{"files":[{"patch":"@@ -580,0 +580,3 @@\n+    \"mov $0, %%r8\\n\\t\"\n+    \"mov $0, %%r9\\n\\t\"\n+    \"mov $0, %%r10\\n\\t\"\n@@ -582,0 +585,2 @@\n+    \"test %%rax, %%rax\\n\\t\" \/\/ exit the loop on error\n+    \"jnz .end\\n\\t\"\n@@ -585,0 +590,1 @@\n+    \".end: nop\\n\\t\"\n@@ -587,1 +593,1 @@\n-    : \"memory\", \"cc\", \"rcx\", \"r11\");\n+    : \"memory\", \"cc\", \"rcx\", \"r8\", \"r9\", \"r10\", \"r11\");\n@@ -599,0 +605,1 @@\n+    \"cbnz x0, .end\\n\\t\" \/\/ exit the loop on error\n@@ -602,1 +609,1 @@\n-    \"mov %[retval], x0\\n\\t\"\n+    \".end: mov %[retval], x0\\n\\t\"\n@@ -616,2 +623,7 @@\n-    perror(\"Syscall wait loop\");\n-    os::exit(1);\n+    \/\/ EAGAIN = EWOULDBLOCK are returned if persist_futex is already 0 (race with the loop condition)\n+    if (errno != EAGAIN && errno != EWOULDBLOCK) {\n+      perror(\"CRaC thread futex wait loop\");\n+      os::exit(1);\n+    }\n+    \/\/ Another option is EINTR when the thread is signalled; this shouldn't happen,\n+    \/\/ though, so we'll treat that as an error.\n","filename":"src\/hotspot\/os\/linux\/crac_linux.cpp","additions":16,"deletions":4,"binary":false,"changes":20,"status":"modified"}]}