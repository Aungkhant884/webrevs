{"files":[{"patch":"@@ -98,1 +98,1 @@\n-        const char* args[] = {\n+        const char* args[32] = {\n@@ -105,1 +105,0 @@\n-            NULL\n@@ -107,0 +106,14 @@\n+        const char** arg = args + 10;\n+        char *criuopts = getenv(\"CRAC_CRIU_OPTS\");\n+        if (criuopts) {\n+            char* criuopt = strtok(criuopts, \" \");\n+            while (criuopt && ARRAY_SIZE(args) >= (size_t)(arg - args) + 1\/* account for trailing NULL *\/) {\n+                *arg++ = criuopt;\n+                criuopt = strtok(NULL, \" \");\n+            }\n+            if (criuopt) {\n+                fprintf(stderr, \"Warning: too many arguments in CRAC_CRIU_OPTS (dropped from '%s')\\n\", criuopt);\n+            }\n+        }\n+        *arg++ = NULL;\n+\n@@ -158,2 +171,10 @@\n-    const char* args[32] = { criu, \"restore\" };\n-    const char** arg = args + 2;\n+    const char* args[32] = {\n+        criu,\n+        \"restore\",\n+        \"-W\", \".\",\n+        \"--shell-job\",\n+        \"--action-script\", self,\n+        \"-D\", imagedir,\n+        \"-v1\"\n+    };\n+    const char** arg = args + 10;\n@@ -165,5 +186,0 @@\n-        \"-W\", \".\",\n-        \"--shell-job\",\n-        \"--action-script\", self,\n-        \"-D\", imagedir,\n-        \"-v1\",\n@@ -173,2 +189,11 @@\n-    static_assert(ARRAY_SIZE(args) >= 2 + ARRAY_SIZE(tail),\n-            \"all possible arguments should fit\");\n+    char *criuopts = getenv(\"CRAC_CRIU_OPTS\");\n+    if (criuopts) {\n+        char* criuopt = strtok(criuopts, \" \");\n+        while (criuopt && ARRAY_SIZE(args) >= (size_t)(arg - args + ARRAY_SIZE(tail))) {\n+            *arg++ = criuopt;\n+            criuopt = strtok(NULL, \" \");\n+        }\n+        if (criuopt) {\n+            fprintf(stderr, \"Warning: too many arguments in CRAC_CRIU_OPTS (dropped from '%s')\\n\", criuopt);\n+        }\n+    }\n","filename":"src\/java.base\/unix\/native\/criuengine\/criuengine.c","additions":36,"deletions":11,"binary":false,"changes":47,"status":"modified"}]}