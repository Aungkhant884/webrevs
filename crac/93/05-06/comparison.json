{"files":[{"patch":"@@ -1149,2 +1149,2 @@\n-  virtual void wait_for_collection_finish() {\n-    G1UncommitRegionTask::wait_if_active();\n+  virtual void finish_collection() {\n+    G1UncommitRegionTask::finish_collection();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-#include \"runtime\/thread.inline.hpp\"\n@@ -133,1 +132,0 @@\n-    _active_sem.signal();\n@@ -139,10 +137,1 @@\n-void G1UncommitRegionTask::_wait_if_active() {\n-  assert(Thread::current_or_null() != NULL, \"no current thread\");\n-  assert(!Thread::current()->is_ConcurrentGC_thread(), \"deadlock prevention\");\n-\n-  while (_active) {\n-    _active_sem.wait();\n-  }\n-}\n-\n-void G1UncommitRegionTask::wait_if_active() {\n+void G1UncommitRegionTask::finish_collection() {\n@@ -151,1 +140,2 @@\n-    _instance->_wait_if_active();\n+    G1CollectedHeap* g1h = G1CollectedHeap::heap();\n+    g1h->uncommit_regions((uint)-1);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1UncommitRegionTask.cpp","additions":3,"deletions":13,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-#include \"runtime\/semaphore.hpp\"\n@@ -50,2 +49,1 @@\n-  volatile bool _active;\n-  Semaphore _active_sem;\n+  bool _active;\n@@ -66,2 +64,0 @@\n-  void _wait_if_active();\n-\n@@ -71,1 +67,1 @@\n-  static void wait_if_active();\n+  static void finish_collection();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1UncommitRegionTask.hpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -369,1 +369,1 @@\n-  virtual void wait_for_collection_finish() {}\n+  virtual void finish_collection() {}\n","filename":"src\/hotspot\/share\/gc\/shared\/collectedHeap.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -408,1 +408,1 @@\n-  Universe::heap()->wait_for_collection_finish();\n+  Universe::heap()->finish_collection();\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}