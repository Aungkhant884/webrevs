{"files":[{"patch":"@@ -29,1 +29,2 @@\n-            String testVarName = \"RESTORE_ENVIRONMENT_TEST_VAR\";\n+            final int testVarCount = 4;\n+            final String testVarName = \"RESTORE_ENVIRONMENT_TEST_VAR\";\n@@ -31,1 +32,1 @@\n-            for (int i = 0; i < 3; ++i) {\n+            for (int i = 0; i < testVarCount; ++i) {\n@@ -39,1 +40,1 @@\n-            for (int i = 0; i < 3; ++i) {\n+            for (int i = 0; i < testVarCount; ++i) {\n","filename":"test\/jdk\/jdk\/crac\/RestoreEnvironmentTest.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -43,0 +43,2 @@\n+export RESTORE_ENVIRONMENT_TEST_VAR2=$BEFORE\n+unset  RESTORE_ENVIRONMENT_TEST_VAR3\n@@ -47,1 +49,3 @@\n-RESULT=`RESTORE_ENVIRONMENT_TEST_VAR2=$NEWVAL ${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=$CHECKPOINT_DIR`\n+unset  RESTORE_ENVIRONMENT_TEST_VAR2 # Use 'unset' to prevent propagating env vars into a restored process\n+export RESTORE_ENVIRONMENT_TEST_VAR3=$NEWVAL\n+RESULT=`${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=$CHECKPOINT_DIR`\n@@ -49,1 +53,1 @@\n-EXPECTED=\"(after restore) RESTORE_ENVIRONMENT_TEST_VAR0=$BEFORE;RESTORE_ENVIRONMENT_TEST_VAR1=$AFTER;RESTORE_ENVIRONMENT_TEST_VAR2=$NEWVAL;\"\n+EXPECTED=\"(after restore) RESTORE_ENVIRONMENT_TEST_VAR0=$BEFORE;RESTORE_ENVIRONMENT_TEST_VAR1=$AFTER;RESTORE_ENVIRONMENT_TEST_VAR2=$BEFORE;RESTORE_ENVIRONMENT_TEST_VAR3=$NEWVAL;\"\n","filename":"test\/jdk\/jdk\/crac\/RestoreEnvironmentTest.sh","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"}]}