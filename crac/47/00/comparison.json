{"files":[{"patch":"@@ -31,1 +31,1 @@\n- * @run main\/othervm -XX:CREngine=simengine -XX:CRaCCheckpointTo=.\/cr -XX:+CRPrintResourcesOnCheckpoint DryRunTest\n+ * @run main\/othervm -XX:CREngine=simengine -XX:CRaCCheckpointTo=.\/cr -XX:+UnlockDiagnosticVMOptions -XX:+CRPrintResourcesOnCheckpoint DryRunTest\n","filename":"test\/jdk\/jdk\/crac\/DryRunTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n- * @run main\/othervm -XX:CREngine=simengine -XX:CRaCCheckpointTo=.\/cr -XX:+CRPrintResourcesOnCheckpoint JarFileFactoryCacheTest\n+ * @run main\/othervm -XX:CREngine=simengine -XX:CRaCCheckpointTo=.\/cr -XX:+UnlockDiagnosticVMOptions -XX:+CRPrintResourcesOnCheckpoint JarFileFactoryCacheTest\n","filename":"test\/jdk\/jdk\/crac\/JarFileFactoryCacheTest\/JarFileFactoryCacheTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,2 @@\n+ * The test will inherit FD with asmtools open and checkpoint would complain; as a workaround we'll add this to classpath\n+ * @library ${jtreg.home}\/lib\/asmtools.jar\n","filename":"test\/jdk\/jdk\/crac\/RefQueueTest.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=cr Test $alg 100\n+${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=cr\n","filename":"test\/jdk\/jdk\/crac\/SecureRandom\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-## @run shell\/timeout=60 Test.sh\n+## @run shell\/timeout=60 Test1.sh\n@@ -46,1 +46,1 @@\n-    ${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=cr Test1 $test\n+    ${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=cr\n@@ -49,1 +49,1 @@\n-    ${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=cr Test1 $test\n+    ${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCRestoreFrom=cr\n","filename":"test\/jdk\/jdk\/crac\/SecureRandom\/Test1.sh","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/Test970\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/interruptedSelection\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/keyAfterRestore\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/multipleSelect\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=cr Test\n+${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=cr\n","filename":"test\/jdk\/jdk\/crac\/Selector\/multipleSelectNow\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/multipleSelectSingleClose\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/selectAfterWakeup\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=cr Test\n+${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=cr\n","filename":"test\/jdk\/jdk\/crac\/Selector\/selectAndWakeupAfterRestore\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/wakeupAfterRestore\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR Test\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR\n","filename":"test\/jdk\/jdk\/crac\/Selector\/wakeupByClose\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n-${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=cr Test\n+${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=cr\n","filename":"test\/jdk\/jdk\/crac\/Selector\/wakeupByTimeoutAfterRestore\/Test.sh","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -192,2 +192,1 @@\n-            pb = ProcessTools.createJavaProcessBuilder(\n-                \"-XX:CRaCRestoreFrom=\" + crImg, \"JoinSleepWaitOnCRPauseTest\");\n+            pb = ProcessTools.createJavaProcessBuilder(\"-XX:CRaCRestoreFrom=\" + crImg);\n","filename":"test\/jdk\/jdk\/crac\/java\/lang\/Thread\/JoinSleepWaitOnCRPauseTest.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n-## @run shell\/timeout=120 Test.sh Test0.sh\n+## @run shell\/timeout=30 Test.sh\n@@ -32,14 +32,15 @@\n-\n-    IMGDIR=\"cr\"\n-\n-    set +e\n-    ${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCCheckpointTo=$IMGDIR -XX:CREngine=pauseengine Test $test 10\n-    e=$?\n-    for run in {1..11}; do\n-        set -e\n-        [ $e -eq 137 ]\n-\n-        ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR  -XX:CREngine=pauseengine Test 10\n-    done\n-    echo \"PASSED $test\"\n-\n+IMGDIR=\"cr\"\n+\n+# We must use pauseengine: CRIU does not support checkpoint after restore, the restored process\n+# has the image directory mapped and second checkpoint would mess this up.\n+${TESTJAVA}\/bin\/java -cp ${TESTCLASSPATH} -XX:CRaCCheckpointTo=$IMGDIR -XX:CREngine=pauseengine Test $test 10 &\n+PID=$!\n+# Wait until the checkpoint happens - inotifywait would be better\n+while [ ! -f $IMGDIR\/pid ]; do sleep 1; done;\n+set -e\n+for run in $(seq 1 11); do\n+    echo \"Restore #\"$run\n+    ${TESTJAVA}\/bin\/java -XX:CRaCRestoreFrom=$IMGDIR -XX:CREngine=pauseengine\n+done\n+wait $PID\n+echo \"PASSED $test\"\n","filename":"test\/jdk\/jdk\/crac\/recursiveCheckpoint\/Test.sh","additions":16,"deletions":15,"binary":false,"changes":31,"status":"modified"}]}