{"files":[{"patch":"@@ -235,0 +235,28 @@\n+    \/**\n+     * Keeps VM alive by at least one non-daemon thread.\n+     *\/\n+    private static class KeepAlive {\n+        private final CountDownLatch start = new CountDownLatch(1);\n+        private final CountDownLatch finish = new CountDownLatch(1);\n+\n+        private final Thread thread = new Thread(() -> {\n+            start.countDown();\n+            try {\n+                finish.await();\n+            } catch (InterruptedException e) {\n+                throw new RuntimeException(e);\n+            }\n+        });\n+\n+        KeepAlive() throws InterruptedException {\n+            thread.setDaemon(false);\n+            thread.start();\n+            start.await();\n+        }\n+\n+        public void stop() throws InterruptedException {\n+            finish.countDown();\n+            thread.join();\n+        }\n+    }\n+\n@@ -248,2 +276,1 @@\n-            Thread keepAliveThread = null;\n-            CountDownLatch finishCleanup = null;\n+            KeepAlive keepAlive = null;\n@@ -258,13 +285,5 @@\n-                    CountDownLatch start = new CountDownLatch(1);\n-                    CountDownLatch finish = new CountDownLatch(1);\n-                    finishCleanup = finish;\n-                    keepAliveThread = new Thread(() -> {\n-                        start.countDown();\n-                        try {\n-                            finish.await();\n-                        } catch (InterruptedException e) {\n-                            throw new RuntimeException(e);\n-                        }\n-                    });\n-                    keepAliveThread.setDaemon(false);\n-                    keepAliveThread.start();\n+                    try {\n+                        keepAlive = new KeepAlive();\n+                    } catch (InterruptedException e) {\n+                        throw new RuntimeException(e);\n+                    }\n@@ -279,2 +298,1 @@\n-                if (finishCleanup != null) {\n-                    finishCleanup.countDown();\n+                if (keepAlive != null) {\n@@ -282,1 +300,1 @@\n-                        keepAliveThread.join();\n+                        keepAlive.stop();\n","filename":"src\/java.base\/share\/classes\/jdk\/crac\/Core.java","additions":36,"deletions":18,"binary":false,"changes":54,"status":"modified"}]}