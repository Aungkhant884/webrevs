{"files":[{"patch":"@@ -21,0 +21,8 @@\n+\n+    public static void error(String msg) {\n+        logger.log(System.Logger.Level.ERROR, msg);\n+    }\n+\n+    public static void error(Throwable t, String msg) {\n+        logger.log(System.Logger.Level.ERROR, msg, t);\n+    }\n","filename":"src\/java.base\/share\/classes\/jdk\/crac\/LoggerContainer.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -101,1 +101,1 @@\n-        CheckpointException exception = new CheckpointException();\n+        CheckpointException exception = null;\n@@ -117,1 +117,9 @@\n-                    for (Throwable t : e.getSuppressed()) {\n+                    enqueueIfContext(r);\n+                    if (exception == null) {\n+                        exception = new CheckpointException();\n+                    }\n+                    Throwable[] suppressed = e.getSuppressed();\n+                    if (suppressed.length == 0) {\n+                        exception.addSuppressed(e);\n+                    }\n+                    for (Throwable t : suppressed) {\n@@ -121,0 +129,4 @@\n+                    enqueueIfContext(r);\n+                    if (exception == null) {\n+                        exception = new CheckpointException();\n+                    }\n@@ -133,1 +145,1 @@\n-        if (0 < exception.getSuppressed().length) {\n+        if (exception != null) {\n@@ -138,0 +150,9 @@\n+    private void enqueueIfContext(R r) {\n+        \/\/ When the resource itself is a context it contains other resources that should\n+        \/\/ be restored upon unsuccessful checkpoint (if the beforeCheckpoint has thrown\n+        \/\/ we are going to call afterRestore on all checkpointed resources immediately)\n+        if (r instanceof Context<?>) {\n+            restoreQ.add(r);\n+        }\n+    }\n+\n@@ -142,1 +163,1 @@\n-            RestoreException exception = new RestoreException();\n+            RestoreException exception = null;\n@@ -148,0 +169,5 @@\n+                    \/\/ Print error early in case the restore process gets stuck\n+                    LoggerContainer.error(e, \"Failed to restore \" + r);\n+                    if (exception == null) {\n+                        exception = new RestoreException();\n+                    }\n@@ -156,0 +182,5 @@\n+                    \/\/ Print error early in case the restore process gets stuck\n+                    LoggerContainer.error(e, \"Failed to restore \" + r);\n+                    if (exception == null) {\n+                        exception = new RestoreException();\n+                    }\n@@ -161,1 +192,1 @@\n-            if (0 < exception.getSuppressed().length) {\n+            if (exception != null) {\n","filename":"src\/java.base\/share\/classes\/jdk\/crac\/impl\/AbstractContextImpl.java","additions":36,"deletions":5,"binary":false,"changes":41,"status":"modified"}]}