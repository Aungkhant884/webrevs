{"files":[{"patch":"@@ -343,1 +343,1 @@\n-  LinuxAttachOperation::effectively_complete(result, st);\n+  LinuxAttachOperation::effectively_complete(result, st, false);\n@@ -356,1 +356,1 @@\n-void LinuxAttachOperation::effectively_complete(jint result, bufferedStream* st) {\n+void LinuxAttachOperation::effectively_complete(jint result, bufferedStream* st, bool cr_call = false) {\n@@ -362,3 +362,4 @@\n-  JavaThread* thread = JavaThread::current();\n-  ThreadBlockInVM tbivm(thread);\n-\n+  if (!cr_call){\n+    JavaThread* thread = JavaThread::current();\n+    ThreadBlockInVM tbivm(thread);\n+  }\n","filename":"src\/hotspot\/os\/linux\/attachListener_linux.cpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-  void effectively_complete(jint res, bufferedStream* st);\n+  void effectively_complete(jint res, bufferedStream* st, bool cr_call);\n","filename":"src\/hotspot\/os\/linux\/linuxAttachOperation.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -399,0 +399,2 @@\n+  outputStream* ostream;\n+  LinuxAttachOperation* jcmd_operation;\n@@ -400,1 +402,1 @@\n-  VM_Crac(bool dry_run) :\n+  VM_Crac(bool dry_run, outputStream* output_stream, LinuxAttachOperation* jcmd_operation) :\n@@ -404,1 +406,3 @@\n-    _restore_parameters(new CracRestoreParameters(NULL, NULL))\n+    _restore_parameters(new CracRestoreParameters(NULL, NULL)),\n+    ostream(output_stream),\n+    jcmd_operation(jcmd_operation)\n@@ -412,2 +416,1 @@\n-  outputStream* ostream;\n-  LinuxAttachOperation* jcmd_operation;\n+\n@@ -6182,1 +6185,1 @@\n-  jcmd_operation->effectively_complete(JNI_OK, buf);\n+  jcmd_operation->effectively_complete(JNI_OK, buf, true);\n@@ -6237,1 +6240,0 @@\n-        ok = true;\n@@ -6252,4 +6254,5 @@\n-  if (!ok) {\n-    if (CRHeapDumpOnCheckpointException){\n-      HeapDumper::dump_heap();\n-    }\n+  if (!ok && CRHeapDumpOnCheckpointException) {\n+    HeapDumper::dump_heap();\n+  }\n+\n+  if (!ok && CRDoThrowCheckpointException) {\n@@ -6384,1 +6387,1 @@\n-  VM_Crac cr(dry_run);\n+  VM_Crac cr(dry_run, (outputStream*) stream, (LinuxAttachOperation*) op);\n@@ -6386,2 +6389,0 @@\n-    cr.jcmd_operation = (LinuxAttachOperation *) op;\n-    cr.ostream = (outputStream *) stream;\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2116,0 +2116,3 @@\n+  product(bool, CRDoThrowCheckpointException, true, EXPERIMENTAL,           \\\n+      \"Throw CheckpointException if uncheckpointable resource handle found\")\\\n+                                                                            \\\n","filename":"src\/hotspot\/share\/runtime\/globals.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}