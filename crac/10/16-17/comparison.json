{"files":[{"patch":"@@ -339,1 +339,1 @@\n-\/\/ An effectively_complete is called in checkpoint processing, before criu engine calls, for properly closing the socket.\n+\/\/ An effectively_complete_raw is called in checkpoint processing, before criu engine calls, for properly closing the socket.\n@@ -343,1 +343,1 @@\n-  LinuxAttachOperation::effectively_complete(result, st, false);\n+  LinuxAttachOperation::effectively_complete_raw(result, st);\n@@ -356,1 +356,1 @@\n-void LinuxAttachOperation::effectively_complete(jint result, bufferedStream* st, bool cr_call = false) {\n+void LinuxAttachOperation::effectively_complete_raw(jint result, bufferedStream* st) {\n@@ -362,3 +362,6 @@\n-  if (!cr_call){\n-    JavaThread* thread = JavaThread::current();\n-    ThreadBlockInVM tbivm(thread);\n+  Thread* thread = Thread::current();\n+  if (thread->is_Java_thread()) {\n+    ThreadBlockInVM((JavaThread* )thread);\n+    write_operation_result(result, st);\n+  } else {\n+    write_operation_result(result, st);\n@@ -366,1 +369,4 @@\n-  \/\/ write operation result\n+  _effectively_completed = true;\n+}\n+\n+void LinuxAttachOperation::write_operation_result(jint result, bufferedStream* st) {\n@@ -379,2 +385,0 @@\n-  _effectively_completed = true;\n-\n","filename":"src\/hotspot\/os\/linux\/attachListener_linux.cpp","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+  void write_operation_result(jint result, bufferedStream* st);\n@@ -37,1 +38,1 @@\n-  void effectively_complete(jint res, bufferedStream* st, bool cr_call);\n+  void effectively_complete_raw(jint res, bufferedStream* st);\n","filename":"src\/hotspot\/os\/linux\/linuxAttachOperation.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -6185,1 +6185,1 @@\n-  jcmd_operation->effectively_complete(JNI_OK, buf, true);\n+  jcmd_operation->effectively_complete(JNI_OK, buf);\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}