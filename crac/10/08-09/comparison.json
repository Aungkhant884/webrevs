{"files":[{"patch":"@@ -6170,1 +6170,1 @@\n-\/\/ If checkpoint is called throught the API, jcmd operation anf jcmd output doesn't exist.\n+\/\/ If checkpoint is called throught the API, jcmd operation and jcmd output doesn't exist.\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1057,1 +1057,1 @@\n-          output()->print_cr(\"An exception durinng checkpoint operation: \");\n+          output()->print_cr(\"An exception during a checkpoint operation: \");\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -58,3 +58,0 @@\n-    private static long jcmd = 0;\n-    private static long ostream = 0;\n-\n@@ -115,1 +112,1 @@\n-    private static void checkpointRestore1() throws\n+    private static void checkpointRestore1(long ostream, long jcmd) throws\n@@ -241,1 +238,1 @@\n-                    checkpointRestore1();\n+                    checkpointRestore1(0, 0);\n@@ -254,0 +251,17 @@\n+    private static void checkpointRestore2(long outputStream_p, long jcmd_p) throws\n+            CheckpointException,\n+            RestoreException {\n+        synchronized (checkpointRestoreLock) {\n+            \/\/ idkn, it worth to protect from multy-thread checkpointing ?  - doesn't have sence for jcmd checkpointing, only for\n+            \/\/ jcmd + comebody through an api ...\n+            if (!checkpointInProgress) {\n+                checkpointInProgress = true;\n+                try {\n+                    checkpointRestore1(outputStream_p, jcmd_p);\n+                } finally {\n+                    checkpointInProgress = false;\n+                }\n+            }\n+        }\n+    }\n+\n@@ -256,2 +270,0 @@\n-        jcmd = jcmd_p;\n-        ostream = outputStream_p;\n@@ -261,1 +273,1 @@\n-            checkpointRestore();\n+            checkpointRestore2(outputStream_p, jcmd_p);\n","filename":"src\/java.base\/share\/classes\/jdk\/crac\/Core.java","additions":20,"deletions":8,"binary":false,"changes":28,"status":"modified"}]}