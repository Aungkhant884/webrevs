{"files":[{"patch":"@@ -295,1 +295,2 @@\n-static void wakeup_threads_in_timedwait() {\n+\/\/ It requires Threads_lock to be held so it is being run as a part of VM_Operation.\n+static void wakeup_threads_in_timedwait_vm() {\n@@ -298,0 +299,1 @@\n+}\n@@ -299,1 +301,4 @@\n-  MonitorLocker ml(PeriodicTask_lock, Mutex::_no_safepoint_check_flag);\n+\/\/ Run it after VM_Operation as it holds Threads_lock which would cause:\n+\/\/ Attempting to acquire lock PeriodicTask_lock\/safepoint out of order with lock Threads_lock\/safepoint-1 -- possible deadlock\n+static void wakeup_threads_in_timedwait() {\n+  MonitorLocker ml(PeriodicTask_lock, Mutex::_safepoint_check_flag);\n@@ -353,1 +358,1 @@\n-  wakeup_threads_in_timedwait();\n+  wakeup_threads_in_timedwait_vm();\n@@ -432,0 +437,3 @@\n+\n+    wakeup_threads_in_timedwait();\n+\n","filename":"src\/hotspot\/share\/runtime\/crac.cpp","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"}]}