{"files":[{"patch":"@@ -315,2 +315,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -320,3 +319,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this));\n@@ -337,2 +334,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -342,3 +338,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this, $src));\n@@ -381,2 +375,1 @@\n-    __ mov(rscratch1, length_in_bytes_resize);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ B, length_in_bytes_resize);\n@@ -1393,2 +1386,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1432,2 +1424,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1462,2 +1453,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ S, vector_length(this, $src2));\n@@ -1489,2 +1479,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1534,2 +1523,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1575,2 +1563,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1622,2 +1609,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1663,2 +1649,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1710,2 +1695,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1751,2 +1735,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1797,2 +1780,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1833,2 +1815,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1869,2 +1850,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ S, vector_length(this, $src2));\n@@ -1903,2 +1883,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1947,2 +1926,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1983,2 +1961,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -2019,2 +1996,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ S, vector_length(this, $src2));\n@@ -2053,2 +2029,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -3233,3 +3208,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, B, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, B, $pTmp, $src\\n\\t\"\n+  format %{ \"sve_extract $dst, B, $pTmp, $src, $idx\\n\\t\"\n@@ -3238,3 +3211,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ B, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ B, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ B, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3252,3 +3224,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, H, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, H, $pTmp, $src\\n\\t\"\n+  format %{ \"sve_extract $dst, H, $pTmp, $src, $idx\\n\\t\"\n@@ -3257,3 +3227,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ H, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ H, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ H, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3272,3 +3241,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, S, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, S, $pTmp, $src\\t# extract from vector(I)\" %}\n+  format %{ \"sve_extract $dst, S, $pTmp, $src, $idx\\t# extract from vector(I)\" %}\n@@ -3276,3 +3243,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ S, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ S, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3289,3 +3255,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, D, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, D, $pTmp, $src\\t# extract from vector(L)\" %}\n+  format %{ \"sve_extract $dst, D, $pTmp, $src, $idx\\t# extract from vector(L)\" %}\n@@ -3293,3 +3257,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ D, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ D, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3306,3 +3269,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, S, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, S, $pTmp, $src\\t# extract from vector(F)\" %}\n+  format %{ \"sve_extract $dst, S, $pTmp, $src, $idx\\t# extract from vector(F)\" %}\n@@ -3310,3 +3271,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n-    __ sve_lastb(as_FloatRegister($dst$$reg), __ S, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_FloatRegister($dst$$reg), __ S, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3323,3 +3283,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, D, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, D, $pTmp, $src\\t# extract from vector(D)\" %}\n+  format %{ \"sve_extract $dst, D, $pTmp, $src, $idx\\t# extract from vector(D)\" %}\n@@ -3327,3 +3285,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n-    __ sve_lastb(as_FloatRegister($dst$$reg), __ D, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_FloatRegister($dst$$reg), __ D, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3388,2 +3345,1 @@\n-    __ mov(rscratch1, vector_length(this, $src1));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), size, vector_length(this, $src1));\n@@ -3409,2 +3365,1 @@\n-    __ mov(rscratch1, vector_length(this, $src1));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), size, vector_length(this, $src1));\n@@ -3684,2 +3639,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3688,2 +3642,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this));\n@@ -3703,2 +3656,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3708,2 +3660,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this));\n@@ -3758,2 +3709,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3762,2 +3712,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this, $src));\n@@ -3777,2 +3726,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3782,2 +3730,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this, $src));\n@@ -3896,2 +3843,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ B, vector_length(this, $src));\n@@ -3912,2 +3858,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pgtmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pgtmp$$reg), __ B, vector_length(this, $src));\n@@ -3928,2 +3873,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ B, vector_length(this, $src));\n@@ -4000,2 +3944,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src));\n@@ -4019,2 +3962,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pgtmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pgtmp$$reg), variant, vector_length(this, $src));\n@@ -4038,2 +3980,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve.ad","additions":57,"deletions":116,"binary":false,"changes":173,"status":"modified"},{"patch":"@@ -252,2 +252,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -257,3 +256,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this));\n@@ -274,2 +271,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -279,3 +275,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this, $src));\n@@ -319,2 +313,1 @@\n-    __ mov(rscratch1, length_in_bytes_resize);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ B, length_in_bytes_resize);\n@@ -1000,2 +993,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1039,2 +1031,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1076,2 +1067,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ $4, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ $4, vector_length(this, $src2));\n@@ -1126,2 +1116,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1167,2 +1156,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1214,2 +1202,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1255,2 +1242,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1302,2 +1288,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1343,2 +1328,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1412,2 +1396,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1435,2 +1418,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1478,2 +1460,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ $4, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ $4, vector_length(this, $src2));\n@@ -2043,3 +2024,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, $3, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, $3, $pTmp, $src\\n\\t\"\n+  format %{ \"sve_extract $dst, $3, $pTmp, $src, $idx\\n\\t\"\n@@ -2048,3 +2027,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ $3, zr, rscratch1);\n-    __ sve_lastb(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -2067,3 +2045,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, $3, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, $3, $pTmp, $src\\t# extract from vector($1)\" %}\n+  format %{ \"sve_extract $dst, $3, $pTmp, $src, $idx\\t# extract from vector($1)\" %}\n@@ -2071,3 +2047,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ $3, zr, rscratch1);\n-    __ sve_lastb(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -2127,2 +2102,1 @@\n-    __ mov(rscratch1, vector_length(this, $src1));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), size, vector_length(this, $src1));\n@@ -2389,2 +2363,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2393,2 +2366,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this));\n@@ -2408,2 +2380,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2413,2 +2384,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this));\n@@ -2463,2 +2433,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2467,2 +2436,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this, $src));\n@@ -2482,2 +2450,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2487,2 +2454,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this, $src));\n@@ -2569,2 +2535,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister(ifelse($1, `firsttrue', `$pgtmp', `$ptmp')$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister(ifelse($1, `firsttrue', `$pgtmp', `$ptmp')$$reg), __ B, vector_length(this, $src));\n@@ -2621,2 +2586,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister(ifelse($1, `firsttrue', `$pgtmp', `$ptmp')$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister(ifelse($1, `firsttrue', `$pgtmp', `$ptmp')$$reg), variant, vector_length(this, $src));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve_ad.m4","additions":34,"deletions":70,"binary":false,"changes":104,"status":"modified"},{"patch":"@@ -67,0 +67,20 @@\n+  \/\/ Generate predicate through whilelo, by comparing ZR with an unsigned\n+  \/\/ immediate. rscratch1 will be clobbered.\n+  inline void sve_whilelo_zr_imm(PRegister pd, SIMD_RegVariant size, uint imm) {\n+    assert(UseSVE > 0, \"not supported\");\n+    mov(rscratch1, imm);\n+    sve_whilelo(pd, size, zr, rscratch1);\n+  }\n+\n+  \/\/ Extract a scalar element from an sve vector at position 'idx'.\n+  \/\/ rscratch1 will be clobbered.\n+  \/\/ T could be FloatRegister or Register.\n+  template<class T>\n+  inline void sve_extract(T dst, SIMD_RegVariant size, PRegister pg, FloatRegister src, int idx) {\n+    assert(UseSVE > 0, \"not supported\");\n+    assert(pg->is_governing(), \"This register has to be a governing predicate register\");\n+    mov(rscratch1, idx);\n+    sve_whilele(pg, size, zr, rscratch1);\n+    sve_lastb(dst, size, pg, src);\n+  }\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.hpp","additions":20,"deletions":0,"binary":false,"changes":20,"status":"modified"}]}