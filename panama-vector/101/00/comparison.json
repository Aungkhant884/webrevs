{"files":[{"patch":"@@ -319,2 +319,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -324,3 +323,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this));\n@@ -341,2 +338,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -346,3 +342,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this, $src));\n@@ -385,2 +379,1 @@\n-    __ mov(rscratch1, length_in_bytes_resize);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ B, length_in_bytes_resize);\n@@ -1397,2 +1390,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1436,2 +1428,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1466,2 +1457,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ S, vector_length(this, $src2));\n@@ -1493,2 +1483,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1538,2 +1527,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1579,2 +1567,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1626,2 +1613,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1667,2 +1653,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1714,2 +1699,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1755,2 +1739,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1801,2 +1784,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1837,2 +1819,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1873,2 +1854,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ S, vector_length(this, $src2));\n@@ -1907,2 +1887,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1951,2 +1930,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1987,2 +1965,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -2023,2 +2000,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ S, vector_length(this, $src2));\n@@ -2057,2 +2033,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -3237,3 +3212,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, B, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, B, $pTmp, $src\\n\\t\"\n+  format %{ \"sve_extract $dst, B, $pTmp, $src, $idx\\n\\t\"\n@@ -3242,3 +3215,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ B, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ B, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ B, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3256,3 +3228,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, H, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, H, $pTmp, $src\\n\\t\"\n+  format %{ \"sve_extract $dst, H, $pTmp, $src, $idx\\n\\t\"\n@@ -3261,3 +3231,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ H, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ H, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ H, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3276,3 +3245,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, S, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, S, $pTmp, $src\\t# extract from vector(I)\" %}\n+  format %{ \"sve_extract $dst, S, $pTmp, $src, $idx\\t# extract from vector(I)\" %}\n@@ -3280,3 +3247,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ S, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ S, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3293,3 +3259,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, D, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, D, $pTmp, $src\\t# extract from vector(L)\" %}\n+  format %{ \"sve_extract $dst, D, $pTmp, $src, $idx\\t# extract from vector(L)\" %}\n@@ -3297,3 +3261,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n-    __ sve_lastb(as_Register($dst$$reg), __ D, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_Register($dst$$reg), __ D, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3310,3 +3273,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, S, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, S, $pTmp, $src\\t# extract from vector(F)\" %}\n+  format %{ \"sve_extract $dst, S, $pTmp, $src, $idx\\t# extract from vector(F)\" %}\n@@ -3314,3 +3275,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n-    __ sve_lastb(as_FloatRegister($dst$$reg), __ S, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_FloatRegister($dst$$reg), __ S, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3327,3 +3287,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, D, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, D, $pTmp, $src\\t# extract from vector(D)\" %}\n+  format %{ \"sve_extract $dst, D, $pTmp, $src, $idx\\t# extract from vector(D)\" %}\n@@ -3331,3 +3289,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n-    __ sve_lastb(as_FloatRegister($dst$$reg), __ D, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_FloatRegister($dst$$reg), __ D, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -3392,2 +3349,1 @@\n-    __ mov(rscratch1, vector_length(this, $src1));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), size, vector_length(this, $src1));\n@@ -3413,2 +3369,1 @@\n-    __ mov(rscratch1, vector_length(this, $src1));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), size, vector_length(this, $src1));\n@@ -3688,2 +3643,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3692,2 +3646,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this));\n@@ -3707,2 +3660,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3712,2 +3664,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this));\n@@ -3762,2 +3713,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3766,2 +3716,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this, $src));\n@@ -3781,2 +3730,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -3786,2 +3734,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this, $src));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve.ad","additions":51,"deletions":104,"binary":false,"changes":155,"status":"modified"},{"patch":"@@ -256,2 +256,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -261,3 +260,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this));\n@@ -278,2 +275,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -283,3 +279,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    Assembler::SIMD_RegVariant size = __ elemType_to_regVariant(bt);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ elemType_to_regVariant(bt), vector_length(this, $src));\n@@ -323,2 +317,1 @@\n-    __ mov(rscratch1, length_in_bytes_resize);\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ B, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ B, length_in_bytes_resize);\n@@ -1004,2 +997,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1043,2 +1035,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1080,2 +1071,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ $4, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ $4, vector_length(this, $src2));\n@@ -1130,2 +1120,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1171,2 +1160,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1218,2 +1206,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1259,2 +1246,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1306,2 +1292,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1347,2 +1332,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1416,2 +1400,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), variant, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), variant, vector_length(this, $src2));\n@@ -1439,2 +1422,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ D, vector_length(this, $src2));\n@@ -1482,2 +1464,1 @@\n-    __ mov(rscratch1, vector_length(this, $src2));\n-    __ sve_whilelo(as_PRegister($ptmp$$reg), __ $4, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($ptmp$$reg), __ $4, vector_length(this, $src2));\n@@ -2047,3 +2028,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, $3, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, $3, $pTmp, $src\\n\\t\"\n+  format %{ \"sve_extract $dst, $3, $pTmp, $src, $idx\\n\\t\"\n@@ -2052,3 +2031,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ $3, zr, rscratch1);\n-    __ sve_lastb(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -2071,3 +2049,1 @@\n-  format %{ \"movzw rscratch1, $idx\\n\\t\"\n-            \"sve_whilele $pTmp, $3, zr, rscratch1\\n\\t\"\n-            \"sve_lastb $dst, $3, $pTmp, $src\\t# extract from vector($1)\" %}\n+  format %{ \"sve_extract $dst, $3, $pTmp, $src, $idx\\t# extract from vector($1)\" %}\n@@ -2075,3 +2051,2 @@\n-    __ movzw(rscratch1, (int)($idx$$constant));\n-    __ sve_whilele(as_PRegister($pTmp$$reg), __ $3, zr, rscratch1);\n-    __ sve_lastb(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg), as_FloatRegister($src$$reg));\n+    __ sve_extract(as_$4($dst$$reg), __ $3, as_PRegister($pTmp$$reg),\n+                   as_FloatRegister($src$$reg), (int)($idx$$constant));\n@@ -2131,2 +2106,1 @@\n-    __ mov(rscratch1, vector_length(this, $src1));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), size, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), size, vector_length(this, $src1));\n@@ -2393,2 +2367,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2397,2 +2370,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this));\n@@ -2412,2 +2384,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2417,2 +2388,1 @@\n-    __ mov(rscratch1, vector_length(this));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this));\n@@ -2467,2 +2437,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2471,2 +2440,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ S, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ S, vector_length(this, $src));\n@@ -2486,2 +2454,1 @@\n-  format %{ \"mov rscratch1, vector_length\\n\\t\"\n-            \"sve_whilelo $pTmp, zr, rscratch1\\n\\t\"\n+  format %{ \"sve_whilelo_zr_imm $pTmp, vector_length\\n\\t\"\n@@ -2491,2 +2458,1 @@\n-    __ mov(rscratch1, vector_length(this, $src));\n-    __ sve_whilelo(as_PRegister($pTmp$$reg), __ D, zr, rscratch1);\n+    __ sve_whilelo_zr_imm(as_PRegister($pTmp$$reg), __ D, vector_length(this, $src));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve_ad.m4","additions":32,"deletions":66,"binary":false,"changes":98,"status":"modified"},{"patch":"@@ -64,0 +64,20 @@\n+  \/\/ Generate predicate through whilelo, by comparing ZR with an unsigned\n+  \/\/ immediate. rscratch1 will be clobbered.\n+  inline void sve_whilelo_zr_imm(PRegister pd, SIMD_RegVariant size, uint imm) {\n+    assert(UseSVE > 0, \"not supported\");\n+    mov(rscratch1, imm);\n+    sve_whilelo(pd, size, zr, rscratch1);\n+  }\n+\n+  \/\/ Extract a scalar element from an sve vector at position 'idx'.\n+  \/\/ rscratch1 will be clobbered.\n+  \/\/ T could be FloatRegister or Register.\n+  template<class T>\n+  inline void sve_extract(T dst, SIMD_RegVariant size, PRegister pg, FloatRegister src, int idx) {\n+    assert(UseSVE > 0, \"not supported\");\n+    assert(pg->is_governing(), \"This register has to be a governing predicate register\");\n+    mov(rscratch1, idx);\n+    sve_whilele(pg, size, zr, rscratch1);\n+    sve_lastb(dst, size, pg, src);\n+  }\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.hpp","additions":20,"deletions":0,"binary":false,"changes":20,"status":"modified"}]}