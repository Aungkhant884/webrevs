{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -136,6 +136,19 @@\n-        ::EnumPrinters(flags,\n-                       NULL, 4, NULL, 0, &cbNeeded, &cReturned);\n-        pPrinterEnum = new BYTE[cbNeeded];\n-        ::EnumPrinters(flags,\n-                       NULL, 4, pPrinterEnum, cbNeeded, &cbNeeded,\n-                       &cReturned);\n+        ::EnumPrinters(flags, NULL, 4, NULL,\n+                       0, &cbNeeded, &cReturned);\n+\n+        BOOL bResult;\n+        int nCount = 0;\n+        do {\n+            if (pPrinterEnum != NULL) {\n+                delete [] pPrinterEnum;\n+            }\n+            pPrinterEnum = new BYTE[cbNeeded];\n+\n+            bResult = ::EnumPrinters(flags, NULL, 4, pPrinterEnum,\n+                                     cbNeeded, &cbNeeded, &cReturned);\n+        } while (!bResult && ++nCount < 5);\n+\n+        if (!bResult) {\n+            \/\/ No printers in case of error\n+            cReturned = 0;\n+        }\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/WPrinterJob.cpp","additions":20,"deletions":7,"binary":false,"changes":27,"status":"modified"}]}