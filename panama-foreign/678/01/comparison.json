{"files":[{"patch":"@@ -164,19 +164,17 @@\n-  AC_MSG_CHECKING([if make --output-sync is supported])\n-  if $MAKE --version -O > \/dev\/null 2>&1; then\n-    OUTPUT_SYNC_SUPPORTED=true\n-    AC_MSG_RESULT([yes])\n-    AC_MSG_CHECKING([for output-sync value])\n-    AC_ARG_WITH([output-sync], [AS_HELP_STRING([--with-output-sync],\n-      [set make output sync type if supported by make. @<:@recurse@:>@])],\n-      [OUTPUT_SYNC=$with_output_sync])\n-    if test \"x$OUTPUT_SYNC\" = \"x\"; then\n-      OUTPUT_SYNC=none\n-    fi\n-    AC_MSG_RESULT([$OUTPUT_SYNC])\n-    if ! $MAKE --version -O$OUTPUT_SYNC > \/dev\/null 2>&1; then\n-      AC_MSG_ERROR([Make did not the support the value $OUTPUT_SYNC as output sync type.])\n-    fi\n-  else\n-    OUTPUT_SYNC_SUPPORTED=false\n-    AC_MSG_RESULT([no])\n-  fi\n+  UTIL_ARG_WITH(NAME: output-sync, TYPE: literal,\n+      VALID_VALUES: [none recurse line target], DEFAULT: recurse,\n+      OPTIONAL: true, ENABLED_DEFAULT: true,\n+      ENABLED_RESULT: OUTPUT_SYNC_SUPPORTED,\n+      CHECKING_MSG: [for make --output-sync value],\n+      DESC: [set make --output-sync type if supported by make],\n+      CHECK_AVAILABLE:\n+      [\n+        AC_MSG_CHECKING([if make --output-sync is supported])\n+        if ! $MAKE --version -O > \/dev\/null 2>&1; then\n+          AC_MSG_RESULT([no])\n+          AVAILABLE=false\n+        else\n+          AC_MSG_RESULT([yes])\n+        fi\n+      ]\n+  )\n@@ -377,10 +375,7 @@\n-    if test \"x$CODESIGN\" != \"x\"; then\n-      # Check for user provided code signing identity.\n-      # If no identity was provided, fall back to \"openjdk_codesign\".\n-      AC_ARG_WITH([macosx-codesign-identity], [AS_HELP_STRING([--with-macosx-codesign-identity],\n-        [specify the code signing identity])],\n-        [MACOSX_CODESIGN_IDENTITY=$with_macosx_codesign_identity],\n-        [MACOSX_CODESIGN_IDENTITY=openjdk_codesign]\n-      )\n-\n-      AC_SUBST(MACOSX_CODESIGN_IDENTITY)\n+    # Check for user provided code signing identity.\n+    UTIL_ARG_WITH(NAME: macosx-codesign-identity, TYPE: string,\n+        DEFAULT: openjdk_codesign, CHECK_VALUE: UTIL_CHECK_STRING_NON_EMPTY,\n+        DESC: [specify the macosx code signing identity],\n+        CHECKING_MSG: [for macosx code signing identity]\n+    )\n+    AC_SUBST(MACOSX_CODESIGN_IDENTITY)\n@@ -388,0 +383,1 @@\n+    if test \"x$CODESIGN\" != \"x\"; then\n","filename":"make\/autoconf\/basic_tools.m4","additions":25,"deletions":29,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -147,1 +147,2 @@\n-         test \"x$OPENJDK_TARGET_CPU\" = xsh); then\n+         test \"x$OPENJDK_TARGET_CPU\" = xsh ||\n+         test \"x$OPENJDK_TARGET_CPU\" = xriscv32); then\n","filename":"make\/autoconf\/libraries.m4","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -129,0 +129,6 @@\n+    riscv32)\n+      VAR_CPU=riscv32\n+      VAR_CPU_ARCH=riscv\n+      VAR_CPU_BITS=32\n+      VAR_CPU_ENDIAN=little\n+      ;;\n@@ -564,0 +570,2 @@\n+  elif test \"x$OPENJDK_$1_CPU\" = xriscv32; then\n+    HOTSPOT_$1_CPU_DEFINE=RISCV32\n","filename":"make\/autoconf\/platform.m4","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -242,1 +242,2 @@\n-    timestamp=$($DATE -u -j -f \"%FZ %TZ\" \"$2\" \"+%s\" 2> \/dev\/null)\n+    # ISO-8601 date&time in Zulu 'date'T'time'Z\n+    timestamp=$($DATE -u -j -f \"%FT%TZ\" \"$2\" \"+%s\" 2> \/dev\/null)\n@@ -248,0 +249,4 @@\n+    if test \"x$timestamp\" = x; then\n+      # Perhaps the time was missing.\n+      timestamp=$($DATE -u -j -f \"%FT%TZ\" \"$2\"\"T00:00:00Z\" \"+%s\" 2> \/dev\/null)\n+    fi\n@@ -326,1 +331,1 @@\n-# is not available, as specified by AVAILABLE and\/or AVAILABLE_CHECK.\n+# is not available, as specified by AVAILABLE and\/or CHECK_AVAILABLE.\n@@ -331,1 +336,1 @@\n-#     <NAME in uppercase>_RESULT.\n+#     <NAME in uppercase>_ENABLED.\n@@ -377,1 +382,1 @@\n-  m4_define([ARG_CHECKING_MSG], m4_if(ARG_CHECKING_MSG, , [for --enable-ARG_NAME], ARG_CHECKING_MSG))\n+  m4_define([ARG_CHECKING_MSG], m4_if(ARG_CHECKING_MSG, , [for --enable-ARG_NAME], m4_normalize(ARG_CHECKING_MSG)))\n@@ -464,0 +469,348 @@\n+###############################################################################\n+# Helper functions for ARG_WITH, to validate different types of argument\n+\n+# Dispatcher to call the correct UTIL_CHECK_TYPE_* function depending on the ARG_TYPE\n+AC_DEFUN([UTIL_CHECK_TYPE],\n+[\n+  UTIL_CHECK_TYPE_$1($2)\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_string],\n+[\n+  # All strings always passes\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_integer],\n+[\n+  # Check that the argument is an integer\n+  # Additional [] needed to keep m4 from mangling shell constructs.\n+  [ if [[ ! \"$1\" =~ ^[0-9]+$ ]] ; then ]\n+    FAILURE=\"Not an integer: $1\"\n+  fi\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_file],\n+[\n+  # Check that the argument is an existing file\n+  if test ! -f \"$1\" ; then\n+    FAILURE=\"File $1 does not exist or is not readable\"\n+  fi\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_directory],\n+[\n+  # Check that the argument is an existing directory\n+  if test ! -d \"$1\" ; then\n+    FAILURE=\"Directory $1 does not exist or is not readable\"\n+  fi\n+\n+  if test \"[x]ARG_CHECK_FOR_FILES\" != x; then\n+    for file in ARG_CHECK_FOR_FILES; do\n+      found_files=$($ECHO $(ls $1\/$file 2> \/dev\/null))\n+      if test \"x$found_files\" = x; then\n+        FAILURE=\"Directory $1 does not contain $file\"\n+        break\n+      elif ! test -e \"$found_files\"; then\n+        FAILURE=\"Directory $1 contains multiple $file: $found_files\"\n+        break\n+      fi\n+    done\n+  fi\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_literal],\n+[\n+  # Check if it contains a space between non-space characters\n+  # Additional [] needed to keep m4 from mangling shell constructs.\n+  [ if [[ \"$1\" =~ [^' ']' '+[^' '] ]] ; then ]\n+    FAILURE=\"Multiple words: $1\"\n+  fi\n+\n+  # Check that the selected variants are valid\n+  UTIL_GET_NON_MATCHING_VALUES(invalid_value, $1, \\\n+      ARG_VALID_VALUES)\n+  if test \"x$invalid_value\" != x; then\n+    FAILURE=\"Invalid value: $invalid_value. Valid values are: ARG_VALID_VALUES\"\n+  fi\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_multivalue],\n+[\n+  # We accept either space or comma as separator, but use space internally\n+  values=`$ECHO $1 | $SED -e 's\/,\/ \/g'`\n+\n+  # Check that the selected variants are valid\n+  UTIL_GET_NON_MATCHING_VALUES(invalid_value, $values, \\\n+      ARG_VALID_VALUES)\n+  if test \"x$invalid_value\" != x; then\n+    FAILURE=\"Invalid value(s): $invalid_value. Valid values are: ARG_VALID_VALUES\"\n+  fi\n+\n+  # Update to version without comma\n+  ARG_RESULT=$($ECHO $values)\n+])\n+\n+AC_DEFUN([UTIL_CHECK_TYPE_features],\n+[\n+  # We accept either space or comma as separator, but use space internally\n+  feature_list=`$ECHO $1 | $SED -e 's\/,\/ \/g'`\n+  features_enabled=`$ECHO $feature_list | \\\n+    $AWK '{ for (i=1; i<=NF; i++) if (!match($i, \/^-.*\/)) printf(\"%s \", $i) }'`\n+  features_disabled=`$ECHO $feature_list | \\\n+    $AWK '{ for (i=1; i<=NF; i++) if (match($i, \/^-.*\/)) printf(\"%s \", substr($i, 2))}'`\n+\n+  # Check that the selected features are valid\n+  UTIL_GET_NON_MATCHING_VALUES(invalid_features, $features_enabled \\\n+        $features_disabled, ARG_VALID_VALUES)\n+  if test \"x$invalid_features\" != x; then\n+    FAILURE=\"Invalid feature(s): $invalid_features. Valid values are: ARG_VALID_VALUES\"\n+  fi\n+\n+  # Update to version without comma\n+  ARG_RESULT=$($ECHO $feature_list)\n+])\n+\n+###############################################################################\n+# Creates a command-line option using the --with-* pattern. Will return a\n+# string in the RESULT variable with the option provided by the user, or the\n+# empty string if the --with-* option was not given. The option can not be given\n+# if it is not available, as specified by AVAILABLE and\/or CHECK_AVAILABLE.\n+#\n+# Arguments:\n+#   NAME: The base name of this option (i.e. what follows --with-). Required.\n+#   TYPE: The type of the value. Can be one of \"string\", \"integer\", \"file\",\n+#     \"directory\", \"literal\", \"multivalue\" or \"features\". Required.\n+#   DEFAULT: The default value for this option. Can be any valid string.\n+#     Required.\n+#   OPTIONAL: If this feature can be disabled. Defaults to false. If true,\n+#     the feature can be disabled using --without-FOO, --with-FOO=no, or\n+#     --with-FOO=. Check the ENABLED_RESULT variable for the enabled\/disabled\n+#     state.\n+#   RESULT: The name of the variable to set to the result. Defaults to\n+#     <NAME in uppercase>. Set to empty if ENABLED_RESULT is false.\n+#   ENABLED_DEFAULT: If the value is enabled by default. Defaults to false. Only\n+#     relevant if OPTIONAL is true.\n+#   ENABLED_RESULT: The name of the variable to set to the enabled\/disabled\n+#     result state. Defaults to <NAME in uppercase>_ENABLED.\n+#   AVAILABLE: If true, this option is allowed to be selected. Defaults to true.\n+#   DESC: A description of this option. Defaults to a generic and unhelpful\n+#     string.\n+#   DEFAULT_DESC: A message describing the default value, for the help. Defaults\n+#     to the literal value of DEFAULT, or \"<none>\" if DEFAULT is empty.\n+#   CHECKING_MSG: The message to present to user when checking this option.\n+#     Defaults to a generic message.\n+#   CHECK_AVAILABLE: An optional code block to execute to determine if the\n+#     option should be available. Must set AVAILABLE to 'false' if not.\n+#   VALID_VALUES: A list of literals that are the allowed values. Only valid if\n+#     TYPE is \"literal\", \"multivalue\" or \"features\".\n+#   CHECK_VALUE: An optional code block to execute to determine if the value\n+#     is correct. Must set FAILURE to a non-empty string if not. This string\n+#     will be displayed. The value is given in $RESULT.\n+#   CHECK_FOR_FILES: A list of files to verify the presence for. Only valid if\n+#     TYPE is \"directory\". Paths are relative the directory given as value.\n+#     Wildcards are accepted. Exactly one matching file must be found, for each\n+#     listed file, or FAILURE is set.\n+#   IF_AUTO: An optional code block to execute if the value is \"auto\", either by\n+#     default or given by the command line. Must set RESULT to the calculated\n+#     value.\n+#   IF_GIVEN:  An optional code block to execute if the option was given on the\n+#     command line (regardless of the value).\n+#   IF_NOT_GIVEN:  An optional code block to execute if the option was not given\n+#     on the command line (regardless of the value).\n+#\n+UTIL_DEFUN_NAMED([UTIL_ARG_WITH],\n+    [*NAME *TYPE *DEFAULT OPTIONAL RESULT ENABLED_DEFAULT ENABLED_RESULT\n+    AVAILABLE DESC DEFAULT_DESC CHECKING_MSG CHECK_AVAILABLE VALID_VALUES\n+    CHECK_VALUE CHECK_FOR_FILES IF_AUTO IF_GIVEN IF_NOT_GIVEN], [$@],\n+[\n+  ##########################\n+  # Part 1: Set up m4 macros\n+  ##########################\n+\n+  # If ENABLED_DEFAULT is not specified, set it to 'false'.\n+  m4_define([ARG_ENABLED_DEFAULT], m4_if(ARG_ENABLED_DEFAULT, , false, ARG_ENABLED_DEFAULT))\n+\n+  # If AVAILABLE is not specified, set it to 'true'.\n+  m4_define([ARG_AVAILABLE], m4_if(ARG_AVAILABLE, , true, ARG_AVAILABLE))\n+\n+  # If OPTIONAL is not specified, set it to 'false'.\n+  m4_define([ARG_OPTIONAL], m4_if(ARG_OPTIONAL, , false, ARG_OPTIONAL))\n+\n+  # If DEFAULT_DESC is not specified, calculate it from DEFAULT.\n+  m4_define([ARG_DEFAULT_DESC], m4_if(ARG_DEFAULT_DESC, , m4_if(ARG_DEFAULT, , <none>, ARG_DEFAULT), ARG_DEFAULT_DESC))\n+\n+  # If RESULT is not specified, set it to 'ARG_NAME'.\n+  m4_define([ARG_RESULT], m4_if(ARG_RESULT, , m4_translit(ARG_NAME, [a-z-], [A-Z_]), ARG_RESULT))\n+\n+  # If ENABLED_RESULT is not specified, set it to 'ARG_NAME[_ENABLED]'.\n+  m4_define([ARG_ENABLED_RESULT], m4_if(ARG_ENABLED_RESULT, , m4_translit(ARG_NAME, [a-z-], [A-Z_])[_ENABLED], ARG_ENABLED_RESULT))\n+\n+  # Construct shell variable names for the option\n+  m4_define(ARG_OPTION, [with_]m4_translit(ARG_NAME, [-], [_]))\n+  m4_define(ARG_GIVEN, m4_translit(ARG_NAME, [a-z-], [A-Z_])[_GIVEN])\n+\n+  # If DESC is not specified, set it to a generic description.\n+  m4_define([ARG_DESC], m4_if(ARG_DESC, , [Give a value for the ARG_NAME feature], m4_normalize(ARG_DESC)))\n+\n+  # If CHECKING_MSG is not specified, set it to a generic description.\n+  m4_define([ARG_CHECKING_MSG], m4_if(ARG_CHECKING_MSG, , [for --with-ARG_NAME], m4_normalize(ARG_CHECKING_MSG)))\n+\n+  m4_define([ARG_HAS_AUTO_BLOCK], m4_if(ARG_IF_AUTO, , false, true))\n+\n+  # If the code blocks are not given, set them to the empty statements to avoid\n+  # tripping up bash.\n+  m4_define([ARG_CHECK_AVAILABLE], m4_if(ARG_CHECK_AVAILABLE, , :, ARG_CHECK_AVAILABLE))\n+  m4_define([ARG_CHECK_VALUE], m4_if(ARG_CHECK_VALUE, , :, ARG_CHECK_VALUE))\n+  m4_define([ARG_CHECK_FOR_FILES], m4_if(ARG_CHECK_FOR_FILES, , :, ARG_CHECK_FOR_FILES))\n+  m4_define([ARG_IF_AUTO], m4_if(ARG_IF_AUTO, , :, ARG_IF_AUTO))\n+  m4_define([ARG_IF_GIVEN], m4_if(ARG_IF_GIVEN, , :, ARG_IF_GIVEN))\n+  m4_define([ARG_IF_NOT_GIVEN], m4_if(ARG_IF_NOT_GIVEN, , :, ARG_IF_NOT_GIVEN))\n+\n+  ##########################\n+  # Part 2: Set up autoconf shell code\n+  ##########################\n+\n+  # Check that OPTIONAL has a valid value\n+  if test \"[x]ARG_OPTIONAL\" != xtrue && test \"[x]ARG_OPTIONAL\" != xfalse ; then\n+    AC_MSG_ERROR([Internal error: Argument OPTIONAL to [UTIL_ARG_WITH] can only be true or false, was: 'ARG_OPTIONAL'])\n+  fi\n+\n+  # Check that ENABLED_DEFAULT has a valid value\n+  if test \"[x]ARG_ENABLED_DEFAULT\" != xtrue && test \"[x]ARG_ENABLED_DEFAULT\" != xfalse ; then\n+    AC_MSG_ERROR([Internal error: Argument ENABLED_DEFAULT to [UTIL_ARG_WITH] can only be true or false, was: 'ARG_ENABLED_DEFAULT'])\n+  fi\n+\n+  # Check that AVAILABLE has a valid value\n+  if test \"[x]ARG_AVAILABLE\" != xtrue && test \"[x]ARG_AVAILABLE\" != xfalse; then\n+    AC_MSG_ERROR([Internal error: Argument AVAILABLE to [UTIL_ARG_WITH] can only be true or false, was: 'ARG_AVAILABLE'])\n+  fi\n+\n+  # Check that TYPE has a valid value\n+  # Need to assign since we can't expand ARG TYPE inside the m4 quoted if statement\n+  TEST_TYPE=\"ARG_TYPE\"\n+  # Additional [] needed to keep m4 from mangling shell constructs.\n+  [ if [[ ! \"$TEST_TYPE\" =~ ^(string|integer|file|directory|literal|multivalue|features)$ ]] ; then ]\n+    AC_MSG_ERROR([Internal error: Argument TYPE to [UTIL_ARG_WITH] must be a valid type, was: 'ARG_TYPE'])\n+  fi\n+\n+  AC_ARG_WITH(ARG_NAME, AS_HELP_STRING([--with-]ARG_NAME,\n+      [ARG_DESC [ARG_DEFAULT_DESC]]), [ARG_GIVEN=true], [ARG_GIVEN=false])\n+\n+  # Check if the option is available\n+  AVAILABLE=ARG_AVAILABLE\n+  # Run the available check block (if any), which can overwrite AVAILABLE.\n+  ARG_CHECK_AVAILABLE\n+\n+  # Check if the option should be turned on\n+  echo check msg:ARG_CHECKING_MSG:\n+  AC_MSG_CHECKING(ARG_CHECKING_MSG)\n+\n+  if test x$AVAILABLE = xfalse; then\n+    ARG_RESULT=\"$ARG_OPTION\"\n+    ARG_ENABLED_RESULT=false\n+    REASON=\"not available\"\n+  else\n+    if test x$ARG_GIVEN = xfalse; then\n+      ARG_RESULT=\"ARG_DEFAULT\"\n+      if test \"[x]ARG_OPTIONAL\" = xtrue; then\n+        ARG_ENABLED_RESULT=ARG_ENABLED_DEFAULT\n+      else\n+        ARG_ENABLED_RESULT=true\n+      fi\n+      REASON=\"default\"\n+\n+    else # ARG_GIVEN is true\n+      # Special treatment of \"yes\" and \"no\" for \"--with-ARG\" and \"--without-ARG\"\n+      if test \"x$ARG_OPTION\" = xyes || test \"x$ARG_OPTION\" = xno || test \"x$ARG_OPTION\" = x ; then\n+        if test \"[x]ARG_OPTIONAL\" = xfalse; then\n+          if test \"x$ARG_OPTION\" = x; then\n+            # If not optional, the empty string is a valid value\n+            ARG_RESULT=\"\"\n+            ARG_ENABLED_RESULT=true\n+            REASON=\"from command line\"\n+          else\n+            AC_MSG_RESULT([invalid])\n+            AC_MSG_ERROR([Option [--with-]ARG_NAME must have a specified value])\n+          fi\n+        else\n+          if test \"x$ARG_OPTION\" = xyes; then\n+            ARG_RESULT=\"ARG_DEFAULT\"\n+            ARG_ENABLED_RESULT=true\n+            REASON=\"default as enabled from command line\"\n+          else\n+            # For optional values, both --without-FOO and --with-FOO= disables\n+            ARG_RESULT=\"\"\n+            ARG_ENABLED_RESULT=false\n+            REASON=\"from command line\"\n+          fi\n+        fi\n+      else\n+        # The most common case -- the user gives a value for the option.\n+        ARG_RESULT=\"$ARG_OPTION\"\n+        ARG_ENABLED_RESULT=true\n+        REASON=\"from command line\"\n+      fi\n+    fi\n+  fi\n+\n+  if test \"x$ARG_ENABLED_RESULT\" = xfalse; then\n+    if test \"x$REASON\" = \"xnot available\"; then\n+      AC_MSG_RESULT([<invalid>, $REASON])\n+      if test \"x$ARG_RESULT\" != \"x\" && test \"x$ARG_RESULT\" != \"xno\" ; then\n+        AC_MSG_WARN([Option [--with-]ARG_NAME is not available for this configuration])\n+      fi\n+    else\n+      AC_MSG_RESULT([<disabled>, $REASON])\n+    fi\n+    ARG_RESULT=\"\"\n+  else\n+    if test [x]ARG_HAS_AUTO_BLOCK = xtrue && test \"x$ARG_RESULT\" = xauto; then\n+      # Execute \"auto\" payload\n+      ARG_IF_AUTO\n+\n+      ARG_RESULT=\"$RESULT\"\n+      REASON=\"$REASON (calculated from 'auto')\"\n+    fi\n+\n+    if test \"x$ARG_RESULT\" = x; then\n+      AC_MSG_RESULT([<none>, $REASON])\n+    else\n+      AC_MSG_RESULT([$ARG_RESULT, $REASON])\n+    fi\n+  fi\n+\n+  # Verify value\n+  # First use our dispatcher to verify that type requirements are satisfied\n+  UTIL_CHECK_TYPE(ARG_TYPE, $ARG_RESULT)\n+\n+  if test \"x$FAILURE\" = x; then\n+    # Execute custom verification payload, if present\n+    RESULT=\"$ARG_RESULT\"\n+\n+    ARG_CHECK_VALUE\n+\n+    ARG_RESULT=\"$RESULT\"\n+  fi\n+\n+  if test \"x$FAILURE\" != x; then\n+    AC_MSG_NOTICE([Invalid value for [--with-]ARG_NAME: \"$ARG_RESULT\"])\n+    AC_MSG_NOTICE([$FAILURE])\n+    AC_MSG_ERROR([Cannot continue])\n+  fi\n+\n+  # Execute result payloads, if present\n+  if test x$ARG_GIVEN = xtrue; then\n+    ARG_IF_GIVEN\n+  else\n+    ARG_IF_NOT_GIVEN\n+  fi\n+])\n+\n+###############################################################################\n+# Helper functions for CHECK_VALUE in ARG_WITH.\n+AC_DEFUN([UTIL_CHECK_STRING_NON_EMPTY],\n+[\n+  if test \"x$RESULT\" = \"x\"; then\n+    FAILURE=\"Value cannot be empty\"\n+  fi\n+])\n","filename":"make\/autoconf\/util.m4","additions":357,"deletions":4,"binary":false,"changes":361,"status":"modified"},{"patch":"@@ -361,0 +361,14 @@\n+\n+      # gcc assembly files must contain an appropriate relative .file\n+      # path for reproducible builds.\n+      ifeq ($(TOOLCHAIN_TYPE), gcc)\n+        # If no absolute paths allowed, work out relative source file path\n+        # for assembly .file substitution, otherwise use full file path\n+        ifeq ($(ALLOW_ABSOLUTE_PATHS_IN_OUTPUT), false)\n+          $1_REL_ASM_SRC := $$(call RelativePath, $$($1_FILE), $(WORKSPACE_ROOT))\n+        else\n+          $1_REL_ASM_SRC := $$($1_FILE)\n+        endif\n+        $1_FLAGS := $$($1_FLAGS) -DASSEMBLY_SRC_FILE='\"$$($1_REL_ASM_SRC)\"' \\\n+            -include $(TOPDIR)\/make\/data\/autoheaders\/assemblyprefix.h\n+      endif\n@@ -1152,13 +1166,0 @@\n-    # Debuginfo of ASM objects always embeds the absolute object path,\n-    # as ASM debuginfo paths do not get prefix mapped.\n-    # So for reproducible builds use relative paths to ensure a reproducible\n-    # debuginfo and libs, when creating debug symbols.\n-    ifeq ($$(ENABLE_REPRODUCIBLE_BUILD), true)\n-      ifeq ($(call isTargetOs, linux), true)\n-        ifeq ($$($1_COMPILE_WITH_DEBUG_SYMBOLS), true)\n-          $1_LINK_OBJS_RELATIVE := true\n-          $1_ALL_OBJS_RELATIVE := $$(patsubst $$(OUTPUTDIR)\/%, %, $$($1_ALL_OBJS))\n-        endif\n-      endif\n-    endif\n-\n","filename":"make\/common\/NativeCompilation.gmk","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -0,0 +1,29 @@\n+#\n+# Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+\/\/ ASSEMBLY_SRC_FILE gets replaced by relative or absolute file path\n+\/\/ in NativeCompilation.gmk for gcc tooling on Linux. This ensures a\n+\/\/ reproducible object file through a predictable value of the STT_FILE\n+\/\/ symbol, and subsequently a reproducible .debuginfo.\n+.file ASSEMBLY_SRC_FILE\n+\n","filename":"make\/data\/autoheaders\/assemblyprefix.h","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"},{"patch":"@@ -850,1 +850,2 @@\n-        \"DateFormatItem\",\n+        \"DateFormatItemInputRegions.allowed\",\n+        \"DateFormatItemInputRegions.preferred\",\n@@ -853,0 +854,2 @@\n+    static final Set<String> availableSkeletons = new HashSet<>();\n+\n@@ -858,2 +861,2 @@\n-                .flatMap(elem -> map.keySet().stream().filter(k -> k.startsWith(prefix + elem)))\n-                .forEach(key -> {\n+                .forEach(elem -> {\n+                    var key = prefix + elem;\n@@ -863,0 +866,2 @@\n+            availableSkeletons.forEach(s ->\n+                copyIfPresent(map, prefix + \"DateFormatItem.\" + s, formatData));\n","filename":"make\/jdk\/src\/classes\/build\/tools\/cldrconverter\/CLDRConverter.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -771,3 +771,8 @@\n-                prefix = (currentCalendarType == null) ? \"\" : currentCalendarType.keyElementName();\n-                pushStringEntry(qName, attributes,\n-                        prefix + Bundle.DATEFORMATITEM_KEY_PREFIX + attributes.getValue(\"id\"));\n+                if (currentCalendarType != null) {\n+                    var skeleton = attributes.getValue(\"id\");\n+                    CLDRConverter.availableSkeletons.add(skeleton);\n+                    pushStringEntry(qName, attributes,\n+                            currentCalendarType.keyElementName() + Bundle.DATEFORMATITEM_KEY_PREFIX + skeleton);\n+                } else {\n+                    pushIgnoredContainer(qName);\n+                }\n","filename":"make\/jdk\/src\/classes\/build\/tools\/cldrconverter\/LDMLParseHandler.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -97,1 +97,2 @@\n-    JAVAC_FLAGS := --add-exports java.base\/sun.security.util=ALL-UNNAMED --enable-preview, \\\n+    JAVAC_FLAGS := --enable-preview --add-exports java.base\/sun.security.util=ALL-UNNAMED \\\n+        --add-exports java.base\/sun.invoke.util=ALL-UNNAMED, \\\n","filename":"make\/test\/BuildMicrobenchmark.gmk","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -68,0 +68,1 @@\n+  BUILD_JDK_JTREG_EXECUTABLES_LIBS_exeNullCallerGetResource := jvm.lib\n@@ -89,0 +90,1 @@\n+  BUILD_JDK_JTREG_EXECUTABLES_LIBS_exeNullCallerGetResource := -ljvm\n","filename":"make\/test\/JtregNativeJdk.gmk","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -82,1 +82,0 @@\n-        static ImageType INT_ARGB = new ImageType(BufferedImage.TYPE_INT_ARGB, \"INT_ARGB\", \"TYPE_INT_ARGB\");\n@@ -84,0 +83,2 @@\n+        static ImageType INT_ARGB = new ImageType(BufferedImage.TYPE_INT_ARGB, \"INT_ARGB\", \"TYPE_INT_ARGB\");\n+        static ImageType INT_ARGB_PRE = new ImageType(BufferedImage.TYPE_INT_ARGB_PRE, \"INT_ARGB_PRE\", \"TYPE_INT_ARGB_PRE\");\n@@ -87,0 +88,7 @@\n+        static ImageType BYTE_4BYTE_ABGR_PRE = new ImageType(BufferedImage.TYPE_4BYTE_ABGR_PRE, \"4BYTE_ABGR_PRE\", \"TYPE_4BYTE_ABGR_PRE\");\n+        static ImageType BYTE_GRAY = new ImageType(BufferedImage.TYPE_BYTE_GRAY, \"BYTE_GRAY\", \"TYPE_BYTE_GRAY\");\n+        static ImageType BYTE_BINARY = new ImageType(BufferedImage.TYPE_BYTE_BINARY, \"BYTE_BINARY\", \"TYPE_BYTE_BINARY\");\n+        static ImageType BYTE_INDEXED = new ImageType(BufferedImage.TYPE_BYTE_INDEXED, \"BYTE_INDEXED\", \"TYPE_BYTE_INDEXED\");\n+        static ImageType USHORT_565_RGB = new ImageType(BufferedImage.TYPE_USHORT_565_RGB, \"USHORT_565_RGB\", \"TYPE_USHORT_565_RGB\");\n+        static ImageType USHORT_555_RGB = new ImageType(BufferedImage.TYPE_USHORT_555_RGB, \"USHORT_555_RGB\", \"TYPE_USHORT_555_RGB\");\n+        static ImageType USHORT_GRAY = new ImageType(BufferedImage.TYPE_USHORT_GRAY, \"USHORT_GRAY\", \"TYPE_USHORT_GRAY\");\n@@ -100,2 +108,4 @@\n-            return new ImageType[]{INT_ARGB, INT_RGB, INT_BGR,\n-                    BYTE_3BYTE_BGR, BYTE_4BYTE_ABGR, COMPATIBLE_DST};\n+            return new ImageType[]{INT_RGB, INT_ARGB, INT_ARGB_PRE, INT_BGR,\n+                    BYTE_3BYTE_BGR, BYTE_4BYTE_ABGR, BYTE_4BYTE_ABGR_PRE,\n+                    BYTE_GRAY, BYTE_BINARY, BYTE_INDEXED, USHORT_565_RGB,\n+                    USHORT_555_RGB, USHORT_GRAY, COMPATIBLE_DST};\n","filename":"src\/demo\/share\/java2d\/J2DBench\/src\/j2dbench\/tests\/cmm\/ColorConvertOpTests.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-# Copyright (c) 2010, 2019, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -441,1 +441,1 @@\n-ProgressBarDemo.accessible_text_area_description=This JTextArea is being filled with text from a buffer progressively a character at a time while the progress bar a the bottom of the window shows the loading progress\n+ProgressBarDemo.accessible_text_area_description=This JTextArea is being filled with text from a buffer progressively a character at a time while the progress bar at the bottom of the window shows the loading progress\n@@ -707,1 +707,0 @@\n-\n","filename":"src\/demo\/share\/jfc\/SwingSet2\/resources\/swingset.properties","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,1 @@\n- * A a UI around the JDBCAdaptor, allowing database data to be interactively\n+ * A UI around the JDBCAdaptor, allowing database data to be interactively\n","filename":"src\/demo\/share\/jfc\/TableExample\/TableExample.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n-\/\/ archtecture.\n+\/\/ architecture.\n@@ -491,1 +491,1 @@\n-\/\/ the AArch64 CSPR status flag register is not directly acessible as\n+\/\/ the AArch64 CSPR status flag register is not directly accessible as\n@@ -1511,1 +1511,1 @@\n-  \/\/ MemBarAcquire, possibly thorugh an optional DecodeN, is still\n+  \/\/ MemBarAcquire, possibly through an optional DecodeN, is still\n@@ -2789,0 +2789,4 @@\n+bool Parse::do_one_bytecode_targeted() {\n+  return false;\n+}\n+\n@@ -4110,1 +4114,1 @@\n-\/\/         are owned by the CALLEE.  Holes should not be nessecary in the\n+\/\/         are owned by the CALLEE.  Holes should not be necessary in the\n@@ -4113,1 +4117,1 @@\n-\/\/         avoid holes.  Holes in the outgoing arguments may be nessecary for\n+\/\/         avoid holes.  Holes in the outgoing arguments may be necessary for\n@@ -17322,1 +17326,1 @@\n-\/\/   \/\/ increment preceeded by register-register move\n+\/\/   \/\/ increment preceded by register-register move\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -5847,1 +5847,1 @@\n-    \/\/ substracting it by 7 (VLENGTH - 1).\n+    \/\/ subtracting it by 7 (VLENGTH - 1).\n@@ -5879,1 +5879,1 @@\n-    \/\/ Count the leading zero bytes and substract it by 15 (VLENGTH - 1).\n+    \/\/ Count the leading zero bytes and subtract it by 15 (VLENGTH - 1).\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon.ad","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2551,1 +2551,1 @@\n-    \/\/ substracting it by 7 (VLENGTH - 1).\n+    \/\/ subtracting it by 7 (VLENGTH - 1).\n@@ -2583,1 +2583,1 @@\n-    \/\/ Count the leading zero bytes and substract it by 15 (VLENGTH - 1).\n+    \/\/ Count the leading zero bytes and subtract it by 15 (VLENGTH - 1).\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon_ad.m4","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -89,1 +89,1 @@\n-  \/\/ on the transistion) Since the callee parameters already account\n+  \/\/ on the transition) Since the callee parameters already account\n","filename":"src\/hotspot\/cpu\/aarch64\/abstractInterpreter_aarch64.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n-\/\/ Use MSVC instrinsic: https:\/\/docs.microsoft.com\/en-us\/cpp\/intrinsics\/arm64-intrinsics?view=vs-2019#I\n+\/\/ Use MSVC intrinsic: https:\/\/docs.microsoft.com\/en-us\/cpp\/intrinsics\/arm64-intrinsics?view=vs-2019#I\n@@ -596,1 +596,1 @@\n-\/\/ Convience classes\n+\/\/ Convenience classes\n","filename":"src\/hotspot\/cpu\/aarch64\/assembler_aarch64.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -436,1 +436,1 @@\n-  \/\/ Preform needed unlocking\n+  \/\/ Perform needed unlocking\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_LIRAssembler_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -695,1 +695,1 @@\n-          \/\/ get the instance size (size is postive so movl is fine for 64bit)\n+          \/\/ get the instance size (size is positive so movl is fine for 64bit)\n","filename":"src\/hotspot\/cpu\/aarch64\/c1_Runtime1_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -83,1 +83,1 @@\n-  \/\/ in str1, cnt1. Find the 1st occurence of pattern in source or return -1.\n+  \/\/ in str1, cnt1. Find the 1st occurrence of pattern in source or return -1.\n","filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -189,1 +189,1 @@\n-\/\/ IMPORTANT: This must preserve all registers, even rscratch1 and rscratch2, except those explicitely\n+\/\/ IMPORTANT: This must preserve all registers, even rscratch1 and rscratch2, except those explicitly\n","filename":"src\/hotspot\/cpu\/aarch64\/gc\/shenandoah\/shenandoahBarrierSetAssembler_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -240,1 +240,1 @@\n-  \/\/ Set up SP to accomodate parameters and maybe r0..\n+  \/\/ Set up SP to accommodate parameters and maybe r0..\n","filename":"src\/hotspot\/cpu\/aarch64\/gc\/z\/zBarrierSetAssembler_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -157,1 +157,1 @@\n-      \/\/ msync suceeded, the address is valid, and maybe even already mapped.\n+      \/\/ msync succeeded, the address is valid, and maybe even already mapped.\n@@ -162,1 +162,1 @@\n-      \/\/ Some error occured. This should never happen, but msync\n+      \/\/ Some error occurred. This should never happen, but msync\n","filename":"src\/hotspot\/cpu\/aarch64\/gc\/z\/zGlobals_aarch64.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -94,1 +94,1 @@\n-          \"Use simpliest and shortest implementation for array equals\") \\\n+          \"Use simplest and shortest implementation for array equals\")  \\\n","filename":"src\/hotspot\/cpu\/aarch64\/globals_aarch64.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -260,1 +260,1 @@\n-\/\/ Use an empty struct with a construtor as MSVC doesn't support `__attribute__ ((constructor))`\n+\/\/ Use an empty struct with a constructor as MSVC doesn't support `__attribute__ ((constructor))`\n","filename":"src\/hotspot\/cpu\/aarch64\/immediate_aarch64.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -526,1 +526,1 @@\n-\/\/ Unlock any Java monitors from syncronized blocks.\n+\/\/ Unlock any Java monitors from synchronized blocks.\n@@ -1751,1 +1751,1 @@\n-      \/\/ begining of the ProfileData we intend to update to check its\n+      \/\/ beginning of the ProfileData we intend to update to check its\n","filename":"src\/hotspot\/cpu\/aarch64\/interp_masm_aarch64.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n-\/\/ This file specializes the assember with interpreter-specific macros\n+\/\/ This file specializes the assembler with interpreter-specific macros\n","filename":"src\/hotspot\/cpu\/aarch64\/interp_masm_aarch64.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -200,1 +200,1 @@\n-  \/\/ Metatdata pointers are either narrow (32 bits) or wide (48 bits).\n+  \/\/ Metadata pointers are either narrow (32 bits) or wide (48 bits).\n@@ -1007,1 +1007,1 @@\n-\/\/ scans count pointer sized words at [addr] for occurence of value,\n+\/\/ scans count pointer sized words at [addr] for occurrence of value,\n@@ -1022,1 +1022,1 @@\n-\/\/ scans count 4 byte words at [addr] for occurence of value,\n+\/\/ scans count 4 byte words at [addr] for occurrence of value,\n@@ -1589,1 +1589,1 @@\n-  if ((VM_Version::features() & VM_Version::CPU_STXR_PREFETCH))\n+  if (VM_Version::supports_stxr_prefetch())\n@@ -1595,1 +1595,1 @@\n-  \/\/ if we store+flush with no intervening write tmp wil be zero\n+  \/\/ if we store+flush with no intervening write tmp will be zero\n@@ -1903,1 +1903,1 @@\n-  count &= ~1;  \/\/ Only push an even nuber of regs\n+  count &= ~1;  \/\/ Only push an even number of regs\n@@ -2224,1 +2224,1 @@\n-\/\/ Seperate vsn which sets the flags. Optimisations are more restricted\n+\/\/ Separate vsn which sets the flags. Optimisations are more restricted\n@@ -2311,1 +2311,1 @@\n-    if ((VM_Version::features() & VM_Version::CPU_STXR_PREFETCH))\n+    if (VM_Version::supports_stxr_prefetch())\n@@ -2319,1 +2319,1 @@\n-    \/\/ if we store+flush with no intervening write tmp wil be zero\n+    \/\/ if we store+flush with no intervening write tmp will be zero\n@@ -2354,1 +2354,1 @@\n-    if ((VM_Version::features() & VM_Version::CPU_STXR_PREFETCH))\n+    if (VM_Version::supports_stxr_prefetch())\n@@ -2362,1 +2362,1 @@\n-    \/\/ if we store+flush with no intervening write tmp wil be zero\n+    \/\/ if we store+flush with no intervening write tmp will be zero\n@@ -2396,1 +2396,1 @@\n-    if ((VM_Version::features() & VM_Version::CPU_STXR_PREFETCH))\n+    if (VM_Version::supports_stxr_prefetch())\n@@ -2455,1 +2455,1 @@\n-  if ((VM_Version::features() & VM_Version::CPU_STXR_PREFETCH))         \\\n+  if (VM_Version::supports_stxr_prefetch())                             \\\n@@ -2486,1 +2486,1 @@\n-  if ((VM_Version::features() & VM_Version::CPU_STXR_PREFETCH))         \\\n+  if (VM_Version::supports_stxr_prefetch())                             \\\n@@ -3038,1 +3038,1 @@\n- * Code for BigInteger::multiplyToLen() instrinsic.\n+ * Code for BigInteger::multiplyToLen() intrinsic.\n@@ -3173,1 +3173,1 @@\n-\/\/ Code for BigInteger::mulAdd instrinsic\n+\/\/ Code for BigInteger::mulAdd intrinsic\n@@ -4849,1 +4849,1 @@\n-\/\/ Aligns the base address first sufficently for DC ZVA, then uses\n+\/\/ Aligns the base address first sufficiently for DC ZVA, then uses\n@@ -5224,1 +5224,1 @@\n-  if (VM_Version::features() & VM_Version::CPU_DCPOP) {\n+  if (VM_Version::supports_dcpop()) {\n@@ -5346,1 +5346,1 @@\n-\/\/ Sign the return value in the given register. Use before updating the LR in the exisiting stack\n+\/\/ Sign the return value in the given register. Use before updating the LR in the existing stack\n@@ -5369,1 +5369,1 @@\n-\/\/ Authenticate the return value in the given register. Use before updating the LR in the exisiting\n+\/\/ Authenticate the return value in the given register. Use before updating the LR in the existing\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -439,1 +439,1 @@\n-    if ((VM_Version::features() & VM_Version::CPU_A53MAC) && Ra != zr)        \\\n+    if (VM_Version::supports_a53mac() && Ra != zr)                            \\\n@@ -483,1 +483,1 @@\n-  \/\/ 64 bits of each vector register. Additonal registers can be excluded\n+  \/\/ 64 bits of each vector register. Additional registers can be excluded\n@@ -664,1 +664,1 @@\n-  \/\/ increment\/decrement for 64 bit operatons and\n+  \/\/ increment\/decrement for 64 bit operations and\n@@ -1032,1 +1032,1 @@\n-                          Label &suceed, Label *fail);\n+                          Label &succeed, Label *fail);\n@@ -1034,1 +1034,1 @@\n-                  Label &suceed, Label *fail);\n+                  Label &succeed, Label *fail);\n@@ -1037,1 +1037,1 @@\n-                  Label &suceed, Label *fail);\n+                  Label &succeed, Label *fail);\n@@ -1124,1 +1124,1 @@\n-  \/\/ CRC32 code for java.util.zip.CRC32::updateBytes() instrinsic.\n+  \/\/ CRC32 code for java.util.zip.CRC32::updateBytes() intrinsic.\n@@ -1128,1 +1128,1 @@\n-  \/\/ CRC32 code for java.util.zip.CRC32C::updateBytes() instrinsic.\n+  \/\/ CRC32 code for java.util.zip.CRC32C::updateBytes() intrinsic.\n@@ -1150,1 +1150,1 @@\n-  \/\/ Seperate vsn which sets the flags\n+  \/\/ Separate vsn which sets the flags\n@@ -1254,1 +1254,1 @@\n-  \/\/ CRC32 code for java.util.zip.CRC32::updateBytes() instrinsic.\n+  \/\/ CRC32 code for java.util.zip.CRC32::updateBytes() intrinsic.\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.hpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -362,1 +362,1 @@\n-                         \/* offseted (temp) registers *\/\n+                         \/* offsetted (temp) registers *\/\n@@ -439,1 +439,1 @@\n-                       \/* offseted (temp) registers *\/\n+                       \/* offsetted (temp) registers *\/\n@@ -524,1 +524,1 @@\n-  \/\/ that) and keep the data in little-endian bit order throught the\n+  \/\/ that) and keep the data in little-endian bit order through the\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64_aes.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-\/* Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+\/* Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -434,1 +434,1 @@\n-\/\/ *      y[]     ouput result in an array of double precision numbers.\n+\/\/ *      y[]     output result in an array of double precision numbers.\n@@ -453,1 +453,1 @@\n-\/\/ *      prec    an interger indicating the precision:\n+\/\/ *      prec    an integer indicating the precision:\n@@ -670,1 +670,1 @@\n-\/\/     3. Non-double code is removed(last switch). Sevaral variables became\n+\/\/     3. Non-double code is removed(last switch). Several variables became\n@@ -1002,1 +1002,1 @@\n-          fcmpd(v18, v24);                                   \/\/ v24 is stil two24A\n+          fcmpd(v18, v24);                                   \/\/ v24 is still two24A\n@@ -1183,1 +1183,1 @@\n-\/\/ Input ans output:\n+\/\/ Input and output:\n@@ -1408,1 +1408,1 @@\n-\/\/ Input ans output:\n+\/\/ Input and output:\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64_trig.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -157,1 +157,1 @@\n-  \/\/ true means we have fast l2f convers\n+  \/\/ true means we have fast l2f conversion\n","filename":"src\/hotspot\/cpu\/aarch64\/matcher_aarch64.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n-\/\/ machine-dependent implemention for register maps\n+\/\/ machine-dependent implementation for register maps\n","filename":"src\/hotspot\/cpu\/aarch64\/registerMap_aarch64.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -751,1 +751,1 @@\n-  \/\/ compiled code, which relys solely on SP and not FP, get sick).\n+  \/\/ compiled code, which relies solely on SP and not FP, get sick).\n@@ -2444,1 +2444,1 @@\n-  \/\/ When the signal occured, the LR was either signed and stored on the stack (in which\n+  \/\/ When the signal occurred, the LR was either signed and stored on the stack (in which\n@@ -2454,1 +2454,1 @@\n-  \/\/ work outselves.\n+  \/\/ work ourselves.\n","filename":"src\/hotspot\/cpu\/aarch64\/sharedRuntime_aarch64.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -456,1 +456,1 @@\n-  \/\/ so it just needs to be generated code wiht no x86 prolog\n+  \/\/ so it just needs to be generated code with no x86 prolog\n@@ -862,1 +862,1 @@\n-      \/\/ then 1 word at offsets {0, 1, 3, 5, 7}. Rather thna use a\n+      \/\/ then 1 word at offsets {0, 1, 3, 5, 7}. Rather than use a\n@@ -988,1 +988,1 @@\n-      \/\/ bits 2 and 1 in the count are the tell-tale for whetehr we\n+      \/\/ bits 2 and 1 in the count are the tell-tale for whether we\n@@ -994,1 +994,1 @@\n-       \/\/ with ony one intervening stp between the str instructions\n+       \/\/ with only one intervening stp between the str instructions\n@@ -3997,1 +3997,1 @@\n-   * Ouput:\n+   * Output:\n@@ -4038,1 +4038,1 @@\n-   * Ouput:\n+   * Output:\n@@ -4299,1 +4299,1 @@\n-   *    c_rarg3   - y lenth\n+   *    c_rarg3   - y length\n@@ -5698,1 +5698,1 @@\n-    \/\/ that) and keep the data in little-endian bit order throught the\n+    \/\/ that) and keep the data in little-endian bit order through the\n@@ -5886,1 +5886,1 @@\n-    Register isURL = c_rarg5;  \/\/ Base64 or URL chracter set\n+    Register isURL = c_rarg5;  \/\/ Base64 or URL character set\n@@ -5972,1 +5972,1 @@\n-    \/\/ we need unsigned saturating substract, to make sure all input values\n+    \/\/ we need unsigned saturating subtract, to make sure all input values\n@@ -6076,1 +6076,1 @@\n-    \/\/ except the trailing character '=' is also treated illegal value in this instrinsic. That\n+    \/\/ except the trailing character '=' is also treated illegal value in this intrinsic. That\n","filename":"src\/hotspot\/cpu\/aarch64\/stubGenerator_aarch64.cpp","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -303,1 +303,1 @@\n-    \/\/ This is a small optimization wich keeping double[8] values in int[] table\n+    \/\/ This is a small optimization which keeping double[8] values in int[] table\n","filename":"src\/hotspot\/cpu\/aarch64\/stubRoutines_aarch64.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -140,1 +140,1 @@\n-\/\/ Miscelaneous helper routines\n+\/\/ Miscellaneous helper routines\n@@ -2233,1 +2233,1 @@\n-\/\/     writes act as aquire & release, so:\n+\/\/     writes act as acquire & release, so:\n@@ -3857,1 +3857,1 @@\n-  \/\/ The object has already been poped from the stack, so the\n+  \/\/ The object has already been popped from the stack, so the\n","filename":"src\/hotspot\/cpu\/aarch64\/templateTable_aarch64.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -127,1 +127,1 @@\n-    if (_features & CPU_DCPOP) {\n+    if (VM_Version::supports_dcpop()) {\n@@ -229,1 +229,1 @@\n-#define ADD_FEATURE_IF_SUPPORTED(id, name, bit) if (_features & CPU_##id) strcat(buf, \", \" name);\n+#define ADD_FEATURE_IF_SUPPORTED(id, name, bit) if (VM_Version::supports_##name()) strcat(buf, \", \" #name);\n@@ -236,1 +236,1 @@\n-    UseCRC32 = (_features & CPU_CRC32) != 0;\n+    UseCRC32 = VM_Version::supports_crc32();\n@@ -239,1 +239,1 @@\n-  if (UseCRC32 && (_features & CPU_CRC32) == 0) {\n+  if (UseCRC32 && !VM_Version::supports_crc32()) {\n@@ -253,1 +253,1 @@\n-  if (_features & CPU_LSE) {\n+  if (VM_Version::supports_lse()) {\n@@ -263,1 +263,1 @@\n-  if (_features & CPU_AES) {\n+  if (VM_Version::supports_aes()) {\n@@ -294,1 +294,1 @@\n-  if (_features & CPU_CRC32) {\n+  if (VM_Version::supports_crc32()) {\n@@ -311,1 +311,2 @@\n-  if (_features & (CPU_SHA1 | CPU_SHA2 | CPU_SHA3 | CPU_SHA512)) {\n+  if (VM_Version::supports_sha1() || VM_Version::supports_sha256() ||\n+      VM_Version::supports_sha3() || VM_Version::supports_sha512()) {\n@@ -320,1 +321,1 @@\n-  if (UseSHA && (_features & CPU_SHA1)) {\n+  if (UseSHA && VM_Version::supports_sha1()) {\n@@ -329,1 +330,1 @@\n-  if (UseSHA && (_features & CPU_SHA2)) {\n+  if (UseSHA && VM_Version::supports_sha256()) {\n@@ -338,1 +339,1 @@\n-  if (UseSHA && (_features & CPU_SHA3)) {\n+  if (UseSHA && VM_Version::supports_sha3()) {\n@@ -348,1 +349,1 @@\n-  if (UseSHA && (_features & CPU_SHA512)) {\n+  if (UseSHA && VM_Version::supports_sha512()) {\n@@ -362,1 +363,1 @@\n-  if (_features & CPU_PMULL) {\n+  if (VM_Version::supports_pmull()) {\n@@ -387,1 +388,1 @@\n-  if (_features & CPU_SVE) {\n+  if (VM_Version::supports_sve2()) {\n@@ -389,1 +390,1 @@\n-      FLAG_SET_DEFAULT(UseSVE, (_features & CPU_SVE2) ? 2 : 1);\n+      FLAG_SET_DEFAULT(UseSVE, 2);\n@@ -391,2 +392,6 @@\n-    if (UseSVE > 0) {\n-      _initial_sve_vector_length = get_current_sve_vector_length();\n+  } else if (VM_Version::supports_sve()) {\n+    if (FLAG_IS_DEFAULT(UseSVE)) {\n+      FLAG_SET_DEFAULT(UseSVE, 1);\n+    } else if (UseSVE > 1) {\n+      warning(\"SVE2 specified, but not supported on current CPU. Using SVE.\");\n+      FLAG_SET_DEFAULT(UseSVE, 1);\n@@ -399,0 +404,4 @@\n+  if (UseSVE > 0) {\n+    _initial_sve_vector_length = get_current_sve_vector_length();\n+  }\n+\n@@ -419,1 +428,1 @@\n-    if ((_features & CPU_PACA) != 0) {\n+    if (VM_Version::supports_paca()) {\n@@ -426,1 +435,1 @@\n-    if ((_features & CPU_PACA) == 0) {\n+    if (!VM_Version::supports_paca()) {\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":28,"deletions":19,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -103,1 +103,0 @@\n-  enum Feature_Flag {\n@@ -105,14 +104,14 @@\n-    decl(FP,            \"fp\",            0)   \\\n-    decl(ASIMD,         \"simd\",          1)   \\\n-    decl(EVTSTRM,       \"evtstrm\",       2)   \\\n-    decl(AES,           \"aes\",           3)   \\\n-    decl(PMULL,         \"pmull\",         4)   \\\n-    decl(SHA1,          \"sha1\",          5)   \\\n-    decl(SHA2,          \"sha256\",        6)   \\\n-    decl(CRC32,         \"crc\",           7)   \\\n-    decl(LSE,           \"lse\",           8)   \\\n-    decl(DCPOP,         \"dcpop\",         16)  \\\n-    decl(SHA3,          \"sha3\",          17)  \\\n-    decl(SHA512,        \"sha512\",        21)  \\\n-    decl(SVE,           \"sve\",           22)  \\\n-    decl(PACA,          \"paca\",          30)  \\\n+    decl(FP,            fp,            0)     \\\n+    decl(ASIMD,         simd,          1)     \\\n+    decl(EVTSTRM,       evtstrm,       2)     \\\n+    decl(AES,           aes,           3)     \\\n+    decl(PMULL,         pmull,         4)     \\\n+    decl(SHA1,          sha1,          5)     \\\n+    decl(SHA2,          sha256,        6)     \\\n+    decl(CRC32,         crc32,         7)     \\\n+    decl(LSE,           lse,           8)     \\\n+    decl(DCPOP,         dcpop,         16)    \\\n+    decl(SHA3,          sha3,          17)    \\\n+    decl(SHA512,        sha512,        21)    \\\n+    decl(SVE,           sve,           22)    \\\n+    decl(PACA,          paca,          30)    \\\n@@ -120,3 +119,4 @@\n-    decl(SVE2,          \"sve2\",          28)  \\\n-    decl(STXR_PREFETCH, \"stxr_prefetch\", 29)  \\\n-    decl(A53MAC,        \"a53mac\",        31)\n+    decl(SVEBITPERM,    svebitperm,    27)    \\\n+    decl(SVE2,          sve2,          28)    \\\n+    decl(STXR_PREFETCH, stxr_prefetch, 29)    \\\n+    decl(A53MAC,        a53mac,        31)\n@@ -124,0 +124,1 @@\n+  enum Feature_Flag {\n@@ -129,0 +130,6 @@\n+  \/\/ Feature identification\n+#define CPU_FEATURE_DETECTION(id, name, bit) \\\n+  static bool supports_##name() { return (_features & CPU_##id) != 0; };\n+  CPU_FEATURE_FLAGS(CPU_FEATURE_DETECTION)\n+#undef CPU_FEATURE_DETECTION\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.hpp","additions":25,"deletions":18,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -89,1 +89,1 @@\n-  \/\/ Our locals were accounted for by the caller (or last_frame_adjust on the transistion)\n+  \/\/ Our locals were accounted for by the caller (or last_frame_adjust on the transition)\n","filename":"src\/hotspot\/cpu\/arm\/abstractInterpreter_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1162,0 +1162,4 @@\n+bool Parse::do_one_bytecode_targeted() {\n+  return false;\n+}\n+\n@@ -1572,1 +1576,1 @@\n-\/\/         are owned by the CALLEE.  Holes should not be nessecary in the\n+\/\/         are owned by the CALLEE.  Holes should not be necessary in the\n@@ -1575,1 +1579,1 @@\n-\/\/         avoid holes.  Holes in the outgoing arguments may be nessecary for\n+\/\/         avoid holes.  Holes in the outgoing arguments may be necessary for\n@@ -2779,1 +2783,1 @@\n-\/\/ Integer ALU reg-imm operaion\n+\/\/ Integer ALU reg-imm operation\n@@ -9066,1 +9070,1 @@\n-  \/\/ TODO: ned save_last_PC here?\n+  \/\/ TODO: need save_last_PC here?\n@@ -9078,1 +9082,1 @@\n-  \/\/ TODO: ned save_last_PC here?\n+  \/\/ TODO: need save_last_PC here?\n@@ -11801,1 +11805,1 @@\n-\/\/   \/\/ increment preceeded by register-register move\n+\/\/   \/\/ increment preceded by register-register move\n","filename":"src\/hotspot\/cpu\/arm\/arm.ad","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2008, 2013, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n-\/\/ archtecture.\n+\/\/ architecture.\n","filename":"src\/hotspot\/cpu\/arm\/arm_32.ad","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -245,1 +245,1 @@\n-  \/\/ Preform needed unlocking\n+  \/\/ Perform needed unlocking\n@@ -644,1 +644,1 @@\n-      case T_FLOAT:    \/\/ used in floatToRawIntBits intrinsic implemenation\n+      case T_FLOAT:    \/\/ used in floatToRawIntBits intrinsic implementation\n","filename":"src\/hotspot\/cpu\/arm\/c1_LIRAssembler_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -192,1 +192,1 @@\n-  assert(BasicObjectLock::lock_offset_in_bytes() == 0, \"ajust this code\");\n+  assert(BasicObjectLock::lock_offset_in_bytes() == 0, \"adjust this code\");\n@@ -250,1 +250,1 @@\n-  assert(BasicObjectLock::lock_offset_in_bytes() == 0, \"ajust this code\");\n+  assert(BasicObjectLock::lock_offset_in_bytes() == 0, \"adjust this code\");\n","filename":"src\/hotspot\/cpu\/arm\/c1_MacroAssembler_arm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -339,1 +339,1 @@\n-    restore_live_registers_without_return(sasm); \/\/ must not jump immediatly to handler\n+    restore_live_registers_without_return(sasm); \/\/ must not jump immediately to handler\n","filename":"src\/hotspot\/cpu\/arm\/c1_Runtime1_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-  \/\/ word by word compare, dont't need alignment check\n+  \/\/ word by word compare, don't need alignment check\n","filename":"src\/hotspot\/cpu\/arm\/c2_MacroAssembler_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -99,1 +99,1 @@\n-\/\/ size of C2 call stub, compiled java to interpretor\n+\/\/ size of C2 call stub, compiled java to interpreter\n","filename":"src\/hotspot\/cpu\/arm\/compiledIC_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -685,1 +685,1 @@\n-\/\/ Unlock any Java monitors from syncronized blocks.\n+\/\/ Unlock any Java monitors from synchronized blocks.\n","filename":"src\/hotspot\/cpu\/arm\/interp_masm_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-\/\/ This file specializes the assember with interpreter-specific macros\n+\/\/ This file specializes the assembler with interpreter-specific macros\n","filename":"src\/hotspot\/cpu\/arm\/interp_masm_arm.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1147,1 +1147,1 @@\n-\/\/ tmp is a scratch for v6 co-processor write op (could be noreg for other architecure versions)\n+\/\/ tmp is a scratch for v6 co-processor write op (could be noreg for other architecture versions)\n@@ -1257,1 +1257,1 @@\n-\/\/ On SMP the updated value might not be visible to external observers without a sychronization barrier\n+\/\/ On SMP the updated value might not be visible to external observers without a synchronization barrier\n","filename":"src\/hotspot\/cpu\/arm\/macroAssembler_arm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1001,1 +1001,1 @@\n-  \/\/ On SMP the updated value might not be visible to external observers without a sychronization barrier\n+  \/\/ On SMP the updated value might not be visible to external observers without a synchronization barrier\n","filename":"src\/hotspot\/cpu\/arm\/macroAssembler_arm.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -149,1 +149,1 @@\n-  \/\/ true means we have fast l2f convers\n+  \/\/ true means we have fast l2f conversion\n","filename":"src\/hotspot\/cpu\/arm\/matcher_arm.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n-\/\/ machine-dependent implemention for register maps\n+\/\/ machine-dependent implementation for register maps\n","filename":"src\/hotspot\/cpu\/arm\/registerMap_arm.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -105,1 +105,1 @@\n-  \/\/ (altFP_7_11 is the one amoung R7 and R11 which is not FP)\n+  \/\/ (altFP_7_11 is the one among R7 and R11 which is not FP)\n@@ -109,1 +109,1 @@\n-  \/\/  When LR may be live in the nmethod from which we are comming\n+  \/\/  When LR may be live in the nmethod from which we are coming\n","filename":"src\/hotspot\/cpu\/arm\/sharedRuntime_arm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -141,1 +141,1 @@\n-    \/\/   more impact on the cache (fetches futher than what is\n+    \/\/   more impact on the cache (fetches further than what is\n@@ -1776,1 +1776,1 @@\n-  \/\/ Aligns 'to' by reading one word from 'from' and writting its part to 'to'.\n+  \/\/ Aligns 'to' by reading one word from 'from' and writing its part to 'to'.\n","filename":"src\/hotspot\/cpu\/arm\/stubGenerator_arm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,2 +36,2 @@\n-\/\/ The table reference is passed in a form of a last argument on the parametes list.\n-\/\/ The tables lookup method proves to perform better then a runtime Galois Field caclulation,\n+\/\/ The table reference is passed in a form of a last argument on the parameters list.\n+\/\/ The tables lookup method proves to perform better than a runtime Galois Field calculation,\n@@ -375,1 +375,1 @@\n-  \/\/ each sub-block is treated similary:\n+  \/\/ each sub-block is treated similarly:\n@@ -595,1 +595,1 @@\n-\/\/ decrypted separatly from each other.\n+\/\/ decrypted separately from each other.\n@@ -645,1 +645,1 @@\n-  \/\/ check remainig cipher size (for individual block processing)\n+  \/\/ check remaining cipher size (for individual block processing)\n@@ -759,1 +759,1 @@\n-  \/\/ sp+20 - ouput buffer pointer\n+  \/\/ sp+20 - output buffer pointer\n","filename":"src\/hotspot\/cpu\/arm\/stubRoutinesCrypto_arm.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -932,1 +932,1 @@\n-  \/\/ Allocate more stack space to accomodate all GP as well as FP registers:\n+  \/\/ Allocate more stack space to accommodate all GP as well as FP registers:\n@@ -1459,1 +1459,1 @@\n-  \/\/ Inbetween activations - previous activation type unknown yet\n+  \/\/ In between activations - previous activation type unknown yet\n","filename":"src\/hotspot\/cpu\/arm\/templateInterpreterGenerator_arm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -167,1 +167,1 @@\n-\/\/ Miscelaneous helper routines\n+\/\/ Miscellaneous helper routines\n@@ -2044,1 +2044,1 @@\n-  \/\/ non-JSR normal-branch stuff occuring below.\n+  \/\/ non-JSR normal-branch stuff occurring below.\n@@ -2528,1 +2528,1 @@\n-\/\/ ALSO reads & writes act as aquire & release, so:\n+\/\/ ALSO reads & writes act as acquire & release, so:\n@@ -4333,1 +4333,1 @@\n-  \/\/ The object has already been poped from the stack, so the expression stack looks correct.\n+  \/\/ The object has already been popped from the stack, so the expression stack looks correct.\n","filename":"src\/hotspot\/cpu\/arm\/templateTable_arm.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -346,1 +346,1 @@\n-\/\/ Load a 64 bit constant, optimized, not identifyable.\n+\/\/ Load a 64 bit constant, optimized, not identifiable.\n","filename":"src\/hotspot\/cpu\/ppc\/assembler_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -448,0 +448,1 @@\n+    DIVDU_OPCODE  = (31u << OPCODE_SHIFT | 457u << 1),              \/\/ XO-FORM\n@@ -1425,0 +1426,2 @@\n+  inline void divdu(  Register d, Register a, Register b);\n+  inline void divdu_( Register d, Register a, Register b);\n@@ -1588,1 +1591,1 @@\n-  \/\/ Turn or0(rx,rx,rx) into a nop and avoid that we accidently emit a\n+  \/\/ Turn or0(rx,rx,rx) into a nop and avoid that we accidentally emit a\n@@ -2534,1 +2537,1 @@\n-  \/\/ Endianess specific concatenation of 2 loaded vectors.\n+  \/\/ Endianness specific concatenation of 2 loaded vectors.\n@@ -2573,1 +2576,1 @@\n-  \/\/ Load a 64 bit constant, optimized, not identifyable.\n+  \/\/ Load a 64 bit constant, optimized, not identifiable.\n","filename":"src\/hotspot\/cpu\/ppc\/assembler_ppc.hpp","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -131,0 +131,2 @@\n+inline void Assembler::divdu(  Register d, Register a, Register b) { emit_int32(DIVDU_OPCODE  | rt(d) | ra(a) | rb(b) | oe(0) | rc(0)); }\n+inline void Assembler::divdu_( Register d, Register a, Register b) { emit_int32(DIVDU_OPCODE  | rt(d) | ra(a) | rb(b) | oe(0) | rc(1)); }\n","filename":"src\/hotspot\/cpu\/ppc\/assembler_ppc.inline.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3100,1 +3100,1 @@\n-    __ stop(\"unexpect null obj\");\n+    __ stop(\"unexpected null obj\");\n","filename":"src\/hotspot\/cpu\/ppc\/c1_LIRAssembler_ppc.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-  \/\/ The PPC ld\/st instructions cannot accomodate displacements > 16 bits long.\n+  \/\/ The PPC ld\/st instructions cannot accommodate displacements > 16 bits long.\n","filename":"src\/hotspot\/cpu\/ppc\/c1_LIRAssembler_ppc.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -273,1 +273,1 @@\n-  \/\/ Resolve the pointer using the standard implementation for weak tag handling and pointer verfication.\n+  \/\/ Resolve the pointer using the standard implementation for weak tag handling and pointer verification.\n@@ -529,1 +529,1 @@\n-        __ add(R4_ARG2, (intptr_t) _ref_addr.disp(), _ref_addr.base()); \/\/ Cloberring _ref\n+        __ add(R4_ARG2, (intptr_t) _ref_addr.disp(), _ref_addr.base()); \/\/ Clobbering _ref\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/z\/zBarrierSetAssembler_ppc.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -45,1 +45,1 @@\n-\/\/ It is assumed that this virtual memroy address space layout is predominant on the power platform.\n+\/\/ It is assumed that this virtual memory address space layout is predominant on the power platform.\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/z\/zGlobals_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1841,1 +1841,1 @@\n-      \/\/ begining of the ProfileData we intend to update to check its\n+      \/\/ beginning of the ProfileData we intend to update to check its\n","filename":"src\/hotspot\/cpu\/ppc\/interp_masm_ppc_64.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1463,1 +1463,1 @@\n-    \/\/ Need some preperation: Compute shift amount, align address. Note: shorts must be 2 byte aligned.\n+    \/\/ Need some preparation: Compute shift amount, align address. Note: shorts must be 2 byte aligned.\n@@ -1540,1 +1540,1 @@\n-    \/\/ Need some preperation: Compute shift amount, align address. Note: shorts must be 2 byte aligned.\n+    \/\/ Need some preparation: Compute shift amount, align address. Note: shorts must be 2 byte aligned.\n@@ -1672,1 +1672,1 @@\n-\/\/ Preforms atomic compare exchange:\n+\/\/ Performs atomic compare exchange:\n@@ -2278,1 +2278,1 @@\n-            \/\/ occured in a nested transaction. This check also matches\n+            \/\/ occurred in a nested transaction. This check also matches\n@@ -2417,1 +2417,1 @@\n-  \/\/ addressess touched in TM state so there is no more space in the footprint\n+  \/\/ addresses touched in TM state so there is no more space in the footprint\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -911,1 +911,1 @@\n-  \/\/ creates function descriptor at the current address and returs\n+  \/\/ creates function descriptor at the current address and returns\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -244,1 +244,1 @@\n-  \/\/ P10, prefer using setbc intructions\n+  \/\/ P10, prefer using setbc instructions\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -471,1 +471,1 @@\n-  \/\/ Order of the int values is Endianess specific.\n+  \/\/ Order of the int values is Endianness specific.\n@@ -1024,1 +1024,1 @@\n-  \/\/ Order of the long values is Endianess specific.\n+  \/\/ Order of the long values is Endianness specific.\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc_sha.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -156,1 +156,1 @@\n-  \/\/ true means we have fast l2f convers\n+  \/\/ true means we have fast l2f conversion\n","filename":"src\/hotspot\/cpu\/ppc\/matcher_ppc.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -543,1 +543,1 @@\n-      \/\/ Robust search of trace_calling_frame (independant of inlining).\n+      \/\/ Robust search of trace_calling_frame (independent of inlining).\n","filename":"src\/hotspot\/cpu\/ppc\/methodHandles_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -2405,0 +2405,4 @@\n+bool Parse::do_one_bytecode_targeted() {\n+  return false;\n+}\n+\n@@ -4134,1 +4138,1 @@\n-\/\/ costant 'pointer 0'.\n+\/\/ constant 'pointer 0'.\n@@ -4909,1 +4913,1 @@\n-\/\/ seperate instructions for every form of operand when the\n+\/\/ separate instructions for every form of operand when the\n@@ -9007,0 +9011,44 @@\n+instruct udivI_reg_reg(iRegIdst dst, iRegIsrc src1, iRegIsrc src2) %{\n+  match(Set dst (UDivI src1 src2));\n+  format %{ \"DIVWU   $dst, $src1, $src2\" %}\n+  size(4);\n+  ins_encode %{\n+    __ divwu($dst$$Register, $src1$$Register, $src2$$Register);\n+  %}\n+  ins_pipe(pipe_class_default);\n+%}\n+\n+instruct umodI_reg_reg(iRegIdst dst, iRegIsrc src1, iRegIsrc src2) %{\n+  match(Set dst (UModI src1 src2));\n+  expand %{\n+    iRegIdst tmp1;\n+    iRegIdst tmp2;\n+    udivI_reg_reg(tmp1, src1, src2);\n+    \/\/ Compute lower 32 bit result using signed instructions as suggested by ISA.\n+    \/\/ Upper 32 bit will contain garbage.\n+    mulI_reg_reg(tmp2, src2, tmp1);\n+    subI_reg_reg(dst, src1, tmp2);\n+  %}\n+%}\n+\n+instruct udivL_reg_reg(iRegLdst dst, iRegLsrc src1, iRegLsrc src2) %{\n+  match(Set dst (UDivL src1 src2));\n+  format %{ \"DIVDU   $dst, $src1, $src2\" %}\n+  size(4);\n+  ins_encode %{\n+    __ divdu($dst$$Register, $src1$$Register, $src2$$Register);\n+  %}\n+  ins_pipe(pipe_class_default);\n+%}\n+\n+instruct umodL_reg_reg(iRegLdst dst, iRegLsrc src1, iRegLsrc src2) %{\n+  match(Set dst (UModL src1 src2));\n+  expand %{\n+    iRegLdst tmp1;\n+    iRegLdst tmp2;\n+    udivL_reg_reg(tmp1, src1, src2);\n+    mulL_reg_reg(tmp2, src2, tmp1);\n+    subL_reg_reg(dst, src1, tmp2);\n+  %}\n+%}\n+\n@@ -12131,1 +12179,1 @@\n-    \/\/ If locking was successfull, crx should indicate 'EQ'.\n+    \/\/ If locking was successful, crx should indicate 'EQ'.\n@@ -12151,1 +12199,1 @@\n-    \/\/ If locking was successfull, crx should indicate 'EQ'.\n+    \/\/ If locking was successful, crx should indicate 'EQ'.\n@@ -12168,1 +12216,1 @@\n-    \/\/ If unlocking was successfull, crx should indicate 'EQ'.\n+    \/\/ If unlocking was successful, crx should indicate 'EQ'.\n@@ -12185,1 +12233,1 @@\n-    \/\/ If unlocking was successfull, crx should indicate 'EQ'.\n+    \/\/ If unlocking was successful, crx should indicate 'EQ'.\n@@ -14472,1 +14520,1 @@\n-\/\/ Load adress to call from TOC, then bl to it.\n+\/\/ Load address to call from TOC, then bl to it.\n@@ -14488,1 +14536,1 @@\n-\/\/ Load adress to call from TOC, then bl to it.\n+\/\/ Load address to call from TOC, then bl to it.\n@@ -14788,1 +14836,1 @@\n-\/\/   \/\/ increment preceeded by register-register move\n+\/\/   \/\/ increment preceded by register-register move\n","filename":"src\/hotspot\/cpu\/ppc\/ppc.ad","additions":58,"deletions":10,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n-\/\/ machine-dependent implemention for register maps\n+\/\/ machine-dependent implementation for register maps\n","filename":"src\/hotspot\/cpu\/ppc\/registerMap_ppc.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -263,1 +263,1 @@\n-  \/\/ calcualte frame size\n+  \/\/ calculate frame size\n@@ -1858,1 +1858,1 @@\n-  \/\/ Native nmethod wrappers never take possesion of the oop arguments.\n+  \/\/ Native nmethod wrappers never take possession of the oop arguments.\n@@ -2876,1 +2876,1 @@\n-  \/\/ work outselves.\n+  \/\/ work ourselves.\n","filename":"src\/hotspot\/cpu\/ppc\/sharedRuntime_ppc.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -3513,1 +3513,1 @@\n-   * Ouput:\n+   * Output:\n@@ -3961,1 +3961,1 @@\n-      \/\/ instuction are invalid Base64 characters.\n+      \/\/ instruction are invalid Base64 characters.\n","filename":"src\/hotspot\/cpu\/ppc\/stubGenerator_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -84,1 +84,1 @@\n-  \/\/ temporarilly. Then we copy the argument list on the java\n+  \/\/ temporarily. Then we copy the argument list on the java\n@@ -2033,1 +2033,1 @@\n-    \/\/ end up in the deopt interpeter entry, deoptimization prepared everything that\n+    \/\/ end up in the deopt interpreter entry, deoptimization prepared everything that\n","filename":"src\/hotspot\/cpu\/ppc\/templateInterpreterGenerator_ppc.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1459,1 +1459,1 @@\n-  \/\/ %%%%% Factor this first part accross platforms\n+  \/\/ %%%%% Factor this first part across platforms\n@@ -2337,1 +2337,1 @@\n-\/\/     writes act as aquire & release, so:\n+\/\/     writes act as acquire & release, so:\n@@ -4036,1 +4036,1 @@\n-\/\/ and uses it to lock the obect in tos.\n+\/\/ and uses it to lock the object in tos.\n@@ -4123,1 +4123,1 @@\n-  \/\/ The object has already been poped from the stack, so the expression stack looks correct.\n+  \/\/ The object has already been popped from the stack, so the expression stack looks correct.\n","filename":"src\/hotspot\/cpu\/ppc\/templateTable_ppc_64.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-  \/\/ Two halfs, multiply by 2.\n+  \/\/ Two halves, multiply by 2.\n@@ -36,1 +36,1 @@\n-  \/\/ Two halfs, multiply by 2.\n+  \/\/ Two halves, multiply by 2.\n","filename":"src\/hotspot\/cpu\/ppc\/vmreg_ppc.inline.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,1 +90,1 @@\n-  \/\/ on the transistion) Since the callee parameters already account\n+  \/\/ on the transition) Since the callee parameters already account\n","filename":"src\/hotspot\/cpu\/riscv\/abstractInterpreter_riscv.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -225,1 +225,1 @@\n-\/\/ Convience classes\n+\/\/ Convenience classes\n","filename":"src\/hotspot\/cpu\/riscv\/assembler_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -362,1 +362,1 @@\n-    __ mv(x9, x10);   \/\/ Perserve the exception\n+    __ mv(x9, x10);   \/\/ Preserve the exception\n@@ -365,1 +365,1 @@\n-  \/\/ Preform needed unlocking\n+  \/\/ Perform needed unlocking\n@@ -402,1 +402,1 @@\n-  \/\/ if the last instruciton is a call (typically to do a throw which\n+  \/\/ if the last instruction is a call (typically to do a throw which\n","filename":"src\/hotspot\/cpu\/riscv\/c1_LIRAssembler_riscv.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -208,1 +208,1 @@\n-    \/\/ 16: multipler for threshold\n+    \/\/ 16: multiplier for threshold\n@@ -216,1 +216,1 @@\n-      if (i < con_size_in_bytes && (con_size_in_bytes % (2 * BytesPerWord))) { \/\/ 2: multipler for BytesPerWord\n+      if (i < con_size_in_bytes && (con_size_in_bytes % (2 * BytesPerWord))) { \/\/ 2: multiplier for BytesPerWord\n","filename":"src\/hotspot\/cpu\/riscv\/c1_MacroAssembler_riscv.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -287,1 +287,1 @@\n-  \/\/ in needle, needle_len. Find the first occurence of pattern in source or return -1.\n+  \/\/ in needle, needle_len. Find the first occurrence of pattern in source or return -1.\n@@ -1433,1 +1433,1 @@\n-  \/\/ for Lating strings, 1 byte for 1 character\n+  \/\/ for Latin strings, 1 byte for 1 character\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -190,1 +190,1 @@\n-\/\/ IMPORTANT: This must preserve all registers, even t0 and t1, except those explicitely\n+\/\/ IMPORTANT: This must preserve all registers, even t0 and t1, except those explicitly\n@@ -502,1 +502,1 @@\n-  \/\/ Step2: CAS failed, check the forwared pointer.\n+  \/\/ Step2: CAS failed, check the forwarded pointer.\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/shenandoah\/shenandoahBarrierSetAssembler_riscv.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -385,1 +385,1 @@\n-  \/\/ Set up SP to accomodate parameters and maybe x10.\n+  \/\/ Set up SP to accommodate parameters and maybe x10.\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/z\/zBarrierSetAssembler_riscv.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -159,1 +159,1 @@\n-      \/\/ msync suceeded, the address is valid, and maybe even already mapped.\n+      \/\/ msync succeeded, the address is valid, and maybe even already mapped.\n@@ -164,1 +164,1 @@\n-      \/\/ Some error occured. This should never happen, but msync\n+      \/\/ Some error occurred. This should never happen, but msync\n","filename":"src\/hotspot\/cpu\/riscv\/gc\/z\/zGlobals_riscv.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -575,1 +575,1 @@\n-\/\/ Unlock any Java monitors from syncronized blocks.\n+\/\/ Unlock any Java monitors from synchronized blocks.\n@@ -1830,1 +1830,1 @@\n-      \/\/ begining of the ProfileData we intend to update to check its\n+      \/\/ beginning of the ProfileData we intend to update to check its\n","filename":"src\/hotspot\/cpu\/riscv\/interp_masm_riscv.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n-\/\/ This file specializes the assember with interpreter-specific macros\n+\/\/ This file specializes the assembler with interpreter-specific macros\n","filename":"src\/hotspot\/cpu\/riscv\/interp_masm_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1394,1 +1394,1 @@\n-  \/\/ Here in case of use with relocation, use fix length instruciton\n+  \/\/ Here in case of use with relocation, use fix length instruction\n@@ -2110,1 +2110,1 @@\n-  \/\/ the receiver class doens't implement the interface, and wasn't the\n+  \/\/ the receiver class doesn't implement the interface, and wasn't the\n@@ -2166,1 +2166,1 @@\n-\/\/ Form an addres from base + offset in Rd. Rd my or may not\n+\/\/ Form an address from base + offset in Rd. Rd my or may not\n@@ -2168,1 +2168,1 @@\n-\/\/ is up to you to ensure that the shift provided mathces the size\n+\/\/ is up to you to ensure that the shift provided matches the size\n@@ -2554,1 +2554,1 @@\n-  \/\/ We move this check to the front fo the fast path because many\n+  \/\/ We move this check to the front of the fast path because many\n@@ -2568,1 +2568,1 @@\n-  \/\/ Ths check has worked decisively for primary supers.\n+  \/\/ This check has worked decisively for primary supers.\n@@ -2572,1 +2572,1 @@\n-  \/\/ between the super_Cache and the primary super dispaly elements.\n+  \/\/ between the super_Cache and the primary super display elements.\n@@ -2593,1 +2593,1 @@\n-\/\/ Scans count pointer sized words at [addr] for occurence of value,\n+\/\/ Scans count pointer sized words at [addr] for occurrence of value,\n@@ -2627,1 +2627,1 @@\n-  \/\/ A couple of usefule fields in sub_klass:\n+  \/\/ A couple of useful fields in sub_klass:\n@@ -2638,1 +2638,1 @@\n-  \/\/ Don't worry too much about pre-existing connecitons with the input regs.\n+  \/\/ Don't worry too much about pre-existing connections with the input regs.\n@@ -2944,1 +2944,1 @@\n-  \/\/ 8 byte aligned after 3 intructions\n+  \/\/ 8 byte aligned after 3 instructions\n@@ -3056,1 +3056,1 @@\n-\/\/ Code for BigInteger::mulAdd instrinsic\n+\/\/ Code for BigInteger::mulAdd intrinsic\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -228,1 +228,1 @@\n-  \/\/ converting a zero (linke NULL) into a Register by giving\n+  \/\/ converting a zero (linked NULL) into a Register by giving\n@@ -265,1 +265,1 @@\n-  \/\/ Form an addres from base + offset in Rd. Rd my or may not\n+  \/\/ Form an address from base + offset in Rd. Rd my or may not\n@@ -267,1 +267,1 @@\n-  \/\/ is up to you to ensure that the shift provided mathces the size\n+  \/\/ is up to you to ensure that the shift provided matches the size\n@@ -305,1 +305,1 @@\n-  \/\/ The reset of the type cehck; must be wired to a corresponding fast path.\n+  \/\/ The reset of the type check; must be wired to a corresponding fast path.\n@@ -307,1 +307,1 @@\n-  \/\/ The tmp1_reg and tmp2_reg can be noreg, if no temps are avaliable.\n+  \/\/ The tmp1_reg and tmp2_reg can be noreg, if no temps are available.\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -155,1 +155,1 @@\n-  \/\/ true means we have fast l2f convers\n+  \/\/ true means we have fast l2f conversion\n","filename":"src\/hotspot\/cpu\/riscv\/matcher_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n-\/\/ machine-dependent implemention for register maps\n+\/\/ machine-dependent implementation for register maps\n","filename":"src\/hotspot\/cpu\/riscv\/registerMap_riscv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n-\/\/ archtecture.\n+\/\/ architecture.\n@@ -2047,0 +2047,4 @@\n+bool Parse::do_one_bytecode_targeted() {\n+  return false;\n+}\n+\n@@ -2151,1 +2155,1 @@\n-  enc_class riscv_enc_cmpxchgw(iRegINoSp res, memory mem, iRegINoSp oldval, iRegINoSp newval) %{\n+  enc_class riscv_enc_cmpxchgw(iRegINoSp res, memory mem, iRegI oldval, iRegI newval) %{\n@@ -2158,1 +2162,1 @@\n-  enc_class riscv_enc_cmpxchgn(iRegINoSp res, memory mem, iRegINoSp oldval, iRegINoSp newval) %{\n+  enc_class riscv_enc_cmpxchgn(iRegINoSp res, memory mem, iRegI oldval, iRegI newval) %{\n@@ -2165,1 +2169,1 @@\n-  enc_class riscv_enc_cmpxchg(iRegINoSp res, memory mem, iRegLNoSp oldval, iRegLNoSp newval) %{\n+  enc_class riscv_enc_cmpxchg(iRegINoSp res, memory mem, iRegL oldval, iRegL newval) %{\n@@ -2172,1 +2176,1 @@\n-  enc_class riscv_enc_cmpxchgw_acq(iRegINoSp res, memory mem, iRegINoSp oldval, iRegINoSp newval) %{\n+  enc_class riscv_enc_cmpxchgw_acq(iRegINoSp res, memory mem, iRegI oldval, iRegI newval) %{\n@@ -2179,1 +2183,1 @@\n-  enc_class riscv_enc_cmpxchgn_acq(iRegINoSp res, memory mem, iRegINoSp oldval, iRegINoSp newval) %{\n+  enc_class riscv_enc_cmpxchgn_acq(iRegINoSp res, memory mem, iRegI oldval, iRegI newval) %{\n@@ -2186,1 +2190,1 @@\n-  enc_class riscv_enc_cmpxchg_acq(iRegINoSp res, memory mem, iRegLNoSp oldval, iRegLNoSp newval) %{\n+  enc_class riscv_enc_cmpxchg_acq(iRegINoSp res, memory mem, iRegL oldval, iRegL newval) %{\n@@ -2323,1 +2327,1 @@\n-  enc_class riscv_enc_fast_lock(iRegP object, iRegP box, iRegP tmp1, iRegP tmp2) %{\n+  enc_class riscv_enc_fast_lock(iRegP object, iRegP box, iRegPNoSp tmp1, iRegPNoSp tmp2) %{\n@@ -2417,1 +2421,1 @@\n-  enc_class riscv_enc_fast_unlock(iRegP object, iRegP box, iRegP tmp1, iRegP tmp2) %{\n+  enc_class riscv_enc_fast_unlock(iRegP object, iRegP box, iRegPNoSp tmp1, iRegPNoSp tmp2) %{\n@@ -2594,1 +2598,1 @@\n-\/\/         are owned by the CALLEE.  Holes should not be nessecary in the\n+\/\/         are owned by the CALLEE.  Holes should not be necessary in the\n@@ -2597,1 +2601,1 @@\n-\/\/         avoid holes.  Holes in the outgoing arguments may be nessecary for\n+\/\/         avoid holes.  Holes in the outgoing arguments may be necessary for\n@@ -5195,1 +5199,1 @@\n-instruct storeLConditional(indirect mem, iRegLNoSp oldval, iRegLNoSp newval, rFlagsReg cr)\n+instruct storeLConditional(indirect mem, iRegL oldval, iRegL newval, rFlagsReg cr)\n@@ -5217,1 +5221,1 @@\n-instruct storeIConditional(indirect mem, iRegINoSp oldval, iRegINoSp newval, rFlagsReg cr)\n+instruct storeIConditional(indirect mem, iRegI oldval, iRegI newval, rFlagsReg cr)\n@@ -5240,1 +5244,1 @@\n-                         iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                         iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5263,1 +5267,1 @@\n-                         iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                         iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5285,1 +5289,1 @@\n-instruct compareAndSwapI(iRegINoSp res, indirect mem, iRegINoSp oldval, iRegINoSp newval)\n+instruct compareAndSwapI(iRegINoSp res, indirect mem, iRegI oldval, iRegI newval)\n@@ -5301,1 +5305,1 @@\n-instruct compareAndSwapL(iRegINoSp res, indirect mem, iRegLNoSp oldval, iRegLNoSp newval)\n+instruct compareAndSwapL(iRegINoSp res, indirect mem, iRegL oldval, iRegL newval)\n@@ -5335,1 +5339,1 @@\n-instruct compareAndSwapN(iRegINoSp res, indirect mem, iRegNNoSp oldval, iRegNNoSp newval)\n+instruct compareAndSwapN(iRegINoSp res, indirect mem, iRegN oldval, iRegN newval)\n@@ -5353,1 +5357,1 @@\n-                            iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                            iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5378,1 +5382,1 @@\n-                            iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                            iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5402,1 +5406,1 @@\n-instruct compareAndSwapIAcq(iRegINoSp res, indirect mem, iRegINoSp oldval, iRegINoSp newval)\n+instruct compareAndSwapIAcq(iRegINoSp res, indirect mem, iRegI oldval, iRegI newval)\n@@ -5420,1 +5424,1 @@\n-instruct compareAndSwapLAcq(iRegINoSp res, indirect mem, iRegLNoSp oldval, iRegLNoSp newval)\n+instruct compareAndSwapLAcq(iRegINoSp res, indirect mem, iRegL oldval, iRegL newval)\n@@ -5456,1 +5460,1 @@\n-instruct compareAndSwapNAcq(iRegINoSp res, indirect mem, iRegNNoSp oldval, iRegNNoSp newval)\n+instruct compareAndSwapNAcq(iRegINoSp res, indirect mem, iRegN oldval, iRegN newval)\n@@ -5481,1 +5485,1 @@\n-                             iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                             iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5503,1 +5507,1 @@\n-                             iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                             iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5606,1 +5610,1 @@\n-                                iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                                iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5630,1 +5634,1 @@\n-                                iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                                iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5742,1 +5746,1 @@\n-                             iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                             iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5766,1 +5770,1 @@\n-                             iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                             iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5871,1 +5875,1 @@\n-                                iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                                iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n@@ -5897,1 +5901,1 @@\n-                                iRegI tmp1, iRegI tmp2, iRegI tmp3, rFlagsReg cr)\n+                                iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3, rFlagsReg cr)\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":36,"deletions":32,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -1949,1 +1949,1 @@\n-                         vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegL tmp)\n+                         vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegLNoSp tmp)\n@@ -1964,1 +1964,1 @@\n-                           vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegL tmp)\n+                           vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegLNoSp tmp)\n@@ -1981,1 +1981,1 @@\n-                          vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegL tmp)\n+                          vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegLNoSp tmp)\n@@ -1997,1 +1997,1 @@\n-                          vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegL tmp)\n+                          vReg_V1 v1, vReg_V2 v2, vReg_V3 v3, iRegLNoSp tmp)\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -627,1 +627,1 @@\n-  \/\/ compiled code, which relys solely on SP and not FP, get sick).\n+  \/\/ compiled code, which relies solely on SP and not FP, get sick).\n@@ -1132,1 +1132,1 @@\n-\/\/    unpack arrray arguments and call native entry point\n+\/\/    unpack array arguments and call native entry point\n@@ -2433,1 +2433,1 @@\n-  \/\/ work outselves.\n+  \/\/ work ourselves.\n","filename":"src\/hotspot\/cpu\/riscv\/sharedRuntime_riscv.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1025,1 +1025,1 @@\n-  \/\/ cache line boundaries will still be loaded and stored atomicly.\n+  \/\/ cache line boundaries will still be loaded and stored atomically.\n@@ -1097,1 +1097,1 @@\n-  \/\/ cache line boundaries will still be loaded and stored atomicly.\n+  \/\/ cache line boundaries will still be loaded and stored atomically.\n@@ -1265,1 +1265,1 @@\n-  \/\/ cache line boundaries will still be loaded and stored atomicly.\n+  \/\/ cache line boundaries will still be loaded and stored atomically.\n@@ -1289,1 +1289,1 @@\n-  \/\/ cache line boundaries will still be loaded and stored atomicly.\n+  \/\/ cache line boundaries will still be loaded and stored atomically.\n","filename":"src\/hotspot\/cpu\/riscv\/stubGenerator_riscv.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -129,1 +129,1 @@\n-\/\/ Miscelaneous helper routines\n+\/\/ Miscellaneous helper routines\n@@ -2224,1 +2224,1 @@\n-\/\/     writes act as aquire & release, so:\n+\/\/     writes act as acquire & release, so:\n@@ -2355,1 +2355,1 @@\n-  \/\/ We use c_rarg registers here beacause we want to use the register used in\n+  \/\/ We use c_rarg registers here because we want to use the register used in\n@@ -2427,1 +2427,1 @@\n-  \/\/ Dont't rewrite getstatic, only getfield\n+  \/\/ Don't rewrite getstatic, only getfield\n@@ -2448,1 +2448,1 @@\n-  \/\/ Rewirte bytecode to be faster\n+  \/\/ Rewrite bytecode to be faster\n@@ -3290,1 +3290,1 @@\n-  assert(byte_no == f1_byte, \"use this arugment\");\n+  assert(byte_no == f1_byte, \"use this argument\");\n@@ -3549,1 +3549,1 @@\n-    \/\/ Initialize obejct fields\n+    \/\/ Initialize object fields\n@@ -3862,1 +3862,1 @@\n-   \/\/ The object has already been poped from the stack, so the\n+   \/\/ The object has already been popped from the stack, so the\n","filename":"src\/hotspot\/cpu\/riscv\/templateTable_riscv.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -222,1 +222,1 @@\n-  \/\/ Preform needed unlocking.\n+  \/\/ Perform needed unlocking.\n@@ -2995,1 +2995,1 @@\n-    __ asm_assert_ne(\"unexpect null obj\", __LINE__);\n+    __ asm_assert_ne(\"unexpected null obj\", __LINE__);\n","filename":"src\/hotspot\/cpu\/s390\/c1_LIRAssembler_s390.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -342,1 +342,1 @@\n-    \/\/ Use shifts if divisior is a power of 2 otherwise use DSGR instruction.\n+    \/\/ Use shifts if divisor is a power of 2 otherwise use DSGR instruction.\n@@ -418,1 +418,1 @@\n-    \/\/ Use shifts if divisior is a power of 2 otherwise use DSGFR instruction.\n+    \/\/ Use shifts if divisor is a power of 2 otherwise use DSGFR instruction.\n","filename":"src\/hotspot\/cpu\/s390\/c1_LIRGenerator_s390.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -96,1 +96,1 @@\n-\/\/ The next two funcions read and write z_ijava_state.monitors.\n+\/\/ The next two functions read and write z_ijava_state.monitors.\n","filename":"src\/hotspot\/cpu\/s390\/frame_s390.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -753,1 +753,1 @@\n-\/\/ Unlock any Java monitors from syncronized blocks.\n+\/\/ Unlock any Java monitors from synchronized blocks.\n@@ -913,1 +913,1 @@\n-\/\/ Unlock any Java monitors from syncronized blocks.\n+\/\/ Unlock any Java monitors from synchronized blocks.\n","filename":"src\/hotspot\/cpu\/s390\/interp_masm_s390.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n-\/\/ This file specializes the assember with interpreter-specific macros.\n+\/\/ This file specializes the assembler with interpreter-specific macros.\n@@ -75,1 +75,1 @@\n-  \/\/ be adjusted to accomodate for the non-argument locals.\n+  \/\/ be adjusted to accommodate for the non-argument locals.\n","filename":"src\/hotspot\/cpu\/s390\/interp_masm_s390.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1244,1 +1244,1 @@\n-\/\/ CPU-version dependend patching of load_const.\n+\/\/ CPU-version dependent patching of load_const.\n@@ -1430,1 +1430,1 @@\n-\/\/ Load constant x into register t with a fast instrcution sequence\n+\/\/ Load constant x into register t with a fast instruction sequence\n@@ -2426,1 +2426,1 @@\n-\/\/  - LGRL(CP) \/ BR          (address in constant pool, pc-relative accesss)\n+\/\/  - LGRL(CP) \/ BR          (address in constant pool, pc-relative access)\n@@ -2847,1 +2847,1 @@\n-\/\/                         use nops to fill ununsed space.\n+\/\/                         use nops to fill unused space.\n@@ -3012,1 +3012,1 @@\n-  \/\/ Also check for R1 which is explicitely used here.\n+  \/\/ Also check for R1 which is explicitly used here.\n@@ -3420,1 +3420,1 @@\n-  \/\/ a 32-bit value. Issueing two illtraps assures the disassembler finds\n+  \/\/ a 32-bit value. Issuing two illtraps assures the disassembler finds\n@@ -3564,1 +3564,1 @@\n-  \/\/ a 32-bit value. Issueing two illtraps assures the disassembler finds\n+  \/\/ a 32-bit value. Issuing two illtraps assures the disassembler finds\n@@ -3611,1 +3611,1 @@\n-  \/\/ a 32-bit value. Issueing two illtraps assures the disassembler finds\n+  \/\/ a 32-bit value. Issuing two illtraps assures the disassembler finds\n@@ -5496,1 +5496,1 @@\n-  \/\/ a 32-bit value. Issueing two illtraps assures the disassembler finds\n+  \/\/ a 32-bit value. Issuing two illtraps assures the disassembler finds\n","filename":"src\/hotspot\/cpu\/s390\/macroAssembler_s390.cpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -147,1 +147,1 @@\n-  \/\/ true means we have fast l2f convers\n+  \/\/ true means we have fast l2f conversion\n","filename":"src\/hotspot\/cpu\/s390\/matcher_s390.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -600,1 +600,1 @@\n-    bool walkable = has_mh; \/\/ Whether the traced frame shoud be walkable.\n+    bool walkable = has_mh; \/\/ Whether the traced frame should be walkable.\n","filename":"src\/hotspot\/cpu\/s390\/methodHandles_s390.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -280,1 +280,1 @@\n-    \/\/ This while loop will also consume the nop which always preceeds a call_far_pcrelative.\n+    \/\/ This while loop will also consume the nop which always precedes a call_far_pcrelative.\n@@ -309,1 +309,1 @@\n-  \/\/ This while loop will also consume the nop which always preceeds a\n+  \/\/ This while loop will also consume the nop which always precedes a\n","filename":"src\/hotspot\/cpu\/s390\/nativeInst_s390.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -42,1 +42,1 @@\n-\/\/    exact alingment cannot be achieved, having the branch target in\n+\/\/    exact alignment cannot be achieved, having the branch target in\n@@ -50,1 +50,1 @@\n-\/\/    Then, the entire target line must be filled first (to contine at the\n+\/\/    Then, the entire target line must be filled first (to continue at the\n@@ -1696,0 +1696,4 @@\n+bool Parse::do_one_bytecode_targeted() {\n+  return false;\n+}\n+\n@@ -3661,1 +3665,1 @@\n-\/\/ seperate instructions for every form of operand when the\n+\/\/ separate instructions for every form of operand when the\n@@ -10337,1 +10341,1 @@\n-\/\/   \/\/ increment preceeded by register-register move\n+\/\/   \/\/ increment preceded by register-register move\n@@ -10753,1 +10757,1 @@\n-\/\/ If no 1-bit is found (i.e. the regsiter contains zero), the instruction\n+\/\/ If no 1-bit is found (i.e. the register contains zero), the instruction\n","filename":"src\/hotspot\/cpu\/s390\/s390.ad","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1272,1 +1272,1 @@\n-      \/\/ stack -> stack. MVC not posible due to sign extension.\n+      \/\/ stack -> stack. MVC not possible due to sign extension.\n@@ -2887,1 +2887,1 @@\n-  \/\/ work outselves.\n+  \/\/ work ourselves.\n","filename":"src\/hotspot\/cpu\/s390\/sharedRuntime_s390.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1927,1 +1927,1 @@\n-      \/\/ spanning the range between [srcOff(Z_ARG3), srcLimit(Z_ARG4)). As detailled above,\n+      \/\/ spanning the range between [srcOff(Z_ARG3), srcLimit(Z_ARG4)). As detailed above,\n@@ -2007,1 +2007,1 @@\n-      \/\/ spanning the range between [srcOff(Z_ARG3), srcLimit(Z_ARG4)). As detailled above,\n+      \/\/ spanning the range between [srcOff(Z_ARG3), srcLimit(Z_ARG4)). As detailed above,\n@@ -2087,1 +2087,1 @@\n-      \/\/ spanning the range between [srcOff(Z_ARG3), srcLimit(Z_ARG4)). As detailled above,\n+      \/\/ spanning the range between [srcOff(Z_ARG3), srcLimit(Z_ARG4)). As detailed above,\n","filename":"src\/hotspot\/cpu\/s390\/stubGenerator_s390.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -345,1 +345,1 @@\n-  \/\/ Method exit, all arguments proocessed.\n+  \/\/ Method exit, all arguments processed.\n","filename":"src\/hotspot\/cpu\/s390\/templateInterpreterGenerator_s390.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -4155,1 +4155,1 @@\n-  \/\/ The object has already been poped from the stack, so the\n+  \/\/ The object has already been popped from the stack, so the\n","filename":"src\/hotspot\/cpu\/s390\/templateTable_s390.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,1 +47,1 @@\n-  \/\/ on the transistion) Since the callee parameters already account\n+  \/\/ on the transition) Since the callee parameters already account\n","filename":"src\/hotspot\/cpu\/x86\/abstractInterpreter_x86.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -362,1 +362,1 @@\n-  \/\/ apply the compression to the displacment iff the result is8bit.\n+  \/\/ apply the compression to the displacement iff the result is8bit.\n@@ -447,1 +447,1 @@\n-  \/\/ apply the compression to the displacment iff the result is8bit.\n+  \/\/ apply the compression to the displacement iff the result is8bit.\n@@ -1050,1 +1050,1 @@\n-    ip++; \/\/ skip P0 and exmaine W in P1\n+    ip++; \/\/ skip P0 and examine W in P1\n@@ -1768,1 +1768,1 @@\n-  \/\/ 0x66 is there. Strangly ucomisd comes out correct\n+  \/\/ 0x66 is there. Strangely ucomisd comes out correct\n@@ -2238,0 +2238,7 @@\n+void Assembler::idivl(Address src) {\n+  InstructionMark im(this);\n+  prefix(src);\n+  emit_int8((unsigned char)0xF7);\n+  emit_operand(as_Register(7), src);\n+}\n+\n@@ -3595,1 +3602,1 @@\n-      \/\/ For Intel don't generate consecutive addess nops (mix with regular nops)\n+      \/\/ For Intel don't generate consecutive address nops (mix with regular nops)\n@@ -3765,1 +3772,1 @@\n-      \/\/ For ZX don't generate consecutive addess nops (mix with regular nops)\n+      \/\/ For ZX don't generate consecutive address nops (mix with regular nops)\n@@ -5301,1 +5308,1 @@\n-\/\/ scans rcx pointer sized words at [edi] for occurance of rax,\n+\/\/ scans rcx pointer sized words at [edi] for occurrence of rax,\n@@ -5310,1 +5317,1 @@\n-\/\/ scans rcx 4 byte words at [edi] for occurance of rax,\n+\/\/ scans rcx 4 byte words at [edi] for occurrence of rax,\n@@ -12369,0 +12376,7 @@\n+void Assembler::idivq(Address src) {\n+  InstructionMark im(this);\n+  prefixq(src);\n+  emit_int8((unsigned char)0xF7);\n+  emit_operand(as_Register(7), src);\n+}\n+\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.cpp","additions":22,"deletions":8,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -139,1 +139,1 @@\n-\/\/ rscratch1 will apear in 32bit code that is dead but of course must compile\n+\/\/ rscratch1 will appear in 32bit code that is dead but of course must compile\n@@ -391,1 +391,1 @@\n-\/\/ Convience classes\n+\/\/ Convenience classes\n@@ -445,1 +445,1 @@\n-\/\/ 64-bit refect the fxsave size which is 512 bytes and the new xsave area on EVEX which is another 2176 bytes\n+\/\/ 64-bit reflect the fxsave size which is 512 bytes and the new xsave area on EVEX which is another 2176 bytes\n@@ -1199,0 +1199,3 @@\n+  void divl(Register src);\n+  void divq(Register src);\n+\n@@ -1367,3 +1370,1 @@\n-  void divl(Register src); \/\/ Unsigned division\n-\n-#ifdef _LP64\n+  void idivl(Address src);\n@@ -1371,2 +1372,1 @@\n-  void divq(Register src); \/\/ Unsigned division\n-#endif\n+  void idivq(Address src);\n@@ -2821,1 +2821,1 @@\n-  \/\/ Set the current instuction to be encoded as an EVEX instuction\n+  \/\/ Set the current instruction to be encoded as an EVEX instruction\n@@ -2831,1 +2831,1 @@\n-  \/\/ Map back to current asembler so that we can manage object level assocation\n+  \/\/ Map back to current assembler so that we can manage object level association\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -459,1 +459,1 @@\n-  \/\/ Preform needed unlocking\n+  \/\/ Perform needed unlocking\n@@ -2274,1 +2274,1 @@\n-        assert(const_addr != NULL, \"incorrect float\/double constant maintainance\");\n+        assert(const_addr != NULL, \"incorrect float\/double constant maintenance\");\n@@ -3657,1 +3657,1 @@\n-    __ stop(\"unexpect null obj\");\n+    __ stop(\"unexpected null obj\");\n","filename":"src\/hotspot\/cpu\/x86\/c1_LIRAssembler_x86.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,1 +125,0 @@\n-    \/\/ there is no immediate move of word values in asembler_i486.?pp\n","filename":"src\/hotspot\/cpu\/x86\/c1_LIRGenerator_x86.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -435,1 +435,1 @@\n-  assert(op->fpu_pop_count() == 0, \"fpu_pop_count alredy set\");\n+  assert(op->fpu_pop_count() == 0, \"fpu_pop_count already set\");\n@@ -445,1 +445,1 @@\n-  assert(op->fpu_pop_count() == 0, \"fpu_pop_count alredy set\");\n+  assert(op->fpu_pop_count() == 0, \"fpu_pop_count already set\");\n@@ -600,1 +600,1 @@\n-            \/\/ TODO: update registes of stub\n+            \/\/ TODO: update registers of stub\n@@ -702,1 +702,1 @@\n-        \/\/ no exchange necessary if right is alredy on top of stack\n+        \/\/ no exchange necessary if right is already on top of stack\n@@ -793,1 +793,1 @@\n-  \/\/ it may contain dead values that could not have been remved by previous operations\n+  \/\/ it may contain dead values that could not have been removed by previous operations\n@@ -933,1 +933,1 @@\n-  \/\/ 1) as long as the current stack top is not in the right location (that meens\n+  \/\/ 1) as long as the current stack top is not in the right location (that means\n","filename":"src\/hotspot\/cpu\/x86\/c1_LinearScan_x86.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1072,1 +1072,1 @@\n-          \/\/ get the instance size (size is postive so movl is fine for 64bit)\n+          \/\/ get the instance size (size is positive so movl is fine for 64bit)\n@@ -1164,1 +1164,1 @@\n-          \/\/ since size is postive movl does right thing on 64bit\n+          \/\/ since size is positive movl does right thing on 64bit\n","filename":"src\/hotspot\/cpu\/x86\/c1_Runtime1_x86.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -774,1 +774,1 @@\n-  \/\/ coherence traffic on the lock *and* artifically extended the critical section\n+  \/\/ coherence traffic on the lock *and* artificially extended the critical section\n@@ -2915,1 +2915,1 @@\n-  jcc(Assembler::less, SCAN_TO_CHAR_INIT);\/\/less than 16 entires left\n+  jcc(Assembler::less, SCAN_TO_CHAR_INIT);\/\/less than 16 entries left\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-  \/\/ See full desription in macroAssembler_x86.cpp.\n+  \/\/ See full description in macroAssembler_x86.cpp.\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -184,1 +184,1 @@\n-      \/\/ begining of the ProfileData we intend to update to check its\n+      \/\/ beginning of the ProfileData we intend to update to check its\n@@ -970,1 +970,1 @@\n-\/\/ Unlock any Java monitors from syncronized blocks.\n+\/\/ Unlock any Java monitors from synchronized blocks.\n","filename":"src\/hotspot\/cpu\/x86\/interp_masm_x86.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n-\/\/ This file specializes the assember with interpreter-specific macros\n+\/\/ This file specializes the assembler with interpreter-specific macros\n","filename":"src\/hotspot\/cpu\/x86\/interp_masm_x86.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1589,1 +1589,1 @@\n-  \/\/ stack pointer as the user finsihed with it. This allows\n+  \/\/ stack pointer as the user finished with it. This allows\n@@ -4785,1 +4785,1 @@\n-\/\/ Doesn't do verfication, generates fixed size code\n+\/\/ Doesn't do verification, generates fixed size code\n@@ -6111,1 +6111,1 @@\n- * Code for BigInteger::multiplyToLen() instrinsic.\n+ * Code for BigInteger::multiplyToLen() intrinsic.\n@@ -6320,1 +6320,1 @@\n-    \/\/ AVX512 code to compare upto 63 byte vectors.\n+    \/\/ AVX512 code to compare up to 63 byte vectors.\n@@ -6601,1 +6601,1 @@\n- * Add 64 bit long carry into z[] with carry propogation.\n+ * Add 64 bit long carry into z[] with carry propagation.\n@@ -6781,1 +6781,1 @@\n-  \/\/ Add 64 bit long carry into z with carry propogation.\n+  \/\/ Add 64 bit long carry into z with carry propagation.\n@@ -7691,1 +7691,1 @@\n-\/\/ Subtract from a lenght of a buffer\n+\/\/ Subtract from a length of a buffer\n@@ -8100,1 +8100,1 @@\n-    \/\/ First check whether a character is compressable ( <= 0xFF).\n+    \/\/ First check whether a character is compressible ( <= 0xFF).\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -544,1 +544,1 @@\n-  \/\/ Additonal registers can be excluded in a passed RegSet.\n+  \/\/ Additional registers can be excluded in a passed RegSet.\n@@ -859,1 +859,1 @@\n-  \/\/ NOTE: these jumps tranfer to the effective address of dst NOT\n+  \/\/ NOTE: these jumps transfer to the effective address of dst NOT\n@@ -866,1 +866,1 @@\n-  \/\/ to be installed in the Address class. This jump will tranfers to the address\n+  \/\/ to be installed in the Address class. This jump will transfer to the address\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -698,1 +698,1 @@\n-    \/\/ xor data block#0 with input state before perfoming carry-less multiplication\n+    \/\/ xor data block#0 with input state before performing carry-less multiplication\n@@ -1212,1 +1212,1 @@\n-    \/\/ extract upto 15 bytes of CT from xmm0 as specified by length register\n+    \/\/ extract up to 15 bytes of CT from xmm0 as specified by length register\n@@ -1596,1 +1596,1 @@\n-    \/\/ AES rounds upto 11 (AES192) or 13 (AES256)\n+    \/\/ AES rounds up to 11 (AES192) or 13 (AES256)\n@@ -1718,1 +1718,1 @@\n-    \/\/ AES rounds upto 11 (AES192) or 13 (AES256)\n+    \/\/ AES rounds up to 11 (AES192) or 13 (AES256)\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86_aes.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -132,2 +132,2 @@\n-  \/\/ On x64 it is stored without convertion so we can use normal access.\n-  \/\/ On x32 it is stored with convertion only when FPU is used for floats.\n+  \/\/ On x64 it is stored without conversion so we can use normal access.\n+  \/\/ On x32 it is stored with conversion only when FPU is used for floats.\n@@ -177,1 +177,1 @@\n-  \/\/ true means we have fast l2f convers\n+  \/\/ true means we have fast l2f conversion\n","filename":"src\/hotspot\/cpu\/x86\/matcher_x86.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -648,1 +648,1 @@\n-  __ mov(rbx, rsp); \/\/ for retreiving saved_regs\n+  __ mov(rbx, rsp); \/\/ for retrieving saved_regs\n","filename":"src\/hotspot\/cpu\/x86\/methodHandles_x86.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -217,2 +217,2 @@\n-\/\/ First patches first word of instruction to two jmp's that jmps to them\n-\/\/ selfs (spinlock). Then patches the last byte, and then atomicly replaces\n+\/\/ First patches first word of instruction to two jmp's that jmps to themselves\n+\/\/ (spinlock). Then patches the last byte, and then atomically replaces\n@@ -499,1 +499,1 @@\n-\/\/ The problem: jmp <dest> is a 5-byte instruction. Atomical write can be only with 4 bytes.\n+\/\/ The problem: jmp <dest> is a 5-byte instruction. Atomic write can be only with 4 bytes.\n@@ -599,2 +599,2 @@\n-\/\/ First patches first word of instruction to two jmp's that jmps to them\n-\/\/ selfs (spinlock). Then patches the last byte, and then atomicly replaces\n+\/\/ First patches first word of instruction to two jmp's that jmps to themselves\n+\/\/ (spinlock). Then patches the last byte, and then atomically replaces\n","filename":"src\/hotspot\/cpu\/x86\/nativeInst_x86.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,47 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+#include \"precompiled.hpp\"\n+\n+#ifdef COMPILER2\n+\n+#include \"opto\/parse.hpp\"\n+#include \"interpreter\/bytecodes.hpp\"\n+\n+bool Parse::do_one_bytecode_targeted() {\n+  switch (bc()) {\n+    case Bytecodes::_idiv: \/\/ fallthrough\n+    case Bytecodes::_irem: \/\/ fallthrough\n+#ifdef _LP64\n+    case Bytecodes::_ldiv: \/\/ fallthrough\n+    case Bytecodes::_lrem:\n+#endif\n+      do_divmod_fixup();\n+      return true;\n+    default:\n+      return false;\n+  }\n+}\n+\n+#endif \/\/ COMPILER2\n","filename":"src\/hotspot\/cpu\/x86\/parse_x86.cpp","additions":47,"deletions":0,"binary":false,"changes":47,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n-\/\/ machine-dependent implemention for register maps\n+\/\/ machine-dependent implementation for register maps\n","filename":"src\/hotspot\/cpu\/x86\/registerMap_x86.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -968,1 +968,1 @@\n-  \/\/ compiled code, which relys solely on SP and not EBP, get sick).\n+  \/\/ compiled code, which relies solely on SP and not EBP, get sick).\n","filename":"src\/hotspot\/cpu\/x86\/sharedRuntime_x86_32.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -954,1 +954,1 @@\n-  \/\/ only needed becaus eof c2 resolve stubs return Method* as a result in\n+  \/\/ only needed because eof c2 resolve stubs return Method* as a result in\n@@ -978,1 +978,1 @@\n-  \/\/ compiled code, which relys solely on SP and not RBP, get sick).\n+  \/\/ compiled code, which relies solely on SP and not RBP, get sick).\n@@ -2867,1 +2867,1 @@\n-  \/\/ work outselves.\n+  \/\/ work ourselves.\n","filename":"src\/hotspot\/cpu\/x86\/sharedRuntime_x86_64.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -3323,1 +3323,1 @@\n-   * Ouput:\n+   * Output:\n@@ -3379,1 +3379,1 @@\n-  * Ouput:\n+  * Output:\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_32.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -2250,1 +2250,1 @@\n-  \/\/ cache line boundaries will still be loaded and stored atomicly.\n+  \/\/ cache line boundaries will still be loaded and stored atomically.\n@@ -2364,1 +2364,1 @@\n-  \/\/ cache line boundaries will still be loaded and stored atomicly.\n+  \/\/ cache line boundaries will still be loaded and stored atomically.\n@@ -3950,1 +3950,1 @@\n-        load_key(xmm15, key, 0xd0); \/\/ 0xd0; 256-bit key goes upto 0xe0\n+        load_key(xmm15, key, 0xd0); \/\/ 0xd0; 256-bit key goes up to 0xe0\n@@ -4042,2 +4042,2 @@\n-        load_key(xmm_key11, key, 0xb0); \/\/ 0xb0; 192-bit key goes upto 0xc0\n-        load_key(xmm_key12, key, 0xc0); \/\/ 0xc0; 192-bit key goes upto 0xc0\n+        load_key(xmm_key11, key, 0xb0); \/\/ 0xb0; 192-bit key goes up to 0xc0\n+        load_key(xmm_key12, key, 0xc0); \/\/ 0xc0; 192-bit key goes up to 0xc0\n@@ -4046,1 +4046,1 @@\n-        load_key(xmm_key11, key, 0xb0); \/\/ 0xb0; 256-bit key goes upto 0xe0\n+        load_key(xmm_key11, key, 0xb0); \/\/ 0xb0; 256-bit key goes up to 0xe0\n@@ -5608,1 +5608,1 @@\n-      \/\/ bits respecively.  This is done using vpmullw.  We end up\n+      \/\/ bits respectively.  This is done using vpmullw.  We end up\n@@ -6485,1 +6485,1 @@\n-   * Ouput:\n+   * Output:\n@@ -6541,1 +6541,1 @@\n-  * Ouput:\n+  * Output:\n@@ -6761,1 +6761,1 @@\n-  \/\/    c_rarg3   - z lenth\n+  \/\/    c_rarg3   - z length\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_64.cpp","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -1050,1 +1050,1 @@\n-  \/\/ NOTE: the order of theses push(es) is known to frame::interpreter_frame_result.\n+  \/\/ NOTE: the order of these push(es) is known to frame::interpreter_frame_result.\n","filename":"src\/hotspot\/cpu\/x86\/templateInterpreterGenerator_x86.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -145,1 +145,1 @@\n-\/\/ Miscelaneous helper routines\n+\/\/ Miscellaneous helper routines\n@@ -2622,1 +2622,1 @@\n-\/\/     writes act as aquire & release, so:\n+\/\/     writes act as acquire & release, so:\n@@ -4356,1 +4356,1 @@\n-  \/\/ The object has already been poped from the stack, so the\n+  \/\/ The object has already been popped from the stack, so the\n","filename":"src\/hotspot\/cpu\/x86\/templateTable_x86.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -411,1 +411,1 @@\n-    \/\/ If UseAVX is unitialized or is set by the user to include EVEX\n+    \/\/ If UseAVX is uninitialized or is set by the user to include EVEX\n@@ -501,1 +501,1 @@\n-    \/\/ If UseAVX is unitialized or is set by the user to include EVEX\n+    \/\/ If UseAVX is uninitialized or is set by the user to include EVEX\n@@ -2145,1 +2145,1 @@\n-  \"Pentium Pro\",   \/\/or Pentium-M\/Woodcrest depeding on model\n+  \"Pentium Pro\",   \/\/or Pentium-M\/Woodcrest depending on model\n@@ -2260,1 +2260,1 @@\n-\/* Brand ID is for back compability\n+\/* Brand ID is for back compatibility\n@@ -2796,1 +2796,1 @@\n-    \/\/ Compute freqency (in Hz) from brand string.\n+    \/\/ Compute frequency (in Hz) from brand string.\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1047,1 +1047,1 @@\n-  \/\/ Old CPUs perform lea on AGU which causes additional latency transfering the\n+  \/\/ Old CPUs perform lea on AGU which causes additional latency transferring the\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-\/\/ archtecture.\n+\/\/ architecture.\n@@ -6666,1 +6666,1 @@\n-    \/\/ Shift lower half, with result in vtmp2 usign vtmp1 as TEMP\n+    \/\/ Shift lower half, with result in vtmp2 using vtmp1 as TEMP\n@@ -6672,1 +6672,1 @@\n-    \/\/ Shift upper half, with result in dst usign vtmp1 as TEMP\n+    \/\/ Shift upper half, with result in dst using vtmp1 as TEMP\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1554,41 +1554,0 @@\n-  enc_class cdq_enc %{\n-    \/\/ Full implementation of Java idiv and irem; checks for\n-    \/\/ special case as described in JVM spec., p.243 & p.271.\n-    \/\/\n-    \/\/         normal case                           special case\n-    \/\/\n-    \/\/ input : rax,: dividend                         min_int\n-    \/\/         reg: divisor                          -1\n-    \/\/\n-    \/\/ output: rax,: quotient  (= rax, idiv reg)       min_int\n-    \/\/         rdx: remainder (= rax, irem reg)       0\n-    \/\/\n-    \/\/  Code sequnce:\n-    \/\/\n-    \/\/  81 F8 00 00 00 80    cmp         rax,80000000h\n-    \/\/  0F 85 0B 00 00 00    jne         normal_case\n-    \/\/  33 D2                xor         rdx,edx\n-    \/\/  83 F9 FF             cmp         rcx,0FFh\n-    \/\/  0F 84 03 00 00 00    je          done\n-    \/\/                  normal_case:\n-    \/\/  99                   cdq\n-    \/\/  F7 F9                idiv        rax,ecx\n-    \/\/                  done:\n-    \/\/\n-    emit_opcode(cbuf,0x81); emit_d8(cbuf,0xF8);\n-    emit_opcode(cbuf,0x00); emit_d8(cbuf,0x00);\n-    emit_opcode(cbuf,0x00); emit_d8(cbuf,0x80);                     \/\/ cmp rax,80000000h\n-    emit_opcode(cbuf,0x0F); emit_d8(cbuf,0x85);\n-    emit_opcode(cbuf,0x0B); emit_d8(cbuf,0x00);\n-    emit_opcode(cbuf,0x00); emit_d8(cbuf,0x00);                     \/\/ jne normal_case\n-    emit_opcode(cbuf,0x33); emit_d8(cbuf,0xD2);                     \/\/ xor rdx,edx\n-    emit_opcode(cbuf,0x83); emit_d8(cbuf,0xF9); emit_d8(cbuf,0xFF); \/\/ cmp rcx,0FFh\n-    emit_opcode(cbuf,0x0F); emit_d8(cbuf,0x84);\n-    emit_opcode(cbuf,0x03); emit_d8(cbuf,0x00);\n-    emit_opcode(cbuf,0x00); emit_d8(cbuf,0x00);                     \/\/ je done\n-    \/\/ normal_case:\n-    emit_opcode(cbuf,0x99);                                         \/\/ cdq\n-    \/\/ idiv (note: must be emitted by the user of this rule)\n-    \/\/ normal:\n-  %}\n-\n@@ -3092,1 +3051,1 @@\n-\/\/         are owned by the CALLEE.  Holes should not be nessecary in the\n+\/\/         are owned by the CALLEE.  Holes should not be necessary in the\n@@ -3095,1 +3054,1 @@\n-\/\/         avoid holes.  Holes in the outgoing arguments may be nessecary for\n+\/\/         avoid holes.  Holes in the outgoing arguments may be necessary for\n@@ -4371,1 +4330,1 @@\n-\/\/ Comparision Code\n+\/\/ Comparison Code\n@@ -7795,1 +7754,1 @@\n-  match(Set rax (DivI rax div));\n+  match(Set rax (NoOvfDivI rax div));\n@@ -7797,13 +7756,9 @@\n-  size(26);\n-  ins_cost(30*100+10*100);\n-  format %{ \"CMP    EAX,0x80000000\\n\\t\"\n-            \"JNE,s  normal\\n\\t\"\n-            \"XOR    EDX,EDX\\n\\t\"\n-            \"CMP    ECX,-1\\n\\t\"\n-            \"JE,s   done\\n\"\n-    \"normal: CDQ\\n\\t\"\n-            \"IDIV   $div\\n\\t\"\n-    \"done:\"        %}\n-  opcode(0xF7, 0x7);  \/* Opcode F7 \/7 *\/\n-  ins_encode( cdq_enc, OpcP, RegOpc(div) );\n-  ins_pipe( ialu_reg_reg_alu0 );\n+  size(3);\n+  ins_cost(500);\n+  format %{ \"CDQ\\n\\t\"\n+            \"IDIV   $div\" %}\n+  ins_encode %{\n+    __ cdql();\n+    __ idivl($div$$Register);\n+  %}\n+  ins_pipe( pipe_slow );\n@@ -7829,1 +7784,1 @@\n-  match(DivModI rax div);\n+  match(NoOvfDivModI rax div);\n@@ -7831,12 +7786,8 @@\n-  size(26);\n-  ins_cost(30*100+10*100);\n-  format %{ \"CMP    EAX,0x80000000\\n\\t\"\n-            \"JNE,s  normal\\n\\t\"\n-            \"XOR    EDX,EDX\\n\\t\"\n-            \"CMP    ECX,-1\\n\\t\"\n-            \"JE,s   done\\n\"\n-    \"normal: CDQ\\n\\t\"\n-            \"IDIV   $div\\n\\t\"\n-    \"done:\"        %}\n-  opcode(0xF7, 0x7);  \/* Opcode F7 \/7 *\/\n-  ins_encode( cdq_enc, OpcP, RegOpc(div) );\n+  size(3);\n+  ins_cost(500);\n+  format %{ \"CDQ\\n\\t\"\n+            \"IDIV   $div\" %}\n+  ins_encode %{\n+    __ cdql();\n+    __ idivl($div$$Register);\n+  %}\n@@ -7848,1 +7799,1 @@\n-  match(Set rdx (ModI rax div));\n+  match(Set rdx (NoOvfModI rax div));\n@@ -7851,2 +7802,2 @@\n-  size(26);\n-  ins_cost(300);\n+  size(3);\n+  ins_cost(500);\n@@ -7855,3 +7806,5 @@\n-  opcode(0xF7, 0x7);  \/* Opcode F7 \/7 *\/\n-  ins_encode( cdq_enc, OpcP, RegOpc(div) );\n-  ins_pipe( ialu_reg_reg_alu0 );\n+  ins_encode %{\n+    __ cdql();\n+    __ idivl($div$$Register);\n+  %}\n+  ins_pipe( pipe_slow );\n@@ -12537,1 +12490,1 @@\n-    \/\/ signed devision: (EAX:EDX) \/ pos_stride\n+    \/\/ signed division: (EAX:EDX) \/ pos_stride\n@@ -13891,1 +13844,1 @@\n-\/\/   \/\/ increment preceeded by register-register move\n+\/\/   \/\/ increment preceded by register-register move\n","filename":"src\/hotspot\/cpu\/x86\/x86_32.ad","additions":32,"deletions":79,"binary":false,"changes":111,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-\/\/ archtecture.\n+\/\/ architecture.\n@@ -341,0 +341,1 @@\n+extern RegMask _STACK_OR_LONG_NO_RAX_RDX_REG_mask;\n@@ -342,0 +343,1 @@\n+extern RegMask _STACK_OR_INT_NO_RAX_RDX_REG_mask;\n@@ -345,0 +347,3 @@\n+inline const RegMask& STACK_OR_LONG_NO_RAX_RDX_REG_mask() {\n+  return _STACK_OR_LONG_NO_RAX_RDX_REG_mask;\n+}\n@@ -346,0 +351,3 @@\n+inline const RegMask& STACK_OR_INT_NO_RAX_RDX_REG_mask() {\n+  return _STACK_OR_INT_NO_RAX_RDX_REG_mask;\n+}\n@@ -371,0 +379,1 @@\n+RegMask _STACK_OR_LONG_NO_RAX_RDX_REG_mask;\n@@ -372,0 +381,1 @@\n+RegMask _STACK_OR_INT_NO_RAX_RDX_REG_mask;\n@@ -432,0 +442,3 @@\n+  _STACK_OR_LONG_NO_RAX_RDX_REG_mask = _LONG_NO_RAX_RDX_REG_mask;\n+  _STACK_OR_LONG_NO_RAX_RDX_REG_mask.OR(STACK_OR_STACK_SLOTS_mask());\n+\n@@ -454,0 +467,3 @@\n+  _STACK_OR_INT_NO_RAX_RDX_REG_mask = _INT_NO_RAX_RDX_REG_mask;\n+  _STACK_OR_INT_NO_RAX_RDX_REG_mask.OR(STACK_OR_STACK_SLOTS_mask());\n+\n@@ -1904,117 +1920,0 @@\n-  enc_class cdql_enc(no_rax_rdx_RegI div)\n-  %{\n-    \/\/ Full implementation of Java idiv and irem; checks for\n-    \/\/ special case as described in JVM spec., p.243 & p.271.\n-    \/\/\n-    \/\/         normal case                           special case\n-    \/\/\n-    \/\/ input : rax: dividend                         min_int\n-    \/\/         reg: divisor                          -1\n-    \/\/\n-    \/\/ output: rax: quotient  (= rax idiv reg)       min_int\n-    \/\/         rdx: remainder (= rax irem reg)       0\n-    \/\/\n-    \/\/  Code sequnce:\n-    \/\/\n-    \/\/    0:   3d 00 00 00 80          cmp    $0x80000000,%eax\n-    \/\/    5:   75 07\/08                jne    e <normal>\n-    \/\/    7:   33 d2                   xor    %edx,%edx\n-    \/\/  [div >= 8 -> offset + 1]\n-    \/\/  [REX_B]\n-    \/\/    9:   83 f9 ff                cmp    $0xffffffffffffffff,$div\n-    \/\/    c:   74 03\/04                je     11 <done>\n-    \/\/ 000000000000000e <normal>:\n-    \/\/    e:   99                      cltd\n-    \/\/  [div >= 8 -> offset + 1]\n-    \/\/  [REX_B]\n-    \/\/    f:   f7 f9                   idiv   $div\n-    \/\/ 0000000000000011 <done>:\n-    MacroAssembler _masm(&cbuf);\n-    Label normal;\n-    Label done;\n-\n-    \/\/ cmp    $0x80000000,%eax\n-    __ cmpl(as_Register(RAX_enc), 0x80000000);\n-\n-    \/\/ jne    e <normal>\n-    __ jccb(Assembler::notEqual, normal);\n-\n-    \/\/ xor    %edx,%edx\n-    __ xorl(as_Register(RDX_enc), as_Register(RDX_enc));\n-\n-    \/\/ cmp    $0xffffffffffffffff,%ecx\n-    __ cmpl($div$$Register, -1);\n-\n-    \/\/ je     11 <done>\n-    __ jccb(Assembler::equal, done);\n-\n-    \/\/ <normal>\n-    \/\/ cltd\n-    __ bind(normal);\n-    __ cdql();\n-\n-    \/\/ idivl\n-    \/\/ <done>\n-    __ idivl($div$$Register);\n-    __ bind(done);\n-  %}\n-\n-  enc_class cdqq_enc(no_rax_rdx_RegL div)\n-  %{\n-    \/\/ Full implementation of Java ldiv and lrem; checks for\n-    \/\/ special case as described in JVM spec., p.243 & p.271.\n-    \/\/\n-    \/\/         normal case                           special case\n-    \/\/\n-    \/\/ input : rax: dividend                         min_long\n-    \/\/         reg: divisor                          -1\n-    \/\/\n-    \/\/ output: rax: quotient  (= rax idiv reg)       min_long\n-    \/\/         rdx: remainder (= rax irem reg)       0\n-    \/\/\n-    \/\/  Code sequnce:\n-    \/\/\n-    \/\/    0:   48 ba 00 00 00 00 00    mov    $0x8000000000000000,%rdx\n-    \/\/    7:   00 00 80\n-    \/\/    a:   48 39 d0                cmp    %rdx,%rax\n-    \/\/    d:   75 08                   jne    17 <normal>\n-    \/\/    f:   33 d2                   xor    %edx,%edx\n-    \/\/   11:   48 83 f9 ff             cmp    $0xffffffffffffffff,$div\n-    \/\/   15:   74 05                   je     1c <done>\n-    \/\/ 0000000000000017 <normal>:\n-    \/\/   17:   48 99                   cqto\n-    \/\/   19:   48 f7 f9                idiv   $div\n-    \/\/ 000000000000001c <done>:\n-    MacroAssembler _masm(&cbuf);\n-    Label normal;\n-    Label done;\n-\n-    \/\/ mov    $0x8000000000000000,%rdx\n-    __ mov64(as_Register(RDX_enc), 0x8000000000000000);\n-\n-    \/\/ cmp    %rdx,%rax\n-    __ cmpq(as_Register(RAX_enc), as_Register(RDX_enc));\n-\n-    \/\/ jne    17 <normal>\n-    __ jccb(Assembler::notEqual, normal);\n-\n-    \/\/ xor    %edx,%edx\n-    __ xorl(as_Register(RDX_enc), as_Register(RDX_enc));\n-\n-    \/\/ cmp    $0xffffffffffffffff,$div\n-    __ cmpq($div$$Register, -1);\n-\n-    \/\/ je     1e <done>\n-    __ jccb(Assembler::equal, done);\n-\n-    \/\/ <normal>\n-    \/\/ cqto\n-    __ bind(normal);\n-    __ cdqq();\n-\n-    \/\/ idivq (note: must be emitted by the user of this rule)\n-    \/\/ <done>\n-    __ idivq($div$$Register);\n-    __ bind(done);\n-  %}\n-\n@@ -2787,1 +2686,1 @@\n-\/\/         are owned by the CALLEE.  Holes should not be nessecary in the\n+\/\/         are owned by the CALLEE.  Holes should not be necessary in the\n@@ -2790,1 +2689,1 @@\n-\/\/         avoid holes.  Holes in the outgoing arguments may be nessecary for\n+\/\/         avoid holes.  Holes in the outgoing arguments may be necessary for\n@@ -3240,1 +3139,1 @@\n-\/\/ Int Immediate: 2^n-1, postive\n+\/\/ Int Immediate: 2^n-1, positive\n@@ -4269,1 +4168,1 @@\n-\/\/ Comparision Code\n+\/\/ Comparison Code\n@@ -8649,1 +8548,1 @@\n-  match(Set rax (DivI rax div));\n+  match(Set rax (NoOvfDivI rax div));\n@@ -8652,11 +8551,24 @@\n-  ins_cost(30*100+10*100); \/\/ XXX\n-  format %{ \"cmpl    rax, 0x80000000\\t# idiv\\n\\t\"\n-            \"jne,s   normal\\n\\t\"\n-            \"xorl    rdx, rdx\\n\\t\"\n-            \"cmpl    $div, -1\\n\\t\"\n-            \"je,s    done\\n\"\n-    \"normal: cdql\\n\\t\"\n-            \"idivl   $div\\n\"\n-    \"done:\"        %}\n-  ins_encode(cdql_enc(div));\n-  ins_pipe(ialu_reg_reg_alu0);\n+  ins_cost(500);\n+  format %{ \"cdql\\n\\t\"\n+            \"idivl   $div\" %}\n+  ins_encode %{\n+    __ cdql();\n+    __ idivl($div$$Register);\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n+instruct divI_mem(rax_RegI rax, rdx_RegI rdx, memory div,\n+                   rFlagsReg cr)\n+%{\n+  match(Set rax (NoOvfDivI rax (LoadI div)));\n+  effect(KILL rdx, KILL cr);\n+\n+  ins_cost(575);\n+  format %{ \"cdql\\n\\t\"\n+            \"idivl   $div\" %}\n+  ins_encode %{\n+    __ cdql();\n+    __ idivl($div$$Address);\n+  %}\n+  ins_pipe(pipe_slow);\n@@ -8668,1 +8580,1 @@\n-  match(Set rax (DivL rax div));\n+  match(Set rax (NoOvfDivL rax div));\n@@ -8671,12 +8583,24 @@\n-  ins_cost(30*100+10*100); \/\/ XXX\n-  format %{ \"movq    rdx, 0x8000000000000000\\t# ldiv\\n\\t\"\n-            \"cmpq    rax, rdx\\n\\t\"\n-            \"jne,s   normal\\n\\t\"\n-            \"xorl    rdx, rdx\\n\\t\"\n-            \"cmpq    $div, -1\\n\\t\"\n-            \"je,s    done\\n\"\n-    \"normal: cdqq\\n\\t\"\n-            \"idivq   $div\\n\"\n-    \"done:\"        %}\n-  ins_encode(cdqq_enc(div));\n-  ins_pipe(ialu_reg_reg_alu0);\n+  ins_cost(500);\n+  format %{ \"cdqq\\n\\t\"\n+            \"idivq   $div\" %}\n+  ins_encode %{\n+    __ cdqq();\n+    __ idivq($div$$Register);\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n+instruct divL_mem(rax_RegL rax, rdx_RegL rdx, memory div,\n+                   rFlagsReg cr)\n+%{\n+  match(Set rax (NoOvfDivL rax (LoadL div)));\n+  effect(KILL rdx, KILL cr);\n+\n+  ins_cost(575);\n+  format %{ \"cdqq\\n\\t\"\n+            \"idivq   $div\" %}\n+  ins_encode %{\n+    __ cdqq();\n+    __ idivq($div$$Address);\n+  %}\n+  ins_pipe(pipe_slow);\n@@ -8715,1 +8639,1 @@\n-  match(DivModI rax div);\n+  match(NoOvfDivModI rax div);\n@@ -8718,10 +8642,7 @@\n-  ins_cost(30*100+10*100); \/\/ XXX\n-  format %{ \"cmpl    rax, 0x80000000\\t# idiv\\n\\t\"\n-            \"jne,s   normal\\n\\t\"\n-            \"xorl    rdx, rdx\\n\\t\"\n-            \"cmpl    $div, -1\\n\\t\"\n-            \"je,s    done\\n\"\n-    \"normal: cdql\\n\\t\"\n-            \"idivl   $div\\n\"\n-    \"done:\"        %}\n-  ins_encode(cdql_enc(div));\n+  ins_cost(500);\n+  format %{ \"cdql\\n\\t\"\n+            \"idivl   $div\" %}\n+  ins_encode %{\n+    __ cdql();\n+    __ idivl($div$$Register);\n+  %}\n@@ -8735,1 +8656,1 @@\n-  match(DivModL rax div);\n+  match(NoOvfDivModL rax div);\n@@ -8738,11 +8659,7 @@\n-  ins_cost(30*100+10*100); \/\/ XXX\n-  format %{ \"movq    rdx, 0x8000000000000000\\t# ldiv\\n\\t\"\n-            \"cmpq    rax, rdx\\n\\t\"\n-            \"jne,s   normal\\n\\t\"\n-            \"xorl    rdx, rdx\\n\\t\"\n-            \"cmpq    $div, -1\\n\\t\"\n-            \"je,s    done\\n\"\n-    \"normal: cdqq\\n\\t\"\n-            \"idivq   $div\\n\"\n-    \"done:\"        %}\n-  ins_encode(cdqq_enc(div));\n+  ins_cost(500);\n+  format %{ \"cdqq\\n\\t\"\n+            \"idivq   $div\" %}\n+  ins_encode %{\n+    __ cdqq();\n+    __ idivq($div$$Register);\n+  %}\n@@ -8786,26 +8703,2 @@\n-\n-\/\/----------- DivL-By-Constant-Expansions--------------------------------------\n-\/\/ DivI cases are handled by the compiler\n-\n-\/\/ Magic constant, reciprocal of 10\n-instruct loadConL_0x6666666666666667(rRegL dst)\n-%{\n-  effect(DEF dst);\n-\n-  format %{ \"movq    $dst, #0x666666666666667\\t# Used in div-by-10\" %}\n-  ins_encode(load_immL(dst, 0x6666666666666667));\n-  ins_pipe(ialu_reg);\n-%}\n-\n-instruct mul_hi(rdx_RegL dst, no_rax_RegL src, rax_RegL rax, rFlagsReg cr)\n-%{\n-  effect(DEF dst, USE src, USE_KILL rax, KILL cr);\n-\n-  format %{ \"imulq   rdx:rax, rax, $src\\t# Used in div-by-10\" %}\n-  ins_encode %{\n-    __ imulq($src$$Register);\n-  %}\n-  ins_pipe(ialu_reg_reg_alu0);\n-%}\n-\n-instruct sarL_rReg_63(rRegL dst, rFlagsReg cr)\n+instruct modI_rReg(rdx_RegI rdx, rax_RegI rax, no_rax_rdx_RegI div,\n+                   rFlagsReg cr)\n@@ -8813,1 +8706,2 @@\n-  effect(USE_DEF dst, KILL cr);\n+  match(Set rdx (NoOvfModI rax div));\n+  effect(KILL rax, KILL cr);\n@@ -8815,1 +8709,3 @@\n-  format %{ \"sarq    $dst, #63\\t# Used in div-by-10\" %}\n+  ins_cost(500);\n+  format %{ \"cdql\\n\\t\"\n+            \"idivl   $div\" %}\n@@ -8817,1 +8713,2 @@\n-    __ sarq($dst$$Register, 63);\n+    __ cdql();\n+    __ idivl($div$$Register);\n@@ -8819,1 +8716,1 @@\n-  ins_pipe(ialu_reg);\n+  ins_pipe(pipe_slow);\n@@ -8822,1 +8719,2 @@\n-instruct sarL_rReg_2(rRegL dst, rFlagsReg cr)\n+instruct modI_mem(rdx_RegI rdx, rax_RegI rax, memory div,\n+                   rFlagsReg cr)\n@@ -8824,1 +8722,2 @@\n-  effect(USE_DEF dst, KILL cr);\n+  match(Set rdx (NoOvfModI rax (LoadI div)));\n+  effect(KILL rax, KILL cr);\n@@ -8826,1 +8725,3 @@\n-  format %{ \"sarq    $dst, #2\\t# Used in div-by-10\" %}\n+  ins_cost(575);\n+  format %{ \"cdql\\n\\t\"\n+            \"idivl   $div\" %}\n@@ -8828,18 +8729,2 @@\n-    __ sarq($dst$$Register, 2);\n-  %}\n-  ins_pipe(ialu_reg);\n-%}\n-\n-instruct divL_10(rdx_RegL dst, no_rax_RegL src, immL10 div)\n-%{\n-  match(Set dst (DivL src div));\n-\n-  ins_cost((5+8)*100);\n-  expand %{\n-    rax_RegL rax;                     \/\/ Killed temp\n-    rFlagsReg cr;                     \/\/ Killed\n-    loadConL_0x6666666666666667(rax); \/\/ movq  rax, 0x6666666666666667\n-    mul_hi(dst, src, rax, cr);        \/\/ mulq  rdx:rax <= rax * $src\n-    sarL_rReg_63(src, cr);            \/\/ sarq  src, 63\n-    sarL_rReg_2(dst, cr);             \/\/ sarq  rdx, 2\n-    subL_rReg(dst, src, cr);          \/\/ subl  rdx, src\n+    __ cdql();\n+    __ idivl($div$$Address);\n@@ -8847,0 +8732,1 @@\n+  ins_pipe(pipe_slow);\n@@ -8849,3 +8735,1 @@\n-\/\/-----------------------------------------------------------------------------\n-\n-instruct modI_rReg(rdx_RegI rdx, rax_RegI rax, no_rax_rdx_RegI div,\n+instruct modL_rReg(rdx_RegL rdx, rax_RegL rax, no_rax_rdx_RegL div,\n@@ -8854,1 +8738,1 @@\n-  match(Set rdx (ModI rax div));\n+  match(Set rdx (NoOvfModL rax div));\n@@ -8857,11 +8741,8 @@\n-  ins_cost(300); \/\/ XXX\n-  format %{ \"cmpl    rax, 0x80000000\\t# irem\\n\\t\"\n-            \"jne,s   normal\\n\\t\"\n-            \"xorl    rdx, rdx\\n\\t\"\n-            \"cmpl    $div, -1\\n\\t\"\n-            \"je,s    done\\n\"\n-    \"normal: cdql\\n\\t\"\n-            \"idivl   $div\\n\"\n-    \"done:\"        %}\n-  ins_encode(cdql_enc(div));\n-  ins_pipe(ialu_reg_reg_alu0);\n+  ins_cost(500);\n+  format %{ \"cdqq\\n\\t\"\n+            \"idivq   $div\" %}\n+  ins_encode %{\n+    __ cdqq();\n+    __ idivq($div$$Register);\n+  %}\n+  ins_pipe(pipe_slow);\n@@ -8870,1 +8751,1 @@\n-instruct modL_rReg(rdx_RegL rdx, rax_RegL rax, no_rax_rdx_RegL div,\n+instruct modL_mem(rdx_RegL rdx, rax_RegL rax, memory div,\n@@ -8873,1 +8754,1 @@\n-  match(Set rdx (ModL rax div));\n+  match(Set rdx (NoOvfModL rax (LoadL div)));\n@@ -8876,12 +8757,8 @@\n-  ins_cost(300); \/\/ XXX\n-  format %{ \"movq    rdx, 0x8000000000000000\\t# lrem\\n\\t\"\n-            \"cmpq    rax, rdx\\n\\t\"\n-            \"jne,s   normal\\n\\t\"\n-            \"xorl    rdx, rdx\\n\\t\"\n-            \"cmpq    $div, -1\\n\\t\"\n-            \"je,s    done\\n\"\n-    \"normal: cdqq\\n\\t\"\n-            \"idivq   $div\\n\"\n-    \"done:\"        %}\n-  ins_encode(cdqq_enc(div));\n-  ins_pipe(ialu_reg_reg_alu0);\n+  ins_cost(575);\n+  format %{ \"cdqq\\n\\t\"\n+            \"idivq   $div\" %}\n+  ins_encode %{\n+    __ cdqq();\n+    __ idivq($div$$Address);\n+  %}\n+  ins_pipe(pipe_slow);\n@@ -13401,1 +13278,1 @@\n-\/\/   \/\/ increment preceeded by register-register move\n+\/\/   \/\/ increment preceded by register-register move\n","filename":"src\/hotspot\/cpu\/x86\/x86_64.ad","additions":128,"deletions":251,"binary":false,"changes":379,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n-\/\/ This file specializes the assember with interpreter-specific macros\n+\/\/ This file specializes the assembler with interpreter-specific macros\n","filename":"src\/hotspot\/cpu\/zero\/interp_masm_zero.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -117,1 +117,1 @@\n-\/\/ to accomodate this.\n+\/\/ to accommodate this.\n","filename":"src\/hotspot\/cpu\/zero\/interpreterRT_zero.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,1 @@\n-  \/\/ machine-dependent implemention for register maps\n+  \/\/ machine-dependent implementation for register maps\n","filename":"src\/hotspot\/cpu\/zero\/registerMap_zero.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -622,0 +622,2 @@\n+    default:\n+      ;\n@@ -790,1 +792,1 @@\n-  \/\/ Adjust the caller's stack frame to accomodate any additional\n+  \/\/ Adjust the caller's stack frame to accommodate any additional\n","filename":"src\/hotspot\/cpu\/zero\/zeroInterpreter_zero.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -309,1 +309,1 @@\n-        \/\/ check for protocol mis-match\n+        \/\/ check for protocol mismatch\n","filename":"src\/hotspot\/os\/aix\/attachListener_aix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -112,2 +112,2 @@\n-  u_longlong_t readch;                  \/* number of characters tranferred with read system call *\/\n-  u_longlong_t writech;                 \/* number of characters tranferred with write system call *\/\n+  u_longlong_t readch;                  \/* number of characters transferred with read system call *\/\n+  u_longlong_t writech;                 \/* number of characters transferred with write system call *\/\n@@ -191,2 +191,2 @@\n-  u_longlong_t readch;                  \/* number of characters tranferred with read system call *\/\n-  u_longlong_t writech;                 \/* number of characters tranferred with write system call *\/\n+  u_longlong_t readch;                  \/* number of characters transferred with read system call *\/\n+  u_longlong_t writech;                 \/* number of characters transferred with write system call *\/\n@@ -275,2 +275,2 @@\n-  u_longlong_t readch;                  \/* number of characters tranferred with read system call *\/\n-  u_longlong_t writech;                 \/* number of characters tranferred with write system call *\/\n+  u_longlong_t readch;                  \/* number of characters transferred with read system call *\/\n+  u_longlong_t writech;                 \/* number of characters transferred with write system call *\/\n@@ -363,2 +363,2 @@\n-  u_longlong_t readch;      \/* number of characters tranferred with read system call *\/\n-  u_longlong_t writech;     \/* number of characters tranferred with write system call *\/\n+  u_longlong_t readch;      \/* number of characters transferred with read system call *\/\n+  u_longlong_t writech;     \/* number of characters transferred with write system call *\/\n@@ -574,1 +574,1 @@\n-  int max_cpus;                         \/* maximum number of virtual CPUs this parition can ever have *\/\n+  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n@@ -598,1 +598,1 @@\n-  u_longlong_t reserved_pages;          \/* Currenlty number of 16GB pages. Cannot participate in DR operations *\/\n+  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n@@ -609,1 +609,1 @@\n-  int max_cpus;                         \/* maximum number of virtual CPUs this parition can ever have *\/\n+  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n@@ -633,1 +633,1 @@\n-  u_longlong_t reserved_pages;          \/* Currenlty number of 16GB pages. Cannot participate in DR operations *\/\n+  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n@@ -668,1 +668,1 @@\n-  int max_cpus;                         \/* maximum number of virtual CPUs this parition can ever have *\/\n+  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n@@ -692,1 +692,1 @@\n-  u_longlong_t reserved_pages;          \/* Currenlty number of 16GB pages. Cannot participate in DR operations *\/\n+  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n@@ -734,1 +734,1 @@\n-  int max_cpus;                         \/* maximum number of virtual CPUs this parition can ever have *\/\n+  int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n@@ -758,1 +758,1 @@\n-  u_longlong_t reserved_pages;          \/* Currenlty number of 16GB pages. Cannot participate in DR operations *\/\n+  u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n@@ -813,1 +813,1 @@\n-        int max_cpus;                         \/* maximum number of virtual CPUs this parition can ever have *\/\n+        int max_cpus;                         \/* maximum number of virtual CPUs this partition can ever have *\/\n@@ -837,1 +837,1 @@\n-        u_longlong_t reserved_pages;          \/* Currenlty number of 16GB pages. Cannot participate in DR operations *\/\n+        u_longlong_t reserved_pages;          \/* Currently number of 16GB pages. Cannot participate in DR operations *\/\n@@ -1037,1 +1037,1 @@\n-  \/\/ information about partition, cpu and wpars, respectivly. They can be used without\n+  \/\/ information about partition, cpu and wpars, respectively. They can be used without\n","filename":"src\/hotspot\/os\/aix\/libperfstat_aix.hpp","additions":20,"deletions":20,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -1985,1 +1985,1 @@\n-  \/\/ This means if the memory was allocated using shmget\/shmat, protection wont work\n+  \/\/ This means if the memory was allocated using shmget\/shmat, protection won't work\n@@ -2341,1 +2341,1 @@\n-  \/\/ Now initialze basic system properties. Note that for some of the values we\n+  \/\/ Now initialize basic system properties. Note that for some of the values we\n@@ -2606,29 +2606,0 @@\n-\/\/ This code originates from JDK's sysAvailable\n-\/\/ from src\/solaris\/hpi\/src\/native_threads\/src\/sys_api_td.c\n-\n-int os::available(int fd, jlong *bytes) {\n-  jlong cur, end;\n-  int mode;\n-  struct stat64 buf64;\n-\n-  if (::fstat64(fd, &buf64) >= 0) {\n-    mode = buf64.st_mode;\n-    if (S_ISCHR(mode) || S_ISFIFO(mode) || S_ISSOCK(mode)) {\n-      int n;\n-      if (::ioctl(fd, FIONREAD, &n) >= 0) {\n-        *bytes = n;\n-        return 1;\n-      }\n-    }\n-  }\n-  if ((cur = ::lseek64(fd, 0L, SEEK_CUR)) == -1) {\n-    return 0;\n-  } else if ((end = ::lseek64(fd, 0L, SEEK_END)) == -1) {\n-    return 0;\n-  } else if (::lseek64(fd, cur, SEEK_SET) == -1) {\n-    return 0;\n-  }\n-  *bytes = end - cur;\n-  return 1;\n-}\n-\n@@ -2927,1 +2898,1 @@\n-  \/\/ Warn explicity if EXTSHM=ON is used. That switch changes how\n+  \/\/ Warn explicitly if EXTSHM=ON is used. That switch changes how\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":3,"deletions":32,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,1 +39,1 @@\n-\/\/ before guarding them. Answer for AIX is definitly no, because memory\n+\/\/ before guarding them. Answer for AIX is definitely no, because memory\n","filename":"src\/hotspot\/os\/aix\/os_aix.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-\/\/ Unfortunately, the interface of dladdr makes the implementator\n+\/\/ Unfortunately, the interface of dladdr makes the implementer\n@@ -327,1 +327,1 @@\n-  \/\/ the entry of a function and a pointer to the function decriptor.\n+  \/\/ the entry of a function and a pointer to the function descriptor.\n@@ -680,1 +680,1 @@\n-  \/\/      |  unsused   |\n+  \/\/      |  unused    |\n","filename":"src\/hotspot\/os\/aix\/porting_aix.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n-\/\/ This function tries to mimick dladdr(3) on Linux\n+\/\/ This function tries to mimic dladdr(3) on Linux\n","filename":"src\/hotspot\/os\/aix\/porting_aix.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -288,1 +288,1 @@\n-        \/\/ check for protocol mis-match\n+        \/\/ check for protocol mismatch\n","filename":"src\/hotspot\/os\/bsd\/attachListener_bsd.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -364,1 +364,1 @@\n-  \/\/ is set in the launcher. This was to accomodate linking restrictions\n+  \/\/ is set in the launcher. This was to accommodate linking restrictions\n@@ -445,1 +445,1 @@\n-  \/\/ is set in the launcher. This was to accomodate linking restrictions\n+  \/\/ is set in the launcher. This was to accommodate linking restrictions\n@@ -1134,1 +1134,1 @@\n-  \/\/ Identify compatability class for VM's architecture and library's architecture\n+  \/\/ Identify compatibility class for VM's architecture and library's architecture\n@@ -2311,29 +2311,0 @@\n-\/\/ This code originates from JDK's sysAvailable\n-\/\/ from src\/solaris\/hpi\/src\/native_threads\/src\/sys_api_td.c\n-\n-int os::available(int fd, jlong *bytes) {\n-  jlong cur, end;\n-  int mode;\n-  struct stat buf;\n-\n-  if (::fstat(fd, &buf) >= 0) {\n-    mode = buf.st_mode;\n-    if (S_ISCHR(mode) || S_ISFIFO(mode) || S_ISSOCK(mode)) {\n-      int n;\n-      if (::ioctl(fd, FIONREAD, &n) >= 0) {\n-        *bytes = n;\n-        return 1;\n-      }\n-    }\n-  }\n-  if ((cur = ::lseek(fd, 0L, SEEK_CUR)) == -1) {\n-    return 0;\n-  } else if ((end = ::lseek(fd, 0L, SEEK_END)) == -1) {\n-    return 0;\n-  } else if (::lseek(fd, cur, SEEK_SET) == -1) {\n-    return 0;\n-  }\n-  *bytes = end - cur;\n-  return 1;\n-}\n-\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":4,"deletions":33,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -87,1 +87,1 @@\n-    \/\/ reduce the timout and try again\n+    \/\/ reduce the timeout and try again\n","filename":"src\/hotspot\/os\/bsd\/semaphore_bsd.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -288,1 +288,1 @@\n-        \/\/ check for protocol mis-match\n+        \/\/ check for protocol mismatch\n","filename":"src\/hotspot\/os\/linux\/attachListener_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -127,1 +127,1 @@\n- * Return the amount of used memory used by this cgroup and decendents\n+ * Return the amount of used memory used by this cgroup and descendents\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -454,1 +454,1 @@\n-  \/\/ is set in the launcher. This was to accomodate linking restrictions\n+  \/\/ is set in the launcher. This was to accommodate linking restrictions\n@@ -814,1 +814,1 @@\n-  \/\/ stack_size by the size of the guard pages to mimick proper\n+  \/\/ stack_size by the size of the guard pages to mimic proper\n@@ -1631,1 +1631,5 @@\n-    {EM_RISCV,       EM_RISCV,   ELFCLASS64, ELFDATA2LSB, (char*)\"RISC-V\"},\n+#ifdef _LP64\n+    {EM_RISCV,       EM_RISCV,   ELFCLASS64, ELFDATA2LSB, (char*)\"RISCV64\"},\n+#else\n+    {EM_RISCV,       EM_RISCV,   ELFCLASS32, ELFDATA2LSB, (char*)\"RISCV32\"},\n+#endif\n@@ -2188,0 +2192,13 @@\n+static void print_container_helper(outputStream* st, jlong j, const char* metrics) {\n+  st->print(\"%s: \", metrics);\n+  if (j > 0) {\n+    if (j >= 1024) {\n+      st->print_cr(UINT64_FORMAT \" k\", uint64_t(j) \/ 1024);\n+    } else {\n+      st->print_cr(UINT64_FORMAT, uint64_t(j));\n+    }\n+  } else {\n+    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n+  }\n+}\n+\n@@ -2243,31 +2260,5 @@\n-  jlong j = OSContainer::memory_limit_in_bytes();\n-  st->print(\"memory_limit_in_bytes: \");\n-  if (j > 0) {\n-    st->print_cr(JLONG_FORMAT, j);\n-  } else {\n-    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n-  }\n-\n-  j = OSContainer::memory_and_swap_limit_in_bytes();\n-  st->print(\"memory_and_swap_limit_in_bytes: \");\n-  if (j > 0) {\n-    st->print_cr(JLONG_FORMAT, j);\n-  } else {\n-    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n-  }\n-\n-  j = OSContainer::memory_soft_limit_in_bytes();\n-  st->print(\"memory_soft_limit_in_bytes: \");\n-  if (j > 0) {\n-    st->print_cr(JLONG_FORMAT, j);\n-  } else {\n-    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n-  }\n-\n-  j = OSContainer::OSContainer::memory_usage_in_bytes();\n-  st->print(\"memory_usage_in_bytes: \");\n-  if (j > 0) {\n-    st->print_cr(JLONG_FORMAT, j);\n-  } else {\n-    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n-  }\n+  print_container_helper(st, OSContainer::memory_limit_in_bytes(), \"memory_limit_in_bytes\");\n+  print_container_helper(st, OSContainer::memory_and_swap_limit_in_bytes(), \"memory_and_swap_limit_in_bytes\");\n+  print_container_helper(st, OSContainer::memory_soft_limit_in_bytes(), \"memory_soft_limit_in_bytes\");\n+  print_container_helper(st, OSContainer::memory_usage_in_bytes(), \"memory_usage_in_bytes\");\n+  print_container_helper(st, OSContainer::memory_max_usage_in_bytes(), \"memory_max_usage_in_bytes\");\n@@ -2275,9 +2266,1 @@\n-  j = OSContainer::OSContainer::memory_max_usage_in_bytes();\n-  st->print(\"memory_max_usage_in_bytes: \");\n-  if (j > 0) {\n-    st->print_cr(JLONG_FORMAT, j);\n-  } else {\n-    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n-  }\n-\n-  j = OSContainer::OSContainer::pids_max();\n+  jlong j = OSContainer::pids_max();\n@@ -2291,1 +2274,1 @@\n-  j = OSContainer::OSContainer::pids_current();\n+  j = OSContainer::pids_current();\n@@ -2500,1 +2483,1 @@\n-  strncpy(cpuinfo, \"RISCV64\", length);\n+  strncpy(cpuinfo, LP64_ONLY(\"RISCV64\") NOT_LP64(\"RISCV32\"), length);\n@@ -4035,1 +4018,1 @@\n-  \/\/ will mix the type of pages used, but in a decending order.\n+  \/\/ will mix the type of pages used, but in a descending order.\n@@ -4964,29 +4947,0 @@\n-\/\/ This code originates from JDK's sysAvailable\n-\/\/ from src\/solaris\/hpi\/src\/native_threads\/src\/sys_api_td.c\n-\n-int os::available(int fd, jlong *bytes) {\n-  jlong cur, end;\n-  int mode;\n-  struct stat64 buf64;\n-\n-  if (::fstat64(fd, &buf64) >= 0) {\n-    mode = buf64.st_mode;\n-    if (S_ISCHR(mode) || S_ISFIFO(mode) || S_ISSOCK(mode)) {\n-      int n;\n-      if (::ioctl(fd, FIONREAD, &n) >= 0) {\n-        *bytes = n;\n-        return 1;\n-      }\n-    }\n-  }\n-  if ((cur = ::lseek64(fd, 0L, SEEK_CUR)) == -1) {\n-    return 0;\n-  } else if ((end = ::lseek64(fd, 0L, SEEK_END)) == -1) {\n-    return 0;\n-  } else if (::lseek64(fd, cur, SEEK_SET) == -1) {\n-    return 0;\n-  }\n-  *bytes = end - cur;\n-  return 1;\n-}\n-\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":29,"deletions":75,"binary":false,"changes":104,"status":"modified"},{"patch":"@@ -156,1 +156,1 @@\n-                     The bitmap of catched signals.\n+                     The bitmap of caught signals.\n","filename":"src\/hotspot\/os\/linux\/os_perf_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -41,0 +41,7 @@\n+\/\/ 32-bit RISC-V has no SYS_futex syscall.\n+#ifdef RISCV32\n+  #if !defined(SYS_futex) && defined(SYS_futex_time64)\n+    #define SYS_futex SYS_futex_time64\n+  #endif\n+#endif\n+\n","filename":"src\/hotspot\/os\/linux\/waitBarrier_linux.cpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -1095,1 +1095,1 @@\n-      \/\/ Throw a stack overflow exception.  Guard pages will be reenabled\n+      \/\/ Throw a stack overflow exception.  Guard pages will be re-enabled\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -698,1 +698,1 @@\n-  \/\/ won't try to handle this situation. even if accidentially or\n+  \/\/ won't try to handle this situation. even if accidentally or\n","filename":"src\/hotspot\/os\/posix\/perfMemory_posix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -404,1 +404,1 @@\n-      \/\/ automaticlly block the signal\n+      \/\/ automatically block the signal\n","filename":"src\/hotspot\/os\/posix\/signals_posix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,1 @@\n-  \/\/  occurr during error reporting itself.\n+  \/\/  occur during error reporting itself.\n","filename":"src\/hotspot\/os\/posix\/vmError_posix.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -196,1 +196,1 @@\n-  \/\/ check that all paramteres to the operation\n+  \/\/ check that all parameters to the operation\n","filename":"src\/hotspot\/os\/windows\/attachListener_windows.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,1 +94,1 @@\n-  \/\/  1) When commiting memory for the created paging file\n+  \/\/  1) When committing memory for the created paging file\n","filename":"src\/hotspot\/os\/windows\/gc\/z\/zMapper_windows.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -128,1 +128,1 @@\n-\/\/ 2) It requires memory locking privilages, even for small pages. This\n+\/\/ 2) It requires memory locking privileges, even for small pages. This\n","filename":"src\/hotspot\/os\/windows\/gc\/z\/zPhysicalMemoryBacking_windows.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,1 @@\n-  \/\/ The 'A' at the end means the ANSI (not the UNICODE) vesions of the methods\n+  \/\/ The 'A' at the end means the ANSI (not the UNICODE) versions of the methods\n","filename":"src\/hotspot\/os\/windows\/iphlp_interface.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4309,1 +4309,1 @@\n-  \/\/ Calculate theoretical max. size of Threads to guard gainst artifical\n+  \/\/ Calculate theoretical max. size of Threads to guard gainst artificial\n@@ -4658,1 +4658,1 @@\n-  \/\/ This code is copy from clasic VM -> hpi::sysThreadCPUTime\n+  \/\/ This code is copy from classic VM -> hpi::sysThreadCPUTime\n@@ -4704,1 +4704,1 @@\n-\/\/ Windows does't provide a loadavg primitive so this is stubbed out for now.\n+\/\/ Windows doesn't provide a loadavg primitive so this is stubbed out for now.\n@@ -4995,37 +4995,0 @@\n-static int nonSeekAvailable(int, long *);\n-static int stdinAvailable(int, long *);\n-\n-\/\/ This code is a copy of JDK's sysAvailable\n-\/\/ from src\/windows\/hpi\/src\/sys_api_md.c\n-\n-int os::available(int fd, jlong *bytes) {\n-  jlong cur, end;\n-  struct _stati64 stbuf64;\n-\n-  if (::_fstati64(fd, &stbuf64) >= 0) {\n-    int mode = stbuf64.st_mode;\n-    if (S_ISCHR(mode) || S_ISFIFO(mode)) {\n-      int ret;\n-      long lpbytes;\n-      if (fd == 0) {\n-        ret = stdinAvailable(fd, &lpbytes);\n-      } else {\n-        ret = nonSeekAvailable(fd, &lpbytes);\n-      }\n-      (*bytes) = (jlong)(lpbytes);\n-      return ret;\n-    }\n-    if ((cur = ::_lseeki64(fd, 0L, SEEK_CUR)) == -1) {\n-      return FALSE;\n-    } else if ((end = ::_lseeki64(fd, 0L, SEEK_END)) == -1) {\n-      return FALSE;\n-    } else if (::_lseeki64(fd, cur, SEEK_SET) == -1) {\n-      return FALSE;\n-    }\n-    *bytes = end - cur;\n-    return TRUE;\n-  } else {\n-    return FALSE;\n-  }\n-}\n-\n@@ -5040,94 +5003,0 @@\n-\/\/ This code is a copy of JDK's nonSeekAvailable\n-\/\/ from src\/windows\/hpi\/src\/sys_api_md.c\n-\n-static int nonSeekAvailable(int fd, long *pbytes) {\n-  \/\/ This is used for available on non-seekable devices\n-  \/\/ (like both named and anonymous pipes, such as pipes\n-  \/\/  connected to an exec'd process).\n-  \/\/ Standard Input is a special case.\n-  HANDLE han;\n-\n-  if ((han = (HANDLE) ::_get_osfhandle(fd)) == (HANDLE)(-1)) {\n-    return FALSE;\n-  }\n-\n-  if (! ::PeekNamedPipe(han, NULL, 0, NULL, (LPDWORD)pbytes, NULL)) {\n-    \/\/ PeekNamedPipe fails when at EOF.  In that case we\n-    \/\/ simply make *pbytes = 0 which is consistent with the\n-    \/\/ behavior we get on Solaris when an fd is at EOF.\n-    \/\/ The only alternative is to raise an Exception,\n-    \/\/ which isn't really warranted.\n-    \/\/\n-    if (::GetLastError() != ERROR_BROKEN_PIPE) {\n-      return FALSE;\n-    }\n-    *pbytes = 0;\n-  }\n-  return TRUE;\n-}\n-\n-#define MAX_INPUT_EVENTS 2000\n-\n-\/\/ This code is a copy of JDK's stdinAvailable\n-\/\/ from src\/windows\/hpi\/src\/sys_api_md.c\n-\n-static int stdinAvailable(int fd, long *pbytes) {\n-  HANDLE han;\n-  DWORD numEventsRead = 0;  \/\/ Number of events read from buffer\n-  DWORD numEvents = 0;      \/\/ Number of events in buffer\n-  DWORD i = 0;              \/\/ Loop index\n-  DWORD curLength = 0;      \/\/ Position marker\n-  DWORD actualLength = 0;   \/\/ Number of bytes readable\n-  BOOL error = FALSE;       \/\/ Error holder\n-  INPUT_RECORD *lpBuffer;   \/\/ Pointer to records of input events\n-\n-  if ((han = ::GetStdHandle(STD_INPUT_HANDLE)) == INVALID_HANDLE_VALUE) {\n-    return FALSE;\n-  }\n-\n-  \/\/ Construct an array of input records in the console buffer\n-  error = ::GetNumberOfConsoleInputEvents(han, &numEvents);\n-  if (error == 0) {\n-    return nonSeekAvailable(fd, pbytes);\n-  }\n-\n-  \/\/ lpBuffer must fit into 64K or else PeekConsoleInput fails\n-  if (numEvents > MAX_INPUT_EVENTS) {\n-    numEvents = MAX_INPUT_EVENTS;\n-  }\n-\n-  lpBuffer = (INPUT_RECORD *)os::malloc(numEvents * sizeof(INPUT_RECORD), mtInternal);\n-  if (lpBuffer == NULL) {\n-    return FALSE;\n-  }\n-\n-  error = ::PeekConsoleInput(han, lpBuffer, numEvents, &numEventsRead);\n-  if (error == 0) {\n-    os::free(lpBuffer);\n-    return FALSE;\n-  }\n-\n-  \/\/ Examine input records for the number of bytes available\n-  for (i=0; i<numEvents; i++) {\n-    if (lpBuffer[i].EventType == KEY_EVENT) {\n-\n-      KEY_EVENT_RECORD *keyRecord = (KEY_EVENT_RECORD *)\n-                                      &(lpBuffer[i].Event);\n-      if (keyRecord->bKeyDown == TRUE) {\n-        CHAR *keyPressed = (CHAR *) &(keyRecord->uChar);\n-        curLength++;\n-        if (*keyPressed == '\\r') {\n-          actualLength = curLength;\n-        }\n-      }\n-    }\n-  }\n-\n-  if (lpBuffer != NULL) {\n-    os::free(lpBuffer);\n-  }\n-\n-  *pbytes = (long) actualLength;\n-  return TRUE;\n-}\n-\n@@ -5270,1 +5139,1 @@\n-  \/\/ The following flags should match the 'exec_access' flages used for\n+  \/\/ The following flags should match the 'exec_access' flags used for\n@@ -5490,1 +5359,1 @@\n-  \/\/ If we encounter a nearly simultanous timeout expiry and unpark()\n+  \/\/ If we encounter a nearly simultaneous timeout expiry and unpark()\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":5,"deletions":136,"binary":false,"changes":141,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -128,1 +128,1 @@\n-  \/\/ A wrapper to install a structured exception handler for fast JNI accesors.\n+  \/\/ A wrapper to install a structured exception handler for fast JNI accessors.\n","filename":"src\/hotspot\/os\/windows\/os_windows.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -63,1 +63,1 @@\n-  \/\/ The 'A' at the end means the ANSI (not the UNICODE) vesions of the methods\n+  \/\/ The 'A' at the end means the ANSI (not the UNICODE) versions of the methods\n","filename":"src\/hotspot\/os\/windows\/pdh_interface.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -146,1 +146,1 @@\n-\/\/ use of SMB network based file systems may result in unsuccesful cleanup\n+\/\/ use of SMB network based file systems may result in unsuccessful cleanup\n@@ -148,1 +148,1 @@\n-\/\/ environement variables, as used by the GetTempPath() Win32 API (see\n+\/\/ environment variables, as used by the GetTempPath() Win32 API (see\n@@ -1549,1 +1549,1 @@\n-  \/\/ the sharable aspects of performance counters was abandonded\n+  \/\/ the shareable aspects of performance counters was abandoned\n","filename":"src\/hotspot\/os\/windows\/perfMemory_windows.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n-  \/\/ Last_Java_pc ist not set, if we come here from compiled code.\n+  \/\/ Last_Java_pc is not set, if we come here from compiled code.\n","filename":"src\/hotspot\/os_cpu\/aix_ppc\/thread_aix_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -77,1 +77,1 @@\n-  _icache_line_size = 16; \/\/ minimal line lenght CCSIDR_EL1 can hold\n+  _icache_line_size = 16; \/\/ minimal line length CCSIDR_EL1 can hold\n","filename":"src\/hotspot\/os_cpu\/bsd_aarch64\/vm_version_bsd_aarch64.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -83,0 +83,4 @@\n+#ifndef HWCAP2_SVEBITPERM\n+#define HWCAP2_SVEBITPERM (1 << 4)\n+#endif\n+\n@@ -90,1 +94,1 @@\n-  assert(_features & CPU_SVE, \"should not call this\");\n+  assert(VM_Version::supports_sve(), \"should not call this\");\n@@ -95,1 +99,1 @@\n-  assert(_features & CPU_SVE, \"should not call this\");\n+  assert(VM_Version::supports_sve(), \"should not call this\");\n@@ -136,0 +140,1 @@\n+  if (auxv2 & HWCAP2_SVEBITPERM) _features |= CPU_SVEBITPERM;\n","filename":"src\/hotspot\/os_cpu\/linux_aarch64\/vm_version_linux_aarch64.cpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-    \/\/  r0 = oldval, r1 = newval, r2 = ptr, lr = return adress\n+    \/\/  r0 = oldval, r1 = newval, r2 = ptr, lr = return address\n@@ -184,1 +184,1 @@\n-    \/\/  r0 = oldval, r1 = newval, r2 = ptr, lr = return adress\n+    \/\/  r0 = oldval, r1 = newval, r2 = ptr, lr = return address\n@@ -273,1 +273,1 @@\n-    \/\/  r2 = ptr, lr = return adress\n+    \/\/  r2 = ptr, lr = return address\n","filename":"src\/hotspot\/os_cpu\/linux_arm\/macroAssembler_linux_arm_32.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -276,1 +276,1 @@\n-            \/\/ Throw a stack overflow exception.  Guard pages will be reenabled\n+            \/\/ Throw a stack overflow exception.  Guard pages will be re-enabled\n","filename":"src\/hotspot\/os_cpu\/linux_arm\/os_linux_arm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -222,2 +222,2 @@\n-      \/\/ and causing a \"Data Storage Interrupt\", so we inspect the intruction\n-      \/\/ in order to extract the faulty data addresss.\n+      \/\/ and causing a \"Data Storage Interrupt\", so we inspect the instruction\n+      \/\/ in order to extract the faulty data address.\n","filename":"src\/hotspot\/os_cpu\/linux_ppc\/os_linux_ppc.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-  \/\/ Last_Java_pc ist not set, if we come here from compiled code.\n+  \/\/ Last_Java_pc is not set, if we come here from compiled code.\n","filename":"src\/hotspot\/os_cpu\/linux_ppc\/thread_linux_ppc.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -37,1 +37,1 @@\n-  \/\/ Last_Java_pc ist not set if we come here from compiled code.\n+  \/\/ Last_Java_pc is not set if we come here from compiled code.\n","filename":"src\/hotspot\/os_cpu\/linux_s390\/thread_linux_s390.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-    \/\/ execption pointer that FS:[0] points to.  This get_thread\n+    \/\/ exception pointer that FS:[0] points to.  This get_thread\n@@ -97,1 +97,1 @@\n-    \/\/ Verify that the offset hasn't changed since we initally captured\n+    \/\/ Verify that the offset hasn't changed since we initially captured\n","filename":"src\/hotspot\/os_cpu\/windows_x86\/os_windows_x86.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 1997, 2015, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -142,1 +142,1 @@\n-\t\tc. Comments must be preceeded by whitespace\n+\t\tc. Comments must be preceded by whitespace\n","filename":"src\/hotspot\/share\/adlc\/Doc\/Syntax.doc","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -244,1 +244,1 @@\n-    else {  \/\/ Done with staticly defined parts of instruction definition\n+    else {  \/\/ Done with statically defined parts of instruction definition\n@@ -925,1 +925,1 @@\n-  \/\/ (2) replacement\/substitution variable, preceeded by a '$'\n+  \/\/ (2) replacement\/substitution variable, preceded by a '$'\n@@ -1561,1 +1561,1 @@\n-    else {  \/\/ Done with staticly defined parts of instruction definition\n+    else {  \/\/ Done with statically defined parts of instruction definition\n@@ -2866,1 +2866,1 @@\n-  \/\/ (2) replacement\/substitution variable, preceeded by a '$'\n+  \/\/ (2) replacement\/substitution variable, preceded by a '$'\n@@ -3332,1 +3332,1 @@\n-  \/\/ (2) replacement\/substitution variable, preceeded by a '$'\n+  \/\/ (2) replacement\/substitution variable, preceded by a '$'\n@@ -3821,1 +3821,1 @@\n-      \/\/ (2) replacement\/substitution variable, preceeded by a '$'\n+      \/\/ (2) replacement\/substitution variable, preceded by a '$'\n@@ -3958,1 +3958,1 @@\n-          \/\/ (2) replacement\/substitution variable, preceeded by a '$'\n+          \/\/ (2) replacement\/substitution variable, preceded by a '$'\n","filename":"src\/hotspot\/share\/adlc\/adlparse.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -89,2 +89,2 @@\n-  void ins_attr_parse(void);    \/\/ Parse instruction attrubute definitions\n-  void op_attr_parse(void);     \/\/ Parse operand attrubute definitions\n+  void ins_attr_parse(void);    \/\/ Parse instruction attribute definitions\n+  void op_attr_parse(void);     \/\/ Parse operand attribute definitions\n","filename":"src\/hotspot\/share\/adlc\/adlparse.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-\/\/ Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+\/\/ Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -448,1 +448,1 @@\n-    \/\/ Regardles of whether the first matchrule is a chain rule, check the list\n+    \/\/ Regardless of whether the first matchrule is a chain rule, check the list\n@@ -714,1 +714,1 @@\n-\/\/ Load the kewords into the global name table\n+\/\/ Load the keywords into the global name table\n","filename":"src\/hotspot\/share\/adlc\/archDesc.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -173,2 +173,2 @@\n-  ADLFILE  _CPP_file;          \/\/ File for ArchNode class defintions\n-  ADLFILE  _CPP_CLONE_file;    \/\/ File for MachNode\/Oper clone defintions\n+  ADLFILE  _CPP_file;          \/\/ File for ArchNode class definitions\n+  ADLFILE  _CPP_CLONE_file;    \/\/ File for MachNode\/Oper clone definitions\n@@ -176,1 +176,1 @@\n-  ADLFILE  _CPP_FORMAT_file;   \/\/ File for MachNode\/Oper format defintions\n+  ADLFILE  _CPP_FORMAT_file;   \/\/ File for MachNode\/Oper format definitions\n@@ -180,1 +180,1 @@\n-  ADLFILE  _CPP_PIPELINE_file; \/\/ File for MachNode pipeline defintions\n+  ADLFILE  _CPP_PIPELINE_file; \/\/ File for MachNode pipeline definitions\n@@ -268,1 +268,1 @@\n-  \/\/ Generate Regsiter Size Array\n+  \/\/ Generate Register Size Array\n","filename":"src\/hotspot\/share\/adlc\/archDesc.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -74,1 +74,1 @@\n-  \/\/ cmpstr does string comparisions.  hashstr computes a key.\n+  \/\/ cmpstr does string comparisons.  hashstr computes a key.\n","filename":"src\/hotspot\/share\/adlc\/dfa.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n-  \/\/ cmp is a key comparision routine.  hash is a routine to hash a key.\n+  \/\/ cmp is a key comparison routine.  hash is a routine to hash a key.\n","filename":"src\/hotspot\/share\/adlc\/dict2.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -98,1 +98,1 @@\n-  \/\/ cmp is a key comparision routine.  hash is a routine to hash a key.\n+  \/\/ cmp is a key comparison routine.  hash is a routine to hash a key.\n@@ -575,1 +575,1 @@\n-  \/\/ cmp is a key comparision routine.  hash is a routine to hash a key.\n+  \/\/ cmp is a key comparison routine.  hash is a routine to hash a key.\n","filename":"src\/hotspot\/share\/adlc\/forms.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1352,1 +1352,1 @@\n-\/\/ Seach through operands to determine parameters unique positions.\n+\/\/ Search through operands to determine parameters unique positions.\n","filename":"src\/hotspot\/share\/adlc\/formssel.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -279,1 +279,1 @@\n-  \/\/ Seach through operands to determine operands unique positions.\n+  \/\/ Search through operands to determine operands unique positions.\n@@ -437,1 +437,1 @@\n-  \/\/ The parameters for each encoding are preceeded by a NameList::_signal\n+  \/\/ The parameters for each encoding are preceded by a NameList::_signal\n","filename":"src\/hotspot\/share\/adlc\/formssel.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -229,0 +229,1 @@\n+  AD.addInclude(AD._CPP_file, \"opto\/parse.hpp\");\n@@ -350,1 +351,1 @@\n-  printf(\" q  quiet mode, supresses all non-essential messages\\n\");\n+  printf(\" q  quiet mode, suppresses all non-essential messages\\n\");\n","filename":"src\/hotspot\/share\/adlc\/main.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1447,1 +1447,1 @@\n-        \/\/ operand which might be assiged to multiple registers.\n+        \/\/ operand which might be assigned to multiple registers.\n@@ -1651,1 +1651,1 @@\n-        !instr->is_mach_constant()) {  \/\/ These inherit the funcion from MachConstantNode.\n+        !instr->is_mach_constant()) {  \/\/ These inherit the function from MachConstantNode.\n@@ -2074,1 +2074,1 @@\n-\/\/ that indicate cost and a successfull rule match.\n+\/\/ that indicate cost and a successful rule match.\n","filename":"src\/hotspot\/share\/adlc\/output_h.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-\/\/  x =  ABI area (SPARC) or  return adress and link (i486)\n+\/\/  x =  ABI area (SPARC) or  return address and link (i486)\n","filename":"src\/hotspot\/share\/c1\/c1_FrameMap.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -2654,1 +2654,1 @@\n-    \/\/ sucessfully simplified phi function\n+    \/\/ successfully simplified phi function\n","filename":"src\/hotspot\/share\/c1\/c1_GraphBuilder.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -467,1 +467,1 @@\n-  ResourceBitMap _dominator_blocks; \/\/ temproary BitMap used for computation of dominator\n+  ResourceBitMap _dominator_blocks; \/\/ temporary BitMap used for computation of dominator\n@@ -692,1 +692,1 @@\n-\/\/ all other loop blocks = loops with mulitple entries).\n+\/\/ all other loop blocks = loops with multiple entries).\n@@ -825,1 +825,1 @@\n-  \/\/ this is necessery for the (very rare) case that two successing blocks have\n+  \/\/ this is necessary for the (very rare) case that two successive blocks have\n@@ -834,1 +834,1 @@\n-  \/\/ critical edge split blocks are prefered because than they have a bigger\n+  \/\/ critical edge split blocks are preferred because than they have a bigger\n@@ -931,1 +931,1 @@\n-    assert(osr_entry->sux_at(0)->number_of_preds() >= 2, \"sucessor of osr entry must have two predecessors (otherwise it is not present in normal control flow\");\n+    assert(osr_entry->sux_at(0)->number_of_preds() >= 2, \"successor of osr entry must have two predecessors (otherwise it is not present in normal control flow\");\n@@ -1139,1 +1139,1 @@\n-        assert(cur->loop_index() == sux->loop_index() || sux->is_set(BlockBegin::linear_scan_loop_header_flag), \"successing blocks with same loop depth must have same loop index\");\n+        assert(cur->loop_index() == sux->loop_index() || sux->is_set(BlockBegin::linear_scan_loop_header_flag), \"successive blocks with same loop depth must have same loop index\");\n@@ -1151,1 +1151,1 @@\n-        assert(cur->loop_index() == pred->loop_index() || cur->is_set(BlockBegin::linear_scan_loop_header_flag), \"successing blocks with same loop depth must have same loop index\");\n+        assert(cur->loop_index() == pred->loop_index() || cur->is_set(BlockBegin::linear_scan_loop_header_flag), \"successive blocks with same loop depth must have same loop index\");\n","filename":"src\/hotspot\/share\/c1\/c1_IR.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -368,1 +368,1 @@\n-\/\/ Implementation of Contant\n+\/\/ Implementation of Constant\n@@ -776,1 +776,1 @@\n-    TRACE_PHI(tty->print_cr(\"exisiting state found\"));\n+    TRACE_PHI(tty->print_cr(\"existing state found\"));\n","filename":"src\/hotspot\/share\/c1\/c1_Instruction.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -282,1 +282,1 @@\n-  int          _use_count;                       \/\/ the number of instructions refering to this value (w\/o prev\/next); only roots can have use count = 0 or > 1\n+  int          _use_count;                       \/\/ the number of instructions referring to this value (w\/o prev\/next); only roots can have use count = 0 or > 1\n","filename":"src\/hotspot\/share\/c1\/c1_Instruction.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -633,1 +633,1 @@\n-  \/\/ Platform dependant.\n+  \/\/ Platform dependent.\n@@ -779,1 +779,1 @@\n-  \/\/ the index is platform independent; a double stack useing indeces 2 and 3 has always\n+  \/\/ the index is platform independent; a double stack using indices 2 and 3 has always\n@@ -1699,1 +1699,1 @@\n-  BlockBegin*   _ublock; \/\/ if this is a float-branch, this is the unorderd block\n+  BlockBegin*   _ublock; \/\/ if this is a float-branch, this is the unordered block\n","filename":"src\/hotspot\/share\/c1\/c1_LIR.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -437,1 +437,1 @@\n-        assert(value->subst() == value, \"missed substition\");\n+        assert(value->subst() == value, \"missed substitution\");\n@@ -1571,1 +1571,1 @@\n-\/\/ ALSO reads & writes act as aquire & release, so:\n+\/\/ ALSO reads & writes act as acquire & release, so:\n","filename":"src\/hotspot\/share\/c1\/c1_LIRGenerator.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -638,1 +638,1 @@\n-           \"shouldn't use set_destroys_register with physical regsiters\");\n+           \"shouldn't use set_destroys_register with physical registers\");\n","filename":"src\/hotspot\/share\/c1\/c1_LIRGenerator.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -271,1 +271,1 @@\n-  assert(_intervals.at(reg_num) == NULL, \"overwriting exisiting interval\");\n+  assert(_intervals.at(reg_num) == NULL, \"overwriting existing interval\");\n@@ -387,1 +387,1 @@\n-\/\/ called once before asignment of register numbers\n+\/\/ called once before assignment of register numbers\n@@ -543,2 +543,2 @@\n-  assert(con == NULL || opr->is_virtual() || opr->is_constant() || opr->is_illegal(), \"asumption: Constant instructions have only constant operands\");\n-  assert(con != NULL || opr->is_virtual(), \"asumption: non-Constant instructions have only virtual operands\");\n+  assert(con == NULL || opr->is_virtual() || opr->is_constant() || opr->is_illegal(), \"assumption: Constant instructions have only constant operands\");\n+  assert(con != NULL || opr->is_virtual(), \"assumption: non-Constant instructions have only virtual operands\");\n@@ -1598,1 +1598,1 @@\n-        \/\/ the asumption that the intervals are already sorted failed,\n+        \/\/ the assumption that the intervals are already sorted failed,\n@@ -1746,1 +1746,1 @@\n-    assert(r < num_virtual_regs(), \"live information set for not exisiting interval\");\n+    assert(r < num_virtual_regs(), \"live information set for not existing interval\");\n@@ -2832,2 +2832,2 @@\n-    assert(con == NULL || opr->is_virtual() || opr->is_constant() || opr->is_illegal(), \"asumption: Constant instructions have only constant operands (or illegal if constant is optimized away)\");\n-    assert(con != NULL || opr->is_virtual(), \"asumption: non-Constant instructions have only virtual operands\");\n+    assert(con == NULL || opr->is_virtual() || opr->is_constant() || opr->is_illegal(), \"assumption: Constant instructions have only constant operands (or illegal if constant is optimized away)\");\n+    assert(con != NULL || opr->is_virtual(), \"assumption: non-Constant instructions have only virtual operands\");\n@@ -3480,1 +3480,1 @@\n-      \/\/ TKR assert(value->as_Constant() == NULL || value->is_pinned(), \"only pinned constants can be alive accross block boundaries\");\n+      \/\/ TKR assert(value->as_Constant() == NULL || value->is_pinned(), \"only pinned constants can be alive across block boundaries\");\n@@ -4005,1 +4005,1 @@\n-        \/\/ this inverval can be processed because target is free\n+        \/\/ this interval can be processed because target is free\n@@ -4255,1 +4255,1 @@\n-    assert(_register_hint->is_split_parent(), \"ony split parents are valid hint registers\");\n+    assert(_register_hint->is_split_parent(), \"only split parents are valid hint registers\");\n@@ -5168,1 +5168,1 @@\n-      \/\/ seach optimal block boundary between min_split_pos and max_split_pos\n+      \/\/ search optimal block boundary between min_split_pos and max_split_pos\n@@ -5738,1 +5738,1 @@\n-    \/\/ perform splitting and spilling for all affected intervalls\n+    \/\/ perform splitting and spilling for all affected intervals\n@@ -6250,1 +6250,1 @@\n-  assert(instructions->last()->as_OpBranch() != NULL, \"last instrcution must always be a branch\");\n+  assert(instructions->last()->as_OpBranch() != NULL, \"last instruction must always be a branch\");\n@@ -6431,1 +6431,1 @@\n-      \/\/       -> this may lead to unnecesary return instructions in the final code\n+      \/\/       -> this may lead to unnecessary return instructions in the final code\n@@ -6860,1 +6860,1 @@\n-    \/\/ is necesary to start and stop itself\n+    \/\/ is necessary to start and stop itself\n","filename":"src\/hotspot\/share\/c1\/c1_LinearScan.cpp","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -168,1 +168,1 @@\n-  \/\/ this can happen when t_block or f_block contained additonal stores to local variables\n+  \/\/ this can happen when t_block or f_block contained additional stores to local variables\n@@ -337,1 +337,1 @@\n-\/\/ This removes others' relation to block, but doesnt empty block's lists\n+\/\/ This removes others' relation to block, but doesn't empty block's lists\n","filename":"src\/hotspot\/share\/c1\/c1_Optimizer.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -981,1 +981,1 @@\n-  \/\/ Interate over current block\n+  \/\/ Iterate over current block\n","filename":"src\/hotspot\/share\/c1\/c1_RangeCheckElimination.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -552,1 +552,1 @@\n-  \/\/ Check the stack guard pages and reenable them if necessary and there is\n+  \/\/ Check the stack guard pages and re-enable them if necessary and there is\n@@ -867,1 +867,1 @@\n-\/\/ thread against the intializing thread so other threads will enter\n+\/\/ thread against the initializing thread so other threads will enter\n","filename":"src\/hotspot\/share\/c1\/c1_Runtime1.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -135,1 +135,1 @@\n-          \"Eliminate unneccessary basic blocks\")                            \\\n+          \"Eliminate unnecessary basic blocks\")                            \\\n@@ -141,1 +141,1 @@\n-          \"Eliminate unneccessary null checks\")                             \\\n+          \"Eliminate unnecessary null checks\")                             \\\n","filename":"src\/hotspot\/share\/c1\/c1_globals.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1762,1 +1762,1 @@\n-        \/\/ regions, or else it would mess up the simple comparision in MetaspaceObj::is_shared().\n+        \/\/ regions, or else it would mess up the simple comparison in MetaspaceObj::is_shared().\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -94,1 +94,1 @@\n-\/\/ Suport for mapped heap (!UseCompressedOops only)\n+\/\/ Support for mapped heap (!UseCompressedOops only)\n@@ -388,1 +388,1 @@\n-\/\/ no way of programatically handling this inside the Java code (as you would handle\n+\/\/ no way of programmatically handling this inside the Java code (as you would handle\n@@ -1259,1 +1259,1 @@\n-\/\/ refererence field and points to a non-null java object, proceed to\n+\/\/ reference field and points to a non-null java object, proceed to\n@@ -1274,1 +1274,1 @@\n-\/\/ for loading and initialzing before any object in the archived graph can\n+\/\/ for loading and initializing before any object in the archived graph can\n","filename":"src\/hotspot\/share\/cds\/heapShared.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1058,1 +1058,1 @@\n-    \/\/ archives, or else it would mess up the simple comparision in MetaspaceObj::is_shared().\n+    \/\/ archives, or else it would mess up the simple comparison in MetaspaceObj::is_shared().\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -184,1 +184,1 @@\n-  \/\/ Can we use the full archived modue graph?\n+  \/\/ Can we use the full archived module graph?\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -312,1 +312,1 @@\n-  \/\/ Get Jvmti capabilities under lock to get consistant values.\n+  \/\/ Get Jvmti capabilities under lock to get consistent values.\n@@ -1615,1 +1615,1 @@\n-      \/\/ Look for MethodHandle contant pool entries\n+      \/\/ Look for MethodHandle constant pool entries\n","filename":"src\/hotspot\/share\/ci\/ciEnv.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -337,1 +337,1 @@\n-  \/\/ Return state of appropriate compilability\n+  \/\/ Return state of appropriate compatibility\n","filename":"src\/hotspot\/share\/ci\/ciEnv.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -491,1 +491,1 @@\n-  \/\/ Also set the numer of loops and blocks in the method.\n+  \/\/ Also set the number of loops and blocks in the method.\n","filename":"src\/hotspot\/share\/ci\/ciMethodData.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1386,1 +1386,1 @@\n-    \/\/ don't allow any intializers to be run.\n+    \/\/ don't allow any initializers to be run.\n","filename":"src\/hotspot\/share\/ci\/ciReplay.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -371,1 +371,1 @@\n-      \/\/ a double or long value since it's seconf half is being overwritten.\n+      \/\/ a double or long value since its second half is being overwritten.\n","filename":"src\/hotspot\/share\/ci\/ciTypeFlow.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1649,1 +1649,1 @@\n-  \/\/ fields array is trimed. Also unused slots that were reserved\n+  \/\/ fields array is trimmed. Also unused slots that were reserved\n@@ -2036,1 +2036,1 @@\n-      if (!privileged)              break;  \/\/ only allow in priviledged code\n+      if (!privileged)              break;  \/\/ only allow in privileged code\n@@ -3947,1 +3947,1 @@\n-    \/\/ The annotations arrays below has been transfered the\n+    \/\/ The annotations arrays below has been transferred the\n@@ -4104,1 +4104,1 @@\n-   * Since field layout sneeks in oops before values, we will be able to condense\n+   * Since field layout sneaks in oops before values, we will be able to condense\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1180,1 +1180,1 @@\n-    \/\/ environemnt, including the runtime --patch-module setting.\n+    \/\/ environment, including the runtime --patch-module setting.\n@@ -1565,1 +1565,1 @@\n-  \/\/ class loader prior to loading j.l.Ojbect.\n+  \/\/ class loader prior to loading j.l.Object.\n@@ -1588,1 +1588,1 @@\n-\/\/ they could get inlined by agressive compiler, an unknown trick, see bug 6966589.\n+\/\/ they could get inlined by aggressive compiler, an unknown trick, see bug 6966589.\n","filename":"src\/hotspot\/share\/classfile\/classLoader.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -67,1 +67,1 @@\n-  \/\/ Returns a class file parsing stream if successfull.\n+  \/\/ Returns a class file parsing stream if successful.\n","filename":"src\/hotspot\/share\/classfile\/classLoader.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -122,1 +122,1 @@\n-                                 \/\/ to these class loader datas.\n+                                 \/\/ to these class loader data.\n@@ -314,1 +314,1 @@\n-  \/\/ Returns the class loader's explict name as specified during\n+  \/\/ Returns the class loader's explicit name as specified during\n","filename":"src\/hotspot\/share\/classfile\/classLoaderData.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -363,1 +363,1 @@\n-  \/\/ For non-leaf nodes (class loaders with child class loaders), do this recursivly.\n+  \/\/ For non-leaf nodes (class loaders with child class loaders), do this recursively.\n@@ -370,1 +370,1 @@\n-        \/\/ Look among the preceeding node siblings for a match.\n+        \/\/ Look among the preceding node siblings for a match.\n","filename":"src\/hotspot\/share\/classfile\/classLoaderHierarchyDCmd.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -588,1 +588,1 @@\n-\/\/ neither the class nor any of it's ancestors provide an implementaion.\n+\/\/ neither the class nor any of it's ancestors provide an implementation.\n","filename":"src\/hotspot\/share\/classfile\/defaultMethods.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,1 @@\n-\/\/ so that we dont't have to walk all dictionaries to check if any actually\n+\/\/ so that we don't have to walk all dictionaries to check if any actually\n@@ -634,1 +634,1 @@\n-  \/\/ boostrap loader\n+  \/\/ bootstrap loader\n","filename":"src\/hotspot\/share\/classfile\/dictionary.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2514,1 +2514,1 @@\n-      \/\/ This is simlar to classic VM.\n+      \/\/ This is similar to classic VM.\n@@ -3015,1 +3015,1 @@\n-  \/\/ This class is eagerly initialized during VM initialization, since we keep a refence\n+  \/\/ This class is eagerly initialized during VM initialization, since we keep a reference\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,1 +58,1 @@\n-\/\/   - a growable array containg other module entries that this module can read.\n+\/\/   - a growable array containing other module entries that this module can read.\n","filename":"src\/hotspot\/share\/classfile\/moduleEntry.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -587,2 +587,1 @@\n-void StringTable::print_table_statistics(outputStream* st,\n-                                         const char* table_name) {\n+void StringTable::print_table_statistics(outputStream* st) {\n@@ -590,1 +589,6 @@\n-  _local_table->statistics_to(Thread::current(), sz, st, table_name);\n+  _local_table->statistics_to(Thread::current(), sz, st, \"StringTable\");\n+#if INCLUDE_CDS_JAVA_HEAP\n+  if (!_shared_table.empty()) {\n+    _shared_table.print_table_statistics(st, \"Shared String Table\");\n+  }\n+#endif\n@@ -653,0 +657,26 @@\n+static void print_string(Thread* current, outputStream* st, oop s) {\n+  typeArrayOop value     = java_lang_String::value_no_keepalive(s);\n+  int          length    = java_lang_String::length(s);\n+  bool         is_latin1 = java_lang_String::is_latin1(s);\n+\n+  if (length <= 0) {\n+    st->print(\"%d: \", length);\n+  } else {\n+    ResourceMark rm(current);\n+    int utf8_length = length;\n+    char* utf8_string;\n+\n+    if (!is_latin1) {\n+      jchar* chars = value->char_at_addr(0);\n+      utf8_string = UNICODE::as_utf8(chars, utf8_length);\n+    } else {\n+      jbyte* bytes = value->byte_at_addr(0);\n+      utf8_string = UNICODE::as_utf8(bytes, utf8_length);\n+    }\n+\n+    st->print(\"%d: \", utf8_length);\n+    HashtableTextDump::put_utf8(st, utf8_string, utf8_length);\n+  }\n+  st->cr();\n+}\n+\n@@ -664,18 +694,4 @@\n-    typeArrayOop value     = java_lang_String::value_no_keepalive(s);\n-    int          length    = java_lang_String::length(s);\n-    bool         is_latin1 = java_lang_String::is_latin1(s);\n-\n-    if (length <= 0) {\n-      _st->print(\"%d: \", length);\n-    } else {\n-      ResourceMark rm(_thr);\n-      int utf8_length = length;\n-      char* utf8_string;\n-\n-      if (!is_latin1) {\n-        jchar* chars = value->char_at_addr(0);\n-        utf8_string = UNICODE::as_utf8(chars, utf8_length);\n-      } else {\n-        jbyte* bytes = value->byte_at_addr(0);\n-        utf8_string = UNICODE::as_utf8(bytes, utf8_length);\n-      }\n+    print_string(_thr, _st, s);\n+    return true;\n+  };\n+};\n@@ -683,2 +699,8 @@\n-      _st->print(\"%d: \", utf8_length);\n-      HashtableTextDump::put_utf8(_st, utf8_string, utf8_length);\n+class PrintSharedString : StackObj {\n+  Thread* _thr;\n+  outputStream* _st;\n+public:\n+  PrintSharedString(Thread* thr, outputStream* st) : _thr(thr), _st(st) {}\n+  void do_value(oop s) {\n+    if (s == NULL) {\n+      return;\n@@ -686,2 +708,1 @@\n-    _st->cr();\n-    return true;\n+    print_string(_thr, _st, s);\n@@ -693,1 +714,1 @@\n-    print_table_statistics(st, \"StringTable\");\n+    print_table_statistics(st);\n@@ -702,0 +723,9 @@\n+#if INCLUDE_CDS_JAVA_HEAP\n+    if (!_shared_table.empty()) {\n+      st->print_cr(\"#----------------\");\n+      st->print_cr(\"# Shared strings:\");\n+      st->print_cr(\"#----------------\");\n+      PrintSharedString pss(thr, st);\n+      _shared_table.iterate(&pss);\n+    }\n+#endif\n","filename":"src\/hotspot\/share\/classfile\/stringTable.cpp","additions":57,"deletions":27,"binary":false,"changes":84,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -75,1 +75,1 @@\n-  static void print_table_statistics(outputStream* st, const char* table_name);\n+  static void print_table_statistics(outputStream* st);\n","filename":"src\/hotspot\/share\/classfile\/stringTable.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -538,2 +538,1 @@\n-void SymbolTable::print_table_statistics(outputStream* st,\n-                                         const char* table_name) {\n+void SymbolTable::print_table_statistics(outputStream* st) {\n@@ -541,1 +540,9 @@\n-  _local_table->statistics_to(Thread::current(), sz, st, table_name);\n+  _local_table->statistics_to(Thread::current(), sz, st, \"SymbolTable\");\n+\n+  if (!_shared_table.empty()) {\n+    _shared_table.print_table_statistics(st, \"Shared Symbol Table\");\n+  }\n+\n+  if (!_dynamic_shared_table.empty()) {\n+    _dynamic_shared_table.print_table_statistics(st, \"Dynamic Shared Symbol Table\");\n+  }\n@@ -565,0 +572,8 @@\n+static void print_symbol(outputStream* st, Symbol* sym) {\n+  const char* utf8_string = (const char*)sym->bytes();\n+  int utf8_length = sym->utf8_length();\n+  st->print(\"%d %d: \", utf8_length, sym->refcount());\n+  HashtableTextDump::put_utf8(st, utf8_string, utf8_length);\n+  st->cr();\n+}\n+\n@@ -574,6 +589,1 @@\n-    Symbol* sym = *value;\n-    const char* utf8_string = (const char*)sym->bytes();\n-    int utf8_length = sym->utf8_length();\n-    _st->print(\"%d %d: \", utf8_length, sym->refcount());\n-    HashtableTextDump::put_utf8(_st, utf8_string, utf8_length);\n-    _st->cr();\n+    print_symbol(_st, *value);\n@@ -584,0 +594,10 @@\n+class DumpSharedSymbol : StackObj {\n+  outputStream* _st;\n+public:\n+  DumpSharedSymbol(outputStream* st) : _st(st) {}\n+  void do_value(Symbol* value) {\n+    assert(value != NULL, \"value should point to a symbol\");\n+    print_symbol(_st, value);\n+  };\n+};\n+\n@@ -586,1 +606,1 @@\n-    print_table_statistics(st, \"SymbolTable\");\n+    print_table_statistics(st);\n@@ -595,0 +615,14 @@\n+    if (!_shared_table.empty()) {\n+      st->print_cr(\"#----------------\");\n+      st->print_cr(\"# Shared symbols:\");\n+      st->print_cr(\"#----------------\");\n+      DumpSharedSymbol dss(st);\n+      _shared_table.iterate(&dss);\n+    }\n+    if (!_dynamic_shared_table.empty()) {\n+      st->print_cr(\"#------------------------\");\n+      st->print_cr(\"# Dynamic shared symbols:\");\n+      st->print_cr(\"#------------------------\");\n+      DumpSharedSymbol dss(st);\n+      _dynamic_shared_table.iterate(&dss);\n+    }\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.cpp","additions":45,"deletions":11,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -149,1 +149,1 @@\n-  static void print_table_statistics(outputStream* st, const char* table_name);\n+  static void print_table_statistics(outputStream* st);\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1665,1 +1665,1 @@\n-\/\/ that the dictionary needs to maintain a set of contraints that\n+\/\/ that the dictionary needs to maintain a set of constraints that\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -174,1 +174,1 @@\n-  \/\/ Load and check super\/interfaces, restore unsharable info\n+  \/\/ Load and check super\/interfaces, restore unshareable info\n@@ -1026,1 +1026,1 @@\n-  \/\/   - M's paramater(s) include an object type T\n+  \/\/   - M's parameter(s) include an object type T\n@@ -1108,1 +1108,1 @@\n-      return true; \/\/ for all recorded constraints added successully.\n+      return true; \/\/ for all recorded constraints added successfully.\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,1 +35,1 @@\n-  \/\/ As specifed in the JVM spec\n+  \/\/ As specified in the JVM spec\n@@ -162,1 +162,1 @@\n-      \/\/ to descriminate between oops and primitives.\n+      \/\/ to discriminate between oops and primitives.\n@@ -192,1 +192,1 @@\n-    \/\/ Since noone should call this on a query type anyway, this is ok.\n+    \/\/ Since no one should call this on a query type anyway, this is ok.\n","filename":"src\/hotspot\/share\/classfile\/verificationType.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1222,1 +1222,1 @@\n-          \/\/ 4938384: relaxed constraint in JVMS 3nd edition.\n+          \/\/ 4938384: relaxed constraint in JVMS 3rd edition.\n","filename":"src\/hotspot\/share\/classfile\/verifier.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -107,1 +107,1 @@\n-\/\/ add the declaration of the intrinsic to the approriate section of the list.\n+\/\/ add the declaration of the intrinsic to the appropriate section of the list.\n","filename":"src\/hotspot\/share\/classfile\/vmIntrinsics.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -339,0 +339,2 @@\n+  template(asFixedArity_name,                         \"asFixedArity\")                             \\\n+  template(asFixedArity_signature,                    \"()Ljava\/lang\/invoke\/MethodHandle;\")        \\\n","filename":"src\/hotspot\/share\/classfile\/vmSymbols.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -207,1 +207,1 @@\n-\/\/  Thats what the CodeHeapStat and CodeHeapStatArray are used for.\n+\/\/  That's what the CodeHeapStat and CodeHeapStatArray are used for.\n","filename":"src\/hotspot\/share\/code\/codeHeapState.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -424,1 +424,1 @@\n-  \/\/ In both of these cases the only thing being modifed is the jump\/call target and these\n+  \/\/ In both of these cases the only thing being modified is the jump\/call target and these\n","filename":"src\/hotspot\/share\/code\/compiledIC.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -169,1 +169,1 @@\n-  \/\/ Also note that concurent readers will walk through Klass* pointers that are not\n+  \/\/ Also note that concurrent readers will walk through Klass* pointers that are not\n@@ -457,1 +457,1 @@\n-    \/\/ The only exception is compiledICHolder metdata which may\n+    \/\/ The only exception is compiledICHolder metadata which may\n","filename":"src\/hotspot\/share\/code\/compiledMethod.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -313,1 +313,1 @@\n-  \/\/ serialize sender stream offest\n+  \/\/ serialize sender stream offset\n","filename":"src\/hotspot\/share\/code\/debugInfoRec.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -124,1 +124,1 @@\n-  \/\/ helper fuctions for describe_scope to enable sharing\n+  \/\/ helper functions for describe_scope to enable sharing\n","filename":"src\/hotspot\/share\/code\/debugInfoRec.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -283,1 +283,1 @@\n-    \/\/ Need acquire becase the read value could come from a concurrent insert.\n+    \/\/ Need acquire because the read value could come from a concurrent insert.\n","filename":"src\/hotspot\/share\/code\/dependencyContext.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -194,1 +194,1 @@\n-  return 0;                     \/\/ Failed to find any execption offset\n+  return 0;                     \/\/ Failed to find any exception offset\n","filename":"src\/hotspot\/share\/code\/exceptionHandlerTable.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -2878,1 +2878,1 @@\n-  \/\/ The following stati are defined\/supported:\n+  \/\/ The following status values are defined\/supported:\n","filename":"src\/hotspot\/share\/code\/nmethod.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -132,1 +132,1 @@\n-  \/\/ \"|\" describes the concatentation of bits in _oops_do_mark_link.\n+  \/\/ \"|\" describes the concatenation of bits in _oops_do_mark_link.\n@@ -335,1 +335,1 @@\n-  \/\/ Initailize fields to their default values\n+  \/\/ Initialize fields to their default values\n","filename":"src\/hotspot\/share\/code\/nmethod.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n-  \/\/ The zero index is reserved for a constant (sharable) null.\n+  \/\/ The zero index is reserved for a constant (shareable) null.\n","filename":"src\/hotspot\/share\/code\/oopRecorder.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -190,1 +190,1 @@\n-    \/\/ In either case, revert to the immediatly preceding state.\n+    \/\/ In either case, revert to the immediately preceding state.\n","filename":"src\/hotspot\/share\/code\/relocInfo.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -100,1 +100,1 @@\n-\/\/ The interpetation of this extra data depends on the relocation type.\n+\/\/ The interpretation of this extra data depends on the relocation type.\n@@ -229,1 +229,1 @@\n-\/\/ and an entry (which is sharable) in the CodeBlob's oop pool,\n+\/\/ and an entry (which is shareable) in the CodeBlob's oop pool,\n@@ -417,1 +417,1 @@\n-  \/\/ Both methods takes old_type, so it is able to performe sanity checks on the information removed.\n+  \/\/ Both methods takes old_type, so it is able to perform sanity checks on the information removed.\n@@ -806,1 +806,1 @@\n-  \/\/ ic_call_type is not always posisition dependent (depending on the state of the cache)). However, this is\n+  \/\/ ic_call_type is not always position dependent (depending on the state of the cache)). However, this is\n@@ -900,1 +900,1 @@\n-    \/\/ Assert that they don't get generated accidently!\n+    \/\/ Assert that they don't get generated accidentally!\n","filename":"src\/hotspot\/share\/code\/relocInfo.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -117,1 +117,1 @@\n-  \/\/ java.lang.ref.Referene::get.\n+  \/\/ java.lang.ref.Reference::get.\n","filename":"src\/hotspot\/share\/compiler\/abstractCompiler.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -530,1 +530,1 @@\n-  \/\/ Setup the maximum level availible for the current compiler configuration.\n+  \/\/ Setup the maximum level available for the current compiler configuration.\n@@ -727,1 +727,1 @@\n-      \/\/ It's not possble to reach the expected level so fall back to simple.\n+      \/\/ It's not possible to reach the expected level so fall back to simple.\n","filename":"src\/hotspot\/share\/compiler\/compilationPolicy.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1342,1 +1342,1 @@\n-  \/\/ Do nothing if compilebroker is not initalized or compiles are submitted on level none\n+  \/\/ Do nothing if compilebroker is not initialized or compiles are submitted on level none\n@@ -1351,1 +1351,1 @@\n-  \/\/ CompileBroker::compile_method can trap and can have pending aysnc exception.\n+  \/\/ CompileBroker::compile_method can trap and can have pending async exception.\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -373,1 +373,1 @@\n-  \/\/ Print curent compilation time stats for a given compiler\n+  \/\/ Print current compilation time stats for a given compiler\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -170,1 +170,1 @@\n-        assert(dest != NULL, \"branch desination must start a block.\");\n+        assert(dest != NULL, \"branch destination must start a block.\");\n@@ -175,1 +175,1 @@\n-        assert(dest != NULL, \"branch desination must start a block.\");\n+        assert(dest != NULL, \"branch destination must start a block.\");\n@@ -180,1 +180,1 @@\n-        assert(dest != NULL, \"branch desination must start a block.\");\n+        assert(dest != NULL, \"branch destination must start a block.\");\n@@ -190,1 +190,1 @@\n-          assert(dest != NULL, \"branch desination must start a block.\");\n+          assert(dest != NULL, \"branch destination must start a block.\");\n@@ -194,1 +194,1 @@\n-            assert(dest != NULL, \"branch desination must start a block.\");\n+            assert(dest != NULL, \"branch destination must start a block.\");\n@@ -207,1 +207,1 @@\n-          assert(dest != NULL, \"branch desination must start a block.\");\n+          assert(dest != NULL, \"branch destination must start a block.\");\n@@ -212,1 +212,1 @@\n-            assert(dest != NULL, \"branch desination must start a block.\");\n+            assert(dest != NULL, \"branch destination must start a block.\");\n@@ -222,1 +222,1 @@\n-          assert(dest != NULL, \"branch desination must start a block.\");\n+          assert(dest != NULL, \"branch destination must start a block.\");\n@@ -232,1 +232,1 @@\n-          assert(dest != NULL, \"branch desination must start a block.\");\n+          assert(dest != NULL, \"branch destination must start a block.\");\n","filename":"src\/hotspot\/share\/compiler\/methodLiveness.cpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-  \/\/ holding the lock. So, we first have to make sure that noone else\n+  \/\/ holding the lock. So, we first have to make sure that no one else\n@@ -68,1 +68,1 @@\n-  \/\/ object. If the free space falls below this, then noone can\n+  \/\/ object. If the free space falls below this, then no one can\n","filename":"src\/hotspot\/share\/gc\/g1\/g1AllocRegion.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -115,1 +115,1 @@\n-  \/\/ so that noone else can allocate out of it any more.\n+  \/\/ so that no one else can allocate out of it any more.\n","filename":"src\/hotspot\/share\/gc\/g1\/g1AllocRegion.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -95,47 +95,33 @@\n-\/\/ The arguments follow the normal convention of denoting\n-\/\/ a right-open interval: [start, end)\n-void G1BlockOffsetTablePart::set_remainder_to_point_to_start(HeapWord* start, HeapWord* end) {\n-  assert(start < end, \"precondition\");\n-  \/\/ Write the backskip value for each region.\n-  \/\/\n-  \/\/    offset\n-  \/\/    card             2nd                       3rd\n-  \/\/     | +- 1st        |                         |\n-  \/\/     v v             v                         v\n-  \/\/    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+-+-+-\n-  \/\/    |x|0|0|0|0|0|0|0|1|1|1|1|1|1| ... |1|1|1|1|2|2|2|2|2|2| ...\n-  \/\/    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+-+-+-\n-  \/\/    11              19                        75\n-  \/\/      12\n-  \/\/\n-  \/\/    offset card is the card that points to the start of an object\n-  \/\/      x - offset value of offset card\n-  \/\/    1st - start of first logarithmic region\n-  \/\/      0 corresponds to logarithmic value N_words + 0 and 2**(3 * 0) = 1\n-  \/\/    2nd - start of second logarithmic region\n-  \/\/      1 corresponds to logarithmic value N_words + 1 and 2**(3 * 1) = 8\n-  \/\/    3rd - start of third logarithmic region\n-  \/\/      2 corresponds to logarithmic value N_words + 2 and 2**(3 * 2) = 64\n-  \/\/\n-  \/\/    integer below the block offset entry is an example of\n-  \/\/    the index of the entry\n-  \/\/\n-  \/\/    Given an address,\n-  \/\/      Find the index for the address\n-  \/\/      Find the block offset table entry\n-  \/\/      Convert the entry to a back slide\n-  \/\/        (e.g., with today's, offset = 0x81 =>\n-  \/\/          back slip = 2**(3*(0x81 - N_words)) = 2**3) = 8\n-  \/\/      Move back N (e.g., 8) entries and repeat with the\n-  \/\/        value of the new entry\n-  \/\/\n-  size_t start_card = _bot->index_for(start);\n-  size_t end_card = _bot->index_for(end-1);\n-  assert(start ==_bot->address_for_index(start_card), \"Precondition\");\n-  assert(end ==_bot->address_for_index(end_card)+BOTConstants::card_size_in_words(), \"Precondition\");\n-  set_remainder_to_point_to_start_incl(start_card, end_card); \/\/ closed interval\n-}\n-\n-\/\/ Unlike the normal convention in this code, the argument here denotes\n-\/\/ a closed, inclusive interval: [start_card, end_card], cf set_remainder_to_point_to_start()\n-\/\/ above.\n+\/\/ Write the backskip value for each region.\n+\/\/\n+\/\/    offset\n+\/\/    card             2nd                       3rd\n+\/\/     | +- 1st        |                         |\n+\/\/     v v             v                         v\n+\/\/    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+-+-+-\n+\/\/    |x|0|0|0|0|0|0|0|1|1|1|1|1|1| ... |1|1|1|1|2|2|2|2|2|2| ...\n+\/\/    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+     +-+-+-+-+-+-+-+-+-+-+-\n+\/\/    11              19                        75\n+\/\/      12\n+\/\/\n+\/\/    offset card is the card that points to the start of an object\n+\/\/      x - offset value of offset card\n+\/\/    1st - start of first logarithmic region\n+\/\/      0 corresponds to logarithmic value N_words + 0 and 2**(3 * 0) = 1\n+\/\/    2nd - start of second logarithmic region\n+\/\/      1 corresponds to logarithmic value N_words + 1 and 2**(3 * 1) = 8\n+\/\/    3rd - start of third logarithmic region\n+\/\/      2 corresponds to logarithmic value N_words + 2 and 2**(3 * 2) = 64\n+\/\/\n+\/\/    integer below the block offset entry is an example of\n+\/\/    the index of the entry\n+\/\/\n+\/\/    Given an address,\n+\/\/      Find the index for the address\n+\/\/      Find the block offset table entry\n+\/\/      Convert the entry to a back slide\n+\/\/        (e.g., with today's, offset = 0x81 =>\n+\/\/          back slip = 2**(3*(0x81 - N_words)) = 2**3) = 8\n+\/\/      Move back N (e.g., 8) entries and repeat with the\n+\/\/        value of the new entry\n+\/\/\n@@ -243,5 +229,1 @@\n-    HeapWord* rem_st  = _bot->address_for_index(index + 1);\n-    \/\/ Calculate rem_end this way because end_index\n-    \/\/ may be the last valid index in the covered region.\n-    HeapWord* rem_end = _bot->address_for_index(end_index) + BOTConstants::card_size_in_words();\n-    set_remainder_to_point_to_start(rem_st, rem_end);\n+    set_remainder_to_point_to_start_incl(index + 1, end_index);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1BlockOffsetTable.cpp","additions":34,"deletions":52,"binary":false,"changes":86,"status":"modified"},{"patch":"@@ -120,7 +120,2 @@\n-  \/\/ Sets the entries\n-  \/\/ corresponding to the cards starting at \"start\" and ending at \"end\"\n-  \/\/ to point back to the card before \"start\": the interval [start, end)\n-  \/\/ is right-open.\n-  void set_remainder_to_point_to_start(HeapWord* start, HeapWord* end);\n-  \/\/ Same as above, except that the args here are a card _index_ interval\n-  \/\/ that is closed: [start_index, end_index]\n+  \/\/ Sets the entries corresponding to the cards starting at \"start\" and ending\n+  \/\/ at \"end\" to point back to the card before \"start\"; [start, end]\n","filename":"src\/hotspot\/share\/gc\/g1\/g1BlockOffsetTable.hpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -78,1 +78,1 @@\n-  log_error(gc)(\"Unkown card set container type %u\", container_type(container));\n+  log_error(gc)(\"Unknown card set container type %u\", container_type(container));\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -84,1 +84,1 @@\n-  \/\/ Iterate over all remaining collectin set candidate regions from the end\n+  \/\/ Iterate over all remaining collection set candidate regions from the end\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectionSetCandidates.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1783,1 +1783,1 @@\n-        \/\/ In theory it should not be neccessary to explicitly walk the nmethods to find roots for concurrent marking\n+        \/\/ In theory it should not be necessary to explicitly walk the nmethods to find roots for concurrent marking\n@@ -1901,0 +1901,1 @@\n+        assert(!curr_region->is_closed_archive(), \"CA regions should be skipped\");\n@@ -2019,1 +2020,1 @@\n-  \/\/ has been signalled is alredy rare), and this work should be negligible compared\n+  \/\/ has been signalled is already rare), and this work should be negligible compared\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -239,1 +239,1 @@\n-  \/\/ use smaller value to substract.\n+  \/\/ use smaller value to subtract.\n","filename":"src\/hotspot\/share\/gc\/g1\/g1MonitoringSupport.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -80,1 +80,1 @@\n-  \/\/ If NUMA is not enabled or supported, initialize as having a singel node.\n+  \/\/ If NUMA is not enabled or supported, initialize as having a single node.\n","filename":"src\/hotspot\/share\/gc\/g1\/g1NUMA.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -35,1 +35,1 @@\n-  \/\/ Total number of bytes allocated in the old generaton during\n+  \/\/ Total number of bytes allocated in the old generation during\n","filename":"src\/hotspot\/share\/gc\/g1\/g1OldGenAllocationTracker.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -266,1 +266,1 @@\n-  \/\/ intitial chunk to allow other workers to steal while we're processing.\n+  \/\/ initial chunk to allow other workers to steal while we're processing.\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ParScanThreadState.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1387,1 +1387,1 @@\n-      \/\/ The second clause must come after - the log buffers might contain cards to uncommited\n+      \/\/ The second clause must come after - the log buffers might contain cards to uncommitted\n","filename":"src\/hotspot\/share\/gc\/g1\/g1RemSet.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -47,1 +47,1 @@\n-  \/\/ service thread multiple times. If the task is active, a new requst to\n+  \/\/ service thread multiple times. If the task is active, a new request to\n","filename":"src\/hotspot\/share\/gc\/g1\/g1UncommitRegionTask.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-\/\/ inbetween we \"arm\" the injector to induce evacuation failures after\n+\/\/ in between we \"arm\" the injector to induce evacuation failures after\n","filename":"src\/hotspot\/share\/gc\/g1\/g1YoungGCEvacFailureInjector.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -245,1 +245,4 @@\n-  _next_top_at_mark_start = top();\n+  if (!is_closed_archive()) {\n+    _next_top_at_mark_start = top();\n+  }\n+  assert(!is_closed_archive() || next_top_at_mark_start() == bottom(), \"CA region's nTAMS must always be at bottom\");\n","filename":"src\/hotspot\/share\/gc\/g1\/heapRegion.inline.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -403,1 +403,1 @@\n-    \/\/ Not else-if to catch the case where the inactive region was uncommited\n+    \/\/ Not else-if to catch the case where the inactive region was uncommitted\n","filename":"src\/hotspot\/share\/gc\/g1\/heapRegionManager.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,1 +55,1 @@\n-    \/\/ Explictly capture current covered_region in a local\n+    \/\/ Explicitly capture current covered_region in a local\n","filename":"src\/hotspot\/share\/gc\/parallel\/psOldGen.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -286,1 +286,1 @@\n-    \/\/ Ensure loads from the forwardee follow all changes that preceeded the\n+    \/\/ Ensure loads from the forwardee follow all changes that preceded the\n","filename":"src\/hotspot\/share\/gc\/parallel\/psPromotionManager.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -158,1 +158,1 @@\n-    \/\/ be recomputed based on the old value further down in this fuction.\n+    \/\/ be recomputed based on the old value further down in this function.\n","filename":"src\/hotspot\/share\/gc\/serial\/tenuredGeneration.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,1 +110,1 @@\n-\/\/ It is called by the LIRGenerator::access_* functions, which is the main entry poing for\n+\/\/ It is called by the LIRGenerator::access_* functions, which is the main entry point for\n","filename":"src\/hotspot\/share\/gc\/shared\/c1\/barrierSetC1.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -99,1 +99,1 @@\n-\/\/ This class wraps a bunch of context parameters thare are passed around in the\n+\/\/ This class wraps a bunch of context parameters that are passed around in the\n@@ -166,1 +166,1 @@\n-\/\/ This class wraps a bunch of context parameters thare are passed around in the\n+\/\/ This class wraps a bunch of context parameters that are passed around in the\n","filename":"src\/hotspot\/share\/gc\/shared\/c2\/barrierSetC2.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-  \/\/ Release control of the concurrent collector, cancelling any preceeding\n+  \/\/ Release control of the concurrent collector, cancelling any preceding\n@@ -78,1 +78,1 @@\n-  \/\/ Requests the concurrent collector to be idle. Cancels any preceeding\n+  \/\/ Requests the concurrent collector to be idle. Cancels any preceding\n@@ -90,1 +90,1 @@\n-  \/\/ reached.  Cancels any preceeding run_to_idle(). If the collector is\n+  \/\/ reached.  Cancels any preceding run_to_idle(). If the collector is\n","filename":"src\/hotspot\/share\/gc\/shared\/concurrentGCBreakpoints.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -128,1 +128,1 @@\n-    \/\/ _adaptive_size_policy is for a collecton done before a full GC\n+    \/\/ _adaptive_size_policy is for a collection done before a full GC\n","filename":"src\/hotspot\/share\/gc\/shared\/gcCause.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -212,1 +212,1 @@\n-    \/\/ Exacly one GC selected\n+    \/\/ Exactly one GC selected\n","filename":"src\/hotspot\/share\/gc\/shared\/gcConfig.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,1 +74,1 @@\n-\/\/   - these operations preform full collection of heaps of\n+\/\/   - these operations perform full collection of heaps of\n","filename":"src\/hotspot\/share\/gc\/shared\/gcVMOperations.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -465,1 +465,1 @@\n-    \/\/ GCH enables and disabled (by enqueing) refs discovery.\n+    \/\/ GCH enables and disabled (by enqueuing) refs discovery.\n","filename":"src\/hotspot\/share\/gc\/shared\/genCollectedHeap.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -92,2 +92,2 @@\n-  \/\/   N    : number of preceeding tasks\n-  \/\/   F*N  : maximum created for preceeding tasks\n+  \/\/   N    : number of preceding tasks\n+  \/\/   F*N  : maximum created for preceding tasks\n","filename":"src\/hotspot\/share\/gc\/shared\/partialArrayTaskStepper.inline.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,1 +73,1 @@\n-  \/\/ will artifically inflate the values in the statistics.\n+  \/\/ will artificially inflate the values in the statistics.\n","filename":"src\/hotspot\/share\/gc\/shared\/plab.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -831,3 +831,0 @@\n-    case REF_OTHER:\n-      \/\/ Unknown reference type, no special treatment\n-      break;\n@@ -846,0 +843,2 @@\n+    case REF_OTHER:\n+      \/\/ Unknown reference type, impossible\n@@ -1039,4 +1038,0 @@\n-  if (list == NULL) {\n-    return false;   \/\/ nothing special needs to be done\n-  }\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.cpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -429,1 +429,1 @@\n-  \/\/ If a discovery is in process that is being superceded, abandon it: all\n+  \/\/ If a discovery is in process that is being superseded, abandon it: all\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -161,1 +161,1 @@\n-  \/\/ Implicity forbids deduplication of the String.\n+  \/\/ Implicitly forbids deduplication of the String.\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedup.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -86,1 +86,1 @@\n-\/\/ Support for log output formating\n+\/\/ Support for log output formatting\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupStat.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -231,1 +231,1 @@\n-\/\/ that doesn't work for concurrent reference processsing.  In that case the\n+\/\/ that doesn't work for concurrent reference processing.  In that case the\n","filename":"src\/hotspot\/share\/gc\/shared\/stringdedup\/stringDedupTable.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1364,1 +1364,1 @@\n-    \/\/ even for non-cset objects to prevent ressurrection of such objects.\n+    \/\/ even for non-cset objects to prevent resurrection of such objects.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahSupport.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -121,1 +121,1 @@\n-    \/\/ SATB protocol requires to keep alive reacheable oops from roots at the beginning of GC\n+    \/\/ SATB protocol requires to keep alive reachable oops from roots at the beginning of GC\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -460,1 +460,1 @@\n-    \/\/ preceeds the object, we can skip over it. Once we cannot trust the bitmap,\n+    \/\/ precedes the object, we can skip over it. Once we cannot trust the bitmap,\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -156,1 +156,1 @@\n-                    ? to_words_align_down(r_index) \/\/ Miniscule savings when aligned.\n+                    ? to_words_align_down(r_index) \/\/ Minuscule savings when aligned.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahMarkBitMap.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -146,1 +146,1 @@\n-  \/\/ will eventually be bound. Any lable will do, as it will only act as\n+  \/\/ will eventually be bound. Any label will do, as it will only act as\n","filename":"src\/hotspot\/share\/gc\/z\/c2\/zBarrierSetC2.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,1 +39,1 @@\n-  \/\/ The preceeding handshake makes sure that all non-strong\n+  \/\/ The preceding handshake makes sure that all non-strong\n","filename":"src\/hotspot\/share\/gc\/z\/zResurrection.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -452,1 +452,1 @@\n- * Module support funcions\n+ * Module support functions\n","filename":"src\/hotspot\/share\/include\/jvm.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n- *   appendend.\n+ *   appended.\n","filename":"src\/hotspot\/share\/include\/jvm_io.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -322,1 +322,1 @@\n-      \/\/ (NOT needed for the old calling convension)\n+      \/\/ (NOT needed for the old calling convention)\n@@ -336,1 +336,1 @@\n-      \/\/ (NOT needed for the old calling convension)\n+      \/\/ (NOT needed for the old calling convention)\n@@ -390,1 +390,1 @@\n-    \/\/ recompute condtional expression folded into _if<cond>\n+    \/\/ recompute conditional expression folded into _if<cond>\n","filename":"src\/hotspot\/share\/interpreter\/abstractInterpreter.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -74,1 +74,1 @@\n-\/\/ A bytecode pair is any sequence of two consequtive bytecodes.\n+\/\/ A bytecode pair is any sequence of two consecutive bytecodes.\n","filename":"src\/hotspot\/share\/interpreter\/bytecodeHistogram.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -194,1 +194,1 @@\n-      \/\/ (carefull: length_for(...) must be used first!)\n+      \/\/ (careful: length_for(...) must be used first!)\n","filename":"src\/hotspot\/share\/interpreter\/bytecodeStream.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -105,1 +105,1 @@\n-  \/\/ more, but 'local<i>'. Similary for 'this'.\n+  \/\/ more, but 'local<i>'. Similarly for 'this'.\n@@ -155,1 +155,1 @@\n-\/\/ exception occured.\n+\/\/ exception occurred.\n","filename":"src\/hotspot\/share\/interpreter\/bytecodeUtils.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1114,1 +1114,1 @@\n-  \/\/ We used to need an explict preserve_arguments here for invoke bytecodes. However,\n+  \/\/ We used to need an explicit preserve_arguments here for invoke bytecodes. However,\n@@ -1251,1 +1251,1 @@\n-\/\/ dependant code)\n+\/\/ dependent code)\n@@ -1312,1 +1312,1 @@\n-      \/\/ allow CPU dependant code to optimize the fingerprints for the fast handler\n+      \/\/ allow CPU dependent code to optimize the fingerprints for the fast handler\n@@ -1327,1 +1327,1 @@\n-          \/\/ debugging suppport\n+          \/\/ debugging support\n","filename":"src\/hotspot\/share\/interpreter\/interpreterRuntime.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -816,1 +816,1 @@\n-\/\/ Do linktime resolution of a method in the interface within the context of the specied bytecode.\n+\/\/ Do linktime resolution of a method in the interface within the context of the specified bytecode.\n","filename":"src\/hotspot\/share\/interpreter\/linkResolver.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -181,1 +181,1 @@\n-  \/\/ The expection is that the bit mask was allocated\n+  \/\/ The expectation is that the bit mask was allocated\n","filename":"src\/hotspot\/share\/interpreter\/oopMapCache.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,1 +94,1 @@\n-                                  \/\/ methd bit_mask().\n+                                  \/\/ method bit_mask().\n","filename":"src\/hotspot\/share\/interpreter\/oopMapCache.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -290,1 +290,1 @@\n-\/\/ Suport for invokes\n+\/\/ Support for invokes\n","filename":"src\/hotspot\/share\/interpreter\/templateInterpreter.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -311,1 +311,1 @@\n- * things (like pushing frames or becomming gc safe) and some need to\n+ * things (like pushing frames or becoming gc safe) and some need to\n@@ -758,1 +758,1 @@\n-       * when returing from transition frames.\n+       * when returning from transition frames.\n@@ -1567,1 +1567,1 @@\n-            \/\/ Check for compatibilty. This check must not GC!!\n+            \/\/ Check for compatibility. This check must not GC!!\n@@ -2012,1 +2012,1 @@\n-            \/\/ Check for compatibilty. This check must not GC!!\n+            \/\/ Check for compatibility. This check must not GC!!\n@@ -2038,1 +2038,1 @@\n-            \/\/ Check for compatibilty. This check must not GC!!\n+            \/\/ Check for compatibility. This check must not GC!!\n@@ -2997,0 +2997,2 @@\n+      default:\n+        ShouldNotReachHere();\n@@ -3024,1 +3026,1 @@\n-    \/\/ in unpredicatable places. Instead we must protect the places where we enter the\n+    \/\/ in unpredictable places. Instead we must protect the places where we enter the\n@@ -3245,1 +3247,1 @@\n-\/\/ This constructor should only be used to contruct the object to signal\n+\/\/ This constructor should only be used to construct the object to signal\n","filename":"src\/hotspot\/share\/interpreter\/zero\/bytecodeInterpreter.cpp","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -382,1 +382,1 @@\n-  out->print_cr(\"                     initalized. (STRING, default determined by the value for\");\n+  out->print_cr(\"                     initialized. (STRING, default determined by the value for\");\n@@ -388,1 +388,1 @@\n-  out->print_cr(\"                     been initalized. (STRING, default determined by the value for\");\n+  out->print_cr(\"                     been initialized. (STRING, default determined by the value for\");\n","filename":"src\/hotspot\/share\/jfr\/dcmd\/jfrDcmds.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1368,1 +1368,1 @@\n-  \/\/                              merging will be neccessary.\n+  \/\/                              merging will be necessary.\n","filename":"src\/hotspot\/share\/jfr\/instrumentation\/jfrEventClassTransformer.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,1 @@\n-  \/\/ Depth-first search, starting from a BFS egde\n+  \/\/ Depth-first search, starting from a BFS edge\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/chains\/dfsClosure.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -25,2 +25,2 @@\n-#ifndef SHARE_JFR_LEAKPROFILER_JFRBITMAP_HPP\n-#define SHARE_JFR_LEAKPROFILER_JFRBITMAP_HPP\n+#ifndef SHARE_JFR_LEAKPROFILER_JFRBITSET_HPP\n+#define SHARE_JFR_LEAKPROFILER_JFRBITSET_HPP\n@@ -33,1 +33,1 @@\n-#endif \/\/ SHARE_JFR_LEAKPROFILER_JFRBITMAP_HPP\n+#endif \/\/ SHARE_JFR_LEAKPROFILER_JFRBITSET_HPP\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/chains\/jfrbitset.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -629,1 +629,1 @@\n-  \/\/ Followings are RA allocated, memory will be released automatically.\n+  \/\/ Following are RA allocated, memory will be released automatically.\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/checkpoint\/objectSampleWriter.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n-\/\/ Class reponsible for holding samples and\n+\/\/ Class responsible for holding samples and\n","filename":"src\/hotspot\/share\/jfr\/leakprofiler\/sampling\/objectSampler.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4,1 +4,1 @@\n- Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n-  <!-- Internal events are only to be used during development, i.e. temporary time measurements, without the need \n+  <!-- Internal events are only to be used during development, i.e. temporary time measurements, without the need\n@@ -44,1 +44,1 @@\n-       $ java -XX:StartFlightRecording:settings=none,filename=dump.jfr ...  \n+       $ java -XX:StartFlightRecording:settings=none,filename=dump.jfr ...\n@@ -70,1 +70,1 @@\n-  \n+\n@@ -77,1 +77,1 @@\n-  \n+\n@@ -427,1 +427,1 @@\n-    description=\"Object survived scavenge and was copied to a new Promotion Local Allocation Buffer (PLAB). Supported GCs are Parallel Scavange, G1 and CMS with Parallel New. Due to promotion being done in parallel an object might be reported multiple times as the GC threads race to copy all objects.\"\n+    description=\"Object survived scavenge and was copied to a new Promotion Local Allocation Buffer (PLAB). Supported GCs are Parallel Scavenge, G1 and CMS with Parallel New. Due to promotion being done in parallel an object might be reported multiple times as the GC threads race to copy all objects.\"\n@@ -433,1 +433,1 @@\n-      description=\"Tenuring age of a surviving object before being copied. The tenuring age of an object is a value between 0-15 and is incremented each scavange the object survives. Newly allocated objects have tenuring age 0.\" \/>\n+      description=\"Tenuring age of a surviving object before being copied. The tenuring age of an object is a value between 0-15 and is incremented each scavenge the object survives. Newly allocated objects have tenuring age 0.\" \/>\n@@ -439,1 +439,1 @@\n-    description=\"Object survived scavenge and was copied directly to the heap. Supported GCs are Parallel Scavange, G1 and CMS with Parallel New. Due to promotion being done in parallel an object might be reported multiple times as the GC threads race to copy all objects.\"\n+    description=\"Object survived scavenge and was copied directly to the heap. Supported GCs are Parallel Scavenge, G1 and CMS with Parallel New. Due to promotion being done in parallel an object might be reported multiple times as the GC threads race to copy all objects.\"\n@@ -445,1 +445,1 @@\n-      description=\"Tenuring age of a surviving object before being copied. The tenuring age of an object is a value between 0-15 and is incremented each scavange the object survives. Newly allocated objects have tenuring age 0.\" \/>\n+      description=\"Tenuring age of a surviving object before being copied. The tenuring age of an object is a value between 0-15 and is incremented each scavenge the object survives. Newly allocated objects have tenuring age 0.\" \/>\n@@ -625,1 +625,1 @@\n-    <Field type=\"boolean\" name=\"safepoint\" label=\"At Safepoint\" description=\"If the operation occured at a safepoint\" \/>\n+    <Field type=\"boolean\" name=\"safepoint\" label=\"At Safepoint\" description=\"If the operation occurred at a safepoint\" \/>\n","filename":"src\/hotspot\/share\/jfr\/metadata\/metadata.xml","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -201,1 +201,1 @@\n- * be to reduce the amount of iterations neccessary for locating artifacts\n+ * be to reduce the amount of iterations necessary for locating artifacts\n","filename":"src\/hotspot\/share\/jfr\/recorder\/checkpoint\/types\/jfrTypeSetUtils.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,1 +40,1 @@\n-\/\/ Java continously keeps the VM informed about new chunk locations via set_chunk_path().\n+\/\/ Java continuously keeps the VM informed about new chunk locations via set_chunk_path().\n","filename":"src\/hotspot\/share\/jfr\/recorder\/repository\/jfrRepository.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -200,1 +200,1 @@\n-      \/\/ Event written succesfully\n+      \/\/ Event written successfully\n@@ -206,1 +206,1 @@\n-        \/\/ Event written succesfully, use large size from now on\n+        \/\/ Event written successfully, use large size from now on\n","filename":"src\/hotspot\/share\/jfr\/recorder\/service\/jfrEvent.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -102,1 +102,1 @@\n- * when the JfrAdaptiveSampler engine is calcualting an expected weigthed moving average (EWMA) over the population.\n+ * when the JfrAdaptiveSampler engine is calculating an expected weighted moving average (EWMA) over the population.\n","filename":"src\/hotspot\/share\/jfr\/recorder\/service\/jfrEventThrottler.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -470,1 +470,1 @@\n-\/\/ an ambiguous situtation\n+\/\/ an ambiguous situation\n@@ -491,1 +491,1 @@\n-      \"Try to remove one of the involved options or make sure they are unambigous\");\n+      \"Try to remove one of the involved options or make sure they are unambiguous\");\n","filename":"src\/hotspot\/share\/jfr\/recorder\/service\/jfrOptionSet.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,1 @@\n- * FreeListType      the type of the free list. The syntactic interface to be fullfilled is most conveniently read from an example,\n+ * FreeListType      the type of the free list. The syntactic interface to be fulfilled is most conveniently read from an example,\n","filename":"src\/hotspot\/share\/jfr\/recorder\/storage\/jfrMemorySpace.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-* Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+* Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -134,1 +134,1 @@\n-\/\/ Call next_window_param() to report the expired window and to retreive params for the next window.\n+\/\/ Call next_window_param() to report the expired window and to retrieve params for the next window.\n","filename":"src\/hotspot\/share\/jfr\/support\/jfrAdaptiveSampler.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-* Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+* Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,1 +69,1 @@\n- * more managable subsets while still keeping the data somewhat representative.\n+ * more manageable subsets while still keeping the data somewhat representative.\n","filename":"src\/hotspot\/share\/jfr\/support\/jfrAdaptiveSampler.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n- * \"node --> next\" becomes \"[node] --> next\", in an attempt to convey the node as exlusively reserved.\n+ * \"node --> next\" becomes \"[node] --> next\", in an attempt to convey the node as exclusively reserved.\n","filename":"src\/hotspot\/share\/jfr\/utilities\/jfrConcurrentLinkedListHost.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n- * compared to global, reference tracking for an assoicated data structure.\n+ * compared to global, reference tracking for an associated data structure.\n","filename":"src\/hotspot\/share\/jfr\/utilities\/jfrVersionSystem.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,1 +93,1 @@\n-      \/\/ the flush implementation will accomodate\n+      \/\/ the flush implementation will accommodate\n","filename":"src\/hotspot\/share\/jfr\/writers\/jfrStorageAdapter.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -587,1 +587,1 @@\n-}\n+C2V_END\n@@ -628,0 +628,71 @@\n+C2V_VMENTRY_NULL(jobjectArray, resolveBootstrapMethod, (JNIEnv* env, jobject, jobject jvmci_constant_pool, jint index))\n+  constantPoolHandle cp(THREAD, JVMCIENV->asConstantPool(jvmci_constant_pool));\n+  constantTag tag = cp->tag_at(index);\n+  bool is_indy = tag.is_invoke_dynamic();\n+  bool is_condy = tag.is_dynamic_constant();\n+  if (!(is_condy || is_indy)) {\n+    JVMCI_THROW_MSG_0(IllegalArgumentException, err_msg(\"Unexpected constant pool tag at index %d: %d\", index, tag.value()));\n+  }\n+  \/\/ Resolve the bootstrap specifier, its name, type, and static arguments\n+  BootstrapInfo bootstrap_specifier(cp, index);\n+  Handle bsm = bootstrap_specifier.resolve_bsm(CHECK_NULL);\n+\n+  \/\/ call java.lang.invoke.MethodHandle::asFixedArity() -> MethodHandle\n+  \/\/ to get a DirectMethodHandle from which we can then extract a Method*\n+  JavaValue result(T_OBJECT);\n+  JavaCalls::call_virtual(&result,\n+                         bsm,\n+                         vmClasses::MethodHandle_klass(),\n+                         vmSymbols::asFixedArity_name(),\n+                         vmSymbols::asFixedArity_signature(),\n+                         CHECK_NULL);\n+  bsm = Handle(THREAD, result.get_oop());\n+\n+  \/\/ Check assumption about getting a DirectMethodHandle\n+  if (!java_lang_invoke_DirectMethodHandle::is_instance(bsm())) {\n+    JVMCI_THROW_MSG_NULL(InternalError, err_msg(\"Unexpected MethodHandle subclass: %s\", bsm->klass()->external_name()));\n+  }\n+  \/\/ Create return array describing the bootstrap method invocation (BSMI)\n+  JVMCIObjectArray bsmi = JVMCIENV->new_Object_array(4, JVMCI_CHECK_NULL);\n+\n+  \/\/ Extract Method* and wrap it in a ResolvedJavaMethod\n+  Handle member = Handle(THREAD, java_lang_invoke_DirectMethodHandle::member(bsm()));\n+  JVMCIObject bsmi_method = JVMCIENV->get_jvmci_method(methodHandle(THREAD, java_lang_invoke_MemberName::vmtarget(member())), JVMCI_CHECK_NULL);\n+  JVMCIENV->put_object_at(bsmi, 0, bsmi_method);\n+\n+  JVMCIObject bsmi_name = JVMCIENV->create_string(bootstrap_specifier.name(), JVMCI_CHECK_NULL);\n+  JVMCIENV->put_object_at(bsmi, 1, bsmi_name);\n+\n+  Handle type_arg = bootstrap_specifier.type_arg();\n+  JVMCIObject bsmi_type = JVMCIENV->get_object_constant(type_arg());\n+  JVMCIENV->put_object_at(bsmi, 2, bsmi_type);\n+\n+  Handle arg_values = bootstrap_specifier.arg_values();\n+  if (arg_values.not_null()) {\n+    if (!arg_values->is_array()) {\n+      JVMCIENV->put_object_at(bsmi, 3, JVMCIENV->get_object_constant(arg_values()));\n+    } else if (arg_values->is_objArray()) {\n+      objArrayHandle args_array = objArrayHandle(THREAD, (objArrayOop) arg_values());\n+      int len = args_array->length();\n+      JVMCIObjectArray arguments = JVMCIENV->new_JavaConstant_array(len, JVMCI_CHECK_NULL);\n+      JVMCIENV->put_object_at(bsmi, 3, arguments);\n+      for (int i = 0; i < len; i++) {\n+        oop x = args_array->obj_at(i);\n+        if (x != nullptr) {\n+          JVMCIENV->put_object_at(arguments, i, JVMCIENV->get_object_constant(x));\n+        } else {\n+          JVMCIENV->put_object_at(arguments, i, JVMCIENV->get_JavaConstant_NULL_POINTER());\n+        }\n+      }\n+    } else if (arg_values->is_typeArray()) {\n+      typeArrayHandle bsci = typeArrayHandle(THREAD, (typeArrayOop) arg_values());\n+      JVMCIPrimitiveArray arguments = JVMCIENV->new_intArray(bsci->length(), JVMCI_CHECK_NULL);\n+      JVMCIENV->put_object_at(bsmi, 3, arguments);\n+      for (int i = 0; i < bsci->length(); i++) {\n+        JVMCIENV->put_int_at(arguments, i, bsci->int_at(i));\n+      }\n+    }\n+  }\n+  return JVMCIENV->get_jobjectArray(bsmi);\n+C2V_END\n+\n@@ -901,4 +972,0 @@\n-C2V_VMENTRY_0(jint, getMetadata, (JNIEnv *env, jobject, jobject target, jobject compiled_code, jobject metadata))\n-  JVMCI_THROW_MSG_0(InternalError, \"unimplemented\");\n-C2V_END\n-\n@@ -1607,4 +1674,0 @@\n-C2V_VMENTRY_0(jlong, getFingerprint, (JNIEnv* env, jobject, jlong metaspace_klass))\n-  JVMCI_THROW_MSG_0(InternalError, \"unimplemented\");\n-C2V_END\n-\n@@ -2698,1 +2761,0 @@\n-#define HS_METADATA             \"Ljdk\/vm\/ci\/hotspot\/HotSpotMetaData;\"\n@@ -2729,0 +2791,1 @@\n+  {CC \"resolveBootstrapMethod\",                       CC \"(\" HS_CONSTANT_POOL \"I)[\" OBJECT,                                                 FN_PTR(resolveBootstrapMethod)},\n@@ -2747,1 +2810,0 @@\n-  {CC \"getMetadata\",                                  CC \"(\" TARGET_DESCRIPTION HS_COMPILED_CODE HS_METADATA \")I\",                          FN_PTR(getMetadata)},\n@@ -2769,1 +2831,0 @@\n-  {CC \"getFingerprint\",                               CC \"(J)J\",                                                                            FN_PTR(getFingerprint)},\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCompilerToVM.cpp","additions":73,"deletions":12,"binary":false,"changes":85,"status":"modified"},{"patch":"@@ -398,1 +398,1 @@\n-  \/\/ These are analagous to the JNI routines\n+  \/\/ These are analogous to the JNI routines\n","filename":"src\/hotspot\/share\/jvmci\/jvmciEnv.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n-\/\/ JVMCIEnv exception utility macros.  Analagous to the regular CHECK, TRAP and THREAD macros.\n+\/\/ JVMCIEnv exception utility macros.  Analogous to the regular CHECK, TRAP and THREAD macros.\n","filename":"src\/hotspot\/share\/jvmci\/jvmciExceptions.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -336,9 +336,0 @@\n-  start_class(HotSpotMetaData, jdk_vm_ci_hotspot_HotSpotMetaData)                                             \\\n-    primarray_field(HotSpotMetaData, pcDescBytes, \"[B\")                                                       \\\n-    primarray_field(HotSpotMetaData, scopesDescBytes, \"[B\")                                                   \\\n-    primarray_field(HotSpotMetaData, relocBytes, \"[B\")                                                        \\\n-    primarray_field(HotSpotMetaData, exceptionBytes, \"[B\")                                                    \\\n-    primarray_field(HotSpotMetaData, implicitExceptionBytes, \"[B\")                                            \\\n-    primarray_field(HotSpotMetaData, oopMaps, \"[B\")                                                           \\\n-    object_field(HotSpotMetaData, metadata, \"[Ljava\/lang\/Object;\")                                            \\\n-  end_class                                                                                                   \\\n","filename":"src\/hotspot\/share\/jvmci\/jvmciJavaClasses.hpp","additions":0,"deletions":9,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -282,1 +282,1 @@\n-  \/\/ Check the stack guard pages and reenable them if necessary and there is\n+  \/\/ Check the stack guard pages and re-enable them if necessary and there is\n","filename":"src\/hotspot\/share\/jvmci\/jvmciRuntime.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -417,1 +417,1 @@\n-  \/\/ simplicty all types are passed by being converted into a jlong\n+  \/\/ simplicity all types are passed by being converted into a jlong\n","filename":"src\/hotspot\/share\/jvmci\/jvmciRuntime.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -53,1 +53,0 @@\n-  template(jdk_vm_ci_hotspot_HotSpotMetaData,                     \"jdk\/vm\/ci\/hotspot\/HotSpotMetaData\")                                    \\\n","filename":"src\/hotspot\/share\/jvmci\/vmSymbols_jvmci.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,1 +58,1 @@\n-  \/\/ cmp is a key comparision routine.  hash is a routine to hash a key.\n+  \/\/ cmp is a key comparison routine.  hash is a routine to hash a key.\n","filename":"src\/hotspot\/share\/libadt\/dict.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-\/\/ LogMessageBuffer consists of a multiple-part\/multiple-line messsage.\n+\/\/ LogMessageBuffer consists of a multiple-part\/multiple-line message.\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -136,1 +136,1 @@\n-\/\/ return 0. AsyncLogWriter is responsible of copying neccessary data.\n+\/\/ return 0. AsyncLogWriter is responsible of copying necessary data.\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -80,1 +80,1 @@\n-\/\/ WARNING: The array variant must only be used for a homogenous array\n+\/\/ WARNING: The array variant must only be used for a homogeneous array\n@@ -552,1 +552,1 @@\n-\/\/ Uses mmaped memory for all allocations. All allocations are initially\n+\/\/ Uses mmapped memory for all allocations. All allocations are initially\n","filename":"src\/hotspot\/share\/memory\/allocation.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -439,1 +439,1 @@\n-\/\/ Print the class name and its unique ClassLoader identifer.\n+\/\/ Print the class name and its unique ClassLoader identifier.\n@@ -471,1 +471,1 @@\n-  \/\/ Print the class name, its unique ClassLoader identifer, and if it is an interface.\n+  \/\/ Print the class name, its unique ClassLoader identifier, and if it is an interface.\n","filename":"src\/hotspot\/share\/memory\/heapInspection.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -292,1 +292,1 @@\n-\/\/ of an interruptable task so as to allow other\n+\/\/ of an interruptible task so as to allow other\n","filename":"src\/hotspot\/share\/memory\/iterator.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n-\/\/ A very simple data structure representing a contigous word-aligned\n+\/\/ A very simple data structure representing a contiguous word-aligned\n","filename":"src\/hotspot\/share\/memory\/memRegion.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n-\/\/ A very simple data structure representing a contigous region\n+\/\/ A very simple data structure representing a contiguous region\n","filename":"src\/hotspot\/share\/memory\/memRegion.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -460,1 +460,1 @@\n-      assert(succeeded, \"Should always succesfully increment HWM when at safepoint\");\n+      assert(succeeded, \"Should always successfully increment HWM when at safepoint\");\n@@ -767,1 +767,1 @@\n-    \/\/ this may fail, in which case the VM will exit after printing an appropiate message.\n+    \/\/ this may fail, in which case the VM will exit after printing an appropriate message.\n@@ -780,1 +780,1 @@\n-        log_info(metaspace)(\"Sucessfully forced class space address to \" PTR_FORMAT, p2i(base));\n+        log_info(metaspace)(\"Successfully forced class space address to \" PTR_FORMAT, p2i(base));\n","filename":"src\/hotspot\/share\/memory\/metaspace.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -155,1 +155,1 @@\n-  \/\/ if we did not get anything yet, there are no free chunks commmitted enough. Repeat search but look for uncommitted chunks too:\n+  \/\/ if we did not get anything yet, there are no free chunks committed enough. Repeat search but look for uncommitted chunks too:\n","filename":"src\/hotspot\/share\/memory\/metaspace\/chunkManager.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -64,1 +64,1 @@\n-  \/\/ or uncomitted (value == false) and returns\n+  \/\/ or uncommitted (value == false) and returns\n","filename":"src\/hotspot\/share\/memory\/metaspace\/commitMask.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -139,1 +139,1 @@\n-    \/\/ Uncomitted chunks go to the back, fully or partially committed to the front.\n+    \/\/ Uncommitted chunks go to the back, fully or partially committed to the front.\n","filename":"src\/hotspot\/share\/memory\/metaspace\/freeChunkList.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -217,1 +217,1 @@\n-    \/\/ The chunk following us or preceeding us may be our buddy or a splintered part of it.\n+    \/\/ The chunk following us or preceding us may be our buddy or a splintered part of it.\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metachunk.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -104,1 +104,1 @@\n-\/\/  at the base of the payload - which is a performace optimization -\n+\/\/  at the base of the payload - which is a performance optimization -\n@@ -350,1 +350,1 @@\n-  \/\/ Returns true if given pointer points into the commmitted payload area of this chunk.\n+  \/\/ Returns true if given pointer points into the committed payload area of this chunk.\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metachunk.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -177,1 +177,1 @@\n-  \/\/ Not if chunk enlargment is switched off...\n+  \/\/ Not if chunk enlargement is switched off...\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceArena.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,1 @@\n-\/\/ When the current chunk is used up, MetaspaceArena requestes a new chunk from\n+\/\/ When the current chunk is used up, MetaspaceArena requests a new chunk from\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceArena.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,1 @@\n-    \/\/ that very closely mimicks the behaviour of old Metaspace.\n+    \/\/ that very closely mimics the behaviour of old Metaspace.\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceSettings.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -88,1 +88,1 @@\n-  \/\/ Commit limit > 0 simulates a limit to max commitable space (like MaxMetaspaceSize)\n+  \/\/ Commit limit > 0 simulates a limit to max committable space (like MaxMetaspaceSize)\n","filename":"src\/hotspot\/share\/memory\/metaspace\/testHelpers.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,1 +55,1 @@\n-\/\/   reserve memory for the upper regions, see ChunkManager. One is a way to manage commited memory.)\n+\/\/   reserve memory for the upper regions, see ChunkManager. One is a way to manage committed memory.)\n","filename":"src\/hotspot\/share\/memory\/metaspace\/virtualSpaceNode.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,1 +36,1 @@\n-\/\/ - MetaspaceCombinedStats: keeps reserved, committed and used byte counters, seperately for both class- and non-class-space;\n+\/\/ - MetaspaceCombinedStats: keeps reserved, committed and used byte counters, separately for both class- and non-class-space;\n","filename":"src\/hotspot\/share\/memory\/metaspaceStats.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1224,1 +1224,1 @@\n-    \/\/ sharing initilization should have already set up _klass\n+    \/\/ sharing initialization should have already set up _klass\n","filename":"src\/hotspot\/share\/memory\/universe.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -99,1 +99,1 @@\n-\/\/ that in the declation.  The ENABLE_IF_SDEFN macro provides the common\n+\/\/ that in the declaration.  The ENABLE_IF_SDEFN macro provides the common\n","filename":"src\/hotspot\/share\/metaprogramming\/enableIf.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -134,1 +134,1 @@\n-\/\/   in the pipeline and hardwire to raw accesses without going trough the GC access barriers.\n+\/\/   in the pipeline and hardwire to raw accesses without going through the GC access barriers.\n","filename":"src\/hotspot\/share\/oops\/accessDecorators.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -102,1 +102,1 @@\n-\/\/ Initialization of vtables and mirror object is done separatly from base_create_array_klass,\n+\/\/ Initialization of vtables and mirror object is done separately from base_create_array_klass,\n","filename":"src\/hotspot\/share\/oops\/arrayKlass.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -229,1 +229,1 @@\n-    \/\/  should be CDS agnostic, that would simplify it - and testing - alot. See JDK-8267141\n+    \/\/  should be CDS agnostic, that would simplify it - and testing - a lot. See JDK-8267141\n","filename":"src\/hotspot\/share\/oops\/compressedOops.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -475,1 +475,1 @@\n-  \/\/ the entry and tag is not updated atomicly.\n+  \/\/ the entry and tag is not updated atomically.\n@@ -2208,1 +2208,1 @@\n-  \/\/ Keep temorarily for debugging until it's stable.\n+  \/\/ Keep temporarily for debugging until it's stable.\n","filename":"src\/hotspot\/share\/oops\/constantPool.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -204,1 +204,1 @@\n-  \/\/ Redefine classes support.  If a method refering to this constant pool\n+  \/\/ Redefine classes support.  If a method referring to this constant pool\n@@ -888,1 +888,1 @@\n-  \/\/ JVMTI accesss - GetConstantPool, RetransformClasses, ...\n+  \/\/ JVMTI access - GetConstantPool, RetransformClasses, ...\n","filename":"src\/hotspot\/share\/oops\/constantPool.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -151,1 +151,1 @@\n-    assert((_shorts[low_packed_offset] & FIELDINFO_TAG_CONTENDED) == 0, \"Overwritting contended group\");\n+    assert((_shorts[low_packed_offset] & FIELDINFO_TAG_CONTENDED) == 0, \"Overwriting contended group\");\n","filename":"src\/hotspot\/share\/oops\/fieldInfo.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -975,1 +975,1 @@\n-    \/\/ Remember prevous bci.\n+    \/\/ Remember previous bci.\n@@ -1159,1 +1159,1 @@\n-      \/\/ Automatically handles 'wide' ret indicies\n+      \/\/ Automatically handles 'wide' ret indices\n@@ -1757,1 +1757,1 @@\n-\/\/ Replace all occurences of the state 'match' with the state 'replace'\n+\/\/ Replace all occurrences of the state 'match' with the state 'replace'\n@@ -2349,1 +2349,1 @@\n-        tty->print_cr(\"Supress rewriting of astore at bci: %d\", bci);\n+        tty->print_cr(\"Suppress rewriting of astore at bci: %d\", bci);\n@@ -2380,1 +2380,1 @@\n-  \/\/ This is neccesary, since relocating the instruction at a certain bci, might\n+  \/\/ This is necessary, since relocating the instruction at a certain bci, might\n@@ -2432,1 +2432,1 @@\n-\/\/ Returns true if expanding was succesful. Otherwise, reports an error and\n+\/\/ Returns true if expanding was successful. Otherwise, reports an error and\n","filename":"src\/hotspot\/share\/oops\/generateOopMap.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,1 @@\n-\/\/ These two should be removed. But requires som code to be cleaned up\n+\/\/ These two should be removed. But requires some code to be cleaned up\n@@ -50,1 +50,1 @@\n-\/\/ Contains maping between jsr targets and there return addresses. One-to-many mapping\n+\/\/ Contains mapping between jsr targets and there return addresses. One-to-many mapping\n@@ -307,1 +307,1 @@\n-  bool         _did_relocation;             \/\/ was relocation neccessary\n+  bool         _did_relocation;             \/\/ was relocation necessary\n@@ -417,1 +417,1 @@\n-  bool  _report_result_for_send;            \/\/ Unfortunatly, stackmaps for sends are special, so we need some extra\n+  bool  _report_result_for_send;            \/\/ Unfortunately, stackmaps for sends are special, so we need some extra\n@@ -453,1 +453,1 @@\n-  \/\/ Helper method. Can be used in subclasses to fx. calculate gc_points. If the current instuction\n+  \/\/ Helper method. Can be used in subclasses to fx. calculate gc_points. If the current instruction\n@@ -488,1 +488,1 @@\n-  \/\/   stackmaps for deadcode, fewer gc_points might have been encounted than assumed during the epilog. It is the\n+  \/\/   stackmaps for deadcode, fewer gc_points might have been encountered than assumed during the epilog. It is the\n@@ -546,1 +546,1 @@\n-\/\/ Subclass used by the compiler to generate pairing infomation\n+\/\/ Subclass used by the compiler to generate pairing information\n","filename":"src\/hotspot\/share\/oops\/generateOopMap.hpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -778,1 +778,1 @@\n-    \/\/ linking successfull, mark class as initialized\n+    \/\/ linking successful, mark class as initialized\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -151,1 +151,1 @@\n-    fully_initialized,                  \/\/ initialized (successfull final state)\n+    fully_initialized,                  \/\/ initialized (successful final state)\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -200,1 +200,1 @@\n-\/\/ \"Normal\" instantiation is preceeded by a MetaspaceObj allocation\n+\/\/ \"Normal\" instantiation is preceded by a MetaspaceObj allocation\n","filename":"src\/hotspot\/share\/oops\/klass.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1150,1 +1150,1 @@\n-  \/\/ There's alway an extra itable entry so we can null-terminate it.\n+  \/\/ There's always an extra itable entry so we can null-terminate it.\n@@ -1511,1 +1511,1 @@\n-  \/\/ There's alway an extra itable entry so we can null-terminate it.\n+  \/\/ There's always an extra itable entry so we can null-terminate it.\n","filename":"src\/hotspot\/share\/oops\/klassVtable.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -154,1 +154,1 @@\n-  \/\/ When loading a class from CDS archive at run time, and no class redefintion\n+  \/\/ When loading a class from CDS archive at run time, and no class redefinition\n","filename":"src\/hotspot\/share\/oops\/klassVtable.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -519,1 +519,1 @@\n-  \/\/ be excuted more than n times.\n+  \/\/ be executed more than n times.\n@@ -1003,1 +1003,1 @@\n-      \"post_event_flag mis-match\");\n+      \"post_event_flag mismatch\");\n@@ -1375,1 +1375,1 @@\n-    \/\/ This is an auxilary frame -- ignore it\n+    \/\/ This is an auxiliary frame -- ignore it\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -540,1 +540,1 @@\n-\/\/ case was taken and specify the data displacment for each branch target.\n+\/\/ case was taken and specify the data displacement for each branch target.\n","filename":"src\/hotspot\/share\/oops\/methodData.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -99,1 +99,1 @@\n-  \/\/ to accomodate a pointer or an integer.\n+  \/\/ to accommodate a pointer or an integer.\n@@ -1607,1 +1607,1 @@\n-\/\/ case was taken and specify the data displacment for each branch target.\n+\/\/ case was taken and specify the data displacement for each branch target.\n@@ -1881,1 +1881,1 @@\n-\/\/ intepretation, when a bytecode is encountered that has profile data\n+\/\/ interpretation, when a bytecode is encountered that has profile data\n","filename":"src\/hotspot\/share\/oops\/methodData.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -265,1 +265,1 @@\n-  assert(m.decode_pointer() == p, \"encoding must be reversable\");\n+  assert(m.decode_pointer() == p, \"encoding must be reversible\");\n@@ -272,1 +272,1 @@\n-  assert(m.decode_pointer() == p, \"encoding must be reversable\");\n+  assert(m.decode_pointer() == p, \"encoding must be reversible\");\n","filename":"src\/hotspot\/share\/oops\/oop.inline.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-\/\/              ^ increment on assignmnet\n+\/\/              ^ increment on assignment\n@@ -264,1 +264,1 @@\n-  \/\/ seperated by ', ' to the outputStream.  Prints external names as\n+  \/\/ separated by ', ' to the outputStream.  Prints external names as\n","filename":"src\/hotspot\/share\/oops\/symbol.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -339,1 +339,1 @@\n-    \/\/ The address is offseted to an aligned address where a raw copy would start.\n+    \/\/ The address is offsetted to an aligned address where a raw copy would start.\n","filename":"src\/hotspot\/share\/opto\/arraycopynode.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1086,1 +1086,1 @@\n-        \/\/ associated with registes (i.e. they are defs).\n+        \/\/ associated with registers (i.e. they are defs).\n","filename":"src\/hotspot\/share\/opto\/block.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,1 +90,1 @@\n-    return true; \/\/ constuctor\n+    return true; \/\/ constructor\n","filename":"src\/hotspot\/share\/opto\/bytecodeInfo.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -168,1 +168,1 @@\n-          \"Print CFG block freqencies\")                                     \\\n+          \"Print CFG block frequencies\")                                    \\\n@@ -337,1 +337,1 @@\n-          \"Globally supress vectorization set in VectorizeMethod\")          \\\n+          \"Globally suppress vectorization set in VectorizeMethod\")         \\\n@@ -532,1 +532,1 @@\n-          \"Miniumum %% of a successor (predecessor) for which block \"       \\\n+          \"Minimum %% of a successor (predecessor) for which block \"        \\\n@@ -633,1 +633,2 @@\n-          \"0 for no aliasing, 1 for oop\/field\/static\/array split, \"         \\\n+          \"(Deprecated) 0 for no aliasing, \"                                \\\n+          \"1 for oop\/field\/static\/array split, \"                            \\\n","filename":"src\/hotspot\/share\/opto\/c2_globals.hpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -419,1 +419,1 @@\n-  \/\/ expression stacks which causes late inlining to break. The MH invoker is not expected to be called from a method wih\n+  \/\/ expression stacks which causes late inlining to break. The MH invoker is not expected to be called from a method with\n","filename":"src\/hotspot\/share\/opto\/callGenerator.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1263,1 +1263,1 @@\n-    \/\/ represent the 2nd half ofthe long\/double.\n+    \/\/ represent the 2nd half of the long\/double.\n@@ -1652,1 +1652,1 @@\n-\/\/ Addtionally we can eliminate versions without the else case:\n+\/\/ Additionally we can eliminate versions without the else case:\n","filename":"src\/hotspot\/share\/opto\/callnode.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -207,1 +207,1 @@\n-  uint              _sp;        \/\/ Jave Expression Stack Pointer for this state\n+  uint              _sp;        \/\/ Java Expression Stack Pointer for this state\n","filename":"src\/hotspot\/share\/opto\/callnode.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1786,1 +1786,1 @@\n-\/\/  as dead loop when the phi references itselfs through an other phi.\n+\/\/  as dead loop when the phi references itself through an other phi.\n","filename":"src\/hotspot\/share\/opto\/cfgnode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -552,1 +552,1 @@\n-\/\/ CatchProjNode controls which exception handler is targetted after a call.\n+\/\/ CatchProjNode controls which exception handler is targeted after a call.\n","filename":"src\/hotspot\/share\/opto\/cfgnode.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -376,1 +376,1 @@\n-  \/\/ Veify the graph before RA.\n+  \/\/ Verify the graph before RA.\n@@ -596,1 +596,1 @@\n-  \/\/ Veify the graph after RA.\n+  \/\/ Verify the graph after RA.\n","filename":"src\/hotspot\/share\/opto\/chaitin.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -263,1 +263,1 @@\n-  \/\/ Add edge between a and b.  Returns true if actually addded.\n+  \/\/ Add edge between a and b.  Returns true if actually added.\n@@ -266,1 +266,1 @@\n-  \/\/ Test for edge existance\n+  \/\/ Test for edge existence\n","filename":"src\/hotspot\/share\/opto\/chaitin.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -164,0 +164,2 @@\n+macro(NoOvfDivI)\n+macro(NoOvfDivL)\n@@ -169,0 +171,2 @@\n+macro(NoOvfDivModI)\n+macro(NoOvfDivModL)\n@@ -237,0 +241,2 @@\n+macro(NoOvfModI)\n+macro(NoOvfModL)\n","filename":"src\/hotspot\/share\/opto\/classes.hpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -327,1 +327,1 @@\n-          \/\/ Check for name mis-match on the 2-address input\n+          \/\/ Check for name mismatch on the 2-address input\n","filename":"src\/hotspot\/share\/opto\/coalesce.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -251,0 +251,1 @@\n+    PhaseStringOpts::print_statistics();\n@@ -1837,1 +1838,1 @@\n-    PhaseStringOpts pso(initial_gvn(), for_igvn());\n+    PhaseStringOpts pso(initial_gvn());\n@@ -3509,0 +3510,5 @@\n+        } else {\n+          \/\/ replace a%b with a-((a\/b)*b)\n+          Node* mult = new MulINode(d, d->in(2));\n+          Node* sub  = new SubINode(d->in(1), mult);\n+          n->subsume_by(sub, this);\n@@ -3524,0 +3530,45 @@\n+        } else {\n+          \/\/ replace a%b with a-((a\/b)*b)\n+          Node* mult = new MulLNode(d, d->in(2));\n+          Node* sub  = new SubLNode(d->in(1), mult);\n+          n->subsume_by(sub, this);\n+        }\n+      }\n+    }\n+    break;\n+\n+  case Op_NoOvfModI:\n+    if (UseDivMod) {\n+      \/\/ Check if a%b and a\/b both exist\n+      Node* d = n->find_similar(Op_NoOvfDivI);\n+      if (d) {\n+        \/\/ Replace them with a fused divmod if supported\n+        if (Matcher::has_match_rule(Op_NoOvfDivModI)) {\n+          NoOvfDivModINode* divmod = NoOvfDivModINode::make(n);\n+          d->subsume_by(divmod->div_proj(), this);\n+          n->subsume_by(divmod->mod_proj(), this);\n+        } else {\n+          \/\/ replace a%b with a-((a\/b)*b)\n+          Node* mult = new MulINode(d, d->in(2));\n+          Node* sub  = new SubINode(d->in(1), mult);\n+          n->subsume_by(sub, this);\n+        }\n+      }\n+    }\n+    break;\n+\n+  case Op_NoOvfModL:\n+    if (UseDivMod) {\n+      \/\/ Check if a%b and a\/b both exist\n+      Node* d = n->find_similar(Op_NoOvfDivL);\n+      if (d) {\n+        \/\/ Replace them with a fused divmod if supported\n+        if (Matcher::has_match_rule(Op_NoOvfDivModL)) {\n+          NoOvfDivModLNode* divmod = NoOvfDivModLNode::make(n);\n+          d->subsume_by(divmod->div_proj(), this);\n+          n->subsume_by(divmod->mod_proj(), this);\n+        } else {\n+          \/\/ replace a%b with a-((a\/b)*b)\n+          Node* mult = new MulLNode(d, d->in(2));\n+          Node* sub  = new SubLNode(d->in(1), mult);\n+          n->subsume_by(sub, this);\n@@ -3913,1 +3964,1 @@\n-  \/\/ check if the optimizer has made it homogenous, item (3).\n+  \/\/ check if the optimizer has made it homogeneous, item (3).\n@@ -4280,1 +4331,1 @@\n-\/\/ _print_inlining_stream and transfered into the _print_inlining_list\n+\/\/ _print_inlining_stream and transferred into the _print_inlining_list\n@@ -4371,1 +4422,1 @@\n-  assert(!_print_inlining || _print_inlining_stream->size() == 0, \"loosing data\");\n+  assert(!_print_inlining || _print_inlining_stream->size() == 0, \"losing data\");\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":55,"deletions":4,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -1469,0 +1469,24 @@\n+\n+\/\/------------------------------make------------------------------------------\n+NoOvfDivModINode* NoOvfDivModINode::make(Node* div_or_mod) {\n+  Node* n = div_or_mod;\n+  assert(n->Opcode() == Op_NoOvfDivI || n->Opcode() == Op_NoOvfModI,\n+         \"only div or mod input pattern accepted\");\n+\n+  NoOvfDivModINode* divmod = new NoOvfDivModINode(n->in(0), n->in(1), n->in(2));\n+  Node*        dproj  = new ProjNode(divmod, DivModNode::div_proj_num);\n+  Node*        mproj  = new ProjNode(divmod, DivModNode::mod_proj_num);\n+  return divmod;\n+}\n+\n+\/\/------------------------------make------------------------------------------\n+NoOvfDivModLNode* NoOvfDivModLNode::make(Node* div_or_mod) {\n+  Node* n = div_or_mod;\n+  assert(n->Opcode() == Op_NoOvfDivL || n->Opcode() == Op_NoOvfModL,\n+         \"only div or mod input pattern accepted\");\n+\n+  NoOvfDivModLNode* divmod = new NoOvfDivModLNode(n->in(0), n->in(1), n->in(2));\n+  Node*        dproj  = new ProjNode(divmod, DivModNode::div_proj_num);\n+  Node*        mproj  = new ProjNode(divmod, DivModNode::mod_proj_num);\n+  return divmod;\n+}\n","filename":"src\/hotspot\/share\/opto\/divnode.cpp","additions":24,"deletions":0,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -106,1 +106,1 @@\n-\/\/------------------------------UDivLNode---------------------------------------\n+\/\/------------------------------UDivLNode--------------------------------------\n@@ -119,0 +119,18 @@\n+\/\/---------------------------NoOvfDivINode-------------------------------------\n+\/\/ Non-overflow integer division, UB when dividend == min_jint and divisor == -1\n+\/\/ so user has to ensure this combination does not appear\n+class NoOvfDivINode : public DivINode {\n+public:\n+  NoOvfDivINode( Node *c, Node *dividend, Node *divisor ) : DivINode(c, dividend, divisor ) {}\n+  virtual int Opcode() const;\n+};\n+\n+\/\/---------------------------NoOvfDivLNode-------------------------------------\n+\/\/ Non-overflow long division, UB when dividend == min_jlong and divisor == -1\n+\/\/ so user has to ensure this combination does not appear\n+class NoOvfDivLNode : public DivLNode {\n+public:\n+  NoOvfDivLNode( Node *c, Node *dividend, Node *divisor ) : DivLNode(c, dividend, divisor ) {}\n+  virtual int Opcode() const;\n+};\n+\n@@ -165,1 +183,1 @@\n-\/\/------------------------------UModINode---------------------------------------\n+\/\/------------------------------UModINode--------------------------------------\n@@ -176,1 +194,1 @@\n-\/\/------------------------------UModLNode---------------------------------------\n+\/\/------------------------------UModLNode--------------------------------------\n@@ -187,1 +205,19 @@\n-\/\/------------------------------DivModNode---------------------------------------\n+\/\/---------------------------NoOvfModINode-------------------------------------\n+\/\/ Non-overflow integer modulus, UB when dividend == min_jint and divisor == -1\n+\/\/ so user has to ensure this combination does not appear\n+class NoOvfModINode : public ModINode {\n+public:\n+  NoOvfModINode( Node *c, Node *dividend, Node *divisor ) : ModINode(c, dividend, divisor ) {}\n+  virtual int Opcode() const;\n+};\n+\n+\/\/---------------------------NoOvfModLNode-------------------------------------\n+\/\/ Non-overflow long modulus, UB when dividend == min_jlong and divisor == -1\n+\/\/ so user has to ensure this combination does not appear\n+class NoOvfModLNode : public ModLNode {\n+public:\n+  NoOvfModLNode( Node *c, Node *dividend, Node *divisor ) : ModLNode(c, dividend, divisor ) {}\n+  virtual int Opcode() const;\n+};\n+\n+\/\/-----------------------------DivModNode--------------------------------------\n@@ -209,1 +245,1 @@\n-\/\/------------------------------DivModINode---------------------------------------\n+\/\/-----------------------------DivModINode-------------------------------------\n@@ -222,1 +258,1 @@\n-\/\/------------------------------DivModLNode---------------------------------------\n+\/\/-----------------------------DivModLNode-------------------------------------\n@@ -236,1 +272,1 @@\n-\/\/------------------------------UDivModINode---------------------------------------\n+\/\/----------------------------UDivModINode-------------------------------------\n@@ -249,1 +285,1 @@\n-\/\/------------------------------UDivModLNode---------------------------------------\n+\/\/----------------------------UDivModLNode-------------------------------------\n@@ -262,0 +298,24 @@\n+\/\/---------------------------NoOvfDivModINode----------------------------------\n+\/\/ Non-overflow integer division with remainder result, UB when dividend == min_jint\n+\/\/ and divisor == -1 so user has to ensure this combination does not appear\n+class NoOvfDivModINode : public DivModINode {\n+public:\n+  NoOvfDivModINode( Node *c, Node *dividend, Node *divisor ) : DivModINode(c, dividend, divisor) {}\n+  virtual int Opcode() const;\n+\n+  \/\/ Make a divmod and associated projections from a div or mod.\n+  static NoOvfDivModINode* make(Node* div_or_mod);\n+};\n+\n+\/\/---------------------------NoOvfDivModLNode----------------------------------\n+\/\/ Non-overflow long division with remainder result, UB when dividend == min_jlong\n+\/\/ and divisor == -1 so user has to ensure this combination does not appear\n+class NoOvfDivModLNode : public DivModLNode {\n+public:\n+  NoOvfDivModLNode( Node *c, Node *dividend, Node *divisor ) : DivModLNode(c, dividend, divisor) {}\n+  virtual int Opcode() const;\n+\n+  \/\/ Make a divmod and associated projections from a div or mod.\n+  static NoOvfDivModLNode* make(Node* div_or_mod);\n+};\n+\n","filename":"src\/hotspot\/share\/opto\/divnode.hpp","additions":68,"deletions":8,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -529,1 +529,1 @@\n-      w->_child = &ntarjan[0];         \/\/ Sentinal\n+      w->_child = &ntarjan[0];         \/\/ Sentinel\n","filename":"src\/hotspot\/share\/opto\/domgraph.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -172,1 +172,1 @@\n-    \/\/ Collect some interesting nodes for futher use.\n+    \/\/ Collect some interesting nodes for further use.\n@@ -1557,1 +1557,1 @@\n-    \/\/ accessable by uses (loads) of fields of destination objects.\n+    \/\/ accessible by uses (loads) of fields of destination objects.\n","filename":"src\/hotspot\/share\/opto\/escape.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,1 +37,1 @@\n-\/\/          \"Escape Analysis for Java\", Procedings of ACM SIGPLAN\n+\/\/          \"Escape Analysis for Java\", Proceedings of ACM SIGPLAN\n","filename":"src\/hotspot\/share\/opto\/escape.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -514,1 +514,1 @@\n-  \/\/ In the comparision below, add one to account for the control input,\n+  \/\/ In the comparison below, add one to account for the control input,\n","filename":"src\/hotspot\/share\/opto\/gcm.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1203,1 +1203,1 @@\n-      \/\/ do not transfrom ccast here, it might convert to top node for\n+      \/\/ do not transform ccast here, it might convert to top node for\n@@ -1622,1 +1622,1 @@\n-                               Node* adr,   \/\/ actual adress to store val at\n+                               Node* adr,   \/\/ actual address to store val at\n@@ -1640,1 +1640,1 @@\n-Node* GraphKit::access_load(Node* adr,   \/\/ actual adress to load val at\n+Node* GraphKit::access_load(Node* adr,   \/\/ actual address to load val at\n","filename":"src\/hotspot\/share\/opto\/graphKit.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -592,1 +592,1 @@\n-                        Node* adr,   \/\/ actual adress to store val at\n+                        Node* adr,   \/\/ actual address to store val at\n@@ -600,1 +600,1 @@\n-                       Node* adr,   \/\/ actual adress to load val at\n+                       Node* adr,   \/\/ actual address to load val at\n@@ -606,1 +606,1 @@\n-  Node* access_load(Node* adr,   \/\/ actual adress to load val at\n+  Node* access_load(Node* adr,   \/\/ actual address to load val at\n","filename":"src\/hotspot\/share\/opto\/graphKit.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -459,0 +459,3 @@\n+    if (flags & Node::Flag_is_reduction) {\n+      print_prop(\"is_reduction\", \"true\");\n+    }\n","filename":"src\/hotspot\/share\/opto\/idealGraphPrinter.cpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -87,1 +87,1 @@\n-  \/\/ Delay gvn.tranform on if-nodes until construction is finished\n+  \/\/ Delay gvn.transform on if-nodes until construction is finished\n","filename":"src\/hotspot\/share\/opto\/idealKit.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -189,1 +189,1 @@\n-          tty->print_cr(\"Phi has use I cant be bothered with\");\n+          tty->print_cr(\"Phi has use I can't be bothered with\");\n@@ -1789,1 +1789,1 @@\n-  \/\/ CountedLoopEnds want the back-control test to be TRUE, irregardless of\n+  \/\/ CountedLoopEnds want the back-control test to be TRUE, regardless of\n","filename":"src\/hotspot\/share\/opto\/ifnode.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -279,1 +279,1 @@\n-        offset += tptr->_offset; \/\/ correct if base is offseted\n+        offset += tptr->_offset; \/\/ correct if base is offsetted\n@@ -631,1 +631,1 @@\n-        \/\/ now caculate its effect upon the graph if we did\n+        \/\/ now calculate its effect upon the graph if we did\n@@ -960,1 +960,1 @@\n-  \/\/ we know when a given instruction is avialable to be scheduled.\n+  \/\/ we know when a given instruction is available to be scheduled.\n","filename":"src\/hotspot\/share\/opto\/lcm.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -755,1 +755,1 @@\n-    set_control(top()); \/\/ No fast path instrinsic\n+    set_control(top()); \/\/ No fast path intrinsic\n@@ -1068,1 +1068,1 @@\n-  \/\/ length is now known postive, add a cast node to make this explicit\n+  \/\/ length is now known positive, add a cast node to make this explicit\n@@ -1589,1 +1589,1 @@\n-    ch = access_load_at(value, adr, TypeAryPtr::BYTES, TypeInt::CHAR, T_CHAR, IN_HEAP | MO_UNORDERED | C2_MISMATCHED | C2_CONTROL_DEPENDENT_LOAD);\n+    ch = access_load_at(value, adr, TypeAryPtr::BYTES, TypeInt::CHAR, T_CHAR, IN_HEAP | MO_UNORDERED | C2_MISMATCHED | C2_CONTROL_DEPENDENT_LOAD | C2_UNKNOWN_CONTROL_LOAD);\n@@ -2270,1 +2270,1 @@\n-  \/\/ contraint in place.\n+  \/\/ constraint in place.\n@@ -4478,1 +4478,1 @@\n-\/\/ unitialized array will escape the compiled method. To prevent that\n+\/\/ uninitialized array will escape the compiled method. To prevent that\n@@ -5752,1 +5752,1 @@\n-  assert(UseAdler32Intrinsics, \"Adler32 Instrinsic support need\"); \/\/ check if we actually need to check this flag or check a different one\n+  assert(UseAdler32Intrinsics, \"Adler32 Intrinsic support need\"); \/\/ check if we actually need to check this flag or check a different one\n@@ -5798,1 +5798,1 @@\n-  assert(UseAdler32Intrinsics, \"Adler32 Instrinsic support need\"); \/\/ check if we actually need to check this flag or check a different one\n+  assert(UseAdler32Intrinsics, \"Adler32 Intrinsic support need\"); \/\/ check if we actually need to check this flag or check a different one\n@@ -6288,1 +6288,1 @@\n-  \/\/ Intel's extention is based on this optimization and AESCrypt generates round keys by preprocessing MixColumns.\n+  \/\/ Intel's extension is based on this optimization and AESCrypt generates round keys by preprocessing MixColumns.\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,1 +90,1 @@\n-  \/\/ FastLock and FastUnlockNode do not hash, we need one for each correspoding\n+  \/\/ FastLock and FastUnlockNode do not hash, we need one for each corresponding\n@@ -116,1 +116,1 @@\n-  \/\/ FastLock and FastUnlockNode do not hash, we need one for each correspoding\n+  \/\/ FastLock and FastUnlockNode do not hash, we need one for each corresponding\n","filename":"src\/hotspot\/share\/opto\/locknode.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -148,1 +148,1 @@\n-    \/\/ Clonning the predicate to new location.\n+    \/\/ Cloning the predicate to new location.\n@@ -1534,1 +1534,1 @@\n-          \/\/     does not determine the execution the remining projs directly, and we\n+          \/\/     does not determine the execution the remaining projs directly, and we\n","filename":"src\/hotspot\/share\/opto\/loopPredicate.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -969,1 +969,1 @@\n-  \/\/ Summary of steps from inital loop to loop nest:\n+  \/\/ Summary of steps from initial loop to loop nest:\n@@ -1287,1 +1287,1 @@\n-      \/\/ If this causes problems in practice, we could maybe direct excution to a post-loop, instead of deoptimizing.\n+      \/\/ If this causes problems in practice, we could maybe direct execution to a post-loop, instead of deoptimizing.\n@@ -1714,1 +1714,1 @@\n-    \/\/ check if there is a possiblity of IV overflowing after the first increment\n+    \/\/ check if there is a possibility of IV overflowing after the first increment\n@@ -2236,0 +2236,1 @@\n+  if (is_reduction_loop()) st->print(\" reduction\");\n@@ -3937,0 +3938,1 @@\n+    if (cl->is_reduction_loop()) tty->print(\" reduction\");\n@@ -4847,1 +4849,1 @@\n-    \/\/ Only indices with a _dom_depth has a Node* or NULL (otherwise uninitalized).\n+    \/\/ Only indices with a _dom_depth has a Node* or NULL (otherwise uninitialized).\n@@ -5087,1 +5089,1 @@\n-          while( cfg->in(k) != m ) k++; \/\/ But check incase cfg is a Region\n+          while( cfg->in(k) != m ) k++; \/\/ But check in case cfg is a Region\n","filename":"src\/hotspot\/share\/opto\/loopnode.cpp","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1432,1 +1432,1 @@\n-\/\/ Tranform:\n+\/\/ Transform:\n","filename":"src\/hotspot\/share\/opto\/loopopts.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -262,1 +262,1 @@\n-  \/\/ index of the input which must match the output.  Not nessecary\n+  \/\/ index of the input which must match the output.  Not necessary\n@@ -264,2 +264,2 @@\n-  \/\/ same singleton regiser (e.g., Intel IDIV which binds AX to be\n-  \/\/ both an input and an output).  It is nessecary when the input and\n+  \/\/ same singleton register (e.g., Intel IDIV which binds AX to be\n+  \/\/ both an input and an output).  It is necessary when the input and\n","filename":"src\/hotspot\/share\/opto\/machnode.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -588,1 +588,1 @@\n-          NOT_PRODUCT(fail_eliminate = \"Undefined field referrence\";)\n+          NOT_PRODUCT(fail_eliminate = \"Undefined field reference\";)\n@@ -601,1 +601,1 @@\n-              NOT_PRODUCT(fail_eliminate = \"Not store field referrence\";)\n+              NOT_PRODUCT(fail_eliminate = \"Not store field reference\";)\n@@ -1024,1 +1024,1 @@\n-  \/\/ regardless scalar replacable status.\n+  \/\/ regardless scalar replaceable status.\n@@ -2124,1 +2124,1 @@\n-    \/\/ Seach for MemBarAcquireLock node and delete it also.\n+    \/\/ Search for MemBarAcquireLock node and delete it also.\n@@ -2141,1 +2141,1 @@\n-  \/\/ Seach for MemBarReleaseLock node and delete it also.\n+  \/\/ Search for MemBarReleaseLock node and delete it also.\n","filename":"src\/hotspot\/share\/opto\/macro.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2224,1 +2224,1 @@\n-    case Op_BoxLock:         \/\/ Cant match until we get stack-regs in ADLC\n+    case Op_BoxLock:         \/\/ Can't match until we get stack-regs in ADLC\n","filename":"src\/hotspot\/share\/opto\/matcher.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -382,1 +382,1 @@\n-  \/\/ initializations was removed. After macro-expansion all stores catched\n+  \/\/ initializations was removed. After macro-expansion all stores caught\n@@ -1512,1 +1512,1 @@\n-          t_oop->is_ptr_to_boxed_value()), \"invalide conditions\");\n+          t_oop->is_ptr_to_boxed_value()), \"invalid conditions\");\n","filename":"src\/hotspot\/share\/opto\/memnode.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,1 +58,1 @@\n-         OopStore               \/\/ Preceeding oop store, only in StoreCM\n+         OopStore               \/\/ Preceding oop store, only in StoreCM\n@@ -773,1 +773,1 @@\n-\/\/ Preceeding equivalent StoreCMs may be eliminated.\n+\/\/ Preceding equivalent StoreCMs may be eliminated.\n@@ -1172,1 +1172,1 @@\n-\/\/ Model.  Monitor-enter and volatile-load act as Aquires: no following ref\n+\/\/ Model.  Monitor-enter and volatile-load act as Acquires: no following ref\n@@ -1253,1 +1253,1 @@\n-\/\/ visibility.  Inserted independ of any load, as required\n+\/\/ visibility.  Inserted independent of any load, as required\n","filename":"src\/hotspot\/share\/opto\/memnode.hpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1022,1 +1022,1 @@\n-  \/\/ treatise in node.cpp above the default implemention AND TEST WITH\n+  \/\/ treatise in node.cpp above the default implementation AND TEST WITH\n","filename":"src\/hotspot\/share\/opto\/node.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -180,1 +180,1 @@\n-\/\/ so that a OptoReg->VMReg->OptoReg would reproduce ther original OptoReg. As it\n+\/\/ so that a OptoReg->VMReg->OptoReg would reproduce the original OptoReg. As it\n","filename":"src\/hotspot\/share\/opto\/optoreg.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1861,0 +1861,13 @@\n+      \/\/ print_metadata and dump_asm may safepoint which makes us loose the ttylock.\n+      \/\/ We call them first and write to a stringStream, then we retake the lock to\n+      \/\/ make sure the end tag is coherent, and that xmlStream->pop_tag is done thread safe.\n+      ResourceMark rm;\n+      stringStream method_metadata_str;\n+      if (C->method() != NULL) {\n+        C->method()->print_metadata(&method_metadata_str);\n+      }\n+      stringStream dump_asm_str;\n+      dump_asm_on(&dump_asm_str, node_offsets, node_offset_limit);\n+\n+      NoSafepointVerifier nsv;\n+      ttyLocker ttyl2;\n@@ -1870,1 +1883,1 @@\n-        C->method()->print_metadata();\n+        tty->print_raw(method_metadata_str.as_string());\n@@ -1876,1 +1889,1 @@\n-      dump_asm(node_offsets, node_offset_limit);\n+      tty->print_raw(dump_asm_str.as_string());\n@@ -1879,4 +1892,0 @@\n-        \/\/ print_metadata and dump_asm above may safepoint which makes us loose the ttylock.\n-        \/\/ Retake lock too make sure the end tag is coherent, and that xmlStream->pop_tag is done\n-        \/\/ thread safe\n-        ttyLocker ttyl2;\n","filename":"src\/hotspot\/share\/opto\/output.cpp","additions":15,"deletions":6,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -243,2 +243,0 @@\n-  uint              node_bundling_limit();\n-  Bundle*           node_bundling_base();\n@@ -256,1 +254,0 @@\n-  void dump_asm(int* pcs = NULL, uint pc_limit = 0) { dump_asm_on(tty, pcs, pc_limit); }\n@@ -259,1 +256,0 @@\n-  void dump_asm(int* pcs = NULL, uint pc_limit = 0) { return; }\n","filename":"src\/hotspot\/share\/opto\/output.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -465,1 +465,2 @@\n-  void do_one_bytecode();\n+  void do_one_bytecode_common();\n+  bool do_one_bytecode_targeted();\n@@ -537,0 +538,4 @@\n+  \/\/ implementation of div\/rem bytecodes for handling of special case\n+  \/\/ min_jint \/ -1\n+  void do_divmod_fixup();\n+\n","filename":"src\/hotspot\/share\/opto\/parse.hpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+#include \"jvm_io.h\"\n@@ -354,1 +355,1 @@\n-      \/\/ isn't precise enought to figure out that they are dead in all\n+      \/\/ isn't precise enough to figure out that they are dead in all\n@@ -1447,1 +1448,1 @@\n-  tty->print_cr(\"transforms: Average amount of tranform progress per bytecode compiled\");\n+  tty->print_cr(\"transforms: Average amount of transform progress per bytecode compiled\");\n@@ -1555,1 +1556,16 @@\n-    do_one_bytecode();\n+    \/\/ Try parsing machine-dependently, then if it is not needed then parse\n+    \/\/ the bytecode in a machine independent manner\n+    if (!do_one_bytecode_targeted()) {\n+      do_one_bytecode_common();\n+    }\n+#ifndef PRODUCT\n+    if (C->should_print_igv(1)) {\n+      IdealGraphPrinter* printer = C->igv_printer();\n+      char buffer[256];\n+      jio_snprintf(buffer, sizeof(buffer), \"Bytecode %d: %s\", bci(), Bytecodes::name(bc()));\n+      bool old = printer->traverse_outs();\n+      printer->set_traverse_outs(true);\n+      printer->print_method(buffer, 4);\n+      printer->set_traverse_outs(old);\n+    }\n+#endif\n","filename":"src\/hotspot\/share\/opto\/parse1.cpp","additions":20,"deletions":4,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -1335,1 +1335,1 @@\n-\/\/ classifed as untaken (by seems_never_taken), so really,\n+\/\/ classified as untaken (by seems_never_taken), so really,\n@@ -1805,1 +1805,1 @@\n-void Parse::do_one_bytecode() {\n+void Parse::do_one_bytecode_common() {\n@@ -2753,12 +2753,0 @@\n-\n-#ifndef PRODUCT\n-  if (C->should_print_igv(1)) {\n-    IdealGraphPrinter* printer = C->igv_printer();\n-    char buffer[256];\n-    jio_snprintf(buffer, sizeof(buffer), \"Bytecode %d: %s\", bci(), Bytecodes::name(bc()));\n-    bool old = printer->traverse_outs();\n-    printer->set_traverse_outs(true);\n-    printer->print_method(buffer, 4);\n-    printer->set_traverse_outs(old);\n-  }\n-#endif\n","filename":"src\/hotspot\/share\/opto\/parse2.cpp","additions":2,"deletions":14,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -436,0 +436,74 @@\n+\n+\/\/ On some architectures, a division cannot be done immediately due to\n+\/\/ the special case with min_jint \/ -1. As a result, we need to have\n+\/\/ special handling for this case\n+void Parse::do_divmod_fixup() {\n+  Bytecodes::Code bc = this->bc();\n+  BasicType bt = (bc == Bytecodes::_idiv || bc == Bytecodes::_irem) ? T_INT : T_LONG;\n+  \/\/ Operands need to stay in the stack during zero check\n+  if (bt == T_INT) {\n+    zero_check_int(peek(0));\n+  } else {\n+    zero_check_long(peek(1));\n+  }\n+  \/\/ Compile-time detection of arithmetic exception\n+  if (stopped()) {\n+    return;\n+  }\n+\n+  Node* in2 = (bt == T_INT) ? pop() : pop_pair();\n+  Node* in1 = (bt == T_INT) ? pop() : pop_pair();\n+\n+  auto generate_division = [](PhaseGVN& gvn, Node* control, Node* in1, Node* in2,\n+                              Bytecodes::Code bc) {\n+    switch (bc) {\n+      case Bytecodes::_idiv: return gvn.transform(new NoOvfDivINode(control, in1, in2));\n+      case Bytecodes::_ldiv: return gvn.transform(new NoOvfDivLNode(control, in1, in2));\n+      case Bytecodes::_irem: return gvn.transform(new NoOvfModINode(control, in1, in2));\n+      case Bytecodes::_lrem: return gvn.transform(new NoOvfModLNode(control, in1, in2));\n+      default:\n+        ShouldNotReachHere();\n+        return static_cast<Node*>(nullptr);\n+    }\n+  };\n+\n+  auto push_result = [](Parse& parser, Node* res, BasicType bt) {\n+    if (bt == T_INT) {\n+      parser.push(res);\n+    } else {\n+      parser.push_pair(res);\n+    }\n+  };\n+\n+  \/\/ No overflow possibility here\n+  if ((in1 == in2) ||\n+      (bt == T_INT  &&  !TypeInt::MIN->higher_equal(_gvn.type(in1))) ||\n+      (bt == T_LONG && !TypeLong::MIN->higher_equal(_gvn.type(in1)))) {\n+    Node* res = generate_division(_gvn, control(), in1, in2, bc);\n+    push_result(*this, res, bt);\n+    return;\n+  }\n+\n+  \/\/ The generated graph is equivalent to (in2 == -1) ? -in1 : (in1 \/ in2)\n+  \/\/ we need to have a separate branch for in2 == -1 due to the special\n+  \/\/ case of min_jint \/ -1\n+  Node* cmp = _gvn.transform(CmpNode::make(in2, _gvn.integercon(-1, bt), bt));\n+  Node* bol = Bool(cmp, BoolTest::eq);\n+  IfNode* iff = create_and_map_if(control(), bol, PROB_UNLIKELY_MAG(3), COUNT_UNKNOWN);\n+  Node* iff_true = IfTrue(iff);\n+  Node* iff_false = IfFalse(iff);\n+  Node* res_fast = (bc == Bytecodes::_idiv || bc == Bytecodes::_ldiv)\n+                   ? _gvn.transform(SubNode::make(_gvn.zerocon(bt), in1, bt))\n+                   : _gvn.zerocon(bt);\n+  Node* res_slow = generate_division(_gvn, iff_false, in1, in2, bc);\n+  Node* merge = new RegionNode(3);\n+  merge->init_req(1, iff_true);\n+  merge->init_req(2, iff_false);\n+  record_for_igvn(merge);\n+  set_control(_gvn.transform(merge));\n+  Node* res = new PhiNode(merge, Type::get_const_basic_type(bt));\n+  res->init_req(1, res_fast);\n+  res->init_req(2, res_slow);\n+  res = _gvn.transform(res);\n+  push_result(*this, res, bt);\n+}\n","filename":"src\/hotspot\/share\/opto\/parse3.cpp","additions":75,"deletions":1,"binary":false,"changes":76,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -602,1 +602,1 @@\n-      \/\/ rematerialized live ranges.  This happens alot to constants\n+      \/\/ rematerialized live ranges.  This happens a lot to constants\n@@ -774,1 +774,1 @@\n-          \/\/ ranges; they are busy getting modifed in this pass.\n+          \/\/ ranges; they are busy getting modified in this pass.\n@@ -813,1 +813,1 @@\n-      \/\/ ********** Handle Crossing HRP Boundry **********\n+      \/\/ ********** Handle Crossing HRP Boundary **********\n@@ -883,1 +883,1 @@\n-      }  \/\/ end if crossing HRP Boundry\n+      }  \/\/ end if crossing HRP Boundary\n","filename":"src\/hotspot\/share\/opto\/reg_split.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -435,1 +435,1 @@\n-        st->print(\",\");         \/\/ Seperate start of new run\n+        st->print(\",\");         \/\/ Separate start of new run\n","filename":"src\/hotspot\/share\/opto\/regmask.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,1 +94,1 @@\n-\/\/ Perfom node replacement (used when returning to caller)\n+\/\/ Perform node replacement (used when returning to caller)\n","filename":"src\/hotspot\/share\/opto\/replacednodes.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,2 +29,0 @@\n-#include \"opto\/addnode.hpp\"\n-#include \"opto\/callGenerator.hpp\"\n@@ -32,1 +30,0 @@\n-#include \"opto\/divnode.hpp\"\n@@ -38,2 +35,1 @@\n-#include \"opto\/subnode.hpp\"\n-#include \"runtime\/sharedRuntime.hpp\"\n+#include \"runtime\/atomic.hpp\"\n@@ -47,1 +43,0 @@\n-  Node*               _string_alloc;\n@@ -74,1 +69,0 @@\n-    _string_alloc(NULL),\n@@ -85,23 +79,0 @@\n-  void merge_add() {\n-#if 0\n-    \/\/ XXX This is place holder code for reusing an existing String\n-    \/\/ allocation but the logic for checking the state safety is\n-    \/\/ probably inadequate at the moment.\n-    CallProjections endprojs;\n-    sc->end()->extract_projections(&endprojs, false);\n-    if (endprojs.resproj != NULL) {\n-      for (SimpleDUIterator i(endprojs.resproj); i.has_next(); i.next()) {\n-        CallStaticJavaNode *use = i.get()->isa_CallStaticJava();\n-        if (use != NULL && use->method() != NULL &&\n-            use->method()->intrinsic_id() == vmIntrinsics::_String_String &&\n-            use->in(TypeFunc::Parms + 1) == endprojs.resproj) {\n-          \/\/ Found useless new String(sb.toString()) so reuse the newly allocated String\n-          \/\/ when creating the result instead of allocating a new one.\n-          sc->set_string_alloc(use->in(TypeFunc::Parms));\n-          sc->set_end(use);\n-        }\n-      }\n-    }\n-#endif\n-  }\n-\n@@ -212,1 +183,0 @@\n-  Node* string_alloc() { return _string_alloc; }\n@@ -221,4 +191,1 @@\n-      log->head(\"replace_string_concat arguments='%d' string_alloc='%d' multiple='%d'\",\n-                num_arguments(),\n-                _string_alloc != NULL,\n-                _multiple);\n+      log->head(\"replace_string_concat arguments='%d' multiple='%d'\", num_arguments(), _multiple);\n@@ -417,0 +384,1 @@\n+  uint encountered = 0;\n@@ -422,0 +390,1 @@\n+      encountered++;\n@@ -434,0 +403,3 @@\n+#ifndef PRODUCT\n+  Atomic::add(&_stropts_total, encountered);\n+#endif\n@@ -437,1 +409,22 @@\n-\n+\/\/ Recognize a fluent-chain of StringBuilder\/Buffer. They are either explicit usages\n+\/\/ of them or the legacy bytecodes of string concatenation prior to JEP-280. eg.\n+\/\/\n+\/\/ String result = new StringBuilder()\n+\/\/   .append(\"foo\")\n+\/\/   .append(\"bar\")\n+\/\/   .append(123)\n+\/\/   .toString(); \/\/ \"foobar123\"\n+\/\/\n+\/\/ PS: Only a certain subset of constructor and append methods are acceptable.\n+\/\/ The criterion is that the length of argument is easy to work out in this phrase.\n+\/\/ It will drop complex cases such as Object.\n+\/\/\n+\/\/ Since it walks along the receivers of fluent-chain, it will give up if the codeshape is\n+\/\/ not \"fluent\" enough. eg.\n+\/\/   StringBuilder sb = new StringBuilder();\n+\/\/   sb.append(\"foo\");\n+\/\/   sb.toString();\n+\/\/\n+\/\/ The receiver of toString method is the result of Allocation Node(CheckCastPP).\n+\/\/ The append method is overlooked. It will fail at validate_control_flow() test.\n+\/\/\n@@ -462,1 +455,0 @@\n-\n@@ -464,1 +456,0 @@\n-  InitializeNode* init = NULL;\n@@ -641,1 +632,1 @@\n-PhaseStringOpts::PhaseStringOpts(PhaseGVN* gvn, Unique_Node_List*):\n+PhaseStringOpts::PhaseStringOpts(PhaseGVN* gvn):\n@@ -694,0 +685,1 @@\n+              Atomic::inc(&_stropts_merged);\n@@ -759,1 +751,1 @@\n-        \/\/ Recurisvely clean up references to CreateEx so EA doesn't\n+        \/\/ Recursively clean up references to CreateEx so EA doesn't\n@@ -1765,1 +1757,1 @@\n-  \/\/ new starting state.  This allows any preceeding tests to feed\n+  \/\/ new starting state.  This allows any preceding tests to feed\n@@ -2034,3 +2026,1 @@\n-    \/\/ If we're not reusing an existing String allocation then allocate one here.\n-    result = sc->string_alloc();\n-    if (result == NULL) {\n+    {\n@@ -2063,0 +2053,3 @@\n+#ifndef PRODUCT\n+  Atomic::inc(&_stropts_replaced);\n+#endif\n@@ -2064,0 +2057,10 @@\n+\n+#ifndef PRODUCT\n+uint PhaseStringOpts::_stropts_replaced = 0;\n+uint PhaseStringOpts::_stropts_merged = 0;\n+uint PhaseStringOpts::_stropts_total = 0;\n+\n+void PhaseStringOpts::print_statistics() {\n+  tty->print_cr(\"StringConcat: %4d\/%4d\/%4d(replaced\/merged\/total)\", _stropts_replaced, _stropts_merged, _stropts_total);\n+}\n+#endif\n","filename":"src\/hotspot\/share\/opto\/stringopts.cpp","additions":48,"deletions":45,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -115,1 +115,9 @@\n-  PhaseStringOpts(PhaseGVN* gvn, Unique_Node_List* worklist);\n+  PhaseStringOpts(PhaseGVN* gvn);\n+\n+#ifndef PRODUCT\n+  static void print_statistics();\n+ private:\n+  static uint _stropts_replaced;\n+  static uint _stropts_merged;\n+  static uint _stropts_total;\n+#endif\n","filename":"src\/hotspot\/share\/opto\/stringopts.hpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -379,1 +379,1 @@\n-\/\/ implemention on most chips.  Since a naive graph involves control flow, we\n+\/\/ implementation on most chips.  Since a naive graph involves control flow, we\n@@ -391,1 +391,1 @@\n-\/\/ implemention on most chips.  Since a naive graph involves control flow, we\n+\/\/ implementation on most chips.  Since a naive graph involves control flow, we\n","filename":"src\/hotspot\/share\/opto\/subnode.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -418,1 +418,1 @@\n-\/\/    This simplies the upcoming \"independence\" checker.\n+\/\/    This simplifies the upcoming \"independence\" checker.\n@@ -2128,1 +2128,1 @@\n-  \/\/ remove current_store from its current position in the memmory graph\n+  \/\/ remove current_store from its current position in the memory graph\n","filename":"src\/hotspot\/share\/opto\/superword.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -478,1 +478,1 @@\n-  \/\/ rebuild the graph so all loads in different iterations of cloned loop become dependant on phi node (in _do_vector_loop only)\n+  \/\/ rebuild the graph so all loads in different iterations of cloned loop become dependent on phi node (in _do_vector_loop only)\n","filename":"src\/hotspot\/share\/opto\/superword.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1441,1 +1441,1 @@\n-\/\/ Convience common pre-built types.\n+\/\/ Convenience common pre-built types.\n@@ -1612,1 +1612,1 @@\n-    return this;                \/\/ doesn't narrow; pretty wierd\n+    return this;                \/\/ doesn't narrow; pretty weird\n@@ -1878,1 +1878,1 @@\n-    return this;                \/\/ doesn't narrow; pretty wierd\n+    return this;                \/\/ doesn't narrow; pretty weird\n@@ -3457,1 +3457,1 @@\n-    \/\/ but this assertion here is to help prevent its occurence.\n+    \/\/ but this assertion here is to help prevent its occurrence.\n@@ -4944,1 +4944,1 @@\n-    \/\/ but this assertion here is to help prevent its occurence.\n+    \/\/ but this assertion here is to help prevent its occurrence.\n@@ -5176,1 +5176,1 @@\n-    \/\/ but this assertion here is to help prevent its occurence.\n+    \/\/ but this assertion here is to help prevent its occurrence.\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -819,1 +819,1 @@\n-  \/\/ MODE_BROADCAST for vector Vector.boradcast and VectorMask.maskAll operations.\n+  \/\/ MODE_BROADCAST for vector Vector.broadcast and VectorMask.maskAll operations.\n","filename":"src\/hotspot\/share\/opto\/vectorIntrinsics.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -344,1 +344,1 @@\n-  \/\/ Adding a pessimistic check to avoid complex pattern mathing which\n+  \/\/ Adding a pessimistic check to avoid complex pattern matching which\n","filename":"src\/hotspot\/share\/opto\/vectornode.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -655,1 +655,1 @@\n-\/\/ Support for the Forte(TM) Peformance Tools collector.\n+\/\/ Support for the Forte(TM) Performance Tools collector.\n","filename":"src\/hotspot\/share\/prims\/forte.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -111,1 +111,1 @@\n-\/\/ since those macros can cause an immedate uninstrumented return.\n+\/\/ since those macros can cause an immediate uninstrumented return.\n@@ -114,1 +114,1 @@\n-\/\/ the return value must be passed to the contructor of the object, and\n+\/\/ the return value must be passed to the constructor of the object, and\n","filename":"src\/hotspot\/share\/prims\/jni.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,1 @@\n-\/\/ the code, and transtition back.  The ThreadInVMfromNative constructor\n+\/\/ the code, and transition back.  The ThreadInVMfromNative constructor\n","filename":"src\/hotspot\/share\/prims\/jniCheck.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1493,1 +1493,1 @@\n-  \/\/ Return null for arrays and primatives\n+  \/\/ Return null for arrays and primitives\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -4,1 +4,1 @@\n- Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -14381,1 +14381,1 @@\n-      Remove GetObjectWithAnnotation since tests show bufferred approach more efficient.\n+      Remove GetObjectWithAnnotation since tests show buffered approach more efficient.\n@@ -14662,1 +14662,1 @@\n-  <change date=\"16 Febuary 2004\" version=\"0.2.103\">\n+  <change date=\"16 February 2004\" version=\"0.2.103\">\n@@ -14665,1 +14665,1 @@\n-  <change date=\"17 Febuary 2004\" version=\"0.2.105\">\n+  <change date=\"17 February 2004\" version=\"0.2.105\">\n@@ -14670,1 +14670,1 @@\n-  <change date=\"18 Febuary 2004\" version=\"0.3.6\">\n+  <change date=\"18 February 2004\" version=\"0.3.6\">\n@@ -14674,1 +14674,1 @@\n-  <change date=\"18 Febuary 2004\" version=\"0.3.7\">\n+  <change date=\"18 February 2004\" version=\"0.3.7\">\n@@ -14678,1 +14678,1 @@\n-  <change date=\"19 Febuary 2004\" version=\"0.3.8\">\n+  <change date=\"19 February 2004\" version=\"0.3.8\">\n@@ -14682,1 +14682,1 @@\n-  <change date=\"23 Febuary 2004\" version=\"0.3.9\">\n+  <change date=\"23 February 2004\" version=\"0.3.9\">\n@@ -14685,1 +14685,1 @@\n-  <change date=\"24 Febuary 2004\" version=\"0.3.10\">\n+  <change date=\"24 February 2004\" version=\"0.3.10\">\n@@ -14695,1 +14695,1 @@\n-  <change date=\"28 Febuary 2004\" version=\"0.3.11\">\n+  <change date=\"28 February 2004\" version=\"0.3.11\">\n","filename":"src\/hotspot\/share\/prims\/jvmti.xml","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -366,1 +366,1 @@\n-\/\/ to do is add the attrubute name and fill in the length.\n+\/\/ to do is add the attribute name and fill in the length.\n","filename":"src\/hotspot\/share\/prims\/jvmtiClassFileReconstituter.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2005, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -97,1 +97,1 @@\n-                line = \"\"; \/\/ so error does not look wierd\n+                line = \"\"; \/\/ so error does not look weird\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvFill.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -301,1 +301,1 @@\n-  \/\/ - SINGLE_STEP event reenabled\n+  \/\/ - SINGLE_STEP event re-enabled\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvThreadState.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1034,1 +1034,1 @@\n-  \/\/ tries to access nonexistant services.\n+  \/\/ tries to access nonexistent services.\n@@ -2612,1 +2612,1 @@\n-  \/\/ The abs paramter should be \"true\" or \"false\"\n+  \/\/ The abs parameter should be \"true\" or \"false\"\n","filename":"src\/hotspot\/share\/prims\/jvmtiExport.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -360,1 +360,1 @@\n-  \/\/ similiar to post_dynamic_code_generated except that it can be used to\n+  \/\/ similar to post_dynamic_code_generated except that it can be used to\n","filename":"src\/hotspot\/share\/prims\/jvmtiExport.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-  \/\/ JVMTI_RM_MAGIC is set in contructor and unset in destructor.\n+  \/\/ JVMTI_RM_MAGIC is set in constructor and unset in destructor.\n","filename":"src\/hotspot\/share\/prims\/jvmtiRawMonitor.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1225,1 +1225,1 @@\n-\/\/ by seaching the index map. Returns zero (0) if there is no mapped\n+\/\/ by searching the index map. Returns zero (0) if there is no mapped\n@@ -1251,1 +1251,1 @@\n-\/\/ value by seaching the index map. Returns unused index (-1) if there is\n+\/\/ value by searching the index map. Returns unused index (-1) if there is\n","filename":"src\/hotspot\/share\/prims\/jvmtiRedefineClasses.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -979,1 +979,1 @@\n-  \/\/ then don't invoke the callback. Similiarly, if the object is untagged\n+  \/\/ then don't invoke the callback. Similarly, if the object is untagged\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -136,1 +136,1 @@\n-  \/\/ is event_type enabled and usable for this thread in any enviroments?\n+  \/\/ is event_type enabled and usable for this thread in any environment?\n","filename":"src\/hotspot\/share\/prims\/jvmtiThreadState.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -120,1 +120,1 @@\n-\/ is a digit 0..3, or if the first character after an injected '_' seperator\n+\/ is a digit 0..3, or if the first character after an injected '_' separator\n@@ -258,1 +258,1 @@\n-  \/\/ gets found the first time around - otherwise an infinite loop can occure. This is\n+  \/\/ gets found the first time around - otherwise an infinite loop can occur. This is\n@@ -377,1 +377,1 @@\n-\/\/ If any are found, remove them before attemping the look up of the\n+\/\/ If any are found, remove them before attempting the look up of the\n","filename":"src\/hotspot\/share\/prims\/nativeLookup.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -655,1 +655,1 @@\n-\/\/ Alloc memory with pseudo call stack. The test can create psudo malloc\n+\/\/ Alloc memory with pseudo call stack. The test can create pseudo malloc\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -545,0 +545,1 @@\n+  { \"AliasLevel\",                   JDK_Version::jdk(19), JDK_Version::jdk(20), JDK_Version::jdk(21) },\n@@ -1763,0 +1764,12 @@\n+    reasonable_max = limit_heap_by_allocatable_memory(reasonable_max);\n+\n+    if (!FLAG_IS_DEFAULT(InitialHeapSize)) {\n+      \/\/ An initial heap size was specified on the command line,\n+      \/\/ so be sure that the maximum size is consistent.  Done\n+      \/\/ after call to limit_heap_by_allocatable_memory because that\n+      \/\/ method might reduce the allocation size.\n+      reasonable_max = MAX2(reasonable_max, (julong)InitialHeapSize);\n+    } else if (!FLAG_IS_DEFAULT(MinHeapSize)) {\n+      reasonable_max = MAX2(reasonable_max, (julong)MinHeapSize);\n+    }\n+\n@@ -1809,12 +1822,0 @@\n-    reasonable_max = limit_heap_by_allocatable_memory(reasonable_max);\n-\n-    if (!FLAG_IS_DEFAULT(InitialHeapSize)) {\n-      \/\/ An initial heap size was specified on the command line,\n-      \/\/ so be sure that the maximum size is consistent.  Done\n-      \/\/ after call to limit_heap_by_allocatable_memory because that\n-      \/\/ method might reduce the allocation size.\n-      reasonable_max = MAX2(reasonable_max, (julong)InitialHeapSize);\n-    } else if (!FLAG_IS_DEFAULT(MinHeapSize)) {\n-      reasonable_max = MAX2(reasonable_max, (julong)MinHeapSize);\n-    }\n-\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":13,"deletions":12,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -136,1 +136,1 @@\n-  \/\/ Acount first for the adjustment of the initial frame\n+  \/\/ Account first for the adjustment of the initial frame\n@@ -2712,1 +2712,1 @@\n-  \/\/ no udpate\n+  \/\/ no update\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,1 @@\n-\/\/ Only materialize src code for contraint checking when required, ignore otherwise\n+\/\/ Only materialize src code for constraint checking when required, ignore otherwise\n","filename":"src\/hotspot\/share\/runtime\/globals_shared.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -122,1 +122,1 @@\n-  \/\/ on sparc\/ia64 which will catch violations of the reseting of last_Java_frame\n+  \/\/ on sparc\/ia64 which will catch violations of the resetting of last_Java_frame\n@@ -377,1 +377,1 @@\n-  \/\/ When we reenter Java, we need to reenable the reserved\/yellow zone which\n+  \/\/ When we reenter Java, we need to re-enable the reserved\/yellow zone which\n","filename":"src\/hotspot\/share\/runtime\/javaCalls.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -148,1 +148,1 @@\n-    assert(!is_jweak(handle), \"wrong method for detroying jweak\");\n+    assert(!is_jweak(handle), \"wrong method for destroying jweak\");\n","filename":"src\/hotspot\/share\/runtime\/jniHandles.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n-\/\/ breakpoints inside registred MXBean notification listeners.\n+\/\/ breakpoints inside registered MXBean notification listeners.\n","filename":"src\/hotspot\/share\/runtime\/notificationThread.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -95,1 +95,1 @@\n-\/\/ there is an inherent resemblence between TSO and acquire\/release\n+\/\/ there is an inherent resemblance between TSO and acquire\/release\n","filename":"src\/hotspot\/share\/runtime\/orderAccess.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -644,1 +644,1 @@\n-  \/\/ On malloc(0), implementators of malloc(3) have the choice to return either\n+  \/\/ On malloc(0), implementations of malloc(3) have the choice to return either\n@@ -691,1 +691,1 @@\n-  \/\/ On realloc(p, 0), implementators of realloc(3) have the choice to return either\n+  \/\/ On realloc(p, 0), implementers of realloc(3) have the choice to return either\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -249,1 +249,1 @@\n-    \/\/ in place until called after initialization has ocurred.\n+    \/\/ in place until called after initialization has occurred.\n@@ -553,1 +553,0 @@\n-  static int available(int fd, jlong *bytes);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n-\/\/ events, oop storage cleanup, and the maintainance of string, symbol,\n+\/\/ events, oop storage cleanup, and the maintenance of string, symbol,\n","filename":"src\/hotspot\/share\/runtime\/serviceThread.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2088,1 +2088,1 @@\n-  \/\/ add 3 for parenthesis and preceeding space\n+  \/\/ add 3 for parenthesis and preceding space\n@@ -2921,1 +2921,1 @@\n-  \/\/ debugging suppport\n+  \/\/ debugging support\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -285,1 +285,1 @@\n-  \/\/ used by native wrappers to reenable yellow if overflow happened in native code\n+  \/\/ used by native wrappers to re-enable yellow if overflow happened in native code\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,1 +71,1 @@\n- *      y[]     ouput result in an array of double precision numbers.\n+ *      y[]     output result in an array of double precision numbers.\n@@ -90,1 +90,1 @@\n- *      prec    an interger indicating the precision:\n+ *      prec    an integer indicating the precision:\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntimeTrig.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -295,1 +295,1 @@\n-  \/\/ note: name is cooridnated with launcher and Arguments.cpp\n+  \/\/ note: name is coordinated with launcher and Arguments.cpp\n","filename":"src\/hotspot\/share\/runtime\/statSampler.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,1 @@\n-  \/\/ Make the task deactive\n+  \/\/ Make the task inactivate\n","filename":"src\/hotspot\/share\/runtime\/task.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1350,1 +1350,1 @@\n-  \/\/ VM->Java transistions are not cleared, it is expected that JNI code enclosed\n+  \/\/ VM->Java transitions are not cleared, it is expected that JNI code enclosed\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -331,1 +331,1 @@\n-  \/\/ Ensure to be 'inside' the expresion stack (i.e., addr >= sp for Intel).\n+  \/\/ Ensure to be 'inside' the expression stack (i.e., addr >= sp for Intel).\n@@ -627,1 +627,1 @@\n-  tty->print_cr(\"C Chunk inbetween Java\");\n+  tty->print_cr(\"C Chunk in between Java\");\n","filename":"src\/hotspot\/share\/runtime\/vframe.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -154,1 +154,1 @@\n-      \/\/ Do not rely on scopeDesc since the pc might be unprecise due to the _last_native_pc trick.\n+      \/\/ Do not rely on scopeDesc since the pc might be imprecise due to the _last_native_pc trick.\n@@ -230,1 +230,1 @@\n-  \/\/ no Java-level information is yet available (e.g., becasue\n+  \/\/ no Java-level information is yet available (e.g., because\n","filename":"src\/hotspot\/share\/runtime\/vframe.inline.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -399,1 +399,1 @@\n-  \/\/ Alway will need at least one, must be on C heap\n+  \/\/ Always will need at least one, must be on C heap\n","filename":"src\/hotspot\/share\/runtime\/vframe_hp.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1583,0 +1583,2 @@\n+  declare_c2_type(NoOvfDivINode, DivINode)                                \\\n+  declare_c2_type(NoOvfDivLNode, DivLNode)                                \\\n@@ -1589,0 +1591,2 @@\n+  declare_c2_type(NoOvfModINode, ModINode)                                \\\n+  declare_c2_type(NoOvfModLNode, ModLNode)                                \\\n@@ -1594,0 +1598,2 @@\n+  declare_c2_type(NoOvfDivModINode, DivModINode)                          \\\n+  declare_c2_type(NoOvfDivModLNode, DivModLNode)                          \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -698,1 +698,1 @@\n-    \/\/ agruments explicitly set by user. All arguments passed\n+    \/\/ arguments explicitly set by user. All arguments passed\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -579,1 +579,1 @@\n-    assert(Bytes::get_Java_u4((address)(buffer() + 5)) == len, \"Inconsitent size!\");\n+    assert(Bytes::get_Java_u4((address)(buffer() + 5)) == len, \"Inconsistent size!\");\n@@ -584,1 +584,1 @@\n-    \/\/ Finish the current segement and try again.\n+    \/\/ Finish the current segment and try again.\n@@ -667,1 +667,1 @@\n-    assert(_tail->_next == NULL, \"Bufer queue is polluted\");\n+    assert(_tail->_next == NULL, \"Buffer queue is polluted\");\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,1 @@\n-         \"Already initailized\");\n+         \"Already initialized\");\n","filename":"src\/hotspot\/share\/services\/mallocSiteTable.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -106,1 +106,1 @@\n-  \/\/ Currently, (number of buckets \/ number of entires) ratio is\n+  \/\/ Currently, (number of buckets \/ number of entries) ratio is\n","filename":"src\/hotspot\/share\/services\/mallocSiteTable.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -366,1 +366,1 @@\n-      \/\/ already indicates that the region is comitted.\n+      \/\/ already indicates that the region is committed.\n","filename":"src\/hotspot\/share\/services\/memReporter.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -216,1 +216,1 @@\n-  \/\/ Virutal memory reservation site comparison\n+  \/\/ Virtual memory reservation site comparison\n","filename":"src\/hotspot\/share\/services\/memReporter.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -128,1 +128,1 @@\n-  \/\/ chuncks that backing up the arena.\n+  \/\/ chunks that are backing up the arena.\n","filename":"src\/hotspot\/share\/services\/memTracker.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3,1 +3,1 @@\n-* Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+* Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,2 +94,2 @@\n-      \/\/ There is no obvious benefits in allowing the thread table\n-      \/\/ to be concurently populated during the initalization.\n+      \/\/ There is no obvious benefit in allowing the thread table\n+      \/\/ to be concurrently populated during initialization.\n","filename":"src\/hotspot\/share\/services\/threadIdTable.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,1 +91,1 @@\n-      \/\/ If old_size_in_bits is not word-aligned, then the preceeding\n+      \/\/ If old_size_in_bits is not word-aligned, then the preceding\n","filename":"src\/hotspot\/share\/utilities\/bitMap.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -193,1 +193,1 @@\n-  \/\/ Old bits are transfered to the new memory\n+  \/\/ Old bits are transferred to the new memory\n@@ -373,1 +373,1 @@\n-  \/\/ Old bits are transfered to the new memory\n+  \/\/ Old bits are transferred to the new memory\n@@ -418,1 +418,1 @@\n-  \/\/ Old bits are transfered to the new memory\n+  \/\/ Old bits are transferred to the new memory\n","filename":"src\/hotspot\/share\/utilities\/bitMap.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -213,1 +213,1 @@\n-        ? to_words_align_down(r_index) \/\/ Miniscule savings when aligned.\n+        ? to_words_align_down(r_index) \/\/ Minuscule savings when aligned.\n","filename":"src\/hotspot\/share\/utilities\/bitMap.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -485,1 +485,1 @@\n-  \/\/ Calcuate statistics. Item sizes are calculated with VALUE_SIZE_FUNC.\n+  \/\/ Calculate statistics. Item sizes are calculated with VALUE_SIZE_FUNC.\n","filename":"src\/hotspot\/share\/utilities\/concurrentHashTable.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -417,1 +417,1 @@\n-  \/\/ Actually we look through all CodeBlobs (the nm name has been kept for backwards compatability)\n+  \/\/ Actually we look through all CodeBlobs (the nm name has been kept for backwards compatibility)\n@@ -496,1 +496,1 @@\n-      \/\/ Does it point into a known mmaped region?\n+      \/\/ Does it point into a known mmapped region?\n","filename":"src\/hotspot\/share\/utilities\/debug.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n- * on a system that doesn't support dtrace or because we're bulding a variant\n+ * on a system that doesn't support dtrace or because we're building a variant\n","filename":"src\/hotspot\/share\/utilities\/dtrace_disabled.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -237,1 +237,1 @@\n-  \/\/ Now read the .opd section wich contains the PPC64 function descriptor table.\n+  \/\/ Now read the .opd section which contains the PPC64 function descriptor table.\n","filename":"src\/hotspot\/share\/utilities\/elfFile.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,1 +55,1 @@\n-      \/\/ We need to go another step trough the function descriptor table (currently PPC64 only)\n+      \/\/ We need to go another step through the function descriptor table (currently PPC64 only)\n","filename":"src\/hotspot\/share\/utilities\/elfSymbolTable.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,1 +37,1 @@\n-\/\/ This facility is extremly useful for post-mortem debugging. The eventlog\n+\/\/ This facility is extremely useful for post-mortem debugging. The eventlog\n","filename":"src\/hotspot\/share\/utilities\/events.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -119,1 +119,1 @@\n-      \/\/ atleast an informative message.\n+      \/\/ at least an informative message.\n","filename":"src\/hotspot\/share\/utilities\/exceptions.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-  \/\/ counter is on a seperate cacheline.\n+  \/\/ counter is on a separate cacheline.\n","filename":"src\/hotspot\/share\/utilities\/globalCounter.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -281,1 +281,1 @@\n-\/\/ The caller is responsible for considering overlow.\n+\/\/ The caller is responsible for considering overflow.\n@@ -475,1 +475,1 @@\n-\/\/ Unsigned one, two, four and eigth byte quantities used for describing\n+\/\/ Unsigned one, two, four and eight byte quantities used for describing\n@@ -959,1 +959,1 @@\n-  _thread_new_trans         =  3, \/\/ corresponding transition state (not used, included for completness)\n+  _thread_new_trans         =  3, \/\/ corresponding transition state (not used, included for completeness)\n@@ -965,1 +965,1 @@\n-  _thread_in_Java_trans     =  9, \/\/ corresponding transition state (not used, included for completness)\n+  _thread_in_Java_trans     =  9, \/\/ corresponding transition state (not used, included for completeness)\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -135,1 +135,1 @@\n-\/\/ For function\/method defintions, the more common placement BEFORE the\n+\/\/ For function\/method definitions, the more common placement BEFORE the\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions_xlc.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -569,1 +569,1 @@\n- * Returns 0 if EOS is encoutered.\n+ * Returns 0 if EOS is encountered.\n","filename":"src\/hotspot\/share\/utilities\/json.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,1 +91,1 @@\n-      \/\/ CAS even on empty pop, for consistent membar bahavior.\n+      \/\/ CAS even on empty pop, for consistent membar behavior.\n","filename":"src\/hotspot\/share\/utilities\/lockFreeStack.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-\/\/ concatenation is performed.  Note: One auxilliary level ought to be\n+\/\/ concatenation is performed.  Note: One auxiliary level ought to be\n","filename":"src\/hotspot\/share\/utilities\/macros.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,1 +65,1 @@\n-  \/\/ The preceeding multiply by z_ones is the only place where the intermediate\n+  \/\/ The preceding multiply by z_ones is the only place where the intermediate\n","filename":"src\/hotspot\/share\/utilities\/population_count.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -120,1 +120,1 @@\n-    \/\/ Switch \"idempotent\" from function paramter to template parameter\n+    \/\/ Switch \"idempotent\" from function parameter to template parameter\n","filename":"src\/hotspot\/share\/utilities\/quickSort.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -66,1 +66,1 @@\n-  \/\/ and returns the end of the current utf8 chararacter.\n+  \/\/ and returns the end of the current utf8 character.\n@@ -71,1 +71,1 @@\n-  \/\/ stores the result in value, and returns the end of the current utf8 chararacter.\n+  \/\/ stores the result in value, and returns the end of the current utf8 character.\n","filename":"src\/hotspot\/share\/utilities\/utf8.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,1 @@\n-  VMGUESTLIB_ERROR_SUCCESS = 0, \/\/ no error occured\n+  VMGUESTLIB_ERROR_SUCCESS = 0, \/\/ no error occurred\n","filename":"src\/hotspot\/share\/utilities\/virtualizationSupport.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,1 +125,1 @@\n-  \/\/ Hook functions for platform dependend functionality:\n+  \/\/ Hook functions for platform dependent functionality:\n","filename":"src\/hotspot\/share\/utilities\/vmError.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,1 +93,1 @@\n-  \/\/ Scan the string looking for inadvertant \"<&>\" chars\n+  \/\/ Scan the string looking for inadvertent \"<&>\" chars\n","filename":"src\/hotspot\/share\/utilities\/xmlstream.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -316,1 +316,1 @@\n-     * Events are retreived from pollset in batch and offered to a BlockingQueue\n+     * Events are retrieved from pollset in batch and offered to a BlockingQueue\n@@ -435,1 +435,1 @@\n-                    \/\/ contine after we processed a control event\n+                    \/\/ continue after we processed a control event\n","filename":"src\/java.base\/aix\/classes\/sun\/nio\/ch\/AixPollPort.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n- * We try to mimick dladdr(3) on Linux (see http:\/\/linux.die.net\/man\/3\/dladdr)\n+ * We try to mimic dladdr(3) on Linux (see http:\/\/linux.die.net\/man\/3\/dladdr)\n","filename":"src\/java.base\/aix\/native\/libjli\/java_md_aix.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -188,1 +188,1 @@\n-                              String parm) {\n+                              String param) {\n@@ -190,1 +190,1 @@\n-                                                      parm,\n+                                                      param,\n","filename":"src\/java.base\/linux\/classes\/jdk\/internal\/platform\/cgroupv1\/CgroupV1Subsystem.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -83,1 +83,1 @@\n-    public static double getDoubleValue(CgroupSubsystemController controller, String parm) {\n+    public static double getDoubleValue(CgroupSubsystemController controller, String param) {\n@@ -85,1 +85,1 @@\n-                                                        parm,\n+                                                        param,\n","filename":"src\/java.base\/linux\/classes\/jdk\/internal\/platform\/cgroupv1\/CgroupV1SubsystemController.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -71,0 +71,19 @@\n+\n+        \/\/ Each KeyStore.TrustedCertificateEntry have 2 attributes:\n+        \/\/ 1. \"trustSettings\" -> trustSettings.toString()\n+        \/\/ 2. \"2.16.840.1.113894.746875.1.1\" -> trustedKeyUsageValue\n+        \/\/ The 1st one is mainly for debugging use. The 2nd one is similar\n+        \/\/ to the attribute with the same key in a PKCS12KeyStore.\n+\n+        \/\/ The SecTrustSettingsCopyTrustSettings() output for this certificate\n+        \/\/ inside the KeyChain in its original array of CFDictionaryRef objects\n+        \/\/ structure with values dumped as strings. For each trust, an extra\n+        \/\/ entry \"SecPolicyOid\" is added whose value is the OID for this trust.\n+        \/\/ The extra entries are used to construct trustedKeyUsageValue.\n+        List<Map<String, String>> trustSettings;\n+\n+        \/\/ One or more OIDs defined in http:\/\/oidref.com\/1.2.840.113635.100.1.\n+        \/\/ It can also be \"2.5.29.37.0\" for a self-signed certificate with\n+        \/\/ an empty trust settings. This value is never empty. When there are\n+        \/\/ multiple OID values, it takes the form of \"[1.1.1, 1.1.2]\".\n+        String trustedKeyUsageValue;\n@@ -303,0 +322,29 @@\n+    private record LocalAttr(String name, String value)\n+            implements KeyStore.Entry.Attribute {\n+\n+        @Override\n+        public String getName() {\n+            return name;\n+        }\n+\n+        @Override\n+        public String getValue() {\n+            return value;\n+        }\n+    }\n+\n+    @Override\n+    public KeyStore.Entry engineGetEntry(String alias, KeyStore.ProtectionParameter protParam)\n+            throws KeyStoreException, NoSuchAlgorithmException, UnrecoverableEntryException {\n+        if (engineIsCertificateEntry(alias)) {\n+            Object entry = entries.get(alias.toLowerCase());\n+            if (entry instanceof TrustedCertEntry tEntry) {\n+                return new KeyStore.TrustedCertificateEntry(\n+                        tEntry.cert, Set.of(\n+                                new LocalAttr(KnownOIDs.ORACLE_TrustedKeyUsage.value(), tEntry.trustedKeyUsageValue),\n+                                new LocalAttr(\"trustSettings\", tEntry.trustSettings.toString())));\n+            }\n+        }\n+        return super.engineGetEntry(alias, protParam);\n+    }\n+\n@@ -456,12 +504,1 @@\n-     * Assigns the given certificate to the given alias.\n-     *\n-     * <p>If the given alias already exists in this keystore and identifies a\n-     * <i>trusted certificate entry<\/i>, the certificate associated with it is\n-     * overridden by the given certificate.\n-     *\n-     * @param alias the alias name\n-     * @param cert the certificate\n-     *\n-     * @exception KeyStoreException if the given alias already exists and does\n-     * not identify a <i>trusted certificate entry<\/i>, or this operation\n-     * fails for some other reason.\n+     * Adding trusted certificate entry is not supported.\n@@ -470,35 +507,3 @@\n-        throws KeyStoreException\n-    {\n-        permissionCheck();\n-\n-        synchronized(entries) {\n-\n-            Object entry = entries.get(alias.toLowerCase());\n-            if ((entry != null) && (entry instanceof KeyEntry)) {\n-                throw new KeyStoreException\n-                (\"Cannot overwrite key entry with certificate\");\n-            }\n-\n-            \/\/ This will be slow, but necessary.  Enumerate the values and then see if the cert matches the one in the trusted cert entry.\n-            \/\/ Security framework doesn't support the same certificate twice in a keychain.\n-            Collection<Object> allValues = entries.values();\n-\n-            for (Object value : allValues) {\n-                if (value instanceof TrustedCertEntry) {\n-                    TrustedCertEntry tce = (TrustedCertEntry)value;\n-                    if (tce.cert.equals(cert)) {\n-                        throw new KeyStoreException(\"Keychain does not support mulitple copies of same certificate.\");\n-                    }\n-                }\n-            }\n-\n-            TrustedCertEntry trustedCertEntry = new TrustedCertEntry();\n-            trustedCertEntry.cert = cert;\n-            trustedCertEntry.date = new Date();\n-            String lowerAlias = alias.toLowerCase();\n-            if (entries.get(lowerAlias) != null) {\n-                deletedEntries.put(lowerAlias, entries.get(lowerAlias));\n-            }\n-            entries.put(lowerAlias, trustedCertEntry);\n-            addedEntries.put(lowerAlias, trustedCertEntry);\n-        }\n+            throws KeyStoreException {\n+        throw new KeyStoreException(\"Cannot set trusted certificate entry.\" +\n+                \" Use the macOS \\\"security add-trusted-cert\\\" command instead.\");\n@@ -683,4 +688,1 @@\n-                TrustedCertEntry tce = (TrustedCertEntry)entry;\n-                Certificate certElem;\n-                certElem = tce.cert;\n-                tce.certRef = addCertificateToKeychain(alias, certElem);\n+                \/\/ Cannot set trusted certificate entry\n@@ -781,1 +783,19 @@\n-     * Callback method from _scanKeychain.  If a trusted certificate is found, this method will be called.\n+     * Callback method from _scanKeychain.  If a trusted certificate is found,\n+     * this method will be called.\n+     *\n+     * inputTrust is a list of strings in groups. Each group contains key\/value\n+     * pairs for one trust setting and ends with a null. Thus the size of the\n+     * whole list is (2 * s_1 + 1) + (2 * s_2 + 1) + ... + (2 * s_n + 1),\n+     * where s_i is the size of mapping for the i'th trust setting,\n+     * and n is the number of trust settings. Ex:\n+     *\n+     * key1 for trust1\n+     * value1 for trust1\n+     * ..\n+     * null (end of trust1)\n+     * key1 for trust2\n+     * value1 for trust2\n+     * ...\n+     * null (end of trust2)\n+     * ...\n+     * null (end if trust_n)\n@@ -783,1 +803,2 @@\n-    private void createTrustedCertEntry(String alias, long keychainItemRef, long creationDate, byte[] derStream) {\n+    private void createTrustedCertEntry(String alias, List<String> inputTrust,\n+            long keychainItemRef, long creationDate, byte[] derStream) {\n@@ -794,0 +815,63 @@\n+            tce.trustSettings = new ArrayList<>();\n+            Map<String,String> tmpMap = new LinkedHashMap<>();\n+            for (int i = 0; i < inputTrust.size(); i++) {\n+                if (inputTrust.get(i) == null) {\n+                    tce.trustSettings.add(tmpMap);\n+                    if (i < inputTrust.size() - 1) {\n+                        \/\/ Prepare an empty map for the next trust setting.\n+                        \/\/ Do not just clear(), must be a new object.\n+                        \/\/ Only create if not at end of list.\n+                        tmpMap = new LinkedHashMap<>();\n+                    }\n+                } else {\n+                    tmpMap.put(inputTrust.get(i), inputTrust.get(i+1));\n+                    i++;\n+                }\n+            }\n+\n+            boolean isSelfSigned;\n+            try {\n+                cert.verify(cert.getPublicKey());\n+                isSelfSigned = true;\n+            } catch (Exception e) {\n+                isSelfSigned = false;\n+            }\n+            if (tce.trustSettings.isEmpty()) {\n+                if (isSelfSigned) {\n+                    \/\/ If a self-signed certificate has an empty trust settings,\n+                    \/\/ trust it for all purposes\n+                    tce.trustedKeyUsageValue = KnownOIDs.anyExtendedKeyUsage.value();\n+                } else {\n+                    \/\/ Otherwise, return immediately. The certificate is not\n+                    \/\/ added into entries.\n+                    return;\n+                }\n+            } else {\n+                List<String> values = new ArrayList<>();\n+                for (var oneTrust : tce.trustSettings) {\n+                    var result = oneTrust.get(\"kSecTrustSettingsResult\");\n+                    \/\/ https:\/\/developer.apple.com\/documentation\/security\/sectrustsettingsresult?language=objc\n+                    \/\/ 1 = kSecTrustSettingsResultTrustRoot, 2 = kSecTrustSettingsResultTrustAsRoot\n+                    \/\/ If missing, a default value of kSecTrustSettingsResultTrustRoot is assumed\n+                    \/\/ for self-signed certificates (see doc for SecTrustSettingsCopyTrustSettings).\n+                    \/\/ Note that the same SecPolicyOid can appear in multiple trust settings\n+                    \/\/ for different kSecTrustSettingsAllowedError and\/or kSecTrustSettingsPolicyString.\n+                    if ((result == null && isSelfSigned)\n+                            || \"1\".equals(result) || \"2\".equals(result)) {\n+                        \/\/ When no kSecTrustSettingsPolicy, it means everything\n+                        String oid = oneTrust.getOrDefault(\"SecPolicyOid\",\n+                                KnownOIDs.anyExtendedKeyUsage.value());\n+                        if (!values.contains(oid)) {\n+                            values.add(oid);\n+                        }\n+                    }\n+                }\n+                if (values.isEmpty()) {\n+                    return;\n+                }\n+                if (values.size() == 1) {\n+                    tce.trustedKeyUsageValue = values.get(0);\n+                } else {\n+                    tce.trustedKeyUsageValue = values.toString();\n+                }\n+            }\n","filename":"src\/java.base\/macosx\/classes\/apple\/security\/KeychainStore.java","additions":138,"deletions":54,"binary":false,"changes":192,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -573,1 +573,1 @@\n-                    map = new HashMap<>((int)Math.ceil(names.length \/ 0.75));\n+                    map = HashMap.newHashMap(names.length);\n","filename":"src\/java.base\/macosx\/classes\/sun\/util\/locale\/provider\/HostLocaleProviderAdapterImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -153,1 +153,1 @@\n- * \"haw\"        (3-letter lanuage designator)\n+ * \"haw\"        (3-letter language designator)\n","filename":"src\/java.base\/macosx\/native\/libjava\/java_props_macosx.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -111,1 +111,1 @@\n-    \/\/ the first getfsstat and the second so loop until consistant\n+    \/\/ the first getfsstat and the second so loop until consistent\n","filename":"src\/java.base\/macosx\/native\/libnio\/fs\/BsdNativeDispatcher.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -371,0 +371,8 @@\n+#define ADD(list, str) { \\\n+    jobject localeObj = (*env)->NewStringUTF(env, [str UTF8String]); \\\n+    (*env)->CallBooleanMethod(env, list, jm_listAdd, localeObj); \\\n+    (*env)->DeleteLocalRef(env, localeObj); \\\n+}\n+\n+#define ADDNULL(list) (*env)->CallBooleanMethod(env, list, jm_listAdd, NULL)\n+\n@@ -382,1 +390,1 @@\n-            env, jc_KeychainStore, \"createTrustedCertEntry\", \"(Ljava\/lang\/String;JJ[B)V\");\n+            env, jc_KeychainStore, \"createTrustedCertEntry\", \"(Ljava\/lang\/String;Ljava\/util\/List;JJ[B)V\");\n@@ -384,0 +392,7 @@\n+    jclass jc_arrayListClass = (*env)->FindClass(env, \"java\/util\/ArrayList\");\n+    CHECK_NULL(jc_arrayListClass);\n+    jmethodID jm_arrayListCons = (*env)->GetMethodID(env, jc_arrayListClass, \"<init>\", \"()V\");\n+    CHECK_NULL(jm_arrayListCons);\n+    jmethodID jm_listAdd = (*env)->GetMethodID(env, jc_arrayListClass, \"add\", \"(Ljava\/lang\/Object;)Z\");\n+    CHECK_NULL(jm_listAdd);\n+\n@@ -404,0 +419,38 @@\n+            \/\/ Only add certificates with trusted settings\n+            CFArrayRef trustSettings;\n+            if (SecTrustSettingsCopyTrustSettings(certRef, kSecTrustSettingsDomainUser, &trustSettings)\n+                    == errSecItemNotFound) {\n+                continue;\n+            }\n+\n+            \/\/ See KeychainStore::createTrustedCertEntry for content of inputTrust\n+            jobject inputTrust = (*env)->NewObject(env, jc_arrayListClass, jm_arrayListCons);\n+            CHECK_NULL(inputTrust);\n+\n+            \/\/ Dump everything inside trustSettings into inputTrust\n+            CFIndex count = CFArrayGetCount(trustSettings);\n+            for (int i = 0; i < count; i++) {\n+                CFDictionaryRef oneTrust = (CFDictionaryRef) CFArrayGetValueAtIndex(trustSettings, i);\n+                CFIndex size = CFDictionaryGetCount(oneTrust);\n+                const void * keys [size];\n+                const void * values [size];\n+                CFDictionaryGetKeysAndValues(oneTrust, keys, values);\n+                for (int j = 0; j < size; j++) {\n+                    NSString* s = [NSString stringWithFormat:@\"%@\", keys[j]];\n+                    ADD(inputTrust, s);\n+                    s = [NSString stringWithFormat:@\"%@\", values[j]];\n+                    ADD(inputTrust, s);\n+                }\n+                SecPolicyRef certPolicy;\n+                certPolicy = (SecPolicyRef)CFDictionaryGetValue(oneTrust, kSecTrustSettingsPolicy);\n+                if (certPolicy != NULL) {\n+                    CFDictionaryRef policyDict = SecPolicyCopyProperties(certPolicy);\n+                    ADD(inputTrust, @\"SecPolicyOid\");\n+                    NSString* s = [NSString stringWithFormat:@\"%@\", CFDictionaryGetValue(policyDict, @\"SecPolicyOid\")];\n+                    ADD(inputTrust, s);\n+                    CFRelease(policyDict);\n+                }\n+                ADDNULL(inputTrust);\n+            }\n+            CFRelease(trustSettings);\n+\n@@ -409,1 +462,1 @@\n-            (*env)->CallVoidMethod(env, keyStore, jm_createTrustedCertEntry, alias, nativeRef, creationDate, certData);\n+            (*env)->CallVoidMethod(env, keyStore, jm_createTrustedCertEntry, alias, inputTrust, nativeRef, creationDate, certData);\n@@ -525,2 +578,2 @@\n- * Signature: (Ljava\/lang\/String;[B)I\n-*\/\n+ * Signature: (Ljava\/lang\/String;Z[B[C)J\n+ *\/\n","filename":"src\/java.base\/macosx\/native\/libosxsecurity\/KeystoreImpl.m","additions":58,"deletions":5,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -165,1 +165,1 @@\n-    \/\/ Static code - to intialise S-boxes and T-boxes\n+    \/\/ Static code - to initialise S-boxes and T-boxes\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/AESCrypt.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -877,1 +877,1 @@\n-        \/\/ Peform 10 iterations of the 8 quarter round set\n+        \/\/ Perform 10 iterations of the 8 quarter round set\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/ChaCha20Cipher.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -187,1 +187,1 @@\n-        \/\/ Repeat if either of the followings does not hold:\n+        \/\/ Repeat if either of the following does not hold:\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/DHKeyPairGenerator.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -548,1 +548,1 @@\n-    \/\/ encryption\/decrytion over 'out' buffer\n+    \/\/ encryption\/decryption over 'out' buffer\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/KeyWrapCipher.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,1 +74,1 @@\n-     * @param msg the string message, which can be retrived by\n+     * @param msg the string message, which can be retrieved by\n","filename":"src\/java.base\/share\/classes\/com\/sun\/security\/ntlm\/NTLMException.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -178,2 +178,3 @@\n-     * a file path is very limited, and it only covers Nul character check.\n-     * Returning true means the path is definitely invalid\/garbage. But\n+     * a file path is very limited, and it only covers Nul character check\n+     * unless further checking is explicitly enabled by a system property.\n+     * Returning true means the path is definitely invalid\/garbage, but\n@@ -187,2 +188,1 @@\n-            s = (this.path.indexOf('\\u0000') < 0) ? PathStatus.CHECKED\n-                                                  : PathStatus.INVALID;\n+            s = fs.isInvalid(this) ? PathStatus.INVALID : PathStatus.CHECKED;\n","filename":"src\/java.base\/share\/classes\/java\/io\/File.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,0 +90,5 @@\n+    \/**\n+     * Tell whether the given abstract pathname is invalid.\n+     *\/\n+    public abstract boolean isInvalid(File f);\n+\n","filename":"src\/java.base\/share\/classes\/java\/io\/FileSystem.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -747,2 +747,1 @@\n-        private static Map<String, UnicodeBlock> map =\n-                new HashMap<>((int)(NUM_ENTITIES \/ 0.75f + 1.0f));\n+        private static Map<String, UnicodeBlock> map = HashMap.newHashMap(NUM_ENTITIES);\n@@ -5289,1 +5288,1 @@\n-        UNKNOWN;\n+        UNKNOWN; \/\/ must be the last enum constant for calculating the size of \"aliases\" hash map.\n@@ -8575,1 +8574,1 @@\n-            aliases = new HashMap<>((int)(162 \/ 0.75f + 1.0f));\n+            aliases = HashMap.newHashMap(UNKNOWN.ordinal() + 1);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Character.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -3005,3 +3005,3 @@\n-                if (callerModule == null && !thisModule.isOpen(pn)) {\n-                    \/\/ no caller, package not open\n-                    return false;\n+                if (callerModule == null) {\n+                    \/\/ no caller, return true if the package is open to all modules\n+                    return thisModule.isOpen(pn);\n@@ -3913,1 +3913,1 @@\n-            directory = new HashMap<>((int)(universe.length \/ 0.75f) + 1);\n+            directory = HashMap.newHashMap(universe.length);\n@@ -4128,1 +4128,1 @@\n-                        annotations = new LinkedHashMap<>((Math.max(\n+                        annotations = LinkedHashMap.newLinkedHashMap(Math.max(\n@@ -4131,1 +4131,1 @@\n-                            ) * 4 + 2) \/ 3\n+                            )\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Class.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -497,1 +497,1 @@\n-    \/\/ calling the overrideable getName method\n+    \/\/ calling the overridable getName method\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ClassLoader.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -983,1 +983,1 @@\n-            openPackages = new HashMap<>((4 * (concealedPkgs.size() + exportedPkgs.size()) \/ 3) + 1);\n+            openPackages = HashMap.newHashMap(concealedPkgs.size() + exportedPkgs.size());\n@@ -1136,2 +1136,1 @@\n-        int cap = (int)(numModules \/ 0.75f + 1.0f);\n-        Map<String, Module> nameToModule = new HashMap<>(cap);\n+        Map<String, Module> nameToModule = HashMap.newHashMap(numModules);\n@@ -1657,5 +1656,5 @@\n-                    if (caller == null && !isOpen(pn)) {\n-                        \/\/ no caller, package not open\n-                        return null;\n-                    }\n-                    if (!isOpen(pn, caller)) {\n+                    if (caller == null) {\n+                        if (!isOpen(pn)) {\n+                            return null;\n+                        }\n+                    } else if (!isOpen(pn, caller)) {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Module.java","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -632,1 +632,1 @@\n-     * with this method is an atomic operation or not. Consequentially it is\n+     * with this method is an atomic operation or not. Consequently it is\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ModuleLayer.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -244,1 +244,1 @@\n-         *          It is undecideable whether white space separates different\n+         *          It is undecidable whether white space separates different\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ProcessHandle.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -3259,1 +3259,1 @@\n-        \/\/ following loop wil add max: (long) Integer.MAX_VALUE * Integer.MAX_VALUE to len\n+        \/\/ following loop will add max: (long) Integer.MAX_VALUE * Integer.MAX_VALUE to len\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -401,3 +401,0 @@\n-            if (Character.toLowerCase(u1) == Character.toLowerCase(u2)) {\n-                continue;\n-            }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/StringLatin1.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1658,1 +1658,1 @@\n-        Map<Thread, StackTraceElement[]> m = new HashMap<>(threads.length);\n+        Map<Thread, StackTraceElement[]> m = HashMap.newHashMap(threads.length);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Thread.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -899,1 +899,1 @@\n-                    MemberName member = new MemberName(MethodHandleStatics.class, \"UNSAFE\", Unsafe.class, REF_getField);\n+                    MemberName member = new MemberName(MethodHandleStatics.class, \"UNSAFE\", Unsafe.class, REF_getStatic);\n@@ -901,1 +901,1 @@\n-                            MemberName.getFactory().resolveOrFail(REF_getField, member,\n+                            MemberName.getFactory().resolveOrFail(REF_getStatic, member,\n@@ -903,1 +903,1 @@\n-                                                                  NoSuchMethodException.class));\n+                                                                  NoSuchFieldException.class));\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/DirectMethodHandle.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -292,1 +292,1 @@\n-        var convSpecMap = new HashMap<Object, int[]>(((4 * convCount) \/ 3) + 1);\n+        HashMap<Object, int[]> convSpecMap = HashMap.newHashMap(convCount);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/MethodHandleImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -241,1 +241,1 @@\n-                \/\/ ignore exotic ops the JVM cares about; we just wont issue them\n+                \/\/ ignore exotic ops the JVM cares about; we just won't issue them\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/MethodHandleNatives.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -5883,0 +5883,1 @@\n+     * }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/MethodHandles.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1506,1 +1506,1 @@\n-         * {@link #build buid} method will add \"{@code requires java.base}\" if\n+         * {@link #build build} method will add \"{@code requires java.base}\" if\n","filename":"src\/java.base\/share\/classes\/java\/lang\/module\/ModuleDescriptor.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -501,2 +501,1 @@\n-        \/\/ initial capacity of maps to avoid resizing\n-        int capacity = 1 + (4 * nameToReference.size())\/ 3;\n+        int moduleCount = nameToReference.size();\n@@ -506,1 +505,1 @@\n-        Map<ResolvedModule, Set<ResolvedModule>> g1 = new HashMap<>(capacity);\n+        Map<ResolvedModule, Set<ResolvedModule>> g1 = HashMap.newHashMap(moduleCount);\n@@ -515,1 +514,1 @@\n-            g2 = new HashMap<>(capacity);\n+            g2 = HashMap.newHashMap(moduleCount);\n@@ -542,1 +541,1 @@\n-        Map<String, ResolvedModule> nameToResolved = new HashMap<>(capacity);\n+        Map<String, ResolvedModule> nameToResolved = HashMap.newHashMap(moduleCount);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/module\/Resolver.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -901,1 +901,1 @@\n-         * Define a dynamic module with a packge named $MODULE which\n+         * Define a dynamic module with a package named $MODULE which\n","filename":"src\/java.base\/share\/classes\/java\/lang\/reflect\/Proxy.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -334,1 +334,1 @@\n-     * @return chunks that wont surpass the maximum number of slots StringConcatFactory::makeConcatWithConstants can chew\n+     * @return chunks that won't surpass the maximum number of slots StringConcatFactory::makeConcatWithConstants can chew\n","filename":"src\/java.base\/share\/classes\/java\/lang\/runtime\/ObjectMethods.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2160,1 +2160,1 @@\n-            \/\/ where unscaledValue is an integer with the mimimum\n+            \/\/ where unscaledValue is an integer with the minimum\n@@ -4314,1 +4314,1 @@\n-     * @return the length of the unscaled value, in deciaml digits.\n+     * @return the length of the unscaled value, in decimal digits.\n@@ -4947,1 +4947,1 @@\n-     * returns INFLATED if oveflow\n+     * returns INFLATED if overflow\n","filename":"src\/java.base\/share\/classes\/java\/math\/BigDecimal.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -3926,1 +3926,1 @@\n-     *         greater than the magnitude aray for the specified BigInteger's.\n+     *         greater than the magnitude array for the specified BigInteger's.\n","filename":"src\/java.base\/share\/classes\/java\/math\/BigInteger.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -179,1 +179,1 @@\n- *    int ttl = ...; \/\/ a number betwen 0 and 255\n+ *    int ttl = ...; \/\/ a number between 0 and 255\n","filename":"src\/java.base\/share\/classes\/java\/net\/DatagramSocket.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -390,1 +390,1 @@\n-        } catch (UnknownHostException e) {} \/* cant happen if ifname is null *\/\n+        } catch (UnknownHostException e) {} \/* can't happen if ifname is null *\/\n","filename":"src\/java.base\/share\/classes\/java\/net\/Inet6Address.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -726,1 +726,1 @@\n-        \/\/ protocol we enforce that the Handler is not overrideable and can\n+        \/\/ protocol we enforce that the Handler is not overridable and can\n","filename":"src\/java.base\/share\/classes\/java\/net\/URL.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -141,1 +141,1 @@\n-    \/\/ Given an offset previously otained from calling\n+    \/\/ Given an offset previously obtained from calling\n@@ -150,1 +150,1 @@\n-    \/\/ given a mappingOffset previously otained from calling\n+    \/\/ given a mappingOffset previously obtained from calling\n","filename":"src\/java.base\/share\/classes\/java\/nio\/MappedMemoryUtils.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -298,1 +298,1 @@\n-     * implementation for failover. If no more implemenations are\n+     * implementation for failover. If no more implementations are\n","filename":"src\/java.base\/share\/classes\/java\/security\/KeyFactory.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -606,1 +606,1 @@\n-         * implementation for failover. If no more implemenations are\n+         * implementation for failover. If no more implementations are\n","filename":"src\/java.base\/share\/classes\/java\/security\/KeyPairGenerator.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -774,1 +774,1 @@\n-         * Gets the trusted {@code Certficate} from this entry.\n+         * Gets the trusted {@code Certificate} from this entry.\n","filename":"src\/java.base\/share\/classes\/java\/security\/KeyStore.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1608,1 +1608,1 @@\n-    \/\/ get the \"standard\" (mixed-case) engine name for arbitary case engine name\n+    \/\/ get the \"standard\" (mixed-case) engine name for arbitrary case engine name\n","filename":"src\/java.base\/share\/classes\/java\/security\/Provider.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -228,1 +228,1 @@\n-     * provider-preference order, as specificed in the security\n+     * provider-preference order, as specified in the security\n","filename":"src\/java.base\/share\/classes\/java\/security\/Security.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -248,1 +248,1 @@\n-            extensions = new HashMap<>(size > 20 ? 20 : size);\n+            extensions = HashMap.newHashMap(size > 20 ? 20 : size);\n","filename":"src\/java.base\/share\/classes\/java\/security\/cert\/CertificateRevokedException.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -200,1 +200,1 @@\n-            Map<X509Certificate, byte[]> copy = new HashMap<>(responses.size());\n+            Map<X509Certificate, byte[]> copy = HashMap.newHashMap(responses.size());\n@@ -219,1 +219,1 @@\n-        Map<X509Certificate, byte[]> copy = new HashMap<>(ocspResponses.size());\n+        Map<X509Certificate, byte[]> copy = HashMap.newHashMap(ocspResponses.size());\n","filename":"src\/java.base\/share\/classes\/java\/security\/cert\/PKIXRevocationChecker.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -115,6 +115,0 @@\n-    \/\/ disallowed\n-    private PSSParameterSpec() {\n-        throw new RuntimeException(\"default constructor not allowed\");\n-    }\n-\n-\n","filename":"src\/java.base\/share\/classes\/java\/security\/spec\/PSSParameterSpec.java","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -408,1 +408,1 @@\n-                \/\/ same as number < choiceLimits, except catchs NaN\n+                \/\/ same as number < choiceLimits, except catches NaN\n@@ -467,1 +467,1 @@\n-     * @return the least double value greather than {@code d}\n+     * @return the least double value greater than {@code d}\n","filename":"src\/java.base\/share\/classes\/java\/text\/ChoiceFormat.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1726,1 +1726,1 @@\n-    \/\/ ======== End fast-path formating logic for double =========================\n+    \/\/ ======== End fast-path formatting logic for double =========================\n","filename":"src\/java.base\/share\/classes\/java\/text\/DecimalFormat.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -464,1 +464,1 @@\n-             *   In the case of formating float or double, We must take into\n+             *   In the case of formatting float or double, We must take into\n@@ -472,1 +472,1 @@\n-             *   converted exactly to its decimal representation given formating\n+             *   converted exactly to its decimal representation given formatting\n","filename":"src\/java.base\/share\/classes\/java\/text\/DigitList.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -190,1 +190,1 @@\n-     * @return the maximum length of any expansion seuences ending\n+     * @return the maximum length of any expansion sequences ending\n","filename":"src\/java.base\/share\/classes\/java\/text\/RBCollationTables.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,1 +85,1 @@\n-        \/\/ Normalize the build rules.  Find occurances of all decomposed characters\n+        \/\/ Normalize the build rules.  Find occurrences of all decomposed characters\n@@ -506,1 +506,1 @@\n-     * for the given characers.  If anOrder is valid, it is added to the\n+     * for the given characters.  If anOrder is valid, it is added to the\n","filename":"src\/java.base\/share\/classes\/java\/text\/RBTableBuilder.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1584,1 +1584,1 @@\n-     * should consider the count of digits while parsing the contigous digits\n+     * should consider the count of digits while parsing the contiguous digits\n","filename":"src\/java.base\/share\/classes\/java\/text\/SimpleDateFormat.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -240,1 +240,1 @@\n- * <li>{@code parse} - static factory method focussed on parsing<\/li>\n+ * <li>{@code parse} - static factory method focused on parsing<\/li>\n","filename":"src\/java.base\/share\/classes\/java\/time\/package-info.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1043,1 +1043,1 @@\n-     * Nulls out slots starting at array index i, upto index end.\n+     * Nulls out slots starting at array index i, up to index end.\n","filename":"src\/java.base\/share\/classes\/java\/util\/ArrayDeque.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -436,0 +436,4 @@\n+     * @apiNote\n+     * To create a {@code HashMap} with an initial capacity that accommodates\n+     * an expected number of mappings, use {@link #newHashMap(int) newHashMap}.\n+     *\n@@ -458,0 +462,4 @@\n+     * @apiNote\n+     * To create a {@code HashMap} with an initial capacity that accommodates\n+     * an expected number of mappings, use {@link #newHashMap(int) newHashMap}.\n+     *\n@@ -2548,0 +2556,28 @@\n+    \/**\n+     * Calculate initial capacity for HashMap based classes, from expected size and default load factor (0.75).\n+     *\n+     * @param numMappings the expected number of mappings\n+     * @return initial capacity for HashMap based classes.\n+     * @since 19\n+     *\/\n+    static int calculateHashMapCapacity(int numMappings) {\n+        return (int) Math.ceil(numMappings \/ (double) DEFAULT_LOAD_FACTOR);\n+    }\n+\n+    \/**\n+     * Creates a new, empty HashMap suitable for the expected number of mappings.\n+     * The returned map uses the default load factor of 0.75, and its initial capacity is\n+     * generally large enough so that the expected number of mappings can be added\n+     * without resizing the map.\n+     *\n+     * @param numMappings the expected number of mappings\n+     * @param <K>         the type of keys maintained by this map\n+     * @param <V>         the type of mapped values\n+     * @return the newly created map\n+     * @throws IllegalArgumentException if numMappings is negative\n+     * @since 19\n+     *\/\n+    public static <K, V> HashMap<K, V> newHashMap(int numMappings) {\n+        return new HashMap<>(calculateHashMapCapacity(numMappings));\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/util\/HashMap.java","additions":37,"deletions":1,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -120,1 +120,1 @@\n-        map = new HashMap<>(Math.max((int) (c.size()\/.75f) + 1, 16));\n+        map = HashMap.newHashMap(Math.max(c.size(), 12));\n","filename":"src\/java.base\/share\/classes\/java\/util\/HashSet.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1222,1 +1222,1 @@\n-                    \/\/ Use an equvalent year of d.getYear() if\n+                    \/\/ Use an equivalent year of d.getYear() if\n","filename":"src\/java.base\/share\/classes\/java\/util\/JapaneseImperialCalendar.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -342,0 +342,4 @@\n+     * @apiNote\n+     * To create a {@code LinkedHashMap} with an initial capacity that accommodates\n+     * an expected number of mappings, use {@link #newLinkedHashMap(int) newLinkedHashMap}.\n+     *\n@@ -356,0 +360,4 @@\n+     * @apiNote\n+     * To create a {@code LinkedHashMap} with an initial capacity that accommodates\n+     * an expected number of mappings, use {@link #newLinkedHashMap(int) newLinkedHashMap}.\n+     *\n@@ -791,0 +799,16 @@\n+    \/**\n+     * Creates a new, empty, insertion-ordered LinkedHashMap suitable for the expected number of mappings.\n+     * The returned map uses the default load factor of 0.75, and its initial capacity is\n+     * generally large enough so that the expected number of mappings can be added\n+     * without resizing the map.\n+     *\n+     * @param numMappings the expected number of mappings\n+     * @param <K>         the type of keys maintained by this map\n+     * @param <V>         the type of mapped values\n+     * @return the newly created map\n+     * @throws IllegalArgumentException if numMappings is negative\n+     * @since 19\n+     *\/\n+    public static <K, V> LinkedHashMap<K, V> newLinkedHashMap(int numMappings) {\n+        return new LinkedHashMap<>(HashMap.calculateHashMapCapacity(numMappings));\n+    }\n","filename":"src\/java.base\/share\/classes\/java\/util\/LinkedHashMap.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -196,1 +196,1 @@\n-        HashMap<String,Object> temp = new HashMap<>(contents.length);\n+        HashMap<String,Object> temp = HashMap.newHashMap(contents.length);\n","filename":"src\/java.base\/share\/classes\/java\/util\/ListResourceBundle.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-     *        {@link Throwable.getCause()} method). (A null value is\n+     *        {@link Throwable#getCause()} method). (A null value is\n","filename":"src\/java.base\/share\/classes\/java\/util\/MissingResourceException.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2972,1 +2972,1 @@\n-                            \/\/ bundles using old convension.\n+                            \/\/ bundles using old convention.\n","filename":"src\/java.base\/share\/classes\/java\/util\/ResourceBundle.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -948,0 +948,1 @@\n+        private long estimatedSize; \/\/ estimated size, to help to split evenly\n@@ -974,0 +975,9 @@\n+            this.estimatedSize = -1;\n+        }\n+\n+        private ArraySpliterator(Object[] array, int origin, int fence, int characteristics, long estimatedSize) {\n+            this.array = array;\n+            this.index = origin;\n+            this.fence = fence;\n+            this.characteristics = characteristics & ~(Spliterator.SIZED | Spliterator.SUBSIZED);\n+            this.estimatedSize = estimatedSize;\n@@ -979,3 +989,7 @@\n-            return (lo >= mid)\n-                   ? null\n-                   : new ArraySpliterator<>(array, lo, index = mid, characteristics);\n+            if (lo >= mid) return null;\n+            if (estimatedSize == -1) {\n+                return new ArraySpliterator<>(array, lo, index = mid, characteristics);\n+            }\n+            long prefixEstimatedSize = estimatedSize >>> 1;\n+            estimatedSize -= prefixEstimatedSize;\n+            return new ArraySpliterator<>(array, lo, index = mid, characteristics, prefixEstimatedSize);\n@@ -1009,1 +1023,3 @@\n-        public long estimateSize() { return (long)(fence - index); }\n+        public long estimateSize() {\n+            return estimatedSize >= 0 ? estimatedSize : (long)(fence - index);\n+        }\n@@ -1033,0 +1049,1 @@\n+        private long estimatedSize; \/\/ estimated size, to help to split evenly\n@@ -1059,0 +1076,9 @@\n+            this.estimatedSize = -1;\n+        }\n+\n+        private IntArraySpliterator(int[] array, int origin, int fence, int characteristics, long estimatedSize) {\n+            this.array = array;\n+            this.index = origin;\n+            this.fence = fence;\n+            this.characteristics = characteristics & ~(Spliterator.SIZED | Spliterator.SUBSIZED);\n+            this.estimatedSize = estimatedSize;\n@@ -1064,3 +1090,7 @@\n-            return (lo >= mid)\n-                   ? null\n-                   : new IntArraySpliterator(array, lo, index = mid, characteristics);\n+            if (lo >= mid) return null;\n+            if (estimatedSize == -1) {\n+                return new IntArraySpliterator(array, lo, index = mid, characteristics);\n+            }\n+            long prefixEstimatedSize = estimatedSize >>> 1;\n+            estimatedSize -= prefixEstimatedSize;\n+            return new IntArraySpliterator(array, lo, index = mid, characteristics, prefixEstimatedSize);\n@@ -1092,1 +1122,3 @@\n-        public long estimateSize() { return (long)(fence - index); }\n+        public long estimateSize() {\n+            return estimatedSize >= 0 ? estimatedSize : (long)(fence - index);\n+        }\n@@ -1116,0 +1148,1 @@\n+        private long estimatedSize; \/\/ estimated size, to help to split evenly\n@@ -1142,0 +1175,9 @@\n+            this.estimatedSize = -1;\n+        }\n+\n+        private LongArraySpliterator(long[] array, int origin, int fence, int characteristics, long estimatedSize) {\n+            this.array = array;\n+            this.index = origin;\n+            this.fence = fence;\n+            this.characteristics = characteristics & ~(Spliterator.SIZED | Spliterator.SUBSIZED);\n+            this.estimatedSize = estimatedSize;\n@@ -1147,3 +1189,7 @@\n-            return (lo >= mid)\n-                   ? null\n-                   : new LongArraySpliterator(array, lo, index = mid, characteristics);\n+            if (lo >= mid) return null;\n+            if (estimatedSize == -1) {\n+                return new LongArraySpliterator(array, lo, index = mid, characteristics);\n+            }\n+            long prefixEstimatedSize = estimatedSize >>> 1;\n+            estimatedSize -= prefixEstimatedSize;\n+            return new LongArraySpliterator(array, lo, index = mid, characteristics, prefixEstimatedSize);\n@@ -1175,1 +1221,3 @@\n-        public long estimateSize() { return (long)(fence - index); }\n+        public long estimateSize() {\n+            return estimatedSize >= 0 ? estimatedSize : (long)(fence - index);\n+        }\n@@ -1199,0 +1247,1 @@\n+        private long estimatedSize; \/\/ estimated size, to help to split evenly\n@@ -1225,0 +1274,9 @@\n+            this.estimatedSize = -1;\n+        }\n+\n+        private DoubleArraySpliterator(double[] array, int origin, int fence, int characteristics, long estimatedSize) {\n+            this.array = array;\n+            this.index = origin;\n+            this.fence = fence;\n+            this.characteristics = characteristics & ~(Spliterator.SIZED | Spliterator.SUBSIZED);\n+            this.estimatedSize = estimatedSize;\n@@ -1230,3 +1288,7 @@\n-            return (lo >= mid)\n-                   ? null\n-                   : new DoubleArraySpliterator(array, lo, index = mid, characteristics);\n+            if (lo >= mid) return null;\n+            if (estimatedSize == -1) {\n+                return new DoubleArraySpliterator(array, lo, index = mid, characteristics);\n+            }\n+            long prefixEstimatedSize = estimatedSize >>> 1;\n+            estimatedSize -= prefixEstimatedSize;\n+            return new DoubleArraySpliterator(array, lo, index = mid, characteristics, prefixEstimatedSize);\n@@ -1258,1 +1320,3 @@\n-        public long estimateSize() { return (long)(fence - index); }\n+        public long estimateSize() {\n+            return estimatedSize >= 0 ? estimatedSize : (long)(fence - index);\n+        }\n@@ -1365,1 +1429,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -1367,1 +1431,3 @@\n-                return new ArraySpliterator<>(a, 0, j, characteristics());\n+                    return new ArraySpliterator<>(a, 0, j, characteristics);\n+                }\n+                return new ArraySpliterator<>(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -1475,1 +1541,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -1477,1 +1543,3 @@\n-                return new IntArraySpliterator(a, 0, j, characteristics());\n+                    return new IntArraySpliterator(a, 0, j, characteristics);\n+                }\n+                return new IntArraySpliterator(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -1585,1 +1653,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -1587,1 +1655,3 @@\n-                return new LongArraySpliterator(a, 0, j, characteristics());\n+                    return new LongArraySpliterator(a, 0, j, characteristics);\n+                }\n+                return new LongArraySpliterator(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -1695,1 +1765,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -1697,1 +1767,3 @@\n-                return new DoubleArraySpliterator(a, 0, j, characteristics());\n+                    return new DoubleArraySpliterator(a, 0, j, characteristics);\n+                }\n+                return new DoubleArraySpliterator(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -1830,1 +1902,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -1832,1 +1904,3 @@\n-                return new ArraySpliterator<>(a, 0, j, characteristics);\n+                    return new ArraySpliterator<>(a, 0, j, characteristics);\n+                }\n+                return new ArraySpliterator<>(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -1942,1 +2016,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -1944,1 +2018,3 @@\n-                return new IntArraySpliterator(a, 0, j, characteristics);\n+                    return new IntArraySpliterator(a, 0, j, characteristics);\n+                }\n+                return new IntArraySpliterator(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -2036,1 +2112,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -2038,1 +2114,3 @@\n-                return new LongArraySpliterator(a, 0, j, characteristics);\n+                    return new LongArraySpliterator(a, 0, j, characteristics);\n+                }\n+                return new LongArraySpliterator(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n@@ -2130,1 +2208,1 @@\n-                if (est != Long.MAX_VALUE)\n+                if (est != Long.MAX_VALUE) {\n@@ -2132,1 +2210,3 @@\n-                return new DoubleArraySpliterator(a, 0, j, characteristics);\n+                    return new DoubleArraySpliterator(a, 0, j, characteristics);\n+                }\n+                return new DoubleArraySpliterator(a, 0, j, characteristics, Long.MAX_VALUE \/ 2);\n","filename":"src\/java.base\/share\/classes\/java\/util\/Spliterators.java","additions":113,"deletions":33,"binary":false,"changes":146,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -2986,1 +2986,1 @@\n-     * To boostrap initialization, external constructors use\n+     * To bootstrap initialization, external constructors use\n","filename":"src\/java.base\/share\/classes\/java\/util\/TreeMap.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -201,0 +201,4 @@\n+     * @apiNote\n+     * To create a {@code WeakHashMap} with an initial capacity that accommodates\n+     * an expected number of mappings, use {@link #newWeakHashMap(int) newWeakHashMap}.\n+     *\n@@ -226,0 +230,4 @@\n+     * @apiNote\n+     * To create a {@code WeakHashMap} with an initial capacity that accommodates\n+     * an expected number of mappings, use {@link #newWeakHashMap(int) newWeakHashMap}.\n+     *\n@@ -1338,0 +1346,17 @@\n+    \/**\n+     * Creates a new, empty WeakHashMap suitable for the expected number of mappings.\n+     * The returned map uses the default load factor of 0.75, and its initial capacity is\n+     * generally large enough so that the expected number of mappings can be added\n+     * without resizing the map.\n+     *\n+     * @param numMappings the expected number of mappings\n+     * @param <K>         the type of keys maintained by this map\n+     * @param <V>         the type of mapped values\n+     * @return the newly created map\n+     * @throws IllegalArgumentException if numMappings is negative\n+     * @since 19\n+     *\/\n+    public static <K, V> WeakHashMap<K, V> newWeakHashMap(int numMappings) {\n+        return new WeakHashMap<>(HashMap.calculateHashMapCapacity(numMappings));\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/util\/WeakHashMap.java","additions":26,"deletions":1,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -679,1 +679,1 @@\n-     * Nulls out slots starting at array index i, upto index end.\n+     * Nulls out slots starting at array index i, up to index end.\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ArrayBlockingQueue.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,1 @@\n-        this(11);\n+        this(16);\n@@ -82,1 +82,1 @@\n-        map = new LinkedHashMap<>(size);\n+        map = LinkedHashMap.newLinkedHashMap(size);\n","filename":"src\/java.base\/share\/classes\/java\/util\/jar\/Attributes.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -675,1 +675,1 @@\n-            signerMap = new HashMap<>(verifiedSigners.size() + sigFileSigners.size());\n+            signerMap = HashMap.newHashMap(verifiedSigners.size() + sigFileSigners.size());\n","filename":"src\/java.base\/share\/classes\/java\/util\/jar\/JarVerifier.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -542,7 +542,9 @@\n-     *         is greater than or equal to {@code bound}\n-     *\n-     * @implSpec The default implementation checks that {@code origin} and\n-     * {@code bound} are positive finite floats. Then invokes\n-     * {@code nextFloat()}, scaling and translating the result so that the final\n-     * result lies between {@code origin} (inclusive) and {@code bound}\n-     * (exclusive).\n+     *         is greater than or equal to {@code bound}, or\n+     *         the difference between {@code bound} and {@code origin}\n+     *         is so large that it cannot be represented as a finite\n+     *         {@code float} value\n+     *\n+     * @implSpec The default implementation verifies that the {@code origin}\n+     *           and {@code bound} are valid then invokes {@code nextFloat()}\n+     *           scaling and translating the result to fit between {@code origin}\n+     *           and {@code bound} (exclusive).\n@@ -606,7 +608,9 @@\n-     *         is greater than or equal to {@code bound}\n-     *\n-     * @implSpec The default implementation checks that {@code origin} and\n-     * {@code bound} are positive finite doubles. Then calls\n-     * {@code nextDouble()}, scaling and translating the result so that the final\n-     * result lies between {@code origin} (inclusive) and {@code bound}\n-     * (exclusive).\n+     *         is greater than or equal to {@code bound}, or\n+     *         the difference between {@code bound} and {@code origin}\n+     *         is so large that it cannot be represented as a finite\n+     *         {@code double} value\n+     *\n+     * @implSpec The default implementation verifies that the {@code origin}\n+     *           and {@code bound} are valid, then invokes {@code nextDouble()}\n+     *           scaling and translating the result to fit between {@code origin}\n+     *           and {@code bound}( exclusive).\n","filename":"src\/java.base\/share\/classes\/java\/util\/random\/RandomGenerator.java","additions":18,"deletions":14,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,1 @@\n- * <pre>{@code\n+ * {@snippet :\n@@ -79,1 +79,1 @@\n- * }<\/pre>\n+ * }\n@@ -90,1 +90,1 @@\n- * <pre>{@code\n+ * {@snippet :\n@@ -92,1 +92,2 @@\n- *         .sorted(Comparator.comparingInt(RandomGenerator::stateBits).reversed())\n+ *         .filter(rgf -> !rgf.name().equals(\"SecureRandom\")) \/\/ SecureRandom has MAX_VALUE stateBits.\n+ *         .sorted(Comparator.comparingInt(RandomGeneratorFactory<RandomGenerator>::stateBits).reversed())\n@@ -99,1 +100,1 @@\n- * }<\/pre>\n+ * }\n","filename":"src\/java.base\/share\/classes\/java\/util\/random\/RandomGeneratorFactory.java","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -4911,1 +4911,1 @@\n-                    \/\/ If yes, then just return false wihtout trying\n+                    \/\/ If yes, then just return false without trying\n","filename":"src\/java.base\/share\/classes\/java\/util\/regex\/Pattern.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -217,1 +217,1 @@\n-        \/\/ or if bytes are stored with a larger witdh than one byte.,%\n+        \/\/ or if bytes are stored with a larger width than one byte.,%\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/CRC32C.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-    boolean csizeSet = false; \/\/ Only true if csize was explicitely set by\n+    boolean csizeSet = false; \/\/ Only true if csize was explicitly set by\n@@ -565,1 +565,1 @@\n-                            \/\/ be the magic value and it \"accidently\" has some\n+                            \/\/ be the magic value and it \"accidentally\" has some\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipEntry.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1635,1 +1635,1 @@\n-                    \/\/ The CEN name must match the specfied one\n+                    \/\/ The CEN name must match the specified one\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipFile.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -703,2 +703,2 @@\n-            writeLong(xentries.size());    \/\/ number of directory entires on disk\n-            writeLong(xentries.size());    \/\/ number of directory entires\n+            writeLong(xentries.size());    \/\/ number of directory entries on disk\n+            writeLong(xentries.size());    \/\/ number of directory entries\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipOutputStream.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -286,1 +286,1 @@\n-     * Loads zip native library, if not already laoded\n+     * Loads zip native library, if not already loaded\n","filename":"src\/java.base\/share\/classes\/java\/util\/zip\/ZipUtils.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -224,1 +224,1 @@\n-    private String transformation;\n+    private final String transformation;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/Cipher.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import java.io.InputStream;\n@@ -31,2 +30,1 @@\n-import javax.crypto.BadPaddingException;\n-import javax.crypto.IllegalBlockSizeException;\n+import java.io.InputStream;\n@@ -80,1 +78,1 @@\n-    private Cipher cipher;\n+    private final Cipher cipher;\n@@ -83,1 +81,1 @@\n-    private InputStream input;\n+    private final InputStream input;\n@@ -88,1 +86,1 @@\n-    private byte[] ibuffer = new byte[512];\n+    private final byte[] ibuffer = new byte[512];\n@@ -218,1 +216,1 @@\n-    };\n+    }\n@@ -236,1 +234,1 @@\n-    public int read(byte b[]) throws IOException {\n+    public int read(byte[] b) throws IOException {\n@@ -257,1 +255,1 @@\n-    public int read(byte b[], int off, int len) throws IOException {\n+    public int read(byte[] b, int off, int len) throws IOException {\n@@ -340,1 +338,1 @@\n-        \/\/ AEAD ciphers are fully readed before closing.  Any authentication\n+        \/\/ AEAD ciphers are fully read before closing.  Any authentication\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/CipherInputStream.java","additions":9,"deletions":11,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,1 +74,1 @@\n-    private Cipher cipher;\n+    private final Cipher cipher;\n@@ -77,1 +77,1 @@\n-    private OutputStream output;\n+    private final OutputStream output;\n@@ -80,1 +80,1 @@\n-    private byte[] ibuffer = new byte[1];\n+    private final byte[] ibuffer = new byte[1];\n@@ -116,1 +116,1 @@\n-    };\n+    }\n@@ -152,1 +152,1 @@\n-    };\n+    }\n@@ -169,1 +169,1 @@\n-    public void write(byte b[]) throws IOException {\n+    public void write(byte[] b) throws IOException {\n@@ -183,1 +183,1 @@\n-    public void write(byte b[], int off, int len) throws IOException {\n+    public void write(byte[] b, int off, int len) throws IOException {\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/CipherOutputStream.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -28,9 +28,0 @@\n-import java.security.AlgorithmParameters;\n-import java.security.Key;\n-import java.security.SecureRandom;\n-import java.security.NoSuchAlgorithmException;\n-import java.security.InvalidKeyException;\n-import java.security.InvalidAlgorithmParameterException;\n-import java.security.ProviderException;\n-import java.security.spec.AlgorithmParameterSpec;\n-\n@@ -38,0 +29,2 @@\n+import java.security.*;\n+import java.security.spec.AlgorithmParameterSpec;\n@@ -543,1 +536,1 @@\n-     * @param output the output ByteByffer\n+     * @param output the output ByteBuffer\n@@ -704,1 +697,1 @@\n-     * @param output the output ByteByffer\n+     * @param output the output ByteBuffer\n@@ -774,0 +767,1 @@\n+            byte[] outArray;\n@@ -775,1 +769,1 @@\n-                byte[] outArray = output.array();\n+                outArray = output.array();\n@@ -800,2 +794,0 @@\n-                \/\/ adjust input position manually\n-                input.position(inLimit);\n@@ -803,1 +795,0 @@\n-                byte[] outArray = null;\n@@ -813,2 +804,0 @@\n-                \/\/ adjust input position manually\n-                input.position(inLimit);\n@@ -816,0 +805,2 @@\n+            \/\/ adjust input position manually\n+            input.position(inLimit);\n@@ -937,1 +928,1 @@\n-     * Continues a multi-part update of the Additional Authentication\n+     * Continues a multipart update of the Additional Authentication\n@@ -967,1 +958,1 @@\n-     * Continues a multi-part update of the Additional Authentication\n+     * Continues a multipart update of the Additional Authentication\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/CipherSpi.java","additions":10,"deletions":19,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.io.Serial;\n@@ -55,1 +56,1 @@\n-    private String alg;\n+    private final String alg;\n@@ -222,1 +223,1 @@\n-        if (!(p instanceof CryptoPermission))\n+        if (!(p instanceof CryptoPermission cp))\n@@ -225,2 +226,0 @@\n-        CryptoPermission cp = (CryptoPermission)p;\n-\n@@ -241,3 +240,1 @@\n-            if (impliesExemptionMechanism(cp.exemptionMechanism)) {\n-                return true;\n-            }\n+            return impliesExemptionMechanism(cp.exemptionMechanism);\n@@ -264,1 +261,1 @@\n-        if (!(obj instanceof CryptoPermission))\n+        if (!(obj instanceof CryptoPermission that))\n@@ -267,2 +264,0 @@\n-        CryptoPermission that = (CryptoPermission) obj;\n-\n@@ -303,1 +298,1 @@\n-     * onject.\n+     * object.\n@@ -401,5 +396,1 @@\n-        if (this.exemptionMechanism.equals(exemptionMechanism)) {\n-            return true;\n-        }\n-\n-        return false;\n+        return this.exemptionMechanism.equals(exemptionMechanism);\n@@ -445,6 +436,1 @@\n-            if (this.algParamSpec.equals(algParamSpec)) {\n-                return true;\n-            }\n-            return false;\n-        } else if (this.checkParam) {\n-            return false;\n+            return this.algParamSpec.equals(algParamSpec);\n@@ -452,1 +438,1 @@\n-            return true;\n+            return !this.checkParam;\n@@ -458,1 +444,1 @@\n-            return (obj2 == null ? true : false);\n+            return (obj2 == null);\n@@ -478,0 +464,1 @@\n+    @Serial\n@@ -480,1 +467,1 @@\n-    private Vector<Permission> permissions;\n+    private final Vector<Permission> permissions;\n@@ -487,1 +474,1 @@\n-        permissions = new Vector<Permission>(3);\n+        permissions = new Vector<>(3);\n@@ -519,1 +506,1 @@\n-        if (!(permission instanceof CryptoPermission))\n+        if (!(permission instanceof CryptoPermission cp))\n@@ -522,2 +509,0 @@\n-        CryptoPermission cp = (CryptoPermission)permission;\n-\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/CryptoPermission.java","additions":15,"deletions":30,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -146,1 +146,1 @@\n-        if (!(permission instanceof CryptoPermission)) {\n+        if (!(permission instanceof CryptoPermission cryptoPerm)) {\n@@ -150,1 +150,0 @@\n-        CryptoPermission cryptoPerm = (CryptoPermission)permission;\n@@ -159,1 +158,1 @@\n-     * Checks if this object's PermissionCollection for permissons\n+     * Checks if this object's PermissionCollection for permissions\n@@ -171,1 +170,1 @@\n-        if (!(permission instanceof CryptoPermission)) {\n+        if (!(permission instanceof CryptoPermission cryptoPerm)) {\n@@ -175,2 +174,0 @@\n-        CryptoPermission cryptoPerm = (CryptoPermission)permission;\n-\n@@ -302,1 +299,1 @@\n-     * @param thisPc the first given PermissionColloection\n+     * @param thisPc the first given PermissionCollection\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/CryptoPermissions.java","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,1 +69,1 @@\n-    private Vector<GrantEntry> grantEntries;\n+    private final Vector<GrantEntry> grantEntries;\n@@ -79,1 +79,1 @@\n-        grantEntries = new Vector<GrantEntry>();\n+        grantEntries = new Vector<>();\n@@ -144,2 +144,1 @@\n-                if (ge != null)\n-                    grantEntries.addElement(ge);\n+                grantEntries.addElement(ge);\n@@ -283,2 +282,2 @@\n-    private static final AlgorithmParameterSpec getInstance(String type,\n-                                                            Integer[] params)\n+    private static AlgorithmParameterSpec getInstance(String type,\n+                                                      Integer[] params)\n@@ -287,1 +286,1 @@\n-        AlgorithmParameterSpec ret = null;\n+        AlgorithmParameterSpec ret;\n@@ -499,1 +498,1 @@\n-            processedPermissions = new Hashtable<String, Vector<String>>();\n+            processedPermissions = new Hashtable<>();\n@@ -518,1 +517,1 @@\n-            exemptionMechanisms = new Vector<String>(1);\n+            exemptionMechanisms = new Vector<>(1);\n@@ -556,1 +555,1 @@\n-        private Vector<CryptoPermissionEntry> permissionEntries;\n+        private final Vector<CryptoPermissionEntry> permissionEntries;\n@@ -559,1 +558,1 @@\n-            permissionEntries = new Vector<CryptoPermissionEntry>();\n+            permissionEntries = new Vector<>();\n@@ -646,1 +645,1 @@\n-            if (!(obj instanceof CryptoPermissionEntry))\n+            if (!(obj instanceof CryptoPermissionEntry that))\n@@ -649,2 +648,0 @@\n-            CryptoPermissionEntry that = (CryptoPermissionEntry) obj;\n-\n@@ -671,1 +668,1 @@\n-                if (that.algParamSpec != null) return false;\n+                return that.algParamSpec == null;\n@@ -673,2 +670,1 @@\n-                if (!this.algParamSpec.equals(that.algParamSpec))\n-                    return false;\n+                return this.algParamSpec.equals(that.algParamSpec);\n@@ -676,3 +672,0 @@\n-\n-            \/\/ everything matched -- the 2 objects are equal\n-            return true;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/CryptoPolicyParser.java","additions":14,"deletions":21,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-    private AlgorithmId algid;\n+    private final AlgorithmId algid;\n@@ -67,1 +67,1 @@\n-    private byte[] encryptedData;\n+    private final byte[] encryptedData;\n@@ -70,1 +70,1 @@\n-    private byte[] encoded = null;\n+    private byte[] encoded;\n@@ -86,1 +86,2 @@\n-        DerValue val = new DerValue(encoded);\n+        this.encoded = encoded.clone();\n+        DerValue val = DerValue.wrap(this.encoded);\n@@ -91,1 +92,0 @@\n-        this.encoded = encoded.clone();\n@@ -127,1 +127,1 @@\n-     * <code>encrypedData<\/code> are copied to protect against subsequent\n+     * <code>encryptedData<\/code> are copied to protect against subsequent\n@@ -165,1 +165,1 @@\n-     * of the <code>AlgorithmIdentifer<\/code> component of the\n+     * of the <code>AlgorithmIdentifier<\/code> component of the\n@@ -168,1 +168,1 @@\n-     * <code>encrypedData<\/code> are copied to protect against\n+     * <code>encryptedData<\/code> are copied to protect against\n@@ -251,1 +251,1 @@\n-        byte[] encoded = null;\n+        byte[] encoded;\n@@ -267,1 +267,1 @@\n-        byte[] encoded = null;\n+        byte[] encoded;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/EncryptedPrivateKeyInfo.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,1 +55,1 @@\n-    private Provider provider;\n+    private final Provider provider;\n@@ -58,1 +58,1 @@\n-    private ExemptionMechanismSpi exmechSpi;\n+    private final ExemptionMechanismSpi exmechSpi;\n@@ -61,1 +61,1 @@\n-    private String mechanism;\n+    private final String mechanism;\n@@ -121,1 +121,1 @@\n-     * may be different than the order of providers returned by\n+     * may be different from the order of providers returned by\n@@ -231,1 +231,1 @@\n-            Provider provider) throws NoSuchAlgorithmException {\n+        Provider provider) throws NoSuchAlgorithmException {\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/ExemptionMechanism.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,1 +93,1 @@\n-        \/\/ lookup is case sensitive.\n+        \/\/ lookup is case-sensitive.\n@@ -202,1 +202,0 @@\n-                continue;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/JceSecurityManager.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -160,1 +160,1 @@\n-     * may be different than the order of providers returned by\n+     * may be different from the order of providers returned by\n@@ -189,1 +189,1 @@\n-            if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+            if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -322,1 +322,1 @@\n-                if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+                if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -327,1 +327,1 @@\n-                    if (obj instanceof KeyAgreementSpi == false) {\n+                    if (!(obj instanceof KeyAgreementSpi)) {\n@@ -380,1 +380,1 @@\n-                if (s.supportsParameter(key) == false) {\n+                if (!s.supportsParameter(key)) {\n@@ -383,1 +383,1 @@\n-                if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+                if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -566,1 +566,1 @@\n-     * @param lastPhase flag which indicates whether or not this is the last\n+     * @param lastPhase flag which indicates whether this is the last\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/KeyAgreement.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -121,1 +121,1 @@\n-     * @param lastPhase flag which indicates whether or not this is the last\n+     * @param lastPhase flag which indicates whether this is the last\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/KeyAgreementSpi.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -221,1 +221,1 @@\n-     * may be different than the order of providers returned by\n+     * may be different from the order of providers returned by\n@@ -362,1 +362,1 @@\n-                if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+                if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -368,1 +368,1 @@\n-                    if (inst instanceof KeyGeneratorSpi == false) {\n+                    if (!(inst instanceof KeyGeneratorSpi spi)) {\n@@ -371,1 +371,0 @@\n-                    KeyGeneratorSpi spi = (KeyGeneratorSpi)inst;\n@@ -492,4 +491,1 @@\n-        if (failure instanceof RuntimeException) {\n-            throw (RuntimeException)failure;\n-        }\n-        throw new InvalidAlgorithmParameterException(\"init() failed\", failure);\n+        throw (RuntimeException)failure;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/KeyGenerator.java","additions":5,"deletions":9,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -159,1 +159,1 @@\n-     * may be different than the order of providers returned by\n+     * may be different from the order of providers returned by\n@@ -185,1 +185,1 @@\n-            if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+            if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -313,1 +313,1 @@\n-                if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+                if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -318,1 +318,1 @@\n-                    if (obj instanceof MacSpi == false) {\n+                    if (!(obj instanceof MacSpi)) {\n@@ -357,1 +357,1 @@\n-                if (s.supportsParameter(key) == false) {\n+                if (!s.supportsParameter(key)) {\n@@ -360,1 +360,1 @@\n-                if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+                if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -484,1 +484,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n@@ -500,1 +500,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n@@ -522,1 +522,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n@@ -547,1 +547,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n@@ -577,1 +577,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n@@ -615,1 +615,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n@@ -625,1 +625,0 @@\n-        return;\n@@ -651,1 +650,1 @@\n-        if (initialized == false) {\n+        if (!initialized) {\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/Mac.java","additions":14,"deletions":15,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -107,1 +107,1 @@\n-        if (input.hasRemaining() == false) {\n+        if (!input.hasRemaining()) {\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/MacSpi.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,2 +61,1 @@\n-        byte[] x = new byte[8];\n-        return x;\n+        return new byte[8];\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/NullCipherSpi.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,3 +49,2 @@\n-    private URL jarURL;\n-    private Provider provider;\n-    private boolean savePerms;\n+    private final URL jarURL;\n+    private final boolean savePerms;\n@@ -75,1 +74,0 @@\n-        this.provider = provider;\n@@ -97,1 +95,1 @@\n-                        jarURL : new URL(\"jar:\" + jarURL.toString() + \"!\/\");\n+                        jarURL : new URL(\"jar:\" + jarURL + \"!\/\");\n@@ -106,10 +104,8 @@\n-                         new PrivilegedExceptionAction<JarFile>() {\n-                             public JarFile run() throws Exception {\n-                                 JarURLConnection conn =\n-                                     (JarURLConnection) url.openConnection();\n-                                 \/\/ You could do some caching here as\n-                                 \/\/ an optimization.\n-                                 conn.setUseCaches(false);\n-                                 return conn.getJarFile();\n-                             }\n-                         });\n+                        (PrivilegedExceptionAction<JarFile>) () -> {\n+                            JarURLConnection conn =\n+                                (JarURLConnection) url.openConnection();\n+                            \/\/ You could do some caching here as\n+                            \/\/ an optimization.\n+                            conn.setUseCaches(false);\n+                            return conn.getJarFile();\n+                        });\n@@ -118,1 +114,1 @@\n-                throw new SecurityException(\"Cannot load \" + url.toString(),\n+                throw new SecurityException(\"Cannot load \" + url,\n@@ -133,2 +129,1 @@\n-                        new JarException(\"Cannot load\/parse\" +\n-                            jarURL.toString());\n+                        new JarException(\"Cannot load\/parse\" + jarURL);\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/ProviderVerifier.java","additions":14,"deletions":19,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -112,1 +112,1 @@\n-    private String sealAlg = null;\n+    private final String sealAlg;\n@@ -138,1 +138,1 @@\n-     * operation are stored inside of the new <code>SealedObject<\/code>.\n+     * operation are stored inside the new <code>SealedObject<\/code>.\n@@ -238,1 +238,1 @@\n-     * @exception IOException if an error occurs during de-serialiazation.\n+     * @exception IOException if an error occurs during de-serialization.\n@@ -240,1 +240,1 @@\n-     * de-serialiazation.\n+     * de-serialization.\n@@ -279,1 +279,1 @@\n-     * @exception IOException if an error occurs during de-serialiazation\n+     * @exception IOException if an error occurs during de-serialization\n@@ -281,1 +281,1 @@\n-     * de-serialiazation\n+     * de-serialization\n@@ -294,2 +294,1 @@\n-            Object obj = a.readObject();\n-            return obj;\n+            return a.readObject();\n@@ -320,1 +319,1 @@\n-     * @exception IOException if an error occurs during de-serialiazation.\n+     * @exception IOException if an error occurs during de-serialization.\n@@ -322,1 +321,1 @@\n-     * de-serialiazation.\n+     * de-serialization.\n@@ -411,2 +410,1 @@\n-            Object obj = a.readObject();\n-            return obj;\n+            return a.readObject();\n@@ -445,1 +443,1 @@\n-        SharedSecrets.setJavaxCryptoSealedObjectAccess((obj,c) -> obj.getExtObjectInputStream(c));\n+        SharedSecrets.setJavaxCryptoSealedObjectAccess(SealedObject::getExtObjectInputStream);\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/SealedObject.java","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,1 @@\n-    static final long serialVersionUID = -4795878709595146952L;\n+    long serialVersionUID = -4795878709595146952L;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/SecretKey.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n- * <P> Key factories are bi-directional, i.e., they allow to build an opaque\n+ * <P> Key factories are bidirectional, i.e., they allow to build an opaque\n@@ -141,1 +141,1 @@\n-     * may be different than the order of providers returned by\n+     * may be different from the order of providers returned by\n@@ -283,1 +283,1 @@\n-     * implementation for failover. If no more implemenations are\n+     * implementation for failover. If no more implementations are\n@@ -299,1 +299,1 @@\n-                if (JceSecurity.canUseProvider(s.getProvider()) == false) {\n+                if (!JceSecurity.canUseProvider(s.getProvider())) {\n@@ -304,1 +304,1 @@\n-                    if (obj instanceof SecretKeyFactorySpi == false) {\n+                    if (!(obj instanceof SecretKeyFactorySpi spi)) {\n@@ -307,1 +307,0 @@\n-                    SecretKeyFactorySpi spi = (SecretKeyFactorySpi)obj;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/SecretKeyFactory.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,1 @@\n-    static final long serialVersionUID = 2211791113380396553L;\n+    long serialVersionUID = 2211791113380396553L;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/interfaces\/DHPrivateKey.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,1 @@\n-    static final long serialVersionUID = -6628103563352519193L;\n+    long serialVersionUID = -6628103563352519193L;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/interfaces\/DHPublicKey.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-import java.math.BigInteger;\n-\n@@ -51,1 +49,1 @@\n-    static final long serialVersionUID = -1430015993304333921L;\n+    long serialVersionUID = -1430015993304333921L;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/interfaces\/PBEKey.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,1 +40,1 @@\n- * seamlessly as needed.  Therefore application developers may take\n+ * seamlessly as needed.  Therefore, application developers may take\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/package-info.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2011, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n-    private byte[] key;\n+    private final byte[] key;\n@@ -229,2 +229,2 @@\n-            for (int j = 0; j < DES_KEY_LEN && found == true; j++) {\n-                if (WEAK_KEYS[i][j] != key[j+offset]) {\n+            for (int j = 0; j < DES_KEY_LEN; j++) {\n+                if (WEAK_KEYS[i][j] != key[j + offset]) {\n@@ -232,0 +232,1 @@\n+                    break;\n@@ -234,2 +235,2 @@\n-            if (found == true) {\n-                return found;\n+            if (found) {\n+                return true;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/DESKeySpec.java","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2011, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n-    private byte[] key;\n+    private final byte[] key;\n@@ -119,6 +119,3 @@\n-            if (DESKeySpec.isParityAdjusted(key, offset) == false\n-                || DESKeySpec.isParityAdjusted(key, offset + 8) == false\n-                || DESKeySpec.isParityAdjusted(key, offset + 16) == false) {\n-                return false;\n-            }\n-            return true;\n+        return DESKeySpec.isParityAdjusted(key, offset)\n+                && DESKeySpec.isParityAdjusted(key, offset + 8)\n+                && DESKeySpec.isParityAdjusted(key, offset + 16);\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/DESedeKeySpec.java","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import java.math.BigInteger;\n@@ -48,1 +47,1 @@\n-    private int primeSize;\n+    private final int primeSize;\n@@ -51,1 +50,1 @@\n-    private int exponentSize;\n+    private final int exponentSize;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/DHGenParameterSpec.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,1 +58,1 @@\n-    private BigInteger p;\n+    private final BigInteger p;\n@@ -61,1 +61,1 @@\n-    private BigInteger g;\n+    private final BigInteger g;\n@@ -64,1 +64,1 @@\n-    private int l;\n+    private final int l;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/DHParameterSpec.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-    private BigInteger x;\n+    private final BigInteger x;\n@@ -49,1 +49,1 @@\n-    private BigInteger p;\n+    private final BigInteger p;\n@@ -52,1 +52,1 @@\n-    private BigInteger g;\n+    private final BigInteger g;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/DHPrivateKeySpec.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-    private BigInteger y;\n+    private final BigInteger y;\n@@ -49,1 +49,1 @@\n-    private BigInteger p;\n+    private final BigInteger p;\n@@ -52,1 +52,1 @@\n-    private BigInteger g;\n+    private final BigInteger g;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/DHPublicKeySpec.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,1 +42,1 @@\n-    private byte[] iv;\n+    private final byte[] iv;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/IvParameterSpec.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import java.math.BigInteger;\n@@ -75,7 +74,0 @@\n- * <p>Note: the OAEPParameterSpec.DEFAULT uses the following:\n- * <pre>\n- *     message digest  -- \"SHA-1\"\n- *     mask generation function (mgf) -- \"MGF1\"\n- *     parameters for mgf -- MGF1ParameterSpec.SHA1\n- *     source of encoding input -- PSource.PSpecified.DEFAULT\n- * <\/pre>\n@@ -92,9 +84,4 @@\n-    private String mdName = \"SHA-1\";\n-    private String mgfName = \"MGF1\";\n-    private AlgorithmParameterSpec mgfSpec = MGF1ParameterSpec.SHA1;\n-    private PSource pSrc = PSource.PSpecified.DEFAULT;\n-\n-    \/**\n-     * The OAEP parameter set with all default values.\n-     *\/\n-    public static final OAEPParameterSpec DEFAULT = new OAEPParameterSpec();\n+    private final String mdName;\n+    private final String mgfName;\n+    private final AlgorithmParameterSpec mgfSpec;\n+    private final PSource pSrc;\n@@ -103,2 +90,15 @@\n-     * Constructs a parameter set for OAEP padding as defined in\n-     * the PKCS #1 standard using the default values.\n+     * The OAEP parameter set with all default values, i.e. \"SHA-1\" as message\n+     * digest algorithm, \"MGF1\" as mask generation function (mgf) algorithm,\n+     * {@code MGF1ParameterSpec.SHA1} as parameters for the mask generation\n+     * function, and {@code PSource.PSpecified.DEFAULT} as the source of the\n+     * encoding input.\n+     *\n+     * @deprecated This field uses the default values defined in the PKCS #1\n+     *         standard. Some of these defaults are no longer recommended due\n+     *         to advances in cryptanalysis -- see\n+     *         <a href=\"https:\/\/www.rfc-editor.org\/rfc\/rfc8017#appendix-B.1\">Appendix B.1 of PKCS #1<\/a>\n+     *         for more details. Thus, it is recommended to create\n+     *         a new {@code OAEPParameterSpec} with the desired parameter values\n+     *         using the\n+     *         {@link #OAEPParameterSpec(String, String, AlgorithmParameterSpec, PSource)} constructor.\n+     *\n@@ -106,2 +106,4 @@\n-    private OAEPParameterSpec() {\n-    }\n+    @Deprecated(since=\"19\")\n+    public static final OAEPParameterSpec DEFAULT = new OAEPParameterSpec(\n+            \"SHA-1\", \"MGF1\", MGF1ParameterSpec.SHA1,\n+            PSource.PSpecified.DEFAULT);\n@@ -112,4 +114,4 @@\n-     * algorithm <code>mdName<\/code>, mask generation function\n-     * algorithm <code>mgfName<\/code>, parameters for the mask\n-     * generation function <code>mgfSpec<\/code>, and source of\n-     * the encoding input P <code>pSrc<\/code>.\n+     * algorithm {@code mdName}, mask generation function\n+     * algorithm {@code mgfName}, parameters for the mask\n+     * generation function {@code mgfSpec}, and source of\n+     * the encoding input P {@code pSrc}.\n@@ -117,8 +119,8 @@\n-     * @param mdName the algorithm name for the message digest.\n-     * @param mgfName the algorithm name for the mask generation\n-     * function.\n-     * @param mgfSpec the parameters for the mask generation function.\n-     * If null is specified, null will be returned by getMGFParameters().\n-     * @param pSrc the source of the encoding input P.\n-     * @exception NullPointerException if <code>mdName<\/code>,\n-     * <code>mgfName<\/code>, or <code>pSrc<\/code> is null.\n+     * @param mdName the algorithm name for the message digest\n+     * @param mgfName the algorithm name for the mask generation function\n+     * @param mgfSpec the parameters for the mask generation function;\n+     * if {@code null} is specified, {@code null} will be returned by\n+     * {@link #getMGFParameters()}\n+     * @param pSrc the source of the encoding input P\n+     * @throws NullPointerException if {@code mdName},\n+     * {@code mgfName}, or {@code pSrc} is {@code null}\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/OAEPParameterSpec.java","additions":36,"deletions":34,"binary":false,"changes":70,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,2 +42,2 @@\n-    private byte[] salt;\n-    private int iterationCount;\n+    private final byte[] salt;\n+    private final int iterationCount;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/PBEParameterSpec.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,1 +51,1 @@\n-    private String pSrcName;\n+    private final String pSrcName;\n@@ -85,1 +85,1 @@\n-        private byte[] p = new byte[0];\n+        private final byte[] p;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/PSource.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n-    private int effectiveKeyBits;\n+    private final int effectiveKeyBits;\n@@ -138,1 +138,1 @@\n-        if (!(obj instanceof RC2ParameterSpec)) {\n+        if (!(obj instanceof RC2ParameterSpec other)) {\n@@ -141,1 +141,0 @@\n-        RC2ParameterSpec other = (RC2ParameterSpec) obj;\n@@ -158,1 +157,1 @@\n-        return (retval += effectiveKeyBits);\n+        return retval + effectiveKeyBits;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/RC2ParameterSpec.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,3 +50,3 @@\n-    private int version;\n-    private int rounds;\n-    private int wordSize; \/\/ the word size in bits\n+    private final int version;\n+    private final int rounds;\n+    private final int wordSize; \/\/ the word size in bits\n@@ -183,1 +183,1 @@\n-        if (!(obj instanceof RC5ParameterSpec)) {\n+        if (!(obj instanceof RC5ParameterSpec other)) {\n@@ -186,1 +186,0 @@\n-        RC5ParameterSpec other = (RC5ParameterSpec) obj;\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/RC5ParameterSpec.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import jdk.internal.access.JavaxCryptoSpecAccess;\n@@ -31,0 +30,1 @@\n+import javax.crypto.SecretKey;\n@@ -35,1 +35,0 @@\n-import javax.crypto.SecretKey;\n@@ -64,1 +63,1 @@\n-    private byte[] key;\n+    private final byte[] key;\n@@ -71,1 +70,1 @@\n-    private String algorithm;\n+    private final String algorithm;\n@@ -75,6 +74,1 @@\n-                new JavaxCryptoSpecAccess() {\n-                    @Override\n-                    public void clearSecretKeySpec(SecretKeySpec keySpec) {\n-                        keySpec.clear();\n-                    }\n-                });\n+                SecretKeySpec::clear);\n@@ -213,1 +207,1 @@\n-            return (retval ^= \"desede\".hashCode());\n+            return retval ^ \"desede\".hashCode();\n@@ -215,2 +209,1 @@\n-            return (retval ^=\n-                    this.algorithm.toLowerCase(Locale.ENGLISH).hashCode());\n+            return retval ^ this.algorithm.toLowerCase(Locale.ENGLISH).hashCode();\n","filename":"src\/java.base\/share\/classes\/javax\/crypto\/spec\/SecretKeySpec.java","additions":7,"deletions":14,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -216,1 +216,1 @@\n-     * to the local address and port suplied.  The socket is configured using\n+     * to the local address and port supplied.  The socket is configured using\n","filename":"src\/java.base\/share\/classes\/javax\/net\/SocketFactory.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -132,1 +132,1 @@\n-     * end-entity certiticate for X509-based cipher suites, and\n+     * end-entity certificate for X509-based cipher suites, and\n","filename":"src\/java.base\/share\/classes\/javax\/net\/ssl\/HttpsURLConnection.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -392,1 +392,1 @@\n-            \/\/ Only possiblities are \/packages, \/packages\/package\/module\n+            \/\/ Only possibilities are \/packages, \/packages\/package\/module\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jimage\/ImageReader.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -248,1 +248,1 @@\n-        \/\/ same package prefix may exist in mutliple modules. This Map\n+        \/\/ same package prefix may exist in multiple modules. This Map\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jrtfs\/ExplodedImage.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -277,1 +277,1 @@\n-        \/\/ check for options of null type and option is an intance of StandardOpenOption\n+        \/\/ check for options of null type and option is an instance of StandardOpenOption\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jrtfs\/JrtFileSystem.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -434,1 +434,1 @@\n-    \/\/ removes redundant slashs, replace \"\\\" to separator \"\/\"\n+    \/\/ removes redundant slashes, replace \"\\\" to separator \"\/\"\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/jrtfs\/JrtPath.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -331,1 +331,1 @@\n-        \/\/ Everyting goes well, print out the file name.\n+        \/\/ Everything goes well, print out the file name.\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/misc\/CDS.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -318,2 +318,2 @@\n-    \/\/ Buffer access constants, to be initalized when required.\n-    \/\/ Avoids a null value for NIO_ACCESS, due to class initalization dependencies\n+    \/\/ Buffer access constants, to be initialized when required.\n+    \/\/ Avoids a null value for NIO_ACCESS, due to class initialization dependencies\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/misc\/X-ScopedMemoryAccess.java.template","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -591,1 +591,1 @@\n-        Map<String, byte[]> map = new HashMap<>(hash_count);\n+        Map<String, byte[]> map = HashMap.newHashMap(hash_count);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/module\/ModuleInfo.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,1 @@\n-     * package\/classe\/resource to jar file list(s)\n+     * package\/class\/resource to jar file list(s)\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/jar\/JarIndex.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1403,1 +1403,1 @@\n-     * to provide {@link Spliterator}-based implmentations that support\n+     * to provide {@link Spliterator}-based implementations that support\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/random\/RandomSupport.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,1 +65,1 @@\n- * Implementors of this class which wrap an underlaying implementation\n+ * Implementors of this class which wrap an underlying implementation\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/xml\/SAXParser.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,1 +36,1 @@\n-     * by the attrubute index, the attribute index MUST be multiplied by 8. The\n+     * by the attribute index, the attribute index MUST be multiplied by 8. The\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/xml\/impl\/Attrs.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,1 @@\n-    \/** The entity systen identifier or null. *\/\n+    \/** The entity system identifier or null. *\/\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/xml\/impl\/Input.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,1 @@\n-    private Map<String, Input> mPEnt; \/\/ the parmeter entities look up table\n+    private Map<String, Input> mPEnt; \/\/ the parameter entities look up table\n@@ -55,1 +55,1 @@\n-    protected boolean mIsSAloneSet;  \/\/ standalone is explicitely set\n+    protected boolean mIsSAloneSet;  \/\/ standalone is explicitly set\n@@ -219,1 +219,1 @@\n-        \/\/ skiped upper case alphabetical character are already 0\n+        \/\/ skipped upper case alphabetical character are already 0\n@@ -223,1 +223,1 @@\n-        \/\/ skiped lower case alphabetical character are already 0\n+        \/\/ skipped lower case alphabetical character are already 0\n@@ -274,1 +274,1 @@\n-        mPh = PH_DOC_START;  \/\/ the begining of the document\n+        mPh = PH_DOC_START;  \/\/ the beginning of the document\n@@ -313,1 +313,1 @@\n-        mPh = PH_AFTER_DOC;  \/\/ before documnet processing\n+        mPh = PH_AFTER_DOC;  \/\/ before document processing\n@@ -399,1 +399,1 @@\n-                            \/\/          Find the list of defined attributs of the current\n+                            \/\/          Find the list of defined attributes of the current\n@@ -1328,1 +1328,1 @@\n-     * declared in DTD (attribute decalration had been read); 0x2 - attribute's\n+     * declared in DTD (attribute declaration had been read); 0x2 - attribute's\n@@ -1599,1 +1599,1 @@\n-                            if (mPh == PH_DOC_START) \/\/ the begining of the document\n+                            if (mPh == PH_DOC_START) \/\/ the beginning of the document\n@@ -1874,1 +1874,1 @@\n-     * Resoves an entity.\n+     * Resolves an entity.\n@@ -2064,1 +2064,1 @@\n-     * Resoves a parameter entity.\n+     * Resolves a parameter entity.\n@@ -2241,1 +2241,1 @@\n-     * @param text The comment text starting from first charcater.\n+     * @param text The comment text starting from first character.\n@@ -3326,1 +3326,1 @@\n-     * Retrives the next character in the document.\n+     * Retrieves the next character in the document.\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/xml\/impl\/Parser.java","additions":14,"deletions":14,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -79,1 +79,1 @@\n-        \/\/              SAX feature defaut values\n+        \/\/              SAX feature default values\n@@ -561,1 +561,1 @@\n-     * @param text The comment text starting from first charcater.\n+     * @param text The comment text starting from first character.\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/xml\/impl\/ParserSAX.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -140,1 +140,1 @@\n-     * @throws UnsupportedEncodingException There is no convertor to support\n+     * @throws UnsupportedEncodingException There is no converter to support\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/util\/xml\/impl\/XMLWriter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2011, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -434,1 +434,1 @@\n-        \/\/ TO DO:  Replace wierd characters in s by C-style escapes.\n+        \/\/ TO DO:  Replace weird characters in s by C-style escapes.\n","filename":"src\/java.base\/share\/classes\/sun\/invoke\/util\/BytecodeName.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import jdk.internal.vm.annotation.DontInline;\n+\n@@ -232,22 +234,11 @@\n-        switch (this) {\n-            case BOOLEAN:\n-                return Boolean.FALSE;\n-            case INT:\n-                return (Integer)0;\n-            case BYTE:\n-                return (Byte)(byte)0;\n-            case CHAR:\n-                return (Character)(char)0;\n-            case SHORT:\n-                return (Short)(short)0;\n-            case LONG:\n-                return (Long)(long)0;\n-            case FLOAT:\n-                return FLOAT_ZERO;\n-            case DOUBLE:\n-                return DOUBLE_ZERO;\n-            case VOID:\n-            case OBJECT:\n-            default:\n-                return null;\n-        }\n+        return switch (this) {\n+            case BOOLEAN -> Boolean.FALSE;\n+            case INT -> (Integer)0;\n+            case BYTE -> (Byte)(byte)0;\n+            case CHAR -> (Character)(char)0;\n+            case SHORT -> (Short)(short)0;\n+            case LONG -> (Long)(long)0;\n+            case FLOAT -> FLOAT_ZERO;\n+            case DOUBLE -> DOUBLE_ZERO;\n+            default -> null;\n+        };\n@@ -271,5 +262,10 @@\n-        Wrapper w = findPrimitiveType(type);\n-        if (w != null)  return w;\n-        if (type.isPrimitive())\n-            throw new InternalError(); \/\/ redo hash function\n-        throw newIllegalArgumentException(\"not primitive: \"+type);\n+        if (type == int.class)     return INT;\n+        if (type == long.class)    return LONG;\n+        if (type == boolean.class) return BOOLEAN;\n+        if (type == short.class)   return SHORT;\n+        if (type == byte.class)    return BYTE;\n+        if (type == char.class)    return CHAR;\n+        if (type == float.class)   return FLOAT;\n+        if (type == double.class)  return DOUBLE;\n+        if (type == void.class)    return VOID;\n+        throw newIllegalArgumentException(\"not primitive: \" + type);\n@@ -283,11 +279,3 @@\n-        switch (basicTypeChar) {\n-            case 'I': return INT;\n-            case 'J': return LONG;\n-            case 'S': return SHORT;\n-            case 'B': return BYTE;\n-            case 'C': return CHAR;\n-            case 'F': return FLOAT;\n-            case 'D': return DOUBLE;\n-            case 'Z': return BOOLEAN;\n-            case 'V': return VOID;\n-            default: throw newIllegalArgumentException(\"not primitive: \" + basicTypeChar);\n+        Wrapper w = FROM_CHAR[(basicTypeChar + (basicTypeChar >> 1)) & 0xf];\n+        if (w == null || w.basicTypeChar != basicTypeChar) {\n+            throw basicTypeError(basicTypeChar);\n@@ -295,6 +283,2 @@\n-    }\n-\n-    static Wrapper findPrimitiveType(Class<?> type) {\n-        Wrapper w = FROM_PRIM[hashPrim(type)];\n-        if (w != null && w.primitiveType == type) {\n-            return w;\n+        if (w == OBJECT) {\n+            throw newIllegalArgumentException(\"not primitive: \" + basicTypeChar);\n@@ -302,1 +286,1 @@\n-        return null;\n+        return w;\n@@ -313,5 +297,4 @@\n-        if (w != null)  return w;\n-        for (Wrapper x : values())\n-            if (x.wrapperType == type)\n-                throw new InternalError(); \/\/ redo hash function\n-        throw newIllegalArgumentException(\"not wrapper: \"+type);\n+        if (w != null) {\n+            return w;\n+        }\n+        throw wrapperTypeError(type);\n@@ -321,4 +304,10 @@\n-        Wrapper w = FROM_WRAP[hashWrap(type)];\n-        if (w != null && w.wrapperType == type) {\n-            return w;\n-        }\n+        if (type == Object.class)    return OBJECT;\n+        if (type == Integer.class)   return INT;\n+        if (type == Long.class)      return LONG;\n+        if (type == Boolean.class)   return BOOLEAN;\n+        if (type == Short.class)     return SHORT;\n+        if (type == Byte.class)      return BYTE;\n+        if (type == Character.class) return CHAR;\n+        if (type == Float.class)     return FLOAT;\n+        if (type == Double.class)    return DOUBLE;\n+        if (type == Void.class)      return VOID;\n@@ -328,0 +317,8 @@\n+    @DontInline\n+    private static RuntimeException wrapperTypeError(Class<?> type) {\n+        for (Wrapper x : values())\n+            if (x.wrapperType == type)\n+                throw new InternalError(); \/\/ missing wrapper type\n+        return newIllegalArgumentException(\"not wrapper: \" + type);\n+    }\n+\n@@ -333,1 +330,1 @@\n-        Wrapper w = FROM_CHAR[hashChar(type)];\n+        Wrapper w = FROM_CHAR[(type + (type >> 1)) & 0xf];\n@@ -337,2 +334,7 @@\n-        for (Wrapper x : values())\n-            if (w.basicTypeChar == type)\n+        throw basicTypeError(type);\n+    }\n+\n+    @DontInline\n+    private static RuntimeException basicTypeError(char type) {\n+        for (Wrapper x : values()) {\n+            if (x.basicTypeChar == type) {\n@@ -340,1 +342,3 @@\n-        throw newIllegalArgumentException(\"not basic type char: \"+type);\n+            }\n+        }\n+        return newIllegalArgumentException(\"not basic type char: \" + type);\n@@ -347,2 +351,9 @@\n-        if (type.isPrimitive())\n-            return forPrimitiveType(type);\n+        if (type == int.class)      return INT;\n+        if (type == long.class)     return LONG;\n+        if (type == boolean.class)  return BOOLEAN;\n+        if (type == void.class)     return VOID;\n+        if (type == byte.class)     return BYTE;\n+        if (type == char.class)     return CHAR;\n+        if (type == float.class)    return FLOAT;\n+        if (type == double.class)   return DOUBLE;\n+        if (type == short.class)    return SHORT;\n@@ -353,7 +364,1 @@\n-    \/\/   for signature chars c, do (c + (c >> 1)) % 16\n-    \/\/   for primitive type names n, do (n[0] + n[2]) % 16\n-    \/\/ The type name hash works for both primitive and wrapper names.\n-    \/\/ You can add \"java\/lang\/Object\" to the primitive names.\n-    \/\/ But you add the wrapper name Object, use (n[2] + (3*n[1])) % 16.\n-    private static final Wrapper[] FROM_PRIM = new Wrapper[16];\n-    private static final Wrapper[] FROM_WRAP = new Wrapper[16];\n+    \/\/   for signature chars c, do (c + (c >> 1)) & 0xf\n@@ -361,14 +366,1 @@\n-    private static int hashPrim(Class<?> x) {\n-        String xn = x.getName();\n-        if (xn.length() < 3)  return 0;\n-        return (xn.charAt(0) + xn.charAt(2)) % 16;\n-    }\n-    private static int hashWrap(Class<?> x) {\n-        String xn = x.getName();\n-        final int offset = 10; assert(offset == \"java.lang.\".length());\n-        if (xn.length() < offset+3)  return 0;\n-        return (3*xn.charAt(offset+1) + xn.charAt(offset+2)) % 16;\n-    }\n-    private static int hashChar(char x) {\n-        return (x + (x >> 1)) % 16;\n-    }\n+\n@@ -377,9 +369,1 @@\n-            int pi = hashPrim(w.primitiveType);\n-            int wi = hashWrap(w.wrapperType);\n-            int ci = hashChar(w.basicTypeChar);\n-            assert(FROM_PRIM[pi] == null);\n-            assert(FROM_WRAP[wi] == null);\n-            assert(FROM_CHAR[ci] == null);\n-            FROM_PRIM[pi] = w;\n-            FROM_WRAP[wi] = w;\n-            FROM_CHAR[ci] = w;\n+            FROM_CHAR[(w.basicTypeChar + (w.basicTypeChar >> 1)) & 0xf] = w;\n@@ -387,1 +371,0 @@\n-        \/\/assert(jdk.sun.invoke.util.WrapperTest.test(false));\n@@ -477,7 +460,0 @@\n-\/\/    \/** Wrap a value in the given type, which may be either a primitive or wrapper type.\n-\/\/     *  Performs standard primitive conversions, including truncation and float conversions.\n-\/\/     *\/\n-\/\/    public static <T> T wrap(Object x, Class<T> type) {\n-\/\/        return Wrapper.valueOf(type).cast(x, type);\n-\/\/    }\n-\n","filename":"src\/java.base\/share\/classes\/sun\/invoke\/util\/Wrapper.java","additions":75,"deletions":99,"binary":false,"changes":174,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -245,1 +245,1 @@\n-                        \/\/ print any bizzare line separators in hex, but really\n+                        \/\/ print any bizarre line separators in hex, but really\n@@ -508,1 +508,1 @@\n-     * Appends the vm synoym message to the header, already created.\n+     * Appends the vm synonym message to the header, already created.\n","filename":"src\/java.base\/share\/classes\/sun\/launcher\/LauncherHelper.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,1 @@\n- * in all likelyhood the connection to the server has been lost and the session\n+ * in all likelihood the connection to the server has been lost and the session\n@@ -353,1 +353,1 @@\n-     * sent before the {@code RETR} in order to restart the tranfer from the specified\n+     * sent before the {@code RETR} in order to restart the transfer from the specified\n@@ -361,1 +361,1 @@\n-     *        retreive from the server.\n+     *        retrieve from the server.\n@@ -376,1 +376,1 @@\n-     * sent before the {@code RETR} in order to restart the tranfer from the specified\n+     * sent before the {@code RETR} in order to restart the transfer from the specified\n@@ -619,1 +619,1 @@\n-     * of the pending action (e.g. number of bytes transfered).<\/p>\n+     * of the pending action (e.g. number of bytes transferred).<\/p>\n@@ -786,1 +786,1 @@\n-     *        for the current working directoty.\n+     *        for the current working directory.\n@@ -834,1 +834,1 @@\n-     * This is retreived by parsing the response string received as an initial\n+     * This is retrieved by parsing the response string received as an initial\n@@ -843,1 +843,1 @@\n-     * Returns, when available, the remote name of the last transfered file.\n+     * Returns, when available, the remote name of the last transferred file.\n@@ -848,1 +848,1 @@\n-     * @return the name the latest transfered file remote name, or\n+     * @return the name the latest transferred file remote name, or\n","filename":"src\/java.base\/share\/classes\/sun\/net\/ftp\/FtpClient.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,1 @@\n- * <p>The specific error code can be retreived with {@link #getReplyCode() }.<\/p>\n+ * <p>The specific error code can be retrieved with {@link #getReplyCode() }.<\/p>\n@@ -41,1 +41,1 @@\n-     * specified detail message. The reply code is set to unknow error.\n+     * specified detail message. The reply code is set to unknown error.\n","filename":"src\/java.base\/share\/classes\/sun\/net\/ftp\/FtpProtocolException.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -603,1 +603,1 @@\n-            \/\/ So we'll use the regular expresions package to parse the output.\n+            \/\/ So we'll use the regular expressions package to parse the output.\n@@ -1303,1 +1303,1 @@\n-     * sent before the RETR in order to restart the tranfer from the specified\n+     * sent before the RETR in order to restart the transfer from the specified\n@@ -1309,1 +1309,1 @@\n-     *        retreive from the server.\n+     *        retrieve from the server.\n@@ -1651,1 +1651,1 @@\n-     * of the pending action (e.g. number of bytes transfered).<\/p>\n+     * of the pending action (e.g. number of bytes transferred).<\/p>\n@@ -1929,1 +1929,1 @@\n-     *        for the current working directoty.\n+     *        for the current working directory.\n@@ -1979,1 +1979,1 @@\n-     * command to exchange the various tokens until authentification is\n+     * command to exchange the various tokens until authentication is\n@@ -2061,1 +2061,1 @@\n-     * This is retreived by parsing the response string received as an initial\n+     * This is retrieved by parsing the response string received as an initial\n@@ -2072,1 +2072,1 @@\n-     * Returns, when available, the remote name of the last transfered file.\n+     * Returns, when available, the remote name of the last transferred file.\n@@ -2077,1 +2077,1 @@\n-     * @return the name the latest transfered file remote name, or\n+     * @return the name the latest transferred file remote name, or\n@@ -2139,1 +2139,1 @@\n-     * back to a non crypted transmission.\n+     * back to a non encrypted transmission.\n","filename":"src\/java.base\/share\/classes\/sun\/net\/ftp\/impl\/FtpClient.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -69,1 +69,1 @@\n-     * means for FTP we try in that oder:\n+     * means for FTP we try in that order:\n@@ -127,1 +127,1 @@\n-        \/\/ by excluding localhost and its litteral notations.\n+        \/\/ by excluding localhost and its literal notations.\n","filename":"src\/java.base\/share\/classes\/sun\/net\/spi\/DefaultProxySelector.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,1 +66,1 @@\n-                \/* if no port is specificed then use the protocols\n+                \/* if no port is specified then use the protocols\n","filename":"src\/java.base\/share\/classes\/sun\/net\/util\/URLUtil.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n-     * from subsequest read() 's\n+     * from subsequent read() 's\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/MeteredStream.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -167,1 +167,1 @@\n-        \/\/ REMIND: OS specific delimters appear here\n+        \/\/ REMIND: OS specific delimiters appear here\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/MimeTable.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -182,1 +182,1 @@\n-     * shift the bytes in use to the begining of the buffer\n+     * shift the bytes in use to the beginning of the buffer\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/http\/ChunkedInputStream.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -526,1 +526,1 @@\n-     * method parseHTTP().  That's why this method is overidden from the\n+     * method parseHTTP().  That's why this method is overridden from the\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/http\/HttpClient.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -236,1 +236,1 @@\n-    \/* Sleeps for an alloted timeout, then checks for timed out connections.\n+    \/* Sleeps for an allotted timeout, then checks for timed out connections.\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/http\/KeepAliveCache.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,1 +94,1 @@\n-                        \/\/on the socket can be cleanup asyncronously.\n+                        \/\/on the socket can be cleanup asynchronously.\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/http\/KeepAliveStream.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -413,1 +413,1 @@\n-     * Get the InputStream to retreive the remote file. It will issue the\n+     * Get the InputStream to retrieve the remote file. It will issue the\n@@ -419,1 +419,1 @@\n-     * @throws  FtpProtocolException if errors occur during the transfert.\n+     * @throws  FtpProtocolException if errors occur during the transfer.\n@@ -546,1 +546,1 @@\n-     * @throws  FtpProtocolException if errors occur during the transfert.\n+     * @throws  FtpProtocolException if errors occur during the transfer.\n@@ -556,1 +556,1 @@\n-            \/\/ getInputStream() is neccessary to force a writeRequests()\n+            \/\/ getInputStream() is necessary to force a writeRequests()\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/ftp\/FtpURLConnection.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -470,1 +470,1 @@\n-            algorithm = \"MD5\";  \/\/ The default, accoriding to rfc2069\n+            algorithm = \"MD5\";  \/\/ The default, according to rfc2069\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/DigestAuthentication.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -603,1 +603,1 @@\n-    \/* adds the standard key\/val pairs to reqests if necessary & write to\n+    \/* adds the standard key\/val pairs to requests if necessary & write to\n@@ -1902,1 +1902,1 @@\n-                \/\/ preformed.\n+                \/\/ performed.\n@@ -3087,1 +3087,1 @@\n-             * - the first becuase it wasn't an EOF (and couldn't be\n+             * - the first because it wasn't an EOF (and couldn't be\n@@ -3115,1 +3115,1 @@\n-                \/\/ We are deliberatly being disconnected so HttpClient\n+                \/\/ We are deliberately being disconnected so HttpClient\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/HttpURLConnection.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,1 +35,1 @@\n- * dependancy.\n+ * dependency.\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/NTLMAuthenticationProxy.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -55,1 +55,1 @@\n-    \/\/ These maps are used to manage the GSS availability for diffrent\n+    \/\/ These maps are used to manage the GSS availability for different\n@@ -100,1 +100,1 @@\n-     * is tried. The generated object will be cached under the name of ths\n+     * is tried. The generated object will be cached under the name of the\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/NegotiateAuthentication.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -566,2 +566,2 @@\n-                    SSLParameters paramaters = s.getSSLParameters();\n-                    paramaters.setEndpointIdentificationAlgorithm(\"HTTPS\");\n+                    SSLParameters parameters = s.getSSLParameters();\n+                    parameters.setEndpointIdentificationAlgorithm(\"HTTPS\");\n@@ -570,1 +570,1 @@\n-                        paramaters.setServerNames(List.of(new SNIHostName(host)));\n+                        parameters.setServerNames(List.of(new SNIHostName(host)));\n@@ -572,1 +572,1 @@\n-                    s.setSSLParameters(paramaters);\n+                    s.setSSLParameters(parameters);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/https\/HttpsClient.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -183,1 +183,1 @@\n-                \/* if the URL referes to an archive *\/\n+                \/* if the URL refers to an archive *\/\n@@ -186,1 +186,1 @@\n-                \/* if the URL referes to an archive entry *\/\n+                \/* if the URL refers to an archive entry *\/\n@@ -368,1 +368,1 @@\n-     * Ths default is \"sticky\", being a part of the static state of all\n+     * The default is \"sticky\", being a part of the static state of all\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/jar\/JarURLConnection.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -242,1 +242,1 @@\n-     * Set the call back interface to call retrive function in sun.plugin\n+     * Set the call back interface to call retrieve function in sun.plugin\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/jar\/URLJarFile.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -202,1 +202,1 @@\n-     * open. It should never be used in conjuncion with isOpen or ensureOpen\n+     * open. It should never be used in conjunction with isOpen or ensureOpen\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/SocketChannelImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n-    \/\/ indicates the pool size (for a fixed thread pool configuratin this is\n+    \/\/ indicates the pool size (for a fixed thread pool configuration this is\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/ThreadPool.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2011, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,1 @@\n-                               WatchEvent.Modifier... modifers)\n+                               WatchEvent.Modifier... modifiers)\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/fs\/AbstractWatchService.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -572,1 +572,1 @@\n-             * criteria (no arguments, contrained return type, etc.)\n+             * criteria (no arguments, constrained return type, etc.)\n@@ -669,2 +669,2 @@\n-                            value.getClass() + \"[\" + value + \"]\").setMember(\n-                                annotationType.members().get(name));\n+                                Objects.toIdentityString(value))\n+                        .setMember(annotationType.members().get(name));\n","filename":"src\/java.base\/share\/classes\/sun\/reflect\/annotation\/AnnotationInvocationHandler.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -109,1 +109,1 @@\n-     * and Provider loading and lookup is only trigered when\n+     * and Provider loading and lookup is only triggered when\n","filename":"src\/java.base\/share\/classes\/sun\/security\/jca\/GetInstance.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,1 @@\n-    \/\/ The ASN.1 systax for the Netscape Certificate Sequence data type is\n+    \/\/ The ASN.1 syntax for the Netscape Certificate Sequence data type is\n","filename":"src\/java.base\/share\/classes\/sun\/security\/pkcs\/ContentInfo.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-     * Contols how attributes, which are not recognized by the PKCS9Attribute\n+     * Controls how attributes, which are not recognized by the PKCS9Attribute\n","filename":"src\/java.base\/share\/classes\/sun\/security\/pkcs\/PKCS9Attributes.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -96,1 +96,1 @@\n-     * @param attributes additonal set of PKCS10 attributes requested\n+     * @param attributes additional set of PKCS10 attributes requested\n","filename":"src\/java.base\/share\/classes\/sun\/security\/pkcs10\/PKCS10.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2011, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,1 +37,1 @@\n- * <p>Attributes are additonal information which can be inserted in a PKCS#10\n+ * <p>Attributes are additional information which can be inserted in a PKCS#10\n","filename":"src\/java.base\/share\/classes\/sun\/security\/pkcs10\/PKCS10Attribute.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -594,1 +594,1 @@\n-     * @return the curent configuration\n+     * @return the current configuration\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/AbstractDrbg.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -365,1 +365,2 @@\n-        if ((r.compareTo(presetQ) == -1) && (s.compareTo(presetQ) == -1)) {\n+        if ((r.compareTo(presetQ) == -1) && (s.compareTo(presetQ) == -1)\n+                && r.signum() > 0 && s.signum() > 0) {\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/DSA.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -639,1 +639,1 @@\n-                \/\/ No need to sync because noone has access to newInfo yet\n+                \/\/ No need to sync because no one has access to newInfo yet\n@@ -792,1 +792,1 @@\n-            \/\/ No need to sync because noone has access to newInfo yet\n+            \/\/ No need to sync because no one has access to newInfo yet\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/PolicyFile.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,1 @@\n- * activites, which in turn add entropy to the random seed.\n+ * activities, which in turn add entropy to the random seed.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/SeedGenerator.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -128,1 +128,1 @@\n-        \/\/ that contains the set of Vertexes we're considering.\n+        \/\/ that contains the set of vertices we're considering.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/certpath\/AdjacencyList.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -310,1 +310,1 @@\n-        singleResponseMap = new HashMap<>(singleResponseDer.length);\n+        singleResponseMap = HashMap.newHashMap(singleResponseDer.length);\n@@ -754,1 +754,1 @@\n-                new HashMap<>(extDer.length);\n+                HashMap.newHashMap(extDer.length);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/certpath\/OCSPResponse.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -68,1 +68,1 @@\n-    private BigInteger coeff;   \/\/ CRT coeffcient\n+    private BigInteger coeff;   \/\/ CRT coefficient\n","filename":"src\/java.base\/share\/classes\/sun\/security\/rsa\/RSAPrivateCrtKeyImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -84,1 +84,1 @@\n-    \/\/ Does tha alert happen during handshake only?\n+    \/\/ Does the alert happen during handshake only?\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/Alert.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -813,1 +813,1 @@\n-                            \", remining=\" + message.remaining() + \")\"));\n+                            \", remaining=\" + message.remaining() + \")\"));\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/CertStatusExtension.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -436,1 +436,1 @@\n-                        \"CertificateRequest hanshake message\");\n+                        \"CertificateRequest handshake message\");\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/CertificateRequest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -154,1 +154,1 @@\n-                \/\/ Convert the incoming bytes to a OCSPResponse strucutre\n+                \/\/ Convert the incoming bytes to a OCSPResponse structure\n@@ -167,1 +167,1 @@\n-                \/\/ Add each OCSP reponse into the array list in the order\n+                \/\/ Add each OCSP response into the array list in the order\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/CertificateStatus.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -134,1 +134,1 @@\n-        byte[] recordEnS = new byte[8];                    \/\/ epoch + seqence\n+        byte[] recordEnS = new byte[8];                    \/\/ epoch + sequence\n@@ -1419,1 +1419,1 @@\n-            \/\/       suppported in the future.\n+            \/\/       supported in the future.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/DTLSInputRecord.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -356,1 +356,1 @@\n-        private int retransmits = 2;            \/\/ attemps of retransmits\n+        private int retransmits = 2;            \/\/ attempts of retransmits\n@@ -626,1 +626,1 @@\n-                retransmits = 2;        \/\/ attemps of retransmits\n+                retransmits = 2;        \/\/ attempts of retransmits\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/DTLSOutputRecord.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -167,1 +167,1 @@\n-        this.algorithmConstraints = new SSLAlgorithmConstraints(\n+        this.algorithmConstraints = SSLAlgorithmConstraints.wrap(\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/HandshakeContext.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -211,1 +211,1 @@\n-                            \"Ingore HelloRequest, handshaking is in progress\");\n+                            \"Ignore HelloRequest, handshaking is in progress\");\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/HelloRequest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -303,1 +303,1 @@\n-                    \/\/ May need more possesion types in the future.\n+                    \/\/ May need more possession types in the future.\n@@ -547,1 +547,1 @@\n-                \/\/ Unlikely, HelloRetryRequest should be used ealier.\n+                \/\/ Unlikely, HelloRetryRequest should be used earlier.\n@@ -579,1 +579,1 @@\n-                        \/\/ May need more possesion types in the future.\n+                        \/\/ May need more possession types in the future.\n@@ -603,1 +603,1 @@\n-                \/\/ Unlikely, HelloRetryRequest should be used instead ealier.\n+                \/\/ Unlikely, HelloRetryRequest should be used instead earlier.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/KeyShareExtension.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -606,1 +606,1 @@\n-        int msgLen = dstBuf.position() - 2;   \/\/ Exclude the legth field itself\n+        int msgLen = dstBuf.position() - 2;   \/\/ Exclude the length field itself\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/OutputRecord.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -573,1 +573,1 @@\n-                    \"Incorect PSK binder value\");\n+                    \"Incorrect PSK binder value\");\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/PreSharedKeyExtension.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -314,1 +314,1 @@\n-                    \/\/ ealier processes.\n+                    \/\/ earlier processes.\n@@ -535,1 +535,1 @@\n-                    \/\/ ealier processes.\n+                    \/\/ earlier processes.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/RenegoInfoExtension.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,1 @@\n-                        new SSLAlgorithmConstraints(null);\n+                        new SSLAlgorithmConstraints(null, true);\n@@ -64,1 +64,1 @@\n-                        new SSLAlgorithmConstraints((SSLSocket)null, false);\n+                        new SSLAlgorithmConstraints(null, false);\n@@ -66,4 +66,3 @@\n-    SSLAlgorithmConstraints(AlgorithmConstraints userSpecifiedConstraints) {\n-        this.userSpecifiedConstraints = userSpecifiedConstraints;\n-        this.peerSpecifiedConstraints = null;\n-        this.enabledX509DisabledAlgConstraints = true;\n+    private SSLAlgorithmConstraints(AlgorithmConstraints userSpecifiedConstraints,\n+                                    boolean enabledX509DisabledAlgConstraints) {\n+        this(userSpecifiedConstraints, null, enabledX509DisabledAlgConstraints);\n@@ -72,1 +71,3 @@\n-    SSLAlgorithmConstraints(SSLSocket socket,\n+    private SSLAlgorithmConstraints(\n+            AlgorithmConstraints userSpecifiedConstraints,\n+            SupportedSignatureAlgorithmConstraints peerSpecifiedConstraints,\n@@ -74,2 +75,2 @@\n-        this.userSpecifiedConstraints = getUserSpecifiedConstraints(socket);\n-        this.peerSpecifiedConstraints = null;\n+        this.userSpecifiedConstraints = userSpecifiedConstraints;\n+        this.peerSpecifiedConstraints = peerSpecifiedConstraints;\n@@ -79,1 +80,13 @@\n-    SSLAlgorithmConstraints(SSLEngine engine,\n+    \/**\n+     * Returns a SSLAlgorithmConstraints instance that checks the provided\n+     * {@code userSpecifiedConstraints} in addition to standard checks.\n+     * Returns a singleton instance if parameter is null or DEFAULT.\n+     * @param userSpecifiedConstraints additional constraints to check\n+     * @return a SSLAlgorithmConstraints instance\n+     *\/\n+    static AlgorithmConstraints wrap(AlgorithmConstraints userSpecifiedConstraints) {\n+        return wrap(userSpecifiedConstraints, true);\n+    }\n+\n+    private static AlgorithmConstraints wrap(\n+            AlgorithmConstraints userSpecifiedConstraints,\n@@ -81,3 +94,19 @@\n-        this.userSpecifiedConstraints = getUserSpecifiedConstraints(engine);\n-        this.peerSpecifiedConstraints = null;\n-        this.enabledX509DisabledAlgConstraints = withDefaultCertPathConstraints;\n+        if (nullIfDefault(userSpecifiedConstraints) == null) {\n+            return withDefaultCertPathConstraints ? DEFAULT : DEFAULT_SSL_ONLY;\n+        }\n+        return new SSLAlgorithmConstraints(userSpecifiedConstraints,\n+                withDefaultCertPathConstraints);\n+    }\n+\n+    \/**\n+     * Returns a SSLAlgorithmConstraints instance that checks the constraints\n+     * configured for the given {@code socket} in addition to standard checks.\n+     * Returns a singleton instance if the constraints are null or DEFAULT.\n+     * @param socket socket with configured constraints\n+     * @return a SSLAlgorithmConstraints instance\n+     *\/\n+    static AlgorithmConstraints forSocket(SSLSocket socket,\n+                                          boolean withDefaultCertPathConstraints) {\n+        AlgorithmConstraints userSpecifiedConstraints =\n+                getUserSpecifiedConstraints(socket);\n+        return wrap(userSpecifiedConstraints, withDefaultCertPathConstraints);\n@@ -86,1 +115,3 @@\n-    SSLAlgorithmConstraints(SSLSocket socket, String[] supportedAlgorithms,\n+    static SSLAlgorithmConstraints forSocket(\n+            SSLSocket socket,\n+            String[] supportedAlgorithms,\n@@ -88,4 +119,18 @@\n-        this.userSpecifiedConstraints = getUserSpecifiedConstraints(socket);\n-        this.peerSpecifiedConstraints =\n-                new SupportedSignatureAlgorithmConstraints(supportedAlgorithms);\n-        this.enabledX509DisabledAlgConstraints = withDefaultCertPathConstraints;\n+        return new SSLAlgorithmConstraints(\n+                nullIfDefault(getUserSpecifiedConstraints(socket)),\n+                new SupportedSignatureAlgorithmConstraints(supportedAlgorithms),\n+                withDefaultCertPathConstraints);\n+    }\n+\n+    \/**\n+     * Returns a SSLAlgorithmConstraints instance that checks the constraints\n+     * configured for the given {@code engine} in addition to standard checks.\n+     * Returns a singleton instance if the constraints are null or DEFAULT.\n+     * @param engine engine with configured constraints\n+     * @return a SSLAlgorithmConstraints instance\n+     *\/\n+    static AlgorithmConstraints forEngine(SSLEngine engine,\n+                                          boolean withDefaultCertPathConstraints) {\n+        AlgorithmConstraints userSpecifiedConstraints =\n+                getUserSpecifiedConstraints(engine);\n+        return wrap(userSpecifiedConstraints, withDefaultCertPathConstraints);\n@@ -94,1 +139,3 @@\n-    SSLAlgorithmConstraints(SSLEngine engine, String[] supportedAlgorithms,\n+    static SSLAlgorithmConstraints forEngine(\n+            SSLEngine engine,\n+            String[] supportedAlgorithms,\n@@ -96,4 +143,9 @@\n-        this.userSpecifiedConstraints = getUserSpecifiedConstraints(engine);\n-        this.peerSpecifiedConstraints =\n-                new SupportedSignatureAlgorithmConstraints(supportedAlgorithms);\n-        this.enabledX509DisabledAlgConstraints = withDefaultCertPathConstraints;\n+        return new SSLAlgorithmConstraints(\n+                nullIfDefault(getUserSpecifiedConstraints(engine)),\n+                new SupportedSignatureAlgorithmConstraints(supportedAlgorithms),\n+                withDefaultCertPathConstraints);\n+    }\n+\n+    private static AlgorithmConstraints nullIfDefault(\n+            AlgorithmConstraints constraints) {\n+        return constraints == DEFAULT ? null : constraints;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLAlgorithmConstraints.java","additions":76,"deletions":24,"binary":false,"changes":100,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1488,1 +1488,1 @@\n-                    constraints = new SSLAlgorithmConstraints(\n+                    constraints = SSLAlgorithmConstraints.forSocket(\n@@ -1492,1 +1492,1 @@\n-                            new SSLAlgorithmConstraints(sslSocket, true);\n+                            SSLAlgorithmConstraints.forSocket(sslSocket, true);\n@@ -1495,1 +1495,1 @@\n-                constraints = new SSLAlgorithmConstraints(sslSocket, true);\n+                constraints = SSLAlgorithmConstraints.forSocket(sslSocket, true);\n@@ -1528,1 +1528,1 @@\n-                    constraints = new SSLAlgorithmConstraints(\n+                    constraints = SSLAlgorithmConstraints.forEngine(\n@@ -1532,1 +1532,1 @@\n-                            new SSLAlgorithmConstraints(engine, true);\n+                            SSLAlgorithmConstraints.forEngine(engine, true);\n@@ -1535,1 +1535,1 @@\n-                constraints = new SSLAlgorithmConstraints(engine, true);\n+                constraints = SSLAlgorithmConstraints.forEngine(engine, true);\n@@ -1601,1 +1601,1 @@\n-            \"No X509TrustManager implementation avaiable\");\n+            \"No X509TrustManager implementation available\");\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLContextImpl.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -464,1 +464,1 @@\n-             * Make sure the destination bufffers are writable.\n+             * Make sure the destination buffers are writable.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLEngineImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -771,1 +771,1 @@\n-            \/\/ splitted into several records.  In fact, some server\n+            \/\/ split into several records.  In fact, some server\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLExtension.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,1 +73,1 @@\n-     * Some SSL\/TLS implementations support large fragment upto 2^15 bytes,\n+     * Some SSL\/TLS implementations support large fragment up to 2^15 bytes,\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLRecord.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -44,1 +44,1 @@\n-     * Hardcode tha Transcript-Hash(\"\") result and skip a digest operation.\n+     * Hardcode the Transcript-Hash(\"\") result and skip a digest operation.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLSecretDerivation.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -139,1 +139,1 @@\n-            \/\/ rethrow EOFException, the call will handle it if neede.\n+            \/\/ rethrow EOFException, the call will handle it if needed.\n@@ -165,1 +165,1 @@\n-                        SSLLogger.finest(\"retransmited handshake flight\");\n+                        SSLLogger.finest(\"retransmitted handshake flight\");\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLTransport.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -202,1 +202,1 @@\n-                    return new SSLAlgorithmConstraints(\n+                    return SSLAlgorithmConstraints.forSocket(\n@@ -207,1 +207,1 @@\n-            return new SSLAlgorithmConstraints(sslSocket, true);\n+            return SSLAlgorithmConstraints.forSocket(sslSocket, true);\n@@ -210,1 +210,1 @@\n-        return new SSLAlgorithmConstraints((SSLSocket)null, true);\n+        return SSLAlgorithmConstraints.DEFAULT;\n@@ -228,1 +228,1 @@\n-                    return new SSLAlgorithmConstraints(\n+                    return SSLAlgorithmConstraints.forEngine(\n@@ -234,1 +234,1 @@\n-        return new SSLAlgorithmConstraints(engine, true);\n+        return SSLAlgorithmConstraints.forEngine(engine, true);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/X509KeyManagerImpl.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -219,1 +219,1 @@\n-                constraints = new SSLAlgorithmConstraints(\n+                constraints = SSLAlgorithmConstraints.forSocket(\n@@ -222,1 +222,1 @@\n-                constraints = new SSLAlgorithmConstraints(sslSocket, false);\n+                constraints = SSLAlgorithmConstraints.forSocket(sslSocket, false);\n@@ -273,1 +273,1 @@\n-                constraints = new SSLAlgorithmConstraints(\n+                constraints = SSLAlgorithmConstraints.forEngine(\n@@ -276,1 +276,1 @@\n-                constraints = new SSLAlgorithmConstraints(engine, false);\n+                constraints = SSLAlgorithmConstraints.forEngine(engine, false);\n@@ -392,1 +392,1 @@\n-     * the identity checking aginst the server_name extension if present, and\n+     * the identity checking against the server_name extension if present, and\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/X509TrustManagerImpl.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,1 +35,1 @@\n- * over different transport machanisms. TSP permits at least the following\n+ * over different transport mechanisms. TSP permits at least the following\n","filename":"src\/java.base\/share\/classes\/sun\/security\/timestamp\/Timestamper.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2258,0 +2258,3 @@\n+                for (var attr : keyStore.getEntry(alias, null).getAttributes()) {\n+                    System.out.println(\"Attribute \" + attr.getName() + \": \" + attr.getValue());\n+                }\n@@ -2425,1 +2428,1 @@\n-         * 2. inside all, shows sucess\n+         * 2. inside all, shows success\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/Main.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -306,1 +306,1 @@\n-            \/\/ entry. If not, readd the entry\n+            \/\/ entry. If not, re-add the entry\n@@ -484,1 +484,1 @@\n-        Map<K,V> kvmap = new HashMap<>(cacheMap.size());\n+        Map<K,V> kvmap = HashMap.newHashMap(cacheMap.size());\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/Cache.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n-    \/\/ and the newly created definte length octets in this list.\n+    \/\/ and the newly created definite length octets in this list.\n@@ -147,9 +147,8 @@\n-        if (dataPos == dataSize) {\n-            return;\n-        }\n-        assert dataPos + 1 < dataSize;\n-        if (isEOC(data, dataPos)) {\n-            dataPos += 2;  \/\/ skip tag and length\n-            writeTag();\n-        } else {\n-            newData[newDataPos++] = data[dataPos++];\n+        while (dataPos < dataSize) {\n+            assert dataPos + 1 < dataSize;\n+            if (isEOC(data, dataPos)) {\n+                dataPos += 2;  \/\/ skip tag and length\n+            } else {\n+                newData[newDataPos++] = data[dataPos++];\n+                break;\n+            }\n@@ -334,1 +333,1 @@\n-     * a definte length DER encoding.\n+     * a definite length DER encoding.\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/DerIndefLenConverter.java","additions":11,"deletions":12,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -108,1 +108,1 @@\n-     * Therfore, for the first 3 cases, exact compatibility is preserved. In\n+     * Therefore, for the first 3 cases, exact compatibility is preserved. In\n@@ -368,1 +368,1 @@\n-                    BigInteger big = new BigInteger(pack(encoding,\n+                    BigInteger big = new BigInteger(1, pack(encoding,\n@@ -437,1 +437,1 @@\n-                        BigInteger big = new BigInteger(\n+                        BigInteger big = new BigInteger(1,\n@@ -687,0 +687,5 @@\n+        if (oidLength < 0) {\n+            throw new IOException(\"ObjectIdentifier encoded length was \" +\n+                    \"negative: \" + oidLength);\n+        }\n+\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/ObjectIdentifier.java","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n- * operations.  The follwoing is an example of how this may be done assuming\n+ * operations.  The following is an example of how this may be done assuming\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/AlgIdDSA.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -76,1 +76,1 @@\n-     * DER-encoded form; subclasses can be made to automaticaly parse\n+     * DER-encoded form; subclasses can be made to automatically parse\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/AlgorithmId.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -972,1 +972,1 @@\n-     * Gets the DER encoded certificate informations, the\n+     * Gets the DER encoded certificate information, the\n@@ -1774,1 +1774,1 @@\n-     * Cert is a SIGNED ASN.1 macro, a three elment sequence:\n+     * Cert is a SIGNED ASN.1 macro, a three element sequence:\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/X509CertImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -164,1 +164,1 @@\n-        \/\/ read in the column map for BMP characteres (this is serialized in\n+        \/\/ read in the column map for BMP characters (this is serialized in\n","filename":"src\/java.base\/share\/classes\/sun\/text\/BreakDictionary.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -57,1 +57,1 @@\n- * array contains the indicies of Unicode characters to the value array.\n+ * array contains the indices of Unicode characters to the value array.\n@@ -92,1 +92,1 @@\n-     * @param indexArray the indicies of the compact array.\n+     * @param indexArray the indices of the compact array.\n","filename":"src\/java.base\/share\/classes\/sun\/text\/CompactByteArray.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -297,1 +297,1 @@\n-            \/\/ otherwise, the value we got back from the inherited fuction\n+            \/\/ otherwise, the value we got back from the inherited function\n","filename":"src\/java.base\/share\/classes\/sun\/text\/DictionaryBasedBreakIterator.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -100,1 +100,1 @@\n-            \/\/ Switching to the ISO 8859-1 decorder.\n+            \/\/ Switching to the ISO 8859-1 decoder.\n","filename":"src\/java.base\/share\/classes\/sun\/util\/PropertyResourceBundleCharset.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -180,1 +180,1 @@\n-        + \"<\\u00a8\"          \/\/ diaresis\/umlaut accent (spacing)\n+        + \"<\\u00a8\"          \/\/ diaeresis\/umlaut accent (spacing)\n","filename":"src\/java.base\/share\/classes\/sun\/util\/locale\/provider\/CollationRules.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -514,1 +514,1 @@\n-         * contructs the Locale array and a set of language tags based on the\n+         * constructs the Locale array and a set of language tags based on the\n","filename":"src\/java.base\/share\/classes\/sun\/util\/locale\/provider\/JRELocaleProviderAdapter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -369,1 +369,1 @@\n-        \/\/ Use a LinkedHashSet to preseve the order\n+        \/\/ Use a LinkedHashSet to preserve the order\n","filename":"src\/java.base\/share\/classes\/sun\/util\/locale\/provider\/LocaleResources.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -246,1 +246,1 @@\n-     * @param isObjectProvider flag designating object provder or not\n+     * @param isObjectProvider flag designating object provider or not\n","filename":"src\/java.base\/share\/classes\/sun\/util\/locale\/provider\/LocaleServiceProviderPool.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -160,1 +160,1 @@\n-        return new HashMap<>(size);\n+        return HashMap.newHashMap(size);\n","filename":"src\/java.base\/share\/classes\/sun\/util\/resources\/OpenListResourceBundle.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -99,1 +99,1 @@\n-        return new LinkedHashMap<>(size);\n+        return LinkedHashMap.newLinkedHashMap(size);\n","filename":"src\/java.base\/share\/classes\/sun\/util\/resources\/TimeZoneNamesBundle.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -20,1 +20,1 @@\n-    \/\/ \"standard\" properies that can be read by anyone\n+    \/\/ \"standard\" properties that can be read by anyone\n","filename":"src\/java.base\/share\/conf\/security\/java.policy","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3669,1 +3669,1 @@\n-The following examples show how to set the mimimum size of allocated\n+The following examples show how to set the minimum size of allocated\n@@ -5351,1 +5351,1 @@\n-(The names \"static\" and \"dyanmic\" are used for historical reasons.\n+(The names \"static\" and \"dynamic\" are used for historical reasons.\n","filename":"src\/java.base\/share\/man\/java.1","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2001, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,1 @@\n- * Return the logrithm of x\n+ * Return the logarithm of x\n","filename":"src\/java.base\/share\/native\/libfdlibm\/e_log.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2001, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -54,1 +54,1 @@\n- *      With some algebric manipulation, it is not difficult to see\n+ *      With some algebraic manipulation, it is not difficult to see\n","filename":"src\/java.base\/share\/native\/libfdlibm\/e_sqrt.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -64,1 +64,1 @@\n- *              precison, one may have to do something like:\n+ *              precision, one may have to do something like:\n","filename":"src\/java.base\/share\/native\/libfdlibm\/k_rem_pio2.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,1 @@\n-\/\/ To retrieve a value using the approprate endian, use one of the overloaded\n+\/\/ To retrieve a value using the appropriate endian, use one of the overloaded\n","filename":"src\/java.base\/share\/native\/libjimage\/endian.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -320,1 +320,1 @@\n-\/\/ Return an id for the specifed ImageFileReader.\n+\/\/ Return an id for the specified ImageFileReader.\n@@ -333,1 +333,1 @@\n-\/\/ Return an id for the specifed ImageFileReader.\n+\/\/ Return an id for the specified ImageFileReader.\n@@ -339,1 +339,1 @@\n-\/\/ Constructor intializes to a closed state.\n+\/\/ Constructor initializes to a closed state.\n","filename":"src\/java.base\/share\/native\/libjimage\/imageFile.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -404,1 +404,1 @@\n-\/\/ it is desirable to share a reader.    To accomodate sharing, a share table is\n+\/\/ it is desirable to share a reader.    To accommodate sharing, a share table is\n@@ -463,1 +463,1 @@\n-    \/\/ Return an id for the specifed ImageFileReader.\n+    \/\/ Return an id for the specified ImageFileReader.\n@@ -469,1 +469,1 @@\n-    \/\/ Return an id for the specifed ImageFileReader.\n+    \/\/ Return an id for the specified ImageFileReader.\n","filename":"src\/java.base\/share\/native\/libjimage\/imageFile.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -367,1 +367,1 @@\n-    \/* arg file cannot be openned *\/\n+    \/* arg file cannot be opened *\/\n","filename":"src\/java.base\/share\/native\/libjli\/args.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1404,1 +1404,1 @@\n-            \/* operand gets set to the \"unitialized object\".  operand2 gets\n+            \/* operand gets set to the \"uninitialized object\".  operand2 gets\n@@ -2176,1 +2176,1 @@\n-            case '@': {         \/* unitialized object, for call to <init> *\/\n+            case '@': {         \/* uninitialized object, for call to <init> *\/\n@@ -2180,1 +2180,1 @@\n-                            \"Expecting to find unitialized object on stack\");\n+                            \"Expecting to find uninitialized object on stack\");\n@@ -2479,1 +2479,1 @@\n-             * result would be an unitialized object being able to masquerade\n+             * result would be an uninitialized object being able to masquerade\n","filename":"src\/java.base\/share\/native\/libverify\/check_code.c","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -638,1 +638,1 @@\n-       * 2. Avoids dual path code maintainance;\n+       * 2. Avoids dual path code maintenance;\n","filename":"src\/java.base\/share\/native\/libzip\/zip_util.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -213,1 +213,1 @@\n-    jlong mlen;           \/* length (in bytes) mmaped *\/\n+    jlong mlen;           \/* length (in bytes) mmapped *\/\n","filename":"src\/java.base\/share\/native\/libzip\/zip_util.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -144,0 +144,5 @@\n+    @Override\n+    public boolean isInvalid(File f) {\n+        return f.getPath().indexOf('\\u0000') < 0 ? false : true;\n+    }\n+\n","filename":"src\/java.base\/unix\/classes\/java\/io\/UnixFileSystem.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -258,1 +258,1 @@\n-     * Sets the first pollfd enty in the poll array to the given fd\n+     * Sets the first pollfd entry in the poll array to the given fd\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/ch\/PollSelectorImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -176,1 +176,1 @@\n-        \/\/ copy field befores accept is re-renabled\n+        \/\/ copy field before accept is re-renabled\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/ch\/UnixAsynchronousServerSocketChannelImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -110,1 +110,1 @@\n-                    mimeTypeMap = new HashMap<>(lines.size());\n+                    mimeTypeMap = HashMap.newHashMap(lines.size());\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/MimeTypesFileTypeDetector.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,1 +90,1 @@\n- * is the same on all platforms except on Linux where it initilizes one\n+ * is the same on all platforms except on Linux where it initializes one\n","filename":"src\/java.base\/unix\/native\/libjava\/ProcessHandleImpl_unix.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -500,1 +500,1 @@\n- * trys some libc implementation dependent mappings. If it still\n+ * tries some libc implementation dependent mappings. If it still\n","filename":"src\/java.base\/unix\/native\/libjava\/TimeZone_md.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -149,1 +149,1 @@\n-     * Practically the chance of its occurance is low, however, we are\n+     * Practically the chance of its occurrence is low, however, we are\n","filename":"src\/java.base\/unix\/native\/libjava\/io_util_md.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -135,1 +135,1 @@\n-         *  TODO: We really cant tell since it may be an unrelated error\n+         *  TODO: We really can't tell since it may be an unrelated error\n","filename":"src\/java.base\/unix\/native\/libnet\/net_util_md.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -230,2 +230,2 @@\n-     * return 1 when partial bytes transfered and return -1 when an error has\n-     * Occured.\n+     * return 1 when partial bytes transferred and return -1 when an error has\n+     * occurred.\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/FileChannelImpl.c","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -409,1 +409,1 @@\n-    \/* On successfull return res >= 0, otherwise res is -1 *\/\n+    \/* On successful return res >= 0, otherwise res is -1 *\/\n","filename":"src\/java.base\/unix\/native\/libnio\/fs\/UnixNativeDispatcher.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import java.nio.file.InvalidPathException;\n@@ -48,0 +49,15 @@\n+    \/\/ Whether to enable alternative data streams (ADS) by suppressing\n+    \/\/ checking the path for invalid characters, in particular \":\".\n+    \/\/ ADS support will be enabled if and only if the property is set and\n+    \/\/ is the empty string or is equal, ignoring case, to the string \"true\".\n+    \/\/ By default ADS support is disabled.\n+    private static final boolean ENABLE_ADS;\n+    static {\n+        String enableADS = GetPropertyAction.privilegedGetProperty(\"jdk.io.File.enableADS\");\n+        if (enableADS != null) {\n+            ENABLE_ADS = \"\".equals(enableADS) || Boolean.parseBoolean(enableADS);\n+        } else {\n+            ENABLE_ADS = false;\n+        }\n+    }\n+\n@@ -308,0 +324,30 @@\n+    @Override\n+    public boolean isInvalid(File f) {\n+        if (f.getPath().indexOf('\\u0000') >= 0)\n+            return true;\n+\n+        if (ENABLE_ADS)\n+            return false;\n+\n+        \/\/ Invalid if there is a \":\" at a position greater than 1, or if there\n+        \/\/ is a \":\" at position 1 and the first character is not a letter\n+        String pathname = f.getPath();\n+        int lastColon = pathname.lastIndexOf(\":\");\n+\n+        \/\/ Valid if there is no \":\" present or if the last \":\" present is\n+        \/\/ at index 1 and the first character is a latter\n+        if (lastColon < 0 ||\n+            (lastColon == 1 && isLetter(pathname.charAt(0))))\n+            return false;\n+\n+        \/\/ Invalid if path creation fails\n+        Path path = null;\n+        try {\n+            path = sun.nio.fs.DefaultFileSystemProvider.theFileSystem().getPath(pathname);\n+            return false;\n+        } catch (InvalidPathException ignored) {\n+        }\n+\n+        return true;\n+    }\n+\n","filename":"src\/java.base\/windows\/classes\/java\/io\/WinNTFileSystem.java","additions":47,"deletions":1,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,0 @@\n-import sun.security.action.GetBooleanAction;\n@@ -272,3 +271,6 @@\n-                int count = countLeadingBackslash(verificationType, s, s.length());\n-                while (count-- > 0) {\n-                    cmdbuf.append(BACKSLASH);   \/\/ double the number of backslashes\n+                if (verificationType == VERIFICATION_WIN32_SAFE ||\n+                    verificationType == VERIFICATION_LEGACY) {\n+                    int count = countLeadingBackslash(verificationType, s, s.length());\n+                    while (count-- > 0) {\n+                        cmdbuf.append(BACKSLASH);   \/\/ double the number of backslashes\n+                    }\n@@ -277,0 +279,8 @@\n+            } else if (verificationType == VERIFICATION_WIN32_SAFE &&\n+                 (s.startsWith(\"\\\"\") && s.endsWith(\"\\\"\") && s.length() > 2)) {\n+                \/\/ Check that quoted argument does not escape the final quote\n+                cmdbuf.append(s);\n+                int count = countLeadingBackslash(verificationType, s, s.length() - 1);\n+                while (count-- > 0) {\n+                    cmdbuf.insert(cmdbuf.length() - 1, BACKSLASH);    \/\/ double the number of backslashes\n+                }\n@@ -285,3 +295,1 @@\n-     * Return the argument without quotes (1st and last) if properly quoted, else the arg.\n-     * A properly quoted string has first and last characters as quote and\n-     * the last quote is not escaped.\n+     * Return the argument without quotes (first and last) if quoted, otherwise the arg.\n@@ -295,3 +303,0 @@\n-        if (str.endsWith(\"\\\\\\\"\")) {\n-            return str;    \/\/ not properly quoted, treat as unquoted\n-        }\n","filename":"src\/java.base\/windows\/classes\/java\/lang\/ProcessImpl.java","additions":16,"deletions":11,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n-    \/\/ The SocketChannel assoicated with this pipe\n+    \/\/ The SocketChannel associated with this pipe\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/ch\/SinkChannelImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,1 @@\n-    \/\/ The SocketChannel assoicated with this pipe\n+    \/\/ The SocketChannel associated with this pipe\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/ch\/SourceChannelImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -933,1 +933,1 @@\n-    private static native int read0(long socket, int count, long addres, long overlapped)\n+    private static native int read0(long socket, int count, long address, long overlapped)\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/ch\/WindowsAsynchronousSocketChannelImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -76,1 +76,1 @@\n-    \/\/ The global native poll array holds file decriptors and event masks\n+    \/\/ The global native poll array holds file descriptors and event masks\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/ch\/WindowsSelectorImpl.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -177,1 +177,1 @@\n-                   _wgetdcwd() and wcslen() everytime), but a hit we have\n+                   _wgetdcwd() and wcslen() every time), but a hit we have\n@@ -180,1 +180,1 @@\n-                   (therefor allocate the sufficient memory block) before calling\n+                   (therefore allocate the sufficient memory block) before calling\n@@ -553,1 +553,1 @@\n-     * Practically the chance of its occurance is low, however, we are\n+     * Practically the chance of its occurrence is low, however, we are\n","filename":"src\/java.base\/windows\/native\/libjava\/io_util_md.c","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -98,1 +98,1 @@\n-\/* command line parameter to swith D3D preloading on *\/\n+\/* command line parameter to switch D3D preloading on *\/\n@@ -104,1 +104,1 @@\n-\/* funtion in awt.dll (src\/windows\/native\/sun\/java2d\/d3d\/D3DPipelineManager.cpp) *\/\n+\/* function in awt.dll (src\/windows\/native\/sun\/java2d\/d3d\/D3DPipelineManager.cpp) *\/\n@@ -612,1 +612,1 @@\n- * error message if any, its upto the calling routine to correctly\n+ * error message if any, it's up to the calling routine to correctly\n@@ -684,1 +684,1 @@\n-        * the exception detail message, for now atleast put a dialog up.\n+        * the exception detail message, for now at least put a dialog up.\n","filename":"src\/java.base\/windows\/native\/libjli\/java_md.c","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -803,1 +803,1 @@\n-        TCP_INITIAL_RTO_UNSPECIFIED_RTT,    \/\/ Use the default or overriden by the Administrator\n+        TCP_INITIAL_RTO_UNSPECIFIED_RTT,    \/\/ Use the default or overridden by the Administrator\n","filename":"src\/java.base\/windows\/native\/libnet\/net_util_md.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -66,2 +66,4 @@\n-     *  17: sealed classes, floating-point always strict\n-     *  18: TBD\n+     *  17: sealed classes, floating-point always strict (pattern\n+     *      matching for switch in preview)\n+     *  18: no changes (pattern matching for switch in second preview)\n+     *  19: TBD\n@@ -130,0 +132,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se6\/html\/j3TOC.html\">\n+     * <cite>The Java Language Specification, Third Edition<\/cite><\/a>\n@@ -141,0 +147,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se7\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 7 Edition<\/cite><\/a>\n@@ -150,0 +160,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se8\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 8 Edition<\/cite><\/a>\n@@ -161,0 +175,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se9\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 9 Edition<\/cite><\/a>\n@@ -172,0 +190,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se10\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 10 Edition<\/cite><\/a>\n@@ -183,0 +205,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se11\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 11 Edition<\/cite><\/a>\n@@ -192,0 +218,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se12\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 12 Edition<\/cite><\/a>\n@@ -201,0 +231,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se13\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 13 Edition<\/cite><\/a>\n@@ -211,0 +245,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se14\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 14 Edition<\/cite><\/a>\n@@ -221,0 +259,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se15\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 15 Edition<\/cite><\/a>\n@@ -232,0 +274,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se16\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 16 Edition<\/cite><\/a>\n@@ -243,0 +289,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se17\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 17 Edition<\/cite><\/a>\n@@ -250,0 +300,2 @@\n+     * No major changes from the prior release.\n+     *\n@@ -251,0 +303,4 @@\n+     *\n+     * @see <a\n+     * href=\"https:\/\/docs.oracle.com\/javase\/specs\/jls\/se18\/html\/index.html\">\n+     * <cite>The Java Language Specification, Java SE 18 Edition<\/cite><\/a>\n","filename":"src\/java.compiler\/share\/classes\/javax\/lang\/model\/SourceVersion.java","additions":58,"deletions":2,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -29,0 +28,1 @@\n+import sun.java2d.SurfaceData;\n@@ -73,7 +73,2 @@\n-        MTLSurfaceData dstData;\n-        try {\n-            dstData = (MTLSurfaceData) sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" +\n-                    sg2d.surfaceData);\n-        }\n+        MTLSurfaceData dstData = SurfaceData.convertTo(MTLSurfaceData.class,\n+                                                       sg2d.surfaceData);\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/java2d\/metal\/MTLMaskFill.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -30,0 +29,1 @@\n+import sun.java2d.SurfaceData;\n@@ -52,6 +52,2 @@\n-        MTLSurfaceData dstData;\n-        try {\n-            dstData = (MTLSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        MTLSurfaceData dstData = SurfaceData.convertTo(MTLSurfaceData.class,\n+                                                       sg2d.surfaceData);\n@@ -66,6 +62,2 @@\n-        MTLSurfaceData dstData;\n-        try {\n-            dstData = (MTLSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        MTLSurfaceData dstData = SurfaceData.convertTo(MTLSurfaceData.class,\n+                                                       sg2d.surfaceData);\n@@ -85,6 +77,2 @@\n-            MTLSurfaceData dstData;\n-            try {\n-                dstData = (MTLSurfaceData)sg2d.surfaceData;\n-            } catch (ClassCastException e) {\n-                throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-            }\n+            MTLSurfaceData dstData = SurfaceData.convertTo(MTLSurfaceData.class,\n+                                                           sg2d.surfaceData);\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/java2d\/metal\/MTLRenderer.java","additions":8,"deletions":20,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -70,0 +70,1 @@\n+import com.sun.imageio.plugins.common.ReaderUtil;\n@@ -1545,3 +1546,2 @@\n-        byte[] values = new byte[imSize];\n-        int bytesRead = 0;\n-        iis.readFully(values, 0, imSize);\n+        byte[] values = ReaderUtil.\n+            staggeredReadByteStream(iis, imSize);\n@@ -1729,2 +1729,2 @@\n-        byte[] values = new byte[imSize];\n-        iis.readFully(values, 0, imSize);\n+        byte[] values = ReaderUtil.\n+            staggeredReadByteStream(iis, imSize);\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/imageio\/plugins\/bmp\/BMPImageReader.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1005,1 +1005,1 @@\n-                \/\/ Check whether the the field value is within the stream.\n+                \/\/ Check whether the field value is within the stream.\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/imageio\/plugins\/tiff\/TIFFIFD.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -79,0 +79,3 @@\n+        int MEGABYTE = 1048576;\n+        int DEFAULT_BUFFER_SIZE = 65536;\n+        int MAX_FRAME_SIZE = 1024;\n@@ -81,1 +84,13 @@\n-            if (ais.getFrameLength() == -1) {\n+            int frameSize = ais.getFormat().getFrameSize();\n+            if (frameSize <= 0 || frameSize > MAX_FRAME_SIZE) {\n+                throw new InvalidMidiDataException(\"Formats with frame size \"\n+                        + frameSize + \" are not supported\");\n+            }\n+\n+            long totalSize = ais.getFrameLength() * frameSize;\n+            if (totalSize >= Integer.MAX_VALUE - 2) {\n+                throw new InvalidMidiDataException(\n+                        \"Can not allocate enough memory to read audio data.\");\n+            }\n+\n+            if (ais.getFrameLength() == -1 || totalSize > MEGABYTE) {\n@@ -83,2 +98,1 @@\n-                byte[] buff = new byte[1024\n-                        - (1024 % ais.getFormat().getFrameSize())];\n+                byte[] buff = new byte[DEFAULT_BUFFER_SIZE - (DEFAULT_BUFFER_SIZE % frameSize)];\n@@ -92,2 +106,1 @@\n-                buffer = new byte[(int) (ais.getFrameLength()\n-                                    * ais.getFormat().getFrameSize())];\n+                buffer = new byte[(int) totalSize];\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/media\/sound\/AudioFileSoundbankReader.java","additions":18,"deletions":5,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -217,1 +217,1 @@\n-     * Returns the an array (length 1) containing the checkbox menu item\n+     * Returns the array (length 1) containing the checkbox menu item\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/CheckboxMenuItem.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -471,1 +471,1 @@\n-                    \/\/   WINDOW_GAINED_FOCUS message which was generated by a\n+                    \/\/   WINDOW_GAINED_FOCUS message which was generated by\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/DefaultKeyboardFocusManager.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,3 +27,0 @@\n-import java.io.*;\n-import java.lang.*;\n-import java.util.*;\n@@ -717,3 +714,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n@@ -752,3 +749,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/Graphics.java","additions":7,"deletions":10,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -42,1 +42,3 @@\n-public abstract class MultipleGradientPaint implements Paint {\n+public abstract sealed class MultipleGradientPaint implements Paint\n+    permits LinearGradientPaint,\n+            RadialGradientPaint {\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/MultipleGradientPaint.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,1 +61,1 @@\n- * RGB components are converted to the CIEXYZ PCS using a a 3x3 matrix\n+ * RGB components are converted to the CIEXYZ PCS using a 3x3 matrix\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/color\/ICC_ProfileRGB.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -232,1 +232,1 @@\n-     * This method returns a the currently available DataFlavors\n+     * This method returns the currently available DataFlavors\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/dnd\/DropTargetContext.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,2 @@\n-import static sun.java2d.StateTrackable.State.*;\n+import static sun.java2d.StateTrackable.State.STABLE;\n+import static sun.java2d.StateTrackable.State.UNTRACKABLE;\n@@ -86,1 +87,1 @@\n-     * @param numBanks The number of banks in the a {@code DataBuffer}.\n+     * @param numBanks The number of banks in the {@code DataBuffer}.\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/image\/DataBufferByte.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,2 @@\n-import static sun.java2d.StateTrackable.State.*;\n+import static sun.java2d.StateTrackable.State.STABLE;\n+import static sun.java2d.StateTrackable.State.UNTRACKABLE;\n@@ -85,1 +86,1 @@\n-     * @param numBanks The number of banks in the a {@code DataBuffer}.\n+     * @param numBanks The number of banks in the {@code DataBuffer}.\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/image\/DataBufferInt.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,2 @@\n-import static sun.java2d.StateTrackable.State.*;\n+import static sun.java2d.StateTrackable.State.STABLE;\n+import static sun.java2d.StateTrackable.State.UNTRACKABLE;\n@@ -84,1 +85,1 @@\n-     * @param numBanks The number of banks in the a {@code DataBuffer}.\n+     * @param numBanks The number of banks in the {@code DataBuffer}.\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/image\/DataBufferShort.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,2 @@\n-import static sun.java2d.StateTrackable.State.*;\n+import static sun.java2d.StateTrackable.State.STABLE;\n+import static sun.java2d.StateTrackable.State.UNTRACKABLE;\n@@ -86,1 +87,1 @@\n-     * @param numBanks The number of banks in the a {@code DataBuffer}.\n+     * @param numBanks The number of banks in the {@code DataBuffer}.\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/image\/DataBufferUShort.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1474,1 +1474,1 @@\n-     * Writes an image using the an arbitrary {@code ImageWriter}\n+     * Writes an image using an arbitrary {@code ImageWriter}\n","filename":"src\/java.desktop\/share\/classes\/javax\/imageio\/ImageIO.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -237,1 +237,1 @@\n-     * Identifies whether a the AcceptAllFileFilter is used or not.\n+     * Identifies whether the AcceptAllFileFilter is used or not.\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/JFileChooser.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -596,1 +596,1 @@\n-     * @return the key value if {@code key} is a a legal value for the\n+     * @return the key value if {@code key} is a legal value for the\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/JLabel.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,2 +27,2 @@\n-import javax.swing.undo.*;\n-import javax.swing.text.*;\n+import javax.swing.text.Document;\n+import javax.swing.text.Element;\n@@ -85,1 +85,1 @@\n-     * For example, if the an element is removed from it's\n+     * For example, if an element is removed from its\n@@ -92,1 +92,1 @@\n-     * If an child element is insert into a parent element,\n+     * If a child element is inserted into a parent element,\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/event\/DocumentEvent.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,2 +27,0 @@\n-import javax.swing.*;\n-import java.awt.Component;\n@@ -30,0 +28,1 @@\n+import java.awt.Component;\n@@ -40,0 +39,5 @@\n+import javax.swing.AbstractButton;\n+import javax.swing.Icon;\n+import javax.swing.JComponent;\n+import javax.swing.SwingUtilities;\n+\n@@ -434,1 +438,1 @@\n-     * @param underlinedIndex index of a a char value (Unicode code unit)\n+     * @param underlinedIndex index of a char value (Unicode code unit)\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/basic\/BasicGraphicsUtils.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -7,1 +7,1 @@\n- Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -221,1 +221,1 @@\n-      will be used when the component is in an a selected and pressed state:\n+      will be used when the component is in a selected and pressed state:\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/synth\/doc-files\/synthFileFormat.html","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,2 @@\n-import javax.swing.event.*;\n+import javax.swing.event.DocumentListener;\n+import javax.swing.event.UndoableEditListener;\n@@ -177,1 +178,1 @@\n- * the <code>isLeaf()<\/code> method returns false. If an element is a a leaf, <code>isLeaf()<\/code> returns true.\n+ * the <code>isLeaf()<\/code> method returns false. If an element is a leaf, <code>isLeaf()<\/code> returns true.\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/Document.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,3 +27,9 @@\n-import java.lang.reflect.*;\n-import java.text.*;\n-import java.util.*;\n+import java.lang.reflect.Constructor;\n+import java.text.AttributedCharacterIterator;\n+import java.text.DecimalFormat;\n+import java.text.DecimalFormatSymbols;\n+import java.text.Format;\n+import java.text.NumberFormat;\n+import java.text.ParseException;\n+import java.util.Map;\n+\n@@ -100,1 +106,1 @@\n-     * Creates a <code>NumberFormatter<\/code> with the a default\n+     * Creates a <code>NumberFormatter<\/code> with the default\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/NumberFormatter.java","additions":11,"deletions":5,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,2 +27,7 @@\n-import java.util.*;\n-import java.awt.*;\n+import java.awt.Container;\n+import java.awt.Font;\n+import java.awt.Rectangle;\n+import java.awt.font.FontRenderContext;\n+import java.awt.font.LineBreakMeasurer;\n+import java.awt.font.TextAttribute;\n+import java.awt.font.TextLayout;\n@@ -31,2 +36,5 @@\n-import java.awt.font.*;\n-import java.awt.geom.AffineTransform;\n+import java.util.HashSet;\n+import java.util.Hashtable;\n+import java.util.Map;\n+import java.util.Set;\n+\n@@ -35,0 +43,1 @@\n+\n@@ -38,1 +47,1 @@\n- * A flow strategy that uses java.awt.font.LineBreakMeasureer to\n+ * A flow strategy that uses java.awt.font.LineBreakMeasurer to\n@@ -101,1 +110,1 @@\n-     * Does a a full layout on the given View.  This causes all of\n+     * Does a full layout on the given View.  This causes all of\n@@ -103,1 +112,1 @@\n-     * constraints for each row.  This is called by a FlowView.layout\n+     * constraints for each row.  This is called by FlowView.layout\n@@ -122,1 +131,1 @@\n-     *   this views element from which to start.\n+     *   this view element from which to start.\n@@ -174,1 +183,1 @@\n-     * @param spanLeft the about of span left to fill in the row\n+     * @param spanLeft the amount of span left to fill in the row\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/TextLayoutStrategy.java","additions":19,"deletions":10,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,8 +27,52 @@\n-import java.net.*;\n-import java.io.*;\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.util.*;\n-import javax.swing.*;\n-import javax.swing.event.*;\n-import javax.swing.text.*;\n+import java.awt.Component;\n+import java.awt.Point;\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n+import java.awt.event.ItemListener;\n+import java.awt.event.MouseAdapter;\n+import java.awt.event.MouseEvent;\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.net.URLEncoder;\n+import java.util.BitSet;\n+\n+import javax.swing.AbstractListModel;\n+import javax.swing.Box;\n+import javax.swing.ButtonModel;\n+import javax.swing.ComboBoxModel;\n+import javax.swing.DefaultButtonModel;\n+import javax.swing.Icon;\n+import javax.swing.ImageIcon;\n+import javax.swing.JButton;\n+import javax.swing.JCheckBox;\n+import javax.swing.JComboBox;\n+import javax.swing.JComponent;\n+import javax.swing.JEditorPane;\n+import javax.swing.JFileChooser;\n+import javax.swing.JList;\n+import javax.swing.JPasswordField;\n+import javax.swing.JRadioButton;\n+import javax.swing.JScrollPane;\n+import javax.swing.JTextArea;\n+import javax.swing.JTextField;\n+import javax.swing.JToggleButton;\n+import javax.swing.ListModel;\n+import javax.swing.ListSelectionModel;\n+import javax.swing.SwingUtilities;\n+import javax.swing.UIManager;\n+import javax.swing.event.ChangeListener;\n+import javax.swing.event.DocumentListener;\n+import javax.swing.event.HyperlinkEvent;\n+import javax.swing.event.ListDataListener;\n+import javax.swing.text.AbstractDocument;\n+import javax.swing.text.AttributeSet;\n+import javax.swing.text.BadLocationException;\n+import javax.swing.text.ComponentView;\n+import javax.swing.text.Document;\n+import javax.swing.text.Element;\n+import javax.swing.text.ElementIterator;\n+import javax.swing.text.PlainDocument;\n+import javax.swing.text.StyleConstants;\n+import javax.swing.text.View;\n@@ -620,1 +664,1 @@\n-    \/**\n+    \/*\n@@ -622,1 +666,1 @@\n-     * iterate over a the elements of the form and in the case\n+     * iterate over the elements of the form and in the case\n@@ -625,1 +669,1 @@\n-     * case of reset, reinitialize the each model to its\n+     * case of reset, reinitialize each model to its\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/FormView.java","additions":56,"deletions":12,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,1 @@\n-import javax.swing.text.*;\n+import java.io.IOException;\n@@ -29,1 +29,0 @@\n-import java.util.Stack;\n@@ -31,0 +30,1 @@\n+import java.util.Stack;\n@@ -32,4 +32,13 @@\n-import java.io.IOException;\n-import java.util.StringTokenizer;\n-import java.util.NoSuchElementException;\n-import java.net.URL;\n+\n+import javax.swing.text.AbstractWriter;\n+import javax.swing.text.AttributeSet;\n+import javax.swing.text.BadLocationException;\n+import javax.swing.text.Document;\n+import javax.swing.text.Element;\n+import javax.swing.text.ElementIterator;\n+import javax.swing.text.MutableAttributeSet;\n+import javax.swing.text.Segment;\n+import javax.swing.text.SimpleAttributeSet;\n+import javax.swing.text.Style;\n+import javax.swing.text.StyleConstants;\n+import javax.swing.text.StyleContext;\n@@ -843,1 +852,1 @@\n-     * Determines whether a the indentation needs to be\n+     * Determines whether the indentation needs to be\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/HTMLWriter.java","additions":17,"deletions":8,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,5 @@\n-import java.awt.*;\n+import java.awt.Component;\n+import java.awt.Graphics;\n+import java.awt.Rectangle;\n+import java.awt.Shape;\n+\n@@ -29,3 +33,0 @@\n-import javax.swing.event.DocumentEvent;\n-import javax.swing.text.Document;\n-import javax.swing.text.Element;\n@@ -33,0 +34,2 @@\n+import javax.swing.text.Element;\n+import javax.swing.text.JTextComponent;\n@@ -35,3 +38,0 @@\n-import javax.swing.text.ViewFactory;\n-import javax.swing.text.BadLocationException;\n-import javax.swing.text.JTextComponent;\n@@ -40,1 +40,1 @@\n- * Displays the a paragraph, and uses css attributes for its\n+ * Displays the paragraph and uses CSS attributes for its\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/ParagraphView.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -301,1 +301,1 @@\n-     * or the target can't be found (either because the a peer was\n+     * or the target can't be found (either because the peer was\n","filename":"src\/java.desktop\/share\/classes\/sun\/awt\/SunToolkit.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2003, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -87,1 +87,1 @@\n-     * Given level data, compute a a visual to logical mapping.\n+     * Given level data, compute a visual to logical mapping.\n","filename":"src\/java.desktop\/share\/classes\/sun\/font\/BidiUtils.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,0 @@\n-import java.util.Iterator;\n@@ -105,1 +104,1 @@\n- * This is a the master Graphics2D superclass for all of the Sun\n+ * This is the master Graphics2D superclass for all of the Sun\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/SunGraphics2D.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1094,0 +1094,11 @@\n+\n+    \/**\n+     * Converts surfaceData to the particular subclass or throws InvalidPipeException\n+     *\/\n+    public static <T> T convertTo(Class<T> surfaceDataClass, SurfaceData surfaceData) {\n+        try {\n+            return surfaceDataClass.cast(surfaceData);\n+        } catch(ClassCastException e) {\n+            throw new InvalidPipeException(\"wrong surface data type: \" + surfaceData);\n+        }\n+    }\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/SurfaceData.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -31,0 +30,1 @@\n+import sun.java2d.SurfaceData;\n@@ -71,7 +71,2 @@\n-        OGLSurfaceData dstData;\n-        try {\n-            dstData = (OGLSurfaceData) sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" +\n-                                           sg2d.surfaceData);\n-        }\n+        OGLSurfaceData dstData = SurfaceData.convertTo(OGLSurfaceData.class,\n+                                                       sg2d.surfaceData);\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/opengl\/OGLMaskFill.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -32,0 +31,1 @@\n+import sun.java2d.SurfaceData;\n@@ -50,6 +50,2 @@\n-        OGLSurfaceData dstData;\n-        try {\n-            dstData = (OGLSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        OGLSurfaceData dstData = SurfaceData.convertTo(OGLSurfaceData.class,\n+                                                       sg2d.surfaceData);\n@@ -64,6 +60,2 @@\n-        OGLSurfaceData dstData;\n-        try {\n-            dstData = (OGLSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        OGLSurfaceData dstData = SurfaceData.convertTo(OGLSurfaceData.class,\n+                                                       sg2d.surfaceData);\n@@ -83,6 +75,2 @@\n-            OGLSurfaceData dstData;\n-            try {\n-                dstData = (OGLSurfaceData)sg2d.surfaceData;\n-            } catch (ClassCastException e) {\n-                throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-            }\n+            OGLSurfaceData dstData = SurfaceData.convertTo(OGLSurfaceData.class,\n+                                                           sg2d.surfaceData);\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/opengl\/OGLRenderer.java","additions":8,"deletions":20,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,2 @@\n-import java.lang.ref.SoftReference;\n-import java.util.Hashtable;\n+import sun.awt.image.SunWritableRaster;\n+import sun.awt.image.ToolkitImage;\n@@ -34,2 +34,0 @@\n-import sun.font.FontManager;\n-import sun.font.FontManagerFactory;\n@@ -39,1 +37,0 @@\n-import java.awt.Composite;\n@@ -41,0 +38,1 @@\n+import java.awt.Composite;\n@@ -47,4 +45,0 @@\n-\n-import java.awt.geom.Path2D;\n-import java.text.AttributedCharacterIterator;\n-\n@@ -60,0 +54,2 @@\n+import java.awt.geom.Path2D;\n+import java.awt.geom.PathIterator;\n@@ -63,1 +59,0 @@\n-import java.awt.geom.PathIterator;\n@@ -77,3 +72,0 @@\n-import sun.awt.image.ByteComponentRaster;\n-import sun.awt.image.ToolkitImage;\n-import sun.awt.image.SunWritableRaster;\n@@ -84,1 +76,0 @@\n-import java.awt.print.PrinterGraphics;\n@@ -87,0 +78,3 @@\n+import java.lang.ref.SoftReference;\n+import java.text.AttributedCharacterIterator;\n+import java.util.Hashtable;\n@@ -491,3 +485,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n@@ -529,3 +523,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n","filename":"src\/java.desktop\/share\/classes\/sun\/print\/PathGraphics.java","additions":15,"deletions":21,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,0 @@\n-import java.awt.Graphics;\n@@ -53,1 +52,0 @@\n-import java.awt.geom.Point2D;\n@@ -778,3 +776,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n@@ -810,3 +808,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n","filename":"src\/java.desktop\/share\/classes\/sun\/print\/PeekGraphics.java","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -670,3 +670,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n@@ -707,3 +707,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n","filename":"src\/java.desktop\/share\/classes\/sun\/print\/ProxyGraphics.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,1 +37,0 @@\n-import java.awt.Graphics;\n@@ -50,1 +49,0 @@\n-import java.awt.geom.Rectangle2D;\n@@ -683,3 +681,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n@@ -710,3 +708,3 @@\n-     * @param        xPoints   a an array of {@code x} coordinates.\n-     * @param        yPoints   a an array of {@code y} coordinates.\n-     * @param        nPoints   a the total number of points.\n+     * @param        xPoints   an array of {@code x} coordinates.\n+     * @param        yPoints   an array of {@code y} coordinates.\n+     * @param        nPoints   the total number of points.\n","filename":"src\/java.desktop\/share\/classes\/sun\/print\/ProxyGraphics2D.java","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -83,1 +83,1 @@\n-<!-- Currently we are using the the HTML.3.2.Conflict entity to work around\n+<!-- Currently we are using the HTML.3.2.Conflict entity to work around\n","filename":"src\/java.desktop\/share\/data\/dtdbuilder\/html32.dtd","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+import sun.java2d.SurfaceData;\n@@ -64,2 +65,1 @@\n-\n-            XRSurfaceData x11sd = (XRSurfaceData) sg2d.surfaceData;\n+            XRSurfaceData x11sd = SurfaceData.convertTo(XRSurfaceData.class, sg2d.surfaceData);\n","filename":"src\/java.desktop\/unix\/classes\/sun\/font\/XRTextRenderer.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -102,1 +102,1 @@\n-            XRSurfaceData x11sd = (XRSurfaceData) sData;\n+            XRSurfaceData x11sd = SurfaceData.convertTo(XRSurfaceData.class, sData);\n","filename":"src\/java.desktop\/unix\/classes\/sun\/java2d\/xr\/XRMaskFill.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -33,0 +32,1 @@\n+import sun.java2d.SurfaceData;\n@@ -73,6 +73,2 @@\n-        XRSurfaceData xrsd;\n-        try {\n-            xrsd = (XRSurfaceData) sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        XRSurfaceData xrsd = SurfaceData.convertTo(XRSurfaceData.class,\n+                                                   sg2d.surfaceData);\n","filename":"src\/java.desktop\/unix\/classes\/sun\/java2d\/xr\/XRRenderer.java","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1700,1 +1700,1 @@\n-                \/* let's see if we can use a a default pen\n+                \/* let's see if we can use the default pen\n","filename":"src\/java.desktop\/windows\/classes\/sun\/awt\/windows\/WPathGraphics.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2008, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -31,0 +30,1 @@\n+import sun.java2d.SurfaceData;\n@@ -71,7 +71,2 @@\n-        D3DSurfaceData dstData;\n-        try {\n-            dstData = (D3DSurfaceData) sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" +\n-                                           sg2d.surfaceData);\n-        }\n+        D3DSurfaceData dstData = SurfaceData.convertTo(D3DSurfaceData.class,\n+                                                       sg2d.surfaceData);\n","filename":"src\/java.desktop\/windows\/classes\/sun\/java2d\/d3d\/D3DMaskFill.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n-import sun.java2d.InvalidPipeException;\n@@ -32,0 +31,1 @@\n+import sun.java2d.SurfaceData;\n@@ -50,6 +50,2 @@\n-        D3DSurfaceData dstData;\n-        try {\n-            dstData = (D3DSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        D3DSurfaceData dstData = SurfaceData.convertTo(D3DSurfaceData.class,\n+                                                       sg2d.surfaceData);\n@@ -64,6 +60,2 @@\n-        D3DSurfaceData dstData;\n-        try {\n-            dstData = (D3DSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        D3DSurfaceData dstData = SurfaceData.convertTo(D3DSurfaceData.class,\n+                                                       sg2d.surfaceData);\n@@ -83,6 +75,2 @@\n-            D3DSurfaceData dstData;\n-            try {\n-                dstData = (D3DSurfaceData)sg2d.surfaceData;\n-            } catch (ClassCastException e) {\n-                throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-            }\n+            D3DSurfaceData dstData = SurfaceData.convertTo(D3DSurfaceData.class,\n+                                                           sg2d.surfaceData);\n","filename":"src\/java.desktop\/windows\/classes\/sun\/java2d\/d3d\/D3DRenderer.java","additions":8,"deletions":20,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -295,6 +295,2 @@\n-        GDIWindowSurfaceData sd;\n-        try {\n-            sd = (GDIWindowSurfaceData)sg2d.surfaceData;\n-        } catch (ClassCastException e) {\n-            throw new InvalidPipeException(\"wrong surface data type: \" + sg2d.surfaceData);\n-        }\n+        GDIWindowSurfaceData sd = SurfaceData.convertTo(GDIWindowSurfaceData.class,\n+                                                        sg2d.surfaceData);\n","filename":"src\/java.desktop\/windows\/classes\/sun\/java2d\/windows\/GDIRenderer.java","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -837,1 +837,1 @@\n-        \/\/ like we do when the an adapter exits fs mode; currently they will\n+        \/\/ like we do when the adapter exits fs mode; currently they will\n@@ -1013,1 +1013,0 @@\n-\n","filename":"src\/java.desktop\/windows\/native\/libawt\/java2d\/d3d\/D3DPipelineManager.cpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2002, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,4 @@\n+import java.net.URI;\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n+import java.util.Locale;\n@@ -67,0 +71,19 @@\n+    private static final String PARSE_MODE_PROP = \"com.sun.jndi.ldapURLParsing\";\n+    private static final ParseMode DEFAULT_PARSE_MODE = ParseMode.COMPAT;\n+\n+    public static final ParseMode PARSE_MODE;\n+    static {\n+        PrivilegedAction<String> action = () ->\n+                System.getProperty(PARSE_MODE_PROP, DEFAULT_PARSE_MODE.toString());\n+        ParseMode parseMode = DEFAULT_PARSE_MODE;\n+        try {\n+            @SuppressWarnings(\"removal\")\n+            String mode = AccessController.doPrivileged(action);\n+            parseMode = ParseMode.valueOf(mode.toUpperCase(Locale.ROOT));\n+        } catch (Throwable t) {\n+            parseMode = DEFAULT_PARSE_MODE;\n+        } finally {\n+            PARSE_MODE = parseMode;\n+        }\n+    }\n+\n@@ -86,1 +109,1 @@\n-                throw new MalformedURLException(\"Not an LDAP URL: \" + url);\n+                throw newInvalidURISchemeException(url);\n@@ -102,0 +125,15 @@\n+    @Override\n+    protected MalformedURLException newInvalidURISchemeException(String uri) {\n+        return new MalformedURLException(\"Not an LDAP URL: \" + uri);\n+    }\n+\n+    @Override\n+    protected boolean isSchemeOnly(String uri) {\n+        return isLdapSchemeOnly(uri);\n+    }\n+\n+    @Override\n+    protected ParseMode parseMode() {\n+        return PARSE_MODE;\n+    }\n+\n@@ -154,1 +192,2 @@\n-            urls[i++] = st.nextToken();\n+            \/\/ we don't accept scheme-only URLs here\n+            urls[i++] = validateURI(st.nextToken());\n@@ -161,0 +200,19 @@\n+    public static boolean isLdapSchemeOnly(String uri) {\n+        return \"ldap:\".equals(uri) || \"ldaps:\".equals(uri);\n+    }\n+\n+    public static String validateURI(String uri) {\n+        \/\/ no validation in legacy mode parsing\n+        if (PARSE_MODE == ParseMode.LEGACY) {\n+            return uri;\n+        }\n+\n+        \/\/ special case of scheme-only URIs\n+        if (isLdapSchemeOnly(uri)) {\n+            return uri;\n+        }\n+\n+        \/\/ use java.net.URI to validate the uri syntax\n+        return URI.create(uri).toString();\n+    }\n+\n@@ -184,1 +242,2 @@\n-            return useSsl ? \"ldaps:\/\/\" + h + p + d : \"ldap:\/\/\" + h + p + d;\n+            String uri = useSsl ? \"ldaps:\/\/\" + h + p + d : \"ldap:\/\/\" + h + p + d;\n+            return validateURI(uri);\n","filename":"src\/java.naming\/share\/classes\/com\/sun\/jndi\/ldap\/LdapURL.java","additions":63,"deletions":4,"binary":false,"changes":67,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,0 +35,2 @@\n+import com.sun.jndi.toolkit.url.Uri.ParseMode;\n+\n@@ -51,0 +53,1 @@\n+\n@@ -164,2 +167,12 @@\n-            \/\/ find last slash\n-            int posn = url.indexOf('\/', start);\n+            \/\/ find where the authority component ends\n+            \/\/ and the rest of the URL starts\n+            int slash = url.indexOf('\/', start);\n+            int qmark = url.indexOf('?', start);\n+            int fmark = url.indexOf('#', start);\n+            if (fmark > -1 && qmark > fmark) qmark = -1;\n+            if (fmark > -1 && slash > fmark) slash = -1;\n+            if (qmark > -1 && slash > qmark) slash = -1;\n+            int posn = slash > -1 ? slash\n+                    : (qmark > -1 ? qmark\n+                    : (fmark > -1 ? fmark\n+                    : url.length()));\n","filename":"src\/java.naming\/share\/classes\/com\/sun\/jndi\/toolkit\/url\/GenericURLContext.java","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2001, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,2 @@\n+import java.net.URI;\n+import java.net.URISyntaxException;\n@@ -39,5 +41,1 @@\n- * available.  The hack of getting around this by temporarily\n- * replacing the scheme part of a URI is not appropriate here: JNDI\n- * service providers must work on older Java platforms, and we want\n- * new features and bug fixes that are not available in old versions\n- * of the URL class.\n+ * available.\n@@ -45,3 +43,9 @@\n- * <p> It may be appropriate to drop this code in favor of the\n- * java.net.URI class.  The changes would need to be written so as to\n- * still run on pre-1.4 platforms not containing that class.\n+ * <p> The {@linkplain ParseMode#STRICT strict} parsing mode uses\n+ * the java.net.URI class to syntactically validate URI strings.\n+ * The {@linkplain ParseMode#COMPAT compat} mode validate the\n+ * URI authority and rejects URI fragments, but doesn't perform any\n+ * additional validation on path and query, other than that\n+ * which may be implemented in the concrete the Uri subclasses.\n+ * The {@linkplain ParseMode#LEGACY legacy} mode should not be\n+ * used unless the application is capable of validating all URI\n+ * strings before any constructors of this class is invoked.\n@@ -108,0 +112,22 @@\n+    \/\/ three parsing modes\n+    public enum ParseMode {\n+        \/**\n+         * Strict validation mode.\n+         * Validate the URI syntactically using {@link java.net.URI}.\n+         * Rejects URI fragments unless explicitly supported by the\n+         * subclass.\n+         *\/\n+        STRICT,\n+        \/**\n+         * Compatibility mode. The URI authority is syntactically validated.\n+         * Rejects URI fragments unless explicitly supported by the\n+         * subclass.\n+         * This is the default.\n+         *\/\n+        COMPAT,\n+        \/**\n+         * Legacy mode. In this mode, no validation is performed.\n+         *\/\n+        LEGACY\n+     }\n+\n@@ -115,0 +141,1 @@\n+    protected String fragment;\n@@ -131,0 +158,9 @@\n+    \/**\n+     * The parse mode for parsing this URI.\n+     * The default is {@link ParseMode#COMPAT}.\n+     * @return the parse mode for parsing this URI.\n+     *\/\n+    protected ParseMode parseMode() {\n+        return ParseMode.COMPAT;\n+    }\n+\n@@ -138,1 +174,1 @@\n-        parse(uri);\n+        parse(uri, parseMode());\n@@ -191,0 +227,218 @@\n+    private void parse(String uri, ParseMode mode) throws MalformedURLException {\n+        switch (mode) {\n+            case STRICT -> parseStrict(uri);\n+            case COMPAT -> parseCompat(uri);\n+            case LEGACY -> parseLegacy(uri);\n+        }\n+    }\n+\n+    \/*\n+     * Parses a URI string and sets this object's fields accordingly.\n+     * Use java.net.URI to validate the uri string syntax\n+     *\/\n+    private void parseStrict(String uri) throws MalformedURLException {\n+        try {\n+            if (!isSchemeOnly(uri)) {\n+                URI u = new URI(uri);\n+                scheme = u.getScheme();\n+                if (scheme == null) throw new MalformedURLException(\"Invalid URI: \" + uri);\n+                var auth = u.getRawAuthority();\n+                hasAuthority = auth != null;\n+                if (hasAuthority) {\n+                    var host = u.getHost();\n+                    var port = u.getPort();\n+                    if (host != null) this.host = host;\n+                    if (port != -1) this.port = port;\n+                    String hostport = (host == null ? \"\" : host)\n+                            + (port == -1 ? \"\" : (\":\" + port));\n+                    if (!hostport.equals(auth)) {\n+                        \/\/ throw if we have user info or regname\n+                        throw new MalformedURLException(\"unsupported authority: \" + auth);\n+                    }\n+                }\n+                path = u.getRawPath();\n+                if (u.getRawQuery() != null) {\n+                    query = \"?\" + u.getRawQuery();\n+                }\n+                if (u.getRawFragment() != null) {\n+                    if (!acceptsFragment()) {\n+                        throw new MalformedURLException(\"URI fragments not supported: \" + uri);\n+                    }\n+                    fragment = \"#\" + u.getRawFragment();\n+                }\n+            } else {\n+                \/\/ scheme-only URIs are not supported by java.net.URI\n+                \/\/ validate the URI by appending \"\/\" to the uri string.\n+                var s = uri.substring(0, uri.indexOf(':'));\n+                URI u = new URI(uri + \"\/\");\n+                if (!s.equals(u.getScheme())\n+                        || !checkSchemeOnly(uri, u.getScheme())) {\n+                    throw newInvalidURISchemeException(uri);\n+                }\n+                scheme = s;\n+                path = \"\";\n+            }\n+        } catch (URISyntaxException e) {\n+            var mue =  new MalformedURLException(e.getMessage());\n+            mue.initCause(e);\n+            throw mue;\n+        }\n+    }\n+\n+\n+    \/*\n+     * Parses a URI string and sets this object's fields accordingly.\n+     * Compatibility mode. Use java.net.URI to validate the syntax of\n+     * the uri string authority.\n+     *\/\n+    private void parseCompat(String uri) throws MalformedURLException {\n+        int i;  \/\/ index into URI\n+\n+        i = uri.indexOf(':');                           \/\/ parse scheme\n+        int slash = uri.indexOf('\/');\n+        int qmark = uri.indexOf('?');\n+        int fmark = uri.indexOf('#');\n+        if (i < 0 || slash > 0 && i > slash || qmark > 0 && i > qmark || fmark > 0 && i > fmark) {\n+            throw new MalformedURLException(\"Invalid URI: \" + uri);\n+        }\n+        if (fmark > -1) {\n+            if (!acceptsFragment()) {\n+                throw new MalformedURLException(\"URI fragments not supported: \" + uri);\n+            }\n+        }\n+        if (i == uri.length() - 1) {\n+            if (!isSchemeOnly(uri)) {\n+                throw newInvalidURISchemeException(uri);\n+            }\n+        }\n+        scheme = uri.substring(0, i);\n+        i++;                                            \/\/ skip past \":\"\n+\n+        hasAuthority = uri.startsWith(\"\/\/\", i);\n+        if (fmark > -1 && qmark > fmark) qmark = -1;\n+        int endp = qmark > -1 ? qmark : fmark > -1 ? fmark : uri.length();\n+        if (hasAuthority) {                             \/\/ parse \"\/\/host:port\"\n+            i += 2;                                     \/\/ skip past \"\/\/\"\n+            int starta = i;\n+            \/\/ authority ends at the first appearance of \/, ?, or #\n+            int enda = uri.indexOf('\/', i);\n+            if (enda == -1 || qmark > -1 && qmark < enda) enda = qmark;\n+            if (enda == -1 || fmark > -1 && fmark < enda) enda = fmark;\n+            if (enda < 0) {\n+                enda = uri.length();\n+            }\n+            if (uri.startsWith(\":\", i)) {\n+                \/\/ LdapURL supports empty host.\n+                i++;\n+                host = \"\";\n+                if (enda > i) {\n+                    port = Integer.parseInt(uri.substring(i, enda));\n+                }\n+            } else {\n+                \/\/ Use URI to parse authority\n+                try {\n+                    \/\/ URI requires at least one char after authority:\n+                    \/\/ we use \"\/\" and expect that the resulting URI path\n+                    \/\/ will be exactly \"\/\".\n+                    URI u = new URI(uri.substring(0, enda) + \"\/\");\n+                    String auth = uri.substring(starta, enda);\n+                    host = u.getHost();\n+                    port = u.getPort();\n+                    String p = u.getRawPath();\n+                    String q = u.getRawQuery();\n+                    String f = u.getRawFragment();\n+                    String ui = u.getRawUserInfo();\n+                    if (ui != null) {\n+                        throw new MalformedURLException(\"user info not supported in authority: \" + ui);\n+                    }\n+                    if (!\"\/\".equals(p)) {\n+                        throw new MalformedURLException(\"invalid authority: \" + auth);\n+                    }\n+                    if (q != null) {\n+                        throw new MalformedURLException(\"invalid trailing characters in authority: ?\" + q);\n+                    }\n+                    if (f != null) {\n+                        throw new MalformedURLException(\"invalid trailing characters in authority: #\" + f);\n+                    }\n+                    String hostport = (host == null ? \"\" : host)\n+                            + (port == -1?\"\":(\":\" + port));\n+                    if (!auth.equals(hostport)) {\n+                        \/\/ throw if we have user info or regname\n+                        throw new MalformedURLException(\"unsupported authority: \" + auth);\n+                    }\n+                } catch (URISyntaxException e) {\n+                    var mue = new MalformedURLException(e.getMessage());\n+                    mue.initCause(e);\n+                    throw mue;\n+                }\n+            }\n+            i = enda;\n+        }\n+        path = uri.substring(i, endp);\n+        \/\/ look for query\n+        if (qmark > -1) {\n+            if (fmark > -1) {\n+                query = uri.substring(qmark, fmark);\n+            } else {\n+                query = uri.substring(qmark);\n+            }\n+        }\n+        if (fmark > -1) {\n+            fragment = uri.substring(fmark);\n+        }\n+    }\n+\n+    \/**\n+     * A subclass of {@code Uri} that supports scheme only\n+     * URIs can override this method and return true in the\n+     * case where the URI string is a scheme-only URI that\n+     * the subclass supports.\n+     * @implSpec\n+     * The default implementation of this method returns false,\n+     * always.\n+     * @param uri An URI string\n+     * @return if this is a scheme-only URI supported by the subclass\n+     *\/\n+    protected boolean isSchemeOnly(String uri) {\n+        return false;\n+    }\n+\n+    \/**\n+     * Checks whether the given uri string should be considered\n+     * as a scheme-only URI. For some protocols - e.g. DNS, we\n+     * might accept \"dns:\/\/\" as a valid URL denoting default DNS.\n+     * For others - we might only accept \"scheme:\".\n+     * @implSpec\n+     * The default implementation of this method returns true if\n+     * the URI is of the form {@code \"<scheme>:\"} with nothing\n+     * after the scheme delimiter.\n+     * @param uri the URI\n+     * @param scheme the scheme\n+     * @return true if the URI should be considered as a scheme-only\n+     *         URI supported by this URI scheme.\n+     *\/\n+    protected boolean checkSchemeOnly(String uri, String scheme) {\n+        return uri.equals(scheme + \":\");\n+    }\n+\n+    \/**\n+     * Creates a {@code MalformedURLException} to be thrown when the\n+     * URI scheme is not supported.\n+     *\n+     * @param uri the URI string\n+     * @return a {@link MalformedURLException}\n+     *\/\n+    protected MalformedURLException newInvalidURISchemeException(String uri) {\n+        return new MalformedURLException(\"Invalid URI scheme: \" + uri);\n+    }\n+\n+    \/**\n+     * Whether fragments are supported.\n+     * @implSpec\n+     * The default implementation of this method retturns false, always.\n+     * @return true if fragments are supported.\n+     *\/\n+    protected boolean acceptsFragment() {\n+        return parseMode() == ParseMode.LEGACY;\n+    }\n+\n@@ -193,0 +447,1 @@\n+     * Legacy parsing mode.\n@@ -194,1 +449,1 @@\n-    private void parse(String uri) throws MalformedURLException {\n+    private void parseLegacy(String uri) throws MalformedURLException {\n","filename":"src\/java.naming\/share\/classes\/com\/sun\/jndi\/toolkit\/url\/Uri.java","additions":266,"deletions":11,"binary":false,"changes":277,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-import java.lang.System.Logger.Level;\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Exchange.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,0 @@\n-import java.net.http.HttpClient;\n@@ -31,0 +30,1 @@\n+import java.net.http.HttpResponse.ResponseInfo;\n@@ -34,0 +34,1 @@\n+import jdk.internal.net.http.common.HttpBodySubscriberWrapper;\n@@ -69,1 +70,1 @@\n-    HttpClient client() {\n+    HttpClientImpl client() {\n@@ -184,0 +185,16 @@\n+    \/**\n+     * Creates and wraps an {@link HttpResponse.BodySubscriber} from a {@link\n+     * HttpResponse.BodyHandler} for the given {@link ResponseInfo}.\n+     * An {@code HttpBodySubscriberWrapper} wraps a response body subscriber and makes\n+     * sure its completed\/onError methods are called only once, and that its onSusbscribe\n+     * is called before onError. This is useful when errors occur asynchronously, and\n+     * most typically when the error occurs before the {@code BodySubscriber} has\n+     * subscribed.\n+     * @param handler  a body handler\n+     * @param response a response info\n+     * @return a new {@code HttpBodySubscriberWrapper} to handle the response\n+     *\/\n+    HttpBodySubscriberWrapper<T> createResponseSubscriber(HttpResponse.BodyHandler<T> handler, ResponseInfo response) {\n+        return new HttpBodySubscriberWrapper<>(handler.apply(response));\n+    }\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/ExchangeImpl.java","additions":20,"deletions":3,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -500,1 +500,2 @@\n-                      + \"\\t\\t queue.isEmpty: \" + queue.isEmpty(), ex);\n+                      + \"\\n\\t queue.isEmpty: \" + queue.isEmpty()\n+                      + \"\\n\\tstopRequested: \" + stopRequested, ex);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http1AsyncReceiver.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,0 @@\n-import java.net.http.HttpClient;\n@@ -34,0 +33,1 @@\n+import java.net.http.HttpResponse.ResponseInfo;\n@@ -42,0 +42,1 @@\n+\n@@ -43,0 +44,1 @@\n+import jdk.internal.net.http.common.HttpBodySubscriberWrapper;\n@@ -50,1 +52,0 @@\n-import static jdk.internal.net.http.common.Utils.wrapWithExtraDetail;\n@@ -81,1 +82,1 @@\n-     * headers and body ( if any ). *\/\n+     * headers and body ( if any )). *\/\n@@ -89,2 +90,4 @@\n-    \/** The subscriber to the request's body published. Maybe null. *\/\n-    private volatile Http1BodySubscriber bodySubscriber;\n+    \/** The subscriber to the request's body published. May be null. *\/\n+    private volatile Http1RequestBodySubscriber bodySubscriber;\n+    \/** The subscriber to the response's body received. May be null. *\/\n+    private volatile BodySubscriber<T> responseSubscriber;\n@@ -120,1 +123,1 @@\n-    abstract static class Http1BodySubscriber implements Flow.Subscriber<ByteBuffer> {\n+    abstract static class Http1RequestBodySubscriber implements Flow.Subscriber<ByteBuffer> {\n@@ -125,1 +128,1 @@\n-        Http1BodySubscriber(Logger debug) {\n+        Http1RequestBodySubscriber(Logger debug) {\n@@ -162,2 +165,2 @@\n-        static Http1BodySubscriber completeSubscriber(Logger debug) {\n-            return new Http1BodySubscriber(debug) {\n+        static Http1RequestBodySubscriber completeSubscriber(Logger debug) {\n+            return new Http1RequestBodySubscriber(debug) {\n@@ -176,0 +179,28 @@\n+    \/**\n+     * The Http1AsyncReceiver ensures that all calls to\n+     * the subscriber, including onSubscribe, occur sequentially.\n+     * There could however be some race conditions that could happen\n+     * in case of unexpected errors thrown at unexpected places, which\n+     * may cause onError to be called multiple times.\n+     * The Http1BodySubscriber will ensure that the user subscriber\n+     * is actually completed only once - and only after it is\n+     * subscribed.\n+     * @param <U> The type of response.\n+     *\/\n+    static final class Http1ResponseBodySubscriber<U> extends HttpBodySubscriberWrapper<U> {\n+        final Http1Exchange<U> exchange;\n+        Http1ResponseBodySubscriber(BodySubscriber<U> userSubscriber, Http1Exchange<U> exchange) {\n+            super(userSubscriber);\n+            this.exchange = exchange;\n+        }\n+\n+        @Override\n+        protected void complete(Throwable t) {\n+            try {\n+                exchange.responseSubscriberCompleted(this);\n+            } finally {\n+                super.complete(t);\n+            }\n+        }\n+    }\n+\n@@ -220,0 +251,22 @@\n+    \/\/ The Http1ResponseBodySubscriber is registered with the HttpClient\n+    \/\/ to ensure that it gets completed if the SelectorManager aborts due\n+    \/\/ to unexpected exceptions.\n+    void registerResponseSubscriber(Http1ResponseBodySubscriber<T> subscriber) {\n+        Throwable failed = null;\n+        synchronized (lock) {\n+            failed = this.failed;\n+            if (failed == null) {\n+                this.responseSubscriber = subscriber;\n+            }\n+        }\n+        if (failed != null) {\n+            subscriber.onError(failed);\n+        } else {\n+            client.registerSubscriber(subscriber);\n+        }\n+    }\n+\n+    void responseSubscriberCompleted(HttpBodySubscriberWrapper<T> subscriber) {\n+        client.subscriberCompleted(subscriber);\n+    }\n+\n@@ -324,2 +377,2 @@\n-                bodySubscriber = Http1BodySubscriber.completeSubscriber(debug);\n-                appendToOutgoing(Http1BodySubscriber.COMPLETED);\n+                bodySubscriber = Http1RequestBodySubscriber.completeSubscriber(debug);\n+                appendToOutgoing(Http1RequestBodySubscriber.COMPLETED);\n@@ -329,1 +382,1 @@\n-                        .thenAccept((s) -> cancelIfFailed(s))\n+                        .thenAccept(this::cancelIfFailed)\n@@ -373,3 +426,3 @@\n-        BodySubscriber<T> bs = handler.apply(new ResponseInfoImpl(response.responseCode(),\n-                                                                  response.responseHeaders(),\n-                                                                  HTTP_1_1));\n+        var responseInfo = new ResponseInfoImpl(response.responseCode(),\n+                response.responseHeaders(), HTTP_1_1);\n+        BodySubscriber<T> bs = createResponseSubscriber(handler, responseInfo);\n@@ -382,0 +435,9 @@\n+    @Override\n+    Http1ResponseBodySubscriber<T> createResponseSubscriber(BodyHandler<T> handler, ResponseInfo response) {\n+        BodySubscriber<T> subscriber = handler.apply(response);\n+        Http1ResponseBodySubscriber<T> bs =\n+                new Http1ResponseBodySubscriber<T>(subscriber, this);\n+        registerResponseSubscriber(bs);\n+        return bs;\n+    }\n+\n@@ -433,1 +495,2 @@\n-        Throwable error;\n+        Throwable error = null;\n+        BodySubscriber<?> subscriber;\n@@ -435,0 +498,1 @@\n+            subscriber = responseSubscriber;\n@@ -467,0 +531,9 @@\n+\n+        \/\/ complete subscriber if needed\n+        if (subscriber != null && error != null) {\n+            var failure = error;\n+            if (client.isSelectorThread()) {\n+                executor.execute(() -> subscriber.onError(failure));\n+            } else subscriber.onError(failure);\n+        }\n+\n@@ -601,1 +674,1 @@\n-                if (dp.data == Http1BodySubscriber.COMPLETED) {\n+                if (dp.data == Http1RequestBodySubscriber.COMPLETED) {\n@@ -712,1 +785,1 @@\n-                        if (data == Http1BodySubscriber.COMPLETED) {\n+                        if (data == Http1RequestBodySubscriber.COMPLETED) {\n@@ -757,1 +830,2 @@\n-    HttpClient client() {\n+    @Override\n+    final HttpClientImpl client() {\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http1Exchange.java","additions":94,"deletions":20,"binary":false,"changes":114,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,1 +41,1 @@\n-import jdk.internal.net.http.Http1Exchange.Http1BodySubscriber;\n+import jdk.internal.net.http.Http1Exchange.Http1RequestBodySubscriber;\n@@ -317,2 +317,2 @@\n-    Http1BodySubscriber continueRequest()  {\n-        Http1BodySubscriber subscriber;\n+    Http1RequestBodySubscriber continueRequest()  {\n+        Http1RequestBodySubscriber subscriber;\n@@ -332,1 +332,1 @@\n-    final class StreamSubscriber extends Http1BodySubscriber {\n+    final class StreamSubscriber extends Http1RequestBodySubscriber {\n@@ -395,1 +395,1 @@\n-    final class FixedContentSubscriber extends Http1BodySubscriber {\n+    final class FixedContentSubscriber extends Http1RequestBodySubscriber {\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http1Request.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+import java.net.http.HttpResponse.BodySubscriber;\n@@ -31,1 +32,0 @@\n-import java.util.List;\n@@ -33,1 +33,0 @@\n-import java.util.concurrent.CompletionStage;\n@@ -35,2 +34,0 @@\n-import java.util.concurrent.Flow;\n-import java.util.concurrent.atomic.AtomicBoolean;\n@@ -44,1 +41,0 @@\n-import jdk.internal.net.http.ResponseSubscribers.TrustedSubscriber;\n@@ -77,1 +73,1 @@\n-    static enum State {INITIAL, READING_HEADERS, READING_BODY, DONE}\n+    enum State {INITIAL, READING_HEADERS, READING_BODY, DONE}\n@@ -126,1 +122,1 @@\n-        public synchronized void acquire() {\n+        public synchronized boolean acquire() {\n@@ -135,0 +131,1 @@\n+                return true;\n@@ -140,0 +137,1 @@\n+                return false;\n@@ -280,113 +278,0 @@\n-    static final Flow.Subscription NOP = new Flow.Subscription() {\n-        @Override\n-        public void request(long n) { }\n-        public void cancel() { }\n-    };\n-\n-    \/**\n-     * The Http1AsyncReceiver ensures that all calls to\n-     * the subscriber, including onSubscribe, occur sequentially.\n-     * There could however be some race conditions that could happen\n-     * in case of unexpected errors thrown at unexpected places, which\n-     * may cause onError to be called multiple times.\n-     * The Http1BodySubscriber will ensure that the user subscriber\n-     * is actually completed only once - and only after it is\n-     * subscribed.\n-     * @param <U> The type of response.\n-     *\/\n-    static final class Http1BodySubscriber<U> implements TrustedSubscriber<U> {\n-        final HttpResponse.BodySubscriber<U> userSubscriber;\n-        final AtomicBoolean completed = new AtomicBoolean();\n-        volatile Throwable withError;\n-        volatile boolean subscribed;\n-        Http1BodySubscriber(HttpResponse.BodySubscriber<U> userSubscriber) {\n-            this.userSubscriber = userSubscriber;\n-        }\n-\n-        @Override\n-        public boolean needsExecutor() {\n-            return TrustedSubscriber.needsExecutor(userSubscriber);\n-        }\n-\n-        \/\/ propagate the error to the user subscriber, even if not\n-        \/\/ subscribed yet.\n-        private void propagateError(Throwable t) {\n-            assert t != null;\n-            try {\n-                \/\/ if unsubscribed at this point, it will not\n-                \/\/ get subscribed later - so do it now and\n-                \/\/ propagate the error\n-                if (subscribed == false) {\n-                    subscribed = true;\n-                    userSubscriber.onSubscribe(NOP);\n-                }\n-            } finally  {\n-                \/\/ if onError throws then there is nothing to do\n-                \/\/ here: let the caller deal with it by logging\n-                \/\/ and closing the connection.\n-                userSubscriber.onError(t);\n-            }\n-        }\n-\n-        \/\/ complete the subscriber, either normally or exceptionally\n-        \/\/ ensure that the subscriber is completed only once.\n-        private void complete(Throwable t) {\n-            if (completed.compareAndSet(false, true)) {\n-                t  = withError = Utils.getCompletionCause(t);\n-                if (t == null) {\n-                    assert subscribed;\n-                    try {\n-                        userSubscriber.onComplete();\n-                    } catch (Throwable x) {\n-                        \/\/ Simply propagate the error by calling\n-                        \/\/ onError on the user subscriber, and let the\n-                        \/\/ connection be reused since we should have received\n-                        \/\/ and parsed all the bytes when we reach here.\n-                        \/\/ If onError throws in turn, then we will simply\n-                        \/\/ let that new exception flow up to the caller\n-                        \/\/ and let it deal with it.\n-                        \/\/ (i.e: log and close the connection)\n-                        \/\/ Note that rethrowing here could introduce a\n-                        \/\/ race that might cause the next send() operation to\n-                        \/\/ fail as the connection has already been put back\n-                        \/\/ into the cache when we reach here.\n-                        propagateError(t = withError = Utils.getCompletionCause(x));\n-                    }\n-                } else {\n-                    propagateError(t);\n-                }\n-            }\n-        }\n-\n-        @Override\n-        public CompletionStage<U> getBody() {\n-            return userSubscriber.getBody();\n-        }\n-\n-        @Override\n-        public void onSubscribe(Flow.Subscription subscription) {\n-            if (!subscribed) {\n-                subscribed = true;\n-                userSubscriber.onSubscribe(subscription);\n-            } else {\n-                \/\/ could be already subscribed and completed\n-                \/\/ if an unexpected error occurred before the actual\n-                \/\/ subscription - though that's not supposed\n-                \/\/ happen.\n-                assert completed.get();\n-            }\n-        }\n-        @Override\n-        public void onNext(List<ByteBuffer> item) {\n-            assert !completed.get();\n-            userSubscriber.onNext(item);\n-        }\n-        @Override\n-        public void onError(Throwable throwable) {\n-            complete(throwable);\n-        }\n-        @Override\n-        public void onComplete() {\n-            complete(null);\n-        }\n-    }\n@@ -401,1 +286,1 @@\n-                        + connection.getClass() + \"\/\" + connection );\n+                        + connection.getClass() + \"\/\" + connection);\n@@ -406,1 +291,2 @@\n-        final Http1BodySubscriber<U> subscriber = new Http1BodySubscriber<>(p);\n+        final BodySubscriber<U> subscriber = p;\n+\n@@ -423,0 +309,1 @@\n+            boolean acquired = false;\n@@ -436,1 +323,2 @@\n-                refCountTracker.acquire();\n+                acquired = refCountTracker.acquire();\n+                assert acquired == true;\n@@ -460,1 +348,1 @@\n-                CompletableFuture<?> trailingOp = bodyReaderCF.whenComplete((s,t) ->  {\n+                CompletableFuture<?> trailingOp = bodyReaderCF.whenComplete((s, t) -> {\n@@ -482,1 +370,1 @@\n-               if (debug.on()) debug.log(\"Failed reading body: \" + t);\n+                if (debug.on()) debug.log(\"Failed reading body: \" + t);\n@@ -487,0 +375,1 @@\n+                    if (acquired) refCountTracker.tryRelease();\n@@ -495,0 +384,1 @@\n+            subscriber.onError(t);\n@@ -755,3 +645,4 @@\n-            if (t instanceof EOFException && bodyParser != null &&\n-                    bodyParser instanceof UnknownLengthBodyParser) {\n-                ((UnknownLengthBodyParser)bodyParser).complete();\n+            BodyParser parser = bodyParser;\n+            if (t instanceof EOFException && parser != null &&\n+                    parser instanceof UnknownLengthBodyParser ulBodyParser) {\n+                ulBodyParser.complete();\n@@ -761,0 +652,1 @@\n+            parser.onError(t);\n@@ -827,0 +719,14 @@\n+            if (error != null) {\n+                \/\/ makes sure the parser gets the error\n+                BodyParser parser = this.parser;\n+                if (parser != null) {\n+                    if (debug.on()) {\n+                        debug.log(\"propagating error to parser: \" + error);\n+                    }\n+                    parser.onError(error);\n+                } else {\n+                    if (debug.on()) {\n+                        debug.log(\"no parser - error not propagated: \" + error);\n+                    }\n+                }\n+            }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http1Response.java","additions":35,"deletions":129,"binary":false,"changes":164,"status":"modified"},{"patch":"@@ -60,0 +60,1 @@\n+    private volatile boolean stopping;\n@@ -163,0 +164,5 @@\n+            if (stopping) {\n+                if (debug.on()) debug.log(\"stopping - closing connection: %s\", c);\n+                close(c);\n+                return false;\n+            }\n@@ -196,0 +202,1 @@\n+        synchronized (this) {stopping = true;}\n@@ -199,2 +206,3 @@\n-        connections.values().forEach(this::close);\n-        connections.clear();\n+        do {\n+            connections.values().forEach(this::close);\n+        } while (!connections.isEmpty());\n@@ -204,0 +212,3 @@\n+        \/\/ close all streams\n+        try { h2c.closeAllStreams(); } catch (Throwable t) {}\n+        \/\/ send GOAWAY\n@@ -205,0 +216,1 @@\n+        \/\/ attempt graceful shutdown\n@@ -206,0 +218,2 @@\n+        \/\/ double check and close any new streams\n+        try { h2c.closeAllStreams(); } catch (Throwable t) {}\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http2ClientImpl.java","additions":16,"deletions":2,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -971,0 +971,10 @@\n+    \/\/ This method is called when the HTTP\/2 client is being\n+    \/\/ stopped. Do not call it from anywhere else.\n+    void closeAllStreams() {\n+        for (var streamId : streams.keySet()) {\n+            \/\/ safe to call without locking - see Stream::deRegister\n+            decrementStreamsCount(streamId);\n+            closeStream(streamId);\n+        }\n+    }\n+\n@@ -973,8 +983,11 @@\n-        boolean isClient = (streamid % 2) == 1;\n-        Stream<?> s = streams.remove(streamid);\n-        if (s != null) {\n-            \/\/ decrement the reference count on the HttpClientImpl\n-            \/\/ to allow the SelectorManager thread to exit if no\n-            \/\/ other operation is pending and the facade is no\n-            \/\/ longer referenced.\n-            client().streamUnreference();\n+\n+        Stream<?> s;\n+        synchronized (this) {\n+            s = streams.remove(streamid);\n+            if (s != null) {\n+                \/\/ decrement the reference count on the HttpClientImpl\n+                \/\/ to allow the SelectorManager thread to exit if no\n+                \/\/ other operation is pending and the facade is no\n+                \/\/ longer referenced.\n+                client().streamUnreference();\n+            }\n@@ -1156,2 +1169,13 @@\n-        client().streamReference();\n-        streams.put(streamid, stream);\n+        synchronized (this) {\n+            if (!closed) {\n+                if (debug.on()) {\n+                    debug.log(\"Opened stream %d\", streamid);\n+                }\n+                client().streamReference();\n+                streams.put(streamid, stream);\n+                return;\n+            }\n+        }\n+        if (debug.on()) debug.log(\"connection closed: closing stream %d\", stream);\n+        stream.cancel();\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http2Connection.java","additions":34,"deletions":10,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import java.nio.channels.ClosedSelectorException;\n@@ -65,0 +66,1 @@\n+import java.util.concurrent.ConcurrentSkipListSet;\n@@ -69,0 +71,1 @@\n+import java.util.concurrent.RejectedExecutionException;\n@@ -70,0 +73,1 @@\n+import java.util.concurrent.atomic.AtomicBoolean;\n@@ -72,0 +76,2 @@\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.function.BiConsumer;\n@@ -80,0 +86,1 @@\n+\n@@ -81,0 +88,1 @@\n+import jdk.internal.net.http.common.HttpBodySubscriberWrapper;\n@@ -83,0 +91,1 @@\n+import jdk.internal.net.http.common.MinimalFuture;\n@@ -103,0 +112,1 @@\n+    private final AtomicLong CONNECTION_IDS = new AtomicLong();\n@@ -141,1 +151,4 @@\n-        DelegatingExecutor(BooleanSupplier isInSelectorThread, Executor delegate) {\n+        private final BiConsumer<Runnable, Throwable> errorHandler;\n+        DelegatingExecutor(BooleanSupplier isInSelectorThread,\n+                           Executor delegate,\n+                           BiConsumer<Runnable, Throwable> errorHandler) {\n@@ -144,0 +157,1 @@\n+            this.errorHandler = errorHandler;\n@@ -150,0 +164,2 @@\n+\n+\n@@ -153,1 +169,1 @@\n-                delegate.execute(command);\n+                ensureExecutedAsync(command);\n@@ -159,0 +175,9 @@\n+        public void ensureExecutedAsync(Runnable command) {\n+            try {\n+                delegate.execute(command);\n+            } catch (Throwable t) {\n+                errorHandler.accept(command, t);\n+                ASYNC_POOL.execute(command);\n+            }\n+        }\n+\n@@ -170,0 +195,71 @@\n+    }\n+\n+    \/\/ We maintain a list of pending requests that will be aborted if ever\n+    \/\/ the selector manager thread exists abnormally.\n+    \/\/ The request, its id, and its completable future, are stored in a record-like\n+    \/\/ PendingRequest object added to the pending requests set (pendingRequests).\n+    \/\/\n+    \/\/ When the request's cf completes, either normally or abnormally, a dependent action\n+    \/\/ will remove the PendingRequest object from the pending requests set.\n+    \/\/ If the SelectorManager threads exits abnormally, all pending requests in the\n+    \/\/ pending requests set will be completed exceptionally, in the ASYNC_POOL.\n+    \/\/\n+    \/\/ HttpClientImpl::registerPending(id, req, cf, client) is called from sendAsync\n+    \/\/ to register the pending request in the pending requests set before returning\n+    \/\/ the completable future to the caller.\n+    \/\/\n+    \/\/ HttpClientImpl::abortPendingRequests(client, Throwable reason) is called from\n+    \/\/ the SelectorManager when a throwable is caught just before exiting.\n+    \/\/\n+    \/\/ A dependent action is registered with the pending request's cf to make sure\n+    \/\/ that the pending request will be removed from the pending requests set if,\n+    \/\/ or after, the cf is completed.\n+    \/\/\n+    private final Set<PendingRequest> pendingRequests;\n+    \/\/ an id to ensure total order of pending request objects\n+    private final AtomicLong pendingRequestId = new AtomicLong();\n+    private static final class PendingRequest implements Comparable<PendingRequest> {\n+        final long id;\n+        final HttpRequest request;\n+        final CompletableFuture<?> cf;\n+        final HttpClientImpl client;\n+        final MultiExchange<?> mex;\n+        Object ref;\n+        private PendingRequest(long id,\n+                               HttpRequest request,\n+                               CompletableFuture<?> cf,\n+                               MultiExchange<?> mex,\n+                               HttpClientImpl client) {\n+            this.id = id;\n+            this.request = request;\n+            this.cf = cf;\n+            this.mex = mex;\n+            this.client = client;\n+        }\n+\n+        public void abort(Throwable t) {\n+            try {\n+                if (client.isSelectorThread()) {\n+                    var done = cf.exceptionally((e) -> null);\n+                    ASYNC_POOL.execute(() -> completeExceptionally(t));\n+                    \/\/ special case for when this method is called in the SelectorManager thread:\n+                    \/\/ we want to wait until all futures are completed before proceeding to\n+                    \/\/ shutdown. This ensures that the caller receive the actual `reason`\n+                    \/\/ and not something like \"HTTP\/2 client closed\"...\n+                    done.join();\n+                } else {\n+                    cf.completeExceptionally(t);\n+                }\n+            } finally {\n+                mex.cancel(Utils.getIOException(t));\n+            }\n+        }\n+\n+        private void completeExceptionally(Throwable t) {\n+            if (client.debug.on()) {\n+                client.debug.log(\"aborting %s with %s\", this, t);\n+            }\n+            try { cf.completeExceptionally(t); } catch (Throwable e) {\n+                client.debug.log(\"Failed to complete cf for [%s]: %s\", this, e);\n+            }\n+        }\n@@ -171,0 +267,51 @@\n+\n+        @Override\n+        public int compareTo(PendingRequest o) {\n+            if (o == null) return 1;\n+            return Long.compare(id, o.id);\n+        }\n+\n+        public String toString() {\n+            return id + \": \" + request.toString();\n+        }\n+    }\n+\n+    static void registerPending(PendingRequest pending) {\n+        \/\/ shortcut if cf is already completed: no need to go through the trouble of\n+        \/\/    registering it\n+        if (pending.cf.isDone()) return;\n+\n+        var client = pending.client;\n+        var cf = pending.cf;\n+        var id = pending.id;\n+        boolean added = client.pendingRequests.add(pending);\n+        \/\/ this may immediately remove `pending` from the set is the cf is already completed\n+        pending.ref = cf.whenComplete((r,t) -> client.pendingRequests.remove(pending));\n+        assert added : \"request %d was already added\".formatted(id);\n+        \/\/ should not happen, unless the selector manager has already\n+        \/\/ exited abnormally\n+        if (client.selmgr.isClosed()) {\n+            pending.abort(client.selmgr.selectorClosedException());\n+        }\n+    }\n+\n+    static void abortPendingRequests(HttpClientImpl client, Throwable reason) {\n+        reason = Utils.getCompletionCause(reason);\n+        if (client.debug.on()) {\n+            var msg = reason instanceof RejectedExecutionException\n+                    ? reason.getClass() : reason;\n+            client.debug.log(\"aborting pending requests due to: %s\", msg);\n+        }\n+        closeSubscribers(client, reason);\n+        var pendingRequests = client.pendingRequests;\n+        while (!pendingRequests.isEmpty()) {\n+            var pendings = pendingRequests.iterator();\n+            while (pendings.hasNext()) {\n+                var pending = pendings.next();\n+                try {\n+                    pending.abort(reason);\n+                } finally {\n+                    pendings.remove();\n+                }\n+            }\n+        }\n@@ -209,0 +356,5 @@\n+    private final ConcurrentSkipListSet<PlainHttpConnection> openedConnections\n+            = new ConcurrentSkipListSet<>(HttpConnection.COMPARE_BY_ID);\n+    private final ConcurrentSkipListSet<HttpBodySubscriberWrapper<?>> subscribers\n+            = new ConcurrentSkipListSet<>(HttpBodySubscriberWrapper.COMPARE_BY_ID);\n+\n@@ -240,0 +392,1 @@\n+    private final AtomicLong pendingHttpOperationsCount = new AtomicLong();\n@@ -242,0 +395,2 @@\n+    private final AtomicLong pendingTCPConnectionCount = new AtomicLong();\n+    private final AtomicBoolean isAlive = new AtomicBoolean();\n@@ -295,1 +450,3 @@\n-        delegatingExecutor = new DelegatingExecutor(this::isSelectorThread, ex);\n+        pendingRequests = new ConcurrentSkipListSet<>();\n+        delegatingExecutor = new DelegatingExecutor(this::isSelectorThread, ex,\n+                this::onSubmitFailure);\n@@ -334,0 +491,4 @@\n+    void onSubmitFailure(Runnable command, Throwable failure) {\n+        selmgr.abort(failure);\n+    }\n+\n@@ -347,0 +508,4 @@\n+        \/\/ make sure all subscribers are completed\n+        closeSubscribers();\n+        \/\/ close TCP connection if any are still opened\n+        openedConnections.forEach(this::closeConnection);\n@@ -351,0 +516,34 @@\n+    private void closeSubscribers() {\n+        if (subscribers.isEmpty()) return;\n+        IOException io = selmgr.selectorClosedException();\n+        closeSubscribers(this, io);\n+    }\n+\n+    private static void closeSubscribers(HttpClientImpl client, Throwable t) {\n+        client.subscribers.forEach(s -> s.onError(t));\n+    }\n+\n+    public void registerSubscriber(HttpBodySubscriberWrapper<?> subscriber) {\n+        if (!selmgr.isClosed()) {\n+            synchronized (selmgr) {\n+                if (!selmgr.isClosed()) {\n+                    subscribers.add(subscriber);\n+                    return;\n+                }\n+            }\n+        }\n+        subscriber.onError(selmgr.selectorClosedException());\n+    }\n+\n+    public void subscriberCompleted(HttpBodySubscriberWrapper<?> subscriber) {\n+        subscribers.remove(subscriber);\n+    }\n+\n+    private void closeConnection(HttpConnection conn) {\n+        try { conn.close(); } catch (Throwable e) {\n+            if (Log.channel()) {\n+                Log.logChannel(\"Failed to close connection: \" + e);\n+            }\n+        }\n+    }\n+\n@@ -368,2 +567,20 @@\n-    \/\/ Increments the pendingOperationCount.\n-    final long reference() {\n+    public long newConnectionId() {\n+        return CONNECTION_IDS.incrementAndGet();\n+    }\n+\n+    \/\/ Increments the pendingTCPConnectionCount\n+    public void connectionOpened(PlainHttpConnection plainHttpConnection) {\n+        if (openedConnections.add(plainHttpConnection)) {\n+            pendingTCPConnectionCount.incrementAndGet();\n+        }\n+    }\n+\n+    \/\/ Decrements the pendingTCPConnectionCount\n+    public void connectionClosed(PlainHttpConnection plainHttpConnection) {\n+        if (openedConnections.remove(plainHttpConnection)) {\n+            pendingTCPConnectionCount.decrementAndGet();\n+        }\n+    }\n+\n+    \/\/ Increments the pendingHttpRequestCount and pendingOperationCount.\n+    final long requestReference() {\n@@ -371,0 +588,12 @@\n+        return reference();\n+    }\n+\n+    \/\/ Decrements the pendingHttpRequestCount and pendingOperationCount.\n+    final long requestUnreference() {\n+        pendingHttpRequestCount.decrementAndGet();\n+        return unreference();\n+    }\n+\n+    \/\/ Increments the pendingHttpOperationsCount and pendingOperationCount.\n+    final long reference() {\n+        pendingHttpOperationsCount.incrementAndGet();\n@@ -374,1 +603,1 @@\n-    \/\/ Decrements the pendingOperationCount.\n+    \/\/ Decrements the pendingHttpOperationsCount and pendingOperationCount.\n@@ -377,1 +606,1 @@\n-        final long httpCount = pendingHttpRequestCount.decrementAndGet();\n+        final long httpCount = pendingHttpOperationsCount.decrementAndGet();\n@@ -390,1 +619,1 @@\n-    \/\/ Increments the pendingOperationCount.\n+    \/\/ Increments the pendingHttp2StreamCount and pendingOperationCount.\n@@ -396,1 +625,1 @@\n-    \/\/ Decrements the pendingOperationCount.\n+    \/\/ Decrements the pendingHttp2StreamCount and pendingOperationCount.\n@@ -400,1 +629,1 @@\n-        final long httpCount = pendingHttpRequestCount.get();\n+        final long httpCount = pendingHttpOperationsCount.get();\n@@ -412,1 +641,1 @@\n-    \/\/ Increments the pendingOperationCount.\n+    \/\/ Increments the pendingWebSocketCount and pendingOperationCount.\n@@ -418,1 +647,1 @@\n-    \/\/ Decrements the pendingOperationCount.\n+    \/\/ Decrements the pendingWebSocketCount and pendingOperationCount.\n@@ -422,1 +651,1 @@\n-        final long httpCount = pendingHttpRequestCount.get();\n+        final long httpCount = pendingHttpOperationsCount.get();\n@@ -435,0 +664,1 @@\n+    \/\/ Incremented with any operation, whether it's HTTP\/1.1, HTTP\/2, or WebSocket\n@@ -439,0 +669,3 @@\n+    \/\/ Trackers are used in test to verify that an instance of\n+    \/\/ HttpClient has shutdown correctly, and that all operations\n+    \/\/ have terminated.\n@@ -440,0 +673,1 @@\n+        final AtomicLong requestCount;\n@@ -444,0 +678,1 @@\n+        final AtomicLong connnectionsCount;\n@@ -445,0 +680,1 @@\n+        final AtomicBoolean isAlive;\n@@ -446,1 +682,2 @@\n-        HttpClientTracker(AtomicLong http,\n+        HttpClientTracker(AtomicLong request,\n+                          AtomicLong http,\n@@ -450,0 +687,1 @@\n+                          AtomicLong conns,\n@@ -451,0 +689,1 @@\n+                          AtomicBoolean isAlive,\n@@ -452,0 +691,1 @@\n+            this.requestCount = request;\n@@ -456,0 +696,1 @@\n+            this.connnectionsCount = conns;\n@@ -457,0 +698,1 @@\n+            this.isAlive = isAlive;\n@@ -464,0 +706,6 @@\n+        public long getOutstandingHttpRequests() {\n+            return requestCount.get();\n+        }\n+        @Override\n+        public long getOutstandingTcpConnections() { return connnectionsCount.get();}\n+        @Override\n@@ -478,0 +726,2 @@\n+        public boolean isSelectorAlive() { return isAlive.get(); }\n+        @Override\n@@ -484,1 +734,3 @@\n-        return new HttpClientTracker(pendingHttpRequestCount,\n+        return new HttpClientTracker(\n+                pendingHttpRequestCount,\n+                pendingHttpOperationsCount,\n@@ -488,0 +740,1 @@\n+                pendingTCPConnectionCount,\n@@ -489,0 +742,1 @@\n+                isAlive,\n@@ -494,1 +748,1 @@\n-    final boolean isReferenced() {\n+    boolean isReferenced() {\n@@ -526,0 +780,8 @@\n+    boolean isSelectorClosed() {\n+        return selmgr.isClosed();\n+    }\n+\n+    IOException selectorClosedException() {\n+        return selmgr.selectorClosedException();\n+    }\n+\n@@ -616,0 +878,6 @@\n+        \/\/ should not happen, unless the selector manager has\n+        \/\/ exited abnormally\n+        if (selmgr.isClosed()) {\n+            return MinimalFuture.failedFuture(selmgr.selectorClosedException());\n+        }\n+\n@@ -625,0 +893,1 @@\n+        long id = pendingRequestId.incrementAndGet();\n@@ -626,1 +895,1 @@\n-        reference();\n+        requestReference();\n@@ -649,2 +918,2 @@\n-            CompletableFuture<HttpResponse<T>> res =\n-                    mex.responseAsync(executor).whenComplete((b,t) -> unreference());\n+            CompletableFuture<HttpResponse<T>> mexCf = mex.responseAsync(executor);\n+            CompletableFuture<HttpResponse<T>> res = mexCf.whenComplete((b,t) -> requestUnreference());\n@@ -662,0 +931,5 @@\n+\n+            \/\/ The mexCf is the Cf we need to abort if the SelectorManager thread\n+            \/\/ is aborted.\n+            PendingRequest pending = new PendingRequest(id, requestImpl, mexCf, mex, this);\n+            registerPending(pending);\n@@ -664,1 +938,1 @@\n-            unreference();\n+            requestUnreference();\n@@ -704,2 +978,3 @@\n-        HttpClientImpl owner;\n-        ConnectionPool pool;\n+        private final HttpClientImpl owner;\n+        private final ConnectionPool pool;\n+        private final AtomicReference<Throwable> errorRef = new AtomicReference<>();\n@@ -720,0 +995,9 @@\n+        IOException selectorClosedException() {\n+            var io = new IOException(\"selector manager closed\");\n+            var cause = errorRef.get();\n+            if (cause != null) {\n+                io.initCause(cause);\n+            }\n+            return io;\n+        }\n+\n@@ -726,1 +1010,1 @@\n-                } else if (e.interestOps() != 0){\n+                } else if (e.interestOps() != 0) {\n@@ -743,0 +1027,1 @@\n+            if (closed) e.abort(selectorClosedException());\n@@ -759,0 +1044,42 @@\n+        void abort(Throwable t) {\n+            boolean closed = this.closed;\n+            errorRef.compareAndSet(null, t);\n+            if (debug.on()) {\n+                debug.log(\"aborting selector manager(closed=%s): \" + t, closed);\n+            }\n+            t = errorRef.get();\n+            boolean inSelectorThread = owner.isSelectorThread();\n+            if (!inSelectorThread) {\n+                \/\/ abort anything pending, then close\n+                abortPendingRequests(owner, t);\n+            }\n+            Set<SelectionKey> keys = new HashSet<>();\n+            Set<AsyncEvent> toAbort = new HashSet<>();\n+            synchronized (this) {\n+                if (closed = this.closed) return;\n+                this.closed = true;\n+                try {\n+                    keys.addAll(selector.keys());\n+                } catch (ClosedSelectorException ce) {\n+                    \/\/ OK - nothing to do...\n+                }\n+                toAbort.addAll(this.registrations);\n+                toAbort.addAll(this.deregistrations);\n+                this.registrations.clear();\n+                this.deregistrations.clear();\n+            }\n+            \/\/ double check after closing\n+            abortPendingRequests(owner, t);\n+\n+            IOException io = toAbort.isEmpty()\n+                    ? null : selectorClosedException();\n+            for (AsyncEvent e : toAbort) {\n+                try {\n+                    e.abort(io);\n+                } catch (Throwable x) {\n+                    debug.log(\"Failed to abort event: \" + x);\n+                }\n+            }\n+            if (!inSelectorThread) selector.wakeup();\n+        }\n+\n@@ -771,0 +1098,4 @@\n+        boolean isClosed() {\n+            return closed;\n+        }\n+\n@@ -776,0 +1107,1 @@\n+            owner.isAlive.set(true);\n@@ -778,1 +1110,1 @@\n-                while (!Thread.currentThread().isInterrupted()) {\n+                while (!Thread.currentThread().isInterrupted() && !closed) {\n@@ -811,1 +1143,1 @@\n-                                    throw new IOException(\"Channel closed\");\n+                                    throw new ClosedChannelException();\n@@ -930,1 +1262,2 @@\n-                    readyList.forEach((e) -> handleEvent(e, null));\n+                    IOException ioe = closed ? selectorClosedException() : null;\n+                    readyList.forEach((e) -> handleEvent(e, ioe));\n@@ -943,0 +1276,1 @@\n+                errorRef.compareAndSet(null, e);\n@@ -944,0 +1278,1 @@\n+                    closed = true; \/\/ set closed early so that new requests are rejected\n@@ -949,0 +1284,1 @@\n+                abortPendingRequests(owner, selectorClosedException());\n@@ -955,1 +1291,5 @@\n-                shutdown();\n+                try {\n+                    shutdown();\n+                } finally {\n+                    owner.isAlive.set(false);\n+                }\n@@ -972,1 +1312,4 @@\n-            if (closed || ioe != null) {\n+            if (ioe == null && closed) {\n+                ioe = selectorClosedException();\n+            }\n+            if (ioe != null) {\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/HttpClientImpl.java","additions":371,"deletions":28,"binary":false,"changes":399,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,1 @@\n+import java.util.Comparator;\n@@ -37,1 +38,0 @@\n-import java.util.TreeMap;\n@@ -72,0 +72,2 @@\n+    public static final Comparator<HttpConnection> COMPARE_BY_ID\n+            = Comparator.comparing(HttpConnection::id);\n@@ -77,0 +79,1 @@\n+    private final long id;\n@@ -82,0 +85,10 @@\n+        this.id = newConnectionId(client);\n+    }\n+\n+    \/\/ This is overridden in tests\n+    long newConnectionId(HttpClientImpl client) {\n+        return client.newConnectionId();\n+    }\n+\n+    private long id() {\n+        return id;\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/HttpConnection.java","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -172,0 +172,1 @@\n+            Executor ensureExecutedAsync = this.executor::ensureExecutedAsync;\n@@ -173,2 +174,2 @@\n-                    ? this.executor.delegate()\n-                    : new PrivilegedExecutor(this.executor.delegate(), acc);\n+                    ? ensureExecutedAsync\n+                    : new PrivilegedExecutor(ensureExecutedAsync, acc);\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/MultiExchange.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -143,0 +143,1 @@\n+                client().connectionOpened(PlainHttpConnection.this);\n@@ -148,0 +149,1 @@\n+                    \/\/ complete async since the event runs on the SelectorManager thread\n@@ -152,0 +154,1 @@\n+                \/\/ complete async since the event runs on the SelectorManager thread\n@@ -159,0 +162,1 @@\n+            \/\/ complete async since the event runs on the SelectorManager thread\n@@ -191,0 +195,1 @@\n+                client().connectionOpened(this);\n@@ -200,0 +205,3 @@\n+                if (Log.channel()) {\n+                    Log.logChannel(\"Closing connection: connect failed due to: \" + throwable);\n+                }\n@@ -371,2 +379,9 @@\n-            chan.close();\n-            tube.signalClosed();\n+            if (Log.channel()) {\n+                Log.logChannel(\"Closing channel: \" + chan);\n+            }\n+            try {\n+                chan.close();\n+                tube.signalClosed();\n+            } finally {\n+                client().connectionClosed(this);\n+            }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/PlainHttpConnection.java","additions":18,"deletions":3,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -107,0 +107,1 @@\n+        void onError(Throwable t);\n@@ -181,0 +182,6 @@\n+        @Override\n+        public void onError(Throwable t) {\n+            closedExceptionally = t;\n+            onComplete.accept(t);\n+        }\n+\n@@ -480,0 +487,6 @@\n+        @Override\n+        public void onError(Throwable t) {\n+            closedExceptionally = t;\n+            onComplete.accept(t);\n+        }\n+\n@@ -566,0 +579,10 @@\n+        @Override\n+        public void onError(Throwable t) {\n+            if (contentLength != 0) {\n+                closedExceptionally = t;\n+                onComplete.accept(t);\n+            } else {\n+                onComplete.accept(null);\n+            }\n+        }\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/ResponseContent.java","additions":24,"deletions":1,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,1 @@\n+import jdk.internal.net.http.HttpClientImpl.DelegatingExecutor;\n@@ -1144,2 +1145,2 @@\n-                e = (e instanceof HttpClientImpl.DelegatingExecutor)\n-                        ? ((HttpClientImpl.DelegatingExecutor) e).delegate() : e;\n+                e = (e instanceof DelegatingExecutor exec)\n+                        ? exec::ensureExecutedAsync : e;\n@@ -1158,0 +1159,1 @@\n+                    \/\/ the errorHandler will complete the CF\n@@ -1164,0 +1166,1 @@\n+            \/\/ the errorHandler will complete the CF\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/ResponseSubscribers.java","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -344,0 +344,4 @@\n+            if (client.isSelectorClosed()) {\n+                signalError(client.selectorClosedException());\n+                return;\n+            }\n@@ -357,0 +361,4 @@\n+                        if (client.isSelectorClosed()) {\n+                            signalError(client.selectorClosedException());\n+                            return;\n+                        }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/SocketTube.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,2 @@\n+import java.net.http.HttpResponse.BodyHandler;\n+import java.net.http.HttpResponse.ResponseInfo;\n@@ -302,0 +304,3 @@\n+    \/\/ This method is called by Http2Connection::decrementStreamCount in order\n+    \/\/ to make sure that the stream count is decremented only once for\n+    \/\/ a given stream.\n@@ -314,1 +319,2 @@\n-            BodySubscriber<T> bodySubscriber = handler.apply(new ResponseInfoImpl(response));\n+            Http2StreamResponseSubscriber<T> bodySubscriber =\n+                    createResponseSubscriber(handler, new ResponseInfoImpl(response));\n@@ -330,0 +336,19 @@\n+    @Override\n+    Http2StreamResponseSubscriber<T> createResponseSubscriber(BodyHandler<T> handler, ResponseInfo response) {\n+        Http2StreamResponseSubscriber<T> subscriber =\n+                new Http2StreamResponseSubscriber<>(handler.apply(response));\n+        registerResponseSubscriber(subscriber);\n+        return subscriber;\n+    }\n+\n+    \/\/ The Http2StreamResponseSubscriber is registered with the HttpClient\n+    \/\/ to ensure that it gets completed if the SelectorManager aborts due\n+    \/\/ to unexpected exceptions.\n+    private void registerResponseSubscriber(Http2StreamResponseSubscriber<?> subscriber) {\n+        client().registerSubscriber(subscriber);\n+    }\n+\n+    private void subscriberCompleted(Http2StreamResponseSubscriber<?> subscriber) {\n+        client().subscriberCompleted(subscriber);\n+    }\n+\n@@ -387,3 +412,0 @@\n-        } else {\n-            pendingResponseSubscriber = bodySubscriber;\n-            sched.runOrSchedule(); \/\/ in case data waiting already to be processed\n@@ -391,0 +413,6 @@\n+\n+        \/\/ ensure that the body subscriber will be subsribed and onError() is\n+        \/\/ invoked\n+        pendingResponseSubscriber = bodySubscriber;\n+        sched.runOrSchedule(); \/\/ in case data waiting already to be processed, or error\n+\n@@ -1487,0 +1515,15 @@\n+    final class Http2StreamResponseSubscriber<U> extends HttpBodySubscriberWrapper<U> {\n+        Http2StreamResponseSubscriber(BodySubscriber<U> subscriber) {\n+            super(subscriber);\n+        }\n+\n+        @Override\n+        protected void complete(Throwable t) {\n+            try {\n+                Stream.this.subscriberCompleted(this);\n+            } finally {\n+                super.complete(t);\n+            }\n+        }\n+    }\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Stream.java","additions":48,"deletions":5,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -0,0 +1,174 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package jdk.internal.net.http.common;\n+\n+import java.net.http.HttpResponse.BodySubscriber;\n+import java.nio.ByteBuffer;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.concurrent.CompletionStage;\n+import java.util.concurrent.Flow;\n+import java.util.concurrent.Flow.Subscription;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicLong;\n+\n+import jdk.internal.net.http.ResponseSubscribers.TrustedSubscriber;\n+\n+\/**\n+ * A class that wraps a user supplied {@link BodySubscriber}, but on\n+ * which {@link #onError(Throwable)} can be invoked at any time,\n+ * even before {@link #onSubscribe(Subscription)} has not been called\n+ * yet.\n+ * @param <T> the type of the response body\n+ *\/\n+public class HttpBodySubscriberWrapper<T> implements TrustedSubscriber<T> {\n+\n+    public static final Comparator<HttpBodySubscriberWrapper<?>> COMPARE_BY_ID\n+            = Comparator.comparing(HttpBodySubscriberWrapper::id);\n+\n+\n+    public static final Flow.Subscription NOP = new Flow.Subscription() {\n+        @Override\n+        public void request(long n) { }\n+        public void cancel() { }\n+    };\n+\n+    static final AtomicLong IDS = new AtomicLong();\n+    final long id = IDS.incrementAndGet();\n+    final BodySubscriber<T> userSubscriber;\n+    final AtomicBoolean completed = new AtomicBoolean();\n+    final AtomicBoolean subscribed = new AtomicBoolean();\n+    volatile Subscription subscription;\n+    volatile Throwable withError;\n+    public HttpBodySubscriberWrapper(BodySubscriber<T> userSubscriber) {\n+        this.userSubscriber = userSubscriber;\n+    }\n+\n+    final long id() { return id; }\n+\n+    @Override\n+    public boolean needsExecutor() {\n+        return TrustedSubscriber.needsExecutor(userSubscriber);\n+    }\n+\n+    \/\/ propagate the error to the user subscriber, even if not\n+    \/\/ subscribed yet.\n+    private void propagateError(Throwable t) {\n+        assert t != null;\n+        try {\n+            \/\/ if unsubscribed at this point, it will not\n+            \/\/ get subscribed later - so do it now and\n+            \/\/ propagate the error\n+            \/\/ Race condition with onSubscribe: we need to wait until\n+            \/\/ subscription is finished before calling onError;\n+            synchronized (this) {\n+                if (subscribed.compareAndSet(false, true)) {\n+                    userSubscriber.onSubscribe(NOP);\n+                }\n+            }\n+        } finally  {\n+            \/\/ if onError throws then there is nothing to do\n+            \/\/ here: let the caller deal with it by logging\n+            \/\/ and closing the connection.\n+            userSubscriber.onError(t);\n+        }\n+    }\n+\n+    \/**\n+     * Complete the subscriber, either normally or exceptionally\n+     * ensure that the subscriber is completed only once.\n+     * @param t a throwable, or {@code null}\n+     *\/\n+    protected void complete(Throwable t) {\n+        if (completed.compareAndSet(false, true)) {\n+            t  = withError = Utils.getCompletionCause(t);\n+            if (t == null) {\n+                try {\n+                    assert subscribed.get();\n+                    userSubscriber.onComplete();\n+                } catch (Throwable x) {\n+                    \/\/ Simply propagate the error by calling\n+                    \/\/ onError on the user subscriber, and let the\n+                    \/\/ connection be reused since we should have received\n+                    \/\/ and parsed all the bytes when we reach here.\n+                    \/\/ If onError throws in turn, then we will simply\n+                    \/\/ let that new exception flow up to the caller\n+                    \/\/ and let it deal with it.\n+                    \/\/ (i.e: log and close the connection)\n+                    \/\/ Note that rethrowing here could introduce a\n+                    \/\/ race that might cause the next send() operation to\n+                    \/\/ fail as the connection has already been put back\n+                    \/\/ into the cache when we reach here.\n+                    propagateError(t = withError = Utils.getCompletionCause(x));\n+                }\n+            } else {\n+                propagateError(t);\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public CompletionStage<T> getBody() {\n+        return userSubscriber.getBody();\n+    }\n+\n+    @Override\n+    public void onSubscribe(Flow.Subscription subscription) {\n+        this.subscription = subscription;\n+        \/\/ race condition with propagateError: we need to wait until\n+        \/\/ subscription is finished before calling onError;\n+        synchronized (this) {\n+            if (subscribed.compareAndSet(false, true)) {\n+                userSubscriber.onSubscribe(subscription);\n+            } else {\n+                \/\/ could be already subscribed and completed\n+                \/\/ if an unexpected error occurred before the actual\n+                \/\/ subscription - though that's not supposed\n+                \/\/ happen.\n+                assert completed.get();\n+            }\n+        }\n+    }\n+\n+    @Override\n+    public void onNext(List<ByteBuffer> item) {\n+        if (completed.get()) {\n+            if (subscription != null) {\n+                subscription.cancel();\n+            }\n+        } else {\n+            userSubscriber.onNext(item);\n+        }\n+    }\n+    @Override\n+    public void onError(Throwable throwable) {\n+        complete(throwable);\n+    }\n+    @Override\n+    public void onComplete() {\n+        complete(null);\n+    }\n+}\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/common\/HttpBodySubscriberWrapper.java","additions":174,"deletions":0,"binary":false,"changes":174,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,0 +46,4 @@\n+        \/\/ The number of outstandanding requests: this is\n+        \/\/ the number of CF returned by send\/sendAsync which\n+        \/\/ have not been completed.\n+        long getOutstandingHttpRequests();\n@@ -56,0 +60,2 @@\n+        \/\/ number of TCP connections still opened\n+        long getOutstandingTcpConnections();\n@@ -59,0 +65,2 @@\n+        \/\/ whether the Selector Manager thread is still running\n+        boolean isSelectorAlive();\n@@ -61,0 +69,1 @@\n+\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/common\/OperationTrackers.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -111,1 +111,1 @@\n-                = new HashMap<>(STATIC_TABLE_LENGTH);\n+                = HashMap.newHashMap(STATIC_TABLE_LENGTH);\n@@ -119,1 +119,1 @@\n-        Map<String, Map<String, Integer>> copy = new HashMap<>(map.size());\n+        Map<String, Map<String, Integer>> copy = HashMap.newHashMap(map.size());\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/hpack\/HeaderTable.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -93,3 +93,5 @@\n-                    GSSUtil.debug(\"Ignore \" + e + \" while acquring cred for \"\n-                        + mechs[i]);\n-                    \/\/e.printStackTrace();\n+                    if (GSSUtil.DEBUG) {\n+                        GSSUtil.debug(\"Ignore \" + e + \" while acquiring cred for \"\n+                                + mechs[i]);\n+                        \/\/ e.printStackTrace();\n+                    }\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/jgss\/GSSCredentialImpl.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,2 +91,4 @@\n-                GSSUtil.debug(\"Skip \" + mech +\n-                              \": error retrieving supported name types\");\n+                if (GSSUtil.DEBUG) {\n+                    GSSUtil.debug(\"Skip \" + mech +\n+                            \": error retrieving supported name types\");\n+                }\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/jgss\/GSSManagerImpl.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -206,4 +206,0 @@\n-    public static final void debug(String str) {\n-        System.err.print(str);\n-    }\n-\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/jgss\/GSSToken.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,4 +74,2 @@\n-        if (DEBUG) {\n-            assert(message != null);\n-            System.out.println(message);\n-        }\n+        assert(message != null);\n+        System.out.println(message);\n@@ -87,1 +85,3 @@\n-            debug(\"Ignored invalid OID: \" + oidStr);\n+            if (DEBUG) {\n+                debug(\"Ignored invalid OID: \" + oidStr);\n+            }\n@@ -141,1 +141,3 @@\n-                debug(\"Skipped name \" + name + \" due to \" + ge);\n+                if (DEBUG) {\n+                    debug(\"Skipped name \" + name + \" due to \" + ge);\n+                }\n@@ -152,4 +154,6 @@\n-        debug(\"Created Subject with the following\");\n-        debug(\"principals=\" + krb5Principals);\n-        debug(\"public creds=\" + pubCredentials);\n-        debug(\"private creds=\" + privCredentials);\n+        if (DEBUG) {\n+            debug(\"Created Subject with the following\");\n+            debug(\"principals=\" + krb5Principals);\n+            debug(\"public creds=\" + pubCredentials);\n+            debug(\"private creds=\" + privCredentials);\n+        }\n@@ -215,1 +219,3 @@\n-                debug(\"Skipped cred element: \" + cred);\n+                if (DEBUG) {\n+                    debug(\"Skipped cred element: \" + cred);\n+                }\n@@ -311,4 +317,6 @@\n-        debug(\"Search Subject for \" + getMechStr(mech) +\n-              (initiate? \" INIT\" : \" ACCEPT\") + \" cred (\" +\n-              (name == null? \"<<DEF>>\" : name.toString()) + \", \" +\n-              credCls.getName() + \")\");\n+        if (DEBUG) {\n+            debug(\"Search Subject for \" + getMechStr(mech) +\n+                    (initiate ? \" INIT\" : \" ACCEPT\") + \" cred (\" +\n+                    (name == null ? \"<<DEF>>\" : name.toString()) + \", \" +\n+                    credCls.getName() + \")\");\n+        }\n@@ -330,1 +338,3 @@\n-                                debug(\"...Found cred\" + cred);\n+                                if (DEBUG) {\n+                                    debug(\"...Found cred\" + cred);\n+                                }\n@@ -334,1 +344,3 @@\n-                                    debug(\"......Found element: \" + ce);\n+                                    if (DEBUG) {\n+                                        debug(\"......Found element: \" + ce);\n+                                    }\n@@ -340,1 +352,3 @@\n-                                        debug(\"......Discard element\");\n+                                        if (DEBUG) {\n+                                            debug(\"......Discard element\");\n+                                        }\n@@ -343,1 +357,3 @@\n-                                    debug(\"...Discard cred (\" + ge + \")\");\n+                                    if (DEBUG) {\n+                                        debug(\"...Discard cred (\" + ge + \")\");\n+                                    }\n@@ -346,1 +362,3 @@\n-                        } else debug(\"No Subject\");\n+                        } else if (DEBUG) {\n+                            debug(\"No Subject\");\n+                        }\n@@ -352,2 +370,4 @@\n-            debug(\"Unexpected exception when searching Subject:\");\n-            if (DEBUG) pae.printStackTrace();\n+            if (DEBUG) {\n+                debug(\"Unexpected exception when searching Subject:\");\n+                pae.printStackTrace();\n+            }\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/jgss\/GSSUtil.java","additions":43,"deletions":23,"binary":false,"changes":66,"status":"modified"},{"patch":"@@ -137,2 +137,4 @@\n-                GSSUtil.debug(\"Error in adding provider \" +\n-                              prov.getName() + \": \" + ge);\n+                if (GSSUtil.DEBUG) {\n+                    GSSUtil.debug(\"Error in adding provider \" +\n+                            prov.getName() + \": \" + ge);\n+                }\n@@ -424,2 +426,4 @@\n-                    GSSUtil.debug(\"Ignore the invalid property \" +\n-                                  prop + \" from provider \" + p.getName());\n+                    if (GSSUtil.DEBUG) {\n+                        GSSUtil.debug(\"Ignore the invalid property \" +\n+                                prop + \" from provider \" + p.getName());\n+                    }\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/jgss\/ProviderList.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import sun.security.action.GetBooleanAction;\n@@ -54,1 +55,3 @@\n-    static boolean DEBUG;\n+    private static final boolean DEBUG =\n+        GetBooleanAction.privilegedGetProperty(\"sun.security.nativegss.debug\");\n+\n@@ -56,5 +59,2 @@\n-        if (DEBUG) {\n-            if (message == null) {\n-                throw new NullPointerException();\n-            }\n-            System.out.println(NAME + \": \" + message);\n+        if (message == null) {\n+            throw new NullPointerException();\n@@ -62,0 +62,1 @@\n+        System.out.println(NAME + \": \" + message);\n@@ -69,2 +70,0 @@\n-                        DEBUG = Boolean.parseBoolean(\n-                            System.getProperty(\"sun.security.nativegss.debug\"));\n@@ -78,2 +77,4 @@\n-                            debug(\"No j2gss library found!\");\n-                            if (DEBUG) err.printStackTrace();\n+                            if (DEBUG) {\n+                                debug(\"No j2gss library found!\");\n+                                err.printStackTrace();\n+                            }\n@@ -110,1 +111,3 @@\n-                                debug(\"Loaded GSS library: \" + libName);\n+                                if (DEBUG) {\n+                                    debug(\"Loaded GSS library: \" + libName);\n+                                }\n@@ -114,1 +117,3 @@\n-                                    debug(\"Native MF for \" + mechs[i]);\n+                                    if (DEBUG) {\n+                                        debug(\"Native MF for \" + mechs[i]);\n+                                    }\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/jgss\/wrapper\/SunNativeProvider.java","additions":18,"deletions":13,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -343,4 +343,0 @@\n-    private static void debug(String message) {\n-        \/\/      System.err.println(\">>> KrbTgsReq: \" + message);\n-    }\n-\n@@ -350,1 +346,0 @@\n-\n","filename":"src\/java.security.jgss\/share\/classes\/sun\/security\/krb5\/KrbTgsReq.java","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -212,1 +212,1 @@\n-     * Constructor to specify the data type value from {@code Types) for\n+     * Constructor to specify the data type value from {@code Types} for\n@@ -214,1 +214,1 @@\n-     * @param type The value from {@code Types) for this data type\n+     * @param type The value from {@code Types} for this data type\n","filename":"src\/java.sql\/share\/classes\/java\/sql\/JDBCType.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -110,1 +110,1 @@\n-                    new HashMap<>(length);\n+                    new HashMap<>((int) Math.ceil(length \/ 0.75));\n","filename":"src\/java.xml.crypto\/share\/classes\/org\/jcp\/xml\/dsig\/internal\/dom\/DOMXPathFilter2Transform.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -78,1 +78,1 @@\n-                new HashMap<>(length);\n+                new HashMap<>((int) Math.ceil(length \/ 0.75));\n","filename":"src\/java.xml.crypto\/share\/classes\/org\/jcp\/xml\/dsig\/internal\/dom\/DOMXPathTransform.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,2 @@\n+import com.sun.org.apache.xalan.internal.xsltc.compiler.sym;\n+import java.util.Arrays;\n@@ -137,0 +139,2 @@\n+ *\n+ * @LastModified: Jan 2022\n@@ -140,0 +144,8 @@\n+    public static final int ID_GROUP = 1;\n+    public static final int ID_OPERATOR = 2;\n+    public static final int ID_TOTAL_OPERATOR = 3;\n+\n+    private boolean isLiteral = false;\n+    private int grpCount = 0;\n+    private int opCount = 0;\n+    private int totalOpCount = 0;\n@@ -358,2 +370,23 @@\n-  public Symbol scan() throws java.lang.Exception {\n-    return getScanner().next_token();\n+  public Symbol scan() throws Exception {\n+      Symbol s = getScanner().next_token();\n+\n+      if (s.sym == sym.LPAREN) {\n+          if (!isLiteral) {\n+            grpCount++;\n+          }\n+          opCount++; \/\/ function\n+          isLiteral = false;\n+      } else if (contains(sym.OPERATORS, s.sym)) {\n+          opCount++;\n+          isLiteral = false;\n+      }\n+\n+      if (s.sym == sym.Literal || s.sym == sym.QNAME) {\n+          isLiteral = true;\n+      }\n+\n+    return s;\n+  }\n+\n+  private boolean contains(final int[] arr, final int key) {\n+    return Arrays.stream(arr).anyMatch(i -> i == key);\n@@ -555,0 +588,3 @@\n+      isLiteral = false;\n+      grpCount = 0;\n+      opCount = 0;\n@@ -633,0 +669,2 @@\n+\n+      totalOpCount += opCount;\n@@ -636,0 +674,18 @@\n+    \/**\n+     * Returns the count of operators in XPath expressions.\n+     *\n+     * @param id the ID of the count\n+     * @return the count associated with the ID\n+     *\/\n+    public int getCount(int id) {\n+        switch (id) {\n+            case ID_GROUP:\n+                return grpCount;\n+            case ID_OPERATOR:\n+                return opCount;\n+            case ID_TOTAL_OPERATOR:\n+                return totalOpCount;\n+        }\n+        return 0;\n+    }\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/java_cup\/internal\/runtime\/lr_parser.java","additions":59,"deletions":3,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -1,480 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.  Oracle designates this\n- * particular file as subject to the \"Classpath\" exception as provided\n- * by Oracle in the LICENSE file that accompanied this code.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package com.sun.org.apache.xalan.internal.utils;\n-\n-import java.util.concurrent.CopyOnWriteArrayList;\n-import jdk.xml.internal.JdkConstants;\n-import jdk.xml.internal.JdkProperty.ImplPropMap;\n-import jdk.xml.internal.JdkProperty.State;\n-import jdk.xml.internal.SecuritySupport;\n-import org.xml.sax.SAXException;\n-\n-\n-\/**\n- * This class is not the same as that in Xerces. It is used to manage the\n- * state of corresponding Xerces properties and pass the values over to\n- * the Xerces Security Manager.\n- *\n- * @author Joe Wang Oracle Corp.\n- *\n- *\/\n-public final class XMLSecurityManager {\n-\n-    \/**\n-     * Limits managed by the security manager\n-     *\/\n-    @SuppressWarnings(\"deprecation\")\n-    public static enum Limit {\n-\n-        ENTITY_EXPANSION_LIMIT(\"EntityExpansionLimit\", JdkConstants.JDK_ENTITY_EXPANSION_LIMIT,\n-                JdkConstants.SP_ENTITY_EXPANSION_LIMIT, 0, 64000),\n-        MAX_OCCUR_NODE_LIMIT(\"MaxOccurLimit\", JdkConstants.JDK_MAX_OCCUR_LIMIT,\n-                JdkConstants.SP_MAX_OCCUR_LIMIT, 0, 5000),\n-        ELEMENT_ATTRIBUTE_LIMIT(\"ElementAttributeLimit\", JdkConstants.JDK_ELEMENT_ATTRIBUTE_LIMIT,\n-                JdkConstants.SP_ELEMENT_ATTRIBUTE_LIMIT, 0, 10000),\n-        TOTAL_ENTITY_SIZE_LIMIT(\"TotalEntitySizeLimit\", JdkConstants.JDK_TOTAL_ENTITY_SIZE_LIMIT,\n-                JdkConstants.SP_TOTAL_ENTITY_SIZE_LIMIT, 0, 50000000),\n-        GENERAL_ENTITY_SIZE_LIMIT(\"MaxEntitySizeLimit\", JdkConstants.JDK_GENERAL_ENTITY_SIZE_LIMIT,\n-                JdkConstants.SP_GENERAL_ENTITY_SIZE_LIMIT, 0, 0),\n-        PARAMETER_ENTITY_SIZE_LIMIT(\"MaxEntitySizeLimit\", JdkConstants.JDK_PARAMETER_ENTITY_SIZE_LIMIT,\n-                JdkConstants.SP_PARAMETER_ENTITY_SIZE_LIMIT, 0, 1000000),\n-        MAX_ELEMENT_DEPTH_LIMIT(\"MaxElementDepthLimit\", JdkConstants.JDK_MAX_ELEMENT_DEPTH,\n-                JdkConstants.SP_MAX_ELEMENT_DEPTH, 0, 0),\n-        MAX_NAME_LIMIT(\"MaxXMLNameLimit\", JdkConstants.JDK_XML_NAME_LIMIT,\n-                JdkConstants.SP_XML_NAME_LIMIT, 1000, 1000),\n-        ENTITY_REPLACEMENT_LIMIT(\"EntityReplacementLimit\", JdkConstants.JDK_ENTITY_REPLACEMENT_LIMIT,\n-                JdkConstants.SP_ENTITY_REPLACEMENT_LIMIT, 0, 3000000);\n-\n-        final String key;\n-        final String apiProperty;\n-        final String systemProperty;\n-        final int defaultValue;\n-        final int secureValue;\n-\n-        Limit(String key, String apiProperty, String systemProperty, int value, int secureValue) {\n-            this.key = key;\n-            this.apiProperty = apiProperty;\n-            this.systemProperty = systemProperty;\n-            this.defaultValue = value;\n-            this.secureValue = secureValue;\n-        }\n-\n-        \/**\n-         * Checks whether the specified name is a limit. Checks both the\n-         * property and System Property which is now the new property name.\n-         *\n-         * @param name the specified name\n-         * @return true if there is a match, false otherwise\n-         *\/\n-        public boolean is(String name) {\n-            \/\/ current spec: new property name == systemProperty\n-            return (systemProperty != null && systemProperty.equals(name)) ||\n-                   \/\/ current spec: apiProperty is legacy\n-                   (apiProperty.equals(name));\n-        }\n-\n-        \/**\n-         * Returns the state of a property name. By the specification as of JDK 17,\n-         * the \"jdk.xml.\" prefixed System property name is also the current API\n-         * name. The URI-based qName is legacy.\n-         *\n-         * @param name the property name\n-         * @return the state of the property name, null if no match\n-         *\/\n-        public State getState(String name) {\n-            if (systemProperty != null && systemProperty.equals(name)) {\n-                return State.APIPROPERTY;\n-            } else if (apiProperty.equals(name)) {\n-                \/\/the URI-style qName is legacy\n-                return State.LEGACY_APIPROPERTY;\n-            }\n-            return null;\n-        }\n-\n-        public String key() {\n-            return key;\n-        }\n-\n-        public String apiProperty() {\n-            return apiProperty;\n-        }\n-\n-        public String systemProperty() {\n-            return systemProperty;\n-        }\n-\n-        public int defaultValue() {\n-            return defaultValue;\n-        }\n-\n-        int secureValue() {\n-            return secureValue;\n-        }\n-    }\n-\n-    \/**\n-     * Map old property names with the new ones\n-     *\/\n-    public static enum NameMap {\n-\n-        ENTITY_EXPANSION_LIMIT(JdkConstants.SP_ENTITY_EXPANSION_LIMIT,\n-                JdkConstants.ENTITY_EXPANSION_LIMIT),\n-        MAX_OCCUR_NODE_LIMIT(JdkConstants.SP_MAX_OCCUR_LIMIT,\n-                JdkConstants.MAX_OCCUR_LIMIT),\n-        ELEMENT_ATTRIBUTE_LIMIT(JdkConstants.SP_ELEMENT_ATTRIBUTE_LIMIT,\n-                JdkConstants.ELEMENT_ATTRIBUTE_LIMIT);\n-        final String newName;\n-        final String oldName;\n-\n-        NameMap(String newName, String oldName) {\n-            this.newName = newName;\n-            this.oldName = oldName;\n-        }\n-\n-        String getOldName(String newName) {\n-            if (newName.equals(this.newName)) {\n-                return oldName;\n-            }\n-            return null;\n-        }\n-    }\n-    \/**\n-     * Values of the properties\n-     *\/\n-    private final int[] values;\n-    \/**\n-     * States of the settings for each property\n-     *\/\n-    private State[] states;\n-    \/**\n-     * States that determine if properties are set explicitly\n-     *\/\n-    private boolean[] isSet;\n-\n-\n-    \/**\n-     * Index of the special entityCountInfo property\n-     *\/\n-    private final int indexEntityCountInfo = 10000;\n-    private String printEntityCountInfo = \"\";\n-\n-    \/**\n-     * Default constructor. Establishes default values for known security\n-     * vulnerabilities.\n-     *\/\n-    public XMLSecurityManager() {\n-        this(false);\n-    }\n-\n-    \/**\n-     * Instantiate Security Manager in accordance with the status of\n-     * secure processing\n-     * @param secureProcessing\n-     *\/\n-    public XMLSecurityManager(boolean secureProcessing) {\n-        values = new int[Limit.values().length];\n-        states = new State[Limit.values().length];\n-        isSet = new boolean[Limit.values().length];\n-        for (Limit limit : Limit.values()) {\n-            if (secureProcessing) {\n-                values[limit.ordinal()] = limit.secureValue();\n-                states[limit.ordinal()] = State.FSP;\n-            } else {\n-                values[limit.ordinal()] = limit.defaultValue();\n-                states[limit.ordinal()] = State.DEFAULT;\n-            }\n-        }\n-        \/\/read system properties or jaxp.properties\n-        readSystemProperties();\n-    }\n-\n-    \/**\n-     * Setting FEATURE_SECURE_PROCESSING explicitly\n-     *\/\n-    public void setSecureProcessing(boolean secure) {\n-        for (Limit limit : Limit.values()) {\n-            if (secure) {\n-                setLimit(limit.ordinal(), State.FSP, limit.secureValue());\n-            } else {\n-                setLimit(limit.ordinal(), State.FSP, limit.defaultValue());\n-            }\n-        }\n-    }\n-\n-    \/**\n-     * Set limit by property name and state\n-     * @param propertyName property name\n-     * @param state the state of the property\n-     * @param value the value of the property\n-     * @return true if the property is managed by the security manager; false\n-     *              if otherwise.\n-     *\/\n-    public boolean setLimit(String propertyName, State state, Object value) {\n-        int index = getIndex(propertyName);\n-        if (index > -1) {\n-            State pState = state;\n-            if (index != indexEntityCountInfo && state == State.APIPROPERTY) {\n-                pState = (Limit.values()[index]).getState(propertyName);\n-            }\n-            setLimit(index, pState, value);\n-            return true;\n-        }\n-        return false;\n-    }\n-\n-    \/**\n-     * Set the value for a specific limit.\n-     *\n-     * @param limit the limit\n-     * @param state the state of the property\n-     * @param value the value of the property\n-     *\/\n-    public void setLimit(Limit limit, State state, int value) {\n-        setLimit(limit.ordinal(), state, value);\n-    }\n-\n-    \/**\n-     * Set the value of a property by its index\n-     *\n-     * @param index the index of the property\n-     * @param state the state of the property\n-     * @param value the value of the property\n-     *\/\n-    public void setLimit(int index, State state, Object value) {\n-        if (index == indexEntityCountInfo) {\n-            \/\/if it's explicitly set, it's treated as yes no matter the value\n-            printEntityCountInfo = (String)value;\n-        } else {\n-            int temp;\n-            if (value instanceof Integer) {\n-                temp = (Integer)value;\n-            } else {\n-                temp = Integer.parseInt((String) value);\n-                if (temp < 0) {\n-                    temp = 0;\n-                }\n-            }\n-            setLimit(index, state, temp);\n-        }\n-    }\n-\n-    \/**\n-     * Set the value of a property by its index\n-     *\n-     * @param index the index of the property\n-     * @param state the state of the property\n-     * @param value the value of the property\n-     *\/\n-    public void setLimit(int index, State state, int value) {\n-        if (index == indexEntityCountInfo) {\n-            \/\/if it's explicitly set, it's treated as yes no matter the value\n-            printEntityCountInfo = JdkConstants.JDK_YES;\n-        } else {\n-            \/\/only update if it shall override\n-            if (state.compareTo(states[index]) >= 0) {\n-                values[index] = value;\n-                states[index] = state;\n-                isSet[index] = true;\n-            }\n-        }\n-    }\n-\n-\n-    \/**\n-     * Return the value of the specified property.\n-     *\n-     * @param propertyName the property name\n-     * @return the value of the property as a string. If a property is managed\n-     * by this manager, its value shall not be null.\n-     *\/\n-    public String getLimitAsString(String propertyName) {\n-        int index = getIndex(propertyName);\n-        if (index > -1) {\n-            return getLimitValueByIndex(index);\n-        }\n-\n-        return null;\n-    }\n-\n-    \/**\n-     * Return the value of a property by its ordinal\n-     *\n-     * @param limit the property\n-     * @return value of a property\n-     *\/\n-    public String getLimitValueAsString(Limit limit) {\n-        return Integer.toString(values[limit.ordinal()]);\n-    }\n-\n-    \/**\n-     * Return the value of the specified property\n-     *\n-     * @param limit the property\n-     * @return the value of the property\n-     *\/\n-    public int getLimit(Limit limit) {\n-        return values[limit.ordinal()];\n-    }\n-\n-    \/**\n-     * Return the value of a property by its ordinal\n-     *\n-     * @param index the index of a property\n-     * @return value of a property\n-     *\/\n-    public int getLimitByIndex(int index) {\n-        return values[index];\n-    }\n-    \/**\n-     * Return the value of a property by its index\n-     *\n-     * @param index the index of a property\n-     * @return limit of a property as a string\n-     *\/\n-    public String getLimitValueByIndex(int index) {\n-        if (index == indexEntityCountInfo) {\n-            return printEntityCountInfo;\n-        }\n-\n-        return Integer.toString(values[index]);\n-    }\n-    \/**\n-     * Return the state of the limit property\n-     *\n-     * @param limit the limit\n-     * @return the state of the limit property\n-     *\/\n-    public State getState(Limit limit) {\n-        return states[limit.ordinal()];\n-    }\n-\n-    \/**\n-     * Return the state of the limit property\n-     *\n-     * @param limit the limit\n-     * @return the state of the limit property\n-     *\/\n-    public String getStateLiteral(Limit limit) {\n-        return states[limit.ordinal()].literal();\n-    }\n-\n-    \/**\n-     * Get the index by property name\n-     *\n-     * @param propertyName property name\n-     * @return the index of the property if found; return -1 if not\n-     *\/\n-    public int getIndex(String propertyName) {\n-        for (Limit limit : Limit.values()) {\n-            \/\/ see JDK-8265248, accept both the URL and jdk.xml as prefix\n-            if (limit.is(propertyName)) {\n-                \/\/internally, ordinal is used as index\n-                return limit.ordinal();\n-            }\n-        }\n-        \/\/special property to return entity count info\n-        if (ImplPropMap.ENTITYCOUNT.is(propertyName)) {\n-            return indexEntityCountInfo;\n-        }\n-        return -1;\n-    }\n-\n-    \/**\n-     * Indicate if a property is set explicitly\n-     * @param index\n-     * @return\n-     *\/\n-    public boolean isSet(int index) {\n-        return isSet[index];\n-    }\n-\n-    public boolean printEntityCountInfo() {\n-        return printEntityCountInfo.equals(JdkConstants.JDK_YES);\n-    }\n-    \/**\n-     * Read from system properties, or those in jaxp.properties\n-     *\/\n-    private void readSystemProperties() {\n-\n-        for (Limit limit : Limit.values()) {\n-            if (!getSystemProperty(limit, limit.systemProperty())) {\n-                \/\/if system property is not found, try the older form if any\n-                for (NameMap nameMap : NameMap.values()) {\n-                    String oldName = nameMap.getOldName(limit.systemProperty());\n-                    if (oldName != null) {\n-                        getSystemProperty(limit, oldName);\n-                    }\n-                }\n-            }\n-        }\n-\n-    }\n-\n-    \/\/ Array list to store printed warnings for each SAX parser used\n-    private static final CopyOnWriteArrayList<String> printedWarnings = new CopyOnWriteArrayList<>();\n-\n-    \/**\n-     * Prints out warnings if a parser does not support the specified feature\/property.\n-     *\n-     * @param parserClassName the name of the parser class\n-     * @param propertyName the property name\n-     * @param exception the exception thrown by the parser\n-     *\/\n-    public static void printWarning(String parserClassName, String propertyName, SAXException exception) {\n-        String key = parserClassName+\":\"+propertyName;\n-        if (printedWarnings.addIfAbsent(key)) {\n-            System.err.println( \"Warning: \"+parserClassName+\": \"+exception.getMessage());\n-        }\n-    }\n-\n-    \/**\n-     * Read from system properties, or those in jaxp.properties\n-     *\n-     * @param property the type of the property\n-     * @param sysPropertyName the name of system property\n-     *\/\n-    private boolean getSystemProperty(Limit limit, String sysPropertyName) {\n-        try {\n-            String value = SecuritySupport.getSystemProperty(sysPropertyName);\n-            if (value != null && !value.equals(\"\")) {\n-                values[limit.ordinal()] = Integer.parseInt(value);\n-                states[limit.ordinal()] = State.SYSTEMPROPERTY;\n-                return true;\n-            }\n-\n-            value = SecuritySupport.readJAXPProperty(sysPropertyName);\n-            if (value != null && !value.equals(\"\")) {\n-                values[limit.ordinal()] = Integer.parseInt(value);\n-                states[limit.ordinal()] = State.JAXPDOTPROPERTIES;\n-                return true;\n-            }\n-        } catch (NumberFormatException e) {\n-            \/\/invalid setting\n-            throw new NumberFormatException(\"Invalid setting for system property: \" + limit.systemProperty());\n-        }\n-        return false;\n-    }\n-}\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/utils\/XMLSecurityManager.java","additions":0,"deletions":480,"binary":false,"changes":480,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -49,0 +48,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -65,1 +65,1 @@\n- * @LastModified: May 2021\n+ * @LastModified: Jan 2022\n@@ -507,2 +507,4 @@\n-                    lastProperty = limit.apiProperty();\n-                    reader.setProperty(lastProperty, securityManager.getLimitValueAsString(limit));\n+                    if (limit.isSupported(XMLSecurityManager.Processor.PARSER)) {\n+                        lastProperty = limit.apiProperty();\n+                        reader.setProperty(lastProperty, securityManager.getLimitValueAsString(limit));\n+                    }\n@@ -1172,0 +1174,3 @@\n+            if (ErrorMsg.XPATH_LIMIT.equals(e.getMessage())) {\n+                throw new RuntimeException(ErrorMsg.XPATH_LIMIT);\n+            }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/Parser.java","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,0 +37,4 @@\n+import jdk.xml.internal.JdkConstants;\n+import jdk.xml.internal.XMLLimitAnalyzer;\n+import jdk.xml.internal.XMLSecurityManager;\n+import jdk.xml.internal.XMLSecurityManager.Limit;\n@@ -42,1 +46,1 @@\n- * @LastModified: Nov 2019\n+ * @LastModified: Jan 2022\n@@ -45,0 +49,3 @@\n+    private int grpLimit = 0;\n+    private int opLimit = 0;\n+    private int totalOpLimit = 0;\n@@ -956,0 +963,3 @@\n+    private XMLSecurityManager _xmlSM;\n+    private XMLLimitAnalyzer _limitAnalyzer = null;\n+\n@@ -960,0 +970,6 @@\n+        _xmlSM = (XMLSecurityManager)_xsltc.getProperty(JdkConstants.SECURITY_MANAGER);\n+        _limitAnalyzer = new XMLLimitAnalyzer();\n+        \/\/ no limits if _xmlSM is null\n+        grpLimit = (_xmlSM != null) ? _xmlSM.getLimit(Limit.XPATH_GROUP_LIMIT) : 0;\n+        opLimit = (_xmlSM != null) ? _xmlSM.getLimit(Limit.XPATH_OP_LIMIT) : 0;\n+        totalOpLimit = (_xmlSM != null) ? _xmlSM.getLimit(Limit.XPATH_TOTALOP_LIMIT) : 0;\n@@ -1104,1 +1120,26 @@\n-            return super.parse();\n+            Symbol s = super.parse();\n+            int grpCount = getCount(ID_GROUP);\n+            int opCount = getCount(ID_OPERATOR);\n+            int totalOpCount = getCount(ID_TOTAL_OPERATOR);\n+\n+            String errCode = null;\n+            Object[] params = null;\n+            if (grpLimit > 0 && grpCount > grpLimit) {\n+                errCode = ErrorMsg.XPATH_GROUP_LIMIT;\n+                params = new Object[]{grpCount, grpLimit,\n+                    _xmlSM.getStateLiteral(Limit.XPATH_GROUP_LIMIT)};\n+            } else if (opLimit > 0 && opCount > opLimit) {\n+                errCode = ErrorMsg.XPATH_OPERATOR_LIMIT;\n+                params = new Object[]{opCount, opLimit,\n+                    _xmlSM.getStateLiteral(Limit.XPATH_OP_LIMIT)};\n+            } else if (totalOpLimit > 0 && totalOpCount > totalOpLimit) {\n+                errCode = ErrorMsg.XPATH_TOTAL_OPERATOR_LIMIT;\n+                params = new Object[]{totalOpCount, totalOpLimit,\n+                    _xmlSM.getStateLiteral(Limit.XPATH_TOTALOP_LIMIT)};\n+            }\n+            if (errCode != null) {\n+                _parser.reportError(Constants.FATAL,\n+                        new ErrorMsg(errCode, lineNumber, params));\n+                throw new RuntimeException(ErrorMsg.XPATH_LIMIT);\n+            }\n+            return s;\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/XPathParser.java","additions":44,"deletions":3,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -50,1 +49,0 @@\n-import jdk.xml.internal.JdkXmlUtils;\n@@ -52,0 +50,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -61,1 +60,1 @@\n- * @LastModified: Nov 2021\n+ * @LastModified: Jan 2022\n@@ -511,1 +510,4 @@\n-            \/*if (_debug)*\/ e.printStackTrace();\n+            if (_debug) e.printStackTrace();\n+            if (ErrorMsg.XPATH_LIMIT.equals(e.getMessage())) {\n+                return !_parser.errorsFound();\n+            }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/XSLTC.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.util.Arrays;\n+\n@@ -31,0 +33,2 @@\n+ *\n+ * @LastModified: Jan 2022\n@@ -88,0 +92,8 @@\n+  \/*\n+    AXES: count once at DCOLON,\n+          these axes names are therefore not counted:\n+            NAMESPACE, FOLLOWINGSIBLING, CHILD, DESCENDANTORSELF, DESCENDANT\n+          , PRECEDINGSIBLING, SELF, ANCESTORORSELF, PRECEDING, ANCESTOROR, PARENT, FOLLOWING, ATTRIBUTE\n+  *\/\n+  public static final int[] OPERATORS = {GE, SLASH, ATSIGN, LPAREN, DCOLON,\n+      MINUS, STAR, LT, OR, DIV, PLUS, LE, VBAR, MOD, EQ, LBRACK, DOLLAR, NE, GT};\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/sym.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+ * @LastModified: Jan 2022\n@@ -1030,6 +1031,16 @@\n-         {ErrorMsg.DESERIALIZE_TRANSLET_ERR, \"When Java security is enabled, \" +\n-                        \"support for deserializing TemplatesImpl is disabled.\" +\n-                        \"This can be overridden by setting the jdk.xml.enableTemplatesImplDeserialization\" +\n-                        \" system property to true.\"}\n-\n-    };\n+        {ErrorMsg.DESERIALIZE_TRANSLET_ERR, \"When Java security is enabled, \"\n+              + \"support for deserializing TemplatesImpl is disabled. This can be \"\n+              + \"overridden by setting the jdk.xml.enableTemplatesImplDeserialization\"\n+              + \" system property to true.\"},\n+\n+        {ErrorMsg.XPATH_GROUP_LIMIT,\n+            \"JAXP0801001: the compiler encountered an XPath expression containing \"\n+              + \"''{0}'' groups that exceeds the ''{1}'' limit set by ''{2}''.\"},\n+\n+        {ErrorMsg.XPATH_OPERATOR_LIMIT,\n+            \"JAXP0801002: the compiler encountered an XPath expression containing \"\n+              + \"''{0}'' operators that exceeds the ''{1}'' limit set by ''{2}''.\"},\n+        {ErrorMsg.XPATH_TOTAL_OPERATOR_LIMIT,\n+            \"JAXP0801003: the compiler encountered XPath expressions with an accumulated \"\n+              + \"''{0}'' operators that exceeds the ''{1}'' limit set by ''{2}''.\"},\n+      };\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/util\/ErrorMessages.java","additions":18,"deletions":7,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,1 +36,1 @@\n- * @LastModified: Sep 2017\n+ * @LastModified: Jan 2022\n@@ -174,0 +174,5 @@\n+    public static final String XPATH_LIMIT = \"XPATH_LIMIT\";\n+    public static final String XPATH_GROUP_LIMIT = \"XPATH_GROUP_LIMIT\";\n+    public static final String XPATH_OPERATOR_LIMIT = \"XPATH_OPERATOR_LIMIT\";\n+    public static final String XPATH_TOTAL_OPERATOR_LIMIT = \"XPATH_TOTAL_OPERATOR_LIMIT\";\n+\n@@ -210,1 +215,5 @@\n-        _params = new Object[] { param };\n+        if (param instanceof Object[]) {\n+            _params = (Object[])param;\n+        } else {\n+            _params = new Object[] { param };\n+        }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/util\/ErrorMsg.java","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,0 +53,1 @@\n+ * @LastModified: Apr 2022\n@@ -171,1 +172,1 @@\n-        _references = new HashMap<>(_size+2);\n+        _references = HashMap.newHashMap(_size);\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/dom\/DocumentCache.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,0 +24,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -26,1 +27,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -91,1 +91,1 @@\n- * @LastModified: May 2021\n+ * @LastModified: Jan 2022\n@@ -289,1 +289,2 @@\n-        _extensionClassLoader = new JdkProperty<>(ImplPropMap.EXTCLSLOADER, null, State.DEFAULT);\n+        _extensionClassLoader = new JdkProperty<>(ImplPropMap.EXTCLSLOADER,\n+                ClassLoader.class, null, State.DEFAULT);\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/trax\/TransformerFactoryImpl.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,1 +23,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -92,0 +91,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -104,1 +104,1 @@\n- * @LastModified: Sept 2021\n+ * @LastModified: Jan 2022\n@@ -291,2 +291,0 @@\n-        String isStandalone = SecuritySupport.getJAXPSystemProperty(\n-                String.class, SP_XSLTC_IS_STANDALONE, \"no\");\n@@ -294,1 +292,1 @@\n-                isStandalone, State.DEFAULT);\n+                String.class, \"no\", State.DEFAULT);\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/trax\/TransformerImpl.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,1 +23,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -42,0 +41,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -54,1 +54,1 @@\n- * @LastModified: May 2021\n+ * @LastModified: Jan 2022\n@@ -116,3 +116,5 @@\n-                                lastProperty = limit.apiProperty();\n-                                reader.setProperty(lastProperty,\n-                                        securityManager.getLimitValueAsString(limit));\n+                                if (limit.isSupported(XMLSecurityManager.Processor.PARSER)) {\n+                                    lastProperty = limit.apiProperty();\n+                                    reader.setProperty(lastProperty,\n+                                            securityManager.getLimitValueAsString(limit));\n+                                }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/trax\/Util.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -86,1 +86,1 @@\n- * @LastModified: Sept 2019\n+ * @LastModified: Apr 2022\n@@ -396,1 +396,1 @@\n-                reversedIdentifiers = new HashMap<>(identifiers.size());\n+                reversedIdentifiers = HashMap.newHashMap(identifiers.size());\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/dom\/CoreDocumentImpl.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,1 @@\n- * @LastModified: Nov 2017\n+ * @LastModified: Apr 2022\n@@ -1819,1 +1819,1 @@\n-        items = new HashMap<>(size*2+1);\n+        items = HashMap.newHashMap(size);\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/impl\/xs\/traversers\/XSAttributeChecker.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -59,0 +59,1 @@\n+import jdk.xml.internal.JdkXmlUtils;\n@@ -87,1 +88,1 @@\n- * @LastModified: Jan 2019\n+ * @LastModified: July 2021\n@@ -2044,11 +2045,2 @@\n-            fInternalSubset.append (' ');\n-            if (publicId != null) {\n-                fInternalSubset.append (\"PUBLIC '\");\n-                fInternalSubset.append (publicId);\n-                fInternalSubset.append (\"' '\");\n-            }\n-            else {\n-                fInternalSubset.append (\"SYSTEM '\");\n-            }\n-            fInternalSubset.append (literalSystemId);\n-            fInternalSubset.append (\"'>\\n\");\n+            fInternalSubset.append (JdkXmlUtils.getDTDExternalDecl(publicId, literalSystemId));\n+            fInternalSubset.append (\">\\n\");\n@@ -2184,14 +2176,2 @@\n-            fInternalSubset.append (' ');\n-            if (publicId != null) {\n-                fInternalSubset.append (\"PUBLIC '\");\n-                fInternalSubset.append (publicId);\n-                if (literalSystemId != null) {\n-                    fInternalSubset.append (\"' '\");\n-                    fInternalSubset.append (literalSystemId);\n-                }\n-            }\n-            else {\n-                fInternalSubset.append (\"SYSTEM '\");\n-                fInternalSubset.append (literalSystemId);\n-            }\n-            fInternalSubset.append (\"' NDATA \");\n+            fInternalSubset.append (JdkXmlUtils.getDTDExternalDecl(publicId, literalSystemId));\n+            fInternalSubset.append (\" NDATA \");\n@@ -2264,13 +2244,2 @@\n-            if (publicId != null) {\n-                fInternalSubset.append (\" PUBLIC '\");\n-                fInternalSubset.append (publicId);\n-                if (literalSystemId != null) {\n-                    fInternalSubset.append (\"' '\");\n-                    fInternalSubset.append (literalSystemId);\n-                }\n-            }\n-            else {\n-                fInternalSubset.append (\" SYSTEM '\");\n-                fInternalSubset.append (literalSystemId);\n-            }\n-            fInternalSubset.append (\"'>\\n\");\n+            fInternalSubset.append (JdkXmlUtils.getDTDExternalDecl(publicId, literalSystemId));\n+            fInternalSubset.append (\">\\n\");\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xerces\/internal\/parsers\/AbstractDOMParser.java","additions":9,"deletions":40,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import jdk.xml.internal.JdkXmlUtils;\n@@ -44,1 +45,1 @@\n- * @LastModified: June 2021\n+ * @LastModified: July 2021\n@@ -682,22 +683,4 @@\n-                writer.write(\"<!DOCTYPE html\");\n-\n-                if (null != doctypePublic)\n-                {\n-                    writer.write(\" PUBLIC \\\"\");\n-                    writer.write(doctypePublic);\n-                    writer.write('\"');\n-                }\n-\n-                if (null != doctypeSystem)\n-                {\n-                    if (null == doctypePublic)\n-                        writer.write(\" SYSTEM \\\"\");\n-                    else\n-                        writer.write(\" \\\"\");\n-\n-                    writer.write(doctypeSystem);\n-                    writer.write('\"');\n-                }\n-\n-                writer.write('>');\n-                outputLineSep();\n+                    writer.write(\"<!DOCTYPE html\");\n+                    writer.write(JdkXmlUtils.getDTDExternalDecl(doctypePublic, doctypeSystem));\n+                    writer.write('>');\n+                    outputLineSep();\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/ToHTMLStream.java","additions":6,"deletions":23,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -899,10 +899,2 @@\n-            if (publicId != null) {\n-                m_writer.write(\" PUBLIC \\\"\");\n-                m_writer.write(publicId);\n-\n-            }\n-            else {\n-                m_writer.write(\" SYSTEM \\\"\");\n-                m_writer.write(systemId);\n-            }\n-            m_writer.write(\"\\\" >\");\n+            m_writer.write(JdkXmlUtils.getDTDExternalDecl(publicId, systemId));\n+            m_writer.write(\">\");\n@@ -1977,0 +1969,2 @@\n+            String systemId = getDoctypeSystem();\n+            writer.write(JdkXmlUtils.getDTDExternalDecl(getDoctypePublic(), systemId));\n@@ -1978,2 +1972,1 @@\n-            String doctypePublic = getDoctypePublic();\n-            if (null != doctypePublic)\n+            if (null != systemId)\n@@ -1981,17 +1974,0 @@\n-                writer.write(\" PUBLIC \\\"\");\n-                writer.write(doctypePublic);\n-                writer.write('\\\"');\n-            }\n-\n-            String doctypeSystem = getDoctypeSystem();\n-            if (null != doctypeSystem)\n-            {\n-                char quote = JdkXmlUtils.getQuoteChar(doctypeSystem);\n-                if (null == doctypePublic) {\n-                    writer.write(\" SYSTEM\");\n-                }\n-                writer.write(\" \");\n-                writer.write(quote);\n-\n-                writer.write(doctypeSystem);\n-                writer.write(quote);\n@@ -2005,11 +1981,0 @@\n-            boolean dothis = false;\n-            if (dothis)\n-            {\n-                \/\/ at one point this code seemed right,\n-                \/\/ but not anymore - Brian M.\n-                if (closeDecl)\n-                {\n-                    writer.write('>');\n-                    writer.write(m_lineSep, 0, m_lineSepLen);\n-                }\n-            }\n@@ -3580,10 +3545,2 @@\n-            if (pubID != null) {\n-                m_writer.write(\" PUBLIC \\\"\");\n-                m_writer.write(pubID);\n-\n-            }\n-            else {\n-                m_writer.write(\" SYSTEM \\\"\");\n-                m_writer.write(sysID);\n-            }\n-            m_writer.write(\"\\\" >\");\n+            m_writer.write(JdkXmlUtils.getDTDExternalDecl(pubID, sysID));\n+            m_writer.write(\">\");\n@@ -3610,10 +3567,2 @@\n-            if (pubID != null) {\n-                m_writer.write(\" PUBLIC \\\"\");\n-                m_writer.write(pubID);\n-\n-            }\n-            else {\n-                m_writer.write(\" SYSTEM \\\"\");\n-                m_writer.write(sysID);\n-            }\n-            m_writer.write(\"\\\" NDATA \");\n+            m_writer.write(JdkXmlUtils.getDTDExternalDecl(pubID, sysID));\n+            m_writer.write(\" NDATA \");\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/ToStream.java","additions":9,"deletions":60,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -66,1 +66,1 @@\n- * @LastModified: Apr 2021\n+ * @LastModified: July 2021\n@@ -509,17 +509,1 @@\n-                    if (null != publicId) {\n-                        dtd.append(\" PUBLIC \\\"\");\n-                        dtd.append(publicId);\n-                        dtd.append('\\\"');\n-                    }\n-\n-                    if (null != systemId) {\n-                        char quote = JdkXmlUtils.getQuoteChar(systemId);\n-                        if (null == publicId) {\n-                            dtd.append(\" SYSTEM \").append(quote);\n-                        } else {\n-                            dtd.append(\" \").append(quote);\n-                        }\n-                        dtd.append(systemId);\n-                        dtd.append(quote);\n-                    }\n-\n+                    dtd.append(JdkXmlUtils.getDTDExternalDecl(publicId, systemId));\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/dom3\/DOM3TreeWalker.java","additions":2,"deletions":18,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,1 +73,1 @@\n- * @LastModified: May 2021\n+ * @LastModified: Jan 2022\n@@ -367,5 +367,2 @@\n-        \/\/ JDK specific property isStandalone\n-        boolean isStandalone = SecuritySupport.getJAXPSystemProperty(\n-                Boolean.class, JdkConstants.SP_IS_STANDALONE, \"false\");\n-\n-        fIsStandalone = new JdkProperty<>(ImplPropMap.ISSTANDALONE, isStandalone, State.DEFAULT);\n+        \/\/ JDK specific property isStandalone, the default value is false\n+        fIsStandalone = new JdkProperty<>(ImplPropMap.ISSTANDALONE, Boolean.class, false, State.DEFAULT);\n@@ -373,1 +370,1 @@\n-        if (isStandalone) {\n+        if (fIsStandalone.getValue()) {\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/dom3\/LSSerializerImpl.java","additions":5,"deletions":8,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,1 +23,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -31,0 +30,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -40,1 +40,1 @@\n- * @LastModified: May 2021\n+ * @LastModified: Jan 2022\n@@ -146,3 +146,5 @@\n-                    lastProperty = limit.apiProperty();\n-                    reader.setProperty(lastProperty,\n-                            _xmlSecurityManager.getLimitValueAsString(limit));\n+                    if (limit.isSupported(XMLSecurityManager.Processor.PARSER)) {\n+                        lastProperty = limit.apiProperty();\n+                        reader.setProperty(lastProperty,\n+                                _xmlSecurityManager.getLimitValueAsString(limit));\n+                    }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/utils\/XMLReaderManager.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +25,1 @@\n+import com.sun.org.apache.xml.internal.utils.DefaultErrorHandler;\n@@ -38,0 +39,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -43,1 +45,1 @@\n- * @LastModified: May 2019\n+ * @LastModified: Jan 2022\n@@ -163,4 +165,3 @@\n-  public XPath(\n-          String exprString, SourceLocator locator, PrefixResolver prefixResolver, int type,\n-          ErrorListener errorListener)\n-            throws javax.xml.transform.TransformerException\n+  public XPath(String exprString, SourceLocator locator, PrefixResolver prefixResolver,\n+          int type, ErrorListener errorListener)\n+            throws TransformerException\n@@ -168,29 +169,1 @@\n-    initFunctionTable();\n-    if(null == errorListener)\n-      errorListener = new com.sun.org.apache.xml.internal.utils.DefaultErrorHandler();\n-\n-    m_patternString = exprString;\n-\n-    XPathParser parser = new XPathParser(errorListener, locator);\n-    Compiler compiler = new Compiler(errorListener, locator, m_funcTable);\n-\n-    if (SELECT == type)\n-      parser.initXPath(compiler, exprString, prefixResolver);\n-    else if (MATCH == type)\n-      parser.initMatchPattern(compiler, exprString, prefixResolver);\n-    else\n-      throw new RuntimeException(XSLMessages.createXPATHMessage(\n-              XPATHErrorResources.ER_CANNOT_DEAL_XPATH_TYPE,\n-              new Object[]{Integer.toString(type)}));\n-\n-    \/\/ System.out.println(\"----------------\");\n-    Expression expr = compiler.compileExpression(0);\n-\n-    \/\/ System.out.println(\"expr: \"+expr);\n-    this.setExpression(expr);\n-\n-    if((null != locator) && locator instanceof ExpressionNode)\n-    {\n-        expr.exprSetParent((ExpressionNode)locator);\n-    }\n-\n+    this(exprString, locator, prefixResolver, type, errorListener, null);\n@@ -210,0 +183,2 @@\n+   * @param funcTable the function table\n+   * @param xmlSecMgr the XML security manager\n@@ -213,5 +188,4 @@\n-  public XPath(\n-          String exprString, SourceLocator locator,\n-          PrefixResolver prefixResolver, int type,\n-          ErrorListener errorListener, FunctionTable aTable)\n-            throws javax.xml.transform.TransformerException\n+  public XPath(String exprString, SourceLocator locator, PrefixResolver prefixResolver,\n+          int type, ErrorListener errorListener, FunctionTable funcTable,\n+          XMLSecurityManager xmlSecMgr)\n+            throws TransformerException\n@@ -219,1 +193,5 @@\n-    m_funcTable = aTable;\n+    if (funcTable == null) {\n+        initFunctionTable();\n+    } else {\n+        m_funcTable = funcTable;\n+    }\n@@ -221,1 +199,1 @@\n-      errorListener = new com.sun.org.apache.xml.internal.utils.DefaultErrorHandler();\n+      errorListener = new DefaultErrorHandler();\n@@ -225,1 +203,1 @@\n-    XPathParser parser = new XPathParser(errorListener, locator);\n+    XPathParser parser = new XPathParser(errorListener, locator, xmlSecMgr);\n@@ -264,3 +242,3 @@\n-  public XPath(\n-          String exprString, SourceLocator locator, PrefixResolver prefixResolver, int type)\n-            throws javax.xml.transform.TransformerException\n+  public XPath(String exprString, SourceLocator locator, PrefixResolver prefixResolver,\n+          int type)\n+            throws TransformerException\n@@ -271,0 +249,19 @@\n+  \/**\n+   * Constructs an XPath object.\n+   *\n+   * @param exprString The XPath expression.\n+   * @param locator The location of the expression, may be null.\n+   * @param prefixResolver A prefix resolver to use to resolve prefixes to\n+   *                       namespace URIs.\n+   * @param type one of {@link #SELECT} or {@link #MATCH}.\n+   * @param errorListener The error listener, or null if default should be used.\n+   * @param funcTable the function table\n+   * @throws TransformerException\n+   *\/\n+  public XPath(String exprString, SourceLocator locator, PrefixResolver prefixResolver,\n+          int type, ErrorListener errorListener, FunctionTable funcTable)\n+            throws TransformerException\n+  {\n+    this(exprString, locator, prefixResolver, type, errorListener, funcTable, null);\n+  }\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/XPath.java","additions":43,"deletions":46,"binary":false,"changes":89,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,0 +23,1 @@\n+import com.sun.org.apache.xalan.internal.res.XSLMessages;\n@@ -26,0 +27,3 @@\n+import javax.xml.transform.TransformerException;\n+import jdk.xml.internal.XMLSecurityManager;\n+import jdk.xml.internal.XMLSecurityManager.Limit;\n@@ -31,1 +35,1 @@\n- * @LastModified: Nov 2017\n+ * @LastModified: Apr 2022\n@@ -73,0 +77,18 @@\n+  \/\/ XML security manager\n+  XMLSecurityManager m_xmlSecMgr;\n+\n+  \/\/ operator limit\n+  private int m_opCountLimit;\n+\n+  \/\/ group limit\n+  private int m_grpCountLimit;\n+\n+  \/\/ count of operators\n+  private int m_opCount;\n+\n+  \/\/ count of groups\n+  private int m_grpCount;\n+\n+  \/\/ indicate whether the current token is a literal\n+  private boolean isLiteral = false;\n+\n@@ -80,0 +102,1 @@\n+   * @param xmlSecMgr the XML security manager\n@@ -82,1 +105,1 @@\n-        XPathParser xpathProcessor)\n+        XPathParser xpathProcessor, XMLSecurityManager xmlSecMgr)\n@@ -84,1 +107,0 @@\n-\n@@ -88,0 +110,8 @@\n+    m_xmlSecMgr = xmlSecMgr;\n+    \/**\n+     * No limits if XML Security Manager is null. Applications using XPath through\n+     * the public API always have a XMLSecurityManager. Applications invoking\n+     * the internal XPath API shall consider using the public API instead.\n+     *\/\n+    m_opCountLimit = (xmlSecMgr != null) ? xmlSecMgr.getLimit(Limit.XPATH_OP_LIMIT) : 0;\n+    m_grpCountLimit = (xmlSecMgr != null) ? xmlSecMgr.getLimit(Limit.XPATH_GROUP_LIMIT) : 0;\n@@ -95,1 +125,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -108,1 +138,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -112,1 +142,1 @@\n-          throws javax.xml.transform.TransformerException\n+          throws TransformerException\n@@ -115,0 +145,1 @@\n+    boolean isGroup = false;\n@@ -139,1 +170,1 @@\n-      case '\\\"' :\n+      case Token.DQ :\n@@ -174,1 +205,1 @@\n-      case '\\'' :\n+      case Token.SQ :\n@@ -193,1 +224,1 @@\n-        for (i++; (i < nChars) && ((c = pat.charAt(i)) != '\\''); i++);\n+        for (i++; (i < nChars) && ((c = pat.charAt(i)) != Token.SQ); i++);\n@@ -195,1 +226,1 @@\n-        if (c == '\\'' && i < nChars)\n+        if (c == Token.SQ && i < nChars)\n@@ -223,1 +254,7 @@\n-            addToTokenQueue(pat.substring(startSubstring, i));\n+            \/\/ check operator symbol\n+            String s = pat.substring(startSubstring, i);\n+            if (Token.contains(s)) {\n+                m_opCount++;\n+                isLiteral = false;\n+            }\n+            addToTokenQueue(s);\n@@ -229,1 +266,1 @@\n-      case '@' :\n+      case Token.AT :\n@@ -233,2 +270,2 @@\n-      case '-' :\n-        if ('-' == c)\n+      case Token.MINUS :\n+        if (Token.MINUS == c)\n@@ -245,10 +282,10 @@\n-      case '(' :\n-      case '[' :\n-      case ')' :\n-      case ']' :\n-      case '|' :\n-      case '\/' :\n-      case '*' :\n-      case '+' :\n-      case '=' :\n-      case ',' :\n+      case Token.LPAREN :\n+      case Token.LBRACK :\n+      case Token.RPAREN :\n+      case Token.RBRACK :\n+      case Token.VBAR :\n+      case Token.SLASH :\n+      case Token.STAR :\n+      case Token.PLUS :\n+      case Token.EQ :\n+      case Token.COMMA :\n@@ -257,4 +294,4 @@\n-      case '!' :  \/\/ Unused at the moment\n-      case '$' :\n-      case '<' :\n-      case '>' :\n+      case Token.EM :  \/\/ Unused at the moment\n+      case Token.DOLLAR :\n+      case Token.LT :\n+      case Token.GT :\n@@ -278,1 +315,1 @@\n-        else if (('\/' == c) && isStartOfPat)\n+        else if ((Token.SLASH == c) && isStartOfPat)\n@@ -282,1 +319,1 @@\n-        else if ('*' == c)\n+        else if (Token.STAR == c)\n@@ -290,1 +327,1 @@\n-          if ('|' == c)\n+          if (Token.VBAR == c)\n@@ -301,1 +338,1 @@\n-        if ((')' == c) || (']' == c))\n+        if ((Token.RPAREN == c) || (Token.RBRACK == c))\n@@ -305,1 +342,1 @@\n-        else if (('(' == c) || ('[' == c))\n+        else if ((Token.LPAREN == c) || (Token.LBRACK == c))\n@@ -308,0 +345,14 @@\n+          if (!isLiteral && (Token.LPAREN == c)) {\n+            m_grpCount++;\n+            m_opCount++;\n+            isLiteral = false;\n+          }\n+        }\n+\n+        if ((Token.GT == c || Token.LT == c || Token.EQ == c) && Token.EQ != peekNext(pat, i)) {\n+            m_opCount++;\n+            isLiteral = false;\n+        }\n+        else if ((Token.LPAREN != c) && (Token.RPAREN != c) && (Token.RBRACK != c)) {\n+            m_opCount++;\n+            isLiteral = false;\n@@ -312,1 +363,1 @@\n-      case ':' :\n+      case Token.COLON :\n@@ -327,1 +378,1 @@\n-\n+            m_opCount++;\n@@ -340,0 +391,1 @@\n+        isLiteral = true;\n@@ -350,0 +402,14 @@\n+      if (m_grpCountLimit > 0 && m_grpCount > m_grpCountLimit) {\n+          throw new TransformerException(XSLMessages.createXPATHMessage(\n+            XPATHErrorResources.ER_XPATH_GROUP_LIMIT,\n+            new Object[]{Integer.toString(m_grpCount),\n+                Integer.toString(m_grpCountLimit),\n+                m_xmlSecMgr.getStateLiteral(Limit.XPATH_GROUP_LIMIT)}));\n+      }\n+      if (m_opCountLimit > 0 && m_opCount > m_opCountLimit) {\n+          throw new TransformerException(XSLMessages.createXPATHMessage(\n+            XPATHErrorResources.ER_XPATH_OPERATOR_LIMIT,\n+            new Object[]{Integer.toString(m_opCount),\n+                Integer.toString(m_opCountLimit),\n+                m_xmlSecMgr.getStateLiteral(Limit.XPATH_OP_LIMIT)}));\n+      }\n@@ -380,0 +446,13 @@\n+  \/**\n+   * Peeks at the next character without advancing the index.\n+   * @param s the input string\n+   * @param index the current index\n+   * @return the next char\n+   *\/\n+  private char peekNext(String s, int index) {\n+      if (index >= 0 && index < s.length() - 1) {\n+          return s.charAt(index + 1);\n+      }\n+      return 0;\n+  }\n+\n@@ -502,1 +581,1 @@\n-    if (m_processor.lookahead('(', 1))\n+    if (m_processor.lookahead(Token.LPAREN, 1))\n@@ -532,1 +611,1 @@\n-      if (m_processor.tokenIs('@'))\n+      if (m_processor.tokenIs(Token.AT))\n@@ -539,1 +618,1 @@\n-      if (m_processor.lookahead(':', 1))\n+      if (m_processor.lookahead(Token.COLON, 1))\n@@ -568,1 +647,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -574,1 +653,1 @@\n-           throws javax.xml.transform.TransformerException\n+           throws TransformerException\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/compiler\/Lexer.java","additions":120,"deletions":41,"binary":false,"changes":161,"status":"modified"},{"patch":"@@ -0,0 +1,77 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package com.sun.org.apache.xpath.internal.compiler;\n+\n+import java.util.Arrays;\n+\n+\/**\n+ * XPath tokens\n+ *\/\n+public final class Token {\n+    static final char EM = '!';\n+    static final char EQ = '=';\n+    static final char LT = '<';\n+    static final char GT = '>';\n+    static final char PLUS = '+';\n+    static final char MINUS = '-';\n+    static final char STAR = '*';\n+    static final char VBAR = '|';\n+    static final char SLASH = '\/';\n+    static final char LBRACK = '[';\n+    static final char RBRACK = ']';\n+    static final char LPAREN = '(';\n+    static final char RPAREN = ')';\n+    static final char COMMA = ',';\n+    static final char DOT = '.';\n+    static final char AT = '@';\n+    static final char US = '_';\n+    static final char COLON = ':';\n+    static final char SQ = '\\'';\n+    static final char DQ = '\"';\n+    static final char DOLLAR = '$';\n+\n+    static final String OR = \"or\";\n+    static final String AND = \"and\";\n+    static final String DIV = \"div\";\n+    static final String MOD = \"mod\";\n+    static final String QUO = \"quo\";\n+    static final String DOT_STR = \".\";\n+    static final String DDOT = \"..\";\n+    static final String DCOLON = \"::\";\n+    static final String ATTR = \"attribute\";\n+    static final String CHILD = \"child\";\n+\n+    static final String[] OPERATORS = {OR, AND, DIV, MOD, QUO,\n+        DDOT, DCOLON, ATTR, CHILD};\n+\n+    public static boolean contains(String str) {\n+        return Arrays.stream(OPERATORS).anyMatch(str::equals);\n+    }\n+\n+    private Token() {\n+        \/\/to prevent instantiation\n+    }\n+}\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/compiler\/Token.java","additions":77,"deletions":0,"binary":false,"changes":77,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,3 +23,0 @@\n-import javax.xml.transform.ErrorListener;\n-import javax.xml.transform.TransformerException;\n-\n@@ -32,0 +29,4 @@\n+import javax.xml.transform.ErrorListener;\n+import javax.xml.transform.SourceLocator;\n+import javax.xml.transform.TransformerException;\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -37,1 +38,1 @@\n- * @LastModified: May 2019\n+ * @LastModified: Apr 2022\n@@ -78,0 +79,3 @@\n+  \/\/ XML security manager\n+  XMLSecurityManager m_xmlSecMgr;\n+\n@@ -81,1 +85,2 @@\n-  public XPathParser(ErrorListener errorListener, javax.xml.transform.SourceLocator sourceLocator)\n+  public XPathParser(ErrorListener errorListener, SourceLocator sourceLocator,\n+          XMLSecurityManager xmlSecMgr)\n@@ -85,0 +90,1 @@\n+    m_xmlSecMgr = xmlSecMgr;\n@@ -102,1 +108,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -106,1 +112,1 @@\n-            throws javax.xml.transform.TransformerException\n+            throws TransformerException\n@@ -113,1 +119,1 @@\n-    Lexer lexer = new Lexer(compiler, namespaceContext, this);\n+    Lexer lexer = new Lexer(compiler, namespaceContext, this, m_xmlSecMgr);\n@@ -181,1 +187,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -185,1 +191,1 @@\n-            throws javax.xml.transform.TransformerException\n+            throws TransformerException\n@@ -192,1 +198,1 @@\n-    Lexer lexer = new Lexer(compiler, namespaceContext, this);\n+    Lexer lexer = new Lexer(compiler, namespaceContext, this, m_xmlSecMgr);\n@@ -385,1 +391,1 @@\n-      char c0 = (lookbehind == null) ? '|' : lookbehind.charAt(0);\n+      char c0 = (lookbehind == null) ? Token.VBAR : lookbehind.charAt(0);\n@@ -387,1 +393,1 @@\n-      hasToken = (c0 == '|') ? false : true;\n+      hasToken = (c0 == Token.VBAR) ? false : true;\n@@ -499,1 +505,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -502,1 +508,1 @@\n-          throws javax.xml.transform.TransformerException\n+          throws TransformerException\n@@ -527,1 +533,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -530,1 +536,1 @@\n-          throws javax.xml.transform.TransformerException\n+          throws TransformerException\n@@ -752,1 +758,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -754,1 +760,1 @@\n-  protected void Expr() throws javax.xml.transform.TransformerException\n+  protected void Expr() throws TransformerException\n@@ -766,1 +772,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -768,1 +774,1 @@\n-  protected void OrExpr() throws javax.xml.transform.TransformerException\n+  protected void OrExpr() throws TransformerException\n@@ -775,1 +781,1 @@\n-    if ((null != m_token) && tokenIs(\"or\"))\n+    if ((null != m_token) && tokenIs(Token.OR))\n@@ -793,1 +799,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -795,1 +801,1 @@\n-  protected void AndExpr() throws javax.xml.transform.TransformerException\n+  protected void AndExpr() throws TransformerException\n@@ -802,1 +808,1 @@\n-    if ((null != m_token) && tokenIs(\"and\"))\n+    if ((null != m_token) && tokenIs(Token.AND))\n@@ -826,1 +832,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -828,1 +834,1 @@\n-  protected int EqualityExpr(int addPos) throws javax.xml.transform.TransformerException\n+  protected int EqualityExpr(int addPos) throws TransformerException\n@@ -840,1 +846,1 @@\n-      if (tokenIs('!') && lookahead('=', 1))\n+      if (tokenIs(Token.EM) && lookahead(Token.EQ, 1))\n@@ -853,1 +859,1 @@\n-      else if (tokenIs('='))\n+      else if (tokenIs(Token.EQ))\n@@ -886,1 +892,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -888,1 +894,1 @@\n-  protected int RelationalExpr(int addPos) throws javax.xml.transform.TransformerException\n+  protected int RelationalExpr(int addPos) throws TransformerException\n@@ -900,1 +906,1 @@\n-      if (tokenIs('<'))\n+      if (tokenIs(Token.LT))\n@@ -904,1 +910,1 @@\n-        if (tokenIs('='))\n+        if (tokenIs(Token.EQ))\n@@ -921,1 +927,1 @@\n-      else if (tokenIs('>'))\n+      else if (tokenIs(Token.GT))\n@@ -925,1 +931,1 @@\n-        if (tokenIs('='))\n+        if (tokenIs(Token.EQ))\n@@ -961,1 +967,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -963,1 +969,1 @@\n-  protected int AdditiveExpr(int addPos) throws javax.xml.transform.TransformerException\n+  protected int AdditiveExpr(int addPos) throws TransformerException\n@@ -975,1 +981,1 @@\n-      if (tokenIs('+'))\n+      if (tokenIs(Token.PLUS))\n@@ -987,1 +993,1 @@\n-      else if (tokenIs('-'))\n+      else if (tokenIs(Token.MINUS))\n@@ -1019,1 +1025,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1021,1 +1027,1 @@\n-  protected int MultiplicativeExpr(int addPos) throws javax.xml.transform.TransformerException\n+  protected int MultiplicativeExpr(int addPos) throws TransformerException\n@@ -1033,1 +1039,1 @@\n-      if (tokenIs('*'))\n+      if (tokenIs(Token.STAR))\n@@ -1045,1 +1051,1 @@\n-      else if (tokenIs(\"div\"))\n+      else if (tokenIs(Token.DIV))\n@@ -1057,1 +1063,1 @@\n-      else if (tokenIs(\"mod\"))\n+      else if (tokenIs(Token.MOD))\n@@ -1069,1 +1075,1 @@\n-      else if (tokenIs(\"quo\"))\n+      else if (tokenIs(Token.QUO))\n@@ -1092,1 +1098,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1094,1 +1100,1 @@\n-  protected void UnaryExpr() throws javax.xml.transform.TransformerException\n+  protected void UnaryExpr() throws TransformerException\n@@ -1100,1 +1106,1 @@\n-    if (m_tokenChar == '-')\n+    if (m_tokenChar == Token.MINUS)\n@@ -1120,1 +1126,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1122,1 +1128,1 @@\n-  protected void StringExpr() throws javax.xml.transform.TransformerException\n+  protected void StringExpr() throws TransformerException\n@@ -1140,1 +1146,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1142,1 +1148,1 @@\n-  protected void BooleanExpr() throws javax.xml.transform.TransformerException\n+  protected void BooleanExpr() throws TransformerException\n@@ -1166,1 +1172,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1168,1 +1174,1 @@\n-  protected void NumberExpr() throws javax.xml.transform.TransformerException\n+  protected void NumberExpr() throws TransformerException\n@@ -1191,1 +1197,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1193,1 +1199,1 @@\n-  protected void UnionExpr() throws javax.xml.transform.TransformerException\n+  protected void UnionExpr() throws TransformerException\n@@ -1204,1 +1210,1 @@\n-      if (tokenIs('|'))\n+      if (tokenIs(Token.VBAR))\n@@ -1237,1 +1243,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1239,1 +1245,1 @@\n-  protected void PathExpr() throws javax.xml.transform.TransformerException\n+  protected void PathExpr() throws TransformerException\n@@ -1252,1 +1258,1 @@\n-      if (tokenIs('\/'))\n+      if (tokenIs(Token.SLASH))\n@@ -1302,1 +1308,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1304,1 +1310,1 @@\n-  protected int FilterExpr() throws javax.xml.transform.TransformerException\n+  protected int FilterExpr() throws TransformerException\n@@ -1313,1 +1319,1 @@\n-      if (tokenIs('['))\n+      if (tokenIs(Token.LBRACK))\n@@ -1319,1 +1325,1 @@\n-        while (tokenIs('['))\n+        while (tokenIs(Token.LBRACK))\n@@ -1357,1 +1363,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1360,1 +1366,1 @@\n-  protected boolean PrimaryExpr() throws javax.xml.transform.TransformerException\n+  protected boolean PrimaryExpr() throws TransformerException\n@@ -1366,1 +1372,1 @@\n-    if ((m_tokenChar == '\\'') || (m_tokenChar == '\"'))\n+    if ((m_tokenChar == Token.SQ) || (m_tokenChar == Token.DQ))\n@@ -1376,1 +1382,1 @@\n-    else if (m_tokenChar == '$')\n+    else if (m_tokenChar == Token.DOLLAR)\n@@ -1387,1 +1393,1 @@\n-    else if (m_tokenChar == '(')\n+    else if (m_tokenChar == Token.LPAREN)\n@@ -1392,1 +1398,1 @@\n-      consumeExpected(')');\n+      consumeExpected(Token.RPAREN);\n@@ -1410,1 +1416,1 @@\n-    else if (lookahead('(', 1) || (lookahead(':', 1) && lookahead('(', 3)))\n+    else if (lookahead(Token.LPAREN, 1) || (lookahead(Token.COLON, 1) && lookahead(Token.LPAREN, 3)))\n@@ -1427,1 +1433,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1429,1 +1435,1 @@\n-  protected void Argument() throws javax.xml.transform.TransformerException\n+  protected void Argument() throws TransformerException\n@@ -1447,1 +1453,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1449,1 +1455,1 @@\n-  protected boolean FunctionCall() throws javax.xml.transform.TransformerException\n+  protected boolean FunctionCall() throws TransformerException\n@@ -1454,1 +1460,1 @@\n-    if (lookahead(':', 1))\n+    if (lookahead(Token.COLON, 1))\n@@ -1494,1 +1500,1 @@\n-    consumeExpected('(');\n+    consumeExpected(Token.LPAREN);\n@@ -1496,1 +1502,1 @@\n-    while (!tokenIs(')') && m_token != null)\n+    while (!tokenIs(Token.RPAREN) && m_token != null)\n@@ -1498,1 +1504,1 @@\n-      if (tokenIs(','))\n+      if (tokenIs(Token.COMMA))\n@@ -1500,1 +1506,2 @@\n-        error(XPATHErrorResources.ER_FOUND_COMMA_BUT_NO_PRECEDING_ARG, null);  \/\/\"Found ',' but no preceding argument!\");\n+        \/\/\"Found ',' but no preceding argument!\");\n+        error(XPATHErrorResources.ER_FOUND_COMMA_BUT_NO_PRECEDING_ARG, null);\n@@ -1505,1 +1512,1 @@\n-      if (!tokenIs(')'))\n+      if (!tokenIs(Token.RPAREN))\n@@ -1507,1 +1514,1 @@\n-        consumeExpected(',');\n+        consumeExpected(Token.COMMA);\n@@ -1509,1 +1516,1 @@\n-        if (tokenIs(')'))\n+        if (tokenIs(Token.RPAREN))\n@@ -1517,1 +1524,1 @@\n-    consumeExpected(')');\n+    consumeExpected(Token.RPAREN);\n@@ -1536,1 +1543,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1538,1 +1545,1 @@\n-  protected void LocationPath() throws javax.xml.transform.TransformerException\n+  protected void LocationPath() throws TransformerException\n@@ -1546,1 +1553,1 @@\n-    boolean seenSlash = tokenIs('\/');\n+    boolean seenSlash = tokenIs(Token.SLASH);\n@@ -1587,1 +1594,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1590,1 +1597,1 @@\n-               throws javax.xml.transform.TransformerException\n+               throws TransformerException\n@@ -1597,1 +1604,1 @@\n-    while (tokenIs('\/'))\n+    while (tokenIs(Token.SLASH))\n@@ -1619,1 +1626,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1621,1 +1628,1 @@\n-  protected boolean Step() throws javax.xml.transform.TransformerException\n+  protected boolean Step() throws TransformerException\n@@ -1625,1 +1632,1 @@\n-    boolean doubleSlash = tokenIs('\/');\n+    boolean doubleSlash = tokenIs(Token.SLASH);\n@@ -1657,1 +1664,1 @@\n-    if (tokenIs(\".\"))\n+    if (tokenIs(Token.DOT_STR))\n@@ -1661,1 +1668,1 @@\n-      if (tokenIs('['))\n+      if (tokenIs(Token.LBRACK))\n@@ -1672,1 +1679,1 @@\n-    else if (tokenIs(\"..\"))\n+    else if (tokenIs(Token.DDOT))\n@@ -1685,1 +1692,1 @@\n-    else if (tokenIs('*') || tokenIs('@') || tokenIs('_')\n+    else if (tokenIs(Token.STAR) || tokenIs(Token.AT) || tokenIs(Token.US)\n@@ -1690,1 +1697,1 @@\n-      while (tokenIs('['))\n+      while (tokenIs(Token.LBRACK))\n@@ -1719,1 +1726,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1721,1 +1728,1 @@\n-  protected void Basis() throws javax.xml.transform.TransformerException\n+  protected void Basis() throws TransformerException\n@@ -1728,1 +1735,1 @@\n-    if (lookahead(\"::\", 1))\n+    if (lookahead(Token.DCOLON, 1))\n@@ -1735,1 +1742,1 @@\n-    else if (tokenIs('@'))\n+    else if (tokenIs(Token.AT))\n@@ -1766,1 +1773,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1768,1 +1775,1 @@\n-  protected int AxisName() throws javax.xml.transform.TransformerException\n+  protected int AxisName() throws TransformerException\n@@ -1794,1 +1801,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1796,1 +1803,1 @@\n-  protected void NodeTest(int axesType) throws javax.xml.transform.TransformerException\n+  protected void NodeTest(int axesType) throws TransformerException\n@@ -1799,1 +1806,1 @@\n-    if (lookahead('(', 1))\n+    if (lookahead(Token.LPAREN, 1))\n@@ -1817,1 +1824,1 @@\n-        consumeExpected('(');\n+        consumeExpected(Token.LPAREN);\n@@ -1821,1 +1828,1 @@\n-          if (!tokenIs(')'))\n+          if (!tokenIs(Token.RPAREN))\n@@ -1827,1 +1834,1 @@\n-        consumeExpected(')');\n+        consumeExpected(Token.RPAREN);\n@@ -1837,1 +1844,1 @@\n-      if (lookahead(':', 1))\n+      if (lookahead(Token.COLON, 1))\n@@ -1839,1 +1846,1 @@\n-        if (tokenIs('*'))\n+        if (tokenIs(Token.STAR))\n@@ -1849,1 +1856,1 @@\n-          if (!Character.isLetter(m_tokenChar) && !tokenIs('_'))\n+          if (!Character.isLetter(m_tokenChar) && !tokenIs(Token.US))\n@@ -1866,1 +1873,1 @@\n-      if (tokenIs('*'))\n+      if (tokenIs(Token.STAR))\n@@ -1876,1 +1883,1 @@\n-        if (!Character.isLetter(m_tokenChar) && !tokenIs('_'))\n+        if (!Character.isLetter(m_tokenChar) && !tokenIs(Token.US))\n@@ -1894,1 +1901,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1896,1 +1903,1 @@\n-  protected void Predicate() throws javax.xml.transform.TransformerException\n+  protected void Predicate() throws TransformerException\n@@ -1898,1 +1905,1 @@\n-    if (tokenIs('['))\n+    if (tokenIs(Token.LBRACK))\n@@ -1913,1 +1920,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1915,1 +1922,1 @@\n-  protected void PredicateExpr() throws javax.xml.transform.TransformerException\n+  protected void PredicateExpr() throws TransformerException\n@@ -1935,1 +1942,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1937,1 +1944,1 @@\n-  protected void QName() throws javax.xml.transform.TransformerException\n+  protected void QName() throws TransformerException\n@@ -1940,1 +1947,1 @@\n-    if(lookahead(':', 1))\n+    if(lookahead(Token.COLON, 1))\n@@ -1982,1 +1989,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -1984,1 +1991,1 @@\n-  protected void Literal() throws javax.xml.transform.TransformerException\n+  protected void Literal() throws TransformerException\n@@ -1991,1 +1998,1 @@\n-    if (((c0 == '\\\"') && (cX == '\\\"')) || ((c0 == '\\'') && (cX == '\\'')))\n+    if (((c0 == Token.DQ) && (cX == Token.DQ)) || ((c0 == Token.SQ) && (cX == Token.SQ)))\n@@ -2022,1 +2029,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2024,1 +2031,1 @@\n-  protected void Number() throws javax.xml.transform.TransformerException\n+  protected void Number() throws TransformerException\n@@ -2065,1 +2072,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2067,1 +2074,1 @@\n-  protected void Pattern() throws javax.xml.transform.TransformerException\n+  protected void Pattern() throws TransformerException\n@@ -2074,1 +2081,1 @@\n-      if (tokenIs('|'))\n+      if (tokenIs(Token.VBAR))\n@@ -2093,1 +2100,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2095,1 +2102,1 @@\n-  protected void LocationPathPattern() throws javax.xml.transform.TransformerException\n+  protected void LocationPathPattern() throws TransformerException\n@@ -2108,1 +2115,1 @@\n-    if (lookahead('(', 1)\n+    if (lookahead(Token.LPAREN, 1)\n@@ -2114,1 +2121,1 @@\n-      if (tokenIs('\/'))\n+      if (tokenIs(Token.SLASH))\n@@ -2118,1 +2125,1 @@\n-        if (tokenIs('\/'))\n+        if (tokenIs(Token.SLASH))\n@@ -2136,1 +2143,1 @@\n-    else if (tokenIs('\/'))\n+    else if (tokenIs(Token.SLASH))\n@@ -2138,1 +2145,1 @@\n-      if (lookahead('\/', 1))\n+      if (lookahead(Token.SLASH, 1))\n@@ -2171,1 +2178,1 @@\n-      if (!tokenIs('|') && (null != m_token))\n+      if (!tokenIs(Token.VBAR) && (null != m_token))\n@@ -2196,1 +2203,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2198,1 +2205,1 @@\n-  protected void IdKeyPattern() throws javax.xml.transform.TransformerException\n+  protected void IdKeyPattern() throws TransformerException\n@@ -2209,1 +2216,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2212,1 +2219,1 @@\n-              throws javax.xml.transform.TransformerException\n+              throws TransformerException\n@@ -2219,1 +2226,1 @@\n-    while (tokenIs('\/'))\n+    while (tokenIs(Token.SLASH))\n@@ -2239,1 +2246,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2242,1 +2249,1 @@\n-            throws javax.xml.transform.TransformerException\n+            throws TransformerException\n@@ -2256,1 +2263,1 @@\n-   * @throws javax.xml.transform.TransformerException\n+   * @throws TransformerException\n@@ -2259,1 +2266,1 @@\n-            throws javax.xml.transform.TransformerException\n+            throws TransformerException\n@@ -2268,1 +2275,1 @@\n-    if (tokenIs('@'))\n+    if (tokenIs(Token.AT))\n@@ -2275,1 +2282,1 @@\n-    else if (this.lookahead(\"::\", 1))\n+    else if (this.lookahead(Token.DCOLON, 1))\n@@ -2277,1 +2284,1 @@\n-      if (tokenIs(\"attribute\"))\n+      if (tokenIs(Token.ATTR))\n@@ -2283,1 +2290,1 @@\n-      else if (tokenIs(\"child\"))\n+      else if (tokenIs(Token.CHILD))\n@@ -2301,1 +2308,1 @@\n-    else if (tokenIs('\/'))\n+    else if (tokenIs(Token.SLASH))\n@@ -2330,1 +2337,1 @@\n-    while (tokenIs('['))\n+    while (tokenIs(Token.LBRACK))\n@@ -2349,1 +2356,1 @@\n-    if ((matchTypePos > -1) && tokenIs('\/') && lookahead('\/', 1))\n+    if ((matchTypePos > -1) && tokenIs(Token.SLASH) && lookahead(Token.SLASH, 1))\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/compiler\/XPathParser.java","additions":163,"deletions":156,"binary":false,"changes":319,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -39,1 +40,1 @@\n- * @LastModified: Nov 2021\n+ * @LastModified: Jan 2022\n@@ -72,0 +73,5 @@\n+        \/**\n+         * The XML security manager\n+         *\/\n+        private XMLSecurityManager _xmlSecMgr;\n+\n@@ -82,0 +88,1 @@\n+            _xmlSecMgr = new XMLSecurityManager(true);\n@@ -83,0 +90,1 @@\n+\n@@ -129,3 +137,2 @@\n-            return new com.sun.org.apache.xpath.internal.jaxp.XPathImpl(\n-                    xPathVariableResolver, xPathFunctionResolver,\n-                    !_isNotSecureProcessing, _featureManager );\n+            return new XPathImpl(xPathVariableResolver, xPathFunctionResolver,\n+                    !_isNotSecureProcessing, _featureManager, _xmlSecMgr);\n@@ -314,1 +321,17 @@\n-    @Override\n+    \/**\n+     * Sets a property for the {@code XPathFactory}. The property applies to\n+     * {@code XPath} objects that the {@code XPathFactory} creates. It has no\n+     * impact on {@code XPath} objects that are already created.\n+     * <p>\n+     * A property can either be defined in the {@code XPathFactory}, or by the\n+     * underlying implementation.\n+     *\n+     * @param name the property name\n+     * @param value the value for the property\n+     *\n+     * @throws IllegalArgumentException if the property name is not recognized,\n+     * or the value can not be assigned\n+     * @throws UnsupportedOperationException if the implementation does not\n+     * support the method\n+     * @throws NullPointerException if the {@code name} is {@code null}\n+     *\/\n@@ -324,0 +347,5 @@\n+        if (_xmlSecMgr != null &&\n+                _xmlSecMgr.setLimit(name, JdkProperty.State.APIPROPERTY, value)) {\n+            return;\n+        }\n+\n@@ -331,1 +359,13 @@\n-    @Override\n+    \/**\n+     * Returns the value of the specified property.\n+     *\n+     * @param name the property name\n+     * @return the value of the property.\n+     *\n+     * @throws IllegalArgumentException if the property name is not recognized\n+     * @throws UnsupportedOperationException if the implementation does not\n+     * support the method\n+     * @throws NullPointerException if the {@code name} is {@code null}\n+     *\n+     * @since 18\n+     *\/\n@@ -341,0 +381,7 @@\n+        \/** Check to see if the property is managed by the security manager **\/\n+        String propertyValue = (_xmlSecMgr != null) ?\n+                _xmlSecMgr.getLimitAsString(name) : null;\n+        if (propertyValue != null) {\n+            return propertyValue;\n+        }\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/jaxp\/XPathFactoryImpl.java","additions":54,"deletions":7,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,0 +35,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -48,0 +49,2 @@\n+ *\n+ * @LastModified: Jan 2022\n@@ -57,1 +60,1 @@\n-        this(vr, fr, false, new JdkXmlFeatures(false));\n+        this(vr, fr, false, new JdkXmlFeatures(false), new XMLSecurityManager(true));\n@@ -61,1 +64,2 @@\n-            boolean featureSecureProcessing, JdkXmlFeatures featureManager) {\n+            boolean featureSecureProcessing, JdkXmlFeatures featureManager,\n+            XMLSecurityManager xmlSecMgr) {\n@@ -68,1 +72,1 @@\n-\n+        this.xmlSecMgr = xmlSecMgr;\n@@ -116,2 +120,2 @@\n-        com.sun.org.apache.xpath.internal.XPath xpath = new com.sun.org.apache.xpath.internal.XPath(expression,\n-            null, prefixResolver, com.sun.org.apache.xpath.internal.XPath.SELECT);\n+        XPath xpath = new XPath(expression, null, prefixResolver, XPath.SELECT,\n+                null, null, xmlSecMgr);\n@@ -162,2 +166,2 @@\n-            com.sun.org.apache.xpath.internal.XPath xpath = new XPath (expression, null,\n-                    prefixResolver, com.sun.org.apache.xpath.internal.XPath.SELECT);\n+            XPath xpath = new XPath(expression, null, prefixResolver, XPath.SELECT,\n+                    null, null, xmlSecMgr);\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/jaxp\/XPathImpl.java","additions":12,"deletions":8,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -46,0 +46,1 @@\n+import jdk.xml.internal.XMLSecurityManager;\n@@ -55,0 +56,2 @@\n+ *\n+ * @LastModified: Jan 2022\n@@ -66,0 +69,1 @@\n+    XMLSecurityManager xmlSecMgr;\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/jaxp\/XPathImplUtil.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -174,1 +174,5 @@\n-                return type.cast(ni.nextNode());\n+                try {\n+                    return type.cast(ni.nextNode());\n+                } catch (RuntimeException e) {\n+                    throw new TransformerException(e.getMessage(), e.getCause());\n+                }\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/jaxp\/XPathResultImpl.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n- * @LastModified: Nov 2021\n+ * @LastModified: Jan 2022\n@@ -329,0 +329,3 @@\n+  public static final String ER_XPATH_GROUP_LIMIT = \"XPATH_GROUP_LIMIT\";\n+  public static final String ER_XPATH_OPERATOR_LIMIT = \"XPATH_OPERATOR_LIMIT\";\n+\n@@ -863,0 +866,8 @@\n+  { ER_XPATH_GROUP_LIMIT,\n+      \"JAXP0801001: the compiler encountered an XPath expression containing \"\n+          + \"''{0}'' groups that exceeds the ''{1}'' limit set by ''{2}''.\"},\n+\n+  { ER_XPATH_OPERATOR_LIMIT,\n+      \"JAXP0801002: the compiler encountered an XPath expression containing \"\n+          + \"''{0}'' operators that exceeds the ''{1}'' limit set by ''{2}''.\"},\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/res\/XPATHErrorResources.java","additions":13,"deletions":2,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import jdk.xml.internal.JdkXmlUtils;\n@@ -132,0 +133,1 @@\n+            writer.write(\"\\\"\");\n@@ -134,8 +136,1 @@\n-            String pubId = getPublicId();\n-            if (pubId != null) {\n-                writer.write(\" PUBLIC \\\"\");\n-                writer.write(pubId);\n-            } else {\n-                writer.write(\" SYSTEM \\\"\");\n-                writer.write(getSystemId());\n-            }\n+            writer.write(JdkXmlUtils.getDTDExternalDecl(getPublicId(), getSystemId()));\n@@ -143,1 +138,1 @@\n-        writer.write(\"\\\"\");\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/xml\/internal\/stream\/events\/EntityDeclarationImpl.java","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import jdk.xml.internal.JdkXmlUtils;\n@@ -91,10 +92,1 @@\n-        if (fPublicId != null) {\n-            writer.write(\" PUBLIC \\\"\");\n-            writer.write(fPublicId);\n-            writer.write(\"\\\"\");\n-        } else if (fSystemId != null) {\n-            writer.write(\" SYSTEM\");\n-            writer.write(\" \\\"\");\n-            writer.write(fSystemId);\n-            writer.write(\"\\\"\");\n-        }\n+        writer.write(JdkXmlUtils.getDTDExternalDecl(fPublicId, fSystemId));\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/xml\/internal\/stream\/events\/NotationDeclarationImpl.java","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -208,0 +208,15 @@\n+    \/**\n+     * JDK XPath Expression group limit\n+     *\/\n+    public static final String XPATH_GROUP_LIMIT = \"jdk.xml.xpathExprGrpLimit\";\n+\n+    \/**\n+     * JDK XPath Expression operators limit\n+     *\/\n+    public static final String XPATH_OP_LIMIT = \"jdk.xml.xpathExprOpLimit\";\n+\n+    \/**\n+     * JDK XSL XPath limit or Total Number of Operators Permitted in an XSL Stylesheet\n+     *\/\n+    public static final String XPATH_TOTALOP_LIMIT = \"jdk.xml.xpathTotalOpLimit\";\n+\n","filename":"src\/java.xml\/share\/classes\/jdk\/xml\/internal\/JdkConstants.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -54,1 +54,2 @@\n-    private ImplPropMap pName;\n+    private final ImplPropMap pName;\n+    private final Class<T> pType;\n@@ -61,0 +62,1 @@\n+     * @param type the type of the value\n@@ -64,1 +66,1 @@\n-    public JdkProperty(ImplPropMap name, T value, State state) {\n+    public JdkProperty(ImplPropMap name, Class<T> type, T value, State state) {\n@@ -66,0 +68,1 @@\n+        this.pType = type;\n@@ -68,0 +71,20 @@\n+        readSystemProperty();\n+    }\n+\n+    \/**\n+     * Read from system properties, or those in jaxp.properties\n+     *\/\n+    private void readSystemProperty() {\n+        if (pState == State.DEFAULT) {\n+            T value = null;\n+            if (pName.systemProperty() != null) {\n+                value = SecuritySupport.getJAXPSystemProperty(pType, pName.systemProperty(), null);\n+            }\n+            if (value == null && pName.systemPropertyOld() != null) {\n+                value = SecuritySupport.getJAXPSystemProperty(pType, pName.systemPropertyOld(), null);\n+            }\n+            if (value != null) {\n+                pValue = value;\n+                pState = State.SYSTEMPROPERTY;\n+            }\n+        }\n","filename":"src\/java.xml\/share\/classes\/jdk\/xml\/internal\/JdkProperty.java","additions":26,"deletions":3,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,0 @@\n-import com.sun.org.apache.xalan.internal.utils.XMLSecurityManager;\n@@ -370,3 +369,1 @@\n-     * Returns the character to be used to quote the input content. Between\n-     * single and double quotes, this method returns the one that is not found\n-     * in the input. Returns double quote by default.\n+     * Returns the external declaration for a DTD construct.\n@@ -374,2 +371,3 @@\n-     * @param s the input string\n-     * @return returns the quote not found in the input\n+     * @param publicId the public identifier\n+     * @param systemId the system identifier\n+     * @return a DTD external declaration\n@@ -377,5 +375,15 @@\n-    public static char getQuoteChar(String s) {\n-        if (s != null && s.indexOf('\"') > -1) {\n-            return '\\'';\n-        } else {\n-            return '\"';\n+    public static String getDTDExternalDecl(String publicId, String systemId) {\n+        StringBuilder sb = new StringBuilder();\n+        if (null != publicId) {\n+            sb.append(\" PUBLIC \");\n+            sb.append(quoteString(publicId));\n+        }\n+\n+        if (null != systemId) {\n+            if (null == publicId) {\n+                sb.append(\" SYSTEM \");\n+            } else {\n+                sb.append(\" \");\n+            }\n+\n+            sb.append(quoteString(systemId));\n@@ -383,0 +391,12 @@\n+        return sb.toString();\n+    }\n+\n+    \/**\n+     * Returns the input string quoted with double quotes or single ones if\n+     * there is a double quote in the string.\n+     * @param s the input string, can not be null\n+     * @return the quoted string\n+     *\/\n+    private static String quoteString(String s) {\n+        char c = (s.indexOf('\"') > -1) ? '\\'' : '\"';\n+        return c + s + c;\n","filename":"src\/java.xml\/share\/classes\/jdk\/xml\/internal\/JdkXmlUtils.java","additions":32,"deletions":12,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -0,0 +1,248 @@\n+\/*\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package jdk.xml.internal;\n+\n+import java.util.Formatter;\n+import java.util.HashMap;\n+import java.util.Map;\n+import jdk.xml.internal.XMLSecurityManager.Limit;\n+\n+\n+\/**\n+ * A helper for analyzing entity expansion limits\n+ *\n+ *\/\n+public final class XMLLimitAnalyzer {\n+\n+    \/**\n+     * Map old property names with the new ones\n+     *\/\n+    public static enum NameMap {\n+        ENTITY_EXPANSION_LIMIT(JdkConstants.SP_ENTITY_EXPANSION_LIMIT, JdkConstants.ENTITY_EXPANSION_LIMIT),\n+        MAX_OCCUR_NODE_LIMIT(JdkConstants.SP_MAX_OCCUR_LIMIT, JdkConstants.MAX_OCCUR_LIMIT),\n+        ELEMENT_ATTRIBUTE_LIMIT(JdkConstants.SP_ELEMENT_ATTRIBUTE_LIMIT, JdkConstants.ELEMENT_ATTRIBUTE_LIMIT);\n+\n+        final String newName;\n+        final String oldName;\n+\n+        NameMap(String newName, String oldName) {\n+            this.newName = newName;\n+            this.oldName = oldName;\n+        }\n+\n+        String getOldName(String newName) {\n+            if (newName.equals(this.newName)) {\n+                return oldName;\n+            }\n+            return null;\n+        }\n+    }\n+\n+    \/**\n+     * Max value accumulated for each property\n+     *\/\n+    private final int[] values;\n+    \/**\n+     * Names of the entities corresponding to their max values\n+     *\/\n+    private final String[] names;\n+    \/**\n+     * Total value of accumulated entities\n+     *\/\n+    private final int[] totalValue;\n+\n+    \/**\n+     * Maintain values of the top 10 elements in the process of parsing\n+     *\/\n+    private final Map<String, Integer>[] caches;\n+\n+    private String entityStart, entityEnd;\n+    \/**\n+     * Default constructor. Establishes default values for known security\n+     * vulnerabilities.\n+     *\/\n+    @SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+    public XMLLimitAnalyzer() {\n+        values = new int[Limit.values().length];\n+        totalValue = new int[Limit.values().length];\n+        names = new String[Limit.values().length];\n+        caches = new Map[Limit.values().length];\n+    }\n+\n+    \/**\n+     * Add the value to the current max count for the specified property\n+     * To find the max value of all entities, set no limit\n+     *\n+     * @param limit the type of the property\n+     * @param entityName the name of the entity\n+     * @param value the value of the entity\n+     *\/\n+    public void addValue(Limit limit, String entityName, int value) {\n+        addValue(limit.ordinal(), entityName, value);\n+    }\n+\n+    \/**\n+     * Add the value to the current count by the index of the property\n+     * @param index the index of the property\n+     * @param entityName the name of the entity\n+     * @param value the value of the entity\n+     *\/\n+    public void addValue(int index, String entityName, int value) {\n+        if (index == Limit.ENTITY_EXPANSION_LIMIT.ordinal() ||\n+                index == Limit.MAX_OCCUR_NODE_LIMIT.ordinal() ||\n+                index == Limit.ELEMENT_ATTRIBUTE_LIMIT.ordinal() ||\n+                index == Limit.TOTAL_ENTITY_SIZE_LIMIT.ordinal() ||\n+                index == Limit.ENTITY_REPLACEMENT_LIMIT.ordinal()\n+                ) {\n+            totalValue[index] += value;\n+            return;\n+        }\n+        if (index == Limit.MAX_ELEMENT_DEPTH_LIMIT.ordinal() ||\n+                index == Limit.MAX_NAME_LIMIT.ordinal()) {\n+            values[index] = value;\n+            totalValue[index] = value;\n+            return;\n+        }\n+\n+        Map<String, Integer> cache;\n+        if (caches[index] == null) {\n+            cache = new HashMap<>(10);\n+            caches[index] = cache;\n+        } else {\n+            cache = caches[index];\n+        }\n+\n+        int accumulatedValue = value;\n+        if (cache.containsKey(entityName)) {\n+            accumulatedValue += cache.get(entityName);\n+            cache.put(entityName, accumulatedValue);\n+        } else {\n+            cache.put(entityName, value);\n+        }\n+\n+        if (accumulatedValue > values[index]) {\n+            values[index] = accumulatedValue;\n+            names[index] = entityName;\n+        }\n+\n+\n+        if (index == Limit.GENERAL_ENTITY_SIZE_LIMIT.ordinal() ||\n+                index == Limit.PARAMETER_ENTITY_SIZE_LIMIT.ordinal()) {\n+            totalValue[Limit.TOTAL_ENTITY_SIZE_LIMIT.ordinal()] += value;\n+        }\n+    }\n+\n+    \/**\n+     * Return the value of the current max count for the specified property\n+     *\n+     * @param limit the property\n+     * @return the value of the property\n+     *\/\n+    public int getValue(Limit limit) {\n+        return getValue(limit.ordinal());\n+    }\n+\n+    public int getValue(int index) {\n+        if (index == Limit.ENTITY_REPLACEMENT_LIMIT.ordinal()) {\n+            return totalValue[index];\n+        }\n+        return values[index];\n+    }\n+    \/**\n+     * Return the total value accumulated so far\n+     *\n+     * @param limit the property\n+     * @return the accumulated value of the property\n+     *\/\n+    public int getTotalValue(Limit limit) {\n+        return totalValue[limit.ordinal()];\n+    }\n+\n+    public int getTotalValue(int index) {\n+        return totalValue[index];\n+    }\n+    \/**\n+     * Return the current max value (count or length) by the index of a property\n+     * @param index the index of a property\n+     * @return count of a property\n+     *\/\n+    public int getValueByIndex(int index) {\n+        return values[index];\n+    }\n+\n+    public void startEntity(String name) {\n+        entityStart = name;\n+    }\n+\n+    public boolean isTracking(String name) {\n+        if (entityStart == null) {\n+            return false;\n+        }\n+        return entityStart.equals(name);\n+    }\n+    \/**\n+     * Stop tracking the entity\n+     * @param limit the limit property\n+     * @param name the name of an entity\n+     *\/\n+    public void endEntity(Limit limit, String name) {\n+        entityStart = \"\";\n+        Map<String, Integer> cache = caches[limit.ordinal()];\n+        if (cache != null) {\n+            cache.remove(name);\n+        }\n+    }\n+\n+    \/**\n+     * Resets the current value of the specified limit.\n+     * @param limit The limit to be reset.\n+     *\/\n+    public void reset(Limit limit) {\n+        if (limit.ordinal() == Limit.TOTAL_ENTITY_SIZE_LIMIT.ordinal()) {\n+            totalValue[limit.ordinal()] = 0;\n+        } else if (limit.ordinal() == Limit.GENERAL_ENTITY_SIZE_LIMIT.ordinal()) {\n+            names[limit.ordinal()] = null;\n+            values[limit.ordinal()] = 0;\n+            caches[limit.ordinal()] = null;\n+            totalValue[limit.ordinal()] = 0;\n+        }\n+    }\n+\n+    public void debugPrint(XMLSecurityManager securityManager) {\n+        Formatter formatter = new Formatter();\n+        System.out.println(formatter.format(\"%30s %15s %15s %15s %30s\",\n+                \"Property\",\"Limit\",\"Total size\",\"Size\",\"Entity Name\"));\n+\n+        for (Limit limit : Limit.values()) {\n+            formatter = new Formatter();\n+            System.out.println(formatter.format(\"%30s %15d %15d %15d %30s\",\n+                    limit.name(),\n+                    securityManager.getLimit(limit),\n+                    totalValue[limit.ordinal()],\n+                    values[limit.ordinal()],\n+                    names[limit.ordinal()]));\n+        }\n+    }\n+}\n","filename":"src\/java.xml\/share\/classes\/jdk\/xml\/internal\/XMLLimitAnalyzer.java","additions":248,"deletions":0,"binary":false,"changes":248,"status":"added"},{"patch":"@@ -0,0 +1,633 @@\n+\/*\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package jdk.xml.internal;\n+\n+\n+import com.sun.org.apache.xerces.internal.util.SecurityManager;\n+import java.util.concurrent.CopyOnWriteArrayList;\n+import jdk.xml.internal.JdkProperty.State;\n+import jdk.xml.internal.JdkProperty.ImplPropMap;\n+import org.xml.sax.SAXException;\n+\n+\/**\n+ * This class manages standard and implementation-specific limitations.\n+ *\n+ *\/\n+public final class XMLSecurityManager {\n+\n+    \/**\n+     * Limits managed by the security manager\n+     *\/\n+    @SuppressWarnings(\"deprecation\")\n+    public static enum Limit {\n+        ENTITY_EXPANSION_LIMIT(\"EntityExpansionLimit\", JdkConstants.JDK_ENTITY_EXPANSION_LIMIT,\n+            JdkConstants.SP_ENTITY_EXPANSION_LIMIT, 0, 64000, Processor.PARSER),\n+        MAX_OCCUR_NODE_LIMIT(\"MaxOccurLimit\", JdkConstants.JDK_MAX_OCCUR_LIMIT,\n+            JdkConstants.SP_MAX_OCCUR_LIMIT, 0, 5000, Processor.PARSER),\n+        ELEMENT_ATTRIBUTE_LIMIT(\"ElementAttributeLimit\", JdkConstants.JDK_ELEMENT_ATTRIBUTE_LIMIT,\n+            JdkConstants.SP_ELEMENT_ATTRIBUTE_LIMIT, 0, 10000, Processor.PARSER),\n+        TOTAL_ENTITY_SIZE_LIMIT(\"TotalEntitySizeLimit\", JdkConstants.JDK_TOTAL_ENTITY_SIZE_LIMIT,\n+            JdkConstants.SP_TOTAL_ENTITY_SIZE_LIMIT, 0, 50000000, Processor.PARSER),\n+        GENERAL_ENTITY_SIZE_LIMIT(\"MaxEntitySizeLimit\", JdkConstants.JDK_GENERAL_ENTITY_SIZE_LIMIT,\n+            JdkConstants.SP_GENERAL_ENTITY_SIZE_LIMIT, 0, 0, Processor.PARSER),\n+        PARAMETER_ENTITY_SIZE_LIMIT(\"MaxEntitySizeLimit\", JdkConstants.JDK_PARAMETER_ENTITY_SIZE_LIMIT,\n+            JdkConstants.SP_PARAMETER_ENTITY_SIZE_LIMIT, 0, 1000000, Processor.PARSER),\n+        MAX_ELEMENT_DEPTH_LIMIT(\"MaxElementDepthLimit\", JdkConstants.JDK_MAX_ELEMENT_DEPTH,\n+            JdkConstants.SP_MAX_ELEMENT_DEPTH, 0, 0, Processor.PARSER),\n+        MAX_NAME_LIMIT(\"MaxXMLNameLimit\", JdkConstants.JDK_XML_NAME_LIMIT,\n+            JdkConstants.SP_XML_NAME_LIMIT, 1000, 1000, Processor.PARSER),\n+        ENTITY_REPLACEMENT_LIMIT(\"EntityReplacementLimit\", JdkConstants.JDK_ENTITY_REPLACEMENT_LIMIT,\n+            JdkConstants.SP_ENTITY_REPLACEMENT_LIMIT, 0, 3000000, Processor.PARSER),\n+        XPATH_GROUP_LIMIT(\"XPathGroupLimit\", JdkConstants.XPATH_GROUP_LIMIT,\n+            JdkConstants.XPATH_GROUP_LIMIT, 10, 10, Processor.XPATH),\n+        XPATH_OP_LIMIT(\"XPathExprOpLimit\", JdkConstants.XPATH_OP_LIMIT,\n+            JdkConstants.XPATH_OP_LIMIT, 100, 100, Processor.XPATH),\n+        XPATH_TOTALOP_LIMIT(\"XPathTotalOpLimit\", JdkConstants.XPATH_TOTALOP_LIMIT,\n+            JdkConstants.XPATH_TOTALOP_LIMIT, 10000, 10000, Processor.XPATH)\n+        ;\n+\n+        final String key;\n+        final String apiProperty;\n+        final String systemProperty;\n+        final int defaultValue;\n+        final int secureValue;\n+        final Processor processor;\n+\n+        Limit(String key, String apiProperty, String systemProperty, int value,\n+                int secureValue, Processor processor) {\n+            this.key = key;\n+            this.apiProperty = apiProperty;\n+            this.systemProperty = systemProperty;\n+            this.defaultValue = value;\n+            this.secureValue = secureValue;\n+            this.processor = processor;\n+        }\n+\n+        \/**\n+         * Checks whether the specified name is a limit. Checks both the\n+         * property and System Property which is now the new property name.\n+         *\n+         * @param name the specified name\n+         * @return true if there is a match, false otherwise\n+         *\/\n+        public boolean is(String name) {\n+            \/\/ current spec: new property name == systemProperty\n+            return (systemProperty != null && systemProperty.equals(name)) ||\n+                   \/\/ current spec: apiProperty is legacy\n+                   (apiProperty.equals(name));\n+        }\n+\n+        \/**\n+         * Returns the state of a property name. By the specification as of JDK 17,\n+         * the \"jdk.xml.\" prefixed System property name is also the current API\n+         * name. The URI-based qName is legacy.\n+         *\n+         * @param name the property name\n+         * @return the state of the property name, null if no match\n+         *\/\n+        public State getState(String name) {\n+            if (systemProperty != null && systemProperty.equals(name)) {\n+                return State.APIPROPERTY;\n+            } else if (apiProperty.equals(name)) {\n+                \/\/the URI-style qName is legacy\n+                return State.LEGACY_APIPROPERTY;\n+            }\n+            return null;\n+        }\n+\n+        public String key() {\n+            return key;\n+        }\n+\n+        public String apiProperty() {\n+            return apiProperty;\n+        }\n+\n+        public String systemProperty() {\n+            return systemProperty;\n+        }\n+\n+        public int defaultValue() {\n+            return defaultValue;\n+        }\n+\n+        public boolean isSupported(Processor p) {\n+            return processor == p;\n+        }\n+\n+        int secureValue() {\n+            return secureValue;\n+        }\n+    }\n+\n+    \/**\n+     * Map old property names with the new ones\n+     *\/\n+    public static enum NameMap {\n+\n+        ENTITY_EXPANSION_LIMIT(JdkConstants.SP_ENTITY_EXPANSION_LIMIT, JdkConstants.ENTITY_EXPANSION_LIMIT),\n+        MAX_OCCUR_NODE_LIMIT(JdkConstants.SP_MAX_OCCUR_LIMIT, JdkConstants.MAX_OCCUR_LIMIT),\n+        ELEMENT_ATTRIBUTE_LIMIT(JdkConstants.SP_ELEMENT_ATTRIBUTE_LIMIT, JdkConstants.ELEMENT_ATTRIBUTE_LIMIT);\n+        final String newName;\n+        final String oldName;\n+\n+        NameMap(String newName, String oldName) {\n+            this.newName = newName;\n+            this.oldName = oldName;\n+        }\n+\n+        String getOldName(String newName) {\n+            if (newName.equals(this.newName)) {\n+                return oldName;\n+            }\n+            return null;\n+        }\n+    }\n+\n+    \/**\n+     * Supported processors\n+     *\/\n+    public static enum Processor {\n+        PARSER,\n+        XPATH,\n+    }\n+\n+    private static final int NO_LIMIT = 0;\n+\n+    \/**\n+     * Values of the properties\n+     *\/\n+    private final int[] values;\n+\n+    \/**\n+     * States of the settings for each property\n+     *\/\n+    private State[] states;\n+\n+    \/**\n+     * Flag indicating if secure processing is set\n+     *\/\n+    boolean secureProcessing;\n+\n+    \/**\n+     * States that determine if properties are set explicitly\n+     *\/\n+    private boolean[] isSet;\n+\n+\n+    \/**\n+     * Index of the special entityCountInfo property\n+     *\/\n+    private final int indexEntityCountInfo = 10000;\n+    private String printEntityCountInfo = \"\";\n+\n+    \/**\n+     * Default constructor. Establishes default values for known security\n+     * vulnerabilities.\n+     *\/\n+    public XMLSecurityManager() {\n+        this(false);\n+    }\n+\n+    \/**\n+     * Instantiate Security Manager in accordance with the status of\n+     * secure processing\n+     * @param secureProcessing\n+     *\/\n+    public XMLSecurityManager(boolean secureProcessing) {\n+        values = new int[Limit.values().length];\n+        states = new State[Limit.values().length];\n+        isSet = new boolean[Limit.values().length];\n+        this.secureProcessing = secureProcessing;\n+        for (Limit limit : Limit.values()) {\n+            if (secureProcessing) {\n+                values[limit.ordinal()] = limit.secureValue;\n+                states[limit.ordinal()] = State.FSP;\n+            } else {\n+                values[limit.ordinal()] = limit.defaultValue();\n+                states[limit.ordinal()] = State.DEFAULT;\n+            }\n+        }\n+        \/\/read system properties or jaxp.properties\n+        readSystemProperties();\n+    }\n+\n+    \/**\n+     * Setting FEATURE_SECURE_PROCESSING explicitly\n+     *\/\n+    public void setSecureProcessing(boolean secure) {\n+        secureProcessing = secure;\n+        for (Limit limit : Limit.values()) {\n+            if (secure) {\n+                setLimit(limit.ordinal(), State.FSP, limit.secureValue());\n+            } else {\n+                setLimit(limit.ordinal(), State.FSP, limit.defaultValue());\n+            }\n+        }\n+    }\n+\n+    \/**\n+     * Return the state of secure processing\n+     * @return the state of secure processing\n+     *\/\n+    public boolean isSecureProcessing() {\n+        return secureProcessing;\n+    }\n+\n+    \/**\n+     * Finds a limit's new name with the given property name.\n+     * @param propertyName the property name specified\n+     * @return the limit's new name if found, null otherwise\n+     *\/\n+    public String find(String propertyName) {\n+        for (Limit limit : Limit.values()) {\n+            if (limit.is(propertyName)) {\n+                \/\/ current spec: new property name == systemProperty\n+                return limit.systemProperty();\n+            }\n+        }\n+        \/\/ENTITYCOUNT's new name is qName\n+        if (ImplPropMap.ENTITYCOUNT.is(propertyName)) {\n+            return ImplPropMap.ENTITYCOUNT.qName();\n+        }\n+        return null;\n+    }\n+\n+    \/**\n+     * Set limit by property name and state\n+     * @param propertyName property name\n+     * @param state the state of the property\n+     * @param value the value of the property\n+     * @return true if the property is managed by the security manager; false\n+     *              if otherwise.\n+     *\/\n+    public boolean setLimit(String propertyName, State state, Object value) {\n+        int index = getIndex(propertyName);\n+        if (index > -1) {\n+            State pState = state;\n+            if (index != indexEntityCountInfo && state == State.APIPROPERTY) {\n+                pState = (Limit.values()[index]).getState(propertyName);\n+            }\n+            setLimit(index, pState, value);\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    \/**\n+     * Set the value for a specific limit.\n+     *\n+     * @param limit the limit\n+     * @param state the state of the property\n+     * @param value the value of the property\n+     *\/\n+    public void setLimit(Limit limit, State state, int value) {\n+        setLimit(limit.ordinal(), state, value);\n+    }\n+\n+    \/**\n+     * Set the value of a property by its index\n+     *\n+     * @param index the index of the property\n+     * @param state the state of the property\n+     * @param value the value of the property\n+     *\/\n+    public void setLimit(int index, State state, Object value) {\n+        if (index == indexEntityCountInfo) {\n+            printEntityCountInfo = (String)value;\n+        } else {\n+            int temp;\n+            if (value instanceof Integer) {\n+                temp = (Integer)value;\n+            } else {\n+                temp = Integer.parseInt((String) value);\n+                if (temp < 0) {\n+                    temp = 0;\n+                }\n+            }\n+            setLimit(index, state, temp);\n+        }\n+    }\n+\n+    \/**\n+     * Set the value of a property by its index\n+     *\n+     * @param index the index of the property\n+     * @param state the state of the property\n+     * @param value the value of the property\n+     *\/\n+    public void setLimit(int index, State state, int value) {\n+        if (index == indexEntityCountInfo) {\n+            \/\/if it's explicitly set, it's treated as yes no matter the value\n+            printEntityCountInfo = JdkConstants.JDK_YES;\n+        } else {\n+            \/\/only update if it shall override\n+            if (state.compareTo(states[index]) >= 0) {\n+                values[index] = value;\n+                states[index] = state;\n+                isSet[index] = true;\n+            }\n+        }\n+    }\n+\n+    \/**\n+     * Return the value of the specified property\n+     *\n+     * @param propertyName the property name\n+     * @return the value of the property as a string. If a property is managed\n+     * by this manager, its value shall not be null.\n+     *\/\n+    public String getLimitAsString(String propertyName) {\n+        int index = getIndex(propertyName);\n+        if (index > -1) {\n+            return getLimitValueByIndex(index);\n+        }\n+\n+        return null;\n+    }\n+    \/**\n+     * Return the value of the specified property\n+     *\n+     * @param limit the property\n+     * @return the value of the property\n+     *\/\n+    public int getLimit(Limit limit) {\n+        return values[limit.ordinal()];\n+    }\n+\n+    \/**\n+     * Return the value of a property by its ordinal\n+     *\n+     * @param limit the property\n+     * @return value of a property\n+     *\/\n+    public String getLimitValueAsString(Limit limit) {\n+        return Integer.toString(values[limit.ordinal()]);\n+    }\n+\n+    \/**\n+     * Return the value of a property by its ordinal\n+     *\n+     * @param index the index of a property\n+     * @return limit of a property as a string\n+     *\/\n+    public String getLimitValueByIndex(int index) {\n+        if (index == indexEntityCountInfo) {\n+            return printEntityCountInfo;\n+        }\n+\n+        return Integer.toString(values[index]);\n+    }\n+\n+    \/**\n+     * Return the state of the limit property\n+     *\n+     * @param limit the limit\n+     * @return the state of the limit property\n+     *\/\n+    public State getState(Limit limit) {\n+        return states[limit.ordinal()];\n+    }\n+\n+    \/**\n+     * Return the state of the limit property\n+     *\n+     * @param limit the limit\n+     * @return the state of the limit property\n+     *\/\n+    public String getStateLiteral(Limit limit) {\n+        return states[limit.ordinal()].literal();\n+    }\n+\n+    \/**\n+     * Get the index by property name\n+     *\n+     * @param propertyName property name\n+     * @return the index of the property if found; return -1 if not\n+     *\/\n+    public int getIndex(String propertyName) {\n+        for (Limit limit : Limit.values()) {\n+            \/\/ see JDK-8265248, accept both the URL and jdk.xml as prefix\n+            if (limit.is(propertyName)) {\n+                \/\/internally, ordinal is used as index\n+                return limit.ordinal();\n+            }\n+        }\n+        \/\/special property to return entity count info\n+        if (ImplPropMap.ENTITYCOUNT.is(propertyName)) {\n+            return indexEntityCountInfo;\n+        }\n+        return -1;\n+    }\n+\n+    \/**\n+     * Check if there's no limit defined by the Security Manager\n+     * @param limit\n+     * @return\n+     *\/\n+    public boolean isNoLimit(int limit) {\n+        return limit == NO_LIMIT;\n+    }\n+    \/**\n+     * Check if the size (length or count) of the specified limit property is\n+     * over the limit\n+     *\n+     * @param limit the type of the limit property\n+     * @param entityName the name of the entity\n+     * @param size the size (count or length) of the entity\n+     * @return true if the size is over the limit, false otherwise\n+     *\/\n+    public boolean isOverLimit(Limit limit, String entityName, int size,\n+            XMLLimitAnalyzer limitAnalyzer) {\n+        return isOverLimit(limit.ordinal(), entityName, size, limitAnalyzer);\n+    }\n+\n+    \/**\n+     * Check if the value (length or count) of the specified limit property is\n+     * over the limit\n+     *\n+     * @param index the index of the limit property\n+     * @param entityName the name of the entity\n+     * @param size the size (count or length) of the entity\n+     * @return true if the size is over the limit, false otherwise\n+     *\/\n+    public boolean isOverLimit(int index, String entityName, int size,\n+            XMLLimitAnalyzer limitAnalyzer) {\n+        if (values[index] == NO_LIMIT) {\n+            return false;\n+        }\n+        if (size > values[index]) {\n+            limitAnalyzer.addValue(index, entityName, size);\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    \/**\n+     * Check against cumulated value\n+     *\n+     * @param limit the type of the limit property\n+     * @param size the size (count or length) of the entity\n+     * @return true if the size is over the limit, false otherwise\n+     *\/\n+    public boolean isOverLimit(Limit limit, XMLLimitAnalyzer limitAnalyzer) {\n+        return isOverLimit(limit.ordinal(), limitAnalyzer);\n+    }\n+\n+    public boolean isOverLimit(int index, XMLLimitAnalyzer limitAnalyzer) {\n+        if (values[index] == NO_LIMIT) {\n+            return false;\n+        }\n+\n+        if (index == Limit.ELEMENT_ATTRIBUTE_LIMIT.ordinal() ||\n+                index == Limit.ENTITY_EXPANSION_LIMIT.ordinal() ||\n+                index == Limit.TOTAL_ENTITY_SIZE_LIMIT.ordinal() ||\n+                index == Limit.ENTITY_REPLACEMENT_LIMIT.ordinal() ||\n+                index == Limit.MAX_ELEMENT_DEPTH_LIMIT.ordinal() ||\n+                index == Limit.MAX_NAME_LIMIT.ordinal()\n+                ) {\n+            return (limitAnalyzer.getTotalValue(index) > values[index]);\n+        } else {\n+            return (limitAnalyzer.getValue(index) > values[index]);\n+        }\n+    }\n+\n+    public void debugPrint(XMLLimitAnalyzer limitAnalyzer) {\n+        if (printEntityCountInfo.equals(JdkConstants.JDK_YES)) {\n+            limitAnalyzer.debugPrint(this);\n+        }\n+    }\n+\n+\n+    \/**\n+     * Indicate if a property is set explicitly\n+     * @param index\n+     * @return\n+     *\/\n+    public boolean isSet(int index) {\n+        return isSet[index];\n+    }\n+\n+    public boolean printEntityCountInfo() {\n+        return printEntityCountInfo.equals(JdkConstants.JDK_YES);\n+    }\n+\n+    \/**\n+     * Read from system properties, or those in jaxp.properties\n+     *\/\n+    private void readSystemProperties() {\n+\n+        for (Limit limit : Limit.values()) {\n+            if (!getSystemProperty(limit, limit.systemProperty())) {\n+                \/\/if system property is not found, try the older form if any\n+                for (NameMap nameMap : NameMap.values()) {\n+                    String oldName = nameMap.getOldName(limit.systemProperty());\n+                    if (oldName != null) {\n+                        getSystemProperty(limit, oldName);\n+                    }\n+                }\n+            }\n+        }\n+\n+    }\n+\n+    \/\/ Array list to store printed warnings for each SAX parser used\n+    private static final CopyOnWriteArrayList<String> printedWarnings = new CopyOnWriteArrayList<>();\n+\n+    \/**\n+     * Prints out warnings if a parser does not support the specified feature\/property.\n+     *\n+     * @param parserClassName the name of the parser class\n+     * @param propertyName the property name\n+     * @param exception the exception thrown by the parser\n+     *\/\n+    public static void printWarning(String parserClassName, String propertyName, SAXException exception) {\n+        String key = parserClassName+\":\"+propertyName;\n+        if (printedWarnings.addIfAbsent(key)) {\n+            System.err.println( \"Warning: \"+parserClassName+\": \"+exception.getMessage());\n+        }\n+    }\n+\n+    \/**\n+     * Read from system properties, or those in jaxp.properties\n+     *\n+     * @param property the type of the property\n+     * @param sysPropertyName the name of system property\n+     *\/\n+    private boolean getSystemProperty(Limit limit, String sysPropertyName) {\n+        try {\n+            String value = SecuritySupport.getSystemProperty(sysPropertyName);\n+            if (value != null && !value.equals(\"\")) {\n+                values[limit.ordinal()] = Integer.parseInt(value);\n+                states[limit.ordinal()] = State.SYSTEMPROPERTY;\n+                return true;\n+            }\n+\n+            value = SecuritySupport.readJAXPProperty(sysPropertyName);\n+            if (value != null && !value.equals(\"\")) {\n+                values[limit.ordinal()] = Integer.parseInt(value);\n+                states[limit.ordinal()] = State.JAXPDOTPROPERTIES;\n+                return true;\n+            }\n+        } catch (NumberFormatException e) {\n+            \/\/invalid setting\n+            throw new NumberFormatException(\"Invalid setting for system property: \" + limit.systemProperty());\n+        }\n+        return false;\n+    }\n+\n+\n+    \/**\n+     * Convert a value set through setProperty to XMLSecurityManager.\n+     * If the value is an instance of XMLSecurityManager, use it to override the default;\n+     * If the value is an old SecurityManager, convert to the new XMLSecurityManager.\n+     *\n+     * @param value user specified security manager\n+     * @param securityManager an instance of XMLSecurityManager\n+     * @return an instance of the new security manager XMLSecurityManager\n+     *\/\n+    public static XMLSecurityManager convert(Object value, XMLSecurityManager securityManager) {\n+        if (value == null) {\n+            if (securityManager == null) {\n+                securityManager = new XMLSecurityManager(true);\n+            }\n+            return securityManager;\n+        }\n+        if (value instanceof XMLSecurityManager) {\n+            return (XMLSecurityManager)value;\n+        } else {\n+            if (securityManager == null) {\n+                securityManager = new XMLSecurityManager(true);\n+            }\n+            if (value instanceof SecurityManager) {\n+                SecurityManager origSM = (SecurityManager)value;\n+                securityManager.setLimit(Limit.MAX_OCCUR_NODE_LIMIT, State.APIPROPERTY, origSM.getMaxOccurNodeLimit());\n+                securityManager.setLimit(Limit.ENTITY_EXPANSION_LIMIT, State.APIPROPERTY, origSM.getEntityExpansionLimit());\n+                securityManager.setLimit(Limit.ELEMENT_ATTRIBUTE_LIMIT, State.APIPROPERTY, origSM.getElementAttrLimit());\n+            }\n+            return securityManager;\n+        }\n+    }\n+}\n","filename":"src\/java.xml\/share\/classes\/jdk\/xml\/internal\/XMLSecurityManager.java","additions":633,"deletions":0,"binary":false,"changes":633,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -410,1 +410,1 @@\n- * <td>\n+ * <td>N\/A\n@@ -435,6 +435,7 @@\n- * <th scope=\"col\" rowspan=\"2\">System Property <a href=\"#Note2\">[2]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">jaxp.properties <a href=\"#Note2\">[2]<\/a><\/th>\n- * <th scope=\"col\" colspan=\"4\" style=\"text-align:center\">Value <a href=\"#Note3\">[3]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">Security <a href=\"#Note4\">[4]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">Supported Processor <a href=\"#Note5\">[5]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">Since <a href=\"#Note6\">[6]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">API Property <a href=\"#Note2\">[2]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">System Property <a href=\"#Note3\">[3]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">jaxp.properties <a href=\"#Note3\">[3]<\/a><\/th>\n+ * <th scope=\"col\" colspan=\"4\" style=\"text-align:center\">Value <a href=\"#Note4\">[4]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Security <a href=\"#Note5\">[5]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Supported Processor <a href=\"#Note6\">[6]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Since <a href=\"#Note7\">[7]<\/a><\/th>\n@@ -458,0 +459,1 @@\n+ * <td style=\"text-align:center\" rowspan=\"9\">yes<\/td>\n@@ -547,0 +549,1 @@\n+ * <td style=\"text-align:center\">yes<\/td>\n@@ -570,0 +573,1 @@\n+ * <td style=\"text-align:center\">yes<\/td>\n@@ -587,0 +591,1 @@\n+ * <td style=\"text-align:center\">yes<\/td>\n@@ -602,0 +607,1 @@\n+ * <td style=\"text-align:center\">yes<\/td>\n@@ -612,0 +618,40 @@\n+ * <tr>\n+ * <td id=\"extensionClassLoader\">jdk.xml.xpathExprGrpLimit<\/td>\n+ * <td>Limits the number of groups an XPath expression can contain.\n+ * <\/td>\n+ * <td style=\"text-align:center\" rowspan=\"2\">\n+ *     <a href=\"#Transform\">Transform<\/a>:yes<br>\n+ *     <a href=\"#XPATH\">XPath<\/a>:no\n+ * <\/td>\n+ * <td style=\"text-align:center\" rowspan=\"3\">yes<\/td>\n+ * <td style=\"text-align:center\" rowspan=\"3\">yes<\/td>\n+ * <td style=\"text-align:center\" rowspan=\"3\">Integer<\/td>\n+ * <td rowspan=\"3\">A positive integer. A value less than or equal to 0 indicates no limit.\n+ * If the value is not an integer, a NumberFormatException is thrown. <\/td>\n+ * <td style=\"text-align:center\">10<\/td>\n+ * <td style=\"text-align:center\">10<\/td>\n+ * <td style=\"text-align:center\" rowspan=\"3\">Yes<\/td>\n+ * <td style=\"text-align:center\" rowspan=\"2\">\n+ *     <a href=\"#Transform\">Transform<\/a><br>\n+ *     <a href=\"#XPath\">XPath<\/a>\n+ * <\/td>\n+ * <td style=\"text-align:center\" rowspan=\"3\">19<\/td>\n+ * <\/tr>\n+ * <tr>\n+ * <td id=\"extensionClassLoader\">jdk.xml.xpathExprOpLimit<\/td>\n+ * <td>Limits the number of operators an XPath expression can contain.\n+ * <\/td>\n+ * <td style=\"text-align:center\">100<\/td>\n+ * <td style=\"text-align:center\">100<\/td>\n+ * <\/tr>\n+ * <tr>\n+ * <td id=\"extensionClassLoader\">jdk.xml.xpathTotalOpLimit<\/td>\n+ * <td>Limits the total number of XPath operators in an XSL Stylesheet.\n+ * <\/td>\n+ * <td style=\"text-align:center\">yes<\/td>\n+ * <td style=\"text-align:center\">10000<\/td>\n+ * <td style=\"text-align:center\">10000<\/td>\n+ * <td style=\"text-align:center\">\n+ *     <a href=\"#Transform\">Transform<\/a><br>\n+ * <\/td>\n+ * <\/tr>\n@@ -625,6 +671,7 @@\n- * <th scope=\"col\" rowspan=\"2\">System Property <a href=\"#Note2\">[2]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">jaxp.properties <a href=\"#Note2\">[2]<\/a><\/th>\n- * <th scope=\"col\" colspan=\"4\" style=\"text-align:center\">Value <a href=\"#Note3\">[3]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">Security <a href=\"#Note4\">[4]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">Supported Processor <a href=\"#Note5\">[5]<\/a><\/th>\n- * <th scope=\"col\" rowspan=\"2\">Since <a href=\"#Note6\">[6]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">API Property <a href=\"#Note2\">[2]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">System Property <a href=\"#Note3\">[3]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">jaxp.properties <a href=\"#Note3\">[3]<\/a><\/th>\n+ * <th scope=\"col\" colspan=\"4\" style=\"text-align:center\">Value <a href=\"#Note4\">[4]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Security <a href=\"#Note5\">[5]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Supported Processor <a href=\"#Note6\">[6]<\/a><\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Since <a href=\"#Note7\">[7]<\/a><\/th>\n@@ -646,0 +693,1 @@\n+ * <td style=\"text-align:center\" rowspan=\"3\">yes<\/td>\n@@ -703,1 +751,4 @@\n- * <b>[2]<\/b> A value \"yes\" indicates there is a corresponding System Property\n+ * <b>[2]<\/b> A value \"yes\" indicates that the property can be set through the\n+ * processor or its factory, \"no\" otherwise.\n+ * <p id=\"Note3\">\n+ * <b>[3]<\/b> A value \"yes\" indicates there is a corresponding System Property\n@@ -706,2 +757,2 @@\n- * <p id=\"Note3\">\n- * <b>[3]<\/b> The value must be exactly as listed in this table, case-sensitive.\n+ * <p id=\"Note4\">\n+ * <b>[4]<\/b> The value must be exactly as listed in this table, case-sensitive.\n@@ -716,2 +767,2 @@\n- * <p id=\"Note4\">\n- * <b>[4]<\/b> A value \"yes\" indicates the property is a Security Property. Refer\n+ * <p id=\"Note5\">\n+ * <b>[5]<\/b> A value \"yes\" indicates the property is a Security Property. Refer\n@@ -720,3 +771,0 @@\n- * <p id=\"Note5\">\n- * <b>[5]<\/b> One or more processors that support the property. The values of the\n- * field are IDs described in table <a href=\"#Processor\">Processors<\/a>.\n@@ -724,1 +772,4 @@\n- * <b>[6]<\/b> Indicates the initial release the property is introduced.\n+ * <b>[6]<\/b> One or more processors that support the property. The values of the\n+ * field are IDs described in table <a href=\"#Processor\">Processors<\/a>.\n+ * <p id=\"Note7\">\n+ * <b>[7]<\/b> Indicates the initial release the property is introduced.\n","filename":"src\/java.xml\/share\/classes\/module-info.java","additions":74,"deletions":23,"binary":false,"changes":97,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,24 @@\n-import java.awt.*;\n-import java.awt.event.*;\n+import java.awt.Color;\n+import java.awt.Component;\n+import java.awt.Cursor;\n+import java.awt.Dimension;\n+import java.awt.EventQueue;\n+import java.awt.Font;\n+import java.awt.FontMetrics;\n+import java.awt.GraphicsConfiguration;\n+import java.awt.GraphicsDevice;\n+import java.awt.GraphicsEnvironment;\n+import java.awt.IllegalComponentStateException;\n+import java.awt.KeyboardFocusManager;\n+import java.awt.Point;\n+import java.awt.Rectangle;\n+import java.awt.Toolkit;\n+import java.awt.event.ActionEvent;\n+import java.awt.event.FocusEvent;\n+import java.awt.event.FocusListener;\n+import java.awt.event.InvocationEvent;\n+import java.awt.event.KeyEvent;\n+import java.awt.event.MouseEvent;\n+import java.awt.event.MouseListener;\n+import java.awt.event.WindowEvent;\n+import java.awt.event.WindowListener;\n@@ -31,11 +53,0 @@\n-import java.util.*;\n-import java.lang.*;\n-import java.lang.reflect.*;\n-\n-import java.beans.*;\n-import javax.swing.*;\n-import javax.swing.event.*;\n-import javax.swing.text.*;\n-import javax.swing.tree.*;\n-import javax.swing.table.*;\n-import javax.swing.plaf.TreeUI;\n@@ -43,3 +54,69 @@\n-import javax.accessibility.*;\n-import com.sun.java.accessibility.util.*;\n-import java.awt.geom.Rectangle2D;\n+import java.beans.PropertyChangeEvent;\n+import java.beans.PropertyChangeListener;\n+import java.lang.reflect.Field;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.util.ArrayList;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.StringTokenizer;\n+import java.util.Vector;\n+import java.util.WeakHashMap;\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import javax.accessibility.Accessible;\n+import javax.accessibility.AccessibleAction;\n+import javax.accessibility.AccessibleComponent;\n+import javax.accessibility.AccessibleContext;\n+import javax.accessibility.AccessibleEditableText;\n+import javax.accessibility.AccessibleExtendedComponent;\n+import javax.accessibility.AccessibleExtendedTable;\n+import javax.accessibility.AccessibleHyperlink;\n+import javax.accessibility.AccessibleHypertext;\n+import javax.accessibility.AccessibleIcon;\n+import javax.accessibility.AccessibleKeyBinding;\n+import javax.accessibility.AccessibleRelation;\n+import javax.accessibility.AccessibleRelationSet;\n+import javax.accessibility.AccessibleRole;\n+import javax.accessibility.AccessibleSelection;\n+import javax.accessibility.AccessibleState;\n+import javax.accessibility.AccessibleStateSet;\n+import javax.accessibility.AccessibleTable;\n+import javax.accessibility.AccessibleText;\n+import javax.accessibility.AccessibleValue;\n+\n+import javax.swing.Icon;\n+import javax.swing.ImageIcon;\n+import javax.swing.JMenuItem;\n+import javax.swing.JPopupMenu;\n+import javax.swing.JRootPane;\n+import javax.swing.JTable;\n+import javax.swing.JTree;\n+import javax.swing.KeyStroke;\n+import javax.swing.MenuElement;\n+import javax.swing.MenuSelectionManager;\n+import javax.swing.event.CaretEvent;\n+import javax.swing.event.CaretListener;\n+import javax.swing.event.ChangeEvent;\n+import javax.swing.event.ChangeListener;\n+import javax.swing.event.MenuEvent;\n+import javax.swing.event.MenuListener;\n+import javax.swing.event.PopupMenuEvent;\n+import javax.swing.event.PopupMenuListener;\n+import javax.swing.plaf.TreeUI;\n+import javax.swing.table.TableCellRenderer;\n+import javax.swing.text.AttributeSet;\n+import javax.swing.text.BadLocationException;\n+import javax.swing.text.JTextComponent;\n+import javax.swing.text.StyleConstants;\n+import javax.swing.text.TabSet;\n+import javax.swing.tree.TreeCellRenderer;\n+import javax.swing.tree.TreeModel;\n+import javax.swing.tree.TreePath;\n+\n+import com.sun.java.accessibility.util.AWTEventMonitor;\n+import com.sun.java.accessibility.util.AccessibilityEventMonitor;\n+import com.sun.java.accessibility.util.EventQueueMonitor;\n+import com.sun.java.accessibility.util.SwingEventMonitor;\n+import com.sun.java.accessibility.util.Translator;\n@@ -50,3 +127,0 @@\n-import java.util.concurrent.Callable;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n@@ -7148,1 +7222,1 @@\n-         * @return true if the the action was performed; else false.\n+         * @return true if the action was performed; else false.\n","filename":"src\/jdk.accessibility\/windows\/classes\/com\/sun\/java\/accessibility\/internal\/AccessBridge.java","additions":95,"deletions":21,"binary":false,"changes":116,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1202,0 +1202,1 @@\n+                    final int savedPos = bp;\n@@ -1204,1 +1205,1 @@\n-                    throw new ParseException(pos, \"dc.unexpected.content\");\n+                    throw new ParseException(savedPos, \"dc.unexpected.content\");\n@@ -1259,0 +1260,1 @@\n+                    final int errorPos = bp;\n@@ -1261,1 +1263,1 @@\n-                    throw new ParseException(pos, \"dc.unexpected.content\");\n+                    throw new ParseException(errorPos, \"dc.unexpected.content\");\n@@ -1311,1 +1313,1 @@\n-                            throw new ParseException(\"dc.gt.expected\");\n+                            throw new ParseException(bp, \"dc.gt.expected\");\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/parser\/DocCommentParser.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,6 +90,0 @@\n-    private static void debug(Object o) {\n-        if (DEBUG) {\n-            System.out.println(o);\n-        }\n-    }\n-\n@@ -551,1 +545,3 @@\n-        debug(st);\n+        if (DEBUG)  {\n+            System.out.println(st);\n+        }\n@@ -598,1 +594,3 @@\n-        debug(keyword + \": \" + value);\n+        if (DEBUG) {\n+            System.out.println(keyword + \": \" + value);\n+        }\n@@ -606,1 +604,3 @@\n-        debug(keyword + \": \" + value);\n+        if (DEBUG) {\n+            System.out.println(keyword + \": \" + value);\n+        }\n@@ -614,1 +614,3 @@\n-        debug(keyword + \": \" + value);\n+        if (DEBUG) {\n+            System.out.println(keyword + \": \" + value);\n+        }\n@@ -719,1 +721,3 @@\n-        debug(keyword + \": \" + lib);\n+        if (DEBUG) {\n+            System.out.println(keyword + \": \" + lib);\n+        }\n@@ -734,1 +738,3 @@\n-        debug(\"description: \" + description);\n+        if (DEBUG) {\n+            System.out.println(\"description: \" + description);\n+        }\n@@ -748,1 +754,3 @@\n-        debug(\"slot: \" + slotID);\n+        if (DEBUG) {\n+            System.out.println(\"slot: \" + slotID);\n+        }\n@@ -762,1 +770,3 @@\n-        debug(\"slotListIndex: \" + slotListIndex);\n+        if (DEBUG) {\n+            System.out.println(\"slotListIndex: \" + slotListIndex);\n+        }\n@@ -1024,1 +1034,3 @@\n-        debug(\"nssArgs: \" + nssArgs);\n+        if (DEBUG) {\n+            System.out.println(\"nssArgs: \" + nssArgs);\n+        }\n@@ -1040,1 +1052,3 @@\n-        debug(\"handleStartupErrors: \" + handleStartupErrors);\n+        if (DEBUG) {\n+            System.out.println(\"handleStartupErrors: \" + handleStartupErrors);\n+        }\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/Config.java","additions":31,"deletions":17,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,1 +28,0 @@\n-import java.lang.ref.Cleaner;\n@@ -235,2 +234,1 @@\n-                Cleaner.create().register(this,\n-                        () -> Arrays.fill(this.password, ' '));\n+                P11Util.cleaner.register(this, releaserFor(this.password));\n@@ -248,0 +246,6 @@\n+\n+        private static Runnable releaserFor(char[] password) {\n+            return () -> {\n+                Arrays.fill(password, ' ');\n+            };\n+        }\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/P11KeyStore.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+import java.lang.ref.Cleaner;\n@@ -42,0 +43,3 @@\n+    \/\/ A cleaner, shared within this module.\n+    public static final Cleaner cleaner = Cleaner.create();\n+\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/P11Util.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,0 @@\n-import java.lang.ref.Cleaner;\n@@ -60,0 +59,1 @@\n+import sun.security.pkcs11.P11Util;\n@@ -115,0 +115,3 @@\n+\n+    \/\/ Note: Please don't update this field other than the constructor.\n+    \/\/ Otherwise, the native data is not able to be collected.\n@@ -167,1 +170,1 @@\n-        Cleaner.create().register(this, this::disconnect);\n+        P11Util.cleaner.register(this, releaserFor(pNativeData));\n@@ -203,0 +206,8 @@\n+    private static Runnable releaserFor(long pNativeData) {\n+        return () -> {\n+            if (pNativeData != 0) {\n+                PKCS11.disconnect(pNativeData);\n+            }\n+        };\n+    }\n+\n@@ -207,1 +218,1 @@\n-     * native part.\n+     * native part.  Please don't use this method other than the constructor.\n@@ -223,1 +234,3 @@\n-     * internal use only.\n+     * internal use only.  Please don't use this method other than finalization\n+     * as implemented in the releaserFor() method.\n+     *\n@@ -230,1 +243,1 @@\n-    private native void disconnect();\n+    private static native void disconnect(long pNativeData);\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/wrapper\/PKCS11.java","additions":19,"deletions":6,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -168,15 +168,0 @@\n-\n-\/*\n- * Removes the entry for the given pkcs11Implementation from the list. Returns\n- * the module's data, after the node was removed. If this function returns NULL\n- * the pkcs11Implementation was not in the list.\n- *\/\n-ModuleData * removeModuleEntry(JNIEnv *env, jobject pkcs11Implementation) {\n-    ModuleData *moduleData = getModuleEntry(env, pkcs11Implementation);\n-    if (moduleData == NULL) {\n-        return NULL;\n-    }\n-    (*env)->SetLongField(env, pkcs11Implementation, pNativeDataID, 0);\n-    return moduleData;\n-}\n-\n","filename":"src\/jdk.crypto.cryptoki\/share\/native\/libj2pkcs11\/p11_util.c","additions":1,"deletions":16,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -419,1 +419,0 @@\n-ModuleData * removeModuleEntry(JNIEnv *env, jobject pkcs11Implementation);\n","filename":"src\/jdk.crypto.cryptoki\/share\/native\/libj2pkcs11\/pkcs11wrapper.h","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -265,1 +265,1 @@\n- * Signature: ()V\n+ * Signature: (J)V\n@@ -267,4 +267,3 @@\n-JNIEXPORT void JNICALL Java_sun_security_pkcs11_wrapper_PKCS11_disconnect\n-    (JNIEnv *env, jobject obj)\n-{\n-    ModuleData *moduleData;\n+JNIEXPORT void JNICALL Java_sun_security_pkcs11_wrapper_PKCS11_disconnect(\n+        JNIEnv *env, jclass thisClass, jlong ckpNativeData) {\n+\n@@ -272,1 +271,2 @@\n-    moduleData = removeModuleEntry(env, obj);\n+    if (ckpNativeData != 0L) {\n+        ModuleData *moduleData = jlong_to_ptr(ckpNativeData);\n@@ -274,2 +274,5 @@\n-    if (moduleData != NULL) {\n-        dlclose(moduleData->hModule);\n+        if (moduleData->hModule != NULL) {\n+            dlclose(moduleData->hModule);\n+        }\n+\n+        free(moduleData);\n@@ -278,1 +281,0 @@\n-    free(moduleData);\n@@ -280,1 +282,0 @@\n-\n","filename":"src\/jdk.crypto.cryptoki\/unix\/native\/libj2pkcs11\/p11_md.c","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -278,1 +278,1 @@\n- * Signature: ()V\n+ * Signature: (J)V\n@@ -280,4 +280,3 @@\n-JNIEXPORT void JNICALL Java_sun_security_pkcs11_wrapper_PKCS11_disconnect\n-    (JNIEnv *env, jobject obj)\n-{\n-    ModuleData *moduleData;\n+JNIEXPORT void JNICALL Java_sun_security_pkcs11_wrapper_PKCS11_disconnect(\n+        JNIEnv *env, jclass thisClass, jlong ckpNativeData) {\n+\n@@ -285,1 +284,2 @@\n-    moduleData = removeModuleEntry(env, obj);\n+    if (ckpNativeData != 0L) {\n+        ModuleData *moduleData = jlong_to_ptr(ckpNativeData);\n@@ -287,2 +287,5 @@\n-    if (moduleData != NULL) {\n-        FreeLibrary(moduleData->hModule);\n+        if (moduleData->hModule != NULL) {\n+            FreeLibrary(moduleData->hModule);\n+        }\n+\n+        free(moduleData);\n@@ -291,1 +294,0 @@\n-    free(moduleData);\n","filename":"src\/jdk.crypto.cryptoki\/windows\/native\/libj2pkcs11\/p11_md.c","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import java.math.BigInteger;\n@@ -203,1 +204,2 @@\n-        int length = (orderField.getSize().bitLength() + 7) \/ 8;\n+        BigInteger mod = orderField.getSize();\n+        int length = (mod.bitLength() + 7) \/ 8;\n@@ -221,0 +223,7 @@\n+        BigInteger rb = new BigInteger(1, r);\n+        BigInteger sb = new BigInteger(1, s);\n+        if (rb.signum() == 0 || sb.signum() == 0\n+                || rb.compareTo(mod) >= 0 || sb.compareTo(mod) >= 0) {\n+            return false;\n+        }\n+\n","filename":"src\/jdk.crypto.ec\/share\/classes\/sun\/security\/ec\/ECDSAOperations.java","additions":11,"deletions":2,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_acos.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_acos_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_asin.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_asin_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_atan2.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_atan2_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_atan.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_atan_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_cbrt.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_cbrt_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_cos.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_cos_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_cosh.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_cosh_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_exp.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_exp_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_expm1.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_expm1_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_hypot.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_hypot_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_log10.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_log10_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_log1p.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_log1p_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_log.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_log_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_pow.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_pow_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_sin.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_sin_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_sinh.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_sinh_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_tan.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_tan_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_d_tanh.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_d_tanh_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_acos.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_acos_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_asin.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_asin_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_atan2.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_atan2_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_atan.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_atan_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_cbrt.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_cbrt_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_cos.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_cos_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_cosh.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_cosh_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_exp.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_exp_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_expm1.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_expm1_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_hypot.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_hypot_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_log10.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_log10_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_log1p.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_log1p_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_log.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_log_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_pow.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_pow_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_sin.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_sin_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_sinh.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_sinh_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_tan.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_tan_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Intel Corporation. All rights reserved.\n+ * Copyright (c) 2018, 2022, Intel Corporation. All rights reserved.\n@@ -31,1 +31,0 @@\n-\t.file \"svml_s_tanh.c\"\n","filename":"src\/jdk.incubator.vector\/linux\/native\/libjsvml\/jsvml_s_tanh_linux_x86.S","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -181,0 +181,1 @@\n+        SVEBITPERM,\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.aarch64\/src\/jdk\/vm\/ci\/aarch64\/AArch64.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -286,2 +286,0 @@\n-    \/\/ TODO resolving JVM_CONSTANT_Dynamic\n-\n@@ -298,5 +296,27 @@\n-     * If {@code cpi} denotes an entry representing a\n-     * <a href=\"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-2.html#jvms-2.9\">signature\n-     * polymorphic<\/a> method, this method ensures that the type referenced by the entry is loaded\n-     * and initialized. It {@code cpi} does not denote a signature polymorphic method, this method\n-     * does nothing.\n+     * Resolves the details for invoking the bootstrap method associated with the\n+     * {@code CONSTANT_Dynamic_info} or @{code CONSTANT_InvokeDynamic_info} entry at {@code cpi} in\n+     * {@code constant pool}.\n+     *\n+     * The return value encodes the details in an object array that is described by the pseudo Java\n+     * object {@code info} below:\n+     *\n+     * <pre>\n+     *     bsm_invocation = [\n+     *         ResolvedJavaMethod[] method,\n+     *         String name,\n+     *         Object type,             \/\/ JavaConstant: reference to Class (condy) or MethodType (indy)\n+     *         Object staticArguments,  \/\/ null: no static arguments\n+     *                                  \/\/ JavaConstant: single static argument\n+     *                                  \/\/ JavaConstant[]: multiple static arguments\n+     *                                  \/\/ int[]: static arguments to be resolved via BootstrapCallInfo\n+     *     ]\n+     * <\/pre>\n+     *\n+     * @return bootstrap method invocation details as encoded above\n+     *\/\n+    native Object[] resolveBootstrapMethod(HotSpotConstantPool constantPool, int cpi);\n+\n+    \/**\n+     * If {@code cpi} denotes an entry representing a signature polymorphic method ({@jvms 2.9}),\n+     * this method ensures that the type referenced by the entry is loaded and initialized. It\n+     * {@code cpi} does not denote a signature polymorphic method, this method does nothing.\n@@ -382,16 +402,0 @@\n-    \/**\n-     * Generates the VM metadata for some compiled code and copies them into {@code metaData}. This\n-     * method does not install anything into the code cache.\n-     *\n-     * @param target the target where this code would be installed\n-     * @param compiledCode the result of a compilation\n-     * @param metaData the metadata is written to this object\n-     * @return the outcome of the installation which will be one of\n-     *         {@link HotSpotVMConfig#codeInstallResultOk},\n-     *         {@link HotSpotVMConfig#codeInstallResultCacheFull},\n-     *         {@link HotSpotVMConfig#codeInstallResultCodeTooLarge} or\n-     *         {@link HotSpotVMConfig#codeInstallResultDependenciesFailed}.\n-     * @throws JVMCIError if there is something wrong with the compiled code or the metadata\n-     *\/\n-    native int getMetadata(TargetDescription target, HotSpotCompiledCode compiledCode, HotSpotMetaData metaData);\n-\n@@ -691,8 +695,0 @@\n-    \/**\n-     * Gets the fingerprint for a given Klass*.\n-     *\n-     * @param metaspaceKlass\n-     * @return the value of the fingerprint (zero for arrays and synthetic classes).\n-     *\/\n-    native long getFingerprint(long metaspaceKlass);\n-\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/CompilerToVM.java","additions":27,"deletions":31,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -30,0 +30,5 @@\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n@@ -521,0 +526,87 @@\n+    static class BootstrapMethodInvocationImpl implements BootstrapMethodInvocation {\n+        private final boolean indy;\n+        private final ResolvedJavaMethod method;\n+        private final String name;\n+        private final JavaConstant type;\n+        private final List<JavaConstant> staticArguments;\n+\n+        BootstrapMethodInvocationImpl(boolean indy, ResolvedJavaMethod method, String name, JavaConstant type, List<JavaConstant> staticArguments) {\n+            this.indy = indy;\n+            this.method = method;\n+            this.name = name;\n+            this.type = type;\n+            this.staticArguments = staticArguments;\n+        }\n+\n+        @Override\n+        public ResolvedJavaMethod getMethod() {\n+            return method;\n+        }\n+\n+        @Override\n+        public String getName() {\n+            return name;\n+        }\n+\n+        @Override\n+        public boolean isInvokeDynamic() {\n+            return indy;\n+        }\n+\n+        @Override\n+        public JavaConstant getType() {\n+            return type;\n+        }\n+\n+        @Override\n+        public List<JavaConstant> getStaticArguments() {\n+            return staticArguments;\n+        }\n+\n+        @Override\n+        public String toString() {\n+            String static_args = staticArguments.stream().map(BootstrapMethodInvocationImpl::argumentAsString).collect(Collectors.joining(\", \", \"[\", \"]\"));\n+            return \"BootstrapMethod[\" + (indy ? \"indy\" : \"condy\") +\n+                            \", method:\" + method.format(\"%H.%n(%p)\") +\n+                            \", name: \" + name +\n+                            \", type: \" + type.toValueString() +\n+                            \", static arguments:\" + static_args;\n+        }\n+\n+        private static String argumentAsString(JavaConstant arg) {\n+            String type = arg.getJavaKind().getJavaName();\n+            String value = arg.toValueString();\n+            return type + \":\" + value;\n+        }\n+    }\n+\n+    @Override\n+    public BootstrapMethodInvocation lookupBootstrapMethodInvocation(int rawCpi, int opcode) {\n+        int cpi = opcode == -1 ? rawCpi : rawIndexToConstantPoolIndex(rawCpi, opcode);\n+        final JvmConstant tag = getTagAt(cpi);\n+        switch (tag.name) {\n+            case \"InvokeDynamic\":\n+            case \"Dynamic\":\n+                Object[] bsmi = compilerToVM().resolveBootstrapMethod(this, cpi);\n+                ResolvedJavaMethod method = (ResolvedJavaMethod) bsmi[0];\n+                String name = (String) bsmi[1];\n+                JavaConstant type = (JavaConstant) bsmi[2];\n+                Object staticArguments = bsmi[3];\n+                List<JavaConstant> staticArgumentsList;\n+                if (staticArguments == null) {\n+                    staticArgumentsList = List.of();\n+                } else if (staticArguments instanceof JavaConstant) {\n+                    staticArgumentsList = List.of((JavaConstant) staticArguments);\n+                } else if (staticArguments instanceof JavaConstant[]) {\n+                    staticArgumentsList = List.of((JavaConstant[]) staticArguments);\n+                } else {\n+                    int[] bsciArgs = (int[]) staticArguments;\n+                    String message = String.format(\"Resolving bootstrap static arguments for %s using BootstrapCallInfo %s not supported\", method.format(\"%H.%n(%p)\"), Arrays.toString(bsciArgs));\n+                    throw new IllegalArgumentException(message);\n+                }\n+                return new BootstrapMethodInvocationImpl(tag.name.equals(\"InvokeDynamic\"), method, name, type, staticArgumentsList);\n+            default:\n+                return null;\n+        }\n+    }\n+\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/HotSpotConstantPool.java","additions":92,"deletions":0,"binary":false,"changes":92,"status":"modified"},{"patch":"@@ -1,77 +0,0 @@\n-\/*\n- * Copyright (c) 2014, 2017, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-package jdk.vm.ci.hotspot;\n-\n-import static jdk.vm.ci.hotspot.HotSpotJVMCIRuntime.runtime;\n-\n-import jdk.vm.ci.code.TargetDescription;\n-\n-public class HotSpotMetaData {\n-    private byte[] pcDescBytes;\n-    private byte[] scopesDescBytes;\n-    private byte[] relocBytes;\n-    private byte[] exceptionBytes;\n-    private byte[] implicitExceptionBytes;\n-    private byte[] oopMaps;\n-    private Object[] metadata;\n-\n-    public HotSpotMetaData(TargetDescription target, HotSpotCompiledCode compiledMethod) {\n-        \/\/ Assign the fields default values...\n-        pcDescBytes = new byte[0];\n-        scopesDescBytes = new byte[0];\n-        relocBytes = new byte[0];\n-        exceptionBytes = new byte[0];\n-        oopMaps = new byte[0];\n-        metadata = new String[0];\n-        \/\/ ...some of them will be overwritten by the VM:\n-        runtime().getCompilerToVM().getMetadata(target, compiledMethod, this);\n-    }\n-\n-    public byte[] pcDescBytes() {\n-        return pcDescBytes;\n-    }\n-\n-    public byte[] scopesDescBytes() {\n-        return scopesDescBytes;\n-    }\n-\n-    public byte[] relocBytes() {\n-        return relocBytes;\n-    }\n-\n-    public byte[] exceptionBytes() {\n-        return exceptionBytes;\n-    }\n-\n-    public byte[] implicitExceptionBytes() {\n-        return implicitExceptionBytes;\n-    }\n-\n-    public byte[] oopMaps() {\n-        return oopMaps;\n-    }\n-\n-    public Object[] metadataEntries() {\n-        return metadata;\n-    }\n-}\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/HotSpotMetaData.java","additions":0,"deletions":77,"binary":false,"changes":77,"status":"deleted"},{"patch":"@@ -110,8 +110,0 @@\n-\n-    \/**\n-     * Gets the fingerprint for this type.\n-     *\n-     * @return the value of the fingerprint ({@code 0} for arrays and synthetic classes or if the VM\n-     *         does not support fingerprints)\n-     *\/\n-    long getFingerprint();\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/HotSpotResolvedObjectType.java","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -528,5 +528,0 @@\n-    @Override\n-    public long getFingerprint() {\n-        return compilerToVM().getFingerprint(getMetaspaceKlass());\n-    }\n-\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/HotSpotResolvedObjectTypeImpl.java","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -33,3 +33,3 @@\n-     * The name of the class declaring the intrinsified method. The name is in\n-     * <a href=\"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-4.html#jvms-4.2.1\">class\n-     * file format<\/a> (e.g., {@code \"java\/lang\/Thread\"} instead of {@code \"java.lang.Thread\"}).\n+     * The name of the class declaring the intrinsified method. The name is in class file format\n+     * (see JVMS {@jvms 4.2.1}). For example, {@code \"java\/lang\/Thread\"} instead of\n+     * {@code \"java.lang.Thread\"}.\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/VMIntrinsicMethod.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -25,0 +25,3 @@\n+import java.lang.invoke.MethodType;\n+import java.util.List;\n+\n@@ -87,0 +90,59 @@\n+    \/**\n+     * The details for invoking a bootstrap method associated with a {@code CONSTANT_Dynamic_info}\n+     * or {@code CONSTANT_InvokeDynamic_info} pool entry .\n+     *\n+     * @jvms 4.4.10 The {@code CONSTANT_Dynamic_info} and {@code CONSTANT_InvokeDynamic_info}\n+     *       Structures\n+     * @jvms 4.7.23 The {@code BootstrapMethods} Attribute\n+     *\/\n+    interface BootstrapMethodInvocation {\n+        \/**\n+         * Gets the bootstrap method that will be invoked.\n+         *\/\n+        ResolvedJavaMethod getMethod();\n+\n+        \/**\n+         * Returns {@code true} if this bootstrap method invocation is for a\n+         * {@code CONSTANT_InvokeDynamic_info} pool entry, {@code false} if it is for a\n+         * {@code CONSTANT_Dynamic_info} entry.\n+         *\/\n+        boolean isInvokeDynamic();\n+\n+        \/**\n+         * Gets the name of the pool entry.\n+         *\/\n+        String getName();\n+\n+        \/**\n+         * Returns a reference to the {@link MethodType} ({@code this.isInvokeDynamic() == true}) or\n+         * {@link Class} ({@code this.isInvokeDynamic() == false}) resolved for the descriptor of\n+         * the pool entry.\n+         *\/\n+        JavaConstant getType();\n+\n+        \/**\n+         * Gets the static arguments with which the bootstrap method will be invoked.\n+         *\n+         * @jvms 5.4.3.6\n+         *\/\n+        List<JavaConstant> getStaticArguments();\n+    }\n+\n+    \/**\n+     * Gets the details for invoking a bootstrap method associated with the\n+     * {@code CONSTANT_Dynamic_info} or {@code CONSTANT_InvokeDynamic_info} pool entry {@code cpi}\n+     * in the constant pool.\n+     *\n+     * @param cpi a constant pool index\n+     * @param opcode the opcode of the instruction that has {@code cpi} as an operand or -1 if\n+     *            {@code cpi} was not decoded from an instruction stream\n+     * @return the bootstrap method invocation details or {@code null} if the entry at {@code cpi}\n+     *         is not a {@code CONSTANT_Dynamic_info} or @{code CONSTANT_InvokeDynamic_info}\n+     * @throws IllegalArgumentException if the bootstrap method invocation makes use of\n+     *             {@code java.lang.invoke.BootstrapCallInfo}\n+     * @jvms 4.7.23 The {@code BootstrapMethods} Attribute\n+     *\/\n+    default BootstrapMethodInvocation lookupBootstrapMethodInvocation(int cpi, int opcode) {\n+        throw new UnsupportedOperationException();\n+    }\n+\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/ConstantPool.java","additions":62,"deletions":0,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -104,4 +104,3 @@\n-     * kinds, this is the <i>FieldType<\/i> term in\n-     * <a href=\"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-4.html#jvms-4.3.2-200\">\n-     * table 4.3-A<\/a> of the JVM Specification. For {@link #Object}, the character {@code 'A'} is\n-     * returned and for {@link #Illegal}, {@code '-'} is returned.\n+     * kinds, this is the <i>FieldType<\/i> term in table 4.3-A of JVMS {@jvms 4.3.2}. For\n+     * {@link #Object}, the character {@code 'A'} is returned and for {@link #Illegal}, {@code '-'}\n+     * is returned.\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/JavaKind.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @see \"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-4.html#jvms-4.7.12\"\n+ * @jvms 4.7.12\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/LineNumberTable.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n- * @see \"https:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-4.html#jvms-4.7.13\"\n+ * @jvms 4.7.13\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/LocalVariableTable.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -86,3 +86,1 @@\n-     * Parses a\n-     * <a href=\"http:\/\/docs.oracle.com\/javase\/specs\/jvms\/se7\/html\/jvms-4.html#jvms-4.3.3\">method\n-     * descriptor<\/a> into a {@link Signature}.\n+     * Parses a method descriptor ({@jvms 4.3.3}) into a {@link Signature}.\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/MetaAccessProvider.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -88,3 +88,1 @@\n-     * Checks that the method is a\n-     * <a href=\"http:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-4.html#jvms-4.6\">varargs<\/a>\n-     * method.\n+     * Checks if the method is a varargs method.\n@@ -93,0 +91,1 @@\n+     * @jvms 4.6\n@@ -97,3 +96,1 @@\n-     * Checks that the method is a\n-     * <a href=\"http:\/\/docs.oracle.com\/javase\/specs\/jvms\/se8\/html\/jvms-4.html#jvms-4.6\">bridge<\/a>\n-     * method.\n+     * Checks if the method is a bridge method.\n@@ -102,0 +99,1 @@\n+     * @jvms 4.6\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/ResolvedJavaMethod.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -28,2 +28,1 @@\n- * @see <a href=\"http:\/\/docs.oracle.com\/javase\/specs\/jvms\/se7\/html\/jvms-4.html#jvms-4.3.3\">Method\n- *      Descriptors<\/a>\n+ * @jvms 4.3.3\n@@ -87,3 +86,1 @@\n-     * Gets the\n-     * <a href=\"http:\/\/docs.oracle.com\/javase\/specs\/jvms\/se7\/html\/jvms-4.html#jvms-4.3.3\">method\n-     * descriptor<\/a> corresponding to this signature. For example:\n+     * Gets the method descriptor ({@jvms 4.3.3}) corresponding to this signature. For example:\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.meta\/src\/jdk\/vm\/ci\/meta\/Signature.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -466,1 +466,2 @@\n-        return !utils.hasHiddenTag(e) && utils.shouldDocument(e);\n+        \/\/ these checks are ordered in a particular way to avoid parsing unless absolutely necessary\n+        return utils.shouldDocument(e) && !utils.hasHiddenTag(e);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/VisibleMemberTable.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-main.usage=Verwendung: jdeprscan [Optionen] ''{dir|jar|class}'' ...\\n\\nOptionen:\\n        --class-path PATH\\n        --for-removal\\n        --full-version\\n  -? -h --help\\n  -l    --list\\n        --release {0}\\n  -v    --verbose\\n        --version\n+main.usage=Verwendung: jdeprscan [Optionen] '{dir|jar|class}' ...\\n\\nOptionen:\\n        --class-path PATH\\n        --for-removal\\n        --full-version\\n  -? -h --help\\n  -l    --list\\n        --release {0}\\n  -v    --verbose\\n        --version\n","filename":"src\/jdk.jdeps\/share\/classes\/com\/sun\/tools\/jdeprscan\/resources\/jdeprscan_de.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-main.usage=\\u4F7F\\u7528\\u65B9\\u6CD5: jdeprscan [options] ''{dir|jar|class}'' ...\\n\\n\\u30AA\\u30D7\\u30B7\\u30E7\\u30F3:\\n        --class-path PATH\\n        --for-removal\\n        --full-version\\n  -? -h --help\\n  -l    --list\\n        --release {0}\\n  -v    --verbose\\n        --version\n+main.usage=\\u4F7F\\u7528\\u65B9\\u6CD5: jdeprscan [options] '{dir|jar|class}' ...\\n\\n\\u30AA\\u30D7\\u30B7\\u30E7\\u30F3:\\n        --class-path PATH\\n        --for-removal\\n        --full-version\\n  -? -h --help\\n  -l    --list\\n        --release {0}\\n  -v    --verbose\\n        --version\n","filename":"src\/jdk.jdeps\/share\/classes\/com\/sun\/tools\/jdeprscan\/resources\/jdeprscan_ja.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-main.usage=\\u7528\\u6CD5\\uFF1Ajdeprscan [options] ''{dir|jar|class}'' ...\\n\\n\\u9009\\u9879\\uFF1A\\n        --class-path PATH\\n        --for-removal\\n        --full-version\\n  -? -h --help\\n  -l    --list\\n        --release {0}\\n  -v    --verbose\\n        --version\n+main.usage=\\u7528\\u6CD5\\uFF1Ajdeprscan [options] '{dir|jar|class}' ...\\n\\n\\u9009\\u9879\\uFF1A\\n        --class-path PATH\\n        --for-removal\\n        --full-version\\n  -? -h --help\\n  -l    --list\\n        --release {0}\\n  -v    --verbose\\n        --version\n","filename":"src\/jdk.jdeps\/share\/classes\/com\/sun\/tools\/jdeprscan\/resources\/jdeprscan_zh_CN.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -139,0 +139,2 @@\n+     * <p>\n+     * Only trusted disk repositories should be opened.\n@@ -169,0 +171,2 @@\n+     * <p>\n+     * Only recording files from trusted sources should be opened.\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/consumer\/EventStream.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -73,0 +73,2 @@\n+     * <p>\n+     * Only recording files from trusted sources should be used.\n@@ -250,0 +252,2 @@\n+     * <p>\n+     * Only recording files from trusted sources should be used.\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/consumer\/RecordingFile.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -69,0 +69,1 @@\n+        input.require(size, \"Metadata string pool size %d exceeds available data\" );\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/MetadataReader.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -116,1 +116,1 @@\n-            Utils.takeNap(1);\n+            input.pollWait();\n@@ -183,1 +183,1 @@\n-                Utils.takeNap(1);\n+                input.pollWait();\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/ChunkHeader.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -148,0 +148,1 @@\n+            input.setStreamed();\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/EventDirectoryStream.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+        this.input.setStreamed();\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/EventFileStream.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -217,0 +217,1 @@\n+            input.setStreamed();\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/OngoingStream.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -299,0 +299,1 @@\n+            input.require(size, \"Array size %d exceeds available data\" );\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/ParserFactory.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,1 @@\n+import jdk.jfr.internal.Utils;\n@@ -69,0 +70,1 @@\n+    private long pollCount = 1000;\n@@ -421,0 +423,9 @@\n+    \/\/ Purpose of this method is to prevent OOM by sanity check\n+    \/\/ the minimum required number of bytes against what is available in\n+    \/\/ segment\/chunk\/file\n+    public void require(int minimumBytes, String errorMessage) throws IOException {\n+        if (position + minimumBytes > size) {\n+            throw new IOException(String.format(errorMessage, minimumBytes));\n+        }\n+    }\n+\n@@ -433,0 +444,14 @@\n+    \/\/ Marks that it is OK to poll indefinitely for file update\n+    \/\/ By default, only 1000 polls are allowed\n+    public void setStreamed() {\n+        this.pollCount = Long.MAX_VALUE;\n+    }\n+\n+    \/\/ Wait for file to be updated\n+    public void pollWait() throws IOException {\n+        pollCount--;\n+        if (pollCount < 0) {\n+            throw new IOException(\"Recording file is stuck in locked stream state.\");\n+        }\n+        Utils.takeNap(1);\n+    }\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/RecordingInput.java","additions":26,"deletions":1,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -73,0 +73,1 @@\n+            input.require(size, \"String size %d exceeds available data\");\n@@ -118,0 +119,1 @@\n+            input.require(size, \"String size %d exceeds available data\");\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/StringParser.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -188,1 +188,1 @@\n-        print(text);\n+        printEscaped(text);\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/tool\/JSONWriter.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -86,1 +86,5 @@\n-        print(\" \", name, \"=\\\"\", value, \"\\\"\");\n+        print(\" \");\n+        print(name); \/\/ Only known strings\n+        print(\"=\\\"\");\n+        printEscaped(value);\n+        print(\"\\\"\");\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/tool\/XMLWriter.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2002, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,5 @@\n-import java.util.Hashtable;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n+import java.util.Locale;\n@@ -59,0 +63,18 @@\n+    private static final String PARSE_MODE_PROP = \"com.sun.jndi.dnsURLParsing\";\n+    private static final ParseMode DEFAULT_PARSE_MODE = ParseMode.COMPAT;\n+\n+    public static final ParseMode PARSE_MODE;\n+    static {\n+        PrivilegedAction<String> action = () ->\n+                System.getProperty(PARSE_MODE_PROP, DEFAULT_PARSE_MODE.toString());\n+        ParseMode parseMode = DEFAULT_PARSE_MODE;\n+        try {\n+            @SuppressWarnings(\"removal\")\n+            String mode = AccessController.doPrivileged(action);\n+            parseMode = ParseMode.valueOf(mode.toUpperCase(Locale.ROOT));\n+        } catch (Throwable t) {\n+            parseMode = DEFAULT_PARSE_MODE;\n+        } finally {\n+            PARSE_MODE = parseMode;\n+        }\n+    }\n@@ -74,1 +96,7 @@\n-            urls[i++] = new DnsUrl(st.nextToken());\n+            try {\n+                urls[i++] = new DnsUrl(validateURI(st.nextToken()));\n+            } catch (URISyntaxException e) {\n+                MalformedURLException mue = new MalformedURLException(e.getMessage());\n+                mue.initCause(e);\n+                throw mue;\n+            }\n@@ -81,0 +109,34 @@\n+    @Override\n+    protected ParseMode parseMode() {\n+        return PARSE_MODE;\n+    }\n+\n+    @Override\n+    protected final boolean isSchemeOnly(String uri) {\n+        return isDnsSchemeOnly(uri);\n+    }\n+\n+    @Override\n+    protected boolean checkSchemeOnly(String uri, String scheme) {\n+        return uri.equals(scheme + \":\") || uri.equals(scheme + \":\/\/\");\n+    }\n+\n+    @Override\n+    protected final MalformedURLException newInvalidURISchemeException(String uri) {\n+        return new MalformedURLException(\n+                uri + \" is not a valid DNS pseudo-URL\");\n+    }\n+\n+    private static boolean isDnsSchemeOnly(String uri) {\n+        return \"dns:\".equals(uri) || \"dns:\/\/\".equals(uri);\n+    }\n+\n+    private static String validateURI(String uri) throws URISyntaxException {\n+        \/\/ no validation in legacy parsing mode\n+        if (PARSE_MODE == ParseMode.LEGACY) return uri;\n+        \/\/ special case of scheme-only URIs\n+        if (isDnsSchemeOnly(uri)) return uri;\n+        \/\/ use java.net.URI to validate the uri syntax\n+        return new URI(uri).toString();\n+    }\n+\n@@ -85,2 +147,1 @@\n-            throw new MalformedURLException(\n-                    url + \" is not a valid DNS pseudo-URL\");\n+            throw newInvalidURISchemeException(url);\n","filename":"src\/jdk.naming.dns\/share\/classes\/com\/sun\/jndi\/dns\/DnsUrl.java","additions":66,"deletions":5,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2011, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,3 @@\n+import java.net.URI;\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n@@ -29,0 +32,1 @@\n+import java.util.Locale;\n@@ -34,0 +38,1 @@\n+import com.sun.jndi.toolkit.url.Uri.ParseMode;\n@@ -50,3 +55,2 @@\n-    public rmiURLContext(Hashtable<?,?> env) {\n-        super(env);\n-    }\n+    private static final String PARSE_MODE_PROP = \"com.sun.jndi.rmiURLParsing\";\n+    private static final ParseMode DEFAULT_PARSE_MODE = ParseMode.COMPAT;\n@@ -54,11 +58,13 @@\n-    \/**\n-     * Resolves the registry portion of \"url\" to the corresponding\n-     * RMI registry, and returns the atomic object name as the\n-     * remaining name.\n-     *\/\n-    protected ResolveResult getRootURLContext(String url, Hashtable<?,?> env)\n-            throws NamingException\n-    {\n-        if (!url.startsWith(\"rmi:\")) {\n-            throw (new IllegalArgumentException(\n-                    \"rmiURLContext: name is not an RMI URL: \" + url));\n+    public static final ParseMode PARSE_MODE;\n+    static {\n+        PrivilegedAction<String> action = () ->\n+                System.getProperty(PARSE_MODE_PROP, DEFAULT_PARSE_MODE.toString());\n+        ParseMode parseMode = DEFAULT_PARSE_MODE;\n+        try {\n+            @SuppressWarnings(\"removal\")\n+            String mode = AccessController.doPrivileged(action);\n+            parseMode = ParseMode.valueOf(mode.toUpperCase(Locale.ROOT));\n+        } catch (Throwable t) {\n+            parseMode = DEFAULT_PARSE_MODE;\n+        } finally {\n+            PARSE_MODE = parseMode;\n@@ -66,0 +72,1 @@\n+    }\n@@ -67,1 +74,3 @@\n-        \/\/ Parse the URL.\n+    public rmiURLContext(Hashtable<?,?> env) {\n+        super(env);\n+    }\n@@ -69,0 +78,3 @@\n+    public static class Parser {\n+        final String url;\n+        final ParseMode mode;\n@@ -72,0 +84,7 @@\n+        public Parser(String url) {\n+            this(url, PARSE_MODE);\n+        }\n+        public Parser(String url, ParseMode mode) {\n+            this.url = url;\n+            this.mode = mode;\n+        }\n@@ -73,1 +92,5 @@\n-        int i = 4;              \/\/ index into url, following the \"rmi:\"\n+        public String url() {return url;}\n+        public String host() {return host;}\n+        public int port() {return port;}\n+        public String objName() {return objName;}\n+        public ParseMode mode() {return mode;}\n@@ -75,11 +98,56 @@\n-        if (url.startsWith(\"\/\/\", i)) {          \/\/ parse \"\/\/host:port\"\n-            i += 2;                             \/\/ skip past \"\/\/\"\n-            int slash = url.indexOf('\/', i);\n-            if (slash < 0) {\n-                slash = url.length();\n-            }\n-            if (url.startsWith(\"[\", i)) {               \/\/ at IPv6 literal\n-                int brac = url.indexOf(']', i + 1);\n-                if (brac < 0 || brac > slash) {\n-                    throw new IllegalArgumentException(\n-                        \"rmiURLContext: name is an Invalid URL: \" + url);\n+        public void parse() throws NamingException {\n+            if (!url.startsWith(\"rmi:\")) {\n+                throw (new IllegalArgumentException(\n+                        \"rmiURLContext: name is not an RMI URL: \" + url));\n+            }\n+\n+            switch (mode) {\n+                case STRICT -> parseStrict();\n+                case COMPAT -> parseCompat();\n+                case LEGACY -> parseLegacy();\n+            }\n+\n+        }\n+\n+        private void parseStrict() throws NamingException {\n+            assert url.startsWith(\"rmi:\");\n+\n+            if (url.equals(\"rmi:\") || url.equals(\"rmi:\/\/\")) return;\n+\n+            \/\/ index into url, following the \"rmi:\"\n+            int i = 4;\n+\n+            if (url.startsWith(\"\/\/\", i)) {\n+                i += 2;\n+                try {\n+                    URI uri = URI.create(url);\n+                    host = uri.getHost();\n+                    port = uri.getPort();\n+                    String auth = uri.getRawAuthority();\n+                    String hostport = (host == null ? \"\" : host)\n+                            + (port == -1 ? \"\" : \":\" + port);\n+                    if (!hostport.equals(auth)) {\n+                        boolean failed = true;\n+                        if (hostport.equals(\"\") && auth.startsWith(\":\")) {\n+                            \/\/ supports missing host\n+                            try {\n+                                port = Integer.parseInt(auth.substring(1));\n+                                failed = false;\n+                            } catch (NumberFormatException x) {\n+                                failed = true;\n+                            }\n+                        }\n+                        if (failed) {\n+                            throw newNamingException(new IllegalArgumentException(\"invalid authority: \"\n+                                    + auth));\n+                        }\n+                    }\n+                    i += auth.length();\n+                } catch (IllegalArgumentException iae) {\n+                    throw newNamingException(iae);\n+                }\n+            }\n+            int fmark = url.indexOf('#', i);\n+            if (fmark > -1) {\n+                if (!acceptsFragment()) {\n+                    throw newNamingException(new IllegalArgumentException(\"URI fragments not supported: \" + url));\n@@ -87,9 +155,39 @@\n-                host = url.substring(i, brac + 1);      \/\/ include brackets\n-                i = brac + 1;                           \/\/ skip past \"[...]\"\n-            } else {                                    \/\/ at host name or IPv4\n-                int colon = url.indexOf(':', i);\n-                int hostEnd = (colon < 0 || colon > slash)\n-                    ? slash\n-                    : colon;\n-                if (i < hostEnd) {\n-                    host = url.substring(i, hostEnd);\n+            }\n+\n+            if (\"\".equals(host)) {\n+                host = null;\n+            }\n+            if (url.startsWith(\"\/\", i)) {           \/\/ skip \"\/\" before object name\n+                i++;\n+            }\n+            if (i < url.length()) {\n+                objName = url.substring(i);\n+            }\n+        }\n+\n+        private void parseCompat() throws NamingException {\n+            assert url.startsWith(\"rmi:\");\n+\n+            int i = 4;              \/\/ index into url, following the \"rmi:\"\n+            boolean hasAuthority = url.startsWith(\"\/\/\", i);\n+            if (hasAuthority) i += 2;  \/\/ skip past \"\/\/\"\n+            int slash = url.indexOf('\/', i);\n+            int qmark = url.indexOf('?', i);\n+            int fmark = url.indexOf('#', i);\n+            if (fmark > -1 && qmark > fmark) qmark = -1;\n+            if (fmark > -1 && slash > fmark) slash = -1;\n+            if (qmark > -1 && slash > qmark) slash = -1;\n+\n+            \/\/ The end of the authority component is either the\n+            \/\/ slash (slash will be -1 if it doesn't come before\n+            \/\/ query or fragment), or the question mark (qmark will\n+            \/\/ be -1 if it doesn't come before the fragment), or\n+            \/\/ the fragment separator, or the end of the URI\n+            \/\/ string if there is no path, no query, and no fragment.\n+            int enda = slash > -1 ? slash\n+                    : (qmark > -1 ? qmark\n+                    : (fmark > -1 ? fmark\n+                    : url.length()));\n+            if (fmark > -1) {\n+                if (!acceptsFragment()) {\n+                    throw newNamingException(new IllegalArgumentException(\"URI fragments not supported: \" + url));\n@@ -97,1 +195,0 @@\n-                i = hostEnd;                            \/\/ skip past host\n@@ -99,4 +196,9 @@\n-            if ((i + 1 < slash)) {\n-                if ( url.startsWith(\":\", i)) {       \/\/ parse port\n-                    i++;                             \/\/ skip past \":\"\n-                    port = Integer.parseInt(url.substring(i, slash));\n+\n+            if (hasAuthority && enda > i) {          \/\/ parse \"\/\/host:port\"\n+                if (url.startsWith(\":\", i)) {\n+                    \/\/ LdapURL supports empty host.\n+                    i++;\n+                    host = \"\";\n+                    if (enda > i) {\n+                        port = Integer.parseInt(url.substring(i, enda));\n+                    }\n@@ -104,2 +206,13 @@\n-                    throw new IllegalArgumentException(\n-                        \"rmiURLContext: name is an Invalid URL: \" + url);\n+                    try {\n+                        URI uri = URI.create(url.substring(0, enda));\n+                        host = uri.getHost();\n+                        port = uri.getPort();\n+                        String hostport = (host == null ? \"\" : host)\n+                                + (port == -1 ? \"\" : \":\" + port);\n+                        if (!hostport.equals(uri.getRawAuthority())) {\n+                            throw newNamingException(new IllegalArgumentException(\"invalid authority: \"\n+                                    + uri.getRawAuthority()));\n+                        }\n+                    } catch (IllegalArgumentException iae) {\n+                        throw newNamingException(iae);\n+                    }\n@@ -107,0 +220,7 @@\n+                i = enda;\n+            }\n+            if (\"\".equals(host)) {\n+                host = null;\n+            }\n+            if (url.startsWith(\"\/\", i)) {           \/\/ skip \"\/\" before object name\n+                i++;\n@@ -108,1 +228,4 @@\n-            i = slash;\n+            if (i < url.length()) {\n+                objName = url.substring(i);\n+            }\n+\n@@ -110,2 +233,53 @@\n-        if (\"\".equals(host)) {\n-            host = null;\n+\n+        \/\/ The legacy parsing used to only throw IllegalArgumentException\n+        \/\/ and continues to do so\n+        private void parseLegacy() {\n+            assert url.startsWith(\"rmi:\");\n+\n+            \/\/ Parse the URL.\n+            int i = 4;              \/\/ index into url, following the \"rmi:\"\n+\n+            if (url.startsWith(\"\/\/\", i)) {          \/\/ parse \"\/\/host:port\"\n+                i += 2;                             \/\/ skip past \"\/\/\"\n+                int slash = url.indexOf('\/', i);\n+                if (slash < 0) {\n+                    slash = url.length();\n+                }\n+                if (url.startsWith(\"[\", i)) {               \/\/ at IPv6 literal\n+                    int brac = url.indexOf(']', i + 1);\n+                    if (brac < 0 || brac > slash) {\n+                        throw new IllegalArgumentException(\n+                                \"rmiURLContext: name is an Invalid URL: \" + url);\n+                    }\n+                    host = url.substring(i, brac + 1);      \/\/ include brackets\n+                    i = brac + 1;                           \/\/ skip past \"[...]\"\n+                } else {                                    \/\/ at host name or IPv4\n+                    int colon = url.indexOf(':', i);\n+                    int hostEnd = (colon < 0 || colon > slash)\n+                            ? slash\n+                            : colon;\n+                    if (i < hostEnd) {\n+                        host = url.substring(i, hostEnd);\n+                    }\n+                    i = hostEnd;                            \/\/ skip past host\n+                }\n+                if ((i + 1 < slash)) {\n+                    if ( url.startsWith(\":\", i)) {       \/\/ parse port\n+                        i++;                             \/\/ skip past \":\"\n+                        port = Integer.parseInt(url.substring(i, slash));\n+                    } else {\n+                        throw new IllegalArgumentException(\n+                                \"rmiURLContext: name is an Invalid URL: \" + url);\n+                    }\n+                }\n+                i = slash;\n+            }\n+            if (\"\".equals(host)) {\n+                host = null;\n+            }\n+            if (url.startsWith(\"\/\", i)) {           \/\/ skip \"\/\" before object name\n+                i++;\n+            }\n+            if (i < url.length()) {\n+                objName = url.substring(i);\n+            }\n@@ -113,2 +287,5 @@\n-        if (url.startsWith(\"\/\", i)) {           \/\/ skip \"\/\" before object name\n-            i++;\n+\n+        NamingException newNamingException(Throwable cause) {\n+            NamingException ne = new InvalidNameException(cause.getMessage());\n+            ne.initCause(cause);\n+            return ne;\n@@ -116,2 +293,3 @@\n-        if (i < url.length()) {\n-            objName = url.substring(i);\n+\n+        protected boolean acceptsFragment() {\n+            return true;\n@@ -119,0 +297,15 @@\n+    }\n+\n+    \/**\n+     * Resolves the registry portion of \"url\" to the corresponding\n+     * RMI registry, and returns the atomic object name as the\n+     * remaining name.\n+     *\/\n+    protected ResolveResult getRootURLContext(String url, Hashtable<?,?> env)\n+            throws NamingException\n+    {\n+        Parser parser = new Parser(url);\n+        parser.parse();\n+        String host = parser.host;\n+        int port = parser.port;\n+        String objName = parser.objName;\n","filename":"src\/jdk.naming.rmi\/share\/classes\/com\/sun\/jndi\/url\/rmi\/rmiURLContext.java","additions":244,"deletions":51,"binary":false,"changes":295,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2009, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2009, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -1564,1 +1564,1 @@\n-        inodes = new LinkedHashMap<>(end.centot + 1);\n+        inodes = LinkedHashMap.newLinkedHashMap(end.centot + 1);\n","filename":"src\/jdk.zipfs\/share\/classes\/jdk\/nio\/zipfs\/ZipFileSystem.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/connect-local-ant-run.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/connect-local-java-jar.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/connect-local.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/remote-connection-failed.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/remote-connection.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/scandir-config.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/scandir-result.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/docfiles\/scandir-start.jpg","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/keystore","binary":true,"status":"deleted"},{"filename":"src\/sample\/share\/jmx\/jmx-scandir\/truststore","binary":true,"status":"deleted"},{"patch":"@@ -82,0 +82,1 @@\n+gc\/arguments\/TestUseCompressedOopsFlagsWithUlimit.java 8285011 generic-all\n","filename":"test\/hotspot\/jtreg\/ProblemList.txt","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -77,3 +77,3 @@\n-            if (isADRP(encoding)) {\n-                return true;\n-            }\n+            \/\/ Check the first instruction only. The raw pointer can be confused with the encoded adrp instruction:\n+            \/\/ emit_exception_handler() = far_call() + should_not_reach_here() = ADRP + ADD + BLR + DCPS1 + raw_pointer\n+            return isADRP(encoding);\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/aarch64\/TestFarJump.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,99 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package compiler.integerArithmetic;\n+\n+import jdk.test.lib.Asserts;\n+\n+\/*\n+ * @test TestDivision\n+ * @bug 8284742\n+ * @summary Tests to verify compiled code correctly handles integral divisions.\n+ * @library \/test\/lib\n+ *\n+ * @run main\/othervm -Xcomp -XX:-TieredCompilation\n+ *      -XX:CompileCommand=compileonly,*.TestDivision::divide\n+ *      -XX:CompileCommand=compileonly,*.TestDivision::remainder\n+ *      compiler.integerArithmetic.TestDivision\n+ *\/\n+public class TestDivision {\n+    public static void main(String[] args) {\n+        Asserts.assertEquals(divide(19, 7), 19 \/ 7);\n+        Asserts.assertEquals(remainder(19, 7), 19 % 7);\n+        Asserts.assertEquals(divide(19L, 7L), 19L \/ 7L);\n+        Asserts.assertEquals(remainder(19L, 7L), 19L % 7L);\n+\n+        Asserts.assertEquals(divide(19, -7), 19 \/ -7);\n+        Asserts.assertEquals(remainder(19, -7), 19 % -7);\n+        Asserts.assertEquals(divide(19L, -7L), 19L \/ -7L);\n+        Asserts.assertEquals(remainder(19L, -7L), 19L % -7L);\n+\n+        Asserts.assertEquals(divide(-19, 7), -19 \/ 7);\n+        Asserts.assertEquals(remainder(-19, 7), -19 % 7);\n+        Asserts.assertEquals(divide(-19L, 7L), -19L \/ 7L);\n+        Asserts.assertEquals(remainder(-19L, 7L), -19L % 7L);\n+\n+        Asserts.assertEquals(divide(-19, -7), -19 \/ -7);\n+        Asserts.assertEquals(remainder(-19, -7), -19 % -7);\n+        Asserts.assertEquals(divide(-19L, -7L), -19L \/ -7L);\n+        Asserts.assertEquals(remainder(-19L, -7L), -19L % -7L);\n+\n+        Asserts.assertEquals(divide(Integer.MIN_VALUE, -1), Integer.MIN_VALUE \/ -1);\n+        Asserts.assertEquals(remainder(Integer.MIN_VALUE, -1), Integer.MIN_VALUE % -1);\n+        Asserts.assertEquals(divide(Long.MIN_VALUE, -1), Long.MIN_VALUE \/ -1L);\n+        Asserts.assertEquals(remainder(Long.MIN_VALUE, -1), Long.MIN_VALUE % -1L);\n+\n+        try {\n+            divide(19, 0);\n+            Asserts.fail();\n+        } catch (ArithmeticException e) {}\n+        try {\n+            remainder(19, 0);\n+            Asserts.fail();\n+        } catch (ArithmeticException e) {}\n+        try {\n+            divide(19L, 0L);\n+            Asserts.fail();\n+        } catch (ArithmeticException e) {}\n+        try {\n+            remainder(19L, 0L);\n+            Asserts.fail();\n+        } catch (ArithmeticException e) {}\n+    }\n+\n+    static int divide(int x, int y) {\n+        return x \/ y;\n+    }\n+\n+    static int remainder(int x, int y) {\n+        return x % y;\n+    }\n+\n+    static long divide(long x, long y) {\n+        return x \/ y;\n+    }\n+\n+    static long remainder(long x, long y) {\n+        return x % y;\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/integerArithmetic\/TestDivision.java","additions":99,"deletions":0,"binary":false,"changes":99,"status":"added"},{"patch":"@@ -177,5 +177,0 @@\n-\n-    public static int getMetadata(TargetDescription target,\n-            HotSpotCompiledCode compiledCode, HotSpotMetaData metaData) {\n-        return CTVM.getMetadata(target, compiledCode, metaData);\n-    }\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/common\/patches\/jdk.internal.vm.ci\/jdk\/vm\/ci\/hotspot\/CompilerToVMHelper.java","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+import java.lang.invoke.StringConcatFactory;\n@@ -57,0 +58,1 @@\n+import jdk.vm.ci.hotspot.HotSpotConstantPool;\n@@ -58,0 +60,1 @@\n+import jdk.vm.ci.meta.ConstantPool.BootstrapMethodInvocation;\n@@ -64,1 +67,1 @@\n- * Tests support for Dynamic constants.\n+ * Tests support for Dynamic constants and {@link jdk.vm.ci.meta.ConstantPool#lookupBootstrapMethodInvocation}.\n@@ -148,0 +151,1 @@\n+            ConstantDynamic condy;\n@@ -154,1 +158,1 @@\n-                ConstantDynamic condy = new ConstantDynamic(\"const\", desc, handle);\n+                condy = new ConstantDynamic(\"const\", desc, handle);\n@@ -164,1 +168,1 @@\n-                ConstantDynamic condy = new ConstantDynamic(\"const\", desc, invokeHandle, handle);\n+                condy = new ConstantDynamic(\"const\", desc, invokeHandle, handle);\n@@ -180,0 +184,1 @@\n+                condy = condy2;\n@@ -187,0 +192,12 @@\n+\n+            MethodVisitor concat = cw.visitMethod(PUBLIC_STATIC, \"concat\", \"()Ljava\/lang\/String;\", null, null);\n+            String sig = \"(Ljava\/lang\/invoke\/MethodHandles$Lookup;Ljava\/lang\/String;Ljava\/lang\/invoke\/MethodType;Ljava\/lang\/String;[Ljava\/lang\/Object;)Ljava\/lang\/invoke\/CallSite;\";\n+            Handle handle = new Handle(H_INVOKESTATIC, Type.getInternalName(StringConcatFactory.class), \"makeConcatWithConstants\", sig, false);\n+            String recipe = \"var arg=\\u0001, const arg=\\u0002\";\n+            Object[] bsmArgs = {recipe};\n+            concat.visitLdcInsn(condy);\n+            concat.visitInvokeDynamicInsn(\"do_concat\", \"(\" + desc + \")Ljava\/lang\/String;\", handle, bsmArgs);\n+            concat.visitInsn(ARETURN);\n+            concat.visitMaxs(0, 0);\n+            concat.visitEnd();\n+\n@@ -237,0 +254,4 @@\n+\n+        Method getTagAt = HotSpotConstantPool.class.getDeclaredMethod(\"getTagAt\", int.class);\n+        getTagAt.setAccessible(true);\n+\n@@ -244,2 +265,0 @@\n-                Method getTagAt = cp.getClass().getDeclaredMethod(\"getTagAt\", int.class);\n-                getTagAt.setAccessible(true);\n@@ -265,0 +284,33 @@\n+\n+                testLookupBootstrapMethodInvocation(condyType, metaAccess, testClass, getTagAt);\n+            }\n+        }\n+    }\n+\n+    \/**\n+     * Tests {@link jdk.vm.ci.meta.ConstantPool#lookupBootstrapMethodInvocation}.\n+     *\/\n+    private void testLookupBootstrapMethodInvocation(CondyType condyType, MetaAccessProvider metaAccess, Class<?> testClass, Method getTagAt) throws Throwable {\n+        Method m = testClass.getDeclaredMethod(\"concat\");\n+        ResolvedJavaMethod concat = metaAccess.lookupJavaMethod(m);\n+        ConstantPool cp = concat.getConstantPool();\n+        Object lastConstant = null;\n+        for (int cpi = 1; cpi < cp.length(); cpi++) {\n+            String tag = String.valueOf(getTagAt.invoke(cp, cpi));\n+            BootstrapMethodInvocation bsmi = cp.lookupBootstrapMethodInvocation(cpi, -1);\n+            if (tag.equals(\"InvokeDynamic\") || tag.equals(\"Dynamic\")) {\n+                Assert.assertNotNull(bsmi);\n+                String bsm = bsmi.getMethod().format(\"%H.%n\");\n+                if (tag.equals(\"InvokeDynamic\")) {\n+                    Assert.assertTrue(bsmi.isInvokeDynamic());\n+                    Assert.assertEquals(bsm, \"java.lang.invoke.StringConcatFactory.makeConcatWithConstants\");\n+                } else {\n+                    Assert.assertFalse(bsmi.isInvokeDynamic());\n+                    if (condyType == CondyType.CALL_DIRECT_BSM) {\n+                        Assert.assertTrue(bsm.startsWith(\"jdk.vm.ci.hotspot.test.TestDynamicConstant.get\") && bsm.endsWith(\"BSM\"), bsm);\n+                    } else {\n+                        Assert.assertEquals(bsm, \"java.lang.invoke.ConstantBootstraps.invoke\");\n+                    }\n+                }\n+            } else {\n+                Assert.assertNull(bsmi, String.valueOf(bsmi));\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/jdk.vm.ci.hotspot.test\/src\/jdk\/vm\/ci\/hotspot\/test\/TestDynamicConstant.java","additions":57,"deletions":5,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -172,2 +172,2 @@\n-    public static final String DIV = START + \"Div(I|L|F|D)\" + MID + END;\n-    public static final String DIV_L = START + \"DivL\" + MID + END;\n+    public static final String DIV = START + \"(NoOvf)?Div(I|L|F|D)\" + MID + END;\n+    public static final String DIV_L = START + \"(NoOvf)?DivL\" + MID + END;\n","filename":"test\/hotspot\/jtreg\/compiler\/lib\/ir_framework\/IRNode.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,92 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package gc.arguments;\n+\n+\/*\n+ * @test TestUseCompressedOopsFlagsWithUlimit\n+ * @bug 8280761\n+ * @summary Verify correct UseCompressedOops when MaxRAM and MaxRAMPercentage\n+ * are specified with ulimit -v.\n+ * @library \/test\/lib\n+ * @library \/\n+ * @requires vm.bits == \"64\"\n+ * @requires os.family != \"aix\" & os.family != \"windows\"\n+ * @run driver gc.arguments.TestUseCompressedOopsFlagsWithUlimit\n+ *\/\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+\n+public class TestUseCompressedOopsFlagsWithUlimit {\n+\n+  private static void checkFlag(long ulimit, long maxram, int maxrampercent, boolean expectcoop) throws Exception {\n+\n+    ArrayList<String> args = new ArrayList<String>();\n+    args.add(\"-XX:MaxRAM=\" + maxram);\n+    args.add(\"-XX:MaxRAMPercentage=\" + maxrampercent);\n+    args.add(\"-XX:+PrintFlagsFinal\");\n+    args.add(\"-version\");\n+\n+    \/\/ Convert bytes to kbytes for ulimit -v\n+    var ulimit_prefix = \"ulimit -v \" + (ulimit \/ 1024);\n+\n+    String cmd = ProcessTools.getCommandLine(ProcessTools.createTestJvm(args.toArray(String[]::new)));\n+    ProcessBuilder pb = new ProcessBuilder(\"sh\", \"-c\", ulimit_prefix + \";\" + cmd);\n+    OutputAnalyzer output = new OutputAnalyzer(pb.start());\n+    output.shouldHaveExitValue(0);\n+    String stdout = output.getStdout();\n+\n+    boolean actualcoop = getFlagBoolValue(\"UseCompressedOops\", stdout);\n+    if (actualcoop != expectcoop) {\n+      throw new RuntimeException(\"UseCompressedOops set to \" + actualcoop +\n+        \", expected \" + expectcoop + \" when running with the following flags: \" + Arrays.asList(args).toString());\n+    }\n+  }\n+\n+  private static boolean getFlagBoolValue(String flag, String where) {\n+    Matcher m = Pattern.compile(flag + \"\\\\s+:?= (true|false)\").matcher(where);\n+    if (!m.find()) {\n+      throw new RuntimeException(\"Could not find value for flag \" + flag + \" in output string\");\n+    }\n+    return m.group(1).equals(\"true\");\n+  }\n+\n+  public static void main(String args[]) throws Exception {\n+    \/\/ Tests\n+    \/\/ Verify that UseCompressedOops Ergo follows ulimit -v setting.\n+\n+    long oneG = 1L * 1024L * 1024L * 1024L;\n+\n+    \/\/ Args: ulimit, max_ram, max_ram_percent, expected_coop\n+    \/\/ Setting MaxRAMPercentage explicitly to make the test more resilient.\n+    checkFlag(10 * oneG, 32 * oneG, 100, true);\n+    checkFlag(10 * oneG, 128 * oneG, 100, true);\n+  }\n+}\n","filename":"test\/hotspot\/jtreg\/gc\/arguments\/TestUseCompressedOopsFlagsWithUlimit.java","additions":92,"deletions":0,"binary":false,"changes":92,"status":"added"},{"patch":"@@ -59,0 +59,1 @@\n+            {\"AliasLevel\", \"3\"},\n","filename":"test\/hotspot\/jtreg\/runtime\/CommandLine\/VMDeprecatedOptions.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8059510\n+ * @bug 8059510 8213445\n@@ -29,1 +29,4 @@\n- * @run main\/othervm -XX:+UnlockDiagnosticVMOptions DumpSymbolAndStringTable\n+ * @build sun.hotspot.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller sun.hotspot.WhiteBox\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions\n+ *                   -XX:+WhiteBoxAPI DumpSymbolAndStringTable\n@@ -35,0 +38,1 @@\n+import sun.hotspot.WhiteBox;\n@@ -41,0 +45,3 @@\n+        WhiteBox wb = WhiteBox.getWhiteBox();\n+        boolean sharingEnabled = wb.isSharingEnabled();\n+\n@@ -44,0 +51,1 @@\n+        final String sharedSymbolsHeader = \"Shared symbols:\\n\";\n@@ -46,0 +54,4 @@\n+            if (sharingEnabled) {\n+                output.shouldContain(sharedSymbolsHeader);\n+                output.shouldContain(\"17 65535: java.lang.runtime\\n\");\n+            }\n@@ -52,0 +64,1 @@\n+        final String sharedStringsHeader = \"Shared strings:\\n\";\n@@ -54,0 +67,6 @@\n+            if (sharingEnabled && wb.canWriteJavaHeapArchive()) {\n+                output.shouldContain(sharedStringsHeader);\n+                if (!wb.isSharedInternedString(\"MILLI_OF_SECOND\")) {\n+                    throw new RuntimeException(\"'MILLI_OF_SECOND' should be a shared string\");\n+                }\n+            }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/DumpSymbolAndStringTable.java","additions":22,"deletions":3,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -0,0 +1,99 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+import jdk.test.lib.JDKToolFinder;\n+import jdk.test.lib.cds.CDSTestUtils;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jtreg.SkippedException;\n+\n+\/*\n+ * @test\n+ * @bug 8213445\n+ * @summary Test dumping of dynamic shared symbols using jcmd\n+ * @requires vm.cds\n+ * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jcmd\n+ * @build JCmdTestLingeredApp Hello jdk.test.lib.apps.LingeredApp\n+ * @build sun.hotspot.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller -jar loadclass.jar JCmdTestLingeredApp\n+ *             jdk.test.lib.apps.LingeredApp jdk.test.lib.apps.LingeredApp$1\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller -jar WhiteBox.jar sun.hotspot.WhiteBox\n+ * @run main\/othervm\/timeout=500 -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbootclasspath\/a:.\/WhiteBox.jar DynamicSharedSymbols\n+ *\/\n+\n+import jdk.test.lib.apps.LingeredApp;\n+import jdk.test.lib.helpers.ClassFileInstaller;\n+import sun.hotspot.WhiteBox;\n+\n+public class DynamicSharedSymbols extends DynamicArchiveTestBase {\n+\n+    public static void main(String[] args) throws Exception {\n+        runTest(DynamicSharedSymbols::testDefaultBase);\n+    }\n+\n+    static void testDefaultBase() throws Exception {\n+        String topArchiveName = getNewArchiveName(\"top\");\n+        doTest(topArchiveName);\n+    }\n+\n+    private static void doTest(String topArchiveName) throws Exception {\n+        WhiteBox wb = WhiteBox.getWhiteBox();\n+        if (!wb.isSharingEnabled()) {\n+            throw new SkippedException(\"Sharing is not enabled, test is skipped.\");\n+        }\n+\n+        String appJar = ClassFileInstaller.getJarPath(\"loadclass.jar\");\n+\n+        \/\/ Create a dynamic archive.\n+        String dynamicDumpArg = \"-XX:ArchiveClassesAtExit=\" + topArchiveName;\n+        JCmdTestLingeredApp theApp = new JCmdTestLingeredApp();\n+        LingeredApp.startApp(theApp, dynamicDumpArg,\n+                             \"-Xlog:cds,cds+dynamic=info\",\n+                             \"-cp\", appJar);\n+        long pid = theApp.getPid();\n+        LingeredApp.stopApp(theApp);\n+\n+        \/\/ Run with dynamic archive.\n+        String sharedArchiveArg = \"-XX:SharedArchiveFile=\" + topArchiveName;\n+        theApp = new JCmdTestLingeredApp();\n+        LingeredApp.startApp(theApp,\n+                             \"-Xshare:on\", sharedArchiveArg,\n+                             \"-Xlog:cds,class+load\",\n+                             \"-cp\", appJar);\n+        pid = theApp.getPid();\n+\n+\n+        \/\/ Use jcmd to dump the symbols of the above process running\n+        \/\/ with dynamic shared archive.\n+        ProcessBuilder pb = new ProcessBuilder();\n+        pb.command(new String[] {JDKToolFinder.getJDKTool(\"jcmd\"), Long.toString(pid), \"VM.symboltable\", \"-verbose\"});\n+        OutputAnalyzer output = CDSTestUtils.executeAndLog(pb, \"jcmd-symboltable\");\n+        output.shouldContain(\"17 2: jdk\/test\/lib\/apps\\n\");\n+        output.shouldContain(\"Dynamic shared symbols:\\n\");\n+        output.shouldContain(\"5 65535: Hello\\n\");\n+\n+        LingeredApp.stopApp(theApp);\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/DynamicSharedSymbols.java","additions":99,"deletions":0,"binary":false,"changes":99,"status":"added"},{"patch":"@@ -33,0 +33,1 @@\n+import jdk.test.lib.helpers.ClassFileInstaller;\n@@ -91,2 +92,2 @@\n-        testJar = JarBuilder.build(\"test\", TEST_CLASSES);\n-        bootJar = JarBuilder.build(\"boot\", BOOT_CLASSES);\n+        testJar = ClassFileInstaller.writeJar(\"test\", TEST_CLASSES);\n+        bootJar = ClassFileInstaller.writeJar(\"boot\", BOOT_CLASSES);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jcmd\/JCmdTestDumpBase.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n- * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\n+ * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\n@@ -33,3 +33,2 @@\n- * @compile ..\/test-classes\/Hello.java JCmdTestDumpBase.java\n- * @build sun.hotspot.WhiteBox\n- * @build JCmdTestLingeredApp JCmdTestDynamicDump\n+ * @build jdk.test.lib.apps.LingeredApp sun.hotspot.WhiteBox Hello\n+ *        JCmdTestDumpBase JCmdTestLingeredApp JCmdTestDynamicDump\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jcmd\/JCmdTestDynamicDump.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n- * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\n+ * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\n@@ -32,3 +32,2 @@\n- * @compile ..\/test-classes\/Hello.java JCmdTestDumpBase.java\n- * @build sun.hotspot.WhiteBox\n- * @build JCmdTestLingeredApp JCmdTestFileSafety\n+ * @build jdk.test.lib.apps.LingeredApp sun.hotspot.WhiteBox Hello\n+ *        JCmdTestDumpBase JCmdTestLingeredApp JCmdTestFileSafety\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jcmd\/JCmdTestFileSafety.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n- * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\n+ * @library \/test\/lib \/test\/hotspot\/jtreg\/runtime\/cds\/appcds \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\n@@ -32,3 +32,2 @@\n- * @compile ..\/test-classes\/Hello.java JCmdTestDumpBase.java\n- * @build sun.hotspot.WhiteBox\n- * @build JCmdTestLingeredApp JCmdTestStaticDump\n+ * @build jdk.test.lib.apps.LingeredApp sun.hotspot.WhiteBox Hello\n+ *         JCmdTestDumpBase JCmdTestLingeredApp JCmdTestStaticDump\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jcmd\/JCmdTestStaticDump.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,82 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package xpath;\n+\n+import java.io.StringReader;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+\n+\/*\n+ * @test\n+ * @bug 8284548\n+ * @run testng xpath.XPathExceptionTest\n+ * @summary This is a general test for Exception handling. Additional cases may\n+ * be added with a bug id in the test cases.\n+ *\/\n+public class XPathExceptionTest {\n+\n+    \/*\n+     * DataProvider: invalid XPath expressions\n+     * Illegal expressions and structures that may escape the validation check.\n+     *\/\n+    @DataProvider(name = \"invalid\")\n+    public Object[][] getInvalid() throws Exception {\n+        return new Object[][]{\n+            \/\/ @bug JDK-8284548: expressions ending with relational operators\n+            \/\/ throw StringIndexOutOfBoundsException instead of XPathExpressionException\n+            {\"\/a\/b\/c[@d >\"},\n+            {\"\/a\/b\/c[@d <\"},\n+            {\"\/a\/b\/c[@d >=\"},\n+            {\">>\"},\n+        };\n+    }\n+\n+    \/**\n+     * Verifies that the XPath processor throws XPathExpressionException upon\n+     * encountering illegal XPath expressions.\n+     * @param invalidExp an illegal XPath expression\n+     * @throws Exception if the test fails\n+     *\/\n+    @Test(dataProvider = \"invalid\")\n+    public void testIllegalExp(String invalidExp) throws Exception {\n+        DocumentBuilder builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+        Document doc = builder.parse(new org.xml.sax.InputSource(new StringReader(\"<A\/>\")));\n+        Assert.assertThrows(XPathExpressionException.class, () -> evaluate(doc, invalidExp));\n+    }\n+\n+    private void evaluate(Document doc, String s) throws XPathExpressionException {\n+        XPath xp = XPathFactory.newInstance().newXPath();\n+        XPathExpression xe = xp.compile(s);\n+        xe.evaluateExpression(doc, Node.class);\n+    }\n+}\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/xpath\/XPathExceptionTest.java","additions":82,"deletions":0,"binary":false,"changes":82,"status":"added"},{"patch":"@@ -0,0 +1,121 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package xpath;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+\/*\n+ * @test\n+ * @bug 8284920\n+ * @run testng\/othervm xpath.XPathExpTest\n+ * @summary Tests for various XPath Expressions.\n+ *\/\n+public class XPathExpTest {\n+\n+    private static final String XML =\n+              \"<root>\"\n+            + \"   <child id='1'>\"\n+            + \"       <grandchild id='1'\/>\"\n+            + \"       <grandchild id='2'\/>\"\n+            + \"   <\/child>\"\n+            + \"   <child id='2'>\"\n+            + \"       <grandchild id='3'\/>\"\n+            + \"       <grandchild id='4'\/>\"\n+            + \"   <\/child>\"\n+            + \"   <child id='3'>\"\n+            + \"       <grandchild id='5'\/>\"\n+            + \"       <grandchild id='6'\/>\"\n+            + \"   <\/child>\"\n+            + \" <\/root>\";\n+    private static final String PARENT_CHILD = \"child(2)\";\n+\n+    \/*\n+     * DataProvider for XPath expression test.\n+     * Data columns:\n+     *  see parameters of the test \"test\"\n+     *\/\n+    @DataProvider(name = \"xpathExp\")\n+    public Object[][] getXPathExpression() throws Exception {\n+\n+        return new Object[][]{\n+            \/\/ verifies various forms of the parent axis\n+            {\"\/root\/child[@id='2']\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/parent::child\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/parent::node()\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/parent::*\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/parent::node()\/grandchild[@id='4']\/parent::node()\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/..\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/..\/grandchild[@id='4']\/..\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/parent::node()\/grandchild[@id='4']\/..\", PARENT_CHILD},\n+\n+            \/\/ verifies various forms of the self axis\n+            {\"\/root\/child[@id='2']\/self::child\", PARENT_CHILD},\n+            {\"\/root\/child[@id='2']\/self::node()\", PARENT_CHILD},\n+            {\"\/root\/child[@id='2']\/self::*\", PARENT_CHILD},\n+            {\"self::node()\/root\/child[@id='2']\", PARENT_CHILD},\n+            {\"\/root\/child[@id='2']\/.\", PARENT_CHILD},\n+            {\".\/root\/child[@id='2']\", PARENT_CHILD},\n+            {\".\/\/child[@id='2']\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/.\/..\/grandchild[@id='4']\/..\", PARENT_CHILD},\n+            {\"\/\/grandchild[@id='3']\/.\/parent::node()\/grandchild[@id='4']\/..\", PARENT_CHILD},\n+        };\n+    }\n+\n+    \/**\n+     * Verifies XPath expressions.\n+     *\n+     * @param exp XPath expression\n+     * @param expected expected result\n+     * @throws Exception\n+     *\/\n+    @Test(dataProvider = \"xpathExp\")\n+    void test(String exp, String expected) throws Exception {\n+        Document doc = getDoc(XML);\n+        XPath xPath = XPathFactory.newInstance().newXPath();\n+        NodeList nl = (NodeList) xPath.evaluate(exp, doc, XPathConstants.NODESET);\n+        Node child = nl.item(0);\n+        Assert.assertEquals(\n+                child.getNodeName() + \"(\" + child.getAttributes().item(0).getNodeValue() + \")\",\n+                expected);\n+    }\n+\n+    Document getDoc(String xml) throws Exception {\n+        DocumentBuilderFactory dfactory = DocumentBuilderFactory.newInstance();\n+        dfactory.setNamespaceAware(true);\n+        DocumentBuilder docBuilder = dfactory.newDocumentBuilder();\n+        InputStream is = new ByteArrayInputStream(xml.getBytes());\n+        return docBuilder.parse(is);\n+    }\n+}\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/xpath\/XPathExpTest.java","additions":121,"deletions":0,"binary":false,"changes":121,"status":"added"},{"patch":"@@ -136,1 +136,0 @@\n-java\/awt\/Focus\/SimpleWindowActivationTest\/SimpleWindowActivationTest.java 8159599 macosx-all\n@@ -142,1 +141,0 @@\n-java\/awt\/Frame\/ShapeNotSetSometimes\/ShapeNotSetSometimes.java 8144030 macosx-all,linux-all\n@@ -240,0 +238,1 @@\n+sun\/java2d\/DirectX\/MultiPaintEventTest\/MultiPaintEventTest.java 8284825 windows-all\n@@ -487,1 +486,0 @@\n-java\/awt\/im\/memoryleak\/InputContextMemoryLeakTest.java 8023814 linux-all\n@@ -545,1 +543,0 @@\n-java\/lang\/Enum\/ConstantDirectoryOptimalCapacity.java            8282120 generic-all\n@@ -725,2 +722,0 @@\n-javax\/swing\/JRootPane\/4670486\/bug4670486.java 8042381 macosx-all\n-javax\/swing\/JButton\/8151303\/PressedIconTest.java 8266246 macosx-aarch64\n@@ -733,8 +728,0 @@\n-javax\/swing\/text\/html\/StyleSheet\/bug4936917.java 8277816 macosx-aarch64\n-javax\/swing\/plaf\/metal\/MetalGradient\/8163193\/ButtonGradientTest.java  8277816 macosx-aarch64\n-javax\/swing\/JInternalFrame\/8160248\/JInternalFrameDraggingTest.java  8277816 macosx-aarch64\n-javax\/swing\/JInternalFrame\/8069348\/bug8069348.java 8277816 macosx-aarch64\n-java\/awt\/Robot\/HiDPIScreenCapture\/ScreenCaptureTest.java  8277816 macosx-aarch64\n-java\/awt\/Robot\/CheckCommonColors\/CheckCommonColors.java 8277816 macosx-aarch64\n-java\/awt\/ColorClass\/AlphaColorTest.java 8277816 macosx-aarch64\n-java\/awt\/AlphaComposite\/WindowAlphaCompositeTest.java 8277816 macosx-aarch64\n","filename":"test\/jdk\/ProblemList.txt","additions":1,"deletions":14,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -51,0 +51,1 @@\n+    private static final boolean IS_LINUX   = System.getProperty(\"os.name\").toLowerCase().contains(\"linux\");\n@@ -167,1 +168,1 @@\n-                } else if (fileName.endsWith(\".debuginfo\") || fileName.endsWith(\".pdb\")) {\n+                } else if ((fileName.endsWith(\".debuginfo\") && !IS_LINUX) || fileName.endsWith(\".pdb\")) {\n","filename":"test\/jdk\/build\/AbsPathsInImage.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -30,2 +30,0 @@\n- * @library   ..\/..\/regtesthelpers\n- * @build     Util\n@@ -34,5 +32,16 @@\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.util.concurrent.Callable;\n-import javax.swing.SwingUtilities;\n-import test.java.awt.regtesthelpers.Util;\n+\n+import java.awt.AWTEvent;\n+import java.awt.Button;\n+import java.awt.Component;\n+import java.awt.Dimension;\n+import java.awt.FlowLayout;\n+import java.awt.Frame;\n+import java.awt.Label;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.Toolkit;\n+import java.awt.Window;\n+import java.awt.event.AWTEventListener;\n+import java.awt.event.FocusEvent;\n+import java.awt.event.InputEvent;\n+import java.awt.event.WindowEvent;\n@@ -62,0 +71,1 @@\n+        robot.delay(500);\n@@ -65,0 +75,1 @@\n+        robot.delay(500);\n@@ -133,2 +144,2 @@\n-        robot.mousePress(InputEvent.BUTTON1_MASK);\n-        robot.mouseRelease(InputEvent.BUTTON1_MASK);\n+        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n","filename":"test\/jdk\/java\/awt\/Focus\/SimpleWindowActivationTest\/SimpleWindowActivationTest.java","additions":20,"deletions":9,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,3 +34,10 @@\n-import java.awt.*;\n-import java.awt.event.InputEvent;\n-import java.awt.geom.*;\n+import java.awt.Color;\n+import java.awt.EventQueue;\n+import java.awt.Frame;\n+import java.awt.Graphics;\n+import java.awt.Point;\n+import java.awt.Rectangle;\n+import java.awt.Robot;\n+import java.awt.geom.Area;\n+import java.awt.geom.Ellipse2D;\n+import java.awt.geom.Rectangle2D;\n@@ -43,3 +50,7 @@\n-    private static final Color BACKGROUND_COLOR = Color.BLUE;\n-    private Shape shape;\n-    private int[][] pointsToCheck;\n+    private static final Color BACKGROUND_COLOR = Color.GREEN;\n+    private static final Color SHAPE_COLOR = Color.WHITE;\n+    private Point[] pointsOutsideToCheck;\n+    private Point[] shadedPointsToCheck;\n+    private Point innerPoint;\n+\n+    private final Rectangle bounds = new Rectangle(220, 400, 300, 300);\n@@ -57,2 +68,1 @@\n-        backgroundFrame.setSize(300, 300);\n-        backgroundFrame.setLocation(20, 400);\n+        backgroundFrame.setBounds(bounds);\n@@ -61,20 +71,20 @@\n-        shape = null;\n-        String shape_name = null;\n-        Area a;\n-        GeneralPath gp;\n-        shape_name = \"Rounded-corners\";\n-        a = new Area();\n-        a.add(new Area(new Rectangle2D.Float(50, 0, 100, 150)));\n-        a.add(new Area(new Rectangle2D.Float(0, 50, 200, 50)));\n-        a.add(new Area(new Ellipse2D.Float(0, 0, 100, 100)));\n-        a.add(new Area(new Ellipse2D.Float(0, 50, 100, 100)));\n-        a.add(new Area(new Ellipse2D.Float(100, 0, 100, 100)));\n-        a.add(new Area(new Ellipse2D.Float(100, 50, 100, 100)));\n-        shape = a;\n-        pointsToCheck = new int[][] {\n-            \/\/ inside shape\n-            {106, 86}, {96, 38}, {76, 107}, {180, 25}, {24, 105},\n-            {196, 77}, {165, 50}, {14, 113}, {89, 132}, {167, 117},\n-            \/\/ outside shape\n-            {165, 196}, {191, 163}, {146, 185}, {61, 170}, {148, 171},\n-            {82, 172}, {186, 11}, {199, 141}, {13, 173}, {187, 3}\n+        Area area = new Area();\n+        area.add(new Area(new Rectangle2D.Float(100, 50, 100, 150)));\n+        area.add(new Area(new Rectangle2D.Float(50, 100, 200, 50)));\n+        area.add(new Area(new Ellipse2D.Float(50, 50, 100, 100)));\n+        area.add(new Area(new Ellipse2D.Float(50, 100, 100, 100)));\n+        area.add(new Area(new Ellipse2D.Float(150, 50, 100, 100)));\n+        area.add(new Area(new Ellipse2D.Float(150, 100, 100, 100)));\n+\n+\n+        innerPoint = new Point(150, 130);\n+        pointsOutsideToCheck = new Point[] {\n+                new Point(150, 20),\n+                new Point(280, 120),\n+                new Point(150, 250),\n+                new Point(20, 120)\n+        };\n+\n+        shadedPointsToCheck = new Point[] {\n+                new Point(62, 62),\n+                new Point(240, 185)\n@@ -85,3 +95,2 @@\n-        window.setSize(200, 200);\n-        window.setLocation(70, 450);\n-        window.setShape(shape);\n+        window.setBounds(bounds);\n+        window.setShape(area);\n@@ -89,2 +98,0 @@\n-\n-        System.out.println(\"Checking \" + window.getClass().getSuperclass().getName() + \" with \" + shape_name + \" shape (\" + window.getShape() + \")...\");\n@@ -93,1 +100,1 @@\n-    class BackgroundFrame extends Frame {\n+    static class BackgroundFrame extends Frame {\n@@ -110,2 +117,2 @@\n-            g.setColor(Color.WHITE);\n-            g.fillRect(0, 0, 200, 200);\n+            g.setColor(SHAPE_COLOR);\n+            g.fillRect(0, 0, bounds.width, bounds.height);\n@@ -127,1 +134,2 @@\n-        Point wls = backgroundFrame.getLocationOnScreen();\n+        EventQueue.invokeAndWait(backgroundFrame::toFront);\n+        robot.waitForIdle();\n@@ -129,5 +137,2 @@\n-        robot.mouseMove(wls.x + 5, wls.y + 5);\n-        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n-        robot.delay(10);\n-        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n-        robot.delay(500);\n+        EventQueue.invokeAndWait(window::toFront);\n+        robot.waitForIdle();\n@@ -135,1 +140,1 @@\n-        EventQueue.invokeAndWait(window::requestFocus);\n+        robot.delay(500);\n@@ -137,1 +142,0 @@\n-        robot.waitForIdle();\n@@ -139,4 +143,1 @@\n-            Thread.sleep(300);\n-        } catch (InterruptedException e) {\n-            \/\/ ignore this one\n-        }\n+            colorCheck(innerPoint.x, innerPoint.y, SHAPE_COLOR, true);\n@@ -144,17 +145,2 @@\n-        \/\/ check transparency\n-        final int COUNT_TARGET = 10;\n-\n-        \/\/ checking outside points only\n-        for(int i = COUNT_TARGET; i < COUNT_TARGET * 2; i++) {\n-            int x = pointsToCheck[i][0];\n-            int y = pointsToCheck[i][1];\n-            boolean inside = i < COUNT_TARGET;\n-            Color c = robot.getPixelColor(window.getX() + x, window.getY() + y);\n-            System.out.println(\"checking \" + x + \", \" + y + \", color = \" + c);\n-            if (inside && BACKGROUND_COLOR.equals(c) || !inside && !BACKGROUND_COLOR.equals(c)) {\n-                System.out.println(\"window.getX() = \" + window.getX() + \", window.getY() = \" + window.getY());\n-                System.err.println(\"Checking for transparency failed: point: \" +\n-                        (window.getX() + x) + \", \" + (window.getY() + y) +\n-                        \", color = \" + c + (inside ? \" is of un\" : \" is not of \") +\n-                        \"expected background color \" + BACKGROUND_COLOR);\n-                throw new RuntimeException(\"Test failed. The shape has not been applied.\");\n+            for (Point point : pointsOutsideToCheck) {\n+                colorCheck(point.x, point.y, BACKGROUND_COLOR, true);\n@@ -162,1 +148,0 @@\n-        }\n@@ -164,2 +149,5 @@\n-        EventQueue.invokeAndWait(new Runnable() {\n-            public void run() {\n+            for (Point point : shadedPointsToCheck) {\n+                colorCheck(point.x, point.y, SHAPE_COLOR, false);\n+            }\n+        } finally {\n+            EventQueue.invokeAndWait(() -> {\n@@ -168,2 +156,31 @@\n-            }\n-        });\n+            });\n+        }\n+    }\n+\n+    private void colorCheck(int x, int y, Color expectedColor, boolean mustBeExpectedColor) {\n+\n+        int screenX = window.getX() + x;\n+        int screenY = window.getY() + y;\n+\n+        Color actualColor = robot.getPixelColor(screenX, screenY);\n+\n+        System.out.printf(\n+                \"Checking %3d, %3d, %35s should %sbe %35s\\n\",\n+                x, y,\n+                actualColor,\n+                (mustBeExpectedColor) ? \"\" : \"not \",\n+                expectedColor\n+        );\n+\n+        if (mustBeExpectedColor != expectedColor.equals(actualColor)) {\n+            System.out.printf(\"window.getX() = %3d, window.getY() = %3d\\n\", window.getX(), window.getY());\n+\n+            System.err.printf(\n+                    \"Checking for transparency failed: point: %3d, %3d\\n\\tactual    %s\\n\\texpected %s%s\\n\",\n+                    screenX,\n+                    screenY,\n+                    actualColor,\n+                    mustBeExpectedColor ? \"\" : \"not \",\n+                    expectedColor);\n+            throw new RuntimeException(\"Test failed. The shape has not been applied.\");\n+        }\n","filename":"test\/jdk\/java\/awt\/Frame\/ShapeNotSetSometimes\/ShapeNotSetSometimes.java","additions":88,"deletions":71,"binary":false,"changes":159,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,0 @@\n-import java.lang.ref.Reference;\n@@ -91,1 +90,6 @@\n-        assertGC();\n+\n+        try {\n+            assertGC();\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> frame.dispose());\n+        }\n","filename":"test\/jdk\/java\/awt\/im\/memoryleak\/InputContextMemoryLeakTest.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,2 @@\n+ * @library ..\/..\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -28,1 +30,1 @@\n- * @run main\/manual=yesno PrintGlyphVectorTest\n+ * @run main\/manual PrintGlyphVectorTest\n@@ -31,6 +33,19 @@\n-import java.io.*;\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.awt.font.*;\n-import java.awt.geom.*;\n-import java.awt.print.*;\n+import java.awt.BorderLayout;\n+import java.awt.Button;\n+import java.awt.Color;\n+import java.awt.Component;\n+import java.awt.Dialog;\n+import java.awt.Dimension;\n+import java.awt.Font;\n+import java.awt.Frame;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.Label;\n+import java.awt.font.FontRenderContext;\n+import java.awt.font.GlyphVector;\n+import java.awt.geom.Point2D;\n+import java.awt.geom.Rectangle2D;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n@@ -40,0 +55,12 @@\n+    private static final String INSTRUCTIONS = \"\"\"\n+            Note: You must have a printer installed for this test.\n+            If printer is not available, the test passes automatically.\n+\n+            Press the PRINT button on the 'Test PrintGlyphVector' frame\n+            and press OK\/print button on the print dialog.\n+\n+            Retrieve the output and compare the printed and on-screen\n+            text to confirm that in both cases the text is aligned and\n+            the boxes are around the text, not offset from the text.\n+            \"\"\";\n+\n@@ -49,3 +76,2 @@\n-\n-        float x = 50f,\n-              y = 50f;\n+        float x = 50f;\n+        float y = 50f;\n@@ -72,3 +98,0 @@\n-\n-\n-\n@@ -77,5 +100,5 @@\n-     public void paint(Graphics g) {\n-       g.setColor(Color.white);\n-       g.fillRect(0,0,getSize().width, getSize().height);\n-       drawGVs(g);\n-     }\n+    public void paint(Graphics g) {\n+        g.setColor(Color.white);\n+        g.fillRect(0, 0, getSize().width, getSize().height);\n+        drawGVs(g);\n+    }\n@@ -100,0 +123,7 @@\n+    private static void createTestUI() {\n+        PrinterJob pj = PrinterJob.getPrinterJob();\n+        if (pj.getPrintService() == null) {\n+            System.out.println(\"Printer not configured or available.\"\n+                    + \" Test cannot continue.\");\n+            PassFailJFrame.forcePass();\n+        }\n@@ -101,9 +131,29 @@\n-    public static void main(String arg[]) throws Exception {\n-\n-       Frame f = new Frame();\n-       PrintGlyphVectorTest pvt = new PrintGlyphVectorTest();\n-       f.add(\"Center\", pvt);\n-       f.add(\"South\", new PrintInstructions());\n-       f.pack();\n-       f.show();\n-\n+        Frame f = new Frame(\"Test PrintGlyphVector\");\n+        PrintGlyphVectorTest pvt = new PrintGlyphVectorTest();\n+        f.add(pvt, BorderLayout.CENTER);\n+\n+        Button printButton = new Button(\"PRINT\");\n+        printButton.addActionListener((e) -> {\n+            pj.setPrintable(new PrintGlyphVectorTest());\n+            if (pj.printDialog()) {\n+                try {\n+                    pj.print();\n+                } catch (PrinterException ex) {\n+                    throw new RuntimeException(ex.getMessage());\n+                }\n+            } else {\n+                throw new RuntimeException(\"Test failed : \"\n+                        + \"User selected 'Cancel' button on the print dialog\");\n+            }\n+        });\n+\n+        f.add(printButton, BorderLayout.SOUTH);\n+        f.pack();\n+        f.setVisible(true);\n+\n+        \/\/ add the test frame to dispose\n+        PassFailJFrame.addTestFrame(f);\n+\n+        \/\/ Arrange the test instruction frame and test frame side by side\n+        PassFailJFrame.positionTestFrame(f, PassFailJFrame.Position.HORIZONTAL);\n+    }\n@@ -111,0 +161,4 @@\n+    public static void main(String[] arg) throws Exception {\n+        PassFailJFrame passFailJFrame = new PassFailJFrame(INSTRUCTIONS);\n+        createTestUI();\n+        passFailJFrame.awaitAndCheck();\n@@ -114,37 +168,0 @@\n-class PrintInstructions extends Panel implements ActionListener {\n-\n-   static final String INSTRUCTIONS =\n-       \"You must have a printer installed for this test.\\n\" +\n-       \"Press the PRINT button below and OK the print dialog\\n\" +\n-       \"Retrieve the output and compare the printed and on-screen text\\n\" +\n-       \" to confirm that in both cases the text is aligned and the boxes\\n\" +\n-       \"are around the text, not offset from the text.\";\n-\n-  PrintInstructions() {\n-\n-     setLayout(new GridLayout(2,1));\n-     TextArea t = new TextArea(INSTRUCTIONS, 8, 80);\n-     add(t);\n-     Button b = new Button(\"PRINT\");\n-     b.setFont(new Font(\"Dialog\", Font.BOLD, 30));\n-     b.addActionListener(this);\n-     add(b);\n-  }\n-\n-  public void actionPerformed(ActionEvent e) {\n-       PrinterJob pj = PrinterJob.getPrinterJob();\n-       if (pj == null ||\n-           pj.getPrintService() == null ||\n-           !pj.printDialog()) {\n-           return;\n-       }\n-\n-       pj.setPrintable(new PrintGlyphVectorTest());\n-       try {\n-           pj.print();\n-       } catch (PrinterException ex) {\n-           System.err.println(ex);\n-       }\n-  }\n-\n-}\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/PrintGlyphVectorTest.java","additions":82,"deletions":65,"binary":false,"changes":147,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import java.awt.HeadlessException;\n@@ -50,1 +49,9 @@\n-    private final static CountDownLatch latch = new CountDownLatch(1);\n+    private static final String TITLE = \"Test Instruction Frame\";\n+    private static final long TEST_TIMEOUT = 5;\n+    private static final int ROWS = 10;\n+    private static final int COLUMNS = 40;\n+\n+    private static final List<Frame> frameList = new ArrayList<>();\n+    private static final Timer timer = new Timer(0, null);\n+    private static final CountDownLatch latch = new CountDownLatch(1);\n+\n@@ -55,2 +62,0 @@\n-    private static final List<Frame> frameList = new ArrayList<>();\n-    private static final Timer timer = new Timer(0, null);\n@@ -60,0 +65,16 @@\n+    public PassFailJFrame(String instructions) throws InterruptedException,\n+            InvocationTargetException {\n+        this(instructions, TEST_TIMEOUT);\n+    }\n+\n+    public PassFailJFrame(String instructions, long testTimeOut) throws\n+            InterruptedException, InvocationTargetException {\n+        this(TITLE, instructions, testTimeOut);\n+    }\n+\n+    public PassFailJFrame(String title, String instructions,\n+                          long testTimeOut) throws InterruptedException,\n+            InvocationTargetException {\n+        this(title, instructions, testTimeOut, ROWS, COLUMNS);\n+    }\n+\n@@ -68,11 +89,14 @@\n-     * @param title                title of the Frame.\n-     * @param instructions         specified instruction that user should follow.\n-     * @param rows                 number of visible rows of the JTextArea where the\n-     *                             instruction is show.\n-     * @param columns              Number of columns of the instructional\n-     *                             JTextArea\n-     * @param testTimeOutInMinutes timeout of the test where time is specified in\n-     *                             minutes.\n-     * @throws HeadlessException         HeadlessException\n-     * @throws InterruptedException      exception thrown for invokeAndWait\n-     * @throws InvocationTargetException exception thrown for invokeAndWait\n+     * @param title        title of the Frame.\n+     * @param instructions the instruction for the tester on how to test\n+     *                     and what is expected (pass) and what is not\n+     *                     expected (fail).\n+     * @param testTimeOut  test timeout where time is specified in minutes.\n+     * @param rows         number of visible rows of the JTextArea where the\n+     *                     instruction is show.\n+     * @param columns      Number of columns of the instructional\n+     *                     JTextArea\n+     * @throws InterruptedException      exception thrown when thread is\n+     *                                   interrupted\n+     * @throws InvocationTargetException if an exception is thrown while\n+     *                                   creating the test instruction frame on\n+     *                                   EDT\n@@ -80,5 +104,3 @@\n-    public PassFailJFrame(String title, String instructions,\n-                          int rows, int columns,\n-                          int testTimeOutInMinutes) throws HeadlessException,\n-            InterruptedException, InvocationTargetException {\n-\n+    public PassFailJFrame(String title, String instructions, long testTimeOut,\n+                          int rows, int columns) throws InterruptedException,\n+            InvocationTargetException {\n@@ -86,1 +108,1 @@\n-            createUI(title, instructions, rows, columns, testTimeOutInMinutes);\n+            createUI(title, instructions, testTimeOut, rows, columns);\n@@ -88,2 +110,2 @@\n-            invokeAndWait(() -> createUI(title, instructions, rows, columns,\n-                    testTimeOutInMinutes));\n+            invokeAndWait(() -> createUI(title, instructions, testTimeOut,\n+                    rows, columns));\n@@ -94,2 +116,1 @@\n-                                 int rows, int columns,\n-                                 int timeoutInMinutes) {\n+                                 long testTimeOut, int rows, int columns) {\n@@ -102,1 +123,1 @@\n-        long testTimeout = TimeUnit.MINUTES.toMillis(timeoutInMinutes);\n+        long tTimeout = TimeUnit.MINUTES.toMillis(testTimeOut);\n@@ -105,1 +126,1 @@\n-                \"timeout: %s\", convertMillisToTimeStr(testTimeout)), JLabel.CENTER);\n+                \"timeout: %s\", convertMillisToTimeStr(tTimeout)), JLabel.CENTER);\n@@ -109,1 +130,1 @@\n-            long leftTime = testTimeout - (System.currentTimeMillis() - startTime);\n+            long leftTime = tTimeout - (System.currentTimeMillis() - startTime);\n@@ -154,1 +175,0 @@\n-\n@@ -174,2 +194,4 @@\n-     * @throws InterruptedException      if the thread is interrupted\n-     * @throws InvocationTargetException exception thrown for invokeAndWait\n+     * @throws InterruptedException      exception thrown when thread is\n+     *                                   interrupted\n+     * @throws InvocationTargetException if an exception is thrown while\n+     *                                   disposing of frames on EDT\n@@ -275,0 +297,23 @@\n+\n+    \/**\n+     * Forcibly pass the test.\n+     * <p>The sample usage:\n+     * <pre><code>\n+     *      PrinterJob pj = PrinterJob.getPrinterJob();\n+     *      if (pj == null || pj.getPrintService() == null) {\n+     *          System.out.println(\"\"Printer not configured or available.\");\n+     *          PassFailJFrame.forcePass();\n+     *      }\n+     * <\/code><\/pre>\n+     *\/\n+    public static void forcePass() {\n+        latch.countDown();\n+    }\n+\n+    \/**\n+     *  Forcibly fail the test.\n+     *\/\n+    public static void forceFail() {\n+        failed = true;\n+        latch.countDown();\n+    }\n","filename":"test\/jdk\/java\/awt\/regtesthelpers\/PassFailJFrame.java","additions":76,"deletions":31,"binary":false,"changes":107,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8080535 8191410 8215194 8221431 8239383 8268081 8283465\n+ * @bug 8080535 8191410 8215194 8221431 8239383 8268081 8283465 8284856\n@@ -28,1 +28,2 @@\n- *      of Character.UnicodeBlock constants.\n+ *      of Character.UnicodeBlock constants. Also checks the size of\n+ *      Character.UnicodeScript's \"aliases\" map.\n@@ -41,1 +42,1 @@\n-    public void test_NumberEntities() throws Throwable {\n+    public void test_UnicodeBlock_NumberEntities() throws Throwable {\n@@ -50,0 +51,7 @@\n+    public void test_UnicodeScript_aliases() throws Throwable {\n+        \/\/ The number of entries in Character.UnicodeScript.aliases.\n+        \/\/ See src\/java.base\/share\/classes\/java\/lang\/Character.java\n+        Field aliases = Character.UnicodeScript.class.getDeclaredField(\"aliases\");\n+        aliases.setAccessible(true);\n+        assertEquals(((Map)aliases.get(null)).size(), Character.UnicodeScript.UNKNOWN.ordinal() + 1);\n+    }\n","filename":"test\/jdk\/java\/lang\/Character\/UnicodeBlock\/NumberEntities.java","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1,114 +0,0 @@\n-\/*\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/**\n- * @test\n- * @bug 8200696\n- * @summary Initial capacity of Class.enumConstantDirectory is not optimal\n- * @library \/test\/lib\n- * @modules java.base\/java.lang:open\n- *          java.base\/java.util:open\n- * @build jdk.test.lib.util.OptimalCapacity\n- * @run main ConstantDirectoryOptimalCapacity\n- *\/\n-\n-import jdk.test.lib.util.OptimalCapacity;\n-\n-public class ConstantDirectoryOptimalCapacity {\n-\n-    public static void main(String[] args) throws Throwable {\n-        test(E1.class);\n-        test(E2.class);\n-        test(E3.class);\n-        test(E4.class);\n-        test(E5.class);\n-        test(E6.class);\n-        test(E7.class);\n-        test(E8.class);\n-        test(E9.class);\n-        test(E10.class);\n-        test(E11.class);\n-        test(E12.class);\n-        test(E13.class);\n-        test(E14.class);\n-        test(E15.class);\n-        test(E16.class);\n-        test(E17.class);\n-        test(E18.class);\n-        test(E19.class);\n-        test(E20.class);\n-        test(E21.class);\n-        test(E22.class);\n-        test(E23.class);\n-        test(E24.class);\n-        test(E25.class);\n-        test(E26.class);\n-    }\n-\n-    private static void test(Class<? extends Enum> e) {\n-        Enum.valueOf(e, \"V0\"); \/\/ trigger init of enumConstantDirectory\n-\n-        int initialCapacity = (int)(e.getEnumConstants().length \/ 0.75f) + 1;\n-        OptimalCapacity.ofHashMap(e.getClass(), e, \"enumConstantDirectory\",\n-            initialCapacity);\n-    }\n-\n-    enum E1 { V0 }\n-    enum E2 { V0, V1 }\n-    enum E3 { V0, V1, V2 }\n-    enum E4 { V0, V1, V2, V3 }\n-    enum E5 { V0, V1, V2, V3, V4 }\n-    enum E6 { V0, V1, V2, V3, V4, V5 }\n-    enum E7 { V0, V1, V2, V3, V4, V5, V6 }\n-    enum E8 { V0, V1, V2, V3, V4, V5, V6, V7 }\n-    enum E9 { V0, V1, V2, V3, V4, V5, V6, V7, V8 }\n-    enum E10 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9 }\n-    enum E11 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10 }\n-    enum E12 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11 }\n-    enum E13 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12 }\n-    enum E14 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13 }\n-    enum E15 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14 }\n-    enum E16 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15 }\n-    enum E17 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16 }\n-    enum E18 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17 }\n-    enum E19 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18 }\n-    enum E20 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19 }\n-    enum E21 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19, V20 }\n-    enum E22 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19, V20, V21 }\n-    enum E23 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19, V20, V21, V22 }\n-    enum E24 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19, V20, V21, V22, V23 }\n-    enum E25 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19, V20, V21, V22, V23, V24 }\n-    enum E26 { V0, V1, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13,\n-               V14, V15, V16, V17, V18, V19, V20, V21, V22, V23, V24, V25 }\n-}\n","filename":"test\/jdk\/java\/lang\/Enum\/ConstantDirectoryOptimalCapacity.java","additions":0,"deletions":114,"binary":false,"changes":114,"status":"deleted"},{"patch":"@@ -0,0 +1,321 @@\n+\/*\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8282008\n+ * @requires (os.family == \"windows\")\n+ * @run main\/othervm ArgCheck\n+ * @summary Check invocation of exe and non-exe programs using ProcessBuilder\n+ *      and arguments with spaces, backslashes, and simple quoting.\n+ *\/\n+\n+import java.io.BufferedWriter;\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Arrays;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+\n+\/**\n+ * Class to check invocation of java, .cmd, and vbs scripts with arguments and various quote cases.\n+ * Can be run standalone to compare results with other Java versions.\n+ *\/\n+public class ArgCheck {\n+\n+    private static final Path SRC_DIR = Paths.get(System.getProperty(\"test.src\", \".\"));\n+    private static final Path WORK_DIR = Paths.get(System.getProperty(\"user.dir\", \".\"));\n+    private static final Path TEST_CLASSES = Paths.get(System.getProperty(\"test.classes\", \".\"));\n+\n+    private static final String ECHO_CMD_PATH = WORK_DIR.resolve(\"EchoArguments.cmd\").toString();\n+    private static final String ECHO_VBS_PATH = WORK_DIR.resolve(\"EchoArguments.vbs\").toString();\n+\n+    \/\/ Test argument containing both a space and a trailing backslash\n+    \/\/ Depending on the mode the final backslash may act as an escape that may turn an added quote to a literal quote\n+    private static final String SPACE_AND_BACKSLASH = \"SPACE AND BACKSLASH\\\\\";\n+    private static final char DOUBLE_QUOTE = '\"';\n+    private static final char BACKSLASH = '\\\\';\n+\n+    private static final String AMBIGUOUS_PROP_NAME = \"jdk.lang.Process.allowAmbiguousCommands\";\n+    private static final String AMBIGUOUS_PROP_VALUE = System.getProperty(AMBIGUOUS_PROP_NAME);\n+    private static final Boolean AMBIGUOUS_PROP_BOOLEAN = AMBIGUOUS_PROP_VALUE == null ? null :\n+                                                          Boolean.valueOf(!\"false\".equals(AMBIGUOUS_PROP_VALUE));\n+\n+    private static final List<String> ECHO_JAVA_ARGS = Arrays.asList(\"java\", \"-classpath\", TEST_CLASSES.toString(), \"ArgCheck\");\n+    private static final List<String> ECHO_CMD_ARGS = Arrays.asList(ECHO_CMD_PATH);\n+    private static final List<String> ECHO_VBS_ARGS = Arrays.asList(\"CScript\", \"\/b\", ECHO_VBS_PATH);\n+\n+    \/**\n+     * If zero arguments are supplied, run the test cases, by launching each as a child process.\n+     * If there are arguments, then this is a child Java process that prints each argument to stdout.\n+     * The test can be run manually with -Djdk.lang.Process.allowAmbiguousCommands={\"true\", \"false\", \"\"}\n+     * to run a matching subset of the tests.\n+     *\/\n+    public static void main(String[] args) throws IOException {\n+        if (args.length > 0) {\n+            \/\/ Echo supplied arguments and exit\n+            for (String arg : args)\n+                System.out.println(arg);\n+            return;\n+        }\n+\n+        System.out.println(\"Java Version: \" + System.getProperty(\"java.version\"));\n+\n+        createFiles();\n+\n+        int errors = 0;\n+        int success = 0;\n+        int skipped = 0;\n+\n+        for (CMD cmd : CASES) {\n+            \/\/ If System property jdk.lang.process.allowAmbiguousCommands matches the case, test it\n+            \/\/ If undefined, test them all\n+            if (AMBIGUOUS_PROP_BOOLEAN == null ||\n+                    AMBIGUOUS_PROP_BOOLEAN.booleanValue() == cmd.allowAmbiguous) {\n+                try {\n+                    testCommand(cmd);\n+                    success++;\n+                } catch (Exception ex) {\n+                    ex.printStackTrace();\n+                    errors++;\n+                }\n+            } else {\n+                \/\/ skip unmatched cases\n+                skipped++;\n+            }\n+        }\n+        if (skipped > 0) {\n+            System.out.printf(\"%d cases skipped, they did not match the tests with jdk.lang.Process.allowAmbiguousCommands: %s%n\",\n+                    skipped, AMBIGUOUS_PROP_BOOLEAN);\n+        }\n+        System.out.printf(\"\\nSuccess: %d, errors: %d%n\", success, errors);\n+        if (errors > 0) {\n+            throw new RuntimeException(\"Errors: \" + errors);\n+        }\n+    }\n+\n+    \/**\n+     * A CMD holds the parameters and the expected result of invoking a process with the parameters.\n+     *\/\n+    static class CMD {\n+        \/**\n+         * Construct a test case.\n+         * @param allowAmbiguous  true\/false to set property jdk.lang.Process.allowAmbiguousCommands\n+         * @param command list of command parameters to invoke the executable or script\n+         * @param arguments list of arguments (appended to the command)\n+         * @param expected    expected lines of output from invoked command\n+         *\/\n+        CMD(boolean allowAmbiguous, List<String> command, List<String> arguments, List<String> expected) {\n+            this.allowAmbiguous = allowAmbiguous;\n+            this.command = command;\n+            this.arguments = arguments;\n+            this.expected = expected;\n+        }\n+\n+        final boolean allowAmbiguous;\n+        final List<String> command;\n+        final List<String> arguments;\n+        final List<String> expected;\n+    }\n+\n+    \/**\n+     * List of cases with the command, arguments, allowAmbiguous setting, and the expected results\n+     *\/\n+    static final List<CMD> CASES = Arrays.asList(\n+\n+            \/\/ allowAmbiguousCommands = false, without application supplied double-quotes.\n+            \/\/ The space in the argument requires it to be quoted, the final backslash\n+            \/\/ must not be allowed to turn the quote that is added into a literal\n+            \/\/ instead of closing the quote.\n+            new CMD(false,\n+                    ECHO_JAVA_ARGS,\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_1\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_1\")),\n+            new CMD(false,\n+                    ECHO_CMD_ARGS,\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_2\"),\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_2\")),\n+            new CMD(false,\n+                    ECHO_VBS_ARGS,\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_3\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH + BACKSLASH, \"ARG_3\")),\n+\n+            \/\/ allowAmbiguousCommands = false, WITH application supplied double-quotes around the argument\n+            \/\/ The argument has surrounding quotes so does not need further quoting.\n+            \/\/ However, for exe commands, the final backslash must not be allowed to turn the quote\n+            \/\/ into a literal instead of closing the quote.\n+            new CMD(false,\n+                    ECHO_JAVA_ARGS,\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_11\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_11\")),\n+            new CMD(false,\n+                    ECHO_CMD_ARGS,\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_12\"),\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_12\")),\n+            new CMD(false,\n+                    ECHO_VBS_ARGS,\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_13\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH + BACKSLASH, \"ARG_13\")),\n+\n+            \/\/ Legacy mode tests; allowAmbiguousCommands = true; no application supplied quotes\n+            \/\/ The space in the argument requires it to be quoted, the final backslash\n+            \/\/ must not be allowed to turn the quote that is added into a literal\n+            \/\/ instead of closing the quote.\n+            new CMD(true,\n+                    ECHO_JAVA_ARGS,\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_21\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_21\")),\n+            new CMD(true,\n+                    ECHO_CMD_ARGS,\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_22\"),\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + BACKSLASH + DOUBLE_QUOTE, \"ARG_22\")),\n+            new CMD(true,\n+                    ECHO_VBS_ARGS,\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_23\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH + BACKSLASH, \"ARG_23\")),\n+\n+            \/\/ allowAmbiguousCommands = true, WITH application supplied double-quotes around the argument\n+            \/\/ The argument has surrounding quotes so does not need further quoting.\n+            \/\/ The backslash before the final quote is ignored and is interpreted differently for each command.\n+            new CMD(true,\n+                    ECHO_JAVA_ARGS,\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_31\"),\n+                    Arrays.asList(\"SPACE AND BACKSLASH\\\" ARG_31\")),\n+            new CMD(true,\n+                    ECHO_CMD_ARGS,\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_32\"),\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_32\")),\n+            new CMD(true,\n+                    ECHO_VBS_ARGS,\n+                    Arrays.asList(DOUBLE_QUOTE + SPACE_AND_BACKSLASH + DOUBLE_QUOTE, \"ARG_33\"),\n+                    Arrays.asList(SPACE_AND_BACKSLASH, \"ARG_33\"))\n+    );\n+\n+    \/**\n+     * Common function to Invoke a process with the commands and check the result.\n+     *\n+     * @param cmd a CMD test case with arguments, allowAmbiguousCommands mode, and expected output\n+     *\/\n+    private static void testCommand(CMD cmd) throws Exception {\n+        System.setProperty(AMBIGUOUS_PROP_NAME, Boolean.toString(cmd.allowAmbiguous));\n+        List<String> actual = null;\n+        List<String> arguments = new ArrayList<>(cmd.command);\n+        arguments.addAll(cmd.arguments);\n+        try {\n+            \/\/ Launch the process and wait for termination\n+            ProcessBuilder pb = new ProcessBuilder(arguments);\n+            Process process = pb.start();\n+            try (InputStream is = process.getInputStream()) {\n+                String str = readAllBytesAsString(is);\n+                str = str.replace(\"\\r\", \"\");\n+                actual = Arrays.asList(str.split(\"\\n\"));\n+            } catch (IOException ioe) {\n+                throw new RuntimeException(ioe.getMessage(), ioe);\n+            }\n+            int exitCode = process.waitFor();\n+            if (exitCode != 0) {\n+                actual = new ArrayList(actual);\n+                actual.add(\"Exit code: \" + exitCode);\n+            }\n+        } catch (IOException ioe) {\n+            actual = Arrays.asList(ioe.getMessage().replace(arguments.get(0), \"CMD\"));\n+        } catch (Exception ex) {\n+            actual = Arrays.asList(ex.getMessage());       \/\/ Use exception message as output\n+        }\n+        if (!Objects.equals(actual, cmd.expected)) {\n+            System.out.println(\"Invoking(\" + cmd.allowAmbiguous + \"): \" + arguments);\n+            if (actual.size() != cmd.expected.size()) {\n+                System.out.println(\"Args Length: actual: \" + actual.size() + \" expected: \" + cmd.expected.size());\n+            }\n+            System.out.println(\"Actual:   \" + actual);\n+            System.out.println(\"Expected: \" + cmd.expected);\n+            System.out.println();\n+            throw new RuntimeException(\"Unexpected output\");\n+        }\n+    }\n+\n+    \/**\n+     * Private method to readAllBytes as a String.\n+     * (InputStream.readAllBytes is not supported by the JDK until 9)\n+     * @param is an InputStream\n+     * @return a String with the contents\n+     * @throws IOException if an error occurs\n+     *\/\n+    private static String readAllBytesAsString(InputStream is) throws IOException {\n+        final int BUF_SIZE = 8192;\n+        byte[] bytes = new byte[BUF_SIZE];\n+        int off = 0;\n+        int len;\n+        while ((len = is.read(bytes, off, bytes.length - off)) > 0) {\n+            off += len;\n+            if (off >= bytes.length) {\n+                \/\/ no space in buffer, reallocate larger\n+                bytes = Arrays.copyOf(bytes, bytes.length + BUF_SIZE);\n+            }\n+        }\n+        return new String(bytes, 0, off, Charset.defaultCharset());\n+    }\n+\n+    \/**\n+     * Initialize .cmd and .vbs scripts.\n+     *\n+     * @throws Error if an exception occurs\n+     *\/\n+    private static void createFiles() throws IOException {\n+        Files.write(Paths.get(ECHO_CMD_PATH), EchoArgumentsCmd.getBytes(StandardCharsets.UTF_8));\n+        Files.write(Paths.get(ECHO_VBS_PATH), EchoArgumentsVbs.getBytes(StandardCharsets.UTF_8));\n+    }\n+\n+    \/**\n+     * Self contained .cmd to echo each argument on a separate line.\n+     *\/\n+    static final String EchoArgumentsCmd = \"@echo off\\n\" +\n+            \"set p1=\\n\" +\n+            \"set p2=\\n\" +\n+            \"\\n\" +\n+            \"if not [%1]==[] set p1=%1\\n\" +\n+            \"if not [%2]==[] set p2=%2\\n\" +\n+            \"if not [%3]==[] set p3=%3\\n\" +\n+            \"if defined p1 echo %p1%\\n\" +\n+            \"if defined p2 echo %p2%\\n\" +\n+            \"if defined p3 echo %p3%\\n\" +\n+            \"exit \/b 0\\n\";\n+\n+\n+    \/**\n+     * Self contained .vbs to echo each argument on a separate line.\n+     *\/\n+    static final String EchoArgumentsVbs = \"Option Explicit\\n\" +\n+            \"Dim arg\\n\" +\n+            \"for each arg in WScript.Arguments\\n\" +\n+            \"  WScript.StdOut.WriteLine(arg)\\n\" +\n+            \"Next\\n\";\n+}\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/ArgCheck.java","additions":321,"deletions":0,"binary":false,"changes":321,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+import java.util.Map;\n@@ -95,0 +96,72 @@\n+                \/\/ Turkish I with dot\n+                new Object[] { \"\\u0130\", false, 0, \"i\", 0, 1, false },\n+                new Object[] { \"\\u0130\", true,  0, \"i\", 0, 1, true },\n+                \/\/ i without dot\n+                new Object[] { \"\\u0131\", false, 0, \"i\", 0, 1, false },\n+                new Object[] { \"\\u0131\", true,  0, \"i\", 0, 1, true },\n+                \/\/ Exhaustive list of 1-char latin1 strings that match\n+                \/\/ case-insensitively:\n+                \/\/ for (char c1 = 0; c1 < 255; c1++) {\n+                \/\/   for (char c2 = c; c2 < 255; c2++) {\n+                \/\/     if (c1 == c2) continue;\n+                \/\/     if (String.valueOf(c1).regionMatches(true, 0, String.valueOf(c2), 0, 1)) {\n+                \/\/       System.out.println(\"                new Object[] { \\\"\\\\u00\"\n+                \/\/                          + Integer.toHexString((int)c) + \"\\\", true, 0, \\\"\\\\u00\"\n+                \/\/                          + Integer.toHexString((int)c2) + \"\\\", 0, 1, true },\");\n+                \/\/ }}}\n+                new Object[] { \"\\u0041\", true, 0, \"\\u0061\", 0, 1, true },\n+                new Object[] { \"\\u0042\", true, 0, \"\\u0062\", 0, 1, true },\n+                new Object[] { \"\\u0043\", true, 0, \"\\u0063\", 0, 1, true },\n+                new Object[] { \"\\u0044\", true, 0, \"\\u0064\", 0, 1, true },\n+                new Object[] { \"\\u0045\", true, 0, \"\\u0065\", 0, 1, true },\n+                new Object[] { \"\\u0046\", true, 0, \"\\u0066\", 0, 1, true },\n+                new Object[] { \"\\u0047\", true, 0, \"\\u0067\", 0, 1, true },\n+                new Object[] { \"\\u0048\", true, 0, \"\\u0068\", 0, 1, true },\n+                new Object[] { \"\\u0049\", true, 0, \"\\u0069\", 0, 1, true },\n+                new Object[] { \"\\u004a\", true, 0, \"\\u006a\", 0, 1, true },\n+                new Object[] { \"\\u004b\", true, 0, \"\\u006b\", 0, 1, true },\n+                new Object[] { \"\\u004c\", true, 0, \"\\u006c\", 0, 1, true },\n+                new Object[] { \"\\u004d\", true, 0, \"\\u006d\", 0, 1, true },\n+                new Object[] { \"\\u004e\", true, 0, \"\\u006e\", 0, 1, true },\n+                new Object[] { \"\\u004f\", true, 0, \"\\u006f\", 0, 1, true },\n+                new Object[] { \"\\u0050\", true, 0, \"\\u0070\", 0, 1, true },\n+                new Object[] { \"\\u0051\", true, 0, \"\\u0071\", 0, 1, true },\n+                new Object[] { \"\\u0052\", true, 0, \"\\u0072\", 0, 1, true },\n+                new Object[] { \"\\u0053\", true, 0, \"\\u0073\", 0, 1, true },\n+                new Object[] { \"\\u0054\", true, 0, \"\\u0074\", 0, 1, true },\n+                new Object[] { \"\\u0055\", true, 0, \"\\u0075\", 0, 1, true },\n+                new Object[] { \"\\u0056\", true, 0, \"\\u0076\", 0, 1, true },\n+                new Object[] { \"\\u0057\", true, 0, \"\\u0077\", 0, 1, true },\n+                new Object[] { \"\\u0058\", true, 0, \"\\u0078\", 0, 1, true },\n+                new Object[] { \"\\u0059\", true, 0, \"\\u0079\", 0, 1, true },\n+                new Object[] { \"\\u005a\", true, 0, \"\\u007a\", 0, 1, true },\n+                new Object[] { \"\\u00c0\", true, 0, \"\\u00e0\", 0, 1, true },\n+                new Object[] { \"\\u00c1\", true, 0, \"\\u00e1\", 0, 1, true },\n+                new Object[] { \"\\u00c2\", true, 0, \"\\u00e2\", 0, 1, true },\n+                new Object[] { \"\\u00c3\", true, 0, \"\\u00e3\", 0, 1, true },\n+                new Object[] { \"\\u00c4\", true, 0, \"\\u00e4\", 0, 1, true },\n+                new Object[] { \"\\u00c5\", true, 0, \"\\u00e5\", 0, 1, true },\n+                new Object[] { \"\\u00c6\", true, 0, \"\\u00e6\", 0, 1, true },\n+                new Object[] { \"\\u00c7\", true, 0, \"\\u00e7\", 0, 1, true },\n+                new Object[] { \"\\u00c8\", true, 0, \"\\u00e8\", 0, 1, true },\n+                new Object[] { \"\\u00c9\", true, 0, \"\\u00e9\", 0, 1, true },\n+                new Object[] { \"\\u00ca\", true, 0, \"\\u00ea\", 0, 1, true },\n+                new Object[] { \"\\u00cb\", true, 0, \"\\u00eb\", 0, 1, true },\n+                new Object[] { \"\\u00cc\", true, 0, \"\\u00ec\", 0, 1, true },\n+                new Object[] { \"\\u00cd\", true, 0, \"\\u00ed\", 0, 1, true },\n+                new Object[] { \"\\u00ce\", true, 0, \"\\u00ee\", 0, 1, true },\n+                new Object[] { \"\\u00cf\", true, 0, \"\\u00ef\", 0, 1, true },\n+                new Object[] { \"\\u00d0\", true, 0, \"\\u00f0\", 0, 1, true },\n+                new Object[] { \"\\u00d1\", true, 0, \"\\u00f1\", 0, 1, true },\n+                new Object[] { \"\\u00d2\", true, 0, \"\\u00f2\", 0, 1, true },\n+                new Object[] { \"\\u00d3\", true, 0, \"\\u00f3\", 0, 1, true },\n+                new Object[] { \"\\u00d4\", true, 0, \"\\u00f4\", 0, 1, true },\n+                new Object[] { \"\\u00d5\", true, 0, \"\\u00f5\", 0, 1, true },\n+                new Object[] { \"\\u00d6\", true, 0, \"\\u00f6\", 0, 1, true },\n+                new Object[] { \"\\u00d8\", true, 0, \"\\u00f8\", 0, 1, true },\n+                new Object[] { \"\\u00d9\", true, 0, \"\\u00f9\", 0, 1, true },\n+                new Object[] { \"\\u00da\", true, 0, \"\\u00fa\", 0, 1, true },\n+                new Object[] { \"\\u00db\", true, 0, \"\\u00fb\", 0, 1, true },\n+                new Object[] { \"\\u00dc\", true, 0, \"\\u00fc\", 0, 1, true },\n+                new Object[] { \"\\u00dd\", true, 0, \"\\u00fd\", 0, 1, true },\n+                new Object[] { \"\\u00de\", true, 0, \"\\u00fe\", 0, 1, true },\n@@ -101,1 +174,1 @@\n-        map.get(str)\n+        map.getOrDefault(str, Map.of(str, str)) \/\/ Allow data provider to test adhoc strings\n","filename":"test\/jdk\/java\/lang\/String\/CompactString\/RegionMatches.java","additions":75,"deletions":2,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -0,0 +1,113 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+\/**\n+ * @test\n+ * @bug 8281006\n+ * @summary Test uses custom launcher that starts VM using JNI that verifies\n+ *          Module::getResourceAsStream and Class::getResourceAsStream with\n+ *          a null caller class functions properly.\n+ * @library \/test\/lib\n+ * @modules java.base\/jdk.internal.module\n+ *          jdk.compiler\n+ * @build NullCallerGetResource\n+ *        jdk.test.lib.compiler.CompilerUtils\n+ * @requires os.family != \"aix\"\n+ * @run main\/native NullCallerGetResource\n+ *\/\n+\n+\/\/ Test disabled on AIX since we cannot invoke the JVM on the primordial thread.\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import jdk.test.lib.Platform;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.compiler.CompilerUtils;\n+\n+public class NullCallerGetResource {\n+\n+    private static final String TEST_SRC = System.getProperty(\"test.src\");\n+\n+    \/\/ the module name of the test module\n+    private static final String TEST_MODULE = \"n\";\n+\n+    private static final Path SRC_DIR    = Paths.get(TEST_SRC, \"src\");\n+    private static final Path MODS_DIR   = Paths.get(\"mods\");\n+    private static final Path TEST_MOD_DIR = MODS_DIR.resolve(TEST_MODULE);\n+\n+    \/*\n+     * Build the test module called 'n' which opens the package 'open'\n+     * to everyone.  There is also a package 'closed' which is neither\n+     * opened or exported.\n+     *\/\n+    static void compileTestModule() throws Exception {\n+        \/\/ javac -d mods\/$TESTMODULE src\/$TESTMODULE\/**\n+        boolean compiled\n+                = CompilerUtils.compile(SRC_DIR.resolve(TEST_MODULE), TEST_MOD_DIR);\n+        assert (compiled);\n+        var open = TEST_MOD_DIR.resolve(\"open\/test.txt\");\n+        try (var out = Files.newBufferedWriter(open)) {\n+            out.write(\"open\");\n+            out.flush();\n+        }\n+        var closed = TEST_MOD_DIR.resolve(\"closed\/test.txt\");\n+        try (var out = Files.newBufferedWriter(closed)) {\n+            out.write(\"closed\");\n+            out.flush();\n+        }\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+\n+        \/\/ build the module used for the test\n+        compileTestModule();\n+\n+        var launcher = Path.of(System.getProperty(\"test.nativepath\"), \"NullCallerGetResource\");\n+        var pb = new ProcessBuilder(launcher.toString());\n+        var env = pb.environment();\n+\n+        var libDir = Platform.libDir().toString();\n+        var vmDir = Platform.jvmLibDir().toString();\n+\n+        \/\/ set up shared library path\n+        var sharedLibraryPathEnvName = Platform.sharedLibraryPathVariableName();\n+        env.compute(sharedLibraryPathEnvName,\n+                (k, v) -> (v == null) ? libDir : v + File.pathSeparator + libDir);\n+        env.compute(sharedLibraryPathEnvName,\n+                (k, v) -> (v == null) ? vmDir : v + File.pathSeparator + vmDir);\n+\n+        \/\/ launch the actual test\n+        System.out.println(\"Launching: \" + launcher + \" shared library path: \" +\n+                env.get(sharedLibraryPathEnvName));\n+        new OutputAnalyzer(pb.start())\n+                .outputTo(System.out)\n+                .errorTo(System.err)\n+                .shouldHaveExitValue(0);\n+\n+    }\n+\n+}\n+\n","filename":"test\/jdk\/java\/lang\/module\/exeNullCallerGetResource\/NullCallerGetResource.java","additions":113,"deletions":0,"binary":false,"changes":113,"status":"added"},{"patch":"@@ -0,0 +1,184 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#include <stdio.h>\n+#include <stdlib.h>\n+\n+#include \"jni.h\"\n+#undef NDEBUG\n+#include \"assert.h\"\n+#include \"string.h\"\n+\n+static jclass class_InputStream = NULL;\n+static jmethodID mid_InputStream_close = NULL;\n+\n+\/\/ in.close();\n+void closeInputStream(JNIEnv *env, jobject in) {\n+    (*env)->CallObjectMethod(env, in, mid_InputStream_close);\n+    if ((*env)->ExceptionOccurred(env) != NULL) {\n+        printf(\"ERROR: Exception was thrown calling InputStream::close.\\n\");\n+        (*env)->ExceptionDescribe(env);\n+        exit(-1);\n+    }\n+}\n+\n+\/*\n+ * The java test running this native test creates a test module named 'n'\n+ * which opens the package 'open'.  It has a text file resource named\n+ * 'test.txt' in the open package.  It also has a class called\n+ * open.OpenResources.  One should be able to get the resource through\n+ * either the Class or the Module with getResourceAsStream.\n+ *\n+ * Class c = open.OpenResources.fetchClass();\n+ * InputStream in1 = c.getResourceAsStream(\"test.txt\");\n+ * Module n = c.getModule();\n+ * InputStream in2 = n.getResourceAsStream(\"open\/test.txt\");\n+ *\n+ * The test also checks that closed resources are not available and\n+ * don't throw any exceptions.  The test module contains a class\n+ * called closed.ClosedResources and a file 'test.txt' in the package\n+ * 'closed'.\n+ *\n+ * Class closed = closed.ClosedResources.fetchClass();\n+ * assert(closed.getResourceAsStream(\"test.txt\") == null);\n+ * assert(n.getResourceAsStream(\"closed\/test.txt\") == null);\n+ *\n+ *\/\n+int main(int argc, char** args) {\n+    JavaVM *jvm;\n+    JNIEnv *env;\n+    JavaVMInitArgs vm_args;\n+    JavaVMOption options[4];\n+    jint rc;\n+\n+    options[0].optionString = \"--module-path=mods\";\n+    options[1].optionString = \"--add-modules=n\";\n+\n+    vm_args.version = JNI_VERSION_9;\n+    vm_args.nOptions = 2;\n+    vm_args.options = options;\n+\n+    if ((rc = JNI_CreateJavaVM(&jvm, (void**)&env, &vm_args)) != JNI_OK) {\n+        printf(\"ERROR: cannot create VM.\\n\");\n+        exit(-1);\n+    }\n+\n+    \/\/ initialize for stream close\n+    class_InputStream = (*env)->FindClass(env, \"java\/io\/InputStream\");\n+    assert(class_InputStream != NULL);\n+    mid_InputStream_close = (*env)->GetMethodID(env, class_InputStream, \"close\", \"()V\" );\n+    assert(mid_InputStream_close != NULL);\n+\n+    \/\/ the open and closed classes\n+    jclass class_OpenResources = (*env)->FindClass(env, \"open\/OpenResources\");\n+    assert(class_OpenResources != NULL);\n+    jclass class_ClosedResources = (*env)->FindClass(env, \"closed\/ClosedResources\");\n+    assert(class_ClosedResources != NULL);\n+\n+    \/\/ Fetch the Module from one of the classes in the module\n+    jclass class_Class = (*env)->FindClass(env, \"java\/lang\/Class\");\n+    assert(class_Class != NULL);\n+    jmethodID mid_Class_getModule = (*env)->GetMethodID(env, class_Class, \"getModule\", \"()Ljava\/lang\/Module;\" );\n+    assert(mid_Class_getModule != NULL);\n+    jobject n =(*env)->CallObjectMethod(env, class_OpenResources, mid_Class_getModule);\n+    if ((*env)->ExceptionOccurred(env) != NULL) {\n+        printf(\"ERROR: Exception was thrown calling Class::getModule.\\n\");\n+        (*env)->ExceptionDescribe(env);\n+        exit(-1);\n+    }\n+    assert(n != NULL);\n+\n+    \/\/ Attempt to fetch an open resource from the module.  It should return a valid stream.\n+    \/\/ InputStream in = n.getResourceAsStream(\"open\/test.txt\");\n+    jclass class_Module = (*env)->FindClass(env, \"java\/lang\/Module\");\n+    assert(class_Module != NULL);\n+    jmethodID mid_Module_getResourceAsStream =\n+        (*env)->GetMethodID(env, class_Module, \"getResourceAsStream\", \"(Ljava\/lang\/String;)Ljava\/io\/InputStream;\" );\n+    assert(mid_Module_getResourceAsStream != NULL);\n+    jobject in = (*env)->CallObjectMethod(env, n, mid_Module_getResourceAsStream,\n+        (*env)->NewStringUTF(env, \"open\/test.txt\"));\n+    if ((*env)->ExceptionOccurred(env) != NULL) {\n+        printf(\"ERROR: Exception was thrown calling Module::getResourceAsStream on 'open\/test.txt'.\\n\");\n+        (*env)->ExceptionDescribe(env);\n+        exit(-1);\n+    }\n+    if (in == NULL) {\n+        printf(\"ERROR: Module::getResourceAsStream, expected valid stream for open resource\\n\");\n+        exit(-1);\n+    }\n+\n+    \/\/ in.close();\n+    closeInputStream(env, in);\n+\n+    \/\/ Attempt to fetch closed resource from the module.  It should return null.\n+    \/\/ in = n.getResourceAsStream(\"closed\/test.txt\");\n+    in =  (*env)->CallObjectMethod(env, n, mid_Module_getResourceAsStream,\n+        (*env)->NewStringUTF(env, \"closed\/test.txt\"));\n+    if ((*env)->ExceptionOccurred(env) != NULL) {\n+        printf(\"ERROR: Exception was thrown calling Module::getResourceAsStream on 'closed\/test.txt'.\\n\");\n+        (*env)->ExceptionDescribe(env);\n+        exit(-1);\n+    }\n+    if (in != NULL) {\n+        printf(\"ERROR: Module::getResourceAsStream, expected null value for closed resource\\n\");\n+        exit(-1);\n+    }\n+\n+    \/\/ Attempt to fetch open resource from the class.  It should return a valid stream.\n+    \/\/ in = open.OpenReosurces.class.getResourceAsStream(\"test.txt\");\n+    jmethodID mid_Class_getResourceAsStream =\n+        (*env)->GetMethodID(env, class_Class, \"getResourceAsStream\", \"(Ljava\/lang\/String;)Ljava\/io\/InputStream;\" );\n+    assert(mid_Class_getResourceAsStream != NULL);\n+    in =  (*env)->CallObjectMethod(env, class_OpenResources, mid_Class_getResourceAsStream,\n+        (*env)->NewStringUTF(env, \"test.txt\"));\n+    if ((*env)->ExceptionOccurred(env) != NULL) {\n+        printf(\"ERROR: Exception was thrown calling Class::getResourceAsStream on 'test.txt'.\\n\");\n+        (*env)->ExceptionDescribe(env);\n+        exit(-1);\n+    }\n+    if (in == NULL) {\n+        printf(\"ERROR: Class::getResourceAsStream, expected valid stream for open resource\\n\");\n+        exit(-1);\n+    }\n+\n+    \/\/ in.close();\n+    closeInputStream(env, in);\n+\n+    \/\/ Attempt to fetch closed resource from the class.  It should return null.\n+    \/\/ in = closed.ClosedResources.class.getResourceAsStream(\"test.txt\");\n+    in =  (*env)->CallObjectMethod(env, class_ClosedResources, mid_Class_getResourceAsStream,\n+        (*env)->NewStringUTF(env, \"test.txt\"));\n+    if ((*env)->ExceptionOccurred(env) != NULL) {\n+        printf(\"ERROR: Exception was thrown calling Class::getResourceAsStream on closed 'test.txt'.\\n\");\n+        (*env)->ExceptionDescribe(env);\n+        exit(-1);\n+    }\n+    if (in != NULL) {\n+        printf(\"ERROR: Class::getResourceAsStream, expected null value for closed resource\\n\");\n+        exit(-1);\n+    }\n+\n+    (*jvm)->DestroyJavaVM(jvm);\n+    return 0;\n+}\n+\n","filename":"test\/jdk\/java\/lang\/module\/exeNullCallerGetResource\/exeNullCallerGetResource.c","additions":184,"deletions":0,"binary":false,"changes":184,"status":"added"},{"patch":"@@ -0,0 +1,29 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package closed;\n+\n+\/\/ class to test relative access to a closed resource\n+\/\/ with Class::getResourceAsStream with no caller frame\n+public class ClosedResources {\n+}\n","filename":"test\/jdk\/java\/lang\/module\/exeNullCallerGetResource\/src\/n\/closed\/ClosedResources.java","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"},{"patch":"@@ -0,0 +1,28 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/\/ module to test access to both open and closed resources using\n+\/\/ Module::getResourceAsStream with no caller frame\n+module n {\n+    opens open;\n+}\n","filename":"test\/jdk\/java\/lang\/module\/exeNullCallerGetResource\/src\/n\/module-info.java","additions":28,"deletions":0,"binary":false,"changes":28,"status":"added"},{"patch":"@@ -0,0 +1,29 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package open;\n+\n+\/\/ class used to test relative access to an open resource\n+\/\/ with Class::getResourceAsStream with no caller frame\n+public class OpenResources {\n+}\n","filename":"test\/jdk\/java\/lang\/module\/exeNullCallerGetResource\/src\/n\/open\/OpenResources.java","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"},{"patch":"@@ -0,0 +1,421 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8277969\n+ * @summary Test for edge case where the executor is not accepting\n+ *          new tasks while the client is still running\n+ * @modules java.base\/sun.net.www.http\n+ *          java.net.http\/jdk.internal.net.http.common\n+ *          java.net.http\/jdk.internal.net.http.frame\n+ *          java.net.http\/jdk.internal.net.http.hpack\n+ *          java.logging\n+ *          jdk.httpserver\n+ * @library \/test\/lib http2\/server\n+ * @build Http2TestServer\n+ * @build jdk.test.lib.net.SimpleSSLContext ReferenceTracker\n+ * @run testng\/othervm\n+ *       -Djdk.internal.httpclient.debug=true\n+ *       -Djdk.httpclient.HttpClient.log=trace,headers,requests\n+ *       AsyncExecutorShutdown\n+ *\/\n+\/\/ -Djdk.internal.httpclient.debug=true\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.io.UncheckedIOException;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import java.net.http.HttpClient;\n+import java.net.http.HttpClient.Redirect;\n+import java.net.http.HttpRequest;\n+import java.net.http.HttpResponse;\n+import java.net.http.HttpResponse.BodyHandlers;\n+import java.nio.channels.ClosedChannelException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Random;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionException;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.RejectedExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import java.util.function.Function;\n+import javax.net.ssl.SSLContext;\n+import javax.net.ssl.SSLHandshakeException;\n+\n+import com.sun.net.httpserver.HttpServer;\n+import com.sun.net.httpserver.HttpsConfigurator;\n+import com.sun.net.httpserver.HttpsServer;\n+import jdk.test.lib.RandomFactory;\n+import jdk.test.lib.net.SimpleSSLContext;\n+import org.testng.annotations.AfterTest;\n+import org.testng.annotations.BeforeTest;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+import static java.lang.System.out;\n+import static java.net.http.HttpClient.Builder.NO_PROXY;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.fail;\n+\n+public class AsyncExecutorShutdown implements HttpServerAdapters {\n+\n+    static {\n+        HttpServerAdapters.enableServerLogging();\n+    }\n+    static final Random RANDOM = RandomFactory.getRandom();\n+\n+    SSLContext sslContext;\n+    HttpTestServer httpTestServer;        \/\/ HTTP\/1.1    [ 4 servers ]\n+    HttpTestServer httpsTestServer;       \/\/ HTTPS\/1.1\n+    HttpTestServer http2TestServer;       \/\/ HTTP\/2 ( h2c )\n+    HttpTestServer https2TestServer;      \/\/ HTTP\/2 ( h2  )\n+    String httpURI;\n+    String httpsURI;\n+    String http2URI;\n+    String https2URI;\n+\n+    static final String MESSAGE = \"AsyncExecutorShutdown message body\";\n+    static final int ITERATIONS = 3;\n+\n+    @DataProvider(name = \"positive\")\n+    public Object[][] positive() {\n+        return new Object[][] {\n+                { httpURI,    },\n+                { httpsURI,   },\n+                { http2URI,   },\n+                { https2URI,  },\n+        };\n+    }\n+\n+    static final AtomicLong requestCounter = new AtomicLong();\n+    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+\n+    static Throwable getCause(Throwable t) {\n+        while (t instanceof CompletionException || t instanceof ExecutionException) {\n+            t = t.getCause();\n+        }\n+        return t;\n+    }\n+\n+    static String readBody(InputStream in) {\n+        try {\n+            return new String(in.readAllBytes(), StandardCharsets.UTF_8);\n+        } catch (IOException io) {\n+            throw new UncheckedIOException(io);\n+        }\n+    }\n+\n+    static void checkCause(String what, Throwable cause) {\n+        Throwable t = cause;\n+        Throwable accepted = null;\n+        while (t != null) {\n+            out.println(what + \": checking \" + t);\n+            if (t instanceof  RejectedExecutionException) {\n+                out.println(what + \": Got expected RejectedExecutionException in cause: \" + t);\n+                return;\n+            } else if (t instanceof ClosedChannelException) {\n+                out.println(what + \": Accepting ClosedChannelException as a valid cause: \" + t);\n+                accepted = t;\n+            }\n+            t = t.getCause();\n+        }\n+        if (accepted != null) {\n+            out.println(what + \": Didn't find expected RejectedExecutionException, \" +\n+                    \"but accepting \" + accepted.getClass().getSimpleName()\n+                    + \" as a valid cause: \" + accepted);\n+            return;\n+        }\n+        throw new AssertionError(what + \": Unexpected exception: \" + cause, cause);\n+    }\n+\n+    @Test(dataProvider = \"positive\")\n+    void testConcurrent(String uriString) throws Exception {\n+        out.printf(\"%n---- starting (%s) ----%n\", uriString);\n+        ExecutorService executorService = Executors.newCachedThreadPool();\n+        ExecutorService readerService = Executors.newCachedThreadPool();\n+        HttpClient client = HttpClient.newBuilder()\n+                .proxy(NO_PROXY)\n+                .followRedirects(Redirect.ALWAYS)\n+                .executor(executorService)\n+                .sslContext(sslContext)\n+                .build();\n+        TRACKER.track(client);\n+        assert client.executor().isPresent();\n+\n+        int step = RANDOM.nextInt(ITERATIONS);\n+        try {\n+            List<CompletableFuture<String>> bodies = new ArrayList<>();\n+            for (int i = 0; i < ITERATIONS; i++) {\n+                URI uri = URI.create(uriString + \"\/concurrent\/iteration-\" + i);\n+                HttpRequest request = HttpRequest.newBuilder(uri)\n+                        .header(\"X-uuid\", \"uuid-\" + requestCounter.incrementAndGet())\n+                        .build();\n+                out.printf(\"Iteration %d request: %s%n\", i, request.uri());\n+                CompletableFuture<HttpResponse<InputStream>> responseCF;\n+                CompletableFuture<String> bodyCF;\n+                final int si = i;\n+                try {\n+                    responseCF = client.sendAsync(request, BodyHandlers.ofInputStream())\n+                            .thenApply((response) -> {\n+                                out.println(si + \":  Got response: \" + response);\n+                                assertEquals(response.statusCode(), 200);\n+                                return response;\n+                            });\n+                    bodyCF = responseCF.thenApplyAsync(HttpResponse::body, readerService)\n+                            .thenApply(AsyncExecutorShutdown::readBody)\n+                            .thenApply((s) -> { assertEquals(s, MESSAGE); return s;});\n+                } catch (RejectedExecutionException x) {\n+                    out.println(i + \": Got expected exception: \" + x);\n+                    continue;\n+                }\n+                long sleep = RANDOM.nextLong(5);\n+                if (sleep > 0) {\n+                    out.printf(\"%d: sleeping %d ms%n\", i, sleep);\n+                    Thread.sleep(sleep);\n+                }\n+                if (i == step) {\n+                    out.printf(\"%d: shutting down executor now%n\", i, sleep);\n+                    executorService.shutdownNow();\n+                }\n+                var cf = bodyCF.exceptionally((t) -> {\n+                    Throwable cause = getCause(t);\n+                    out.println(si + \": Got expected exception: \" + cause);\n+                    if (UncheckedIOException.class.isAssignableFrom(cause.getClass())) {\n+                        if (cause.getCause() != null) {\n+                            out.println(si + \": Got expected exception: \" + cause);\n+                            cause = cause.getCause();\n+                        }\n+                    }\n+                    checkCause(String.valueOf(si), cause);\n+                    return null;\n+                });\n+                bodies.add(cf);\n+            }\n+            CompletableFuture.allOf(bodies.toArray(new CompletableFuture<?>[0])).get();\n+        } finally {\n+            client = null;\n+            executorService.awaitTermination(2000, TimeUnit.MILLISECONDS);\n+            readerService.shutdown();\n+            readerService.awaitTermination(2000, TimeUnit.MILLISECONDS);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"positive\")\n+    void testSequential(String uriString) throws Exception {\n+        out.printf(\"%n---- starting (%s) ----%n\", uriString);\n+        ExecutorService executorService = Executors.newCachedThreadPool();\n+        ExecutorService readerService = Executors.newCachedThreadPool();\n+        HttpClient client = HttpClient.newBuilder()\n+                .proxy(NO_PROXY)\n+                .followRedirects(Redirect.ALWAYS)\n+                .executor(executorService)\n+                .sslContext(sslContext)\n+                .build();\n+        TRACKER.track(client);\n+        assert client.executor().isPresent();\n+\n+        int step = RANDOM.nextInt(ITERATIONS);\n+        out.printf(\"will shutdown executor in step %d%n\", step);\n+        try {\n+            for (int i = 0; i < ITERATIONS; i++) {\n+                URI uri = URI.create(uriString + \"\/sequential\/iteration-\" + i);\n+                HttpRequest request = HttpRequest.newBuilder(uri)\n+                            .header(\"X-uuid\", \"uuid-\" + requestCounter.incrementAndGet())\n+                            .build();\n+                out.printf(\"Iteration %d request: %s%n\", i, request.uri());\n+                final int si = i;\n+                CompletableFuture<HttpResponse<InputStream>> responseCF;\n+                CompletableFuture<String> bodyCF;\n+                try {\n+                    responseCF = client.sendAsync(request, BodyHandlers.ofInputStream())\n+                            .thenApply((response) -> {\n+                                out.println(si + \":  Got response: \" + response);\n+                                assertEquals(response.statusCode(), 200);\n+                                return response;\n+                            });\n+                    bodyCF = responseCF.thenApplyAsync(HttpResponse::body, readerService)\n+                            .thenApply(AsyncExecutorShutdown::readBody)\n+                            .thenApply((s) -> {assertEquals(s, MESSAGE); return s;})\n+                            .thenApply((s) -> {out.println(si + \":  Got body: \" + s); return s;});\n+                } catch (RejectedExecutionException x) {\n+                    out.println(i + \": Got expected exception: \" + x);\n+                    continue;\n+                }\n+                long sleep = RANDOM.nextLong(5);\n+                if (sleep > 0) {\n+                    out.printf(\"%d: sleeping %d ms%n\", i, sleep);\n+                    Thread.sleep(sleep);\n+                }\n+                if (i == step) {\n+                    out.printf(\"%d: shutting down executor now%n\", i, sleep);\n+                    executorService.shutdownNow();\n+                }\n+                bodyCF.handle((r,t) -> {\n+                    if (t != null) {\n+                        try {\n+                            Throwable cause = getCause(t);\n+                            out.println(si + \": Got expected exception: \" + cause);\n+                            if (UncheckedIOException.class.isAssignableFrom(cause.getClass())) {\n+                                if (cause.getCause() != null) {\n+                                    out.println(si + \": Got expected exception: \" + cause);\n+                                    cause = cause.getCause();\n+                                }\n+                            }\n+                            checkCause(String.valueOf(si), cause);\n+                        } catch (Throwable ase) {\n+                            return CompletableFuture.failedFuture(ase);\n+                        }\n+                        return CompletableFuture.completedFuture(null);\n+                    } else {\n+                        return CompletableFuture.completedFuture(r);\n+                    }\n+                }).thenCompose((c) -> c).get();\n+            }\n+       } finally {\n+            client = null;\n+            executorService.awaitTermination(2000, TimeUnit.MILLISECONDS);\n+            readerService.shutdown();\n+            readerService.awaitTermination(2000, TimeUnit.MILLISECONDS);\n+        }\n+    }\n+\n+    \/\/ -- Infrastructure\n+\n+    @BeforeTest\n+    public void setup() throws Exception {\n+        out.println(\"\\n**** Setup ****\\n\");\n+        sslContext = new SimpleSSLContext().get();\n+        if (sslContext == null)\n+            throw new AssertionError(\"Unexpected null sslContext\");\n+\n+        InetSocketAddress sa = new InetSocketAddress(InetAddress.getLoopbackAddress(), 0);\n+\n+        httpTestServer = HttpTestServer.of(HttpServer.create(sa, 0));\n+        httpTestServer.addHandler(new ServerRequestHandler(), \"\/http1\/exec\/\");\n+        httpURI = \"http:\/\/\" + httpTestServer.serverAuthority() + \"\/http1\/exec\/retry\";\n+        HttpsServer httpsServer = HttpsServer.create(sa, 0);\n+        httpsServer.setHttpsConfigurator(new HttpsConfigurator(sslContext));\n+        httpsTestServer = HttpTestServer.of(httpsServer);\n+        httpsTestServer.addHandler(new ServerRequestHandler(),\"\/https1\/exec\/\");\n+        httpsURI = \"https:\/\/\" + httpsTestServer.serverAuthority() + \"\/https1\/exec\/retry\";\n+\n+        http2TestServer = HttpTestServer.of(new Http2TestServer(\"localhost\", false, 0));\n+        http2TestServer.addHandler(new ServerRequestHandler(), \"\/http2\/exec\/\");\n+        http2URI = \"http:\/\/\" + http2TestServer.serverAuthority() + \"\/http2\/exec\/retry\";\n+        https2TestServer = HttpTestServer.of(new Http2TestServer(\"localhost\", true, sslContext));\n+        https2TestServer.addHandler(new ServerRequestHandler(), \"\/https2\/exec\/\");\n+        https2URI = \"https:\/\/\" + https2TestServer.serverAuthority() + \"\/https2\/exec\/retry\";\n+\n+        httpTestServer.start();\n+        httpsTestServer.start();\n+        http2TestServer.start();\n+        https2TestServer.start();\n+    }\n+\n+    @AfterTest\n+    public void teardown() throws Exception {\n+        Thread.sleep(100);\n+        AssertionError fail = TRACKER.checkShutdown(5000);\n+        try {\n+            httpTestServer.stop();\n+            httpsTestServer.stop();\n+            http2TestServer.stop();\n+            https2TestServer.stop();\n+        } finally {\n+            if (fail != null) throw fail;\n+        }\n+    }\n+\n+    static class ServerRequestHandler implements HttpTestHandler {\n+        ConcurrentHashMap<String,String> closedRequests = new ConcurrentHashMap<>();\n+\n+        @java.lang.Override\n+        public void handle(HttpTestExchange t) throws IOException {\n+            out.println(\"ServerRequestHandler for: \" + t.getRequestURI());\n+\n+            List<String> uuids = t.getRequestHeaders().get(\"X-uuid\");\n+            if (uuids == null || uuids.size() != 1) {\n+                readAllRequestData(t);\n+                try (OutputStream os = t.getResponseBody()) {\n+                    String msg = \"Incorrect uuid header values:[\" + uuids + \"]\";\n+                    (new RuntimeException(msg)).printStackTrace();\n+                    t.sendResponseHeaders(500, -1);\n+                    os.write(msg.getBytes(UTF_8));\n+                }\n+                return;\n+            }\n+\n+            String uuid = uuids.get(0);\n+            \/\/ retrying\n+            if (closedRequests.putIfAbsent(uuid, t.getRequestURI().toString()) == null) {\n+                if (t.getExchangeVersion() == HttpClient.Version.HTTP_1_1) {\n+                    \/\/ Throwing an exception here only causes a retry\n+                    \/\/ with HTTP_1_1 - where it forces the server to close\n+                    \/\/ the connection.\n+                    \/\/ For HTTP\/2 then throwing an IOE would cause the server\n+                    \/\/ to close the stream, and throwing anything else would\n+                    \/\/ cause it to close the connection, but neither would\n+                    \/\/ cause the client to retry.\n+                    \/\/ So we simply do not try to retry with HTTP\/2.\n+                    out.println(\"Server will close connection, client will retry: \"\n+                            + t.getRequestURI().toString());\n+                    throw new IOException(\"Closing on first request\");\n+                }\n+            }\n+\n+            \/\/ not retrying\n+            readAllRequestData(t);\n+            try (OutputStream os = t.getResponseBody()) {\n+                byte[] bytes = MESSAGE.getBytes(UTF_8);\n+                t.sendResponseHeaders(200, bytes.length);\n+                for (int i=0; i<bytes.length; i++) {\n+                    os.write(bytes, i, 1);\n+                    os.flush();\n+                    try {\n+                        Thread.sleep(RANDOM.nextInt(5));\n+                    } catch (InterruptedException x) { }\n+                }\n+            }\n+\n+            closedRequests.remove(uuid);\n+        }\n+    }\n+\n+    static void readAllRequestData(HttpTestExchange t) throws IOException {\n+        try (InputStream is = t.getRequestBody()) {\n+            is.readAllBytes();\n+        }\n+    }\n+}\n","filename":"test\/jdk\/java\/net\/httpclient\/AsyncExecutorShutdown.java","additions":421,"deletions":0,"binary":false,"changes":421,"status":"added"},{"patch":"@@ -0,0 +1,384 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8277969\n+ * @summary Test for edge case where the executor is not accepting\n+ *          new tasks while the client is still running\n+ * @modules java.base\/sun.net.www.http\n+ *          java.net.http\/jdk.internal.net.http.common\n+ *          java.net.http\/jdk.internal.net.http.frame\n+ *          java.net.http\/jdk.internal.net.http.hpack\n+ *          java.logging\n+ *          jdk.httpserver\n+ * @library \/test\/lib http2\/server\n+ * @build Http2TestServer\n+ * @build jdk.test.lib.net.SimpleSSLContext ReferenceTracker\n+ * @run testng\/othervm\n+ *       -Djdk.internal.httpclient.debug=true\n+ *       -Djdk.httpclient.HttpClient.log=trace,headers,requests\n+ *       ExecutorShutdown\n+ *\/\n+\/\/ -Djdk.internal.httpclient.debug=true\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.net.InetAddress;\n+import java.net.InetSocketAddress;\n+import java.net.URI;\n+import java.net.http.HttpClient;\n+import java.net.http.HttpClient.Redirect;\n+import java.net.http.HttpRequest;\n+import java.net.http.HttpResponse;\n+import java.net.http.HttpResponse.BodyHandlers;\n+import java.nio.channels.ClosedChannelException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Random;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionException;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.RejectedExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicLong;\n+import javax.net.ssl.SSLContext;\n+import javax.net.ssl.SSLHandshakeException;\n+\n+import com.sun.net.httpserver.HttpServer;\n+import com.sun.net.httpserver.HttpsConfigurator;\n+import com.sun.net.httpserver.HttpsServer;\n+import jdk.test.lib.RandomFactory;\n+import jdk.test.lib.net.SimpleSSLContext;\n+import org.testng.annotations.AfterTest;\n+import org.testng.annotations.BeforeTest;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+import static java.lang.System.out;\n+import static java.net.http.HttpClient.Builder.NO_PROXY;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.fail;\n+\n+public class ExecutorShutdown implements HttpServerAdapters {\n+\n+    static {\n+        HttpServerAdapters.enableServerLogging();\n+    }\n+    static final Random RANDOM = RandomFactory.getRandom();\n+\n+    SSLContext sslContext;\n+    HttpTestServer httpTestServer;        \/\/ HTTP\/1.1    [ 4 servers ]\n+    HttpTestServer httpsTestServer;       \/\/ HTTPS\/1.1\n+    HttpTestServer http2TestServer;       \/\/ HTTP\/2 ( h2c )\n+    HttpTestServer https2TestServer;      \/\/ HTTP\/2 ( h2  )\n+    String httpURI;\n+    String httpsURI;\n+    String http2URI;\n+    String https2URI;\n+\n+    static final String MESSAGE = \"ExecutorShutdown message body\";\n+    static final int ITERATIONS = 3;\n+\n+    @DataProvider(name = \"positive\")\n+    public Object[][] positive() {\n+        return new Object[][] {\n+                { httpURI,    },\n+                { httpsURI,   },\n+                { http2URI,   },\n+                { https2URI,  },\n+        };\n+    }\n+\n+    static final AtomicLong requestCounter = new AtomicLong();\n+    final ReferenceTracker TRACKER = ReferenceTracker.INSTANCE;\n+\n+    static Throwable getCause(Throwable t) {\n+        while (t instanceof CompletionException || t instanceof ExecutionException) {\n+            t = t.getCause();\n+        }\n+        return t;\n+    }\n+\n+    static void checkCause(String what, Throwable cause) {\n+        Throwable t = cause;\n+        Throwable accepted = null;\n+        while (t != null) {\n+            out.println(what + \": checking \" + t);\n+            if (t instanceof  RejectedExecutionException) {\n+                out.println(what + \": Got expected RejectedExecutionException in cause: \" + t);\n+                return;\n+            } else if (t instanceof ClosedChannelException) {\n+                out.println(what + \": Accepting ClosedChannelException as a valid cause: \" + t);\n+                accepted = t;\n+            }\n+            t = t.getCause();\n+        }\n+        if (accepted != null) {\n+            out.println(what + \": Didn't find expected RejectedExecutionException, \" +\n+                    \"but accepting \" + accepted.getClass().getSimpleName()\n+                    + \" as a valid cause: \" + accepted);\n+            return;\n+        }\n+        throw new AssertionError(what + \": Unexpected exception: \" + cause, cause);\n+    }\n+\n+    @Test(dataProvider = \"positive\")\n+    void testConcurrent(String uriString) throws Exception {\n+        out.printf(\"%n---- starting (%s) ----%n\", uriString);\n+        ExecutorService executorService = Executors.newCachedThreadPool();\n+        HttpClient client = HttpClient.newBuilder()\n+                .proxy(NO_PROXY)\n+                .followRedirects(Redirect.ALWAYS)\n+                .executor(executorService)\n+                .sslContext(sslContext)\n+                .build();\n+        TRACKER.track(client);\n+        assert client.executor().isPresent();\n+\n+        int step = RANDOM.nextInt(ITERATIONS);\n+        try {\n+            List<CompletableFuture<HttpResponse<String>>> responses = new ArrayList<>();\n+            for (int i = 0; i < ITERATIONS; i++) {\n+                URI uri = URI.create(uriString + \"\/concurrent\/iteration-\" + i);\n+                HttpRequest request = HttpRequest.newBuilder(uri)\n+                        .header(\"X-uuid\", \"uuid-\" + requestCounter.incrementAndGet())\n+                        .build();\n+                out.printf(\"Iteration %d request: %s%n\", i, request.uri());\n+                CompletableFuture<HttpResponse<String>> responseCF;\n+                try {\n+                    responseCF = client.sendAsync(request, BodyHandlers.ofString());\n+                } catch (RejectedExecutionException x) {\n+                    out.println(i + \": Got expected exception: \" + x);\n+                    continue;\n+                }\n+                long sleep = RANDOM.nextLong(5);\n+                if (sleep > 0) {\n+                    out.printf(\"%d: sleeping %d ms%n\", i, sleep);\n+                    Thread.sleep(sleep);\n+                }\n+                if (i == step) {\n+                    out.printf(\"%d: shutting down executor now%n\", i, sleep);\n+                    executorService.shutdownNow();\n+                }\n+                final int si = i;\n+                var cf = responseCF.thenApply((response) -> {\n+                    out.println(si + \":  Got response: \" + response);\n+                    out.println(si + \":  Got body Path: \" + response.body());\n+                    assertEquals(response.statusCode(), 200);\n+                    assertEquals(response.body(), MESSAGE);\n+                    return response;\n+                }).exceptionally((t) -> {\n+                    Throwable cause = getCause(t);\n+                    out.println(si + \": Got expected exception: \" + cause);\n+                    checkCause(String.valueOf(si), cause);\n+                    return null;\n+                });\n+                responses.add(cf);\n+            }\n+            CompletableFuture.allOf(responses.toArray(new CompletableFuture<?>[0])).get();\n+        } finally {\n+            client = null;\n+            executorService.awaitTermination(2000, TimeUnit.MILLISECONDS);\n+        }\n+    }\n+\n+    @Test(dataProvider = \"positive\")\n+    void testSequential(String uriString) throws Exception {\n+        out.printf(\"%n---- starting (%s) ----%n\", uriString);\n+        ExecutorService executorService = Executors.newCachedThreadPool();\n+        HttpClient client = HttpClient.newBuilder()\n+                .proxy(NO_PROXY)\n+                .followRedirects(Redirect.ALWAYS)\n+                .executor(executorService)\n+                .sslContext(sslContext)\n+                .build();\n+        TRACKER.track(client);\n+        assert client.executor().isPresent();\n+\n+        int step = RANDOM.nextInt(ITERATIONS);\n+        out.printf(\"will shutdown executor in step %d%n\", step);\n+        try {\n+            for (int i = 0; i < ITERATIONS; i++) {\n+                URI uri = URI.create(uriString + \"\/sequential\/iteration-\" + i);\n+                HttpRequest request = HttpRequest.newBuilder(uri)\n+                            .header(\"X-uuid\", \"uuid-\" + requestCounter.incrementAndGet())\n+                            .build();\n+                out.printf(\"Iteration %d request: %s%n\", i, request.uri());\n+                CompletableFuture<HttpResponse<String>> responseCF;\n+                try {\n+                    responseCF = client.sendAsync(request, BodyHandlers.ofString());\n+                } catch (RejectedExecutionException x) {\n+                    out.println(i + \": Got expected exception: \" + x);\n+                    continue;\n+                }\n+                long sleep = RANDOM.nextLong(5);\n+                if (sleep > 0) {\n+                    out.printf(\"%d: sleeping %d ms%n\", i, sleep);\n+                    Thread.sleep(sleep);\n+                }\n+                if (i == step) {\n+                    out.printf(\"%d: shutting down executor now%n\", i, sleep);\n+                    executorService.shutdownNow();\n+                }\n+                final int si = i;\n+                responseCF.thenApply((response) -> {\n+                    out.println(si + \":  Got response: \" + response);\n+                    out.println(si + \":  Got body Path: \" + response.body());\n+                    assertEquals(response.statusCode(), 200);\n+                    assertEquals(response.body(), MESSAGE);\n+                    return response;\n+                }).handle((r,t) -> {\n+                    if (t != null) {\n+                        try {\n+                            Throwable cause = getCause(t);\n+                            out.println(si + \": Got expected exception: \" + cause);\n+                            checkCause(String.valueOf(si), cause);\n+                         } catch (Throwable ase) {\n+                            return CompletableFuture.failedFuture(ase);\n+                        }\n+                        return CompletableFuture.completedFuture(null);\n+                    } else {\n+                        return CompletableFuture.completedFuture(r);\n+                    }\n+                }).thenCompose((c) -> c).get();\n+            }\n+       } finally {\n+            client = null;\n+            executorService.awaitTermination(2000, TimeUnit.MILLISECONDS);\n+        }\n+    }\n+\n+    \/\/ -- Infrastructure\n+\n+    @BeforeTest\n+    public void setup() throws Exception {\n+        out.println(\"\\n**** Setup ****\\n\");\n+        sslContext = new SimpleSSLContext().get();\n+        if (sslContext == null)\n+            throw new AssertionError(\"Unexpected null sslContext\");\n+\n+        InetSocketAddress sa = new InetSocketAddress(InetAddress.getLoopbackAddress(), 0);\n+\n+        httpTestServer = HttpTestServer.of(HttpServer.create(sa, 0));\n+        httpTestServer.addHandler(new ServerRequestHandler(), \"\/http1\/exec\/\");\n+        httpURI = \"http:\/\/\" + httpTestServer.serverAuthority() + \"\/http1\/exec\/retry\";\n+        HttpsServer httpsServer = HttpsServer.create(sa, 0);\n+        httpsServer.setHttpsConfigurator(new HttpsConfigurator(sslContext));\n+        httpsTestServer = HttpTestServer.of(httpsServer);\n+        httpsTestServer.addHandler(new ServerRequestHandler(),\"\/https1\/exec\/\");\n+        httpsURI = \"https:\/\/\" + httpsTestServer.serverAuthority() + \"\/https1\/exec\/retry\";\n+\n+        http2TestServer = HttpTestServer.of(new Http2TestServer(\"localhost\", false, 0));\n+        http2TestServer.addHandler(new ServerRequestHandler(), \"\/http2\/exec\/\");\n+        http2URI = \"http:\/\/\" + http2TestServer.serverAuthority() + \"\/http2\/exec\/retry\";\n+        https2TestServer = HttpTestServer.of(new Http2TestServer(\"localhost\", true, sslContext));\n+        https2TestServer.addHandler(new ServerRequestHandler(), \"\/https2\/exec\/\");\n+        https2URI = \"https:\/\/\" + https2TestServer.serverAuthority() + \"\/https2\/exec\/retry\";\n+\n+        httpTestServer.start();\n+        httpsTestServer.start();\n+        http2TestServer.start();\n+        https2TestServer.start();\n+    }\n+\n+    @AfterTest\n+    public void teardown() throws Exception {\n+        Thread.sleep(100);\n+        AssertionError fail = TRACKER.check(5000);\n+        try {\n+            httpTestServer.stop();\n+            httpsTestServer.stop();\n+            http2TestServer.stop();\n+            https2TestServer.stop();\n+        } finally {\n+            if (fail != null) throw fail;\n+        }\n+    }\n+\n+    static class ServerRequestHandler implements HttpTestHandler {\n+        ConcurrentHashMap<String,String> closedRequests = new ConcurrentHashMap<>();\n+\n+        @java.lang.Override\n+        public void handle(HttpTestExchange t) throws IOException {\n+            out.println(\"ServerRequestHandler for: \" + t.getRequestURI());\n+\n+            List<String> uuids = t.getRequestHeaders().get(\"X-uuid\");\n+            if (uuids == null || uuids.size() != 1) {\n+                readAllRequestData(t);\n+                try (OutputStream os = t.getResponseBody()) {\n+                    String msg = \"Incorrect uuid header values:[\" + uuids + \"]\";\n+                    (new RuntimeException(msg)).printStackTrace();\n+                    t.sendResponseHeaders(500, -1);\n+                    os.write(msg.getBytes(UTF_8));\n+                }\n+                return;\n+            }\n+\n+            String uuid = uuids.get(0);\n+            \/\/ retrying\n+            if (closedRequests.putIfAbsent(uuid, t.getRequestURI().toString()) == null) {\n+                if (t.getExchangeVersion() == HttpClient.Version.HTTP_1_1) {\n+                    \/\/ Throwing an exception here only causes a retry\n+                    \/\/ with HTTP_1_1 - where it forces the server to close\n+                    \/\/ the connection.\n+                    \/\/ For HTTP\/2 then throwing an IOE would cause the server\n+                    \/\/ to close the stream, and throwing anything else would\n+                    \/\/ cause it to close the connection, but neither would\n+                    \/\/ cause the client to retry.\n+                    \/\/ So we simply do not try to retry with HTTP\/2.\n+                    out.println(\"Server will close connection, client will retry: \"\n+                            + t.getRequestURI().toString());\n+                    throw new IOException(\"Closing on first request\");\n+                }\n+            }\n+\n+            \/\/ not retrying\n+            readAllRequestData(t);\n+            try (OutputStream os = t.getResponseBody()) {\n+                byte[] bytes = MESSAGE.getBytes(UTF_8);\n+                t.sendResponseHeaders(200, bytes.length);\n+                for (int i=0; i<bytes.length; i++) {\n+                    os.write(bytes, i, 1);\n+                    os.flush();\n+                    try {\n+                        Thread.sleep(RANDOM.nextInt(5));\n+                    } catch (InterruptedException x) { }\n+                }\n+            }\n+\n+            closedRequests.remove(uuid);\n+        }\n+    }\n+\n+    static void readAllRequestData(HttpTestExchange t) throws IOException {\n+        try (InputStream is = t.getRequestBody()) {\n+            is.readAllBytes();\n+        }\n+    }\n+}\n","filename":"test\/jdk\/java\/net\/httpclient\/ExecutorShutdown.java","additions":384,"deletions":0,"binary":false,"changes":384,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,2 @@\n+import java.io.PrintStream;\n+import java.lang.management.ManagementFactory;\n@@ -28,0 +30,1 @@\n+import java.util.Arrays;\n@@ -29,0 +32,1 @@\n+import java.util.function.Predicate;\n@@ -54,0 +58,4 @@\n+        return diagnose(warnings, (t) -> t.getOutstandingHttpOperations() > 0);\n+    }\n+\n+    public StringBuilder diagnose(StringBuilder warnings, Predicate<Tracker> hasOutstanding) {\n@@ -55,1 +63,1 @@\n-            checkOutstandingOperations(warnings, tracker);\n+            checkOutstandingOperations(warnings, tracker, hasOutstanding);\n@@ -79,0 +87,16 @@\n+        return check(graceDelayMs,\n+                (t) -> t.getOutstandingHttpOperations() > 0,\n+                \"outstanding operations\", true);\n+    }\n+\n+    private void printThreads(String why, PrintStream out) {\n+        out.println(why);\n+        Arrays.stream(ManagementFactory.getThreadMXBean()\n+                        .dumpAllThreads(true, true))\n+                .forEach(out::println);\n+    }\n+\n+    public AssertionError check(long graceDelayMs,\n+                                Predicate<Tracker> hasOutstanding,\n+                                String description,\n+                                boolean printThreads) {\n@@ -80,7 +104,16 @@\n-        if (hasOutstandingOperations()) {\n-            try {\n-                Thread.sleep(graceDelayMs);\n-            } catch (InterruptedException x) {\n-                \/\/ OK\n-            }\n-            StringBuilder warnings = diagnose(new StringBuilder());\n+        graceDelayMs = Math.max(graceDelayMs, 100);\n+        long delay = Math.min(graceDelayMs, 500);\n+        var count = delay > 0 ? graceDelayMs \/ delay : 1;\n+        for (int i = 0; i < count; i++) {\n+            if (TRACKERS.stream().anyMatch(hasOutstanding)) {\n+                System.gc();\n+                try {\n+                    System.out.println(\"Waiting for HTTP operations to terminate...\");\n+                    Thread.sleep(Math.min(graceDelayMs, Math.max(delay, 1)));\n+                } catch (InterruptedException x) {\n+                    \/\/ OK\n+                }\n+            } else break;\n+        }\n+        if (TRACKERS.stream().anyMatch(hasOutstanding)) {\n+            StringBuilder warnings = diagnose(new StringBuilder(), hasOutstanding);\n@@ -88,1 +121,1 @@\n-            if (hasOutstandingOperations()) {\n+            if (TRACKERS.stream().anyMatch(hasOutstanding)) {\n@@ -92,1 +125,1 @@\n-            System.out.println(\"PASSED: No outstanding operations found in \"\n+            System.out.println(\"PASSED: No \" + description + \" found in \"\n@@ -95,0 +128,7 @@\n+        if (fail != null) {\n+            Predicate<Tracker> isAlive = Tracker::isSelectorAlive;\n+            if (printThreads && TRACKERS.stream().anyMatch(isAlive)) {\n+                printThreads(\"Some selector manager threads are still alive: \", System.out);\n+                printThreads(\"Some selector manager threads are still alive: \", System.err);\n+            }\n+        }\n@@ -111,2 +151,2 @@\n-        System.out.println(warning.toString().substring(pos));\n-        System.err.println(warning.toString().substring(pos));\n+        System.out.println(warning.substring(pos));\n+        System.err.println(warning.substring(pos));\n@@ -115,2 +155,4 @@\n-    private static void checkOutstandingOperations(StringBuilder warning, Tracker tracker) {\n-        if (tracker.getOutstandingOperations() > 0) {\n+    private static void checkOutstandingOperations(StringBuilder warning,\n+                                                   Tracker tracker,\n+                                                   Predicate<Tracker> hasOutsanding) {\n+        if (hasOutsanding.test(tracker)) {\n@@ -120,0 +162,1 @@\n+            warning.append(\"\\n\\tPending HTTP Requests: \" + tracker.getOutstandingHttpRequests());\n@@ -123,0 +166,1 @@\n+            warning.append(\"\\n\\tPending TCP connections: \" + tracker.getOutstandingTcpConnections());\n@@ -125,2 +169,3 @@\n-            System.out.println(warning.toString().substring(pos));\n-            System.err.println(warning.toString().substring(pos));\n+            warning.append(\"\\n\\tSelector alive: \" + tracker.isSelectorAlive());\n+            System.out.println(warning.substring(pos));\n+            System.err.println(warning.substring(pos));\n@@ -130,0 +175,21 @@\n+    private boolean isSelectorManager(Thread t) {\n+        String name = t.getName();\n+        if (name == null) return false;\n+        return name.contains(\"SelectorManager\");\n+    }\n+\n+    \/\/ This is a slightly more permissive check than the default checks,\n+    \/\/ it only verifies that all CFs returned by send\/sendAsync have been\n+    \/\/ completed, and that all opened channels have been closed, and that\n+    \/\/ the selector manager thread has exited.\n+    \/\/ It doesn't check that all refcounts have reached 0.\n+    \/\/ This is typically useful to only check that resources have been released.\n+    public AssertionError checkShutdown(long graceDelayMs) {\n+        Predicate<Tracker> isAlive = Tracker::isSelectorAlive;\n+        Predicate<Tracker> hasPendingRequests = (t) -> t.getOutstandingHttpRequests() > 0;\n+        Predicate<Tracker> hasPendingConnections = (t) -> t.getOutstandingTcpConnections() > 0;\n+        AssertionError failed = check(graceDelayMs,\n+                isAlive.or(hasPendingRequests).or(hasPendingConnections),\n+                \"outstanding unclosed resources\", true);\n+        return failed;\n+    }\n","filename":"test\/jdk\/java\/net\/httpclient\/ReferenceTracker.java","additions":83,"deletions":17,"binary":false,"changes":100,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+import java.util.concurrent.ConcurrentHashMap;\n@@ -30,0 +31,1 @@\n+import java.util.concurrent.atomic.AtomicLong;\n@@ -31,1 +33,0 @@\n-import java.util.function.Consumer;\n@@ -36,2 +37,0 @@\n-import javax.net.ssl.SSLServerSocketFactory;\n-import javax.net.ssl.SNIServerName;\n@@ -48,0 +47,2 @@\n+    static final AtomicLong IDS = new AtomicLong();\n+    final long id = IDS.incrementAndGet();\n@@ -52,1 +53,1 @@\n-    volatile boolean stopping = false;\n+    private volatile boolean stopping = false;\n@@ -56,1 +57,1 @@\n-    final HashMap<InetSocketAddress,Http2TestServerConnection> connections;\n+    final Set<Http2TestServerConnection> connections;\n@@ -58,0 +59,1 @@\n+    final String name;\n@@ -175,0 +177,1 @@\n+        this.name = \"TestServer(%d)\".formatted(id);\n@@ -191,1 +194,1 @@\n-        this.connections = new HashMap<>();\n+        this.connections = ConcurrentHashMap.newKeySet();\n@@ -230,1 +233,1 @@\n-        System.err.println(\"Using handler for: \" + bestMatch.get());\n+        System.err.println(name + \": Using handler for: \" + bestMatch.get());\n@@ -244,2 +247,2 @@\n-        System.err.printf(\"Server stopping %d connections\\n\", connections.size());\n-        for (Http2TestServerConnection connection : connections.values()) {\n+        System.err.printf(\"%s: stopping %d connections\\n\", name, connections.size());\n+        for (Http2TestServerConnection connection : connections) {\n@@ -282,1 +285,1 @@\n-            connections.put(addr, c);\n+            connections.add(c);\n@@ -286,1 +289,46 @@\n-        connections.remove(addr, c);\n+        connections.remove(c);\n+    }\n+\n+    record AcceptedConnection(Http2TestServer server,\n+                              Socket socket) {\n+        void startConnection() {\n+            String name = server.name;\n+            Http2TestServerConnection c = null;\n+            InetSocketAddress addr = null;\n+            try {\n+                addr = (InetSocketAddress) socket.getRemoteSocketAddress();\n+                System.err.println(name + \": creating connection\");\n+                c = server.createConnection(server, socket, server.exchangeSupplier);\n+                server.putConnection(addr, c);\n+                System.err.println(name + \": starting connection\");\n+                c.run();\n+                System.err.println(name + \": connection started\");\n+            } catch (Throwable e) {\n+                boolean stopping = server.stopping;\n+                if (!stopping) {\n+                    System.err.println(name + \": unexpected exception: \" + e);\n+                    e.printStackTrace();\n+                }\n+                \/\/ we should not reach here, but if we do\n+                \/\/ the connection might not have been closed\n+                \/\/ and if so then the client might wait\n+                \/\/ forever.\n+                if (c != null) {\n+                    server.removeConnection(addr, c);\n+                }\n+                try {\n+                    if (c != null) c.close(ErrorFrame.PROTOCOL_ERROR);\n+                } catch (Exception x) {\n+                    if (!stopping)\n+                        System.err.println(name + \": failed to close connection: \" + e);\n+                } finally {\n+                    try {\n+                        socket.close();\n+                    } catch (IOException x) {\n+                        if (!stopping)\n+                            System.err.println(name + \": failed to close socket: \" + e);\n+                    }\n+                }\n+                System.err.println(name + \": failed to start connection: \" + e);\n+            }\n+        }\n@@ -296,0 +344,1 @@\n+                    System.err.println(name + \": accepting connections\");\n@@ -297,2 +346,1 @@\n-                    Http2TestServerConnection c = null;\n-                    InetSocketAddress addr = null;\n+                    System.err.println(name + \": connection accepted\");\n@@ -300,4 +348,2 @@\n-                        addr = (InetSocketAddress) socket.getRemoteSocketAddress();\n-                        c = createConnection(this, socket, exchangeSupplier);\n-                        putConnection(addr, c);\n-                        c.run();\n+                        var accepted = new AcceptedConnection(this, socket);\n+                        exec.submit(accepted::startConnection);\n@@ -305,0 +351,4 @@\n+                        if (!stopping) {\n+                            System.err.println(name + \": unexpected exception: \" + e);\n+                            e.printStackTrace();\n+                        }\n@@ -309,7 +359,1 @@\n-                        if (c != null) {\n-                            removeConnection(addr, c);\n-                            c.close(ErrorFrame.PROTOCOL_ERROR);\n-                        } else {\n-                            socket.close();\n-                        }\n-                        System.err.println(\"TestServer: start exception: \" + e);\n+                        System.err.println(name + \": start exception: \" + e);\n@@ -317,0 +361,1 @@\n+                    System.err.println(name + \": stopping is: \" + stopping);\n@@ -319,1 +364,1 @@\n-                System.err.println(\"TestServer: terminating, caught \" + se);\n+                System.err.println(name + \": terminating, caught \" + se);\n@@ -325,1 +370,1 @@\n-                    System.err.println(\"TestServer: terminating, caught \" + e);\n+                    System.err.println(name + \": terminating, caught \" + e);\n@@ -328,0 +373,2 @@\n+            } finally {\n+                System.err.println(name + \": finished\");\n@@ -341,0 +388,1 @@\n+        System.err.println(name + \": closing\");\n","filename":"test\/jdk\/java\/net\/httpclient\/http2\/server\/Http2TestServer.java","additions":75,"deletions":27,"binary":false,"changes":102,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,0 +50,1 @@\n+import java.util.concurrent.atomic.AtomicLong;\n@@ -65,1 +66,0 @@\n- * @author danielfuchs\n@@ -444,0 +444,2 @@\n+        static final AtomicLong IDS = new AtomicLong();\n+\n@@ -476,0 +478,6 @@\n+        \/\/ Called from within super constructor\n+        @Override\n+        long newConnectionId(HttpClientImpl client) {\n+            return IDS.incrementAndGet();\n+        }\n+\n","filename":"test\/jdk\/java\/net\/httpclient\/whitebox\/java.net.http\/jdk\/internal\/net\/http\/ConnectionPoolTest.java","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -302,1 +302,1 @@\n-            if (unfulfilled <= maxQueueSize\/2) {\n+            if (unfulfilled <= maxQueueSize \/ 2) {\n@@ -307,1 +307,1 @@\n-                        req, requested-req, queue.size(), unfulfilled );\n+                        req, requested - req, queue.size(), unfulfilled);\n","filename":"test\/jdk\/java\/net\/httpclient\/whitebox\/java.net.http\/jdk\/internal\/net\/http\/SSLEchoTubeTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -51,1 +51,1 @@\n- * @bug 8210280 8281631\n+ * @bug 8186958 8210280 8281631 8285386\n@@ -54,1 +54,1 @@\n- * @run testng WhiteBoxResizeTest\n+ * @run testng\/othervm -Xmx2g WhiteBoxResizeTest\n@@ -204,1 +204,1 @@\n-        for (int i = 2; i < 128; i++) {\n+        for (int i = 2; i < 64; i++) {\n@@ -283,1 +283,1 @@\n-                \/\/ pcc(\"fwm0pa\", size, cap, () -> new WeakHashMap<>(),                map -> { map.putAll(fakeMap(size)); }), \/\/ see note\n+             \/\/ pcc(\"fwm0pa\", size, cap, () -> new WeakHashMap<>(),                map -> { map.putAll(fakeMap(size)); }), \/\/ see note\n@@ -295,1 +295,0 @@\n-        cases.addAll(genPopulatedCapacityCases(11,  16));\n@@ -298,1 +297,4 @@\n-        cases.addAll(genPopulatedCapacityCases(64, 128));\n+        cases.addAll(genPopulatedCapacityCases(24,  32));\n+        cases.addAll(genPopulatedCapacityCases(25,  64));\n+        cases.addAll(genPopulatedCapacityCases(48,  64));\n+        cases.addAll(genPopulatedCapacityCases(49, 128));\n@@ -302,3 +304,4 @@\n-        cases.addAll(genFakePopulatedCapacityCases(25165824, 33554432));\n-        cases.addAll(genFakePopulatedCapacityCases(25165825, 67108864));\n-        cases.addAll(genFakePopulatedCapacityCases(25165826, 67108864));\n+        cases.addAll(genFakePopulatedCapacityCases(25165824,  33554432));\n+        cases.addAll(genFakePopulatedCapacityCases(25165825,  67108864));\n+        cases.addAll(genFakePopulatedCapacityCases(50331648,  67108864));\n+        cases.addAll(genFakePopulatedCapacityCases(50331649, 134217728));\n@@ -320,0 +323,49 @@\n+    \/*\n+     * tests for requested size (static factory methods)\n+     *\/\n+\n+    \/\/ helper method for one requested size case, to provide target types for lambda\n+    Object[] rsc(String label,\n+                 int size,\n+                 int expectedCapacity,\n+                 Supplier<Map<String, String>> supplier) {\n+        return new Object[]{label, size, expectedCapacity, supplier};\n+    }\n+\n+    List<Object[]> genRequestedSizeCases(int size, int cap) {\n+        return Arrays.asList(\n+                rsc(\"rshm\", size, cap, () -> HashMap.newHashMap(size)),\n+                rsc(\"rslm\", size, cap, () -> LinkedHashMap.newLinkedHashMap(size)),\n+                rsc(\"rswm\", size, cap, () -> WeakHashMap.newWeakHashMap(size))\n+        );\n+    }\n+\n+    @DataProvider(name = \"requestedSize\")\n+    public Iterator<Object[]> requestedSizeCases() {\n+        ArrayList<Object[]> cases = new ArrayList<>();\n+        cases.addAll(genRequestedSizeCases(12,  16));\n+        cases.addAll(genRequestedSizeCases(13,  32));\n+        cases.addAll(genRequestedSizeCases(24,  32));\n+        cases.addAll(genRequestedSizeCases(25,  64));\n+        cases.addAll(genRequestedSizeCases(48,  64));\n+        cases.addAll(genRequestedSizeCases(49, 128));\n+\n+        \/\/ numbers in this range are truncated by a float computation with 0.75f\n+        \/\/ but can get an exact result with a double computation with 0.75d\n+        cases.addAll(genRequestedSizeCases(25165824,  33554432));\n+        cases.addAll(genRequestedSizeCases(25165825,  67108864));\n+        cases.addAll(genRequestedSizeCases(50331648,  67108864));\n+        cases.addAll(genRequestedSizeCases(50331649, 134217728));\n+\n+        return cases.iterator();\n+    }\n+\n+    @Test(dataProvider = \"requestedSize\")\n+    public void requestedSize(String label,  \/\/ unused, included for diagnostics\n+                              int size,      \/\/ unused, included for diagnostics\n+                              int expectedCapacity,\n+                              Supplier<Map<String, String>> s) {\n+        Map<String, String> map = s.get();\n+        map.put(\"\", \"\");\n+        assertEquals(capacity(map), expectedCapacity);\n+    }\n","filename":"test\/jdk\/java\/util\/HashMap\/WhiteBoxResizeTest.java","additions":61,"deletions":9,"binary":false,"changes":70,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import java.util.stream.Collector;\n@@ -100,0 +101,17 @@\n+\n+    @Test\n+    public void testParallelize() {\n+        checkHasSplit(Stream.iterate(0, x -> x < 10, x -> x + 1));\n+        checkHasSplit(IntStream.iterate(0, x -> x < 10, x -> x + 1).boxed());\n+        checkHasSplit(LongStream.iterate(0, x -> x < 10, x -> x + 1).boxed());\n+        checkHasSplit(DoubleStream.iterate(0, x -> x < 10, x -> x + 1).boxed());\n+    }\n+\n+    private void checkHasSplit(Stream<?> stream) {\n+        int[] numberOfNonEmptyParts = stream.parallel().collect(\n+                Collector.of(() -> new int[1], (acc, e) -> acc[0] = 1, (acc1, acc2) -> {\n+                  acc1[0] += acc2[0];\n+                  return acc1;\n+                }));\n+        assertTrue(numberOfNonEmptyParts[0] >= 2);\n+    }\n","filename":"test\/jdk\/java\/util\/stream\/test\/org\/openjdk\/tests\/java\/util\/stream\/IterateTest.java","additions":19,"deletions":1,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-                <li>Use the 'space' key to make a the selection.<\/li>\r\n+                <li>Use the 'space' key to make the selection.<\/li>\r\n@@ -75,1 +75,0 @@\n-        \n\\ No newline at end of file\n","filename":"test\/jdk\/javax\/accessibility\/manual\/ComboBoxDemo.html","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -40,0 +40,2 @@\n+    private static JFrame frame;\n+    private static boolean selectionFail = false;\n@@ -41,3 +43,15 @@\n-    public static void main(String[] args) throws InterruptedException {\n-        SwingUtilities.invokeLater(new Test8019180());\n-        LATCH.await();\n+    public static void main(String[] args) throws Exception {\n+        try {\n+            SwingUtilities.invokeLater(new Test8019180());\n+            LATCH.await();\n+            System.out.println(\"selectionFail \" + selectionFail);\n+            if (selectionFail) {\n+                throw new RuntimeException(\"Combobox not selected\");\n+            }\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n+        }\n@@ -53,1 +67,1 @@\n-            JFrame frame = new JFrame();\n+            frame = new JFrame();\n@@ -55,0 +69,1 @@\n+            frame.setLocationRelativeTo(null);\n@@ -63,1 +78,1 @@\n-                System.exit(8019180);\n+                selectionFail = true;\n@@ -65,1 +80,0 @@\n-            SwingUtilities.getWindowAncestor(this.test).dispose();\n","filename":"test\/jdk\/javax\/swing\/JComboBox\/8019180\/Test8019180.java","additions":20,"deletions":6,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -77,0 +77,2 @@\n+                    desktop.setBackground(Color.WHITE);\n+                    desktop.setForeground(Color.BLACK);\n","filename":"test\/jdk\/javax\/swing\/JComponent\/7154030\/bug7154030.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,138 @@\n+\/*\n+ * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.awt.Point;\n+import java.awt.Robot;\n+import java.awt.event.InputEvent;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Collectors;\n+import javax.swing.JButton;\n+import javax.swing.JFrame;\n+import javax.swing.JPanel;\n+import javax.swing.SwingUtilities;\n+import javax.swing.UIManager;\n+import javax.swing.UIManager.LookAndFeelInfo;\n+import javax.swing.UnsupportedLookAndFeelException;\n+\n+import static javax.swing.UIManager.getInstalledLookAndFeels;\n+\n+\/*\n+ * @test\n+ * @key headful\n+ * @bug 4371575\n+ * @summary This testcase tests RFE-4371575 request, verifies that\n+ *          JComponent.setRequestFocusEnabled() works as expected\n+ * @run main JComponentSetRequestFocusEnabledTest\n+ *\/\n+public class JComponentSetRequestFocusEnabledTest {\n+\n+    private static JButton button;\n+    private static Robot robot;\n+    private static JFrame frame;\n+\n+    public static void main(String[] args) throws Exception {\n+        robot = new Robot();\n+        robot.setAutoWaitForIdle(true);\n+        robot.setAutoDelay(200);\n+        List<String> lafs = Arrays.stream(getInstalledLookAndFeels())\n+                                  .map(LookAndFeelInfo::getClassName)\n+                                  .collect(Collectors.toList());\n+        for (final String laf : lafs) {\n+            try {\n+                AtomicBoolean lafSetSuccess = new AtomicBoolean(false);\n+                SwingUtilities.invokeAndWait(() -> {\n+                    lafSetSuccess.set(setLookAndFeel(laf));\n+                    if (lafSetSuccess.get()) {\n+                        createUI();\n+                    }\n+                });\n+                if (!lafSetSuccess.get()) {\n+                    continue;\n+                }\n+                robot.waitForIdle();\n+\n+                mouseClick(button);\n+\n+                if (!button.isFocusOwner()) {\n+                    System.out.println(\"Test Passed in \" + laf);\n+                } else {\n+                    throw new RuntimeException(\n+                            \"Test Failed, button has focus in \" + laf);\n+                }\n+            } finally {\n+                SwingUtilities.invokeAndWait(\n+                        JComponentSetRequestFocusEnabledTest::disposeFrame);\n+            }\n+        }\n+    }\n+\n+    private static void mouseClick(JButton jButton) throws Exception {\n+        final AtomicReference<Point> loc = new AtomicReference<>();\n+        SwingUtilities\n+                .invokeAndWait(() -> loc.set(jButton.getLocationOnScreen()));\n+        final Point location = loc.get();\n+        robot.mouseMove(location.x + 10, location.y + 10);\n+        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+    }\n+\n+    public static void createUI() {\n+        frame = new JFrame();\n+        JPanel panel = new JPanel();\n+        panel.add(new JButton(\"Focused\"));\n+        panel.add(button = new JButton(\"Unfocusable\"));\n+\n+        button.setRequestFocusEnabled(false);\n+\n+        frame.setContentPane(panel);\n+        frame.setSize(150, 100);\n+        frame.setLocationRelativeTo(null);\n+        frame.pack();\n+        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);\n+        frame.setVisible(true);\n+    }\n+\n+    private static boolean setLookAndFeel(String lafName) {\n+        try {\n+            UIManager.setLookAndFeel(lafName);\n+        } catch (UnsupportedLookAndFeelException ignored) {\n+            System.out.println(\"Ignoring Unsupported L&F: \" + lafName);\n+            return false;\n+        } catch (ClassNotFoundException | InstantiationException\n+                | IllegalAccessException e) {\n+            throw new RuntimeException(e);\n+        }\n+        return true;\n+    }\n+\n+    private static void disposeFrame() {\n+        if (frame != null) {\n+            frame.dispose();\n+            frame = null;\n+        }\n+    }\n+\n+}\n","filename":"test\/jdk\/javax\/swing\/JComponent\/JComponentSetRequestFocusEnabledTest.java","additions":138,"deletions":0,"binary":false,"changes":138,"status":"added"},{"patch":"@@ -121,1 +121,1 @@\n-        System.exit(1);\n+        throw new RuntimeException(throwable);\n","filename":"test\/jdk\/javax\/swing\/JFileChooser\/8013442\/Test8013442.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -107,1 +107,1 @@\n-            robot.setAutoDelay(250);\n+            robot.setAutoDelay(100);\n@@ -119,0 +119,1 @@\n+                    frame.setLocationRelativeTo(null);\n@@ -125,0 +126,1 @@\n+            robot.delay(1000);\n","filename":"test\/jdk\/javax\/swing\/JRootPane\/4670486\/bug4670486.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -44,1 +44,1 @@\n-        System.exit(1);\n+        throw new RuntimeException(throwable);\n","filename":"test\/jdk\/javax\/swing\/plaf\/basic\/BasicTabbedPaneUI\/Test6943780.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-        System.exit(1);\n+        throw new RuntimeException(exception);\n","filename":"test\/jdk\/javax\/swing\/plaf\/synth\/Test8015926.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,5 +26,20 @@\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.beans.*;\n-import java.lang.reflect.*;\n-import java.util.*;\n+import java.awt.AWTEvent;\n+import java.awt.BorderLayout;\n+import java.awt.Component;\n+import java.awt.EventQueue;\n+import java.awt.KeyboardFocusManager;\n+import java.awt.Toolkit;\n+import java.awt.Window;\n+import java.awt.event.AWTEventListener;\n+import java.awt.event.PaintEvent;\n+import java.beans.PropertyChangeEvent;\n+import java.beans.PropertyChangeListener;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Modifier;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.HashSet;\n+import java.util.LinkedList;\n@@ -32,1 +47,2 @@\n-import javax.swing.*;\n+import javax.swing.JFrame;\n+import javax.swing.JProgressBar;\n@@ -296,1 +312,1 @@\n-     * <code>JFrame<\/code> and the the frame is packed.\n+     * <code>JFrame<\/code> and the frame is packed.\n","filename":"test\/jdk\/javax\/swing\/regtesthelpers\/SwingTestHelper.java","additions":24,"deletions":8,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -71,1 +71,1 @@\n-        System.exit(1);\n+        throw new RuntimeException(throwable);\n","filename":"test\/jdk\/javax\/swing\/text\/AbstractDocument\/6968363\/Test6968363.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-* Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+* Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,2 @@\n+import java.util.concurrent.CountDownLatch;\n+\n@@ -31,0 +33,2 @@\n+import static java.util.concurrent.TimeUnit.MILLISECONDS;\n+\n@@ -34,1 +38,0 @@\n-   @author Mikhail Cherkasov\n@@ -38,2 +41,6 @@\n-    static volatile boolean parsingDone = false;\n-    static volatile Exception exception;\n+    private static final long TIMEOUT = 10_000;\n+\n+    private static final String FILENAME = \"slowparse.html\";\n+\n+    private static final CountDownLatch latch = new CountDownLatch(1);\n+    private static volatile Exception exception;\n@@ -42,2 +49,0 @@\n-        long timeout = 10_000;\n-        long s = System.currentTimeMillis();\n@@ -50,2 +55,1 @@\n-                    htmlKit.read(new FileReader(getDirURL() + \"slowparse.html\"), doc, 0);\n-                    parsingDone = true;\n+                    htmlKit.read(new FileReader(getAbsolutePath()), doc, 0);\n@@ -55,0 +59,1 @@\n+                latch.countDown();\n@@ -57,2 +62,3 @@\n-        while (!parsingDone && exception == null && System.currentTimeMillis() - s < timeout) {\n-            Thread.sleep(200);\n+\n+        if (!latch.await(TIMEOUT, MILLISECONDS)) {\n+            throw new RuntimeException(\"Parsing takes too long.\");\n@@ -60,1 +66,0 @@\n-        final long took = System.currentTimeMillis() - s;\n@@ -64,3 +69,0 @@\n-        if (took > timeout) {\n-            throw new RuntimeException(\"Parsing takes too long.\");\n-        }\n@@ -69,3 +71,3 @@\n-    static String getDirURL() {\n-        return new File(System.getProperty(\"test.src\", \".\")).getAbsolutePath() +\n-                File.separator;\n+    private static String getAbsolutePath() {\n+        return System.getProperty(\"test.src\", \".\")\n+               + File.separator + FILENAME;\n","filename":"test\/jdk\/javax\/swing\/text\/html\/parser\/Parser\/8078268\/bug8078268.java","additions":19,"deletions":17,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-                System.exit(1);\n+                throw new RuntimeException(throwable);\n","filename":"test\/jdk\/javax\/swing\/text\/html\/parser\/Test8017492.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -11,1 +11,1 @@\n-ProgressBarDemo.accessible_text_area_description=This JTextArea is being filled with text from a buffer progressively a character at a time while the progress bar a the bottom of the window shows the loading progress\n+ProgressBarDemo.accessible_text_area_description=This JTextArea is being filled with text from a buffer progressively a character at a time while the progress bar at the bottom of the window shows the loading progress\n","filename":"test\/jdk\/sanity\/client\/lib\/SwingSet3\/src\/com\/sun\/swingset3\/demos\/progressbar\/resources\/ProgressBarDemo.properties","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,1 +33,1 @@\n- * Contains methods to search for components below a a given\n+ * Contains methods to search for components below a given\n","filename":"test\/jdk\/sanity\/client\/lib\/jemmy\/src\/org\/netbeans\/jemmy\/ComponentSearcher.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n- * @bug 8158072 7172749\n+ * @bug 8158072 7172749 8283794\n","filename":"test\/jdk\/sun\/java2d\/ClassCastExceptionForInvalidSurface.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,1 +85,4 @@\n-        Thread.sleep(6000);\n+        Date expiring = new Date(d1.getTime() + 6000);\n+        while (new Date().before(expiring)) {\n+            Thread.sleep(500);\n+        }\n","filename":"test\/jdk\/sun\/security\/krb5\/auto\/Renew.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,135 @@\n+\/*\n+ * Copyright (c) 2022, Huawei Technologies Co., Ltd. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8240903\n+ * @summary Test consistency of moduleHashes attribute between builds\n+ * @library \/test\/lib\n+ * @run testng HashesOrderTest\n+ *\/\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.spi.ToolProvider;\n+import java.util.stream.Collectors;\n+\n+import jdk.test.lib.compiler.ModuleInfoMaker;\n+\n+import org.testng.annotations.Test;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+public class HashesOrderTest {\n+    private ToolProvider JMOD_TOOL = ToolProvider.findFirst(\"jmod\")\n+        .orElseThrow(() ->\n+            new RuntimeException(\"jmod tool not found\")\n+        );\n+\n+    private String DATE = \"2021-01-06T14:36:00+02:00\";\n+    private int NUM_MODULES = 64;\n+    private Path mods;\n+    private Path lib1;\n+    private Path lib2;\n+    private ModuleInfoMaker builder;\n+\n+    @Test\n+    public void test() throws Exception {\n+        mods = Path.of(\"mods\");\n+        lib1 = Path.of(\"lib1\");\n+        lib2 = Path.of(\"lib2\");\n+        builder = new ModuleInfoMaker(Path.of(\"src\"));\n+\n+        Files.createDirectories(mods);\n+        Files.createDirectories(lib1);\n+        Files.createDirectories(lib2);\n+\n+        makeModule(\"ma\");\n+        String moduleName;\n+        for (int i = 0; i < NUM_MODULES; i++) {\n+            moduleName = \"m\" + i + \"b\";\n+            makeModule(moduleName, \"ma\");\n+            makeJmod(moduleName, lib1);\n+            makeJmod(moduleName, lib2);\n+        }\n+        makeJmod(\"ma\", lib1, \"--module-path\", lib1.toString(),\n+                \"--hash-modules\", \".*\");\n+        Path jmod1 = lib1.resolve(\"ma.jmod\");\n+\n+        makeJmod(\"ma\", lib2, \"--module-path\", lib2.toString(),\n+                \"--hash-modules\", \".*\");\n+        Path jmod2 = lib2.resolve(\"ma.jmod\");\n+\n+        assertEquals(Files.mismatch(jmod1, jmod2), -1);\n+    }\n+\n+    private void makeModule(String mn, String... deps)\n+        throws IOException\n+    {\n+        StringBuilder sb = new StringBuilder();\n+        sb.append(\"module \")\n+          .append(mn)\n+          .append(\" {\")\n+          .append(\"\\n\");\n+        Arrays.stream(deps)\n+              .forEach(req -> {\n+                  sb.append(\"    requires \");\n+                  sb.append(req)\n+                    .append(\";\\n\");\n+              });\n+        sb.append(\"}\\n\");\n+        builder.writeJavaFiles(mn, sb.toString());\n+        builder.compile(mn, mods);\n+    }\n+\n+    private void makeJmod(String moduleName, Path libName, String... options) {\n+        Path mclasses = mods.resolve(moduleName);\n+        Path outfile = libName.resolve(moduleName + \".jmod\");\n+        List<String> args = new ArrayList<>();\n+        args.add(\"create\");\n+        Collections.addAll(args, options);\n+        Collections.addAll(args, \"--date\", DATE);\n+        Collections.addAll(args, \"--class-path\", mclasses.toString(),\n+                           outfile.toString());\n+\n+        runJmod(args);\n+    }\n+\n+    private void runJmod(List<String> args) {\n+        runJmod(args.toArray(new String[args.size()]));\n+    }\n+\n+    private void runJmod(String... args) {\n+        int rc = JMOD_TOOL.run(System.out, System.out, args);\n+        System.out.println(\"jmod \" + Arrays.stream(args).collect(Collectors.joining(\" \")));\n+        if (rc != 0) {\n+            throw new AssertionError(\"jmod failed: rc = \" + rc);\n+        }\n+    }\n+\n+}\n","filename":"test\/jdk\/tools\/jmod\/hashes\/HashesOrderTest.java","additions":135,"deletions":0,"binary":false,"changes":135,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8241780 8273244\n+ * @bug 7021614 8241780 8273244 8284908\n@@ -143,1 +143,1 @@\n-    Erroneous[ERRONEOUS, pos:0\n+    Erroneous[ERRONEOUS, pos:0, prefPos:20\n@@ -159,1 +159,1 @@\n-    Erroneous[ERRONEOUS, pos:1\n+    Erroneous[ERRONEOUS, pos:1, prefPos:34\n","filename":"test\/langtools\/tools\/javac\/doctree\/CodeTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -730,1 +730,3 @@\n-                out.println(simpleClassName(node) + \"[\" + node.getKind() + \", pos:\" + ((DCTree) node).pos);\n+                var n = (DCTree) node;\n+                out.println(simpleClassName(node) + \"[\" + node.getKind() + \", pos:\" + n.pos +\n+                        (n.getPreferredPosition() != n.pos ? \", prefPos:\" + n.getPreferredPosition() : \"\"));\n","filename":"test\/langtools\/tools\/javac\/doctree\/DocCommentTester.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-    Erroneous[ERRONEOUS, pos:4\n+    Erroneous[ERRONEOUS, pos:4, prefPos:14\n","filename":"test\/langtools\/tools\/javac\/doctree\/DocRootTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8273244\n+ * @bug 7021614 8273244 8284908\n@@ -141,1 +141,1 @@\n-    Erroneous[ERRONEOUS, pos:6\n+    Erroneous[ERRONEOUS, pos:6, prefPos:10\n@@ -159,1 +159,1 @@\n-    Erroneous[ERRONEOUS, pos:6\n+    Erroneous[ERRONEOUS, pos:6, prefPos:12\n","filename":"test\/langtools\/tools\/javac\/doctree\/EntityTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8078320 8273244\n+ * @bug 8078320 8273244 8284908\n@@ -175,1 +175,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:10\n@@ -191,1 +191,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:14\n","filename":"test\/langtools\/tools\/javac\/doctree\/InPreTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8144287 8273244\n+ * @bug 8144287 8273244 8284908\n@@ -249,1 +249,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:11\n@@ -269,1 +269,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:22\n@@ -285,1 +285,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:11\n","filename":"test\/langtools\/tools\/javac\/doctree\/IndexTest.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -79,1 +79,1 @@\n-    Erroneous[ERRONEOUS, pos:4\n+    Erroneous[ERRONEOUS, pos:4, prefPos:17\n","filename":"test\/langtools\/tools\/javac\/doctree\/InheritDocTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614  8241780 8273244\n+ * @bug 7021614  8241780 8273244 8284908\n@@ -123,1 +123,1 @@\n-    Erroneous[ERRONEOUS, pos:0\n+    Erroneous[ERRONEOUS, pos:0, prefPos:23\n@@ -139,1 +139,1 @@\n-    Erroneous[ERRONEOUS, pos:1\n+    Erroneous[ERRONEOUS, pos:1, prefPos:37\n","filename":"test\/langtools\/tools\/javac\/doctree\/LiteralTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8273244\n+ * @bug 7021614 8273244 8284908\n@@ -70,0 +70,15 @@\n+*\/\n+    \/**\n+     * @param <T type\n+     *\/\n+    <T> void type_param(int x) { }\n+\/*\n+DocComment[DOC_COMMENT, pos:1\n+  firstSentence: empty\n+  body: empty\n+  block tags: 1\n+    Erroneous[ERRONEOUS, pos:1, prefPos:10\n+      code: compiler.err.dc.gt.expected\n+      body: @param_<T_type\n+    ]\n+]\n","filename":"test\/langtools\/tools\/javac\/doctree\/ParamTest.java","additions":17,"deletions":2,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8031212 8273244\n+ * @bug 7021614 8031212 8273244 8284908\n@@ -171,1 +171,1 @@\n-    Erroneous[ERRONEOUS, pos:7\n+    Erroneous[ERRONEOUS, pos:7, prefPos:19\n","filename":"test\/langtools\/tools\/javac\/doctree\/SeeTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 5076751 8273244\n+ * @bug 5076751 8273244 8284908\n@@ -62,1 +62,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:26\n@@ -80,1 +80,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:20\n","filename":"test\/langtools\/tools\/javac\/doctree\/SystemPropertyTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8078320 8273244\n+ * @bug 7021614 8078320 8273244 8284908\n@@ -96,1 +96,1 @@\n-    Erroneous[ERRONEOUS, pos:1\n+    Erroneous[ERRONEOUS, pos:1, prefPos:5\n@@ -144,1 +144,1 @@\n-    Erroneous[ERRONEOUS, pos:1\n+    Erroneous[ERRONEOUS, pos:1, prefPos:2\n@@ -178,1 +178,1 @@\n-    Erroneous[ERRONEOUS, pos:1\n+    Erroneous[ERRONEOUS, pos:1, prefPos:13\n","filename":"test\/langtools\/tools\/javac\/doctree\/TagTest.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8273244\n+ * @bug 7021614 8273244 8284908\n@@ -95,1 +95,1 @@\n-    Erroneous[ERRONEOUS, pos:5\n+    Erroneous[ERRONEOUS, pos:5, prefPos:32\n","filename":"test\/langtools\/tools\/javac\/doctree\/ValueTest.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+import java.io.Closeable;\n@@ -280,0 +281,58 @@\n+\n+    \/\/ Create a temporary keychain in macOS and use it. The original\n+    \/\/ keychains will be restored when the object is closed.\n+    public static class TemporaryKeychain implements Closeable {\n+        \/\/ name of new keychain\n+        private final String newChain;\n+        \/\/ names of the original keychains\n+        private final List<String> oldChains;\n+\n+        public TemporaryKeychain(String name) {\n+            Path p = Path.of(name + \".keychain-db\");\n+            newChain = p.toAbsolutePath().toString();\n+            try {\n+                oldChains = ProcessTools.executeProcess(\"security\", \"list-keychains\")\n+                        .shouldHaveExitValue(0)\n+                        .getStdout()\n+                        .lines()\n+                        .map(String::trim)\n+                        .map(x -> x.startsWith(\"\\\"\") ? x.substring(1, x.length() - 1) : x)\n+                        .collect(Collectors.toList());\n+                if (!Files.exists(p)) {\n+                    ProcessTools.executeProcess(\"security\", \"create-keychain\", \"-p\", \"changeit\", newChain)\n+                            .shouldHaveExitValue(0);\n+                }\n+                ProcessTools.executeProcess(\"security\", \"unlock-keychain\", \"-p\", \"changeit\", newChain)\n+                        .shouldHaveExitValue(0);\n+                ProcessTools.executeProcess(\"security\", \"list-keychains\", \"-s\", newChain)\n+                        .shouldHaveExitValue(0);\n+            } catch (Throwable t) {\n+                if (t instanceof RuntimeException re) {\n+                    throw re;\n+                } else {\n+                    throw new RuntimeException(t);\n+                }\n+            }\n+        }\n+\n+        public String chain() {\n+            return newChain;\n+        }\n+\n+        @Override\n+        public void close() throws IOException {\n+            List<String> cmds = new ArrayList<>();\n+            cmds.addAll(List.of(\"security\", \"list-keychains\", \"-s\"));\n+            cmds.addAll(oldChains);\n+            try {\n+                ProcessTools.executeProcess(cmds.toArray(new String[0]))\n+                        .shouldHaveExitValue(0);\n+            } catch (Throwable t) {\n+                if (t instanceof RuntimeException re) {\n+                    throw re;\n+                } else {\n+                    throw new RuntimeException(t);\n+                }\n+            }\n+        }\n+    }\n","filename":"test\/lib\/jdk\/test\/lib\/SecurityTools.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"modified"},{"patch":"@@ -1,240 +0,0 @@\n-\/*\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package jdk.test.lib.util;\n-\n-import java.lang.reflect.Field;\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.IdentityHashMap;\n-\n-\/**\n- * Utility functions to check that the static storages are pre-sized\n- * optimally.\n- *\/\n-public final class OptimalCapacity {\n-\n-    private OptimalCapacity() {}\n-\n-    \/**\n-     * Checks adequacy of the initial capacity of a static field\n-     * of type {@code ArrayList}.\n-     *\n-     * Having\n-     * <pre>\n-     * class XClass {\n-     *     static ArrayList theList = new ArrayList(N);\n-     * }\n-     * <\/pre>\n-     *\n-     * you should call from the test\n-     *\n-     * <pre>\n-     * OptimalCapacity.assertProperlySized(XClass.class, \"theList\", N);\n-     * <\/pre>\n-     *\/\n-    public static void ofArrayList(Class<?> clazz, String fieldName,\n-            int initialCapacity)\n-    {\n-        try {\n-            Field field = clazz.getDeclaredField(fieldName);\n-            field.setAccessible(true);\n-            Object obj = field.get(null);\n-            if (!ArrayList.class.equals(obj.getClass())) {\n-                throw new RuntimeException(\"'\" + field +\n-                    \"' expected to be of type ArrayList\");\n-            }\n-            ArrayList<?> list = (ArrayList<?>)obj;\n-\n-            \/\/ For ArrayList the optimal capacity is its final size\n-            if (list.size() != initialCapacity) {\n-                throw new RuntimeException(\"Size of '\" + field +\n-                    \"' is \" + list.size() +\n-                    \", but expected to be \" + initialCapacity);\n-            }\n-            if (internalArraySize(list) != initialCapacity) {\n-                throw new RuntimeException(\"Capacity of '\" + field +\n-                    \"' is \" + internalArraySize(list) +\n-                    \", but expected to be \" + initialCapacity);\n-            }\n-        } catch (ReflectiveOperationException roe) {\n-            throw new RuntimeException(roe);\n-        }\n-    }\n-\n-    \/**\n-     * Checks adequacy of the initial capacity of a static field\n-     * of type {@code HashMap}.\n-     *\n-     * Having\n-     * <pre>\n-     * class XClass {\n-     *     static HashMap theMap = new HashMap(N);\n-     * }\n-     * <\/pre>\n-     *\n-     * you should call from the test\n-     *\n-     * <pre>\n-     * OptimalCapacity.ofHashMap(XClass.class, \"theMap\", N);\n-     * <\/pre>\n-     *\/\n-    public static void ofHashMap(Class<?> clazz, String fieldName,\n-            int initialCapacity)\n-    {\n-        ofHashMap(clazz, null, fieldName, initialCapacity);\n-    }\n-\n-    \/**\n-     * Checks adequacy of the initial capacity of a non-static field\n-     * of type {@code HashMap}.\n-     *\n-     * Having\n-     * <pre>\n-     * class XClass {\n-     *     HashMap theMap = new HashMap(N);\n-     * }\n-     * XClass instance = ...\n-     * <\/pre>\n-     *\n-     * you should call from the test\n-     *\n-     * <pre>\n-     * OptimalCapacity.ofHashMap(XClass.class, instance, \"theMap\", N);\n-     * <\/pre>\n-     *\/\n-    public static void ofHashMap(Class<?> clazz, Object instance,\n-            String fieldName, int initialCapacity)\n-    {\n-        try {\n-            Field field = clazz.getDeclaredField(fieldName);\n-            field.setAccessible(true);\n-            Object obj = field.get(instance);\n-            if (!HashMap.class.equals(obj.getClass())) {\n-                throw new RuntimeException(field +\n-                    \" expected to be of type HashMap\");\n-            }\n-            HashMap<?,?> map = (HashMap<?,?>)obj;\n-\n-            \/\/ Check that the map allocates only necessary amount of space\n-            HashMap<Object, Object> tmp = new HashMap<>(map);\n-            if (internalArraySize(map) != internalArraySize(tmp)) {\n-                throw new RuntimeException(\"Final capacity of '\" + field +\n-                    \"' is \" + internalArraySize(map) +\n-                    \", which exceeds necessary minimum \" + internalArraySize(tmp));\n-            }\n-\n-            \/\/ Check that map is initially properly sized\n-            tmp = new HashMap<>(initialCapacity);\n-            tmp.put(new Object(), new Object()); \/\/ trigger storage init\n-            if (internalArraySize(map) != internalArraySize(tmp)) {\n-                throw new RuntimeException(\"Requested capacity of '\" + field +\n-                    \"' was \" + initialCapacity +\n-                    \", which resulted in final capacity \" + internalArraySize(tmp) +\n-                    \", which differs from necessary minimum \" + internalArraySize(map));\n-            }\n-\n-        } catch (ReflectiveOperationException roe) {\n-            throw new RuntimeException(roe);\n-        }\n-    }\n-\n-    \/**\n-     * Checks adequacy of the expected maximum size of a static field\n-     * of type {@code IdentityHashMap}.\n-     *\n-     * Having\n-     * <pre>\n-     * class XClass {\n-     *     static IdentityHashMap theMap = new IdentityHashMap(M);\n-     * }\n-     * <\/pre>\n-     *\n-     * you should call from the test\n-     *\n-     * <pre>\n-     * OptimalCapacity.ofIdentityHashMap(XClass.class, \"theMap\", M);\n-     * <\/pre>\n-     *\/\n-    public static void ofIdentityHashMap(Class<?> clazz, String fieldName,\n-            int expectedMaxSize)\n-    {\n-        try {\n-            Field field = clazz.getDeclaredField(fieldName);\n-            field.setAccessible(true);\n-            Object obj = field.get(null);\n-            if (!IdentityHashMap.class.equals(obj.getClass())) {\n-                throw new RuntimeException(\"'\" + field +\n-                    \"' expected to be of type IdentityHashMap\");\n-            }\n-            IdentityHashMap<?,?> map = (IdentityHashMap<?,?>)obj;\n-\n-            \/\/ Check that size of map is what was expected\n-            if (map.size() != expectedMaxSize) {\n-                throw new RuntimeException(\"Size of '\" + field +\n-                    \"' is \" + map.size() +\n-                    \", which differs from expected \" + expectedMaxSize);\n-            }\n-\n-            \/\/ Check that the map allocated only necessary amount of memory\n-            IdentityHashMap<Object, Object> tmp = new IdentityHashMap<>(map);\n-            if (internalArraySize(map) != internalArraySize(tmp)) {\n-                throw new RuntimeException(\"Final capacity of '\" + field +\n-                    \"' is \" + internalArraySize(map) +\n-                    \", which exceeds necessary minimum \" + internalArraySize(tmp));\n-            }\n-\n-            \/\/ Check that map was initially properly sized\n-            tmp = new IdentityHashMap<>(expectedMaxSize);\n-            tmp.put(new Object(), new Object()); \/\/ trigger storage init\n-            if (internalArraySize(map) != internalArraySize(tmp)) {\n-                throw new RuntimeException(\"Requested number of elements in '\" + field +\n-                    \"' was \" + expectedMaxSize +\n-                    \", which resulted in final capacity \" + internalArraySize(tmp) +\n-                    \", which differs from necessary minimum \" + internalArraySize(map));\n-            }\n-        } catch (ReflectiveOperationException roe) {\n-            throw new RuntimeException(roe);\n-        }\n-    }\n-\n-    \/**\n-     * Returns size of the internal storage.\n-     *\/\n-    private static int internalArraySize(Object container)\n-            throws ReflectiveOperationException {\n-        Field field;\n-        if (ArrayList.class.equals(container.getClass())) {\n-            field = ArrayList.class.getDeclaredField(\"elementData\");\n-        } else if (HashMap.class.equals(container.getClass())) {\n-            field = HashMap.class.getDeclaredField(\"table\");\n-        } else if (IdentityHashMap.class.equals(container.getClass())) {\n-            field = IdentityHashMap.class.getDeclaredField(\"table\");\n-        } else {\n-            throw new RuntimeException(\"Unexpected class \" +\n-                    container.getClass());\n-        }\n-        field.setAccessible(true);\n-        return ((Object[])field.get(container)).length;\n-    }\n-}\n","filename":"test\/lib\/jdk\/test\/lib\/util\/OptimalCapacity.java","additions":0,"deletions":240,"binary":false,"changes":240,"status":"deleted"},{"patch":"@@ -27,0 +27,1 @@\n+import org.openjdk.jmh.annotations.Fork;\n@@ -37,3 +38,0 @@\n-\/**\n- * Tests unsigned division and modulus methods in java.lang.Integer\n- *\/\n@@ -43,0 +41,1 @@\n+@Fork(1)\n@@ -63,2 +62,5 @@\n-            if (divisorType.equals(\"positive\")) divisor = Math.abs(divisor);\n-            else if (divisorType.equals(\"negative\")) divisor = -Math.abs(divisor);\n+            if (divisorType.equals(\"positive\")) {\n+                divisor = Math.abs(divisor);\n+            } else if (divisorType.equals(\"negative\")) {\n+                divisor = -Math.abs(divisor);\n+            }\n@@ -69,0 +71,22 @@\n+    @Benchmark\n+    public void testDivide() {\n+        for (int i = 0; i < BUFFER_SIZE; i++) {\n+            quotients[i] = dividends[i] \/ divisors[i];\n+        }\n+    }\n+\n+    @Benchmark\n+    public void testDivideKnownPositive() {\n+        for (int i = 0; i < BUFFER_SIZE; i++) {\n+            quotients[i] = dividends[i] \/ Math.max(1, divisors[i]);\n+        }\n+    }\n+\n+    @Benchmark\n+    public void testDivideHoistedDivisor() {\n+        int x = divisors[0];\n+        for (int i = 0; i < BUFFER_SIZE; i++) {\n+            quotients[i] = dividends[i] \/ x;\n+        }\n+    }\n+\n@@ -94,1 +118,0 @@\n-\n@@ -96,3 +119,0 @@\n-\n-\n-\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/IntegerDivMod.java","additions":29,"deletions":9,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+import org.openjdk.jmh.annotations.Fork;\n@@ -37,3 +38,0 @@\n-\/**\n- * Tests unsigned division and modulus methods in java.lang.Long\n- *\/\n@@ -43,0 +41,1 @@\n+@Fork(1)\n@@ -63,2 +62,5 @@\n-            if (divisorType.equals(\"positive\")) divisor = Math.abs(divisor);\n-            else if (divisorType.equals(\"negative\")) divisor = -Math.abs(divisor);\n+            if (divisorType.equals(\"positive\")) {\n+                divisor = Math.abs(divisor);\n+            } else if (divisorType.equals(\"negative\")) {\n+                divisor = -Math.abs(divisor);\n+            }\n@@ -69,0 +71,22 @@\n+    @Benchmark\n+    public void testDivide() {\n+        for (int i = 0; i < BUFFER_SIZE; i++) {\n+            quotients[i] = dividends[i] \/ divisors[i];\n+        }\n+    }\n+\n+    @Benchmark\n+    public void testDivideKnownPositive() {\n+        for (int i = 0; i < BUFFER_SIZE; i++) {\n+            quotients[i] = dividends[i] \/ Math.max(1, divisors[i]);\n+        }\n+    }\n+\n+    @Benchmark\n+    public void testDivideHoistedDivisor() {\n+        long x = divisors[0];\n+        for (int i = 0; i < BUFFER_SIZE; i++) {\n+            quotients[i] = dividends[i] \/ x;\n+        }\n+    }\n+\n@@ -94,1 +118,0 @@\n-\n@@ -96,3 +119,0 @@\n-\n-\n-\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/LongDivMod.java","additions":29,"deletions":9,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,2 @@\n+import org.openjdk.jmh.annotations.Fork;\n+import org.openjdk.jmh.annotations.Measurement;\n@@ -32,0 +34,1 @@\n+import org.openjdk.jmh.annotations.Warmup;\n@@ -34,0 +37,1 @@\n+import java.util.Locale;\n@@ -40,0 +44,3 @@\n+@Warmup(iterations = 10, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n+@Measurement(iterations = 5, time = 1000, timeUnit = TimeUnit.MILLISECONDS)\n+@Fork(3)\n@@ -46,0 +53,1 @@\n+    private String str1UP;\n@@ -51,0 +59,1 @@\n+        str1UP = str1.toUpperCase(Locale.ROOT);\n@@ -88,0 +97,6 @@\n+    @Benchmark\n+    public void regionMatchesLatin1(Blackhole bh) {\n+        bh.consume(str1.regionMatches(true, 0, str2, 0, str1.length()));\n+        bh.consume(str2.regionMatches(true, 16, str1UP, 0, 8));\n+        bh.consume(str3.regionMatches(true, 6, str4, 1, 2));\n+    }\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/StringOther.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -0,0 +1,122 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.bench.java.lang.invoke;\n+\n+import org.openjdk.jmh.annotations.Benchmark;\n+import org.openjdk.jmh.annotations.BenchmarkMode;\n+import org.openjdk.jmh.annotations.Fork;\n+import org.openjdk.jmh.annotations.Measurement;\n+import org.openjdk.jmh.annotations.Mode;\n+import org.openjdk.jmh.annotations.OutputTimeUnit;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.Warmup;\n+import org.openjdk.jmh.infra.Blackhole;\n+\n+import java.util.concurrent.TimeUnit;\n+import sun.invoke.util.Wrapper;\n+\n+\/**\n+ * Test sun.invoke.util.Wrapper accessors\n+ *\/\n+@BenchmarkMode(Mode.AverageTime)\n+@Warmup(iterations = 5, time = 500, timeUnit = TimeUnit.MILLISECONDS)\n+@Measurement(iterations = 10, time = 500, timeUnit = TimeUnit.MILLISECONDS)\n+@OutputTimeUnit(TimeUnit.NANOSECONDS)\n+@State(Scope.Thread)\n+@Fork(value = 3, jvmArgsAppend = \"--add-exports=java.base\/sun.invoke.util=ALL-UNNAMED\")\n+public class Wrappers {\n+\n+    public static Class<?>[] PRIM_CLASSES = {\n+        int.class,\n+        float.class,\n+        short.class,\n+        double.class,\n+        void.class,\n+        boolean.class,\n+        byte.class,\n+        char.class,\n+        long.class };\n+\n+    public static Class<?>[] WRAP_CLASSES = {\n+        Integer.class,\n+        Float.class,\n+        Short.class,\n+        Double.class,\n+        Void.class,\n+        Boolean.class,\n+        Byte.class,\n+        Character.class,\n+        Long.class,\n+        Object.class };\n+    public static char[] BASIC_TYPES = {\n+        'I',\n+        'J',\n+        'S',\n+        'B',\n+        'C',\n+        'F',\n+        'D',\n+        'Z',\n+        'V',\n+        'L' };\n+    public static char[] PRIM_TYPES = {\n+        'I',\n+        'J',\n+        'S',\n+        'B',\n+        'C',\n+        'F',\n+        'D',\n+        'Z',\n+        'V' };\n+\n+    @Benchmark\n+    public void forPrimitive(Blackhole bh) throws Throwable {\n+        for (Class<?> c : PRIM_CLASSES) {\n+            bh.consume(Wrapper.forPrimitiveType(c));\n+        }\n+    }\n+\n+    @Benchmark\n+    public void forWrapper(Blackhole bh) throws Throwable {\n+        for (Class<?> c : WRAP_CLASSES) {\n+            bh.consume(Wrapper.forWrapperType(c));\n+        }\n+    }\n+\n+    @Benchmark\n+    public void forBasicType(Blackhole bh) throws Throwable {\n+        for (char c : BASIC_TYPES) {\n+            bh.consume(Wrapper.forBasicType(c));\n+        }\n+    }\n+\n+    @Benchmark\n+    public void forPrimitiveType(Blackhole bh) throws Throwable {\n+        for (char c : PRIM_TYPES) {\n+            bh.consume(Wrapper.forPrimitiveType(c));\n+        }\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/invoke\/Wrappers.java","additions":122,"deletions":0,"binary":false,"changes":122,"status":"added"},{"patch":"@@ -0,0 +1,184 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package org.openjdk.bench.java.security;\n+\n+import org.openjdk.jmh.annotations.Benchmark;\n+import org.openjdk.jmh.annotations.BenchmarkMode;\n+import org.openjdk.jmh.annotations.Fork;\n+import org.openjdk.jmh.annotations.Level;\n+import org.openjdk.jmh.annotations.Measurement;\n+import org.openjdk.jmh.annotations.Mode;\n+import org.openjdk.jmh.annotations.OutputTimeUnit;\n+import org.openjdk.jmh.annotations.Param;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.TearDown;\n+import org.openjdk.jmh.annotations.Warmup;\n+\n+import java.nio.ByteBuffer;\n+import java.security.KeyStore;\n+import java.util.concurrent.TimeUnit;\n+import javax.net.ssl.KeyManagerFactory;\n+import javax.net.ssl.SSLContext;\n+import javax.net.ssl.SSLEngine;\n+import javax.net.ssl.SSLEngineResult;\n+import javax.net.ssl.SSLEngineResult.HandshakeStatus;\n+import javax.net.ssl.SSLSession;\n+import javax.net.ssl.TrustManagerFactory;\n+\n+@BenchmarkMode(Mode.Throughput)\n+@OutputTimeUnit(TimeUnit.SECONDS)\n+@State(Scope.Benchmark)\n+public class SSLHandshake {\n+\n+    private SSLContext sslc;\n+\n+    private SSLEngine clientEngine;\n+    private ByteBuffer clientOut = ByteBuffer.allocate(5);\n+    private ByteBuffer clientIn = ByteBuffer.allocate(1 << 15);\n+\n+    private SSLEngine serverEngine;\n+    private ByteBuffer serverOut = ByteBuffer.allocate(5);\n+    private ByteBuffer serverIn = ByteBuffer.allocate(1 << 15);\n+\n+    private ByteBuffer cTOs = ByteBuffer.allocateDirect(1 << 16);\n+    private ByteBuffer sTOc = ByteBuffer.allocateDirect(1 << 16);\n+\n+    @Param({\"true\", \"false\"})\n+    boolean resume;\n+\n+    @Param({\"TLSv1.2\", \"TLS\"})\n+    String tlsVersion;\n+\n+    @Setup(Level.Trial)\n+    public void init() throws Exception {\n+        KeyStore ks = TestCertificates.getKeyStore();\n+        KeyStore ts = TestCertificates.getTrustStore();\n+\n+        KeyManagerFactory kmf = KeyManagerFactory.getInstance(\"SunX509\");\n+        kmf.init(ks, new char[0]);\n+\n+        TrustManagerFactory tmf =\n+                TrustManagerFactory.getInstance(\"SunX509\");\n+        tmf.init(ts);\n+\n+        SSLContext sslCtx = SSLContext.getInstance(tlsVersion);\n+        sslCtx.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);\n+        sslc = sslCtx;\n+    }\n+\n+    private HandshakeStatus checkResult(SSLEngine engine, SSLEngineResult result) {\n+\n+        HandshakeStatus hsStatus = result.getHandshakeStatus();\n+\n+        if (hsStatus == HandshakeStatus.NEED_TASK) {\n+            Runnable runnable;\n+            while ((runnable = engine.getDelegatedTask()) != null) {\n+                runnable.run();\n+            }\n+            hsStatus = engine.getHandshakeStatus();\n+        }\n+        return hsStatus;\n+    }\n+\n+    \/**\n+     * This benchmark measures the time needed to perform a TLS handshake.\n+     * Data is exchanged using a pair of ByteBuffers.\n+     * The client and the server both operate on the same thread.\n+     *\/\n+    @Benchmark\n+    @Warmup(iterations = 5, time = 5, timeUnit = TimeUnit.SECONDS)\n+    @Measurement(iterations = 5, time = 5, timeUnit = TimeUnit.SECONDS)\n+    @Fork(3)\n+    public SSLSession doHandshake() throws Exception {\n+\n+        createSSLEngines();\n+        boolean isCtoS = true;\n+        for (;;) {\n+            HandshakeStatus result;\n+            if (isCtoS) {\n+                result = checkResult(clientEngine,\n+                        clientEngine.wrap(clientOut, cTOs)\n+                );\n+                cTOs.flip();\n+                checkResult(serverEngine,\n+                        serverEngine.unwrap(cTOs, serverIn)\n+                );\n+                cTOs.compact();\n+                if (result == HandshakeStatus.NEED_UNWRAP) {\n+                    isCtoS = false;\n+                } else if (result == HandshakeStatus.FINISHED) {\n+                    break;\n+                } else if (result != HandshakeStatus.NEED_WRAP) {\n+                    throw new Exception(\"Unexpected result \"+result);\n+                }\n+            } else {\n+                result = checkResult(serverEngine,\n+                        serverEngine.wrap(serverOut, sTOc)\n+                );\n+                sTOc.flip();\n+                checkResult(clientEngine,\n+                        clientEngine.unwrap(sTOc, clientIn)\n+                );\n+                sTOc.compact();\n+                if (result == HandshakeStatus.NEED_UNWRAP) {\n+                    isCtoS = true;\n+                } else if (result == HandshakeStatus.FINISHED) {\n+                    break;\n+                } else if (result != HandshakeStatus.NEED_WRAP) {\n+                    throw new Exception(\"Unexpected result \"+result);\n+                }\n+            }\n+        }\n+\n+        SSLSession session = clientEngine.getSession();\n+        if (resume) {\n+            \/\/ TLS 1.3 needs another wrap\/unwrap to deliver a session ticket\n+            serverEngine.wrap(serverOut, sTOc);\n+            sTOc.flip();\n+            clientEngine.unwrap(sTOc, clientIn);\n+            sTOc.compact();\n+        } else {\n+            \/\/ invalidate TLS1.2 session. TLS 1.3 doesn't care\n+            session.invalidate();\n+        }\n+        return session;\n+    }\n+\n+    private void createSSLEngines() {\n+        \/*\n+         * Configure the serverEngine to act as a server in the SSL\/TLS\n+         * handshake.\n+         *\/\n+        serverEngine = sslc.createSSLEngine();\n+        serverEngine.setUseClientMode(false);\n+\n+        \/*\n+         * Similar to above, but using client mode instead.\n+         *\/\n+        clientEngine = sslc.createSSLEngine(\"client\", 80);\n+        clientEngine.setUseClientMode(true);\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/security\/SSLHandshake.java","additions":184,"deletions":0,"binary":false,"changes":184,"status":"added"},{"patch":"@@ -0,0 +1,148 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package org.openjdk.bench.java.security;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.security.GeneralSecurityException;\n+import java.security.Key;\n+import java.security.KeyFactory;\n+import java.security.KeyStore;\n+import java.security.cert.Certificate;\n+import java.security.cert.CertificateFactory;\n+import java.security.spec.PKCS8EncodedKeySpec;\n+import java.util.Base64;\n+\n+\/**\n+ * This class contains a 3-certificate chain for use in TLS tests.\n+ * The method {@link #getKeyStore()} returns a keystore with a single entry\n+ * containing one server+one intermediate CA certificate.\n+ * Server's CN and subjectAltName are both set to \"client\"\n+ *\n+ * The method {@link #getTrustStore()} returns a keystore with a single entry\n+ * containing the root CA certificate used for signing the intermediate CA.\n+ *\/\n+class TestCertificates {\n+\n+    \/\/ \"\/C=US\/ST=CA\/O=Test Root CA, Inc.\"\n+    \/\/ basicConstraints=critical, CA:true\n+    \/\/ subjectKeyIdentifier    = hash\n+    \/\/ authorityKeyIdentifier  = keyid:always\n+    \/\/ keyUsage                = keyCertSign\n+    private static final String ROOT_CA_CERT =\n+            \"-----BEGIN CERTIFICATE-----\\n\" +\n+            \"MIIB0jCCAXigAwIBAgIUE+wUdx22foJXSQzD3hpCNCqITLEwCgYIKoZIzj0EAwIw\\n\" +\n+            \"NzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRswGQYDVQQKDBJUZXN0IFJvb3Qg\\n\" +\n+            \"Q0EsIEluYy4wIBcNMjIwNDEyMDcxMzMzWhgPMjEyMjAzMTkwNzEzMzNaMDcxCzAJ\\n\" +\n+            \"BgNVBAYTAlVTMQswCQYDVQQIDAJDQTEbMBkGA1UECgwSVGVzdCBSb290IENBLCBJ\\n\" +\n+            \"bmMuMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEBKye\/mwO0V0WLr71tf8auFEz\\n\" +\n+            \"EmqhaYWauaP17Fb33fRAeG8aVp9c4B0isv\/VgcqSTRMG0SJjbx7ttSYwR\/JNhqNg\\n\" +\n+            \"MF4wDwYDVR0TAQH\/BAUwAwEB\/zAdBgNVHQ4EFgQUpfGt4bjadmVzWeXAiSMp9pLU\\n\" +\n+            \"RMkwHwYDVR0jBBgwFoAUpfGt4bjadmVzWeXAiSMp9pLURMkwCwYDVR0PBAQDAgIE\\n\" +\n+            \"MAoGCCqGSM49BAMCA0gAMEUCIBF8YyD5BBuhkFNV\/3rNmvvMuvWUAECJ8rrUg8kr\\n\" +\n+            \"J8zpAiEAzbZQsC\/IZ0wVNd4lqHn6\/Ih5v7vhCgkg95KCP1NhBnU=\\n\" +\n+            \"-----END CERTIFICATE-----\";\n+\n+    \/\/ \"\/C=US\/ST=CA\/O=Test Intermediate CA, Inc.\"\n+    \/\/ basicConstraints=critical, CA:true, pathlen:0\n+    \/\/ subjectKeyIdentifier    = hash\n+    \/\/ authorityKeyIdentifier  = keyid:always\n+    \/\/ keyUsage                = keyCertSign\n+    private static final String CA_CERT =\n+            \"-----BEGIN CERTIFICATE-----\\n\" +\n+            \"MIIB3TCCAYOgAwIBAgIUQ+lTbsDcIQ1UUg0RGdpJB6JMXpcwCgYIKoZIzj0EAwIw\\n\" +\n+            \"NzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRswGQYDVQQKDBJUZXN0IFJvb3Qg\\n\" +\n+            \"Q0EsIEluYy4wIBcNMjIwNDEyMDcxMzM0WhgPMjEyMjAzMTkwNzEzMzRaMD8xCzAJ\\n\" +\n+            \"BgNVBAYTAlVTMQswCQYDVQQIDAJDQTEjMCEGA1UECgwaVGVzdCBJbnRlcm1lZGlh\\n\" +\n+            \"dGUgQ0EsIEluYy4wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAQ7DsKCSQkP5oT2\\n\" +\n+            \"Wx0gf40N+H\/F75w1YmPm6dp2wiQ6JPMN\/4En87Ylx0ISJkeXJLxrbLvu2xZ+aonM\\n\" +\n+            \"kckNh\/ERo2MwYTASBgNVHRMBAf8ECDAGAQH\/AgEAMB0GA1UdDgQWBBTqP6hB5Ibr\\n\" +\n+            \"aivot\/zWSMKr8ZkCVzAfBgNVHSMEGDAWgBSl8a3huNp2ZXNZ5cCJIyn2ktREyTAL\\n\" +\n+            \"BgNVHQ8EBAMCAgQwCgYIKoZIzj0EAwIDSAAwRQIhAM0vCIV938aqGAEmELIA8Kc4\\n\" +\n+            \"X+kOc4LGE0R7sMiBAbXuAiBlbNVaskKYRHIEGHEtIWet6Ufi3w9NMrycEbBZ+v5o\\n\" +\n+            \"gA==\\n\" +\n+            \"-----END CERTIFICATE-----\";\n+\n+    \/\/ \"\/C=US\/ST=CA\/O=Test Server\/CN=client\"\n+    \/\/ subjectKeyIdentifier    = hash\n+    \/\/ authorityKeyIdentifier  = keyid:always\n+    \/\/ keyUsage                = digitalSignature\n+    \/\/ subjectAltName          = DNS:client\n+    private static final String SERVER_CERT =\n+            \"-----BEGIN CERTIFICATE-----\\n\" +\n+            \"MIIB5TCCAYygAwIBAgIUNWe754lZoDc6wNs9Vsev\/h9TMicwCgYIKoZIzj0EAwIw\\n\" +\n+            \"PzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMSMwIQYDVQQKDBpUZXN0IEludGVy\\n\" +\n+            \"bWVkaWF0ZSBDQSwgSW5jLjAgFw0yMjA0MTIwNzEzMzRaGA8yMTIyMDMxOTA3MTMz\\n\" +\n+            \"NFowQTELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRQwEgYDVQQKDAtUZXN0IFNl\\n\" +\n+            \"cnZlcjEPMA0GA1UEAwwGY2xpZW50MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE\\n\" +\n+            \"o6zUz5QmzmfHL2xRifvaJenggck\/Dlu6KC4v4rGXug69R7tWKWuRUsbSFLy29Rii\\n\" +\n+            \"F7V1wjFhsyGAzNyKf\/KlmaNiMGAwHQYDVR0OBBYEFHz32VSnXBF4WdLDOe7e3hF9\\n\" +\n+            \"yDxmMB8GA1UdIwQYMBaAFOo\/qEHkhutqK+i3\/NZIwqvxmQJXMAsGA1UdDwQEAwIH\\n\" +\n+            \"gDARBgNVHREECjAIggZjbGllbnQwCgYIKoZIzj0EAwIDRwAwRAIgWsCn2LIElgVs\\n\" +\n+            \"VihcQznvBemWneEcmnp\/Bw+lwk86KQ8CIA3loL7P\/0\/Ft\/xXtClxJfyxEoZ\/Az1n\\n\" +\n+            \"HTTjbe6ZnN0Y\\n\" +\n+            \"-----END CERTIFICATE-----\";\n+\n+    private static final String serverkey =\n+            \/\/\"-----BEGIN PRIVATE KEY-----\\n\" +\n+            \"MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgKb9cKLH++BgA9CL1\\n\" +\n+            \"cdCLHpD0poPJ\/uAkafGXDJBR67ChRANCAASjrNTPlCbOZ8cvbFGJ+9ol6eCByT8O\\n\" +\n+            \"W7ooLi\/isZe6Dr1Hu1Ypa5FSxtIUvLb1GKIXtXXCMWGzIYDM3Ip\/8qWZ\";\n+            \/\/ + \"\\n-----END PRIVATE KEY-----\";\n+\n+    private TestCertificates() {}\n+\n+    public static KeyStore getKeyStore() throws GeneralSecurityException, IOException {\n+        KeyStore result = KeyStore.getInstance(\"JKS\");\n+        result.load(null, null);\n+        CertificateFactory cf = CertificateFactory.getInstance(\"X.509\");\n+        Certificate serverCert = cf.generateCertificate(\n+                new ByteArrayInputStream(\n+                        TestCertificates.SERVER_CERT.getBytes(StandardCharsets.ISO_8859_1)));\n+        Certificate caCert = cf.generateCertificate(\n+                new ByteArrayInputStream(\n+                        CA_CERT.getBytes(StandardCharsets.ISO_8859_1)));\n+        KeyFactory kf = KeyFactory.getInstance(\"EC\");\n+        PKCS8EncodedKeySpec ks = new PKCS8EncodedKeySpec(\n+                Base64.getMimeDecoder().decode(serverkey));\n+        Key key = kf.generatePrivate(ks);\n+        Certificate[] chain = {serverCert, caCert};\n+\n+        result.setKeyEntry(\"server\", key, new char[0], chain);\n+        return result;\n+    }\n+\n+    public static KeyStore getTrustStore() throws GeneralSecurityException, IOException {\n+        KeyStore result = KeyStore.getInstance(\"JKS\");\n+        result.load(null, null);\n+        CertificateFactory cf = CertificateFactory.getInstance(\"X.509\");\n+        Certificate rootcaCert = cf.generateCertificate(\n+                new ByteArrayInputStream(\n+                        ROOT_CA_CERT.getBytes(StandardCharsets.ISO_8859_1)));\n+\n+        result.setCertificateEntry(\"testca\", rootcaCert);\n+        return result;\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/security\/TestCertificates.java","additions":148,"deletions":0,"binary":false,"changes":148,"status":"added"},{"patch":"@@ -0,0 +1,80 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.bench.java.util.stream;\n+\n+import org.openjdk.jmh.annotations.Benchmark;\n+import org.openjdk.jmh.annotations.BenchmarkMode;\n+import org.openjdk.jmh.annotations.Fork;\n+import org.openjdk.jmh.annotations.Measurement;\n+import org.openjdk.jmh.annotations.Mode;\n+import org.openjdk.jmh.annotations.OutputTimeUnit;\n+import org.openjdk.jmh.annotations.Param;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.Warmup;\n+\n+import java.math.BigInteger;\n+import java.util.SplittableRandom;\n+import java.util.concurrent.TimeUnit;\n+import java.util.regex.Pattern;\n+import java.util.stream.Collectors;\n+\n+\/**\n+ * Benchmark for checking Pattern::splitAsStream performance\n+ * with CPU-bound downstream operation in sequential and parallel streams\n+ *\n+ * See JDK-8280915\n+ *\/\n+@BenchmarkMode(Mode.AverageTime)\n+@OutputTimeUnit(TimeUnit.MICROSECONDS)\n+@Warmup(iterations = 5, time = 500, timeUnit = TimeUnit.MILLISECONDS)\n+@Measurement(iterations = 10, time = 500, timeUnit = TimeUnit.MILLISECONDS)\n+@Fork(3)\n+@State(Scope.Thread)\n+public class PatternSplit {\n+    @Param({\"10\", \"100\", \"1000\", \"10000\"})\n+    private int size;\n+\n+    private String input;\n+\n+    private static final Pattern PATTERN = Pattern.compile(\",\");\n+\n+    @Setup\n+    public void setup() {\n+        input = new SplittableRandom(1).ints(size, 1000, 2000)\n+                .mapToObj(String::valueOf).collect(Collectors.joining(\",\"));\n+    }\n+\n+    @Benchmark\n+    public BigInteger sumOf1000thPowers() {\n+        return PATTERN.splitAsStream(input).map(BigInteger::new).map(v -> v.pow(1000))\n+                .reduce(BigInteger.ZERO, BigInteger::add);\n+    }\n+\n+    @Benchmark\n+    public BigInteger sumOf1000thPowersParallel() {\n+        return PATTERN.splitAsStream(input).parallel().map(BigInteger::new).map(v -> v.pow(1000))\n+                .reduce(BigInteger.ZERO, BigInteger::add);\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/util\/stream\/PatternSplit.java","additions":80,"deletions":0,"binary":false,"changes":80,"status":"added"}]}