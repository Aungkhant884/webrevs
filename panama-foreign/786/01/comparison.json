{"files":[{"patch":"@@ -2,1 +2,1 @@\n- *  Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ *  Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -81,1 +81,1 @@\n-            checkCarrierSize(carrier, bitSize);\n+            assertCarrierSize(carrier, bitSize);\n@@ -111,7 +111,3 @@\n-            if (this == other) {\n-                return true;\n-            }\n-            if (!super.equals(other)) {\n-                return false;\n-            }\n-            return other instanceof AbstractValueLayout<?> otherValue &&\n+            return this == other ||\n+                    other instanceof AbstractValueLayout<?> otherValue &&\n+                    super.equals(other) &&\n@@ -152,13 +148,8 @@\n-        static void checkCarrierSize(Class<?> carrier, long size) {\n-            if (!isValidCarrier(carrier)) {\n-                throw new IllegalArgumentException(\"Invalid carrier: \" + carrier.getName());\n-            }\n-            if (carrier == MemorySegment.class && size != ADDRESS_SIZE_BITS) {\n-                throw new IllegalArgumentException(\"Address size mismatch: \" + ADDRESS_SIZE_BITS + \" != \" + size);\n-            }\n-            if (carrier.isPrimitive()) {\n-                int expectedSize = carrier == boolean.class ? 8 : Wrapper.forPrimitiveType(carrier).bitWidth();\n-                if (size != expectedSize) {\n-                    throw new IllegalArgumentException(\"Carrier size mismatch: \" + carrier.getName() + \" != \" + size);\n-                }\n-            }\n+        static void assertCarrierSize(Class<?> carrier, long bitSize) {\n+            assert isValidCarrier(carrier);\n+            assert carrier != MemorySegment.class\n+                    \/\/ MemorySegment bitSize must always equal ADDRESS_SIZE_BITS\n+                    || bitSize == ADDRESS_SIZE_BITS;\n+            assert !carrier.isPrimitive() ||\n+                    \/\/ Primitive class bitSize must always correspond\n+                    bitSize == (carrier == boolean.class ? 8 : Wrapper.forPrimitiveType(carrier).bitWidth());\n@@ -168,0 +159,1 @@\n+            \/\/ void.class is not valid\n@@ -179,1 +171,0 @@\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/layout\/ValueLayouts.java","additions":14,"deletions":23,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -35,1 +35,0 @@\n-import java.util.function.Function;\n@@ -41,4 +40,1 @@\n-import static java.lang.foreign.ValueLayout.JAVA_BYTE;\n-import static java.lang.foreign.ValueLayout.JAVA_INT;\n-import static java.lang.foreign.ValueLayout.JAVA_LONG;\n-import static java.lang.foreign.ValueLayout.JAVA_SHORT;\n+import static java.lang.foreign.ValueLayout.*;\n@@ -54,0 +50,27 @@\n+    @Test(dataProvider = \"basicLayoutsAndAddress\")\n+    public void testNotEquals(MemoryLayout layout) {\n+\n+        \/\/ Use another Type\n+        MemoryLayout differentType = MemoryLayout.paddingLayout(8);\n+        assertFalse(layout.equals(differentType));\n+\n+        \/\/ Use another name\n+        MemoryLayout differentName = layout.withName(\"CustomName\");\n+        assertFalse(layout.equals(differentName));\n+\n+        \/\/ Swap endian\n+        MemoryLayout differentOrder = JAVA_INT.withOrder(JAVA_INT.order() == ByteOrder.BIG_ENDIAN ? ByteOrder.LITTLE_ENDIAN : ByteOrder.BIG_ENDIAN);\n+        assertFalse(layout.equals(differentOrder));\n+\n+        \/\/ Something totally different\n+        assertFalse(layout.equals(\"A\"));\n+\n+        \/\/ Null\n+        assertFalse(layout.equals(null));\n+    }\n+\n+    public void testTargetLayoutEquals() {\n+        MemoryLayout differentTargetLayout = ADDRESS.withTargetLayout(JAVA_CHAR);\n+        assertFalse(ADDRESS.equals(differentTargetLayout));\n+    }\n+\n@@ -283,0 +306,7 @@\n+    @DataProvider(name = \"basicLayoutsAndAddress\")\n+    public Object[][] basicLayoutsAndAddress() {\n+        return Stream.concat(Stream.of(basicLayouts), Stream.of(ADDRESS))\n+                .map(l -> new Object[] { l })\n+                .toArray(Object[][]::new);\n+    }\n+\n","filename":"test\/jdk\/java\/foreign\/TestLayouts.java","additions":35,"deletions":5,"binary":false,"changes":40,"status":"modified"}]}