[{"commit":{"message":"8284072: foreign\/StdLibTest.java randomly crashes on MacOS\/AArch64\n\nThis test fails intermittently on Apple silicon macOS with a JVM SIGBUS\nand the stack trace below:\n\n  Stack: [0x0000000171758000,0x000000017195b000], sp=0x0000000171957ef0, free space=2047k\n  Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\n  V [libjvm.dylib+0x984f70] MarkActivationClosure::do_code_blob(CodeBlob*)+0x3c\n  V [libjvm.dylib+0x9bfb60] JavaThread::nmethods_do(CodeBlobClosure*)+0xac\n  V [libjvm.dylib+0x4669a8] HandshakeState::process_by_self(bool)+0x31c\n  V [libjvm.dylib+0x891230] SafepointMechanism::process(JavaThread*, bool)+0xac\n  V [libjvm.dylib+0x9f4df0] UpcallLinker::on_entry(UpcallStub::FrameData*)+0xe0\n  v blob 0x000000010e1ca4a8\n  C [libsystem_c.dylib+0x5c284] _isort+0x88\n  C 0x176d80010e0ca444\n  j java.lang.invoke.LambdaForm$MH+0x0000000800c82000.invoke(Ljava\/lang\/Object;JJJJJ)V+16 java.base@19-internal\n\nIn UpcallLinker::on_entry we call\nThreadStateTransition::transition_from_native() which needs the code\ncache to be writable if it suspends for a safepoint\/handshake.\n\nUse the ThreadWXEnable helper to temporarily set the W^X state to W\nwhile inside on_entry() and then toggle it back to X before returning to\nthe upcall stub.\n\nTested jdk_foreign plus looped java\/foreign\/StdLibTest.java for several\nhours on an M1 Mac Mini which used to eventually fail."},"files":[{"filename":"src\/hotspot\/share\/prims\/upcallLinker.cpp"}],"sha":"4fd35561cc5cec562dac587c61a40d1be0183fc6"}]