{"files":[{"patch":"@@ -354,1 +354,1 @@\n-     * segment with the requested size cannot be found, {@link MemorySegment#NULL} is returned instead.\n+     * segment with the requested size cannot be found, an {@link IndexOutOfBoundsException} is thrown.\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/SegmentAllocator.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -48,7 +48,3 @@\n-        if (segment.byteSize() - start < byteSize) {\n-            return MemorySegment.NULL;\n-        } else {\n-            MemorySegment slice = segment.asSlice(start, byteSize);\n-            sp = start + byteSize;\n-            return slice;\n-        }\n+        MemorySegment slice = segment.asSlice(start, byteSize);\n+        sp = start + byteSize;\n+        return slice;\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SlicingAllocator.java","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -88,1 +88,1 @@\n-                    } catch (IndexOutOfBoundsException | IllegalStateException ex) {\n+                    } catch (IndexOutOfBoundsException ex) {\n@@ -121,2 +121,2 @@\n-            assertEquals(MemorySegment.NULL, allocator.allocate(12));\n-            assertNotEquals(MemorySegment.NULL, allocator.allocate(5));\n+            assertThrows(IndexOutOfBoundsException.class, () -> allocator.allocate(12));\n+            allocator.allocate(5);\n","filename":"test\/jdk\/java\/foreign\/TestSegmentAllocators.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -149,0 +149,1 @@\n+        long rem;\n@@ -157,3 +158,1 @@\n-            MemorySegment res = current.allocate(byteSize, byteAlignment);\n-            if (res.equals(MemorySegment.NULL)) {\n-                \/\/ reached the end of the segment, start again\n+            if (rem < byteSize) {\n@@ -161,1 +160,0 @@\n-                res = current.allocate(byteSize, byteAlignment);\n@@ -163,0 +161,2 @@\n+            MemorySegment res = current.allocate(byteSize, byteAlignment);\n+            rem -= segment.segmentOffset(res);\n@@ -168,0 +168,1 @@\n+            rem = segment.byteSize();\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/foreign\/StrLenTest.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"}]}