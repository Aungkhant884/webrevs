{"files":[{"patch":"@@ -1079,1 +1079,1 @@\n-        return getString(offset, StandardCharsets.UTF_8);\n+        return getString(offset, sun.nio.cs.UTF_8.INSTANCE);\n@@ -1135,1 +1135,1 @@\n-        setString(offset, str, StandardCharsets.UTF_8);\n+        setString(offset, str, sun.nio.cs.UTF_8.INSTANCE);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/MemorySegment.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -93,1 +93,1 @@\n-        return allocateFrom(str, StandardCharsets.UTF_8);\n+        return allocateFrom(str, sun.nio.cs.UTF_8.INSTANCE);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/foreign\/SegmentAllocator.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -244,9 +244,8 @@\n-            if (charset == StandardCharsets.UTF_8 || charset == StandardCharsets.ISO_8859_1 || charset == StandardCharsets.US_ASCII) {\n-                return CharsetKind.SINGLE_BYTE;\n-            } else if (charset == StandardCharsets.UTF_16LE || charset == StandardCharsets.UTF_16BE || charset == StandardCharsets.UTF_16) {\n-                return CharsetKind.DOUBLE_BYTE;\n-            } else if (charset == StandardCharsets.UTF_32LE || charset == StandardCharsets.UTF_32BE || charset == StandardCharsets.UTF_32) {\n-                return CharsetKind.QUAD_BYTE;\n-            } else {\n-                throw new UnsupportedOperationException(\"Unsupported charset: \" + charset);\n-            }\n+            \/\/ Switching on the charset names rather than specific instances of\n+            \/\/ `Charset` avoids loading the class `StandardCharsets`\n+            return switch (charset.name()) {\n+                case \"UTF-8\", \"ISO8859_1\", \"US-ASCII\" -> CharsetKind.SINGLE_BYTE;\n+                case \"UTF-16LE\", \"UTF-16BE\", \"UTF-16\" -> CharsetKind.DOUBLE_BYTE;\n+                case \"UTF-32LE\", \"UTF-32BE\", \"UTF-32\" -> CharsetKind.QUAD_BYTE;\n+                default -> throw new UnsupportedOperationException(\"Unsupported charset: \" + charset);\n+            };\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/StringSupport.java","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"}]}