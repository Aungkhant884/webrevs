{"files":[{"patch":"@@ -157,0 +157,8 @@\n+<li><a href=\"#using-tensorflow-mac-os\">Using tensorflow (Mac OS)<\/a>\n+<ul>\n+<li><a href=\"#getting-libtensorflow\">getting libtensorflow<\/a><\/li>\n+<li><a href=\"#jextract-c_api.h\">jextract c_api.h<\/a><\/li>\n+<li><a href=\"#python-program-that-creates-and-saves-model\">Python program that creates and saves model<\/a><\/li>\n+<li><a href=\"#java-program-that-uses-tensorflow-c-api\">Java program that uses Tensorflow C API<\/a><\/li>\n+<li><a href=\"#compiling-and-running-the-java-tensorflow-sample\">Compiling and running the Java Tensorflow sample<\/a><\/li>\n+<\/ul><\/li>\n@@ -736,0 +744,107 @@\n+<h2 id=\"using-tensorflow-mac-os\">Using tensorflow (Mac OS)<\/h2>\n+<h3 id=\"getting-libtensorflow\">getting libtensorflow<\/h3>\n+<ul>\n+<li><p>Download tensorflow library from<\/p>\n+<p>https:\/\/www.tensorflow.org\/install\/lang_c<\/p><\/li>\n+<li><p>extract the downloaded tar in a directory called LIBTENSORFLOW_HOME<\/p><\/li>\n+<\/ul>\n+<h3 id=\"jextract-c_api.h\">jextract c_api.h<\/h3>\n+<div class=\"sourceCode\" id=\"cb36\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb36-1\"><a href=\"#cb36-1\"><\/a><\/span>\n+<span id=\"cb36-2\"><a href=\"#cb36-2\"><\/a><span class=\"ex\">jextract<\/span> --source \\<\/span>\n+<span id=\"cb36-3\"><a href=\"#cb36-3\"><\/a>  -I \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include\/ \\<\/span>\n+<span id=\"cb36-4\"><a href=\"#cb36-4\"><\/a>  -t org.tensorflow \\<\/span>\n+<span id=\"cb36-5\"><a href=\"#cb36-5\"><\/a>  -I <span class=\"va\">${LIBTENSORFLOW_HOME}<\/span>\/include \\<\/span>\n+<span id=\"cb36-6\"><a href=\"#cb36-6\"><\/a>  -l <span class=\"va\">${LIBTENSORFLOW_HOME}<\/span>\/lib\/libtensorflow.dylib \\<\/span>\n+<span id=\"cb36-7\"><a href=\"#cb36-7\"><\/a>  <span class=\"va\">${LIBTENSORFLOW_HOME}<\/span>\/include\/tensorflow\/c\/c_api.h<\/span>\n+<span id=\"cb36-8\"><a href=\"#cb36-8\"><\/a><\/span>\n+<span id=\"cb36-9\"><a href=\"#cb36-9\"><\/a><span class=\"ex\">javac<\/span> --add-modules jdk.incubator.foreign org\/tensorflow\/*.java<\/span><\/code><\/pre><\/div>\n+<h3 id=\"python-program-that-creates-and-saves-model\">Python program that creates and saves model<\/h3>\n+<p>The following Python program should be run to create and save model which will read and printed by a Java program.<\/p>\n+<p>Note: you need to install tensorflow package to run this python script.<\/p>\n+<div class=\"sourceCode\" id=\"cb37\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><span id=\"cb37-1\"><a href=\"#cb37-1\"><\/a><\/span>\n+<span id=\"cb37-2\"><a href=\"#cb37-2\"><\/a><span class=\"im\">import<\/span> tensorflow <span class=\"im\">as<\/span> tf<\/span>\n+<span id=\"cb37-3\"><a href=\"#cb37-3\"><\/a><span class=\"im\">from<\/span> tensorflow.keras <span class=\"im\">import<\/span> models, layers<\/span>\n+<span id=\"cb37-4\"><a href=\"#cb37-4\"><\/a><span class=\"im\">from<\/span> tensorflow.keras.datasets <span class=\"im\">import<\/span> mnist<\/span>\n+<span id=\"cb37-5\"><a href=\"#cb37-5\"><\/a><\/span>\n+<span id=\"cb37-6\"><a href=\"#cb37-6\"><\/a>model <span class=\"op\">=<\/span> tf.keras.models.Sequential([<\/span>\n+<span id=\"cb37-7\"><a href=\"#cb37-7\"><\/a>  tf.keras.layers.Flatten(input_shape<span class=\"op\">=<\/span>(<span class=\"dv\">28<\/span>, <span class=\"dv\">28<\/span>)),<\/span>\n+<span id=\"cb37-8\"><a href=\"#cb37-8\"><\/a>  tf.keras.layers.Dense(<span class=\"dv\">128<\/span>,activation<span class=\"op\">=<\/span><span class=\"st\">&#39;relu&#39;<\/span>),<\/span>\n+<span id=\"cb37-9\"><a href=\"#cb37-9\"><\/a>  tf.keras.layers.Dense(<span class=\"dv\">10<\/span>, activation<span class=\"op\">=<\/span><span class=\"st\">&#39;softmax&#39;<\/span>)<\/span>\n+<span id=\"cb37-10\"><a href=\"#cb37-10\"><\/a>])<\/span>\n+<span id=\"cb37-11\"><a href=\"#cb37-11\"><\/a><\/span>\n+<span id=\"cb37-12\"><a href=\"#cb37-12\"><\/a>model.<span class=\"bu\">compile<\/span>(<\/span>\n+<span id=\"cb37-13\"><a href=\"#cb37-13\"><\/a>    loss<span class=\"op\">=<\/span><span class=\"st\">&#39;sparse_categorical_crossentropy&#39;<\/span>,<\/span>\n+<span id=\"cb37-14\"><a href=\"#cb37-14\"><\/a>    optimizer<span class=\"op\">=<\/span>tf.keras.optimizers.Adam(<span class=\"fl\">0.001<\/span>),<\/span>\n+<span id=\"cb37-15\"><a href=\"#cb37-15\"><\/a>    metrics<span class=\"op\">=<\/span>[<span class=\"st\">&#39;accuracy&#39;<\/span>],<\/span>\n+<span id=\"cb37-16\"><a href=\"#cb37-16\"><\/a>)<\/span>\n+<span id=\"cb37-17\"><a href=\"#cb37-17\"><\/a><\/span>\n+<span id=\"cb37-18\"><a href=\"#cb37-18\"><\/a><span class=\"bu\">print<\/span>(model.summary())<\/span>\n+<span id=\"cb37-19\"><a href=\"#cb37-19\"><\/a><\/span>\n+<span id=\"cb37-20\"><a href=\"#cb37-20\"><\/a>(train_images, train_labels), (test_images, test_labels) <span class=\"op\">=<\/span> mnist.load_data()<\/span>\n+<span id=\"cb37-21\"><a href=\"#cb37-21\"><\/a><\/span>\n+<span id=\"cb37-22\"><a href=\"#cb37-22\"><\/a>train_images <span class=\"op\">=<\/span> train_images<span class=\"op\">\/<\/span><span class=\"fl\">255.0<\/span><\/span>\n+<span id=\"cb37-23\"><a href=\"#cb37-23\"><\/a>test_images <span class=\"op\">=<\/span> test_images<span class=\"op\">\/<\/span><span class=\"fl\">255.0<\/span><\/span>\n+<span id=\"cb37-24\"><a href=\"#cb37-24\"><\/a><\/span>\n+<span id=\"cb37-25\"><a href=\"#cb37-25\"><\/a>model.fit(train_images, train_labels,<\/span>\n+<span id=\"cb37-26\"><a href=\"#cb37-26\"><\/a>    epochs<span class=\"op\">=<\/span><span class=\"dv\">4<\/span>, batch_size<span class=\"op\">=<\/span><span class=\"dv\">128<\/span>, verbose<span class=\"op\">=<\/span><span class=\"dv\">1<\/span>)<\/span>\n+<span id=\"cb37-27\"><a href=\"#cb37-27\"><\/a><\/span>\n+<span id=\"cb37-28\"><a href=\"#cb37-28\"><\/a>test_loss, test_accuracy <span class=\"op\">=<\/span> model.evaluate(test_images, test_labels)<\/span>\n+<span id=\"cb37-29\"><a href=\"#cb37-29\"><\/a><\/span>\n+<span id=\"cb37-30\"><a href=\"#cb37-30\"><\/a><span class=\"bu\">print<\/span>(test_loss, test_accuracy)<\/span>\n+<span id=\"cb37-31\"><a href=\"#cb37-31\"><\/a><\/span>\n+<span id=\"cb37-32\"><a href=\"#cb37-32\"><\/a>model.save(<span class=\"st\">&quot;saved_mnist_model&quot;<\/span>)<\/span><\/code><\/pre><\/div>\n+<h3 id=\"java-program-that-uses-tensorflow-c-api\">Java program that uses Tensorflow C API<\/h3>\n+<div class=\"sourceCode\" id=\"cb38\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb38-1\"><a href=\"#cb38-1\"><\/a><\/span>\n+<span id=\"cb38-2\"><a href=\"#cb38-2\"><\/a><span class=\"kw\">import<\/span><span class=\"im\"> jdk.incubator.foreign.*;<\/span><\/span>\n+<span id=\"cb38-3\"><a href=\"#cb38-3\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.CSupport.*;<\/span><\/span>\n+<span id=\"cb38-4\"><a href=\"#cb38-4\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.MemoryAccess.*;<\/span><\/span>\n+<span id=\"cb38-5\"><a href=\"#cb38-5\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.MemoryAddress.*;<\/span><\/span>\n+<span id=\"cb38-6\"><a href=\"#cb38-6\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> org.tensorflow.c_api_h.*;<\/span><\/span>\n+<span id=\"cb38-7\"><a href=\"#cb38-7\"><\/a><\/span>\n+<span id=\"cb38-8\"><a href=\"#cb38-8\"><\/a><span class=\"co\">\/\/ simple program that loads saved model and prints basic info on operations in it<\/span><\/span>\n+<span id=\"cb38-9\"><a href=\"#cb38-9\"><\/a><\/span>\n+<span id=\"cb38-10\"><a href=\"#cb38-10\"><\/a><span class=\"kw\">public<\/span> <span class=\"kw\">class<\/span> TensorflowLoadSavedModel {<\/span>\n+<span id=\"cb38-11\"><a href=\"#cb38-11\"><\/a>    <span class=\"kw\">public<\/span> <span class=\"dt\">static<\/span> <span class=\"dt\">void<\/span> <span class=\"fu\">main<\/span>(<span class=\"bu\">String<\/span><span class=\"kw\">... <\/span>args) <span class=\"kw\">throws<\/span> <span class=\"bu\">Exception<\/span> {<\/span>\n+<span id=\"cb38-12\"><a href=\"#cb38-12\"><\/a>        <span class=\"bu\">System<\/span>.<span class=\"fu\">out<\/span>.<span class=\"fu\">println<\/span>(<span class=\"st\">&quot;TensorFlow C library version: &quot;<\/span> + <span class=\"fu\">toJavaStringRestricted<\/span>(<span class=\"fu\">TF_Version<\/span>()));<\/span>\n+<span id=\"cb38-13\"><a href=\"#cb38-13\"><\/a><\/span>\n+<span id=\"cb38-14\"><a href=\"#cb38-14\"><\/a>        <span class=\"kw\">if<\/span> (args.<span class=\"fu\">length<\/span> == <span class=\"dv\">0<\/span>) {<\/span>\n+<span id=\"cb38-15\"><a href=\"#cb38-15\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">err<\/span>.<span class=\"fu\">println<\/span>(<span class=\"st\">&quot;java TensorflowLoadSavedModel &lt;saved model dir&gt;&quot;<\/span>);<\/span>\n+<span id=\"cb38-16\"><a href=\"#cb38-16\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">exit<\/span>(<span class=\"dv\">1<\/span>);<\/span>\n+<span id=\"cb38-17\"><a href=\"#cb38-17\"><\/a>        }<\/span>\n+<span id=\"cb38-18\"><a href=\"#cb38-18\"><\/a><\/span>\n+<span id=\"cb38-19\"><a href=\"#cb38-19\"><\/a>        <span class=\"kw\">try<\/span> (var scope = NativeScope.<span class=\"fu\">unboundedScope<\/span>()) {<\/span>\n+<span id=\"cb38-20\"><a href=\"#cb38-20\"><\/a>            var graph = <span class=\"fu\">TF_NewGraph<\/span>();<\/span>\n+<span id=\"cb38-21\"><a href=\"#cb38-21\"><\/a>            var status = <span class=\"fu\">TF_NewStatus<\/span>();<\/span>\n+<span id=\"cb38-22\"><a href=\"#cb38-22\"><\/a>            var sessionOpts = <span class=\"fu\">TF_NewSessionOptions<\/span>();<\/span>\n+<span id=\"cb38-23\"><a href=\"#cb38-23\"><\/a><\/span>\n+<span id=\"cb38-24\"><a href=\"#cb38-24\"><\/a>            var savedModelDir = <span class=\"fu\">toCString<\/span>(args[<span class=\"dv\">0<\/span>], scope);<\/span>\n+<span id=\"cb38-25\"><a href=\"#cb38-25\"><\/a>            var tags = scope.<span class=\"fu\">allocate<\/span>(C_POINTER, <span class=\"fu\">toCString<\/span>(<span class=\"st\">&quot;serve&quot;<\/span>, scope));<\/span>\n+<span id=\"cb38-26\"><a href=\"#cb38-26\"><\/a>            var session = <span class=\"fu\">TF_LoadSessionFromSavedModel<\/span>(sessionOpts, NULL, savedModelDir, tags, <span class=\"dv\">1<\/span>, graph, NULL, status);<\/span>\n+<span id=\"cb38-27\"><a href=\"#cb38-27\"><\/a><\/span>\n+<span id=\"cb38-28\"><a href=\"#cb38-28\"><\/a>            <span class=\"kw\">if<\/span> (<span class=\"fu\">TF_GetCode<\/span>(status) != <span class=\"fu\">TF_OK<\/span>()) {<\/span>\n+<span id=\"cb38-29\"><a href=\"#cb38-29\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">err.printf<\/span>(<span class=\"st\">&quot;cannot load session from saved model: <\/span><span class=\"sc\">%s\\n<\/span><span class=\"st\">&quot;<\/span>,<\/span>\n+<span id=\"cb38-30\"><a href=\"#cb38-30\"><\/a>                    <span class=\"fu\">toJavaStringRestricted<\/span>(<span class=\"fu\">TF_Message<\/span>(status)));<\/span>\n+<span id=\"cb38-31\"><a href=\"#cb38-31\"><\/a>            } <span class=\"kw\">else<\/span> {<\/span>\n+<span id=\"cb38-32\"><a href=\"#cb38-32\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">err<\/span>.<span class=\"fu\">println<\/span>(<span class=\"st\">&quot;load session from saved model works!&quot;<\/span>);<\/span>\n+<span id=\"cb38-33\"><a href=\"#cb38-33\"><\/a>            }<\/span>\n+<span id=\"cb38-34\"><a href=\"#cb38-34\"><\/a><\/span>\n+<span id=\"cb38-35\"><a href=\"#cb38-35\"><\/a>            <span class=\"co\">\/\/ print operations<\/span><\/span>\n+<span id=\"cb38-36\"><a href=\"#cb38-36\"><\/a>            var size = scope.<span class=\"fu\">allocate<\/span>(C_LONGLONG);<\/span>\n+<span id=\"cb38-37\"><a href=\"#cb38-37\"><\/a>            var operation = NULL;<\/span>\n+<span id=\"cb38-38\"><a href=\"#cb38-38\"><\/a>            <span class=\"kw\">while<\/span> (!(operation = <span class=\"fu\">TF_GraphNextOperation<\/span>(graph, size)).<span class=\"fu\">equals<\/span>(NULL)) {<\/span>\n+<span id=\"cb38-39\"><a href=\"#cb38-39\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">out.printf<\/span>(<span class=\"st\">&quot;<\/span><span class=\"sc\">%s<\/span><span class=\"st\"> : <\/span><span class=\"sc\">%s\\n<\/span><span class=\"st\">&quot;<\/span>,<\/span>\n+<span id=\"cb38-40\"><a href=\"#cb38-40\"><\/a>                    <span class=\"fu\">toJavaStringRestricted<\/span>(<span class=\"fu\">TF_OperationName<\/span>(operation)),<\/span>\n+<span id=\"cb38-41\"><a href=\"#cb38-41\"><\/a>                    <span class=\"fu\">toJavaStringRestricted<\/span>(<span class=\"fu\">TF_OperationOpType<\/span>(operation)));<\/span>\n+<span id=\"cb38-42\"><a href=\"#cb38-42\"><\/a>            }<\/span>\n+<span id=\"cb38-43\"><a href=\"#cb38-43\"><\/a><\/span>\n+<span id=\"cb38-44\"><a href=\"#cb38-44\"><\/a>            <span class=\"fu\">TF_DeleteGraph<\/span>(graph);<\/span>\n+<span id=\"cb38-45\"><a href=\"#cb38-45\"><\/a>            <span class=\"fu\">TF_DeleteSession<\/span>(session, status);<\/span>\n+<span id=\"cb38-46\"><a href=\"#cb38-46\"><\/a>            <span class=\"fu\">TF_DeleteSessionOptions<\/span>(sessionOpts);<\/span>\n+<span id=\"cb38-47\"><a href=\"#cb38-47\"><\/a>            <span class=\"fu\">TF_DeleteStatus<\/span>(status);<\/span>\n+<span id=\"cb38-48\"><a href=\"#cb38-48\"><\/a>        }<\/span>\n+<span id=\"cb38-49\"><a href=\"#cb38-49\"><\/a>    }<\/span>\n+<span id=\"cb38-50\"><a href=\"#cb38-50\"><\/a>}<\/span><\/code><\/pre><\/div>\n+<h3 id=\"compiling-and-running-the-java-tensorflow-sample\">Compiling and running the Java Tensorflow sample<\/h3>\n+<div class=\"sourceCode\" id=\"cb39\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb39-1\"><a href=\"#cb39-1\"><\/a><\/span>\n+<span id=\"cb39-2\"><a href=\"#cb39-2\"><\/a><span class=\"ex\">java<\/span> -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \\<\/span>\n+<span id=\"cb39-3\"><a href=\"#cb39-3\"><\/a>   TensorflowLoadSavedModel.java saved_mnist_model<\/span><\/code><\/pre><\/div>\n@@ -738,4 +853,4 @@\n-<div class=\"sourceCode\" id=\"cb36\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb36-1\"><a href=\"#cb36-1\"><\/a><\/span>\n-<span id=\"cb36-2\"><a href=\"#cb36-2\"><\/a><span class=\"ex\">jextract<\/span> -t org.unix \\<\/span>\n-<span id=\"cb36-3\"><a href=\"#cb36-3\"><\/a>  -I \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include \\<\/span>\n-<span id=\"cb36-4\"><a href=\"#cb36-4\"><\/a>   \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include\/time.h<\/span><\/code><\/pre><\/div>\n+<div class=\"sourceCode\" id=\"cb40\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb40-1\"><a href=\"#cb40-1\"><\/a><\/span>\n+<span id=\"cb40-2\"><a href=\"#cb40-2\"><\/a><span class=\"ex\">jextract<\/span> -t org.unix \\<\/span>\n+<span id=\"cb40-3\"><a href=\"#cb40-3\"><\/a>  -I \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include \\<\/span>\n+<span id=\"cb40-4\"><a href=\"#cb40-4\"><\/a>   \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include\/time.h<\/span><\/code><\/pre><\/div>\n@@ -743,15 +858,15 @@\n-<div class=\"sourceCode\" id=\"cb37\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb37-1\"><a href=\"#cb37-1\"><\/a><\/span>\n-<span id=\"cb37-2\"><a href=\"#cb37-2\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> org.unix.time_h.*;<\/span><\/span>\n-<span id=\"cb37-3\"><a href=\"#cb37-3\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.CSupport.*;<\/span><\/span>\n-<span id=\"cb37-4\"><a href=\"#cb37-4\"><\/a><span class=\"kw\">import<\/span><span class=\"im\"> jdk.incubator.foreign.*;<\/span><\/span>\n-<span id=\"cb37-5\"><a href=\"#cb37-5\"><\/a><\/span>\n-<span id=\"cb37-6\"><a href=\"#cb37-6\"><\/a><span class=\"kw\">public<\/span> <span class=\"kw\">class<\/span> PanamaTime {<\/span>\n-<span id=\"cb37-7\"><a href=\"#cb37-7\"><\/a>    <span class=\"kw\">public<\/span> <span class=\"dt\">static<\/span> <span class=\"dt\">void<\/span> <span class=\"fu\">main<\/span>(<span class=\"bu\">String<\/span>[] args) {<\/span>\n-<span id=\"cb37-8\"><a href=\"#cb37-8\"><\/a>        <span class=\"kw\">try<\/span> (NativeScope scope = NativeScope.<span class=\"fu\">unboundedScope<\/span>()) {<\/span>\n-<span id=\"cb37-9\"><a href=\"#cb37-9\"><\/a>            var now = scope.<span class=\"fu\">allocate<\/span>(C_LONG, <span class=\"bu\">System<\/span>.<span class=\"fu\">currentTimeMillis<\/span>() \/ <span class=\"dv\">1000<\/span>);<\/span>\n-<span id=\"cb37-10\"><a href=\"#cb37-10\"><\/a>            MemorySegment time = tm.<span class=\"fu\">allocate<\/span>(scope);<\/span>\n-<span id=\"cb37-11\"><a href=\"#cb37-11\"><\/a>            <span class=\"fu\">localtime_r<\/span>(now, time);<\/span>\n-<span id=\"cb37-12\"><a href=\"#cb37-12\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">err.printf<\/span>(<span class=\"st\">&quot;Time = <\/span><span class=\"sc\">%d<\/span><span class=\"st\">:<\/span><span class=\"sc\">%d\\n<\/span><span class=\"st\">&quot;<\/span>, tm.<span class=\"fu\">tm_hour<\/span>$<span class=\"fu\">get<\/span>(time), tm.<span class=\"fu\">tm_min<\/span>$<span class=\"fu\">get<\/span>(time));<\/span>\n-<span id=\"cb37-13\"><a href=\"#cb37-13\"><\/a>        }<\/span>\n-<span id=\"cb37-14\"><a href=\"#cb37-14\"><\/a>    }<\/span>\n-<span id=\"cb37-15\"><a href=\"#cb37-15\"><\/a>}<\/span><\/code><\/pre><\/div>\n+<div class=\"sourceCode\" id=\"cb41\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb41-1\"><a href=\"#cb41-1\"><\/a><\/span>\n+<span id=\"cb41-2\"><a href=\"#cb41-2\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> org.unix.time_h.*;<\/span><\/span>\n+<span id=\"cb41-3\"><a href=\"#cb41-3\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.CSupport.*;<\/span><\/span>\n+<span id=\"cb41-4\"><a href=\"#cb41-4\"><\/a><span class=\"kw\">import<\/span><span class=\"im\"> jdk.incubator.foreign.*;<\/span><\/span>\n+<span id=\"cb41-5\"><a href=\"#cb41-5\"><\/a><\/span>\n+<span id=\"cb41-6\"><a href=\"#cb41-6\"><\/a><span class=\"kw\">public<\/span> <span class=\"kw\">class<\/span> PanamaTime {<\/span>\n+<span id=\"cb41-7\"><a href=\"#cb41-7\"><\/a>    <span class=\"kw\">public<\/span> <span class=\"dt\">static<\/span> <span class=\"dt\">void<\/span> <span class=\"fu\">main<\/span>(<span class=\"bu\">String<\/span>[] args) {<\/span>\n+<span id=\"cb41-8\"><a href=\"#cb41-8\"><\/a>        <span class=\"kw\">try<\/span> (NativeScope scope = NativeScope.<span class=\"fu\">unboundedScope<\/span>()) {<\/span>\n+<span id=\"cb41-9\"><a href=\"#cb41-9\"><\/a>            var now = scope.<span class=\"fu\">allocate<\/span>(C_LONG, <span class=\"bu\">System<\/span>.<span class=\"fu\">currentTimeMillis<\/span>() \/ <span class=\"dv\">1000<\/span>);<\/span>\n+<span id=\"cb41-10\"><a href=\"#cb41-10\"><\/a>            MemorySegment time = tm.<span class=\"fu\">allocate<\/span>(scope);<\/span>\n+<span id=\"cb41-11\"><a href=\"#cb41-11\"><\/a>            <span class=\"fu\">localtime_r<\/span>(now, time);<\/span>\n+<span id=\"cb41-12\"><a href=\"#cb41-12\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">err.printf<\/span>(<span class=\"st\">&quot;Time = <\/span><span class=\"sc\">%d<\/span><span class=\"st\">:<\/span><span class=\"sc\">%d\\n<\/span><span class=\"st\">&quot;<\/span>, tm.<span class=\"fu\">tm_hour<\/span>$<span class=\"fu\">get<\/span>(time), tm.<span class=\"fu\">tm_min<\/span>$<span class=\"fu\">get<\/span>(time));<\/span>\n+<span id=\"cb41-13\"><a href=\"#cb41-13\"><\/a>        }<\/span>\n+<span id=\"cb41-14\"><a href=\"#cb41-14\"><\/a>    }<\/span>\n+<span id=\"cb41-15\"><a href=\"#cb41-15\"><\/a>}<\/span><\/code><\/pre><\/div>\n@@ -759,2 +874,2 @@\n-<div class=\"sourceCode\" id=\"cb38\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb38-1\"><a href=\"#cb38-1\"><\/a><\/span>\n-<span id=\"cb38-2\"><a href=\"#cb38-2\"><\/a><span class=\"ex\">java<\/span> -Dforeign.restricted=permit --add-modules jdk.incubator.foreign PanamaTime.java<\/span><\/code><\/pre><\/div>\n+<div class=\"sourceCode\" id=\"cb42\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb42-1\"><a href=\"#cb42-1\"><\/a><\/span>\n+<span id=\"cb42-2\"><a href=\"#cb42-2\"><\/a><span class=\"ex\">java<\/span> -Dforeign.restricted=permit --add-modules jdk.incubator.foreign PanamaTime.java<\/span><\/code><\/pre><\/div>\n@@ -763,9 +878,9 @@\n-<div class=\"sourceCode\" id=\"cb39\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb39-1\"><a href=\"#cb39-1\"><\/a><\/span>\n-<span id=\"cb39-2\"><a href=\"#cb39-2\"><\/a><span class=\"co\"># LIBCLANG_HOME is the directory where you&#39;ve installed llvm 9.x or above<\/span><\/span>\n-<span id=\"cb39-3\"><a href=\"#cb39-3\"><\/a><\/span>\n-<span id=\"cb39-4\"><a href=\"#cb39-4\"><\/a><span class=\"ex\">jextract<\/span> --source -t org.llvm.clang -lclang \\<\/span>\n-<span id=\"cb39-5\"><a href=\"#cb39-5\"><\/a>  -I \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include\/ \\<\/span>\n-<span id=\"cb39-6\"><a href=\"#cb39-6\"><\/a>  -I <span class=\"va\">${LIBCLANG_HOME}<\/span>\/include\/ \\<\/span>\n-<span id=\"cb39-7\"><a href=\"#cb39-7\"><\/a>  -I <span class=\"va\">${LIBCLANG_HOME}<\/span>\/include\/clang-c \\<\/span>\n-<span id=\"cb39-8\"><a href=\"#cb39-8\"><\/a>  <span class=\"va\">${LIBCLANG_HOME}<\/span>\/include\/clang-c\/Index.h<\/span>\n-<span id=\"cb39-9\"><a href=\"#cb39-9\"><\/a><span class=\"ex\">javac<\/span> --add-modules jdk.incubator.foreign org\/llvm\/clang\/*.java<\/span><\/code><\/pre><\/div>\n+<div class=\"sourceCode\" id=\"cb43\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb43-1\"><a href=\"#cb43-1\"><\/a><\/span>\n+<span id=\"cb43-2\"><a href=\"#cb43-2\"><\/a><span class=\"co\"># LIBCLANG_HOME is the directory where you&#39;ve installed llvm 9.x or above<\/span><\/span>\n+<span id=\"cb43-3\"><a href=\"#cb43-3\"><\/a><\/span>\n+<span id=\"cb43-4\"><a href=\"#cb43-4\"><\/a><span class=\"ex\">jextract<\/span> --source -t org.llvm.clang -lclang \\<\/span>\n+<span id=\"cb43-5\"><a href=\"#cb43-5\"><\/a>  -I \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include\/ \\<\/span>\n+<span id=\"cb43-6\"><a href=\"#cb43-6\"><\/a>  -I <span class=\"va\">${LIBCLANG_HOME}<\/span>\/include\/ \\<\/span>\n+<span id=\"cb43-7\"><a href=\"#cb43-7\"><\/a>  -I <span class=\"va\">${LIBCLANG_HOME}<\/span>\/include\/clang-c \\<\/span>\n+<span id=\"cb43-8\"><a href=\"#cb43-8\"><\/a>  <span class=\"va\">${LIBCLANG_HOME}<\/span>\/include\/clang-c\/Index.h<\/span>\n+<span id=\"cb43-9\"><a href=\"#cb43-9\"><\/a><span class=\"ex\">javac<\/span> --add-modules jdk.incubator.foreign org\/llvm\/clang\/*.java<\/span><\/code><\/pre><\/div>\n@@ -773,58 +888,58 @@\n-<div class=\"sourceCode\" id=\"cb40\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb40-1\"><a href=\"#cb40-1\"><\/a><\/span>\n-<span id=\"cb40-2\"><a href=\"#cb40-2\"><\/a><span class=\"kw\">import<\/span><span class=\"im\"> jdk.incubator.foreign.*;<\/span><\/span>\n-<span id=\"cb40-3\"><a href=\"#cb40-3\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.CSupport.*;<\/span><\/span>\n-<span id=\"cb40-4\"><a href=\"#cb40-4\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.MemoryAddress.NULL;<\/span><\/span>\n-<span id=\"cb40-5\"><a href=\"#cb40-5\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> org.llvm.clang.Index_h.*;<\/span><\/span>\n-<span id=\"cb40-6\"><a href=\"#cb40-6\"><\/a><\/span>\n-<span id=\"cb40-7\"><a href=\"#cb40-7\"><\/a><span class=\"kw\">public<\/span> <span class=\"kw\">class<\/span> ASTPrinter {<\/span>\n-<span id=\"cb40-8\"><a href=\"#cb40-8\"><\/a>    <span class=\"kw\">private<\/span> <span class=\"dt\">static<\/span> <span class=\"bu\">String<\/span> <span class=\"fu\">asJavaString<\/span>(MemorySegment clangStr) {<\/span>\n-<span id=\"cb40-9\"><a href=\"#cb40-9\"><\/a>        <span class=\"bu\">String<\/span> str = <span class=\"fu\">toJavaStringRestricted<\/span>(<span class=\"fu\">clang_getCString<\/span>(clangStr));<\/span>\n-<span id=\"cb40-10\"><a href=\"#cb40-10\"><\/a>        <span class=\"fu\">clang_disposeString<\/span>(clangStr);<\/span>\n-<span id=\"cb40-11\"><a href=\"#cb40-11\"><\/a>        <span class=\"kw\">return<\/span> str;<\/span>\n-<span id=\"cb40-12\"><a href=\"#cb40-12\"><\/a>    }<\/span>\n-<span id=\"cb40-13\"><a href=\"#cb40-13\"><\/a><\/span>\n-<span id=\"cb40-14\"><a href=\"#cb40-14\"><\/a>    <span class=\"kw\">public<\/span> <span class=\"dt\">static<\/span> <span class=\"dt\">void<\/span> <span class=\"fu\">main<\/span>(<span class=\"bu\">String<\/span>[] args) {<\/span>\n-<span id=\"cb40-15\"><a href=\"#cb40-15\"><\/a>        <span class=\"kw\">if<\/span> (args.<span class=\"fu\">length<\/span> == <span class=\"dv\">0<\/span>) {<\/span>\n-<span id=\"cb40-16\"><a href=\"#cb40-16\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">err<\/span>.<span class=\"fu\">println<\/span>(<span class=\"st\">&quot;java ASTPrinter &lt;C source or header&gt;&quot;<\/span>);<\/span>\n-<span id=\"cb40-17\"><a href=\"#cb40-17\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">exit<\/span>(<span class=\"dv\">1<\/span>);<\/span>\n-<span id=\"cb40-18\"><a href=\"#cb40-18\"><\/a>        }<\/span>\n-<span id=\"cb40-19\"><a href=\"#cb40-19\"><\/a><\/span>\n-<span id=\"cb40-20\"><a href=\"#cb40-20\"><\/a>        <span class=\"kw\">try<\/span> (var scope = NativeScope.<span class=\"fu\">unboundedScope<\/span>()) {<\/span>\n-<span id=\"cb40-21\"><a href=\"#cb40-21\"><\/a>            <span class=\"co\">\/\/ parse the C header\/source passed from the command line<\/span><\/span>\n-<span id=\"cb40-22\"><a href=\"#cb40-22\"><\/a>            var index = <span class=\"fu\">clang_createIndex<\/span>(<span class=\"dv\">0<\/span>, <span class=\"dv\">0<\/span>);<\/span>\n-<span id=\"cb40-23\"><a href=\"#cb40-23\"><\/a>            var tu = <span class=\"fu\">clang_parseTranslationUnit<\/span>(index, <span class=\"fu\">toCString<\/span>(args[<span class=\"dv\">0<\/span>], scope),<\/span>\n-<span id=\"cb40-24\"><a href=\"#cb40-24\"><\/a>                    NULL, <span class=\"dv\">0<\/span>, NULL, <span class=\"dv\">0<\/span>, <span class=\"fu\">CXTranslationUnit_None<\/span>());<\/span>\n-<span id=\"cb40-25\"><a href=\"#cb40-25\"><\/a>            <span class=\"co\">\/\/ array trick to update within lambda<\/span><\/span>\n-<span id=\"cb40-26\"><a href=\"#cb40-26\"><\/a>            var level = <span class=\"kw\">new<\/span> <span class=\"dt\">int<\/span>[<span class=\"dv\">1<\/span>];<\/span>\n-<span id=\"cb40-27\"><a href=\"#cb40-27\"><\/a>            var visitor = <span class=\"kw\">new<\/span> MemorySegment[<span class=\"dv\">1<\/span>];<\/span>\n-<span id=\"cb40-28\"><a href=\"#cb40-28\"><\/a><\/span>\n-<span id=\"cb40-29\"><a href=\"#cb40-29\"><\/a>            <span class=\"co\">\/\/ clang Cursor visitor callback<\/span><\/span>\n-<span id=\"cb40-30\"><a href=\"#cb40-30\"><\/a>            visitor[<span class=\"dv\">0<\/span>] = clang_visitChildren$visitor.<span class=\"fu\">allocate<\/span>((cursor, parent, data) -&gt; {<\/span>\n-<span id=\"cb40-31\"><a href=\"#cb40-31\"><\/a>                var kind = <span class=\"fu\">clang_getCursorKind<\/span>(cursor);<\/span>\n-<span id=\"cb40-32\"><a href=\"#cb40-32\"><\/a>                var name = <span class=\"fu\">asJavaString<\/span>(<span class=\"fu\">clang_getCursorSpelling<\/span>(cursor));<\/span>\n-<span id=\"cb40-33\"><a href=\"#cb40-33\"><\/a>                var kindName = <span class=\"fu\">asJavaString<\/span>(<span class=\"fu\">clang_getCursorKindSpelling<\/span>(kind));<\/span>\n-<span id=\"cb40-34\"><a href=\"#cb40-34\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">out.printf<\/span>(<span class=\"st\">&quot;<\/span><span class=\"sc\">%s<\/span><span class=\"st\"> <\/span><span class=\"sc\">%s<\/span><span class=\"st\"> <\/span><span class=\"sc\">%s<\/span><span class=\"st\">&quot;<\/span>, <span class=\"st\">&quot; &quot;<\/span>.<span class=\"fu\">repeat<\/span>(level[<span class=\"dv\">0<\/span>]), kindName, name);<\/span>\n-<span id=\"cb40-35\"><a href=\"#cb40-35\"><\/a>                var type = <span class=\"fu\">clang_getCursorType<\/span>(cursor);<\/span>\n-<span id=\"cb40-36\"><a href=\"#cb40-36\"><\/a>                <span class=\"kw\">if<\/span> (CXType.<span class=\"fu\">kind<\/span>$<span class=\"fu\">get<\/span>(type) != <span class=\"fu\">CXType_Invalid<\/span>()) {<\/span>\n-<span id=\"cb40-37\"><a href=\"#cb40-37\"><\/a>                    var typeName = <span class=\"fu\">asJavaString<\/span>(<span class=\"fu\">clang_getTypeSpelling<\/span>(type));<\/span>\n-<span id=\"cb40-38\"><a href=\"#cb40-38\"><\/a>                    <span class=\"bu\">System<\/span>.<span class=\"fu\">out.printf<\/span>(<span class=\"st\">&quot; &lt;<\/span><span class=\"sc\">%s<\/span><span class=\"st\">&gt;&quot;<\/span>, typeName);<\/span>\n-<span id=\"cb40-39\"><a href=\"#cb40-39\"><\/a>                }<\/span>\n-<span id=\"cb40-40\"><a href=\"#cb40-40\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">out<\/span>.<span class=\"fu\">println<\/span>();<\/span>\n-<span id=\"cb40-41\"><a href=\"#cb40-41\"><\/a><\/span>\n-<span id=\"cb40-42\"><a href=\"#cb40-42\"><\/a>                <span class=\"co\">\/\/ visit children<\/span><\/span>\n-<span id=\"cb40-43\"><a href=\"#cb40-43\"><\/a>                level[<span class=\"dv\">0<\/span>]++;<\/span>\n-<span id=\"cb40-44\"><a href=\"#cb40-44\"><\/a>                <span class=\"fu\">clang_visitChildren<\/span>(cursor, visitor[<span class=\"dv\">0<\/span>], NULL);<\/span>\n-<span id=\"cb40-45\"><a href=\"#cb40-45\"><\/a>                level[<span class=\"dv\">0<\/span>]--;<\/span>\n-<span id=\"cb40-46\"><a href=\"#cb40-46\"><\/a><\/span>\n-<span id=\"cb40-47\"><a href=\"#cb40-47\"><\/a>                <span class=\"kw\">return<\/span> <span class=\"fu\">CXChildVisit_Continue<\/span>();<\/span>\n-<span id=\"cb40-48\"><a href=\"#cb40-48\"><\/a>            });<\/span>\n-<span id=\"cb40-49\"><a href=\"#cb40-49\"><\/a><\/span>\n-<span id=\"cb40-50\"><a href=\"#cb40-50\"><\/a>            <span class=\"co\">\/\/ get the AST root and visit it<\/span><\/span>\n-<span id=\"cb40-51\"><a href=\"#cb40-51\"><\/a>            var root = <span class=\"fu\">clang_getTranslationUnitCursor<\/span>(tu);<\/span>\n-<span id=\"cb40-52\"><a href=\"#cb40-52\"><\/a>            <span class=\"fu\">clang_visitChildren<\/span>(root, visitor[<span class=\"dv\">0<\/span>], NULL);<\/span>\n-<span id=\"cb40-53\"><a href=\"#cb40-53\"><\/a><\/span>\n-<span id=\"cb40-54\"><a href=\"#cb40-54\"><\/a>            <span class=\"fu\">clang_disposeTranslationUnit<\/span>(tu);<\/span>\n-<span id=\"cb40-55\"><a href=\"#cb40-55\"><\/a>            <span class=\"fu\">clang_disposeIndex<\/span>(index);<\/span>\n-<span id=\"cb40-56\"><a href=\"#cb40-56\"><\/a>        }<\/span>\n-<span id=\"cb40-57\"><a href=\"#cb40-57\"><\/a>    }<\/span>\n-<span id=\"cb40-58\"><a href=\"#cb40-58\"><\/a>}<\/span><\/code><\/pre><\/div>\n+<div class=\"sourceCode\" id=\"cb44\"><pre class=\"sourceCode java\"><code class=\"sourceCode java\"><span id=\"cb44-1\"><a href=\"#cb44-1\"><\/a><\/span>\n+<span id=\"cb44-2\"><a href=\"#cb44-2\"><\/a><span class=\"kw\">import<\/span><span class=\"im\"> jdk.incubator.foreign.*;<\/span><\/span>\n+<span id=\"cb44-3\"><a href=\"#cb44-3\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.CSupport.*;<\/span><\/span>\n+<span id=\"cb44-4\"><a href=\"#cb44-4\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> jdk.incubator.foreign.MemoryAddress.NULL;<\/span><\/span>\n+<span id=\"cb44-5\"><a href=\"#cb44-5\"><\/a><span class=\"kw\">import static<\/span><span class=\"im\"> org.llvm.clang.Index_h.*;<\/span><\/span>\n+<span id=\"cb44-6\"><a href=\"#cb44-6\"><\/a><\/span>\n+<span id=\"cb44-7\"><a href=\"#cb44-7\"><\/a><span class=\"kw\">public<\/span> <span class=\"kw\">class<\/span> ASTPrinter {<\/span>\n+<span id=\"cb44-8\"><a href=\"#cb44-8\"><\/a>    <span class=\"kw\">private<\/span> <span class=\"dt\">static<\/span> <span class=\"bu\">String<\/span> <span class=\"fu\">asJavaString<\/span>(MemorySegment clangStr) {<\/span>\n+<span id=\"cb44-9\"><a href=\"#cb44-9\"><\/a>        <span class=\"bu\">String<\/span> str = <span class=\"fu\">toJavaStringRestricted<\/span>(<span class=\"fu\">clang_getCString<\/span>(clangStr));<\/span>\n+<span id=\"cb44-10\"><a href=\"#cb44-10\"><\/a>        <span class=\"fu\">clang_disposeString<\/span>(clangStr);<\/span>\n+<span id=\"cb44-11\"><a href=\"#cb44-11\"><\/a>        <span class=\"kw\">return<\/span> str;<\/span>\n+<span id=\"cb44-12\"><a href=\"#cb44-12\"><\/a>    }<\/span>\n+<span id=\"cb44-13\"><a href=\"#cb44-13\"><\/a><\/span>\n+<span id=\"cb44-14\"><a href=\"#cb44-14\"><\/a>    <span class=\"kw\">public<\/span> <span class=\"dt\">static<\/span> <span class=\"dt\">void<\/span> <span class=\"fu\">main<\/span>(<span class=\"bu\">String<\/span>[] args) {<\/span>\n+<span id=\"cb44-15\"><a href=\"#cb44-15\"><\/a>        <span class=\"kw\">if<\/span> (args.<span class=\"fu\">length<\/span> == <span class=\"dv\">0<\/span>) {<\/span>\n+<span id=\"cb44-16\"><a href=\"#cb44-16\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">err<\/span>.<span class=\"fu\">println<\/span>(<span class=\"st\">&quot;java ASTPrinter &lt;C source or header&gt;&quot;<\/span>);<\/span>\n+<span id=\"cb44-17\"><a href=\"#cb44-17\"><\/a>            <span class=\"bu\">System<\/span>.<span class=\"fu\">exit<\/span>(<span class=\"dv\">1<\/span>);<\/span>\n+<span id=\"cb44-18\"><a href=\"#cb44-18\"><\/a>        }<\/span>\n+<span id=\"cb44-19\"><a href=\"#cb44-19\"><\/a><\/span>\n+<span id=\"cb44-20\"><a href=\"#cb44-20\"><\/a>        <span class=\"kw\">try<\/span> (var scope = NativeScope.<span class=\"fu\">unboundedScope<\/span>()) {<\/span>\n+<span id=\"cb44-21\"><a href=\"#cb44-21\"><\/a>            <span class=\"co\">\/\/ parse the C header\/source passed from the command line<\/span><\/span>\n+<span id=\"cb44-22\"><a href=\"#cb44-22\"><\/a>            var index = <span class=\"fu\">clang_createIndex<\/span>(<span class=\"dv\">0<\/span>, <span class=\"dv\">0<\/span>);<\/span>\n+<span id=\"cb44-23\"><a href=\"#cb44-23\"><\/a>            var tu = <span class=\"fu\">clang_parseTranslationUnit<\/span>(index, <span class=\"fu\">toCString<\/span>(args[<span class=\"dv\">0<\/span>], scope),<\/span>\n+<span id=\"cb44-24\"><a href=\"#cb44-24\"><\/a>                    NULL, <span class=\"dv\">0<\/span>, NULL, <span class=\"dv\">0<\/span>, <span class=\"fu\">CXTranslationUnit_None<\/span>());<\/span>\n+<span id=\"cb44-25\"><a href=\"#cb44-25\"><\/a>            <span class=\"co\">\/\/ array trick to update within lambda<\/span><\/span>\n+<span id=\"cb44-26\"><a href=\"#cb44-26\"><\/a>            var level = <span class=\"kw\">new<\/span> <span class=\"dt\">int<\/span>[<span class=\"dv\">1<\/span>];<\/span>\n+<span id=\"cb44-27\"><a href=\"#cb44-27\"><\/a>            var visitor = <span class=\"kw\">new<\/span> MemorySegment[<span class=\"dv\">1<\/span>];<\/span>\n+<span id=\"cb44-28\"><a href=\"#cb44-28\"><\/a><\/span>\n+<span id=\"cb44-29\"><a href=\"#cb44-29\"><\/a>            <span class=\"co\">\/\/ clang Cursor visitor callback<\/span><\/span>\n+<span id=\"cb44-30\"><a href=\"#cb44-30\"><\/a>            visitor[<span class=\"dv\">0<\/span>] = clang_visitChildren$visitor.<span class=\"fu\">allocate<\/span>((cursor, parent, data) -&gt; {<\/span>\n+<span id=\"cb44-31\"><a href=\"#cb44-31\"><\/a>                var kind = <span class=\"fu\">clang_getCursorKind<\/span>(cursor);<\/span>\n+<span id=\"cb44-32\"><a href=\"#cb44-32\"><\/a>                var name = <span class=\"fu\">asJavaString<\/span>(<span class=\"fu\">clang_getCursorSpelling<\/span>(cursor));<\/span>\n+<span id=\"cb44-33\"><a href=\"#cb44-33\"><\/a>                var kindName = <span class=\"fu\">asJavaString<\/span>(<span class=\"fu\">clang_getCursorKindSpelling<\/span>(kind));<\/span>\n+<span id=\"cb44-34\"><a href=\"#cb44-34\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">out.printf<\/span>(<span class=\"st\">&quot;<\/span><span class=\"sc\">%s<\/span><span class=\"st\"> <\/span><span class=\"sc\">%s<\/span><span class=\"st\"> <\/span><span class=\"sc\">%s<\/span><span class=\"st\">&quot;<\/span>, <span class=\"st\">&quot; &quot;<\/span>.<span class=\"fu\">repeat<\/span>(level[<span class=\"dv\">0<\/span>]), kindName, name);<\/span>\n+<span id=\"cb44-35\"><a href=\"#cb44-35\"><\/a>                var type = <span class=\"fu\">clang_getCursorType<\/span>(cursor);<\/span>\n+<span id=\"cb44-36\"><a href=\"#cb44-36\"><\/a>                <span class=\"kw\">if<\/span> (CXType.<span class=\"fu\">kind<\/span>$<span class=\"fu\">get<\/span>(type) != <span class=\"fu\">CXType_Invalid<\/span>()) {<\/span>\n+<span id=\"cb44-37\"><a href=\"#cb44-37\"><\/a>                    var typeName = <span class=\"fu\">asJavaString<\/span>(<span class=\"fu\">clang_getTypeSpelling<\/span>(type));<\/span>\n+<span id=\"cb44-38\"><a href=\"#cb44-38\"><\/a>                    <span class=\"bu\">System<\/span>.<span class=\"fu\">out.printf<\/span>(<span class=\"st\">&quot; &lt;<\/span><span class=\"sc\">%s<\/span><span class=\"st\">&gt;&quot;<\/span>, typeName);<\/span>\n+<span id=\"cb44-39\"><a href=\"#cb44-39\"><\/a>                }<\/span>\n+<span id=\"cb44-40\"><a href=\"#cb44-40\"><\/a>                <span class=\"bu\">System<\/span>.<span class=\"fu\">out<\/span>.<span class=\"fu\">println<\/span>();<\/span>\n+<span id=\"cb44-41\"><a href=\"#cb44-41\"><\/a><\/span>\n+<span id=\"cb44-42\"><a href=\"#cb44-42\"><\/a>                <span class=\"co\">\/\/ visit children<\/span><\/span>\n+<span id=\"cb44-43\"><a href=\"#cb44-43\"><\/a>                level[<span class=\"dv\">0<\/span>]++;<\/span>\n+<span id=\"cb44-44\"><a href=\"#cb44-44\"><\/a>                <span class=\"fu\">clang_visitChildren<\/span>(cursor, visitor[<span class=\"dv\">0<\/span>], NULL);<\/span>\n+<span id=\"cb44-45\"><a href=\"#cb44-45\"><\/a>                level[<span class=\"dv\">0<\/span>]--;<\/span>\n+<span id=\"cb44-46\"><a href=\"#cb44-46\"><\/a><\/span>\n+<span id=\"cb44-47\"><a href=\"#cb44-47\"><\/a>                <span class=\"kw\">return<\/span> <span class=\"fu\">CXChildVisit_Continue<\/span>();<\/span>\n+<span id=\"cb44-48\"><a href=\"#cb44-48\"><\/a>            });<\/span>\n+<span id=\"cb44-49\"><a href=\"#cb44-49\"><\/a><\/span>\n+<span id=\"cb44-50\"><a href=\"#cb44-50\"><\/a>            <span class=\"co\">\/\/ get the AST root and visit it<\/span><\/span>\n+<span id=\"cb44-51\"><a href=\"#cb44-51\"><\/a>            var root = <span class=\"fu\">clang_getTranslationUnitCursor<\/span>(tu);<\/span>\n+<span id=\"cb44-52\"><a href=\"#cb44-52\"><\/a>            <span class=\"fu\">clang_visitChildren<\/span>(root, visitor[<span class=\"dv\">0<\/span>], NULL);<\/span>\n+<span id=\"cb44-53\"><a href=\"#cb44-53\"><\/a><\/span>\n+<span id=\"cb44-54\"><a href=\"#cb44-54\"><\/a>            <span class=\"fu\">clang_disposeTranslationUnit<\/span>(tu);<\/span>\n+<span id=\"cb44-55\"><a href=\"#cb44-55\"><\/a>            <span class=\"fu\">clang_disposeIndex<\/span>(index);<\/span>\n+<span id=\"cb44-56\"><a href=\"#cb44-56\"><\/a>        }<\/span>\n+<span id=\"cb44-57\"><a href=\"#cb44-57\"><\/a>    }<\/span>\n+<span id=\"cb44-58\"><a href=\"#cb44-58\"><\/a>}<\/span><\/code><\/pre><\/div>\n@@ -832,3 +947,3 @@\n-<div class=\"sourceCode\" id=\"cb41\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb41-1\"><a href=\"#cb41-1\"><\/a><\/span>\n-<span id=\"cb41-2\"><a href=\"#cb41-2\"><\/a><span class=\"ex\">java<\/span> -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \\<\/span>\n-<span id=\"cb41-3\"><a href=\"#cb41-3\"><\/a>    ASTPrinter.java <span class=\"va\">$*<\/span><\/span><\/code><\/pre><\/div>\n+<div class=\"sourceCode\" id=\"cb45\"><pre class=\"sourceCode sh\"><code class=\"sourceCode bash\"><span id=\"cb45-1\"><a href=\"#cb45-1\"><\/a><\/span>\n+<span id=\"cb45-2\"><a href=\"#cb45-2\"><\/a><span class=\"ex\">java<\/span> -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \\<\/span>\n+<span id=\"cb45-3\"><a href=\"#cb45-3\"><\/a>    ASTPrinter.java <span class=\"va\">$*<\/span><\/span><\/code><\/pre><\/div>\n","filename":"doc\/panama_jextract.html","additions":206,"deletions":91,"binary":false,"changes":297,"status":"modified"},{"patch":"@@ -758,0 +758,133 @@\n+## Using tensorflow (Mac OS)\n+\n+### getting libtensorflow\n+\n+* Download tensorflow library from\n+\n+    https:\/\/www.tensorflow.org\/install\/lang_c\n+\n+* extract the downloaded tar in a directory called LIBTENSORFLOW_HOME\n+\n+###  jextract c_api.h\n+\n+```sh\n+\n+jextract --source \\\n+  -I \/Applications\/Xcode.app\/Contents\/Developer\/Platforms\/MacOSX.platform\/Developer\/SDKs\/MacOSX.sdk\/usr\/include\/ \\\n+  -t org.tensorflow \\\n+  -I ${LIBTENSORFLOW_HOME}\/include \\\n+  -l ${LIBTENSORFLOW_HOME}\/lib\/libtensorflow.dylib \\\n+  ${LIBTENSORFLOW_HOME}\/include\/tensorflow\/c\/c_api.h\n+\n+javac --add-modules jdk.incubator.foreign org\/tensorflow\/*.java\n+\n+```\n+\n+### Python program that creates and saves model\n+\n+The following Python program should be run to create and save model\n+which will read and printed by a Java program.\n+\n+Note: you need to install tensorflow package to run this python script.\n+\n+```python\n+\n+import tensorflow as tf\n+from tensorflow.keras import models, layers\n+from tensorflow.keras.datasets import mnist\n+\n+model = tf.keras.models.Sequential([\n+  tf.keras.layers.Flatten(input_shape=(28, 28)),\n+  tf.keras.layers.Dense(128,activation='relu'),\n+  tf.keras.layers.Dense(10, activation='softmax')\n+])\n+\n+model.compile(\n+    loss='sparse_categorical_crossentropy',\n+    optimizer=tf.keras.optimizers.Adam(0.001),\n+    metrics=['accuracy'],\n+)\n+\n+print(model.summary())\n+\n+(train_images, train_labels), (test_images, test_labels) = mnist.load_data()\n+\n+train_images = train_images\/255.0\n+test_images = test_images\/255.0\n+\n+model.fit(train_images, train_labels,\n+    epochs=4, batch_size=128, verbose=1)\n+\n+test_loss, test_accuracy = model.evaluate(test_images, test_labels)\n+\n+print(test_loss, test_accuracy)\n+\n+model.save(\"saved_mnist_model\")\n+\n+```\n+\n+### Java program that uses Tensorflow C API\n+\n+```java\n+\n+import jdk.incubator.foreign.*;\n+import static jdk.incubator.foreign.CSupport.*;\n+import static jdk.incubator.foreign.MemoryAccess.*;\n+import static jdk.incubator.foreign.MemoryAddress.*;\n+import static org.tensorflow.c_api_h.*;\n+\n+\/\/ simple program that loads saved model and prints basic info on operations in it\n+\n+public class TensorflowLoadSavedModel {\n+    public static void main(String... args) throws Exception {\n+        System.out.println(\"TensorFlow C library version: \" + toJavaStringRestricted(TF_Version()));\n+\n+        if (args.length == 0) {\n+            System.err.println(\"java TensorflowLoadSavedModel <saved model dir>\");\n+            System.exit(1);\n+        }\n+\n+        try (var scope = NativeScope.unboundedScope()) {\n+            var graph = TF_NewGraph();\n+            var status = TF_NewStatus();\n+            var sessionOpts = TF_NewSessionOptions();\n+\n+            var savedModelDir = toCString(args[0], scope);\n+            var tags = scope.allocate(C_POINTER, toCString(\"serve\", scope));\n+            var session = TF_LoadSessionFromSavedModel(sessionOpts, NULL, savedModelDir, tags, 1, graph, NULL, status);\n+\n+            if (TF_GetCode(status) != TF_OK()) {\n+                System.err.printf(\"cannot load session from saved model: %s\\n\",\n+                    toJavaStringRestricted(TF_Message(status)));\n+            } else {\n+                System.err.println(\"load session from saved model works!\");\n+            }\n+\n+            \/\/ print operations\n+            var size = scope.allocate(C_LONGLONG);\n+            var operation = NULL;\n+            while (!(operation = TF_GraphNextOperation(graph, size)).equals(NULL)) {\n+                System.out.printf(\"%s : %s\\n\",\n+                    toJavaStringRestricted(TF_OperationName(operation)),\n+                    toJavaStringRestricted(TF_OperationOpType(operation)));\n+            }\n+\n+            TF_DeleteGraph(graph);\n+            TF_DeleteSession(session, status);\n+            TF_DeleteSessionOptions(sessionOpts);\n+            TF_DeleteStatus(status);\n+        }\n+    }\n+}\n+\n+```\n+\n+### Compiling and running the Java Tensorflow sample\n+\n+```sh\n+\n+java -Dforeign.restricted=permit --add-modules jdk.incubator.foreign \\\n+   TensorflowLoadSavedModel.java saved_mnist_model\n+\n+```\n+\n","filename":"doc\/panama_jextract.md","additions":133,"deletions":0,"binary":false,"changes":133,"status":"modified"}]}