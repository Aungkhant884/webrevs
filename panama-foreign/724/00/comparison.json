{"files":[{"patch":"@@ -72,1 +72,1 @@\n-    static final JavaNioAccess nioAccess = SharedSecrets.getJavaNioAccess();\n+    static final JavaNioAccess NIO_ACCESS = SharedSecrets.getJavaNioAccess();\n@@ -243,1 +243,1 @@\n-        throw new UnsupportedOperationException(\"Not a mapped segment\");\n+        throw newUnsupportedOperationExceptionNotAMappedSegment();\n@@ -248,1 +248,1 @@\n-        throw new UnsupportedOperationException(\"Not a mapped segment\");\n+        throw newUnsupportedOperationExceptionNotAMappedSegment();\n@@ -253,1 +253,1 @@\n-        throw new UnsupportedOperationException(\"Not a mapped segment\");\n+        throw newUnsupportedOperationExceptionNotAMappedSegment();\n@@ -258,0 +258,4 @@\n+        throw newUnsupportedOperationExceptionNotAMappedSegment();\n+    }\n+\n+    private static UnsupportedOperationException newUnsupportedOperationExceptionNotAMappedSegment() {\n@@ -367,1 +371,1 @@\n-    static class SegmentSplitter implements Spliterator<MemorySegment> {\n+    static final class SegmentSplitter implements Spliterator<MemorySegment> {\n@@ -464,3 +468,3 @@\n-        long bbAddress = nioAccess.getBufferAddress(bb);\n-        Object base = nioAccess.getBufferBase(bb);\n-        UnmapperProxy unmapper = nioAccess.unmapper(bb);\n+        long bbAddress = NIO_ACCESS.getBufferAddress(bb);\n+        Object base = NIO_ACCESS.getBufferBase(bb);\n+        UnmapperProxy unmapper = NIO_ACCESS.unmapper(bb);\n@@ -472,1 +476,1 @@\n-        AbstractMemorySegmentImpl bufferSegment = (AbstractMemorySegmentImpl)nioAccess.bufferSegment(bb);\n+        AbstractMemorySegmentImpl bufferSegment = (AbstractMemorySegmentImpl) NIO_ACCESS.bufferSegment(bb);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/AbstractMemorySegmentImpl.java","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -170,1 +170,3 @@\n-                returnLayout().map(Object::toString).orElse(\"v\"));\n+                returnLayout()\n+                        .map(Object::toString)\n+                        .orElse(\"v\"));\n@@ -222,1 +224,3 @@\n-                    Stream.concat(descriptor.argumentLayouts().stream(), Arrays.stream(argLayouts).map(Objects::requireNonNull)).toList());\n+                    Stream.concat(descriptor.argumentLayouts().stream(), Arrays.stream(argLayouts)\n+                            .map(Objects::requireNonNull))\n+                            .toList());\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/FunctionDescriptorImpl.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -52,1 +52,4 @@\n-public class LayoutPath {\n+public final class LayoutPath {\n+\n+    private static final long[] EMPTY_STRIDES = new long[0];\n+    private static final long[] EMPTY_BOUNDS = new long[0];\n@@ -261,3 +264,0 @@\n-    private static final long[] EMPTY_STRIDES = new long[0];\n-    private static final long[] EMPTY_BOUNDS = new long[0];\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/LayoutPath.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-        return nioAccess.newMappedByteBuffer(unmapper, min, (int)length, null,\n+        return NIO_ACCESS.newMappedByteBuffer(unmapper, min, (int)length, null,\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/MappedMemorySegmentImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -58,4 +58,0 @@\n-    final ResourceList resourceList;\n-    final Cleaner.Cleanable cleanable;\n-    final Thread owner;\n-\n@@ -66,2 +62,0 @@\n-    int state = OPEN;\n-\n@@ -69,0 +63,11 @@\n+    static final int MAX_FORKS = Integer.MAX_VALUE;\n+\n+    public static final MemorySessionImpl GLOBAL = new GlobalSessionImpl(null);\n+\n+    static final ScopedMemoryAccess.ScopedAccessError ALREADY_CLOSED = new ScopedMemoryAccess.ScopedAccessError(MemorySessionImpl::alreadyClosed);\n+    static final ScopedMemoryAccess.ScopedAccessError WRONG_THREAD = new ScopedMemoryAccess.ScopedAccessError(MemorySessionImpl::wrongThread);\n+\n+    final ResourceList resourceList;\n+    final Cleaner.Cleanable cleanable;\n+    final Thread owner;\n+    int state = OPEN;\n@@ -78,2 +83,0 @@\n-    static final int MAX_FORKS = Integer.MAX_VALUE;\n-\n@@ -299,2 +302,0 @@\n-    public static final MemorySessionImpl GLOBAL = new GlobalSessionImpl(null);\n-\n@@ -470,3 +471,0 @@\n-    static final ScopedMemoryAccess.ScopedAccessError ALREADY_CLOSED = new ScopedMemoryAccess.ScopedAccessError(MemorySessionImpl::alreadyClosed);\n-\n-    static final ScopedMemoryAccess.ScopedAccessError WRONG_THREAD = new ScopedMemoryAccess.ScopedAccessError(MemorySessionImpl::wrongThread);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/MemorySessionImpl.java","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -45,11 +45,1 @@\n-    private static final Unsafe unsafe = Unsafe.getUnsafe();\n-\n-    @Override\n-    public long address() {\n-        return min;\n-    }\n-\n-    @Override\n-    public Optional<Object> array() {\n-        return Optional.empty();\n-    }\n+    private static final Unsafe UNSAFE = Unsafe.getUnsafe();\n@@ -60,1 +50,0 @@\n-\n@@ -71,0 +60,10 @@\n+    @Override\n+    public long address() {\n+        return min;\n+    }\n+\n+    @Override\n+    public Optional<Object> array() {\n+        return Optional.empty();\n+    }\n+\n@@ -79,1 +78,1 @@\n-        return nioAccess.newDirectByteBuffer(min, (int) this.length, null,\n+        return NIO_ACCESS.newDirectByteBuffer(min, (int) this.length, null,\n@@ -109,1 +108,1 @@\n-            alignmentBytes = Math.max(alignmentBytes, nioAccess.pageSize());\n+            alignmentBytes = Math.max(alignmentBytes, NIO_ACCESS.pageSize());\n@@ -115,1 +114,1 @@\n-        nioAccess.reserveMemory(alignedSize, bytesSize);\n+        NIO_ACCESS.reserveMemory(alignedSize, bytesSize);\n@@ -117,1 +116,1 @@\n-        long buf = unsafe.allocateMemory(alignedSize);\n+        long buf = UNSAFE.allocateMemory(alignedSize);\n@@ -119,1 +118,1 @@\n-            unsafe.setMemory(buf, alignedSize, (byte)0);\n+            UNSAFE.setMemory(buf, alignedSize, (byte)0);\n@@ -127,2 +126,2 @@\n-                unsafe.freeMemory(buf);\n-                nioAccess.unreserveMemory(alignedSize, bytesSize);\n+                UNSAFE.freeMemory(buf);\n+                NIO_ACCESS.unreserveMemory(alignedSize, bytesSize);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/NativeMemorySegmentImpl.java","additions":18,"deletions":19,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-    static class SharedResourceList extends ResourceList {\n+    static final class SharedResourceList extends ResourceList {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/SharedSession.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -80,0 +80,3 @@\n+    private Utils() {\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/Utils.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-public class ABIDescriptor {\n+public final class ABIDescriptor {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/ABIDescriptor.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,1 +31,4 @@\n-public class BindingInterpreter {\n+public final class BindingInterpreter {\n+\n+    private BindingInterpreter() {\n+    }\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/BindingInterpreter.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -67,1 +67,1 @@\n-public class BindingSpecializer {\n+public final class BindingSpecializer {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/BindingSpecializer.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,1 +33,1 @@\n-public class CallingSequence {\n+public final class CallingSequence {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/CallingSequence.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-public class CallingSequenceBuilder {\n+public final class CallingSequenceBuilder {\n@@ -63,1 +63,1 @@\n-    public final CallingSequenceBuilder addArgumentBindings(Class<?> carrier, MemoryLayout layout,\n+    public CallingSequenceBuilder addArgumentBindings(Class<?> carrier, MemoryLayout layout,\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/CallingSequenceBuilder.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-public class DowncallLinker {\n+public final class DowncallLinker {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/DowncallLinker.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-public class NativeEntryPoint {\n+public final class NativeEntryPoint {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/NativeEntryPoint.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -392,1 +392,1 @@\n-    public static non-sealed class EmptyVaList implements VaList {\n+    public static final class EmptyVaList implements VaList {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/SharedUtils.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-class SoftReferenceCache<K, V> {\n+final class SoftReferenceCache<K, V> {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/SoftReferenceCache.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-public class UpcallLinker {\n+public final class UpcallLinker {\n@@ -64,0 +64,3 @@\n+    private UpcallLinker() {\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/UpcallLinker.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n-public class VMStorage {\n+public final class VMStorage {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/VMStorage.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -124,1 +124,1 @@\n-    public Bindings getBindings(MethodType mt, FunctionDescriptor cDesc, boolean forUpcall) {\n+    public final Bindings getBindings(MethodType mt, FunctionDescriptor cDesc, boolean forUpcall) {\n@@ -152,1 +152,1 @@\n-    public MethodHandle arrangeDowncall(MethodType mt, FunctionDescriptor cDesc) {\n+    public final MethodHandle arrangeDowncall(MethodType mt, FunctionDescriptor cDesc) {\n@@ -164,1 +164,1 @@\n-    public MemorySegment arrangeUpcall(MethodHandle target, MethodType mt, FunctionDescriptor cDesc, MemorySession session) {\n+    public final MemorySegment arrangeUpcall(MethodHandle target, MethodType mt, FunctionDescriptor cDesc, MemorySession session) {\n@@ -181,1 +181,1 @@\n-    class StorageCalculator {\n+    final class StorageCalculator {\n@@ -312,1 +312,1 @@\n-    class UnboxBindingCalculator extends BindingCalculator {\n+    final class UnboxBindingCalculator extends BindingCalculator {\n@@ -413,1 +413,1 @@\n-    class BoxBindingCalculator extends BindingCalculator {\n+    final class BoxBindingCalculator extends BindingCalculator {\n@@ -431,1 +431,1 @@\n-                case STRUCT_REGISTER: {\n+                case STRUCT_REGISTER -> {\n@@ -435,1 +435,1 @@\n-                        StorageClasses.INTEGER, layout);\n+                            StorageClasses.INTEGER, layout);\n@@ -452,1 +452,0 @@\n-                    break;\n@@ -454,1 +453,1 @@\n-                case STRUCT_REFERENCE: {\n+                case STRUCT_REFERENCE -> {\n@@ -457,1 +456,1 @@\n-                        StorageClasses.INTEGER, AArch64.C_POINTER);\n+                            StorageClasses.INTEGER, AArch64.C_POINTER);\n@@ -460,1 +459,0 @@\n-                    break;\n@@ -462,1 +460,1 @@\n-                case STRUCT_HFA: {\n+                case STRUCT_HFA -> {\n@@ -465,1 +463,1 @@\n-                    GroupLayout group = (GroupLayout)layout;\n+                    GroupLayout group = (GroupLayout) layout;\n@@ -467,1 +465,1 @@\n-                        StorageClasses.VECTOR, group.memberLayouts().size());\n+                            StorageClasses.VECTOR, group.memberLayouts().size());\n@@ -483,1 +481,0 @@\n-                    break;\n@@ -485,1 +482,1 @@\n-                case POINTER: {\n+                case POINTER -> {\n@@ -487,1 +484,1 @@\n-                        storageCalculator.nextStorage(StorageClasses.INTEGER, layout);\n+                            storageCalculator.nextStorage(StorageClasses.INTEGER, layout);\n@@ -490,1 +487,0 @@\n-                    break;\n@@ -492,1 +488,1 @@\n-                case INTEGER: {\n+                case INTEGER -> {\n@@ -494,1 +490,1 @@\n-                        storageCalculator.nextStorage(StorageClasses.INTEGER, layout);\n+                            storageCalculator.nextStorage(StorageClasses.INTEGER, layout);\n@@ -496,1 +492,0 @@\n-                    break;\n@@ -498,1 +493,1 @@\n-                case FLOAT: {\n+                case FLOAT -> {\n@@ -500,1 +495,1 @@\n-                        storageCalculator.nextStorage(StorageClasses.VECTOR, layout);\n+                            storageCalculator.nextStorage(StorageClasses.VECTOR, layout);\n@@ -502,1 +497,0 @@\n-                    break;\n@@ -504,2 +498,1 @@\n-                default:\n-                    throw new UnsupportedOperationException(\"Unhandled class \" + argumentClass);\n+                default -> throw new UnsupportedOperationException(\"Unhandled class \" + argumentClass);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/aarch64\/CallArranger.java","additions":20,"deletions":27,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -156,1 +156,3 @@\n-                IntStream.range(0, numX87Outputs).mapToObj(X86_64Architecture::x87Storage).toArray(VMStorage[]::new)\n+                IntStream.range(0, numX87Outputs)\n+                        .mapToObj(X86_64Architecture::x87Storage)\n+                        .toArray(VMStorage[]::new)\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/x64\/X86_64Architecture.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -61,1 +61,1 @@\n-public class CallArranger {\n+public final class CallArranger {\n@@ -155,1 +155,1 @@\n-    static class StorageCalculator {\n+    static final class StorageCalculator {\n@@ -219,8 +219,5 @@\n-            switch (type) {\n-                case StorageClasses.INTEGER:\n-                    return nIntegerReg;\n-                case StorageClasses.VECTOR:\n-                    return nVectorReg;\n-                default:\n-                    throw new IllegalStateException();\n-            }\n+            return switch (type) {\n+                case StorageClasses.INTEGER -> nIntegerReg;\n+                case StorageClasses.VECTOR -> nVectorReg;\n+                default -> throw new IllegalStateException();\n+            };\n@@ -231,8 +228,3 @@\n-                case StorageClasses.INTEGER:\n-                    nIntegerReg++;\n-                    break;\n-                case StorageClasses.VECTOR:\n-                    nVectorReg++;\n-                    break;\n-                default:\n-                    throw new IllegalStateException();\n+                case StorageClasses.INTEGER -> nIntegerReg++;\n+                case StorageClasses.VECTOR -> nVectorReg++;\n+                default -> throw new IllegalStateException();\n@@ -253,1 +245,1 @@\n-    static class UnboxBindingCalculator extends BindingCalculator {\n+    static final class UnboxBindingCalculator extends BindingCalculator {\n@@ -264,1 +256,1 @@\n-                case STRUCT: {\n+                case STRUCT -> {\n@@ -281,1 +273,0 @@\n-                    break;\n@@ -283,1 +274,1 @@\n-                case POINTER: {\n+                case POINTER -> {\n@@ -287,3 +278,2 @@\n-                    break;\n-                }\n-                case INTEGER: {\n+                                    }\n+                case INTEGER -> {\n@@ -292,1 +282,0 @@\n-                    break;\n@@ -294,1 +283,1 @@\n-                case FLOAT: {\n+                case FLOAT -> {\n@@ -297,1 +286,0 @@\n-                    break;\n@@ -299,2 +287,1 @@\n-                default:\n-                    throw new UnsupportedOperationException(\"Unhandled class \" + argumentClass);\n+                default -> throw new UnsupportedOperationException(\"Unhandled class \" + argumentClass);\n@@ -306,1 +293,1 @@\n-    static class BoxBindingCalculator extends BindingCalculator {\n+    static final class BoxBindingCalculator extends BindingCalculator {\n@@ -317,1 +304,1 @@\n-                case STRUCT: {\n+                case STRUCT -> {\n@@ -333,1 +320,0 @@\n-                    break;\n@@ -335,1 +321,1 @@\n-                case POINTER: {\n+                case POINTER -> {\n@@ -339,1 +325,0 @@\n-                    break;\n@@ -341,1 +326,1 @@\n-                case INTEGER: {\n+                case INTEGER -> {\n@@ -344,1 +329,0 @@\n-                    break;\n@@ -346,1 +330,1 @@\n-                case FLOAT: {\n+                case FLOAT -> {\n@@ -349,1 +333,0 @@\n-                    break;\n@@ -351,2 +334,1 @@\n-                default:\n-                    throw new UnsupportedOperationException(\"Unhandled class \" + argumentClass);\n+                default -> throw new UnsupportedOperationException(\"Unhandled class \" + argumentClass);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/x64\/sysv\/CallArranger.java","additions":23,"deletions":41,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-public non-sealed class SysVVaList implements VaList {\n+public final class SysVVaList implements VaList {\n@@ -358,1 +358,1 @@\n-    public static non-sealed class Builder implements VaList.Builder {\n+    public static final class Builder implements VaList.Builder {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/x64\/sysv\/SysVVaList.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n-class TypeClass {\n+final class TypeClass {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/abi\/x64\/sysv\/TypeClass.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -86,14 +86,0 @@\n-    \/**\n-     * {@return {@code true}, if this group layout is a struct layout}\n-     *\/\n-    public final boolean isStruct() {\n-        return kind == Kind.STRUCT;\n-    }\n-\n-    \/**\n-     * {@return {@code true}, if this group layout is a union layout}\n-     *\/\n-    public final boolean isUnion() {\n-        return kind == Kind.UNION;\n-    }\n-\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/layout\/AbstractGroupLayout.java","additions":0,"deletions":14,"binary":false,"changes":14,"status":"modified"}]}