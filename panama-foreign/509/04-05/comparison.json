{"files":[{"patch":"@@ -29,1 +29,1 @@\n-\n+  private static final VarHandle ENTRY_NEXT;\n@@ -35,0 +35,2 @@\n+\n+      ENTRY_NEXT = MethodHandles.lookup().findVarHandle(Entry.class, \"next\", Entry.class);\n@@ -46,1 +48,2 @@\n-    while ((int) LOCK.compareAndExchange(this, 0, 1) != 1) { }\n+\/\/    while ((int) LOCK.compareAndExchange(this, 0, 1) != 1) {};\n+    while (!LOCK.compareAndSet(this, 0, 1)) {}\n@@ -50,1 +53,1 @@\n-        HEAD.setRelease(this, current.next);\n+        HEAD.setRelease(this, ENTRY_NEXT.getAcquire(current));\n@@ -79,1 +82,2 @@\n-    while ((int) LOCK.compareAndExchangeAcquire(this, 0, 1) != 1) { }\n+\/\/    while ((int) LOCK.compareAndExchange(this, 0, 1) != 1) { }\n+    while (!LOCK.compareAndSet(this, 0, 1)) { }\n@@ -83,1 +87,1 @@\n-        entry.next = (T) HEAD.getAcquire(this);\n+        ENTRY_NEXT.setRelease(entry, HEAD.getAcquire(this));\n@@ -86,0 +90,1 @@\n+        LOCK.setRelease(this, 0);\n","filename":"src\/jdk.incubator.foreign\/share\/classes\/jdk\/incubator\/foreign\/SpinLockQueue.java","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"}]}