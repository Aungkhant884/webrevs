{"files":[{"patch":"@@ -237,1 +237,1 @@\n-                            toArray(ms, gl, info.lastDimension(), arrayComponentType, mapperCtor);\n+                            toArray(ms, gl, arrayComponentType, mapperCtor);\n@@ -463,1 +463,1 @@\n-        return toArray(slice, elementLayout, count, type, mapper);\n+        return toArray(slice, elementLayout, type, mapper);\n@@ -469,1 +469,0 @@\n-                           long count,\n@@ -473,11 +472,10 @@\n-        R[] result = (R[]) Array.newInstance(type, Math.toIntExact(count));\n-        Spliterator<MemorySegment> spliterator = segment.spliterator(elementLayout);\n-        int[] cnt = new int[]{0};\n-        spliterator.forEachRemaining(s -> {\n-            try {\n-                result[cnt[0]++] = (R) mapper.invokeExact(s);\n-            } catch (Throwable t) {\n-                throw new IllegalArgumentException(t);\n-            }\n-        });\n-        return result;\n+        return segment.elements(elementLayout)\n+                .map(s -> {\n+                    try {\n+                     return (R) mapper.invokeExact(s);\n+                    } catch (Throwable t) {\n+                        throw new IllegalArgumentException(t);\n+                    }\n+\n+                })\n+                .toArray(s -> (R[]) Array.newInstance(type, Math.toIntExact(s)));\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/LayoutRecordMapper.java","additions":12,"deletions":14,"binary":false,"changes":26,"status":"modified"}]}