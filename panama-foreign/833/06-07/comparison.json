{"files":[{"patch":"@@ -71,0 +71,1 @@\n+    private final MethodHandles.Lookup lookup;\n@@ -75,1 +76,1 @@\n-        this(type, layout, 0);\n+        this(type, layout, 0L, PUBLIC_LOOKUP);\n@@ -78,3 +79,4 @@\n-    private LayoutRecordMapper(Class<T> type,\n-                               GroupLayout layout,\n-                               long offset) {\n+    public LayoutRecordMapper(Class<T> type,\n+                              GroupLayout layout,\n+                              long offset,\n+                              MethodHandles.Lookup lookup) {\n@@ -89,0 +91,1 @@\n+        this.lookup = lookup;\n@@ -102,1 +105,1 @@\n-            var ctor = PUBLIC_LOOKUP.findConstructor(type, MethodType.methodType(void.class, ctorParameterTypes));\n+            var ctor = lookup.findConstructor(type, MethodType.methodType(void.class, ctorParameterTypes));\n@@ -116,1 +119,1 @@\n-                    \"' for \" + Arrays.toString(ctorParameterTypes), e);\n+                    \"' for \" + Arrays.toString(ctorParameterTypes) + \" using lookup \" + lookup, e);\n@@ -143,1 +146,1 @@\n-        var mh = PUBLIC_LOOKUP.findVirtual(MemorySegment.class, \"get\", mt);\n+        var mh = LOOKUP.findVirtual(MemorySegment.class, \"get\", mt);\n@@ -398,1 +401,1 @@\n-        return new LayoutRecordMapper<>(componentType, gl, byteOffset);\n+        return new LayoutRecordMapper<>(componentType, gl, byteOffset, lookup);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/foreign\/LayoutRecordMapper.java","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"}]}