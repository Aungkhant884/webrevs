{"files":[{"patch":"@@ -1,2 +1,18 @@\n-ALL_MD=$(wildcard src\/*.md)\n-ALL_HTML=$(ALL_MD:src\/%.md=build\/%.html)\n+default: all\n+\n+define NEWLINE\n+\n+\n+endef\n+\n+TITLE := The OpenJDK Developers' Guide\n+\n+ALL_MD := $(wildcard src\/*.md)\n+ALL_FOOTER := $(patsubst src\/%.md, build\/support\/footers\/%.html, $(ALL_MD))\n+ALL_RESULT := $(patsubst src\/%.md, build\/dist\/%.html, $(ALL_MD))\n+\n+UTF8_HTML := $(patsubst build\/dist\/%.html, build\/support\/utf-8\/%.html, $(ALL_RESULT))\n+\n+ifneq ($(DEBUG_MAKE),)\n+  .SECONDARY: $(ALL_FOOTER) $(UTF8_HTML)\n+endif\n@@ -12,1 +28,7 @@\n-.PHONY: all clean\n+# Return the short form git hash for the last change to a file or set of files\n+# $1: the name of the file or files to get the hash for\n+GetHash = \\\n+\t$(eval _shell_hash = $(shell git log -1 --pretty=format:\"%h\" -- $1)) \\\n+\t$(if $(_shell_hash), \\\n+\t$(_shell_hash), \\\n+\t0000000)\n@@ -14,1 +36,6 @@\n-all: build build\/guidestyle.css $(ALL_HTML)\n+# Generate a footer from the tempate in src\/footer.html\n+# $1: output file name\n+# $2: git hash value\n+# $3: relative file name\n+GenerateFooter = \\\n+\tsed -e 's@!git-commit-hash!@$(strip $2)@' -e 's@!source-file-name!@$(strip $3)@' src\/footer.html > $1\n@@ -16,2 +43,19 @@\n-clean:\n-\trm -rf build\n+# Convert markdown to html by pandoc\n+# $1: input markdown file\n+# $2: output html file\n+RunPandoc = \\\n+\tpandoc $1 $(MERMAID_FILTER) --css guidestyle.css --strip-comments --standalone --toc --ascii --to html4 --title-prefix \"$(TITLE)\" --include-after-body=build\/support\/footers\/$(notdir $2) > $2\n+\n+# Convert utf-8 html to latin-1\n+# $1: input utf-8 file\n+# $2: output latin-1 file\n+ConvertToLatin1 = \\\n+\tsed -e 's\/ charset=utf-8\/\/' $1 | iconv -f UTF-8 -t ISO-8859-1 > $2\n+\n+build\/support\/footers\/%.html: src\/%.md\n+\tmkdir -p build\/support\/footers\n+\t$(call GenerateFooter, $@, $(call GetHash, $<), $<)\n+\n+build\/support\/utf-8\/%.html: src\/%.md build\/support\/footers\/%.html\n+\tmkdir -p build\/support\/utf-8\n+\t$(call RunPandoc, $<, $@)\n@@ -19,2 +63,3 @@\n-build:\n-\tmkdir build\n+build\/dist\/%.html: build\/support\/utf-8\/%.html\n+\tmkdir -p build\/dist\n+\t$(call ConvertToLatin1, $<, $@)\n@@ -22,11 +67,3 @@\n-build\/%.html: src\/%.md src\/footer.html\n-\tcp src\/footer.html build\/tmp_footer.html\n-\tCHANGE_HASH=$$(git log -1 --pretty=format:\"%h\" -- $<);   \\\n-\tif [ \"$$CHANGE_HASH\" = \"\" ]; then                        \\\n-\t  CHANGE_HASH=\"0000000\";                                 \\\n-\tfi;                                                      \\\n-\tperl -pi -e 'BEGIN {$$hash=shift} s\/!git-commit-hash!\/$$hash\/' $$CHANGE_HASH build\/tmp_footer.html\n-\tperl -pi -e 's;!source-file-name!;$<;' build\/tmp_footer.html\n-\tpandoc $< $(MERMAID_FILTER) --css guidestyle.css --strip-comments --standalone --toc --ascii --to html4 --title-prefix \"The OpenJDK Developers' Guide\" --include-after-body=build\/tmp_footer.html | iconv -f UTF-8 -t ISO-8859-1 > $@\n-\tperl -pi -e 's\/ charset=utf-8\/\/' $@\n-\trm build\/tmp_footer.html\n+build\/dist\/guidestyle.css: src\/guidestyle.css\n+\tmkdir -p build\/dist\n+\tcp $< $@\n@@ -34,2 +71,4 @@\n-build\/guidestyle.css: build src\/guidestyle.css\n-\tcp src\/guidestyle.css build\/guidestyle.css\n+all: $(ALL_RESULT) build\/dist\/guidestyle.css\n+\n+clean:\n+\trm -rf build\n@@ -39,0 +78,2 @@\n+\n+.PHONY: default all clean validate\n","filename":"Makefile","additions":62,"deletions":21,"binary":false,"changes":83,"status":"modified"}]}