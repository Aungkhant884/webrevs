{"files":[{"patch":"@@ -2,0 +2,8 @@\n+\n+define NEWLINE\n+\n+\n+endef\n+\n+TITLE := The OpenJDK Developers' Guide\n+\n@@ -3,1 +11,8 @@\n-ALL_HTML := $(patsubst src\/%.md, build\/dist\/%.html, $(ALL_MD))\n+ALL_FOOTER := $(patsubst src\/%.md, build\/support\/footers\/%.html, $(ALL_MD))\n+ALL_RESULT := $(patsubst src\/%.md, build\/dist\/%.html, $(ALL_MD))\n+\n+UTF8_HTML := $(patsubst build\/dist\/%.html, build\/support\/utf-8\/%.html, $(ALL_RESULT))\n+\n+ifneq ($(DEBUG_MAKE),)\n+  .SECONDARY: $(ALL_FOOTER) $(UTF8_HTML)\n+endif\n@@ -13,0 +28,27 @@\n+# Return the short form git hash for the last change to a file or set of files\n+# $1: the name of the file or files to get the hash for\n+GetHash = \\\n+\t$(eval _shell_hash = $(shell git log -1 --pretty=format:\"%h\" -- $1)) \\\n+\t$(if $(_shell_hash), \\\n+\t$(_shell_hash), \\\n+\t0000000)\n+\n+# Generate a footer from the tempate in src\/footer.html\n+# $1: output file name\n+# $2: git hash value\n+# $3: relative file name\n+GenerateFooter = \\\n+\tsed -e 's@!git-commit-hash!@$(strip $2)@' -e 's@!source-file-name!@$(strip $3)@' src\/footer.html > $1\n+\n+# Convert markdown to html by pandoc\n+# $1: input markdown file\n+# $2: output html file\n+RunPandoc = \\\n+\tpandoc $1 $(MERMAID_FILTER) --css guidestyle.css --strip-comments --standalone --toc --ascii --to html4 --title-prefix \"$(TITLE)\" --include-after-body=build\/support\/footers\/$(notdir $2) > $2\n+\n+# Convert utf-8 html to latin-1\n+# $1: input utf-8 file\n+# $2: output latin-1 file\n+ConvertToLatin1 = \\\n+\tsed -e 's\/ charset=utf-8\/\/' $1 | iconv -f UTF-8 -t ISO-8859-1 > $2\n+\n@@ -15,9 +57,7 @@\n-\tcp src\/footer.html $@\n-\tCHANGE_HASH=$$(git log -1 --pretty=format:\"%h\" -- $<);   \\\n-\tif [ \"$$CHANGE_HASH\" = \"\" ]; then                        \\\n-\t  CHANGE_HASH=\"0000000\";                                 \\\n-\tfi;                                                      \\\n-\tperl -pi -e 'BEGIN {$$hash=shift} s\/!git-commit-hash!\/$$hash\/' $$CHANGE_HASH $@\n-\tperl -pi -e 's;!source-file-name!;$<;' $@\n-\n-build\/dist\/%.html: src\/%.md build\/support\/footers\/%.html\n+\t$(call GenerateFooter, $@, $(call GetHash, $<), $<)\n+\n+build\/support\/utf-8\/%.html: src\/%.md build\/support\/footers\/%.html\n+\tmkdir -p build\/support\/utf-8\n+\t$(call RunPandoc, $<, $@)\n+\n+build\/dist\/%.html: build\/support\/utf-8\/%.html\n@@ -25,2 +65,1 @@\n-\tpandoc $< $(MERMAID_FILTER) --css guidestyle.css --strip-comments --standalone --toc --ascii --to html4 --title-prefix \"The OpenJDK Developers' Guide\" --include-after-body=build\/support\/footers\/$(notdir $@) | iconv -f UTF-8 -t ISO-8859-1 > $@\n-\tperl -pi -e 's\/ charset=utf-8\/\/' $@\n+\t$(call ConvertToLatin1, $<, $@)\n@@ -32,1 +71,1 @@\n-all: $(ALL_HTML) build\/dist\/guidestyle.css\n+all: $(ALL_RESULT) build\/dist\/guidestyle.css\n","filename":"Makefile","additions":52,"deletions":13,"binary":false,"changes":65,"status":"modified"}]}