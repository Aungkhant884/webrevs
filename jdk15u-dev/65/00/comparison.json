{"files":[{"patch":"@@ -29,1 +29,1 @@\n- * @run main\/othervm -XX:-BackgroundCompilation -XX:+UseCountedLoopSafepoints -XX:LoopStripMiningIter=1000 TestVectorsNotSavedAtSafepoint test1\n+ * @run main\/othervm -XX:-BackgroundCompilation -XX:+IgnoreUnrecognizedVMOptions -XX:+UseCountedLoopSafepoints -XX:LoopStripMiningIter=2 -XX:-TieredCompilation TestVectorsNotSavedAtSafepoint test1\n@@ -61,0 +61,2 @@\n+                \/\/ Produce some garbage and then let the GC do its work which will\n+                \/\/ corrupt vector registers if they are not saved at safepoints.\n@@ -65,0 +67,1 @@\n+                System.gc();\n@@ -75,11 +78,8 @@\n-            byte[] barray = new byte[10];\n-            long[] larray1 = new long[1000];\n-            long[] larray2 = new long[100_000_000];\n-            for (int i = 0; i < 20_000; i++) {\n-                test1(barray, barray, barray, larray1, -1);\n-            }\n-            for (int i = 0; i < 100; i++) {\n-                test1(barray, barray, barray, larray2, -1);\n-                if (larray2[larray2.length-1] != -1) {\n-                    System.out.println(\"Iter \" + i + \" Failed with \" + Long.toHexString(larray2[larray2.length-1]));\n-                    throw new RuntimeException(\"Test1 failed\");\n+            byte[] bArr = new byte[10];\n+            long[] lArr = new long[1000];\n+            for (int i = 0; i < 10_000; ++i) {\n+                test1(bArr, bArr, bArr, lArr, -1);\n+                for (int j = 0; j < lArr.length; ++j) {\n+                    if (bArr[j % 10] != 0 || lArr[j] != -1) {\n+                        throw new RuntimeException(\"Test1 failed at iteration \" + i + \": bArr[\" + (j % 10) + \"] = \" + bArr[j % 10] + \", lArr[\" + j + \"] = \" + lArr[j]);\n+                    }\n@@ -91,1 +91,1 @@\n-            for (int i = 0; i < 600_000; ++i) {\n+            for (int i = 0; i < 10_000; ++i) {\n","filename":"test\/hotspot\/jtreg\/compiler\/vectorization\/TestVectorsNotSavedAtSafepoint.java","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"}]}