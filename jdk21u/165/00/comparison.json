{"files":[{"patch":"@@ -2957,1 +2957,0 @@\n-    Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n@@ -2959,3 +2958,2 @@\n-    __ vmclr_m(as_VectorRegister($dst$$reg));\n-    __ vsetvli(t0, $src$$Register, sew);\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n+    __ vid_v(as_VectorRegister($dst$$reg));\n+    __ vmsltu_vx(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), $src$$Register);\n@@ -2971,1 +2969,0 @@\n-    Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n@@ -2973,3 +2970,2 @@\n-    __ vmclr_m(as_VectorRegister($dst$$reg));\n-    __ vsetvli(t0, $src$$Register, sew);\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n+    __ vid_v(as_VectorRegister($dst$$reg));\n+    __ vmsltu_vx(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), $src$$Register);\n@@ -2981,0 +2977,2 @@\n+  predicate(n->in(1)->get_long() <= 16 ||\n+            n->in(1)->get_long() == Matcher::vector_length(n));\n@@ -2985,2 +2983,2 @@\n-    if ($con$$constant != Matcher::vector_length(this)) {\n-      __ vsetvli_helper(bt, Matcher::vector_length(this));\n+    __ vsetvli_helper(bt, Matcher::vector_length(this));\n+    if ((uint)($con$$constant) == 0) {\n@@ -2988,0 +2986,6 @@\n+    } else if ((uint)($con$$constant) == Matcher::vector_length(this)) {\n+      __ vmset_m(as_VectorRegister($dst$$reg));\n+    } else {\n+      assert((uint)($con$$constant) < Matcher::vector_length(this), \"unsupported input lane_cnt\");\n+      __ vid_v(as_VectorRegister($dst$$reg));\n+      __ vmsleu_vi(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), (uint)($con$$constant) - 1);\n@@ -2989,2 +2993,0 @@\n-    __ vsetvli_helper(bt, (uint)($con$$constant));\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n@@ -3554,1 +3556,1 @@\n-instruct mcompress(vRegMask dst, vRegMask src, iRegLNoSp tmp) %{\n+instruct mcompress(vRegMask dst, vRegMask src, vReg tmp) %{\n@@ -3556,1 +3558,1 @@\n-  effect(TEMP_DEF dst, TEMP tmp);\n+  effect(TEMP tmp);\n@@ -3560,1 +3562,0 @@\n-    Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n@@ -3562,4 +3563,3 @@\n-    __ vmclr_m(as_VectorRegister($dst$$reg));\n-    __ vcpop_m($tmp$$Register, as_VectorRegister($src$$reg));\n-    __ vsetvli(t0, $tmp$$Register, sew);\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n+    __ vid_v(as_VectorRegister($tmp$$reg));\n+    __ vcpop_m(t0, as_VectorRegister($src$$reg));\n+    __ vmsltu_vx(as_VectorRegister($dst$$reg), as_VectorRegister($tmp$$reg), t0);\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":19,"deletions":19,"binary":false,"changes":38,"status":"modified"}]}