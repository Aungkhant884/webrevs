{"files":[{"patch":"@@ -1901,7 +1901,7 @@\n-      \/\/ T_SHORT\n-      vsetvli(t0, t0, Assembler::e16, Assembler::mf2);\n-      vncvt_x_x_w(dst, src);\n-      if (dst_bt == T_BYTE) {\n-        vsetvli(t0, t0, Assembler::e8, Assembler::mf2);\n-        vncvt_x_x_w(dst, dst);\n-      }\n+    \/\/ T_SHORT\n+    vsetvli(t0, t0, Assembler::e16, Assembler::mf2);\n+    vncvt_x_x_w(dst, src);\n+    if (dst_bt == T_BYTE) {\n+      vsetvli(t0, t0, Assembler::e8, Assembler::mf2);\n+      vncvt_x_x_w(dst, dst);\n+    }\n@@ -1923,2 +1923,0 @@\n-VFCVT_SAFE(vfwcvt_rtz_x_f_v);\n-VFCVT_SAFE(vfncvt_rtz_x_f_w);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":7,"deletions":9,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -245,2 +245,0 @@\n-  void vfwcvt_rtz_x_f_v_safe(VectorRegister dst, VectorRegister src);\n-  void vfncvt_rtz_x_f_w_safe(VectorRegister dst, VectorRegister src);\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3202,1 +3202,4 @@\n-    __ vsetvli_helper(T_SHORT, Matcher::vector_length(this), Assembler::mf2);\n+    BasicType bt = Matcher::vector_element_basic_type(this);\n+    __ integer_extend_v(as_VectorRegister($dst$$reg), (bt == T_FLOAT ? T_INT : T_LONG),\n+                        Matcher::vector_length(this), as_VectorRegister($src$$reg), T_SHORT);\n+    __ vsetvli_helper(bt, Matcher::vector_length(this));\n@@ -3204,5 +3207,1 @@\n-    __ vfwcvt_f_x_v(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg));\n-    if (Matcher::vector_element_basic_type(this) == T_DOUBLE) {\n-      __ vsetvli_helper(T_FLOAT, Matcher::vector_length(this), Assembler::mf2);\n-      __ vfwcvt_f_f_v(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg));\n-    }\n+    __ vfcvt_f_x_v(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg));\n@@ -3314,6 +3313,5 @@\n-    __ vsetvli_helper(T_SHORT, Matcher::vector_length(this), Assembler::mf2);\n-    __ vfncvt_rtz_x_f_w_safe(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg));\n-    if (Matcher::vector_element_basic_type(this) == T_BYTE) {\n-      __ vsetvli_helper(T_BYTE, Matcher::vector_length(this), Assembler::mf2);\n-      __ vncvt_x_x_w(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg));\n-    }\n+    __ vsetvli_helper(T_FLOAT, Matcher::vector_length(this));\n+    __ vfcvt_rtz_x_f_v_safe(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg));\n+    BasicType bt = Matcher::vector_element_basic_type(this);\n+    __ integer_narrow_v(as_VectorRegister($dst$$reg), bt, Matcher::vector_length(this),\n+                        as_VectorRegister($dst$$reg), T_INT);\n@@ -3342,0 +3340,2 @@\n+    __ vsetvli_helper(T_LONG, Matcher::vector_length(this));\n+    __ vxor_vv(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg));\n@@ -3343,1 +3343,2 @@\n-    __ vfwcvt_rtz_x_f_v_safe(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg));\n+    __ vmfeq_vv(as_VectorRegister($v0$$reg), as_VectorRegister($src$$reg), as_VectorRegister($src$$reg));\n+    __ vfwcvt_rtz_x_f_v(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg), Assembler::v0_t);\n@@ -3371,0 +3372,2 @@\n+    __ vsetvli_helper(T_DOUBLE, Matcher::vector_length(this));\n+    __ vmfeq_vv(as_VectorRegister($v0$$reg), as_VectorRegister($src$$reg), as_VectorRegister($src$$reg));\n@@ -3372,1 +3375,2 @@\n-    __ vfncvt_rtz_x_f_w_safe(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg));\n+    __ vxor_vv(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg));\n+    __ vfncvt_rtz_x_f_w(as_VectorRegister($dst$$reg), as_VectorRegister($src$$reg), Assembler::v0_t);\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":18,"deletions":14,"binary":false,"changes":32,"status":"modified"}]}