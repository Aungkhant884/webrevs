{"files":[{"patch":"@@ -130,0 +130,2 @@\n+| '--version`                                                  | print version information and exit                           |\n+\n","filename":"README.md","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -143,0 +143,12 @@\n+        String className() {\n+            return className;\n+        }\n+\n+        String javaName() {\n+            return javaName;\n+        }\n+\n+        Kind kind() {\n+            return kind;\n+        }\n+\n@@ -193,1 +205,7 @@\n-        append(fieldName + \" = RuntimeHelper.downcallHandle(\\n\");\n+        append(fieldName + \" = RuntimeHelper.\");\n+        if (isVarargs) {\n+            append(\"downcallHandleVariadic\");\n+        } else {\n+            append(\"downcallHandle\");\n+        }\n+        append(\"(\\n\");\n@@ -202,3 +220,0 @@\n-        append(\", \");\n-        \/\/ isVariadic\n-        append(isVarargs);\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/ConstantBuilder.java","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -98,2 +98,2 @@\n-            append(\"return RuntimeHelper.upcallStub(\" + className() + \".class, fi, \" + functionDesc.accessExpression() + \", \" +\n-                    \"\\\"\" + fiType.toMethodDescriptorString() + \"\\\", scope);\\n\");\n+            append(\"return RuntimeHelper.upcallStub(\" + className() + \".class, fi, \" +\n+                functionDesc.accessExpression() + \", scope);\\n\");\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/FunctionalInterfaceBuilder.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -133,5 +133,3 @@\n-        append(\"var mh$ = RuntimeHelper.requireNonNull(\");\n-        append(mhConstant.accessExpression());\n-        append(\", \\\"\");\n-        append(nativeName);\n-        append(\"\\\");\\n\");\n+        append(\"var mh$ = \");\n+        append(mhConstant.kind().fieldName(javaName));\n+        append(\"();\\n\");\n","filename":"src\/main\/java\/org\/openjdk\/jextract\/impl\/HeaderFileBuilder.java","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -58,7 +58,4 @@\n-    static final MethodHandle downcallHandle(String name, FunctionDescriptor fdesc, boolean variadic) {\n-        return SYMBOL_LOOKUP.lookup(name).map(\n-                addr -> {\n-                    return variadic ?\n-                        VarargsInvoker.make(addr, fdesc) :\n-                        LINKER.downcallHandle(addr, fdesc);\n-                }).orElse(null);\n+    static final MethodHandle downcallHandle(String name, FunctionDescriptor fdesc) {\n+        return SYMBOL_LOOKUP.lookup(name).\n+                map(addr -> LINKER.downcallHandle(addr, fdesc)).\n+                orElse(null);\n@@ -67,4 +64,1 @@\n-    static final MethodHandle downcallHandle(FunctionDescriptor fdesc, boolean variadic) {\n-        if (variadic) {\n-            throw new AssertionError(\"Cannot get here!\");\n-        }\n+    static final MethodHandle downcallHandle(FunctionDescriptor fdesc) {\n@@ -74,1 +68,7 @@\n-    static final <Z> NativeSymbol upcallStub(Class<Z> fi, Z z, FunctionDescriptor fdesc, String mtypeDesc, ResourceScope scope) {\n+    static final MethodHandle downcallHandleVariadic(String name, FunctionDescriptor fdesc) {\n+        return SYMBOL_LOOKUP.lookup(name).\n+                map(addr -> VarargsInvoker.make(addr, fdesc)).\n+                orElse(null);\n+    }\n+\n+    static final <Z> NativeSymbol upcallStub(Class<Z> fi, Z z, FunctionDescriptor fdesc, ResourceScope scope) {\n@@ -76,2 +76,1 @@\n-            MethodHandle handle = MH_LOOKUP.findVirtual(fi, \"apply\",\n-                    MethodType.fromMethodDescriptorString(mtypeDesc, LOADER));\n+            MethodHandle handle = MH_LOOKUP.findVirtual(fi, \"apply\", CLinker.upcallType(fdesc));\n","filename":"src\/main\/resources\/org\/openjdk\/jextract\/impl\/resources\/RuntimeHelper.java.template","additions":13,"deletions":14,"binary":false,"changes":27,"status":"modified"}]}