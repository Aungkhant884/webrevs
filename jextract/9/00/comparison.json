{"files":[{"patch":"@@ -9,0 +9,7 @@\n+Before starting, please make sure `JAVA_HOME` points and jdk 18:\n+\n+```sh\n+$ echo $JAVA_HOME\n+\/path\/to\/jdk18\n+```\n+\n@@ -12,1 +19,1 @@\n-$ sh .\/gradlew -Pjdk18_home=<jdk18_home_dir> -Pllvm_home=<libclang_dir> clean verify\n+$ sh .\/gradlew -Pllvm_home=<llvm_dir> clean verify\n@@ -41,1 +48,1 @@\n-$ sh .\/gradlew -Pjdk18_home=<jdk18_home_dir> -Pllvm_home=<libclang_dir> jtreg\n+$ sh .\/gradlew -Pllvm_home=<llvm_dir> -Pjtreg_home=<jtreg_dir> jtreg\n","filename":"README.md","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -4,0 +4,1 @@\n+import java.util.Properties;\n@@ -16,1 +17,5 @@\n-    if (!Files.exists(Path.of(p))) {\n+    checkPath(Path.of(p));\n+}\n+\n+def static checkPath(Path p) {\n+    if (!Files.exists(p)) {\n@@ -21,0 +26,23 @@\n+def static checkJDKRelease(String java_home, String expectedVersion) {\n+    Path releaseFile = Path.of(java_home).resolve(\"release\");\n+    checkPath(releaseFile);\n+\n+    Properties props = new Properties();\n+    try (InputStream input = Files.newInputStream(releaseFile)) {\n+        props.load(input);\n+    }\n+\n+    String foundVersion = props.getProperty(\"JAVA_VERSION\");\n+    if (foundVersion == null) {\n+        throw new IllegalArgumentException(\"Could not determine java version from ${releaseFile}\");\n+    }\n+\n+    expectedVersion = \"\\\"${expectedVersion}\\\"\"; \/\/ version in release file is quoted\n+    if (!foundVersion.equals(expectedVersion)) {\n+        throw new IllegalArgumentException(\"Incorrect java version. Expected ${expectedVersion}, but found ${foundVersion}\");\n+    }\n+}\n+\n+def java_home = System.getProperty(\"java.home\");\n+checkJDKRelease(java_home, \"18\");\n+\n@@ -59,1 +87,1 @@\n-    options.forkOptions.executable = \"${jdk18_home}\/bin\/javac\"\n+    options.forkOptions.executable = \"${java_home}\/bin\/javac\"\n@@ -68,3 +96,0 @@\n-    \/\/ moditect uses java.home to find JDK tools\n-    System.setProperty(\"java.home\", \"$jdk18_home\")\n-\n@@ -168,1 +193,1 @@\n-    modulePath = [file(\"$buildDir\/modules\"),file(\"$jdk18_home\/jmods\")]\n+    modulePath = [file(\"$buildDir\/modules\"),file(\"$java_home\/jmods\")]\n","filename":"build.gradle","additions":31,"deletions":6,"binary":false,"changes":37,"status":"modified"}]}