{"files":[{"patch":"@@ -1,52 +1,64 @@\n-default: all\n-\n-.NOTPARALLEL:\n-\n-include make\/Common.gmk\n-\n-JEXTRACT_NATIVE_TEST_DIR ?= $(JEXTRACT_IMAGE_NATIVE_TEST_DIR)\n-JEXTRACT_TEST_JDK ?= $(JEXTRACT_IMAGE_TEST_JDK_DIR)\n-JEXTRACT_DIR ?= $(JEXTRACT_IMAGE_DIR)\n-\n-TEST ?= test\n-\n-all: bundles\n-\n-TARGETS += all\n-\n-\n-image images test-image bundles:\n-\t$(MAKE) -f make\/Build.gmk $@\n-\n-TARGETS += image images test-image bundles\n-\n-\n-verify: test test-integration\n-\n-TARGETS += verify\n-\n-\n-test-prebuilt:\n-\t@( \\\n-\t    $(MAKE) --no-print-directory -r -R -I make\/common\/ -f make\/RunTestsPrebuilt.gmk \\\n-\t        test-prebuilt $(MAKE_ARGS) \\\n-\t        JEXTRACT_TEST_JDK=\"$(JEXTRACT_TEST_JDK)\" \\\n-\t        JEXTRACT_NATIVE_TEST_DIR=\"$(JEXTRACT_NATIVE_TEST_DIR)\" \\\n-\t        JEXTRACT_DIR=\"$(JEXTRACT_DIR)\" \\\n-\t        TEST=\"$(TEST)\" \\\n-\t)\n-\n-TARGETS += test-prebuilt\n-\n-\n-test: image test-image test-prebuilt\n-\n-TARGETS += test\n-\n-clean:\n-\trm -rf $(BUILD_DIR)\n-\n-TARGETS += clean\n-\n-\n-.PHONY: default $(TARGETS)\n+#\n+# Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+###\n+### This file is just a very small wrapper needed to run the real make\/Init.gmk.\n+### It also performs some sanity checks on make.\n+###\n+\n+# The shell code below will be executed on \/usr\/bin\/make on Solaris, but not in GNU Make.\n+# \/usr\/bin\/make lacks basically every other flow control mechanism.\n+.TEST_FOR_NON_GNUMAKE:sh=echo You are not using GNU Make\/gmake, this is a requirement. Check your path. 1>&2 && exit 1\n+\n+# The .FEATURES variable is likely to be unique for GNU Make.\n+ifeq ($(.FEATURES), )\n+  $(info Error: '$(MAKE)' does not seem to be GNU Make, which is a requirement.)\n+  $(info Check your path, or upgrade to GNU Make 3.81 or newer.)\n+  $(error Cannot continue)\n+endif\n+\n+# Assume we have GNU Make, but check version.\n+ifeq ($(strip $(foreach v, 3.81% 3.82% 4.%, $(filter $v, $(MAKE_VERSION)))), )\n+  $(info Error: This version of GNU Make is too low ($(MAKE_VERSION)).)\n+  $(info Check your path, or upgrade to GNU Make 3.81 or newer.)\n+  $(error Cannot continue)\n+endif\n+\n+# In Cygwin, the MAKE variable gets prepended with the current directory if the\n+# make executable is called using a Windows mixed path (c:\/cygwin\/bin\/make.exe).\n+ifneq ($(findstring :, $(MAKE)), )\n+  MAKE := $(patsubst $(CURDIR)%, %, $(patsubst $(CURDIR)\/%, %, $(MAKE)))\n+endif\n+\n+# Locate this Makefile\n+ifeq ($(filter \/%, $(lastword $(MAKEFILE_LIST))),)\n+  makefile_path := $(CURDIR)\/$(strip $(lastword $(MAKEFILE_LIST)))\n+else\n+  makefile_path := $(lastword $(MAKEFILE_LIST))\n+endif\n+topdir := $(strip $(patsubst %\/, %, $(dir $(makefile_path))))\n+\n+# ... and then we can include the real makefile\n+include $(topdir)\/make\/Init.gmk\n","filename":"Makefile","additions":64,"deletions":52,"binary":false,"changes":116,"status":"modified"},{"patch":"@@ -104,0 +104,2 @@\n+AWK := awk\n+EXPR := expr\n","filename":"make\/Common.gmk","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,79 @@\n+#\n+# Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+# This code is free software; you can redistribute it and\/or modify it\n+# under the terms of the GNU General Public License version 2 only, as\n+# published by the Free Software Foundation.  Oracle designates this\n+# particular file as subject to the \"Classpath\" exception as provided\n+# by Oracle in the LICENSE file that accompanied this code.\n+#\n+# This code is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# version 2 for more details (a copy is included in the LICENSE file that\n+# accompanied this code).\n+#\n+# You should have received a copy of the GNU General Public License version\n+# 2 along with this work; if not, write to the Free Software Foundation,\n+# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+#\n+# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+# or visit www.oracle.com if you need additional information or have any\n+# questions.\n+#\n+\n+default: all\n+\n+.NOTPARALLEL:\n+\n+include $(topdir)\/make\/Common.gmk\n+\n+JEXTRACT_NATIVE_TEST_DIR ?= $(JEXTRACT_IMAGE_NATIVE_TEST_DIR)\n+JEXTRACT_TEST_JDK ?= $(JEXTRACT_IMAGE_TEST_JDK_DIR)\n+JEXTRACT_DIR ?= $(JEXTRACT_IMAGE_DIR)\n+\n+TEST ?= test\n+\n+all: bundles\n+\n+TARGETS += all\n+\n+\n+image images test-image bundles:\n+\t( cd $(topdir) && \\\n+\t    $(MAKE) -f $(topdir)\/make\/Build.gmk $@)\n+\n+TARGETS += image images test-image bundles\n+\n+\n+verify: test test-integration\n+\n+TARGETS += verify\n+\n+\n+test-prebuilt:\n+\t@( cd $(topdir) && \\\n+\t    $(MAKE) --no-print-directory -r -R -f $(topdir)\/make\/RunTestsPrebuilt.gmk \\\n+\t        test-prebuilt $(MAKE_ARGS) \\\n+\t        JEXTRACT_TEST_JDK=\"$(JEXTRACT_TEST_JDK)\" \\\n+\t        JEXTRACT_NATIVE_TEST_DIR=\"$(JEXTRACT_NATIVE_TEST_DIR)\" \\\n+\t        JEXTRACT_DIR=\"$(JEXTRACT_DIR)\" \\\n+\t\t\tCUSTOM_ROOT=\"$(CUSTOM_ROOT)\" \\\n+\t        TEST=\"$(TEST)\" \\\n+\t)\n+\n+TARGETS += test-prebuilt\n+\n+\n+test: image test-image test-prebuilt\n+\n+TARGETS += test\n+\n+clean:\n+\trm -rf $(BUILD_DIR)\n+\n+TARGETS += clean\n+\n+\n+.PHONY: default $(TARGETS)\n","filename":"make\/Init.gmk","additions":79,"deletions":0,"binary":false,"changes":79,"status":"added"},{"patch":"@@ -20,1 +20,0 @@\n-$(eval $(call SetupVariable,OUTPUTDIR,$(BUILD_DIR),MKDIR))\n@@ -29,0 +28,12 @@\n+ifeq ($(CUSTOM_ROOT), )\n+  JTREG_TOPDIR := $(TOPDIR)\n+else\n+  JTREG_TOPDIR := $(CUSTOM_ROOT)\n+endif\n+\n+ifeq ($(OUTPUTDIR), )\n+  JTREG_OUTPUT_DIR := $(BUILD_DIR)\n+else\n+  JTREG_OUTPUT_DIR := $(OUTPUTDIR)\n+endif\n+\n@@ -35,1 +46,1 @@\n-TEST_SOURCE_ROOT := $(TOPDIR)\/open\/test\/java\n+TEST_SOURCE_ROOT := $(TOPDIR)\/open\/test\n@@ -42,2 +53,2 @@\n-  $1_TEST_RESULTS_DIR := $$(OUTPUTDIR)\/test-results\/$1\n-  $1_TEST_SUPPORT_DIR := $$(OUTPUTDIR)\/test-support\/$1\n+  $1_TEST_RESULTS_DIR := $$(JTREG_OUTPUT_DIR)\/test-results\/$1\n+  $1_TEST_SUPPORT_DIR := $$(JTREG_OUTPUT_DIR)\/test-support\/$1\n@@ -53,1 +64,1 @@\n-\t    -dir:$$(TOPDIR) \\\n+\t    -dir:$$(JTREG_TOPDIR) \\\n@@ -65,0 +76,2 @@\n+  $1_RESULT_FILE := $$($1_TEST_RESULTS_DIR)\/text\/stats.txt\n+\n@@ -66,1 +79,21 @@\n-\t@$$(ECHO) \"Would parse test results here\"\n+\t$$(if $$(wildcard $$($1_RESULT_FILE)), \\\n+\t  $$(eval $1_PASSED := $$(shell $$(AWK) '{ gsub(\/[,;]\/, \"\"); \\\n+\t      for (i=1; i<=NF; i++) { if ($$$$i == \"passed:\") \\\n+\t      print $$$$(i+1) } }' $$($1_RESULT_FILE))) \\\n+\t  $$(if $$($1_PASSED), , $$(eval $1_PASSED := 0)) \\\n+\t  $$(eval $1_FAILED := $$(shell $$(AWK) '{gsub(\/[,;]\/, \"\"); \\\n+\t      for (i=1; i<=NF; i++) { if ($$$$i == \"failed:\") \\\n+\t      print $$$$(i+1) } }' $$($1_RESULT_FILE))) \\\n+\t  $$(if $$($1_FAILED), , $$(eval $1_FAILED := 0)) \\\n+\t  $$(eval $1_ERROR := $$(shell $$(AWK) '{gsub(\/[,;]\/, \"\"); \\\n+\t      for (i=1; i<=NF; i++) { if ($$$$i == \"error:\") \\\n+\t      print $$$$(i+1) } }' $$($1_RESULT_FILE))) \\\n+\t  $$(if $$($1_ERROR), , $$(eval $1_ERROR := 0)) \\\n+\t  $$(eval $1_TOTAL := $$(shell \\\n+\t      $$(EXPR) $$($1_PASSED) + $$($1_FAILED) + $$($1_ERROR))) \\\n+\t, \\\n+\t  $$(eval $1_PASSED := 0) \\\n+\t  $$(eval $1_FAILED := 0) \\\n+\t  $$(eval $1_ERROR := 1) \\\n+\t  $$(eval $1_TOTAL := 1) \\\n+\t)\n","filename":"make\/RunTestsPrebuilt.gmk","additions":39,"deletions":6,"binary":false,"changes":45,"status":"modified"}]}