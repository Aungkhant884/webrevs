{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n-    private String prompt;\n+    private final String prompt;\n@@ -49,1 +49,1 @@\n-    private String[] choices;\n+    private final String[] choices;\n@@ -54,1 +54,1 @@\n-    private int defaultChoice;\n+    private final int defaultChoice;\n@@ -60,1 +60,1 @@\n-    private boolean multipleSelectionsAllowed;\n+    private final boolean multipleSelectionsAllowed;\n@@ -112,1 +112,1 @@\n-        this.choices = choices;\n+        this.choices = choices.clone();\n@@ -136,1 +136,1 @@\n-        return choices;\n+        return choices.clone();\n@@ -195,1 +195,1 @@\n-        this.selections = selections;\n+        this.selections = selections == null ? null : selections.clone();\n@@ -209,1 +209,1 @@\n-        return selections;\n+        return selections == null ? null : selections.clone();\n","filename":"jdk\/src\/share\/classes\/javax\/security\/auth\/callback\/ChoiceCallback.java","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -123,0 +123,1 @@\n+\n@@ -127,1 +128,1 @@\n-    private String prompt;\n+    private final String prompt;\n@@ -132,1 +133,1 @@\n-    private int messageType;\n+    private final int messageType;\n@@ -137,1 +138,1 @@\n-    private int optionType = UNSPECIFIED_OPTION;\n+    private final int optionType;\n@@ -142,1 +143,1 @@\n-    private int defaultOption;\n+    private final int defaultOption;\n@@ -147,1 +148,1 @@\n-    private String[] options;\n+    private final String[] options;\n@@ -209,0 +210,1 @@\n+        this.prompt = null;\n@@ -211,0 +213,1 @@\n+        this.options = null;\n@@ -258,0 +261,1 @@\n+        this.prompt = null;\n@@ -259,1 +263,2 @@\n-        this.options = options;\n+        this.optionType = UNSPECIFIED_OPTION;\n+        this.options = options.clone();\n@@ -326,0 +331,1 @@\n+        this.options = null;\n@@ -380,1 +386,2 @@\n-        this.options = options;\n+        this.optionType = UNSPECIFIED_OPTION;\n+        this.options = options.clone();\n@@ -440,1 +447,1 @@\n-        return options;\n+        return options == null ? null : options.clone();\n","filename":"jdk\/src\/share\/classes\/javax\/security\/auth\/callback\/ConfirmationCallback.java","additions":16,"deletions":9,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -0,0 +1,96 @@\n+\/*\n+ * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8242330\n+ * @library \/lib\/testlibrary\n+ * @summary Arrays should be cloned in several JAAS Callback classes\n+ *\/\n+\n+import javax.security.auth.callback.ChoiceCallback;\n+import javax.security.auth.callback.ConfirmationCallback;\n+\n+import static jdk.testlibrary.Asserts.assertEQ;\n+\n+public class Mutability {\n+    public static void main(String[] args) {\n+\n+        \/\/ #1. ConfirmationCallback.new(3)\n+        String[] i11 = {\"1\", \"2\"};\n+        ConfirmationCallback c1 = new ConfirmationCallback(\n+                ConfirmationCallback.INFORMATION,\n+                i11,\n+                0);\n+\n+        \/\/ Modify argument of constructor\n+        i11[0] = \"x\";\n+        String[] o11 = c1.getOptions();\n+        assertEQ(o11[0], \"1\");\n+        \/\/ Modify output\n+        o11[0] = \"y\";\n+        String[] o12 = c1.getOptions();\n+        assertEQ(o12[0], \"1\");\n+\n+        \/\/ #2. ConfirmationCallback.new(4)\n+        String[] i21 = {\"1\", \"2\"};\n+        ConfirmationCallback c2 = new ConfirmationCallback(\n+                \"Hi\",\n+                ConfirmationCallback.INFORMATION,\n+                i21,\n+                0);\n+\n+        \/\/ Modify argument of constructor\n+        i21[0] = \"x\";\n+        assertEQ(c2.getOptions()[0], \"1\");\n+\n+        \/\/ #3. ChoiceCallback.new\n+        String[] i31 = {\"1\", \"2\"};\n+        ChoiceCallback c3 = new ChoiceCallback(\n+                \"Hi\",\n+                i31,\n+                0,\n+                true);\n+\n+        \/\/ Modify argument of constructor\n+        i31[0] = \"x\";\n+        String[] o31 = c3.getChoices();\n+        assertEQ(o31[0], \"1\");\n+        \/\/ Modify output of getChoices\n+        o31[0] = \"y\";\n+        String[] o32 = c3.getChoices();\n+        assertEQ(o32[0], \"1\");\n+\n+        int[] s31 = {0, 1};\n+        c3.setSelectedIndexes(s31);\n+\n+        \/\/ Modify argument of setSelectedIndexes\n+        s31[0] = 1;\n+        int[] s32 = c3.getSelectedIndexes();\n+        assertEQ(s32[0], 0);\n+        \/\/ Modify output of getSelectedIndexes\n+        s32[1] = 0;\n+        int[] s33 = c3.getSelectedIndexes();\n+        assertEQ(s33[1], 1);\n+    }\n+}\n","filename":"jdk\/test\/javax\/security\/auth\/callback\/Mutability.java","additions":96,"deletions":0,"binary":false,"changes":96,"status":"added"}]}