{"files":[{"patch":"@@ -186,0 +186,1 @@\n+    NSString *nsVerStr = NULL;\n@@ -193,1 +194,1 @@\n-        NSString *nsVerStr;\n+\n@@ -205,2 +206,0 @@\n-            \/\/ Copy out the char*\n-            osVersionCStr = strdup([nsVerStr UTF8String]);\n@@ -209,1 +208,2 @@\n-            \/\/ AKA 11.x; compute the version number from the letter in the ProductBuildVersion\n+            \/\/ AKA 11+ Read the *real* ProductVersion from the hidden link to avoid SYSTEM_VERSION_COMPAT\n+            \/\/ If not found, fallback below to the SystemVersion.plist\n@@ -211,1 +211,1 @@\n-                             @\"\/System\/Library\/CoreServices\/SystemVersion.plist\"];\n+                             @\"\/System\/Library\/CoreServices\/.SystemVersionPlatform.plist\"];\n@@ -213,8 +213,1 @@\n-                NSString *nsBuildVerStr = [version objectForKey : @\"ProductBuildVersion\"];\n-                if (nsBuildVerStr != NULL && nsBuildVerStr.length >= 3) {\n-                    int letter = [nsBuildVerStr characterAtIndex:2];\n-                    if (letter >= 'B' && letter <= 'Z') {\n-                        int vers = letter - 'A' - 1;\n-                        asprintf(&osVersionCStr, \"11.%d\", vers);\n-                    }\n-                }\n+                nsVerStr = [version objectForKey : @\"ProductVersion\"];\n@@ -225,1 +218,1 @@\n-    if (osVersionCStr == NULL) {\n+    if (nsVerStr == NULL) {\n@@ -229,4 +222,1 @@\n-            NSString *nsVerStr = [version objectForKey : @\"ProductVersion\"];\n-            if (nsVerStr != NULL) {\n-                osVersionCStr = strdup([nsVerStr UTF8String]);\n-            }\n+            nsVerStr = [version objectForKey : @\"ProductVersion\"];\n@@ -235,0 +225,5 @@\n+\n+    if (nsVerStr != NULL) {\n+        \/\/ Copy out the char*\n+        osVersionCStr = strdup([nsVerStr UTF8String]);\n+    }\n","filename":"jdk\/src\/solaris\/native\/java\/lang\/java_props_macosx.c","additions":13,"deletions":18,"binary":false,"changes":31,"status":"modified"}]}