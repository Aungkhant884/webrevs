{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -186,0 +186,1 @@\n+    NSString *nsVerStr = NULL;\n@@ -193,4 +194,12 @@\n-        NSString *nsVerStr;\n-        if (osVer.patchVersion == 0) { \/\/ Omit trailing \".0\"\n-            nsVerStr = [NSString stringWithFormat:@\"%ld.%ld\",\n-                    (long)osVer.majorVersion, (long)osVer.minorVersion];\n+\n+        \/\/ Copy out the char* if running on version other than 10.16 Mac OS (10.16 == 11.x)\n+        \/\/ or explicitly requesting version compatibility\n+        if (!((long)osVer.majorVersion == 10 && (long)osVer.minorVersion >= 16) ||\n+                (getenv(\"SYSTEM_VERSION_COMPAT\") != NULL)) {\n+            if (osVer.patchVersion == 0) { \/\/ Omit trailing \".0\"\n+                nsVerStr = [NSString stringWithFormat:@\"%ld.%ld\",\n+                        (long)osVer.majorVersion, (long)osVer.minorVersion];\n+            } else {\n+                nsVerStr = [NSString stringWithFormat:@\"%ld.%ld.%ld\",\n+                        (long)osVer.majorVersion, (long)osVer.minorVersion, (long)osVer.patchVersion];\n+            }\n@@ -198,2 +207,8 @@\n-            nsVerStr = [NSString stringWithFormat:@\"%ld.%ld.%ld\",\n-                    (long)osVer.majorVersion, (long)osVer.minorVersion, (long)osVer.patchVersion];\n+            \/\/ Version 10.16, without explicit env setting of SYSTEM_VERSION_COMPAT\n+            \/\/ AKA 11+ Read the *real* ProductVersion from the hidden link to avoid SYSTEM_VERSION_COMPAT\n+            \/\/ If not found, fallback below to the SystemVersion.plist\n+            NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile :\n+                             @\"\/System\/Library\/CoreServices\/.SystemVersionPlatform.plist\"];\n+            if (version != NULL) {\n+                nsVerStr = [version objectForKey : @\"ProductVersion\"];\n+            }\n@@ -201,2 +216,0 @@\n-        \/\/ Copy out the char*\n-        osVersionCStr = strdup([nsVerStr UTF8String]);\n@@ -205,1 +218,1 @@\n-    if (osVersionCStr == NULL) {\n+    if (nsVerStr == NULL) {\n@@ -209,4 +222,1 @@\n-            NSString *nsVerStr = [version objectForKey : @\"ProductVersion\"];\n-            if (nsVerStr != NULL) {\n-                osVersionCStr = strdup([nsVerStr UTF8String]);\n-            }\n+            nsVerStr = [version objectForKey : @\"ProductVersion\"];\n@@ -215,0 +225,5 @@\n+\n+    if (nsVerStr != NULL) {\n+        \/\/ Copy out the char*\n+        osVersionCStr = strdup([nsVerStr UTF8String]);\n+    }\n","filename":"jdk\/src\/solaris\/native\/java\/lang\/java_props_macosx.c","additions":29,"deletions":14,"binary":false,"changes":43,"status":"modified"}]}