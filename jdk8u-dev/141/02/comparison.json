{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,0 +23,1 @@\n+\n@@ -28,0 +29,1 @@\n+import java.util.concurrent.atomic.AtomicInteger;\n@@ -41,1 +43,26 @@\n-    private static volatile int wheelRotation;\n+\n+    private static AtomicInteger wheelRotation = new AtomicInteger();\n+    private static int wheelSign = OSInfo.getOSType().equals(OSInfo.OSType.MACOSX) ? -1 : 1;\n+\n+    static Robot robot;\n+\n+    static void waitTillSuccess(int i) {\n+        boolean success = false;\n+\n+        for (int t = 0; t < 5; t++) {\n+            if (i == wheelSign * wheelRotation.get()) {\n+                success = true;\n+                break;\n+            }\n+            System.out.printf(\n+                    \"attempt #%d failed. wheelRotation = %d, expected value = %d\\n\",\n+                    t, wheelRotation.get(), i\n+            );\n+            robot.delay(100);\n+        }\n+\n+        if (!success) {\n+            throw new RuntimeException(\"wheelRotation = \" + wheelRotation.get()\n+                    + \", expected value = \" + i);\n+        }\n+    }\n@@ -44,0 +71,1 @@\n+        robot = new Robot();\n@@ -47,2 +75,0 @@\n-            int wheelSign = OSInfo.getOSType().equals(OSInfo.OSType.MACOSX) ? -1 : 1;\n-\n@@ -52,1 +78,1 @@\n-            button.addMouseWheelListener(e -> wheelRotation = e.getWheelRotation());\n+            button.addMouseWheelListener(e -> wheelRotation.addAndGet(e.getWheelRotation()));\n@@ -54,0 +80,1 @@\n+            frame.setLocationRelativeTo(null);\n@@ -56,1 +83,0 @@\n-            Robot robot = new Robot();\n@@ -70,0 +96,3 @@\n+\n+                wheelRotation.set(0);\n+\n@@ -72,4 +101,2 @@\n-                if (i != wheelSign * wheelRotation) {\n-                    throw new RuntimeException(\"wheelRotation = \" + wheelRotation\n-                            + \", expected value = \" + i);\n-                }\n+\n+                waitTillSuccess(i);\n","filename":"jdk\/test\/java\/awt\/Robot\/RobotWheelTest\/RobotWheelTest.java","additions":37,"deletions":10,"binary":false,"changes":47,"status":"modified"}]}