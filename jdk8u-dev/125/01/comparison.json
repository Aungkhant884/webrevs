{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -194,3 +194,13 @@\n-        if (osVer.patchVersion == 0) { \/\/ Omit trailing \".0\"\n-            nsVerStr = [NSString stringWithFormat:@\"%ld.%ld\",\n-                    (long)osVer.majorVersion, (long)osVer.minorVersion];\n+        \/\/ Copy out the char* if running on version other than 10.16 Mac OS (10.16 == 11.x)\n+        \/\/ or explicitly requesting version compatibility\n+        if (!((long)osVer.majorVersion == 10 && (long)osVer.minorVersion >= 16) ||\n+                (getenv(\"SYSTEM_VERSION_COMPAT\") != NULL)) {\n+            if (osVer.patchVersion == 0) { \/\/ Omit trailing \".0\"\n+                nsVerStr = [NSString stringWithFormat:@\"%ld.%ld\",\n+                        (long)osVer.majorVersion, (long)osVer.minorVersion];\n+            } else {\n+                nsVerStr = [NSString stringWithFormat:@\"%ld.%ld.%ld\",\n+                        (long)osVer.majorVersion, (long)osVer.minorVersion, (long)osVer.patchVersion];\n+            }\n+            \/\/ Copy out the char*\n+            osVersionCStr = strdup([nsVerStr UTF8String]);\n@@ -198,2 +208,14 @@\n-            nsVerStr = [NSString stringWithFormat:@\"%ld.%ld.%ld\",\n-                    (long)osVer.majorVersion, (long)osVer.minorVersion, (long)osVer.patchVersion];\n+            \/\/ Version 10.16, without explicit env setting of SYSTEM_VERSION_COMPAT\n+            \/\/ AKA 11.x; compute the version number from the letter in the ProductBuildVersion\n+            NSDictionary *version = [NSDictionary dictionaryWithContentsOfFile :\n+                             @\"\/System\/Library\/CoreServices\/SystemVersion.plist\"];\n+            if (version != NULL) {\n+                NSString *nsBuildVerStr = [version objectForKey : @\"ProductBuildVersion\"];\n+                if (nsBuildVerStr != NULL && nsBuildVerStr.length >= 3) {\n+                    int letter = [nsBuildVerStr characterAtIndex:2];\n+                    if (letter >= 'B' && letter <= 'Z') {\n+                        int vers = letter - 'A' - 1;\n+                        asprintf(&osVersionCStr, \"11.%d\", vers);\n+                    }\n+                }\n+            }\n@@ -201,2 +223,0 @@\n-        \/\/ Copy out the char*\n-        osVersionCStr = strdup([nsVerStr UTF8String]);\n","filename":"jdk\/src\/solaris\/native\/java\/lang\/java_props_macosx.c","additions":28,"deletions":8,"binary":false,"changes":36,"status":"modified"}]}