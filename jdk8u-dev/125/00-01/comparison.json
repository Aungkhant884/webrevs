{"files":[{"patch":"@@ -186,1 +186,0 @@\n-    NSString *nsVerStr = NULL;\n@@ -194,1 +193,1 @@\n-\n+        NSString *nsVerStr;\n@@ -206,0 +205,2 @@\n+            \/\/ Copy out the char*\n+            osVersionCStr = strdup([nsVerStr UTF8String]);\n@@ -208,2 +209,1 @@\n-            \/\/ AKA 11+ Read the *real* ProductVersion from the hidden link to avoid SYSTEM_VERSION_COMPAT\n-            \/\/ If not found, fallback below to the SystemVersion.plist\n+            \/\/ AKA 11.x; compute the version number from the letter in the ProductBuildVersion\n@@ -211,1 +211,1 @@\n-                             @\"\/System\/Library\/CoreServices\/.SystemVersionPlatform.plist\"];\n+                             @\"\/System\/Library\/CoreServices\/SystemVersion.plist\"];\n@@ -213,1 +213,8 @@\n-                nsVerStr = [version objectForKey : @\"ProductVersion\"];\n+                NSString *nsBuildVerStr = [version objectForKey : @\"ProductBuildVersion\"];\n+                if (nsBuildVerStr != NULL && nsBuildVerStr.length >= 3) {\n+                    int letter = [nsBuildVerStr characterAtIndex:2];\n+                    if (letter >= 'B' && letter <= 'Z') {\n+                        int vers = letter - 'A' - 1;\n+                        asprintf(&osVersionCStr, \"11.%d\", vers);\n+                    }\n+                }\n@@ -218,1 +225,1 @@\n-    if (nsVerStr == NULL) {\n+    if (osVersionCStr == NULL) {\n@@ -222,1 +229,4 @@\n-            nsVerStr = [version objectForKey : @\"ProductVersion\"];\n+            NSString *nsVerStr = [version objectForKey : @\"ProductVersion\"];\n+            if (nsVerStr != NULL) {\n+                osVersionCStr = strdup([nsVerStr UTF8String]);\n+            }\n@@ -225,5 +235,0 @@\n-\n-    if (nsVerStr != NULL) {\n-        \/\/ Copy out the char*\n-        osVersionCStr = strdup([nsVerStr UTF8String]);\n-    }\n","filename":"jdk\/src\/solaris\/native\/java\/lang\/java_props_macosx.c","additions":18,"deletions":13,"binary":false,"changes":31,"status":"modified"}]}