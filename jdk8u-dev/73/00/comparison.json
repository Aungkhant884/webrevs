{"files":[{"patch":"@@ -273,0 +273,4 @@\n+static bool is_in_asgct() {\n+  Thread* current_thread = Thread::current_or_null();\n+  return current_thread != NULL && current_thread->is_Java_thread() && ((JavaThread*)current_thread)->in_asgct();\n+}\n@@ -281,2 +285,6 @@\n-  guarantee(!result->is_zombie() || result->is_locked_by_vm() || is_error_reported(), \"unsafe access to zombie method\");\n-  return result;\n+  bool is_zombie = result != NULL && result->is_zombie();\n+  bool is_result_safe = !is_zombie || result->is_locked_by_vm() || is_error_reported();\n+  guarantee(is_result_safe || is_in_asgct(), \"unsafe access to zombie method\");\n+  \/\/ When in ASGCT the previous gurantee will pass for a zombie method but we still don't want that code blob returned in order\n+  \/\/ to minimize the chance of accessing dead memory\n+  return is_result_safe ? result : NULL;\n","filename":"hotspot\/src\/share\/vm\/code\/codeCache.cpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -556,0 +556,3 @@\n+  \/\/ !important! make sure all to call thread->set_in_asgct(false) before every return\n+  thread->set_in_asgct(true);\n+\n@@ -613,0 +616,1 @@\n+  thread->set_in_asgct(false);\n","filename":"hotspot\/src\/share\/vm\/prims\/forte.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1451,0 +1451,1 @@\n+  _in_asgct = false;\n","filename":"hotspot\/src\/share\/vm\/runtime\/thread.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -783,0 +783,1 @@\n+  bool           _in_asgct;                      \/\/ Is set when this JavaThread is handling ASGCT call\n@@ -1784,0 +1785,4 @@\n+\n+  \/\/ AsyncGetCallTrace support\n+  inline bool in_asgct(void) {return _in_asgct;}\n+  inline void set_in_asgct(bool value) {_in_asgct = value;}\n","filename":"hotspot\/src\/share\/vm\/runtime\/thread.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}