{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,1 @@\n- * @bug 8014499\n+ * @bug 8014499 8219804\n@@ -33,0 +33,1 @@\n+import java.lang.management.ManagementFactory;\n@@ -45,1 +46,1 @@\n-        DatagramPacket p = new DatagramPacket(ba, ba.length);\n+        DatagramPacket p;\n@@ -47,3 +48,12 @@\n-            mc.receive(p);\n-            int recvId = Integer.parseInt(\n-                    new String(p.getData(), 0, p.getLength(), \"UTF-8\"));\n+            String data = null;\n+            while (true) {\n+                p = new DatagramPacket(ba, ba.length);\n+                mc.receive(p);\n+                data = new String(p.getData(), 0, p.getLength(), \"UTF-8\");\n+                if (data.length() > UUID.length() && data.startsWith(UUID)) {\n+                    data = data.substring(UUID.length());\n+                    break;\n+                }\n+                logUnexpected(p);\n+            }\n+            int recvId = Integer.parseInt(data);\n@@ -68,0 +78,14 @@\n+    static void logUnexpected(DatagramPacket p) {\n+        byte[] ba = p.getData();\n+        System.out.printf(\"Unexpected packet: length: %d. First three bytes: %d, %d, %d\\n\",\n+                          p.getLength(), ba[0], ba[1], ba[2]);\n+    }\n+\n+    static final String UUID; \/\/ process-id : currentTimeMillis\n+\n+    static {\n+        String s1 = ManagementFactory.getRuntimeMXBean().getName().split(\"@\")[0];\n+        String s2 = Long.toString(System.currentTimeMillis());\n+        UUID = \"<\" + s1 + s2 + \">\";\n+    }\n+\n@@ -80,1 +104,1 @@\n-            byte[] msg = Integer.toString(nextId).getBytes(\"UTF-8\");\n+            byte[] msg = (UUID + Integer.toString(nextId)).getBytes(\"UTF-8\");\n@@ -98,1 +122,1 @@\n-            msg = Integer.toString(nextId).getBytes(\"UTF-8\");\n+            msg = (UUID + Integer.toString(nextId)).getBytes(\"UTF-8\");\n@@ -132,2 +156,2 @@\n-        InetAddress ip4Group1 = InetAddress.getByName(\"224.7.8.9\");\n-        InetAddress ip4Group2 = InetAddress.getByName(\"225.4.5.6\");\n+        InetAddress ip4Group1 = InetAddress.getByName(\"224.0.0.120\");\n+        InetAddress ip4Group2 = InetAddress.getByName(\"224.0.0.121\");\n","filename":"jdk\/test\/java\/net\/MulticastSocket\/Promiscuous.java","additions":34,"deletions":10,"binary":false,"changes":44,"status":"modified"}]}