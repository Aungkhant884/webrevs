{"files":[{"patch":"@@ -89,3 +89,9 @@\n-                int midIndex = -Collections.binarySearch(removed, retainedRow, rowComparator) - 1;\n-                firstRemovedRange = removed.subList(0, midIndex);\n-                secondRemovedRange = removed.subList(midIndex, removedSize);\n+                int insertionPoint = Collections.binarySearch(removed, retainedRow, rowComparator);\n+                if (insertionPoint >= 0) {\n+                    firstRemovedRange = removed;\n+                    secondRemovedRange = Collections.emptyList();\n+                } else {\n+                    int midIndex = -insertionPoint - 1;\n+                    firstRemovedRange = removed.subList(0, midIndex);\n+                    secondRemovedRange = removed.subList(midIndex, removedSize);\n+                }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ControlUtils.java","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -355,0 +355,44 @@\n+    @Test\n+    public void ensureRowRemainsSelectedWhenSelectingCellInSameRow() {\n+        class Person {\n+            final String firstName, lastName;\n+            Person(String firstName, String lastName) {\n+                this.firstName = firstName;\n+                this.lastName = lastName;\n+            }\n+            public String getFirstName() { return firstName; }\n+            public String getLastName() { return lastName; }\n+        }\n+\n+        var tableView = new TableView<Person>();\n+        tableView.getSelectionModel().setCellSelectionEnabled(true);\n+        tableView.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);\n+\n+        var col1 = new TableColumn<Person, String>();\n+        col1.setCellValueFactory(new PropertyValueFactory<>(\"firstName\"));\n+        var col2 = new TableColumn<Person, String>();\n+        col2.setCellValueFactory(new PropertyValueFactory<>(\"lastName\"));\n+        tableView.getColumns().addAll(List.of(col1, col2));\n+\n+        var ab = new Person(\"a\", \"b\");\n+        tableView.getItems().add(ab);\n+        var cd = new Person(\"c\", \"d\");\n+        tableView.getItems().add(cd);\n+\n+        var selectionModel = tableView.getSelectionModel();\n+        selectionModel.select(0);\n+        selectionModel.clearAndSelect(0, col1);\n+\n+        \/\/ The following asserts should work once JDK-8273336 is fixed:\n+        \/\/\n+        \/\/ assertEquals(1, selectionModel.getSelectedIndices().size());\n+        \/\/ assertEquals(0, (int)selectionModel.getSelectedIndices().get(0));\n+\n+        selectionModel.clearSelection();\n+        selectionModel.selectRange(0, col1, 1, col2);\n+        selectionModel.clearAndSelect(1, col2);\n+\n+        \/\/ assertEquals(1, selectionModel.getSelectedIndices().size());\n+        \/\/ assertEquals(1, (int)selectionModel.getSelectedIndices().get(0));\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TableViewTest.java","additions":44,"deletions":0,"binary":false,"changes":44,"status":"modified"}]}