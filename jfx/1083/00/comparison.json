{"files":[{"patch":"@@ -29,0 +29,1 @@\n+import com.sun.javafx.font.FontResource;\n@@ -924,1 +925,1 @@\n-                           final float[] advances, final float x, final float y)\n+                           final float[] advances, float x, final float y)\n@@ -931,0 +932,53 @@\n+        PGFont font = (PGFont)f.getPlatformFont();\n+        final FontStrike strike = font.getStrike(getTransformNoClone(), getFontSmoothingType());\n+        final FontResource fontResource = font.getFontResource();\n+        boolean isColorGlyph = false;\n+        for (int i=0; i<glyphs.length; i++) {\n+           if (fontResource.isColorGlyph(glyphs[i])) {\n+               isColorGlyph = true;\n+               break;\n+           }\n+        }\n+        if (!isColorGlyph || glyphs.length <= 1) {\n+            drawStringInternal(f, glyphs, advances, x, y);\n+            return;\n+        }\n+        int[] emoji_glyphs = new int[1];\n+        float[] emoji_advances = new float[1];\n+        int[] char_glyphs;\n+        float[] char_advances;\n+        int chars_start = 0;\n+        int pos = 0;\n+        int len = glyphs.length;\n+        while (pos < len) {\n+            int gcode = glyphs[pos];\n+            float adv = advances[pos];\n+            isColorGlyph = fontResource.isColorGlyph(gcode);\n+            if (isColorGlyph || (pos == (len-1))) {\n+                if (chars_start < pos) { \/\/ emit non-emoji run\n+                    int run_len = pos-chars_start;\n+                    char_glyphs = new int[run_len];\n+                    char_advances = new float[run_len];\n+                    System.arraycopy(glyphs, chars_start, char_glyphs, 0, run_len);\n+                    System.arraycopy(advances, chars_start, char_advances, 0, run_len);\n+                    drawStringInternal(f, char_glyphs, char_advances, x, y);\n+                    for (int i=0; i<char_advances.length; i++) {\n+                        x += char_advances[i];\n+                    }\n+                }\n+                if (isColorGlyph) { \/\/ emit emoji\n+                    emoji_glyphs[0] = gcode;\n+                    emoji_advances[0] = adv;\n+                    drawStringInternal(f, emoji_glyphs, emoji_advances, x, y); \/\/ emit emoji\n+                    x += adv;\n+                    chars_start = pos+1;\n+                }\n+            }\n+            pos++;\n+        }\n+\n+    }\n+\n+    private void drawStringInternal(final WCFont f, final int[] glyphs,\n+                           final float[] advances, final float x, final float y) {\n+\n","filename":"modules\/javafx.web\/src\/main\/java\/com\/sun\/javafx\/webkit\/prism\/WCGraphicsPrismContext.java","additions":55,"deletions":1,"binary":false,"changes":56,"status":"modified"}]}