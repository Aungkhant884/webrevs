{"files":[{"patch":"@@ -169,3 +169,1 @@\n-static void process_dnd_target_drag_leave(WindowContext *ctx, GdkEventDND *event) {\n-    (void)event;\n-\n+static void notify_drag_leave(WindowContext *ctx) {\n@@ -232,1 +230,1 @@\n-            process_dnd_target_drag_leave(ctx, event);\n+            notify_drag_leave(ctx);\n@@ -743,2 +741,0 @@\n-    if (selected) {\n-        ctx->performed_action = translate_gdk_action_to_glass(selected);\n@@ -746,3 +742,3 @@\n-        if (is_dnd_owner) {\n-            WindowContext *window_ctx = (WindowContext*)\n-                g_object_get_data(G_OBJECT(ctx->dnd_window), GDK_WINDOW_DATA_CONTEXT);\n+    if (is_dnd_owner) {\n+        WindowContext *window_ctx = (WindowContext*)\n+            g_object_get_data(G_OBJECT(ctx->dnd_window), GDK_WINDOW_DATA_CONTEXT);\n@@ -750,0 +746,1 @@\n+        if (selected) {\n@@ -752,1 +749,1 @@\n-            gdk_drag_drop(ctx->dnd_ctx, GDK_CURRENT_TIME);\n+            notify_drag_leave(window_ctx);\n@@ -755,1 +752,6 @@\n-        gdk_drag_abort(ctx->dnd_ctx, GDK_CURRENT_TIME);\n+        if (selected) {\n+            ctx->performed_action = translate_gdk_action_to_glass(selected);\n+            gdk_drag_drop(ctx->dnd_ctx, GDK_CURRENT_TIME);\n+        } else {\n+            gdk_drag_abort(ctx->dnd_ctx, GDK_CURRENT_TIME);\n+        }\n@@ -766,4 +768,0 @@\n-    if (ctx->drag_view) {\n-        ctx->drag_view->move(x_root, y_root);\n-    }\n-\n@@ -850,1 +848,1 @@\n-        GdkCursor* cursor = gdk_cursor_new_from_name(gdk_display_get_default(), \"dnd-none\");\n+        cursor = gdk_cursor_new_from_name(gdk_display_get_default(), \"dnd-none\");\n@@ -958,1 +956,2 @@\n-    if (event->type == GDK_EXPOSE && ctx->drag_view != NULL && window == ctx->drag_view->get_window()) {\n+    if (ctx->drag_view != NULL && event->type == GDK_EXPOSE &&\n+        window == ctx->drag_view->get_window()) {\n@@ -963,0 +962,6 @@\n+    \/\/ dnd_window window will grab pointer motion, so it's delivered there\n+    if (event->type == GDK_MOTION_NOTIFY && ctx->drag_view != NULL\n+        && window == ctx->dnd_window) {\n+        ctx->drag_view->move(event->motion.x_root, event->motion.y_root);\n+    }\n+\n@@ -969,0 +974,4 @@\n+    if (window != ctx->dnd_window) {\n+        return;\n+    }\n+\n@@ -1020,1 +1029,0 @@\n-    \/\/TODO: should clear data?\n@@ -1157,1 +1165,1 @@\n-    attrs.event_mask = GDK_EXPOSURE_MASK | GDK_POINTER_MOTION_MASK;\n+    attrs.event_mask = GDK_EXPOSURE_MASK;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_dnd.cpp","additions":27,"deletions":19,"binary":false,"changes":46,"status":"modified"}]}