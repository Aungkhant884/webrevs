{"files":[{"patch":"@@ -181,2 +181,2 @@\n-        gdk_drop_reply(event->context, FALSE, event->time);\n-        gdk_drop_finish(event->context, FALSE, event->time);\n+        gdk_drop_finish(event->context, FALSE, GDK_CURRENT_TIME);\n+        gdk_drop_reply(event->context, FALSE, GDK_CURRENT_TIME);\n@@ -194,2 +194,2 @@\n-    gdk_drop_reply(event->context, TRUE, event->time);\n-    gdk_drop_finish(event->context, TRUE, event->time);\n+    gdk_drop_finish(event->context, TRUE, GDK_CURRENT_TIME);\n+    gdk_drop_reply(event->context, TRUE, GDK_CURRENT_TIME);\n@@ -527,14 +527,1 @@\n-    GdkGrabStatus status;\n-\n-    GdkEventMask mask = (GdkEventMask)\n-                            (GDK_POINTER_MOTION_MASK\n-                                | GDK_BUTTON_MOTION_MASK\n-                                | GDK_BUTTON1_MOTION_MASK\n-                                | GDK_BUTTON2_MOTION_MASK\n-                                | GDK_BUTTON3_MOTION_MASK\n-                                | GDK_BUTTON_PRESS_MASK\n-                                | GDK_BUTTON_RELEASE_MASK);\n-\n-    status = gdk_pointer_grab(dnd_window, FALSE, mask, NULL, cursor, GDK_CURRENT_TIME);\n-\n-    return status == GDK_GRAB_SUCCESS;\n+    return glass_gdk_mouse_devices_grab_with_cursor(dnd_window, cursor, FALSE, FALSE);\n@@ -543,1 +530,0 @@\n-\n@@ -798,0 +784,1 @@\n+    g_print(\"grab broken\\n\");\n@@ -874,10 +861,0 @@\n-static GdkCursor* get_default_drag_cursor() {\n-    GdkCursor* cursor = gdk_cursor_new_from_name(gdk_display_get_default(), \"dnd-none\");\n-\n-    if (cursor == NULL) {\n-        cursor = gdk_cursor_new_from_name(gdk_display_get_default(), \"grabbing\");\n-    }\n-\n-    return cursor;\n-}\n-\n@@ -921,1 +898,5 @@\n-        cursor = get_default_drag_cursor();\n+        GdkCursor* cursor = gdk_cursor_new_from_name(gdk_display_get_default(), \"dnd-none\");\n+\n+        if (cursor == NULL) {\n+            cursor = gdk_cursor_new_from_name(gdk_display_get_default(), \"grabbing\");\n+        }\n@@ -995,1 +976,3 @@\n-    ctx = gdk_drag_begin(src_window, targets);\n+    if (!dnd_pointer_grab(NULL)) {\n+        ERROR0(\"Mouse grab failed.\\n\");\n+    }\n@@ -997,1 +980,1 @@\n-    DragView::set_drag_view();\n+    ctx = gdk_drag_begin(src_window, targets);\n@@ -1002,3 +985,1 @@\n-    if (!dnd_pointer_grab(get_default_drag_cursor())) {\n-       g_warning(\"Mouse grab failed.\\n\");\n-    }\n+    DragView::set_drag_view();\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_dnd.cpp","additions":16,"deletions":35,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -119,0 +119,5 @@\n+\n+    if (is_in_drag()) {\n+        process_dnd_source(window, event);\n+    }\n+\n@@ -133,4 +138,0 @@\n-    if (is_in_drag()) {\n-        process_dnd_source(window, event);\n-    }\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_evloop.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -535,1 +535,1 @@\n-    return glass_gdk_mouse_devices_grab_with_cursor(gdkWindow, NULL, TRUE);\n+    return glass_gdk_mouse_devices_grab_with_cursor(gdkWindow, NULL, TRUE, TRUE);\n@@ -539,2 +539,2 @@\n-glass_gdk_mouse_devices_grab_with_cursor(GdkWindow *gdkWindow, GdkCursor *cursor, gboolean owner_events) {\n-    if (disableGrab) {\n+glass_gdk_mouse_devices_grab_with_cursor(GdkWindow *gdkWindow, GdkCursor *cursor, gboolean owner_events, gboolean obey_disable_grab) {\n+    if (disableGrab && obey_disable_grab) {\n@@ -544,9 +544,21 @@\n-    GdkGrabStatus status = gdk_pointer_grab(gdkWindow, owner_events, (GdkEventMask)\n-                                            (GDK_POINTER_MOTION_MASK\n-                                                | GDK_BUTTON_MOTION_MASK\n-                                                | GDK_BUTTON1_MOTION_MASK\n-                                                | GDK_BUTTON2_MOTION_MASK\n-                                                | GDK_BUTTON3_MOTION_MASK\n-                                                | GDK_BUTTON_PRESS_MASK\n-                                                | GDK_BUTTON_RELEASE_MASK),\n-                                            NULL, cursor, GDK_CURRENT_TIME);\n+    GdkGrabStatus status;\n+    GdkEventMask events = (GdkEventMask)\n+                                (GDK_POINTER_MOTION_MASK\n+                                    | GDK_BUTTON_MOTION_MASK\n+                                    | GDK_BUTTON1_MOTION_MASK\n+                                    | GDK_BUTTON2_MOTION_MASK\n+                                    | GDK_BUTTON3_MOTION_MASK\n+                                    | GDK_BUTTON_PRESS_MASK\n+                                    | GDK_BUTTON_RELEASE_MASK);\n+\n+#ifdef GLASS_GTK3\n+    GdkDevice *device = gdk_device_manager_get_client_pointer(\n+                                    gdk_display_get_device_manager(\n+                                        gdk_display_get_default()));\n+\n+    status = gdk_device_grab(device, gdkWindow, GDK_OWNERSHIP_APPLICATION,\n+                                owner_events, events, cursor, GDK_CURRENT_TIME);\n+#else\n+    status = gdk_pointer_grab(gdkWindow, owner_events, events,\n+                                    NULL, cursor, GDK_CURRENT_TIME);\n+#endif\n@@ -559,0 +571,6 @@\n+#ifdef GLASS_GTK3\n+    GdkDevice *device = gdk_device_manager_get_client_pointer(\n+                                    gdk_display_get_device_manager(\n+                                        gdk_display_get_default()));\n+    gdk_device_ungrab(device, GDK_CURRENT_TIME);\n+#else\n@@ -560,0 +578,1 @@\n+#endif\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.cpp","additions":31,"deletions":12,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -289,1 +289,1 @@\n-glass_gdk_mouse_devices_grab_with_cursor(GdkWindow * gdkWindow, GdkCursor *cursor, gboolean owner_events);\n+glass_gdk_mouse_devices_grab_with_cursor(GdkWindow * gdkWindow, GdkCursor *cursor, gboolean owner_events, gboolean obey_disable_grab);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -622,1 +622,1 @@\n-            gdk_window, gdk_window_get_cursor(gdk_window), FALSE)) {\n+            gdk_window, gdk_window_get_cursor(gdk_window), FALSE, TRUE)) {\n@@ -665,2 +665,2 @@\n-            glass_gdk_mouse_devices_grab_with_cursor(\n-                    WindowContextBase::sm_mouse_drag_window->get_gdk_window(), cursor, FALSE);\n+            GdkWindow* window = WindowContextBase::sm_mouse_drag_window->get_gdk_window();\n+            glass_gdk_mouse_devices_grab_with_cursor(window, cursor, FALSE, TRUE);\n@@ -668,2 +668,2 @@\n-            glass_gdk_mouse_devices_grab_with_cursor(\n-                    WindowContextBase::sm_grab_window->get_gdk_window(), cursor, TRUE);\n+            GdkWindow* window = WindowContextBase::sm_grab_window->get_gdk_window();\n+            glass_gdk_mouse_devices_grab_with_cursor(window, cursor, TRUE, TRUE);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"}]}