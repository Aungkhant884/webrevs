{"files":[{"patch":"@@ -100,1 +100,0 @@\n-    private boolean isOpaque = true;\n@@ -458,4 +457,0 @@\n-        if (!isOpaque) {\n-            clearRect((int)c.getX(), (int)c.getY(),\n-                    (int)c.getWidth(), (int)c.getHeight());\n-        }\n@@ -639,10 +634,0 @@\n-    @Override\n-    public void setOpaque(boolean opaque) {\n-        this.isOpaque = opaque;\n-    }\n-\n-    @Override\n-    public boolean isOpaque() {\n-        return isOpaque;\n-    }\n-\n","filename":"modules\/javafx.web\/src\/main\/java\/com\/sun\/javafx\/webkit\/prism\/WCGraphicsPrismContext.java","additions":0,"deletions":15,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-    private Color backgroundColor = Color.WHITE;\n+    private int backgroundIntRgba = 0xFFFFFFFF;\n@@ -378,1 +378,1 @@\n-        if (!isBackgroundOpaque()) {\n+        if (!isBackgroundColorOpaque()) {\n@@ -601,0 +601,1 @@\n+        backgroundIntRgba = backgroundColor;\n@@ -603,1 +604,1 @@\n-            log.fine(\"setBackgroundColor int32: \" + backgroundColor);\n+            log.fine(\"setBackgroundColor intRgba: {0}\", backgroundColor);\n@@ -611,1 +612,1 @@\n-            twkSetTransparent(frameID, isBackgroundTransparent());\n+            twkSetTransparent(frameID, isBackgroundColorTransparent());\n@@ -621,2 +622,1 @@\n-        this.backgroundColor = backgroundColor;\n-        setBackgroundColor(getColorInt32Value(backgroundColor));\n+        setBackgroundColor(getIntRgba(backgroundColor));\n@@ -626,0 +626,1 @@\n+        backgroundIntRgba = backgroundColor;\n@@ -628,2 +629,1 @@\n-            log.fine(\"setBackgroundColor int32: \" + backgroundColor +\n-                   \" for all frames\");\n+            log.fine(\"setBackgroundColor intRgba: {0} for all frames\", backgroundColor);\n@@ -636,1 +636,1 @@\n-                twkSetTransparent(frameID, isBackgroundTransparent());\n+                twkSetTransparent(frameID, isBackgroundColorTransparent());\n@@ -747,1 +747,0 @@\n-        gc.setOpaque(isBackgroundOpaque());\n@@ -761,2 +760,9 @@\n-                if (rq.getClip() != null) {\n-                    gc.setClip(rq.getClip());\n+                WCRectangle clip = rq.getClip();\n+                if (clip != null) {\n+                    if (isBackgroundColorTransparent()) {\n+                        \/\/ As backbuffer is enabled, new clips are drawn over the old rendered frames\n+                        \/\/ regardless the alpha channel. While that works fine for alpha > 0,\n+                        \/\/ for alpha == 0 we need to clear the old frame or it will still be visible.\n+                        gc.clearRect((int) clip.getX(), (int) clip.getY(), (int) clip.getWidth(), (int) clip.getHeight());\n+                    }\n+                    gc.setClip(clip);\n@@ -841,1 +847,1 @@\n-            if (!isBackgroundOpaque()) {\n+            if (!isBackgroundColorOpaque()) {\n@@ -863,1 +869,1 @@\n-            if (!isBackgroundOpaque()) {\n+            if (!isBackgroundColorOpaque()) {\n@@ -2554,1 +2560,1 @@\n-        setBackgroundColor(getColorInt32Value(backgroundColor));\n+        setBackgroundColor(backgroundIntRgba);\n@@ -2573,2 +2579,2 @@\n-    private boolean isBackgroundTransparent() {\n-        return backgroundColor != null && backgroundColor.getOpacity() == 0f;\n+    private boolean isBackgroundColorTransparent() {\n+        return (backgroundIntRgba & 0x000000FF) == 0;\n@@ -2577,2 +2583,2 @@\n-    private boolean isBackgroundOpaque() {\n-        return backgroundColor == null || backgroundColor.isOpaque();\n+    private boolean isBackgroundColorOpaque() {\n+        return (backgroundIntRgba & 0x000000FF) == 255;\n@@ -2581,1 +2587,1 @@\n-    private static int getColorInt32Value(Color color) {\n+    private static int getIntRgba(Color color) {\n","filename":"modules\/javafx.web\/src\/main\/java\/com\/sun\/webkit\/WebPage.java","additions":26,"deletions":20,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -62,2 +62,0 @@\n-    public abstract void setOpaque(boolean opaque);\n-    public abstract boolean isOpaque();\n","filename":"modules\/javafx.web\/src\/main\/java\/com\/sun\/webkit\/graphics\/WCGraphicsContext.java","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -155,15 +155,0 @@\n-    @Override\n-    public void setOpaque(boolean opaque) {\n-        logger.resumeCount(\"SET_OPAQUE\");\n-        gc.setOpaque(opaque);\n-        logger.suspendCount(\"SET_OPAQUE\");\n-    }\n-\n-    @Override\n-    public boolean isOpaque() {\n-        logger.resumeCount(\"IS_OPAQUE\");\n-        boolean o = gc.isOpaque();\n-        logger.suspendCount(\"IS_OPAQUE\");\n-        return o;\n-    }\n-\n","filename":"modules\/javafx.web\/src\/main\/java\/com\/sun\/webkit\/perf\/WCGraphicsPerfLogger.java","additions":0,"deletions":15,"binary":false,"changes":15,"status":"modified"}]}