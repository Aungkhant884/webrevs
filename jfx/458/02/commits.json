[{"commit":{"message":"Review fix: Use correct bug id"},"files":[{"filename":"tests\/system\/src\/test\/java\/test\/com\/sun\/webkit\/LocalStorageAccessTest.java"}],"sha":"e1de314d33d47832d065258d0fa7f87609d22c2b"},{"commit":{"message":"Revert changes to thread attachment introduced in second commit\n\nThread attachment is handled in\njfx\/modules\/javafx.web\/src\/main\/native\/Source\/WebKitLegacy\/Storage\/StorageThread.cpp\nand thus does not need to be modified."},"files":[{"filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/FileSystemJava.cpp"}],"sha":"c9ec47c9dce86106225e7a766c9e2cdc39e2c345"},{"commit":{"message":"Address review comments"},"files":[{"filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/FileSystemJava.cpp"},{"filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/JavaEnv.cpp"},{"filename":"tests\/system\/src\/testapp7\/java\/mymod\/myapp7\/LocalStorageAccessWithModuleLayer.java"},{"filename":"tests\/system\/src\/testapp7\/java\/mymod\/myapp7\/LocalStorageAccessWithModuleLayerLauncher.java"},{"filename":"tests\/system\/src\/testapp7\/resources\/mymod\/myapp7\/LocalStorageAccess.html"}],"sha":"d7cfc5675a298604ceb496620f037749c8e4d90f"},{"commit":{"message":"9069811: Fix segfault when accessing local storage in webview\n\nThe functions from FileSystemJava are called from different threads the\nroot problem manifests because the JNI FindClass function behaves\ndifferently when called from a context that is the ancestor of a java\nframe compared to when called in isolation.\n\nA segmentation fault is observed when local storage of a webview is\naccessed. At that time a new native thread is spun up and that sets up\nthe local storage, by calling into the JVM via\nWTF::FileSystem::makeAllDirectories. At that point GetFileSystemClass is\ninvoked to get a referenc to the java implementation of the FileSystem.\nAs this is is called from a new native thread (no java context\navailable), JNI uses the system classloader to locate the class. This\nfails if the JavaFX modules are not on the boot module\/class path.\n\nInstead on relying on fetching the class reference everytime it is\nneeded, this change fetches it once when the JavaFX library is loaded\nand stores it in the WTF namespace.\n\nIn addition to this it was observed, that there is no attachment to the\nJVM done when calling into the filesystem. No fault was observed, but\nthe JNI specs indicate, that the JNIEnv interface is only valid when\nattached."},"files":[{"filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/FileSystemJava.cpp"},{"filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/JavaEnv.cpp"},{"filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/JavaEnv.h"},{"filename":"tests\/system\/src\/test\/java\/test\/com\/sun\/webkit\/LocalStorageAccessTest.java"}],"sha":"0a46951594af3932fd3b05119368ce28eb5cfa1f"},{"commit":{"message":"9069811: Create reproducer for segfault when accessing local storage"},"files":[{"filename":"tests\/system\/src\/test\/java\/test\/com\/sun\/webkit\/LocalStorageAccessTest.java"},{"filename":"tests\/system\/src\/testapp7\/java\/mymod\/myapp7\/LocalStorageAccessWithModuleLayer.java"},{"filename":"tests\/system\/src\/testapp7\/java\/mymod\/myapp7\/LocalStorageAccessWithModuleLayerLauncher.java"},{"filename":"tests\/system\/src\/testapp7\/resources\/mymod\/myapp7\/LocalStorageAccess.html"}],"sha":"c04c7ceb04bcf359668acbbe6e7ee96d8baa3e77"}]