{"files":[{"patch":"@@ -234,0 +234,12 @@\n+    \/**\n+     * Returns the shape for the underline in local coordinates.\n+     *\n+     * @param start the beginning character index for the range\n+     * @param end the end character index (non-inclusive) for the range\n+     * @return an array of {@code PathElement} which can be used to create a {@code Shape}\n+     * @since 21\n+     *\/\n+    public final PathElement[] underlineShape(int start, int end) {\n+        return getRange(start, end, TextLayout.TYPE_UNDERLINE);\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/text\/TextFlow.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+    protected final CheckBox underline;\n@@ -66,0 +67,1 @@\n+    protected final Path underlinePath;\n@@ -86,0 +88,6 @@\n+        underlinePath = new Path();\n+        underlinePath.setStrokeWidth(1);\n+        underlinePath.setStroke(Color.GREEN);\n+        underlinePath.setFill(Color.YELLOW);\n+        underlinePath.setManaged(false);\n+\n@@ -107,1 +115,7 @@\n-            updateControl();\n+            updateCaret();\n+        });\n+\n+        underline = new CheckBox(\"underline shape\");\n+        underline.setId(\"underline\");\n+        underline.selectedProperty().addListener((p) -> {\n+            updateUnderline();\n@@ -119,0 +133,1 @@\n+        p.option(underline);\n@@ -145,3 +160,3 @@\n-        if (showCaretPath.isSelected()) {\n-            caretPath.getElements().clear();\n-            control.getChildren().add(caretPath);\n+        caretPath.getElements().clear();\n+        underlinePath.getElements().clear();\n+        control.getChildren().addAll(underlinePath, caretPath);\n@@ -149,6 +164,2 @@\n-            int len = computeTextLength(control);\n-            for (int i = 0; i < len; i++) {\n-                PathElement[] es = control.caretShape(i, true);\n-                caretPath.getElements().addAll(es);\n-            }\n-        }\n+        updateCaret();\n+        updateUnderline();\n@@ -163,0 +174,3 @@\n+            } else {\n+                \/\/ treat any other nodes as having length 1\n+                len++;\n@@ -164,1 +178,0 @@\n-            \/\/ embedded nodes do not have an associated text\n@@ -224,0 +237,22 @@\n+\n+    protected void updateUnderline() {\n+        if (underline.isSelected()) {\n+            int len = computeTextLength(control);\n+            PathElement[] es = control.underlineShape(0, len);\n+            underlinePath.getElements().addAll(es);\n+        } else {\n+            underlinePath.getElements().clear();\n+        }\n+    }\n+\n+    protected void updateCaret() {\n+        if (showCaretPath.isSelected()) {\n+            int len = computeTextLength(control);\n+            for (int i = 0; i < len; i++) {\n+                PathElement[] es = control.caretShape(i, true);\n+                caretPath.getElements().addAll(es);\n+            }\n+        } else {\n+            caretPath.getElements().clear();\n+        }\n+    }\n","filename":"tests\/manual\/monkey\/src\/com\/oracle\/tools\/fx\/monkey\/pages\/TextFlowPage.java","additions":46,"deletions":11,"binary":false,"changes":57,"status":"modified"}]}