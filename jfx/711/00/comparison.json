{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -265,0 +265,4 @@\n+        if (getNode().getFocusModel() == null) {\n+            return;\n+        }\n+\n@@ -302,0 +306,4 @@\n+        if (getNode().getFocusModel() == null) {\n+            return;\n+        }\n+\n@@ -369,2 +377,5 @@\n-            int index = getNode().getSelectionModel().getSelectedIndex();\n-            setAnchor(index);\n+            MultipleSelectionModel<T> selectionModel = getNode().getSelectionModel();\n+            if (selectionModel != null) {\n+                int index = selectionModel.getSelectedIndex();\n+                setAnchor(index);\n+            }\n@@ -383,1 +394,4 @@\n-        getNode().getSelectionModel().clearSelection();\n+        MultipleSelectionModel<T> selectionModel = getNode().getSelectionModel();\n+        if (selectionModel != null) {\n+            selectionModel.clearSelection();\n+        }\n@@ -566,0 +580,3 @@\n+        MultipleSelectionModel<T> selectionModel = getNode().getSelectionModel();\n+        if (selectionModel == null) return;\n+\n@@ -567,1 +584,1 @@\n-        getNode().getSelectionModel().clearAndSelect(focusIndex - 1);\n+        selectionModel.clearAndSelect(focusIndex - 1);\n@@ -590,0 +607,5 @@\n+        MultipleSelectionModel<T> selectionModel = getNode().getSelectionModel();\n+        if (selectionModel == null) {\n+            return;\n+        }\n+\n@@ -591,1 +613,1 @@\n-            getNode().getSelectionModel().clearAndSelect(0);\n+            selectionModel.clearAndSelect(0);\n@@ -597,1 +619,6 @@\n-        getNode().getSelectionModel().clearAndSelect(getRowCount() - 1);\n+        MultipleSelectionModel<T> selectionModel = getNode().getSelectionModel();\n+        if (selectionModel == null) {\n+            return;\n+        }\n+\n+        selectionModel.clearAndSelect(getRowCount() - 1);\n@@ -738,2 +765,12 @@\n-        int focusedIndex = getNode().getFocusModel().getFocusedIndex();\n-        getNode().getSelectionModel().select(focusedIndex);\n+        MultipleSelectionModel<T> selectionModel = getNode().getSelectionModel();\n+        if (selectionModel == null) {\n+            return;\n+        }\n+\n+        FocusModel<T> focusModel = getNode().getFocusModel();\n+        if (focusModel == null) {\n+            return;\n+        }\n+\n+        int focusedIndex = focusModel.getFocusedIndex();\n+        selectionModel.select(focusedIndex);\n","filename":"modules\/javafx.controls\/src\/main\/java\/com\/sun\/javafx\/scene\/control\/behavior\/ListViewBehavior.java","additions":46,"deletions":9,"binary":false,"changes":55,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-import com.sun.javafx.scene.NodeHelper;\n-import com.sun.javafx.scene.SceneHelper;\n@@ -63,1 +61,1 @@\n-import static org.junit.Assert.fail;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n@@ -2377,0 +2375,39 @@\n+\n+    @Test public void testSpaceKeyPressWithNullSelectionModelDoesNotThrowNPE() {\n+        listView.setSelectionModel(null);\n+\n+        assertDoesNotThrow(() ->  keyboard.doKeyPress(KeyCode.SPACE));\n+    }\n+\n+    @Test public void testSpaceKeyPressWithNullFocusModelDoesNotThrowNPE() {\n+        listView.setFocusModel(null);\n+\n+        assertDoesNotThrow(() -> keyboard.doKeyPress(KeyCode.SPACE));\n+    }\n+\n+    @Test public void testKpUpKeyPressWithNullSelectionModelDoesNotThrowNPE() {\n+        \/\/ Navigate one down so as we can navigate up below.\n+        keyboard.doKeyPress(KeyCode.KP_DOWN);\n+\n+        listView.setSelectionModel(null);\n+\n+        assertDoesNotThrow(() -> keyboard.doKeyPress(KeyCode.KP_UP));\n+    }\n+\n+    @Test public void testHomeKeyPressWithNullSelectionModelDoesNotThrowNPE() {\n+        listView.setSelectionModel(null);\n+\n+        assertDoesNotThrow(() -> keyboard.doKeyPress(KeyCode.HOME));\n+    }\n+\n+    @Test public void testEndKeyPressWithNullSelectionModelDoesNotThrowNPE() {\n+        listView.setSelectionModel(null);\n+\n+        assertDoesNotThrow(() -> keyboard.doKeyPress(KeyCode.END));\n+    }\n+\n+    @Test public void testBackSlashKeyPressWithNullSelectionModelDoesNotThrowNPE() {\n+        listView.setSelectionModel(null);\n+\n+        assertDoesNotThrow(() -> keyboard.doKeyPress(KeyCode.BACK_SLASH, KeyModifier.CTRL));\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListViewKeyInputTest.java","additions":41,"deletions":4,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,0 +53,1 @@\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n@@ -387,0 +388,11 @@\n+\n+    @Test public void testClickWithNullSelectionModelDoesNotThrowNPE() {\n+        listView.setSelectionModel(null);\n+\n+        StageLoader loader = new StageLoader(listView);\n+\n+        assertDoesNotThrow(()  -> VirtualFlowTestUtils.clickOnRow(listView, 2));\n+\n+        loader.dispose();\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListViewMouseInputTest.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -80,0 +80,2 @@\n+\n+import org.junit.After;\n@@ -82,0 +84,2 @@\n+\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n@@ -102,0 +106,13 @@\n+\n+        Thread.currentThread().setUncaughtExceptionHandler((thread, throwable) -> {\n+            if (throwable instanceof RuntimeException) {\n+                throw (RuntimeException)throwable;\n+            } else {\n+                Thread.currentThread().getThreadGroup().uncaughtException(thread, throwable);\n+            }\n+        });\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        Thread.currentThread().setUncaughtExceptionHandler(null);\n@@ -2173,0 +2190,25 @@\n+    @Test\n+    public void testSelectWithNullFocusModelDoesNotThrowNPE() {\n+        listView.getItems().addAll(\"1\", \"2\");\n+        listView.setFocusModel(null);\n+\n+        StageLoader stageLoader = new StageLoader(listView);\n+\n+        assertDoesNotThrow(() -> listView.getSelectionModel().select(1));\n+\n+        stageLoader.dispose();\n+    }\n+\n+    @Test\n+    public void testItemChangeWithNullFocusModelDoesNotThrowNPE() {\n+        listView.getItems().addAll(\"1\", \"2\");\n+        listView.setFocusModel(null);\n+\n+        StageLoader stageLoader = new StageLoader(listView);\n+\n+        listView.getSelectionModel().clearAndSelect(1);\n+        assertDoesNotThrow(() -> listView.getItems().add(\"3\"));\n+\n+        stageLoader.dispose();\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListViewTest.java","additions":43,"deletions":1,"binary":false,"changes":44,"status":"modified"}]}