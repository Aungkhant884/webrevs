{"files":[{"patch":"@@ -302,2 +302,2 @@\n-            if (secondaryLoop.enter()) {\n-                Platform.runLater(() -> {\n+            Platform.runLater(() -> {\n+                try {\n@@ -305,3 +305,5 @@\n-                });\n-                secondaryLoop.exit();\n-            }\n+                } finally {\n+                    secondaryLoop.exit();\n+                }\n+            });\n+            secondaryLoop.enter();\n","filename":"modules\/javafx.swing\/src\/main\/java\/javafx\/embed\/swing\/JFXPanel.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import org.junit.After;\n@@ -57,0 +58,2 @@\n+    JFrame jframe;\n+\n@@ -87,0 +90,7 @@\n+    @After\n+    public void doCleanup() {\n+        if (jframe != null) {\n+            SwingUtilities.invokeLater(() -> jframe.dispose());\n+        }\n+    }\n+\n@@ -106,1 +116,1 @@\n-            JFrame jframe = new JFrame();\n+            jframe = new JFrame();\n@@ -158,1 +168,0 @@\n-}\n@@ -160,0 +169,54 @@\n+    @Test\n+    public void setSceneOnFXThread() throws Exception {\n+\n+        CountDownLatch completionLatch = new CountDownLatch(1);\n+\n+        SwingUtilities.invokeLater(() -> {\n+            JFXPanel fxPanel = new JFXPanel();\n+            fxPanel.setPreferredSize(new Dimension(100, 100));\n+            jframe = new JFrame();\n+            JPanel jpanel = new JPanel();\n+            jpanel.add(fxPanel);\n+            jframe.add(jpanel);\n+            jframe.pack();\n+            jframe.setVisible(true);\n+\n+            Platform.runLater(() -> {\n+                Scene scene = new Scene(new Group());\n+                fxPanel.setScene(scene);\n+                completionLatch.countDown();\n+            });\n+        });\n+\n+        Assert.assertTrue(\"Timeout waiting for setScene to complete\",\n+                completionLatch.await(5000, TimeUnit.MILLISECONDS));\n+    }\n+\n+    @Test\n+    public void setSceneOnSwingThread() throws Exception {\n+\n+        CountDownLatch completionLatch = new CountDownLatch(1);\n+\n+        SwingUtilities.invokeLater(() -> {\n+            JFXPanel fxPanel = new JFXPanel();\n+            fxPanel.setPreferredSize(new Dimension(100, 100));\n+            jframe = new JFrame();\n+            JPanel jpanel = new JPanel();\n+            jpanel.add(fxPanel);\n+            jframe.add(jpanel);\n+            jframe.pack();\n+            jframe.setVisible(true);\n+\n+            Platform.runLater(() -> {\n+                Scene scene = new Scene(new Group());\n+                SwingUtilities.invokeLater(() -> {\n+                    fxPanel.setScene(scene);\n+                    completionLatch.countDown();\n+                });\n+            });\n+        });\n+\n+        Assert.assertTrue(\"Timeout waiting for setScene to complete\",\n+                completionLatch.await(5000, TimeUnit.MILLISECONDS));\n+    }\n+}\n","filename":"tests\/system\/src\/test\/java\/test\/javafx\/embed\/swing\/JFXPanelTest.java","additions":65,"deletions":2,"binary":false,"changes":67,"status":"modified"}]}