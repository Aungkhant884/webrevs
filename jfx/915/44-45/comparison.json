{"files":[{"patch":"@@ -731,36 +731,0 @@\n-static int geometry_get_window_x(const WindowGeometry *windowGeometry) {\n-    float value = windowGeometry->refx;\n-    if (windowGeometry->gravity_x != 0) {\n-        value -= geometry_get_window_width(windowGeometry)\n-                     * windowGeometry->gravity_x;\n-    }\n-    return (int) value;\n-}\n-\n-static int geometry_get_window_y(const WindowGeometry *windowGeometry) {\n-    float value = windowGeometry->refy;\n-    if (windowGeometry->gravity_y != 0) {\n-        value -= geometry_get_window_height(windowGeometry)\n-                     * windowGeometry->gravity_y;\n-    }\n-    return (int) value;\n-}\n-\n-static void geometry_set_window_x(WindowGeometry *windowGeometry, int value) {\n-    float newValue = value;\n-    if (windowGeometry->gravity_x != 0) {\n-        newValue += geometry_get_window_width(windowGeometry)\n-                * windowGeometry->gravity_x;\n-    }\n-    windowGeometry->refx = (int) newValue;\n-}\n-\n-static void geometry_set_window_y(WindowGeometry *windowGeometry, int value) {\n-    float newValue = value;\n-    if (windowGeometry->gravity_y != 0) {\n-        newValue += geometry_get_window_height(windowGeometry)\n-                * windowGeometry->gravity_y;\n-    }\n-    windowGeometry->refy = (int) newValue;\n-}\n-\n@@ -893,0 +857,8 @@\n+\n+                \/\/ correct position using gravity\n+                if (geometry.x || geometry.y) {\n+                    geometry.x -= geometry.gravity_x * (left + right);\n+                    geometry.y -= geometry.gravity_y * (top + bottom);\n+                    gtk_window_move(GTK_WINDOW(gtk_widget), geometry.x, geometry.y);\n+                }\n+\n@@ -914,1 +886,2 @@\n-    \/\/ Window didn't actually move, but view X, Y might change\n+    \/\/ Window didn't actually move, but view X, Y might change or\n+    \/\/ may have gravity envolved\n@@ -1029,6 +1002,2 @@\n-    int x, y, w, h;\n-\n-    x = event->x - geometry.extents.left;\n-    y = event->y - geometry.extents.top;\n-    w = event->width;\n-    h = event->height;\n+    int x, y;\n+    gdk_window_get_position(gdk_window, &x, &y);\n@@ -1037,1 +1006,1 @@\n-        geometry.final_width.value = w;\n+        geometry.final_width.value = event->width;\n@@ -1039,1 +1008,1 @@\n-        geometry.final_height.value = h;\n+        geometry.final_height.value = event->height;\n@@ -1044,2 +1013,2 @@\n-        int ww = w + geometry.extents.left + geometry.extents.right;\n-        int wh = h + geometry.extents.top + geometry.extents.bottom;\n+        int ww = event->width + geometry.extents.left + geometry.extents.right;\n+        int wh = event->height + geometry.extents.top + geometry.extents.bottom;\n@@ -1055,1 +1024,1 @@\n-            mainEnv->CallVoidMethod(jview, jViewNotifyResize, w, h);\n+            mainEnv->CallVoidMethod(jview, jViewNotifyResize, event->width, event->height);\n@@ -1060,5 +1029,1 @@\n-    int curX, curY;\n-    curX = geometry_get_window_x(&geometry);\n-    curY = geometry_get_window_y(&geometry);\n-\n-    bool moved = (curX != x || curY != y);\n+    bool moved = (geometry.x != x || geometry.y != y);\n@@ -1067,2 +1032,2 @@\n-        geometry_set_window_x(&geometry, x);\n-        geometry_set_window_y(&geometry, y);\n+        geometry.x = x;\n+        geometry.y = y;\n@@ -1070,3 +1035,1 @@\n-        if (jwindow) {\n-            notify_window_move();\n-        }\n+        notify_window_move();\n@@ -1134,1 +1097,1 @@\n-    fprintf(stderr, \"set_bounds -> w = %d, h = %d, cw = %d, ch = %d\\n\", w, h, cw, ch);\n+    fprintf(stderr, \"set_bounds -> x = %d, y = %d, w = %d, h = %d, cw = %d, ch = %d\\n\", x, y, w, h, cw, ch);\n@@ -1176,1 +1139,1 @@\n-            geometry.refx = x + geometry_get_window_width(&geometry) * geometry.gravity_x;\n+            geometry.x = x;\n@@ -1180,1 +1143,1 @@\n-            geometry.refy = y + geometry_get_window_height(&geometry) * geometry.gravity_y;\n+            geometry.y = y;\n@@ -1183,5 +1146,1 @@\n-        int newX, newY;\n-        newX = geometry_get_window_x(&geometry);\n-        newY = geometry_get_window_y(&geometry);\n-\n-        gtk_window_move(GTK_WINDOW(gtk_widget), newX, newY);\n+        gtk_window_move(GTK_WINDOW(gtk_widget), geometry.x, geometry.y);\n@@ -1224,1 +1183,2 @@\n-        request_focus();\n+        gtk_window_deiconify(GTK_WINDOW(gtk_widget));\n+        gdk_window_focus(gdk_window, GDK_CURRENT_TIME);\n@@ -1317,2 +1277,1 @@\n-    int oldX = geometry_get_window_x(&geometry);\n-    int oldY = geometry_get_window_y(&geometry);\n+    g_print(\"set gravity: %f, %f\\n\", x, y);\n@@ -1321,2 +1280,0 @@\n-    geometry_set_window_x(&geometry, oldX);\n-    geometry_set_window_y(&geometry, oldY);\n@@ -1413,9 +1370,3 @@\n-    int x = geometry_get_window_x(&geometry);\n-    int y = geometry_get_window_y(&geometry);\n-\n-    mainEnv->CallVoidMethod(jwindow, jWindowNotifyMove, x, y);\n-    CHECK_JNI_EXCEPTION(mainEnv)\n-\n-    if (jview) {\n-        mainEnv->CallVoidMethod(jview, jViewNotifyView,\n-                com_sun_glass_events_ViewEvent_MOVE);\n+    if (jwindow) {\n+        mainEnv->CallVoidMethod(jwindow, jWindowNotifyMove,\n+                                 geometry.x, geometry.y);\n@@ -1423,0 +1374,6 @@\n+\n+        if (jview) {\n+            mainEnv->CallVoidMethod(jview, jViewNotifyView,\n+                    com_sun_glass_events_ViewEvent_MOVE);\n+            CHECK_JNI_EXCEPTION(mainEnv)\n+        }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.cpp","additions":37,"deletions":80,"binary":false,"changes":117,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-    size_assigned(false), refx(), refy(), gravity_x(), gravity_y(), extents() {}\n+    size_assigned(false), x(), y(), gravity_x(), gravity_y(), extents() {}\n@@ -85,2 +85,2 @@\n-    float refx;\n-    float refy;\n+    int x;\n+    int y;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.h","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}