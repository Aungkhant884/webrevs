{"files":[{"patch":"@@ -708,0 +708,3 @@\n+int WindowContextTop::cached_adjust_w = 0;\n+int WindowContextTop::cached_adjust_h = 0;\n+\n@@ -929,0 +932,3 @@\n+                    cached_adjust_w = geometry.adjust_w;\n+                    cached_adjust_h = geometry.adjust_h;\n+\n@@ -932,2 +938,1 @@\n-                        set_bounds(0, 0, false, false, geometry.current_w, geometry.current_h,\n-                                    geometry.current_cw, geometry.current_ch);\n+                        set_bounds(0, 0, false, false, -1, -1, geometry.current_cw, geometry.current_ch);\n@@ -942,1 +947,1 @@\n-    gint x, y, w, h, cw, ch;\n+    gint x, y, cw, ch;\n@@ -948,3 +953,0 @@\n-    w = cw + geometry.adjust_w;\n-    h = ch + geometry.adjust_h;\n-\n@@ -954,1 +956,1 @@\n-    bool window_size_changed = geometry.current_w != w || geometry.current_h != h;\n+    bool window_size_changed = false;\n@@ -957,2 +959,10 @@\n-    geometry.current_w = w;\n-    geometry.current_h = h;\n+    \/\/wait for frame extents to notify it\n+    if (!geometry.needs_frame_extents) {\n+        int w, h;\n+        w = cw + geometry.adjust_w;\n+        h = ch + geometry.adjust_h;\n+        window_size_changed =  geometry.current_w != w || geometry.current_h != h;;\n+        geometry.current_w = w;\n+        geometry.current_h = h;\n+    }\n+\n@@ -970,0 +980,13 @@\n+\n+    glong to_screen = getScreenPtrForLocation(x, y);\n+    if (to_screen != -1) {\n+        if (to_screen != screen) {\n+            if (jwindow) {\n+                \/\/notify screen changed\n+                jobject jScreen = createJavaScreen(mainEnv, to_screen);\n+                mainEnv->CallVoidMethod(jwindow, jWindowNotifyMoveToAnotherScreen, jScreen);\n+                CHECK_JNI_EXCEPTION(mainEnv)\n+            }\n+            screen = to_screen;\n+        }\n+    }\n@@ -1030,2 +1053,11 @@\n-    g_print(\"size_position_notify -> window_size_changed: %d, content_size_changed: %d, pos_changed: %d\\n\",\n-                window_size_changed, content_size_changed, pos_changed);\n+   if (jview) {\n+       if (content_size_changed) {\n+           mainEnv->CallVoidMethod(jview, jViewNotifyResize, geometry.current_cw, geometry.current_ch);\n+           CHECK_JNI_EXCEPTION(mainEnv);\n+       }\n+\n+       if (pos_changed) {\n+           mainEnv->CallVoidMethod(jview, jViewNotifyView, com_sun_glass_events_ViewEvent_MOVE);\n+           CHECK_JNI_EXCEPTION(mainEnv)\n+       }\n+   }\n@@ -1035,1 +1067,0 @@\n-            g_print(\"notify window size: %d, %d\\n\", geometry.current_w, geometry.current_h);\n@@ -1045,1 +1076,0 @@\n-            g_print(\"notify window move: %d, %d\\n\", geometry.current_x, geometry.current_y);\n@@ -1050,14 +1080,0 @@\n-\n-    if (jview) {\n-        if (content_size_changed) {\n-            g_print(\"notify content size: %d, %d\\n\", geometry.current_cw, geometry.current_ch);\n-            mainEnv->CallVoidMethod(jview, jViewNotifyResize, geometry.current_cw, geometry.current_ch);\n-            CHECK_JNI_EXCEPTION(mainEnv);\n-        }\n-\n-        if (pos_changed) {\n-            g_print(\"notify view pos changed\\n\");\n-            mainEnv->CallVoidMethod(jview, jViewNotifyView, com_sun_glass_events_ViewEvent_MOVE);\n-            CHECK_JNI_EXCEPTION(mainEnv)\n-        }\n-    }\n@@ -1067,1 +1083,0 @@\n-    g_print(\"set_bounds: %d, %d, %d, %d, %d, %d\\n\", x, y, w, h, cw, ch);\n@@ -1076,0 +1091,10 @@\n+    int adjust_w, adjust_h;\n+\n+    if (geometry.needs_frame_extents) {\n+        adjust_w = cached_adjust_w;\n+        adjust_h = cached_adjust_h;\n+    } else {\n+        adjust_w = geometry.adjust_w;\n+        adjust_h = geometry.adjust_h;\n+    }\n+\n@@ -1087,1 +1112,2 @@\n-    bool size_changed = false;\n+    bool window_size_changed = false;\n+    bool content_size_changed = false;\n@@ -1091,2 +1117,0 @@\n-        geometry.current_w = newW + geometry.adjust_w;\n-        geometry.current_h = newH + geometry.adjust_h;\n@@ -1106,1 +1130,10 @@\n-        size_changed = true;\n+        \/\/TODO: find an alternative to positioning since this resizes the window when frame extents are received\n+        \/\/ this is used mostly to trigger gravity, since Java side needs\n+        if (geometry.current_w <= 0 || geometry.current_h <= 0) {\n+            window_size_changed = true;\n+\n+            geometry.current_w = (geometry.current_w <= 0) ? geometry.current_cw + adjust_w : geometry.current_w;\n+            geometry.current_h = (geometry.current_h <= 0) ? geometry.current_ch + adjust_h : geometry.current_h;\n+        }\n+\n+        content_size_changed = geometry.content_size;\n@@ -1114,1 +1147,0 @@\n-        \/\/gravity is informed by Java side when it want's to move the window based on it's size\n@@ -1116,2 +1148,2 @@\n-            newX -= geometry.current_w * geometry.gravity_x;\n-            newY -= geometry.current_h * geometry.gravity_y;\n+            newX -= (((geometry.content_size) ? 0 : adjust_w) + geometry.current_cw) * geometry.gravity_x;\n+            newY -= (((geometry.content_size) ? 0 : adjust_h) + geometry.current_ch) * geometry.gravity_y;\n@@ -1128,2 +1160,2 @@\n-    if (size_changed || pos_changed) {\n-        size_position_notify(size_changed, size_changed, pos_changed);\n+    if (window_size_changed || content_size_changed || pos_changed) {\n+        size_position_notify(window_size_changed, content_size_changed, pos_changed);\n@@ -1289,1 +1321,0 @@\n-    g_print(\"set_gravity: %f, %f\\n\", x, y);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.cpp","additions":69,"deletions":38,"binary":false,"changes":107,"status":"modified"},{"patch":"@@ -401,0 +401,2 @@\n+    static int cached_adjust_w;\n+    static int cached_adjust_h;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}