{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,0 +49,1 @@\n+import test.javafx.collections.MockListObserver;\n@@ -6644,0 +6645,20 @@\n+\n+    @Test public void testRemovedSelectedItemsWhenBranchIsCollapsed() {\n+        TreeItem<String> c1, c2, c3;\n+        TreeItem<String> root = new TreeItem<>(\"foo\");\n+        root.getChildren().add(c1 = new TreeItem<>(\"bar\"));\n+        root.getChildren().add(c2 = new TreeItem<>(\"baz\"));\n+        root.getChildren().add(c3 = new TreeItem<>(\"qux\"));\n+        root.setExpanded(true);\n+\n+        TreeTableView<String> treeView = new TreeTableView<>(root);\n+        treeView.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);\n+        treeView.getSelectionModel().selectAll();\n+\n+        MockListObserver<TreeItem<String>> observer = new MockListObserver<>();\n+        treeView.getSelectionModel().getSelectedItems().addListener(observer);\n+        root.setExpanded(false);\n+\n+        observer.check1();\n+        observer.checkAddRemove(0, treeView.getSelectionModel().getSelectedItems(), List.of(c1, c2, c3), 1, 1);\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeTableViewTest.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import test.javafx.collections.MockListObserver;\n@@ -3686,0 +3687,1 @@\n+        TreeItem<String> c1, c2, c3;\n@@ -3687,3 +3689,3 @@\n-        root.getChildren().add(new TreeItem<>(\"bar\"));\n-        root.getChildren().add(new TreeItem<>(\"baz\"));\n-        root.getChildren().add(new TreeItem<>(\"qux\"));\n+        root.getChildren().add(c1 = new TreeItem<>(\"bar\"));\n+        root.getChildren().add(c2 = new TreeItem<>(\"baz\"));\n+        root.getChildren().add(c3 = new TreeItem<>(\"qux\"));\n@@ -3692,1 +3694,0 @@\n-        List<TreeItem<String>> removed = new ArrayList<>();\n@@ -3695,6 +3696,0 @@\n-        treeView.getSelectionModel().getSelectedItems().addListener((ListChangeListener<? super TreeItem<String>>) c -> {\n-            while (c.next()) {\n-                removed.addAll(new ArrayList<>(c.getRemoved()));\n-            }\n-        });\n-\n@@ -3702,0 +3697,3 @@\n+\n+        MockListObserver<TreeItem<String>> observer = new MockListObserver<>();\n+        treeView.getSelectionModel().getSelectedItems().addListener(observer);\n@@ -3704,4 +3702,2 @@\n-        assertEquals(3, removed.size());\n-        assertEquals(\"bar\", removed.get(0).getValue());\n-        assertEquals(\"baz\", removed.get(1).getValue());\n-        assertEquals(\"qux\", removed.get(2).getValue());\n+        observer.check1();\n+        observer.checkAddRemove(0, treeView.getSelectionModel().getSelectedItems(), List.of(c1, c2, c3), 1, 1);\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeViewTest.java","additions":11,"deletions":15,"binary":false,"changes":26,"status":"modified"}]}