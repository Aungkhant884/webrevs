{"files":[{"patch":"@@ -174,1 +174,1 @@\n-        if (launchCalled.getAndSet(true)) {\n+        if (com.sun.glass.ui.Application.isEventThread() || launchCalled.getAndSet(true)) {\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/application\/LauncherImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,84 @@\n+package test.javafx.scene;\n+\n+import javafx.application.Application;\n+import javafx.application.Platform;\n+import javafx.stage.Stage;\n+import junit.framework.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public class InitializeJavaFXTest {\n+\n+    public static final CountDownLatch appLatch = new CountDownLatch(1);\n+\n+    public static class InitializeApp extends Application {\n+        @Override\n+        public void start(Stage primaryStage) throws Exception {\n+            appLatch.countDown();\n+        }\n+    }\n+\n+    public static void initializeApplication() throws Exception {\n+        new Thread(() -> {\n+            Application.launch(InitializeApp.class);\n+        }).start();\n+        appLatch.await();\n+    }\n+\n+    public static void initializeStartup() throws Exception {\n+        CountDownLatch latch = new CountDownLatch(1);\n+        Platform.startup(() -> {\n+            latch.countDown();\n+        });\n+        latch.await();\n+    }\n+\n+    @BeforeClass\n+    public static void initialize() throws Exception {\n+        System.out.println(\"Calling Startup!\");\n+        initializeStartup();\n+        System.out.println(\"Called Startup!\");\n+    }\n+\n+    public static class TestApp extends Application {\n+        @Override\n+        public void start(Stage primaryStage) throws Exception {\n+            System.out.println(\"start called!\");\n+        }\n+    }\n+\n+    @Test\n+    public void testStartupThenLaunchInFX() throws Exception {\n+        CountDownLatch latch = new CountDownLatch(1);\n+        Platform.runLater(() -> {\n+            try {\n+                System.out.println(\"Calling launch!\");\n+                Application.launch(TestApp.class);\n+                System.out.println(\"Finished launch!\");\n+            } catch (IllegalStateException e) {\n+                latch.countDown();\n+            } catch (Exception e) {\n+                System.out.println(\"got exception:  \" + e);\n+                e.printStackTrace();\n+            }\n+        });\n+        Assert.assertTrue(\"Timeout\", latch.await(10, TimeUnit.SECONDS));\n+    }\n+\n+    @Test\n+    public void testStartupThenLaunch() throws Exception {\n+        try {\n+            System.out.println(\"Calling launch!\");\n+            Application.launch(TestApp.class);\n+            System.out.println(\"Finished launch!\");\n+            throw new Exception(\"We excpect an error!\");\n+        } catch (IllegalStateException e) {\n+            System.out.println(\"Works!\");\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+    }\n+}\n","filename":"tests\/system\/src\/test\/java\/test\/javafx\/scene\/InitializeJavaFXTest.java","additions":84,"deletions":0,"binary":false,"changes":84,"status":"added"}]}