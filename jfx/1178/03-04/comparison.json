{"files":[{"patch":"@@ -422,0 +422,36 @@\n+    private SwingDnD getDnD() {\n+        synchronized(LOCK) {\n+            return dnd;\n+        }\n+    }\n+\n+    private void setDnD(SwingDnD val) {\n+        synchronized(LOCK) {\n+            dnd = val;\n+        }\n+    }\n+\n+    private int getCompWidth() {\n+        synchronized(LOCK) {\n+            return pWidth;\n+        }\n+    }\n+\n+    private int getCompHeight() {\n+        synchronized(LOCK) {\n+            return pHeight;\n+        }\n+    }\n+\n+    private double getScaleFactorX() {\n+        synchronized(LOCK) {\n+            return scaleFactorX;\n+        }\n+    }\n+\n+    private double getScaleFactorY() {\n+        synchronized(LOCK) {\n+            return scaleFactorY;\n+        }\n+    }\n+\n@@ -595,0 +631,2 @@\n+        int lWidth = getCompWidth();\n+        int lHeight = getCompHeight();\n@@ -596,1 +634,1 @@\n-            lStagePeer.setSize(pWidth, pHeight);\n+            lStagePeer.setSize(lWidth, lHeight);\n@@ -599,1 +637,1 @@\n-            lScenePeer.setSize(pWidth, pHeight);\n+            lScenePeer.setSize(lWidth, lHeight);\n@@ -635,2 +673,6 @@\n-        int oldWidth = pWidth;\n-        int oldHeight = pHeight;\n+        int lWidth = getCompWidth();\n+        int lHeight = getCompHeight();\n+        double lScaleFactorX = getScaleFactorX();\n+        double lScaleFactorY = getScaleFactorY();\n+        int oldWidth = lWidth;\n+        int oldHeight = lHeight;\n@@ -639,2 +681,2 @@\n-            pWidth -= (i.left + i.right);\n-            pHeight -= (i.top + i.bottom);\n+            lWidth -= (i.left + i.right);\n+            lHeight -= (i.top + i.bottom);\n@@ -644,4 +686,8 @@\n-        pWidth = Math.max(0, getWidth());\n-        pHeight = Math.max(0, getHeight());\n-        double newScaleFactorX = scaleFactorX;\n-        double newScaleFactorY = scaleFactorY;\n+        lWidth = Math.max(0, getWidth());\n+        lHeight = Math.max(0, getHeight());\n+        synchronized(LOCK) {\n+            pWidth = lWidth;\n+            pHeight = lHeight;\n+        }\n+        double newScaleFactorX = lScaleFactorX;\n+        double newScaleFactorY = lScaleFactorY;\n@@ -655,1 +701,1 @@\n-        if (oldWidth == 0 && oldHeight == 0 && pWidth == 0 && pHeight == 0) {\n+        if (oldWidth == 0 && oldHeight == 0 && lWidth == 0 && lHeight == 0) {\n@@ -658,2 +704,2 @@\n-        if (oldWidth != pWidth || oldHeight != pHeight ||\n-            newScaleFactorX != scaleFactorX || newScaleFactorY != scaleFactorY)\n+        if (oldWidth != lWidth || oldHeight != lHeight ||\n+            newScaleFactorX != lScaleFactorX || newScaleFactorY != lScaleFactorY)\n@@ -666,2 +712,4 @@\n-            scaleFactorX = newScaleFactorX;\n-            scaleFactorY = newScaleFactorY;\n+            synchronized(LOCK) {\n+                scaleFactorX = newScaleFactorX;\n+                scaleFactorY = newScaleFactorY;\n+            }\n@@ -764,1 +812,5 @@\n-        if (lScenePeer == null || pWidth <= 0 || pHeight <= 0) {\n+        int lWidth = getCompWidth();\n+        int lHeight = getCompHeight();\n+        double lScaleFactorX = getScaleFactorX();\n+        double lScaleFactorY = getScaleFactorY();\n+        if (lScenePeer == null || lWidth <= 0 || lHeight <= 0) {\n@@ -768,2 +820,2 @@\n-            int newPixelW = (int) Math.ceil(pWidth * newScaleFactorX);\n-            int newPixelH = (int) Math.ceil(pHeight * newScaleFactorY);\n+            int newPixelW = (int) Math.ceil(lWidth * newScaleFactorX);\n+            int newPixelH = (int) Math.ceil(lHeight * newScaleFactorY);\n@@ -774,2 +826,2 @@\n-                double ratioX = newScaleFactorX \/ scaleFactorX;\n-                double ratioY = newScaleFactorY \/ scaleFactorY;\n+                double ratioX = newScaleFactorX \/ lScaleFactorX;\n+                double ratioY = newScaleFactorY \/ lScaleFactorY;\n@@ -825,0 +877,4 @@\n+        int lWidth = getCompWidth();\n+        int lHeight = getCompHeight();\n+        double lScaleFactorX = getScaleFactorX();\n+        double lScaleFactorY = getScaleFactorY();\n@@ -829,1 +885,1 @@\n-            createResizePixelBuffer(scaleFactorX, scaleFactorY);\n+            createResizePixelBuffer(lScaleFactorX, lScaleFactorY);\n@@ -837,1 +893,1 @@\n-        if (!lScenePeer.getPixels(buf, pWidth, pHeight)) {\n+        if (!lScenePeer.getPixels(buf, lWidth, lHeight)) {\n@@ -853,1 +909,1 @@\n-            gg.drawImage(pixelsIm, 0, 0, pWidth, pHeight, null);\n+            gg.drawImage(pixelsIm, 0, 0, lWidth, lHeight, null);\n@@ -855,2 +911,2 @@\n-            double newScaleFactorX = scaleFactorX;\n-            double newScaleFactorY = scaleFactorY;\n+            double newScaleFactorX = lScaleFactorX;\n+            double newScaleFactorY = lScaleFactorY;\n@@ -863,1 +919,1 @@\n-            if (scaleFactorX != newScaleFactorX || scaleFactorY != newScaleFactorY) {\n+            if (lScaleFactorX != newScaleFactorX || lScaleFactorY != newScaleFactorY) {\n@@ -868,2 +924,4 @@\n-                scaleFactorX = newScaleFactorX;\n-                scaleFactorY = newScaleFactorY;\n+                synchronized(LOCK) {\n+                    scaleFactorX = newScaleFactorX;\n+                    scaleFactorY = newScaleFactorY;\n+                }\n@@ -902,0 +960,1 @@\n+        SwingDnD lDnD = getDnD();\n@@ -904,2 +963,2 @@\n-                if (dnd != null) {\n-                    dnd.removeNotify();\n+                if (lDnD != null) {\n+                    lDnD.removeNotify();\n@@ -914,2 +973,2 @@\n-                if (dnd != null) {\n-                    dnd.addNotify();\n+                if (lDnD != null) {\n+                    lDnD.addNotify();\n@@ -1009,2 +1068,4 @@\n-        pWidth = 0;\n-        pHeight = 0;\n+        synchronized(LOCK) {\n+            pWidth = 0;\n+            pHeight = 0;\n+        }\n@@ -1044,2 +1105,4 @@\n-            if (pWidth > 0 && pHeight > 0) {\n-                embeddedStage.setSize(pWidth, pHeight);\n+            int lWidth = getCompWidth();\n+            int lHeight = getCompHeight();\n+            if (lWidth > 0 && lHeight > 0) {\n+                embeddedStage.setSize(lWidth, lHeight);\n@@ -1065,3 +1128,4 @@\n-                    if (dnd != null) {\n-                        dnd.removeNotify();\n-                        dnd = null;\n+                    SwingDnD lDnD = getDnD();\n+                    if (lDnD != null) {\n+                        lDnD.removeNotify();\n+                        lDnD = null;\n@@ -1069,0 +1133,1 @@\n+                    setDnD(lDnD);\n@@ -1072,2 +1137,6 @@\n-            if (pWidth > 0 && pHeight > 0) {\n-                embeddedScene.setSize(pWidth, pHeight);\n+            int lWidth = getCompWidth();\n+            int lHeight = getCompHeight();\n+            double lScaleFactorX = getScaleFactorX();\n+            double lScaleFactorY = getScaleFactorY();\n+            if (lWidth > 0 && lHeight > 0) {\n+                embeddedScene.setSize(lWidth, lHeight);\n@@ -1075,1 +1144,1 @@\n-            embeddedScene.setPixelScaleFactors((float) scaleFactorX, (float) scaleFactorY);\n+            embeddedScene.setPixelScaleFactors((float) lScaleFactorX, (float) lScaleFactorY);\n@@ -1078,3 +1147,5 @@\n-                dnd = new SwingDnD(JFXPanel.this, embeddedScene);\n-                dnd.addNotify();\n-                embeddedScene.setDragStartListener(dnd.getDragStartListener());\n+                SwingDnD lDnD = getDnD();\n+                lDnD = new SwingDnD(JFXPanel.this, embeddedScene);\n+                lDnD.addNotify();\n+                setDnD(lDnD);\n+                embeddedScene.setDragStartListener(lDnD.getDragStartListener());\n","filename":"modules\/javafx.swing\/src\/main\/java\/javafx\/embed\/swing\/JFXPanel.java","additions":116,"deletions":45,"binary":false,"changes":161,"status":"modified"}]}