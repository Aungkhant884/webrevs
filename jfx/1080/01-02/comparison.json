{"files":[{"patch":"@@ -29,0 +29,1 @@\n+\n@@ -33,1 +34,0 @@\n-import java.util.TreeSet;\n@@ -107,13 +107,0 @@\n-\n-    protected void notifyInputMethodLinux(String str, boolean commit, int length, int cursor, byte[] attr) {\n-        if (commit) {\n-            notifyInputMethod(str, null, null, null, length, cursor, 0);\n-        } else {\n-            int[] boundary = new int[length + 1];\n-            for (int i = 0; i < boundary.length; i++) {\n-                boundary[i] = i;\n-            }\n-\n-            notifyInputMethod(str, boundary, boundary, attr, 0, cursor, 0);\n-        }\n-    }\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/gtk\/GtkView.java","additions":1,"deletions":14,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -64,1 +64,1 @@\n-jmethodID jViewNotifyInputMethodLinux;\n+jmethodID jViewNotifyInputMethod;\n@@ -211,0 +211,2 @@\n+    jViewNotifyInputMethod = env->GetMethodID(clazz, \"notifyInputMethod\", \"(Ljava\/lang\/String;[I[I[BIII)V\");\n+    if (env->ExceptionCheck()) return JNI_ERR;\n@@ -219,5 +221,0 @@\n-    clazz = env->FindClass(\"com\/sun\/glass\/ui\/gtk\/GtkView\");\n-    if (env->ExceptionCheck()) return JNI_ERR;\n-    jViewNotifyInputMethodLinux = env->GetMethodID(clazz, \"notifyInputMethodLinux\", \"(Ljava\/lang\/String;ZII[B)V\");\n-    if (env->ExceptionCheck()) return JNI_ERR;\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.cpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -176,1 +176,1 @@\n-    extern jmethodID jViewNotifyInputMethodLinux; \/\/com.sun.glass.ui.View#notifyInputMethodLinux (Ljava\/lang\/String;ZII[B)V\n+    extern jmethodID jViewNotifyInputMethod; \/\/com.sun.glass.ui.View#jViewNotifyInputMethod (Ljava\/lang\/String;[I[I[BIII)V\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,0 @@\n-    gchar *preedit_text;\n@@ -42,1 +41,1 @@\n-    jbyteArray attr = NULL;\n+    gchar *preedit_text;\n@@ -53,3 +52,0 @@\n-    attr = mainEnv->NewByteArray(slen);\n-    CHECK_JNI_EXCEPTION(mainEnv)\n-\n@@ -57,1 +53,0 @@\n-    jbyte v[slen];\n@@ -60,0 +55,3 @@\n+    PangoAttribute  *attr;\n+\n+    int boundaryCount = 0;\n@@ -63,9 +61,18 @@\n-\n-        if (pango_attr_iterator_get(iter, PANGO_ATTR_BACKGROUND)) {\n-            g_print(\"PANGO_ATTR_BACKGROUND\\n\");\n-\/\/            v[i] = com_sun_glass_ui_View_IME_ATTR_TARGET_NOTCONVERTED;\n-        }\n-\n-        if (pango_attr_iterator_get(iter, PANGO_ATTR_UNDERLINE)) {\n-            g_print(\"PANGO_ATTR_UNDERLINE\\n\");\n-    \/\/        v[0] = com_sun_glass_ui_View_IME_ATTR_CONVERTED;\n+        g_print(\"attr_range: %d, %d\\n\", start, end);\n+\n+        if (attr = pango_attr_iterator_get(iter, PANGO_ATTR_BACKGROUND)) {\n+            const PangoColor *color = &((PangoAttrColor *)attr)->color;\n+\n+            g_print(\"attr_color: %d, %d, %d\\n\", color->red, color->green, color->blue);\n+\n+            if ((color->red | color->green | color->blue) == 0) {\n+\/\/                v[i] = com_sun_glass_ui_View_IME_ATTR_TARGET_NOTCONVERTED;\n+            } else {\n+\/\/                v[i] = com_sun_glass_ui_View_IME_ATTR_TARGET_CONVERTED;\n+            }\n+        } else if ((attr = pango_attr_iterator_get(iter, PANGO_ATTR_UNDERLINE))\n+                && (((PangoAttrInt *)attr)->value != PANGO_UNDERLINE_NONE)) {\n+            g_print(\"underline\\n\");\n+\/\/            v[i] = com_sun_glass_ui_View_IME_ATTR_CONVERTED;\n+        } else {\n+\/\/            v[i] = com_sun_glass_ui_View_IME_ATTR_INPUT;\n@@ -74,0 +81,1 @@\n+        boundaryCount++;\n@@ -79,2 +87,8 @@\n-    mainEnv->SetByteArrayRegion(attr, 0, slen, v);\n-    CHECK_JNI_EXCEPTION(mainEnv)\n+\/\/    boundary = mainEnv->newIntArray(slen);\n+\/\/    CHECK_JNI_EXCEPTION(mainEnv)\n+\/\/\n+\/\/    attr = mainEnv->NewByteArray(slen);\n+\/\/    CHECK_JNI_EXCEPTION(mainEnv)\n+\/\/\n+\/\/    mainEnv->SetByteArrayRegion(attr, 0, slen, v);\n+\/\/    CHECK_JNI_EXCEPTION(mainEnv)\n@@ -83,1 +97,1 @@\n-            jViewNotifyInputMethodLinux,\n+            jViewNotifyInputMethod,\n@@ -85,2 +99,4 @@\n-            false,\n-            slen,\n+            NULL,\n+            NULL,\n+            NULL,\n+            0,\n@@ -88,1 +104,1 @@\n-            attr);\n+            0);\n@@ -112,1 +128,1 @@\n-                jViewNotifyInputMethodLinux,\n+                jViewNotifyInputMethod,\n@@ -114,1 +130,3 @@\n-                true,\n+                NULL,\n+                NULL,\n+                NULL,\n@@ -117,1 +135,1 @@\n-                NULL);\n+                0);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window_ime.cpp","additions":42,"deletions":24,"binary":false,"changes":66,"status":"modified"}]}