{"files":[{"patch":"@@ -29,1 +29,0 @@\n-\n@@ -34,0 +33,1 @@\n+import java.util.TreeSet;\n@@ -107,0 +107,11 @@\n+\n+    protected void notifyInputMethodLinux(String str, int commitLength, int cursor, byte attr) {\n+        if (commitLength > 0) {\n+            notifyInputMethod(str, null, null, null, commitLength, cursor, 0);\n+        } else {\n+            int[] attBounds = new int[] { 0, str.length() };\n+            byte[] attValues = new byte[] { attr };\n+\n+            notifyInputMethod(str, attBounds, attBounds, attValues, 0, cursor, 0);\n+        }\n+    }\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/gtk\/GtkView.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -64,1 +64,1 @@\n-jmethodID jViewNotifyInputMethod;\n+jmethodID jViewNotifyInputMethodLinux;\n@@ -211,2 +211,0 @@\n-    jViewNotifyInputMethod = env->GetMethodID(clazz, \"notifyInputMethod\", \"(Ljava\/lang\/String;[I[I[BIII)V\");\n-    if (env->ExceptionCheck()) return JNI_ERR;\n@@ -221,0 +219,5 @@\n+    clazz = env->FindClass(\"com\/sun\/glass\/ui\/gtk\/GtkView\");\n+    if (env->ExceptionCheck()) return JNI_ERR;\n+    jViewNotifyInputMethodLinux = env->GetMethodID(clazz, \"notifyInputMethodLinux\", \"(Ljava\/lang\/String;IIB)V\");\n+    if (env->ExceptionCheck()) return JNI_ERR;\n+\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.cpp","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -176,1 +176,1 @@\n-    extern jmethodID jViewNotifyInputMethod; \/\/com.sun.glass.ui.View#jViewNotifyInputMethod (Ljava\/lang\/String;[I[I[BIII)V\n+    extern jmethodID jViewNotifyInputMethodLinux; \/\/com.sun.glass.ui.View#notifyInputMethodLinux (Ljava\/lang\/String;IIB)V\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_general.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -478,1 +478,0 @@\n-    g_print(\"PROCESS_KEY -> press: %d\\n\", press);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-    g_print(\"preedit_start\\n\");\n@@ -53,1 +52,2 @@\n-    g_print(\"CursorPos: %d\\n\", cursor_pos);\n+    PangoAttrIterator *iter = pango_attr_list_get_iterator(attrList);\n+    PangoAttribute *pangoAttr;\n@@ -55,4 +55,1 @@\n-    PangoAttrIterator* iter = pango_attr_list_get_iterator(attrList);\n-    PangoAttribute  *attr;\n-\n-    int boundaryCount = 0;\n+    jbyte attr = com_sun_glass_ui_View_IME_ATTR_INPUT;\n@@ -60,20 +57,7 @@\n-        int start, end;\n-        pango_attr_iterator_range(iter, &start, &end);\n-        g_print(\"attr_range: %d, %d\\n\", start, end);\n-\n-        if (attr = pango_attr_iterator_get(iter, PANGO_ATTR_BACKGROUND)) {\n-            const PangoColor *color = &((PangoAttrColor *)attr)->color;\n-\n-            g_print(\"attr_color: %d, %d, %d\\n\", color->red, color->green, color->blue);\n-\n-            if ((color->red | color->green | color->blue) == 0) {\n-\/\/                v[i] = com_sun_glass_ui_View_IME_ATTR_TARGET_NOTCONVERTED;\n-            } else {\n-\/\/                v[i] = com_sun_glass_ui_View_IME_ATTR_TARGET_CONVERTED;\n-            }\n-        } else if ((attr = pango_attr_iterator_get(iter, PANGO_ATTR_UNDERLINE))\n-                && (((PangoAttrInt *)attr)->value != PANGO_UNDERLINE_NONE)) {\n-            g_print(\"underline\\n\");\n-\/\/            v[i] = com_sun_glass_ui_View_IME_ATTR_CONVERTED;\n-        } else {\n-\/\/            v[i] = com_sun_glass_ui_View_IME_ATTR_INPUT;\n+        if (pangoAttr = pango_attr_iterator_get(iter, PANGO_ATTR_BACKGROUND)) {\n+             attr = com_sun_glass_ui_View_IME_ATTR_TARGET_NOTCONVERTED;\n+             break;\n+        } else if ((pangoAttr = pango_attr_iterator_get(iter, PANGO_ATTR_UNDERLINE))\n+                && (((PangoAttrInt *)pangoAttr)->value == PANGO_UNDERLINE_SINGLE)) {\n+            attr = com_sun_glass_ui_View_IME_ATTR_CONVERTED;\n+            break;\n@@ -81,2 +65,0 @@\n-\n-        boundaryCount++;\n@@ -88,9 +70,0 @@\n-\/\/    boundary = mainEnv->newIntArray(slen);\n-\/\/    CHECK_JNI_EXCEPTION(mainEnv)\n-\/\/\n-\/\/    attr = mainEnv->NewByteArray(slen);\n-\/\/    CHECK_JNI_EXCEPTION(mainEnv)\n-\/\/\n-\/\/    mainEnv->SetByteArrayRegion(attr, 0, slen, v);\n-\/\/    CHECK_JNI_EXCEPTION(mainEnv)\n-\n@@ -98,1 +71,1 @@\n-            jViewNotifyInputMethod,\n+            jViewNotifyInputMethodLinux,\n@@ -100,3 +73,0 @@\n-            NULL,\n-            NULL,\n-            NULL,\n@@ -105,1 +75,1 @@\n-            0);\n+            attr);\n@@ -110,2 +80,0 @@\n-    g_print(\"on_preedit_end\\n\");\n-\n@@ -117,1 +85,0 @@\n-    g_print(\"on_commit\\n\");\n@@ -129,1 +96,1 @@\n-                jViewNotifyInputMethod,\n+                jViewNotifyInputMethodLinux,\n@@ -131,3 +98,0 @@\n-                NULL,\n-                NULL,\n-                NULL,\n@@ -136,1 +100,1 @@\n-                0);\n+                NULL);\n@@ -152,1 +116,0 @@\n-    g_print(\"will filter?\\n\");\n@@ -160,2 +123,0 @@\n-    g_print(\"filterIME -> keyval: %d, press: %d, filtered: %d\\n\", event->key.keyval, (event->key.type == GDK_KEY_PRESS), filtered);\n-\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window_ime.cpp","additions":14,"deletions":53,"binary":false,"changes":67,"status":"modified"}]}