{"files":[{"patch":"@@ -329,2 +329,0 @@\n-\n-        control.addEventHandler(InputMethodEvent.INPUT_METHOD_TEXT_CHANGED, inputMethodTextChangedHandler);\n@@ -339,0 +337,5 @@\n+        \/\/ IMPORTANT: both setOnInputMethodTextChanged() and setInputMethodRequests() are required for IME to work\n+        if (control.getOnInputMethodTextChanged() == null) {\n+            control.setOnInputMethodTextChanged(inputMethodTextChangedHandler);\n+        }\n+\n@@ -405,2 +408,0 @@\n-        getSkinnable().removeEventHandler(InputMethodEvent.INPUT_METHOD_TEXT_CHANGED, inputMethodTextChangedHandler);\n-\n@@ -410,0 +411,5 @@\n+\n+        if (getSkinnable().getOnInputMethodTextChanged() == inputMethodTextChangedHandler) {\n+            getSkinnable().setOnInputMethodTextChanged(null);\n+        }\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TextInputControlSkin.java","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1350,0 +1350,31 @@\n+    \/**\n+     * Test that both inputMethodRequests and onInputMethodTextChanged properties, required for IME to work\n+     * (see Scene:2239) are set by a skin, on replacing a skin, and on uninstalling a skin.\n+     *\/\n+    @Test\n+    public void testTextInput_BothIME() {\n+        TextField t = new TextField();\n+        installDefaultSkin(t);\n+        InputMethodRequests mr1 = t.getInputMethodRequests();\n+        EventHandler<? super InputMethodEvent> tc1 = t.getOnInputMethodTextChanged();\n+\n+        assertNotNull(\"InputMethodRequests must be set by a skin\", mr1);\n+        assertNotNull(\"onInputMethodTextChanged must be set by a skin\", tc1);\n+\n+        replaceSkin(t);\n+        InputMethodRequests mr2 = t.getInputMethodRequests();\n+        EventHandler<? super InputMethodEvent> tc2 = t.getOnInputMethodTextChanged();\n+\n+        assertNotNull(\"InputMethodRequests must be set by a skin 2\", mr2);\n+        assertNotNull(\"onInputMethodTextChanged must be set by a skin 2\", tc2);\n+\n+        assertNotEquals(\"InputMethodRequests set by an old skin must be replaced by the new skin\", mr1, mr2);\n+        assertNotEquals(\"onInputMethodTextChanged set by an old skin must be replaced by the new skin\", tc1, tc2);\n+\n+        t.setSkin(null);\n+        InputMethodRequests mr3 = t.getInputMethodRequests();\n+        EventHandler<? super InputMethodEvent> tc3 = t.getOnInputMethodTextChanged();\n+        assertNull(\"InputMethodRequests must be cleared by uninstalling a skin\", mr3);\n+        assertNull(\"onInputMethodTextChanged must be cleared by uninstalling a skin\", tc3);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinCleanupTest.java","additions":31,"deletions":0,"binary":false,"changes":31,"status":"modified"}]}