{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -154,0 +154,3 @@\n+            SingleSelectionModel<T> sm = getSelectionModel();\n+            if (sm == null) return;\n+\n@@ -156,1 +159,1 @@\n-                getSelectionModel().select(index);\n+                sm.select(index);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ChoiceBox.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -243,1 +243,0 @@\n-\n@@ -245,0 +244,2 @@\n+            if (sm == null) return;\n+\n@@ -281,1 +282,4 @@\n-                    getSelectionModel().clearSelection();\n+                    SingleSelectionModel<T> selectionModel = getSelectionModel();\n+                    if (selectionModel != null) {\n+                        selectionModel.clearSelection();\n+                    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ComboBox.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,0 +56,1 @@\n+import javafx.scene.control.SingleSelectionModel;\n@@ -324,3 +325,7 @@\n-                T item = comboBox.getSelectionModel().getSelectedItem();\n-                listView.getSelectionModel().clearSelection();\n-                listView.getSelectionModel().select(item);\n+                SingleSelectionModel<T> selectionModel = comboBox.getSelectionModel();\n+\n+                if (selectionModel != null) {\n+                    T item = selectionModel.getSelectedItem();\n+                    listView.getSelectionModel().clearSelection();\n+                    listView.getSelectionModel().select(item);\n+                }\n@@ -399,0 +404,5 @@\n+        SingleSelectionModel<T> comboBoxSM = comboBox.getSelectionModel();\n+        if (comboBoxSM == null) {\n+            return;\n+        }\n+\n@@ -416,1 +426,1 @@\n-                int index = comboBox.getSelectionModel().getSelectedIndex();\n+                int index = comboBoxSM.getSelectedIndex();\n@@ -557,0 +567,3 @@\n+            SingleSelectionModel<T> selectionModel = comboBox.getSelectionModel();\n+            if (selectionModel == null) return;\n+\n@@ -558,1 +571,1 @@\n-            comboBox.getSelectionModel().select(index);\n+            selectionModel.select(index);\n@@ -563,3 +576,6 @@\n-        comboBox.getSelectionModel().selectedItemProperty().addListener(o -> {\n-            listViewSelectionDirty = true;\n-        });\n+        SingleSelectionModel<T> selectionModel = comboBox.getSelectionModel();\n+        if (selectionModel != null) {\n+            selectionModel.selectedItemProperty().addListener(o -> {\n+                listViewSelectionDirty = true;\n+            });\n+        }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/ComboBoxListViewSkin.java","additions":25,"deletions":9,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import org.junit.After;\n@@ -59,2 +60,0 @@\n-import javafx.event.Event;\n-import javafx.event.EventHandler;\n@@ -73,0 +72,8 @@\n+        Thread.currentThread().setUncaughtExceptionHandler((thread, throwable) -> {\n+            if (throwable instanceof RuntimeException) {\n+                throw (RuntimeException) throwable;\n+            } else {\n+                Thread.currentThread().getThreadGroup().uncaughtException(thread, throwable);\n+            }\n+        });\n+\n@@ -77,0 +84,4 @@\n+    @After public void cleanUp() {\n+        Thread.currentThread().setUncaughtExceptionHandler(null);\n+    }\n+\n@@ -157,0 +168,13 @@\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnValueChange() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        box.setSkin(new ChoiceBoxSkin<>(box));\n+        box.setItems(items);\n+        box.setSelectionModel(null);\n+\n+        box.setValue(items.get(1));\n+\n+        String text = ChoiceBoxSkinNodesShim.getChoiceBoxSelectedText((ChoiceBoxSkin<?>) box.getSkin());\n+        assertEquals(items.get(1), text);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ChoiceBoxTest.java","additions":27,"deletions":3,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -288,0 +288,77 @@\n+    @Test public void testNullSelectionModelDoesNotThrowNPEInSkinOnValueChange() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        ListCell<String> buttonCell = new ListCell<>() {\n+            @Override\n+            protected void updateItem(String item, boolean empty) {\n+                super.updateItem(item, empty);\n+                setText(item);\n+            }\n+        };\n+        comboBox.setButtonCell(buttonCell);\n+        comboBox.setItems(items);\n+        comboBox.setSelectionModel(null);\n+\n+        \/\/ Should not throw an NPE.\n+        comboBox.setValue(items.get(1));\n+\n+        assertEquals(items.get(1), comboBox.getValue());\n+        assertEquals(items.get(1), comboBox.getButtonCell().getText());\n+    }\n+\n+    @Test public void testNullSelectionModelDoesNotThrowNPEInSkinOnLayout() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        comboBox.setItems(items);\n+\n+        comboBox.setValue(items.get(1));\n+        comboBox.setSelectionModel(null);\n+\n+        \/\/ Should not throw an NPE.\n+        comboBox.layout();\n+    }\n+\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnEditableChange() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        comboBox.setEditable(true);\n+        comboBox.setItems(items);\n+        comboBox.setSelectionModel(null);\n+\n+        \/\/ Should not throw an NPE.\n+        comboBox.setEditable(false);\n+    }\n+\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnValueChange() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        ComboBox<String> comboBox = new ComboBox<>();\n+        comboBox.setItems(items);\n+        comboBox.setSelectionModel(null);\n+\n+        \/\/ Should not throw an NPE.\n+        comboBox.setValue(items.get(1));\n+\n+        assertEquals(items.get(1), comboBox.getValue());\n+    }\n+\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnListViewSelect() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        comboBox.setItems(items);\n+        comboBox.setSelectionModel(null);\n+        ListView<String> listView = (ListView<String>) ((ComboBoxListViewSkin<String>) comboBox.getSkin())\n+                .getPopupContent();\n+\n+        \/\/ Should not throw an NPE.\n+        listView.getSelectionModel().select(1);\n+    }\n+\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnSkinCreation() {\n+        ComboBox<String> comboBox = new ComboBox<>();\n+        comboBox.setSelectionModel(null);\n+\n+        \/\/ Should not throw an NPE.\n+        comboBox.setSkin(new ComboBoxListViewSkin<>(comboBox));\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ComboBoxTest.java","additions":77,"deletions":0,"binary":false,"changes":77,"status":"modified"}]}