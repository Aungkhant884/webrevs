{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -154,0 +154,3 @@\n+            SingleSelectionModel<T> sm = getSelectionModel();\n+            if (sm == null) return;\n+\n@@ -156,1 +159,1 @@\n-                getSelectionModel().select(index);\n+                sm.select(index);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ChoiceBox.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -243,1 +243,0 @@\n-\n@@ -245,0 +244,2 @@\n+            if (sm == null) return;\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ComboBox.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,0 +56,1 @@\n+import javafx.scene.control.SingleSelectionModel;\n@@ -399,0 +400,5 @@\n+        SingleSelectionModel<T> comboBoxSM = comboBox.getSelectionModel();\n+        if (comboBoxSM == null) {\n+            return;\n+        }\n+\n@@ -416,1 +422,1 @@\n-                int index = comboBox.getSelectionModel().getSelectedIndex();\n+                int index = comboBoxSM.getSelectedIndex();\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/ComboBoxListViewSkin.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import static org.junit.Assert.fail;\n@@ -59,2 +60,0 @@\n-import javafx.event.Event;\n-import javafx.event.EventHandler;\n@@ -75,0 +74,8 @@\n+\n+        Thread.currentThread().setUncaughtExceptionHandler((thread, throwable) -> {\n+            if (throwable instanceof RuntimeException) {\n+                throw (RuntimeException) throwable;\n+            } else {\n+                Thread.currentThread().getThreadGroup().uncaughtException(thread, throwable);\n+            }\n+        });\n@@ -157,0 +164,17 @@\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnValueChange() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        box.setSkin(new ChoiceBoxSkin<>(box));\n+        box.setItems(items);\n+        box.setSelectionModel(null);\n+\n+        try {\n+            box.setValue(items.get(1));\n+        } catch (Exception e) {\n+            fail(\"ChoiceBox.setValue() should not throw an exception.\");\n+        }\n+\n+        String text = ChoiceBoxSkinNodesShim.getChoiceBoxSelectedText((ChoiceBoxSkin<?>) box.getSkin());\n+        assertEquals(items.get(1), text);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ChoiceBoxTest.java","additions":27,"deletions":3,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -288,0 +288,23 @@\n+    @Test public void testNullSelectionModelDoesNotThrowNPEOnValueChange() {\n+        ObservableList<String> items = FXCollections.observableArrayList(\"ITEM1\", \"ITEM2\");\n+\n+        ListCell<String> buttonCell = new ListCell<>() {\n+            @Override\n+            protected void updateItem(String item, boolean empty) {\n+                super.updateItem(item, empty);\n+                setText(item);\n+            }\n+        };\n+        comboBox.setButtonCell(buttonCell);\n+        comboBox.setItems(items);\n+        comboBox.setSelectionModel(null);\n+\n+        try {\n+            comboBox.setValue(items.get(1));\n+        } catch (Exception e) {\n+            fail(\"ComboBox.setValue() should not throw an exception.\");\n+        }\n+\n+        assertEquals(items.get(1), comboBox.getButtonCell().getText());\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ComboBoxTest.java","additions":23,"deletions":0,"binary":false,"changes":23,"status":"modified"}]}