{"files":[{"patch":"@@ -29,2 +29,2 @@\n-import javafx.beans.InvalidationListener;\n-import javafx.beans.Observable;\n+import com.sun.javafx.scene.control.behavior.ListCellBehavior;\n+\n@@ -32,3 +32,0 @@\n-import javafx.scene.Node;\n-import javafx.scene.control.Accordion;\n-import javafx.scene.control.Button;\n@@ -38,2 +35,1 @@\n-\n-import com.sun.javafx.scene.control.behavior.ListCellBehavior;\n+import javafx.scene.layout.Region;\n@@ -55,2 +51,0 @@\n-    private double fixedCellSize;\n-    private boolean fixedCellSizeEnabled;\n@@ -59,2 +53,0 @@\n-\n-\n@@ -80,2 +72,0 @@\n-\n-        setupListeners();\n@@ -84,21 +74,0 @@\n-    private void setupListeners() {\n-        ListView listView = getSkinnable().getListView();\n-        if (listView == null) {\n-            getSkinnable().listViewProperty().addListener(new InvalidationListener() {\n-                @Override public void invalidated(Observable observable) {\n-                    getSkinnable().listViewProperty().removeListener(this);\n-                    setupListeners();\n-                }\n-            });\n-        } else {\n-            this.fixedCellSize = listView.getFixedCellSize();\n-            this.fixedCellSizeEnabled = fixedCellSize > 0;\n-            registerChangeListener(listView.fixedCellSizeProperty(), e -> {\n-                this.fixedCellSize = getSkinnable().getListView().getFixedCellSize();\n-                this.fixedCellSizeEnabled = fixedCellSize > 0;\n-            });\n-        }\n-    }\n-\n-\n-\n@@ -130,1 +99,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -143,1 +113,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -152,1 +123,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -155,1 +127,0 @@\n-\n@@ -158,0 +129,5 @@\n+\n+    private double getFixedCellSize() {\n+        ListView<?> listView = getSkinnable().getListView();\n+        return listView != null ? listView.getFixedCellSize() : Region.USE_COMPUTED_SIZE;\n+    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/ListCellSkin.java","additions":14,"deletions":38,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -45,0 +45,1 @@\n+import static javafx.scene.control.ControlShim.*;\n@@ -726,0 +727,24 @@\n+\n+    \/**\n+     * Test that min\/max\/pref height respect fixedCellSize.\n+     * Sanity test when fixing JDK-8246745.\n+     *\/\n+    @Test\n+    public void testListCellHeights() {\n+        ListCell<Object> cell =  new ListCell<>();\n+        ListView<Object> listView = new ListView<>();\n+        cell.updateListView(listView);\n+        installDefaultSkin(cell);\n+        listView.setFixedCellSize(100);\n+        assertEquals(\"pref height must be fixedCellSize\",\n+                listView.getFixedCellSize(),\n+                cell.prefHeight(-1), 1);\n+        assertEquals(\"min height must be fixedCellSize\",\n+                listView.getFixedCellSize(),\n+                cell.minHeight(-1), 1);\n+        assertEquals(\"max height must be fixedCellSize\",\n+                listView.getFixedCellSize(),\n+                cell.maxHeight(-1), 1);\n+    }\n+\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListCellTest.java","additions":25,"deletions":0,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -42,0 +42,1 @@\n+import javafx.scene.control.ListCell;\n@@ -58,0 +59,26 @@\n+\/\/ ------------------ ListCell\n+\n+    @Test\n+    public void testListCellReplaceListViewWithNull() {\n+        ListCell<Object> cell =  new ListCell<>();\n+        ListView<Object> listView = new ListView<>();\n+        cell.updateListView(listView);\n+        installDefaultSkin(cell);\n+        cell.updateListView(null);\n+        \/\/ 8246745: updating the old listView must not throw NPE in skin\n+        listView.setFixedCellSize(100);\n+    }\n+\n+   @Test\n+   public void testListCellPrefHeightOnReplaceListView() {\n+       ListCell<Object> cell =  new ListCell<>();\n+       cell.updateListView(new ListView<>());\n+       installDefaultSkin(cell);\n+       ListView<Object> listView = new ListView<>();\n+       listView.setFixedCellSize(100);\n+       cell.updateListView(listView);\n+       assertEquals(\"fixed cell set to value of new listView\",\n+               cell.getListView().getFixedCellSize(),\n+               cell.prefHeight(-1), 1);\n+   }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinCleanupTest.java","additions":27,"deletions":0,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -113,1 +113,0 @@\n-                ListCell.class,\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinMemoryLeakTest.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}