{"files":[{"patch":"@@ -133,1 +133,1 @@\n-            \/**\n+            \/*\n@@ -137,2 +137,2 @@\n-            IndexedCell firstVisibleCell = flow.getFirstVisibleCell();\n-            IndexedCell lastVisibleCell = flow.getLastVisibleCell();\n+            IndexedCell<?> firstVisibleCell = flow.getFirstVisibleCell();\n+            IndexedCell<?> lastVisibleCell = flow.getLastVisibleCell();\n@@ -142,1 +142,1 @@\n-                    flow.scrollTo(index - 1);\n+                    index = Math.max(0, index - 1);\n@@ -144,1 +144,1 @@\n-                    flow.scrollTo(index + 1);\n+                    index = Math.min(flow.getCellCount(), index + 1);\n@@ -146,0 +146,1 @@\n+                flow.scrollTo(index);\n@@ -148,1 +149,1 @@\n-                    IndexedCell cell = firstVisibleCell;\n+                    IndexedCell<?> cell = firstVisibleCell;\n@@ -154,1 +155,1 @@\n-                    IndexedCell cell = lastVisibleCell;\n+                    IndexedCell<?> cell = lastVisibleCell;\n","filename":"modules\/javafx.controls\/src\/main\/java\/com\/sun\/javafx\/scene\/control\/VirtualScrollBar.java","additions":8,"deletions":7,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -1675,2 +1675,4 @@\n-                double prevIndexSize = getCellLength(firstIndex - 1);\n-                addLeadingCells(firstIndex - 1, getCellPosition(firstCell) - prevIndexSize);\n+                int index = Math.max(0, firstIndex - 1);\n+\n+                double prevIndexSize = getCellLength(index);\n+                addLeadingCells(index, getCellPosition(firstCell) - prevIndexSize);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1770,0 +1770,71 @@\n+    \/**\n+     * Scrolling via the trough (-> {@link com.sun.javafx.scene.control.VirtualScrollBar#adjustValue(double)}) should\n+     * not throw any exception.\n+     * This happened in the past when scrolling up (more) when we already only see the uppermost cell with the index 0.\n+     * This index was subtracted by 1, leading to an {@link IndexOutOfBoundsException}.\n+     *\n+     * @see <a href=\"https:\/\/bugs.openjdk.org\/browse\/JDK-8311983\">JDK-8311983<\/a>\n+     *\/\n+    @Test\n+    public void testScrollBarValueAdjustmentShouldNotThrowIOOBE() {\n+        flow = new VirtualFlowShim<>();\n+        flow.setFixedCellSize(512);\n+        flow.setCellFactory(fw -> new CellStub(flow));\n+        flow.setCellCount(2);\n+        flow.resize(250, 300);\n+\n+        pulse();\n+\n+        \/\/ Scroll down.\n+        flow.shim_getVbar().adjustValue(0.9605263157894737);\n+        \/\/ Scroll up.\n+        flow.shim_getVbar().adjustValue(0.05263157894736842);\n+\n+        \/\/ This should not throw any exception. It used to throw an IndexOutOfBoundsException.\n+        flow.shim_getVbar().adjustValue(0.05263157894736842);\n+    }\n+\n+    @Test\n+    public void testScrollBarValueAdjustmentShouldScrollOneDown() {\n+        flow = new VirtualFlowShim<>();\n+        flow.setFixedCellSize(512);\n+        flow.setCellFactory(fw -> new CellStub(flow));\n+        flow.setCellCount(5);\n+        flow.resize(250, 300);\n+\n+        pulse();\n+\n+        assertEquals(0, flow.getLastVisibleCell().getIndex());\n+\n+        \/\/ Scroll down.\n+        flow.shim_getVbar().adjustValue(1);\n+        pulse();\n+\n+        assertEquals(1, flow.getLastVisibleCell().getIndex());\n+    }\n+\n+    @Test\n+    public void testScrollBarValueAdjustmentShouldScrollOneUp() {\n+        flow = new VirtualFlowShim<>();\n+        flow.setFixedCellSize(512);\n+        flow.setCellFactory(fw -> new CellStub(flow));\n+        flow.setCellCount(5);\n+        flow.resize(250, 300);\n+\n+        pulse();\n+\n+        assertEquals(0, flow.getFirstVisibleCell().getIndex());\n+\n+        \/\/ Scroll completely down.\n+        flow.shim_getVbar().setValue(1.0);\n+        pulse();\n+\n+        assertEquals(4, flow.getFirstVisibleCell().getIndex());\n+\n+        \/\/ Scroll up.\n+        flow.shim_getVbar().adjustValue(0.0);\n+        pulse();\n+\n+        assertEquals(3, flow.getFirstVisibleCell().getIndex());\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/VirtualFlowTest.java","additions":71,"deletions":0,"binary":false,"changes":71,"status":"modified"}]}