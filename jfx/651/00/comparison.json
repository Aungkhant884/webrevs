{"files":[{"patch":"@@ -42,2 +42,4 @@\n-+ (jint)mapNsOperationToJavaMask:(NSDragOperation)operation;\n-+ (jint)getRecommendedActionForMask:(NSDragOperation)operation;\n++ (jint)mapNsOperationToJavaMaskExternal:(NSDragOperation)operation;\n++ (jint)mapNSOperationToJavaMaskInternal:(NSDragOperation)operation;\n++ (jint)getRecommendedActionForMaskExternal:(NSDragOperation)operation;\n++ (jint)getRecommendedActionForMaskInternal:(NSDragOperation)operation;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassDragSource.h","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -106,0 +106,3 @@\n+    \/\/ The upper layers of Java code will turn TransferMode.ANY into a bitwise-OR of COPY,\n+    \/\/ MOVE, and REFERENCE. This condition will never be true which means the only\n+    \/\/ NSDragOperation flags we will set will be Copy, Move, and Link.\n@@ -114,1 +117,3 @@\n-+ (jint)mapNsOperationToJavaMask:(NSDragOperation)operation\n+\/\/ In this case the NSDragOperation was provided to us by an external\n+\/\/ application.\n++ (jint)mapNsOperationToJavaMaskExternal:(NSDragOperation)operation\n@@ -116,1 +121,1 @@\n-    LOG(\"GlassDragSource:mapNsOperationToJavaMask: %d\", operation);\n+    LOG(\"GlassDragSource:mapNsOperationToJavaMaskExternal: %d\", operation);\n@@ -144,0 +149,28 @@\n+\/\/ The NSDragOperation mas was generated by this JavaFX application so we\n+\/\/ interpret Generic to be a synonym for Move.\n++ (jint)mapNsOperationToJavaMaskInternal:(NSDragOperation)operation\n+{\n+    LOG(\"GlassDragSource:mapNsOperationToJavaMaskInternal: %d\", operation);\n+\n+    jint mask = com_sun_glass_ui_Clipboard_ACTION_NONE;\n+    if (operation & NSDragOperationGeneric)\n+    {\n+        mask |= com_sun_glass_ui_Clipboard_ACTION_MOVE;\n+    }\n+    if (operation & NSDragOperationLink)\n+    {\n+        mask |= com_sun_glass_ui_Clipboard_ACTION_REFERENCE;\n+    }\n+    if (operation & NSDragOperationCopy)\n+    {\n+        mask |= com_sun_glass_ui_Clipboard_ACTION_COPY;\n+    }\n+    if (operation & NSDragOperationMove)\n+    {\n+        mask |= com_sun_glass_ui_Clipboard_ACTION_MOVE;\n+    }\n+    return mask;\n+}\n+\n+\/\/ The NSDragOperation was provided to us by an external\n+\/\/ application.\n@@ -145,1 +178,1 @@\n-+ (jint)getRecommendedActionForMask:(NSDragOperation)operation\n++ (jint)getRecommendedActionForMaskExternal:(NSDragOperation)operation\n@@ -147,1 +180,1 @@\n-    LOG(\"GlassDragSource:getRecommendedActionForMask: %d\", operation);\n+    LOG(\"GlassDragSource:getRecommendedActionForMaskExternal: %d\", operation);\n@@ -172,1 +205,26 @@\n-    GLASS_LOG(\"WARNING: unhandled case in mapNsOperationToJavaMask: %d\", operation);\n+    GLASS_LOG(\"WARNING: unhandled case in getRecommendedActionForMaskExternal: %d\", operation);\n+    return com_sun_glass_ui_Clipboard_ACTION_NONE;\n+}\n+\n+\/\/ The NSDragOperation mas was generated by this JavaFX application so we\n+\/\/ interpret Generic to be a synonym for Move.\n+\/\/ To match historical behavior (as embodied in getRecommendedActionForMaskExternal)\n+\/\/ we prefer Copy over Move if both are available.\n+\/\/ Return a recommendedAction (one), but the input is a mask\n++ (jint)getRecommendedActionForMaskInternal:(NSDragOperation)operation\n+{\n+    LOG(\"GlassDragSource:getRecommendedActionForMaskInternal: %d\", operation);\n+\n+    if (operation & NSDragOperationCopy) {\n+        return com_sun_glass_ui_Clipboard_ACTION_COPY;\n+    }\n+    if (operation & NSDragOperationGeneric) {\n+        return com_sun_glass_ui_Clipboard_ACTION_MOVE;\n+    }\n+    if (operation & NSDragOperationMove) {\n+        return com_sun_glass_ui_Clipboard_ACTION_MOVE;\n+    }\n+    if (operation & NSDragOperationLink) {\n+        return com_sun_glass_ui_Clipboard_ACTION_REFERENCE;\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassDragSource.m","additions":63,"deletions":5,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -935,0 +935,1 @@\n+    jint recommendedAction = com_sun_glass_ui_Clipboard_ACTION_NONE;\n@@ -936,1 +937,8 @@\n-    [GlassDragSource setSupportedActions:[GlassDragSource mapNsOperationToJavaMask:operation]];\n+    if (info.draggingSource != nil) {\n+        [GlassDragSource setSupportedActions:[GlassDragSource mapNsOperationToJavaMaskInternal:operation]];\n+        recommendedAction = [GlassDragSource getRecommendedActionForMaskInternal:operation];\n+    }\n+    else {\n+        [GlassDragSource setSupportedActions:[GlassDragSource mapNsOperationToJavaMaskExternal:operation]];\n+        recommendedAction = [GlassDragSource getRecommendedActionForMaskExternal:operation];\n+    }\n@@ -938,1 +946,0 @@\n-    jint recommendedAction = [GlassDragSource getRecommendedActionForMask:operation];\n@@ -972,0 +979,10 @@\n+    \/\/ The Command key masks out every operation other than NSDragOperationGeneric. We want\n+    \/\/ internal Move events to get through this filtering so we copy the Move bit into the\n+    \/\/ Generic bit and treat Generic as a synonym for Move.\n+    if (isLocal)\n+    {\n+        NSDragOperation result = self->dragOperation;\n+        if (result & NSDragOperationMove)\n+            result |= NSDragOperationGeneric;\n+        return result;\n+    }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassViewDelegate.m","additions":19,"deletions":2,"binary":false,"changes":21,"status":"modified"}]}