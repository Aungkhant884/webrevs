{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -63,0 +63,3 @@\n+        \/\/ Use the alternative creation path for MouseEvent by default, see JDK-8253769\n+        this.alternative = true;\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/com\/sun\/javafx\/scene\/control\/infrastructure\/MouseEventFirer.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -363,0 +363,12 @@\n+\n+        \/\/ Any mouse or touch press on the scene will clear the focusVisible flag of\n+        \/\/ the current focus owner, if there is one.\n+        EventHandler<InputEvent> pressedHandler = event -> {\n+            Node focusOwner = getFocusOwner();\n+            if (focusOwner != null) {\n+                getKeyHandler().setFocusVisible(focusOwner, false);\n+            }\n+        };\n+\n+        addEventFilter(MouseEvent.MOUSE_PRESSED, pressedHandler);\n+        addEventFilter(TouchEvent.TOUCH_PRESSED, pressedHandler);\n@@ -4039,1 +4051,3 @@\n-        private void setFocusOwner(final Node value) {\n+        private void setFocusOwner(Node value, boolean focusVisible) {\n+            this.focusVisible = focusVisible;\n+\n@@ -4056,0 +4070,1 @@\n+            this.focusVisible = focusVisible;\n@@ -4103,1 +4118,1 @@\n-                setFocusOwner(null);\n+                setFocusOwner(null, focusVisible);\n@@ -4106,2 +4121,1 @@\n-                    this.focusVisible = focusVisible;\n-                    setFocusOwner(node);\n+                    setFocusOwner(node, focusVisible);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/Scene.java","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import javafx.event.EventTarget;\n@@ -44,0 +45,1 @@\n+import java.util.Collections;\n@@ -52,0 +54,5 @@\n+import javafx.scene.input.MouseButton;\n+import javafx.scene.input.MouseEvent;\n+import javafx.scene.input.PickResult;\n+import javafx.scene.input.TouchEvent;\n+import javafx.scene.input.TouchPoint;\n@@ -778,0 +785,19 @@\n+    private void fireMousePressedEvent(EventTarget target) {\n+        double x = 10, y = 10;\n+        PickResult pickResult = new PickResult(target, x, y);\n+        Event.fireEvent(target, new MouseEvent(\n+                MouseEvent.MOUSE_PRESSED, x, y, x, y, MouseButton.PRIMARY, 1,\n+                false, false, false, false,\n+                true, false, false,\n+                false, false, false, pickResult));\n+    }\n+\n+    private void fireTouchPressedEvent(EventTarget target) {\n+        double x = 10, y = 10;\n+        PickResult pickResult = new PickResult(scene, x, y);\n+        Event.fireEvent(target, new TouchEvent(\n+                TouchEvent.TOUCH_PRESSED,\n+                new TouchPoint(0, TouchPoint.State.PRESSED, x, y, x, y, target, pickResult),\n+                Collections.emptyList(), 0, false, false, false, false));\n+    }\n+\n@@ -851,0 +877,38 @@\n+    \/**\n+     * When any region of the window is clicked, the focus owner loses visible focus\n+     * even when the focus owner doesn't change.\n+     *\/\n+    @Test public void testMousePressedClearsFocusVisible() {\n+        Node node1 = n(), node2 = n();\n+        Group g = new Group(node1, node2);\n+        scene.setRoot(g);\n+        fireTabKeyEvent(g);\n+\n+        assertIsFocused(scene, node1);\n+        assertIsFocusVisible(node1);\n+\n+        fireMousePressedEvent(scene);\n+\n+        assertIsFocused(scene, node1);\n+        assertNotFocusVisible(node1);\n+    }\n+\n+    \/**\n+     * When any region of the window is touched, the focus owner loses visible focus\n+     * even when the focus owner doesn't change.\n+     *\/\n+    @Test public void testTouchPressedClearsFocusVisible() {\n+        Node node1 = n(), node2 = n();\n+        Group g = new Group(node1, node2);\n+        scene.setRoot(g);\n+        fireTabKeyEvent(g);\n+\n+        assertIsFocused(scene, node1);\n+        assertIsFocusVisible(node1);\n+\n+        fireTouchPressedEvent(scene);\n+\n+        assertIsFocused(scene, node1);\n+        assertNotFocusVisible(node1);\n+    }\n+\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/FocusTest.java","additions":64,"deletions":0,"binary":false,"changes":64,"status":"modified"}]}