{"files":[{"patch":"@@ -272,8 +272,0 @@\n-        getSkinnable().getTabs().removeListener(weakTabsListener);\n-\n-        getChildren().remove(tabHeaderArea);\n-        tabHeaderArea.removeListeners();\n-\n-        for (TabContentRegion contentRegion : tabContentRegions) {\n-            contentRegion.dispose();\n-        }\n@@ -284,0 +276,11 @@\n+        getSkinnable().getTabs().removeListener(weakTabsListener);\n+        tabHeaderArea.removeListeners();\n+\n+\n+        \/\/ Control and Skin share the list of children, so children that are\n+        \/\/ added by Skin are actually added to control's list of children,\n+        \/\/ so a skin should remove the children that it adds.\n+        getChildren().remove(tabHeaderArea);\n+        for (Tab tab : getSkinnable().getTabs()) {\n+            removeTabContent(tab);\n+        }\n@@ -690,2 +693,1 @@\n-                contentRegion.dispose();\n-                tabContentRegions.remove(contentRegion);\n+                removeTabContent(contentRegion);\n@@ -697,0 +699,6 @@\n+    private void removeTabContent(TabContentRegion contentRegion) {\n+        contentRegion.dispose();\n+        tabContentRegions.remove(contentRegion);\n+        getChildren().remove(contentRegion);\n+    }\n+\n@@ -716,1 +724,1 @@\n-        Side tabPosition = getSkinnable() != null ? getSkinnable().getSide() : Side.TOP;\n+        Side tabPosition = getSkinnable().getSide();\n@@ -1226,1 +1234,1 @@\n-            for(Node child : headersRegion.getChildren()) {\n+            for (Node child : headersRegion.getChildren()) {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TabPaneSkin.java","additions":20,"deletions":12,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+import javafx.scene.control.skin.TabPaneSkin;\n@@ -45,0 +46,2 @@\n+import javafx.scene.control.Tab;\n+import javafx.scene.control.TabPane;\n@@ -260,0 +263,62 @@\n+\/\/-------- TabPane\n+    @Test\n+    public void testChildrenCountAfterSkinIsReplaced() {\n+      TabPane tabPane = new TabPane();\n+      tabPane.getTabs().addAll(new Tab(\"0\"), new Tab(\"1\"));\n+      showControl(tabPane, false);\n+      assertEquals(3, tabPane.getChildrenUnmodifiable().size());\n+      TabPaneSkin skin1 = (TabPaneSkin)createAlternativeSkin(tabPane);\n+      assertEquals(6, tabPane.getChildrenUnmodifiable().size());\n+      tabPane.setSkin(skin1);\n+      assertEquals(3, tabPane.getChildrenUnmodifiable().size());\n+    }\n+\n+    @Test\n+    public void testChildrenCountAfterSkinIsRemoved() {\n+      TabPane tabPane = new TabPane();\n+      assertEquals(0, tabPane.getChildrenUnmodifiable().size());\n+      tabPane.getTabs().addAll(new Tab(\"0\"), new Tab(\"1\"));\n+      showControl(tabPane, false);\n+      assertEquals(3, tabPane.getChildrenUnmodifiable().size());\n+      root.getChildren().remove(tabPane);\n+      assertTrue(tabPane.getSkin() instanceof TabPaneSkin);\n+      assertEquals(3, tabPane.getChildrenUnmodifiable().size());\n+      tabPane.setSkin(null);\n+      assertNull(tabPane.getSkin());\n+      assertEquals(0, tabPane.getChildrenUnmodifiable().size());\n+    }\n+\n+    @Test\n+    public void testNPEWhenAddTabsAfterSkinIsReplaced() {\n+      TabPane tabPane = new TabPane();\n+      tabPane.getTabs().addAll(new Tab(\"0\"), new Tab(\"1\"));\n+      showControl(tabPane, false);\n+      replaceSkin(tabPane);\n+      tabPane.getTabs().addAll(new Tab(\"2\"), new Tab(\"3\"));\n+    }\n+\n+    @Test\n+    public void testNPEWhenRemTabAfterSkinIsReplaced() {\n+      TabPane tabPane = new TabPane();\n+      tabPane.getTabs().addAll(new Tab(\"0\"), new Tab(\"1\"));\n+      showControl(tabPane, false);\n+      replaceSkin(tabPane);\n+      tabPane.getTabs().remove(0);\n+    }\n+\n+    @Test\n+    public void testAddRemTabsAfterSkinIsReplaced() {\n+      TabPane tabPane = new TabPane();\n+      tabPane.getTabs().addAll(new Tab(\"0\"), new Tab(\"1\"));\n+      showControl(tabPane, false);\n+      assertEquals(2, tabPane.getTabs().size());\n+      assertEquals(3, tabPane.getChildrenUnmodifiable().size());\n+      replaceSkin(tabPane);\n+      tabPane.getTabs().addAll(new Tab(\"2\"), new Tab(\"3\"));\n+      assertEquals(4, tabPane.getTabs().size());\n+      assertEquals(5, tabPane.getChildrenUnmodifiable().size());\n+      tabPane.getTabs().clear();\n+      assertEquals(0, tabPane.getTabs().size());\n+      assertEquals(1, tabPane.getChildrenUnmodifiable().size());\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinCleanupTest.java","additions":65,"deletions":0,"binary":false,"changes":65,"status":"modified"}]}