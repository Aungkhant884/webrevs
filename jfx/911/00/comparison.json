{"files":[{"patch":"@@ -28,0 +28,5 @@\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+\n@@ -45,4 +50,2 @@\n-import java.util.ArrayList;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.ListIterator;\n+\n+import com.sun.javafx.scene.control.ListenerHelper;\n@@ -66,0 +69,1 @@\n+    private ListenerHelper contentDividerListenerHelper;\n@@ -92,1 +96,1 @@\n-\/\/        control.setManaged(false);\n+\n@@ -104,3 +108,1 @@\n-        for (SplitPane.Divider d: getSkinnable().getDividers()) {\n-            addDivider(d);\n-        }\n+        rebuildDividers(false);\n@@ -108,1 +110,2 @@\n-        registerChangeListener(control.orientationProperty(), e -> {\n+        ListenerHelper lh = ListenerHelper.get(this);\n+        lh.addChangeListener(control.orientationProperty(), (v) -> {\n@@ -116,2 +119,2 @@\n-        registerChangeListener(control.widthProperty(), e -> getSkinnable().requestLayout());\n-        registerChangeListener(control.heightProperty(), e -> getSkinnable().requestLayout());\n+        lh.addChangeListener(control.widthProperty(), (v) -> getSkinnable().requestLayout());\n+        lh.addChangeListener(control.heightProperty(), (v) -> getSkinnable().requestLayout());\n@@ -128,0 +131,7 @@\n+    @Override\n+    public void dispose() {\n+        removeAllDividers();\n+\n+        super.dispose();\n+    }\n+\n@@ -523,1 +533,1 @@\n-        getSkinnable().getItems().addListener((ListChangeListener<Node>) c -> {\n+        ListenerHelper.get(this).addListChangeListener(getSkinnable().getItems(), (ListChangeListener<Node>) c -> {\n@@ -548,6 +558,2 @@\n-            \/\/ TODO there may be a more efficient way than rebuilding all the dividers\n-            \/\/ everytime the list changes.\n-            removeAllDividers();\n-            for (SplitPane.Divider d: getSkinnable().getDividers()) {\n-                addDivider(d);\n-            }\n+\n+            rebuildDividers(true);\n@@ -621,10 +627,21 @@\n-    private void addDivider(SplitPane.Divider d) {\n-        ContentDivider c = new ContentDivider(d);\n-        c.setInitialPos(d.getPosition());\n-        c.setDividerPos(-1);\n-        ChangeListener<Number> posPropertyListener = new PosPropertyListener(c);\n-        c.setPosPropertyListener(posPropertyListener);\n-        d.positionProperty().addListener(posPropertyListener);\n-        initializeDividerEventHandlers(c);\n-        contentDividers.add(c);\n-        getChildren().add(c);\n+    private void rebuildDividers(boolean removeAllDividers) {\n+        if (removeAllDividers) {\n+            removeAllDividers();\n+        }\n+\n+        contentDividerListenerHelper = new ListenerHelper();\n+\n+        for (SplitPane.Divider d : getSkinnable().getDividers()) {\n+            ContentDivider c = new ContentDivider(d);\n+            c.setInitialPos(d.getPosition());\n+            c.setDividerPos(-1);\n+\n+            ChangeListener<Number> li = new PosPropertyListener(c);\n+            contentDividerListenerHelper.addChangeListener(d.positionProperty(), li);\n+\n+            \/\/ TODO\n+            initializeDividerEventHandlers(c);\n+\n+            contentDividers.add(c);\n+            getChildren().add(c);\n+        }\n@@ -638,1 +655,0 @@\n-            c.getDivider().positionProperty().removeListener(c.getPosPropertyListener());\n@@ -641,0 +657,1 @@\n+\n@@ -642,0 +659,5 @@\n+\n+        if(contentDividerListenerHelper != null) {\n+            contentDividerListenerHelper.disconnect();\n+            contentDividerListenerHelper = null;\n+        }\n@@ -981,1 +1003,0 @@\n-        private ChangeListener<Number> listener;\n@@ -1077,8 +1098,0 @@\n-        public ChangeListener<Number> getPosPropertyListener() {\n-            return listener;\n-        }\n-\n-        public void setPosPropertyListener(ChangeListener<Number> listener) {\n-            this.listener = listener;\n-        }\n-\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/SplitPaneSkin.java","additions":51,"deletions":38,"binary":false,"changes":89,"status":"modified"},{"patch":"@@ -178,1 +178,1 @@\n-                SplitPane.class,\n+                \/\/SplitPane.class,\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinMemoryLeakTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}