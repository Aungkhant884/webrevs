{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,12 +28,1 @@\n-import com.sun.javafx.scene.control.skin.Utils;\n-import javafx.beans.property.DoubleProperty;\n-import javafx.css.StyleableBooleanProperty;\n-import javafx.css.StyleableDoubleProperty;\n-import javafx.css.StyleableObjectProperty;\n-import javafx.css.CssMetaData;\n-\n-import javafx.css.converter.BooleanConverter;\n-import javafx.css.converter.EnumConverter;\n-import javafx.css.converter.SizeConverter;\n-import com.sun.javafx.scene.control.behavior.PaginationBehavior;\n-\n+import static com.sun.javafx.scene.control.skin.resources.ControlResources.getString;\n@@ -43,2 +32,7 @@\n-\n-import javafx.animation.*;\n+import com.sun.javafx.scene.control.ListenerHelper;\n+import com.sun.javafx.scene.control.behavior.PaginationBehavior;\n+import com.sun.javafx.scene.control.skin.Utils;\n+import javafx.animation.Interpolator;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.KeyValue;\n+import javafx.animation.Timeline;\n@@ -47,0 +41,1 @@\n+import javafx.beans.property.DoubleProperty;\n@@ -48,1 +43,0 @@\n-import javafx.beans.value.ChangeListener;\n@@ -50,1 +44,1 @@\n-import javafx.collections.ListChangeListener;\n+import javafx.css.CssMetaData;\n@@ -52,0 +46,3 @@\n+import javafx.css.StyleableBooleanProperty;\n+import javafx.css.StyleableDoubleProperty;\n+import javafx.css.StyleableObjectProperty;\n@@ -53,0 +50,3 @@\n+import javafx.css.converter.BooleanConverter;\n+import javafx.css.converter.EnumConverter;\n+import javafx.css.converter.SizeConverter;\n@@ -64,1 +64,9 @@\n-import javafx.scene.control.*;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.Pagination;\n+import javafx.scene.control.SkinBase;\n+import javafx.scene.control.Toggle;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.control.ToggleGroup;\n+import javafx.scene.control.Tooltip;\n@@ -72,2 +80,0 @@\n-import static com.sun.javafx.scene.control.skin.resources.ControlResources.getString;\n-\n@@ -101,1 +107,0 @@\n-    private Pagination pagination;\n@@ -182,1 +187,0 @@\n-\/\/        control.setInputMap(behavior.getInputMap());\n@@ -184,1 +188,0 @@\n-\/\/        setManaged(false);\n@@ -186,3 +189,0 @@\n-        getSkinnable().setClip(clipRect);\n-\n-        this.pagination = control;\n@@ -197,2 +197,0 @@\n-        resetIndexes(true);\n-\n@@ -203,1 +201,15 @@\n-        control.maxPageIndicatorCountProperty().addListener(o -> {\n+        ListenerHelper lh = ListenerHelper.get(this);\n+\n+        lh.addInvalidationListener(control.maxPageIndicatorCountProperty(), (o) -> {\n+            resetIndiciesAndNav();\n+        });\n+\n+        lh.addChangeListener(control.widthProperty(), true, (ev) -> {\n+            clipRect.setWidth(control.getWidth());\n+        });\n+\n+        lh.addChangeListener(control.heightProperty(), true, (ev) -> {\n+            clipRect.setHeight(control.getHeight());\n+        });\n+\n+        lh.addChangeListener(control.pageCountProperty(), (ev) -> {\n@@ -207,4 +219,1 @@\n-        registerChangeListener(control.widthProperty(), e -> clipRect.setWidth(getSkinnable().getWidth()));\n-        registerChangeListener(control.heightProperty(), e -> clipRect.setHeight(getSkinnable().getHeight()));\n-        registerChangeListener(control.pageCountProperty(), e -> resetIndiciesAndNav());\n-        registerChangeListener(control.pageFactoryProperty(), e -> {\n+        lh.addChangeListener(control.pageFactoryProperty(), (ev) -> {\n@@ -226,0 +235,6 @@\n+    @Override\n+    public void install() {\n+        getSkinnable().setClip(clipRect);\n+        resetIndexes(true);\n+    }\n+\n@@ -385,2 +400,8 @@\n-    @Override public void dispose() {\n-        super.dispose();\n+    @Override\n+    public void dispose() {\n+        if (getSkinnable() == null) {\n+            return;\n+        }\n+\n+        getSkinnable().setClip(null);\n+        getChildren().removeAll(currentStackPane, nextStackPane, navigation);\n@@ -391,0 +412,2 @@\n+\n+        super.dispose();\n@@ -452,1 +475,1 @@\n-            pagination.setCurrentPageIndex(getCurrentPageIndex() + 1);\n+            getSkinnable().setCurrentPageIndex(getCurrentPageIndex() + 1);\n@@ -458,1 +481,1 @@\n-            pagination.setCurrentPageIndex(getCurrentPageIndex() - 1);\n+            getSkinnable().setCurrentPageIndex(getCurrentPageIndex() - 1);\n@@ -470,0 +493,1 @@\n+        ListenerHelper lh = ListenerHelper.get(this);\n@@ -471,1 +495,1 @@\n-        getSkinnable().addEventHandler(TouchEvent.TOUCH_PRESSED, e -> {\n+        lh.addEventHandler(control, TouchEvent.TOUCH_PRESSED, e -> {\n@@ -484,1 +508,1 @@\n-        getSkinnable().addEventHandler(TouchEvent.TOUCH_MOVED, e -> {\n+        lh.addEventHandler(control, TouchEvent.TOUCH_MOVED, e -> {\n@@ -562,1 +586,1 @@\n-        getSkinnable().addEventHandler(TouchEvent.TOUCH_RELEASED, e -> {\n+        lh.addEventHandler(control, TouchEvent.TOUCH_RELEASED, e -> {\n@@ -628,1 +652,1 @@\n-        pagination.setCurrentPageIndex(currentIndex);\n+        getSkinnable().setCurrentPageIndex(currentIndex);\n@@ -637,2 +661,2 @@\n-        if (pagination.getPageFactory() != null && pane.getChildren().isEmpty()) {\n-            Node content = pagination.getPageFactory().call(index);\n+        if (getSkinnable().getPageFactory() != null && pane.getChildren().isEmpty()) {\n+            Node content = getSkinnable().getPageFactory().call(index);\n@@ -651,2 +675,2 @@\n-                if (pagination.getPageFactory().call(previousIndex) != null) {\n-                    pagination.setCurrentPageIndex(previousIndex);\n+                if (getSkinnable().getPageFactory().call(previousIndex) != null) {\n+                    getSkinnable().setCurrentPageIndex(previousIndex);\n@@ -656,1 +680,1 @@\n-                    pagination.setCurrentPageIndex(0);\n+                    getSkinnable().setCurrentPageIndex(0);\n@@ -896,3 +920,3 @@\n-            pagination.currentPageIndexProperty().addListener((arg0, arg1, arg2) -> {\n-                previousIndex = arg1.intValue();\n-                currentIndex = arg2.intValue();\n+            ListenerHelper.get(PaginationSkin.this).addChangeListener(getSkinnable().currentPageIndexProperty(), (src, old, cur) -> {\n+                previousIndex = old.intValue();\n+                currentIndex = cur.intValue();\n@@ -926,6 +950,0 @@\n-            for (Toggle toggle : indicatorButtons.getToggles()) {\n-                if (toggle instanceof IndicatorButton) {\n-                    IndicatorButton indicatorButton = (IndicatorButton) toggle;\n-                    indicatorButton.release();\n-                }\n-            }\n@@ -1271,6 +1289,0 @@\n-        private final ListChangeListener<String> updateSkinIndicatorType =\n-                                                    c -> setIndicatorType();\n-\n-        private final ChangeListener<Boolean> updateTooltipVisibility =\n-                       (ob, oldValue, newValue) -> setTooltipVisible(newValue);\n-\n@@ -1282,2 +1294,0 @@\n-            setIndicatorType();\n-            setTooltipVisible(isTooltipVisible());\n@@ -1285,1 +1295,6 @@\n-            getSkinnable().getStyleClass().addListener(updateSkinIndicatorType);\n+            ListenerHelper lh = ListenerHelper.get(PaginationSkin.this);\n+\n+            lh.addListChangeListener(getSkinnable().getStyleClass(), (ch) -> {\n+                setIndicatorType();\n+            });\n+            setIndicatorType();\n@@ -1292,1 +1307,1 @@\n-                        pagination.setCurrentPageIndex(IndicatorButton.this.pageNumber);\n+                        getSkinnable().setCurrentPageIndex(IndicatorButton.this.pageNumber);\n@@ -1297,1 +1312,3 @@\n-            tooltipVisibleProperty().addListener(updateTooltipVisibility);\n+            lh.addChangeListener(tooltipVisibleProperty(), true, (visible) -> {\n+                setTooltipVisible(visible);\n+            });\n@@ -1340,5 +1357,0 @@\n-        public void release() {\n-            getSkinnable().getStyleClass().removeListener(updateSkinIndicatorType);\n-            tooltipVisibleProperty().removeListener(updateTooltipVisibility);\n-        }\n-\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/PaginationSkin.java","additions":83,"deletions":71,"binary":false,"changes":154,"status":"modified"},{"patch":"@@ -171,1 +171,1 @@\n-                Pagination.class,\n+                \/\/Pagination.class,\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinMemoryLeakTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}