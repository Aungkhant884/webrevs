{"files":[{"patch":"@@ -43,0 +43,1 @@\n+import com.sun.glass.ui.Screen;\n@@ -46,0 +47,1 @@\n+import com.sun.javafx.tk.quantum.WindowStage;\n@@ -882,4 +884,3 @@\n-    float[] getPlatformScales() {\n-        float[] scales = new float[] { 1.0f, 1.0f };\n-        Scene scene = (Scene)getAttribute(SCENE);\n-        if (scene == null || scene.getWindow() == null) return scales;\n+    private Screen getScreen() {\n+        Scene scene = (Scene) getAttribute(SCENE);\n+        if (scene == null || scene.getWindow() == null) return null;\n@@ -887,1 +888,5 @@\n-        if (tkStage == null) return scales;\n+        if (!(tkStage instanceof WindowStage)) return null;\n+        WindowStage windowStage = (WindowStage) tkStage;\n+        if (windowStage.getPlatformWindow() == null) return null;\n+        return windowStage.getPlatformWindow().getScreen();\n+    }\n@@ -889,3 +894,9 @@\n-        scales[0] = tkStage.getPlatformScaleX();\n-        scales[1] = tkStage.getPlatformScaleY();\n-        return scales;\n+    float[] getPlatformBounds(float x, float y, float w, float h) {\n+        float[] platformBounds = new float[] { x, y, w, h };\n+        Screen screen = getScreen();\n+        if (screen == null) return platformBounds;\n+        platformBounds[0] = screen.toPlatformX(x);\n+        platformBounds[1] = screen.toPlatformY(y);\n+        platformBounds[2] = (float) Math.ceil(w * screen.getPlatformScaleX());\n+        platformBounds[3] = (float) Math.ceil(h * screen.getPlatformScaleY());\n+        return platformBounds;\n@@ -904,10 +915,4 @@\n-            float[] scales = getPlatformScales();\n-            float scaleX = scales[0];\n-            float scaleY = scales[1];\n-\n-            float minX = (float) bounds.getMinX() * scaleX;\n-            float minY = (float) bounds.getMinY() * scaleY;\n-            float width = (float) bounds.getWidth() * scaleX;\n-            float height = (float) bounds.getHeight() * scaleY;\n-\n-            return new float[] { minX, minY, width, height };\n+            return getPlatformBounds((float) bounds.getMinX(),\n+                                     (float) bounds.getMinY(),\n+                                     (float) bounds.getWidth(),\n+                                     (float) bounds.getHeight());\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/win\/WinAccessible.java","additions":23,"deletions":18,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -325,4 +325,0 @@\n-            float[] scales = accessible.getPlatformScales();\n-            float scaleX = scales[0];\n-            float scaleY = scales[1];\n-\n@@ -333,4 +329,10 @@\n-                result[index++] = b.getMinX() * scaleX;\n-                result[index++] = b.getMinY() * scaleY;\n-                result[index++] = b.getWidth() * scaleX;\n-                result[index++] = b.getHeight() * scaleY;\n+                float[] platformBounds = accessible.getPlatformBounds(\n+                        (float) b.getMinX(),\n+                        (float) b.getMinY(),\n+                        (float) b.getWidth(),\n+                        (float) b.getHeight());\n+\n+                result[index++] = platformBounds[0];\n+                result[index++] = platformBounds[1];\n+                result[index++] = platformBounds[2];\n+                result[index++] = platformBounds[3];\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/win\/WinTextRangeProvider.java","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -58,1 +58,1 @@\n-class WindowStage extends GlassStage {\n+public class WindowStage extends GlassStage {\n@@ -226,1 +226,1 @@\n-    final Window getPlatformWindow() {\n+    public final Window getPlatformWindow() {\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/tk\/quantum\/WindowStage.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}