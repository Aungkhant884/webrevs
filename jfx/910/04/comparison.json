{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -268,2 +268,2 @@\n-            Double leftAnchor = getLeftAnchor(child);\n-            Double rightAnchor = getRightAnchor(child);\n+            Double leftAnchor = getSnappedLeftAnchor(child);\n+            Double rightAnchor = getSnappedRightAnchor(child);\n@@ -277,1 +277,1 @@\n-                childHeight = computeChildHeight(child, getTopAnchor(child), getBottomAnchor(child), contentHeight, -1);\n+                childHeight = computeChildHeight(child, getSnappedTopAnchor(child), getSnappedBottomAnchor(child), contentHeight, -1);\n@@ -283,2 +283,33 @@\n-        final Insets insets = getInsets();\n-        return insets.getLeft() + max + insets.getRight();\n+        return snappedLeftInset() + max + snappedRightInset();\n+    }\n+\n+    private Double getSnappedTopAnchor(Node child) {\n+        Double topAnchor = getTopAnchor(child);\n+        if (topAnchor == null) {\n+            return null;\n+        }\n+        return snapPositionY(topAnchor);\n+    }\n+\n+    private Double getSnappedBottomAnchor(Node child) {\n+        Double bottomAnchor = getBottomAnchor(child);\n+        if (bottomAnchor == null) {\n+            return null;\n+        }\n+        return snapPositionY(bottomAnchor);\n+    }\n+\n+    private Double getSnappedLeftAnchor(Node child) {\n+        Double leftAnchor = getLeftAnchor(child);\n+        if (leftAnchor == null) {\n+            return null;\n+        }\n+        return snapPositionX(leftAnchor);\n+    }\n+\n+    private Double getSnappedRightAnchor(Node child) {\n+        Double rightAnchor = getRightAnchor(child);\n+        if (rightAnchor == null) {\n+            return null;\n+        }\n+        return snapPositionX(rightAnchor);\n@@ -292,2 +323,2 @@\n-            Double topAnchor = getTopAnchor(child);\n-            Double bottomAnchor = getBottomAnchor(child);\n+            Double topAnchor = getSnappedTopAnchor(child);\n+            Double bottomAnchor = getSnappedBottomAnchor(child);\n@@ -300,1 +331,1 @@\n-                childWidth = computeChildWidth(child, getLeftAnchor(child), getRightAnchor(child), contentWidth, -1);\n+                childWidth = computeChildWidth(child, getSnappedLeftAnchor(child), getSnappedRightAnchor(child), contentWidth, -1);\n@@ -306,2 +337,1 @@\n-        final Insets insets = getInsets();\n-        return insets.getTop() + max + insets.getBottom();\n+        return snappedTopInset() + max + snappedBottomInset();\n@@ -312,2 +342,1 @@\n-            final Insets insets = getInsets();\n-            return areaWidth - insets.getLeft() - insets.getRight() - leftAnchor - rightAnchor;\n+            return areaWidth - snappedLeftInset() - snappedRightInset() - leftAnchor - rightAnchor;\n@@ -320,2 +349,1 @@\n-            final Insets insets = getInsets();\n-            return areaHeight - insets.getTop() - insets.getBottom() - topAnchor - bottomAnchor;\n+            return areaHeight - snappedTopInset() - snappedBottomInset() - topAnchor - bottomAnchor;\n@@ -327,1 +355,0 @@\n-        final Insets insets = getInsets();\n@@ -330,4 +357,4 @@\n-            final Double topAnchor = getTopAnchor(child);\n-            final Double bottomAnchor = getBottomAnchor(child);\n-            final Double leftAnchor = getLeftAnchor(child);\n-            final Double rightAnchor = getRightAnchor(child);\n+            final Double topAnchor = getSnappedTopAnchor(child);\n+            final Double bottomAnchor = getSnappedBottomAnchor(child);\n+            final Double leftAnchor = getSnappedLeftAnchor(child);\n+            final Double rightAnchor = getSnappedRightAnchor(child);\n@@ -358,1 +385,1 @@\n-                x = insets.getLeft() + leftAnchor;\n+                x = snappedLeftInset() + leftAnchor;\n@@ -360,1 +387,1 @@\n-                x = getWidth() - insets.getRight() - rightAnchor - w;\n+                x = getWidth() - snappedRightInset() - rightAnchor - w;\n@@ -364,1 +391,1 @@\n-                y = insets.getTop() + topAnchor;\n+                y = snappedTopInset() + topAnchor;\n@@ -366,1 +393,1 @@\n-                y = getHeight() - insets.getBottom() - bottomAnchor - h;\n+                y = getHeight() - snappedBottomInset() - bottomAnchor - h;\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/layout\/AnchorPane.java","additions":51,"deletions":24,"binary":false,"changes":75,"status":"modified"},{"patch":"@@ -28,1 +28,9 @@\n-import static org.junit.Assert.assertEquals;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.geometry.Bounds;\n+import javafx.scene.Scene;\n+import javafx.scene.layout.StackPane;\n+import javafx.stage.Stage;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.ValueSource;\n@@ -35,2 +43,1 @@\n-import org.junit.Test;\n-\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n@@ -40,1 +47,2 @@\n-    @Test public void testNoAnchorsSet() {\n+    @Test\n+    public void testNoAnchorsSet() {\n@@ -720,0 +728,111 @@\n+\n+    \/**\n+     * Tests the {@link Insets} snapping of the {@link AnchorPane} with different scales.\n+     *\n+     * @param scale the scale which is used as render scale on the {@link Stage}\n+     * @see <a href=\"https:\/\/bugs.openjdk.org\/browse\/JDK-8295078\">JDK-8295078<\/a>\n+     *\/\n+    @ValueSource(doubles = { 1.0, 1.25, 1.5, 1.75, 2.0 })\n+    @ParameterizedTest\n+    void testAnchorPaneInsetsSnappingWithDifferentScales(double scale) {\n+        double padding = 9.6;\n+\n+        StackPane child = new StackPane();\n+        AnchorPane anchorPane = new AnchorPane(child);\n+        anchorPane.setStyle(\"-fx-padding: \" + padding + \"px;\");\n+\n+        AnchorPane.setTopAnchor(child, 0d);\n+        AnchorPane.setLeftAnchor(child, 0d);\n+        AnchorPane.setBottomAnchor(child, 0d);\n+        AnchorPane.setRightAnchor(child, 0d);\n+\n+        DoubleProperty renderScaleProperty = new SimpleDoubleProperty(scale);\n+\n+        Stage stage = new Stage();\n+        stage.renderScaleXProperty().bind(renderScaleProperty);\n+        stage.renderScaleYProperty().bind(renderScaleProperty);\n+\n+        int widthHeight = 500;\n+        Scene scene = new Scene(anchorPane, widthHeight, widthHeight);\n+        stage.setScene(scene);\n+        stage.show();\n+\n+        Bounds boundsInParent = child.getBoundsInParent();\n+\n+        double snappedPaddingX = child.snapPositionX(padding);\n+        double snappedPaddingY = child.snapPositionY(padding);\n+\n+        assertEquals(snappedPaddingX, boundsInParent.getMinX(), 0.0001);\n+        assertEquals(snappedPaddingY, boundsInParent.getMinY(), 0.0001);\n+\n+        double expectedMaxX = widthHeight - snappedPaddingX;\n+        assertEquals(expectedMaxX, boundsInParent.getMaxX(), 0.0001);\n+\n+        double expectedMaxY = widthHeight - snappedPaddingY;\n+        assertEquals(expectedMaxY, boundsInParent.getMaxY(), 0.0001);\n+\n+        double expectedWidth = widthHeight - snappedPaddingX * 2;\n+        assertEquals(expectedWidth, boundsInParent.getWidth(), 0.0001);\n+\n+        double expectedHeight = widthHeight - snappedPaddingY * 2;\n+        assertEquals(expectedHeight, boundsInParent.getHeight(), 0.0001);\n+    }\n+\n+    \/**\n+     * Tests the anchor snapping of the {@link AnchorPane} with different scales.\n+     *\n+     * @param scale the scale which is used as render scale on the {@link Stage}\n+     * @see <a href=\"https:\/\/bugs.openjdk.org\/browse\/JDK-8295078\">JDK-8295078<\/a>\n+     *\/\n+    @ValueSource(doubles = { 1.0, 1.25, 1.5, 1.75, 2.0 })\n+    @ParameterizedTest\n+    void testAnchorPaneAnchorSnappingWithDifferentScales(double scale) {\n+        StackPane child = new StackPane();\n+        AnchorPane anchorPane = new AnchorPane(child);\n+\n+        double topAnchor = 4d;\n+        double leftAnchor = 5d;\n+        double bottomAnchor = 6d;\n+        double rightAnchor = 7d;\n+\n+        AnchorPane.setTopAnchor(child, topAnchor);\n+        AnchorPane.setLeftAnchor(child, leftAnchor);\n+        AnchorPane.setBottomAnchor(child, bottomAnchor);\n+        AnchorPane.setRightAnchor(child, rightAnchor);\n+\n+        DoubleProperty renderScaleProperty = new SimpleDoubleProperty(scale);\n+\n+        Stage stage = new Stage();\n+        stage.renderScaleXProperty().bind(renderScaleProperty);\n+        stage.renderScaleYProperty().bind(renderScaleProperty);\n+\n+        int widthHeight = 500;\n+        Scene scene = new Scene(anchorPane, widthHeight, widthHeight);\n+        stage.setScene(scene);\n+        stage.show();\n+\n+        Bounds boundsInParent = child.getBoundsInParent();\n+\n+        double snappedLeftAnchor = child.snapPositionY(leftAnchor);\n+        double snappedRightAnchor = child.snapPositionY(rightAnchor);\n+        double horizontalAnchor = snappedLeftAnchor + snappedRightAnchor;\n+\n+        double snappedTopAnchor = child.snapPositionX(topAnchor);\n+        double snappedBottomAnchor = child.snapPositionX(bottomAnchor);\n+        double verticalAnchor = snappedTopAnchor + snappedBottomAnchor;\n+\n+        assertEquals(snappedLeftAnchor, boundsInParent.getMinX(), 0.0001);\n+        assertEquals(snappedTopAnchor, boundsInParent.getMinY(), 0.0001);\n+\n+        double expectedMaxX = widthHeight - snappedRightAnchor;\n+        assertEquals(expectedMaxX, boundsInParent.getMaxX(), 0.0001);\n+\n+        double expectedMaxY = widthHeight - snappedBottomAnchor;\n+        assertEquals(expectedMaxY, boundsInParent.getMaxY(), 0.0001);\n+\n+        double expectedWidth = widthHeight - horizontalAnchor;\n+        assertEquals(expectedWidth, boundsInParent.getWidth(), 0.0001);\n+\n+        double expectedHeight = widthHeight - verticalAnchor;\n+        assertEquals(expectedHeight, boundsInParent.getHeight(), 0.0001);\n+    }\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/layout\/AnchorPaneTest.java","additions":123,"deletions":4,"binary":false,"changes":127,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import javafx.scene.layout.AnchorPane;\n@@ -155,1 +156,2 @@\n-                })\n+                }),\n+                new ContainerCreator<>(AnchorPane::new)\n@@ -164,1 +166,0 @@\n-\/\/                new ContainerCreator<>(AnchorPane::new), \/\/ fixed by JDK-8295078\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/layout\/SnappingTest.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}