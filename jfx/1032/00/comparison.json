{"files":[{"patch":"@@ -28,2 +28,0 @@\n-import java.util.Locale;\n-\n@@ -31,0 +29,3 @@\n+\n+import java.util.regex.Pattern;\n+\n@@ -39,0 +40,4 @@\n+    private static final String HEX_DIGIT = \"[A-Fa-f0-9]\";\n+    private static final Pattern PATTERN = Pattern.compile(\"#?\" + HEX_DIGIT + \"{6}\");\n+    private static final Pattern PARTIAL_PATTERN = Pattern.compile(\"#?\" + HEX_DIGIT + \"{0,6}\");\n+\n@@ -40,1 +45,0 @@\n-    private boolean noChangeInValue = false;\n@@ -83,1 +87,0 @@\n-    \/\/  \"^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$\";\n@@ -86,5 +89,1 @@\n-        if (text.length() == 0) return true;\n-        if (text.matches(\"#[a-fA-F0-9]{0,6}\") || text.matches(\"[a-fA-F0-9]{0,6}\")) {\n-            return true;\n-        }\n-        return false;\n+        return PARTIAL_PATTERN.matcher(text).matches();\n@@ -102,1 +101,0 @@\n-        if (noChangeInValue) return;\n@@ -104,12 +102,10 @@\n-        String text = getTextField().getText() == null ? \"\" : getTextField().getText().trim().toUpperCase(Locale.ROOT);\n-        if (text.matches(\"#[A-F0-9]{6}\") || text.matches(\"[A-F0-9]{6}\")) {\n-            try {\n-                Color newValue = (text.charAt(0) == '#')? Color.web(text) : Color.web(\"#\"+text);\n-                if (!newValue.equals(value)) {\n-                    ((WebColorField) control).setValue(newValue);\n-                } else {\n-                    \/\/ calling setText results in updateValue - so we set this flag to true\n-                    \/\/ so that when this is true updateValue simply returns.\n-                    noChangeInValue = true;\n-                    getTextField().setText(Utils.formatHexString(newValue));\n-                    noChangeInValue = false;\n+        String text = getTextField().getText() == null ? \"\" : getTextField().getText().trim();\n+        if (PATTERN.matcher(text).matches()) {\n+            Color newValue = (text.charAt(0) == '#') ? Color.web(text) : Color.web(\"#\" + text);\n+            if (!newValue.equals(value)) {\n+                ((WebColorField) control).setValue(newValue);\n+            } else {\n+                String newText = Utils.formatHexString(newValue);\n+\n+                if (!newText.equals(text)) {\n+                    getTextField().setText(newText);\n@@ -117,2 +113,0 @@\n-            } catch (java.lang.IllegalArgumentException ex) {\n-                System.out.println(\"Failed to parse [\"+text+\"]\");\n","filename":"modules\/javafx.controls\/src\/main\/java\/com\/sun\/javafx\/scene\/control\/skin\/WebColorFieldSkin.java","additions":18,"deletions":24,"binary":false,"changes":42,"status":"modified"}]}