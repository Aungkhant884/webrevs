{"files":[{"patch":"@@ -147,3 +147,1 @@\n-        if (getSkinnable().getScene() != null) {\n-            ControlAcceleratorSupport.addAcceleratorsIntoScene(getSkinnable().getItems(), getSkinnable());\n-        }\n+        ControlAcceleratorSupport.addAcceleratorsIntoScene(getSkinnable().getItems(), getSkinnable());\n@@ -154,2 +152,0 @@\n-                ControlAcceleratorSupport.removeAcceleratorsFromScene(getSkinnable().getItems(), oldValue);\n-\n@@ -160,5 +156,0 @@\n-\n-            \/\/ FIXME: null skinnable should not happen\n-            if (getSkinnable() != null && getSkinnable().getScene() != null) {\n-                ControlAcceleratorSupport.addAcceleratorsIntoScene(getSkinnable().getItems(), getSkinnable());\n-            }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/MenuButtonSkinBase.java","additions":1,"deletions":10,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import javafx.beans.value.ChangeListener;\n@@ -30,0 +31,1 @@\n+import javafx.scene.control.MenuButton;\n@@ -34,0 +36,1 @@\n+import test.com.sun.javafx.binding.ExpressionHelperUtility;\n@@ -41,0 +44,1 @@\n+import static org.junit.Assert.assertNotEquals;\n@@ -118,0 +122,41 @@\n+\n+    @Test\n+    public void testMemoryButtonSkinDoesntAddAdditionalListeners() {\n+        \/\/ JDK-8296409\n+        MenuItem menuItem = new MenuItem(\"Menu Item\");\n+        MenuButton menuButton = new MenuButton(\"Menu Button\", null, menuItem);\n+        StackPane root = new StackPane(menuButton);\n+        StageLoader sl = new StageLoader(root);\n+        assertEquals(1, getListenerCount(menuItem.acceleratorProperty()));\n+        root.getChildren().remove(menuButton);\n+        assertEquals(0, getListenerCount(menuItem.acceleratorProperty()));\n+        root.getChildren().add(menuButton);\n+        assertEquals(1, getListenerCount(menuItem.acceleratorProperty()));\n+        sl.dispose();\n+    }\n+\n+    @Test\n+    public void testMemoryButtonSkinDoesntAddAdditionalListenersOnSceneChange() {\n+        \/\/ JDK-8296409\n+        MenuItem menuItem = new MenuItem(\"Menu Item\");\n+        MenuButton menuButton = new MenuButton(\"Menu Button\", null, menuItem);\n+        StackPane root = new StackPane(menuButton);\n+        StackPane root2 = new StackPane();\n+        StageLoader sl1 = new StageLoader(root);\n+        StageLoader sl2 = new StageLoader(root2);\n+        assertEquals(1, getListenerCount(menuItem.acceleratorProperty()));\n+        ChangeListener originalChangeListener =\n+                ExpressionHelperUtility.getChangeListeners(menuItem.acceleratorProperty()).get(0);\n+        root2.getChildren().add(menuButton);\n+        assertEquals(1, getListenerCount(menuItem.acceleratorProperty()));\n+        ChangeListener secondChangeListener =\n+                ExpressionHelperUtility.getChangeListeners(menuItem.acceleratorProperty()).get(0);\n+        assertNotEquals(originalChangeListener, secondChangeListener);\n+        root.getChildren().add(menuButton);\n+        assertEquals(1, getListenerCount(menuItem.acceleratorProperty()));\n+        ChangeListener thirdChangeListener =\n+                ExpressionHelperUtility.getChangeListeners(menuItem.acceleratorProperty()).get(0);\n+        assertNotEquals(secondChangeListener,thirdChangeListener);\n+        sl1.dispose();\n+        sl2.dispose();\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ControlAcceleratorSupportTest.java","additions":45,"deletions":0,"binary":false,"changes":45,"status":"modified"}]}