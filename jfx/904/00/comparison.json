{"files":[{"patch":"@@ -27,13 +27,2 @@\n-import com.sun.javafx.scene.ParentHelper;\n-import com.sun.javafx.scene.control.behavior.BehaviorBase;\n-import com.sun.javafx.scene.traversal.Algorithm;\n-import com.sun.javafx.scene.control.FakeFocusTextField;\n-import com.sun.javafx.scene.traversal.Direction;\n-import com.sun.javafx.scene.traversal.ParentTraversalEngine;\n-import javafx.scene.control.Accordion;\n-import javafx.scene.control.Button;\n-import javafx.scene.control.Control;\n-import javafx.scene.control.SkinBase;\n-import com.sun.javafx.scene.control.behavior.SpinnerBehavior;\n-import com.sun.javafx.scene.traversal.TraversalContext;\n-import javafx.collections.ListChangeListener;\n+import java.util.List;\n+\n@@ -46,0 +35,2 @@\n+import javafx.scene.control.Control;\n+import javafx.scene.control.SkinBase;\n@@ -53,1 +44,8 @@\n-import java.util.List;\n+import com.sun.javafx.scene.ParentHelper;\n+import com.sun.javafx.scene.control.FakeFocusTextField;\n+import com.sun.javafx.scene.control.ListenerHelper;\n+import com.sun.javafx.scene.control.behavior.SpinnerBehavior;\n+import com.sun.javafx.scene.traversal.Algorithm;\n+import com.sun.javafx.scene.traversal.Direction;\n+import com.sun.javafx.scene.traversal.ParentTraversalEngine;\n+import com.sun.javafx.scene.traversal.TraversalContext;\n@@ -86,1 +84,0 @@\n-\n@@ -90,1 +87,0 @@\n-\n@@ -109,1 +105,0 @@\n-\/\/        control.setInputMap(behavior.getInputMap());\n@@ -112,1 +107,2 @@\n-        getChildren().add(textField);\n+\n+        ListenerHelper lh = ListenerHelper.get(this);\n@@ -115,1 +111,3 @@\n-        control.getStyleClass().addListener((ListChangeListener<String>) c -> updateStyleClass());\n+        lh.addListChangeListener(control.getStyleClass(), (ch) -> {\n+            updateStyleClass();\n+        });\n@@ -173,1 +171,1 @@\n-        control.focusedProperty().addListener((ov, t, hasFocus) -> {\n+        lh.addChangeListener(control.focusedProperty(), (op) -> {\n@@ -175,1 +173,1 @@\n-            ((FakeFocusTextField)textField).setFakeFocus(hasFocus);\n+            ((FakeFocusTextField)textField).setFakeFocus(control.isFocused());\n@@ -178,1 +176,1 @@\n-        control.addEventFilter(KeyEvent.ANY, ke -> {\n+        lh.addEventFilter(control, KeyEvent.ANY, (ke) -> {\n@@ -208,1 +206,1 @@\n-        textField.addEventFilter(KeyEvent.ANY, ke -> {\n+        lh.addEventFilter(textField, KeyEvent.ANY, (ke) -> {\n@@ -215,1 +213,2 @@\n-        textField.focusedProperty().addListener((ov, t, hasFocus) -> {\n+        lh.addChangeListener(textField.focusedProperty(), (op) -> {\n+            boolean hasFocus = textField.isFocused();\n@@ -233,1 +232,0 @@\n-\n@@ -265,0 +263,5 @@\n+    @Override\n+    public void install() {\n+        getChildren().add(textField);\n+    }\n+\n@@ -266,2 +269,7 @@\n-    @Override public void dispose() {\n-        super.dispose();\n+    @Override\n+    public void dispose() {\n+        if(getSkinnable() == null) {\n+            return;\n+        }\n+\n+        getChildren().removeAll(textField, incrementArrowButton, decrementArrowButton);\n@@ -272,0 +280,2 @@\n+\n+        super.dispose();\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/SpinnerSkin.java","additions":37,"deletions":27,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -176,1 +176,1 @@\n-                Spinner.class,\n+                \/\/ Spinner.class,\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinMemoryLeakTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -144,0 +144,8 @@\n+\n+    \/** Tests JDK-8245145: IAE when replacing skins *\/\n+    @Test\n+    public void testSpinnerSkin() {\n+        Spinner<?> spinner = new Spinner<>();\n+        spinner.setSkin(new SpinnerSkin<>(spinner));\n+        spinner.setSkin(new SpinnerSkin<>(spinner));\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SpinnerSkinTest.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"}]}