{"files":[{"patch":"@@ -56,0 +56,1 @@\n+import javafx.scene.control.SkinBase;\n@@ -648,3 +649,3 @@\n-\n-        TableRow<T> tableRow = new TableRow<>();\n-        tableRow.updateTableView(tv);\n+        Callback<TableView<T>, TableRow<T>> rowFactory = tv.getRowFactory();\n+        TableRow<T> tableRow = createMeasureRow(tv, tableSkin, rowFactory);\n+        ((SkinBase<?>) tableRow.getSkin()).getChildren().add(cell);\n@@ -663,2 +664,1 @@\n-                tableSkin.getChildren().add(cell);\n-                cell.applyCss();\n+                tableRow.applyCss();\n@@ -704,0 +704,15 @@\n+    private <T> TableRow<T> createMeasureRow(TableView<T> tv, TableViewSkinBase tableSkin,\n+            Callback<TableView<T>, TableRow<T>> rowFactory) {\n+        TableRow<T> tableRow = rowFactory != null ? rowFactory.call(tv) : new TableRow<>();\n+        tableSkin.getChildren().add(tableRow);\n+        tableRow.applyCss();\n+        if (!(tableRow.getSkin() instanceof SkinBase<?>)) {\n+            tableSkin.getChildren().remove(tableRow);\n+            \/\/ recreate with null rowFactory will result in a standard TableRow that will\n+            \/\/ have a SkinBase-derived skin\n+            tableRow = createMeasureRow(tv, tableSkin, null);\n+        }\n+        assert tableRow.getSkin() instanceof SkinBase<?>;\n+        return tableRow;\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TableColumnHeader.java","additions":20,"deletions":5,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -32,0 +32,3 @@\n+import javafx.scene.Node;\n+import javafx.scene.control.Skin;\n+import javafx.scene.control.Skinnable;\n@@ -33,0 +36,1 @@\n+import javafx.scene.control.TableRow;\n@@ -38,0 +42,2 @@\n+import javafx.scene.layout.HBox;\n+\n@@ -255,0 +261,72 @@\n+\n+    \/** Row style must affect the required column width *\/\n+    @Test\n+    public void test_resizeColumnToFitContentRowStyle() {\n+        TableColumn column = tableView.getColumns().get(0);\n+\n+        tableView.setRowFactory(this::createSmallRow);\n+        TableColumnHeaderShim.resizeColumnToFitContent(firstColumnHeader, -1);\n+        double width = column.getWidth();\n+\n+        tableView.setRowFactory(this::createLargeRow);\n+        TableColumnHeaderShim.resizeColumnToFitContent(firstColumnHeader, -1);\n+        assertTrue(\"Column width must be greater\", width < column.getWidth());\n+    }\n+\n+    \/** Test resizeColumnToFitContent in the presence of a non-standard row skin *\/\n+    @Test\n+    public void test_resizeColumnToFitContentCustomRowSkin() {\n+        TableColumn column = tableView.getColumns().get(0);\n+\n+        tableView.setRowFactory(this::createCustomRow);\n+        TableColumnHeaderShim.resizeColumnToFitContent(firstColumnHeader, -1);\n+        double width = column.getWidth();\n+        assertTrue(width > 0);\n+    }\n+\n+    private TableRow<Person> createCustomRow(TableView<Person> tableView) {\n+        TableRow<Person> row = new TableRow<>() {\n+            protected Skin<?> createDefaultSkin() {\n+                return new CustomSkin(this);\n+            };\n+        };\n+        return row;\n+    }\n+\n+    private static class CustomSkin implements Skin<TableRow<?>> {\n+\n+        private TableRow<?> row;\n+        private Node node = new HBox();\n+\n+        CustomSkin(TableRow<?> row) {\n+            this.row = row;\n+        }\n+\n+        @Override\n+        public TableRow<?> getSkinnable() {\n+            return row;\n+        }\n+\n+        @Override\n+        public Node getNode() {\n+            return node;\n+        }\n+\n+        @Override\n+        public void dispose() {\n+            node = null;\n+        }\n+    }\n+\n+    private TableRow<Person> createSmallRow(TableView<Person> tableView) {\n+        TableRow<Person> row = new TableRow<>();\n+        row.setStyle(\"-fx-font: 24 Amble\");\n+        return row;\n+    }\n+\n+    private TableRow<Person> createLargeRow(TableView<Person> param) {\n+        TableRow<Person> row = new TableRow<>();\n+        row.setStyle(\"-fx-font: 48 Amble\");\n+        return row;\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/TableColumnHeaderTest.java","additions":78,"deletions":0,"binary":false,"changes":78,"status":"modified"}]}