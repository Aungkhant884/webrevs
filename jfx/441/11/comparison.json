{"files":[{"patch":"@@ -341,0 +341,1 @@\n+        updateEditing();\n@@ -533,1 +534,1 @@\n-\n+        \n@@ -543,13 +544,10 @@\n-        \/\/ Check that the list is specified, and my index is not -1\n-        if (index != -1 && list != null) {\n-            \/\/ If my index is the index being edited and I'm not currently in\n-            \/\/ the edit mode, then I need to enter the edit mode\n-            if (index == editIndex && !editing) {\n-                startEdit();\n-            } else if (index != editIndex && editing) {\n-                \/\/ If my index is not the one being edited then I need to cancel\n-                \/\/ the edit. The tricky thing here is that as part of this call\n-                \/\/ I cannot end up calling list.edit(-1) the way that the standard\n-                \/\/ cancelEdit method would do. Yet, I need to call cancelEdit\n-                \/\/ so that subclasses which override cancelEdit can execute. So,\n-                \/\/ I have to use a kind of hacky flag workaround.\n+\n+        if (editing && (index == -1 || list == null || index != editIndex)) {\n+            \/\/ If my index is not the one being edited then I need to cancel\n+            \/\/ the edit. The tricky thing here is that as part of this call\n+            \/\/ I cannot end up calling list.edit(-1) the way that the standard\n+            \/\/ cancelEdit method would do. Yet, I need to call cancelEdit\n+            \/\/ so that subclasses which override cancelEdit can execute. So,\n+            \/\/ I have to use a kind of hacky flag workaround.\n+            try {\n+                \/\/ try-finally to make certain that the flag is reliably reset to true\n@@ -558,0 +556,1 @@\n+            } finally {\n@@ -561,0 +560,5 @@\n+        if(!editing && list != null && index != -1 && index == editIndex) {\n+            \/\/ If my index is the index being edited and I'm not currently in\n+            \/\/ the edit mode, then I need to enter the edit mode\n+            startEdit();\n+        }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ListCell.java","additions":18,"deletions":14,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import javafx.scene.control.ListView.EditEvent;\n@@ -41,0 +42,2 @@\n+import java.util.List;\n+import java.util.ArrayList;\n@@ -836,0 +839,76 @@\n+    @Test\n+    public void testChangeIndexToEditing1_jdk_8264127() {\n+        assertChangeIndexToEditing(0, 1);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing2_jdk_8264127() {\n+        assertChangeIndexToEditing(-1, 1);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing3_jdk_8264127() {\n+        assertChangeIndexToEditing(1, 0);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing4_jdk_8264127() {\n+        assertChangeIndexToEditing(-1, 0);\n+    }\n+\n+\n+\n+    private void assertChangeIndexToEditing(int initialCellIndex, int listEditingIndex) {\n+        list.getFocusModel().focus(-1);\n+        List<EditEvent> events = new ArrayList<EditEvent>();\n+        list.setOnEditStart(e -> {\n+            events.add(e);\n+        });\n+        list.setEditable(true);\n+        cell.updateListView(list);\n+        cell.updateIndex(initialCellIndex);\n+        list.edit(listEditingIndex);\n+        assertEquals(\"sanity: list editingIndex \", listEditingIndex, list.getEditingIndex());\n+        assertFalse(\"sanity: cell must not be editing\", cell.isEditing());\n+        cell.updateIndex(listEditingIndex);\n+        assertEquals(\"sanity: index updated \", listEditingIndex, cell.getIndex());\n+        assertEquals(\"list editingIndex unchanged by cell\", listEditingIndex, list.getEditingIndex());\n+        assertTrue(cell.isEditing());\n+        assertEquals(1, events.size());\n+    }\n+\n+    @Test\n+    public void testChangeIndexOffEditing0_jdk_8264127() {\n+        assertUpdateCellIndexOffEditing(1, 0);\n+    }\n+    @Test\n+    public void testChangeIndexOffEditing1_jdk_8264127() {\n+        assertUpdateCellIndexOffEditing(1, -1);\n+    }\n+    @Test\n+    public void testChangeIndexOffEditing2_jdk_8264127() {\n+        assertUpdateCellIndexOffEditing(0, 1);\n+    }\n+    @Test\n+    public void testChangeIndexOffEditing3_jdk_8264127() {\n+        assertUpdateCellIndexOffEditing(0, -1);\n+    }\n+\n+    public void assertUpdateCellIndexOffEditing(int editingIndex, int cancelIndex) {\n+        list.getFocusModel().focus(-1);\n+        List<EditEvent> events = new ArrayList<EditEvent>();\n+        list.setOnEditCancel(e -> {\n+            events.add(e);\n+        });\n+        list.setEditable(true);\n+        cell.updateListView(list);\n+        cell.updateIndex(editingIndex);\n+        list.edit(editingIndex);\n+        assertEquals(\"sanity: list editingIndex \", editingIndex, list.getEditingIndex());\n+        assertTrue(\"sanity: cell must be editing\", cell.isEditing());\n+        cell.updateIndex(cancelIndex); \/\/ change cell index to negative\n+        assertEquals(\"sanity: index updated \", cancelIndex, cell.getIndex());\n+        assertEquals(\"list editingIndex unchanged by cell\", editingIndex, list.getEditingIndex());\n+        assertFalse(\"cell must not be editing if cell index is \" + cell.getIndex(), cell.isEditing());\n+        assertEquals(1, events.size());\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListCellTest.java","additions":79,"deletions":0,"binary":false,"changes":79,"status":"modified"}]}