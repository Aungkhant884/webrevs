{"files":[{"patch":"@@ -341,0 +341,1 @@\n+        updateEditing();\n@@ -544,1 +545,5 @@\n-        if (index != -1 && list != null) {\n+        if (index == -1 || list == null) {\n+            if(isEditing()) {\n+                cancelEdit();\n+            }\n+        } else {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ListCell.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+import javafx.scene.control.ListView.EditEvent;\n@@ -41,0 +42,2 @@\n+import java.util.List;\n+import java.util.ArrayList;\n@@ -836,0 +839,74 @@\n+    @Test\n+    public void testChangeIndexWhileEditing_jdk_8264127() {\n+        List<EditEvent> events = new ArrayList<EditEvent>();\n+        list.setOnEditCancel(e -> {\n+            events.add(e);\n+        });\n+        list.setEditable(true);\n+        cell.updateListView(list);\n+        cell.updateIndex(1);\n+        list.edit(1);\n+        cell.updateIndex(0);\n+        assertTrue(!cell.isEditing());\n+        assertEquals(\"Should still be editing 1\", list.getEditingIndex(), 1);\n+        assertTrue(\"cell re-use must trigger cancel events\", events.size() == 1);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing1_jdk_8264127() {\n+        assertChangeIndexToEditing(0, 1);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing2_jdk_8264127() {\n+        assertChangeIndexToEditing(1, 0);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing3_jdk_8264127() {\n+        assertChangeIndexToEditing(1, -1);\n+    }\n+\n+    @Test\n+    public void testChangeIndexToEditing4_jdk_8264127() {\n+        assertChangeIndexToEditing(-1, 0);\n+    }\n+\n+    private void assertChangeIndexToEditing(int initialCellIndex, int listEditingIndex) {\n+        list.getFocusModel().focus(-1);\n+        List<EditEvent> events = new ArrayList<EditEvent>();\n+        list.setOnEditStart(e -> {\n+            events.add(e);\n+        });\n+        list.setEditable(true);\n+        cell.updateListView(list);\n+        cell.updateIndex(initialCellIndex);\n+        list.edit(listEditingIndex);\n+        assertEquals(\"sanity: list editingIndex \", listEditingIndex, list.getEditingIndex());\n+        assertFalse(\"sanity: cell must not be editing\", cell.isEditing());\n+        cell.updateIndex(listEditingIndex);\n+        assertEquals(\"sanity: index updated \", listEditingIndex, cell.getIndex());\n+        assertEquals(\"list editingIndex unchanged by cell\", listEditingIndex, list.getEditingIndex());\n+        if(listEditingIndex != -1) {\n+            assertTrue(cell.isEditing());\n+            assertTrue(\"cell re-use must trigger edit events\", events.size() == 1);\n+        } else {\n+            \/\/ -1 represents \"not editing\" for the listview and \"no index\" for the list cell.\n+            assertTrue(!cell.isEditing());\n+            assertTrue(\"cell re-use must trigger edit events\", events.size() == 0);\n+        }\n+    }\n+\n+    @Test\n+    public void testUpdateCellIndexOffEditing() {\n+        list.getFocusModel().focus(-1);\n+        list.setEditable(true);\n+        cell.updateListView(list);\n+        int editingIndex = 1; \/\/ list editing\n+        cell.updateIndex(editingIndex);\n+        list.edit(editingIndex);\n+        \/\/ here we are certain that the cell is in editing state\n+        assertTrue(\"sanity: cell must be editing\", cell.isEditing());\n+        cell.updateIndex(-1); \/\/ change cell index to negative\n+        assertFalse(\"cell must not be editing if cell index is \" + cell.getIndex(), cell.isEditing());\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/ListCellTest.java","additions":77,"deletions":0,"binary":false,"changes":77,"status":"modified"}]}