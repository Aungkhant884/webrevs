{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -3633,0 +3633,1 @@\n+            pdrEventTargets.clear();  \/\/ clear to remove potentially removed nodes, see JDK-8264330\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/Scene.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+import javafx.scene.input.MouseButton;\n@@ -56,0 +57,1 @@\n+import java.lang.ref.WeakReference;\n@@ -974,0 +976,48 @@\n+\n+    @Test public void testNoReferencesRemainToRemovedNodeAfterBeingClicked() {\n+        StubToolkit toolkit = (StubToolkit) Toolkit.getToolkit();\n+        MouseEventGenerator generator = new MouseEventGenerator();\n+        TilePane pane = new TilePane();\n+        VBox vbox = new VBox(pane);\n+        Scene scene = new Scene(vbox, 300, 200);\n+        WeakReference<TilePane> ref = new WeakReference<>(pane);\n+\n+        pane.setMinSize(1000, 1000);  \/\/ ensure mouse click will hit this node\n+\n+        stage.setScene(scene);\n+\n+        \/\/ Press mouse on TilePane so it gets picked up as a potential node to drag:\n+        SceneHelper.processMouseEvent(\n+            scene,\n+            generator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, 100, 100)\n+        );\n+\n+        \/\/ Release mouse on TilePane to trigger clean up code as there will be no dragging:\n+        SceneHelper.processMouseEvent(\n+            scene,\n+            generator.generateMouseEvent(MouseEvent.MOUSE_RELEASED, 100, 100)\n+        );\n+\n+        \/\/ Remove TilePane, and replace with something else:\n+        vbox.getChildren().setAll(new StackPane());\n+\n+        \/\/ Generate a MOUSE_EXITED event for the removed node and a pulse as otherwise many unrelated Scene references\n+        \/\/ hang around to the removed node:\n+        SceneHelper.processMouseEvent(\n+                scene,\n+                new MouseEvent(\n+                        MouseEvent.MOUSE_EXITED, 100, 100, 100, 100, MouseButton.NONE, 0, false, false, false,\n+                        false, false, false, false, false, false, true, null\n+                )\n+        );\n+\n+        toolkit.firePulse();\n+\n+        \/\/ Clear our own reference and call GC to see if the TilePane is now not referenced anywhere:\n+        pane = null;\n+\n+        System.gc();\n+\n+        \/\/ Verify TilePane was GC'd:\n+        assertNull(ref.get());\n+    }\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/SceneTest.java","additions":50,"deletions":0,"binary":false,"changes":50,"status":"modified"}]}