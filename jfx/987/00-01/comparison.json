{"files":[{"patch":"@@ -32,1 +32,0 @@\n-import javafx.application.Platform;\n@@ -46,5 +45,0 @@\n-\n-    boolean isInserted = false;\n-    Callback callback = null;\n-\n-    private Callback lastSetCallback = null;\n@@ -73,2 +67,0 @@\n-        this.callback = callback;\n-        isInserted = true;\n@@ -81,2 +73,0 @@\n-        macMenu.isInserted = true;\n-        macMenu.updateCallback();\n@@ -89,4 +79,0 @@\n-        if (macMenu != null) {\n-            macMenu.isInserted = true;\n-            macMenu.updateCallback();\n-        }\n@@ -100,2 +86,0 @@\n-        macMenu.isInserted = false;\n-        macMenu.callback = null;\n@@ -103,5 +87,0 @@\n-        Platform.runLater(() -> {\n-            \/\/ runLater seems to be important, because otherwise sometimes the callable isn't called.\n-            \/\/ This is probably, because the menu is closed before the callback is called.\n-            macMenu.updateCallback();\n-        });\n@@ -114,9 +93,0 @@\n-        if (macMenu != null) {\n-            macMenu.isInserted = false;\n-            macMenu.callback = null;\n-            Platform.runLater(() -> {\n-                \/\/ runLater seems to be important, because otherwise sometimes the callable isn't called.\n-                \/\/ This is probably, because the menu is closed before the callback is called.\n-                macMenu.updateCallback();\n-            });\n-        }\n@@ -157,13 +127,0 @@\n-    private void updateCallback() {\n-        if (isInserted) {\n-            if (lastSetCallback != callback) {\n-                _setCallback(ptr, callback);\n-                lastSetCallback = callback;\n-            }\n-        } else {\n-            if (lastSetCallback != null) {\n-                _setCallback(ptr, null);\n-                lastSetCallback = null;\n-            }\n-        }\n-    }\n@@ -171,2 +128,1 @@\n-        this.callback = callback;\n-        updateCallback();\n+        _setCallback(ptr, callback);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/glass\/ui\/mac\/MacMenuDelegate.java","additions":1,"deletions":45,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -116,1 +116,1 @@\n-            self->jCallback = (*env)->NewGlobalRef(env, jcallback);\n+            self->jCallback = (*env)->NewWeakGlobalRef(env, jcallback);\n@@ -155,1 +155,1 @@\n-            (*env)->DeleteGlobalRef(env, self->jCallback);\n+            (*env)->DeleteWeakGlobalRef(env, self->jCallback);\n@@ -650,1 +650,1 @@\n-        (*env)->DeleteGlobalRef(env, menu->jCallback);\n+        (*env)->DeleteWeakGlobalRef(env, menu->jCallback);\n@@ -653,1 +653,1 @@\n-            menu->jCallback = (*env)->NewGlobalRef(env, jCallback);\n+            menu->jCallback = (*env)->NewWeakGlobalRef(env, jCallback);\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/mac\/GlassMenu.m","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}