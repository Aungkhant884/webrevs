{"files":[{"patch":"@@ -3077,30 +3077,20 @@\n-        int itemCount = getCellCount();\n-        int cacheCount = itemSizeCache.size();\n-        boolean keepRatio = ((cacheCount > 0) && !Double.isInfinite(this.absoluteOffset));\n-\n-        int oldIndex = computeCurrentIndex();\n-        double oldOffset = computeViewportOffset(getPosition());\n-        int added = 0;\n-        while ((itemCount > itemSizeCache.size()) && (added < improve)) {\n-            getOrCreateCellSize(itemSizeCache.size());\n-            added++;\n-        }\n-        cacheCount = itemSizeCache.size();\n-        int cnt = 0;\n-        double tot = 0d;\n-        for (int i = 0; (i < itemCount && i < cacheCount); i++) {\n-            Double il = itemSizeCache.get(i);\n-            if (il != null) {\n-                tot = tot + il;\n-                cnt++;\n-            }\n-        }\n-        this.estimatedSize = cnt == 0 ? 1d : tot * itemCount \/ cnt;\n-        double estSize = estimatedSize \/ itemCount;\n-\n-        if (keepRatio) {\n-            double newOffset = 0;\n-            for (int i = 0; i < oldIndex; i++) {\n-                double h = getCellSize(i);\n-                if (h < 0) {\n-                    h = estSize;\n+        try {\n+            int itemCount = getCellCount();\n+            int cacheCount = itemSizeCache.size();\n+            boolean keepRatio = ((cacheCount > 0) && !Double.isInfinite(this.absoluteOffset));\n+\n+            int oldIndex = computeCurrentIndex();\n+            double oldOffset = computeViewportOffset(getPosition());\n+            int added = 0;\n+            while ((itemCount > itemSizeCache.size()) && (added < improve)) {\n+                getOrCreateCellSize(itemSizeCache.size());\n+                added++;\n+            }\n+            cacheCount = itemSizeCache.size();\n+            int cnt = 0;\n+            double tot = 0d;\n+            for (int i = 0; (i < itemCount && i < cacheCount); i++) {\n+                Double il = itemSizeCache.get(i);\n+                if (il != null) {\n+                    tot = tot + il;\n+                    cnt++;\n@@ -3108,1 +3098,0 @@\n-                newOffset += h;\n@@ -3110,2 +3099,17 @@\n-            this.absoluteOffset = newOffset + oldOffset;\n-            adjustPosition();\n+            this.estimatedSize = cnt == 0 ? 1d : tot * itemCount \/ cnt;\n+            double estSize = estimatedSize \/ itemCount;\n+\n+            if (keepRatio) {\n+                double newOffset = 0;\n+                for (int i = 0; i < oldIndex; i++) {\n+                    double h = getCellSize(i);\n+                    if (h < 0) {\n+                        h = estSize;\n+                    }\n+                    newOffset += h;\n+                }\n+                this.absoluteOffset = newOffset + oldOffset;\n+                adjustPosition();\n+            }\n+        } finally {\n+            recalculating = false;\n@@ -3113,1 +3117,0 @@\n-        recalculating = false;\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":37,"deletions":34,"binary":false,"changes":71,"status":"modified"}]}