{"files":[{"patch":"@@ -29,0 +29,3 @@\n+import com.sun.javafx.collections.TrackableObservableList;\n+import com.sun.javafx.util.Utils;\n+\n@@ -36,2 +39,2 @@\n-import javafx.geometry.Bounds;\n-import javafx.geometry.NodeOrientation;\n+import javafx.geometry.HPos;\n+import javafx.geometry.Point2D;\n@@ -39,0 +42,1 @@\n+import javafx.geometry.VPos;\n@@ -41,3 +45,0 @@\n-import javafx.stage.Window;\n-\n-import com.sun.javafx.collections.TrackableObservableList;\n@@ -45,0 +46,1 @@\n+import javafx.stage.Window;\n@@ -247,25 +249,3 @@\n-        setAnchorLocation(getAnchorLocation(side, anchor.getEffectiveNodeOrientation()));\n-        Bounds anchorBounds = anchor.localToScreen(anchor.getLayoutBounds());\n-        double x = getXBySide(anchorBounds, side, anchor.getEffectiveNodeOrientation()) + dx;\n-        double y = getYBySide(anchorBounds, side) + dy;\n-        doShow(anchor, x, y);\n-    }\n-\n-     private AnchorLocation getAnchorLocation(Side side, NodeOrientation orientation) {\n-         if (orientation == NodeOrientation.RIGHT_TO_LEFT) {\n-             switch (side) {\n-                 case TOP: return AnchorLocation.CONTENT_BOTTOM_RIGHT;\n-                 case RIGHT: return AnchorLocation.CONTENT_TOP_RIGHT;\n-                 case BOTTOM: return AnchorLocation.CONTENT_TOP_RIGHT;\n-                 case LEFT: return AnchorLocation.CONTENT_TOP_LEFT;\n-             }\n-         } else {\n-             switch (side) {\n-                 case TOP: return AnchorLocation.CONTENT_BOTTOM_LEFT;\n-                 case RIGHT: return AnchorLocation.CONTENT_TOP_LEFT;\n-                 case BOTTOM: return AnchorLocation.CONTENT_TOP_LEFT;\n-                 case LEFT: return AnchorLocation.CONTENT_TOP_RIGHT;\n-             }\n-         }\n-        return AnchorLocation.CONTENT_TOP_LEFT; \/\/ never reached\n-     }\n+        if (getScene().getStylesheets().isEmpty()) {\n+            getScene().getStylesheets().setAll(anchor.getScene().getStylesheets());\n+        }\n@@ -273,15 +253,2 @@\n-     private double getXBySide(Bounds anchorBounds, Side side, NodeOrientation orientation) {\n-         if (orientation == NodeOrientation.RIGHT_TO_LEFT) {\n-             if (side == Side.RIGHT) {\n-                 return anchorBounds.getMinX();\n-             } else {\n-                 return anchorBounds.getMaxX();\n-             }\n-         } else {\n-             if (side == Side.RIGHT) {\n-                 return anchorBounds.getMaxX();\n-             } else {\n-                 return anchorBounds.getMinX();\n-             }\n-         }\n-     }\n+        HPos hpos = side == Side.LEFT ? HPos.LEFT : side == Side.RIGHT ? HPos.RIGHT : HPos.CENTER;\n+        VPos vpos = side == Side.TOP ? VPos.TOP : side == Side.BOTTOM ? VPos.BOTTOM : VPos.CENTER;\n@@ -289,7 +256,6 @@\n-     private double getYBySide(Bounds anchorBounds, Side side) {\n-         if (side == Side.BOTTOM) {\n-             return anchorBounds.getMaxY();\n-         } else {\n-             return anchorBounds.getMinY();\n-         }\n-     }\n+        \/\/ translate from anchor\/hpos\/vpos\/dx\/dy into screenX\/screenY\n+        Point2D point = Utils.pointRelativeTo(anchor,\n+                prefWidth(-1), prefHeight(-1),\n+                hpos, vpos, dx, dy, true);\n+        doShow(anchor, point.getX(), point.getY());\n+    }\n@@ -312,1 +278,0 @@\n-        setAnchorLocation(AnchorLocation.CONTENT_TOP_LEFT);\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/ContextMenu.java","additions":18,"deletions":53,"binary":false,"changes":71,"status":"modified"}]}