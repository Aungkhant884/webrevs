{"files":[{"patch":"@@ -8192,1 +8192,1 @@\n-     * focus, we need to stop clearing the focusWithin bits if we encounter a parent node that is focused.\n+     * focus, we need to adjust the focus-within count on all parents of the node.\n@@ -8197,2 +8197,2 @@\n-            while (node != null && !node.focused.get()) {\n-                node.focusWithin.set(false);\n+            while (node != null) {\n+                node.focusWithin.adjust(-focusWithin.count);\n@@ -8240,0 +8240,1 @@\n+                int change = value ? 1 : -1;\n@@ -8241,0 +8242,1 @@\n+\n@@ -8242,1 +8244,1 @@\n-                    node.focusWithin.set(value);\n+                    node.focusWithin.adjust(change);\n@@ -8298,2 +8300,4 @@\n-    private final FocusPropertyBase focusWithin = new FocusPropertyBase() {\n-        private int count; \/\/ the number of downstream focused nodes\n+    private final FocusWithinProperty focusWithin = new FocusWithinProperty();\n+\n+    private class FocusWithinProperty extends FocusPropertyBase {\n+        int count;\n@@ -8311,6 +8315,10 @@\n-        @Override\n-        public void set(boolean value) {\n-            if (value && ++count == 1) {\n-                super.set(true);\n-            } else if (!value && --count == 0) {\n-                super.set(false);\n+        \/**\n+         * Adjusts the number of focused nodes within this node.\n+         *\/\n+        void adjust(int change) {\n+            count += change;\n+\n+            if (count == 1) {\n+                set(true);\n+            } else if (count == 0) {\n+                set(false);\n","filename":"modules\/javafx.graphics\/src\/main\/java\/javafx\/scene\/Node.java","additions":20,"deletions":12,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -1026,1 +1026,1 @@\n-        N node1, node2, node3, node4;\n+        N node1, node2, node3, node4, node5;\n@@ -1029,4 +1029,6 @@\n-            node1 = new N(\n-                node2 = new N(\n-                    node3 = new N(\n-                        node4 = new N()\n+            node1 = new N(                  \/\/ focusWithin=3\n+                node2 = new N(              \/\/ focusWithin=3, focused\n+                    node3 = new N(          \/\/ focusWithin=2\n+                        node4 = new N(      \/\/ focusWithin=2, focused\n+                            node5 = new N() \/\/ focusWithin=1, focused\n+                        )\n@@ -1039,2 +1041,10 @@\n-\n-        \/\/ Remove node4 from the scene graph\n+        node5.setFocused();\n+\n+        \/\/ Detach node4 from the scene graph:\n+        \/\/     node1           focusWithin=1\n+        \/\/     |--> node2      focusWithin=1, focused\n+        \/\/         |--> node3\n+        \/\/\n+        \/\/     node4           focusWithin=2, focused\n+        \/\/     |--> node5      focusWithin=1, focused\n+        \/\/\n@@ -1047,0 +1057,1 @@\n+        assertIsFocusWithin(node5);\n@@ -1052,0 +1063,1 @@\n+        assertIsFocused(node5);\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/javafx\/scene\/FocusTest.java","additions":19,"deletions":7,"binary":false,"changes":26,"status":"modified"}]}