{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,2 +35,0 @@\n-import javafx.beans.InvalidationListener;\n-import javafx.beans.Observable;\n@@ -43,1 +41,0 @@\n-import javafx.scene.control.ListView;\n@@ -47,0 +44,1 @@\n+import javafx.scene.layout.Region;\n@@ -88,1 +86,0 @@\n-\n@@ -99,4 +96,0 @@\n-    private double fixedCellSize;\n-    private boolean fixedCellSizeEnabled;\n-\n-\n@@ -132,21 +125,0 @@\n-\n-        setupTreeViewListeners();\n-    }\n-\n-    private void setupTreeViewListeners() {\n-        TreeView<T> treeView = getSkinnable().getTreeView();\n-        if (treeView == null) {\n-            getSkinnable().treeViewProperty().addListener(new InvalidationListener() {\n-                @Override public void invalidated(Observable observable) {\n-                    getSkinnable().treeViewProperty().removeListener(this);\n-                    setupTreeViewListeners();\n-                }\n-            });\n-        } else {\n-            this.fixedCellSize = treeView.getFixedCellSize();\n-            this.fixedCellSizeEnabled = fixedCellSize > 0;\n-            registerChangeListener(treeView.fixedCellSizeProperty(), e -> {\n-                this.fixedCellSize = getSkinnable().getTreeView().getFixedCellSize();\n-                this.fixedCellSizeEnabled = fixedCellSize > 0;\n-            });\n-        }\n@@ -156,1 +128,0 @@\n-\n@@ -280,1 +251,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -291,1 +263,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -308,1 +281,2 @@\n-        if (fixedCellSizeEnabled) {\n+        double fixedCellSize = getFixedCellSize();\n+        if (fixedCellSize > 0) {\n@@ -343,0 +317,4 @@\n+    private double getFixedCellSize() {\n+        TreeView<?> treeView = getSkinnable().getTreeView();\n+        return treeView != null ? treeView.getFixedCellSize() : Region.USE_COMPUTED_SIZE;\n+    }\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/TreeCellSkin.java","additions":12,"deletions":34,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,0 +42,1 @@\n+import static javafx.scene.control.ControlShim.*;\n@@ -733,0 +734,23 @@\n+\n+    \/**\n+     * Test that min\/max\/pref height respect fixedCellSize.\n+     * Sanity test when fixing JDK-8253634.\n+     *\/\n+    @Test\n+    public void testTreeCellHeights() {\n+        TreeCell<Object> cell =  new TreeCell<>();\n+        TreeView<Object> treeView = new TreeView<>();\n+        cell.updateTreeView(treeView);\n+        installDefaultSkin(cell);\n+        treeView.setFixedCellSize(100);\n+        assertEquals(\"pref height must be fixedCellSize\",\n+                treeView.getFixedCellSize(),\n+                cell.prefHeight(-1), 1);\n+        assertEquals(\"min height must be fixedCellSize\",\n+                treeView.getFixedCellSize(),\n+                cell.minHeight(-1), 1);\n+        assertEquals(\"max height must be fixedCellSize\",\n+                treeView.getFixedCellSize(),\n+                cell.maxHeight(-1), 1);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/TreeCellTest.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -45,0 +45,2 @@\n+import javafx.scene.control.TreeCell;\n+import javafx.scene.control.TreeView;\n@@ -59,0 +61,26 @@\n+\/\/ ------------------ TreeCell\n+\n+    @Test\n+    public void testTreeCellReplaceTreeViewWithNull() {\n+        TreeCell<Object> cell =  new TreeCell<>();\n+        TreeView<Object> treeView = new TreeView<>();\n+        cell.updateTreeView(treeView);\n+        installDefaultSkin(cell);\n+        cell.updateTreeView(null);\n+        \/\/ 8253634: updating the old treeView must not throw NPE in skin\n+        treeView.setFixedCellSize(100);\n+    }\n+\n+    @Test\n+    public void testTreeCellPrefHeightOnReplaceTreeView() {\n+        TreeCell<Object> cell =  new TreeCell<>();\n+        cell.updateTreeView(new TreeView<>());\n+        installDefaultSkin(cell);\n+        TreeView<Object> treeView = new TreeView<>();\n+        treeView.setFixedCellSize(100);\n+        cell.updateTreeView(treeView);\n+        assertEquals(\"fixed cell set to value of new treeView\",\n+                cell.getTreeView().getFixedCellSize(),\n+                cell.prefHeight(-1), 1);\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinCleanupTest.java","additions":28,"deletions":0,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -45,1 +45,0 @@\n-import javafx.scene.control.ChoiceBox;\n@@ -50,2 +49,0 @@\n-import javafx.scene.control.ListCell;\n-import javafx.scene.control.ListView;\n@@ -66,2 +63,0 @@\n-import javafx.scene.control.ToolBar;\n-import javafx.scene.control.TreeCell;\n@@ -131,1 +126,0 @@\n-                TreeCell.class,\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/SkinMemoryLeakTest.java","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"}]}