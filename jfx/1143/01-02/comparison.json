{"files":[{"patch":"@@ -375,1 +375,4 @@\n-    GdkKeymap *keymap = gdk_keymap_get_default();\n+    Display* display = gdk_x11_display_get_xdisplay(gdk_display_get_default());\n+    if (!isXkbAvailable(display)) {\n+        return com_sun_glass_events_KeyEvent_KEY_LOCK_UNKNOWN;\n+    }\n@@ -377,0 +380,1 @@\n+    Atom keyCodeAtom = None;\n@@ -379,3 +383,2 @@\n-            return (gdk_keymap_get_caps_lock_state(keymap))\n-                ? com_sun_glass_events_KeyEvent_KEY_LOCK_ON\n-                : com_sun_glass_events_KeyEvent_KEY_LOCK_OFF;\n+            keyCodeAtom = XInternAtom(display, \"Caps Lock\", True);\n+            break;\n@@ -384,3 +387,15 @@\n-            return (gdk_keymap_get_num_lock_state(keymap))\n-                ? com_sun_glass_events_KeyEvent_KEY_LOCK_ON\n-                : com_sun_glass_events_KeyEvent_KEY_LOCK_OFF;\n+            keyCodeAtom = XInternAtom(display, \"Num Lock\", True);\n+            break;\n+    }\n+\n+    if (keyCodeAtom == None) {\n+        return com_sun_glass_events_KeyEvent_KEY_LOCK_UNKNOWN;\n+    }\n+\n+    Bool isLocked = False;\n+    if (XkbGetNamedIndicator(display, keyCodeAtom, NULL, &isLocked, NULL, NULL)) {\n+        if (isLocked) {\n+            return com_sun_glass_events_KeyEvent_KEY_LOCK_ON;\n+        } else {\n+            return com_sun_glass_events_KeyEvent_KEY_LOCK_OFF;\n+        }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_key.cpp","additions":22,"deletions":7,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -478,12 +478,9 @@\n-    \/\/ do not send undefined keys\n-    if (glassKey > 0) {\n-        mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n-                (press) ? com_sun_glass_events_KeyEvent_PRESS\n-                        : com_sun_glass_events_KeyEvent_RELEASE,\n-                glassKey,\n-                jChars,\n-                glassModifier);\n-        CHECK_JNI_EXCEPTION(mainEnv)\n-    }\n-\n-    if (key > 0 && press) { \/\/ TYPED events should only be sent for printable characters.\n+    mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n+            (press) ? com_sun_glass_events_KeyEvent_PRESS\n+                    : com_sun_glass_events_KeyEvent_RELEASE,\n+            glassKey,\n+            jChars,\n+            glassModifier);\n+    CHECK_JNI_EXCEPTION(mainEnv)\n+\n+    if (press && key > 0) { \/\/ TYPED events should only be sent for printable characters.\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.cpp","additions":9,"deletions":12,"binary":false,"changes":21,"status":"modified"}]}