{"files":[{"patch":"@@ -37,1 +37,2 @@\n-static void glass_g_hash_table_insert_int(GHashTable *table, gint key, gint value) {\n+static void glass_g_hash_table_insert_int(GHashTable *table, gint key, gint value)\n+{\n@@ -41,1 +42,2 @@\n-static void initialize_key() {\n+static void initialize_key()\n+{\n@@ -46,1 +48,1 @@\n-    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Clear), com_sun_glass_events_KeyEvent_VK_CLEAR);\n+    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Clear), com_sun_glass_events_KeyEvent_VK_CLEAR); \/\/XXX what is this?\n@@ -51,1 +53,1 @@\n-    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Print), com_sun_glass_events_KeyEvent_VK_PRINTSCREEN);\n+    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Print), com_sun_glass_events_KeyEvent_VK_PRINTSCREEN); \/\/XXX is correct?\n@@ -53,1 +55,1 @@\n-    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Help), com_sun_glass_events_KeyEvent_VK_HELP);\n+    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Help), com_sun_glass_events_KeyEvent_VK_HELP); \/\/XXX what is this?\n@@ -56,1 +58,1 @@\n-    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Shift_R), com_sun_glass_events_KeyEvent_VK_SHIFT);\n+    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Shift_R), com_sun_glass_events_KeyEvent_VK_SHIFT); \/\/XXX is this correct?\n@@ -65,1 +67,1 @@\n-    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Meta_R), com_sun_glass_events_KeyEvent_VK_CONTEXT_MENU);\n+    glass_g_hash_table_insert_int(keymap, GLASS_GDK_KEY_CONSTANT(Meta_R), com_sun_glass_events_KeyEvent_VK_CONTEXT_MENU);\/\/XXX is this correct?\n@@ -252,1 +254,2 @@\n-jint gdk_keyval_to_glass(guint keyval) {\n+jint gdk_keyval_to_glass(guint keyval)\n+{\n@@ -302,1 +305,2 @@\n-jint gdk_modifier_mask_to_glass(guint mask) {\n+jint gdk_modifier_mask_to_glass(guint mask)\n+{\n@@ -330,1 +334,1 @@\n-            return com_sun_glass_events_KeyEvent_MODIFIER_NONE;\n+            return 0;\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_key.cpp","additions":14,"deletions":10,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -462,0 +462,16 @@\n+    } else {\n+#ifdef GLASS_GTK2\n+        if (key == 0) {\n+            \/\/ Work around \"bug\" fixed in gtk-3.0:\n+            \/\/ http:\/\/mail.gnome.org\/archives\/commits-list\/2011-March\/msg06832.html\n+            switch (event->keyval) {\n+            case 0xFF08 \/* Backspace *\/: key =  '\\b';\n+            case 0xFF09 \/* Tab       *\/: key =  '\\t';\n+            case 0xFF0A \/* Linefeed  *\/: key =  '\\n';\n+            case 0xFF0B \/* Vert. Tab *\/: key =  '\\v';\n+            case 0xFF0D \/* Return    *\/: key =  '\\r';\n+            case 0xFF1B \/* Escape    *\/: key =  '\\033';\n+            case 0xFFFF \/* Delete    *\/: key =  '\\177';\n+            }\n+        }\n+#endif\n@@ -473,0 +489,8 @@\n+    if (jview) {\n+        if (press) {\n+            mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n+                    com_sun_glass_events_KeyEvent_PRESS,\n+                    glassKey,\n+                    jChars,\n+                    glassModifier);\n+            CHECK_JNI_EXCEPTION(mainEnv)\n@@ -474,19 +498,16 @@\n-    if (!jview) {\n-        return;\n-    }\n-\n-    mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n-            (press) ? com_sun_glass_events_KeyEvent_PRESS\n-                    : com_sun_glass_events_KeyEvent_RELEASE,\n-            glassKey,\n-            jChars,\n-            glassModifier);\n-    CHECK_JNI_EXCEPTION(mainEnv)\n-\n-    if (press && key > 0) { \/\/ TYPED events should only be sent for printable characters.\n-        mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n-                com_sun_glass_events_KeyEvent_TYPED,\n-                com_sun_glass_events_KeyEvent_VK_UNDEFINED,\n-                jChars,\n-                glassModifier);\n-        CHECK_JNI_EXCEPTION(mainEnv)\n+            if (jview && key > 0) { \/\/ TYPED events should only be sent for printable characters.\n+                mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n+                        com_sun_glass_events_KeyEvent_TYPED,\n+                        com_sun_glass_events_KeyEvent_VK_UNDEFINED,\n+                        jChars,\n+                        glassModifier);\n+                CHECK_JNI_EXCEPTION(mainEnv)\n+            }\n+        } else {\n+            mainEnv->CallVoidMethod(jview, jViewNotifyKey,\n+                    com_sun_glass_events_KeyEvent_RELEASE,\n+                    glassKey,\n+                    jChars,\n+                    glassModifier);\n+            CHECK_JNI_EXCEPTION(mainEnv)\n+        }\n","filename":"modules\/javafx.graphics\/src\/main\/native-glass\/gtk\/glass_window.cpp","additions":40,"deletions":19,"binary":false,"changes":59,"status":"modified"}]}