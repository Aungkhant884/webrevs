{"files":[{"patch":"@@ -29,1 +29,0 @@\n-import com.sun.javafx.collections.MapListenerHelper;\n@@ -40,0 +39,1 @@\n+import java.util.List;\n@@ -44,0 +44,1 @@\n+import java.util.concurrent.CopyOnWriteArrayList;\n@@ -62,1 +63,2 @@\n-    private MapListenerHelper<String, Object> helper;\n+    private final List<InvalidationListener> invalidationListeners = new CopyOnWriteArrayList<>();\n+    private final List<MapChangeListener<? super String, Object>> mapChangeListeners = new CopyOnWriteArrayList<>();\n@@ -80,1 +82,1 @@\n-        helper = MapListenerHelper.addListener(helper, listener);\n+        invalidationListeners.add(listener);\n@@ -85,1 +87,1 @@\n-        helper = MapListenerHelper.removeListener(helper, listener);\n+        invalidationListeners.remove(listener);\n@@ -90,1 +92,1 @@\n-        helper = MapListenerHelper.addListener(helper, listener);\n+        mapChangeListeners.add(listener);\n@@ -95,1 +97,1 @@\n-        helper = MapListenerHelper.removeListener(helper, listener);\n+        mapChangeListeners.remove(listener);\n@@ -212,0 +214,4 @@\n+        for (var listener : invalidationListeners) {\n+            listener.invalidated(this);\n+        }\n+\n@@ -226,1 +232,3 @@\n-            MapListenerHelper.fireValueChangedEvent(helper, change);\n+            for (var listener : mapChangeListeners) {\n+                listener.onChanged(change);\n+            }\n","filename":"modules\/javafx.graphics\/src\/main\/java\/com\/sun\/javafx\/application\/preferences\/PlatformPreferences.java","additions":15,"deletions":7,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -133,0 +133,3 @@\n+        assertEquals(2, count[0]);\n+\n+        prefs.update(Map.of(\"qux\", \"quux\", \"quz\", \"quuz\", \"abc\", \"def\"));\n","filename":"modules\/javafx.graphics\/src\/test\/java\/test\/com\/sun\/javafx\/application\/preferences\/PlatformPreferencesTest.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -93,4 +93,3 @@\n-                if (changed.size() > 0) {\n-                    double scrollTop = textArea.getScrollTop();\n-                    textArea.setText(textArea.getText() + \"changed = \" + formatPrefs(changed));\n-                    textArea.setScrollTop(scrollTop);\n+                double scrollTop = textArea.getScrollTop();\n+                textArea.setText(textArea.getText() + \"changed = \" + formatPrefs(changed));\n+                textArea.setScrollTop(scrollTop);\n@@ -98,2 +97,1 @@\n-                    cachedPreferences = new HashMap<>(Platform.getPreferences());\n-                }\n+                cachedPreferences = new HashMap<>(Platform.getPreferences());\n","filename":"tests\/manual\/events\/PlatformPreferencesTest.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"}]}