{"files":[{"patch":"@@ -51,1 +51,1 @@\n-    \/\/ scheduleDispatchFunctionsOnMainThread is invoced, the system class loader\n+    \/\/ scheduleDispatchFunctionsOnMainThread is invoked, the system class loader\n@@ -65,0 +65,1 @@\n+    \/\/ once\n","filename":"modules\/javafx.web\/src\/main\/native\/Source\/WTF\/wtf\/java\/MainThreadJava.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-    @Test\n+    @Test (timeout = 15000)\n@@ -60,1 +60,1 @@\n-            \"-cp\",appModulePath + \"\/mymod\",\n+            \"-cp\", appModulePath + \"\/mymod\",\n","filename":"tests\/system\/src\/test\/java\/test\/com\/sun\/webkit\/MainThreadTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,1 +32,3 @@\n-import javafx.application.Platform;\n+import javafx.beans.value.ChangeListener;\n+import javafx.beans.value.ObservableValue;\n+import javafx.concurrent.Worker.State;\n@@ -39,0 +41,4 @@\n+    public static final int ERROR_OK = 0;\n+    public static final int ERROR_ASSUMPTION_VIOLATED = 1;\n+    public static final int ERROR_TIMEOUT = 2;\n+    public static final int ERROR_TITLE_NOT_UPDATED = 3;\n@@ -46,1 +52,1 @@\n-            System.exit(1);\n+            System.exit(ERROR_ASSUMPTION_VIOLATED);\n@@ -51,1 +57,1 @@\n-            System.exit(1);\n+            System.exit(ERROR_ASSUMPTION_VIOLATED);\n@@ -58,1 +64,1 @@\n-            System.exit(1);\n+            System.exit(ERROR_ASSUMPTION_VIOLATED);\n@@ -63,1 +69,1 @@\n-            System.exit(1);\n+            System.exit(ERROR_ASSUMPTION_VIOLATED);\n@@ -88,1 +94,13 @@\n-\n+        webview.getEngine().getLoadWorker().stateProperty().addListener(\n+                new ChangeListener<State>() {\n+                    public void changed(ObservableValue ov, State oldState, State newState) {\n+                        String title = webview.getEngine().getTitle();\n+                        if (newState == State.SUCCEEDED) {\n+                            if (\"Executed\".equals(title)) {\n+                                System.exit(ERROR_OK);\n+                            } else {\n+                                System.exit(ERROR_TITLE_NOT_UPDATED);\n+                            }\n+                        }\n+                    }\n+                });\n@@ -95,19 +113,0 @@\n-\n-        new Thread() {\n-            @Override\n-            public void run() {\n-                while (true) {\n-                    Platform.runLater(() -> {\n-                        String title = webview.getEngine().getTitle();\n-                        if(\"Executed\".equals(title)) {\n-                            System.exit(0);\n-                        }\n-                    });\n-                    try {\n-                        Thread.sleep(500);\n-                    } catch (InterruptedException ex) {\n-                        break;\n-                    }\n-                }\n-            }\n-        }.start();\n","filename":"tests\/system\/src\/testapp7\/java\/mymod\/myapp7\/DataUrlWithModuleLayer.java","additions":24,"deletions":25,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -41,0 +41,13 @@\n+        \/\/ Install safeguard to ensure this application is terminated\n+        new Thread() {\n+            @Override\n+            public void run() {\n+                try {\n+                    Thread.sleep(15000);\n+                } catch (InterruptedException ex) {\n+                    \/\/ Ok, lets exit early\n+                }\n+                System.exit(DataUrlWithModuleLayer.ERROR_TIMEOUT);\n+            }\n+        }.start();\n+\n","filename":"tests\/system\/src\/testapp7\/java\/mymod\/myapp7\/DataUrlWithModuleLayerLauncher.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"}]}