{"files":[{"patch":"@@ -858,0 +858,2 @@\n+            int oldIndex = computeCurrentIndex();\n+            double oldOffset = computeViewportOffset(getPosition());\n@@ -863,0 +865,2 @@\n+            double boff = computeBaseOffset(oldIndex);\n+            absoluteOffset = boff + oldOffset;\n@@ -2981,0 +2985,12 @@\n+    private double computeBaseOffset(int index) {\n+        double baseOffset = 0d;\n+        int currentCellCount = getCellCount();\n+        double estSize = estimatedSize \/ currentCellCount;\n+        for (int i = 0; i < index; i++) {\n+            double nextSize = getCellSize(i);\n+            if (nextSize < 0) nextSize = estSize;\n+            baseOffset += nextSize;\n+        }\n+        return baseOffset;\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -100,1 +100,1 @@\n-                return flow.isVertical() ? (c.getIndex() == 29 ? 200 : 100) : (c.getIndex() == 29 ? 100 : 25);\n+                return flow.isVertical() ? (getIndex() == 29 ? 200 : 100) : (getIndex() == 29 ? 100 : 25);\n@@ -115,1 +115,1 @@\n-                return flow.isVertical() ? (c.getIndex() == 29 ? 100 : 25) : (c.getIndex() == 29 ? 200 : 100);\n+                return flow.isVertical() ? (getIndex() == 29 ? 100 : 25) : (getIndex() == 29 ? 200 : 100);\n@@ -1225,0 +1225,30 @@\n+    @Test\n+    \/\/ see JDK-8306447\n+    public void testPositionCellRemainsConstantWithManyItems() {\n+        flow.setVertical(true);\n+        flow.setCellCount(100);\n+        flow.resize(300, 300);\n+        \/\/ scroll up and down, to populate the size cache\n+        for (int i = 0; i < 20; i++) {\n+            flow.scrollPixels(1);\n+            pulse();\n+            flow.scrollPixels(-1);\n+            pulse();\n+        }\n+        flow.scrollPixels(911);\n+        pulse();\n+\n+        IndexedCell vc = flow.getCell(33);\n+        double cellPosition = flow.getCellPosition(vc);\n+        \/\/ cell 33 should be at (32 x 25 + 1 x 100) - 911 = -11\n+        assertEquals(\"Wrong first cell position\", -11d, cellPosition, 0d);\n+\n+        flow.setCellCount(101);\n+        pulse();\n+        vc = flow.getCell(33);\n+        cellPosition = flow.getCellPosition(vc);\n+        assertEquals(\"First cell position changed after adding cell on large irregular list\", -11d, cellPosition, 0d);\n+    }\n+\n+\n+\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/VirtualFlowTest.java","additions":32,"deletions":2,"binary":false,"changes":34,"status":"modified"}]}