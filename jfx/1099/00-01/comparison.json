{"files":[{"patch":"@@ -858,2 +858,2 @@\n-            int oldIndex = computeCurrentIndex();\n-            double oldOffset = computeViewportOffset(getPosition());\n+            int oldIndex = computeCurrentIndex(oldCount);\n+            double oldOffset = computeViewportOffset(getPosition(), oldCount);\n@@ -862,1 +862,1 @@\n-            recalculateEstimatedSize();\n+            recalculateAndImproveEstimatedSize(DEFAULT_IMPROVEMENT, oldIndex, oldOffset);\n@@ -2898,0 +2898,4 @@\n+        return computeViewportOffset(position, getCellCount());\n+    }\n+\n+    private double computeViewportOffset(double position, int localCellCount) {\n@@ -2900,1 +2904,1 @@\n-        double estSize = estimatedSize \/ getCellCount();\n+        double estSize = estimatedSize \/ localCellCount;\n@@ -2906,1 +2910,1 @@\n-        for (int i = 0; i < getCellCount(); i++) {\n+        for (int i = 0; i < localCellCount; i++) {\n@@ -2998,0 +3002,4 @@\n+        return computeCurrentIndex(getCellCount());\n+    }\n+\n+    private int computeCurrentIndex(int currentCellCount) {\n@@ -2999,1 +3007,0 @@\n-        int currentCellCount = getCellCount();\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -1246,5 +1246,7 @@\n-        flow.setCellCount(101);\n-        pulse();\n-        vc = flow.getCell(33);\n-        cellPosition = flow.getCellPosition(vc);\n-        assertEquals(\"First cell position changed after adding cell on large irregular list\", -11d, cellPosition, 0d);\n+        for (int i = 1; i < 10; i++) {\n+            flow.setCellCount(100 + i);\n+            pulse();\n+            vc = flow.getCell(33);\n+            cellPosition = flow.getCellPosition(vc);\n+            assertEquals(\"First cell position changed after adding \" + i + \" cells on large irregular list\", -11d, cellPosition, 0d);\n+        }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/VirtualFlowTest.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"}]}