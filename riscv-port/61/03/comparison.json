{"files":[{"patch":"@@ -95,2 +95,3 @@\n-  product(bool, UseRVC, false, EXPERIMENTAL, \"Use RVC instructions\")\n-\n+  product(bool, UseRVC, false, EXPERIMENTAL, \"Use RVC instructions\")             \\\n+  product(bool, UseRVVForBigIntegerShiftIntrinsics, true,                        \\\n+          \"Use RVV instructions for left\/right shift of BigInteger\")\n","filename":"src\/hotspot\/cpu\/riscv\/globals_riscv.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2856,0 +2856,51 @@\n+\n+  \/\/ Arguments:\n+  \/\/\n+  \/\/ Input:\n+  \/\/   c_rarg0   - newArr address\n+  \/\/   c_rarg1   - oldArr address\n+  \/\/   c_rarg2   - newIdx\n+  \/\/   c_rarg3   - shiftCount\n+  \/\/   c_rarg4   - numIter\n+  \/\/\n+  address generate_bigIntegerLeftShift() {\n+    __ align(CodeEntryAlignment);\n+    StubCodeMark mark(this, \"StubRoutines\", \"bigIntegerLeftShiftWorker\");\n+    address entry = __ pc();\n+\n+    Label loop, exit;\n+\n+    Register newArr        = c_rarg0;\n+    Register oldArr        = c_rarg1;\n+    Register newIdx        = c_rarg2;\n+    Register shiftCount    = c_rarg3;\n+    Register numIter       = c_rarg4;\n+\n+    Register shiftRevCount = c_rarg5;\n+    Register oldArrNext    = t1;\n+\n+    __ beqz(numIter, exit);\n+    __ shadd(newArr, newIdx, newArr, t0, 2);\n+\n+    __ li(shiftRevCount, 32);\n+    __ sub(shiftRevCount, shiftRevCount, shiftCount);\n+\n+    __ bind(loop);\n+    __ addi(oldArrNext, oldArr, 4);\n+    __ vsetvli(t0, numIter, Assembler::e32, Assembler::m4);\n+    __ vle32_v(v0, oldArr);\n+    __ vle32_v(v4, oldArrNext);\n+    __ vsll_vx(v0, v0, shiftCount);\n+    __ vsrl_vx(v4, v4, shiftRevCount);\n+    __ vor_vv(v0, v0, v4);\n+    __ vse32_v(v0, newArr);\n+    __ sub(numIter, numIter, t0);\n+    __ shadd(oldArr, t0, oldArr, t1, 2);\n+    __ shadd(newArr, t0, newArr, t1, 2);\n+    __ bnez(numIter, loop);\n+\n+    __ bind(exit);\n+    __ ret();\n+\n+    return entry;\n+  }\n@@ -3721,0 +3772,4 @@\n+\n+    if (UseRVVForBigIntegerShiftIntrinsics) {\n+      StubRoutines::_bigIntegerLeftShiftWorker = generate_bigIntegerLeftShift();\n+    }\n","filename":"src\/hotspot\/cpu\/riscv\/stubGenerator_riscv.cpp","additions":55,"deletions":0,"binary":false,"changes":55,"status":"modified"},{"patch":"@@ -170,0 +170,4 @@\n+  if (!UseRVV) {\n+    FLAG_SET_DEFAULT(UseRVVForBigIntegerShiftIntrinsics, false);\n+  }\n+\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}