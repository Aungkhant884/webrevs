{"files":[{"patch":"@@ -35,0 +35,1 @@\n+const char* VM_Version::_uarch = \"\";\n@@ -37,1 +38,3 @@\n-void VM_Version::get_processor_features() {\n+void VM_Version::initialize() {\n+  get_os_cpu_info();\n+\n@@ -120,0 +123,10 @@\n+  char buf[512];\n+  buf[0] = '\\0';\n+  if (_uarch != NULL && strcmp(_uarch, \"\") != 0) snprintf(buf, sizeof(buf), \"%s,\", _uarch);\n+  strcat(buf, \"rv64\");\n+#define ADD_FEATURE_IF_SUPPORTED(id, name, bit) if (_features & CPU_##id) strcat(buf, name);\n+  CPU_FEATURE_FLAGS(ADD_FEATURE_IF_SUPPORTED)\n+#undef ADD_FEATURE_IF_SUPPORTED\n+\n+  _features_string = os::strdup(buf);\n+\n@@ -121,1 +134,1 @@\n-  get_c2_processor_features();\n+  initialize_c2();\n@@ -126,1 +139,1 @@\n-void VM_Version::get_c2_processor_features() {\n+void VM_Version::initialize_c2() {\n@@ -167,5 +180,0 @@\n-void VM_Version::initialize() {\n-  get_cpu_info();\n-  get_processor_features();\n-}\n-\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.cpp","additions":16,"deletions":8,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-  static void get_c2_processor_features();\n+  static void initialize_c2();\n@@ -42,0 +42,1 @@\n+  static const char* _uarch;\n@@ -43,2 +44,1 @@\n-  static void get_processor_features();\n-  static void get_cpu_info();\n+  static void get_os_cpu_info();\n@@ -56,8 +56,8 @@\n-    decl(I,            \"I\",            8)     \\\n-    decl(M,            \"M\",           12)     \\\n-    decl(A,            \"A\",            0)     \\\n-    decl(F,            \"F\",            5)     \\\n-    decl(D,            \"D\",            3)     \\\n-    decl(C,            \"C\",            2)     \\\n-    decl(V,            \"V\",           21)     \\\n-    decl(B,            \"B\",            1)\n+    decl(I,            \"i\",            8)     \\\n+    decl(M,            \"m\",           12)     \\\n+    decl(A,            \"a\",            0)     \\\n+    decl(F,            \"f\",            5)     \\\n+    decl(D,            \"d\",            3)     \\\n+    decl(C,            \"c\",            2)     \\\n+    decl(V,            \"v\",           21)     \\\n+    decl(B,            \"b\",            1)\n","filename":"src\/hotspot\/cpu\/riscv\/vm_version_riscv.hpp","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-void VM_Version::get_cpu_info() {\n+void VM_Version::get_os_cpu_info() {\n@@ -103,0 +103,15 @@\n+\n+  if (FILE *f = fopen(\"\/proc\/cpuinfo\", \"r\")) {\n+    char buf[512], *p;\n+    while (fgets(buf, sizeof (buf), f) != NULL) {\n+      if ((p = strchr(buf, ':')) != NULL) {\n+        if (strncmp(buf, \"uarch\", sizeof \"uarch\" - 1) == 0) {\n+          char* uarch = os::strdup(p + 2);\n+          uarch[strcspn(uarch, \"\\n\")] = '\\0';\n+          _uarch = uarch;\n+          break;\n+        }\n+      }\n+    }\n+    fclose(f);\n+  }\n","filename":"src\/hotspot\/os_cpu\/linux_riscv\/vm_version_linux_riscv.cpp","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"}]}