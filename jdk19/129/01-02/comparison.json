{"files":[{"patch":"@@ -76,1 +76,5 @@\n-  return strncmp(inf.name, TEST_THREAD_NAME_BASE, strlen(TEST_THREAD_NAME_BASE)) == 0;\n+\n+  bool result = strncmp(inf.name, TEST_THREAD_NAME_BASE, strlen(TEST_THREAD_NAME_BASE)) == 0;\n+  jvmti->Deallocate((unsigned char *)inf.name);\n+\n+  return result;\n@@ -181,1 +185,1 @@\n-  RawMonitorLocker arml(jvmti, jni, agent_lock);\n+  RawMonitorLocker rml(jvmti, jni, agent_lock);\n@@ -190,10 +194,12 @@\n-  if (printdump == JNI_TRUE) {\n-    print_current_time();\n-    fflush(0);\n-    LOG(\">>> %sMethod entry\\n>>>\", (isNative == JNI_TRUE) ? \"Native \" : \"\");\n-    printInfo(jni, jvmti, thr, method, frameCount);\n-  }\n-  if (isNative == JNI_FALSE) {\n-    RawMonitorLocker erml(jvmti, jni, event_lock);\n-    push(jni, thr, method, frameCount);\n-    check_jvmti_status(jni, jvmti->NotifyFramePop(thr, 0), \"Error in NotifyFramePop.\");\n+  {\n+    if (printdump == JNI_TRUE) {\n+      print_current_time();\n+      fflush(0);\n+      LOG(\">>> %sMethod entry\\n>>>\", (isNative == JNI_TRUE) ? \"Native \" : \"\");\n+      printInfo(jni, jvmti, thr, method, frameCount);\n+    }\n+    if (isNative == JNI_FALSE) {\n+      RawMonitorLocker rml(jvmti, jni, event_lock);\n+      push(jni, thr, method, frameCount);\n+      check_jvmti_status(jni, jvmti->NotifyFramePop(thr, 0), \"Error in NotifyFramePop.\");\n+    }\n@@ -218,5 +224,1 @@\n-  if (!isTestThread(jni, jvmti, thr)) {\n-    return; \/\/ not a tested thread\n-  }\n-\n-  RawMonitorLocker arml(jvmti, jni, agent_lock);\n+  RawMonitorLocker rml(jvmti, jni, agent_lock);\n@@ -229,5 +231,9 @@\n-  if (printdump == JNI_TRUE) {\n-    print_current_time();\n-    fflush(0);\n-    LOG(\" >>> Frame Pop\\n>>>\");\n-    printInfo(jni, jvmti, thr, method, frameCount);\n+  { \n+    if (printdump == JNI_TRUE) {\n+      print_current_time();\n+      fflush(0);\n+      LOG(\" >>> Frame Pop\\n>>>\");\n+      printInfo(jni, jvmti, thr, method, frameCount);\n+    }\n+    RawMonitorLocker rml(jvmti, jni, event_lock);\n+    pop(jvmti, (JNIEnv *)jni, thr, method, frameCount);\n@@ -235,2 +241,0 @@\n-  RawMonitorLocker erml(jvmti, jni, event_lock);\n-  pop(jvmti, (JNIEnv *)jni, thr, method, frameCount);\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/events\/FramePop\/framepop02\/libframepop02.cpp","additions":28,"deletions":24,"binary":false,"changes":52,"status":"modified"}]}