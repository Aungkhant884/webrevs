{"files":[{"patch":"@@ -428,5 +428,0 @@\n-                    String line = sequence.toString();\n-                    String strippedLine = line.strip();\n-                    int idx = line.indexOf(strippedLine);\n-                    assert idx >= 0; \/\/ because the stripped line is a substring of the line being stripped\n-                    Text whitespace = Text.of(utils.normalizeNewlines(line.substring(0, idx)));\n@@ -436,6 +431,1 @@\n-                        \/\/ If the leading whitespace is not excluded from the link,\n-                        \/\/ browsers might exhibit unwanted behavior. For example, a\n-                        \/\/ browser might display hand-click cursor while user hovers\n-                        \/\/ over that whitespace portion of the line; or use\n-                        \/\/ underline decoration.\n-                        c = new ContentBuilder(whitespace, htmlWriter.linkToContent(element, e, t, strippedLine));\n+                        c = new ContentBuilder(htmlWriter.linkToContent(element, e, t, sequence.toString()));\n@@ -445,1 +435,0 @@\n-                    \/\/ We don't care about trailing whitespace.\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/TagletWriterImpl.java","additions":1,"deletions":12,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8266666\n+ * @bug 8266666 8281969\n@@ -183,1 +183,12 @@\n-                ));\n+                ),\n+                new TestCase(\n+                        \"\"\"\n+                                First line\n+                                  Second line \/\/ @link substring=\" \" target=\"java.lang.System#out\"\n+                                \"\"\",\n+                        replace(\"\"\"\n+                                First line\n+                                link(  )Secondlink( )line\n+                                \"\"\", \"link\\\\((.+?)\\\\)\", r -> link(true, \"java.lang.System#out\", r.group(1)))\n+                )\n+        );\n@@ -578,1 +589,1 @@\n-                                 link(Third line)\n+                                link( Third line)\n@@ -720,10 +731,20 @@\n-        \/\/ The HTML <a> tag generated from the @link snippet markup tag is the\n-        \/\/ same as that of the {@link} Standard doclet tag. This is specified\n-        \/\/ and can be used for comparison and testing.\n-\n-        \/\/ generate documentation for {@link} to grab its HTML <a> tag;\n-        \/\/ generate documentation at low cost and do not interfere with the\n-        \/\/ calling test state; for that, do not create file trees, do not write\n-        \/\/ to std out\/err, and generally try to keep everything in memory\n-\n-        String source = \"\"\"\n+        \/\/ The HTML A element generated for the @link snippet markup tag is\n+        \/\/ the same as that for the similar Standard doclet {@link} tag.\n+        \/\/ This fact can be used for comparison and testing.\n+\n+        \/\/ Generate documentation for {@link} to grab its HTML A element.\n+        \/\/ Generate documentation cheaply and do not interfere with the\n+        \/\/ calling test state; for that: do not create file trees, do not write\n+        \/\/ to std out\/err, and generally try to keep everything in memory.\n+\n+        \/\/ Caveat: a label used in snippet's @link tag can start, end, or both,\n+        \/\/ with whitespace. In this regard, snippet's @link differs from\n+        \/\/ {@link} and {@linkplain} Standard doclet tags, which trim whitespace\n+        \/\/ from labels. In particular, {@link} and {@linkplain} treat\n+        \/\/ whitespace after the reference as an absent label, whereas\n+        \/\/ snippet's @link does not. To avoid whitespace problems,\n+        \/\/ LABEL_PLACEHOLDER is used. It is later substituted with \"content\",\n+        \/\/ which might be an empty or blank string.\n+\n+        var LABEL_PLACEHOLDER = \"label\";\n+        var source = \"\"\"\n@@ -732,1 +753,1 @@\n-                \"\"\".formatted(targetReference, content);\n+                \"\"\".formatted(targetReference, LABEL_PLACEHOLDER);\n@@ -853,2 +874,2 @@\n-            Matcher m = Pattern.compile(\"(?is)<a href=\\\"[^<>]*\\\" title=\\\"[^<>]*\\\" class=\\\"[^<>]*\\\"><code>\"\n-                    + content + \"<\/code><\/a>\").matcher(output);\n+            Matcher m = Pattern.compile(\"(?is)(<a href=\\\"[^<>]*\\\" title=\\\"[^<>]*\\\" class=\\\"[^<>]*\\\"><code>)\"\n+                    +  LABEL_PLACEHOLDER + \"(<\/code><\/a>)\").matcher(output);\n@@ -858,1 +879,1 @@\n-            return m.group(0);\n+            return m.group(1) + content + m.group(2);\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSnippetTag\/TestSnippetMarkup.java","additions":39,"deletions":18,"binary":false,"changes":57,"status":"modified"}]}