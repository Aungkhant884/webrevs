{"files":[{"patch":"@@ -1000,3 +1000,0 @@\n-    Thread* current = Thread::current();\n-    guarantee(current != thread || JavaThread::cast(thread)->is_oop_safe(),\n-              \"current cannot touch oops after its GC barrier is detached.\");\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -797,0 +797,3 @@\n+  Thread* current = Thread::current();\n+  guarantee(current != this || JavaThread::cast(current)->is_oop_safe(),\n+            \"current cannot touch oops after its GC barrier is detached.\");\n@@ -2147,3 +2150,5 @@\n-  oop thread_obj = threadObj();\n-  if (thread_obj != NULL) {\n-    if (java_lang_Thread::is_daemon(thread_obj)) st->print(\" daemon\");\n+  if (is_oop_safe()) {\n+    oop thread_obj = threadObj();\n+    if (thread_obj != NULL) {\n+      if (java_lang_Thread::is_daemon(thread_obj)) st->print(\" daemon\");\n+    }\n@@ -2208,6 +2213,12 @@\n-  oop thread_obj = threadObj();\n-  if (thread_obj != NULL) {\n-    oop name = java_lang_Thread::name(thread_obj);\n-    if (name != NULL) {\n-      if (buf == NULL) {\n-        name_str = java_lang_String::as_utf8_string(name);\n+  if (is_oop_safe()) {\n+    oop thread_obj = threadObj();\n+    if (thread_obj != NULL) {\n+      oop name = java_lang_Thread::name(thread_obj);\n+      if (name != NULL) {\n+        if (buf == NULL) {\n+          name_str = java_lang_String::as_utf8_string(name);\n+        } else {\n+          name_str = java_lang_String::as_utf8_string(name, buf, buflen);\n+        }\n+      } else if (is_attaching_via_jni()) { \/\/ workaround for 6412693 - see 6404306\n+        name_str = \"<no-name - thread is attaching>\";\n@@ -2215,1 +2226,1 @@\n-        name_str = java_lang_String::as_utf8_string(name, buf, buflen);\n+        name_str = \"<un-named>\";\n@@ -2217,2 +2228,0 @@\n-    } else if (is_attaching_via_jni()) { \/\/ workaround for 6412693 - see 6404306\n-      name_str = \"<no-name - thread is attaching>\";\n@@ -2220,1 +2229,1 @@\n-      name_str = \"<un-named>\";\n+      name_str = Thread::name();\n@@ -2223,1 +2232,1 @@\n-    name_str = Thread::name();\n+    name_str = \"<no-name - thread has exited>\";\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":23,"deletions":14,"binary":false,"changes":37,"status":"modified"}]}