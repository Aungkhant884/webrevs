{"files":[{"patch":"@@ -2150,1 +2150,5 @@\n-  if (is_oop_safe()) {\n+  Thread* current = Thread::current_or_null();\n+  if (current != nullptr && (!current->is_Java_thread() || JavaThread::cast(current)->is_oop_safe())) {\n+    \/\/ Only access threadObj() if current thread is attached and\n+    \/\/ if it is not a JavaThread or if it is a JavaThread that can safely\n+    \/\/ access oops.\n@@ -2152,1 +2156,1 @@\n-    if (thread_obj != NULL) {\n+    if (thread_obj != nullptr) {\n@@ -2213,1 +2217,8 @@\n-  if (is_oop_safe()) {\n+  Thread* current = Thread::current_or_null();\n+  if (current == nullptr) {\n+    \/\/ Current thread is not attached so it can't safely determine this\n+    \/\/ JavaThread's name so use the default thread name.\n+    name_str = Thread::name();\n+  } else if (!current->is_Java_thread() || JavaThread::cast(current)->is_oop_safe()) {\n+    \/\/ Only access threadObj() if current thread is not a JavaThread\n+    \/\/ or if it is a JavaThread that can safely access oops.\n@@ -2232,1 +2243,9 @@\n-    name_str = \"<no-name - thread has exited>\";\n+    \/\/ Current JavaThread has exited...\n+    if (current == this) {\n+      \/\/ ... and is asking about itself:\n+      name_str = \"<no-name - current JavaThread has exited>\";\n+    } else {\n+      \/\/ ... and it can't safely determine this JavaThread's name so\n+      \/\/ use the default thread name.\n+      name_str = Thread::name();\n+    }\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":23,"deletions":4,"binary":false,"changes":27,"status":"modified"}]}