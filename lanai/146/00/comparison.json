{"files":[{"patch":"@@ -30,0 +30,1 @@\n+#include <CoreVideo\/CVDisplayLink.h>\n@@ -47,0 +48,1 @@\n+    CVDisplayLinkRef displayLink;\n@@ -57,0 +59,1 @@\n+@property (readwrite, assign) CVDisplayLinkRef displayLink;\n@@ -69,0 +72,1 @@\n+- (void) redraw;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLLayer.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+@synthesize displayLink;\n@@ -73,0 +74,2 @@\n+    CVDisplayLinkCreateWithActiveCGDisplays(&displayLink);\n+    CVDisplayLinkSetOutputCallback(displayLink, &displayLinkCallback, (__bridge void*)self);\n@@ -82,1 +85,1 @@\n-    if (self.nextDrawableCount != 0)\n+    if (self.nextDrawableCount != 0) {\n@@ -84,0 +87,1 @@\n+    }\n@@ -120,0 +124,4 @@\n+    if (CVDisplayLinkIsRunning(self.displayLink))\n+        CVDisplayLinkStop(self.displayLink);\n+    CVDisplayLinkRelease(self.displayLink);\n+    self.displayLink = nil;\n@@ -144,0 +152,15 @@\n+\n+- (void) redraw {\n+    AWT_ASSERT_APPKIT_THREAD;\n+    [self setNeedsDisplay];\n+}\n+\n+CVReturn displayLinkCallback(CVDisplayLinkRef displayLink, const CVTimeStamp* now, const CVTimeStamp* outputTime, CVOptionFlags flagsIn, CVOptionFlags* flagsOut, void* displayLinkContext)\n+{\n+    J2dTraceLn(J2D_TRACE_VERBOSE, \"MTLLayer_displayLinkCallback() called\");\n+    @autoreleasepool {\n+        MTLLayer *layer = (__bridge MTLLayer *)displayLinkContext;\n+        [layer performSelectorOnMainThread:@selector(redraw) withObject:nil waitUntilDone:NO];\n+    }\n+    return kCVReturnSuccess;\n+}\n@@ -190,0 +213,2 @@\n+        if (!CVDisplayLinkIsRunning(layer.displayLink))\n+            CVDisplayLinkStart(layer.displayLink);\n@@ -192,0 +217,2 @@\n+        if (CVDisplayLinkIsRunning(layer.displayLink))\n+            CVDisplayLinkStop(layer.displayLink);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLLayer.m","additions":28,"deletions":1,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -1162,11 +1162,0 @@\n-            BMTLSDOps *dstOps = MTLRenderQueue_GetCurrentDestination();\n-            if (dstOps != NULL) {\n-                MTLSDOps *dstMTLOps = (MTLSDOps *)dstOps->privOps;\n-                MTLLayer *layer = (MTLLayer*)dstMTLOps->layer;\n-                if (layer != NULL) {\n-                    [JNFRunLoop performOnMainThreadWaiting:NO withBlock:^(){\n-                        AWT_ASSERT_APPKIT_THREAD;\n-                        [layer setNeedsDisplay];\n-                    }];\n-                }\n-            }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLRenderQueue.m","additions":0,"deletions":11,"binary":false,"changes":11,"status":"modified"}]}