{"files":[{"patch":"@@ -79,1 +79,2 @@\n-            \/\/ Should never reach here, but still have to check this\n+            \/\/ This indicates fallback to other rendering pipeline also failed.\n+            \/\/ Should never reach here\n@@ -81,1 +82,1 @@\n-            \/\/ Throw exception????\n+            throw new RuntimeException(\"Error - unable to initialize any rendering pipeline.\");\n@@ -330,1 +331,3 @@\n-            System.out.println(\"OpenGL rendering pipeline initialization failed. Using Metal rendering pipeline.\");\n+            if (MacOSFlags.isOGLVerbose()) {\n+                System.out.println(\"OpenGL rendering pipeline initialization failed. Using Metal rendering pipeline.\");\n+            }\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/awt\/CGraphicsDevice.java","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+import sun.java2d.opengl.CGLGraphicsConfig;\n@@ -40,0 +41,2 @@\n+    private static boolean oglEnabled;\n+    private static boolean oglVerbose;\n@@ -43,0 +46,2 @@\n+    private enum PropertyState {ENABLED, DISABLED, UNSPECIFIED};\n+\n@@ -50,1 +55,1 @@\n-    private static boolean getBooleanProp(String p, boolean defaultVal) {\n+    private static PropertyState getBooleanProp(String p, PropertyState defaultVal) {\n@@ -52,1 +57,1 @@\n-        boolean returnVal = defaultVal;\n+        PropertyState returnVal = defaultVal;\n@@ -60,1 +65,1 @@\n-                returnVal = true;\n+                returnVal = PropertyState.ENABLED;\n@@ -66,1 +71,1 @@\n-                returnVal = false;\n+                returnVal = PropertyState.DISABLED;\n@@ -93,6 +98,9 @@\n-                    metalEnabled = getBooleanProp(\"sun.java2d.metal\", false);\n-                    if (metalEnabled) {\n-                        metalVerbose = isBooleanPropTrueVerbose(\"sun.java2d.metal\");\n-\n-                        \/\/ Check whether Metal framework is available on the system\n-                        if (!MTLGraphicsConfig.isMetalAvailable()) {\n+                    PropertyState oglState = getBooleanProp(\"sun.java2d.opengl\", PropertyState.UNSPECIFIED);\n+                    PropertyState metalState = getBooleanProp(\"sun.java2d.metal\", PropertyState.UNSPECIFIED);\n+\n+                    if (metalState == PropertyState.UNSPECIFIED) {\n+                        if (oglState == PropertyState.DISABLED) {\n+                            oglEnabled = false;\n+                            metalEnabled = true;\n+                        } else if (oglState == PropertyState.ENABLED || oglState == PropertyState.UNSPECIFIED) {\n+                            oglEnabled = true;\n@@ -100,0 +108,24 @@\n+                        }\n+                    } else if (metalState == PropertyState.ENABLED) {\n+                        if (oglState == PropertyState.DISABLED || oglState == PropertyState.UNSPECIFIED) {\n+                            oglEnabled = false;\n+                            metalEnabled = true;\n+                        } else if (oglState == PropertyState.ENABLED) {\n+                            oglEnabled = true;\n+                            metalEnabled = false;\n+                        }\n+                    } else if (metalState == PropertyState.DISABLED) {\n+                        oglEnabled = true;\n+                        metalEnabled = false;\n+                    }\n+\n+                    oglVerbose = isBooleanPropTrueVerbose(\"sun.java2d.opengl\");\n+                    metalVerbose = isBooleanPropTrueVerbose(\"sun.java2d.metal\");\n+\n+                    boolean oglAvailable = CGLGraphicsConfig.isCGLAvailable();\n+                    boolean metalAvailable = MTLGraphicsConfig.isMetalAvailable();\n+\n+                    if (!oglAvailable && !metalAvailable) {\n+                        \/\/ Should never reach here\n+                        throw new RuntimeException(\"Error - Both, OpenGL and Metal frameworks not available.\");\n+                    }\n@@ -101,0 +133,12 @@\n+                    if (oglEnabled && !metalEnabled) {\n+                        \/\/ Check whether OGL is available\n+                        if (!oglAvailable) {\n+                            if (oglVerbose) {\n+                                System.out.println(\"Could not enable OpenGL pipeline (CGL not available)\");\n+                            }\n+                            oglEnabled = false;\n+                            metalEnabled = metalAvailable;\n+                        }\n+                    } else if (metalEnabled && !oglEnabled) {\n+                        \/\/ Check whether Metal framework is available\n+                        if (!metalAvailable) {\n@@ -104,0 +148,2 @@\n+                            metalEnabled = false;\n+                            oglEnabled = oglAvailable;\n@@ -106,0 +152,6 @@\n+\n+                    \/\/ At this point one of the rendering pipeline must be enabled.\n+                    if (!metalEnabled && !oglEnabled) {\n+                        throw new RuntimeException(\"Error - unable to initialize any rendering pipeline.\");\n+                    }\n+\n@@ -117,0 +169,8 @@\n+\n+    public static boolean isOGLEnabled() {\n+        return oglEnabled;\n+    }\n+\n+    public static boolean isOGLVerbose() {\n+        return oglVerbose;\n+    }\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/java2d\/macos\/MacOSFlags.java","additions":70,"deletions":10,"binary":false,"changes":80,"status":"modified"}]}