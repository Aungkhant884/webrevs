{"files":[{"patch":"@@ -93,2 +93,2 @@\n-\n-    MTLVertexCache_EnableMaskCache(mtlc, dstOps);\n+    if (mtlc == nil) return;\n+    CHECK_PREVIOUS_OP(MTL_OP_MASK_OP);\n@@ -119,2 +119,0 @@\n-\n-    MTLVertexCache_DisableMaskCache(mtlc);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLMaskFill.m","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -53,0 +53,1 @@\n+  MTL_OP_MASK_OP,\n@@ -55,1 +56,1 @@\n-\n+void MTLRenderQueue_CheckPreviousOp(jint op);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLRenderQueue.h","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -318,3 +318,0 @@\n-    J2dTraceLn1(J2D_TRACE_VERBOSE,\n-                \"MTLRenderQueue_CheckPreviousOp: new op=%d\", op);\n-\n@@ -322,4 +319,5 @@\n-        return; \/\/ SET_COLOR should not cause endEncoder\n-    }\n-\n-    if (mtlPreviousOp == MTL_OP_INIT) {\n+        if (mtlPreviousOp != MTL_OP_MASK_OP) {\n+            return; \/\/ SET_COLOR should not cause endEncoder\n+        }\n+    } else if (op == MTL_OP_MASK_OP) {\n+        MTLVertexCache_EnableMaskCache(mtlc, dstOps);\n@@ -330,0 +328,12 @@\n+    J2dTraceLn1(J2D_TRACE_VERBOSE,\n+                \"MTLRenderQueue_CheckPreviousOp: new op=%d\", op);\n+\n+    switch (mtlPreviousOp) {\n+        case MTL_OP_INIT :\n+            mtlPreviousOp = op;\n+            return;\n+        case MTL_OP_MASK_OP :\n+            MTLVertexCache_DisableMaskCache(mtlc);\n+            break;\n+    }\n+\n@@ -714,1 +724,0 @@\n-                    CHECK_PREVIOUS_OP(MTL_OP_OTHER);\n@@ -1140,0 +1149,3 @@\n+            if (mtlPreviousOp == MTL_OP_MASK_OP) {\n+                MTLVertexCache_DisableMaskCache(mtlc);\n+            }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLRenderQueue.m","additions":20,"deletions":8,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -242,5 +242,0 @@\n-    if (maskCacheTex != nil) {\n-        [[mtlc getCommandBufferWrapper] registerPooledTexture:maskCacheTex];\n-        [maskCacheTex release];\n-        maskCacheTex = nil;\n-    }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLVertexCache.m","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"}]}