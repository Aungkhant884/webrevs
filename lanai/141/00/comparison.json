{"files":[{"patch":"@@ -254,0 +254,10 @@\n+fragment half4 frag_text(\n+        TxtShaderInOut vert [[stage_in]],\n+        texture2d<float, access::sample> renderTexture [[texture(0)]],\n+        constant TxtFrameUniforms& uniforms [[buffer(1)]],\n+        sampler textureSampler [[sampler(0)]]\n+) {\n+    float4 pixelColor = renderTexture.sample(textureSampler, vert.texCoords);\n+    return half4(uniforms.color * pixelColor.a);\n+}\n+\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/shaders.metal","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -57,0 +57,3 @@\n+- (id<MTLRenderCommandEncoder> _Nonnull)getTextEncoder:(const BMTLSDOps * _Nonnull)dstOps\n+                                      isSrcOpaque:(bool)isSrcOpaque;\n+\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/EncoderManager.h","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -21,1 +21,2 @@\n-                  isAA:(jboolean)isAA;\n+                  isAA:(jboolean)isAA\n+                  isText:(jboolean)isText;\n@@ -28,0 +29,1 @@\n+@property (assign) jboolean text;\n@@ -40,0 +42,1 @@\n+    jboolean _isText;\n@@ -63,0 +66,1 @@\n+@synthesize text = _isText;\n@@ -92,1 +96,2 @@\n-                  isAA:(jboolean)isAA {\n+                  isAA:(jboolean)isAA\n+                  isText:(jboolean)isText {\n@@ -97,0 +102,1 @@\n+    _isText = isText;\n@@ -144,0 +150,1 @@\n+        && _isText == renderOptions->isText\n@@ -152,0 +159,1 @@\n+    _isText = renderOptions->isText;\n@@ -245,1 +253,1 @@\n-  RenderOptions roptions = {JNI_FALSE, JNI_TRUE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {dstOps->isOpaque, JNI_TRUE}};\n+  RenderOptions roptions = {JNI_FALSE, JNI_TRUE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {dstOps->isOpaque, JNI_TRUE}, JNI_FALSE};\n@@ -252,1 +260,1 @@\n-    RenderOptions roptions = {JNI_FALSE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {isOpaque, JNI_TRUE}};\n+    RenderOptions roptions = {JNI_FALSE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {isOpaque, JNI_TRUE}, JNI_FALSE};\n@@ -282,1 +290,1 @@\n-    RenderOptions roptions = {JNI_TRUE, isAA, interpolation, { isSrcOpaque, JNI_TRUE }, {isDstOpaque, JNI_TRUE}};\n+    RenderOptions roptions = {JNI_TRUE, isAA, interpolation, { isSrcOpaque, JNI_TRUE }, {isDstOpaque, JNI_TRUE}, JNI_FALSE};\n@@ -294,0 +302,7 @@\n+- (id<MTLRenderCommandEncoder> _Nonnull) getTextEncoder:(const BMTLSDOps * _Nonnull)dstOps\n+                                      isSrcOpaque:(bool)isSrcOpaque\n+{\n+    RenderOptions roptions = {JNI_TRUE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, { isSrcOpaque, JNI_TRUE }, {dstOps->isOpaque, JNI_TRUE}, JNI_TRUE};\n+    return [self getEncoder:dstOps->pTexture renderOptions:&roptions];\n+}\n+\n@@ -361,1 +376,2 @@\n-                      isAA:renderOptions->isAA];\n+                      isAA:renderOptions->isAA\n+                      isText:renderOptions->isText];\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/EncoderManager.m","additions":22,"deletions":6,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -164,0 +164,3 @@\n+        if (renderOptions->isText) {\n+            fragShader = @\"frag_text\";\n+        }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLPaints.m","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-    RenderOptions defaultOptions = {JNI_FALSE, JNI_FALSE, 0\/*unused*\/, {JNI_FALSE, JNI_TRUE}, {JNI_FALSE, JNI_TRUE}};\n+    RenderOptions defaultOptions = {JNI_FALSE, JNI_FALSE, 0\/*unused*\/, {JNI_FALSE, JNI_TRUE}, {JNI_FALSE, JNI_TRUE}, JNI_FALSE};\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLPipelineStatesStorage.m","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -135,1 +135,2 @@\n-    MTLPixelFormat pixelFormat = MTLPixelFormatBGRA8Unorm;\n+    MTLPixelFormat pixelFormat =\n+        lcdCache ? MTLPixelFormatBGRA8Unorm : MTLPixelFormatA8Unorm;\n@@ -223,21 +224,1 @@\n-            \/\/ Opengl uses GL_INTENSITY as internal pixel format to set number of\n-            \/\/ color components in the texture for grayscale texture.\n-            \/\/ It is mentioned that for GL_INTENSITY format,\n-            \/\/ the GL assembles it into an RGBA element by replicating the\n-            \/\/ intensity value three times for red, green, blue, and alpha.\n-            \/\/ To let metal behave the same for grayscale text,\n-            \/\/ we need to make sure we create BGRA component by replicating\n-            \/\/ graycale pixel value as in R=G=B=A=grayscale pixel value\n-\n-            unsigned int imageBytes = w * h * 4;\n-            unsigned char imageData[imageBytes];\n-            memset(&imageData, 0, sizeof(imageData));\n-\n-            unsigned int dstindex = 0;\n-            for (int i = 0; i < (w * h); i++) {\n-                imageData[dstindex++] = glyph->image[i];\n-                imageData[dstindex++] = glyph->image[i];\n-                imageData[dstindex++] = glyph->image[i];\n-                imageData[dstindex++] = glyph->image[i];\n-            }\n-            NSUInteger bytesPerRow = 4 * w;\n+            NSUInteger bytesPerRow = 1 * w;\n@@ -246,1 +227,1 @@\n-                             withBytes:imageData\n+                             withBytes:glyph->image\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLTextRenderer.m","additions":4,"deletions":23,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -250,1 +250,3 @@\n-    encoder = [mtlc.encoderManager getTextureEncoder:dstOps isSrcOpaque:NO];\n+    \/\/encoder = [mtlc.encoderManager getTextureEncoder:dstOps isSrcOpaque:NO];\n+    encoder = [mtlc.encoderManager getTextEncoder:dstOps\n+                                         isSrcOpaque:NO];\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLVertexCache.m","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -14,0 +14,1 @@\n+    jboolean isText;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/RenderOptions.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}