{"files":[{"patch":"@@ -62,0 +62,2 @@\n+- (id<MTLRenderCommandEncoder> _Nonnull)getAAShaderRenderEncoder:(const BMTLSDOps * _Nonnull)dstOps;\n+\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/EncoderManager.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -57,0 +57,1 @@\n+@property (assign) jboolean aaShader;\n@@ -71,0 +72,1 @@\n+    jboolean _isAAShader;\n@@ -96,0 +98,1 @@\n+@synthesize aaShader = _isAAShader;\n@@ -181,0 +184,1 @@\n+        && _isAAShader == renderOptions->isAAShader\n@@ -191,0 +195,1 @@\n+    _isAAShader = renderOptions->isAAShader;\n@@ -286,1 +291,1 @@\n-  RenderOptions roptions = {JNI_FALSE, JNI_TRUE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {dstOps->isOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE};\n+  RenderOptions roptions = {JNI_FALSE, JNI_TRUE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {dstOps->isOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE, JNI_FALSE};\n@@ -290,0 +295,6 @@\n+- (id<MTLRenderCommandEncoder> _Nonnull)getAAShaderRenderEncoder:(const BMTLSDOps * _Nonnull)dstOps\n+{\n+    RenderOptions roptions = {JNI_FALSE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {dstOps->isOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE, JNI_TRUE};\n+    return [self getEncoder:dstOps->pTexture renderOptions:&roptions];\n+}\n+\n@@ -293,1 +304,1 @@\n-    RenderOptions roptions = {JNI_FALSE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {isOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE};\n+    RenderOptions roptions = {JNI_FALSE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, defaultRasterFlags, {isOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE, JNI_FALSE};\n@@ -321,1 +332,1 @@\n-    RenderOptions roptions = {JNI_TRUE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, {isSrcOpaque, JNI_TRUE }, {isDstOpaque, JNI_TRUE}, JNI_FALSE, JNI_TRUE};\n+    RenderOptions roptions = {JNI_TRUE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, {isSrcOpaque, JNI_TRUE }, {isDstOpaque, JNI_TRUE}, JNI_FALSE, JNI_TRUE, JNI_FALSE};\n@@ -331,1 +342,1 @@\n-    RenderOptions roptions = {JNI_TRUE, isAA, interpolation, { isSrcOpaque, JNI_TRUE }, {isDstOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE};\n+    RenderOptions roptions = {JNI_TRUE, isAA, interpolation, { isSrcOpaque, JNI_TRUE }, {isDstOpaque, JNI_TRUE}, JNI_FALSE, JNI_FALSE, JNI_FALSE};\n@@ -346,1 +357,1 @@\n-    RenderOptions roptions = {JNI_TRUE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, { isSrcOpaque, JNI_TRUE }, {dstOps->isOpaque, JNI_TRUE}, JNI_TRUE, JNI_FALSE};\n+    RenderOptions roptions = {JNI_TRUE, JNI_FALSE, INTERPOLATION_NEAREST_NEIGHBOR, { isSrcOpaque, JNI_TRUE }, {dstOps->isOpaque, JNI_TRUE}, JNI_TRUE, JNI_FALSE, JNI_FALSE};\n@@ -358,1 +369,2 @@\n-    if (_destination != dest || renderOptions->isAA != _encoderStates.aa) {\n+    if (_destination != dest || renderOptions->isAA != _encoderStates.aa ||\n+            renderOptions->isAAShader != _encoderStates.aaShader) {\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/EncoderManager.m","additions":18,"deletions":6,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -56,0 +56,1 @@\n+static MTLRenderPipelineDescriptor * templateAAPipelineDesc = nil;\n@@ -108,0 +109,27 @@\n+\n+    vertDesc = [[MTLVertexDescriptor new] autorelease];\n+    vertDesc.attributes[VertexAttributePosition].format = MTLVertexFormatFloat2;\n+    vertDesc.attributes[VertexAttributePosition].offset = 0;\n+    vertDesc.attributes[VertexAttributePosition].bufferIndex = MeshVertexBuffer;\n+    vertDesc.layouts[MeshVertexBuffer].stride = sizeof(struct AAVertex);\n+    vertDesc.layouts[MeshVertexBuffer].stepRate = 1;\n+    vertDesc.layouts[MeshVertexBuffer].stepFunction = MTLVertexStepFunctionPerVertex;\n+\n+    templateAAPipelineDesc = [MTLRenderPipelineDescriptor new];\n+    templateAAPipelineDesc.sampleCount = 1;\n+    templateAAPipelineDesc.vertexDescriptor = vertDesc;\n+    templateAAPipelineDesc.colorAttachments[0].pixelFormat = MTLPixelFormatBGRA8Unorm;\n+    templateAAPipelineDesc.colorAttachments[0].rgbBlendOperation =   MTLBlendOperationAdd;\n+    templateAAPipelineDesc.colorAttachments[0].alphaBlendOperation = MTLBlendOperationAdd;\n+    templateAAPipelineDesc.colorAttachments[0].sourceRGBBlendFactor = MTLBlendFactorOne;\n+    templateAAPipelineDesc.colorAttachments[0].sourceAlphaBlendFactor = MTLBlendFactorOne;\n+    templateAAPipelineDesc.colorAttachments[0].destinationRGBBlendFactor = MTLBlendFactorOneMinusSourceAlpha;\n+    templateAAPipelineDesc.colorAttachments[0].destinationAlphaBlendFactor = MTLBlendFactorOneMinusSourceAlpha;\n+    templateAAPipelineDesc.colorAttachments[0].blendingEnabled = YES;\n+    templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeTexPos].format = MTLVertexFormatFloat2;\n+    templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeTexPos].offset = 2*sizeof(float);\n+    templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeTexPos].bufferIndex = MeshVertexBuffer;\n+    templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeITexPos].format = MTLVertexFormatFloat2;\n+    templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeITexPos].offset = 4*sizeof(float);\n+    templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeITexPos].bufferIndex = MeshVertexBuffer;\n+    templateAAPipelineDesc.label = @\"template_aa\";\n@@ -183,0 +211,4 @@\n+    } else if (renderOptions->isAAShader) {\n+        vertShader = @\"vert_col_aa\";\n+        fragShader = @\"frag_col_aa\";\n+        rpDesc = [[templateAAPipelineDesc copy] autorelease];\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLPaints.m","additions":32,"deletions":0,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -87,1 +87,1 @@\n-    RenderOptions defaultOptions = {JNI_FALSE, JNI_FALSE, 0\/*unused*\/, {JNI_FALSE, JNI_TRUE}, {JNI_FALSE, JNI_TRUE}, JNI_FALSE, JNI_FALSE};\n+    RenderOptions defaultOptions = {JNI_FALSE, JNI_FALSE, 0\/*unused*\/, {JNI_FALSE, JNI_TRUE}, {JNI_FALSE, JNI_TRUE}, JNI_FALSE, JNI_FALSE, JNI_FALSE};\n@@ -101,1 +101,1 @@\n-    RenderOptions defaultOptions = {JNI_FALSE, JNI_FALSE, 0\/*unused*\/, {JNI_FALSE, JNI_TRUE}, {JNI_FALSE, JNI_TRUE}, JNI_FALSE, JNI_FALSE};\n+    RenderOptions defaultOptions = {JNI_FALSE, JNI_FALSE, 0\/*unused*\/, {JNI_FALSE, JNI_TRUE}, {JNI_FALSE, JNI_TRUE}, JNI_FALSE, JNI_FALSE, JNI_FALSE};\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLPipelineStatesStorage.m","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -734,49 +734,0 @@\n-static MTLRenderPipelineDescriptor * templateAAPipelineDesc = nil;\n-\n-static jboolean\n-setupAAShaderState(id<MTLRenderCommandEncoder> encoder,\n-                    MTLContext *mtlc,\n-                    MTLSDOps *dstOps)\n-{\n-    if (templateAAPipelineDesc == nil) {\n-\n-        MTLVertexDescriptor *vertDesc = [[MTLVertexDescriptor new] autorelease];\n-        vertDesc.attributes[VertexAttributePosition].format = MTLVertexFormatFloat2;\n-        vertDesc.attributes[VertexAttributePosition].offset = 0;\n-        vertDesc.attributes[VertexAttributePosition].bufferIndex = MeshVertexBuffer;\n-        vertDesc.layouts[MeshVertexBuffer].stride = sizeof(struct AAVertex);\n-        vertDesc.layouts[MeshVertexBuffer].stepRate = 1;\n-        vertDesc.layouts[MeshVertexBuffer].stepFunction = MTLVertexStepFunctionPerVertex;\n-\n-        templateAAPipelineDesc = [MTLRenderPipelineDescriptor new];\n-        templateAAPipelineDesc.sampleCount = 1;\n-        templateAAPipelineDesc.vertexDescriptor = vertDesc;\n-        templateAAPipelineDesc.colorAttachments[0].pixelFormat = MTLPixelFormatBGRA8Unorm;\n-        templateAAPipelineDesc.colorAttachments[0].rgbBlendOperation =   MTLBlendOperationAdd;\n-        templateAAPipelineDesc.colorAttachments[0].alphaBlendOperation = MTLBlendOperationAdd;\n-        templateAAPipelineDesc.colorAttachments[0].sourceRGBBlendFactor = MTLBlendFactorOne;\n-        templateAAPipelineDesc.colorAttachments[0].sourceAlphaBlendFactor = MTLBlendFactorOne;\n-        templateAAPipelineDesc.colorAttachments[0].destinationRGBBlendFactor = MTLBlendFactorOneMinusSourceAlpha;\n-        templateAAPipelineDesc.colorAttachments[0].destinationAlphaBlendFactor = MTLBlendFactorOneMinusSourceAlpha;\n-        templateAAPipelineDesc.colorAttachments[0].blendingEnabled = YES;\n-        templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeTexPos].format = MTLVertexFormatFloat2;\n-        templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeTexPos].offset = 2*sizeof(float);\n-        templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeTexPos].bufferIndex = MeshVertexBuffer;\n-        templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeITexPos].format = MTLVertexFormatFloat2;\n-        templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeITexPos].offset = 4*sizeof(float);\n-        templateAAPipelineDesc.vertexDescriptor.attributes[VertexAttributeITexPos].bufferIndex = MeshVertexBuffer;\n-        templateAAPipelineDesc.label = @\"template_aa\";\n-    }\n-\n-    id<MTLRenderPipelineState> pipelineState =\n-                [mtlc.pipelineStateStorage\n-                    getPipelineState:templateAAPipelineDesc\n-                      vertexShaderId:@\"vert_col_aa\"\n-                    fragmentShaderId:@\"frag_col_aa\"\n-                       stencilNeeded:mtlc.clip.isShape\n-                   ];\n-\n-    [encoder setRenderPipelineState:pipelineState];\n-    return JNI_TRUE;\n-}\n-\n@@ -874,2 +825,1 @@\n-        [mtlc.encoderManager getRenderEncoder:dstOps];\n-    setupAAShaderState(encoder, mtlc, dstOps);\n+        [mtlc.encoderManager getAAShaderRenderEncoder:dstOps];\n@@ -938,2 +888,1 @@\n-        [mtlc.encoderManager getRenderEncoder:dstOps];\n-    setupAAShaderState(encoder, mtlc, dstOps);\n+        [mtlc.encoderManager getAAShaderRenderEncoder:dstOps];\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLRenderer.m","additions":2,"deletions":53,"binary":false,"changes":55,"status":"modified"},{"patch":"@@ -41,0 +41,1 @@\n+    jboolean isAAShader;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/RenderOptions.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}