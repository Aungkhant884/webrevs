{"files":[{"patch":"@@ -72,1 +72,0 @@\n-        boolean globalProfiler = JDKVersion.parseMajor(System.getProperty(\"java.version\")) >= 21;\n@@ -76,1 +75,1 @@\n-        if (globalProfiler && (Math.abs(1 - allocRateNormB \/ SIZE) > 0.01)) {\n+        if (accurateProfiler() && (Math.abs(1 - allocRateNormB \/ SIZE) > 0.01)) {\n@@ -78,2 +77,0 @@\n-        } else {\n-            System.out.println(msg);\n@@ -81,0 +78,17 @@\n+\n+        System.out.println(msg);\n+    }\n+\n+    private boolean accurateProfiler() {\n+        \/\/ Change to this version-sensing code after JDK 21 releases:\n+        \/\/ return JDKVersion.parseMajor(System.getProperty(\"java.version\")) >= 21;\n+\n+        \/\/ Try to sense the existence of the accurate method:\n+        try {\n+            Class.forName(\"com.sun.management.ThreadMXBean\").getMethod(\"getTotalThreadAllocatedBytes\");\n+            return true;\n+        } catch (Exception e) {\n+            \/\/ Fall through\n+        }\n+\n+        return false;\n","filename":"jmh-core-it\/src\/test\/java\/org\/openjdk\/jmh\/it\/profilers\/GCProfilerSeparateThreadTest.java","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"}]}