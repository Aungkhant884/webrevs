{"files":[{"patch":"@@ -305,0 +305,3 @@\n+                    boolean svg = svgFlamegraphs(execute(\"version\"));\n+                    String ext = svg ? \"svg\" : \"html\";\n+                    String type = svg ? \"svg\" : \"flamegraph\";\n@@ -306,1 +309,1 @@\n-                        dump(trialOutDir, \"flame-%s-forward.svg\", \"svg\");\n+                        dump(trialOutDir, \"flame-%s-forward.\" + ext, type);\n@@ -309,1 +312,1 @@\n-                        dump(trialOutDir, \"flame-%s-reverse.svg\", \"svg,reverse\");\n+                        dump(trialOutDir, \"flame-%s-reverse.\" + ext, type + \",reverse\");\n@@ -344,0 +347,47 @@\n+    static boolean svgFlamegraphs(String ver) {\n+        \/\/ The last SVG-enabled version is 1.8.4\n+        \/\/ The first HTML-enabled version in 1.8.5\n+\n+        if (ver.startsWith(\"1\")) {\n+            String[] split = ver.split(\"\\\\.\");\n+            if (split.length < 2) {\n+                \/\/ Um, pretend it is one of old 1.x\n+                return true;\n+            }\n+\n+            int minor;\n+            try {\n+                minor = Integer.parseInt(split[1]);\n+            } catch (NumberFormatException e) {\n+                \/\/ Pretend it is one of old 1.x\n+                return true;\n+            }\n+\n+            if (minor < 8) {\n+                return true;\n+            }\n+\n+            if (minor > 8) {\n+                return false;\n+            }\n+\n+            if (split.length < 3) {\n+                \/\/ Pretend it is old 1.8\n+                return true;\n+            }\n+\n+            int patch;\n+            try {\n+                patch = Integer.parseInt(split[2]);\n+            } catch (NumberFormatException e) {\n+                \/\/ Pretend it is still one of old 1.8.x\n+                return true;\n+            }\n+\n+            return patch <= 4;\n+        } else {\n+            \/\/ Assume all other versions are HTML-enabled\n+            return false;\n+        }\n+    }\n+\n","filename":"jmh-core\/src\/main\/java\/org\/openjdk\/jmh\/profile\/AsyncProfiler.java","additions":52,"deletions":2,"binary":false,"changes":54,"status":"modified"},{"patch":"@@ -0,0 +1,48 @@\n+\/*\n+ * Copyright (c) 2021, Red Hat, Inc. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.jmh.profile;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class AsyncProfilerTest {\n+\n+    @Test\n+    public void testSvgGraphs() {\n+        Assert.assertTrue(AsyncProfiler.svgFlamegraphs(\"1.rc1\"));\n+        Assert.assertTrue(AsyncProfiler.svgFlamegraphs(\"1.0\"));\n+        Assert.assertTrue(AsyncProfiler.svgFlamegraphs(\"1.2\"));\n+        Assert.assertTrue(AsyncProfiler.svgFlamegraphs(\"1.8\"));\n+        Assert.assertTrue(AsyncProfiler.svgFlamegraphs(\"1.8.rc1\"));\n+        Assert.assertTrue(AsyncProfiler.svgFlamegraphs(\"1.8.4\"));\n+\n+        Assert.assertFalse(AsyncProfiler.svgFlamegraphs(\"1.8.5\"));\n+        Assert.assertFalse(AsyncProfiler.svgFlamegraphs(\"1.9\"));\n+        Assert.assertFalse(AsyncProfiler.svgFlamegraphs(\"2.0\"));\n+        Assert.assertFalse(AsyncProfiler.svgFlamegraphs(\"2.1\"));\n+        Assert.assertFalse(AsyncProfiler.svgFlamegraphs(\"3.0\"));\n+    }\n+\n+}\n","filename":"jmh-core\/src\/test\/java\/org\/openjdk\/jmh\/profile\/AsyncProfilerTest.java","additions":48,"deletions":0,"binary":false,"changes":48,"status":"added"}]}