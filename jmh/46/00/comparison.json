{"files":[{"patch":"@@ -37,0 +37,1 @@\n+import org.openjdk.jmh.util.JDKVersion;\n@@ -112,0 +113,6 @@\n+        Collection<String> result = new ArrayList<>();\n+\n+        if (!annProc) {\n+            result.add(\"-proc:none\");\n+        }\n+\n@@ -113,6 +120,4 @@\n-        if (klass.equals(SwingTest.class)) {\n-            if (annProc) {\n-                return Collections.emptyList();\n-            } else {\n-                return Collections.singleton(\"-proc:none\");\n-            }\n+        boolean noWerror = klass.equals(SwingTest.class);\n+\n+        if (!noWerror) {\n+            result.add(\"-Werror\");\n@@ -123,9 +128,3 @@\n-        if (klass.equals(GenericReturnTest.class) ||\n-            klass.equals(PublicStaticBenchmarkTest.class) ||\n-            klass.equals(PublicSynchronizedStaticBenchmarkStateBenchmarkTest.class)) {\n-            if (annProc) {\n-                return Arrays.asList(\"-Xlint:all,-processing,-static\", \"-Werror\");\n-            } else {\n-                return Arrays.asList(\"-proc:none\", \"-Xlint:all,-static\", \"-Werror\");\n-            }\n-        }\n+        boolean noStatic = klass.equals(GenericReturnTest.class) ||\n+                klass.equals(PublicStaticBenchmarkTest.class) ||\n+                klass.equals(PublicSynchronizedStaticBenchmarkStateBenchmarkTest.class);\n@@ -133,6 +132,9 @@\n-        \/\/ Regular tests should compile with full lint and Werror.\n-        if (annProc) {\n-            return Arrays.asList(\"-Xlint:all,-processing\", \"-Werror\");\n-        } else {\n-            return Arrays.asList(\"-proc:none\", \"-Xlint:all\", \"-Werror\");\n-        }\n+        \/\/ JDK 17 introduces a new warning about unnecessary strictfp use.\n+        boolean noStrictFPChecks = JDKVersion.parseMajor(System.getProperty(\"java.version\")) >= 17;\n+\n+        result.add(\"-Xlint:all\" +\n+                      (annProc ? \",-processing\" : \"\") +\n+                      (noStatic ? \",-static\" : \"\") +\n+                      (noStrictFPChecks ? \",-strictfp\" : \"\"));\n+\n+        return result;\n","filename":"jmh-core-ct\/src\/test\/java\/org\/openjdk\/jmh\/ct\/CompileTest.java","additions":23,"deletions":21,"binary":false,"changes":44,"status":"modified"}]}