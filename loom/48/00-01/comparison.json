{"files":[{"patch":"@@ -529,1 +529,0 @@\n-  JavaThread* const _current;  \/\/ Current thread\n@@ -541,0 +540,2 @@\n+  bool  _is_preempt;\n+\n@@ -550,1 +551,1 @@\n-  ContMirror(JavaThread* current, JavaThread* thread, oop cont);\n+  ContMirror(JavaThread* thread, oop cont, bool is_preempt = false);\n@@ -693,2 +694,2 @@\n-ContMirror::ContMirror(JavaThread* current, JavaThread* thread, oop cont)\n- : _current(current), _thread(thread), _entry(thread->last_continuation()), _cont(cont),\n+ContMirror::ContMirror(JavaThread* thread, oop cont, bool is_preempt)\n+ : _thread(thread), _entry(thread->last_continuation()), _cont(cont),\n@@ -698,1 +699,2 @@\n-  _e_size(0) {\n+  _e_size(0),\n+  _is_preempt(is_preempt) {\n@@ -700,1 +702,0 @@\n-  assert(current == JavaThread::current(), \"should be\");\n@@ -707,1 +708,1 @@\n- : _current(nullptr), _thread(nullptr), _entry(nullptr), _cont(cont),\n+ : _thread(nullptr), _entry(nullptr), _cont(cont),\n@@ -718,2 +719,1 @@\n- : _current(nullptr),\n-   _thread(map->thread()),\n+ : _thread(map->thread()),\n@@ -1870,1 +1870,1 @@\n-  ContMirror cont(preempt ? JavaThread::current() : current, current, oopCont);\n+  ContMirror cont(current, oopCont, preempt);\n@@ -2784,1 +2784,1 @@\n-  ContMirror cont(thread, thread, oopCont);\n+  ContMirror cont(thread, oopCont);\n@@ -3187,1 +3187,2 @@\n-  assert(_current == JavaThread::current(), \"should be current\");\n+  assert(_is_preempt || _thread == JavaThread::current(), \"should be current\");\n+  JavaThread* current = _is_preempt ? JavaThread::current() : _thread;\n@@ -3190,1 +3191,1 @@\n-  HeapWord* start = _current->tlab().allocate(size_in_words);\n+  HeapWord* start = current->tlab().allocate(size_in_words);\n@@ -3195,2 +3196,2 @@\n-  \/\/HandleMark hm(_current);\n-  Handle conth(_current, _cont);\n+  \/\/HandleMark hm(current);\n+  Handle conth(current, _cont);\n","filename":"src\/hotspot\/share\/runtime\/continuation.cpp","additions":16,"deletions":15,"binary":false,"changes":31,"status":"modified"}]}