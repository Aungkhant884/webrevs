{"files":[{"patch":"@@ -305,1 +305,2 @@\n-com.sun.management.jmxremote.serial.filter.pattern=java.lang.*;java.math.BigInteger;java.math.BigDecimal;java.util.*;javax.management.openmbean.*;javax.management.ObjectName;java.rmi.MarshalledObject;javax.security.auth.Subject;!*\n+com.sun.management.jmxremote.serial.filter.pattern=java.lang.*;java.math.BigInteger;java.math.BigDecimal;java.util.*;\\\n+javax.management.*;javax.management.openmbean.*;java.rmi.MarshalledObject;javax.security.auth.Subject;!*\n","filename":"src\/jdk.management.agent\/share\/conf\/management.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8159377 8283093\n+ * @bug 8159377 8283093 8299891\n@@ -51,0 +51,1 @@\n+import java.util.Set;\n@@ -52,0 +53,2 @@\n+import javax.management.Attribute;\n+import javax.management.AttributeList;\n@@ -54,0 +57,3 @@\n+import javax.management.ObjectInstance;\n+import javax.management.Query;\n+import javax.management.QueryExp;\n@@ -76,0 +82,8 @@\n+\n+        public void setMyAttribute(boolean b);\n+\n+        public boolean getMyAttribute();\n+\n+        public void setMyAttribute2(String s);\n+\n+        public String getMyAttribute2();\n@@ -80,0 +94,3 @@\n+        boolean myAttribute;\n+        String myAttribute2;\n+\n@@ -94,0 +111,20 @@\n+\n+        public void setMyAttribute(boolean b) {\n+            this.myAttribute = b;\n+            System.out.println(\"Invoked setMyAttribute\");\n+        }\n+\n+        public boolean getMyAttribute() {\n+            System.out.println(\"Invoked getMyAttribute\");\n+            return myAttribute;\n+        }\n+\n+        public void setMyAttribute2(String s) {\n+            this.myAttribute2 = s;\n+            System.out.println(\"Invoked setMyAttribute2\");\n+        }\n+\n+        public String getMyAttribute2() {\n+            System.out.println(\"Invoked getMyAttribute2\");\n+            return myAttribute2;\n+        }\n@@ -175,1 +212,5 @@\n-        testDefaultAgent(propertyFile, null);\n+        testDefaultAgent(propertyFile, null, true \/* test operations *\/);\n+    }\n+\n+    private static void testDefaultAgent(String propertyFile, boolean testOperations) throws Exception {\n+        testDefaultAgent(propertyFile, null, testOperations);\n@@ -178,1 +219,1 @@\n-    private static void testDefaultAgent(String propertyFile, String additionalArgument) throws Exception {\n+    private static void testDefaultAgent(String propertyFile, String additionalArgument, boolean testOperations) throws Exception {\n@@ -185,1 +226,1 @@\n-                testDefaultAgent(propertyFile, additionalArgument, port);\n+                testDefaultAgent(propertyFile, additionalArgument, port, testOperations);\n@@ -196,1 +237,5 @@\n-    private static void testDefaultAgent(String propertyFile, String additionalArgument, int port) throws Exception {\n+    \/**\n+      * Run the test app and connect. Test MBean Operations if the boolean testOperations is true, otherwise\n+      * test other usages (Attributes, Query)\n+      *\/\n+    private static void testDefaultAgent(String propertyFile, String additionalArgument, int port, boolean testOperations) throws Exception {\n@@ -222,1 +267,5 @@\n-            testMBeanOperations(url);\n+            if (testOperations) {\n+                testMBeanOperations(url);\n+            } else {\n+                testMBeanOtherClasses(url);\n+            }\n@@ -307,0 +356,8 @@\n+        try {\n+            \/\/ Test Attributes and Query work by default:\n+            testDefaultAgent(null \/* no properties file *\/,  false \/* not testing operations *\/);\n+        } catch (Exception ex) {\n+            System.out.println(ex);\n+            System.out.println(\"----\\tTest FAILED !!\");\n+            throw ex;\n+        }\n@@ -311,1 +368,2 @@\n-                             + \"java.rmi.MarshalledObject;javax.security.auth.Subject;DefaultAgentFilterTest$MyTestObject;!*\\\"\");\n+                             + \"java.rmi.MarshalledObject;javax.security.auth.Subject;DefaultAgentFilterTest$MyTestObject;!*\\\"\",\n+                             true \/* test operations *\/);\n@@ -349,0 +407,33 @@\n+\n+            System.out.println(\"Done testMBeanOperations\");\n+        }\n+    }\n+\n+    private static void testMBeanOtherClasses(JMXServiceURL serverUrl) throws Exception {\n+        Map<String, Object> clientEnv = new HashMap<>(1);\n+        ObjectName name = new ObjectName(\"jtreg:type=Test\");\n+        try (JMXConnector client = JMXConnectorFactory.connect(serverUrl, clientEnv)) {\n+            MBeanServerConnection conn = client.getMBeanServerConnection();\n+\n+            \/\/ Set operations send types to the server and can conflict with the filter.\n+            \/\/ Attribute set operations require javax.management.Attribute.\n+            conn.setAttribute(name, new Attribute(\"MyAttribute\", Boolean.TRUE));\n+            boolean b = (Boolean) conn.getAttribute(name, \"MyAttribute\");\n+            if (b != true) {\n+                throw new RuntimeException(\"Attribute not as expected, got: \" + b);\n+            }\n+            conn.setAttribute(name, new Attribute(\"MyAttribute2\", \"my string value\"));\n+            String s = (String) conn.getAttribute(name, \"MyAttribute2\");\n+            if (!s.equals(\"my string value\")) {\n+                throw new RuntimeException(\"Attribute not as expected, got: \" + s);\n+            }\n+\n+            \/\/ Use javax.management.AttributeList:\n+            AttributeList attrs = conn.getAttributes(name, new String [] { \"MyAttribute\", \"MyAttribute2\" });\n+            attrs = conn.setAttributes(name, attrs); \/\/ Setting fails if filter too restrictive\n+\n+            \/\/ Sending a Query uses several classes from javax.management:\n+            QueryExp exp = Query.isInstanceOf(Query.value(\"notImportantClassName\"));\n+            Set<ObjectInstance> queryResult = conn.queryMBeans(name, exp);\n+\n+            System.out.println(\"Done testMBeanOtherClasses\");\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/connection\/DefaultAgentFilterTest.java","additions":99,"deletions":8,"binary":false,"changes":107,"status":"modified"}]}