{"files":[{"patch":"@@ -1796,0 +1796,3 @@\n+JavaThread* java_lang_Thread::thread_acquire(oop java_thread) {\n+  return reinterpret_cast<JavaThread*>(java_thread->address_field_acquire(_eetop_offset));\n+}\n@@ -1801,0 +1804,4 @@\n+void java_lang_Thread::release_set_thread(oop java_thread, JavaThread* thread) {\n+  java_thread->release_address_field_put(_eetop_offset, (address)thread);\n+}\n+\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -423,0 +423,1 @@\n+  static JavaThread* thread_acquire(oop java_thread);\n@@ -425,0 +426,1 @@\n+  static void release_set_thread(oop java_thread, JavaThread* thread);\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1344,2 +1344,1 @@\n-  OrderAccess::release();\n-  java_lang_Thread::set_thread(threadObj(), NULL);\n+  java_lang_Thread::release_set_thread(threadObj(), NULL);\n@@ -2264,1 +2263,0 @@\n-  java_lang_Thread::set_thread(thread_oop(), this);\n@@ -2280,0 +2278,5 @@\n+  \/\/ Publish the JavaThread* in java.lang.Thread after the JavaThread* is\n+  \/\/ on a ThreadsList. We don't want to wait for the release when the\n+  \/\/ Theads_lock is dropped somewhere in the caller since the JavaThread*\n+  \/\/ is already visible to JVM\/TI via the ThreadsList.\n+  java_lang_Thread::release_set_thread(thread_oop(), this);\n@@ -4010,3 +4013,0 @@\n-\n-  java_lang_Thread::set_thread(thread_oop(), target); \/\/ isAlive == true now\n-\n@@ -4025,0 +4025,5 @@\n+  \/\/ Publish the JavaThread* in java.lang.Thread after the JavaThread* is\n+  \/\/ on a ThreadsList. We don't want to wait for the release when the\n+  \/\/ Theads_lock is dropped when the 'mu' destructor is run since the\n+  \/\/ JavaThread* is already visible to JVM\/TI via the ThreadsList.\n+  java_lang_Thread::release_set_thread(thread_oop(), target); \/\/ isAlive == true now\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -795,1 +795,1 @@\n-  JavaThread *java_thread = java_lang_Thread::thread(thread_oop);\n+  JavaThread *java_thread = java_lang_Thread::thread_acquire(thread_oop);\n@@ -797,2 +797,3 @@\n-    \/\/ The java.lang.Thread does not contain a JavaThread * so it has\n-    \/\/ not yet run or it has died.\n+    \/\/ The java.lang.Thread does not contain a JavaThread* so it has not\n+    \/\/ run enough to be put on a ThreadsList or it has exited enough to\n+    \/\/ make it past ensure_join() where the JavaThread* is cleared.\n","filename":"src\/hotspot\/share\/runtime\/threadSMR.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"}]}