{"files":[{"patch":"@@ -224,0 +224,7 @@\n+# For reproducible builds specify the jmod --date using SOURCE_DATE in ISO-8601\n+ifeq ($(ENABLE_REPRODUCIBLE_BUILD), true)\n+  JMOD_SOURCE_DATE := --date $(SOURCE_DATE_ISO_8601)\n+else\n+  JMOD_SOURCE_DATE :=\n+endif\n+\n@@ -235,0 +242,1 @@\n+        $(JMOD_SOURCE_DATE) \\\n","filename":"make\/CreateJmods.gmk","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -316,0 +316,9 @@\n+    ifeq ($$(IS_GNU_DATE), yes)\n+      export SOURCE_DATE_ISO_8601 := $$(shell $$(DATE) --utc \\\n+                                                       --date=\"@$$(SOURCE_DATE_EPOCH)\" \\\n+                                                       +\"%Y-%m-%dT%H:%M:%SZ\" 2> \/dev\/null)\n+    else\n+      export SOURCE_DATE_ISO_8601 := $$(shell $$(DATE) -u \\\n+                                                       -j -f \"%s\" \"$$(SOURCE_DATE_EPOCH)\" \\\n+                                                       +\"%Y-%m-%dT%H:%M:%SZ\" 2> \/dev\/null)\n+    endif\n","filename":"make\/InitSupport.gmk","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -360,0 +360,1 @@\n+  AC_MSG_CHECKING([if date is the GNU version])\n@@ -362,0 +363,1 @@\n+    AC_MSG_RESULT([yes])\n@@ -364,0 +366,1 @@\n+    AC_MSG_RESULT([no])\n@@ -366,0 +369,1 @@\n+  AC_SUBST(IS_GNU_DATE)\n","filename":"make\/autoconf\/basic_tools.m4","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -360,0 +360,10 @@\n+  # Determine if the boot jdk jar supports the --date option\n+  if $JAR --help 2>&1 | $GREP -q \"\\-\\-date=TIMESTAMP\"; then\n+    BOOT_JDK_JAR_SUPPORTS_DATE=true\n+  else\n+    BOOT_JDK_JAR_SUPPORTS_DATE=false\n+  fi\n+  AC_MSG_CHECKING([if Boot JDK jar supports --date=TIMESTAMP])\n+  AC_MSG_RESULT([$BOOT_JDK_JAR_SUPPORTS_DATE])\n+  AC_SUBST(BOOT_JDK_JAR_SUPPORTS_DATE)\n+\n","filename":"make\/autoconf\/boot-jdk.m4","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -367,0 +367,3 @@\n+# Whether the boot jdk jar supports --date=TIMESTAMP\n+BOOT_JDK_JAR_SUPPORTS_DATE:=@BOOT_JDK_JAR_SUPPORTS_DATE@\n+\n@@ -703,0 +706,1 @@\n+IS_GNU_DATE:=@IS_GNU_DATE@\n","filename":"make\/autoconf\/spec.gmk.in","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -239,4 +239,6 @@\n-  timestamp=$($DATE --utc --date=$2 +\"%s\" 2> \/dev\/null)\n-  if test \"x$timestamp\" = x; then\n-    # GNU date format did not work, try BSD date options\n-    timestamp=$($DATE -j -f \"%F %T\" \"$2\" \"+%s\" 2> \/dev\/null)\n+  if test \"x$IS_GNU_DATE\" = xyes; then\n+    # GNU date\n+    timestamp=$($DATE --utc --date=$2 +\"%s\" 2> \/dev\/null)\n+  else\n+    # BSD date\n+    timestamp=$($DATE -u -j -f \"%F %T\" \"$2\" \"+%s\" 2> \/dev\/null)\n@@ -245,1 +247,1 @@\n-      timestamp=$($DATE -j -f \"%F %T\" \"$2 00:00:00\" \"+%s\" 2> \/dev\/null)\n+      timestamp=$($DATE -u -j -f \"%F %T\" \"$2 00:00:00\" \"+%s\" 2> \/dev\/null)\n","filename":"make\/autoconf\/util.m4","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -196,1 +196,1 @@\n-        $$($1_JAR_CMD) $$($1_JAR_UPDATE_OPTIONS) $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents; \\\n+        $$($1_JAR_CMD) --update $$($1_JAR_OPTIONS) --file $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents; \\\n@@ -215,1 +215,1 @@\n-  $1_SUPDATE_CONTENTS=$$($1_JAR_CMD) $$($1_JAR_UPDATE_OPTIONS) $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents $$(NEWLINE)\n+  $1_SUPDATE_CONTENTS=$$($1_JAR_CMD) --update $$($1_JAR_OPTIONS) --file $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents $$(NEWLINE)\n@@ -220,0 +220,8 @@\n+  # If reproducible build and the boot jdk jar supports --date option\n+  # then specify the --date using SOURCE_DATE in ISO-8601\n+  $1_JAR_OPTIONS :=\n+  ifeq ($$(ENABLE_REPRODUCIBLE_BUILD), true)\n+    ifeq ($$(BOOT_JDK_JAR_SUPPORTS_DATE), true)\n+      $1_JAR_OPTIONS += --date $(SOURCE_DATE_ISO_8601)\n+    endif\n+  endif\n@@ -221,5 +229,2 @@\n-    $1_JAR_CREATE_OPTIONS := c0fm\n-    $1_JAR_UPDATE_OPTIONS := u0f\n-    ifeq ($(COMPRESS_JARS), true)\n-      $1_JAR_CREATE_OPTIONS := cfm\n-      $1_JAR_UPDATE_OPTIONS := uf\n+    ifneq ($(COMPRESS_JARS), true)\n+      $1_JAR_OPTIONS += --no-compress\n@@ -227,3 +232,0 @@\n-  else\n-    $1_JAR_CREATE_OPTIONS := cfm\n-    $1_JAR_UPDATE_OPTIONS := uf\n@@ -233,1 +235,1 @@\n-  $1_VARDEPS := $$($1_JAR_CMD) $$($1_JAR_CREATE_OPTIONS) $$($1_MANIFEST) \\\n+  $1_VARDEPS := $$($1_JAR_CMD) $$($1_JAR_OPTIONS) $$($1_MANIFEST) \\\n@@ -258,1 +260,1 @@\n-\t  $$($1_JAR_CMD) $$($1_JAR_CREATE_OPTIONS) $$@ $$($1_MANIFEST_FILE) $$(NEWLINE) \\\n+\t  $$($1_JAR_CMD) --create $$($1_JAR_OPTIONS) --file $$@ --manifest $$($1_MANIFEST_FILE) $$(NEWLINE) \\\n","filename":"make\/common\/JarArchive.gmk","additions":15,"deletions":13,"binary":false,"changes":28,"status":"modified"}]}