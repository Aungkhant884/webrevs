{"files":[{"patch":"@@ -489,1 +489,0 @@\n-void VM_Version::check_virtualizations() {\n@@ -491,2 +490,3 @@\n-  const char* info_file = \"\/sys\/devices\/virtual\/dmi\/id\/product_name\";\n-  \/\/ check for various strings in the dmi data indicating virtualizations\n+static bool check_info_file(const char* fpath,\n+                            const char* virt1, VirtualizationType vt1,\n+                            const char* virt2, VirtualizationType vt2) {\n@@ -494,1 +494,1 @@\n-  FILE* fp = os::fopen(info_file, \"r\");\n+  FILE* fp = os::fopen(fpath, \"r\");\n@@ -496,1 +496,1 @@\n-    return;\n+    return false;\n@@ -499,3 +499,4 @@\n-    if (strcasestr(line, \"KVM\") != 0) {\n-      Abstract_VM_Version::_detected_virtualization = KVM;\n-      break;\n+    if (strcasestr(line, virt1) != 0) {\n+      Abstract_VM_Version::_detected_virtualization = vt1;\n+      fclose(fp);\n+      return true;\n@@ -503,3 +504,4 @@\n-    if (strcasestr(line, \"VMware\") != 0) {\n-      Abstract_VM_Version::_detected_virtualization = VMWare;\n-      break;\n+    if (virt2 != NULL && strcasestr(line, virt2) != 0) {\n+      Abstract_VM_Version::_detected_virtualization = vt2;\n+      fclose(fp);\n+      return true;\n@@ -509,0 +511,12 @@\n+  return false;\n+}\n+#endif\n+\n+void VM_Version::check_virtualizations() {\n+#if defined(LINUX)\n+  const char* pname_file = \"\/sys\/devices\/virtual\/dmi\/id\/product_name\";\n+  const char* tname_file = \"\/sys\/hypervisor\/type\";\n+  if (check_info_file(pname_file, \"KVM\", KVM, \"VMWare\", VMWare)) {\n+    return;\n+  }\n+  check_info_file(tname_file, \"Xen\", XenHVM, NULL, NoDetectedVirtualization);\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":25,"deletions":11,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,0 +74,2 @@\n+ public:\n+\n@@ -76,1 +78,0 @@\n- public:\n","filename":"src\/hotspot\/share\/runtime\/abstract_vm_version.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}