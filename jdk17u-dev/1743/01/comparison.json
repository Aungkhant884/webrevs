{"files":[{"patch":"@@ -27,1 +27,0 @@\n-\n@@ -1399,0 +1398,3 @@\n+    \/\/ extra padded border for captioned windows\n+    int extraPaddedBorderInsets = ::GetSystemMetrics(SM_CXPADDEDBORDER);\n+\n@@ -1422,1 +1424,1 @@\n-                    ::GetSystemMetrics(SM_CXSIZEFRAME);\n+                    ::GetSystemMetrics(SM_CXSIZEFRAME) + extraPaddedBorderInsets;\n@@ -1424,1 +1426,1 @@\n-                    ::GetSystemMetrics(SM_CYSIZEFRAME);\n+                    ::GetSystemMetrics(SM_CYSIZEFRAME) + extraPaddedBorderInsets;\n@@ -1427,1 +1429,1 @@\n-                    ::GetSystemMetrics(SM_CXDLGFRAME);\n+                    ::GetSystemMetrics(SM_CXDLGFRAME) + extraPaddedBorderInsets;\n@@ -1429,1 +1431,1 @@\n-                    ::GetSystemMetrics(SM_CYDLGFRAME);\n+                    ::GetSystemMetrics(SM_CYDLGFRAME) + extraPaddedBorderInsets;\n@@ -1431,2 +1433,0 @@\n-\n-\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Window.cpp","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -0,0 +1,100 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.awt.AWTException;\n+import java.awt.BorderLayout;\n+import java.awt.Button;\n+import java.awt.Dimension;\n+import java.awt.Frame;\n+import java.awt.Menu;\n+import java.awt.MenuBar;\n+import java.awt.Panel;\n+import java.awt.Robot;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import javax.imageio.ImageIO;\n+\n+\/*\n+ * @test\n+ * @bug 8265586\n+ * @key headful\n+ * @summary Tests whether insets are calculated correctly on Windows\n+ * for AWT Frame by checking the actual and expected\/preferred frame sizes.\n+ * @run main AwtFramePackTest\n+ *\/\n+\n+public class AwtFramePackTest {\n+\n+    private static Frame frame;\n+    private static Robot robot;\n+\n+    public static void main(String[] args) throws AWTException {\n+        try {\n+            robot = new Robot();\n+            robot.setAutoDelay(300);\n+\n+            frame = new Frame();\n+            frame.setLayout(new BorderLayout());\n+\n+            Panel panel = new Panel();\n+            panel.add(new Button(\"Panel Button B1\"));\n+            panel.add(new Button(\"Panel Button B2\"));\n+            frame.add(panel, BorderLayout.CENTER);\n+\n+            MenuBar mb = new MenuBar();\n+            Menu m = new Menu(\"Menu\");\n+            mb.add(m);\n+            frame.setMenuBar(mb);\n+\n+            frame.pack();\n+            frame.setVisible(true);\n+\n+            robot.delay(500);\n+            robot.waitForIdle();\n+\n+            Dimension actualFrameSize = frame.getSize();\n+            Dimension expectedFrameSize = frame.getPreferredSize();\n+\n+            if (!actualFrameSize.equals(expectedFrameSize)) {\n+                System.out.println(\"Expected frame size: \"+ expectedFrameSize);\n+                System.out.println(\"Actual frame size: \"+ actualFrameSize);\n+                saveScreenCapture();\n+                throw new RuntimeException(\"Expected and Actual frame size\" +\n+                        \" are different. frame.pack() does not work!!\");\n+            }\n+        } finally {\n+            frame.dispose();\n+        }\n+    }\n+\n+    \/\/ for debugging purpose, saves screen capture when test fails.\n+    private static void saveScreenCapture() {\n+        BufferedImage image = robot.createScreenCapture(frame.getBounds());\n+        try {\n+            ImageIO.write(image,\"png\", new File(\"Frame.png\"));\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+    }\n+}\n","filename":"test\/jdk\/java\/awt\/Frame\/AwtFramePackTest.java","additions":100,"deletions":0,"binary":false,"changes":100,"status":"added"}]}