{"files":[{"patch":"@@ -118,0 +118,9 @@\n+bool ParCompactionManager::transfer_from_overflow_stack(ObjArrayTask& task) {\n+  while (_objarray_stack.pop_overflow(task)) {\n+    if (!_objarray_stack.try_push_to_taskqueue(task)) {\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n+\n@@ -120,1 +129,2 @@\n-    \/\/ Drain the overflow stack first, to allow stealing from the marking stack.\n+    \/\/ First, try to move tasks from the overflow stack into the shared buffer, so\n+    \/\/ that other threads can steal. Otherwise process the overflow stack first.\n@@ -123,1 +133,3 @@\n-      follow_contents(obj);\n+      if (!marking_stack()->try_push_to_taskqueue(obj)) {\n+        follow_contents(obj);\n+      }\n@@ -131,1 +143,1 @@\n-    if (_objarray_stack.pop_overflow(task) || _objarray_stack.pop_local(task)) {\n+    if (transfer_from_overflow_stack(task) || _objarray_stack.pop_local(task)) {\n","filename":"src\/hotspot\/share\/gc\/parallel\/psCompactionManager.cpp","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -97,0 +97,1 @@\n+  bool transfer_from_overflow_stack(ObjArrayTask& task);\n","filename":"src\/hotspot\/share\/gc\/parallel\/psCompactionManager.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2005,2 +2005,0 @@\n-  oop obj = NULL;\n-  ObjArrayTask task;\n@@ -2008,1 +2006,3 @@\n-    while (ParCompactionManager::steal_objarray(worker_id,  task)) {\n+    oop obj = NULL;\n+    ObjArrayTask task;\n+    if (ParCompactionManager::steal_objarray(worker_id,  task)) {\n@@ -2010,3 +2010,1 @@\n-      cm->follow_marking_stacks();\n-    }\n-    while (ParCompactionManager::steal(worker_id, obj)) {\n+    } else if (ParCompactionManager::steal(worker_id, obj)) {\n@@ -2014,1 +2012,0 @@\n-      cm->follow_marking_stacks();\n@@ -2016,0 +2013,1 @@\n+    cm->follow_marking_stacks();\n","filename":"src\/hotspot\/share\/gc\/parallel\/psParallelCompact.cpp","additions":5,"deletions":7,"binary":false,"changes":12,"status":"modified"}]}