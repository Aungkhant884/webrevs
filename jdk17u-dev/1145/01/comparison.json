{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -111,0 +111,5 @@\n+        \/**\n+         * Indicates that docs use old-form of anchors.\n+         *\/\n+        final boolean useOldFormId;\n+\n@@ -121,1 +126,1 @@\n-        Item(String elementName, DocPath path, boolean relative) {\n+        Item(String elementName, DocPath path, boolean relative, boolean useOldFormId) {\n@@ -125,0 +130,1 @@\n+            this.useOldFormId = useOldFormId;\n@@ -194,1 +200,1 @@\n-        return new DocLink(p, memberName);\n+        return new DocLink(p, fnd.useOldFormId ? getOldFormHtmlName(memberName) : memberName);\n@@ -264,1 +270,1 @@\n-                    readElementList(in, docUrl, false, versionNumber);\n+                    readElementList(in, docUrl, false, versionNumber, isOldFormPlatformDocs(versionNumber));\n@@ -275,0 +281,12 @@\n+    \/**\n+     * Checks if platform docs for the specified version use old-form anchors.\n+     * Old-form anchors are used by Oracle docs for JDKs 8 and 9.\n+     * It can be checked on https:\/\/docs.oracle.com\/javase\/<version>\/docs\/api\n+     *\n+     * @param version\n+     * @return True if docs use old-form anchors\n+     *\/\n+    private boolean isOldFormPlatformDocs(int version) {\n+        return 8 == version || 9 == version;\n+    }\n+\n@@ -427,1 +445,1 @@\n-                readElementList(in, urlpath, false, 0);\n+                readElementList(in, urlpath, false, 0, false);\n@@ -446,1 +464,1 @@\n-                readElementList(in, urlpath, false, 0);\n+                readElementList(in, urlpath, false, 0, true);\n@@ -470,1 +488,1 @@\n-            readElementList(file, path);\n+            readElementList(file, path, false);\n@@ -477,1 +495,1 @@\n-                readElementList(file1, path);\n+                readElementList(file1, path, true);\n@@ -484,1 +502,1 @@\n-    private void readElementList(DocFile file, String path) throws Fault, DocFileIOException {\n+    private void readElementList(DocFile file, String path, boolean isOldFormDoc) throws Fault, DocFileIOException {\n@@ -490,1 +508,1 @@\n-                readElementList(file.openInputStream(), path, pathIsRelative, 0);\n+                readElementList(file.openInputStream(), path, pathIsRelative, 0, isOldFormDoc);\n@@ -510,1 +528,2 @@\n-    private void readElementList(InputStream input, String path, boolean relative, int platformVersion)\n+    private void readElementList(InputStream input, String path, boolean relative, int platformVersion,\n+                                 boolean isOldFormDoc)\n@@ -523,1 +542,1 @@\n-                        Item item = new Item(moduleName, elempath, relative);\n+                        Item item = new Item(moduleName, elempath, relative, isOldFormDoc);\n@@ -541,1 +560,1 @@\n-                        Item item = new Item(elemname, elempath, relative);\n+                        Item item = new Item(elemname, elempath, relative, isOldFormDoc);\n@@ -662,0 +681,61 @@\n+\n+    \/**\n+     * Converts a name to an old-form HTML name (old-form id).\n+     *\n+     * @param name the string that needs to be converted to a valid HTML name\n+     * @return old-form HTML name\n+     *\/\n+    private String getOldFormHtmlName(String name) {\n+        \/* The HTML 4 spec at http:\/\/www.w3.org\/TR\/html4\/types.html#h-6.2 mentions\n+         * that the name\/id should begin with a letter followed by other valid characters.\n+         * The HTML 5 spec (draft) is more permissive on names\/ids where the only restriction\n+         * is that it should be at least one character long and should not contain spaces.\n+         * The spec draft is @ http:\/\/www.w3.org\/html\/wg\/drafts\/html\/master\/dom.html#the-id-attribute.\n+         *\n+         * For HTML 4, we need to check for non-characters at the beginning of the name and\n+         * substitute it accordingly, \"_\" and \"$\" can appear at the beginning of a member name.\n+         * The method substitutes \"$\" with \"Z:Z:D\" and will prefix \"_\" with \"Z:Z\".\n+         *\/\n+\n+        if (null == name)\n+            return name;\n+\n+        StringBuilder sb = new StringBuilder();\n+        for (int i = 0; i < name.length(); i++) {\n+            char ch = name.charAt(i);\n+            switch (ch) {\n+                case '(':\n+                case ')':\n+                case '<':\n+                case '>':\n+                case ',':\n+                    sb.append('-');\n+                    break;\n+                case ' ':\n+                case '[':\n+                    break;\n+                case ']':\n+                    sb.append(\":A\");\n+                    break;\n+                \/\/ Any appearance of $ needs to be substituted with \":D\" and not with hyphen\n+                \/\/ since a field name \"P$$ and a method P(), both valid member names, can end\n+                \/\/ up as \"P--\". A member name beginning with $ needs to be substituted with\n+                \/\/ \"Z:Z:D\".\n+                case '$':\n+                    if (i == 0)\n+                        sb.append(\"Z:Z\");\n+                    sb.append(\":D\");\n+                    break;\n+                \/\/ A member name beginning with _ needs to be prefixed with \"Z:Z\" since valid anchor\n+                \/\/ names can only begin with a letter.\n+                case '_':\n+                    if (i == 0)\n+                        sb.append(\"Z:Z\");\n+                    sb.append(ch);\n+                    break;\n+                default:\n+                    sb.append(ch);\n+            }\n+        }\n+        return sb.toString();\n+    }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/Extern.java","additions":93,"deletions":13,"binary":false,"changes":106,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -68,1 +68,1 @@\n-                    java\/math\/BigInteger.html#gcd(java.math.BigInteger)\" title=\"class or interface i\\\n+                    java\/math\/BigInteger.html#gcd-java.math.BigInteger-\" title=\"class or interface i\\\n@@ -105,1 +105,1 @@\n-                    java\/math\/BigInteger.html#gcd(java.math.BigInteger)\" title=\"class or interface i\\\n+                    java\/math\/BigInteger.html#gcd-java.math.BigInteger-\" title=\"class or interface i\\\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testClassCrossReferences\/TestClassCrossReferences.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -59,1 +59,1 @@\n-                    \/java\/io\/FilterReader.html#read()\" title=\"class or interface in java.io\" class=\"\\\n+                    \/java\/io\/FilterReader.html#read--\" title=\"class or interface in java.io\" class=\"\\\n@@ -65,1 +65,1 @@\n-                    \/java\/io\/DataInput.html#readInt()\" title=\"class or interface in java.io\" class=\"\\\n+                    \/java\/io\/DataInput.html#readInt--\" title=\"class or interface in java.io\" class=\"\\\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testExternalOverriddenMethod\/TestExternalOverriddenMethod.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-                    href=\"http:\/\/java.sun.com\/j2se\/1.4\/docs\/api\/java\/lang\/Object.html#wait(long,int)\\\"\"\"\",\n+                    href=\"http:\/\/java.sun.com\/j2se\/1.4\/docs\/api\/java\/lang\/Object.html#wait-long-int-\\\"\"\"\",\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testHref\/TestHref.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -92,1 +92,1 @@\n-                    java\/lang\/ClassLoader.html#getSystemClassLoader()\" title=\"class or interface in \\\n+                    java\/lang\/ClassLoader.html#getSystemClassLoader--\" title=\"class or interface in \\\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testLinkOption\/TestLinkOption.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8216497\n+ * @bug 8216497 8297437\n@@ -106,5 +106,13 @@\n-            checkOutput(\"p\/q\/A.html\", true,\n-                    \"<a href=\\\"\" + url + \"\\\"\",\n-                    \"<a href=\\\"\" + url + \"#clone()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n-                    \"<a href=\\\"\" + url + \"#equals(java.lang.Object)\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n-                    \"<a href=\\\"\" + url + \"#finalize()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            if (version == 8 || version == 9) {\n+                checkOutput(\"p\/q\/A.html\", true,\n+                        \"<a href=\\\"\" + url + \"\\\"\",\n+                        \"<a href=\\\"\" + url + \"#clone--\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#equals-java.lang.Object-\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#finalize--\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            } else {\n+                checkOutput(\"p\/q\/A.html\", true,\n+                        \"<a href=\\\"\" + url + \"\\\"\",\n+                        \"<a href=\\\"\" + url + \"#clone()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#equals(java.lang.Object)\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#finalize()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            }\n@@ -128,5 +136,13 @@\n-            checkOutput(\"p\/q\/A.html\", true,\n-                    \"<a href=\\\"\" + url + \"\\\"\",\n-                    \"<a href=\\\"\" + url + \"#clone()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n-                    \"<a href=\\\"\" + url + \"#equals(java.lang.Object)\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n-                    \"<a href=\\\"\" + url + \"#finalize()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            if (version == 8 || version == 9) {\n+                checkOutput(\"p\/q\/A.html\", true,\n+                        \"<a href=\\\"\" + url + \"\\\"\",\n+                        \"<a href=\\\"\" + url + \"#clone--\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#equals-java.lang.Object-\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#finalize--\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            } else {\n+                checkOutput(\"p\/q\/A.html\", true,\n+                        \"<a href=\\\"\" + url + \"\\\"\",\n+                        \"<a href=\\\"\" + url + \"#clone()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#equals(java.lang.Object)\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#finalize()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            }\n@@ -150,5 +166,13 @@\n-            checkOutput(\"p\/q\/A.html\", true,\n-                    \"<a href=\\\"\" + url + \"\\\"\",\n-                    \"<a href=\\\"\" + url + \"#clone()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n-                    \"<a href=\\\"\" + url + \"#equals(java.lang.Object)\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n-                    \"<a href=\\\"\" + url + \"#finalize()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            if (version == 8 || version == 9) {\n+                checkOutput(\"p\/q\/A.html\", true,\n+                        \"<a href=\\\"\" + url + \"\\\"\",\n+                        \"<a href=\\\"\" + url + \"#clone--\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#equals-java.lang.Object-\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#finalize--\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            } else {\n+                checkOutput(\"p\/q\/A.html\", true,\n+                        \"<a href=\\\"\" + url + \"\\\"\",\n+                        \"<a href=\\\"\" + url + \"#clone()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#equals(java.lang.Object)\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\",\n+                        \"<a href=\\\"\" + url + \"#finalize()\\\" title=\\\"class or interface in java.lang\\\" class=\\\"external-link\\\">\");\n+            }\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testLinkPlatform\/TestLinkPlatform.java","additions":41,"deletions":17,"binary":false,"changes":58,"status":"modified"}]}