{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8163805 8224252 8196751\n+ * @bug 8163805 8224252 8196751 8279351\n@@ -74,0 +74,10 @@\n+    private static boolean checkOutput(final String line, final boolean useRmiPort, final int rmiPort) {\n+        if (!useRmiPort && line.contains(GOLDEN)) {\n+            testResult = true;\n+        } else if (useRmiPort && line.contains(RMI_CONNECTOR_IS_BOUND + rmiPort)) {\n+            testResult = true;\n+        } else if (line.contains(ADDRESS_ALREADY_IN_USE)) {\n+            portInUse = true;\n+        }\n+        return (line.contains(GOLDEN) || portInUse);\n+    }\n@@ -98,1 +108,1 @@\n-                int rmiPort = -1;\n+                final int rmiPort = useRmiPort ? Utils.findUnreservedFreePort(REGISTRY_DEFAULT_PORT, registryPort) : -1;\n@@ -100,1 +110,0 @@\n-                    rmiPort = Utils.findUnreservedFreePort(REGISTRY_DEFAULT_PORT, registryPort);\n@@ -110,2 +119,0 @@\n-                final int finalRmiPort = rmiPort;\n-\n@@ -114,11 +121,1 @@\n-                Process debugd = startProcess(\"debugd\", pb, null,\n-                        l -> {\n-                            if (!useRmiPort && l.contains(GOLDEN)) {\n-                                testResult = true;\n-                            } else if (useRmiPort && l.contains(RMI_CONNECTOR_IS_BOUND + finalRmiPort)) {\n-                                testResult = true;\n-                            } else if (l.contains(ADDRESS_ALREADY_IN_USE)) {\n-                                portInUse = true;\n-                            }\n-                            return (l.contains(GOLDEN) || portInUse);\n-                        }, 20, TimeUnit.SECONDS);\n+                Process debugd = startProcess(\"debugd\", pb, null, l -> checkOutput(l, useRmiPort, rmiPort), 20, TimeUnit.SECONDS);\n@@ -131,1 +128,1 @@\n-                if (!testResult) {\n+                if (!testResult && !portInUse) {\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/sadebugd\/SADebugDTest.java","additions":15,"deletions":18,"binary":false,"changes":33,"status":"modified"}]}