{"files":[{"patch":"@@ -688,1 +688,0 @@\n-javax\/sound\/midi\/Sequencer\/MetaCallback.java 8178698 linux-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,0 +34,3 @@\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n@@ -40,1 +43,1 @@\n- * @run main\/othervm MetaCallback\n+ * @run main\/othervm\/timeout=120 MetaCallback\n@@ -62,2 +65,5 @@\n-    int metaCount = 0;\n-    boolean finished = false;\n+    volatile int metaCount = 0;\n+    volatile boolean finished = false;\n+    \/\/ On M1 Mac sometimes system notifies listener about the same message twice\n+    static List<MetaMessage> received = Collections.synchronizedList(new ArrayList<>());\n+    long startTimeMs;\n@@ -67,0 +73,1 @@\n+        startTimeMs = System.currentTimeMillis();\n@@ -104,1 +111,4 @@\n-    void stop() {sequencer.stop();}\n+    void stop() {\n+        sequencer.stop();\n+        sequencer.close();\n+    }\n@@ -111,0 +121,12 @@\n+            if (!received.contains(msg)) {\n+                received.add(msg);\n+            } else {\n+                \/\/ Add some additional debug output for the case of duplicate meta message\n+                \/\/ The test will fail anyway at the end\n+                System.out.println(\"Duplicate message received after getting \"\n+                        + received.size() + \" messages.\");\n+                System.out.println(\"Sequencer in use: \" + sequencer);\n+                System.out.println(\"Time from test start: \" +\n+                        (System.currentTimeMillis() - startTimeMs) + \"ms\");\n+                Thread.dumpStack();\n+            }\n","filename":"test\/jdk\/javax\/sound\/midi\/Sequencer\/MetaCallback.java","additions":27,"deletions":5,"binary":false,"changes":32,"status":"modified"}]}