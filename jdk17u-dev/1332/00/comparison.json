{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,10 +39,1 @@\n-        \/\/ If cgroups is not configured, report success.\n-        Metrics metrics = Metrics.systemMetrics();\n-        if (metrics == null) {\n-            System.out.println(\"TEST PASSED!!!\");\n-            return;\n-        }\n-\n-        MetricsTester metricsTester = new MetricsTester();\n-        metricsTester.testAll(metrics);\n-        System.out.println(\"TEST PASSED!!!\");\n+        MetricsTester.main(args);\n","filename":"test\/jdk\/jdk\/internal\/platform\/cgroup\/TestCgroupMetrics.java","additions":2,"deletions":11,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,0 +58,1 @@\n+            opts.addClassOptions(\"-incontainer\");\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/TestSystemMetrics.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Red Hat Inc.\n+ * Copyright (c) 2020, 2022, Red Hat Inc.\n@@ -55,1 +55,1 @@\n-    public void testAll(Metrics m) throws Exception {\n+    private void testAll(Metrics m, boolean inContainer) throws Exception {\n@@ -61,2 +61,10 @@\n-        tester.testMemorySubsystem();\n-        tester.testMemoryUsage();\n+        if (!inContainer) {\n+          \/\/ If not running in a container, these test cases query the memory usage.\n+          \/\/ of all processes in the entire system (or those belonging to the current\n+          \/\/ Linux user). They cannot produce predictable results due to interference\n+          \/\/ from unrelated processes.\n+          System.out.println(\"testMemorySubsystem and testMemoryUsage skipped\");\n+        } else {\n+          tester.testMemorySubsystem();\n+          tester.testMemoryUsage();\n+        }\n@@ -74,0 +82,6 @@\n+        boolean inContainer = false;\n+        if (args.length > 0 && \"-incontainer\".equals(args[0])) {\n+          inContainer = true;\n+        }\n+        System.out.println(\"inContainer = \" + inContainer);\n+\n@@ -75,1 +89,1 @@\n-        metricsTester.testAll(m);\n+        metricsTester.testAll(m, inContainer);\n","filename":"test\/lib\/jdk\/test\/lib\/containers\/cgroup\/MetricsTester.java","additions":19,"deletions":5,"binary":false,"changes":24,"status":"modified"}]}