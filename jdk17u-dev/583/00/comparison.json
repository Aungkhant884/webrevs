{"files":[{"patch":"@@ -744,1 +744,0 @@\n-javax\/swing\/JPopupMenu\/4634626\/bug4634626.java 8017175 macosx-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,3 +34,15 @@\n-import javax.swing.*;\n-import java.awt.event.*;\n-import java.awt.*;\n+import javax.swing.JButton;\n+import javax.swing.JComponent;\n+import javax.swing.JFrame;\n+import javax.swing.JPanel;\n+import javax.swing.JPopupMenu;\n+import javax.swing.JTextArea;\n+import javax.swing.SwingUtilities;\n+import java.awt.BorderLayout;\n+import java.awt.Component;\n+import java.awt.event.KeyEvent;\n+import java.awt.event.MouseAdapter;\n+import java.awt.event.MouseEvent;\n+import java.awt.event.WindowAdapter;\n+import java.awt.event.WindowEvent;\n+import java.util.concurrent.atomic.AtomicBoolean;\n@@ -40,2 +52,2 @@\n-    public boolean passed = true;\n-    public boolean done = false;\n+    public volatile boolean passed = true;\n+    public volatile boolean done = false;\n@@ -43,6 +55,5 @@\n-    public static JFrame mainFrame = new JFrame(\"Bug4634626\");\n-    public JRootPane rootPane = mainFrame.getRootPane();\n-    public JPanel contentPane = new JPanel();\n-    public JButton nopButton = new JButton(\"No popup button\");\n-    public JTextArea someText = new JTextArea(\"Some text here\", 20, 10);\n-    public JButton popButton = new JButton(\"Button with the popup\");\n+    public static JFrame mainFrame;\n+    public JPanel contentPane;\n+    public JButton nopButton;\n+    public JTextArea someText;\n+    public JButton popButton;\n@@ -50,2 +61,2 @@\n-    public JPopupMenu btnPopup = new JPopupMenu();\n-    public JPopupMenu commonPopup = new JPopupMenu();\n+    public JPopupMenu btnPopup;\n+    public JPopupMenu commonPopup;\n@@ -64,1 +75,1 @@\n-                  new Error(\"The event got thru the component with popup: \"\n+                  new Error(\"The event got through the component with popup: \"\n@@ -68,0 +79,1 @@\n+\n@@ -75,1 +87,1 @@\n-                  new Error(\"The event got thru the component with popup: \"\n+                  new Error(\"The event got through the component with popup: \"\n@@ -96,1 +108,7 @@\n-    public void init() {\n+    public void init() throws Exception {\n+        SwingUtilities.invokeLater(() -> {\n+            mainFrame = new JFrame(\"Bug4634626\");\n+            contentPane = new JPanel();\n+            nopButton = new JButton(\"No popup button\");\n+            someText = new JTextArea(\"Some text here\", 20, 10);\n+            popButton = new JButton(\"Button with the popup\");\n@@ -98,3 +116,15 @@\n-        try {\n-            popButton.setComponentPopupMenu(null);\n-            popButton.setComponentPopupMenu(null);\n+            btnPopup = new JPopupMenu();\n+            commonPopup = new JPopupMenu();\n+\n+            try {\n+                popButton.setComponentPopupMenu(null);\n+                popButton.setComponentPopupMenu(null);\n+                popButton.setComponentPopupMenu(btnPopup);\n+                popButton.setComponentPopupMenu(null);\n+            } catch (Exception ex) {\n+                System.err.println(\"Unexpected exception was thrown by \" +\n+                        \"setComponentPopupMenu() method: \" + ex);\n+            }\n+            btnPopup.add(\"Button 1\");\n+            btnPopup.add(\"Button 2\");\n+            btnPopup.add(\"Button 3\");\n@@ -102,30 +132,21 @@\n-            popButton.setComponentPopupMenu(null);\n-        } catch(Exception ex) {\n-            System.err.println(\"Unexpected exception was thrown by \" +\n-                               \"setComponentPopupMenu() method: \" + ex);\n-        }\n-        btnPopup.add(\"Button 1\");\n-        btnPopup.add(\"Button 2\");\n-        btnPopup.add(\"Button 3\");\n-        popButton.setComponentPopupMenu(btnPopup);\n-        popButton.addMouseListener(mouser);\n-        commonPopup.add(\"One\");\n-        commonPopup.add(\"Two\");\n-        commonPopup.add(\"Three\");\n-\n-        contentPane.setLayout(new BorderLayout());\n-        contentPane.setComponentPopupMenu(commonPopup);\n-        contentPane.addMouseListener(mouser);\n-        contentPane.add(nopButton, BorderLayout.NORTH);\n-        nopButton.addMouseListener(mouser);\n-        contentPane.add(popButton, BorderLayout.SOUTH);\n-        someText.addMouseListener(mouser);\n-        contentPane.add(someText, BorderLayout.CENTER);\n-        mainFrame.setContentPane(contentPane);\n-\n-        mainFrame.pack();\n-        mainFrame.setLocation(50, 50);\n-\n-        mainFrame.addWindowListener(new TestStateListener());\n-        mainFrame.setLocationRelativeTo(null);\n-        mainFrame.setVisible(true);\n+            popButton.addMouseListener(mouser);\n+            commonPopup.add(\"One\");\n+            commonPopup.add(\"Two\");\n+            commonPopup.add(\"Three\");\n+\n+            contentPane.setLayout(new BorderLayout());\n+            contentPane.setComponentPopupMenu(commonPopup);\n+            contentPane.addMouseListener(mouser);\n+            contentPane.add(nopButton, BorderLayout.NORTH);\n+            nopButton.addMouseListener(mouser);\n+            contentPane.add(popButton, BorderLayout.SOUTH);\n+            someText.addMouseListener(mouser);\n+            contentPane.add(someText, BorderLayout.CENTER);\n+            mainFrame.setContentPane(contentPane);\n+\n+            mainFrame.pack();\n+            mainFrame.setLocation(50, 50);\n+            mainFrame.addWindowListener(new TestStateListener());\n+            mainFrame.setLocationRelativeTo(null);\n+            mainFrame.setVisible(true);\n+        });\n@@ -138,1 +159,0 @@\n-\n@@ -168,1 +188,1 @@\n-            robo.delay(500);\n+            robo.delay(1000);\n@@ -175,1 +195,5 @@\n-            someText.setInheritsPopupMenu(true);\n+            try {\n+                SwingUtilities.invokeAndWait(() -> someText.setInheritsPopupMenu(true));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not assign popup to button\", ex);\n+            }\n@@ -178,2 +202,9 @@\n-            robo.delay(500);\n-            if(!commonPopup.isVisible()) {\n+            robo.delay(1000);\n+            AtomicBoolean popupVisible = new AtomicBoolean(false);\n+            try {\n+                SwingUtilities.invokeAndWait(() ->\n+                        popupVisible.set(commonPopup.isVisible()));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not get commonPopup status\");\n+            }\n+            if(!popupVisible.get()) {\n@@ -186,1 +217,5 @@\n-            someText.setInheritsPopupMenu(false);\n+            try {\n+                SwingUtilities.invokeAndWait(() -> someText.setInheritsPopupMenu(false));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not unassign popup on button\", ex);\n+            }\n@@ -191,2 +226,8 @@\n-            robo.delay(500);\n-            if(!btnPopup.isVisible()) {\n+            robo.delay(1000);\n+            try {\n+                SwingUtilities.invokeAndWait(() ->\n+                    popupVisible.set(btnPopup.isVisible()));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not get btnPopup status\");\n+            }\n+            if(!popupVisible.get()) {\n@@ -203,2 +244,0 @@\n-\n-\n@@ -210,0 +249,1 @@\n+\n","filename":"test\/jdk\/javax\/swing\/JPopupMenu\/4634626\/bug4634626.java","additions":100,"deletions":60,"binary":false,"changes":160,"status":"modified"}]}