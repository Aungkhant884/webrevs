{"files":[{"patch":"@@ -41,0 +41,1 @@\n+import java.lang.Thread.State;\n@@ -112,0 +113,1 @@\n+\tprivate static boolean isPreferenceStoreListenerEnabled;\n@@ -117,0 +119,2 @@\n+\tprivate static Thread sleeperThread;\n+\n@@ -322,0 +326,21 @@\n+\tprivate static void addPreferenceStoreListener() {\n+\t\tif (!isPreferenceStoreListenerEnabled) {\n+\t\t\tBrowserAttachPlugin.getDefault().getPreferenceStore()\n+\t\t\t\t\t.addPropertyChangeListener(new IPropertyChangeListener() {\n+\t\t\t\t\t\t@Override\n+\t\t\t\t\t\tpublic void propertyChange(PropertyChangeEvent event) {\n+\t\t\t\t\t\t\tif (event.getProperty().equals(PreferenceConstants.P_JVM_ATTACH_DELAY)) {\n+\t\t\t\t\t\t\t\tif (sleeperThread.getState().equals(State.TIMED_WAITING)) {\n+\t\t\t\t\t\t\t\t\tsleeperThread.interrupt();\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t});\n+\t\t\tisPreferenceStoreListenerEnabled = true;\n+\t\t}\n+\t}\n+\n+\tprivate static final int getJvmAttachDelay() {\n+\t\treturn BrowserAttachPlugin.getDefault().getPreferenceStore().getInt(PreferenceConstants.P_JVM_ATTACH_DELAY);\n+\t}\n+\n@@ -337,0 +362,16 @@\n+\t\t\t\t\t\tif (getJvmAttachDelay() > 0) {\n+\t\t\t\t\t\t\taddPreferenceStoreListener();\n+\t\t\t\t\t\t\tsleeperThread = new Thread(() -> {\n+\t\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\t\tThread.sleep(getJvmAttachDelay());\n+\t\t\t\t\t\t\t\t} catch (InterruptedException e) {\n+\t\t\t\t\t\t\t\t\t\/\/ Interrupted if delay setting is changed while sleeping.\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t});\n+\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\tsleeperThread.start();\n+\t\t\t\t\t\t\t\tsleeperThread.join();\n+\t\t\t\t\t\t\t} catch (InterruptedException e) {\n+\t\t\t\t\t\t\t\t\/\/ ignore\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n","filename":"application\/org.openjdk.jmc.browser.attach\/src\/main\/java\/org\/openjdk\/jmc\/browser\/attach\/LocalJVMToolkit.java","additions":41,"deletions":0,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -35,0 +35,2 @@\n+import java.time.Duration;\n+\n@@ -72,0 +74,4 @@\n+\t\tIntegerFieldEditor jvmAttachOffset = new IntegerFieldEditor(PreferenceConstants.P_JVM_ATTACH_DELAY,\n+\t\t\t\tMessages.AttachPreferencePage_JVM_ATTACH_DELAY, getFieldEditorParent());\n+\t\tjvmAttachOffset.setValidRange(0, (int) Duration.ofMinutes(1).toMillis());\n+\t\taddField(jvmAttachOffset);\n","filename":"application\/org.openjdk.jmc.browser.attach\/src\/main\/java\/org\/openjdk\/jmc\/browser\/attach\/preferences\/AttachPreferencePage.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -44,0 +44,1 @@\n+\tpublic static String AttachPreferencePage_JVM_ATTACH_DELAY;\n","filename":"application\/org.openjdk.jmc.browser.attach\/src\/main\/java\/org\/openjdk\/jmc\/browser\/attach\/preferences\/Messages.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -44,0 +44,5 @@\n+\t\/**\n+\t * Preference key for setting a delay when creating the attachable JVM Descriptor\n+\t *\/\n+\tpublic static final String P_JVM_ATTACH_DELAY = \"jvmAttachDelay\"; \/\/$NON-NLS-1$\n+\n","filename":"application\/org.openjdk.jmc.browser.attach\/src\/main\/java\/org\/openjdk\/jmc\/browser\/attach\/preferences\/PreferenceConstants.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -49,0 +49,1 @@\n+\t\tstore.setDefault(PreferenceConstants.P_JVM_ATTACH_DELAY, 0);\n","filename":"application\/org.openjdk.jmc.browser.attach\/src\/main\/java\/org\/openjdk\/jmc\/browser\/attach\/preferences\/PreferenceInitializer.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+AttachPreferencePage_JVM_ATTACH_DELAY=Delay between discovering a new JVM and attachment [ms]:\n","filename":"application\/org.openjdk.jmc.browser.attach\/src\/main\/resources\/org\/openjdk\/jmc\/browser\/attach\/preferences\/messages.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}