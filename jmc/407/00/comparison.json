{"files":[{"patch":"@@ -1,1 +1,1 @@\n-name: validate\n+name: Validation\n@@ -3,1 +3,5 @@\n-on: [push, pull_request]\n+on: [push, workflow_dispatch]\n+\n+concurrency:\n+  group: ${{ github.workflow }}-${{ github.ref }}\n+  cancel-in-progress: true\n@@ -6,2 +10,13 @@\n-  linux:\n-    runs-on: 'ubuntu-latest'\n+  build_and_test:\n+    name: Build and Test on ${{ matrix.os }}\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        os: ['ubuntu-latest', 'macOS-latest', 'windows-latest']\n+    runs-on: ${{ matrix.os }}\n+    defaults:\n+      run:\n+       shell: bash\n+    env:\n+      MAVEN_OPTS: -Xmx2048m\n+      MAVENPARAMS: --no-transfer-progress\n@@ -9,2 +24,4 @@\n-    - uses: actions\/checkout@v1\n-    - uses: actions\/setup-java@v2\n+    - name: Checkout repository\n+      uses: actions\/checkout@v3\n+    - name: Set up Java\n+      uses: actions\/setup-java@v3\n@@ -16,1 +33,1 @@\n-      uses: actions\/cache@v2\n+      uses: actions\/cache@v3\n@@ -21,4 +38,2 @@\n-          ${{ runner.os }}-maven-\n-    - name: Check formatting\n-      run: .\/scripts\/checkformatting.sh\n-    - name: Run core tests\n+          ${{ runner.os }}-maven\n+    - name: Build & test core\n@@ -26,1 +41,3 @@\n-    - name: Run application tests\n+    - name: Start P2 repository\n+      run: .\/scripts\/startp2.sh\n+    - name: Build & test application\n@@ -28,1 +45,1 @@\n-    - name: Run agent tests\n+    - name: Build & test agent\n@@ -30,17 +47,0 @@\n-\n-  mac:\n-    runs-on: 'macOS-latest'\n-    steps:\n-    - uses: actions\/checkout@v1\n-    - uses: actions\/setup-java@v2\n-      with:\n-        distribution: temurin\n-        java-version: '11.0.14'\n-        java-package: jdk\n-    - name: Cache local Maven repository\n-      uses: actions\/cache@v2\n-      with:\n-        path: ~\/.m2\/repository\n-        key: ${{ runner.os }}-maven-${{ hashFiles('**\/pom.xml') }}\n-        restore-keys: |\n-          ${{ runner.os }}-maven-\n@@ -49,35 +49,0 @@\n-    - name: Run core tests\n-      run: .\/scripts\/runcoretests.sh\n-    - name: Run application tests\n-      run: .\/scripts\/runapptests.sh\n-    - name: Run agent tests\n-      run: .\/scripts\/runagenttests.sh\n-\n-  win:\n-    runs-on: 'windows-latest'\n-    steps:\n-    - uses: actions\/checkout@v1\n-    - uses: actions\/setup-java@v2\n-      with:\n-        distribution: temurin\n-        java-version: '11.0.14'\n-        java-package: jdk\n-    - name: Cache local Maven repository\n-      uses: actions\/cache@v2\n-      with:\n-        path: ~\/.m2\/repository\n-        key: ${{ runner.os }}-maven-${{ hashFiles('**\/pom.xml') }}\n-        restore-keys: |\n-          ${{ runner.os }}-maven-\n-    - name: Check formatting\n-      run: .\\scripts\\checkformatting.bat\n-      shell: cmd\n-    - name: Run core tests\n-      run: .\\scripts\\runcoretests.bat\n-      shell: cmd\n-    - name: Run application tests\n-      run: .\\scripts\\runapptests.bat\n-      shell: cmd\n-    - name: Run agent tests\n-      run: .\\scripts\\runagenttests.bat\n-      shell: cmd\n","filename":".github\/workflows\/validate.yml","additions":30,"deletions":65,"binary":false,"changes":95,"status":"modified"},{"patch":"@@ -2,8 +2,1 @@\n-echo \"======== Building p2 repo ===================\"\n-cd releng\\third-party\n-call mvn p2:site || EXIT \/B 1\n-echo \"======== Starting p2 repo ===================\"\n-start \/B cmd \/C \"mvn jetty:run\"\n-cd ..\\..\\core\n-echo \"======== Installing core ====================\"\n-call mvn install || EXIT \/B 2\n+\n@@ -11,6 +4,5 @@\n-call mvn spotless:check || EXIT \/B 3\n-cd ..\n-echo \"======== Running spotless for agent ==========\"\n-cd agent\n-call mvn spotless:check || EXIT \/B 4\n-cd ..\n+cd core\n+call mvn %MAVENPARAMS% spotless:check || EXIT \/B 5\n+echo \"======== Running spotless for agent =========\"\n+cd ..\\agent\n+call mvn %MAVENPARAMS% spotless:check || EXIT \/B 6\n@@ -18,1 +10,2 @@\n-call mvn -Puitests spotless:check || EXIT \/B 5\n+cd ..\n+call mvn %MAVENPARAMS% -Puitests spotless:check || EXIT \/B 7\n","filename":"scripts\/checkformatting.bat","additions":8,"deletions":15,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -2,1 +2,0 @@\n-\n@@ -4,9 +3,1 @@\n-echo \"======== Building p2 repo ===================\"\n-cd releng\/third-party\n-sh -c \"mvn p2:site\"\n-echo \"======== Starting p2 repo ===================\"\n-sh -c \"nohup mvn jetty:run &\"\n-cd ..\/..\n-echo \"======== Installing core ====================\"\n-cd core\n-sh -c \"mvn install\"\n+\n@@ -14,2 +5,2 @@\n-sh -c \"mvn spotless:check\"\n-cd ..\n+cd core\n+sh -c \"mvn ${MAVENPARAMS} spotless:check\"\n@@ -17,3 +8,2 @@\n-cd agent\n-sh -c \"mvn spotless:check\"\n-cd ..\n+cd ..\/agent\n+sh -c \"mvn ${MAVENPARAMS} spotless:check\"\n@@ -21,1 +11,2 @@\n-sh -c \"mvn -Puitests spotless:check\"\n+cd ..\n+sh -c \"mvn ${MAVENPARAMS} -Puitests spotless:check\"\n@@ -23,1 +14,0 @@\n-\n","filename":"scripts\/checkformatting.sh","additions":7,"deletions":17,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -2,1 +2,2 @@\n-echo \"======== Running agent tests ================\"\n+\n+echo \"======== Building and testing agent =========\"\n@@ -4,2 +5,2 @@\n-rem The integration tests fail on windows - change to \"mvn verify\" once fixed.\n-mvn test\n+rem The integration tests currently fail on windows - change to \"mvn verify\" once fixed.\n+call mvn %MAVENPARAMS% test || EXIT \/B 4\n@@ -7,1 +8,0 @@\n-\n","filename":"scripts\/runagenttests.bat","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,0 @@\n-\n@@ -4,1 +3,2 @@\n-echo \"======== Running agent tests ================\"\n+\n+echo \"======== Building and testing agent =========\"\n@@ -6,1 +6,6 @@\n-mvn verify\n+# The integration tests currently fail on windows - change to \"mvn verify\" once fixed.\n+if [[ $(uname) == MINGW* ]] || [[ $(uname) == CYGWIN* ]]; then\n+  sh -c \"mvn ${MAVENPARAMS} test\"\n+else\n+  sh -c \"mvn ${MAVENPARAMS} verify\"\n+fi\n@@ -8,1 +13,0 @@\n-\n","filename":"scripts\/runagenttests.sh","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,12 +2,0 @@\n-REM Seems we need to restart repo\n-cd releng\\third-party\n-echo \"======== Starting p2 repo ===================\"\n-start \/B cmd \/C \"mvn jetty:run\"\n-cd ..\\..\\core\n-REM Seems we need to re-install core\n-echo \"======== Installing core ====================\"\n-call mvn install\n-cd ..\n-echo \"======== Running application tests ==========\"\n-mvn verify\n-echo \"======== Finished ===========================\"\n@@ -15,0 +3,5 @@\n+rem Note that core must have been installed, and the p2 repo started\n+rem before running this.\n+echo \"======== Building and testing application ===\"\n+call mvn %MAVENPARAMS% verify || EXIT \/B 3\n+echo \"======== Finished ===========================\"\n","filename":"scripts\/runapptests.bat","additions":5,"deletions":12,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,0 @@\n-\n@@ -4,0 +3,1 @@\n+\n@@ -6,2 +6,2 @@\n-echo \"======== Running application tests ==========\"\n-sh -c \"mvn verify\"\n+echo \"======== Building and testing application ===\"\n+sh -c \"mvn ${MAVENPARAMS} verify\"\n@@ -9,1 +9,0 @@\n-\n","filename":"scripts\/runapptests.sh","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,2 @@\n-echo \"======== Running core tests =================\"\n+\n+echo \"======== Installing and testing core ========\"\n@@ -4,1 +5,1 @@\n-mvn verify\n+call mvn %MAVENPARAMS% install || EXIT \/B 2\n@@ -6,1 +7,0 @@\n-\n","filename":"scripts\/runcoretests.bat","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,0 @@\n-\n@@ -4,1 +3,2 @@\n-echo \"======== Running core tests =================\"\n+\n+echo \"======== Installing and testing core ========\"\n@@ -6,1 +6,1 @@\n-mvn verify\n+sh -c \"mvn ${MAVENPARAMS} install\"\n@@ -8,1 +8,0 @@\n-\n","filename":"scripts\/runcoretests.sh","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -0,0 +1,8 @@\n+@echo off\n+\n+echo \"======== Building p2 repo ===================\"\n+cd releng\\third-party\n+call mvn %MAVENPARAMS% p2:site || EXIT \/B 1\n+echo \"======== Starting p2 repo ===================\"\n+start \/B cmd \/C \"mvn %MAVENPARAMS% jetty:run\"\n+echo \"======== Done ===============================\"\n","filename":"scripts\/startp2.bat","additions":8,"deletions":0,"binary":false,"changes":8,"status":"added"},{"patch":"@@ -0,0 +1,9 @@\n+#!\/bin\/sh -l\n+set -e\n+\n+echo \"======== Building p2 repo ===================\"\n+cd releng\/third-party\n+sh -c \"mvn ${MAVENPARAMS} p2:site\"\n+echo \"======== Starting p2 repo ===================\"\n+sh -c \"nohup mvn ${MAVENPARAMS} jetty:run &\"\n+echo \"======== Done ===============================\"\n","filename":"scripts\/startp2.sh","additions":9,"deletions":0,"binary":false,"changes":9,"status":"added"}]}