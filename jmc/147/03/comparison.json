{"files":[{"patch":"@@ -45,0 +45,3 @@\n+\n+# logs generated by build.bat script\n+*.log\n\\ No newline at end of file\n","filename":".gitignore","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -0,0 +1,138 @@\n+@echo off\n+@title %0\n+\n+@setlocal\n+\n+@REM checkPreconditions\n+where mvn > NUL\n+if not %ERRORLEVEL% == 0 (\n+\techo It seems you do not have maven installed. Please ensure you have it installed and executable as \"mvn\".\n+\texit \/B 1\n+)\n+\n+where java > NUL\n+if not %ERRORLEVEL% == 0 (\n+\techo It seems you do not have java installed. Please ensure you have it installed and executable as \"java\".\n+\texit \/B 1\n+)\n+if not exist target (\n+\tmd target\n+)\n+\n+:preconditions_ok\n+if not \"%*\" == \"\" goto parse_args\n+\n+:print_usage\n+echo usage: call %0 with the following options:\n+echo \t--test\tto run the tests\n+echo \t--testUi\tto run the tests including UI tests\n+echo \t--packageJmc\tto package JMC\n+echo \t--clean\tto run maven clean\n+echo \t--run\tto run JMC once it was packaged\n+echo \t--help\tto show this help dialog\n+exit \/B 0\n+\n+:parse_args\n+if \"%1\" == \"--help\" goto print_usage\n+if \"%1\" == \"--test\" goto test\n+if \"%1\" == \"--testUi\" goto testUi\n+if \"%1\" == \"--packageJmc\" goto packageJmc\n+if \"%1\" == \"--clean\" goto clean\n+if \"%1\" == \"--run\" goto run\n+echo unknown argument %1\n+goto print_usage\n+\n+:startJetty\n+for \/f \"skip=1\" %%A in ('wmic os get localdatetime ^| findstr .') do (set LOCALDATETIME=%%A)\n+set TIMESTAMP=%LOCALDATETIME:~0,14%\n+set P2_SITE_LOG=%cd%\\build_%TIMESTAMP%.1.p2_site.log\n+set JETTY_LOG=%cd%\\build_%TIMESTAMP%.2.jetty.log\n+set INSTALL_LOG=%cd%\\build_%TIMESTAMP%.3.install.log\n+echo %time% building p2:site - logging output to %P2_SITE_LOG%\n+call mvn -f releng\\third-party\\pom.xml p2:site --log-file \"%P2_SITE_LOG%\"\n+if not %ERRORLEVEL% == 0 (\n+\techo p2:site build failed!\n+\texit \/B 1\n+)\n+echo %time% run jetty - logging output to %JETTY_LOG%\n+start \"%1\" cmd \/C \"mvn -f releng\\third-party\\pom.xml jetty:run --log-file %JETTY_LOG%\"\n+:wait_jetty\n+echo Waiting for jetty server to start\n+timeout \/t 1\n+findstr \"[INFO] Started Jetty Server\" %JETTY_LOG%\n+if not %ERRORLEVEL% == 0 goto :wait_jetty\n+echo %time% jetty server up and running\n+echo %time% installing core artifacts - logging output to %INSTALL_LOG%\n+call mvn -f core\\pom.xml clean install --log-file \"%INSTALL_LOG%\"\n+if not %ERRORLEVEL% == 0 (\n+\tcall :killJetty %1\n+\techo installing core artifacts failed!\n+\texit \/B 1\n+)\n+exit \/B 0\n+\n+@REM Kill the console based on title passed as first arg (%1)\n+@REM tasklist gives us the pid, and using unique id on window title to filter the list\n+:killJetty\n+echo kill jetty\n+for \/F \"tokens=2 delims=,\" %%R in ('tasklist \/FI \"Windowtitle eq %1\" \/NH \/FO csv') do (\n+\ttaskkill \/PID %%R\n+)\n+exit \/B 0\n+\n+:test\n+echo %time% running tests\n+call mvn verify\n+goto end\n+\n+:testUi\n+@REM generate a unique id for window title\n+@REM allow to filter uniquely to get PID associated later\n+set JETTY_TITLE=jmc-jetty-%time%\n+call :startJetty %JETTY_TITLE%\n+if not %ERRORLEVEL% == 0 (\n+\texit \/B 1\n+)\n+echo %time% running UI tests\n+call mvn verify -P uitests\n+call :killJetty %JETTY_TITLE%\n+goto end\n+\n+:packageJmc\n+@REM generate a unique id for window title\n+@REM allow to filter uniquely to get PID associated later\n+set JETTY_TITLE=jmc-jetty-%time%\n+call :startJetty %JETTY_TITLE%\n+if not %ERRORLEVEL% == 0 (\n+\texit \/B 1\n+)\n+for \/f \"skip=1\" %%A in ('wmic os get localdatetime ^| findstr .') do (set LOCALDATETIME=%%A)\n+set TIMESTAMP=%LOCALDATETIME:~0,14%\n+set PACKAGE_LOG=%cd%\\build_%TIMESTAMP%.4.package.log\n+echo %time% packaging jmc - logging output to %PACKAGE_LOG%\n+call mvn package --log-file \"%PACKAGE_LOG%\"\n+if %ERRORLEVEL% == 0 echo You can now run jmc by calling \"%0 --run\" or \"%cd%\\target\\products\\org.openjdk.jmc\\win32\\win32\\x86_64\\JDK Mission Control\\jmc.exe\"\n+call :killJetty %JETTY_TITLE%\n+goto end\n+\n+:clean\n+echo %time% running clean up\n+call mvn clean\n+cd core\n+call mvn clean\n+cd ..\n+cd releng\\third-party\n+call mvn clean\n+cd ..\\..\n+goto end\n+\n+:run\n+set JMC_EXE=%cd%\\target\\products\\org.openjdk.jmc\\win32\\win32\\x86_64\\JDK Mission Control\\jmc.exe\n+if exist \"%JMC_EXE%\" (\n+\tstart \/B cmd \/c \"%JMC_EXE%\"\n+) else (\n+\techo JMC not found in \\\"%JMC_EXE%\\\". Did you call --packageJmc before?\n+) \n+goto end\n+\n+:end\n\\ No newline at end of file\n","filename":"build.bat","additions":138,"deletions":0,"binary":false,"changes":138,"status":"added"}]}