{"files":[{"patch":"@@ -58,0 +58,1 @@\n+import java.util.ArrayList;\n@@ -59,1 +60,1 @@\n-import java.util.concurrent.Callable;\n+import java.util.List;\n@@ -65,1 +66,0 @@\n-import java.util.concurrent.Future;\n@@ -158,1 +158,2 @@\n-\tprivate static final ExecutorService MODEL_EXECUTOR = Executors.newFixedThreadPool(1);\n+\tprivate static final int MODEL_EXECUTOR_THREADS_NUMBER = 3;\n+\tprivate static final ExecutorService MODEL_EXECUTOR = Executors.newFixedThreadPool(MODEL_EXECUTOR_THREADS_NUMBER);\n@@ -170,2 +171,3 @@\n-\tprivate ModelRebuildCallable modelRebuildCallable;\n-\tprivate Future<Void> modelCalculationFuture;\n+\tprivate int activeModelRebuildThread;\n+\tprivate List<ModelRebuildRunable> modelRebuildRunnableList = new ArrayList<ModelRebuildRunable>(\n+\t\t\tMODEL_EXECUTOR_THREADS_NUMBER);\n@@ -193,1 +195,1 @@\n-\t\tINIT, CALCULATION, READY, ABORTED, NONE;\n+\t\tNOT_STARTED, STARTED, FINISHED, NONE;\n@@ -282,1 +284,1 @@\n-\tprivate static class ModelRebuildCallable implements Callable<Void> {\n+\tprivate static class ModelRebuildRunable implements Runnable {\n@@ -288,1 +290,1 @@\n-\t\tprivate ModelRebuildCallable(FlameGraphView view, IItemCollection items) {\n+\t\tprivate ModelRebuildRunable(FlameGraphView view, IItemCollection items) {\n@@ -298,2 +300,2 @@\n-\t\tpublic Void call() throws Exception {\n-\t\t\tview.modelState = ModelState.CALCULATION;\n+\t\tpublic void run() {\n+\t\t\tview.modelState = ModelState.STARTED;\n@@ -303,1 +305,1 @@\n-\t\t\t\treturn abort();\n+\t\t\t\treturn;\n@@ -306,0 +308,3 @@\n+\t\t\tif (isInvalid) {\n+\t\t\t\treturn;\n+\t\t\t}\n@@ -308,1 +313,1 @@\n-\t\t\t\treturn abort();\n+\t\t\t\treturn;\n@@ -310,1 +315,1 @@\n-\t\t\t\tview.modelState = ModelState.READY;\n+\t\t\t\tview.modelState = ModelState.FINISHED;\n@@ -312,1 +317,0 @@\n-\t\t\t\treturn null;\n@@ -315,5 +319,0 @@\n-\n-\t\tprivate Void abort() {\n-\t\t\tview.modelState = ModelState.ABORTED;\n-\t\t\treturn null;\n-\t\t}\n@@ -392,3 +391,3 @@\n-\t\tif (modelCalculationFuture != null) {\n-\t\t\tmodelRebuildCallable.setInvalid();\n-\t\t\tmodelCalculationFuture.cancel(true);\n+\t\tif (!modelRebuildRunnableList.isEmpty()) {\n+\t\t\tmodelRebuildRunnableList.get(activeModelRebuildThread).setInvalid();\n+\t\t\tactiveModelRebuildThread = ++activeModelRebuildThread % MODEL_EXECUTOR_THREADS_NUMBER;\n@@ -397,1 +396,0 @@\n-\t\tmodelState = ModelState.INIT;\n@@ -399,2 +397,5 @@\n-\t\tmodelRebuildCallable = new ModelRebuildCallable(this, items);\n-\t\tmodelCalculationFuture = MODEL_EXECUTOR.submit(modelRebuildCallable);\n+\t\tmodelState = ModelState.NOT_STARTED;\n+\t\tmodelRebuildRunnableList.add(activeModelRebuildThread, new ModelRebuildRunable(this, items));\n+\t\tif (!modelRebuildRunnableList.get(activeModelRebuildThread).isInvalid) {\n+\t\t\tMODEL_EXECUTOR.execute(modelRebuildRunnableList.get(activeModelRebuildThread));\n+\t\t}\n@@ -404,1 +405,1 @@\n-\t\tif (ModelState.READY.equals(modelState) && items.equals(currentItems) && !browser.isDisposed()) {\n+\t\tif (ModelState.FINISHED.equals(modelState) && items.equals(currentItems) && !browser.isDisposed()) {\n@@ -499,1 +500,1 @@\n-\tprivate StringBuilder toJSonModel(TraceNode root, ModelRebuildCallable rebuildCallable) {\n+\tprivate StringBuilder toJSonModel(TraceNode root, ModelRebuildRunable rebuildCallable) {\n@@ -508,1 +509,1 @@\n-\tprivate static void render(StringBuilder builder, TraceNode node, ModelRebuildCallable rebuildCallable) {\n+\tprivate static void render(StringBuilder builder, TraceNode node, ModelRebuildRunable rebuildCallable) {\n@@ -516,1 +517,1 @@\n-\tprivate static void renderChildren(StringBuilder builder, TraceNode node, ModelRebuildCallable rebuildCallable) {\n+\tprivate static void renderChildren(StringBuilder builder, TraceNode node, ModelRebuildRunable rebuildCallable) {\n","filename":"application\/org.openjdk.jmc.flightrecorder.flameview\/src\/main\/java\/org\/openjdk\/jmc\/flightrecorder\/flameview\/views\/FlameGraphView.java","additions":30,"deletions":29,"binary":false,"changes":59,"status":"modified"}]}