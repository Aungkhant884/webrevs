{"files":[{"patch":"@@ -51,0 +51,1 @@\n+application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/jslibs\/\n","filename":".gitignore","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -202,0 +202,6 @@\n+   <plugin\n+         id=\"org.openjdk.jmc.flightrecorder.hierarchical-edge\"\n+         download-size=\"0\"\n+         install-size=\"0\"\n+         version=\"0.0.0\"\n+         unpack=\"false\"\/>\n","filename":"application\/org.openjdk.jmc.feature.flightrecorder\/feature.xml","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,12 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<classpath>\n+\t<classpathentry kind=\"src\" path=\"src\/main\/java\"\/>\n+\t<classpathentry kind=\"src\" path=\"src\/main\/resources\"\/>\n+\t<classpathentry kind=\"con\" path=\"org.eclipse.pde.core.requiredPlugins\"\/>\n+\t<classpathentry kind=\"con\" path=\"org.eclipse.jdt.launching.JRE_CONTAINER\">\n+\t\t<attributes>\n+\t\t\t<attribute name=\"module\" value=\"true\"\/>\n+\t\t<\/attributes>\n+\t<\/classpathentry>\n+\t<classpathentry kind=\"output\" path=\"target\/classes\"\/>\n+<\/classpath>\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/.classpath","additions":12,"deletions":0,"binary":false,"changes":12,"status":"added"},{"patch":"@@ -3,1 +3,1 @@\n-\t<name>org.openjdk.jmc.browser.attach.ja<\/name>\n+\t<name>org.openjdk.jmc.flightrecorder.hierarchical-edge<\/name>\n@@ -31,1 +31,0 @@\n-\t\t<nature>org.eclipse.pde.PluginNature<\/nature>\n@@ -33,0 +32,1 @@\n+\t\t<nature>org.eclipse.pde.PluginNature<\/nature>\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/.project","additions":2,"deletions":2,"binary":false,"changes":4,"previous_filename":"application\/l10n\/org.openjdk.jmc.browser.attach.ja\/.project","status":"copied"},{"patch":"@@ -0,0 +1,12 @@\n+Manifest-Version: 1.0\n+Bundle-ManifestVersion: 2\n+Bundle-Name: Heatmap\n+Bundle-SymbolicName: org.openjdk.jmc.flightrecorder.hierarchical-edge;singleton:=true\n+Bundle-Version: 8.3.0.qualifier\n+Require-Bundle: org.openjdk.jmc.flightrecorder,\n+ org.openjdk.jmc.flightrecorder.ui,\n+ org.openjdk.jmc.flightrecorder.serializers,\n+ org.apiguardian\n+Bundle-RequiredExecutionEnvironment: JavaSE-1.8\n+Automatic-Module-Name: org.openjdk.jmc.flightrecorder.hierarchical-edge\n+Bundle-Vendor: Oracle Corporation\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/META-INF\/MANIFEST.MF","additions":12,"deletions":0,"binary":false,"changes":12,"status":"added"},{"patch":"@@ -0,0 +1,10 @@\n+source.. = src\/main\/java\/,\\\n+           src\/main\/resources\/,\\\n+           src\/test\/java\/\n+output.. = target\/classes\/\n+bin.includes = META-INF\/,\\\n+               .,\\\n+               plugin.xml,\\\n+               plugin.properties,\\\n+               icons\/\n+pde.match.rule.bundle=compatible\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/build.properties","additions":10,"deletions":0,"binary":false,"changes":10,"status":"added"},{"patch":"","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/icons\/flameflip.png","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.flameview\/icons\/flameflip.png","status":"copied"},{"patch":"","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/icons\/flameflip@2x.png","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.flameview\/icons\/flameflip@2x.png","status":"copied"},{"filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/icons\/hierarchical.png","binary":true,"status":"added"},{"filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/icons\/hierarchical@2x.png","binary":true,"status":"added"},{"patch":"","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/icons\/icicleflip.png","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.flameview\/icons\/icicleflip.png","status":"copied"},{"patch":"","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/icons\/icicleflip@2x.png","additions":0,"deletions":0,"binary":false,"changes":0,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.flameview\/icons\/icicleflip@2x.png","status":"copied"},{"patch":"@@ -2,2 +2,2 @@\n-#  Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n-#  Copyright (c) 2019, Datadog, Inc. All rights reserved.\n+#  Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2022, Datadog, Inc. All rights reserved.\n@@ -34,1 +34,1 @@\n-FLAME_VIEW_NAME=Flame View\n+HIERARCHICAL_EDGE=Hierarchical Edge\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/plugin.properties","additions":3,"deletions":3,"binary":false,"changes":6,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.flameview\/plugin.properties","status":"copied"},{"patch":"@@ -0,0 +1,15 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<?eclipse version=\"3.2\"?>\n+<plugin>\n+\t<extension point=\"org.eclipse.ui.views\">\n+\t\t<view\n+          allowMultiple=\"false\"\n+          category=\"org.openjdk.jmc.ui.main\"\n+          class=\"org.openjdk.jmc.flightrecorder.hierarchical.views.HierarchicalEdgeView\"\n+          icon=\"icons\/hierarchical.png\"\n+          id=\"org.openjdk.jmc.flightrecorder.hierarchical-edge\"\n+          name=\"Hierarchical Edge View\"\n+          restorable=\"true\">\n+\t\t<\/view>\n+\t<\/extension>\n+<\/plugin>\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/plugin.xml","additions":15,"deletions":0,"binary":false,"changes":15,"status":"added"},{"patch":"@@ -3,3 +3,2 @@\n-   Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n-   Copyright (c) 2021, Datadog, Inc. All rights reserved.\n-\n+   Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+   Copyright (c) 2022, Datadog, Inc. All rights reserved.\n@@ -7,1 +6,0 @@\n-\n@@ -10,1 +8,0 @@\n-\n@@ -12,1 +9,0 @@\n-\n@@ -15,1 +11,0 @@\n-\n@@ -18,1 +13,0 @@\n-\n@@ -22,1 +16,0 @@\n-\n@@ -25,1 +18,0 @@\n-\n@@ -43,1 +35,1 @@\n-\t<artifactId>org.openjdk.jmc.flightrecorder.heatmap<\/artifactId>\n+\t<artifactId>org.openjdk.jmc.flightrecorder.hierarchical-edge<\/artifactId>\n@@ -79,1 +71,1 @@\n-<\/project>\n+<\/project>\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/pom.xml","additions":4,"deletions":12,"binary":false,"changes":16,"previous_filename":"application\/org.openjdk.jmc.flightrecorder.heatmap\/pom.xml","status":"copied"},{"patch":"@@ -0,0 +1,58 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, Datadog, Inc. All rights reserved.\n+ *\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ *\n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.flightrecorder.hierarchical;\n+\n+import java.util.MissingResourceException;\n+import java.util.ResourceBundle;\n+\n+public class Messages {\n+\tprivate static final String BUNDLE_NAME = \"org.openjdk.jmc.flightrecorder.hierarchical.messages\"; \/\/$NON-NLS-1$\n+\n+\tprivate static final ResourceBundle RESOURCE_BUNDLE = ResourceBundle.getBundle(BUNDLE_NAME);\n+\n+\tpublic static final String HIERARCHICAL_PACKAGE_LEVEL_DEPTH = \"HIERARCHICAL_PACKAGE_LEVEL_DEPTH\"; \/\/$NON-NLS-1$\n+\tpublic static final String HIERARCHICAL_EDGE_BUNDLING_DIAGRAM = \"HIERARCHICAL_EDGE_BUNDLING_DIAGRAM\"; \/\/$NON-NLS-1$\n+\tpublic static final String HIERARCHICAL_CHORD_DIAGRAM = \"HIERARCHICAL_CHORD_DIAGRAM\"; \/\/$NON-NLS-1$\n+\n+\tprivate Messages() {\n+\t}\n+\n+\tpublic static String getString(String key) {\n+\t\ttry {\n+\t\t\treturn RESOURCE_BUNDLE.getString(key);\n+\t\t} catch (MissingResourceException e) {\n+\t\t\treturn '!' + key + '!';\n+\t\t}\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/java\/org\/openjdk\/jmc\/flightrecorder\/hierarchical\/Messages.java","additions":58,"deletions":0,"binary":false,"changes":58,"status":"added"},{"patch":"@@ -0,0 +1,391 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, Datadog, Inc. All rights reserved.\n+ *\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * The contents of this file are subject to the terms of either the Universal Permissive License\n+ * v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+ *\n+ * or the following license:\n+ *\n+ * Redistribution and use in source and binary forms, with or without modification, are permitted\n+ * provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+ * and the following disclaimer.\n+ *\n+ * 2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+ * conditions and the following disclaimer in the documentation and\/or other materials provided with\n+ * the distribution.\n+ *\n+ * 3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+ * endorse or promote products derived from this software without specific prior written permission.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+ * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+ * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+ * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ *\/\n+package org.openjdk.jmc.flightrecorder.hierarchical.views;\n+\n+import java.io.BufferedInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.text.MessageFormat;\n+import java.util.List;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ThreadFactory;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import java.util.stream.Stream;\n+\n+import org.eclipse.jface.action.Action;\n+import org.eclipse.jface.action.ActionContributionItem;\n+import org.eclipse.jface.action.IAction;\n+import org.eclipse.jface.action.IMenuCreator;\n+import org.eclipse.jface.action.IToolBarManager;\n+import org.eclipse.jface.action.Separator;\n+import org.eclipse.jface.resource.ImageDescriptor;\n+import org.eclipse.jface.resource.ResourceLocator;\n+import org.eclipse.jface.viewers.ISelection;\n+import org.eclipse.jface.viewers.IStructuredSelection;\n+import org.eclipse.swt.SWT;\n+import org.eclipse.swt.browser.Browser;\n+import org.eclipse.swt.browser.ProgressAdapter;\n+import org.eclipse.swt.browser.ProgressEvent;\n+import org.eclipse.swt.custom.SashForm;\n+import org.eclipse.swt.events.MenuDetectEvent;\n+import org.eclipse.swt.events.MenuDetectListener;\n+import org.eclipse.swt.widgets.Composite;\n+import org.eclipse.swt.widgets.Control;\n+import org.eclipse.swt.widgets.Menu;\n+import org.eclipse.ui.IMemento;\n+import org.eclipse.ui.ISelectionListener;\n+import org.eclipse.ui.IViewSite;\n+import org.eclipse.ui.IWorkbenchPart;\n+import org.eclipse.ui.PartInitException;\n+import org.eclipse.ui.part.ViewPart;\n+import org.openjdk.jmc.common.item.IItemCollection;\n+import org.openjdk.jmc.common.item.ItemCollectionToolkit;\n+import org.openjdk.jmc.common.util.Pair;\n+import org.openjdk.jmc.common.util.StringToolkit;\n+import org.openjdk.jmc.flightrecorder.hierarchical.Messages;\n+import org.openjdk.jmc.flightrecorder.serializers.json.IItemCollectionJsonSerializer;\n+import org.openjdk.jmc.flightrecorder.ui.FlightRecorderUI;\n+import org.openjdk.jmc.ui.common.util.AdapterUtil;\n+import org.openjdk.jmc.ui.misc.DisplayToolkit;\n+\n+public class HierarchicalEdgeView extends ViewPart implements ISelectionListener {\n+\tprivate static final String DIR_ICONS = \"icons\/\"; \/\/$NON-NLS-1$\n+\tprivate static final String PLUGIN_ID = \"org.openjdk.jmc.flightrecorder.hierarchical-edge\"; \/\/$NON-NLS-1$\n+\tprivate static final String HTML_PAGE;\n+\tstatic {\n+\t\tString jsD3V6 = \"jslibs\/d3.v6.min.js\";\n+\t\tHTML_PAGE = String.format(\n+\t\t\t\tloadStringFromFile(\"page.template\"),\n+\t\t\t\tloadLibraries(jsD3V6),\n+\t\t\t\tloadStringFromFile(\"main.js\"),\n+\t\t\t\tloadStringFromFile(\"utils.js\"),\n+\t\t\t\tloadStringFromFile(\"hierarchical-edge.js\"),\n+\t\t\t\tloadStringFromFile(\"chord.js\"));\n+\t}\n+\n+\tprivate enum ModelState {\n+\t\tNOT_STARTED, STARTED, FINISHED, NONE;\n+\t}\n+\n+\tprivate static class ModelRebuildRunnable implements Runnable {\n+\t\tprivate final HierarchicalEdgeView view;\n+\t\tprivate final IItemCollection items;\n+\t\tprivate volatile boolean isInvalid;\n+\t\tprivate final int packageDepth;\n+\n+\t\tprivate ModelRebuildRunnable(HierarchicalEdgeView view, IItemCollection items, int packageDepth) {\n+\t\t\tthis.view = view;\n+\t\t\tthis.items = items;\n+\t\t\tthis.packageDepth = packageDepth;\n+\t\t}\n+\n+\t\tprivate void setInvalid() {\n+\t\t\tthis.isInvalid = true;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic void run() {\n+\t\t\tview.modelState = ModelState.STARTED;\n+\t\t\tif (isInvalid) {\n+\t\t\t\treturn;\n+\t\t\t}\n+\t\t\tString eventsJson = IItemCollectionJsonSerializer.toJsonString(items);\n+\t\t\tif (isInvalid) {\n+\t\t\t\treturn;\n+\t\t\t} else {\n+\t\t\t\tview.modelState = ModelState.FINISHED;\n+\t\t\t\tDisplayToolkit.inDisplayThread().execute(() -> view.setModel(items, eventsJson, packageDepth));\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate enum DependencyChartType {\n+\t\tEDGE_BUNDLING(Messages.getString(Messages.HIERARCHICAL_EDGE_BUNDLING_DIAGRAM), IAction.AS_RADIO_BUTTON, hierarchicalEdgeImageDescriptor(\"flameflip.png\")),\n+\t\tCHORD(Messages.getString(Messages.HIERARCHICAL_CHORD_DIAGRAM), IAction.AS_RADIO_BUTTON, hierarchicalEdgeImageDescriptor(\"icicleflip.png\"));\n+\n+\t\tprivate final String message;\n+\t\tprivate final int action;\n+\t\tprivate final ImageDescriptor imageDescriptor;\n+\n+\t\tprivate DependencyChartType(String message, int action, ImageDescriptor imageDescriptor) {\n+\t\t\tthis.message = message;\n+\t\t\tthis.action = action;\n+\t\t\tthis.imageDescriptor = imageDescriptor;\n+\t\t}\n+\t}\n+\n+\tprivate class ChangeChartTypeAction extends Action {\n+\t\tprivate final DependencyChartType type;\n+\n+\t\tChangeChartTypeAction(DependencyChartType type) {\n+\t\t\tsuper(type.message, type.action);\n+\t\t\tthis.type = type;\n+\t\t\tsetToolTipText(type.message);\n+\t\t\tsetImageDescriptor(type.imageDescriptor);\n+\t\t\tsetChecked(DependencyChartType.EDGE_BUNDLING.equals(type));\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic void run() {\n+\t\t\tif (this.isChecked()) {\n+\t\t\t\tchartType = type;\n+\t\t\t\tString eventsJson = IItemCollectionJsonSerializer.toJsonString(currentItems);\n+\t\t\t\tbrowser.execute(String.format(\"updateGraph(`%s`, %d, `%s`);\", eventsJson, packageDepth, chartType.name()));\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate static ImageDescriptor hierarchicalEdgeImageDescriptor(String iconName) {\n+\t\treturn ResourceLocator.imageDescriptorFromBundle(PLUGIN_ID, DIR_ICONS + iconName).orElse(null); \/\/$NON-NLS-1$\n+\t}\n+\n+\tprivate static final int MODEL_EXECUTOR_THREADS_NUMBER = 3;\n+\tprivate static final ExecutorService MODEL_EXECUTOR = Executors.newFixedThreadPool(MODEL_EXECUTOR_THREADS_NUMBER,\n+\t\t\tnew ThreadFactory() {\n+\t\t\t\tprivate ThreadGroup group = new ThreadGroup(\"HierarchicalEdgeCalculationGroup\");\n+\t\t\t\tprivate AtomicInteger counter = new AtomicInteger();\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic Thread newThread(Runnable r) {\n+\t\t\t\t\tThread t = new Thread(group, r, \"HierarchicalEdgeCalculation-\" + counter.getAndIncrement());\n+\t\t\t\t\tt.setDaemon(true);\n+\t\t\t\t\treturn t;\n+\t\t\t\t}\n+\t\t\t});\n+\tprivate Browser browser;\n+\tprivate SashForm container;\n+\tprivate IItemCollection currentItems;\n+\tprivate volatile ModelState modelState = ModelState.NONE;\n+\tprivate ModelRebuildRunnable modelRebuildRunnable;\n+\tprivate int packageDepth = 3;\n+\tprivate DependencyChartType chartType = DependencyChartType.EDGE_BUNDLING;\n+\n+\t@Override\n+\tpublic void init(IViewSite site, IMemento memento) throws PartInitException {\n+\t\tsuper.init(site, memento);\n+\t\tIToolBarManager toolBar = site.getActionBars().getToolBarManager();\n+\t\tChangeChartTypeAction[] chartTypeActions = new ChangeChartTypeAction[] {\n+\t\t\t\tnew ChangeChartTypeAction(DependencyChartType.EDGE_BUNDLING),\n+\t\t\t\tnew ChangeChartTypeAction(DependencyChartType.CHORD)\n+\t\t};\n+\t\tStream.of(chartTypeActions).forEach(toolBar::add);\n+\t\ttoolBar.add(new Separator());\n+\t\ttoolBar.add(new PackageDepthSelection());\n+\t\tgetSite().getPage().addSelectionListener(this);\n+\t}\n+\n+\t@Override\n+\tpublic void dispose() {\n+\t\tgetSite().getPage().removeSelectionListener(this);\n+\t\tsuper.dispose();\n+\t}\n+\n+\tprivate class PackageDepthSelection extends Action implements IMenuCreator {\n+\t\tprivate Menu menu;\n+\t\tprivate final List<Pair<String, Integer>> depths = IntStream.of(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)\n+\t\t\t\t.mapToObj(i -> new Pair<>(Integer.toString(i), i)).collect(Collectors.toUnmodifiableList());\n+\n+\t\tPackageDepthSelection() {\n+\t\t\tsuper(Messages.getString(Messages.HIERARCHICAL_PACKAGE_LEVEL_DEPTH), IAction.AS_DROP_DOWN_MENU);\n+\t\t\tsetMenuCreator(this);\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic void dispose() {\n+\t\t\t\/\/ do nothing\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic Menu getMenu(Control parent) {\n+\t\t\tif (menu == null) {\n+\t\t\t\tmenu = new Menu(parent);\n+\t\t\t\tpopulate(menu);\n+\t\t\t}\n+\t\t\treturn menu;\n+\t\t}\n+\n+\t\t@Override\n+\t\tpublic Menu getMenu(Menu parent) {\n+\t\t\tif (menu == null) {\n+\t\t\t\tmenu = new Menu(parent);\n+\t\t\t\tpopulate(menu);\n+\t\t\t}\n+\t\t\treturn menu;\n+\t\t}\n+\n+\t\tprivate void populate(Menu menu) {\n+\t\t\tfor (Pair<String, Integer> item : depths) {\n+\t\t\t\tvar actionItem = new ActionContributionItem(new SetPackageDepth(item, item.right == packageDepth));\n+\t\t\t\tactionItem.fill(menu, -1);\n+\t\t\t}\n+\t\t}\n+\n+\t\tprivate class SetPackageDepth extends Action {\n+\t\t\tprivate int value;\n+\n+\t\t\tSetPackageDepth(Pair<String, Integer> item, boolean isSelected) {\n+\t\t\t\tsuper(item.left, IAction.AS_RADIO_BUTTON);\n+\t\t\t\tthis.value = item.right;\n+\t\t\t\tsetChecked(isSelected);\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic void run() {\n+\t\t\t\tif (packageDepth != value) {\n+\t\t\t\t\tpackageDepth = value;\n+\t\t\t\t\ttriggerRebuildTask(currentItems);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic void createPartControl(Composite parent) {\n+\t\tcontainer = new SashForm(parent, SWT.HORIZONTAL);\n+\t\tbrowser = new Browser(container, SWT.NONE);\n+\t\tcontainer.setMaximizedControl(browser);\n+\t\tbrowser.addMenuDetectListener(new MenuDetectListener() {\n+\t\t\t@Override\n+\t\t\tpublic void menuDetected(MenuDetectEvent e) {\n+\t\t\t\te.doit = false;\n+\t\t\t}\n+\t\t});\n+\t}\n+\n+\t@Override\n+\tpublic void setFocus() {\n+\t\tbrowser.setFocus();\n+\t}\n+\n+\t@Override\n+\tpublic void saveState(IMemento memento) {\n+\t}\n+\n+\t@Override\n+\tpublic void selectionChanged(IWorkbenchPart part, ISelection selection) {\n+\t\tif (selection instanceof IStructuredSelection) {\n+\t\t\tObject first = ((IStructuredSelection) selection).getFirstElement();\n+\t\t\tIItemCollection items = AdapterUtil.getAdapter(first, IItemCollection.class);\n+\t\t\tif (items == null) {\n+\t\t\t\ttriggerRebuildTask(ItemCollectionToolkit.build(Stream.empty()));\n+\t\t\t} else if (!items.equals(currentItems)) {\n+\t\t\t\ttriggerRebuildTask(items);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate void triggerRebuildTask(IItemCollection items) {\n+\t\t\/\/ Release old model calculation before building a new\n+\t\tif (modelRebuildRunnable != null) {\n+\t\t\tmodelRebuildRunnable.setInvalid();\n+\t\t}\n+\n+\t\tcurrentItems = items;\n+\t\tmodelState = ModelState.NOT_STARTED;\n+\t\tmodelRebuildRunnable = new ModelRebuildRunnable(this, items, packageDepth);\n+\t\tif (!modelRebuildRunnable.isInvalid) {\n+\t\t\tMODEL_EXECUTOR.execute(modelRebuildRunnable);\n+\t\t}\n+\t}\n+\n+\tprivate void setModel(final IItemCollection items, final String eventsJson, int packageDepth) {\n+\t\tif (ModelState.FINISHED.equals(modelState) && items.equals(currentItems) && !browser.isDisposed()) {\n+\t\t\tsetViewerInput(eventsJson, packageDepth);\n+\t\t}\n+\t}\n+\n+\tprivate void setViewerInput(String eventsJson, int packageDepth) {\n+\t\tbrowser.setText(HTML_PAGE);\n+\t\tbrowser.addListener(SWT.Resize, event -> {\n+\t\t\tbrowser.execute(String.format(\"updateGraph(`%s`, %d, `%s`);\", eventsJson, packageDepth, chartType.name()));\n+\t\t});\n+\n+\t\tbrowser.addProgressListener(new ProgressAdapter() {\n+\t\t\tprivate boolean loaded = false;\n+\n+\t\t\t@Override\n+\t\t\tpublic void changed(ProgressEvent event) {\n+\t\t\t\tif (loaded) {\n+\t\t\t\t\tbrowser.removeProgressListener(this);\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic void completed(ProgressEvent event) {\n+\t\t\t\tbrowser.removeProgressListener(this);\n+\t\t\t\tbrowser.execute(String.format(\"updateGraph(`%s`, %d, `%s`);\", eventsJson, packageDepth, chartType.name()));\n+\t\t\t\tloaded = true;\n+\t\t\t}\n+\t\t});\n+\t}\n+\n+\tprivate static String loadLibraries(String... libs) {\n+\t\tif (libs == null || libs.length == 0) {\n+\t\t\treturn \"\";\n+\t\t} else {\n+\t\t\tStringBuilder builder = new StringBuilder(2048);\n+\t\t\tfor (String lib : libs) {\n+\t\t\t\tbuilder.append(loadStringFromFile(lib));\n+\t\t\t\tbuilder.append(\"\\n\");\n+\t\t\t}\n+\t\t\treturn builder.toString();\n+\t\t}\n+\t}\n+\n+\tprivate static String loadStringFromFile(String fileName) {\n+\t\ttry {\n+\t\t\treturn StringToolkit.readString(HierarchicalEdgeView.class.getClassLoader().getResourceAsStream(fileName));\n+\t\t} catch (IOException e) {\n+\t\t\tFlightRecorderUI.getDefault().getLogger().log(Level.WARNING,\n+\t\t\t\t\tMessageFormat.format(\"Could not load script \\\"{0}\\\",\\\"{1}\\\"\", fileName, e.getMessage())); \/\/$NON-NLS-1$\n+\t\t\treturn \"\";\n+\t\t}\n+\t}\n+\n+\tpublic static byte[] readBytes(InputStream in) throws IOException {\n+\t\tBufferedInputStream bis = new BufferedInputStream(in);\n+\t\tByteArrayOutputStream buf = new ByteArrayOutputStream();\n+\t\tint result = bis.read();\n+\t\twhile (result != -1) {\n+\t\t\tbuf.write((byte) result);\n+\t\t\tresult = bis.read();\n+\t\t}\n+\t\treturn buf.toByteArray();\n+\t}\n+}\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/java\/org\/openjdk\/jmc\/flightrecorder\/hierarchical\/views\/HierarchicalEdgeView.java","additions":391,"deletions":0,"binary":false,"changes":391,"status":"added"},{"patch":"@@ -0,0 +1,98 @@\n+function renderChordDiagram(data) {\n+\tconst svg = d3\n+\t\t.select(\"#hierarchical\")\n+\t\t.append(\"svg\")\n+\t\t.attr(\"viewBox\", [-width \/ 2, -height \/ 2, width, height]);\n+\n+\tconst innerRadius = Math.max(Math.min(width, height) * 0.5 - 90, 100);\n+\tconst outerRadius = innerRadius + 10;\n+\n+\tconst names = Array.from(\n+\t\tnew Set(data.flatMap((d) => [d.source, d.target]))\n+\t).sort(d3.ascending);\n+\tconst color = d3.scaleOrdinal(\n+\t\tnames,\n+\t\td3.quantize(d3.interpolateRainbow, names.length)\n+\t);\n+\n+\tconst chord = d3\n+\t\t.chordDirected()\n+\t\t.padAngle(10 \/ innerRadius)\n+\t\t.sortSubgroups(d3.descending)\n+\t\t.sortChords(d3.descending);\n+\n+\tconst arc = d3.arc().innerRadius(innerRadius).outerRadius(outerRadius);\n+\n+\tconst ribbon = d3\n+\t\t.ribbonArrow()\n+\t\t.radius(innerRadius - 1)\n+\t\t.padAngle(1 \/ innerRadius);\n+\n+\tconst matrix = buildMatrix(data, names);\n+\tconst chords = chord(matrix);\n+\n+\tconst group = svg\n+\t\t.append(\"g\")\n+\t\t.attr(\"font-size\", 10)\n+\t\t.attr(\"font-family\", \"sans-serif\")\n+\t\t.selectAll(\"g\")\n+\t\t.data(chords.groups)\n+\t\t.join(\"g\");\n+\n+\tgroup\n+\t\t.append(\"path\")\n+\t\t.attr(\"fill\", (d) => color(names[d.index]))\n+\t\t.attr(\"d\", arc);\n+\n+\tgroup\n+\t\t.append(\"text\")\n+\t\t.each((d) => (d.angle = (d.startAngle + d.endAngle) \/ 2))\n+\t\t.attr(\"dy\", \"0.35em\")\n+\t\t.attr(\n+\t\t\t\"transform\",\n+\t\t\t(d) => `\n+\t\t\t\trotate(${(d.angle * 180) \/ Math.PI - 90})\n+\t\t\t\ttranslate(${outerRadius + 5})\n+\t\t\t\t${d.angle > Math.PI ? \"rotate(180)\" : \"\"}\n+\t\t\t`\n+\t\t)\n+\t\t.attr(\"text-anchor\", (d) => (d.angle > Math.PI ? \"end\" : null))\n+\t\t.text((d) => names[d.index]);\n+\n+\tgroup.append(\"title\").text(\n+\t\t(d) => `${names[d.index]}\n+${d3.sum(\n+\tchords,\n+\t(c) => (c.source.index === d.index) * c.source.value\n+)} outgoing →\n+${d3.sum(\n+\tchords,\n+\t(c) => (c.target.index === d.index) * c.source.value\n+)} incoming ←`\n+\t);\n+\n+\tsvg\n+\t\t.append(\"g\")\n+\t\t.attr(\"fill-opacity\", 0.75)\n+\t\t.selectAll(\"path\")\n+\t\t.data(chords)\n+\t\t.join(\"path\")\n+\t\t.style(\"mix-blend-mode\", \"multiply\")\n+\t\t.attr(\"fill\", (d) => color(names[d.target.index]))\n+\t\t.attr(\"d\", ribbon)\n+\t\t.append(\"title\")\n+\t\t.text(\n+\t\t\t(d) =>\n+\t\t\t\t`${names[d.source.index]} → ${names[d.target.index]} ${d.source.value}`\n+\t\t);\n+\n+\treturn svg.node();\n+}\n+\n+function buildMatrix(data, names) {\n+\tconst index = new Map(names.map((name, i) => [name, i]));\n+\tconst matrix = Array.from(index, () => new Array(names.length).fill(0));\n+\tfor (const { source, target, value } of data)\n+\t\tmatrix[index.get(source)][index.get(target)] += value;\n+\treturn matrix;\n+}\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/chord.js","additions":98,"deletions":0,"binary":false,"changes":98,"status":"added"},{"patch":"@@ -0,0 +1,125 @@\n+function renderHierarchicalEdgeBundling(graph) {\n+\t\/\/ compute package hierarchy\n+\tconst svg = d3\n+\t\t.select(\"#hierarchical\")\n+\t\t.append(\"svg\")\n+\t\t.attr(\"viewBox\", [-width \/ 2, -height \/ 2, width, height]);\n+\tconst d3Hierarchy = d3\n+\t\t.hierarchy(graph.root)\n+\t\t.sort(\n+\t\t\t(a, b) =>\n+\t\t\t\td3.ascending(a.height, b.height) ||\n+\t\t\t\td3.ascending(a.data.name, b.data.name)\n+\t\t);\n+\t\/\/ we use the same formula as for the outerRadius in the chord diagram\n+\tconst radius = Math.max(Math.min(width, height) * 0.5 - 90, 100) + 10;\n+\tconst treeClustering = d3.cluster().size([2 * Math.PI, radius]);\n+\tconst root = treeClustering(bilink(d3Hierarchy));\n+\tconst colors = getColors();\n+\tconst node = svg\n+\t\t.append(\"g\")\n+\t\t.attr(\"font-family\", \"sans-serif\")\n+\t\t.attr(\"font-size\", 10)\n+\t\t.selectAll(\"g\")\n+\t\t.data(root.leaves())\n+\t\t.join(\"g\")\n+\t\t.attr(\n+\t\t\t\"transform\",\n+\t\t\t(d) => `rotate(${(d.x * 180) \/ Math.PI - 90}) translate(${d.y},0)`\n+\t\t)\n+\t\t.append(\"text\")\n+\t\t.attr(\"dy\", \"0.31em\")\n+\t\t.attr(\"x\", (d) => (d.x < Math.PI ? 6 : -6))\n+\t\t.attr(\"text-anchor\", (d) => (d.x < Math.PI ? \"start\" : \"end\"))\n+\t\t.attr(\"transform\", (d) => (d.x >= Math.PI ? \"rotate(180)\" : null))\n+\t\t.text((d) => d.data.name)\n+\t\t.each(function (d) {\n+\t\t\td.text = this;\n+\t\t})\n+\t\t.on(\"mouseover\", overed)\n+\t\t.on(\"mouseout\", outed)\n+\t\t.call((text) =>\n+\t\t\ttext.attr(\"fill\", colors.default).append(\"title\").text(formatTooltip)\n+\t\t);\n+\tconst line = d3\n+\t\t.lineRadial()\n+\t\t.curve(d3.curveBundle.beta(0.85))\n+\t\t.radius((d) => d.y)\n+\t\t.angle((d) => d.x);\n+\tconst link = svg\n+\t\t.append(\"g\")\n+\t\t.attr(\"stroke\", colors.link)\n+\t\t.attr(\"fill\", \"none\")\n+\t\t.selectAll(\"path\")\n+\t\t.data(root.leaves().flatMap((leaf) => leaf.outgoing))\n+\t\t.join(\"path\")\n+\t\t.style(\"mix-blend-mode\", \"multiply\")\n+\t\t.attr(\"d\", ([i, o]) => line(i.path(o)))\n+\t\t.each(function (d) {\n+\t\t\td.path = this;\n+\t\t});\n+\n+\tfunction overed(event, d) {\n+\t\tlink.style(\"mix-blend-mode\", null);\n+\t\td3.select(this)\n+\t\t\t.attr(\"font-weight\", \"bold\")\n+\t\t\t.attr(\"fill\", colors.hover)\n+\t\t\t.style(\"cursor\", \"default\");\n+\t\td3.selectAll(d.incoming.map((d) => d.path))\n+\t\t\t.attr(\"stroke\", colors.incoming)\n+\t\t\t.raise();\n+\t\td3.selectAll(d.incoming.map(([d]) => d.text))\n+\t\t\t.attr(\"fill\", colors.incoming)\n+\t\t\t.attr(\"font-weight\", \"bold\");\n+\t\td3.selectAll(d.outgoing.map((d) => d.path))\n+\t\t\t.attr(\"stroke\", colors.outgoing)\n+\t\t\t.raise();\n+\t\td3.selectAll(d.outgoing.map(([, d]) => d.text))\n+\t\t\t.attr(\"fill\", colors.outgoing)\n+\t\t\t.attr(\"font-weight\", \"bold\");\n+\n+\t\tconst both = intersection(d.incoming, d.outgoing);\n+\t\td3.selectAll(both.map((d) => d.path))\n+\t\t\t.attr(\"stroke\", colors.both)\n+\t\t\t.raise();\n+\t\td3.selectAll(both.map(([d]) => d.text))\n+\t\t\t.attr(\"fill\", colors.both)\n+\t\t\t.attr(\"font-weight\", \"bold\");\n+\t}\n+\n+\tfunction outed(event, d) {\n+\t\tlink.style(\"mix-blend-mode\", \"multiply\");\n+\t\td3.select(this).attr(\"font-weight\", null).attr(\"fill\", colors.default);\n+\t\td3.selectAll(d.incoming.map((d) => d.path)).attr(\"stroke\", null);\n+\t\td3.selectAll(d.incoming.map(([d]) => d.text))\n+\t\t\t.attr(\"fill\", colors.default)\n+\t\t\t.attr(\"font-weight\", null);\n+\t\td3.selectAll(d.outgoing.map((d) => d.path)).attr(\"stroke\", null);\n+\t\td3.selectAll(d.outgoing.map(([, d]) => d.text))\n+\t\t\t.attr(\"fill\", colors.default)\n+\t\t\t.attr(\"font-weight\", null);\n+\t}\n+\n+\treturn svg.node();\n+}\n+\n+function bilink(root) {\n+\tconst leaves = root.leaves();\n+\tconst map = new Map(leaves.map((d) => [d.data.name, d]));\n+\tfor (const d of leaves) {\n+\t\td.incoming = [];\n+\t\td.outgoing = [...d.data.outgoing]\n+\t\t\t.map((i) => {\n+\t\t\t\treturn [d, map.get(i.name)];\n+\t\t\t})\n+\t\t\t.filter((o) => o[1]);\n+\t}\n+\n+\tfor (const d of leaves) {\n+\t\tfor (const o of d.outgoing) {\n+\t\t\to[1].incoming.push(o);\n+\t\t}\n+\t}\n+\n+\treturn root;\n+}\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/hierarchical-edge.js","additions":125,"deletions":0,"binary":false,"changes":125,"status":"added"},{"patch":"@@ -0,0 +1,25 @@\n+let width = window.innerWidth;\n+let height = window.innerHeight;\n+\n+let levels = 2;\n+\n+function updateGraph(eventsJson, packageLevels, chartType) {\n+\tconst data = JSON.parse(eventsJson);\n+\tdebug(`${chartType} displaying ${data.events.length} events`);\n+\ttry {\n+\t\tlevels = packageLevels;\n+\t\twidth = window.innerWidth;\n+\t\theight = window.innerHeight;\n+\t\td3.select(\"#hierarchical\").selectAll(\"*\").remove();\n+\t\tif (chartType === \"EDGE_BUNDLING\") {\n+\t\t\tconst edgeBundlingData = transformEdgeBundlingData(data);\n+\t\t\trenderHierarchicalEdgeBundling(edgeBundlingData);\n+\t\t} else if (chartType === \"CHORD\") {\n+\t\t\tconst chordData = transformChordData(data);\n+\t\t\trenderChordDiagram(chordData);\n+\t\t}\n+\t} catch (e) {\n+\t\tdebug(e.message);\n+\t\tdebug(`<pre>${e.stack}<\/pre>`);\n+\t}\n+}\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/main.js","additions":25,"deletions":0,"binary":false,"changes":25,"status":"added"},{"patch":"@@ -0,0 +1,36 @@\n+#\n+#  Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2022, Datadog, Inc. All rights reserved.\n+#\n+#  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+#  The contents of this file are subject to the terms of either the Universal Permissive License \n+#  v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+#   \n+#  or the following license:\n+#   \n+#  Redistribution and use in source and binary forms, with or without modification, are permitted\n+#  provided that the following conditions are met:\n+#   \n+#  1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+#  and the following disclaimer.\n+#   \n+#  2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+#  conditions and the following disclaimer in the documentation and\/or other materials provided with\n+#  the distribution.\n+#   \n+#  3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+#  endorse or promote products derived from this software without specific prior written permission.\n+#\n+#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+#  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+#  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+#  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+#  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+#  WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#\n+HIERARCHICAL_PACKAGE_LEVEL_DEPTH=Package depth\n+HIERARCHICAL_EDGE_BUNDLING_DIAGRAM=Edge bundling diagram\n+HIERARCHICAL_CHORD_DIAGRAM=Chord diagram\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/org\/openjdk\/jmc\/flightrecorder\/hierarchical\/messages.properties","additions":36,"deletions":0,"binary":false,"changes":36,"status":"added"},{"patch":"@@ -0,0 +1,36 @@\n+#\n+#  Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2022, Datadog, Inc. All rights reserved.\n+#\n+#  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+#  The contents of this file are subject to the terms of either the Universal Permissive License \n+#  v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+#   \n+#  or the following license:\n+#   \n+#  Redistribution and use in source and binary forms, with or without modification, are permitted\n+#  provided that the following conditions are met:\n+#   \n+#  1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+#  and the following disclaimer.\n+#   \n+#  2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+#  conditions and the following disclaimer in the documentation and\/or other materials provided with\n+#  the distribution.\n+#   \n+#  3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+#  endorse or promote products derived from this software without specific prior written permission.\n+#\n+#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+#  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+#  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+#  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+#  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+#  WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#\n+HIERARCHICAL_PACKAGE_LEVEL_DEPTH=Package level depth\n+HIERARCHICAL_EDGE_BUNDLING_DIAGRAM=Edge bundling diagram\n+HIERARCHICAL_CHORD_DIAGRAM=Chord diagram\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/org\/openjdk\/jmc\/flightrecorder\/hierarchical\/messages_ja.properties","additions":36,"deletions":0,"binary":false,"changes":36,"status":"added"},{"patch":"@@ -0,0 +1,36 @@\n+#\n+#  Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+#  Copyright (c) 2022, Datadog, Inc. All rights reserved.\n+#\n+#  DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+#\n+#  The contents of this file are subject to the terms of either the Universal Permissive License \n+#  v 1.0 as shown at http:\/\/oss.oracle.com\/licenses\/upl\n+#   \n+#  or the following license:\n+#   \n+#  Redistribution and use in source and binary forms, with or without modification, are permitted\n+#  provided that the following conditions are met:\n+#   \n+#  1. Redistributions of source code must retain the above copyright notice, this list of conditions\n+#  and the following disclaimer.\n+#   \n+#  2. Redistributions in binary form must reproduce the above copyright notice, this list of\n+#  conditions and the following disclaimer in the documentation and\/or other materials provided with\n+#  the distribution.\n+#   \n+#  3. Neither the name of the copyright holder nor the names of its contributors may be used to\n+#  endorse or promote products derived from this software without specific prior written permission.\n+#\n+#  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR\n+#  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n+#  FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR\n+#  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n+#  DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n+#  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n+#  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY\n+#  WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+#\n+HIERARCHICAL_PACKAGE_LEVEL_DEPTH=Package level depth\n+HIERARCHICAL_EDGE_BUNDLING_DIAGRAM=Edge bundling diagram\n+HIERARCHICAL_CHORD_DIAGRAM=Chord diagram\n\\ No newline at end of file\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/org\/openjdk\/jmc\/flightrecorder\/hierarchical\/messages_zh_CN.properties","additions":36,"deletions":0,"binary":false,"changes":36,"status":"added"},{"patch":"@@ -0,0 +1,25 @@\n+<!DOCTYPE html \"-\/\/W3C\/\/DTD XHTML 1.0 Strict\/\/EN\" \"http:\/\/www.w3.org\/TR\/xhtml1\/DTD\/xhtml1-strict.dtd\">\n+<html xmlns=\"http:\/\/www.w3.org\/1999\/xhtml\">\n+\t<head>\n+\t\t<meta http-equiv=\"content-type\" content=\"text\/html; charset=utf-8\" \/>\n+\t\t<script>\n+\t\t\t%1$s\n+\t\t<\/script>\n+\t<\/head>\n+\t<body>\n+\t\t<div id=\"debug\" width=\"100%%\" style=\"text-align: left; display:none;\"><\/div>\n+\t\t<div id=\"hierarchical\" width=\"100%%\" style=\"text-align: center\"><\/div>\n+\t\t<script type=\"text\/javascript\">\n+\t\t\t%2$s\n+\t\t<\/script>\n+\t\t<script type=\"text\/javascript\">\n+\t\t\t%3$s\n+\t\t<\/script>\n+\t\t<script type=\"text\/javascript\">\n+\t\t\t%4$s\n+\t\t<\/script>\n+\t\t<script type=\"text\/javascript\">\n+\t\t\t%5$s\n+\t\t<\/script>\n+\t<\/body>\n+<\/html>\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/page.template","additions":25,"deletions":0,"binary":false,"changes":25,"status":"added"},{"patch":"@@ -0,0 +1,207 @@\n+class StackTrace {\n+\tconstructor(stackTraceData) {\n+\t\tconst frames = (stackTraceData && stackTraceData.frames) || [];\n+\t\tthis.frames = frames.map((frame) => new StackFrame(frame));\n+\t}\n+}\n+\n+class StackFrame {\n+\tconstructor({ name }) {\n+\t\tthis.id = name;\n+\t\tconst [fqcn, method] = name.split(\"#\");\n+\t\tconst lastDelimiterIdx = fqcn.lastIndexOf(\".\");\n+\t\tthis.package = new Package(fqcn.slice(0, lastDelimiterIdx));\n+\t\tthis.clazz = fqcn.slice(lastDelimiterIdx + 1);\n+\t\tthis.method = method.split(\"(\")[0];\n+\t}\n+}\n+\n+class Package {\n+\tconstructor(name) {\n+\t\tthis.name = name;\n+\t}\n+\n+\tsubpackages(maxDepth) {\n+\t\tconst parts = this.name.split(\".\");\n+\t\tconst subpackages = parts.reduce((acc, current, idx) => {\n+\t\t\tif (maxDepth - 1 >= 0 && maxDepth - 1 < idx) {\n+\t\t\t\treturn acc;\n+\t\t\t}\n+\t\t\tconst parent = acc[acc.length - 1];\n+\t\t\tacc.push(parent ? `${parent}.${current}` : current);\n+\t\t\treturn acc;\n+\t\t}, []);\n+\t\t\/\/ subpackages.push(\"\/\" + parts.join(\".\"));\n+\t\treturn subpackages;\n+\t}\n+}\n+\n+class Event {\n+\tconstructor({ type, attributes }) {\n+\t\tthis.type = type;\n+\t\tif (!attributes) {\n+\t\t\treturn;\n+\t\t}\n+\t\t\/\/ TODO: support more time attributes\n+\t\tthis.time = attributes[\"(endTime)\"];\n+\t\tthis.eventThread = attributes.eventThread;\n+\t\tthis.stackTrace = new StackTrace(attributes.stackTrace);\n+\t\tthis.state = attributes.state;\n+\t}\n+}\n+\n+function debug(msg) {\n+\tconst displayEl = document.getElementById(\"debug\");\n+\tdisplayEl.innerHTML += \"<br \/>\" + msg;\n+}\n+\n+function clear() {\n+\tdocument.getElementById(\"debug\").innerHTML = \"\";\n+}\n+\n+\/\/ data manipulation for chord diagram\n+const maxPackages = 500;\n+\n+function truncatePackage(name, level) {\n+\treturn name.split(\".\").slice(0, level).join(\".\");\n+}\n+\n+function transformChordData(json) {\n+\tconst events = json.events.map((e) => new Event(e));\n+\tlet calls = {};\n+\tevents.forEach((e) => {\n+\t\tconst frames = e.stackTrace.frames;\n+\t\tconst len = frames.length;\n+\t\tfor (let i = len - 1; i > 0; i--) {\n+\t\t\tconst source = truncatePackage(frames[i].package.name, levels);\n+\t\t\tconst target = truncatePackage(frames[i - 1].package.name, levels);\n+\t\t\tconst id = `${source} ${target}`;\n+\t\t\tcalls[id] = (calls[id] || 0) + 1;\n+\t\t}\n+\t});\n+\tcalls = Object.entries(calls)\n+\t\t.sort(([, a], [, b]) => b - a)\n+\t\t.slice(0, maxPackages)\n+\t\t.reduce((r, [k, v]) => ({ ...r, [k]: v }), {});\n+\treturn Object.keys(calls).map((id) => {\n+\t\tconst [source, target] = id.split(\" \");\n+\t\treturn { source, target, value: calls[id] };\n+\t});\n+}\n+\n+\/\/ data manipulation for hierarchical edge bundling diagram\n+function transformEdgeBundlingData(data) {\n+\tconst graph = new Graph();\n+\tdata.events\n+\t\t.map((d) => new Event(d))\n+\t\t.forEach((event) => {\n+\t\t\tconst stackTrace = event.stackTrace;\n+\t\t\tif (stackTrace) {\n+\t\t\t\tconst frames = stackTrace.frames.reverse();\n+\t\t\t\tfor (let idx = 0; idx < frames.length; idx++) {\n+\t\t\t\t\tconst currentFrame = frames[idx];\n+\t\t\t\t\tconst parentFrame = frames[idx - 1];\n+\t\t\t\t\tconst current = graph.createAllNodes(currentFrame);\n+\t\t\t\t\tif (parentFrame) {\n+\t\t\t\t\t\tconst parent = graph.createAllNodes(parentFrame);\n+\t\t\t\t\t\tif (parent != current) {\n+\t\t\t\t\t\t\tparent.addIncoming(current);\n+\t\t\t\t\t\t\tcurrent.addOutgoing(parent);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t\tif (idx === frames.length - 1) {\n+\t\t\t\t\t\tcurrent.leaf = true;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t});\n+\treturn graph;\n+}\n+\n+function getColors() {\n+\tconst scheme = d3.schemeCategory10;\n+\treturn {\n+\t\toutgoing: scheme[2],\n+\t\tincoming: scheme[1],\n+\t\thover: scheme[0],\n+\t\tboth: scheme[3],\n+\t\tdefault: \"#eee\",\n+\t\tlink: \"#ccc\",\n+\t};\n+}\n+\n+class Graph {\n+\tconstructor() {\n+\t\tthis.root = new Node(\"root\");\n+\t\tthis.nodesByName = { root: this.root };\n+\t}\n+\n+\tcreateAllNodes(frame) {\n+\t\tconst nodeNames = frame.package.subpackages(levels);\n+\t\tlet node = this.root;\n+\t\tfor (let nodeName of nodeNames) {\n+\t\t\tconst child = this.ensureNode(nodeName);\n+\t\t\tconst exists = node.children.find((c) => c.name === child.name);\n+\t\t\tif (!exists) {\n+\t\t\t\tnode.children.push(child);\n+\t\t\t}\n+\t\t\tnode = child;\n+\t\t}\n+\t\treturn node;\n+\t}\n+\n+\tensureNode(name) {\n+\t\tlet node = this.nodesByName[name];\n+\t\tif (!node) {\n+\t\t\tnode = new Node(name);\n+\t\t\tthis.nodesByName[name] = node;\n+\t\t}\n+\t\treturn node;\n+\t}\n+}\n+\n+class Node {\n+\tconstructor(name, fullName) {\n+\t\tthis.name = name;\n+\t\tthis.fullName = fullName;\n+\t\tthis.children = [];\n+\t\tthis.outgoing = new Set();\n+\t\tthis.incoming = new Set();\n+\t}\n+\n+\taddChild(node) {\n+\t\tthis.children.push(node);\n+\t\treturn this;\n+\t}\n+\n+\taddOutgoing(node) {\n+\t\tthis.outgoing.add(node);\n+\t}\n+\n+\taddIncoming(node) {\n+\t\tthis.incoming.add(node);\n+\t}\n+}\n+\n+function intersection(incoming, outgoing) {\n+\treturn incoming.filter((i) => outgoing.find((o) => o[1] == i[0]));\n+}\n+\n+function subtract(first, second, itemFn) {\n+\treturn first.filter((pair) => !second.find((i) => i[0] === itemFn(pair)));\n+}\n+\n+function formatTooltip(d) {\n+\tlet tooltip = d.data.name;\n+\tconst both = intersection(d.incoming, d.outgoing);\n+\tconst incoming = subtract(d.incoming, both, (p) => p[0]);\n+\tconst outgoing = subtract(d.outgoing, both, (p) => p[1]);\n+\tconst getName = (d) => d.data.name;\n+\tconst displayLink = (prefix, d) => `${prefix} ${getName(d)}`;\n+\tconst displayLinks = (prefix, ds, getItem) =>\n+\t\tds.map((d) => displayLink(prefix, getItem(d))).join(\"\\n\");\n+\ttooltip += \"\\n\" + displayLinks(\"←\", incoming, (p) => p[0]);\n+\ttooltip += \"\\n\" + displayLinks(\"↔\", both, (p) => p[0]);\n+\ttooltip += \"\\n\" + displayLinks(\"→\", outgoing, (p) => p[1]);\n+\treturn tooltip;\n+}\n","filename":"application\/org.openjdk.jmc.flightrecorder.hierarchical-edge\/src\/main\/resources\/utils.js","additions":207,"deletions":0,"binary":false,"changes":207,"status":"added"},{"patch":"@@ -92,0 +92,1 @@\n+\t\t<module>org.openjdk.jmc.flightrecorder.hierarchical-edge<\/module>\n","filename":"application\/pom.xml","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}