{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -138,134 +138,0 @@\n-static void AddFontsToX11FontPath ( fDirRecord *fDirP )\n-{\n-    char *onePath;\n-    int index, nPaths;\n-    int origNumPaths, length;\n-    int origIndex;\n-    int totalDirCount;\n-    char  **origFontPath;\n-    char  **tempFontPath;\n-    int doNotAppend;\n-    int *appendDirList;\n-    char **newFontPath;\n-    int err, compareLength;\n-    char fontDirPath[512];\n-    int dirFile;\n-\n-    doNotAppend = 0;\n-\n-    if ( fDirP->num == 0 ) return;\n-\n-    appendDirList = SAFE_SIZE_ARRAY_ALLOC(malloc, fDirP->num, sizeof ( int ));\n-    if ( appendDirList == NULL ) {\n-      return;  \/* if it fails we cannot do much *\/\n-    }\n-\n-    origFontPath = XGetFontPath ( awt_display, &nPaths );\n-\n-    totalDirCount = nPaths;\n-    origNumPaths = nPaths;\n-    tempFontPath = origFontPath;\n-\n-\n-    for (index = 0; index < fDirP->num; index++ ) {\n-\n-        doNotAppend = 0;\n-\n-        tempFontPath = origFontPath;\n-        for ( origIndex = 0; origIndex < nPaths; origIndex++ ) {\n-\n-            onePath = *tempFontPath;\n-\n-            compareLength = strlen ( onePath );\n-            if ( onePath[compareLength -1] == '\/' )\n-              compareLength--;\n-\n-            \/* there is a slash at the end of every solaris X11 font path name *\/\n-            if ( strncmp ( onePath, fDirP->name[index], compareLength ) == 0 ) {\n-              doNotAppend = 1;\n-              break;\n-            }\n-            tempFontPath++;\n-        }\n-\n-        appendDirList[index] = 0;\n-        if ( doNotAppend == 0 ) {\n-            snprintf(fontDirPath, sizeof(fontDirPath), \"%s\/fonts.dir\", fDirP->name[index]);\n-            fontDirPath[sizeof(fontDirPath) - 1] = '\\0';\n-            dirFile = open ( fontDirPath, O_RDONLY, 0 );\n-            if ( dirFile == -1 ) {\n-                doNotAppend = 1;\n-            } else {\n-               close ( dirFile );\n-               totalDirCount++;\n-               appendDirList[index] = 1;\n-            }\n-        }\n-\n-    }\n-\n-    \/* if no changes are required do not bother to do a setfontpath *\/\n-    if ( totalDirCount == nPaths ) {\n-      free ( ( void *) appendDirList );\n-      XFreeFontPath ( origFontPath );\n-      return;\n-    }\n-\n-\n-    newFontPath = SAFE_SIZE_ARRAY_ALLOC(malloc, totalDirCount, sizeof(char *));\n-    \/* if it fails free things and get out *\/\n-    if ( newFontPath == NULL ) {\n-      free ( ( void *) appendDirList );\n-      XFreeFontPath ( origFontPath );\n-      return;\n-    }\n-\n-    for ( origIndex = 0; origIndex < nPaths; origIndex++ ) {\n-      onePath = origFontPath[origIndex];\n-      newFontPath[origIndex] = onePath;\n-    }\n-\n-    \/* now add the other font paths *\/\n-\n-    for (index = 0; index < fDirP->num; index++ ) {\n-\n-      if ( appendDirList[index] == 1 ) {\n-\n-        \/* printf ( \"Appending %s\\n\", fDirP->name[index] ); *\/\n-\n-        onePath = SAFE_SIZE_ARRAY_ALLOC(malloc, strlen (fDirP->name[index]) + 2, sizeof( char ) );\n-        if (onePath == NULL) {\n-            free ( ( void *) appendDirList );\n-\n-            for ( index = origIndex; index < nPaths; index++ ) {\n-                free( newFontPath[index] );\n-            }\n-\n-            free( ( void *) newFontPath);\n-            XFreeFontPath ( origFontPath );\n-            return;\n-        }\n-        strcpy ( onePath, fDirP->name[index] );\n-        strcat ( onePath, \"\/\" );\n-        newFontPath[nPaths++] = onePath;\n-        \/* printf ( \"The path to be appended is %s\\n\", onePath ); *\/\n-      }\n-    }\n-\n-    \/*   printf ( \"The dir count = %d\\n\", totalDirCount ); *\/\n-    free ( ( void *) appendDirList );\n-\n-    XSetFontPath ( awt_display, newFontPath, totalDirCount );\n-\n-        for ( index = origNumPaths; index < totalDirCount; index++ ) {\n-                free( newFontPath[index] );\n-    }\n-\n-        free ( (void *) newFontPath );\n-    XFreeFontPath ( origFontPath );\n-    return;\n-}\n-#endif \/* !HEADLESS *\/\n-\n-\n-#ifndef HEADLESS\n","filename":"src\/java.desktop\/unix\/native\/common\/awt\/fontpath.c","additions":1,"deletions":135,"binary":false,"changes":136,"status":"modified"}]}