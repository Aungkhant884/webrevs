{"files":[{"patch":"@@ -114,0 +114,1 @@\n+\/\/ Generic implementation. GCs can provide an optimized one.\n@@ -117,1 +118,1 @@\n-  Label done;\n+  Label done, not_weak, verify;\n@@ -121,2 +122,2 @@\n-  __ clrrdi(tmp1, value, JNIHandles::weak_tag_size);\n-  __ ld(value, 0, tmp1);      \/\/ Resolve (untagged) jobject.\n+  __ andi_(tmp1, value, JNIHandles::weak_tag_mask);\n+  __ beq(CCR0, not_weak);     \/\/ Test for jweak tag.\n@@ -124,0 +125,11 @@\n+  \/\/ Resolve (untagged) jobject.\n+  __ clrrdi(value, value, JNIHandles::weak_tag_size);\n+  load_at(masm, IN_NATIVE | ON_PHANTOM_OOP_REF, T_OBJECT,\n+          value, (intptr_t)0, value, tmp1, tmp2, preservation_level);\n+  __ b(verify);\n+\n+  __ bind(not_weak);\n+  load_at(masm, IN_NATIVE, T_OBJECT,\n+          value, (intptr_t)0, value, tmp1, tmp2, preservation_level);\n+\n+  __ bind(verify);\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shared\/barrierSetAssembler_ppc.cpp","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"runtime\/jniHandles.hpp\"\n@@ -77,0 +78,14 @@\n+\n+void ModRefBarrierSetAssembler::resolve_jobject(MacroAssembler* masm, Register value,\n+                                                Register tmp1, Register tmp2,\n+                                                MacroAssembler::PreservationLevel preservation_level) {\n+  Label done;\n+  __ cmpdi(CCR0, value, 0);\n+  __ beq(CCR0, done);         \/\/ Use NULL as-is.\n+\n+  __ clrrdi(tmp1, value, JNIHandles::weak_tag_size);\n+  __ ld(value, 0, tmp1);      \/\/ Resolve (untagged) jobject.\n+\n+  __ verify_oop(value, FILE_AND_LINE);\n+  __ bind(done);\n+}\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shared\/modRefBarrierSetAssembler_ppc.cpp","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -60,0 +60,4 @@\n+\n+  virtual void resolve_jobject(MacroAssembler* masm, Register value,\n+                               Register tmp1, Register tmp2,\n+                               MacroAssembler::PreservationLevel preservation_level);\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/shared\/modRefBarrierSetAssembler_ppc.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}