{"files":[{"patch":"@@ -201,0 +201,24 @@\n+    \/\/ Additional bot-specific progresses that are not handled by JCheck\n+    private Map<String, Boolean> botSpecificProgresses() {\n+        var ret = new HashMap<String, Boolean>();\n+        if (pr.labelNames().contains(\"csr\")) {\n+            \/\/ If the PR have csr label, the CSR request need to be approved.\n+            ret.put(\"Change requires a CSR request to be approved\", false);\n+        } else {\n+            var csrIssue = Issue.fromStringRelaxed(pr.title()).flatMap(this::getCsrIssue)\n+                    .flatMap(value -> issueProject() != null ? issueProject().issue(value.shortId()) : Optional.empty());\n+            if (csrIssue.isPresent()) {\n+                var resolution = csrIssue.get().properties().get(\"resolution\");\n+                if (resolution != null && !resolution.isNull()\n+                        && resolution.get(\"name\") != null && !resolution.get(\"name\").isNull()\n+                        && csrIssue.get().state() == org.openjdk.skara.issuetracker.Issue.State.CLOSED\n+                        && \"Approved\".equals(resolution.get(\"name\").asString())) {\n+                    \/\/ The PR doesn't have csr label and the csr request has been Approved.\n+                    ret.put(\"Change requires a CSR request to be approved\", true);\n+                }\n+            }\n+            \/\/ At other states, no need to add the csr progress.\n+        }\n+        return ret;\n+    }\n+\n@@ -209,2 +233,1 @@\n-        return Map.of(\"rejected\", \"The change is currently blocked from integration by a rejection.\",\n-                      \"csr\", \"The change requires a CSR request to be approved.\");\n+        return Map.of(\"rejected\", \"The change is currently blocked from integration by a rejection.\");\n@@ -377,1 +400,1 @@\n-    private String getChecksList(PullRequestCheckIssueVisitor visitor, boolean isCleanBackport) {\n+    private String getChecksList(PullRequestCheckIssueVisitor visitor, boolean isCleanBackport, Map<String, Boolean> additionalProgresses) {\n@@ -379,0 +402,1 @@\n+        checks.putAll(additionalProgresses);\n@@ -460,2 +484,2 @@\n-                                    List<String> additionalErrors, List<String> integrationBlockers,\n-                                    boolean isCleanBackport) {\n+                                    List<String> additionalErrors, Map<String, Boolean> additionalProgresses,\n+                                    List<String> integrationBlockers, boolean isCleanBackport) {\n@@ -465,1 +489,1 @@\n-        progressBody.append(getChecksList(visitor, isCleanBackport));\n+        progressBody.append(getChecksList(visitor, isCleanBackport, additionalProgresses));\n@@ -936,0 +960,1 @@\n+            Map<String, Boolean> additionalProgresses = Map.of();\n@@ -957,0 +982,1 @@\n+                additionalProgresses = botSpecificProgresses();\n@@ -964,1 +990,2 @@\n-            var statusMessage = getStatusMessage(comments, activeReviews, visitor, additionalErrors, integrationBlockers, isCleanBackport);\n+            var statusMessage = getStatusMessage(comments, activeReviews, visitor, additionalErrors,\n+                                                additionalProgresses, integrationBlockers, isCleanBackport);\n@@ -978,0 +1005,1 @@\n+                                      !additionalProgresses.containsValue(false) &&\n@@ -983,0 +1011,1 @@\n+                                      !additionalProgresses.containsValue(false) &&\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":36,"deletions":7,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -75,1 +75,2 @@\n-\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -85,0 +86,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -95,0 +98,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -139,0 +144,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [x] Change requires a CSR request to be approved\"));\n@@ -179,0 +186,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -216,0 +225,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -223,0 +234,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -233,0 +246,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -240,0 +255,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -247,0 +264,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -284,0 +303,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -325,0 +346,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -365,0 +388,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -374,0 +399,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -418,0 +445,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -430,0 +459,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -443,0 +474,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -486,0 +519,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -498,0 +533,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -511,0 +548,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -545,0 +584,2 @@\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n@@ -583,0 +624,2 @@\n+            \/\/ The PR body shouldn't contain the progress about CSR request\n+            assertFalse(pr.body().contains(\"Change requires a CSR request to be approved\"));\n@@ -601,2 +644,2 @@\n-            \/\/ The body should contain a note about why\n-            assertTrue(pr.body().contains(\"change requires a CSR request to be approved\"));\n+            \/\/ The PR body should contain the progress about CSR request\n+            assertTrue(pr.body().contains(\"- [ ] Change requires a CSR request to be approved\"));\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CSRTests.java","additions":46,"deletions":3,"binary":false,"changes":49,"status":"modified"}]}