{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,2 +29,0 @@\n-import java.io.IOException;\n-import java.nio.file.Path;\n@@ -33,1 +31,0 @@\n-import java.util.stream.Stream;\n@@ -44,0 +41,1 @@\n+        var tabPattern = Pattern.compile(conf.checks().whitespace().ignoreTabs());\n@@ -59,1 +57,3 @@\n-                            if (tabIndex >= 0 || crIndex >= 0 || line.endsWith(\" \")) {\n+                            var ignoreTab = tabPattern.matcher(path.toString()).matches();\n+                            if ((tabIndex >= 0 && !ignoreTab) || crIndex >= 0\n+                                    || line.endsWith(\" \") || line.endsWith(\"\\t\")) {\n@@ -63,1 +63,1 @@\n-                                    if (line.charAt(index) == ' ' && trailing) {\n+                                    if ((line.charAt(index) == ' ' || line.charAt(index) == '\\t') && trailing) {\n@@ -65,1 +65,1 @@\n-                                    } else if (line.charAt(index) == '\\t') {\n+                                    } else if (line.charAt(index) == '\\t'  && !ignoreTab) {\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/WhitespaceCheck.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,4 +27,0 @@\n-import java.util.List;\n-import java.util.Set;\n-import java.util.stream.Collectors;\n-\n@@ -33,1 +29,1 @@\n-        new WhitespaceConfiguration(\".*\\\\.cpp|.*\\\\.hpp|.*\\\\.c|.*\\\\.h|.*\\\\.java\");\n+        new WhitespaceConfiguration(\".*\\\\.cpp|.*\\\\.hpp|.*\\\\.c|.*\\\\.h|.*\\\\.java\", \"\");\n@@ -36,0 +32,1 @@\n+    private final String ignoreTabs;\n@@ -37,1 +34,1 @@\n-    WhitespaceConfiguration(String files) {\n+    WhitespaceConfiguration(String files, String ignoreTabs) {\n@@ -39,0 +36,1 @@\n+        this.ignoreTabs = ignoreTabs;\n@@ -45,0 +43,4 @@\n+    public String ignoreTabs() {\n+        return ignoreTabs;\n+    }\n+\n@@ -55,1 +57,2 @@\n-        return new WhitespaceConfiguration(files);\n+        var ignoreTabs = s.get(\"ignore-tabs\", DEFAULT.ignoreTabs());\n+        return new WhitespaceConfiguration(files, ignoreTabs);\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/WhitespaceConfiguration.java","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -25,1 +25,0 @@\n-import org.openjdk.skara.census.Census;\n@@ -38,1 +37,0 @@\n-import java.io.IOException;\n@@ -59,1 +57,1 @@\n-    private static JCheckConfiguration configuration(String files) {\n+    private static JCheckConfiguration configuration(String files, String ignoreTabs) {\n@@ -62,0 +60,1 @@\n+        lines.add(\"ignore-tabs = \" + ignoreTabs);\n@@ -90,1 +89,1 @@\n-        var conf = configuration(\"README\\\\.md\");\n+        var conf = configuration(\"README\\\\.md\", \"\");\n@@ -102,1 +101,1 @@\n-        var conf = configuration(\"README\\\\.md\");\n+        var conf = configuration(\"README\\\\.md\", \"\");\n@@ -122,1 +121,49 @@\n-    void tabShouldFail() {\n+    void trailingTabShouldFailWithoutIgnoreTabs() {\n+        var filename = \"README.md\";\n+        var line = \"An additional line\\t\";\n+        var commit = commit(parentDiffs(filename, line));\n+        var conf = configuration(\"README\\\\.md\", \"\");\n+        var message = message(commit);\n+        var check = new WhitespaceCheck();\n+        var issues = toList(check.check(commit, message, conf, null));\n+\n+        assertEquals(1, issues.size());\n+        assertTrue(issues.get(0) instanceof WhitespaceIssue);\n+        var issue = (WhitespaceIssue) issues.get(0);\n+        assertEquals(Path.of(filename), issue.path());\n+        assertEquals(1, issue.row());\n+        assertEquals(line, issue.line());\n+        assertEquals(List.of(new WhitespaceIssue.Error(line.length() - 1, WhitespaceIssue.Whitespace.TRAILING)),\n+                issue.errors());\n+        assertEquals(commit, issue.commit());\n+        assertEquals(check, issue.check());\n+        assertEquals(message, issue.message());\n+        assertEquals(Severity.ERROR, issue.severity());\n+    }\n+\n+    @Test\n+    void trailingTabShouldFailWithIgnoreTabs() {\n+        var filename = \"README.md\";\n+        var line = \"An additional line\\t\";\n+        var commit = commit(parentDiffs(filename, line));\n+        var conf = configuration(\"README\\\\.md\", \"\\\"README\\\\\\\\.md\");\n+        var message = message(commit);\n+        var check = new WhitespaceCheck();\n+        var issues = toList(check.check(commit, message, conf, null));\n+\n+        assertEquals(1, issues.size());\n+        assertTrue(issues.get(0) instanceof WhitespaceIssue);\n+        var issue = (WhitespaceIssue) issues.get(0);\n+        assertEquals(Path.of(filename), issue.path());\n+        assertEquals(1, issue.row());\n+        assertEquals(line, issue.line());\n+        assertEquals(List.of(new WhitespaceIssue.Error(line.length() - 1, WhitespaceIssue.Whitespace.TRAILING)),\n+                issue.errors());\n+        assertEquals(commit, issue.commit());\n+        assertEquals(check, issue.check());\n+        assertEquals(message, issue.message());\n+        assertEquals(Severity.ERROR, issue.severity());\n+    }\n+\n+    @Test\n+    void tabShouldFailWithoutIgnoreTabs() {\n@@ -126,1 +173,1 @@\n-        var conf = configuration(\"README\\\\.md\");\n+        var conf = configuration(\"README\\\\.md\", \"\");\n@@ -145,0 +192,13 @@\n+    @Test\n+    void tabShouldSucceedWithIgnoreTabs() {\n+        var filename = \"README.md\";\n+        var line = \"\\tAn additional line\";\n+        var commit = commit(parentDiffs(filename, line));\n+        var conf = configuration(\"README\\\\.md\", \"README\\\\.md\");\n+        var message = message(commit);\n+        var check = new WhitespaceCheck();\n+        var issues = toList(check.check(commit, message, conf, null));\n+\n+        assertEquals(0, issues.size());\n+    }\n+\n@@ -150,1 +210,1 @@\n-        var conf = configuration(\"README\\\\.md\");\n+        var conf = configuration(\"README\\\\.md\", \"\");\n","filename":"jcheck\/src\/test\/java\/org\/openjdk\/skara\/jcheck\/WhitespaceCheckTests.java","additions":68,"deletions":8,"binary":false,"changes":76,"status":"modified"}]}