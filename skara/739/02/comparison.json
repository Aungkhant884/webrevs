{"files":[{"patch":"@@ -31,0 +31,1 @@\n+import java.time.format.DateTimeParseException;\n@@ -35,0 +36,22 @@\n+    private static final String delimiter = \"#@!_-=&\";\n+    private static final String hash = \"{node}\";\n+    private static final String rev = \"{rev}\";\n+    private static final String branch = \"{branch}\";\n+    private static final String parentHashes = \"{p1.node} {p2.node}\";\n+    private static final String parentRevs = \"{p1.rev} {p2.rev}\";\n+    private static final String user = \"{user}\";\n+    private static final String date = \"{date|rfc3339date}\";\n+    private static final String descLen = \"{desc|count}\";\n+    private static final String desc = \"{desc}\";\n+\n+    public static final String TEMPLATE = String.join(\"\\n\",\n+                                                      delimiter,\n+                                                      hash,\n+                                                      rev,\n+                                                      branch,\n+                                                      parentHashes,\n+                                                      parentRevs,\n+                                                      user,\n+                                                      date,\n+                                                      descLen,\n+                                                      desc);\n@@ -49,2 +72,11 @@\n-        var formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd H:m:sZ\");\n-        var authored = ZonedDateTime.parse(reader.readLine(), formatter);\n+        \/\/ ext.py and hg uses slightly different time formats\n+        ZonedDateTime authored = null;\n+        var date = reader.readLine();\n+        try {\n+            \/\/ ext.py\n+            var formatter = DateTimeFormatter.ofPattern(\"yyyy-MM-dd H:m:sZ\");\n+            authored = ZonedDateTime.parse(date, formatter);\n+        } catch (DateTimeParseException e) {\n+            \/\/ hg's rfc3339date\n+            authored = ZonedDateTime.parse(date, DateTimeFormatter.ISO_OFFSET_DATE_TIME);\n+        }\n","filename":"vcs\/src\/main\/java\/org\/openjdk\/skara\/vcs\/hg\/HgCommitMetadata.java","additions":34,"deletions":2,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -276,5 +276,2 @@\n-        var ext = Files.createTempFile(\"ext\", \".py\");\n-        copyResource(EXT_PY, ext);\n-\n-        var args = new ArrayList<String>();\n-        args.addAll(List.of(\"hg\", \"--config\", \"extensions.dump=\" + ext.toAbsolutePath().toString(), \"metadata\"));\n+        var cmd = new ArrayList<String>();\n+        cmd.addAll(List.of(\"hg\", \"log\", \"--template\", HgCommitMetadata.TEMPLATE));\n@@ -283,1 +280,2 @@\n-        args.add(revset);\n+        cmd.add(\"--rev\");\n+        cmd.add(revset);\n@@ -285,1 +283,1 @@\n-            args.add(paths.stream().map(Path::toString).collect(Collectors.joining(\"\\t\")));\n+            cmd.addAll(paths.stream().map(Path::toString).collect(Collectors.toList()));\n@@ -287,1 +285,1 @@\n-        var p = start(args);\n+        var p = start(cmd);\n","filename":"vcs\/src\/main\/java\/org\/openjdk\/skara\/vcs\/hg\/HgRepository.java","additions":6,"deletions":8,"binary":false,"changes":14,"status":"modified"}]}