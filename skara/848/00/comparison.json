{"files":[{"patch":"@@ -316,7 +316,6 @@\n-            \/\/ First entry should not have the label\n-            var first = streamIssues.get(0);\n-            if (first.labels().contains(label)) {\n-                first.removeLabel(label);\n-            }\n-\n-            \/\/ But all the following ones should\n+            \/\/ The first issue may have the label if it was part of another\n+            \/\/ stream. (e.g. feature release has 14 & 15 where update release\n+            \/\/ has 15, 15.0.1 & 15.0.2. In this case the label should be\n+            \/\/ applied to 15, which is the first releases in the 15u stream)\n+            \/\/ This means we ignore the first issue for the purposes of adding\n+            \/\/ the label.\n","filename":"bots\/notify\/src\/main\/java\/org\/openjdk\/skara\/bots\/notify\/issue\/Backports.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -215,0 +215,14 @@\n+\n+        void assertNotLabeled(String... labeledVersions) {\n+            Backports.labelReleaseStreamDuplicates(issues.get(0), \"hgupdate-sync\");\n+\n+            var labels = new HashSet<>(Arrays.asList(labeledVersions));\n+            var unLabeledIssues = new HashSet<String>();\n+            for (var issue : issues) {\n+                var version = issue.properties().get(\"fixVersions\").get(0).asString();\n+                if (!issue.labels().contains(\"hgupdate-sync\")) {\n+                    unLabeledIssues.add(version);\n+                }\n+            }\n+            assertEquals(labels, unLabeledIssues);\n+        }\n@@ -249,1 +263,1 @@\n-            backports.assertLabeled(\"14.0.1\", \"14.0.2\", \"15.0.1\", \"15.0.2\");\n+            backports.assertLabeled(\"14.0.1\", \"14.0.2\", \"15\", \"15.0.1\", \"15.0.2\");\n@@ -267,0 +281,13 @@\n+    @Test\n+    void labelSeparateOpenJdkUpdateReleaseStream(TestInfo testInfo) throws IOException {\n+        try (var credentials = new HostCredentials(testInfo)) {\n+            var backports = new BackportManager(credentials, \"11.0.3\");\n+            backports.assertLabeled();\n+\n+            backports.addBackports(\"11.0.3-oracle\", \"11.0.4\", \"11.0.4-oracle\");\n+            backports.assertLabeled(\"11.0.4\", \"11.0.4-oracle\");\n+            backports.assertNotLabeled(\"11.0.3-oracle\", \"11.0.3\");\n+        }\n+    }\n+\n+\n","filename":"bots\/notify\/src\/test\/java\/org\/openjdk\/skara\/bots\/notify\/issue\/BackportsTests.java","additions":28,"deletions":1,"binary":false,"changes":29,"status":"modified"}]}