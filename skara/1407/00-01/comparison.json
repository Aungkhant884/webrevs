{"files":[{"patch":"@@ -227,19 +227,1 @@\n-\n-        if (bot.confOverrideRepository().isEmpty()) {\n-            \/\/check whether this repo contains .jcheck\/conf, if not, let the pr author to notify the repo owner\n-            try {\n-                pr.repository().fileContents(\".jcheck\/conf\", pr.targetRef());\n-            } catch (NoSuchElementException e) {\n-                String message = \"@\" + pr.author().username() + \" This repo doesn't contain `.jcheck\/conf`,\"\n-                        + \" please close this pr and notify the repo owner.\"\n-                        + \" After uploading `.jcheck\/conf` to the target branch, you can create a new pull request.\";\n-                boolean messageSent = pr.comments().stream().anyMatch(comment -> comment.body().equals(message));\n-                if (!messageSent) {\n-                    pr.addComment(message);\n-                }\n-                return List.of();\n-            }\n-        }\n-\n-        var census = CensusInstance.createCensusInstance(hostedRepositoryPool, bot.censusRepo(), bot.censusRef(), scratchPath.resolve(\"census\"), pr,\n-                                           bot.confOverrideRepository().orElse(null), bot.confOverrideName(), bot.confOverrideRef()).orElseThrow();\n+        CensusInstance census = null;\n@@ -249,0 +231,15 @@\n+        try {\n+            census = CensusInstance.createCensusInstance(hostedRepositoryPool, bot.censusRepo(), bot.censusRef(), scratchPath.resolve(\"census\"), pr,\n+                    bot.confOverrideRepository().orElse(null), bot.confOverrideName(), bot.confOverrideRef()).orElseThrow();\n+        } catch (InvalidJCheckConfException invalidJCheckConfException) {\n+            if (bot.confOverrideRepository().isEmpty()) {\n+                var text = \" ⚠️ @\" + pr.author().username() + \" The `.jcheck\/conf` in the target branch of this pull request is either invalid or missing completely. \"\n+                        + \"Until that is resolved, this pull request cannot be processed. Please notify the repository owner.\";\n+                addErrorComment(text, comments);\n+            } else {\n+                var text = \" ⚠️ @\" + pr.author().username() + \" The `.jcheck\/conf` in the override repo is either invalid or missing completely. \"\n+                        + \"Until that is resolved, this pull request cannot be processed. Please notify the repository owner.\";\n+                addErrorComment(text, comments);\n+            }\n+            return List.of();\n+        }\n@@ -270,1 +267,1 @@\n-                        addBackportErrorComment(text, comments);\n+                        addErrorComment(text, comments);\n@@ -286,1 +283,1 @@\n-                        addBackportErrorComment(text, comments);\n+                        addErrorComment(text, comments);\n@@ -297,1 +294,1 @@\n-                        addBackportErrorComment(text, comments);\n+                        addErrorComment(text, comments);\n@@ -327,1 +324,1 @@\n-                    addBackportErrorComment(text, comments);\n+                    addErrorComment(text, comments);\n@@ -343,1 +340,1 @@\n-                    addBackportErrorComment(text, comments);\n+                    addErrorComment(text, comments);\n@@ -351,1 +348,1 @@\n-                    addBackportErrorComment(text, comments);\n+                    addErrorComment(text, comments);\n@@ -407,1 +404,1 @@\n-    private void addBackportErrorComment(String text, List<Comment> comments) {\n+    private void addErrorComment(String text, List<Comment> comments) {\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckWorkItem.java","additions":23,"deletions":26,"binary":false,"changes":49,"status":"modified"},{"patch":"@@ -17,0 +17,5 @@\n+class InvalidJCheckConfException extends RuntimeException {\n+    public InvalidJCheckConfException(String message) {\n+        super(message);\n+    }\n+}\n@@ -42,1 +47,1 @@\n-                return Optional.empty();\n+                throw new InvalidJCheckConfException(\".jcheck\/conf is invalid or missing\");\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/LimitedCensusInstance.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2178,1 +2178,1 @@\n-    void jCheckConfMissing(TestInfo testInfo) throws IOException {\n+    void invalidJCheckConf(TestInfo testInfo) throws IOException {\n@@ -2216,4 +2216,2 @@\n-            assertTrue(comments.get(comments.size() - 1).body().contains(\"@\" + pr.author().username() + \" This repo doesn't contain `.jcheck\/conf`,\"\n-                    + \" please close this pr and notify the repo owner.\"\n-                    + \" After uploading `.jcheck\/conf` to the target branch, you can create a new pull request.\"));\n-\n+            assertTrue(comments.get(comments.size() - 1).body().contains(\" ⚠️ @\" + pr.author().username() + \" The `.jcheck\/conf` in the target branch of this pull request is either invalid or missing completely. \"\n+                    + \"Until that is resolved, this pull request cannot be processed. Please notify the repository owner.\"));\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CheckTests.java","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"}]}