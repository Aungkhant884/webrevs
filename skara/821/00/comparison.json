{"files":[{"patch":"@@ -60,2 +60,2 @@\n-        if (!censusInstance.isReviewer(command.user())) {\n-            reply.println(\"only [Reviewers](https:\/\/openjdk.java.net\/bylaws#reviewer) are allowed require a CSR.\");\n+        if (!pr.author().equals(command.user()) && !censusInstance.isReviewer(command.user())) {\n+            reply.println(\"only the pull request author and [Reviewers](https:\/\/openjdk.java.net\/bylaws#reviewer) are allowed to require a CSR.\");\n@@ -68,0 +68,5 @@\n+        if (!cmd.isEmpty() && !(cmd.equals(\"needed\") || cmd.equals(\"unneeded\") || cmd.equals(\"uneeded\"))) {\n+            showHelp(reply);\n+            return;\n+        }\n+\n@@ -69,0 +74,5 @@\n+            if (pr.author().equals(command.user()) && !censusInstance.isReviewer(command.user())) {\n+                reply.println(\"only [Reviewers](https:\/\/openjdk.java.net\/bylaws#reviewer) can determine that a CSR is not needed.\");\n+                return;\n+            }\n+\n@@ -73,4 +83,1 @@\n-                          \"is no longer needed for this pull request.\");\n-            return;\n-        } else if (!cmd.isEmpty() && !cmd.equals(\"needed\")) {\n-            showHelp(reply);\n+                          \"is not needed for this pull request.\");\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CSRCommand.java","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -87,1 +87,1 @@\n-                                          \"is no longer needed for this pull request.\");\n+                                          \"is not needed for this pull request.\");\n@@ -215,3 +215,12 @@\n-            \/\/ The bot should reply with a message that only reviewers can require a CSR\n-            assertLastCommentContains(pr, \"only [Reviewers](https:\/\/openjdk.java.net\/bylaws#reviewer) are allowed require a CSR.\");\n-            assertFalse(pr.labels().contains(\"csr\"));\n+            \/\/ The bot should reply with a message that a CSR is needed\n+            assertLastCommentContains(pr, \"has indicated that a \" +\n+                                          \"[compatibility and specification](https:\/\/wiki.openjdk.java.net\/display\/csr\/Main) (CSR) request \" +\n+                                          \"is needed for this pull request.\");\n+            assertTrue(pr.labels().contains(\"csr\"));\n+\n+            \/\/ Stating that a CSR is not needed should not work\n+            pr.addComment(\"\/csr unneeded\");\n+            TestBotRunner.runPeriodicItems(prBot);\n+            assertLastCommentContains(pr, \"only [Reviewers]\");\n+            assertLastCommentContains(pr, \"can determine that a CSR is not needed.\");\n+            assertTrue(pr.labels().contains(\"csr\"));\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CSRTests.java","additions":13,"deletions":4,"binary":false,"changes":17,"status":"modified"}]}