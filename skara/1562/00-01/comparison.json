{"files":[{"patch":"@@ -26,0 +26,1 @@\n+import org.openjdk.skara.forge.PreIntegrations;\n@@ -51,2 +52,0 @@\n-    private static final Pattern PRE_INTEGRATE_BRANCH_PATTERN = Pattern.compile(\"pr\/(\\\\d+)\");\n-\n@@ -60,1 +59,1 @@\n-        var targetRef = realTargetRef(pr);\n+        var targetRef = PreIntegrations.realTargetRef(pr);\n@@ -175,11 +174,0 @@\n-\n-    public static String realTargetRef(PullRequest pr) {\n-        var targetRef = pr.targetRef();\n-        var matcher = PRE_INTEGRATE_BRANCH_PATTERN.matcher(targetRef);\n-        if (!matcher.matches()) {\n-            return targetRef;\n-        }\n-        String id = matcher.group(1);\n-        var dependentPR = pr.repository().pullRequest(id);\n-        return realTargetRef(dependentPR);\n-    }\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/ApprovalCommand.java","additions":2,"deletions":14,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+import org.openjdk.skara.forge.PreIntegrations;\n@@ -33,1 +34,0 @@\n-import java.util.Optional;\n@@ -62,1 +62,1 @@\n-        var targetRef = ApprovalCommand.realTargetRef(pr);\n+        var targetRef = PreIntegrations.realTargetRef(pr);\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/ApproveCommand.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -79,1 +79,0 @@\n-    private final String realTargetRef;\n@@ -82,0 +81,2 @@\n+    \/\/ Only set if approval is configured for the repo\n+    private String realTargetRef;\n@@ -108,1 +109,0 @@\n-        realTargetRef = ApprovalCommand.realTargetRef(pr);\n@@ -1522,1 +1522,7 @@\n-        return approval != null && approval.needsApproval(realTargetRef);\n+        if (approval != null) {\n+            if (realTargetRef == null) {\n+                realTargetRef = PreIntegrations.realTargetRef(pr);\n+            }\n+            return approval.needsApproval(realTargetRef);\n+        }\n+        return false;\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,0 +62,5 @@\n+\n+    public static String realTargetRef(PullRequest pr) {\n+        Optional<String> idOpt = dependentPullRequestId(pr);\n+        return idOpt.isEmpty() ? pr.targetRef() : realTargetRef(pr.repository().pullRequest(idOpt.get()));\n+    }\n","filename":"forge\/src\/main\/java\/org\/openjdk\/skara\/forge\/PreIntegrations.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"}]}