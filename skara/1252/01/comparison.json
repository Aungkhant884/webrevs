{"files":[{"patch":"@@ -25,0 +25,1 @@\n+import org.openjdk.skara.census.Contributor;\n@@ -373,16 +374,19 @@\n-        var namespace = censusInstance.namespace();\n-        var contributor = namespace.get(reviewer.id());\n-        if (contributor == null) {\n-            return \"@\" + reviewer.username() + \" (no known \" + namespace.name() + \" user name \/ role)\";\n-        } else {\n-            var ret = new StringBuilder();\n-            var censusLink = workItem.bot.censusLink(contributor);\n-            if (censusLink.isPresent()) {\n-                ret.append(\"[\");\n-            }\n-            ret.append(contributor.fullName().orElse(contributor.username()));\n-            if (censusLink.isPresent()) {\n-                ret.append(\"](\");\n-                ret.append(censusLink.get());\n-                ret.append(\")\");\n-            }\n+        var contributor = censusInstance.namespace().get(reviewer.id());\n+        return formatUser(reviewer, contributor);\n+    }\n+\n+    \/**\n+     * Format the contributor user information.\n+     * If both the HostUser and the Contributor are not null, return `[FullName](Link) (@user - RoleName)`\n+     * If the HostUser is not null and the Contributor is null, return `@user (Unknown ProjectName username and role)`\n+     * If the HostUser is null and the Contributor is not null, return `[FullName](Link) - RoleName` or FullName - RoleName\n+     * If both the HostUser and the Contributor are null, return: null string\n+     *\/\n+    private String formatUser(HostUser user, Contributor contributor) {\n+        if (contributor == null && user == null) {\n+            return \"\";\n+        }\n+        var ret = new StringBuilder();\n+        if (contributor != null && user != null) {\n+            \/\/ Both the HostUser and the Contributor are not null\n+            ret.append(contributorLink(contributor));\n@@ -390,1 +394,1 @@\n-            ret.append(reviewer.username());\n+            ret.append(user.username());\n@@ -395,0 +399,27 @@\n+        } else if (contributor == null) {\n+            \/\/ The HostUser is not null and the Contributor is null\n+            ret.append(\"@\");\n+            ret.append(user.username());\n+            ret.append(\" (no known \");\n+            ret.append(censusInstance.namespace().name());\n+            ret.append(\" user name \/ role)\");\n+        } else {\n+            \/\/ The HostUser is null and the Contributor is not null\n+            ret.append(contributorLink(contributor));\n+            ret.append(\" - \");\n+            ret.append(getRole(contributor.username()));\n+        }\n+        return ret.toString();\n+    }\n+\n+    private String contributorLink(Contributor contributor) {\n+        var ret = new StringBuilder();\n+        var censusLink = workItem.bot.censusLink(contributor);\n+        if (censusLink.isPresent()) {\n+            ret.append(\"[\");\n+        }\n+        ret.append(contributor.fullName().orElse(contributor.username()));\n+        if (censusLink.isPresent()) {\n+            ret.append(\"](\");\n+            ret.append(censusLink.get());\n+            ret.append(\")\");\n@@ -396,0 +427,1 @@\n+        return ret.toString();\n@@ -441,1 +473,2 @@\n-                    additionalEntries.add(\" * \" + additional + \" - \" + getRole(additional) + \" ⚠️ Added manually\");\n+                    var userInfo = formatUser(null, censusInstance.census().contributor(additional));\n+                    additionalEntries.add(\" * \" + userInfo + \" ⚠️ Added manually\");\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":51,"deletions":18,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -392,1 +392,1 @@\n-            assertEquals(\"integrationauthor1 - Author ⚠️ Added manually\", contributors.get(0));\n+            assertEquals(\"Generated Author 1 - Author ⚠️ Added manually\", contributors.get(0));\n@@ -394,1 +394,1 @@\n-            \/\/ Remove contributor\n+            \/\/ Remove reviewer\n@@ -410,1 +410,1 @@\n-            assertTrue(pr.body().contains(\"Added manually\"));\n+            assertTrue(pr.body().contains(\" * Generated Author 1 - Author ⚠️ Added manually\"));\n@@ -419,0 +419,1 @@\n+            assertTrue(pr.body().contains(\" * Generated Author 1 (@user2 - Author)\"));\n@@ -454,0 +455,4 @@\n+            \/\/ The reviewer is not added manually\n+            assertFalse(pr.body().contains(\"Added manually\"));\n+            assertTrue(pr.body().contains(\" * Generated Reviewer 1 (@user2 - **Reviewer**)\"));\n+\n@@ -461,0 +466,4 @@\n+\n+            \/\/ The reviewer is not added manually\n+            assertFalse(pr.body().contains(\"Added manually\"));\n+            assertTrue(pr.body().contains(\" * Generated Reviewer 1 (@user2 - **Reviewer**)\"));\n@@ -494,0 +503,4 @@\n+            \/\/ Check the PR body\n+            assertTrue(pr.body().contains(\" * Generated Reviewer 1 - **Reviewer** ⚠️ Added manually\"));\n+            assertTrue(pr.body().contains(\" * Generated Committer 3 - Committer ⚠️ Added manually\"));\n+\n@@ -502,0 +515,6 @@\n+            \/\/ Check the PR body\n+            assertTrue(pr.body().contains(\" * Generated Reviewer 1 - **Reviewer** ⚠️ Added manually\"));\n+            assertTrue(pr.body().contains(\" * Generated Committer 3 - Committer ⚠️ Added manually\"));\n+            assertTrue(pr.body().contains(\" * Generated Reviewer 2 (@user3 - **Reviewer**)\"));\n+            assertFalse(pr.body().contains(\" * Generated Reviewer 2 (@user3 - **Reviewer**) ⚠️ Added manually\"));\n+\n@@ -509,0 +528,6 @@\n+\n+            \/\/ Check the PR body\n+            assertFalse(pr.body().contains(\" * Generated Reviewer 1 - **Reviewer**\"));\n+            assertFalse(pr.body().contains(\" * Generated Committer 3 - Committer\"));\n+            assertTrue(pr.body().contains(\" * Generated Reviewer 2 (@user3 - **Reviewer**)\"));\n+            assertFalse(pr.body().contains(\" * Generated Reviewer 2 (@user3 - **Reviewer**) ⚠️ Added manually\"));\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/ReviewerTests.java","additions":29,"deletions":4,"binary":false,"changes":33,"status":"modified"}]}