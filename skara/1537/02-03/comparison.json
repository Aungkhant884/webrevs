{"files":[{"patch":"@@ -73,0 +73,1 @@\n+    private static final String APPROVAL_NEEDED_MARKER = \"<!-- PullRequestBot approval needed comment -->\";\n@@ -272,1 +273,1 @@\n-        if (approval != null && approval.needsApproval(pr.targetRef())) {\n+        if (approvalNeeded()) {\n@@ -701,1 +702,1 @@\n-                            if (approval != null && approval.needsApproval(pr.targetRef())) {\n+                            if (approvalNeeded()) {\n@@ -1321,1 +1322,3 @@\n-\n+            if (approvalNeeded()) {\n+                updateApprovalNeededComment(additionalProgresses);\n+            }\n@@ -1493,0 +1496,34 @@\n+    private boolean approvalNeeded() {\n+        return approval != null && approval.needsApproval(pr.targetRef());\n+    }\n+\n+    private void updateApprovalNeededComment(Map<String, Boolean> additionalProgresses) {\n+        var existing = findComment(APPROVAL_NEEDED_MARKER);\n+        var existingUnapproved = false;\n+        for (var entry : additionalProgresses.entrySet()) {\n+            if (entry.getKey().endsWith(\"needs maintainer approval\") && !entry.getValue()) {\n+                existingUnapproved = true;\n+                break;\n+            }\n+        }\n+        StringBuilder messageBuilder = new StringBuilder();\n+        if (existingUnapproved) {\n+            messageBuilder.append(\"⚠️  @\").append(pr.author().username())\n+                    .append(\" There are still some issues that have not received maintainer approval.\")\n+                    .append(\"\\n\")\n+                    .append(\"Please follow the instruction here to get maintainer approval: \")\n+                    .append(\"[Requesting push approval for fixes](https:\/\/openjdk.org\/projects\/jdk-updates\/approval.html)\");\n+        } else {\n+            messageBuilder.append(\"@\").append(pr.author().username()).append(\" All the issues have already got the maintainer approval!\");\n+        }\n+        messageBuilder.append(APPROVAL_NEEDED_MARKER);\n+        String message = messageBuilder.toString();\n+        if (existing.isPresent()) {\n+            if (!existing.get().body().equals(message)) {\n+                pr.updateComment(existing.get().id(), message);\n+            }\n+        } else {\n+            pr.addComment(message);\n+        }\n+    }\n+\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":40,"deletions":3,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -408,0 +408,2 @@\n+            assertEquals(pr.store().comments().get(1).body(), \"⚠️  @user1 There are still some issues that have not received maintainer approval.\\n\" +\n+                    \"Please follow the instruction here to get maintainer approval: [Requesting push approval for fixes](https:\/\/openjdk.org\/projects\/jdk-updates\/approval.html)<!-- PullRequestBot approval needed comment -->\");\n@@ -416,0 +418,1 @@\n+            assertEquals(pr.store().comments().get(1).body(), \"@user1 All the issues have already got the maintainer approval!<!-- PullRequestBot approval needed comment -->\");\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/IssueBotTests.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}