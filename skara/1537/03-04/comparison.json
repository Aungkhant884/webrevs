{"files":[{"patch":"@@ -34,0 +34,1 @@\n+    private final String documentLink;\n@@ -36,1 +37,1 @@\n-    public Approval(String prefix, String request, String approved, String rejected) {\n+    public Approval(String prefix, String request, String approved, String rejected, String documentLink) {\n@@ -42,0 +43,1 @@\n+        this.documentLink = documentLink;\n@@ -60,0 +62,4 @@\n+    public String documentLink() {\n+        return documentLink;\n+    }\n+\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/Approval.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -1322,0 +1322,1 @@\n+\n@@ -1323,1 +1324,10 @@\n-                updateApprovalNeededComment(additionalProgresses);\n+                var readyButMaintainerApproval = true;\n+                for (var entry : additionalProgresses.entrySet()) {\n+                    if (!entry.getKey().endsWith(\"needs maintainer approval\") && !entry.getValue()) {\n+                        readyButMaintainerApproval = false;\n+                        break;\n+                    }\n+                }\n+                if (readyButMaintainerApproval) {\n+                    postApprovalNeededComment(additionalProgresses);\n+                }\n@@ -1325,0 +1335,1 @@\n+\n@@ -1500,1 +1511,1 @@\n-    private void updateApprovalNeededComment(Map<String, Boolean> additionalProgresses) {\n+    private void postApprovalNeededComment(Map<String, Boolean> additionalProgresses) {\n@@ -1502,19 +1513,0 @@\n-        var existingUnapproved = false;\n-        for (var entry : additionalProgresses.entrySet()) {\n-            if (entry.getKey().endsWith(\"needs maintainer approval\") && !entry.getValue()) {\n-                existingUnapproved = true;\n-                break;\n-            }\n-        }\n-        StringBuilder messageBuilder = new StringBuilder();\n-        if (existingUnapproved) {\n-            messageBuilder.append(\"⚠️  @\").append(pr.author().username())\n-                    .append(\" There are still some issues that have not received maintainer approval.\")\n-                    .append(\"\\n\")\n-                    .append(\"Please follow the instruction here to get maintainer approval: \")\n-                    .append(\"[Requesting push approval for fixes](https:\/\/openjdk.org\/projects\/jdk-updates\/approval.html)\");\n-        } else {\n-            messageBuilder.append(\"@\").append(pr.author().username()).append(\" All the issues have already got the maintainer approval!\");\n-        }\n-        messageBuilder.append(APPROVAL_NEEDED_MARKER);\n-        String message = messageBuilder.toString();\n@@ -1522,5 +1514,1 @@\n-            if (!existing.get().body().equals(message)) {\n-                pr.updateComment(existing.get().id(), message);\n-            }\n-        } else {\n-            pr.addComment(message);\n+            return;\n@@ -1528,0 +1516,4 @@\n+        String message = \"⚠️  @\" + pr.author().username() +\n+                \" This change has now been reviewed and requires maintainer [approval](\" + approval.documentLink() + \").\" +\n+                APPROVAL_NEEDED_MARKER;\n+        pr.addComment(message);\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":18,"deletions":26,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -233,1 +233,2 @@\n-                Approval approval = new Approval(prefix, request, approved, rejected);\n+                String documentLink = approvalJSON.get(\"documentLink\").asString();\n+                Approval approval = new Approval(prefix, request, approved, rejected, documentLink);\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactory.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-        Approval approval = new Approval(\"\", \"jdk17u-fix-request\", \"jdk17u-fix-yes\", \"jdk17u-fix-no\");\n+        Approval approval = new Approval(\"\", \"jdk17u-fix-request\", \"jdk17u-fix-yes\", \"jdk17u-fix-no\", \"https:\/\/test.openjdk.org\");\n@@ -38,0 +38,1 @@\n+        assertEquals(\"https:\/\/test.openjdk.org\", approval.documentLink());\n@@ -40,1 +41,1 @@\n-        approval = new Approval(\"jdk17u-fix-\", \"request\", \"yes\", \"no\");\n+        approval = new Approval(\"jdk17u-fix-\", \"request\", \"yes\", \"no\", \"https:\/\/test.openjdk.org\");\n@@ -46,1 +47,1 @@\n-        approval = new Approval(\"\", \"-critical-request\", \"-critical-approved\", \"-critical-rejected\");\n+        approval = new Approval(\"\", \"-critical-request\", \"-critical-approved\", \"-critical-rejected\", \"https:\/\/test.openjdk.org\");\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/ApprovalTests.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -320,1 +320,1 @@\n-                    .approval(new Approval(\"\", \"jdk17u-fix-request\", \"jdk17u-fix-yes\", \"jdk17u-fix-no\"))\n+                    .approval(new Approval(\"\", \"jdk17u-fix-request\", \"jdk17u-fix-yes\", \"jdk17u-fix-no\", \"https:\/\/test.openjdk.org\"))\n@@ -366,1 +366,1 @@\n-            Approval approval = new Approval(\"\", \"-critical-request\", \"-critical-approved\", \"-critical-rejected\");\n+            Approval approval = new Approval(\"\", \"-critical-request\", \"-critical-approved\", \"-critical-rejected\", \"https:\/\/test.openjdk.org\");\n@@ -408,2 +408,1 @@\n-            assertEquals(pr.store().comments().get(1).body(), \"⚠️  @user1 There are still some issues that have not received maintainer approval.\\n\" +\n-                    \"Please follow the instruction here to get maintainer approval: [Requesting push approval for fixes](https:\/\/openjdk.org\/projects\/jdk-updates\/approval.html)<!-- PullRequestBot approval needed comment -->\");\n+            assertEquals(\"⚠️  @user1 This change has now been reviewed and requires maintainer [approval](https:\/\/test.openjdk.org).<!-- PullRequestBot approval needed comment -->\", pr.store().comments().get(1).body());\n@@ -418,1 +417,1 @@\n-            assertEquals(pr.store().comments().get(1).body(), \"@user1 All the issues have already got the maintainer approval!<!-- PullRequestBot approval needed comment -->\");\n+            assertEquals(\"⚠️  @user1 This change has now been reviewed and requires maintainer [approval](https:\/\/test.openjdk.org).<!-- PullRequestBot approval needed comment -->\", pr.store().comments().get(1).body());\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/IssueBotTests.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -151,0 +151,1 @@\n+                            \"documentLink\": \"https:\/\/test.openjdk.org\",\n@@ -238,0 +239,1 @@\n+            assertEquals(\"https:\/\/test.openjdk.org\", pullRequestBot7.approval().documentLink());\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactoryTest.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}