{"files":[{"patch":"@@ -27,0 +27,1 @@\n+import org.openjdk.skara.issuetracker.Comment;\n@@ -35,1 +36,1 @@\n-import java.util.regex.Pattern;\n+import java.util.regex.*;\n@@ -53,15 +54,15 @@\n-    private Hash resultingCommitHashFor(PullRequest pr) {\n-       if (pr.labels().contains(\"integrated\")) {\n-           for (var comment : pr.comments()) {\n-               if (comment.author().id().equals(integratorId)) {\n-                   for (var line : comment.body().split(\"\\n\")) {\n-                       if (line.startsWith(\"Pushed as commit\")) {\n-                           var parts = line.split(\" \");\n-                           var hash = parts[parts.length - 1].replace(\".\", \"\");\n-                           return new Hash(hash);\n-                       }\n-                   }\n-               }\n-           }\n-       }\n-       return null;\n+    private final static Pattern pushedPattern = Pattern.compile(\"Pushed as commit ([a-f0-9]{40})\\\\.\");\n+\n+    private Hash resultingCommitHash() {\n+        if (pr.labels().contains(\"integrated\")) {\n+            return pr.comments().stream()\n+                     .filter(comment -> comment.author().id().equals(integratorId))\n+                     .map(Comment::body)\n+                     .map(pushedPattern::matcher)\n+                     .filter(Matcher::find)\n+                     .map(m -> m.group(1))\n+                     .map(Hash::new)\n+                     .findAny()\n+                     .orElse(null);\n+        }\n+        return null;\n@@ -182,1 +183,1 @@\n-        var commit = resultingCommitHashFor(pr);\n+        var commit = resultingCommitHash();\n@@ -196,1 +197,1 @@\n-            var hash = resultingCommitHashFor(pr);\n+            var hash = resultingCommitHash();\n","filename":"bots\/notify\/src\/main\/java\/org\/openjdk\/skara\/bots\/notify\/PullRequestWorkItem.java","additions":19,"deletions":18,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n-import org.openjdk.skara.bots.notify.*;\n+import org.openjdk.skara.bots.notify.NotifyBot;\n@@ -31,1 +31,0 @@\n-import java.net.URI;\n@@ -79,1 +78,1 @@\n-            pr.addComment(\"Pushed as commit \" + editHash.hex() + \".\");\n+            pr.addComment(\"More text!\\n\\n@user Pushed as commit \" + editHash.hex() + \". Even more text.\\n\\nAnd some additional text.\");\n","filename":"bots\/notify\/src\/test\/java\/org\/openjdk\/skara\/bots\/notify\/comment\/CommitCommentNotifierTests.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}