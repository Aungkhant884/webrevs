{"files":[{"patch":"@@ -34,1 +34,2 @@\n-import java.nio.file.Path;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.*;\n@@ -174,13 +175,0 @@\n-    private List<Email> parseArchive(MailingListReader archive) {\n-        var conversations = archive.conversations(Duration.ofDays(365));\n-\n-        if (conversations.size() == 0) {\n-            return new ArrayList<>();\n-        } else if (conversations.size() == 1) {\n-            var conversation = conversations.get(0);\n-            return conversation.allMessages();\n-        } else {\n-            throw new RuntimeException(\"Something is wrong with the mbox\");\n-        }\n-    }\n-\n@@ -258,3 +246,8 @@\n-        var mbox = MailingListServerFactory.createMboxFileServer(mboxBasePath);\n-        var reviewArchiveList = mbox.getListReader(pr.id());\n-        var sentMails = parseArchive(reviewArchiveList);\n+\n+        var sentMails = new ArrayList<Email>();\n+        try {\n+            var archiveContents = Files.readString(mboxBasePath.resolve(pr.id() + \".mbox\"), StandardCharsets.UTF_8);\n+            sentMails.addAll(Mbox.splitMbox(archiveContents, bot.emailAddress()));\n+        } catch (IOException ignored) {\n+        }\n+\n@@ -383,0 +376,1 @@\n+            var mbox = MailingListServerFactory.createMboxFileServer(mboxBasePath);\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/ArchiveWorkItem.java","additions":11,"deletions":17,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -3351,0 +3351,6 @@\n+            listServer.processIncoming();\n+\n+            \/\/ Ensure that the PR is considered again - no duplicates should be sent\n+            pr.addLabel(\"ping\");\n+            TestBotRunner.runPeriodicItems(mlBot);\n+            assertThrows(RuntimeException.class, () -> listServer.processIncoming(Duration.ofMillis(1)));\n","filename":"bots\/mlbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBotTests.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"}]}