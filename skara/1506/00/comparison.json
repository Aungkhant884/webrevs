{"files":[{"patch":"@@ -153,0 +153,1 @@\n+            var issueString = \"\";\n@@ -154,1 +155,1 @@\n-                var issueString = repo.value().get(\"issues\").asString();\n+                issueString = repo.value().get(\"issues\").asString();\n@@ -156,9 +157,0 @@\n-                var issueProject = issueProjects.get(issueString);\n-                if (issueProject == null) {\n-                    issueProject = configuration.issueProject(issueString);\n-                    issueProjects.put(issueString, issueProject);\n-                }\n-                if (!repositories.containsKey(issueProject)) {\n-                    repositories.put(issueProject, new ArrayList<>());\n-                }\n-                repositories.get(issueProject).add(repository);\n@@ -183,1 +175,13 @@\n-                botBuilder.enableCsr(repo.value().get(\"csr\").asBoolean());\n+                var enableCsr = repo.value().get(\"csr\").asBoolean();\n+                botBuilder.enableCsr(enableCsr);\n+                if (enableCsr && !issueString.equals(\"\")) {\n+                    var issueProject = issueProjects.get(issueString);\n+                    if (issueProject == null) {\n+                        issueProject = configuration.issueProject(issueString);\n+                        issueProjects.put(issueString, issueProject);\n+                    }\n+                    if (!repositories.containsKey(issueProject)) {\n+                        repositories.put(issueProject, new ArrayList<>());\n+                    }\n+                    repositories.get(issueProject).add(repository);\n+                }\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactory.java","additions":15,"deletions":11,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -107,1 +107,19 @@\n-                          \"csr\": true,\n+                          \"csr\": false,\n+                          \"two-reviewers\": [\n+                            \"rfr\"\n+                          ],\n+                          \"24h\": [\n+                            \"24h_test\"\n+                          ],\n+                          \"integrators\": [\n+                            \"integrator1\",\n+                            \"integrator2\"\n+                          ],\n+                          \"reviewCleanBackport\": true,\n+                          \"reviewMerge\": true,\n+                          \"processPR\": false\n+                        },\n+                        \"repo7\": {\n+                          \"census\": \"census:master\",\n+                          \"censuslink\": \"https:\/\/test.test.com\",\n+                          \"issues\": \"TEST3\",\n@@ -139,0 +157,1 @@\n+                    .addHostedRepository(\"repo7\", new TestHostedRepository(TestHost.createNew(List.of()), \"repo7\"))\n@@ -144,0 +163,1 @@\n+                    .addIssueProject(\"TEST3\", new TestIssueProject(TestHost.createNew(List.of()), \"TEST3\"))\n@@ -148,2 +168,3 @@\n-            \/\/A pullRequestBot for every configured repository and A CSRIssueBot for every configured issue project\n-            assertEquals(5, bots.size());\n+            \/\/ A pullRequestBot for every configured repository and A CSRIssueBot for every configured issue project with any repo configured with 'csr: true'\n+            \/\/ No CSRIssueBot created for issueTracker TEST3 because it is not associated with any CSR enabled repo\n+            assertEquals(6, bots.size());\n@@ -151,13 +172,13 @@\n-            var pullRequestBot1 = (PullRequestBot) bots.get(0);\n-            assertEquals(\"PullRequestBot@repo6\", pullRequestBot1.toString());\n-            assertEquals(\"used to run tests\", pullRequestBot1.externalPullRequestCommands().get(\"test\"));\n-            assertEquals(\"TEST2\", pullRequestBot1.issueProject().name());\n-            assertEquals(\"census\", pullRequestBot1.censusRepo().name());\n-            assertEquals(\"master\", pullRequestBot1.censusRef());\n-            assertEquals(\"{test=used to run tests}\", pullRequestBot1.externalPullRequestCommands().toString());\n-            assertEquals(\"{test=Signature needs verify}\", pullRequestBot1.blockingCheckLabels().toString());\n-            assertEquals(\"[rfr]\", pullRequestBot1.twoReviewersLabels().toString());\n-            assertEquals(\"[24h_test]\", pullRequestBot1.twentyFourHoursLabels().toString());\n-            assertFalse(pullRequestBot1.ignoreStaleReviews());\n-            assertEquals(\".*\", pullRequestBot1.allowedTargetBranches().toString());\n-            var integrators = pullRequestBot1.integrators();\n+            var pullRequestBot0 = (PullRequestBot) bots.get(0);\n+            assertEquals(\"PullRequestBot@repo6\", pullRequestBot0.toString());\n+            assertEquals(\"used to run tests\", pullRequestBot0.externalPullRequestCommands().get(\"test\"));\n+            assertEquals(\"TEST2\", pullRequestBot0.issueProject().name());\n+            assertEquals(\"census\", pullRequestBot0.censusRepo().name());\n+            assertEquals(\"master\", pullRequestBot0.censusRef());\n+            assertEquals(\"{test=used to run tests}\", pullRequestBot0.externalPullRequestCommands().toString());\n+            assertEquals(\"{test=Signature needs verify}\", pullRequestBot0.blockingCheckLabels().toString());\n+            assertEquals(\"[rfr]\", pullRequestBot0.twoReviewersLabels().toString());\n+            assertEquals(\"[24h_test]\", pullRequestBot0.twentyFourHoursLabels().toString());\n+            assertFalse(pullRequestBot0.ignoreStaleReviews());\n+            assertEquals(\".*\", pullRequestBot0.allowedTargetBranches().toString());\n+            var integrators = pullRequestBot0.integrators();\n@@ -167,4 +188,7 @@\n-            assertTrue(pullRequestBot1.reviewCleanBackport());\n-            assertTrue(pullRequestBot1.reviewMerge());\n-            assertEquals(\"mlbridge[bot]\", pullRequestBot1.mlbridgeBotName());\n-            assertTrue(pullRequestBot1.enableMerge());\n+            assertTrue(pullRequestBot0.reviewCleanBackport());\n+            assertTrue(pullRequestBot0.reviewMerge());\n+            assertEquals(\"mlbridge[bot]\", pullRequestBot0.mlbridgeBotName());\n+            assertTrue(pullRequestBot0.enableMerge());\n+\n+            var pullRequestBot1 = (PullRequestBot) bots.get(1);\n+            assertEquals(\"PullRequestBot@repo7\", pullRequestBot1.toString());\n@@ -172,1 +196,1 @@\n-            var pullRequestBot2 = (PullRequestBot) bots.get(1);\n+            var pullRequestBot2 = (PullRequestBot) bots.get(2);\n@@ -176,1 +200,1 @@\n-            var pullRequestBot3 = (PullRequestBot) bots.get(2);\n+            var pullRequestBot3 = (PullRequestBot) bots.get(3);\n@@ -180,2 +204,2 @@\n-            var csrIssueBot1 = (CSRIssueBot) bots.get(3);\n-            assertEquals(2, csrIssueBot1.repositories().size());\n+            var csrIssueBot1 = (CSRIssueBot) bots.get(4);\n+            assertEquals(1, csrIssueBot1.repositories().size());\n@@ -183,1 +207,0 @@\n-            assertNotNull(csrIssueBot1.getPRBot(\"repo6\"));\n@@ -185,1 +208,1 @@\n-            var csrIssueBot2 = (CSRIssueBot) bots.get(4);\n+            var csrIssueBot2 = (CSRIssueBot) bots.get(5);\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactoryTest.java","additions":49,"deletions":26,"binary":false,"changes":75,"status":"modified"}]}