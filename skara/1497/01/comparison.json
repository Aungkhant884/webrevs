{"files":[{"patch":"@@ -294,0 +294,12 @@\n+            var backportHashMatcher = BACKPORT_HASH_TITLE_PATTERN.matcher(pr.title());\n+            var backportIssueMatcher = BACKPORT_ISSUE_TITLE_PATTERN.matcher(pr.title());\n+\n+            \/\/ If backport pr is not allowed, reply warning to the user and return\n+            if (!bot.enableBackport() && (backportHashMatcher.matches() || backportIssueMatcher.matches())) {\n+                var backportDisabledText = \"<!-- backport error -->\\n\" +\n+                        \":warning: @\" + pr.author().username() + \" backports are not allowed in this repository.\" +\n+                        \" If it was unintentional, please modify the title of this pull request.\";\n+                addErrorComment(backportDisabledText, comments);\n+                return List.of();\n+            }\n+\n@@ -310,1 +322,0 @@\n-            var backportHashMatcher = BACKPORT_HASH_TITLE_PATTERN.matcher(pr.title());\n@@ -383,1 +394,0 @@\n-            var backportIssueMatcher = BACKPORT_ISSUE_TITLE_PATTERN.matcher(pr.title());\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckWorkItem.java","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -72,0 +72,1 @@\n+    private final boolean enableBackport;\n@@ -85,1 +86,1 @@\n-                   boolean enableMerge) {\n+                   boolean enableMerge, boolean enableBackport) {\n@@ -116,0 +117,1 @@\n+        this.enableBackport = enableBackport;\n@@ -305,0 +307,4 @@\n+    public boolean enableBackport() {\n+        return enableBackport;\n+    }\n+\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBot.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -64,0 +64,1 @@\n+    private boolean enableBackport = true;\n@@ -218,0 +219,5 @@\n+    public PullRequestBotBuilder enableBackport(boolean enableBackport) {\n+        this.enableBackport = enableBackport;\n+        return this;\n+    }\n+\n@@ -226,1 +232,1 @@\n-                                  processPR, processCommit, enableMerge);\n+                                  processPR, processCommit, enableMerge, enableBackport);\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotBuilder.java","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -191,0 +191,3 @@\n+            if (repo.value().contains(\"backport\")) {\n+                botBuilder.enableBackport(repo.value().get(\"backport\").asBoolean());\n+            }\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactory.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2891,0 +2891,48 @@\n+\n+    @Test\n+    void backportDisabled(TestInfo testInfo) throws IOException {\n+        try (var credentials = new HostCredentials(testInfo);\n+             var tempFolder = new TemporaryDirectory()) {\n+            var author = credentials.getHostedRepository();\n+            var reviewer = credentials.getHostedRepository();\n+\n+            var censusBuilder = credentials.getCensusBuilder()\n+                    .addAuthor(author.forge().currentUser().id())\n+                    .addReviewer(reviewer.forge().currentUser().id());\n+            var seedFolder = tempFolder.path().resolve(\"seed\");\n+            var prBot = PullRequestBot.newBuilder()\n+                    .repo(author)\n+                    .censusRepo(censusBuilder.build())\n+                    .censusLink(\"https:\/\/census.com\/{{contributor}}-profile\")\n+                    .seedStorage(seedFolder)\n+                    .enableBackport(false)\n+                    .build();\n+\n+            \/\/ Populate the projects repository\n+            var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());\n+            var masterHash = localRepo.resolve(\"master\").orElseThrow();\n+            localRepo.push(masterHash, author.authenticatedUrl(), \"master\", true);\n+\n+            \/\/ Make a change with a corresponding PR\n+            var editHash = CheckableRepository.appendAndCommit(localRepo);\n+            localRepo.push(editHash, author.authenticatedUrl(), \"refs\/heads\/edit\", true);\n+            var pr = credentials.createPullRequest(author, \"master\", \"edit\", \"Backport 0123456789012345678901234567890123456789\");\n+\n+            \/\/ Check the status\n+            TestBotRunner.runPeriodicItems(prBot);\n+\n+            var comment = pr.store().comments().get(pr.store().comments().size() - 1);\n+            assertEquals(1, pr.store().comments().size());\n+            assertTrue(comment.body().contains(\"backports are not allowed in this repository\"));\n+\n+            pr.setTitle(\"Backport 123\");\n+            TestBotRunner.runPeriodicItems(prBot);\n+            comment = pr.store().comments().get(pr.store().comments().size() - 1);\n+            assertEquals(1, pr.store().comments().size());\n+            assertTrue(comment.body().contains(\"backports are not allowed in this repository\"));\n+\n+            pr.setTitle(\"SKARA-123\");\n+            TestBotRunner.runPeriodicItems(prBot);\n+            assertEquals(1, pr.store().comments().size());\n+        }\n+    }\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CheckTests.java","additions":48,"deletions":0,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -71,0 +71,1 @@\n+                          \"backport\": false,\n@@ -89,0 +90,1 @@\n+                          \"backport\": true,\n@@ -171,0 +173,1 @@\n+            assertTrue(pullRequestBot1.enableBackport());\n@@ -175,0 +178,1 @@\n+            assertTrue(pullRequestBot2.enableBackport());\n@@ -179,0 +183,1 @@\n+            assertFalse(pullRequestBot3.enableBackport());\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactoryTest.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}