{"files":[{"patch":"@@ -179,1 +179,1 @@\n-                log.info(\"No CSR found for issue \" + jbsIssueOpt.get().id() + \" for \" + describe(pr));\n+                log.info(\"No CSR found for issue \" + jbsIssueOpt.get().id() + \" for \" + describe(pr) + \" with fixVersion \" + versionOpt.get().raw());\n","filename":"bots\/csr\/src\/main\/java\/org\/openjdk\/skara\/bots\/csr\/PullRequestWorkItem.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+import org.openjdk.skara.jbs.JdkVersion;\n@@ -120,1 +121,1 @@\n-    private List<Issue> issues(boolean withCsr, boolean withJep) {\n+    private List<Issue> issues() {\n@@ -126,6 +127,9 @@\n-            if (withCsr) {\n-                issues.addAll(getCsrIssues(issues));\n-            }\n-            if (withJep) {\n-                getJepIssue().ifPresent(issues::add);\n-            }\n+            return issues;\n+        }\n+        return List.of();\n+    }\n+\n+    private List<Issue> issuesWithCSRAndJEP(List<Issue> issues, List<org.openjdk.skara.issuetracker.Issue> csrIssueTrackerIssues) {\n+        if (!issues.isEmpty()) {\n+            issues.addAll(getCsrIssues(csrIssueTrackerIssues));\n+            getJepIssue().ifPresent(issues::add);\n@@ -140,1 +144,1 @@\n-    private List<org.openjdk.skara.issuetracker.Issue> getCsrIssueTrackerIssues(List<Issue> issues) {\n+    private List<org.openjdk.skara.issuetracker.Issue> getCsrIssueTrackerIssues(List<Issue> issues, JdkVersion version) {\n@@ -145,2 +149,1 @@\n-        var versionOpt = BotUtils.getVersion(pr);\n-        if (versionOpt.isEmpty()) {\n+        if (version == null) {\n@@ -155,1 +158,1 @@\n-            Backports.findCsr(jbsIssueOpt.get(), versionOpt.get())\n+            Backports.findCsr(jbsIssueOpt.get(), version)\n@@ -164,1 +167,1 @@\n-    private List<Issue> getCsrIssues(List<Issue> issues) {\n+    private List<Issue> getCsrIssues(List<org.openjdk.skara.issuetracker.Issue> csrIssueTrackerIssues) {\n@@ -166,1 +169,1 @@\n-        return getCsrIssueTrackerIssues(issues).stream()\n+        return csrIssueTrackerIssues.stream()\n@@ -265,1 +268,1 @@\n-    private Map<String, Boolean> botSpecificProgresses() {\n+    private Map<String, Boolean> botSpecificProgresses(List<org.openjdk.skara.issuetracker.Issue> csrIssueTrackerIssues, JdkVersion version) {\n@@ -268,1 +271,1 @@\n-        var csrIssues = getCsrIssueTrackerIssues(issues(false, false)).stream()\n+        var csrIssues = csrIssueTrackerIssues.stream()\n@@ -274,1 +277,2 @@\n-            ret.put(\"Change requires a CSR request (needs to be created) to be approved\", false);\n+            ret.put(\"Change requires a CSR request matching fixVersion \" + (version != null ? version.raw() : \"(No fixVersion in .jcheck\/conf)\")\n+                    + \" to be approved (needs to be created)\", false);\n@@ -321,1 +325,1 @@\n-    private List<String> botSpecificIntegrationBlockers() {\n+    private List<String> botSpecificIntegrationBlockers(List<Issue> issues) {\n@@ -324,1 +328,0 @@\n-        var issues = issues(false, false);\n@@ -613,1 +616,1 @@\n-                                    List<String> integrationBlockers, boolean reviewNeeded) {\n+                                    List<String> integrationBlockers, boolean reviewNeeded, List<Issue> allIssues) {\n@@ -640,1 +643,0 @@\n-        var issues = issues(true, true);\n@@ -642,1 +644,1 @@\n-        if (issueProject != null && !issues.isEmpty()) {\n+        if (issueProject != null && !allIssues.isEmpty()) {\n@@ -644,1 +646,1 @@\n-            if (issues.size() > 1) {\n+            if (allIssues.size() > 1) {\n@@ -648,1 +650,1 @@\n-            for (var currentIssue : issues) {\n+            for (var currentIssue : allIssues) {\n@@ -1124,0 +1126,10 @@\n+\n+            JdkVersion version = null;\n+            try {\n+                version = BotUtils.getVersion(pr).orElse(null);\n+            } catch (Exception e) {\n+            }\n+            \/\/ issues without CSR issues and JEP issues\n+            var issues = issues();\n+            var csrIssueTrackerIssues = getCsrIssueTrackerIssues(issues, version);\n+\n@@ -1152,1 +1164,1 @@\n-                additionalProgresses = botSpecificProgresses();\n+                additionalProgresses = botSpecificProgresses(csrIssueTrackerIssues, version);\n@@ -1157,1 +1169,1 @@\n-            var integrationBlockers = botSpecificIntegrationBlockers();\n+            var integrationBlockers = botSpecificIntegrationBlockers(issues);\n@@ -1163,1 +1175,1 @@\n-            var statusMessage = getStatusMessage(visitor, additionalErrors, additionalProgresses, integrationBlockers, reviewNeeded);\n+            var statusMessage = getStatusMessage(visitor, additionalErrors, additionalProgresses, integrationBlockers, reviewNeeded, issuesWithCSRAndJEP(issues, csrIssueTrackerIssues));\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckRun.java","additions":38,"deletions":26,"binary":false,"changes":64,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -93,1 +93,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -105,1 +105,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -198,1 +198,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -237,1 +237,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -246,1 +246,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -258,1 +258,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -267,1 +267,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -276,1 +276,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -315,1 +315,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -358,1 +358,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -400,1 +400,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -411,1 +411,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -596,1 +596,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -636,1 +636,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -656,1 +656,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -689,1 +689,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -700,1 +700,1 @@\n-            assertTrue(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -760,1 +760,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion (No fixVersion in .jcheck\/conf) to be approved (needs to be created)\"));\n@@ -771,1 +771,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion (No fixVersion in .jcheck\/conf) to be approved (needs to be created)\"));\n@@ -789,1 +789,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion (No fixVersion in .jcheck\/conf) to be approved (needs to be created)\"));\n@@ -800,1 +800,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion (No fixVersion in .jcheck\/conf) to be approved (needs to be created)\"));\n@@ -818,1 +818,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 17 to be approved (needs to be created)\"));\n@@ -829,1 +829,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 17 to be approved (needs to be created)\"));\n@@ -864,1 +864,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 17 to be approved (needs to be created)\"));\n@@ -875,1 +875,1 @@\n-            assertFalse(pr.store().body().contains(\"Change requires a CSR request (needs to be created) to be approved\"));\n+            assertFalse(pr.store().body().contains(\"Change requires a CSR request matching fixVersion 17 to be approved (needs to be created)\"));\n@@ -938,1 +938,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 11 to be approved (needs to be created)\"));\n@@ -998,1 +998,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -1038,1 +1038,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n@@ -1154,1 +1154,1 @@\n-            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request (needs to be created) to be approved\"));\n+            assertTrue(pr.store().body().contains(\"- [ ] Change requires a CSR request matching fixVersion 0.1 to be approved (needs to be created)\"));\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/CSRTests.java","additions":30,"deletions":30,"binary":false,"changes":60,"status":"modified"}]}