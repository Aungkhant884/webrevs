{"files":[{"patch":"@@ -335,2 +335,2 @@\n-        Commit currentPostIntegrateCommit;\n-        Commit lastPostIntegrateCommit;\n+        Commit currentMarkAsMergedCommit;\n+        Commit lastMarkAsMergedCommit;\n@@ -345,2 +345,4 @@\n-            currentPostIntegrateCommit = isMarkAsMergeCommit(commits.get(0)) ? commits.get(0) : null;\n-            lastPostIntegrateCommit = isMarkAsMergeCommit(commits.get(1)) ? commits.get(1) : null;\n+            currentMarkAsMergedCommit = isMarkAsMergeCommit(commits.get(0)) ? commits.get(0) : null;\n+            \/\/ Work with the possibility that only a single commit exists on the repository\n+            lastMarkAsMergedCommit =\n+                    (commits.size() == 2 ? (isMarkAsMergeCommit(commits.get(1)) ? commits.get(1) : null) : null);\n@@ -349,2 +351,2 @@\n-             * Not good, have to handle this now, since commits after a post integrate one\n-             * are treated as broken)\n+             * Not good, have to handle this now, since commits after a mark as merged one are\n+             * treated as broken)\n@@ -352,4 +354,5 @@\n-            if (lastPostIntegrateCommit != null) {\n-                repository.reset(lastPostIntegrateCommit.parents().get(0), true);\n-                repository.push(lastPostIntegrateCommit.parents().get(0), pr.repository().url(), pr.targetRef(), true);\n-                lastPostIntegrateCommit = null;\n+            if (lastMarkAsMergedCommit != null) {\n+                \/\/ Mark as Merged commits always have a preceding commit, same applies below\n+                repository.reset(lastMarkAsMergedCommit.parents().get(0), true);\n+                repository.push(lastMarkAsMergedCommit.parents().get(0), pr.repository().url(), pr.targetRef(), true);\n+                lastMarkAsMergedCommit = null;\n@@ -358,2 +361,2 @@\n-                 * In the unlikely and very erroneous case that 2 post integrate commits are\n-                 * back to back getting rid of the first one would remove the one that comes after\n+                 * In the unlikely and very erroneous case that 2 mark as merged commits are back\n+                 * to back getting rid of the first one would remove the one that comes after\n@@ -361,2 +364,2 @@\n-                currentPostIntegrateCommit = null;\n-            } else if (currentPostIntegrateCommit != null) {\n+                currentMarkAsMergedCommit = null;\n+            } else if (currentMarkAsMergedCommit != null) {\n@@ -364,4 +367,4 @@\n-                        !currentPostIntegrateCommit.message().get(0).substring(28).equals(hash.hex())) {\n-                    repository.reset(currentPostIntegrateCommit.parents().get(0), true);\n-                    repository.push(currentPostIntegrateCommit.parents().get(0), pr.repository().url(), pr.targetRef(), true);\n-                    currentPostIntegrateCommit = null;\n+                        !currentMarkAsMergedCommit.message().get(0).substring(31).equals(hash.hex())) {\n+                    repository.reset(currentMarkAsMergedCommit.parents().get(0), true);\n+                    repository.push(currentMarkAsMergedCommit.parents().get(0), pr.repository().url(), pr.targetRef(), true);\n+                    currentMarkAsMergedCommit = null;\n@@ -373,1 +376,1 @@\n-             * own post integrate commit\n+             * own mark as merged commit\n@@ -375,1 +378,1 @@\n-            if (pr.state() != PullRequest.State.RESOLVED && currentPostIntegrateCommit == null) {\n+            if (pr.state() != PullRequest.State.RESOLVED && currentMarkAsMergedCommit == null) {\n@@ -381,1 +384,1 @@\n-                markMergedHash = repository.commit(\"Post Integration Merging of \" + hash.hex(), \"duke\", \"duke@openjdk.org\");\n+                markMergedHash = repository.commit(\"Mark Integration as Merged for \" + hash.hex(), \"duke\", \"duke@openjdk.org\");\n@@ -384,1 +387,1 @@\n-                markMergedHash = (pr.state() == PullRequest.State.RESOLVED ? null : currentPostIntegrateCommit.hash());\n+                markMergedHash = (pr.state() == PullRequest.State.RESOLVED ? null : currentMarkAsMergedCommit.hash());\n@@ -418,1 +421,1 @@\n-                    commit.message().get(0).startsWith(\"Post Integration Merging of \") : false);\n+                    commit.message().get(0).startsWith(\"Mark Integration as Merged for \") : false);\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/IntegrateCommand.java","additions":26,"deletions":23,"binary":false,"changes":49,"status":"modified"}]}