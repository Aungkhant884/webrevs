{"files":[{"patch":"@@ -328,2 +328,19 @@\n-    public static String mergeBranch(PullRequest pull) {\n-        return \"merged\/\" + pull.id();\n+    public static Optional<String> integratedBranch(final PullRequest pull) {\n+        if (isIntegrationBranch(pull.targetRef())) {\n+            final String integrationMarker = \"integrated\/\" + pull.id() + \"\/\";\n+            final int branchStart = pull.targetRef().indexOf(integrationMarker);\n+            if (branchStart == -1) {\n+                throw new IllegalStateException(\"Cannot parse integration branch \" + pull.targetRef());\n+            }\n+            return Optional.of(pull.targetRef().substring(branchStart + integrationMarker.length()));\n+        } else {\n+            return Optional.empty();\n+        }\n+    }\n+\n+    public static boolean isIntegrationBranch(final String name) {\n+        return name.startsWith(\"integrated\/\");\n+    }\n+\n+    public static String integrationBranch(final PullRequest pull, final String branch) {\n+        return \"integrated\/\" + pull.id() + \"\/\" + branch;\n@@ -335,1 +352,1 @@\n-        final String ref = pr.targetRef();\n+        final String integrationBranch = integrationBranch(pr, pr.targetRef());\n@@ -339,2 +356,2 @@\n-            Hash branchTip = repository.fetch(pr.repository().url(), pr.sourceRef());\n-            repository.push(branchTip, pr.repository().url(), mergeBranch(pr), true);\n+            Hash tip = repository.fetch(pr.repository().url(), pr.targetRef());\n+            repository.push(tip, pr.repository().url(), integrationBranch, true);\n@@ -345,1 +362,1 @@\n-        pr.setTargetRef(mergeBranch(pr));\n+        pr.setTargetRef(integrationBranch);\n@@ -347,2 +364,1 @@\n-        pr.repository().deleteBranch(mergeBranch(pr));\n-        pr.setTargetRef(ref);\n+        pr.repository().deleteBranch(integrationBranch);\n@@ -360,1 +376,1 @@\n-        reply.println(\"Your pull request was correctly integrated into the \" + ref + \" branch.\");\n+        reply.println(\"Your pull request was correctly integrated into the \" + integratedBranch(pr) + \" branch.\");\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/IntegrateCommand.java","additions":25,"deletions":9,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -27,0 +27,2 @@\n+import org.openjdk.skara.bots.pr.IntegrateCommand;\n+\n@@ -52,1 +54,1 @@\n-                candidate.setTargetRef(pr.targetRef());\n+                candidate.setTargetRef(IntegrateCommand.integratedBranch(pr).orElse(pr.targetRef()));\n","filename":"forge\/src\/main\/java\/org\/openjdk\/skara\/forge\/PreIntegrations.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}