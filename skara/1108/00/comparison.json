{"files":[{"patch":"@@ -300,1 +300,0 @@\n-        ArchiveItem lastCommentOrReview = generated.get(0);\n@@ -302,1 +301,0 @@\n-        eligible.add(lastCommentOrReview);\n@@ -305,3 +303,2 @@\n-                if (item.createdAt().isBefore(comment.createdAt()) && item.createdAt().isAfter(lastCommentOrReview.createdAt())) {\n-                    lastCommentOrReview = item;\n-                    eligible.add(lastCommentOrReview);\n+                if (item.createdAt().isBefore(comment.createdAt())) {\n+                    eligible.add(item);\n@@ -321,1 +318,9 @@\n-        return lastCommentOrReview;\n+        ArchiveItem lastRevisionItem = generated.get(0);\n+        for (var item : generated) {\n+            if (item.id().startsWith(\"ha\")) {\n+                if (item.createdAt().isBefore(comment.createdAt())) {\n+                    lastRevisionItem = item;\n+                }\n+            }\n+        }\n+        return lastRevisionItem;\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/ArchiveItem.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+import org.junit.jupiter.api.*;\n@@ -28,0 +29,2 @@\n+import org.openjdk.skara.json.JSON;\n+import org.openjdk.skara.mailinglist.*;\n@@ -29,1 +32,0 @@\n-import org.openjdk.skara.mailinglist.MailingListServerFactory;\n@@ -32,3 +34,0 @@\n-import org.openjdk.skara.json.JSON;\n-\n-import org.junit.jupiter.api.*;\n@@ -262,1 +261,1 @@\n-            pr.addComment(\"This is another comment\");\n+            pr.addComment(\"@\" + pr.author().username() +\" This is another comment\");\n@@ -1181,1 +1180,1 @@\n-            assertEquals(3, archiveContainsCount(archiveFolder.path(), \"First comment\"));\n+            assertEquals(2, archiveContainsCount(archiveFolder.path(), \"First comment\"));\n@@ -1299,1 +1298,2 @@\n-            pr.addComment(\"Second comment\\nfourth line\");\n+            var authorPr = author.pullRequest(pr.id());\n+            authorPr.addComment(\"Second comment\\nfourth line\");\n@@ -1308,1 +1308,1 @@\n-            \/\/ The first comment should be quoted more often than the second\n+            \/\/ The first comment should be replied to once, and the original post once\n@@ -1310,3 +1310,2 @@\n-            assertEquals(2, archiveContainsCount(archiveFolder.path(), \"First comment\"));\n-            assertEquals(3, archiveContainsCount(archiveFolder.path(), \"First comm\"));\n-            assertEquals(1, archiveContainsCount(archiveFolder.path(), \"Second comment\"));\n+            assertEquals(1, archiveContainsCount(archiveFolder.path(), Pattern.quote(reviewPr.author().fullName()) + \".* wrote\"));\n+            assertEquals(1, archiveContainsCount(archiveFolder.path(), Pattern.quote(pr.author().fullName()) + \".* wrote\"));\n@@ -2355,1 +2354,1 @@\n-            pr.addComment(\"Thanks for the review!\");\n+            pr.addComment(\"@\" + reviewer.forge().currentUser().username() + \" Thanks for the review!\");\n@@ -3110,1 +3109,1 @@\n-            pr.addComment(\"This is another comment\");\n+            pr.addComment(\"@\" + pr.author().username() + \" This is another comment\");\n","filename":"bots\/mlbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBotTests.java","additions":12,"deletions":13,"binary":false,"changes":25,"status":"modified"}]}