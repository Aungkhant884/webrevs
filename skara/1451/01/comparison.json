{"files":[{"patch":"@@ -40,0 +40,1 @@\n+import org.openjdk.skara.issuetracker.Comment;\n@@ -158,0 +159,1 @@\n+        boolean withdrawnCSRWhenCSRNeeded = false;\n@@ -228,0 +230,3 @@\n+                    if (CSRNeeded(pr.comments())) {\n+                        withdrawnCSRWhenCSRNeeded = true;\n+                    }\n@@ -251,1 +256,1 @@\n-        if (allCSRApproved && existingCSR && pr.labelNames().contains(CSR_LABEL)) {\n+        if (allCSRApproved && existingCSR && !withdrawnCSRWhenCSRNeeded && pr.labelNames().contains(CSR_LABEL)) {\n@@ -259,0 +264,16 @@\n+    \/**\n+     * Determine whether the CSR label is added via '\/csr needed' command\n+     *\/\n+    private boolean CSRNeeded(List<Comment> comments) {\n+        var CSRNeededCommentCount = 0;\n+        for (var comment : comments) {\n+            if (comment.body().contains(\"<!-- csr: 'needed' -->\")) {\n+                CSRNeededCommentCount++;\n+            }\n+            if (comment.body().contains(\"<!-- csr: 'unneeded' -->\") && CSRNeededCommentCount > 0) {\n+                CSRNeededCommentCount--;\n+            }\n+        }\n+        return CSRNeededCommentCount > 0;\n+    }\n+\n","filename":"bots\/csr\/src\/main\/java\/org\/openjdk\/skara\/bots\/csr\/PullRequestWorkItem.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -558,1 +558,1 @@\n-    void testPRWithMultipleIssues(TestInfo testInfo) throws IOException{\n+    void testPRWithMultipleIssues(TestInfo testInfo) throws IOException {\n@@ -616,1 +616,1 @@\n-            \/\/ PR should not contain csr label\n+            \/\/ PR should not contain csr label because CSR label is not added via '\/csr needed'\n@@ -635,0 +635,6 @@\n+\n+            \/\/ Approve CSR2\n+            csr2.setProperty(\"resolution\", JSON.object().put(\"name\", \"Approved\"));\n+            TestBotRunner.runPeriodicItems(csrIssueBot);\n+            \/\/ PR should not contain csr label\n+            assertFalse(pr.store().labelNames().contains(\"csr\"));\n","filename":"bots\/csr\/src\/test\/java\/org\/openjdk\/skara\/bots\/csr\/CSRBotTests.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"}]}