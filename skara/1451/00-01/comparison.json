{"files":[{"patch":"@@ -40,0 +40,1 @@\n+import org.openjdk.skara.issuetracker.Comment;\n@@ -158,1 +159,1 @@\n-        boolean existingWithdrawnCSR = false;\n+        boolean withdrawnCSRWhenCSRNeeded = false;\n@@ -229,1 +230,3 @@\n-                    existingWithdrawnCSR = true;\n+                    if (CSRNeeded(pr.comments())) {\n+                        withdrawnCSRWhenCSRNeeded = true;\n+                    }\n@@ -253,1 +256,1 @@\n-        if (allCSRApproved && existingCSR && !existingWithdrawnCSR && pr.labelNames().contains(CSR_LABEL)) {\n+        if (allCSRApproved && existingCSR && !withdrawnCSRWhenCSRNeeded && pr.labelNames().contains(CSR_LABEL)) {\n@@ -261,0 +264,16 @@\n+    \/**\n+     * Determine whether the CSR label is added via '\/csr needed' command\n+     *\/\n+    private boolean CSRNeeded(List<Comment> comments) {\n+        var CSRNeededCommentCount = 0;\n+        for (var comment : comments) {\n+            if (comment.body().contains(\"<!-- csr: 'needed' -->\")) {\n+                CSRNeededCommentCount++;\n+            }\n+            if (comment.body().contains(\"<!-- csr: 'unneeded' -->\") && CSRNeededCommentCount > 0) {\n+                CSRNeededCommentCount--;\n+            }\n+        }\n+        return CSRNeededCommentCount > 0;\n+    }\n+\n","filename":"bots\/csr\/src\/main\/java\/org\/openjdk\/skara\/bots\/csr\/PullRequestWorkItem.java","additions":22,"deletions":3,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -616,2 +616,2 @@\n-            \/\/ PR should still contain csr label\n-            assertTrue(pr.store().labelNames().contains(\"csr\"));\n+            \/\/ PR should not contain csr label because CSR label is not added via '\/csr needed'\n+            assertFalse(pr.store().labelNames().contains(\"csr\"));\n@@ -633,2 +633,2 @@\n-            \/\/ PR should still contain csr label\n-            assertTrue(pr.store().labelNames().contains(\"csr\"));\n+            \/\/ PR should not contain csr label\n+            assertFalse(pr.store().labelNames().contains(\"csr\"));\n","filename":"bots\/csr\/src\/test\/java\/org\/openjdk\/skara\/bots\/csr\/CSRBotTests.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}