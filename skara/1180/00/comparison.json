{"files":[{"patch":"@@ -42,0 +42,1 @@\n+import org.openjdk.skara.network.UncheckedRestException;\n@@ -185,0 +186,6 @@\n+                } catch (UncheckedRestException e) {\n+                    EXCEPTIONS_COUNTER.labels(item.botName(), item.workItemName(), e.getClass().getName()).inc();\n+                    \/\/ Log as WARNING to avoid triggering alarms. Failed REST calls are tracked\n+                    \/\/ using metrics.\n+                    log.log(Level.WARNING, \"RestException during item execution (\" + item + \")\", e);\n+                    item.handleRuntimeException(e);\n@@ -352,0 +359,4 @@\n+            } catch (UncheckedRestException e) {\n+                \/\/ Log as WARNING to avoid triggering alarms. Failed REST calls are tracked\n+                \/\/ using metrics.\n+                log.log(Level.WARNING, \"RestException during periodic item checking\", e);\n","filename":"bot\/src\/main\/java\/org\/openjdk\/skara\/bot\/BotRunner.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-    private final static Counter.WithOneLabel responseCounter =\n+    private final static Counter.WithTwoLabels responseCounter =\n@@ -45,1 +45,1 @@\n-               .labels(\"code\")\n+               .labels(\"code\", \"error_handled\")\n@@ -198,0 +198,7 @@\n+\n+        @Override\n+        public String toString() {\n+            return \"QueryBuilder: type: \" + queryType +\n+                    \", endpoint: \" + endpoint +\n+                    \", body: \" + composedBody();\n+        }\n@@ -316,3 +323,4 @@\n-            log.warning(queryBuilder.toString());\n-            log.warning(response.body());\n-            throw new RuntimeException(\"Request returned bad status: \" + response.statusCode());\n+            log.warning(\"Request returned bad status: \" + response.statusCode());\n+            log.info(queryBuilder.toString());\n+            log.info(response.body());\n+            throw new UncheckedRestException(\"Request returned bad status: \" + response.statusCode());\n@@ -395,1 +403,0 @@\n-        responseCounter.labels(Integer.toString(response.statusCode())).inc();\n@@ -397,0 +404,1 @@\n+        responseCounter.labels(Integer.toString(response.statusCode()), Boolean.toString(errorTransform.isPresent())).inc();\n@@ -415,0 +423,1 @@\n+            requestCounter.labels(queryBuilder.queryType.toString()).inc();\n@@ -419,0 +428,1 @@\n+            responseCounter.labels(Integer.toString(response.statusCode()), Boolean.toString(errorTransform.isPresent())).inc();\n@@ -436,0 +446,1 @@\n+        requestCounter.labels(queryBuilder.queryType.toString()).inc();\n@@ -437,0 +448,1 @@\n+        responseCounter.labels(Integer.toString(response.statusCode()), Boolean.toString(false)).inc();\n","filename":"network\/src\/main\/java\/org\/openjdk\/skara\/network\/RestRequest.java","additions":18,"deletions":6,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -0,0 +1,13 @@\n+package org.openjdk.skara.network;\n+\n+\/**\n+ * Specialized RuntimeException thrown when a REST call receives a response code\n+ * >=400 that isn't handled. When catching this, details about the failed call\n+ * has already been logged.\n+ *\/\n+public class UncheckedRestException extends RuntimeException {\n+\n+    public UncheckedRestException(String message) {\n+        super(message);\n+    }\n+}\n","filename":"network\/src\/main\/java\/org\/openjdk\/skara\/network\/UncheckedRestException.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"added"}]}