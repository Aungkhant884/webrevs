{"files":[{"patch":"@@ -143,1 +143,2 @@\n-    private final Pattern issuesBlockPattern = Pattern.compile(\"\\\\n\\\\n###? Issues?((?:\\\\n(?: \\\\* )?\\\\[.*)+)\", Pattern.MULTILINE);\n+    private final String lineSep = \"(?:\\\\n|\\\\r|\\\\r\\\\n|\\\\n\\\\r)\";\n+    private final Pattern issuesBlockPattern = Pattern.compile(lineSep + lineSep + \"###? Issues?((?:\" + lineSep + \"(?: \\\\* )?\\\\[.*)+)\", Pattern.MULTILINE);\n","filename":"bots\/notify\/src\/main\/java\/org\/openjdk\/skara\/bots\/notify\/PullRequestWorkItem.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -267,0 +267,36 @@\n+            links1 = issue.links();\n+            assertEquals(0, links1.size());\n+            comments1 = issue.comments();\n+            assertEquals(0, comments1.size());\n+\n+            links2 = issue2.links();\n+            assertEquals(1, links2.size());\n+            assertEquals(pr.webUrl(), links2.get(0).uri().orElseThrow());\n+            comments2 = issue2.comments();\n+            assertEquals(1, comments2.size());\n+            assertTrue(comments2.get(0).body().contains(pullRequestTip));\n+            assertTrue(comments2.get(0).body().contains(pr.webUrl().toString()));\n+\n+            \/\/ test line separator \"\\r\"\n+            pr.setBody(\"\\r\\r### Issues\\r * [\" + issue.id() + \"](http:\/\/www.test.test\/): The issue\");\n+            TestBotRunner.runPeriodicItems(notifyBot);\n+\n+            \/\/ Only the first issue should now contain a link to the PR and a comment which contains the link to the PR\n+            links1 = issue.links();\n+            assertEquals(1, links1.size());\n+            assertEquals(pr.webUrl(), links1.get(0).uri().orElseThrow());\n+            comments1 = issue.comments();\n+            assertEquals(1, comments1.size());\n+            assertTrue(comments1.get(0).body().contains(pullRequestTip));\n+            assertTrue(comments1.get(0).body().contains(pr.webUrl().toString()));\n+\n+            links2 = issue2.links();\n+            assertEquals(0, links2.size());\n+            comments2 = issue2.comments();\n+            assertEquals(0, comments2.size());\n+\n+            \/\/ test line separator \"\\r\\n\"\n+            pr.setBody(\"\\r\\n\\r\\n### Issues\\r\\n * [\" + issue2.id() + \"](http:\/\/www.test2.test\/): That other issue\");\n+            TestBotRunner.runPeriodicItems(notifyBot);\n+\n+            \/\/ Only the second issue should now contain a link to the PR and a comment which contains the link to the PR\n","filename":"bots\/notify\/src\/test\/java\/org\/openjdk\/skara\/bots\/notify\/issue\/IssueNotifierTests.java","additions":36,"deletions":0,"binary":false,"changes":36,"status":"modified"}]}