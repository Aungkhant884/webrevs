{"files":[{"patch":"@@ -112,5 +112,12 @@\n-            \/\/ Check if the currently running check seems stale - perhaps the checker failed to complete\n-            if (check.completedAt().isEmpty()) {\n-                var runningTime = Duration.between(check.startedAt().toInstant(), Instant.now());\n-                if (runningTime.toMinutes() > 10) {\n-                    log.warning(\"Previous jcheck running for more than 10 minutes - checking again\");\n+            if (check.completedAt().isPresent() && check.metadata().isPresent()) {\n+                var previousMetadata = check.metadata().get();\n+                if (previousMetadata.contains(\":\")) {\n+                    var splitIndex = previousMetadata.lastIndexOf(\":\");\n+                    var stableMetadata = previousMetadata.substring(0, splitIndex);\n+                    var expiresAt = Instant.ofEpochSecond(Long.parseLong(previousMetadata.substring(splitIndex + 1)));\n+                    if (stableMetadata.equals(metadata) && expiresAt.isAfter(Instant.now())) {\n+                        log.finer(\"Metadata with expiration time is still valid, not checking again\");\n+                        return true;\n+                    } else {\n+                        log.finer(\"Metadata expiration time has expired - checking again\");\n+                    }\n@@ -118,14 +125,3 @@\n-                    log.finer(\"Jcheck in progress for \" + runningTime.toMinutes() + \" minutes, not starting another one\");\n-                    return true;\n-                }\n-            } else {\n-                if (check.metadata().isPresent()) {\n-                    var previousMetadata = check.metadata().get();\n-                    if (previousMetadata.contains(\":\")) {\n-                        var splitIndex = previousMetadata.lastIndexOf(\":\");\n-                        var stableMetadata = previousMetadata.substring(0, splitIndex);\n-                        var expiresAt = Instant.ofEpochSecond(Long.parseLong(previousMetadata.substring(splitIndex + 1)));\n-                        if (stableMetadata.equals(metadata) && expiresAt.isAfter(Instant.now())) {\n-                            log.finer(\"Metadata with expiration time is still valid, not checking again\");\n-                            return true;\n-                        }\n+                    if (previousMetadata.equals(metadata)) {\n+                        log.fine(\"No activity since last check, not checking again.\");\n+                        return true;\n@@ -133,4 +129,1 @@\n-                        if (previousMetadata.equals(metadata)) {\n-                            log.finer(\"No activity since last check, not checking again\");\n-                            return true;\n-                        }\n+                        log.fine(\"Previous metadata: \" + check.metadata().get() + \" - current: \" + metadata);\n@@ -139,4 +132,2 @@\n-                log.info(\"PR updated after last check, checking again\");\n-                if (check.metadata().isPresent() && (!check.metadata().get().equals(metadata))) {\n-                    log.fine(\"Previous metadata: \" + check.metadata().get() + \" - current: \" + metadata);\n-                }\n+            } else {\n+                log.info(\"Check in progress was never finished - checking again\");\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckWorkItem.java","additions":18,"deletions":27,"binary":false,"changes":45,"status":"modified"}]}