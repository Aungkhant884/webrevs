{"files":[{"patch":"@@ -117,1 +117,1 @@\n-    private final static Pattern commandPattern = Pattern.compile(\"^\\\\s*\/([A-Za-z]+).*$\");\n+    private static final Pattern commandPattern = Pattern.compile(\"^\\\\s*\/([A-Za-z]+).*$\", Pattern.MULTILINE | Pattern.DOTALL);\n@@ -127,5 +127,6 @@\n-        var commandOnly = body.strip().lines()\n-                              .map(commandPattern::matcher)\n-                              .allMatch(Matcher::matches);\n-        if (body.strip().lines().count() > 0 && commandOnly) {\n-            return true;\n+        var commandLineMatcher = commandPattern.matcher(body);\n+        if (commandLineMatcher.find()) {\n+            var filteredBody = commandLineMatcher.replaceAll(\"\");\n+            if (filteredBody.strip().isEmpty()) {\n+                return true;\n+            }\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/ArchiveWorkItem.java","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -1519,0 +1519,12 @@\n+\n+            \/\/ There should not be consecutive empty lines due to a filtered multiline message\n+            var lines = archiveContents(archiveFolder.path(), \"\").orElseThrow();\n+            assertFalse(lines.contains(\"\\n\\n\\n\"), lines);\n+\n+            \/\/ And a stand-alone multiline comment should not cause another mail to be sent\n+            pr.addComment(\"\/another\\nmultiline\\nwill not cause another mail\");\n+            TestBotRunner.runPeriodicItems(mlBot);\n+            Repository.materialize(archiveFolder.path(), archive.url(), \"master\");\n+            lines = archiveContents(archiveFolder.path(), \"\").orElseThrow();\n+            var mails = Mbox.splitMbox(lines, EmailAddress.from(\"duke@openjdk.org\"));\n+            assertEquals(2, mails.size());\n","filename":"bots\/mlbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBotTests.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"}]}