{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -265,2 +265,5 @@\n-    public void visit(BinaryIssue issue) {\n-        log.fine(\"ignored: binary file\");\n+    public void visit(BinaryFileTooLargeIssue issue) {\n+        addFailureMessage(issue.check(), \"The size of the binary file `\" + issue.path() + \"` is \" + issue.fileSize()\n+                + (issue.fileSize() > 1 ? \" Bytes\" : \" Byte\") + \", which is larger than the limited file size: \"\n+                + issue.limitedFileSize() + (issue.limitedFileSize() > 1 ? \" Bytes.\" : \" Byte.\"));\n+        readyForReview = false;\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCheckIssueVisitor.java","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -293,1 +293,1 @@\n-    public void visit(BinaryIssue i) {\n+    public void visit(BinaryFileTooLargeIssue i) {\n@@ -295,1 +295,3 @@\n-            println(i, \"adds binary file: \" + i.path().toString());\n+            println(i, \"The size of the binary file `\" + i.path() + \"` is \" + i.fileSize()\n+                    + (i.fileSize() > 1 ? \" Bytes\" : \" Byte\") + \", which is larger than the limited file size: \"\n+                    + i.limitedFileSize() + (i.limitedFileSize() > 1 ? \" Bytes.\" : \" Byte.\"));\n","filename":"cli\/src\/main\/java\/org\/openjdk\/skara\/cli\/JCheckCLIVisitor.java","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -57,1 +57,2 @@\n-        this.entries = new HashMap<>();\n+        \/\/ The BinaryConfiguration need a fixed iteration order.\n+        this.entries = new LinkedHashMap<>();\n","filename":"ini\/src\/main\/java\/org\/openjdk\/skara\/ini\/Section.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+import org.openjdk.skara.vcs.BinaryPatch;\n@@ -29,0 +30,2 @@\n+import java.io.IOException;\n+import java.nio.file.Files;\n@@ -31,0 +34,1 @@\n+import java.util.Map;\n@@ -32,0 +36,1 @@\n+import java.util.regex.Pattern;\n@@ -39,0 +44,1 @@\n+        var fileSizeLimits = conf.checks().binary().fileSizeLimits();\n@@ -43,3 +49,36 @@\n-                if (patch.isBinary() &&\n-                    (patch.status().isAdded() || patch.status().isCopied())) {\n-                    issues.add(new BinaryIssue(patch.target().path().get(), metadata));\n+                if (patch.isTextual()) {\n+                    continue;\n+                }\n+                \/\/ Here, the file is surely binary.\n+                var binaryPatch = (BinaryPatch) patch;\n+                var path =  binaryPatch.target().path().orElse(null);\n+                var fileName = path != null ? path.getFileName().toString() : \"\";\n+\n+                long fileSize = 0;\n+                boolean needCheck = false;\n+\n+                if (binaryPatch.status().isAdded()) {\n+                    \/\/ This is a new-added file, so the BinaryHunk#inflatedSize of the first hunk should be the file size.\n+                    fileSize = binaryPatch.hunks().get(0).inflatedSize();\n+                    needCheck = true;\n+                } else if (binaryPatch.status().isRenamed() || binaryPatch.status().isCopied()\n+                        || binaryPatch.status().isModified() || binaryPatch.status().isUnmerged()) {\n+                    \/\/ Use the file size in the file system.\n+                    try {\n+                        fileSize = path != null ? Files.size(path) : 0;\n+                        needCheck = true;\n+                    } catch (IOException e) {\n+                        log.warning(\"The file '\" + path + \"' doesn't exist. \");\n+                    }\n+                }\n+\n+                \/\/ If the size of the binary file exceeds the limited size, the check should fail.\n+                if (needCheck) {\n+                    var excessSize = calculateExcessSize(fileSizeLimits, fileName, fileSize);\n+                    if (excessSize > 0) {\n+                        var limitedSize = fileSize - excessSize;\n+                        log.info(\"The size of the binary file `\" + path + \"` is \" + fileSize\n+                                 + (fileSize > 1 ? \" Bytes\" : \" Byte\") + \", which is larger than the limited file size: \"\n+                                 + limitedSize + (limitedSize > 1 ? \" Bytes.\" : \" Byte.\"));\n+                        issues.add(new BinaryFileTooLargeIssue(path, fileSize, limitedSize, metadata));\n+                    }\n@@ -49,1 +88,0 @@\n-\n@@ -53,0 +91,14 @@\n+    \/**\n+     * Check whether the file size is exceeded and return the excess size.\n+     * @return the value of (the file size - the limited size)\n+     *\/\n+    private long calculateExcessSize(Map<Pattern, Long> fileSizeLimits, String fileName, long fileSize) {\n+        for (var entry : fileSizeLimits.entrySet()) {\n+            if (entry.getKey().matcher(fileName).matches()) {\n+                return fileSize - entry.getValue();\n+            }\n+        }\n+        \/\/ the `fileSizeLimits` has no related limits about this file.\n+        return 0;\n+    }\n+\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/BinaryCheck.java","additions":57,"deletions":5,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -0,0 +1,59 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.skara.jcheck;\n+\n+import org.openjdk.skara.ini.Section;\n+\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.regex.Pattern;\n+\n+public class BinaryConfiguration {\n+    static final BinaryConfiguration DEFAULT =\n+            new BinaryConfiguration(new LinkedHashMap<>());\n+\n+    private final Map<Pattern, Long> fileSizeLimits;\n+\n+    private BinaryConfiguration(Map<Pattern, Long> fileSizeLimits) {\n+        this.fileSizeLimits = fileSizeLimits;\n+    }\n+\n+    static BinaryConfiguration parse(Section s) {\n+        if (s == null) {\n+            return DEFAULT;\n+        }\n+        Map<Pattern, Long> fileSizeLimits = new LinkedHashMap<>();\n+        for (var entry : s.entries()) {\n+            fileSizeLimits.put(Pattern.compile(entry.key()), SizeUtils.getSizeFromString(entry.value().asString()));\n+        }\n+        return new BinaryConfiguration(fileSizeLimits);\n+    }\n+\n+    static String name() {\n+        return \"binary\";\n+    }\n+\n+    public Map<Pattern, Long> fileSizeLimits() {\n+        return fileSizeLimits;\n+    }\n+}\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/BinaryConfiguration.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"added"},{"patch":"@@ -0,0 +1,55 @@\n+\/*\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.skara.jcheck;\n+\n+import java.nio.file.Path;\n+\n+public class BinaryFileTooLargeIssue extends CommitIssue {\n+    private final Path path;\n+    private final long fileSize;\n+    private final long limitedFileSize;\n+\n+    BinaryFileTooLargeIssue(Path path, long fileSize, long limitedFileSize, CommitIssue.Metadata metadata) {\n+        super(metadata);\n+        this.path = path;\n+        this.fileSize = fileSize;\n+        this.limitedFileSize = limitedFileSize;\n+    }\n+\n+    public Path path() {\n+        return path;\n+    }\n+\n+    public long fileSize() {\n+        return fileSize;\n+    }\n+\n+    public long limitedFileSize() {\n+        return limitedFileSize;\n+    }\n+\n+    @Override\n+    public void accept(IssueVisitor v) {\n+        v.visit(this);\n+    }\n+}\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/BinaryFileTooLargeIssue.java","additions":55,"deletions":0,"binary":false,"changes":55,"status":"added"},{"patch":"@@ -1,43 +0,0 @@\n-\/*\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-package org.openjdk.skara.jcheck;\n-\n-import java.nio.file.Path;\n-\n-public class BinaryIssue extends CommitIssue {\n-    private final Path path;\n-\n-    BinaryIssue(Path path, CommitIssue.Metadata metadata) {\n-        super(metadata);\n-        this.path = path;\n-    }\n-\n-    public Path path() {\n-        return path;\n-    }\n-\n-    @Override\n-    public void accept(IssueVisitor v) {\n-        v.visit(this);\n-    }\n-}\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/BinaryIssue.java","additions":0,"deletions":43,"binary":false,"changes":43,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,0 +39,1 @@\n+                                BinaryConfiguration.DEFAULT,\n@@ -48,0 +49,1 @@\n+    private final BinaryConfiguration binary;\n@@ -57,0 +59,1 @@\n+                        BinaryConfiguration binary,\n@@ -65,0 +68,1 @@\n+        this.binary = binary;\n@@ -114,0 +118,4 @@\n+    public BinaryConfiguration binary() {\n+        return binary;\n+    }\n+\n@@ -135,0 +143,1 @@\n+        var binary = BinaryConfiguration.parse(s.subsection(BinaryConfiguration.name()));\n@@ -136,1 +145,1 @@\n-        return new ChecksConfiguration(error, warning, whitespace, reviewers, merge, committer, issues, problemlists);\n+        return new ChecksConfiguration(error, warning, whitespace, reviewers, merge, committer, issues, binary, problemlists);\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/ChecksConfiguration.java","additions":11,"deletions":2,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -44,1 +44,1 @@\n-    void visit(BinaryIssue issue);\n+    void visit(BinaryFileTooLargeIssue issue);\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/IssueVisitor.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,54 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.skara.jcheck;\n+\n+import java.util.logging.Logger;\n+\n+public class SizeUtils {\n+    private static final Logger log = Logger.getLogger(\"org.openjdk.skara.jcheck.sizeutils\");\n+\n+    public static long getSizeFromString(String str) {\n+        long size = 0;\n+        String unit = \"\";\n+        var sizeStr = str.toLowerCase();\n+        if (sizeStr.endsWith(\"kb\") || sizeStr.endsWith(\"mb\") || sizeStr.endsWith(\"gb\")) {\n+            unit = sizeStr.substring(sizeStr.length() - 2);\n+            sizeStr = sizeStr.substring(0, sizeStr.length() - 2);\n+        } else if (sizeStr.endsWith(\"k\") || sizeStr.endsWith(\"m\") || sizeStr.endsWith(\"g\") || sizeStr.endsWith(\"b\")) {\n+            unit = sizeStr.substring(sizeStr.length() - 1);\n+            sizeStr = sizeStr.substring(0, sizeStr.length() - 1);\n+        }\n+        try {\n+            size = Long.parseLong(sizeStr);\n+        } catch (NumberFormatException exception) {\n+            log.info(\"The string '\" + str + \"' can't be convert to a number. \" + exception);\n+            size = 0; \/\/ default 0\n+        }\n+        switch (unit) {\n+            case \"kb\", \"k\" -> size *= 1024;\n+            case \"mb\", \"m\" -> size *= 1024 * 1024;\n+            case \"gb\", \"g\" -> size *= 1024 * 1024 * 1024;\n+        }\n+        return size;\n+    }\n+}\n","filename":"jcheck\/src\/main\/java\/org\/openjdk\/skara\/jcheck\/SizeUtils.java","additions":54,"deletions":0,"binary":false,"changes":54,"status":"added"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+import java.nio.file.Files;\n@@ -44,1 +45,4 @@\n-        \"error = binary\"\n+        \"error = binary\",\n+        \"[checks \\\"binary\\\"]\",\n+        \".*\\\\.bin=1b\",\n+        \".*\\\\.o=1k\"\n@@ -57,0 +61,8 @@\n+    private static List<Diff> binaryParentDiffs(Path path, Status status, int inflatedSize, List<String> data) {\n+        var hunk = BinaryHunk.ofLiteral(inflatedSize, data);\n+        var patch = new BinaryPatch(null, null, null, path,\n+                                    FileType.fromOctal(\"100644\"), Hash.zero(), status, List.of(hunk));\n+        var diff = new Diff(Hash.zero(), Hash.zero(), List.of(patch));\n+        return List.of(diff);\n+    }\n+\n@@ -89,18 +101,57 @@\n-    void binaryFileShouldFail() throws IOException {\n-        var hunk = BinaryHunk.ofLiteral(8, List.of(\"asdfasdf8\"));\n-        var patch = new BinaryPatch(null, null, null,\n-                                    Path.of(\"file.bin\"), FileType.fromOctal(\"100644\"), Hash.zero(),\n-                                    Status.from('A'), List.of(hunk));\n-        var diff = new Diff(Hash.zero(), Hash.zero(), List.of(patch));\n-        var commit = commit(List.of(diff));\n-        var message = message(commit);\n-        var check = new BinaryCheck();\n-        var issues = toList(check.check(commit, message, conf, null));\n-        assertEquals(1, issues.size());\n-        assertTrue(issues.get(0) instanceof BinaryIssue);\n-        var issue = (BinaryIssue) issues.get(0);\n-        assertEquals(Path.of(\"file.bin\"), issue.path());\n-        assertEquals(commit, issue.commit());\n-        assertEquals(message, issue.message());\n-        assertEquals(check, issue.check());\n-        assertEquals(Severity.ERROR, issue.severity());\n+    void binaryFileNotLimited() throws IOException {\n+        \/\/ The size of the file `*.s` is not limited in the config file.\n+        Path path = Path.of(\"file.s\");\n+        Files.deleteIfExists(path);\n+        Files.createFile(path);\n+        Files.write(path, List.of(\"testtest\"));\n+        for (var status : List.of(Status.from(\"A\"), Status.from(\"M\"), Status.from(\"U\"), Status.from(\"R100\"), Status.from(\"C100\"))) {\n+            var commit = commit(binaryParentDiffs(path, status, 9, List.of(\"testtest\")));\n+            var message = message(commit);\n+            var check = new BinaryCheck();\n+            var issues = toList(check.check(commit, message, conf, null));\n+            assertEquals(0, issues.size());\n+        }\n+        Files.deleteIfExists(path);\n+    }\n+\n+    @Test\n+    void binaryFileInRange() throws IOException {\n+        \/\/ The size of the file `*.o` is limited to 1k in the config file.\n+        Path path = Path.of(\"file.o\");\n+        Files.deleteIfExists(path);\n+        Files.createFile(path);\n+        Files.write(path, List.of(\"testtest\"));\n+        for (var status : List.of(Status.from(\"A\"), Status.from(\"M\"), Status.from(\"U\"), Status.from(\"R100\"), Status.from(\"C100\"))) {\n+            var commit = commit(binaryParentDiffs(path, status, 9, List.of(\"testtest\")));\n+            var message = message(commit);\n+            var check = new BinaryCheck();\n+            var issues = toList(check.check(commit, message, conf, null));\n+            assertEquals(0, issues.size());\n+        }\n+        Files.deleteIfExists(path);\n+    }\n+\n+    @Test\n+    void binaryFileTooLarge() throws IOException {\n+        \/\/ The size of the file `*.bin` is limited to 1b in the config file.\n+        Path path = Path.of(\"file.bin\");\n+        Files.deleteIfExists(path);\n+        Files.createFile(path);\n+        Files.write(path, List.of(\"testtest\"));\n+        for (var status : List.of(Status.from(\"A\"), Status.from(\"M\"), Status.from(\"U\"), Status.from(\"R100\"), Status.from(\"C100\"))) {\n+            var commit = commit(binaryParentDiffs(path, status, 9, List.of(\"testtest\")));\n+            var message = message(commit);\n+            var check = new BinaryCheck();\n+            var issues = toList(check.check(commit, message, conf, null));\n+            assertEquals(1, issues.size());\n+            assertTrue(issues.get(0) instanceof BinaryFileTooLargeIssue);\n+            var issue = (BinaryFileTooLargeIssue) issues.get(0);\n+            assertEquals(path, issue.path());\n+            assertTrue(issue.fileSize() > issue.limitedFileSize());\n+            assertEquals(1, issue.limitedFileSize());\n+            assertEquals(commit, issue.commit());\n+            assertEquals(message, issue.message());\n+            assertEquals(check, issue.check());\n+            assertEquals(Severity.ERROR, issue.severity());\n+        }\n+        Files.deleteIfExists(path);\n","filename":"jcheck\/src\/test\/java\/org\/openjdk\/skara\/jcheck\/BinaryCheckTests.java","additions":71,"deletions":20,"binary":false,"changes":91,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -232,1 +232,1 @@\n-        public void visit(BinaryIssue e) {\n+        public void visit(BinaryFileTooLargeIssue e) {\n","filename":"jcheck\/src\/test\/java\/org\/openjdk\/skara\/jcheck\/JCheckTests.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,51 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.skara.jcheck;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+import static org.openjdk.skara.jcheck.SizeUtils.*;\n+\n+public class SizeUtilsTest {\n+    @Test\n+    void testGetSizeFromString() {\n+        String[] simpleLowerStrList = new String[]{\"1\", \"2b\", \"3k\", \"4m\", \"5g\", \"\", \"a\", \"ab\", \"ak\", \"am\", \"ag\"};\n+        String[] simpleUpperStrList = new String[]{\"1\", \"2B\", \"3K\", \"4M\", \"5G\", \"\", \"A\", \"AB\", \"AK\", \"AM\", \"AG\"};\n+        long[] simpleSizeList = new long[]{1L, 2L, 3L * 1024, 4L * 1024 * 1024, 5L * 1024 * 1024 * 1024, 0, 0, 0, 0, 0, 0};\n+        for (int i = 0; i < simpleSizeList.length; i++) {\n+            assertEquals(simpleSizeList[i], getSizeFromString(simpleLowerStrList[i]));\n+            assertEquals(simpleSizeList[i], getSizeFromString(simpleUpperStrList[i]));\n+        }\n+\n+        String[] kiloStrList = new String[]{\"1kb\", \"2Kb\", \"3kB\", \"4KB\", \"akb\", \"aKb\", \"akB\", \"aKB\", \"kb\", \"Kb\", \"kB\", \"KB\"};\n+        String[] mageStrList = new String[]{\"1mb\", \"2Mb\", \"3mB\", \"4MB\", \"amb\", \"aMb\", \"amB\", \"aMB\", \"mb\", \"Mb\", \"mB\", \"MB\"};\n+        String[] gigaStrList = new String[]{\"1gb\", \"2Gb\", \"3gB\", \"4GB\", \"agb\", \"aGb\", \"agB\", \"aGB\", \"gb\", \"Gb\", \"gB\", \"GB\"};\n+        long[] expectedSizeList = new long[]{1L, 2L, 3L, 4L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 0L};\n+        for (int i = 0; i < expectedSizeList.length; i++) {\n+            assertEquals(expectedSizeList[i] * 1024, getSizeFromString(kiloStrList[i]));\n+            assertEquals(expectedSizeList[i] * 1024 * 1024, getSizeFromString(mageStrList[i]));\n+            assertEquals(expectedSizeList[i] * 1024 * 1024 * 1024, getSizeFromString(gigaStrList[i]));\n+        }\n+    }\n+}\n","filename":"jcheck\/src\/test\/java\/org\/openjdk\/skara\/jcheck\/SizeUtilsTest.java","additions":51,"deletions":0,"binary":false,"changes":51,"status":"added"}]}