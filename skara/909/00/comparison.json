{"files":[{"patch":"@@ -159,1 +159,3 @@\n-                        localRepoInstance.clean();\n+                        if (!bare) {\n+                            localRepoInstance.clean();\n+                        }\n","filename":"forge\/src\/main\/java\/org\/openjdk\/skara\/forge\/HostedRepositoryPool.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+import java.util.Optional;\n@@ -57,0 +58,32 @@\n+    @Test\n+    void simpleBare(TestInfo testInfo) throws IOException {\n+        try (var credentials = new HostCredentials(testInfo);\n+             var sourceFolder = new TemporaryDirectory();\n+             var seedFolder = new TemporaryDirectory();\n+             var cloneFolder = new TemporaryDirectory()) {\n+            var source = credentials.getHostedRepository();\n+\n+            \/\/ Populate the projects repository\n+            var localRepo = CheckableRepository.init(sourceFolder.path(), source.repositoryType());\n+            var masterHash = localRepo.resolve(\"master\").orElseThrow();\n+            localRepo.push(masterHash, source.url(), \"master\", true);\n+\n+            var pool = new HostedRepositoryPool(seedFolder.path());\n+            var bareClone = pool.materializeBare(source, cloneFolder.path());\n+\n+            \/\/ Push something else\n+            var hash = CheckableRepository.appendAndCommit(localRepo);\n+            localRepo.push(hash, source.url(), \"master\");\n+\n+            \/\/ The commit should not appear from this\n+            bareClone = pool.materializeBare(source, cloneFolder.path());\n+            var bareCommit = bareClone.lookup(hash);\n+            assertEquals(Optional.empty(), bareCommit);\n+\n+            \/\/ But should be possible to fetch\n+            bareClone.fetchAll(source.url());\n+            bareCommit = bareClone.lookup(hash);\n+            assertEquals(bareCommit.get().hash(), hash);\n+        }\n+    }\n+\n","filename":"forge\/src\/test\/java\/org\/openjdk\/skara\/forge\/HostedRepositoryPoolTests.java","additions":33,"deletions":0,"binary":false,"changes":33,"status":"modified"}]}