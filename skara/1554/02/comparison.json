{"files":[{"patch":"@@ -109,1 +109,1 @@\n-                .map(pr -> new CheckWorkItem(bot.getPRBot(pr.repository().name()), pr.id(), errorHandler, csrIssue.updatedAt(), true, true))\n+                .map(pr -> CheckWorkItem.fromCSRIssue(bot.getPRBot(pr.repository().name()), pr.id(), errorHandler, csrIssue.updatedAt()))\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CSRIssueWorkItem.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -69,0 +69,1 @@\n+    private final boolean initialRun;\n@@ -71,2 +72,2 @@\n-    CheckWorkItem(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt,\n-                  boolean needsReadyCheck, boolean forceUpdate) {\n+    private CheckWorkItem(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt,\n+                          boolean needsReadyCheck, boolean forceUpdate, boolean spawnedFromIssueBot, boolean initialRun) {\n@@ -75,1 +76,2 @@\n-        this.spawnedFromIssueBot = false;\n+        this.spawnedFromIssueBot = spawnedFromIssueBot;\n+        this.initialRun = initialRun;\n@@ -78,5 +80,5 @@\n-    CheckWorkItem(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt,\n-                  boolean needsReadyCheck, boolean forceUpdate, boolean spawnedFromIssueBot) {\n-        super(bot, prId, errorHandler, triggerUpdatedAt, needsReadyCheck);\n-        this.forceUpdate = forceUpdate;\n-        this.spawnedFromIssueBot = spawnedFromIssueBot;\n+    \/**\n+     * Create CheckWorkItem spawned from CSRIssueWorkItem\n+     *\/\n+    public static CheckWorkItem fromCSRIssue(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt) {\n+        return new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, true, true, false, false);\n@@ -85,5 +87,26 @@\n-    CheckWorkItem(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt,\n-                  boolean needsReadyCheck) {\n-        super(bot, prId, errorHandler, triggerUpdatedAt, needsReadyCheck);\n-        this.forceUpdate = false;\n-        this.spawnedFromIssueBot = false;\n+    \/**\n+     * Create CheckWorkItem spawned from initial run of PullRequestBot\n+     *\/\n+    public static CheckWorkItem fromInitialRunOfPRBot(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt) {\n+        return new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, true, false, false, true);\n+    }\n+\n+    \/**\n+     * Create CheckWorkItem spawned from PullRequestBot\n+     *\/\n+    public static CheckWorkItem fromPRBot(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt) {\n+        return new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, true, false, false, false);\n+    }\n+\n+    \/**\n+     * Create CheckWorkItem spawned from IssueBot\n+     *\/\n+    public static CheckWorkItem fromIssueBot(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt) {\n+        return new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, true, false, true, false);\n+    }\n+\n+    \/**\n+     * Create Normal CheckWorkItem\n+     *\/\n+    public static CheckWorkItem fromWorkItem(PullRequestBot bot, String prId, Consumer<RuntimeException> errorHandler, ZonedDateTime triggerUpdatedAt) {\n+        return new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, false, false, false, false);\n@@ -226,2 +249,2 @@\n-                \/\/ triggered by issue update\n-                if (spawnedFromIssueBot) {\n+                \/\/ triggered by issue update or initial run when bot restarts\n+                if (initialRun || spawnedFromIssueBot) {\n@@ -232,1 +255,0 @@\n-                            return true;\n@@ -235,0 +257,1 @@\n+                            return false;\n@@ -239,1 +262,0 @@\n-                            return true;\n@@ -242,0 +264,1 @@\n+                            return false;\n@@ -244,2 +267,3 @@\n-                    \/\/ triggered by pr updates\n-                } else {\n+                }\n+                \/\/ triggered by pr updates\n+                if (!spawnedFromIssueBot) {\n@@ -251,1 +275,0 @@\n-                            return true;\n@@ -254,0 +277,1 @@\n+                            return false;\n@@ -258,1 +282,0 @@\n-                            return true;\n@@ -261,0 +284,1 @@\n+                            return false;\n@@ -266,0 +290,1 @@\n+                return false;\n@@ -267,0 +292,2 @@\n+        } else {\n+            return false;\n@@ -269,1 +296,1 @@\n-        return false;\n+        return true;\n@@ -521,1 +548,1 @@\n-                    return List.of(new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, false));\n+                    return List.of(CheckWorkItem.fromWorkItem(bot, prId, errorHandler, triggerUpdatedAt));\n@@ -560,1 +587,1 @@\n-                return List.of(new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, false));\n+                return List.of(CheckWorkItem.fromWorkItem(bot, prId, errorHandler, triggerUpdatedAt));\n@@ -567,1 +594,1 @@\n-                return List.of(new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, false));\n+                return List.of(CheckWorkItem.fromWorkItem(bot, prId, errorHandler, triggerUpdatedAt));\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/CheckWorkItem.java","additions":52,"deletions":25,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -98,2 +98,2 @@\n-                    .map(pr -> new CheckWorkItem(pullRequestBotMap.get(pr.repository().name()), pr.id(),\n-                            e -> poller.retryIssue(issue), issue.updatedAt(), true, false, true))\n+                    .map(pr -> CheckWorkItem.fromIssueBot(pullRequestBotMap.get(pr.repository().name()), pr.id(),\n+                            e -> poller.retryIssue(issue), issue.updatedAt()))\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/IssueBot.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -81,0 +81,1 @@\n+    private boolean initialRun = true;\n@@ -153,1 +154,5 @@\n-                ret.add(new CheckWorkItem(this, pr.id(), e -> poller.retryPullRequest(pr), pr.updatedAt(), true));\n+                if (initialRun) {\n+                    ret.add(CheckWorkItem.fromInitialRunOfPRBot(this, pr.id(), e -> poller.retryPullRequest(pr), pr.updatedAt()));\n+                } else {\n+                    ret.add(CheckWorkItem.fromPRBot(this, pr.id(), e -> poller.retryPullRequest(pr), pr.updatedAt()));\n+                }\n@@ -160,0 +165,2 @@\n+        initialRun = false;\n+\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBot.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -218,1 +218,1 @@\n-            return List.of(new CheckWorkItem(bot, prId, errorHandler, triggerUpdatedAt, false));\n+            return List.of(CheckWorkItem.fromWorkItem(bot, prId, errorHandler, triggerUpdatedAt));\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCommandWorkItem.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}