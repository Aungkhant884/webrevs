{"files":[{"patch":"@@ -88,6 +88,0 @@\n-        private static final Gauge.WithTwoLabels CPU_TIME_GAUGE =\n-                Gauge.name(\"skara_runner_cpu_time\").labels(\"bot\", \"work_item\").register();\n-        private static final Gauge.WithTwoLabels USER_TIME_GAUGE =\n-                Gauge.name(\"skara_runner_user_time\").labels(\"bot\", \"work_item\").register();\n-        private static final Gauge.WithTwoLabels ALLOCATED_BYTES_GAUGE =\n-                Gauge.name(\"skara_runner_allocated_bytes\").labels(\"bot\", \"work_item\").register();\n@@ -106,0 +100,4 @@\n+        private static final Counter.WithTwoLabels TIME_COUNTER =\n+                Counter.name(\"skara_runner_run_time_total\").labels(\"bot\", \"work_item\").register();\n+        private static final Counter.WithTwoLabels ITEM_FINISHED_COUNTER =\n+                Counter.name(\"skara_runner_finished_counter\").labels(\"bot\", \"work_item\").register();\n@@ -108,2 +106,0 @@\n-        private static final Counter.WithTwoLabels USER_TIME_COUNTER =\n-                Counter.name(\"skara_runner_user_time_total\").labels(\"bot\", \"work_item\").register();\n@@ -151,10 +147,0 @@\n-        private static long getCurrentThreadUserTime() {\n-            var bean = getThreadMXBean();\n-            if (bean.isEmpty()) {\n-                return -1L;\n-            }\n-            return bean.get().isCurrentThreadCpuTimeSupported()?\n-                bean.get().getCurrentThreadUserTime() :\n-                -1L;\n-        }\n-\n@@ -182,1 +168,0 @@\n-            long startUserTimeNs = getCurrentThreadUserTime();\n@@ -184,0 +169,1 @@\n+            var start = Instant.now();\n@@ -188,0 +174,1 @@\n+                ITEM_FINISHED_COUNTER.labels(item.botName(), item.workItemName()).inc();\n@@ -189,1 +176,0 @@\n-                long stopUserTimeNs = getCurrentThreadUserTime();\n@@ -194,2 +180,0 @@\n-                var userTimeNs = (startUserTimeNs == -1L && stopUserTimeNs == -1L)?\n-                    -1L : stopUserTimeNs - startUserTimeNs;\n@@ -201,1 +185,0 @@\n-                    CPU_TIME_GAUGE.labels(item.botName(), item.workItemName()).set(cpuTimeSeconds);\n@@ -204,5 +187,0 @@\n-                if (userTimeNs != -1L) {\n-                    double userTimeSeconds = userTimeNs \/ 1_000_000_000.0;\n-                    USER_TIME_GAUGE.labels(item.botName(), item.workItemName()).set(userTimeSeconds);\n-                    USER_TIME_COUNTER.labels(item.botName(), item.workItemName()).inc(userTimeSeconds);\n-                }\n@@ -210,1 +188,0 @@\n-                    ALLOCATED_BYTES_GAUGE.labels(item.botName(), item.workItemName()).set(allocatedBytes);\n@@ -213,0 +190,2 @@\n+                TIME_COUNTER.labels(item.botName(), item.workItemName()).inc(\n+                        Duration.between(start, Instant.now()).toMillis() \/ 1_000.0);\n@@ -304,1 +283,5 @@\n-        Counter.name(\"skara_runner_scheduled\").labels(\"bot\", \"work_item\").register();\n+            Counter.name(\"skara_runner_scheduled_counter\").labels(\"bot\", \"work_item\").register();\n+    private static final Counter.WithTwoLabels PENDING_COUNTER =\n+            Counter.name(\"skara_runner_pending_counter\").labels(\"bot\", \"work_item\").register();\n+    private static final Counter.WithTwoLabels SUBMITTED_COUNTER =\n+            Counter.name(\"skara_runner_submitted_counter\").labels(\"bot\", \"work_item\").register();\n@@ -306,1 +289,1 @@\n-        Counter.name(\"skara_runner_discarded\").labels(\"bot\", \"work_item\").register();\n+            Counter.name(\"skara_runner_discarded_counter\").labels(\"bot\", \"work_item\").register();\n@@ -310,1 +293,1 @@\n-    private final Gauge.WithTwoLabels activeGauge =\n+    private static final Gauge.WithTwoLabels ACTIVE_GAUGE =\n@@ -315,1 +298,1 @@\n-    private final Gauge.WithTwoLabels pendingGauge =\n+    private static final Gauge.WithTwoLabels PENDING_GAUGE =\n@@ -354,1 +337,2 @@\n-        pendingGauge.labels(pendingItem.item.botName(), pendingItem.item.workItemName()).inc();\n+        PENDING_GAUGE.labels(pendingItem.item.botName(), pendingItem.item.workItemName()).inc();\n+        PENDING_COUNTER.labels(pendingItem.item.botName(), pendingItem.item.workItemName()).inc();\n@@ -362,1 +346,1 @@\n-        pendingGauge.labels(pendingItem.item.botName(), pendingItem.item.workItemName()).dec();\n+        PENDING_GAUGE.labels(pendingItem.item.botName(), pendingItem.item.workItemName()).dec();\n@@ -372,1 +356,2 @@\n-        activeGauge.labels(item.botName(), item.workItemName()).inc();\n+        ACTIVE_GAUGE.labels(item.botName(), item.workItemName()).inc();\n+        SUBMITTED_COUNTER.labels(item.botName(), item.workItemName()).inc();\n@@ -380,1 +365,1 @@\n-        activeGauge.labels(item.botName(), item.workItemName()).dec();\n+        ACTIVE_GAUGE.labels(item.botName(), item.workItemName()).dec();\n@@ -458,0 +443,5 @@\n+    private static final Gauge PERIODIC_CHECK_TIME_GAUGE =\n+            Gauge.name(\"skara_runner_check_time_gauge\").register();\n+    private static final Counter.WithOneLabel PERIODIC_CHECK_TIME =\n+            Counter.name(\"skara_runner_check_time\").labels(\"bot\").register();\n+\n@@ -460,0 +450,1 @@\n+            Instant start = Instant.now();\n@@ -463,3 +454,8 @@\n-                    var items = bot.getPeriodicItems();\n-                    for (var item : items) {\n-                        submitOrSchedule(item);\n+                    try (var ___ = new LogContext(\"bot\", bot.toString())) {\n+                        Instant botStart = Instant.now();\n+                        log.fine(\"Starting of checking for periodic items for \" + bot.toString());\n+                        var items = bot.getPeriodicItems();\n+                        PERIODIC_CHECK_TIME.labels(bot.name()).inc(Duration.between(botStart, Instant.now()).toMillis() \/ 1_000.0);\n+                        for (var item : items) {\n+                            submitOrSchedule(item);\n+                        }\n@@ -476,0 +472,1 @@\n+                PERIODIC_CHECK_TIME_GAUGE.set(Duration.between(start, Instant.now()).toMillis() \/ 1_000.0);\n","filename":"bot\/src\/main\/java\/org\/openjdk\/skara\/bot\/BotRunner.java","additions":37,"deletions":40,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -155,0 +155,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"PullRequestCloserBot@\" + remoteRepo.name();\n+    }\n","filename":"bots\/bridgekeeper\/src\/main\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/PullRequestCloserBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -179,0 +179,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"PullRequestPrunerBot\";\n+    }\n","filename":"bots\/bridgekeeper\/src\/main\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/PullRequestPrunerBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -98,0 +98,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"LoggingBot\";\n+    }\n","filename":"bots\/cli\/src\/test\/java\/org\/openjdk\/skara\/bots\/cli\/LoggingBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -151,0 +151,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"MailingListArchiveReaderBot@\" + repository.name();\n+    }\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListArchiveReaderBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -241,0 +241,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"MailingListBridgeBot@\" + codeRepo.name();\n+    }\n","filename":"bots\/mlbridge\/src\/main\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -112,1 +112,1 @@\n-        return \"JNotifyBot@\" + repository.name();\n+        return \"NotifyBot@\" + repository.name();\n","filename":"bots\/notify\/src\/main\/java\/org\/openjdk\/skara\/bots\/notify\/NotifyBot.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -319,0 +319,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"PullRequestBot@\" + remoteRepo.name();\n+    }\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -59,0 +59,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"SubmitBot@\" + repository.name();\n+    }\n","filename":"bots\/submit\/src\/main\/java\/org\/openjdk\/skara\/bots\/submit\/SubmitBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -90,0 +90,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"SyncLabelBot@\" + issueProject.name();\n+    }\n","filename":"bots\/synclabel\/src\/main\/java\/org\/openjdk\/skara\/bots\/synclabel\/SyncLabelBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -146,0 +146,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"TestBot@\" + repo.name();\n+    }\n","filename":"bots\/tester\/src\/main\/java\/org\/openjdk\/skara\/bots\/tester\/TestBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -74,0 +74,5 @@\n+\n+    @Override\n+    public String toString() {\n+        return \"TestInfoBot@\" + repo.name();\n+    }\n","filename":"bots\/testinfo\/src\/main\/java\/org\/openjdk\/skara\/bots\/testinfo\/TestInfoBot.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}