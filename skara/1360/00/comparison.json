{"files":[{"patch":"@@ -332,0 +332,3 @@\n+            \/\/ Test the method `TestPullRequest#diff`.\n+            assertEquals(1, pr.diff().patches().size());\n+\n@@ -345,0 +348,3 @@\n+            \/\/ Test the method `TestPullRequest#diff`.\n+            assertEquals(1, pr.diff().patches().size());\n+\n","filename":"bots\/csr\/src\/test\/java\/org\/openjdk\/skara\/bots\/csr\/CSRBotTests.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+import org.openjdk.skara.vcs.Branch;\n@@ -245,1 +246,0 @@\n-            var targetHash = targetRepository.branchHash(targetRef());\n@@ -248,7 +248,5 @@\n-            if (targetLocalRepository.root().equals(sourceLocalRepository.root())) {\n-                \/\/ same target and source repo, must contain both commits\n-                return targetLocalRepository.diff(targetHash, headHash());\n-            } else {\n-                var uri = URI.create(\"file:\/\/\" + sourceLocalRepository.root().toString());\n-                var fetchHead = targetLocalRepository.fetch(uri, sourceRef);\n-                return targetLocalRepository.diff(targetHash, fetchHead);\n+            var sourceHash = headHash();\n+            if (!targetLocalRepository.root().equals(sourceLocalRepository.root())) {\n+                \/\/ The target and source repo are not same, fetch the source branch\n+                var sourceUri = URI.create(\"file:\/\/\" + sourceLocalRepository.root().toString());\n+                sourceHash = targetLocalRepository.fetch(sourceUri, sourceRef);\n@@ -256,0 +254,10 @@\n+            \/\/ Find the base hash of the source and target branches.\n+            var baseHash = sourceHash;\n+            var targetBranch = new Branch(targetRef());\n+            while (!\"0\".repeat(40).equals(baseHash.hex())) {\n+                if (targetLocalRepository.contains(targetBranch, baseHash)) {\n+                    break;\n+                }\n+                baseHash = targetRepository.commit(baseHash).get().parents().get(0);\n+            }\n+            return targetLocalRepository.diff(baseHash, sourceHash);\n","filename":"test\/src\/main\/java\/org\/openjdk\/skara\/test\/TestPullRequest.java","additions":16,"deletions":8,"binary":false,"changes":24,"status":"modified"}]}