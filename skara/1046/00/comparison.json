{"files":[{"patch":"@@ -70,0 +70,1 @@\n+        private String rawBody;\n@@ -78,0 +79,1 @@\n+            rawBody = null;\n@@ -82,1 +84,9 @@\n-        private JSONValue composedBody() {\n+        private String composedBody() {\n+            if (rawBody != null && (body != null || !bodyParams.isEmpty())) {\n+                throw new RuntimeException(\"Cannot mix raw body and JSON body in request\");\n+            }\n+\n+            if (rawBody != null) {\n+                return rawBody;\n+            }\n+\n@@ -87,1 +97,1 @@\n-            return finalBody;\n+            return finalBody.toString();\n@@ -128,0 +138,10 @@\n+        \/**\n+         * Sets the request body encoded as raw POST data.\n+         * @param data\n+         * @return\n+         *\/\n+        public QueryBuilder body(String data) {\n+            rawBody = data;\n+            return this;\n+        }\n+\n@@ -291,1 +311,1 @@\n-    private HttpRequest.Builder createRequest(RequestType requestType, String endpoint, JSONValue body,\n+    private HttpRequest.Builder createRequest(RequestType requestType, String endpoint, String body,\n@@ -308,1 +328,1 @@\n-            requestBuilder.method(requestType.name(), HttpRequest.BodyPublishers.ofString(body.toString()));\n+            requestBuilder.method(requestType.name(), HttpRequest.BodyPublishers.ofString(body));\n","filename":"network\/src\/main\/java\/org\/openjdk\/skara\/network\/RestRequest.java","additions":24,"deletions":4,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+    private final List<String> rawRequests = new ArrayList<>();\n@@ -66,1 +67,5 @@\n-                requests.add(JSON.parse(input).asObject());\n+                try {\n+                    requests.add(JSON.parse(input).asObject());\n+                } catch (IllegalStateException e) {\n+                    rawRequests.add(input);\n+                }\n@@ -143,0 +148,4 @@\n+    List<String> getRawRequests() {\n+        return rawRequests;\n+    }\n+\n@@ -314,1 +323,26 @@\n-    }}\n+    }\n+\n+    @Test\n+    void rawBody() throws IOException {\n+        try (var receiver = new RestReceiver()) {\n+            var request = new RestRequest(receiver.getEndpoint());\n+            request.post(\"\/test\").body(\"foo=bar\").execute();\n+            var rawRequests = receiver.getRawRequests();\n+            assertEquals(1, rawRequests.size());\n+            assertEquals(\"foo=bar\", rawRequests.get(0));\n+            assertEquals(List.of(), receiver.getRequests());\n+        }\n+    }\n+\n+    @Test\n+    void jsonBody() throws IOException {\n+        try (var receiver = new RestReceiver()) {\n+            var request = new RestRequest(receiver.getEndpoint());\n+            request.post(\"\/test\").body(JSON.object().put(\"foo\", \"bar\")).execute();\n+            var requests = receiver.getRequests();\n+            assertEquals(1, requests.size());\n+            assertEquals(\"bar\", requests.get(0).get(\"foo\").asString());\n+            assertEquals(List.of(), receiver.getRawRequests());\n+        }\n+    }\n+}\n","filename":"network\/src\/test\/java\/org\/openjdk\/skara\/network\/RestRequestTests.java","additions":36,"deletions":2,"binary":false,"changes":38,"status":"modified"}]}