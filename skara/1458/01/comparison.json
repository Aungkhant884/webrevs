{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -182,1 +182,1 @@\n-        var comments = prComments();\n+        var comments = getAllComments();\n@@ -231,0 +231,18 @@\n+\n+    \/**\n+     * This method returns all the comments in the pr including comments in reviews(review body) and file specific comments\n+     *\/\n+    private List<Comment> getAllComments() {\n+        \/\/ Regular comments\n+        List<Comment> comments = new ArrayList<>(prComments());\n+        \/\/ Comments in reviews\n+        comments.addAll(pr.reviews().stream()\n+                .map(review -> new Comment(\"Review\" + review.id(), review.body().orElse(\"\"), review.reviewer(), review.createdAt(), null))\n+                .toList());\n+        \/\/ File specific comments\n+\/\/        comments.addAll(pr.reviewComments().stream()\n+\/\/                .map(reviewComment -> new Comment(\"ReviewComment\" + reviewComment.id(), reviewComment.body(), reviewComment.author(), reviewComment.createdAt(), reviewComment.updatedAt()))\n+\/\/                .toList());\n+        comments = comments.stream().sorted(Comparator.comparing(Comment::createdAt)).toList();\n+        return comments;\n+    }\n","filename":"bots\/pr\/src\/main\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCommandWorkItem.java","additions":20,"deletions":2,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+import org.openjdk.skara.forge.Review;\n@@ -29,0 +30,1 @@\n+import java.nio.file.Path;\n@@ -360,0 +362,36 @@\n+\n+    @Test\n+    void interpretCommandFromReviewsAndReviewComments(TestInfo testInfo) throws IOException {\n+        try (var credentials = new HostCredentials(testInfo);\n+             var tempFolder = new TemporaryDirectory()) {\n+            var author = credentials.getHostedRepository();\n+            var integrator = credentials.getHostedRepository();\n+\n+            var censusBuilder = credentials.getCensusBuilder()\n+                    .addAuthor(author.forge().currentUser().id());\n+            var prBot = PullRequestBot.newBuilder().repo(integrator).censusRepo(censusBuilder.build()).build();\n+\n+            \/\/ Populate the projects repository\n+            var localRepo = CheckableRepository.init(tempFolder.path(), author.repositoryType());\n+            var masterHash = localRepo.resolve(\"master\").orElseThrow();\n+            assertFalse(CheckableRepository.hasBeenEdited(localRepo));\n+            localRepo.push(masterHash, author.url(), \"master\", true);\n+\n+            \/\/ Make a change with a corresponding PR\n+            var editHash = CheckableRepository.appendAndCommit(localRepo);\n+            localRepo.push(editHash, author.url(), \"edit\", true);\n+            var pr = credentials.createPullRequest(author, \"master\", \"edit\", \"This is a pull request\");\n+\n+            \/\/ Test command in review\n+            pr.addReview(Review.Verdict.APPROVED, \"\/reviewers 3\");\n+            \/\/ Run the bot\n+            TestBotRunner.runPeriodicItems(prBot);\n+            assertLastCommentContains(pr, \"The total number of required reviews for this PR (including the jcheck configuration and the last \/reviewers command) is now set to 3\");\n+\n+            \/\/Test command in reviewComment\n+\/\/            pr.addReviewComment(masterHash, editHash, Path.of(\"appendable.txt\").toString(), 2, \"\/reviewers 4\");\n+\/\/            \/\/ Run the bot\n+\/\/            TestBotRunner.runPeriodicItems(prBot);\n+\/\/            assertLastCommentContains(pr, \"The total number of required reviews for this PR (including the jcheck configuration and the last \/reviewers command) is now set to 4\");\n+        }\n+    }\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestCommandTests.java","additions":39,"deletions":1,"binary":false,"changes":40,"status":"modified"}]}