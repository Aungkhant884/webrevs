{"files":[{"patch":"@@ -160,0 +160,4 @@\n+\n+    public Type getType() {\n+        return type;\n+    }\n","filename":"bots\/bridgekeeper\/src\/main\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/PullRequestCloserBot.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4,2 +4,0 @@\n-import org.openjdk.skara.bot.BotConfiguration;\n-import org.openjdk.skara.bot.ConfigurationError;\n@@ -7,1 +5,2 @@\n-import org.openjdk.skara.test.TestBotRunnerConfiguration;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n@@ -9,7 +8,1 @@\n-import java.io.IOException;\n-import java.nio.charset.StandardCharsets;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n-import java.nio.file.Paths;\n-\n-import static org.junit.jupiter.api.Assertions.*;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n@@ -18,2 +11,0 @@\n-    BridgekeeperBotFactory bridgekeeperBotFactory = new BridgekeeperBotFactory();\n-\n@@ -21,7 +12,80 @@\n-    public void testCreate() throws IOException, ConfigurationError {\n-\/\/        Path jsonFile = Paths.get(\"..\", \"resources\", \"services-external.json\");\n-\/\/        var jsonConfig = JWCC.parse(Files.readString(jsonFile, StandardCharsets.UTF_8)).asObject();\n-\/\/\n-\/\/        TestBotRunnerConfiguration runnerConfig = new TestBotRunnerConfiguration(jsonConfig);\n-\/\/        BotConfiguration botConfig = runnerConfig.perBotConfiguration(bridgekeeperBotFactory.name());\n-\/\/        bridgekeeperBotFactory.create(botConfig);\n+    public void testCreate() {\n+        var mirror1 = new TestHostedRepository(null, \"mirror1\");\n+        var mirror2 = new TestHostedRepository(null, \"mirror2\");\n+        var mirror3 = new TestHostedRepository(null, \"mirror3\");\n+        var data1 = new TestHostedRepository(null, \"data1\");\n+        var data2 = new TestHostedRepository(null, \"data2\");\n+        var data3 = new TestHostedRepository(null, \"data3\");\n+        var pruned1 = new TestHostedRepository(null, \"pruned1\");\n+        var pruned2 = new TestHostedRepository(null, \"pruned2\");\n+        var pruned3 = new TestHostedRepository(null, \"pruned3\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                  \"mirrors\": [\n+                    \"mirror1\",\n+                    \"mirror2\",\n+                    \"mirror3\"\n+                  ],\n+                  \"data\": [\n+                    \"data1\",\n+                    \"data2\",\n+                    \"data3\"\n+                  ],\n+                  \"pruned\": {\n+                    \"pruned1\": {\n+                      \"maxage\": \"P1D\"\n+                    },\n+                    \"pruned2\": {\n+                      \"maxage\": \"P2D\"\n+                    },\n+                    \"pruned3\": {\n+                      \"maxage\": \"P3D\"\n+                    }\n+                  }\n+                }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"mirror1\", mirror1)\n+                .addHostedRepository(\"mirror2\", mirror2)\n+                .addHostedRepository(\"mirror3\", mirror3)\n+                .addHostedRepository(\"data1\", data1)\n+                .addHostedRepository(\"data2\", data2)\n+                .addHostedRepository(\"data3\", data3)\n+                .addHostedRepository(\"pruned1\", pruned1)\n+                .addHostedRepository(\"pruned2\", pruned2)\n+                .addHostedRepository(\"pruned3\", pruned3)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(BridgekeeperBotFactory.NAME, jsonConfig);\n+        assertEquals(7, bots.size());\n+\n+        var mirrorPullRequestCloserBots = bots.stream()\n+                .filter(e -> e.getClass().equals(PullRequestCloserBot.class))\n+                .filter(e -> ((PullRequestCloserBot) e).getType().equals(PullRequestCloserBot.Type.MIRROR))\n+                .toList();\n+        var dataPullRequestCloserBots = bots.stream()\n+                .filter(e -> e.getClass().equals(PullRequestCloserBot.class))\n+                .filter(e -> ((PullRequestCloserBot) e).getType().equals(PullRequestCloserBot.Type.DATA))\n+                .toList();\n+        var pullRequestPrunerBots = bots.stream()\n+                .filter(e -> e.getClass().equals(PullRequestPrunerBot.class))\n+                .toList();\n+\n+        \/\/ A mirror pullRequestCloserBot for every configured mirror repository\n+        assertEquals(3, mirrorPullRequestCloserBots.size());\n+        \/\/ A data pullRequestCloserBot for every configured data repository\n+        assertEquals(3, dataPullRequestCloserBots.size());\n+        \/\/ One pullRequestPrunerBot for all configured pruned repository\n+        assertEquals(1, pullRequestPrunerBots.size());\n+\n+        \/\/ Check whether each bot is combined with the correct repo\n+        assertEquals(\"PullRequestCloserBot@mirror1\", mirrorPullRequestCloserBots.get(0).toString());\n+        assertEquals(\"PullRequestCloserBot@mirror2\", mirrorPullRequestCloserBots.get(1).toString());\n+        assertEquals(\"PullRequestCloserBot@mirror3\", mirrorPullRequestCloserBots.get(2).toString());\n+        assertEquals(\"PullRequestCloserBot@data1\", dataPullRequestCloserBots.get(0).toString());\n+        assertEquals(\"PullRequestCloserBot@data2\", dataPullRequestCloserBots.get(1).toString());\n+        assertEquals(\"PullRequestCloserBot@data3\", dataPullRequestCloserBots.get(2).toString());\n+        assertEquals(\"PullRequestPrunerBot\", pullRequestPrunerBots.get(0).toString());\n","filename":"bots\/bridgekeeper\/src\/test\/java\/org\/openjdk\/skara\/bots\/bridgekeeper\/BridgekeeperBotFactoryTest.java","additions":83,"deletions":19,"binary":false,"changes":102,"status":"modified"},{"patch":"@@ -0,0 +1,55 @@\n+package org.openjdk.skara.bots.censussync;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class CensusSyncBotFactoryTest {\n+    @Test\n+    void testCreate() {\n+        var from1 = new TestHostedRepository(null, \"from1\");\n+        var to1 = new TestHostedRepository(null, \"to1\");\n+        var to2 = new TestHostedRepository(null, \"to2\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                    \"sync\": [\n+                      {\n+                        \"method\": \"unify\",\n+                        \"from\": \"from1\",\n+                        \"to\": \"to1\",\n+                        \"version\": 1\n+                      },\n+                      {\n+                        \"method\": \"split\",\n+                        \"from\": \"https:\/\/test.org\/test.xml\",\n+                        \"to\": \"to2\",\n+                        \"version\": 2\n+                      }\n+                    ]\n+                  }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"from1\", from1)\n+                .addHostedRepository(\"to1\", to1)\n+                .addHostedRepository(\"to2\", to2)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(CensusSyncBotFactory.NAME, jsonConfig);\n+        assertEquals(2, bots.size());\n+\n+        var censusSyncUnifyBots = bots.stream().filter(e -> e.getClass().equals(CensusSyncUnifyBot.class)).toList();\n+        var censusSyncSplitBots = bots.stream().filter(e -> e.getClass().equals(CensusSyncSplitBot.class)).toList();\n+\n+        assertEquals(1, censusSyncUnifyBots.size());\n+        assertEquals(1, censusSyncSplitBots.size());\n+\n+        assertEquals(\"CensusSyncUnifyBot(from1->to1@1)\", censusSyncUnifyBots.get(0).toString());\n+        assertEquals(\"CensusSyncSplitBot(https:\/\/test.org\/test.xml->to2@2)\", censusSyncSplitBots.get(0).toString());\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/censussync\/src\/test\/java\/org\/openjdk\/skara\/bots\/censussync\/CensusSyncBotFactoryTest.java","additions":55,"deletions":0,"binary":false,"changes":55,"status":"added"},{"patch":"@@ -0,0 +1,58 @@\n+package org.openjdk.skara.bots.checkout;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class CheckoutBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        var mark = new TestHostedRepository(null, \"mark\");\n+        var from1 = new TestHostedRepository(null, \"from1\");\n+        var from2 = new TestHostedRepository(null, \"from2\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                  \"marks\": {\n+                    \"repo\": \"mark\",\n+                    \"author\": \"test_author <test_author@test.com>\"\n+                  },\n+                  \"repositories\": [\n+                    {\n+                      \"from\": {\n+                        \"repo\": \"from1\",\n+                        \"branch\": \"master\"\n+                      },\n+                      \"to\": \"to1\"\n+                    },\n+                    {\n+                      \"from\": {\n+                        \"repo\": \"from2\",\n+                        \"branch\": \"master\"\n+                      },\n+                      \"to\": \"to2\"\n+                    }\n+                  ]\n+                }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"mark\", mark)\n+                .addHostedRepository(\"from1\", from1)\n+                .addHostedRepository(\"from2\", from2)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(CheckoutBotFactory.NAME, jsonConfig);\n+        \/\/ A checkoutBot for every configured repository\n+        assertEquals(2, bots.size());\n+\n+        CheckoutBot checkoutBot1 = (CheckoutBot) bots.get(0);\n+        assertEquals(\"CheckoutBot(from1:master, to1)\", checkoutBot1.toString());\n+        CheckoutBot checkoutBot2 = (CheckoutBot) bots.get(1);\n+        assertEquals(\"CheckoutBot(from2:master, to2)\", checkoutBot2.toString());\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/checkout\/src\/test\/java\/org\/openjdk\/skara\/bots\/checkout\/CheckoutBotFactoryTest.java","additions":58,"deletions":0,"binary":false,"changes":58,"status":"added"},{"patch":"@@ -4,5 +4,0 @@\n-import org.junit.jupiter.api.TestInfo;\n-import org.openjdk.skara.bot.BotConfiguration;\n-import org.openjdk.skara.bot.ConfigurationError;\n-import org.openjdk.skara.host.Host;\n-import org.openjdk.skara.issuetracker.IssueProject;\n@@ -11,9 +6,0 @@\n-import org.openjdk.skara.vcs.git.GitRepository;\n-\n-import java.io.IOException;\n-import java.nio.charset.StandardCharsets;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n-import java.nio.file.Paths;\n-import java.util.List;\n-import java.util.stream.Collectors;\n@@ -24,84 +10,0 @@\n-\/\/    CSRBotFactory csrBotFactory = new CSRBotFactory();\n-\/\/\n-\/\/    @Test\n-\/\/    public void testCreate() throws IOException, ConfigurationError {\n-\/\/        String jsonString = \"\"\"\n-\/\/                {\n-\/\/                  \"forges\": {\n-\/\/                    \"orahub\": {\n-\/\/                      \"gitlab\": {\n-\/\/                        \"url\": \"https:\/\/test.test.com\"\n-\/\/                      }\n-\/\/                    },\n-\/\/                    \"test@github\": {\n-\/\/                      \"github\": {\n-\/\/                        \"app\": {\n-\/\/                        }\n-\/\/                      }\n-\/\/                    }\n-\/\/                  },\n-\/\/                  \"issuetrackers\": {\n-\/\/                    \"test_bugs\": {\n-\/\/                      \"jira\": {\n-\/\/                        \"url\": \"https:\/\/test.test.org\"\n-\/\/                      }\n-\/\/                    }\n-\/\/                  },\n-\/\/                  \"csr\": {\n-\/\/                    \"projects\": [\n-\/\/                      {\n-\/\/                        \"repository\": \"test@github\/openjdk\/jdk1\",\n-\/\/                        \"issues\": \"test_bugs\/TEST\"\n-\/\/                      },\n-\/\/                      {\n-\/\/                        \"repository\": \"test@github\/openjdk\/jdk2\",\n-\/\/                        \"issues\": \"test_bugs\/TEST\"\n-\/\/                      },\n-\/\/                      {\n-\/\/                        \"repository\": \"test@github\/openjdk\/jdk3\",\n-\/\/                        \"issues\": \"test_bugs\/TEST\"\n-\/\/                      },\n-\/\/                      {\n-\/\/                        \"repository\": \"test@github\/openjdk\/jdk4\",\n-\/\/                        \"issues\": \"test_bugs\/TEST\"\n-\/\/                      },\n-\/\/                      {\n-\/\/                        \"repository\": \"test@github\/openjdk\/jdk5\",\n-\/\/                        \"issues\": \"test_bugs\/TEST\"\n-\/\/                      },\n-\/\/                      {\n-\/\/                        \"repository\": \"test@github\/openjdk\/jdk6\",\n-\/\/                        \"issues\": \"test_bugs\/TEST2\"\n-\/\/                      }\n-\/\/                    ]\n-\/\/                  }\n-\/\/                }\n-\/\/                \"\"\";\n-\/\/        var jsonConfig = JWCC.parse(jsonString).asObject();\n-\/\/\n-\/\/        TestBotRunnerConfiguration runnerConfig = new TestBotRunnerConfiguration(jsonConfig);\n-\/\/        BotConfiguration botConfig = runnerConfig.perBotConfiguration(csrBotFactory.name());\n-\/\/        var bots = csrBotFactory.create(botConfig);\n-\/\/        assertEquals(8, bots.size());\n-\/\/\n-\/\/        var csrPullRequestBots = bots.stream().filter(e -> e.getClass().equals(CSRPullRequestBot.class)).collect(Collectors.toList());\n-\/\/        var csrIssueBots = bots.stream().filter(e -> e.getClass().equals(CSRIssueBot.class)).collect(Collectors.toList());\n-\/\/\n-\/\/        \/\/ a CSRPullRequestBot for every configured repository\n-\/\/        assertEquals(6, csrPullRequestBots.size());\n-\/\/        \/\/ a CSRIssueBot for each unique IssueProject\n-\/\/        assertEquals(2, csrIssueBots.size());\n-\/\/\n-\/\/        for (var bot : csrIssueBots) {\n-\/\/            CSRIssueBot csrIssueBot = (CSRIssueBot) bot;\n-\/\/            if (csrIssueBot.toString().equals(\"CSRIssueBot@TEST\")) {\n-\/\/                assertEquals(5, csrIssueBot.repositories().size());\n-\/\/            } else if (csrIssueBot.toString().equals(\"CSRIssueBot@TEST2\")) {\n-\/\/                assertEquals(1, csrIssueBot.repositories().size());\n-\/\/            } else {\n-\/\/                throw new RuntimeException(\"This issue bot is not expected\");\n-\/\/            }\n-\/\/        }\n-\/\/\n-\/\/    }\n-\n@@ -109,2 +11,6 @@\n-    public void testCreate() throws IOException, ConfigurationError {\n-\n+    public void testCreate() {\n+        var repo1 = new TestHostedRepository(null, \"repo1\");\n+        var repo2 = new TestHostedRepository(null, \"repo2\");\n+        var repo3 = new TestHostedRepository(null, \"repo3\");\n+        var issueProject1 = new TestIssueProject(null, \"TEST\");\n+        var issueProject2 = new TestIssueProject(null, \"TEST2\");\n@@ -116,1 +22,1 @@\n-                       \"repository\": \"test@github\/openjdk\/jdk1\",\n+                       \"repository\": \"repo1\",\n@@ -120,1 +26,1 @@\n-                       \"repository\": \"test@github\/openjdk\/jdk2\",\n+                       \"repository\": \"repo2\",\n@@ -124,13 +30,1 @@\n-                       \"repository\": \"test@github\/openjdk\/jdk3\",\n-                       \"issues\": \"test_bugs\/TEST\"\n-                     },\n-                     {\n-                       \"repository\": \"test@github\/openjdk\/jdk4\",\n-                       \"issues\": \"test_bugs\/TEST\"\n-                     },\n-                     {\n-                       \"repository\": \"test@github\/openjdk\/jdk5\",\n-                       \"issues\": \"test_bugs\/TEST\"\n-                     },\n-                     {\n-                       \"repository\": \"test@github\/openjdk\/jdk6\",\n+                       \"repository\": \"repo3\",\n@@ -144,10 +38,6 @@\n-        var host = TestHost.createNew(List.of());\n-        var localRepo = new GitRepository(Paths.get(\"\"));\n-        var testBotFactory = TestBotFactory.newBuilder().addHostedRepository(\"test@github\/openjdk\/jdk1\", new TestHostedRepository(host, \"openjdk\/jdk1\", localRepo))\n-                .addHostedRepository(\"test@github\/openjdk\/jdk2\", new TestHostedRepository(host, \"openjdk\/jdk2\", localRepo))\n-                .addHostedRepository(\"test@github\/openjdk\/jdk3\", new TestHostedRepository(host, \"openjdk\/jdk3\", localRepo))\n-                .addHostedRepository(\"test@github\/openjdk\/jdk4\", new TestHostedRepository(host, \"openjdk\/jdk4\", localRepo))\n-                .addHostedRepository(\"test@github\/openjdk\/jdk5\", new TestHostedRepository(host, \"openjdk\/jdk5\", localRepo))\n-                .addHostedRepository(\"test@github\/openjdk\/jdk6\", new TestHostedRepository(host, \"openjdk\/jdk6\", localRepo))\n-                .addIssueProject(\"test_bugs\/TEST\", new TestIssueProject(null, \"TEST\"))\n-                .addIssueProject(\"test_bugs\/TEST2\", new TestIssueProject(null, \"TEST2\"))\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"repo1\", repo1)\n+                .addHostedRepository(\"repo2\", repo2)\n+                .addHostedRepository(\"repo3\", repo3)\n+                .addIssueProject(\"test_bugs\/TEST\", issueProject1)\n+                .addIssueProject(\"test_bugs\/TEST2\", issueProject2)\n@@ -156,2 +46,2 @@\n-        var bots = testBotFactory.createBots(\"csr\", jsonConfig);\n-        assertEquals(8, bots.size());\n+        var bots = testBotFactory.createBots(CSRBotFactory.NAME, jsonConfig);\n+        assertEquals(5, bots.size());\n@@ -159,2 +49,2 @@\n-        var csrPullRequestBots = bots.stream().filter(e -> e.getClass().equals(CSRPullRequestBot.class)).collect(Collectors.toList());\n-        var csrIssueBots = bots.stream().filter(e -> e.getClass().equals(CSRIssueBot.class)).collect(Collectors.toList());\n+        var csrPullRequestBots = bots.stream().filter(e -> e.getClass().equals(CSRPullRequestBot.class)).toList();\n+        var csrIssueBots = bots.stream().filter(e -> e.getClass().equals(CSRIssueBot.class)).toList();\n@@ -162,3 +52,3 @@\n-        \/\/ a CSRPullRequestBot for every configured repository\n-        assertEquals(6, csrPullRequestBots.size());\n-        \/\/ a CSRIssueBot for each unique IssueProject\n+        \/\/ A CSRPullRequestBot for every configured repository\n+        assertEquals(3, csrPullRequestBots.size());\n+        \/\/ A CSRIssueBot for each unique IssueProject\n@@ -167,0 +57,4 @@\n+        assertEquals(\"CSRPullRequestBot@repo1\", csrPullRequestBots.get(0).toString());\n+        assertEquals(\"CSRPullRequestBot@repo2\", csrPullRequestBots.get(1).toString());\n+        assertEquals(\"CSRPullRequestBot@repo3\", csrPullRequestBots.get(2).toString());\n+\n@@ -170,1 +64,1 @@\n-                assertEquals(5, csrIssueBot.repositories().size());\n+                assertEquals(2, csrIssueBot.repositories().size());\n@@ -174,1 +68,1 @@\n-                throw new RuntimeException(\"This issue bot is not expected\");\n+                throw new RuntimeException(\"This CSRIssueBot is not expected\");\n","filename":"bots\/csr\/src\/test\/java\/org\/openjdk\/skara\/bots\/csr\/CSRBotFactoryTest.java","additions":28,"deletions":134,"binary":false,"changes":162,"status":"modified"},{"patch":"@@ -98,1 +98,1 @@\n-        return \"FowardBot@(\" + fromHostedRepo.name() + \":\" + fromBranch.name() +\n+        return \"ForwardBot@(\" + fromHostedRepo.name() + \":\" + fromBranch.name() +\n","filename":"bots\/forward\/src\/main\/java\/org\/openjdk\/skara\/bots\/forward\/ForwardBot.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,58 @@\n+package org.openjdk.skara.bots.forward;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import java.util.Comparator;\n+import java.util.Objects;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class ForwardBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var from1 = new TestHostedRepository(null, \"from1\");\n+            var from2 = new TestHostedRepository(null, \"from2\");\n+            var to1 = new TestHostedRepository(null, \"to1\");\n+            var to2 = new TestHostedRepository(null, \"to2\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"repositories\": {\n+                        \"repo1\": {\n+                          \"from\": \"from1:master\",\n+                          \"to\": \"to1:master\"\n+                        },\n+                        \"repo2\": {\n+                          \"from\": \"from2:dev\",\n+                          \"to\": \"to2:test\"\n+                        }\n+                      }\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"from1\", from1)\n+                    .addHostedRepository(\"from2\", from2)\n+                    .addHostedRepository(\"to1\", to1)\n+                    .addHostedRepository(\"to2\", to2)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(ForwardBotFactory.NAME, jsonConfig);\n+            bots = bots.stream().sorted(Comparator.comparing(Objects::toString)).toList();\n+            \/\/A forwardBot for every configured repo\n+            assertEquals(2, bots.size());\n+\n+            ForwardBot forwardBot1 = (ForwardBot) bots.get(0);\n+            assertEquals(\"ForwardBot@(from1:master-> to1:master)\", forwardBot1.toString());\n+            ForwardBot forwardBot2 = (ForwardBot) bots.get(1);\n+            assertEquals(\"ForwardBot@(from2:dev-> to2:test)\", forwardBot2.toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/forward\/src\/test\/java\/org\/openjdk\/skara\/bots\/forward\/ForwardBotFactoryTest.java","additions":58,"deletions":0,"binary":false,"changes":58,"status":"added"},{"patch":"@@ -0,0 +1,72 @@\n+package org.openjdk.skara.bots.hgbridge;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class JBridgeBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var marks = new TestHostedRepository(null, \"marks\");\n+            var converter = new TestHostedRepository(null, \"converter\");\n+            var des1 = new TestHostedRepository(null, \"des1\");\n+            var des2 = new TestHostedRepository(null, \"des2\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"marks\": {\n+                        \"repository\": \"marks\",\n+                        \"ref\": \"master\",\n+                        \"name\": \"test\",\n+                        \"email\": \"test@test.org\"\n+                      },\n+                      \"converters\": [\n+                        {\n+                          \"repository\": \"converter\",\n+                          \"ref\": \"master\",\n+                          \"authors\": \"test_authors.json\",\n+                          \"contributors\": \"test_contributors.json\",\n+                          \"sponsors\": \"test_sponsors.json\",\n+                          \"corrections\": \"test_corrections.json\",\n+                          \"replacements\": \"test_replacements.json\",\n+                          \"repositories\": [\n+                            {\n+                              \"source\": \"https:\/\/test.org\/source1\",\n+                              \"destinations\": \"https:\/\/test.org\/des1\",\n+                              \"replacements\": \"test_replacements_for_spec_repo.json\",\n+                            },\n+                            {\n+                              \"source\": \"https:\/\/test.org\/source2\",\n+                              \"destinations\": \"https:\/\/test.org\/des2\"\n+                            }\n+                          ]\n+                        }\n+                      ]\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"marks\", marks)\n+                    .addHostedRepository(\"converter\", converter)\n+                    .addHostedRepository(\"https:\/\/test.org\/des1\", des1)\n+                    .addHostedRepository(\"https:\/\/test.org\/des2\", des2)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(JBridgeBotFactory.NAME, jsonConfig);\n+            \/\/ A JBridgeBot for every configured repo\n+            assertEquals(2, bots.size());\n+\n+            JBridgeBot jBridgeBot1 = (JBridgeBot) bots.get(0);\n+            assertEquals(\"JBridgeBot@https:\/\/test.org\/source1\", jBridgeBot1.toString());\n+            JBridgeBot jBridgeBot2 = (JBridgeBot) bots.get(1);\n+            assertEquals(\"JBridgeBot@https:\/\/test.org\/source2\", jBridgeBot2.toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/hgbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/hgbridge\/JBridgeBotFactoryTest.java","additions":72,"deletions":0,"binary":false,"changes":72,"status":"added"},{"patch":"@@ -0,0 +1,49 @@\n+package org.openjdk.skara.bots.jep;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+import org.openjdk.skara.test.TestIssueProject;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class JEPBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        var repo1 = new TestHostedRepository(null, \"repo1\");\n+        var repo2 = new TestHostedRepository(null, \"repo2\");\n+        var issueProject1 = new TestIssueProject(null, \"TEST\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                  \"projects\": [\n+                    {\n+                      \"repository\": \"repo1\",\n+                      \"issues\": \"test_bugs\/TEST\"\n+                    },\n+                    {\n+                      \"repository\": \"repo2\",\n+                      \"issues\": \"test_bugs\/TEST\"\n+                    }\n+                  ]\n+                }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"repo1\", repo1)\n+                .addHostedRepository(\"repo2\", repo2)\n+                .addIssueProject(\"test_bugs\/TEST\", issueProject1)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(JEPBotFactory.NAME, jsonConfig);\n+        \/\/ A JEPBot for every configured project\n+        assertEquals(2, bots.size());\n+\n+        JEPBot jepBot1 = (JEPBot) bots.get(0);\n+        assertEquals(\"JEPBot@repo1\", jepBot1.toString());\n+        JEPBot jepBot2 = (JEPBot) bots.get(1);\n+        assertEquals(\"JEPBot@repo2\", jepBot2.toString());\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/jep\/src\/test\/java\/org\/openjdk\/skara\/bots\/jep\/JEPBotFactoryTest.java","additions":49,"deletions":0,"binary":false,"changes":49,"status":"added"},{"patch":"@@ -625,0 +625,4 @@\n+\n+    public List<Spec> getSpecs() {\n+        return specs;\n+    }\n","filename":"bots\/merge\/src\/main\/java\/org\/openjdk\/skara\/bots\/merge\/MergeBot.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,145 @@\n+package org.openjdk.skara.bots.merge;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import java.time.DayOfWeek;\n+import java.time.Month;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class MergeBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var target = new TestHostedRepository(null, \"target\");\n+            var fork = new TestHostedRepository(null, \"fork\");\n+            var from1 = new TestHostedRepository(null, \"from1\");\n+            var from2 = new TestHostedRepository(null, \"from2\");\n+            var from3 = new TestHostedRepository(null, \"from3\");\n+            var from4 = new TestHostedRepository(null, \"from4\");\n+            var from5 = new TestHostedRepository(null, \"from5\");\n+            var from6 = new TestHostedRepository(null, \"from6\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"repositories\": [\n+                        {\n+                          \"target\": \"target\",\n+                          \"fork\": \"fork\",\n+                          \"spec\": [\n+                            {\n+                              \"from\": \"from1:master\",\n+                              \"to\": \"master\",\n+                              \"frequency\": {\n+                                \"interval\": \"weekly\",\n+                                \"weekday\": \"monday\",\n+                                \"hour\": 3\n+                              }\n+                            },\n+                            {\n+                              \"name\": \"spec2\",\n+                              \"from\": \"from2:master\",\n+                              \"to\": \"test\"\n+                            },\n+                            {\n+                              \"from\": \"from3:master\",\n+                              \"to\": \"master\",\n+                              \"frequency\": {\n+                                \"interval\": \"hourly\",\n+                                \"minute\": 30\n+                              }\n+                            },\n+                            {\n+                              \"from\": \"from4:master\",\n+                              \"to\": \"master\",\n+                              \"frequency\": {\n+                                \"interval\": \"daily\",\n+                                \"hour\": 2\n+                              }\n+                            },\n+                            {\n+                              \"from\": \"from5:master\",\n+                              \"to\": \"master\",\n+                              \"frequency\": {\n+                                \"interval\": \"monthly\",\n+                                \"day\": 1,\n+                                \"hour\": 2\n+                              }\n+                            },\n+                            {\n+                              \"from\": \"from6:master\",\n+                              \"to\": \"master\",\n+                              \"frequency\": {\n+                                \"interval\": \"yearly\",\n+                                \"month\": \"october\",\n+                                \"day\": 15,\n+                                \"hour\": 5\n+                              }\n+                            }\n+                          ]\n+                        }\n+                      ]\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"target\", target)\n+                    .addHostedRepository(\"fork\", fork)\n+                    .addHostedRepository(\"from1\", from1)\n+                    .addHostedRepository(\"from2\", from2)\n+                    .addHostedRepository(\"from3\", from3)\n+                    .addHostedRepository(\"from4\", from4)\n+                    .addHostedRepository(\"from5\", from5)\n+                    .addHostedRepository(\"from6\", from6)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(MergeBotFactory.NAME, jsonConfig);\n+            assertEquals(1, bots.size());\n+\n+            MergeBot mergeBot = (MergeBot) bots.get(0);\n+            assertEquals(\"MergeBot@(target)\", mergeBot.toString());\n+\n+            \/\/ Check the contents in the mergeBot\n+            var specs = mergeBot.getSpecs();\n+            MergeBot.Spec spec1 = specs.get(0);\n+            MergeBot.Spec.Frequency frequency1 = spec1.frequency().get();\n+            assertTrue(spec1.name().isEmpty());\n+            assertTrue(frequency1.isWeekly());\n+            assertEquals(DayOfWeek.MONDAY, frequency1.weekday());\n+            assertEquals(3, frequency1.hour());\n+\n+            MergeBot.Spec spec2 = specs.get(1);\n+            assertTrue(spec2.frequency().isEmpty());\n+            assertTrue(spec2.name().isPresent());\n+\n+            MergeBot.Spec spec3 = specs.get(2);\n+            MergeBot.Spec.Frequency frequency3 = spec3.frequency().get();\n+            assertTrue(frequency3.isHourly());\n+            assertEquals(30, frequency3.minute());\n+\n+            MergeBot.Spec spec4 = specs.get(3);\n+            MergeBot.Spec.Frequency frequency4 = spec4.frequency().get();\n+            assertTrue(frequency4.isDaily());\n+            assertEquals(2, frequency4.hour());\n+\n+            MergeBot.Spec spec5 = specs.get(4);\n+            MergeBot.Spec.Frequency frequency5 = spec5.frequency().get();\n+            assertTrue(frequency5.isMonthly());\n+            assertEquals(1, frequency5.day());\n+            assertEquals(2, frequency5.hour());\n+\n+            MergeBot.Spec spec6 = specs.get(5);\n+            MergeBot.Spec.Frequency frequency6 = spec6.frequency().get();\n+            assertTrue(frequency6.isYearly());\n+            assertEquals(Month.OCTOBER, frequency6.month());\n+            assertEquals(15, frequency6.day());\n+            assertEquals(5, frequency6.hour());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/merge\/src\/test\/java\/org\/openjdk\/skara\/bots\/merge\/MergeBotFactoryTest.java","additions":145,"deletions":0,"binary":false,"changes":145,"status":"added"},{"patch":"@@ -0,0 +1,59 @@\n+package org.openjdk.skara.bots.mirror;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class MirrorBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var from1 = new TestHostedRepository(null, \"from1\");\n+            var from2 = new TestHostedRepository(null, \"from2\");\n+            var to1 = new TestHostedRepository(null, \"to1\");\n+            var to2 = new TestHostedRepository(null, \"to2\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"repositories\": [\n+                        {\n+                          \"from\": \"from1\",\n+                          \"to\": \"to1\",\n+                          \"branches\": \"master\"\n+                        },\n+                        {\n+                          \"from\": \"from2\",\n+                          \"to\": \"to2\",\n+                          \"branches\": [\n+                            \"master\",\n+                            \"dev\",\n+                            \"test\"\n+                          ]\n+                        }\n+                      ]\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"from1\", from1)\n+                    .addHostedRepository(\"from2\", from2)\n+                    .addHostedRepository(\"to1\", to1)\n+                    .addHostedRepository(\"to2\", to2)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(MirrorBotFactory.NAME, jsonConfig);\n+            assertEquals(2, bots.size());\n+\n+            MirrorBot mirrorBot1 = (MirrorBot) bots.get(0);\n+            assertEquals(\"MirrorBot@from1->to1 (master)\", mirrorBot1.toString());\n+            MirrorBot mirrorBot2 = (MirrorBot) bots.get(1);\n+            assertEquals(\"MirrorBot@from2->to2 (master,dev,test)\", mirrorBot2.toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/mirror\/src\/test\/java\/org\/openjdk\/skara\/bots\/mirror\/MirrorBotFactoryTest.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"added"},{"patch":"@@ -0,0 +1,155 @@\n+package org.openjdk.skara.bots.mlbridge;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.bot.Bot;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class MailingListBridgeBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var repo1 = new TestHostedRepository(null, \"repo1\");\n+            var repo2 = new TestHostedRepository(null, \"repo2\");\n+            var repo3 = new TestHostedRepository(null, \"repo3\");\n+            var repo4 = new TestHostedRepository(null, \"repo4\");\n+            var repo5 = new TestHostedRepository(null, \"repo5\");\n+            var archive = new TestHostedRepository(null, \"archive\");\n+            var census = new TestHostedRepository(null, \"census\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"name\": \"test\",\n+                      \"mail\": \"test@openjdk.org\",\n+                      \"ignored\": {\n+                        \"users\": [\n+                          \"ignore1[bot]\",\n+                          \"ignore2[bot]\",\n+                          \"ignore3[bot]\",\n+                          \"ignore4[bot]\"\n+                        ],\n+                        \"comments\": [\n+                          \"<!-- It's a test comment!-->\"\n+                        ]\n+                      },\n+                      \"ready\": {\n+                        \"labels\": [\n+                          \"rfr\"\n+                        ],\n+                        \"comments\": [\n+                          {\n+                            \"user\": \"test_user[bot]\",\n+                            \"pattern\": \"<!-- Welcome message -->\"\n+                          }\n+                        ]\n+                      },\n+                      \"server\": {\n+                        \"archive\": \"https:\/\/mail.test.org\/test\/\",\n+                        \"smtp\": \"0.0.0.0\",\n+                        \"interval\": \"PT5S\"\n+                      },\n+                      \"webrevs\": {\n+                        \"repository\": {\n+                          \"html\": \"repo1\",\n+                          \"json\": \"repo2\"\n+                        },\n+                        \"ref\": \"master\",\n+                        \"web\": \"https:\/\/test.openjdk.org\/\"\n+                      },\n+                      \"archive\": \"archive:master\",\n+                      \"issues\": \"https:\/\/bugs.test.org\/browse\/\",\n+                      \"cooldown\": \"PT2M\",\n+                      \"repositories\": [\n+                        {\n+                          \"repository\": \"repo3\",\n+                          \"census\": \"census:master\",\n+                          \"webrevs\": {\n+                            \"html\": false,\n+                            \"json\": true\n+                          },\n+                          \"headers\": {\n+                            \"Approved\": \"test\"\n+                          },\n+                          \"lists\": [\n+                            {\n+                              \"email\": \"test_email@test.org\"\n+                            }\n+                          ]\n+                        },\n+                        {\n+                          \"repository\": \"repo4\",\n+                          \"census\": \"census:master\",\n+                          \"webrevs\": {\n+                            \"html\": false,\n+                            \"json\": true\n+                          },\n+                          \"lists\": {\n+                            \"email\": \"test@test.com\"\n+                          },\n+                          \"bidirectional\": false,\n+                          \"reponame\": true\n+                        },\n+                        {\n+                          \"repository\": \"repo5\",\n+                          \"census\": \"census:master\",\n+                          \"webrevs\": {\n+                            \"html\": false,\n+                            \"json\": true\n+                          },\n+                          \"headers\": {\n+                            \"Approved\": \"test\"\n+                          },\n+                          \"reponame\": true,\n+                          \"branchname\": \"master\",\n+                          \"lists\": [\n+                            {\n+                              \"email\": \"test@test.org\",\n+                              \"labels\": [\n+                                \"label1\",\n+                                \"label2\",\n+                                \"label3\"\n+                              ]\n+                            }\n+                          ]\n+                        }\n+                      ]\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"repo1\", repo1)\n+                    .addHostedRepository(\"repo2\", repo2)\n+                    .addHostedRepository(\"repo3\", repo3)\n+                    .addHostedRepository(\"repo4\", repo4)\n+                    .addHostedRepository(\"repo5\", repo5)\n+                    .addHostedRepository(\"archive\", archive)\n+                    .addHostedRepository(\"census\", census)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(MailingListBridgeBotFactory.NAME, jsonConfig);\n+            assertEquals(5, bots.size());\n+\n+            \/\/A mailingListArchiveReaderBot for every configured repository which is bidirectional\n+            List<Bot> mailingListArchiveReaderBots = bots.stream().filter(e -> e.getClass().equals(MailingListArchiveReaderBot.class)).toList();\n+            \/\/A mailingListBridgeBot for every configured repository\n+            List<Bot> mailingListBridgeBots = bots.stream().filter(e -> e.getClass().equals(MailingListBridgeBot.class)).toList();\n+\n+            assertEquals(2, mailingListArchiveReaderBots.size());\n+            assertEquals(3, mailingListBridgeBots.size());\n+\n+            assertEquals(\"MailingListArchiveReaderBot@repo3\", mailingListArchiveReaderBots.get(0).toString());\n+            assertEquals(\"MailingListArchiveReaderBot@repo5\", mailingListArchiveReaderBots.get(1).toString());\n+            assertEquals(\"MailingListBridgeBot@repo3\", mailingListBridgeBots.get(0).toString());\n+            assertEquals(\"MailingListBridgeBot@repo4\", mailingListBridgeBots.get(1).toString());\n+            assertEquals(\"MailingListBridgeBot@repo5\", mailingListBridgeBots.get(2).toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/mlbridge\/src\/test\/java\/org\/openjdk\/skara\/bots\/mlbridge\/MailingListBridgeBotFactoryTest.java","additions":155,"deletions":0,"binary":false,"changes":155,"status":"added"},{"patch":"@@ -0,0 +1,129 @@\n+package org.openjdk.skara.bots.notify;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.*;\n+\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Objects;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class NotifyBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var notify = new TestHostedRepository(null, \"notify\");\n+            var repo1 = new TestHostedRepository(null, \"repo1\");\n+            var repo2 = new TestHostedRepository(null, \"repo2\");\n+            var testHost = TestHost.createNew(List.of());\n+            var issueProject1 = new TestIssueProject(testHost, \"TEST\");\n+            String jsonString = \"\"\"\n+                    {\n+                      \"database\": {\n+                        \"repository\": \"notify:master\",\n+                        \"name\": \"test_notify\",\n+                        \"email\": \"test_notify@openjdk.org\"\n+                      },\n+                      \"ready\": {\n+                        \"labels\": [\n+                          \"rfr\"\n+                        ],\n+                        \"comments\": [\n+                          {\n+                            \"user\": \"test[bot]\",\n+                            \"pattern\": \"<!-- Welcome message -->\"\n+                          }\n+                        ]\n+                      },\n+                      \"integrator\": \"111\",\n+                      \"mailinglist\": {\n+                        \"archive\": \"https:\/\/test.openjdk.org\/archive\",\n+                        \"smtp\": \"0.0.0.0\",\n+                        \"sender\": \"test <test@openjdk.org>\",\n+                        \"interval\": \"PT5S\"\n+                      },\n+                      \"issue\": {\n+                        \"reviews\": {\n+                          \"icon\": \"icon.png\"\n+                        },\n+                        \"commits\": {\n+                          \"icon\": \"commit.png\"\n+                        },\n+                        \"namespace\": \"test.org\"\n+                      },\n+                      \"repositories\": {\n+                        \"test@github\/test\/repo1\": {\n+                          \"basename\": \"test-repo\",\n+                          \"branches\": \"master\",\n+                          \"mailinglist\": {\n+                            \"recipient\": \"test@test.org\",\n+                            \"domains\": \"test.org|test.com\",\n+                            \"headers\": {\n+                              \"Approved\": \"0000000\"\n+                            },\n+                            \"branchnames\": false,\n+                            \"branches\": false,\n+                            \"tags\": true,\n+                            \"builds\": false\n+                          },\n+                          \"issue\": {\n+                            \"project\": \"test_bugs\/TEST\",\n+                            \"pronly\": true,\n+                            \"resolve\": false\n+                          },\n+                          \"comment\": {\n+                            \"project\": \"test_bugs\/TEST\"\n+                          },\n+                          \"prbranch\": {\n+                          }\n+                        },\n+                        \"test@github\/test\/repo2\": {\n+                          \"basename\": \"test-repo2\",\n+                          \"branches\": \"master\",\n+                          \"mailinglist\": {\n+                            \"recipient\": \"test@test.org\",\n+                            \"domains\": \"test.org|test.com\",\n+                            \"headers\": {\n+                              \"Approved\": \"0000000\"\n+                            },\n+                            \"branchnames\": false,\n+                            \"branches\": false,\n+                            \"tags\": true,\n+                            \"builds\": false\n+                          },\n+                          \"issue\": {\n+                            \"project\": \"test_bugs\/TEST\",\n+                            \"pronly\": true,\n+                            \"resolve\": false\n+                          },\n+                          \"comment\": {\n+                            \"project\": \"test_bugs\/TEST\"\n+                          },\n+                          \"prbranch\": {\n+                          }\n+                        }\n+                      }\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"notify\", notify)\n+                    .addHostedRepository(\"test@github\/test\/repo1\", repo1)\n+                    .addHostedRepository(\"test@github\/test\/repo2\", repo2)\n+                    .addIssueProject(\"test_bugs\/TEST\", issueProject1)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(NotifyBotFactory.NAME, jsonConfig);\n+            bots = bots.stream().sorted(Comparator.comparing(Objects::toString)).toList();\n+            \/\/A notifyBot for every configured repository\n+            assertEquals(2, bots.size());\n+\n+            assertEquals(\"NotifyBot@repo1\", bots.get(0).toString());\n+            assertEquals(\"NotifyBot@repo2\", bots.get(1).toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/notify\/src\/test\/java\/org\/openjdk\/skara\/bots\/notify\/NotifyBotFactoryTest.java","additions":129,"deletions":0,"binary":false,"changes":129,"status":"added"},{"patch":"@@ -0,0 +1,94 @@\n+package org.openjdk.skara.bots.pr;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.*;\n+\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class PullRequestBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var repo1 = new TestHostedRepository(null, \"repo1\");\n+            var testHost = TestHost.createNew(List.of());\n+            var repo2 = new TestHostedRepository(testHost, \"repo2\");\n+            var repo3 = new TestHostedRepository(null, \"repo3\");\n+            var repo4 = new TestHostedRepository(null, \"repo4\");\n+            var fork3 = new TestHostedRepository(null, \"fork4\");\n+            var fork4 = new TestHostedRepository(null, \"fork4\");\n+            var census = new TestHostedRepository(null, \"census\");\n+            var issueProject = new TestIssueProject(null, \"TEST\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"external\": {\n+                        \"pr\": {\n+                          \"test\": \"used to run tests\"\n+                        },\n+                        \"commit\": {\n+                          \"command1\": \"test1\",\n+                          \"command2\": \"test2\"\n+                        }\n+                      },\n+                      \"blockers\": {\n+                        \"test\": \"Signature needs verify\"\n+                      },\n+                      \"ready\": {\n+                        \"labels\": [],\n+                        \"comments\": []\n+                      },\n+                      \"labels\": {\n+                        \"label1\": {\n+                          \"repository\": \"repo1:master\",\n+                          \"filename\": \"file.json\"\n+                        }\n+                      },\n+                      \"repositories\": {\n+                        \"repo2\": {\n+                          \"census\": \"census:master\",\n+                          \"censuslink\": \"https:\/\/test.test.com\",\n+                          \"issues\": \"TEST\",\n+                          \"csr\": false,\n+                          \"two-reviewers\": [\n+                            \"rfr\"\n+                          ],\n+                          \"24h\": [\n+                            \"rfr\"\n+                          ]\n+                        }\n+                      },\n+                      \"forks\": {\n+                        \"repo3\": \"fork3\",\n+                        \"repo4\": \"fork4\",\n+                      }\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"repo1\", repo1)\n+                    .addHostedRepository(\"repo2\", repo2)\n+                    .addHostedRepository(\"repo3\", repo3)\n+                    .addHostedRepository(\"repo4\", repo4)\n+                    .addHostedRepository(\"fork3\", fork3)\n+                    .addHostedRepository(\"fork4\", fork4)\n+                    .addHostedRepository(\"census\", census)\n+                    .addIssueProject(\"TEST\", issueProject)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(PullRequestBotFactory.NAME, jsonConfig);\n+            \/\/A pullRequestBot for every configured repository\n+            assertEquals(1, bots.size());\n+\n+            var pullRequestBot1 = (PullRequestBot) bots.get(0);\n+            assertEquals(\"PullRequestBot@repo2\", pullRequestBot1.toString());\n+\n+            assertEquals(\"used to run tests\", pullRequestBot1.externalPullRequestCommands().get(\"test\"));\n+            assertEquals(\"TEST\", pullRequestBot1.issueProject().name());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/pr\/src\/test\/java\/org\/openjdk\/skara\/bots\/pr\/PullRequestBotFactoryTest.java","additions":94,"deletions":0,"binary":false,"changes":94,"status":"added"},{"patch":"@@ -0,0 +1,49 @@\n+package org.openjdk.skara.bots.submit;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class SubmitBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        var repo1 = new TestHostedRepository(null, \"repo1\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                  \"executors\": {\n+                    \"executor1\": {\n+                      \"type\": \"shell\",\n+                      \"timeout\": \"P3D\",\n+                      \"config\": {\n+                        \"cmd\": [\n+                        ],\n+                        \"name\": \"name1\",\n+                        \"env\": {\n+                          \"key1\": \"val1\",\n+                          \"key2\": \"val2\"\n+                        }\n+                      }\n+                    }\n+                  },\n+                  \"repositories\": {\n+                    \"repo1\": \"executor1\"\n+                  }\n+                }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"repo1\", repo1)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(SubmitBotFactory.NAME, jsonConfig);\n+        \/\/A submitBot for every configured repository\n+        assertEquals(1, bots.size());\n+\n+        assertEquals(\"SubmitBot@repo1\", bots.get(0).toString());\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/submit\/src\/test\/java\/org\/openjdk\/skara\/bots\/submit\/SubmitBotFactoryTest.java","additions":49,"deletions":0,"binary":false,"changes":49,"status":"added"},{"patch":"@@ -0,0 +1,36 @@\n+package org.openjdk.skara.bots.synclabel;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestIssueProject;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class SyncLabelBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        var issueProject = new TestIssueProject(null, \"TEST\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                  \"issueprojects\": [\n+                    {\n+                      \"project\": \"test_bugs\/TEST\",\n+                      \"inspect\": \".*\",\n+                      \"ignore\": \"\\\\\\\\b\\\\\\\\B\"\n+                    }\n+                  ]\n+                }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addIssueProject(\"test_bugs\/TEST\", issueProject)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(SyncLabelBotFactory.NAME, jsonConfig);\n+        \/\/ A syncLabelBot for every configured issueProject\n+        assertEquals(1, bots.size());\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/synclabel\/src\/test\/java\/org\/openjdk\/skara\/bots\/synclabel\/SyncLabelBotFactoryTest.java","additions":36,"deletions":0,"binary":false,"changes":36,"status":"added"},{"patch":"@@ -0,0 +1,60 @@\n+package org.openjdk.skara.bots.tester;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class TestBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var repo1 = new TestHostedRepository(null, \"repo1\");\n+            var repo2 = new TestHostedRepository(null, \"repo2\");\n+            var census = new TestHostedRepository(null, \"census\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"census\": \"census\",\n+                      \"approvers\": \"approver\",\n+                      \"allowlist\": [\n+                        \"allow1\",\n+                        \"allow2\"\n+                      ],\n+                      \"availableJobs\": [\n+                        \"availableJob1\",\n+                        \"availableJob2\"\n+                      ],\n+                      \"defaultJobs\":[\n+                        \"defaultJob1\",\n+                        \"defaultJob2\"\n+                      ],\n+                      \"ci\": \"ci_test\",\n+                      \"name\": \"name\",\n+                      \"repositories\": [\n+                        \"repo1\",\n+                        \"repo2\"\n+                      ]\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"repo1\", repo1)\n+                    .addHostedRepository(\"repo2\", repo2)\n+                    .addHostedRepository(\"census\", census)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(org.openjdk.skara.bots.tester.TestBotFactory.NAME, jsonConfig);\n+            \/\/A TestBot for every configured repo\n+            assertEquals(2, bots.size());\n+\n+            assertEquals(\"TestBot@repo1\",bots.get(0).toString());\n+            assertEquals(\"TestBot@repo2\",bots.get(1).toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/tester\/src\/test\/java\/org\/openjdk\/skara\/bots\/tester\/TestBotFactoryTest.java","additions":60,"deletions":0,"binary":false,"changes":60,"status":"added"},{"patch":"@@ -0,0 +1,39 @@\n+package org.openjdk.skara.bots.testinfo;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class TestInfoBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        var repo1 = new TestHostedRepository(null, \"repo1\");\n+        var repo2 = new TestHostedRepository(null, \"repo2\");\n+        var repo3 = new TestHostedRepository(null, \"repo3\");\n+\n+        String jsonString = \"\"\"\n+                {\n+                  \"repositories\": [\n+                    \"repo1\",\n+                    \"repo2\"\n+                  ]\n+                }\n+                \"\"\";\n+        var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+        var testBotFactory = TestBotFactory.newBuilder()\n+                .addHostedRepository(\"repo1\", repo1)\n+                .addHostedRepository(\"repo2\", repo2)\n+                .build();\n+\n+        var bots = testBotFactory.createBots(TestInfoBotFactory.NAME, jsonConfig);\n+        \/\/ A testInfoBot for every configured repo\n+        assertEquals(2, bots.size());\n+\n+        assertEquals(\"TestInfoBot@repo1\",bots.get(0).toString());\n+        assertEquals(\"TestInfoBot@repo2\",bots.get(1).toString());\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/testinfo\/src\/test\/java\/org\/openjdk\/skara\/bots\/testinfo\/TestInfoBotFactoryTest.java","additions":39,"deletions":0,"binary":false,"changes":39,"status":"added"},{"patch":"@@ -0,0 +1,42 @@\n+package org.openjdk.skara.bots.topological;\n+\n+import org.junit.jupiter.api.Test;\n+import org.openjdk.skara.json.JWCC;\n+import org.openjdk.skara.test.TemporaryDirectory;\n+import org.openjdk.skara.test.TestBotFactory;\n+import org.openjdk.skara.test.TestHostedRepository;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class TopologicalBotFactoryTest {\n+    @Test\n+    public void testCreate() {\n+        try (var tempFolder = new TemporaryDirectory()) {\n+            var repo1 = new TestHostedRepository(null, \"repo1\");\n+\n+            String jsonString = \"\"\"\n+                    {\n+                      \"repo\": \"repo1\",\n+                      \"branches\": [\n+                        \"master\",\n+                        \"dev\",\n+                        \"test\"\n+                      ],\n+                      \"depsFile\": \"test\"\n+                    }\n+                    \"\"\";\n+            var jsonConfig = JWCC.parse(jsonString).asObject();\n+\n+            var testBotFactory = TestBotFactory.newBuilder()\n+                    .addHostedRepository(\"repo1\", repo1)\n+                    .storagePath(tempFolder.path().resolve(\"storage\"))\n+                    .build();\n+\n+            var bots = testBotFactory.createBots(TopologicalBotFactory.NAME, jsonConfig);\n+            \/\/ A topologicalBot for every configured repo\n+            assertEquals(1, bots.size());\n+\n+            assertEquals(\"TopologicalBot@repo1\", bots.get(0).toString());\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"bots\/topological\/src\/test\/java\/org\/openjdk\/skara\/bots\/topological\/TopologicalBotFactoryTest.java","additions":42,"deletions":0,"binary":false,"changes":42,"status":"added"},{"patch":"@@ -178,2 +178,2 @@\n-                if (!hostedRepositories.containsKey(repoName)) {\n-                    throw new RuntimeException(\"Unknown repository: \" + repoName);\n+                if (!hostedRepositories.containsKey(repoName) && !hostedRepositories.containsKey(name)) {\n+                    throw new RuntimeException(\"Unknown repository: \" + repoName + \" or \" + name);\n@@ -181,1 +181,4 @@\n-                return hostedRepositories.get(repoName);\n+                if(hostedRepositories.get(repoName) !=null){\n+                    return hostedRepositories.get(repoName);\n+                }\n+                return hostedRepositories.get(name);\n@@ -194,1 +197,1 @@\n-                throw new RuntimeException(\"not implemented yet\");\n+                return null;\n@@ -224,2 +227,1 @@\n-                var bots = factory.create(botConfiguration);\n-                return bots;\n+                return factory.create(botConfiguration);\n","filename":"test\/src\/main\/java\/org\/openjdk\/skara\/test\/TestBotFactory.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1,82 +0,0 @@\n-package org.openjdk.skara.test;\n-\n-import org.openjdk.skara.bot.BotRunnerConfiguration;\n-import org.openjdk.skara.bot.ConfigurationError;\n-import org.openjdk.skara.forge.Forge;\n-import org.openjdk.skara.host.Credential;\n-import org.openjdk.skara.issuetracker.IssueTracker;\n-import org.openjdk.skara.json.JSONObject;\n-import org.openjdk.skara.network.URIBuilder;\n-\n-import java.net.URI;\n-import java.util.HashMap;\n-import java.util.Map;\n-\n-public class TestBotRunnerConfiguration extends BotRunnerConfiguration {\n-    public TestBotRunnerConfiguration(JSONObject config) throws ConfigurationError {\n-        super(config, parseRepositoryHosts(config), parseIssueHosts(config));\n-    }\n-\n-    static private Map<String, Forge> parseRepositoryHosts(JSONObject config) throws ConfigurationError {\n-        Map<String, Forge> ret = new HashMap<>();\n-\n-        if (!config.contains(\"forges\")) {\n-            return ret;\n-        }\n-        \/\/ Since we don't have the real credential, all the pats are set to null\n-        for (var entry : config.get(\"forges\").fields()) {\n-            if (entry.value().contains(\"gitlab\")) {\n-                var gitlab = entry.value().get(\"gitlab\");\n-                var uri = URIBuilder.base(gitlab.get(\"url\").asString()).build();\n-                Credential pat = null;\n-                ret.put(entry.name(), Forge.from(\"gitlab\", uri, pat, gitlab.asObject()));\n-            } else if (entry.value().contains(\"github\")) {\n-                var github = entry.value().get(\"github\");\n-                \/\/add {\"offline\":true} to the configuration, so that in Forge#repository, it will just create a new repo\n-                \/\/ instead of trying to get repo information from host\n-                github.asObject().put(\"offline\", true);\n-                URI uri;\n-                if (github.contains(\"url\")) {\n-                    uri = URIBuilder.base(github.get(\"url\").asString()).build();\n-                } else {\n-                    uri = URIBuilder.base(\"https:\/\/github.com\/\").build();\n-                }\n-                if (github.contains(\"app\")) {\n-                    Credential pat = null;\n-                    ret.put(entry.name(), Forge.from(\"github\", uri, pat, github.asObject()));\n-                } else if (github.contains(\"username\")) {\n-                    Credential pat = null;\n-                    ret.put(entry.name(), Forge.from(\"github\", uri, pat, github.asObject()));\n-                } else {\n-                    ret.put(entry.name(), Forge.from(\"github\", uri, github.asObject()));\n-                }\n-            } else {\n-                throw new ConfigurationError(\"Host \" + entry.name());\n-            }\n-        }\n-\n-        return ret;\n-    }\n-\n-    static private Map<String, IssueTracker> parseIssueHosts(JSONObject config) throws ConfigurationError {\n-        Map<String, IssueTracker> ret = new HashMap<>();\n-\n-        if (!config.contains(\"issuetrackers\")) {\n-            return ret;\n-        }\n-\n-        for (var entry : config.get(\"issuetrackers\").fields()) {\n-            if (entry.value().contains(\"jira\")) {\n-                var jira = entry.value().get(\"jira\");\n-                var uri = URIBuilder.base(jira.get(\"url\").asString()).build();\n-                \/\/we don't have real credential\n-                Credential credential = null;\n-                ret.put(entry.name(), IssueTracker.from(\"jira\", uri, credential, jira.asObject()));\n-            } else {\n-                throw new ConfigurationError(\"Host \" + entry.name());\n-            }\n-        }\n-\n-        return ret;\n-    }\n-}\n","filename":"test\/src\/main\/java\/org\/openjdk\/skara\/test\/TestBotRunnerConfiguration.java","additions":0,"deletions":82,"binary":false,"changes":82,"status":"deleted"},{"patch":"@@ -58,0 +58,9 @@\n+    public TestHostedRepository(TestHost host, String projectName) {\n+        super(host, projectName);\n+        this.host = host;\n+        this.projectName = projectName;\n+        this.localRepository = null;\n+        pullRequestPattern = null;\n+        commitComments = new HashMap<>();\n+    }\n+\n","filename":"test\/src\/main\/java\/org\/openjdk\/skara\/test\/TestHostedRepository.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}