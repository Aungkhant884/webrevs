{"files":[{"patch":"@@ -35,0 +35,1 @@\n+import java.awt.Frame;\n@@ -61,0 +62,1 @@\n+import sun.awt.TimedWindowEvent;\n@@ -390,0 +392,34 @@\n+    private void notifyWindowStateChanged(int oldState, int newState) {\n+        int changed = oldState ^ newState;\n+        if (changed == 0) {\n+            return;\n+        }\n+        if (log.isLoggable(PlatformLogger.Level.FINE)) {\n+            log.fine(\"Reporting state change %x -> %x\", oldState, newState);\n+        }\n+\n+        if (target instanceof Frame) {\n+            \/\/ Sync target with peer.\n+            AWTAccessor.getFrameAccessor().setExtendedState((Frame) target,\n+                newState);\n+        }\n+\n+        \/\/ Report (de)iconification to old clients.\n+        if ((changed & Frame.ICONIFIED) > 0) {\n+            if ((newState & Frame.ICONIFIED) > 0) {\n+                postEvent(new TimedWindowEvent((Window) target,\n+                        WindowEvent.WINDOW_ICONIFIED, null, 0, 0,\n+                        System.currentTimeMillis()));\n+            } else {\n+                postEvent(new TimedWindowEvent((Window) target,\n+                        WindowEvent.WINDOW_DEICONIFIED, null, 0, 0,\n+                        System.currentTimeMillis()));\n+            }\n+        }\n+\n+        \/\/ New (since 1.4) state change event.\n+        postEvent(new TimedWindowEvent((Window) target,\n+                WindowEvent.WINDOW_STATE_CHANGED, null, oldState, newState,\n+                System.currentTimeMillis()));\n+    }\n+\n","filename":"src\/java.desktop\/windows\/classes\/sun\/awt\/windows\/WWindowPeer.java","additions":36,"deletions":0,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -102,1 +102,0 @@\n-jmethodID AwtFrame::setExtendedStateMID;\n@@ -816,7 +815,0 @@\n-void\n-AwtFrame::SendWindowStateEvent(int oldState, int newState)\n-{\n-    SendWindowEvent(java_awt_event_WindowEvent_WINDOW_STATE_CHANGED,\n-                    NULL, oldState, newState);\n-}\n-\n@@ -976,18 +968,1 @@\n-        DTRACE_PRINTLN2(\"AwtFrame::WmSize: reporting state change %x -> %x\",\n-                oldState, newState);\n-\n-        \/\/ sync target with peer\n-        JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n-        env->CallVoidMethod(GetPeer(env), AwtFrame::setExtendedStateMID, newState);\n-\n-        \/\/ report (de)iconification to old clients\n-        if (changed & java_awt_Frame_ICONIFIED) {\n-            if (newState & java_awt_Frame_ICONIFIED) {\n-                SendWindowEvent(java_awt_event_WindowEvent_WINDOW_ICONIFIED);\n-            } else {\n-                SendWindowEvent(java_awt_event_WindowEvent_WINDOW_DEICONIFIED);\n-            }\n-        }\n-\n-        \/\/ New (since 1.4) state change event\n-        SendWindowStateEvent(oldState, newState);\n+        NotifyWindowStateChanged(oldState, newState);\n@@ -1699,4 +1674,0 @@\n-    AwtFrame::setExtendedStateMID = env->GetMethodID(cls, \"setExtendedState\", \"(I)V\");\n-    DASSERT(AwtFrame::setExtendedStateMID);\n-    CHECK_NULL(AwtFrame::setExtendedStateMID);\n-\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Frame.cpp","additions":1,"deletions":30,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -57,1 +57,0 @@\n-    static jmethodID setExtendedStateMID;\n@@ -91,2 +90,0 @@\n-    void SendWindowStateEvent(int oldState, int newState);\n-\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Frame.h","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -187,0 +187,1 @@\n+jmethodID AwtWindow::notifyWindowStateChangedMID;\n@@ -1644,0 +1645,10 @@\n+void AwtWindow::NotifyWindowStateChanged(jint oldState, jint newState)\n+{\n+    JNIEnv *env = (JNIEnv *)JNU_GetEnv(jvm, JNI_VERSION_1_2);\n+    jobject peer = GetPeer(env);\n+    if (peer != NULL) {\n+        env->CallVoidMethod(peer, AwtWindow::notifyWindowStateChangedMID,\n+            oldState, newState);\n+    }\n+}\n+\n@@ -3347,0 +3358,5 @@\n+    AwtWindow::notifyWindowStateChangedMID =\n+        env->GetMethodID(cls, \"notifyWindowStateChanged\", \"(II)V\");\n+    DASSERT(AwtWindow::notifyWindowStateChangedMID);\n+    CHECK_NULL(AwtWindow::notifyWindowStateChangedMID);\n+\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Window.cpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -60,0 +60,1 @@\n+    \/* sun.awt.windows.WWindowPeer field and method IDs *\/\n@@ -67,0 +68,1 @@\n+    static jmethodID notifyWindowStateChangedMID;\n@@ -68,0 +70,1 @@\n+    \/* java.awt.Window method IDs *\/\n@@ -152,0 +155,1 @@\n+    void NotifyWindowStateChanged(jint oldState, jint newState);\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/awt_Window.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"}]}