{"files":[{"patch":"@@ -98,0 +98,1 @@\n+        String gnome = \"gnome\";\n@@ -101,1 +102,9 @@\n-        return (gsi != null) ? \"gnome\" : null;\n+        if (gsi != null) {\n+            return gnome;\n+        }\n+\n+        String desktop = AccessController.doPrivileged(\n+                (PrivilegedAction<String>) ()\n+                        -> System.getenv(\"XDG_CURRENT_DESKTOP\"));\n+        return (desktop != null && desktop.toLowerCase().contains(gnome))\n+                ? gnome : null;\n","filename":"src\/java.desktop\/unix\/classes\/sun\/awt\/UNIXToolkit.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -24,1 +24,1 @@\n- \/*\n+\/*\n@@ -26,1 +26,1 @@\n- * @bug 8226783\n+ * @bug 8226783 8247753\n@@ -55,19 +55,20 @@\n-           \/*\n-            * The implementation keys off the following desktop setting to\n-            * decide if GTK is an appropriate system L&F.\n-            * In its absence, there probably isn't support for the GTK L&F\n-            * anyway. It does not tell us if the GTK libraries are available\n-            * but they really should be if this is a gnome session.\n-            * If it proves necessary the test can perhaps be updated to see\n-            * if the GTK LAF is listed as installed and can be instantiated.\n-            *\/\n-           String gnome = System.getenv(\"GNOME_DESKTOP_SESSION_ID\");\n-           System.out.println(\"Gnome desktop session ID is \" + gnome);\n-           if (gnome != null) {\n-               expLAF = \"com.sun.java.swing.plaf.gtk.GTKLookAndFeel\";\n-           } else if (os.contains(\"linux\")) {\n-               expLAF = \"javax.swing.plaf.metal.MetalLookAndFeel\";\n-           } else if (os.contains(\"sunos\")) {\n-               expLAF = \"com.sun.java.swing.plaf.motif.MotifLookAndFeel\";\n-           }\n-       }\n+            \/*\n+             * The implementation keys off the following desktop setting to\n+             * decide if GTK is an appropriate system L&F.\n+             * In its absence, there probably isn't support for the GTK L&F\n+             * anyway. It does not tell us if the GTK libraries are available\n+             * but they really should be if this is a gnome session.\n+             * If it proves necessary the test can perhaps be updated to see\n+             * if the GTK LAF is listed as installed and can be instantiated.\n+             *\/\n+            String gnome = System.getenv(\"GNOME_DESKTOP_SESSION_ID\");\n+            String desktop = System.getenv(\"XDG_CURRENT_DESKTOP\");\n+            System.out.println(\"Gnome desktop session ID is \" + gnome);\n+            System.out.println(\"XDG_CURRENT_DESKTOP is set to \" + desktop);\n+            if (gnome != null ||\n+                    (desktop != null && desktop.toLowerCase().contains(\"gnome\"))) {\n+                expLAF = \"com.sun.java.swing.plaf.gtk.GTKLookAndFeel\";\n+            } else {\n+                expLAF = \"javax.swing.plaf.metal.MetalLookAndFeel\";\n+            }\n+        }\n@@ -82,1 +83,1 @@\n-   }\n+    }\n","filename":"test\/jdk\/javax\/swing\/LookAndFeel\/SystemLookAndFeel\/SystemLookAndFeelTest.java","additions":23,"deletions":22,"binary":false,"changes":45,"status":"modified"}]}