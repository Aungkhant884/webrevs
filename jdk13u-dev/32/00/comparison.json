{"files":[{"patch":"@@ -4639,1 +4639,1 @@\n-                            KeyUtil.getKeySize(key), key.getAlgorithm())));\n+                            KeyUtil.getKeySize(key), fullDisplayAlgName(key))));\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/Main.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,4 @@\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n@@ -47,1 +51,1 @@\n-    static String[] getAlgorithms(String propertyName) {\n+    static List<String> getAlgorithms(String propertyName) {\n@@ -71,1 +75,1 @@\n-            algorithmsInProperty = new String[0];\n+            return Collections.emptyList();\n@@ -73,1 +77,1 @@\n-        return algorithmsInProperty;\n+        return new ArrayList<>(Arrays.asList(algorithmsInProperty));\n@@ -76,1 +80,1 @@\n-    static boolean checkAlgorithm(String[] algorithms, String algorithm,\n+    static boolean checkAlgorithm(List<String> algorithms, String algorithm,\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/AbstractAlgorithmConstraints.java","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -34,0 +34,3 @@\n+import java.security.interfaces.ECKey;\n+import java.security.interfaces.XECKey;\n+import java.security.spec.NamedParameterSpec;\n@@ -52,2 +55,2 @@\n-    \/\/ Public Key being checked against constraints\n-    private final Key publicKey;\n+    \/\/ Key being checked against constraints\n+    private final Key key;\n@@ -69,0 +72,3 @@\n+    \/\/ Named Curve\n+    private final String[] curveStr;\n+    private static final String[] EMPTYLIST = new String[0];\n@@ -79,1 +85,6 @@\n-        publicKey = null;\n+        key = null;\n+        if (c != null) {\n+            curveStr = getNamedCurveFromKey(c.getPublicKey());\n+        } else {\n+            curveStr = EMPTYLIST;\n+        }\n@@ -86,1 +97,2 @@\n-        this.publicKey = key;\n+        this.key = key;\n+        curveStr = getNamedCurveFromKey(key);\n@@ -112,2 +124,2 @@\n-    public Key getPublicKey() {\n-        return publicKey;\n+    public Key getKey() {\n+        return key;\n@@ -115,0 +127,1 @@\n+\n@@ -135,0 +148,43 @@\n+\n+    public String[] getNamedCurve() {\n+        return curveStr;\n+    }\n+\n+    public static String[] getNamedCurveFromKey(Key key) {\n+        if (key instanceof ECKey) {\n+            NamedCurve nc = CurveDB.lookup(((ECKey)key).getParams());\n+            return (nc == null ? EMPTYLIST : CurveDB.getNamesByOID(nc.getObjectId()));\n+        } else if (key instanceof XECKey) {\n+            String[] s = {\n+                    ((NamedParameterSpec)((XECKey)key).getParams()).getName()\n+            };\n+            return s;\n+        } else {\n+            return EMPTYLIST;\n+        }\n+    }\n+\n+    public String toString() {\n+        StringBuilder s = new StringBuilder();\n+        s.append(\"Cert:       \");\n+        if (cert != null) {\n+            s.append(cert.toString());\n+            s.append(\"\\nSigAlgo:    \");\n+            s.append(cert.getSigAlgName());\n+        } else {\n+            s.append(\"None\");\n+        }\n+        s.append(\"\\nAlgParams:  \");\n+        if (getAlgParams() != null) {\n+            getAlgParams().toString();\n+        } else {\n+            s.append(\"None\");\n+        }\n+        s.append(\"\\nNamedCurves: \");\n+        for (String c : getNamedCurve()) {\n+            s.append(c + \" \");\n+        }\n+        s.append(\"\\nVariant:    \" + getVariant());\n+        return s.toString();\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/ConstraintsParameters.java","additions":62,"deletions":6,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -156,0 +156,19 @@\n+    private static class Holder {\n+        private static final Pattern nameSplitPattern = Pattern.compile(\n+                SPLIT_PATTERN);\n+    }\n+\n+    \/\/ Return all the names the EC curve could be using.\n+    static String[] getNamesByOID(String oid) {\n+        NamedCurve nc = oidMap.get(oid);\n+        if (nc == null) {\n+            return new String[0];\n+        }\n+        String[] list = Holder.nameSplitPattern.split(nc.getName());\n+        int i = 0;\n+        do {\n+            list[i] = list[i].trim();\n+        } while (++i < list.length);\n+        return list;\n+    }\n+\n@@ -157,1 +176,1 @@\n-        Pattern nameSplitPattern = Pattern.compile(SPLIT_PATTERN);\n+        Pattern nameSplitPattern = Holder.nameSplitPattern;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/CurveDB.java","additions":20,"deletions":1,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,2 +30,0 @@\n-import java.io.ByteArrayOutputStream;\n-import java.io.PrintStream;\n@@ -40,0 +38,1 @@\n+import java.util.Arrays;\n@@ -63,1 +62,1 @@\n-    \/\/ the known security property, jdk.certpath.disabledAlgorithms\n+    \/\/ Disabled algorithm security property for certificate path\n@@ -67,1 +66,1 @@\n-    \/\/ the known security property, jdk.tls.disabledAlgorithms\n+    \/\/ Disabled algorithm security property for TLS\n@@ -71,1 +70,1 @@\n-    \/\/ the known security property, jdk.jar.disabledAlgorithms\n+    \/\/ Disabled algorithm security property for jar\n@@ -75,1 +74,5 @@\n-    private final String[] disabledAlgorithms;\n+    \/\/ Property for disabled EC named curves\n+    private static final String PROPERTY_DISABLED_EC_CURVES =\n+            \"jdk.disabled.namedCurves\";\n+\n+    private final List<String> disabledAlgorithms;\n@@ -100,0 +103,18 @@\n+\n+        \/\/ Check for alias\n+        int ecindex = -1, i = 0;\n+        for (String s : disabledAlgorithms) {\n+            if (s.regionMatches(true, 0,\"include \", 0, 8)) {\n+                if (s.regionMatches(true, 8, PROPERTY_DISABLED_EC_CURVES, 0,\n+                        PROPERTY_DISABLED_EC_CURVES.length())) {\n+                    ecindex = i;\n+                    break;\n+                }\n+            }\n+            i++;\n+        }\n+        if (ecindex > -1) {\n+            disabledAlgorithms.remove(ecindex);\n+            disabledAlgorithms.addAll(ecindex,\n+                    getAlgorithms(PROPERTY_DISABLED_EC_CURVES));\n+        }\n@@ -167,0 +188,13 @@\n+\n+        \/\/ Check if named curves in the ConstraintParameters are disabled.\n+        if (cp.getNamedCurve() != null) {\n+            for (String curve : cp.getNamedCurve()) {\n+                if (!checkAlgorithm(disabledAlgorithms, curve, decomposer)) {\n+                    throw new CertPathValidatorException(\n+                            \"Algorithm constraints check failed on disabled \" +\n+                                    \"algorithm: \" + curve,\n+                            null, null, -1, BasicReason.ALGORITHM_CONSTRAINED);\n+                }\n+            }\n+        }\n+\n@@ -202,0 +236,7 @@\n+        \/\/ If this is an elliptic curve, check disabled the named curve.\n+        for (String curve : ConstraintsParameters.getNamedCurveFromKey(key)) {\n+            if (!permits(primitives, curve, null)) {\n+                return false;\n+            }\n+        }\n+\n@@ -233,1 +274,1 @@\n-        public Constraints(String[] constraintArray) {\n+        public Constraints(List<String> constraintArray) {\n@@ -261,1 +302,3 @@\n-                if (space <= 0) {\n+                \/\/ If there is no whitespace, it is a algorithm name; however,\n+                \/\/ if there is a whitespace, could be a multi-word EC curve too.\n+                if (space <= 0 || CurveDB.lookup(constraintEntry) != null) {\n@@ -360,1 +403,1 @@\n-                        debug.println(\"keySizeConstraint: failed key \" +\n+                        debug.println(\"Constraints: failed key size\" +\n@@ -379,1 +422,1 @@\n-                        debug.println(\"keySizeConstraint: failed algorithm \" +\n+                        debug.println(\"Constraints: failed algorithm \" +\n@@ -396,2 +439,1 @@\n-                debug.println(\"Constraints.permits(): \" + algorithm +\n-                        \" Variant: \" + cp.getVariant());\n+                debug.println(\"Constraints.permits(): \" + cp.toString());\n@@ -411,2 +453,2 @@\n-            if (cp.getPublicKey() != null) {\n-                algorithms.add(cp.getPublicKey().getAlgorithm());\n+            if (cp.getKey() != null) {\n+                algorithms.add(cp.getKey().getAlgorithm());\n@@ -551,4 +593,1 @@\n-            if (nextConstraint != null && nextConstraint.permits(key)) {\n-                return true;\n-            }\n-            return false;\n+            return nextConstraint != null && nextConstraint.permits(key);\n@@ -804,2 +843,2 @@\n-            if (cp.getPublicKey() != null) {\n-                key = cp.getPublicKey();\n+            if (cp.getKey() != null) {\n+                key = cp.getKey();\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/DisabledAlgorithmConstraints.java","additions":60,"deletions":21,"binary":false,"changes":81,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+import java.util.List;\n@@ -32,1 +33,0 @@\n-import static sun.security.util.AbstractAlgorithmConstraints.getAlgorithms;\n@@ -43,1 +43,1 @@\n-    private final String[] legacyAlgorithms;\n+    private final List<String> legacyAlgorithms;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/LegacyAlgorithmConstraints.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -502,0 +502,16 @@\n+#\n+# This property contains a list of disabled EC Named Curves that can be included\n+# in the jdk.[tls|certpath|jar].disabledAlgorithms properties.  To include this\n+# list in any of the disabledAlgorithms properties, add the property name as\n+# an entry.\n+jdk.disabled.namedCurves = secp112r1, secp112r2, secp128r1, secp128r2, \\\n+    secp160k1, secp160r1, secp160r2, secp192k1, secp192r1, secp224k1, \\\n+    secp224r1, secp256k1, sect113r1, sect113r2, sect131r1, sect131r2, \\\n+    sect163k1, sect163r1, sect163r2, sect193r1, sect193r2, sect233k1, \\\n+    sect233r1, sect239k1, sect283k1, sect283r1, sect409k1, sect409r1, \\\n+    sect571k1, sect571r1, X9.62 c2tnb191v1, X9.62 c2tnb191v2, \\\n+    X9.62 c2tnb191v3, X9.62 c2tnb239v1, X9.62 c2tnb239v2, X9.62 c2tnb239v3, \\\n+    X9.62 c2tnb359v1, X9.62 c2tnb431r1, X9.62 prime192v2, X9.62 prime192v3, \\\n+    X9.62 prime239v1, X9.62 prime239v2, X9.62 prime239v3, brainpoolP256r1, \\\n+    brainpoolP320r1, brainpoolP384r1, brainpoolP512r1\n+\n@@ -516,1 +532,1 @@\n-#       AlgorithmName [Constraint] { '&' Constraint }\n+#       AlgorithmName [Constraint] { '&' Constraint } | IncludeProperty\n@@ -543,0 +559,3 @@\n+#   IncludeProperty:\n+#       include <security property>\n+#\n@@ -555,0 +574,8 @@\n+# The \"IncludeProperty\" allows a implementation-defined security property that\n+# can be included in the disabledAlgorithms properties.  These properties are\n+# to help manage common actions easier across multiple disabledAlgorithm\n+# properties.\n+# There is one defined security property:  jdk.disabled.NamedCurves\n+# See the property for more specific details.\n+#\n+#\n@@ -627,1 +654,2 @@\n-    RSA keySize < 1024, DSA keySize < 1024, EC keySize < 224\n+    RSA keySize < 1024, DSA keySize < 1024, EC keySize < 224, \\\n+    include jdk.disabled.namedCurves\n@@ -671,1 +699,1 @@\n-      DSA keySize < 1024\n+      DSA keySize < 1024, include jdk.disabled.namedCurves\n@@ -706,1 +734,2 @@\n-    EC keySize < 224, 3DES_EDE_CBC, anon, NULL\n+    EC keySize < 224, 3DES_EDE_CBC, anon, NULL, \\\n+    include jdk.disabled.namedCurves\n","filename":"src\/java.base\/share\/conf\/security\/java.security","additions":33,"deletions":4,"binary":false,"changes":37,"status":"modified"}]}