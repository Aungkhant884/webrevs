{"files":[{"patch":"@@ -33,0 +33,1 @@\n+#include \"gc\/shared\/barrierSetNMethod.hpp\"\n@@ -538,0 +539,12 @@\n+    BarrierSetNMethod* bs_nm = BarrierSet::barrier_set()->barrier_set_nmethod();\n+    if (bs_nm != NULL) {\n+      \/\/ We want to keep an invariant that nmethods found through iterations of a Thread's\n+      \/\/ nmethods found in safepoints have gone through an entry barrier and are not armed.\n+      \/\/ By calling this nmethod entry barrier from the sweeper, it plays along and acts\n+      \/\/ like any other nmethod found on the stack of a thread (fewer surprises).\n+      nmethod* nm = as_nmethod_or_null();\n+      if (nm != NULL) {\n+        bool alive = bs_nm->nmethod_entry_barrier(nm);\n+        assert(alive, \"should be alive\");\n+      }\n+    }\n","filename":"src\/hotspot\/share\/code\/compiledMethod.cpp","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -40,1 +40,0 @@\n-  virtual bool nmethod_entry_barrier(nmethod* nm) = 0;\n@@ -43,0 +42,1 @@\n+  virtual bool nmethod_entry_barrier(nmethod* nm) = 0;\n","filename":"src\/hotspot\/share\/gc\/shared\/barrierSetNMethod.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}