{"files":[{"patch":"@@ -71,1 +71,1 @@\n-    LIBS_macosx := -framework Foundation -framework JavaNativeFoundation \\\n+    LIBS_macosx := -framework Foundation \\\n","filename":"make\/lib\/Lib-jdk.hotspot.agent.gmk","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,2 +27,0 @@\n-#import <JavaNativeFoundation\/JavaNativeFoundation.h>\n-#import <JavaRuntimeSupport\/JavaRuntimeSupport.h>\n@@ -258,0 +256,33 @@\n+\/* Create a pool and initiate a try block to catch any exception *\/\n+#define JNI_COCOA_ENTER(env) \\\n+ NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init]; \\\n+ @try {\n+\n+\/* Don't allow NSExceptions to escape to Java.\n+ * If there is a Java exception that has been thrown that should escape.\n+ * And ensure we drain the auto-release pool.\n+ *\/\n+#define JNI_COCOA_EXIT(env) \\\n+ } \\\n+ @catch (NSException *e) { \\\n+     NSLog(@\"%@\", [e callStackSymbols]); \\\n+ } \\\n+ @finally { \\\n+    [pool drain]; \\\n+ };\n+\n+static NSString* JavaStringToNSString(JNIEnv *env, jstring jstr) {\n+\n+    if (jstr == NULL) {\n+        return NULL;\n+    }\n+    jsize len = (*env)->GetStringLength(env, jstr);\n+    const jchar *chars = (*env)->GetStringChars(env, jstr, NULL);\n+    if (chars == NULL) {\n+        return NULL;\n+    }\n+    NSString *result = [NSString stringWithCharacters:(UniChar *)chars length:len];\n+    (*env)->ReleaseStringChars(env, jstr, chars);\n+    return result;\n+}\n+\n@@ -275,2 +306,3 @@\n-JNF_COCOA_ENTER(env);\n-  NSString *symbolNameString = JNFJavaToNSString(env, symbolName);\n+  JNI_COCOA_ENTER(env);\n+\n+  NSString *symbolNameString = JavaStringToNSString(env, symbolName);\n@@ -287,1 +319,1 @@\n-JNF_COCOA_EXIT(env);\n+  JNI_COCOA_EXIT(env);\n@@ -804,1 +836,1 @@\n-JNF_COCOA_ENTER(env);\n+  JNI_COCOA_ENTER(env);\n@@ -918,1 +950,1 @@\n-JNF_COCOA_EXIT(env);\n+  JNI_COCOA_EXIT(env);\n@@ -1009,1 +1041,2 @@\n-JNF_COCOA_ENTER(env);\n+\n+  JNI_COCOA_ENTER(env);\n@@ -1060,1 +1093,1 @@\n-JNF_COCOA_EXIT(env);\n+  JNI_COCOA_EXIT(env);\n","filename":"src\/jdk.hotspot.agent\/macosx\/native\/libsaproc\/MacosxDebuggerLocal.m","additions":42,"deletions":9,"binary":false,"changes":51,"status":"modified"}]}