{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2006, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2006, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,0 +23,1 @@\n+import com.sun.org.apache.xml.internal.serializer.dom3.DOMConstants;\n@@ -505,2 +506,4 @@\n-                    boolean b = val.endsWith(\"yes\") ? true : false;\n-                    m_doIndent = b;\n+                    m_doIndent = val.endsWith(\"yes\");\n+                } else if ((DOMConstants.S_JDK_PROPERTIES_NS + DOMConstants.S_IS_STANDALONE)\n+                        .equals(name)) {\n+                    m_isStandalone = val.endsWith(\"yes\");\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/ToStream.java","additions":6,"deletions":3,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,2 +2,1 @@\n- * reserved comment block\n- * DO NOT REMOVE OR ALTER!\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +24,2 @@\n+import com.sun.org.apache.xerces.internal.impl.Constants;\n+\n@@ -29,0 +30,1 @@\n+ * @LastModified: Jan 2021\n@@ -30,1 +32,1 @@\n-final class DOMConstants {\n+public final class DOMConstants {\n@@ -38,0 +40,2 @@\n+    public static final String ORACLE_URL = \"http:\/\/www.oracle.com\/xml\";\n+\n@@ -45,0 +49,3 @@\n+    \/\/ The namespace used for the JDK-only parameters\n+    public static final String S_JDK_PROPERTIES_NS = \"{\" + ORACLE_URL + \"}\";\n+\n@@ -116,0 +123,19 @@\n+    \/**\n+     * Indicates that the serializer should treat the output as a standalone document.\n+     * The JDK specific standalone property controls whether a newline should be\n+     * added after the XML header.\n+     *\n+     * @see similar property ORACLE_IS_STANDALONE in OutputPropertiesFactory.\n+     *\/\n+    public static final String S_IS_STANDALONE = \"isStandalone\";\n+\n+    \/\/ Fully-qualified property name with the JDK Impl prefix\n+    public static final String FQ_IS_STANDALONE =\n+            Constants.ORACLE_JAXP_PROPERTY_PREFIX + S_IS_STANDALONE;\n+\n+    \/\/ The property with namespace as the internal DOMConfiguration format\n+    public static final String NS_IS_STANDALONE = S_JDK_PROPERTIES_NS + S_IS_STANDALONE;\n+\n+    \/\/ Corresponding System property\n+    public static final String SP_IS_STANDALONE = \"jdk.xml.isStandalone\";\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/dom3\/DOMConstants.java","additions":29,"deletions":3,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+import com.sun.org.apache.xerces.internal.impl.Constants;\n@@ -36,1 +37,1 @@\n-\n+import jdk.xml.internal.SecuritySupport;\n@@ -162,0 +163,4 @@\n+\n+    \/\/ Parameter is-standalone, jdk specific, not required\n+    private final static int IS_STANDALONE = 0x1 << 19;\n+\n@@ -185,0 +190,1 @@\n+            DOMConstants.FQ_IS_STANDALONE,\n@@ -354,0 +360,14 @@\n+        \/\/ JDK specific property isStandalone\n+        String p = SecuritySupport.getSystemProperty(DOMConstants.SP_IS_STANDALONE);\n+        if (p == null || p.isEmpty()) {\n+            p = SecuritySupport.readJAXPProperty(DOMConstants.SP_IS_STANDALONE);\n+        }\n+        \/\/ the system property is true only if it is \"true\" and false otherwise\n+        if (p != null && p.equals(\"true\")) {\n+            fFeatures |= IS_STANDALONE;\n+            fDOMConfigProperties.setProperty(DOMConstants.NS_IS_STANDALONE,\n+                    DOMConstants.DOM3_EXPLICIT_TRUE);\n+        } else {\n+            fDOMConfigProperties.setProperty(DOMConstants.NS_IS_STANDALONE,\n+                    DOMConstants.DOM3_DEFAULT_FALSE);\n+        }\n@@ -381,1 +401,2 @@\n-                    || name.equalsIgnoreCase(DOMConstants.DOM_XMLDECL)){\n+                    || name.equalsIgnoreCase(DOMConstants.DOM_XMLDECL)\n+                    || name.equalsIgnoreCase(DOMConstants.FQ_IS_STANDALONE)){\n@@ -393,1 +414,1 @@\n-                return !((Boolean)value).booleanValue();\n+                return !((Boolean)value);\n@@ -397,1 +418,1 @@\n-                return ((Boolean)value).booleanValue();\n+                return ((Boolean)value);\n@@ -439,0 +460,2 @@\n+        } else if (name.equalsIgnoreCase(DOMConstants.FQ_IS_STANDALONE)) {\n+            return ((fFeatures & IS_STANDALONE) != 0) ? Boolean.TRUE : Boolean.FALSE;\n@@ -609,0 +632,4 @@\n+            } else if (name.equalsIgnoreCase(DOMConstants.FQ_IS_STANDALONE)) {\n+                fFeatures = state ? fFeatures | IS_STANDALONE : fFeatures & ~IS_STANDALONE;\n+                fDOMConfigProperties.setProperty(DOMConstants.NS_IS_STANDALONE, state ? \"yes\" : \"no\");\n+\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xml\/internal\/serializer\/dom3\/LSSerializerImpl.java","additions":31,"deletions":4,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,230 @@\n+ * @implNote\n+ * <h2>Implementation Specific Features and Properties<\/h2>\n+ *\n+ * In addition to the standard features and properties described within the public\n+ * APIs of this module, the JDK implementation supports a further number of\n+ * implementation specific features and properties. This section describes the\n+ * naming convention, System Properties, jaxp.properties, scope and order,\n+ * and processors to which a property applies. A table listing the implementation\n+ * specific features and properties which the implementation currently supports\n+ * can be found at the end of this note.\n+ *\n+ * <h3>Naming Convention<\/h3>\n+ * The names of the features and properties are fully qualified, composed of a\n+ * prefix and name.\n+ * <p>\n+ * <h4>Prefix<\/h4>\n+ * The prefix for JDK properties is defined as:\n+ * <pre>\n+ *     {@code http:\/\/www.oracle.com\/xml\/jaxp\/properties\/}\n+ * <\/pre>\n+ *\n+ * The prefix for features:\n+ * <pre>\n+ *     {@code http:\/\/www.oracle.com\/xml\/jaxp\/features\/}\n+ * <\/pre>\n+ *\n+ * The prefix for System Properties:\n+ * <pre>\n+ *     {@code jdk.xml.}\n+ * <\/pre>\n+ * <p>\n+ * <h4>Name<\/h4>\n+ * A name may consist of one or multiple words that are case-sensitive.\n+ * All letters of the first word are in lowercase, while the first letter of\n+ * each subsequent word is capitalized.\n+ * <p>\n+ * An example of a property that indicates whether an XML document is standalone\n+ * would thus have a format:\n+ * <pre>\n+ *     {@code http:\/\/www.oracle.com\/xml\/jaxp\/properties\/isStandalone}\n+ * <\/pre>\n+ * and a corresponding System Property:\n+ * <pre>\n+ *     {@systemProperty jdk.xml.isStandalone}\n+ * <\/pre>\n+ *\n+ * <h3>System Properties<\/h3>\n+ * A property may have a corresponding System Property that has the same name\n+ * except for the prefix as shown above. A System Property should be set prior\n+ * to the creation of a processor and may be cleared afterwards.\n+ *\n+ * <h3>jaxp.properties<\/h3>\n+ * A system property can be specified in the {@code jaxp.properties} file to\n+ * set the behavior for all invocations of the JDK. The format is\n+ * {@code system-property-name=value}. For example:\n+ * <pre>\n+ *     {@code jdk.xml.isStandalone=true}\n+ * <\/pre>\n+ * <p>\n+ * For details about the JAXP configuration file {@code jaxp.properties}, refer to\n+ * {@link javax.xml.parsers.SAXParserFactory#newInstance() SAXParserFactory#newInstance}.\n+ *\n+ * <h3 id=\"ScopeAndOrder\">Scope and Order<\/h3>\n+ * The {@link javax.xml.XMLConstants#FEATURE_SECURE_PROCESSING} feature\n+ * (hereafter referred to as secure processing) is required for XML processors\n+ * including DOM, SAX, Schema Validation, XSLT, and XPath. Any properties flagged\n+ * as {@code \"security: yes\"} (hereafter referred to as security properties) in\n+ * table <a href=\"#FeaturesAndProperties\">Features And Properties<\/a>\n+ * are enforced when secure processing is set to true. Such enforcement includes\n+ * setting security features to true and limits to the defined values shown in\n+ * the table. The property values will not be affected, however, when setting\n+ * secure processing to false.\n+ * <p>\n+ * When the Java Security Manager is present, secure processing is set to true\n+ * and can not be turned off. The security properties are therefore enforced.\n+ * <p>\n+ * Properties specified in the jaxp.properties file affect all invocations of\n+ * the JDK, and will override their default values, or those that may have been\n+ * set by secure processing.\n+ * <p>\n+ * System properties, when set, affect the invocation of the JDK and override\n+ * the default settings or those that may have been set in jaxp.properties or\n+ * by secure processing.\n+ * <p>\n+ * JAXP properties specified through JAXP factories or processors (e.g. SAXParser)\n+ * take preference over system properties, the jaxp.properties file, as well as\n+ * secure processing.\n+ * <p>\n+ *\n+ * <h3 id=\"Processor\">Processor Support<\/h3>\n+ * Features and properties may be supported by one or more processors. The\n+ * following table lists the processors by IDs that can be used for reference.\n+ * <p>\n+ *\n+ * <table class=\"plain\" id=\"Processors\">\n+ * <caption>Processors<\/caption>\n+ * <thead>\n+ * <tr>\n+ * <th scope=\"col\">ID<\/th>\n+ * <th scope=\"col\">Name<\/th>\n+ * <th scope=\"col\">How to set the property<\/th>\n+ * <\/tr>\n+ * <\/thead>\n+ *\n+ * <tbody>\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"DOM\">DOM<\/th>\n+ * <td>DOM Parser<\/td>\n+ * <td>\n+ * {@code DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();}<br>\n+ * {@code dbf.setAttribute(name, value);}\n+ * <\/td>\n+ * <\/tr>\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"SAX\">SAX<\/th>\n+ * <td>SAX Parser<\/td>\n+ * <td>\n+ * {@code SAXParserFactory spf = SAXParserFactory.newInstance();}<br>\n+ * {@code SAXParser parser = spf.newSAXParser();}<br>\n+ * {@code parser.setProperty(name, value);}\n+ * <\/td>\n+ * <\/tr>\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"StAX\">StAX<\/th>\n+ * <td>StAX Parser<\/td>\n+ * <td>\n+ * {@code XMLInputFactory xif = XMLInputFactory.newInstance();}<br>\n+ * {@code xif.setProperty(name, value);}\n+ * <\/td>\n+ * <\/tr>\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"Validation\">Validation<\/th>\n+ * <td>XML Validation API<\/td>\n+ * <td>\n+ * {@code SchemaFactory schemaFactory = SchemaFactory.newInstance(schemaLanguage);}<br>\n+ * {@code schemaFactory.setProperty(name, value);}\n+ * <\/td>\n+ * <\/tr>\n+ * <\/tr>\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"Transform\">Transform<\/th>\n+ * <td>XML Transform API<\/td>\n+ * <td>\n+ * {@code TransformerFactory factory = TransformerFactory.newInstance();}<br>\n+ * {@code factory.setAttribute(name, value);}\n+ * <\/td>\n+ * <\/tr>\n+ * <\/tr>\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"DOMLS\">DOMLS<\/th>\n+ * <td>DOM Load and Save<\/td>\n+ * <td>\n+ * {@code LSSerializer serializer = domImplementation.createLSSerializer();} <br>\n+ * {@code serializer.getDomConfig().setParameter(name, value);}\n+ * <\/td>\n+ * <\/tr>\n+ * <\/tbody>\n+ * <\/table>\n+ *\n+ * <p>\n+ * <h3>Implementation Specific Features and Properties<\/h3>\n+ * This section lists features and properties supported by the JDK implementation.\n+ *\n+ * <p>\n+ * <table class=\"plain\" id=\"FeaturesAndProperties\">\n+ * <caption>Features and Properties<\/caption>\n+ * <thead>\n+ * <tr>\n+ * <th scope=\"col\" rowspan=\"2\">Name [1]<\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Description<\/th>\n+ * <th scope=\"col\" rowspan=\"2\">System Property [2]<\/th>\n+ * <th scope=\"col\" rowspan=\"2\">jaxp.properties [2]<\/th>\n+ * <th scope=\"col\" colspan=\"3\" style=\"text-align:center\">Value [3]<\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Security [4]<\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Supported Processor [5]<\/th>\n+ * <th scope=\"col\" rowspan=\"2\">Since [6]<\/th>\n+ * <\/tr>\n+ * <tr>\n+ * <th scope=\"col\">Type<\/th>\n+ * <th scope=\"col\">Value<\/th>\n+ * <th scope=\"col\">Default<\/th>\n+ * <\/tr>\n+ * <\/thead>\n+ *\n+ * <tbody>\n+ *\n+ * <tr>\n+ * <th scope=\"row\" style=\"font-weight:normal\" id=\"ISSTANDALONE\">isStandalone<\/th>\n+ * <td>indicates that the serializer should treat the output as a\n+ * standalone document. The property can be used to ensure a newline is written\n+ * after the XML declaration when the property\n+ * {@link org.w3c.dom.ls.LSSerializer#getDomConfig() format-pretty-print} is set\n+ * to true. Unlike the property\n+ * {@link org.w3c.dom.ls.LSSerializer#getDomConfig() xml-declaration}, this property\n+ * does not have an effect on whether an XML declaration should be written out.\n+ * <\/td>\n+ * <td>yes<\/td>\n+ * <td>yes<\/td>\n+ * <td>boolean<\/td>\n+ * <th id=\"Value\" scope=\"row\" style=\"font-weight:normal\">true\/false<\/th>\n+ * <th id=\"Default\" scope=\"row\" style=\"font-weight:normal\">false<\/th>\n+ * <td>No<\/td>\n+ * <td><a href=\"#DOMLS\">DOMLS<\/a><\/td>\n+ * <td>17<\/td>\n+ * <\/tr>\n+ * <\/tbody>\n+ * <\/table>\n+ * <p>\n+ * <b>[1]<\/b> The name of a property. The fully-qualified name, prefix + name,\n+ * should be used when setting the property.\n+ * <p>\n+ * <b>[2]<\/b> A value \"yes\" indicates there is a corresponding System Property\n+ * for the property, \"no\" otherwise.\n+ *\n+ * <p>\n+ * <b>[3]<\/b> The value must be exactly as listed in this table, case-sensitive.\n+ * The value type for the corresponding System Property is String. For boolean\n+ * type, the system property is true only if it is \"true\" and false otherwise.\n+ * <p>\n+ * <b>[4]<\/b> A value \"yes\" indicates the property is a Security Property. Refer\n+ * to the <a href=\"#ScopeAndOrder\">Scope and Order<\/a> on how secure processing\n+ * may affect the value of a Security Property.\n+ * <p>\n+ * <b>[5]<\/b> One or more processors that support the property. The values of the\n+ * field are IDs described in table <a href=\"#Processor\">Processors<\/a>.\n+ * <p>\n+ * <b>[6]<\/b> Indicates the initial release the property is introduced.\n+ *\n+ *\n+ *\n","filename":"src\/java.xml\/share\/classes\/module-info.java","additions":231,"deletions":1,"binary":false,"changes":232,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,3 @@\n+import static jaxp.library.JAXPTestUtilities.clearSystemProperty;\n+import static jaxp.library.JAXPTestUtilities.setSystemProperty;\n+\n@@ -33,0 +36,2 @@\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n@@ -51,0 +56,1 @@\n+import org.w3c.dom.Element;\n@@ -63,1 +69,1 @@\n- * @bug 6439439 8087303 8174025\n+ * @bug 6439439 8087303 8174025 8249867\n@@ -71,0 +77,9 @@\n+    private static final String DOM_FORMAT_PRETTY_PRINT = \"format-pretty-print\";\n+    private static final String JDK_IS_STANDALONE =\n+            \"http:\/\/www.oracle.com\/xml\/jaxp\/properties\/isStandalone\";\n+    private static final String SP_JDK_IS_STANDALONE = \"jdk.xml.isStandalone\";\n+    private static final String XML_LB\n+            = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<sometag\/>\\n\";\n+    private static final String XML_NOLB\n+            = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><sometag\/>\\n\";\n+\n@@ -86,0 +101,76 @@\n+    \/*\n+     * Bug: 8249867\n+     * DataProvider: for testing the isStandalone property\n+     * Data columns: property, system property, value, expected result\n+     *\/\n+    @DataProvider(name = \"setting\")\n+    Object[][] getData() throws Exception {\n+        return new Object[][]{\n+            {false, true, true, XML_LB},   \/\/set System property\n+            {false, true, false, XML_NOLB},\/\/set System property\n+            {true, false, true, XML_LB},   \/\/set property\n+            {true, false, false, XML_NOLB},\/\/set property\n+            {false, false, false, XML_NOLB} \/\/default\n+        };\n+    }\n+\n+    \/*\n+     * Bug: 8249867\n+     * DataProvider: for verifying the System property\n+     * Data columns: value for system property, expected result\n+     *\/\n+    @DataProvider(name = \"SP\")\n+    Object[][] getSystemProperty() throws Exception {\n+        return new Object[][]{\n+            \/\/ the system property is true only if it is \"true\" and false otherwise\n+            {\"true\", true},\n+            {\"false\", false},\n+            {\"yes\", false},\n+            {\"\", false},\n+        };\n+    }\n+\n+    \/*\n+     * Bug: 8249867\n+     * Verifies the use of the new property \"isStandalone\" and the\n+     * corresponding System property \"jdk.xml.isStandalone\".\n+     *\/\n+    @Test(dataProvider = \"setting\")\n+    public void test(boolean p, boolean sp, boolean val, String expected)\n+            throws Exception {\n+        if (sp) {\n+            setSystemProperty(SP_JDK_IS_STANDALONE, Boolean.toString(val));\n+        }\n+        Document document = getDocument();\n+        DOMImplementationLS impl = (DOMImplementationLS)document.getImplementation();\n+        LSSerializer ser = impl.createLSSerializer();\n+        ser.getDomConfig().setParameter(\"format-pretty-print\", true);\n+        if (p && !sp) {\n+            ser.getDomConfig().setParameter(JDK_IS_STANDALONE, val);\n+        }\n+        if (sp) {\n+            clearSystemProperty(SP_JDK_IS_STANDALONE);\n+        }\n+        final StringWriter writer = new StringWriter();\n+        final LSOutput output = impl.createLSOutput();\n+        output.setCharacterStream(writer);\n+        ser.write(document, output);\n+        String result = writer.toString();\n+\n+        Assert.assertEquals(result, expected);\n+    }\n+\n+    \/*\n+     * Bug: 8249867\n+     * Verifies the definition of the System property \"jdk.xml.isStandalone\".\n+     * The system property is true only if it is \"true\" and false otherwise.\n+     *\/\n+    @Test(dataProvider = \"SP\")\n+    public void testSP(String value, boolean expected) throws Exception {\n+        setSystemProperty(SP_JDK_IS_STANDALONE, value);\n+        DOMConfiguration c = getConfig();\n+        clearSystemProperty(SP_JDK_IS_STANDALONE);\n+\n+        Assert.assertEquals(c.getParameter(JDK_IS_STANDALONE), expected);\n+    }\n+\n@@ -93,1 +184,2 @@\n-    public void testXMLPrettyPrint(String sourceFile, String expectedFile) throws Exception {\n+    public void testXMLPrettyPrint(String sourceFile, String expectedFile)\n+            throws Exception {\n@@ -98,1 +190,2 @@\n-        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)), \"The actual is: \" + result);\n+        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)),\n+                \"The actual is: \" + result);\n@@ -103,1 +196,2 @@\n-        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)), \"The actual is: \" + result);\n+        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)),\n+                \"The actual is: \" + result);\n@@ -105,1 +199,2 @@\n-        assertEquals(transform(toXmlDocument(source), true).replaceAll(\"\\r\\n\", \"\\n\"), expected);\n+        assertEquals(transform(toXmlDocument(source), true).replaceAll(\"\\r\\n\", \"\\n\"),\n+                expected);\n@@ -167,1 +262,2 @@\n-    public void testWhitespaceWithLSSerializer(String sourceFile, String expectedFile) throws Exception {\n+    public void testWhitespaceWithLSSerializer(String sourceFile, String expectedFile)\n+            throws Exception {\n@@ -172,1 +268,2 @@\n-        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)), \"The actual is: \" + result);\n+        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)),\n+                \"The actual is: \" + result);\n@@ -194,1 +291,2 @@\n-    public void testWhitespaceWithTransformer(String sourceFile, String expectedFile) throws Exception {\n+    public void testWhitespaceWithTransformer(String sourceFile, String expectedFile)\n+            throws Exception {\n@@ -199,1 +297,2 @@\n-        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)), \"The actual is: \" + result);\n+        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(result)),\n+                \"The actual is: \" + result);\n@@ -201,1 +300,2 @@\n-        assertEquals(transform(toXmlDocument(source), true).replaceAll(\"\\r\\n\", \"\\n\"), expected);\n+        assertEquals(transform(toXmlDocument(source), true).replaceAll(\"\\r\\n\", \"\\n\"),\n+                expected);\n@@ -226,1 +326,2 @@\n-    public void testTransformToHTML(String sourceFile, String expectedFile) throws Exception {\n+    public void testTransformToHTML(String sourceFile, String expectedFile)\n+            throws Exception {\n@@ -231,2 +332,4 @@\n-        getTransformer(true, false).transform(new StreamSource(new StringReader(source)), new StreamResult(writer));\n-        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(writer.toString())), \"The actual is: \" + writer.toString());\n+        getTransformer(true, false).transform(\n+                new StreamSource(new StringReader(source)), new StreamResult(writer));\n+        assertTrue(toXmlDocument(source).isEqualNode(toXmlDocument(writer.toString())),\n+                \"The actual is: \" + writer.toString());\n@@ -236,1 +339,2 @@\n-        getTransformer(true, true).transform(new StreamSource(new StringReader(source)), new StreamResult(writer));\n+        getTransformer(true, true).transform(\n+                new StreamSource(new StringReader(source)), new StreamResult(writer));\n@@ -251,1 +355,2 @@\n-        Transformer transformer = factory.newTemplates(new StreamSource(new StringReader(read(xsl)))).newTransformer();\n+        Transformer transformer = factory.newTemplates(\n+                new StreamSource(new StringReader(read(xsl)))).newTransformer();\n@@ -257,1 +362,2 @@\n-        transformer.transform(new StreamSource(new StringReader(read(xml))), new StreamResult(writer));\n+        transformer.transform(new StreamSource(new StringReader(read(xml))),\n+                new StreamResult(writer));\n@@ -265,1 +371,2 @@\n-                + \"<hello>before child element<child><children\/><children\/><\/child>after child element<\/hello>\";\n+                + \"<hello>before child element<child><children\/><children\/><\/child>\"\n+                + \"after child element<\/hello>\";\n@@ -276,1 +383,2 @@\n-        final String XML_DOCUMENT_PRETTY_PRINT = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-16\\\"?><hello>\\n\" +\n+        final String XML_DOCUMENT_PRETTY_PRINT =\n+                \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-16\\\"?><hello>\\n\" +\n@@ -313,1 +421,2 @@\n-        System.out.println(\"Serializer is: \" + lsSerializer.getClass().getName() + \" \" + lsSerializer);\n+        System.out.println(\"Serializer is: \" + lsSerializer.getClass().getName()\n+                + \" \" + lsSerializer);\n@@ -319,5 +428,9 @@\n-        Boolean defaultFormatPrettyPrint = (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT);\n-        Boolean canSetFormatPrettyPrintFalse = (Boolean) domConfiguration.canSetParameter(DOM_FORMAT_PRETTY_PRINT, Boolean.FALSE);\n-        Boolean canSetFormatPrettyPrintTrue = (Boolean) domConfiguration.canSetParameter(DOM_FORMAT_PRETTY_PRINT, Boolean.TRUE);\n-\n-        System.out.println(DOM_FORMAT_PRETTY_PRINT + \" default\/can set false\/can set true = \" + defaultFormatPrettyPrint + \"\/\"\n+        Boolean defaultFormatPrettyPrint =\n+                (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT);\n+        Boolean canSetFormatPrettyPrintFalse =\n+                (Boolean) domConfiguration.canSetParameter(DOM_FORMAT_PRETTY_PRINT, Boolean.FALSE);\n+        Boolean canSetFormatPrettyPrintTrue =\n+                (Boolean) domConfiguration.canSetParameter(DOM_FORMAT_PRETTY_PRINT, Boolean.TRUE);\n+\n+        System.out.println(DOM_FORMAT_PRETTY_PRINT + \" default\/can set false\/can set true = \"\n+                + defaultFormatPrettyPrint + \"\/\"\n@@ -327,1 +440,2 @@\n-        assertEquals(defaultFormatPrettyPrint, Boolean.FALSE, \"Default value of \" + DOM_FORMAT_PRETTY_PRINT + \" should be \" + Boolean.FALSE);\n+        assertEquals(defaultFormatPrettyPrint, Boolean.FALSE,\n+                \"Default value of \" + DOM_FORMAT_PRETTY_PRINT + \" should be \" + Boolean.FALSE);\n@@ -329,1 +443,2 @@\n-        assertEquals(canSetFormatPrettyPrintFalse, Boolean.TRUE, \"Can set \" + DOM_FORMAT_PRETTY_PRINT + \" to \" + Boolean.FALSE + \" should be \"\n+        assertEquals(canSetFormatPrettyPrintFalse, Boolean.TRUE,\n+                \"Can set \" + DOM_FORMAT_PRETTY_PRINT + \" to \" + Boolean.FALSE + \" should be \"\n@@ -332,1 +447,2 @@\n-        assertEquals(canSetFormatPrettyPrintTrue, Boolean.TRUE, \"Can set \" + DOM_FORMAT_PRETTY_PRINT + \" to \" + Boolean.TRUE + \" should be \"\n+        assertEquals(canSetFormatPrettyPrintTrue, Boolean.TRUE,\n+                \"Can set \" + DOM_FORMAT_PRETTY_PRINT + \" to \" + Boolean.TRUE + \" should be \"\n@@ -337,1 +453,2 @@\n-        System.out.println(\"(default) \" + DOM_FORMAT_PRETTY_PRINT + \"==\" + (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT)\n+        System.out.println(\"(default) \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n+                + (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT)\n@@ -340,1 +457,2 @@\n-        assertEquals(prettyPrintDefault, XML_DOCUMENT_DEFAULT_PRINT, \"Invalid serialization with default value, \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n+        assertEquals(prettyPrintDefault, XML_DOCUMENT_DEFAULT_PRINT,\n+                \"Invalid serialization with default value, \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n@@ -346,1 +464,2 @@\n-        System.out.println(\"(FALSE) \" + DOM_FORMAT_PRETTY_PRINT + \"==\" + (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT)\n+        System.out.println(\"(FALSE) \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n+                + (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT)\n@@ -349,1 +468,2 @@\n-        assertEquals(prettyPrintFalse, XML_DOCUMENT_DEFAULT_PRINT, \"Invalid serialization with FALSE value, \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n+        assertEquals(prettyPrintFalse, XML_DOCUMENT_DEFAULT_PRINT,\n+                \"Invalid serialization with FALSE value, \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n@@ -355,1 +475,2 @@\n-        System.out.println(\"(TRUE) \" + DOM_FORMAT_PRETTY_PRINT + \"==\" + (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT)\n+        System.out.println(\"(TRUE) \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n+                + (Boolean) domConfiguration.getParameter(DOM_FORMAT_PRETTY_PRINT)\n@@ -358,1 +479,2 @@\n-        assertEquals(prettyPrintTrue, XML_DOCUMENT_PRETTY_PRINT, \"Invalid serialization with TRUE value, \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n+        assertEquals(prettyPrintTrue, XML_DOCUMENT_PRETTY_PRINT,\n+                \"Invalid serialization with TRUE value, \" + DOM_FORMAT_PRETTY_PRINT + \"==\"\n@@ -364,1 +486,2 @@\n-        DOMImplementationLS domImplementation = (DOMImplementationLS) registry.getDOMImplementation(\"LS\");\n+        DOMImplementationLS domImplementation =\n+                (DOMImplementationLS) registry.getDOMImplementation(\"LS\");\n@@ -461,1 +584,0 @@\n-\n@@ -468,1 +590,19 @@\n-    private static final String DOM_FORMAT_PRETTY_PRINT = \"format-pretty-print\";\n+    private Document getDocument() throws Exception {\n+        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+        DocumentBuilder builder = factory.newDocumentBuilder();\n+        Document document = builder.newDocument();\n+\n+        Element child = document.createElement(\"sometag\");\n+        document.appendChild(child);\n+        return document;\n+    }\n+\n+    private DOMImplementationLS getImpl() throws Exception {\n+        Document document = getDocument();\n+        return (DOMImplementationLS)document.getImplementation();\n+    }\n+\n+    private DOMConfiguration getConfig() throws Exception {\n+        LSSerializer ser = getImpl().createLSSerializer();\n+        return ser.getDomConfig();\n+    }\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/prettyprint\/PrettyPrintTest.java","additions":177,"deletions":37,"binary":false,"changes":214,"status":"modified"}]}