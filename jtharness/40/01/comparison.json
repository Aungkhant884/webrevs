{"files":[{"patch":"@@ -61,0 +61,2 @@\n+import java.util.Objects;\n+import java.util.concurrent.ConcurrentHashMap;\n@@ -97,1 +99,0 @@\n-    static Map<String, WorkDirLogHandler> handlersMap = new HashMap<>();\n@@ -1482,1 +1483,2 @@\n-        private String logFileName;\n+        private static final Map<String, WorkDirLogHandler> handlersMap = new ConcurrentHashMap<>();\n+        private final String logFileName;\n@@ -1488,8 +1490,10 @@\n-            if (wd != null) {\n-                if (!handlersMap.containsKey(wd.getLogFileName())) {\n-                    WorkDirLogHandler wdlh = new WorkDirLogHandler(ts.getObservedFile(wd));\n-                    handlersMap.put(wd.getLogFileName(), wdlh);\n-                }\n-\n-                addHandler(handlersMap.get(wd.getLogFileName()));\n-            }\n+            addHandler(\n+                    handlersMap.computeIfAbsent(logFileName, fileName -> {\n+                                ObservedFile observedFile = ts.getObservedFile(wd);\n+                                Objects.requireNonNull(observedFile,\n+                                        \"Method TestSuite.getObservedFile(WorkDirectory) returned 'null' \"\n+                                                + \"when called on test suite \" + ts + \", passing work directory \" + wd);\n+                                return new WorkDirLogHandler(observedFile);\n+                            }\n+                    )\n+            );\n","filename":"src\/com\/sun\/javatest\/TestSuite.java","additions":14,"deletions":10,"binary":false,"changes":24,"status":"modified"}]}