[{"commit":{"message":"Fix NullPointerException on a parallel run\n\nError: Unexpected exception occurred! java.lang.NullPointerException\njava.lang.NullPointerException\n\tat com.sun.javatest.regtest.config.TestProperties$Cache.getEntryInternal(TestProperties.java:515)\n\tat com.sun.javatest.regtest.config.TestProperties$Cache.getEntryInternal(TestProperties.java:515)\n\tat com.sun.javatest.regtest.config.TestProperties$Cache.getEntry(TestProperties.java:502)\n\tat com.sun.javatest.regtest.config.TestProperties.getEntry(TestProperties.java:170)\n\tat com.sun.javatest.regtest.config.TestProperties.getTestNGRoot(TestProperties.java:123)\n\tat com.sun.javatest.regtest.config.RegressionTestFinder.scanFile(RegressionTestFinder.java:143)\n\tat com.sun.javatest.finder.TagTestFinder.scan(TagTestFinder.java:115)\n\tat com.sun.javatest.TestFinder.read(TestFinder.java:433)\n\tat com.sun.javatest.TRT_TreeNode.processFile(TRT_TreeNode.java:1259)\n\tat com.sun.javatest.TRT_TreeNode.scanIfNeeded(TRT_TreeNode.java:807)\n\tat com.sun.javatest.TRT_TreeNode.getTreeNode(TRT_TreeNode.java:616)\n\tat com.sun.javatest.TestResultTable.findNode(TestResultTable.java:400)\n\tat com.sun.javatest.TestResultTable.lookupNode(TestResultTable.java:533)\n\tat com.sun.javatest.TestResultTable.lookupInitURL(TestResultTable.java:571)\n\tat com.sun.javatest.TestResultTable.validatePath(TestResultTable.java:1000)\n\tat com.sun.javatest.regtest.config.TestManager.validatePath(TestManager.java:299)\n\tat com.sun.javatest.regtest.config.TestManager.getTests(TestManager.java:271)\n\tat com.sun.javatest.regtest.tool.Tool.createParameters(Tool.java:1659)\n\tat com.sun.javatest.regtest.tool.Tool.run(Tool.java:1293)\n\tat com.sun.javatest.regtest.tool.Tool.run(Tool.java:1082)\n\tat com.sun.javatest.regtest.tool.Tool.main(Tool.java:155)\n\tat com.sun.javatest.regtest.Main.main(Main.java:46)\n\nSome debug output showing the problem:\n\tscanIfNeeded getRootRelativePath= separator=\/ filesToScan[i]=resultdir\n\tprocessFile file=\/resultdir isAbsolute=true\n\tTestFinder.java read file=\/resultdir isAbsolute=true\n\tscanFile caller file=\/resultdir\n\tscanFile File=\/resultdir\n\tTestProperties.java:dir=\/ rootDir=\/home\/azul\/azul\/zulu11-git\/test\/hotspot\/jtreg file2=\/resultdir file2.getParentFile()=\/\n\tTestProperties.java:dir=null rootDir=\/home\/azul\/azul\/zulu11-git\/test\/hotspot\/jtreg file2=\/resultdir file2.getParentFile()=\/\n\nThis happens with jtreg using -w:resultdir . getRootRelativePath()\nreturns empty \"\" path. Other option would be to return \".\" but in such\ncase it broke some other code.\n\nThis problem does not happen during a single run. It happens only when\njtreg is being run in parallel, in my case:\n\tseq 1 100000|xargs -n1 -P64 .\/runtest\n\t#! \/bin\/bash\n\tdir=result-test$$\n\trm -rf $dir\n\tmkdir $dir\n\tset -o pipefail\n\t(JAVA_HOME=$HOME\/azul\/zulu11-git\/build\/linux-x86_64-normal-server-release\/images\/jdk\/; $JAVA_HOME\/bin\/java -classpath $HOME\/azul\/jtreg\/build\/images\/jtreg\/lib\/jtreg.jar:$HOME\/azul\/jtreg\/build\/images\/jtreg\/lib\/javatest.jar:$HOME\/azul\/jtreg\/build\/images\/jtreg\/lib\/asmtools.jar com.sun.javatest.regtest.Main -testjdk:$JAVA_HOME -othervm -verbose -ignore:quiet -retain:all -a -conc:1 -timeout:10 -vmoptions:-XX:+UnlockExperimentalVMOptions -w:$dir -noreport -dir:$JAVA_HOME\/..\/..\/..\/..\/test\/jdk\/ -nativepath:$JAVA_HOME\/..\/test\/hotspot\/jtreg\/native ..\/hotspot\/jtreg\/vmTestbase\/nsk\/jdi\/stress\/serial\/heapwalking001\/TestDescription.java |& tee $dir\/err) || exit 255\n\trm -rf $dir"},"files":[{"filename":"src\/com\/sun\/javatest\/TRT_TreeNode.java"}],"sha":"1eeeb9641b1dc7a0baf05e7e344ed1737f6c248b"}]