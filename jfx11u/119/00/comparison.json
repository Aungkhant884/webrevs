{"files":[{"patch":"@@ -3343,0 +3343,1 @@\n+            media name: \"ffmpeg-5.1.2\", ext: \"tar.gz\"\n@@ -3491,1 +3492,3 @@\n-                                                      \"vdpau.h\", \"version.h\", \"xvmc.h\", \"old_codec_ids.h\")\n+                                                      \"vdpau.h\", \"version.h\", \"xvmc.h\", \"old_codec_ids.h\",\n+                                                      \"codec.h\", \"codec_desc.h\", \"codec_par.h\", \"codec_id.h\",\n+                                                      \"defs.h\", \"packet.h\", \"version_major.h\")\n@@ -3494,1 +3497,1 @@\n-                    FileCollection libavformat = files(\"avformat.h\", \"avio.h\", \"version.h\")\n+                    FileCollection libavformat = files(\"avformat.h\", \"avio.h\", \"version.h\", \"version_major.h\")\n@@ -3507,1 +3510,1 @@\n-                    FileCollection libswscale = files(\"swscale.h\", \"version.h\")\n+                    FileCollection libswscale = files(\"swscale.h\", \"version.h\", \"version_major.h\")\n@@ -3687,2 +3690,2 @@\n-                        project.ext.libav.versions = [ \"3.3.3\", \"4.0.2\" ]\n-                        project.ext.libav.versionmap = [ \"3.3.3\" : \"57\", \"4.0.2\" : \"58\" ]\n+                        project.ext.libav.versions = [ \"3.3.3\", \"4.0.2\", \"5.1.2\" ]\n+                        project.ext.libav.versionmap = [ \"3.3.3\" : \"57\", \"4.0.2\" : \"58\", \"5.1.2\" : \"59\" ]\n@@ -3768,1 +3771,1 @@\n-                            project.ext.libav.ffmpeg.versions = [ \"57\", \"58\" ]\n+                            project.ext.libav.ffmpeg.versions = [ \"57\", \"58\", \"59\" ]\n","filename":"build.gradle","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -127,0 +127,1 @@\n+                    dependencies.add(\"avplugin-ffmpeg-59\");\n","filename":"modules\/javafx.media\/src\/main\/java\/com\/sun\/media\/jfxmediaimpl\/NativeMediaManager.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -149,1 +149,1 @@\n-static const int AVCODEC_EXPLICIT_VERSIONS[] = { 57, 58 };\n+static const int AVCODEC_EXPLICIT_VERSIONS[] = { 57, 58, 59 };\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/gstreamer-lite\/gstreamer\/gst\/gstregistry.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -127,1 +127,1 @@\n-#if DECODE_AUDIO4\n+#if DECODE_AUDIO4 || USE_SEND_RECEIVE\n@@ -193,1 +193,1 @@\n-#if !DECODE_AUDIO4\n+#if !DECODE_AUDIO4 && !USE_SEND_RECEIVE\n@@ -228,1 +228,1 @@\n-#if !DECODE_AUDIO4\n+#if !DECODE_AUDIO4 && !USE_SEND_RECEIVE\n@@ -655,1 +655,1 @@\n-#if DECODE_AUDIO4\n+#if DECODE_AUDIO4 || USE_SEND_RECEIVE\n@@ -718,1 +718,11 @@\n-#if DECODE_AUDIO4\n+#if USE_SEND_RECEIVE\n+    num_dec = avcodec_send_packet(base->context, &decoder->packet);\n+    if (num_dec == 0)\n+    {\n+        num_dec = avcodec_receive_frame(base->context, base->frame);\n+        if (num_dec == 0)\n+        {\n+            got_frame = 1;\n+        }\n+    }\n+#elif DECODE_AUDIO4\n@@ -725,1 +735,1 @@\n-#if DECODE_AUDIO4\n+#if DECODE_AUDIO4 || USE_SEND_RECEIVE\n@@ -738,1 +748,1 @@\n-#if DECODE_AUDIO4\n+#if DECODE_AUDIO4 || USE_SEND_RECEIVE\n@@ -773,1 +783,1 @@\n-#if DECODE_AUDIO4\n+#if DECODE_AUDIO4 || USE_SEND_RECEIVE\n@@ -882,1 +892,1 @@\n-#if DECODE_AUDIO4\n+#if DECODE_AUDIO4 || USE_SEND_RECEIVE\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/plugins\/av\/audiodecoder.c","additions":20,"deletions":10,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,1 +56,1 @@\n-#if !DECODE_AUDIO4\n+#if !DECODE_AUDIO4 && !USE_SEND_RECEIVE\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/plugins\/av\/audiodecoder.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,2 +30,2 @@\n-\/\/ _decode_audio4  in version 53.25.0\n-#define DECODE_AUDIO4          (LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(53,25,0))\n+\/\/ _decode_audio4 in version 53.25.0 and removed in version 59\n+#define DECODE_AUDIO4          (LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(53,25,0) && LIBAVCODEC_VERSION_INT < AV_VERSION_INT(59,0,0))\n@@ -39,0 +39,14 @@\n+\n+\/\/ \"codec\" field was removed from AVStream in 59 and \"codecpar\" should be used\n+\/\/ instead.\n+#define CODEC_PAR              (LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(59,0,0))\n+\n+\/\/ Use \"av_packet_unref()\"\n+#define PACKET_UNREF           (LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(59,0,0))\n+\n+\/\/ Use \"avcodec_send_packet()\" and \"avcodec_receive_frame()\"\n+#define USE_SEND_RECEIVE       (LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(59,0,0))\n+\n+\/\/ Do not call avcodec_register_all() and av_register_all()\n+\/\/ Not required since 58 and removed in 59\n+#define NO_REGISTER_ALL        (LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(59,0,0))\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/plugins\/av\/avdefines.h","additions":17,"deletions":3,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+#include <stdio.h>\n@@ -79,0 +80,1 @@\n+#if !NO_REGISTER_ALL\n@@ -80,0 +82,1 @@\n+#endif\n@@ -107,1 +110,1 @@\n-    if (!decoder->frame)\n+    if (!decoder->frame) {\n@@ -109,0 +112,1 @@\n+    }\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/plugins\/av\/decoder.c","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -229,0 +229,1 @@\n+#if !NO_REGISTER_ALL\n@@ -230,0 +231,1 @@\n+#endif\n@@ -520,0 +522,3 @@\n+#if CODEC_PAR\n+static GstBuffer* get_codec_extradata(AVCodecParameters *codec)\n+#else\n@@ -521,0 +526,1 @@\n+#endif\n@@ -541,0 +547,3 @@\n+#if CODEC_PAR\n+        switch (demuxer->context->streams[i]->codecpar->codec_type)\n+#else\n@@ -542,0 +551,1 @@\n+#endif\n@@ -548,1 +558,3 @@\n-#if NEW_CODEC_ID\n+#if CODEC_PAR\n+                    if (stream->codecpar->codec_id == AV_CODEC_ID_H264)\n+#elif NEW_CODEC_ID\n@@ -555,0 +567,3 @@\n+#if CODEC_PAR\n+                        demuxer->video.codec_id = stream->codecpar->codec_id;\n+#else\n@@ -556,0 +571,1 @@\n+#endif\n@@ -562,0 +578,3 @@\n+#if CODEC_PAR\n+                        GstBuffer *codec_data = get_codec_extradata(stream->codecpar);\n+#else\n@@ -563,0 +582,1 @@\n+#endif\n@@ -579,1 +599,3 @@\n-#if NEW_CODEC_ID\n+#if CODEC_PAR\n+                    if (stream->codecpar->codec_id == AV_CODEC_ID_AAC)\n+#elif NEW_CODEC_ID\n@@ -586,0 +608,6 @@\n+#if CODEC_PAR\n+                        demuxer->audio.codec_id = stream->codecpar->codec_id;\n+                        gint channels = stream->codecpar->ch_layout.nb_channels;\n+                        gint sample_rate = stream->codecpar->sample_rate;\n+                        gint bit_rate = stream->codecpar->bit_rate;\n+#else\n@@ -587,1 +615,4 @@\n-\n+                        gint channels = stream->codec->channels;\n+                        gint sample_rate = stream->codec->sample_rate;\n+                        gint bit_rate = stream->codec->bit_rate;\n+#endif\n@@ -591,3 +622,3 @@\n-                                                    \"channels\", G_TYPE_INT, stream->codec->channels,\n-                                                    \"rate\", G_TYPE_INT, stream->codec->sample_rate,\n-                                                    \"bitrate\", G_TYPE_INT, stream->codec->bit_rate,\n+                                                    \"channels\", G_TYPE_INT, channels,\n+                                                    \"rate\", G_TYPE_INT, sample_rate,\n+                                                    \"bitrate\", G_TYPE_INT, bit_rate,\n@@ -595,1 +626,3 @@\n-\n+#if CODEC_PAR\n+                        GstBuffer *codec_data = get_codec_extradata(stream->codecpar);\n+#else\n@@ -597,0 +630,1 @@\n+#endif\n@@ -636,0 +670,3 @@\n+#if CODEC_PAR\n+    return demuxer->context->streams[packet->stream_index]->codecpar->codec_id == stream->codec_id;\n+#else\n@@ -637,0 +674,1 @@\n+#endif\n@@ -879,0 +917,3 @@\n+#if PACKET_UNREF\n+    av_packet_unref(&packet);\n+#else\n@@ -880,0 +921,1 @@\n+#endif\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/plugins\/av\/mpegtsdemuxer.c","additions":49,"deletions":7,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -402,0 +402,11 @@\n+#if USE_SEND_RECEIVE\n+            num_dec = avcodec_send_packet(base->context, &decoder->packet);\n+            if (num_dec == 0)\n+            {\n+                num_dec = avcodec_receive_frame(base->context, base->frame);\n+                if (num_dec == 0)\n+                    decoder->frame_finished = 1;\n+                else\n+                    decoder->frame_finished = 0;\n+            }\n+#else\n@@ -403,0 +414,5 @@\n+#endif\n+\n+#if PACKET_UNREF\n+            av_packet_unref(&decoder->packet);\n+#else\n@@ -404,0 +420,1 @@\n+#endif\n@@ -421,0 +438,11 @@\n+#if USE_SEND_RECEIVE\n+        num_dec = avcodec_send_packet(base->context, &decoder->packet);\n+        if (num_dec == 0)\n+        {\n+            num_dec = avcodec_receive_frame(base->context, base->frame);\n+            if (num_dec == 0)\n+                decoder->frame_finished = 1;\n+            else\n+                decoder->frame_finished = 0;\n+        }\n+#else\n@@ -422,0 +450,1 @@\n+#endif\n","filename":"modules\/javafx.media\/src\/main\/native\/gstreamer\/plugins\/av\/videodecoder.c","additions":29,"deletions":0,"binary":false,"changes":29,"status":"modified"}]}