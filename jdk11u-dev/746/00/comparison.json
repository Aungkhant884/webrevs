{"files":[{"patch":"@@ -0,0 +1,75 @@\n+\/*\n+ * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\n+\/*\n+ * @test\n+ *\n+ * @summary converted from VM Testbase vm\/compiler\/CodeCacheInfo.\n+ * VM Testbase readme:\n+ * DESCRIPTION\n+ *     Test calls java -version and checks enhanced output format of the\n+ *     -XX:+PrintCodeCache vm option.\n+ *\n+ * @library \/vmTestbase\n+ *          \/test\/lib\n+ * @run driver vm.compiler.CodeCacheInfo.Test\n+ *\/\n+\n+package vm.compiler.CodeCacheInfo;\n+\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+\n+public class Test {\n+    private static String p1 = \" size=\\\\d+Kb used=\\\\d+Kb max_used=\\\\d+Kb free=\\\\d+Kb\\\\n\";\n+    private static String p2 = \" bounds \\\\[0x[0-9a-f]+, 0x[0-9a-f]+, 0x[0-9a-f]+\\\\]\\\\n\";\n+    private static String p3 = \" total_blobs=\\\\d+ nmethods=\\\\d+ adapters=\\\\d+\\\\n\";\n+    private static String p4 = \" compilation: enabled\\\\n\";\n+\n+    private static String SEG_REGEXP = \"^(CodeHeap '[^']+':\" + p1 + p2 + \")+\" + p3 + p4;\n+    private static String NOSEG_REGEXP = \"^CodeCache:\" + p1 + p2 + p3 + p4;\n+\n+    public static void main(String[] args) throws Exception {\n+        {\n+            System.out.println(\"SegmentedCodeCache is enabled\");\n+            var pb = ProcessTools.createJavaProcessBuilder(true,\n+                    \"-XX:+SegmentedCodeCache\",\n+                    \"-XX:+PrintCodeCache\",\n+                    \"-version\");\n+            var output = new OutputAnalyzer(pb.start());\n+            output.shouldHaveExitValue(0);\n+            output.stdoutShouldMatch(SEG_REGEXP);\n+        }\n+        {\n+            System.out.println(\"SegmentedCodeCache is disabled\");\n+            var pb = ProcessTools.createJavaProcessBuilder(true,\n+                    \"-XX:-SegmentedCodeCache\",\n+                    \"-XX:+PrintCodeCache\",\n+                    \"-version\");\n+            var output = new OutputAnalyzer(pb.start());\n+            output.shouldHaveExitValue(0);\n+            output.stdoutShouldMatch(NOSEG_REGEXP);\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/vm\/compiler\/CodeCacheInfo\/Test.java","additions":75,"deletions":0,"binary":false,"changes":75,"status":"added"},{"patch":"@@ -1,40 +0,0 @@\n-\/*\n- * Copyright (c) 2017, 2018, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\n-\/*\n- * @test\n- *\n- * @summary converted from VM Testbase vm\/compiler\/CodeCacheInfo.\n- * VM Testbase readme:\n- * DESCRIPTION\n- *     Test calls java -version and checks enhanced output format of the\n- *     -XX:+PrintCodeCache vm option.\n- *\n- *\n- * @library \/vmTestbase\n- *          \/test\/lib\n- * @run driver jdk.test.lib.FileInstaller . .\n- * @run shell run.sh\n- *\/\n-\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/vm\/compiler\/CodeCacheInfo\/TestDescription.java","additions":0,"deletions":40,"binary":false,"changes":40,"status":"deleted"},{"patch":"@@ -1,60 +0,0 @@\n-#!\/bin\/bash\n-#\n-# Copyright (c) 2013, 2018, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-JAVA_OPTS=\"$TESTJAVAOPTS $TESTVMOPTS\"\n-TESTED_JAVA_HOME=\"$TESTJAVA\"\n-\n-digit=\"[0123456789]\"\n-number=\"${digit}*\"\n-size_pattern=\"${number}Kb\"\n-bound_pattern=\"0x[0123456789abcdef]*\"\n-s1=\" size=${size_pattern} used=${size_pattern} max_used=${size_pattern} free=${size_pattern}\"\n-s2=\" bounds \\[${bound_pattern}, ${bound_pattern}, ${bound_pattern}\\]\"\n-s3=\" total_blobs=${number} nmethods=${number} adapters=${number}\"\n-s4=\" compilation: enabled\"\n-summary_pat_nonseg=\"CodeCache:${s1}${s2}${s3}${s4}\"\n-summary_pat_seg=\"((CodeHeap.*):${s1}${s2})+${s3}${s4}\"\n-\n-# check whether SegmentedCodeCache enabled\n-segmented=$(${TESTED_JAVA_HOME}\/bin\/java ${JAVA_OPTS} -XX:+PrintFlagsFinal -version | egrep -c ' +SegmentedCodeCache +:?= +true')\n-out=$(${TESTED_JAVA_HOME}\/bin\/java ${JAVA_OPTS} -XX:+PrintCodeCache -version)\n-if [ \"${segmented}\" = \"1\" ]; then\n-        summary_pat=${summary_pat_seg}\n-        status=\"enabled\"\n-else\n-        summary_pat=${summary_pat_nonseg}\n-        status=\"disabled\"\n-fi\n-echo \"INFO: SegmentedCodeCache is ${status}\"\n-\n-res=$(echo ${out} | egrep -c \"${summary_pat}\")\n-if [ \"${res}\" = \"1\" ]; then\n-        echo \"passed\"\n-        true\n-else\n-        echo ${summary_pat}\n-        echo \"did not match for:\"\n-        echo ${out}\n-        false\n-fi\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/vm\/compiler\/CodeCacheInfo\/run.sh","additions":0,"deletions":60,"binary":false,"changes":60,"status":"deleted"},{"patch":"@@ -0,0 +1,59 @@\n+\/*\n+ * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\n+\/*\n+ * @test\n+ *\n+ * @summary converted from VM Testbase vm\/compiler\/CodeCacheInfoOnCompilation.\n+ * VM Testbase readme:\n+ * DESCRIPTION\n+ *     Test calls java class with one method call in main. Test checks output\n+ *     format of the -XX:+PrintCodeCacheOnCompilation vm option during this method\n+ *     call.\n+ *\n+ * @library \/vmTestbase\n+ *          \/test\/lib\n+ * @run driver vm.compiler.CodeCacheInfoOnCompilation.Test\n+ *\/\n+\n+package vm.compiler.CodeCacheInfoOnCompilation;\n+\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+\n+public class Test {\n+    private static String REGEXP = \"^(CodeCache|(CodeHeap.*)): size=\\\\d+Kb used=\\\\d+Kb max_used=\\\\d+Kb free=\\\\d+Kb\";\n+\n+    public static void main(String[] args) throws Exception {\n+        var pb = ProcessTools.createJavaProcessBuilder(true,\n+                \"-XX:-PrintCodeCache\",\n+                \"-XX:+PrintCodeCacheOnCompilation\",\n+                \"-XX:-Inline\",\n+                \"-Xcomp\",\n+                PrintOnCall.class.getName());\n+        var output = new OutputAnalyzer(pb.start());\n+        output.shouldHaveExitValue(0);\n+        output.stdoutShouldMatch(REGEXP);\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/vm\/compiler\/CodeCacheInfoOnCompilation\/Test.java","additions":59,"deletions":0,"binary":false,"changes":59,"status":"added"},{"patch":"@@ -1,44 +0,0 @@\n-\/*\n- * Copyright (c) 2017, 2018, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\n-\/*\n- * @test\n- *\n- * @summary converted from VM Testbase vm\/compiler\/CodeCacheInfoOnCompilation.\n- * VM Testbase readme:\n- * DESCRIPTION\n- *     Test calls java class with one method call in main. Test checks output\n- *     format of the -XX:+PrintCodeCacheOnCompilation vm option during this method\n- *     call.\n- *\n- *     Test will be skipped if java has not \"-Xcomp\" option\n- *\n- *\n- * @library \/vmTestbase\n- *          \/test\/lib\n- * @run driver jdk.test.lib.FileInstaller . .\n- * @build vm.compiler.CodeCacheInfoOnCompilation.PrintOnCall\n- * @run shell run.sh\n- *\/\n-\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/vm\/compiler\/CodeCacheInfoOnCompilation\/TestDescription.java","additions":0,"deletions":44,"binary":false,"changes":44,"status":"deleted"},{"patch":"@@ -1,50 +0,0 @@\n-#!\/bin\/sh\n-#\n-# Copyright (c) 2013, 2018, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-JAVA_OPTS=\"-cp $TESTCLASSPATH $TESTJAVAOPTS $TESTVMOPTS\"\n-TESTED_JAVA_HOME=\"$TESTJAVA\"\n-\n-ver=$(${TESTED_JAVA_HOME}\/bin\/java ${JAVA_OPTS} -version 2>&1)\n-isComp=$( echo ${ver} | grep -c \"compiled mode\")\n-if [ \"$isComp\" -ne 1 ]; then\n-        echo \"skipped. This test works only with -Xcomp\"\n-        exit\n-fi\n-\n-digit=\"[0123456789]\"\n-number=\"${digit}+\"\n-size_pattern=\"${number}Kb\"\n-pattern=\"(CodeCache|(CodeHeap.*)): size=${size_pattern} used=${size_pattern} max_used=${size_pattern} free=${size_pattern}\"\n-\n-res=$(${TESTED_JAVA_HOME}\/bin\/java ${JAVA_OPTS} -XX:+PrintCodeCacheOnCompilation -XX:-Inline vm.compiler.CodeCacheInfoOnCompilation.PrintOnCall | egrep -ce \"${pattern}\")\n-echo \"res: \" ${res}\n-\n-if [ \"$res\" -ne 0 ]; then\n-        echo \"passed\"\n-        true\n-else\n-        echo $pattern\n-        echo \" not found\"\n-        false\n-fi\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/vm\/compiler\/CodeCacheInfoOnCompilation\/run.sh","additions":0,"deletions":50,"binary":false,"changes":50,"status":"deleted"}]}