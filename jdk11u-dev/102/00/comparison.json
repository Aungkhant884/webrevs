{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -86,0 +86,10 @@\n+void SafepointMechanism::block_if_requested_slow(JavaThread *thread) {\n+  \/\/ local poll already checked, if used.\n+  if (global_poll()) {\n+    SafepointSynchronize::block(thread);\n+  }\n+  if (uses_thread_local_poll() && thread->has_handshake()) {\n+      thread->handshake_process_by_self();\n+  }\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/safepointMechanism.cpp","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-  static inline void block_if_requested_local_poll(JavaThread *thread);\n+  static void block_if_requested_slow(JavaThread *thread);\n","filename":"src\/hotspot\/share\/runtime\/safepointMechanism.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -58,13 +58,0 @@\n-void SafepointMechanism::block_if_requested_local_poll(JavaThread *thread) {\n-  bool armed = local_poll_armed(thread); \/\/ load acquire, polling page -> op \/ global state\n-  if(armed) {\n-    \/\/ We could be armed for either a handshake operation or a safepoint\n-    if (global_poll()) {\n-      SafepointSynchronize::block(thread);\n-    }\n-    if (thread->has_handshake()) {\n-      thread->handshake_process_by_self();\n-    }\n-  }\n-}\n-\n@@ -72,7 +59,2 @@\n-  if (uses_thread_local_poll()) {\n-    block_if_requested_local_poll(thread);\n-  } else {\n-    \/\/ If we don't have per thread poll this could a handshake or a safepoint\n-    if (global_poll()) {\n-      SafepointSynchronize::block(thread);\n-    }\n+  if (uses_thread_local_poll() && !SafepointMechanism::local_poll_armed(thread)) {\n+    return;\n@@ -80,0 +62,1 @@\n+  block_if_requested_slow(thread);\n","filename":"src\/hotspot\/share\/runtime\/safepointMechanism.inline.hpp","additions":3,"deletions":20,"binary":false,"changes":23,"status":"modified"}]}