{"files":[{"patch":"@@ -37,0 +37,1 @@\n+DST_DIR = dist\n@@ -38,1 +39,1 @@\n-TESTLIBRARY_DIR = ..\/..\/..\/..\/test\/lib\n+TESTLIBRARY_DIR = ..\/..\/..\/..\/..\/test\/lib\n@@ -43,1 +44,5 @@\n-SRC_FILES = $(shell find $(SRC_DIR) $(TESTLIBRARY_DIR)\/jdk\/test\/lib -name '*.java')\n+SRC_FILES = $(shell find $(SRC_DIR) -name '*.java')\n+LIB_FILES = $(shell find $(TESTLIBRARY_DIR)\/jdk\/test\/lib\/ \\\n+    $(TESTLIBRARY_DIR)\/jdk\/test\/lib\/process \\\n+    $(TESTLIBRARY_DIR)\/jdk\/test\/lib\/util \\\n+    -maxdepth 1 -name '*.java')\n@@ -45,0 +50,4 @@\n+EXPORTS=--add-exports java.base\/jdk.internal.jimage=ALL-UNNAMED \\\n+\t--add-exports java.base\/jdk.internal.misc=ALL-UNNAMED \\\n+\t--add-exports java.base\/jdk.internal.reflect=ALL-UNNAMED \\\n+\t--add-exports java.base\/jdk.internal.access=ALL-UNNAMED\n@@ -50,1 +59,1 @@\n-all: ctw.jar cleantmp\n+all: $(DST_DIR)\/ctw.zip cleantmp\n@@ -53,1 +62,1 @@\n-\t@rm -rf ctw.jar wb.jar\n+\t@rm -rf $(DST_DIR)\n@@ -59,1 +68,8 @@\n-ctw.jar: filelist wb.jar\n+$(DST_DIR):\n+\t@mkdir -p $@\n+\n+$(DST_DIR)\/ctw.sh: $(DST_DIR)\n+\techo '$${JAVA_HOME}\/bin\/java $${JAVA_OPTIONS} $(EXPORTS) -XX:-UseCounterDecay -Xbatch \"-XX:CompileCommand=exclude,java\/lang\/invoke\/MethodHandle.*\" -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbootclasspath\/a:wb.jar -jar ctw.jar $$@' > $@\n+\tchmod a+x $@\n+\n+$(DST_DIR)\/ctw.jar: filelist $(DST_DIR)\/wb.jar\n@@ -61,4 +77,1 @@\n-\t$(JAVAC) --add-exports java.base\/jdk.internal.jimage=ALL-UNNAMED \\\n-\t\t --add-exports java.base\/jdk.internal.misc=ALL-UNNAMED \\\n-\t\t --add-exports java.base\/jdk.internal.reflect=ALL-UNNAMED \\\n-\t\t -sourcepath $(SRC_DIR) -d $(OUTPUT_DIR) -cp wb.jar @filelist\n+\t$(JAVAC) $(EXPORTS) -sourcepath $(SRC_DIR) -d $(OUTPUT_DIR) -cp $(DST_DIR)\/wb.jar @filelist\n@@ -66,0 +79,1 @@\n+\t@rm -rf $(OUTPUT_DIR)\n@@ -67,1 +81,1 @@\n-wb.jar: wb_filelist\n+$(DST_DIR)\/wb.jar: wb_filelist $(DST_DIR)\n@@ -74,0 +88,4 @@\n+\t@rm -rf $(OUTPUT_DIR)\n+\n+$(DST_DIR)\/ctw.zip: $(DST_DIR)\/ctw.sh $(DST_DIR)\/wb.jar $(DST_DIR)\/ctw.jar\n+\tzip -j $@ $?\n@@ -79,1 +97,1 @@\n-filelist: $(SRC_FILES)\n+filelist: $(SRC_FILES) $(LIB_FILES)\n@@ -81,1 +99,1 @@\n-\t@echo $(SRC_FILES) > $@\n+\t@echo $(SRC_FILES) $(LIB_FILES) > $@\n","filename":"test\/hotspot\/jtreg\/testlibrary\/ctw\/Makefile","additions":30,"deletions":12,"binary":false,"changes":42,"status":"modified"}]}