{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -924,2 +924,1 @@\n-        char c;\n-        while (sp < sl && (c = StringUTF16.getChar(val, sp)) < '\\u0080') {\n+        while (sp < sl) {\n@@ -927,0 +926,4 @@\n+            char c = StringUTF16.getChar(val, sp);\n+            if (c >= '\\u0080') {\n+                break;\n+            }\n@@ -931,1 +934,1 @@\n-            c = StringUTF16.getChar(val, sp++);\n+            char c = StringUTF16.getChar(val, sp++);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/StringCoding.java","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -0,0 +1,124 @@\n+\/*\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package org.openjdk.bench.java.lang;\n+\n+import org.openjdk.jmh.annotations.*;\n+import org.openjdk.jmh.infra.Blackhole;\n+\n+import java.nio.charset.Charset;\n+import java.util.concurrent.TimeUnit;\n+\n+@BenchmarkMode(Mode.AverageTime)\n+@OutputTimeUnit(TimeUnit.NANOSECONDS)\n+@Fork(value = 3)\n+@Warmup(iterations = 5, time = 2)\n+@Measurement(iterations = 5, time = 3)\n+@State(Scope.Thread)\n+public class StringEncode {\n+\n+    @Param({\"US-ASCII\", \"ISO-8859-1\", \"UTF-8\", \"MS932\", \"ISO-8859-6\"})\n+    private String charsetName;\n+    private Charset charset;\n+    private String asciiString;\n+    private String utf16String;\n+    private String longUtf16String;\n+    private String longUtf16StartString;\n+\n+    @Setup\n+    public void setup() {\n+        charset = Charset.forName(charsetName);\n+        asciiString = \"ascii string\";\n+        utf16String = \"UTF-\\uFF11\\uFF16 string\";\n+        longUtf16String =\n+                 \" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ac sem eu\\n\" +\n+                 \" urna egestas placerat. Etiam finibus ipsum nulla, non mattis dolor cursus a.\\n\" +\n+                 \" Nulla nec nisl consectetur, lacinia neque id, accumsan ante. Curabitur et\\n\" +\n+                 \" sapien in magna porta ultricies. Sed vel pellentesque nibh. Pellentesque dictum\\n\" +\n+                 \" dignissim diam eu ultricies. Class aptent taciti sociosqu ad litora torquent\\n\" +\n+                 \" per conubia nostra, per inceptos himenaeos. Suspendisse erat diam, fringilla\\n\" +\n+                 \" sed massa sed, posuere viverra orci. Suspendisse tempor libero non gravida\\n\" +\n+                 \" efficitur. Vivamus lacinia risus non orci viverra, at consectetur odio laoreet.\\n\" +\n+                 \" Suspendisse potenti.\\n\" +\n+                 \"\\n\" +\n+                 \" Phasellus vel nisi iaculis, accumsan quam sed, bibendum eros. Sed venenatis\\n\" +\n+                 \" nulla tortor, et eleifend urna sodales id. Nullam tempus ac metus sit amet\\n\" +\n+                 \" sollicitudin. Nam sed ex diam. Praesent vitae eros et neque condimentum\\n\" +\n+                 \" consectetur eget non tortor. Praesent bibendum vel felis nec dignissim.\\n\" +\n+                 \" Maecenas a enim diam. Suspendisse quis ligula at nisi accumsan lacinia id\\n\" +\n+                 \" hendrerit sapien. Donec aliquam mattis lectus eu ultrices. Duis eu nisl\\n\" +\n+                 \" euismod, blandit mauris vel, placerat urna. Etiam malesuada enim purus,\\n\" +\n+                 \" tristique mollis odio blandit quis. Vivamus posuere.\\n\" +\n+                 \" \\uFF11\";\n+        longUtf16StartString =\n+                 \" \\uFF11\" +\n+                 \" Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ac sem eu\\n\" +\n+                 \" urna egestas placerat. Etiam finibus ipsum nulla, non mattis dolor cursus a.\\n\" +\n+                 \" Nulla nec nisl consectetur, lacinia neque id, accumsan ante. Curabitur et\\n\" +\n+                 \" sapien in magna porta ultricies. Sed vel pellentesque nibh. Pellentesque dictum\\n\" +\n+                 \" dignissim diam eu ultricies. Class aptent taciti sociosqu ad litora torquent\\n\" +\n+                 \" per conubia nostra, per inceptos himenaeos. Suspendisse erat diam, fringilla\\n\" +\n+                 \" sed massa sed, posuere viverra orci. Suspendisse tempor libero non gravida\\n\" +\n+                 \" efficitur. Vivamus lacinia risus non orci viverra, at consectetur odio laoreet.\\n\" +\n+                 \" Suspendisse potenti.\\n\" +\n+                 \"\\n\" +\n+                 \" Phasellus vel nisi iaculis, accumsan quam sed, bibendum eros. Sed venenatis\\n\" +\n+                 \" nulla tortor, et eleifend urna sodales id. Nullam tempus ac metus sit amet\\n\" +\n+                 \" sollicitudin. Nam sed ex diam. Praesent vitae eros et neque condimentum\\n\" +\n+                 \" consectetur eget non tortor. Praesent bibendum vel felis nec dignissim.\\n\" +\n+                 \" Maecenas a enim diam. Suspendisse quis ligula at nisi accumsan lacinia id\\n\" +\n+                 \" hendrerit sapien. Donec aliquam mattis lectus eu ultrices. Duis eu nisl\\n\" +\n+                 \" euismod, blandit mauris vel, placerat urna. Etiam malesuada enim purus,\\n\" +\n+                 \" tristique mollis odio blandit quis. Vivamus posuere.\\n\";\n+    }\n+\n+    @Benchmark\n+    public byte[] encodeAsciiCharsetName() throws Exception {\n+        return asciiString.getBytes(charset);\n+    }\n+\n+    @Benchmark\n+    public byte[] encodeAscii() throws Exception {\n+        return asciiString.getBytes(charset);\n+    }\n+\n+    @Benchmark\n+    public void encodeMix(Blackhole bh) throws Exception {\n+        bh.consume(asciiString.getBytes(charset));\n+        bh.consume(utf16String.getBytes(charset));\n+    }\n+\n+    @Benchmark\n+    public byte[] encodeUTF16LongEnd() throws Exception {\n+        return longUtf16String.getBytes(charset);\n+    }\n+\n+    @Benchmark\n+    public byte[] encodeUTF16LongStart() throws Exception {\n+        return longUtf16StartString.getBytes(charset);\n+    }\n+\n+    @Benchmark\n+    public byte[] encodeUTF16() throws Exception {\n+        return utf16String.getBytes(charset);\n+    }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/StringEncode.java","additions":124,"deletions":0,"binary":false,"changes":124,"status":"added"}]}