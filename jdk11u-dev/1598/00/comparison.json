{"files":[{"patch":"@@ -40,2 +40,2 @@\n-\t$(ECHO) \"build.workspace.root=$(call FixPath, $(WORKSPACE_ROOT))\" >> $@\n-\t$(ECHO) \"build.output.root=$(call FixPath, $(OUTPUTDIR))\" >> $@\n+\t$(ECHO) 'build.workspace.root=$(call FixPath, $(WORKSPACE_ROOT))' >> $@\n+\t$(ECHO) 'build.output.root=$(call FixPath, $(OUTPUTDIR))' >> $@\n","filename":"make\/TestImage.gmk","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -198,1 +198,2 @@\n-# Configure flags for the tools\n+# Configure flags for the tools. Need to know if we should build reproducible.\n+JDKOPT_SETUP_REPRODUCIBLE_BUILD\n@@ -238,1 +239,0 @@\n-JDKOPT_SETUP_REPRODUCIBLE_BUILD\n","filename":"make\/autoconf\/configure.ac","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -816,0 +816,12 @@\n+  if test \"x$TOOLCHAIN_TYPE\" = xmicrosoft && test \"x$ENABLE_REPRODUCIBLE_BUILD\" = xtrue; then\n+    # Enabling deterministic creates warnings if __DATE__ or __TIME__ are\n+    # used, and since we are, silence that warning.\n+    REPRODUCIBLE_CFLAGS=\"-experimental:deterministic -wd5048\"\n+    FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${REPRODUCIBLE_CFLAGS}],\n+        PREFIX: $3,\n+        IF_FALSE: [\n+            REPRODUCIBLE_CFLAGS=\n+        ]\n+    )\n+  fi\n+\n@@ -834,0 +846,21 @@\n+    elif test \"x$TOOLCHAIN_TYPE\" = xmicrosoft &&\n+        test \"x$ENABLE_REPRODUCIBLE_BUILD\" = xtrue; then\n+      # There is a known issue with the pathmap if the mapping is made to the\n+      # empty string. Add a minimal string \"s\" as prefix to work around this.\n+      # PATHMAP_FLAGS is also added to LDFLAGS in flags-ldflags.m4.\n+      PATHMAP_FLAGS=\"-pathmap:${WORKSPACE_ROOT}=s\"\n+      FILE_MACRO_CFLAGS=\"$PATHMAP_FLAGS\"\n+      FLAGS_COMPILER_CHECK_ARGUMENTS(ARGUMENT: [${FILE_MACRO_CFLAGS}],\n+          PREFIX: $3,\n+          IF_FALSE: [\n+              PATHMAP_FLAGS=\n+              FILE_MACRO_CFLAGS=\n+          ]\n+      )\n+    fi\n+\n+    AC_MSG_CHECKING([how to prevent absolute paths in output])\n+    if test \"x$FILE_MACRO_CFLAGS\" != x; then\n+      AC_MSG_RESULT([using compiler options])\n+    else\n+      AC_MSG_RESULT([using relative paths])\n@@ -842,1 +875,2 @@\n-      $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS\"\n+      $WARNING_CFLAGS $WARNING_CFLAGS_JVM $JVM_PICFLAG $FILE_MACRO_CFLAGS \\\n+      $REPRODUCIBLE_CFLAGS\"\n@@ -847,1 +881,1 @@\n-      $FILE_MACRO_CFLAGS\"\n+      $FILE_MACRO_CFLAGS $REPRODUCIBLE_CFLAGS\"\n","filename":"make\/autoconf\/flags-cflags.m4","additions":36,"deletions":2,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -150,0 +150,6 @@\n+  if test \"x$ENABLE_REPRODUCIBLE_BUILD\" = \"xtrue\"; then\n+    if test \"x$TOOLCHAIN_TYPE\" = xmicrosoft; then\n+      REPRODUCIBLE_LDFLAGS=\"-experimental:deterministic\"\n+    fi\n+  fi\n+\n@@ -153,0 +159,2 @@\n+      # PATHMAP_FLAGS is setup in flags-cflags.m4.\n+      FILE_MACRO_LDFLAGS=\"${PATHMAP_FLAGS}\"\n@@ -214,1 +222,2 @@\n-      ${$1_LDFLAGS_JDK_LIBPATH} $SHARED_LIBRARY_FLAGS\"\n+      ${$1_LDFLAGS_JDK_LIBPATH} $SHARED_LIBRARY_FLAGS \\\n+      $REPRODUCIBLE_LDFLAGS $FILE_MACRO_LDFLAGS\"\n@@ -216,1 +225,1 @@\n-      ${$1_CPU_EXECUTABLE_LDFLAGS}\"\n+      ${$1_CPU_EXECUTABLE_LDFLAGS} $REPRODUCIBLE_LDFLAGS $FILE_MACRO_LDFLAGS\"\n@@ -220,1 +229,2 @@\n-      ${$1_CPU_LDFLAGS} ${$1_CPU_LDFLAGS_JVM_ONLY} ${$2EXTRA_LDFLAGS}\"\n+      ${$1_CPU_LDFLAGS} ${$1_CPU_LDFLAGS_JVM_ONLY} ${$2EXTRA_LDFLAGS} \\\n+      $REPRODUCIBLE_LDFLAGS $FILE_MACRO_LDFLAGS\"\n","filename":"make\/autoconf\/flags-ldflags.m4","additions":13,"deletions":3,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -98,0 +98,7 @@\n+        \/\/ Validate the root paths\n+        if (!Paths.get(buildWorkspaceRoot).isAbsolute()) {\n+            throw new Error(\"Workspace root is not an absolute path: \" + buildWorkspaceRoot);\n+        }\n+        if (!Paths.get(buildOutputRoot).isAbsolute()) {\n+            throw new Error(\"Output root is not an absolute path: \" + buildOutputRoot);\n+        }\n@@ -161,5 +168,0 @@\n-                } else if (fileName.endsWith(\"jvm.dll\")) {\n-                    \/\/ On Windows, the Microsoft toolchain does not provide a way\n-                    \/\/ to reliably remove all absolute paths from __FILE__ usage.\n-                    \/\/ Until that is fixed, we simply exclude jvm.dll from this\n-                    \/\/ test.\n","filename":"test\/jdk\/build\/AbsPathsInImage.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"}]}