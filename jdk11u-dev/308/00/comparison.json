{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2008, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -202,1 +202,5 @@\n-      for (OopMapStream oms = new OopMapStream(map, OopMapValue.OopTypes.DERIVED_OOP_VALUE); !oms.isDone(); oms.next()) {\n+      for (OopMapStream oms = new OopMapStream(map); !oms.isDone(); oms.next()) {\n+        omv = oms.getCurrent();\n+        if (omv.getType() != OopMapValue.OopTypes.DERIVED_OOP_VALUE) {\n+          continue;\n+        }\n@@ -206,1 +210,0 @@\n-        omv = oms.getCurrent();\n@@ -217,4 +220,0 @@\n-    OopMapValue.OopTypes[] values = new OopMapValue.OopTypes[] {\n-        OopMapValue.OopTypes.OOP_VALUE, OopMapValue.OopTypes.NARROWOOP_VALUE\n-    };\n-\n@@ -222,1 +221,1 @@\n-      for (OopMapStream oms = new OopMapStream(map, values); !oms.isDone(); oms.next()) {\n+      for (OopMapStream oms = new OopMapStream(map); !oms.isDone(); oms.next()) {\n@@ -279,1 +278,1 @@\n-    for (OopMapStream oms = new OopMapStream(map, OopMapValue.OopTypes.CALLEE_SAVED_VALUE); !oms.isDone(); oms.next()) {\n+    for (OopMapStream oms = new OopMapStream(map); !oms.isDone(); oms.next()) {\n@@ -281,0 +280,3 @@\n+      if (omv.getType() != OopMapValue.OopTypes.CALLEE_SAVED_VALUE) {\n+        continue;\n+      }\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/compiler\/ImmutableOopMapSet.java","additions":11,"deletions":9,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,1 +32,0 @@\n-  private int mask;\n@@ -39,9 +38,0 @@\n-    this(oopMap, (OopMapValue.OopTypes[]) null);\n-  }\n-\n-  public OopMapStream(ImmutableOopMap oopMap, OopMapValue.OopTypes type) {\n-    this(oopMap, (OopMapValue.OopTypes[]) null);\n-    mask = type.getValue();\n-  }\n-\n-  public OopMapStream(ImmutableOopMap oopMap, OopMapValue.OopTypes[] types) {\n@@ -49,1 +39,0 @@\n-    mask = computeMask(types);\n@@ -75,10 +64,0 @@\n-  private int computeMask(OopMapValue.OopTypes[] types) {\n-    mask = 0;\n-    if (types != null) {\n-      for (int i = 0; i < types.length; i++) {\n-        mask |= types[i].getValue();\n-      }\n-    }\n-    return mask;\n-  }\n-\n@@ -86,1 +65,1 @@\n-    while (position++ < size) {\n+    if (position++ < size) {\n@@ -88,4 +67,2 @@\n-      if ((omv.getType().getValue() & mask) > 0) {\n-        omvValid = true;\n-        return;\n-      }\n+      omvValid = true;\n+      return;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/compiler\/OopMapStream.java","additions":4,"deletions":27,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -1186,1 +1186,2 @@\n-         final Formatter iterate(OopMapStream oms, String type, boolean printContentReg) {\n+         final Formatter iterate(OopMapStream oms, String type, boolean printContentReg,\n+                                 OopMapValue.OopTypes filter) {\n@@ -1194,1 +1195,1 @@\n-               if (omv == null) {\n+               if (omv == null || omv.getType() != filter) {\n@@ -1230,2 +1231,3 @@\n-      OopMapStream oms = new OopMapStream(map, OopMapValue.OopTypes.OOP_VALUE);\n-      buf.append(omvIterator.iterate(oms, \"Oops:\", false));\n+      OopMapStream oms = new OopMapStream(map);\n+      buf.append(omvIterator.iterate(oms, \"Oops:\", false,\n+                                     OopMapValue.OopTypes.OOP_VALUE));\n@@ -1233,2 +1235,3 @@\n-      oms = new OopMapStream(map, OopMapValue.OopTypes.NARROWOOP_VALUE);\n-      buf.append(omvIterator.iterate(oms, \"NarrowOops:\", false));\n+      oms = new OopMapStream(map);\n+      buf.append(omvIterator.iterate(oms, \"NarrowOops:\", false,\n+                                     OopMapValue.OopTypes.NARROWOOP_VALUE));\n@@ -1236,2 +1239,3 @@\n-      oms = new OopMapStream(map, OopMapValue.OopTypes.CALLEE_SAVED_VALUE);\n-      buf.append(omvIterator.iterate(oms, \"Callee saved:\",  true));\n+      oms = new OopMapStream(map);\n+      buf.append(omvIterator.iterate(oms, \"Callee saved:\", true,\n+                                     OopMapValue.OopTypes.CALLEE_SAVED_VALUE));\n@@ -1239,2 +1243,3 @@\n-      oms = new OopMapStream(map, OopMapValue.OopTypes.DERIVED_OOP_VALUE);\n-      buf.append(omvIterator.iterate(oms, \"Derived oops:\", true));\n+      oms = new OopMapStream(map);\n+      buf.append(omvIterator.iterate(oms, \"Derived oops:\", true,\n+                                     OopMapValue.OopTypes.DERIVED_OOP_VALUE));\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/ui\/classbrowser\/HTMLGenerator.java","additions":15,"deletions":10,"binary":false,"changes":25,"status":"modified"}]}