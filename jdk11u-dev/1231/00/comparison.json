{"files":[{"patch":"@@ -142,2 +142,2 @@\n-  static OopMap* save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_vectors);\n-  static void restore_live_registers(MacroAssembler* masm, bool restore_vectors = false);\n+  static OopMap* save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_wide_vectors);\n+  static void restore_live_registers(MacroAssembler* masm, bool restore_wide_vectors = false);\n@@ -160,1 +160,1 @@\n-OopMap* RegisterSaver::save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_vectors) {\n+OopMap* RegisterSaver::save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_wide_vectors) {\n@@ -167,2 +167,2 @@\n-  if (save_vectors && UseAVX == 0) {\n-    save_vectors = false; \/\/ vectors larger than 16 byte long are supported only with AVX\n+  if (save_wide_vectors && UseAVX == 0) {\n+    save_wide_vectors = false; \/\/ vectors larger than 16 byte long are supported only with AVX\n@@ -170,1 +170,1 @@\n-  assert(!save_vectors || MaxVectorSize <= 64, \"Only up to 64 byte long vectors are supported\");\n+  assert(!save_wide_vectors || MaxVectorSize <= 64, \"Only up to 64 byte long vectors are supported\");\n@@ -172,1 +172,1 @@\n-  save_vectors = false; \/\/ vectors are generated only by C2 and JVMCI\n+  save_wide_vectors = false; \/\/ vectors are generated only by C2 and JVMCI\n@@ -193,1 +193,1 @@\n-  if (save_vectors) {\n+  if (save_wide_vectors) {\n@@ -215,1 +215,1 @@\n-      \/\/ Save upper bank of ZMM registers(16..31) for double\/float usage\n+      \/\/ Save upper bank of XMM registers(16..31) for scalar or 16-byte vector usage\n@@ -218,0 +218,1 @@\n+      int vector_len = VM_Version::supports_avx512vl() ?  Assembler::AVX_128bit : Assembler::AVX_512bit;\n@@ -219,1 +220,1 @@\n-        __ movsd(Address(rsp, base_addr+(off++*64)), as_XMMRegister(n));\n+        __ evmovdqul(Address(rsp, base_addr+(off++*64)), as_XMMRegister(n), vector_len);\n@@ -276,1 +277,1 @@\n-  if (save_vectors) {\n+  if (save_wide_vectors) {\n@@ -339,1 +340,1 @@\n-void RegisterSaver::restore_live_registers(MacroAssembler* masm, bool restore_vectors) {\n+void RegisterSaver::restore_live_registers(MacroAssembler* masm, bool restore_wide_vectors) {\n@@ -350,1 +351,1 @@\n-  if (restore_vectors) {\n+  if (restore_wide_vectors) {\n@@ -355,1 +356,1 @@\n-  assert(!restore_vectors, \"vectors are generated only by C2\");\n+  assert(!restore_wide_vectors, \"vectors are generated only by C2\");\n@@ -361,1 +362,1 @@\n-  if (restore_vectors) {\n+  if (restore_wide_vectors) {\n@@ -383,1 +384,1 @@\n-      \/\/ Restore upper bank of ZMM registers(16..31) for double\/float usage\n+      \/\/ Restore upper bank of XMM registers(16..31) for scalar or 16-byte vector usage\n@@ -386,0 +387,1 @@\n+      int vector_len = VM_Version::supports_avx512vl() ?  Assembler::AVX_128bit : Assembler::AVX_512bit;\n@@ -387,1 +389,1 @@\n-        __ movsd(as_XMMRegister(n), Address(rsp, base_addr+(off++*64)));\n+        __ evmovdqul(as_XMMRegister(n), Address(rsp, base_addr+(off++*64)), vector_len);\n@@ -2866,1 +2868,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2884,1 +2886,1 @@\n-  (void) RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+  (void) RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2903,1 +2905,1 @@\n-    RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+    RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2950,1 +2952,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -3386,1 +3388,1 @@\n-  bool save_vectors = (poll_type == POLL_AT_VECTOR_LOOP);\n+  bool save_wide_vectors = (poll_type == POLL_AT_VECTOR_LOOP);\n@@ -3401,1 +3403,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, save_vectors);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, save_wide_vectors);\n@@ -3440,1 +3442,1 @@\n-  RegisterSaver::restore_live_registers(masm, save_vectors);\n+  RegisterSaver::restore_live_registers(masm, save_wide_vectors);\n@@ -3508,1 +3510,1 @@\n-  RegisterSaver::restore_live_registers(masm, save_vectors);\n+  RegisterSaver::restore_live_registers(masm, save_wide_vectors);\n@@ -3548,1 +3550,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ false);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ false);\n","filename":"src\/hotspot\/cpu\/x86\/sharedRuntime_x86_64.cpp","additions":28,"deletions":26,"binary":false,"changes":54,"status":"modified"}]}