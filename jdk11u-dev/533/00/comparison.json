{"files":[{"patch":"@@ -2,1 +2,2 @@\n- * Copyright (c) 2013, 2020, Red Hat, Inc. All rights reserved.\n+ * Copyright (c) 2013, 2021, Red Hat, Inc. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n@@ -92,2 +93,4 @@\n-    bool explicit_gc_requested = _gc_requested.is_set() &&  is_explicit_gc(_requested_gc_cause);\n-    bool implicit_gc_requested = _gc_requested.is_set() && !is_explicit_gc(_requested_gc_cause);\n+    bool is_gc_requested = _gc_requested.is_set();\n+    GCCause::Cause requested_gc_cause = _requested_gc_cause;\n+    bool explicit_gc_requested = is_gc_requested && is_explicit_gc(requested_gc_cause);\n+    bool implicit_gc_requested = is_gc_requested && !is_explicit_gc(requested_gc_cause);\n@@ -127,1 +130,1 @@\n-      cause = _requested_gc_cause;\n+      cause = requested_gc_cause;\n@@ -143,1 +146,1 @@\n-      cause = _requested_gc_cause;\n+      cause = requested_gc_cause;\n@@ -539,1 +542,3 @@\n-    _gc_requested.set();\n+    \/\/ Although setting gc request is under _gc_waiters_lock, but read side (run_service())\n+    \/\/ does not take the lock. We need to enforce following order, so that read side sees\n+    \/\/ latest requested gc cause when the flag is set.\n@@ -541,0 +546,1 @@\n+    _gc_requested.set();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahControlThread.cpp","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"}]}