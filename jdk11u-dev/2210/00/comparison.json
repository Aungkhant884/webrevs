{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,0 +36,1 @@\n+import java.awt.event.MouseAdapter;\n@@ -37,1 +38,3 @@\n-import java.awt.event.*;\n+import java.io.File;\n+import java.util.stream.IntStream;\n+import javax.imageio.ImageIO;\n@@ -39,1 +42,1 @@\n-\/**\n+\/*\n@@ -50,0 +53,1 @@\n+    public static final int OFFSET = 50;\n@@ -51,0 +55,4 @@\n+    private static Robot robot;\n+    private static Frame frame;\n+    private static Rectangle screenBounds;\n+\n@@ -53,0 +61,2 @@\n+        robot = new Robot();\n+        robot.setAutoDelay(200);\n@@ -58,2 +68,1 @@\n-            Rectangle bounds = gc.getBounds();\n-            Point point = new Point(bounds.x, bounds.y);\n+            screenBounds = gc.getBounds();\n@@ -61,3 +70,8 @@\n-            while (point.y < bounds.y + bounds.height - insets.bottom - SIZE) {\n-                while (point.x\n-                        < bounds.x + bounds.width - insets.right - SIZE) {\n+            Point point = new Point(screenBounds.x + insets.left,\n+                                    screenBounds.y + insets.top);\n+            final int yBound = screenBounds.y + screenBounds.height\n+                               - insets.bottom - SIZE;\n+            final int xBound = screenBounds.x + screenBounds.width\n+                               - insets.right - SIZE;\n+            while (point.y < yBound) {\n+                while (point.x < xBound) {\n@@ -65,1 +79,1 @@\n-                    point.translate(bounds.width \/ 5, 0);\n+                    point.translate(screenBounds.width \/ 5, 0);\n@@ -67,1 +81,2 @@\n-                point.setLocation(bounds.x, point.y + bounds.height \/ 5);\n+                point.setLocation(screenBounds.x,\n+                                  point.y + screenBounds.height \/ 5);\n@@ -72,1 +87,2 @@\n-    private static void test(final Point tmp) throws Exception {\n+    private static void test(final Point loc) {\n+        frame = new Frame();\n@@ -74,5 +90,6 @@\n-        for (int i = 1; i < 7; i++) {\n-            pm.add(TEXT + i);\n-        }\n-        pm.addActionListener(e -> action = true);\n-        Frame frame = new Frame();\n+        IntStream.rangeClosed(1, 6).forEach(i -> pm.add(TEXT + i));\n+        pm.addActionListener(e -> {\n+            action = true;\n+            System.out.println(\" Got action event \" + e);\n+        });\n+\n@@ -80,0 +97,1 @@\n+            frame.setUndecorated(true);\n@@ -85,0 +103,1 @@\n+            frame.setLocation(loc);\n@@ -86,1 +105,1 @@\n-            frame.setLocation(tmp.x, tmp.y);\n+\n@@ -108,3 +127,1 @@\n-    private static void openPopup(final Frame frame) throws Exception {\n-        Robot robot = new Robot();\n-        robot.setAutoDelay(200);\n+    private static void openPopup(final Frame frame) {\n@@ -113,1 +130,3 @@\n-        robot.mouseMove(pt.x + frame.getWidth() \/ 2, pt.y + 50);\n+        int x = pt.x + frame.getWidth() \/ 2;\n+        int y = pt.y + OFFSET;\n+        robot.mouseMove(x, y);\n@@ -116,2 +135,2 @@\n-        int x = pt.x + frame.getWidth() \/ 2;\n-        int y = pt.y + 130;\n+        robot.delay(200);\n+        y += OFFSET;\n@@ -123,1 +142,4 @@\n-            throw new RuntimeException();\n+            captureScreen();\n+            throw new RuntimeException(\n+                    \"Failed, didn't receive the PopupMenu ActionEvent on \" +\n+                    \"frame= \" + frame + \", isFocused = \" + frame.isFocused());\n@@ -127,0 +149,11 @@\n+\n+    private static void captureScreen() {\n+        try {\n+            ImageIO.write(robot.createScreenCapture(screenBounds),\n+                          \"png\",\n+                          new File(\"screen.png\"));\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+        }\n+    }\n+\n","filename":"test\/jdk\/java\/awt\/PopupMenu\/PopupMenuLocation.java","additions":57,"deletions":24,"binary":false,"changes":81,"status":"modified"}]}