{"files":[{"patch":"@@ -32,1 +32,3 @@\n- *      ReplayCacheTestProc\n+ *      -Dtest.libs=J ReplayCacheTestProc\n+ * @run main\/othervm\/timeout=300 -Djdk.net.hosts.file=TestHosts\n+ *      -Dtest.libs=N ReplayCacheTestProc\n@@ -48,0 +50,1 @@\n+import jdk.test.lib.Asserts;\n@@ -56,1 +59,1 @@\n- * - test.libs on what types of acceptors to use\n+ * - test.libs on what types of acceptors to use. Cannot be null.\n@@ -58,1 +61,0 @@\n- *   Default: J,N on Solaris and Linux where N is available, or J\n@@ -128,0 +130,10 @@\n+            \/\/ User-provided libs\n+            String userLibs = System.getProperty(\"test.libs\");\n+            Asserts.assertNotNull(userLibs, \"test.libs property must be provided\");\n+            libs = userLibs.split(\",\");\n+            if (Arrays.asList(libs).contains(\"N\") && !isNativeLibAvailable()) {\n+                \/\/ Skip test when native GSS libs are not available in running platform\n+                System.out.println(\"Native mode not available - skipped\");\n+                return;\n+            }\n+\n@@ -145,19 +157,0 @@\n-            \/\/ User-provided libs\n-            String userLibs = System.getProperty(\"test.libs\");\n-\n-            if (userLibs != null) {\n-                libs = userLibs.split(\",\");\n-            } else {\n-                if (Platform.isOSX() || Platform.isWindows()) {\n-                    \/\/ macOS uses Heimdal and Windows has no native lib\n-                    libs = new String[]{\"J\"};\n-                } else {\n-                    if (acceptor(\"N\", \"sanity\").waitFor() != 0) {\n-                        Proc.d(\"Native mode sanity check failed, only java\");\n-                        libs = new String[]{\"J\"};\n-                    } else {\n-                        libs = new String[]{\"J\", \"N\"};\n-                    }\n-                }\n-            }\n-\n@@ -340,0 +333,7 @@\n+    \/\/ returns true if native lib is available in running platform\n+    \/\/ macOS uses Heimdal and Windows has no native lib\n+    private static boolean isNativeLibAvailable() throws Exception {\n+        return !Platform.isOSX() && !Platform.isWindows()\n+                && acceptor(\"N\", \"sanity\").waitFor() == 0;\n+    }\n+\n","filename":"test\/jdk\/sun\/security\/krb5\/auto\/ReplayCacheTestProc.java","additions":22,"deletions":22,"binary":false,"changes":44,"status":"modified"},{"patch":"@@ -35,1 +35,2 @@\n- *           -Dtest.service=host ReplayCacheTestProc\n+ *           -Dtest.service=host\n+ *           -Dtest.libs=J ReplayCacheTestProc\n","filename":"test\/jdk\/sun\/security\/krb5\/auto\/ReplayCacheTestProcWithMD5.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}