{"files":[{"patch":"@@ -171,1 +171,1 @@\n-  OUTPUT=`$3 $1 -version 2>&1`\n+  OUTPUT=`$3 $1 $USER_BOOT_JDK_OPTIONS -version 2>&1`\n","filename":"make\/autoconf\/basics.m4","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -77,1 +77,12 @@\n-          BOOT_JDK_VERSION=`\"$BOOT_JDK\/bin\/java\" -version 2>&1 | $HEAD -n 1`\n+          BOOT_JDK_VERSION=`\"$BOOT_JDK\/bin\/java\" $USER_BOOT_JDK_OPTIONS -version 2>&1 | $HEAD -n 1`\n+          if [ [[ \"$BOOT_JDK_VERSION\" =~ \"Picked up\" ]] ]; then\n+            AC_MSG_NOTICE([You have _JAVA_OPTIONS or JAVA_TOOL_OPTIONS set. This can mess up the build. Please use --with-boot-jdk-jvmargs instead.])\n+            AC_MSG_NOTICE([Java reports: \"$BOOT_JDK_VERSION\".])\n+            AC_MSG_ERROR([Cannot continue])\n+          fi\n+          if [ [[ \"$BOOT_JDK_VERSION\" =~ \"Unrecognized option\" ]] ]; then\n+            AC_MSG_NOTICE([The specified --with-boot-jdk-jvmargs is invalid for the tested java])\n+            AC_MSG_NOTICE([Error message: \"$BOOT_JDK_VERSION\".])\n+            AC_MSG_NOTICE([Please fix arguments, or point to an explicit boot JDK which accept these arguments])\n+            AC_MSG_ERROR([Cannot continue])\n+          fi\n@@ -93,1 +104,1 @@\n-            BOOT_JDK_VERSION=`\"$BOOT_JDK\/bin\/java\" -version 2>&1 | $TR '\\n\\r' '  '`\n+            BOOT_JDK_VERSION=`\"$BOOT_JDK\/bin\/java\" $USER_BOOT_JDK_OPTIONS -version 2>&1 | $TR '\\n\\r' '  '`\n@@ -286,0 +297,5 @@\n+  AC_ARG_WITH(boot-jdk-jvmargs, [AS_HELP_STRING([--with-boot-jdk-jvmargs],\n+  [specify additional arguments to be passed to Boot JDK tools @<:@none@:>@])])\n+\n+  USER_BOOT_JDK_OPTIONS=\"$with_boot_jdk_jvmargs\"\n+\n@@ -375,4 +391,0 @@\n-  AC_ARG_WITH(boot-jdk-jvmargs, [AS_HELP_STRING([--with-boot-jdk-jvmargs],\n-  [specify JVM arguments to be passed to all java invocations of boot JDK, overriding the default values,\n-  e.g --with-boot-jdk-jvmargs=\"-Xmx8G -enableassertions\"])])\n-\n@@ -392,2 +404,2 @@\n-  # Apply user provided options.\n-  ADD_JVM_ARG_IF_OK([$with_boot_jdk_jvmargs],boot_jdk_jvmargs,[$JAVA])\n+  # Finally append user provided options to allow them to override.\n+  ADD_JVM_ARG_IF_OK([$USER_BOOT_JDK_OPTIONS],boot_jdk_jvmargs,[$JAVA])\n","filename":"make\/autoconf\/boot-jdk.m4","additions":20,"deletions":8,"binary":false,"changes":28,"status":"modified"}]}