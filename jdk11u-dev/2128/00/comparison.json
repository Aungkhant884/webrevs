{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -42,2 +42,0 @@\n-import jdk.test.lib.Platform;\n-import jdk.test.lib.Utils;\n@@ -48,0 +46,3 @@\n+import jdk.test.lib.Platform;\n+import jdk.test.lib.Utils;\n+\n@@ -84,1 +85,0 @@\n-    @SuppressWarnings(\"raw_types\")\n@@ -163,5 +163,1 @@\n-                    if (info.user().isPresent()) {\n-                        String user = info.user().get();\n-                        Assert.assertNotNull(user, \"User name\");\n-                        Assert.assertEquals(user, whoami, \"User name\");\n-                    }\n+                    assertUser(info);\n@@ -294,5 +290,2 @@\n-                if (info.user().isPresent()) {\n-                    String user = info.user().get();\n-                    Assert.assertNotNull(user);\n-                    Assert.assertEquals(user, whoami);\n-                }\n+                assertUser(info);\n+\n@@ -400,1 +393,1 @@\n-                long x = r.nextLong();\n+                r.nextLong();\n@@ -413,0 +406,1 @@\n+\n@@ -446,0 +440,27 @@\n+\n+    \/**\n+     * Asserts the expected process user.\n+     *\n+     * The Expected user is determined by creating a file and reading its owner, see static block above.\n+     *\n+     * On Windows, when run privileged as member of the Administrators group, this does not always\n+     * work because new files can be owned by BUILTIN\\Administrators instead, depending on system\n+     * settings. In that case we resort to comparing System property user.name, which does not contain\n+     * the domain name, though.\n+     *\n+     * @param info ProcessHanlde info object\n+     *\/\n+    static void assertUser(ProcessHandle.Info info) {\n+        if (!info.user().isPresent()) {\n+            return;\n+        }\n+        String user = info.user().get();\n+        Assert.assertNotNull(user, \"User name\");\n+        if (Platform.isWindows() && \"BUILTIN\\\\Administrators\".equals(whoami)) {\n+            int bsi = user.lastIndexOf(\"\\\\\");\n+            Assert.assertEquals(bsi == -1 ? user : user.substring(bsi + 1),\n+                    System.getProperty(\"user.name\"), \"User name\");\n+        } else {\n+            Assert.assertEquals(user, whoami, \"User name\");\n+        }\n+    }\n","filename":"test\/jdk\/java\/lang\/ProcessHandle\/InfoTest.java","additions":36,"deletions":15,"binary":false,"changes":51,"status":"modified"}]}