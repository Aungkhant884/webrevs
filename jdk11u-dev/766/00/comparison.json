{"files":[{"patch":"@@ -1788,1 +1788,1 @@\n-  vmTestbase\/jit\/tiered\/TestDescription.java \\\n+  vmTestbase\/jit\/tiered\/Test.java \\\n","filename":"test\/hotspot\/jtreg\/TEST.quick-groups","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,76 @@\n+\/*\n+ * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\n+\/*\n+ * @test\n+ *\n+ * @summary converted from VM Testbase jit\/tiered.\n+ * VM Testbase keywords: [jit, quick]\n+ * VM Testbase readme:\n+ * Description\n+ *     The test verifies that JVM prints tiered events with -XX:+PrintTieredEvents\n+ *     for tiered compilation explicitly enabled with -XX:+TieredCompilation.\n+ *     If tiered compilation is explicitly disabled the test verifies that there are no\n+ *     output from PrintTieredEvents.\n+ *\n+ * @library \/vmTestbase\n+ *          \/test\/lib\n+ * @run driver vmTestbase.jit.tiered.Test\n+ *\/\n+\n+package vmTestbase.jit.tiered;\n+\n+import jtreg.SkippedException;\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n+\n+public class Test {\n+    private static String UNSUPPORTED_OPTION_MESSAGE = \"-XX:TieredCompilation not supported in this VM\";\n+    private static String REGEXP = \"^[0-9.]+: \\\\[compile level=\\\\d\";\n+    public static void main(String[] args) throws Exception {\n+        {\n+            System.out.println(\"TieredCompilation is enabled\");\n+            var pb = ProcessTools.createJavaProcessBuilder(true,\n+                    \"-XX:+TieredCompilation\",\n+                    \"-XX:+PrintTieredEvents\",\n+                    \"-version\");\n+            var output = new OutputAnalyzer(pb.start());\n+            if (output.getStdout().contains(UNSUPPORTED_OPTION_MESSAGE)) {\n+                throw new SkippedException(UNSUPPORTED_OPTION_MESSAGE);\n+            }\n+            output.shouldHaveExitValue(0)\n+                  .stdoutShouldMatch(REGEXP);\n+        }\n+        {\n+            System.out.println(\"TieredCompilation is disabled\");\n+            var pb = ProcessTools.createJavaProcessBuilder(true,\n+                    \"-XX:-TieredCompilation\",\n+                    \"-XX:+PrintTieredEvents\",\n+                    \"-version\");\n+            var output = new OutputAnalyzer(pb.start())\n+                    .shouldHaveExitValue(0)\n+                    .stdoutShouldNotMatch(REGEXP);\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/jit\/tiered\/Test.java","additions":76,"deletions":0,"binary":false,"changes":76,"status":"added"},{"patch":"@@ -1,42 +0,0 @@\n-\/*\n- * Copyright (c) 2017, 2018, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\n-\/*\n- * @test\n- *\n- * @summary converted from VM Testbase jit\/tiered.\n- * VM Testbase keywords: [jit, quick]\n- * VM Testbase readme:\n- * Description\n- *     The test verifies that JVM prints tiered events with -XX:+PrintTieredEvents\n- *     for tiered compilation explicitly enabled with -XX:+TieredCompilation.\n- *     If tiered compilation is explicitly disabled the test verifies that there are no\n- *     output from PrintTieredEvents.\n- *\n- * @library \/vmTestbase\n- *          \/test\/lib\n- * @run driver jdk.test.lib.FileInstaller . .\n- * @run shell tieredTest.sh\n- *\/\n-\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/jit\/tiered\/TestDescription.java","additions":0,"deletions":42,"binary":false,"changes":42,"status":"deleted"},{"patch":"@@ -1,70 +0,0 @@\n-#!\/bin\/bash\n-#\n-# Copyright (c) 2012, 2018, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-JAVA_OPTS=\"$TESTJAVAOPTS $TESTVMOPTS\"\n-JAVA=\"$TESTJAVA\/bin\/java\"\n-\n-log=output.txt\n-tiered=\"off\"\n-\n-if echo \"$JAVA_OPTS\" | grep \"[-]XX:+TieredCompilation\"; then\n-    tiered=\"on\"\n-elif echo \"$JAVA_OPTS\" | grep \"[-]XX:-TieredCompilation\"; then\n-    tiered=\"off\"\n-else\n-    echo \"TEST PASSED: TieredCompilation option is not specified. Nothing to test\"\n-    exit 0\n-fi\n-\n-echo \"Tiered is ${tiered}\"\n-\n-$JAVA $JAVA_OPTS -XX:+PrintTieredEvents -version >$log 2>&1\n-\n-if grep \"Client VM\" $log; then\n-    echo \"TEST PASSED: Client VM. The test is useless\"\n-    exit 0\n-fi\n-\n-if grep \"TieredCompilation not supported in this VM\" $log; then\n-    echo \"TEST PASSED: Non-tiered Server VM. The test is useless\"\n-    exit 0\n-fi\n-\n-if ! egrep '^[0-9.]+: \\[compile level=[0-9]' $log; then\n-    if [ \"${tiered}\" == \"on\" ]; then\n-        echo \"TEST FAILED: No PrintTieredEvents output\"\n-        exit 2\n-    else\n-        echo \"TEST PASSED: No events with TieredCompilation turned off\"\n-        exit 0\n-    fi\n-else\n-    if [ \"${tiered}\" == \"off\" ]; then\n-        echo \"TEST FAILED: PrintTieredEvents output found but TieredCompilation is turned off\"\n-        exit 2\n-    else\n-        echo \"TEST PASSED: PrintTieredEvents output found\"\n-        exit 0\n-    fi\n-fi\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/jit\/tiered\/tieredTest.sh","additions":0,"deletions":70,"binary":false,"changes":70,"status":"deleted"}]}