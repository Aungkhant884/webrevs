{"files":[{"patch":"@@ -50,2 +50,2 @@\n-        try (Reactor r = new Reactor();\n-             Actor a = new Actor(r.getSocketAddress())\n+        try (Responder r = new Responder();\n+             Initiator a = new Initiator(r.getSocketAddress())\n@@ -78,2 +78,15 @@\n-    public static class Actor implements AutoCloseable, Runnable {\n-        final SocketAddress socketAddress;\n+    private static SocketAddress toConnectAddress(SocketAddress address) {\n+        if (address instanceof InetSocketAddress) {\n+            var inet = (InetSocketAddress) address;\n+            if (inet.getAddress().isAnyLocalAddress()) {\n+                \/\/ if the peer is bound to the wildcard address, use\n+                \/\/ the loopback address to connect.\n+                var loopback = InetAddress.getLoopbackAddress();\n+                return new InetSocketAddress(loopback, inet.getPort());\n+            }\n+        }\n+        return address;\n+    }\n+\n+    public static class Initiator implements AutoCloseable, Runnable {\n+        final SocketAddress connectSocketAddress;\n@@ -82,2 +95,2 @@\n-        Actor(SocketAddress socketAddress) throws IOException {\n-            this.socketAddress = socketAddress;\n+        Initiator(SocketAddress peerSocketAddress) throws IOException {\n+            this.connectSocketAddress = toConnectAddress(peerSocketAddress);\n@@ -92,1 +105,2 @@\n-                dc.connect(socketAddress);\n+                log.println(\"Initiator connecting to \" + connectSocketAddress);\n+                dc.connect(connectSocketAddress);\n@@ -95,1 +109,1 @@\n-                log.println(\"Actor attempting to write to Reactor at \" + socketAddress.toString());\n+                log.println(\"Initiator attempting to write to Responder at \" + connectSocketAddress.toString());\n@@ -103,1 +117,1 @@\n-                    log.println(\"Testing if Actor throws AlreadyConnectedException\" + otherAddress.toString());\n+                    log.println(\"Testing if Initiator throws AlreadyConnectedException\" + otherAddress.toString());\n@@ -105,1 +119,1 @@\n-                    throw new RuntimeException(\"Actor allowed send to other address while already connected\");\n+                    throw new RuntimeException(\"Initiator allowed send to other address while already connected\");\n@@ -112,1 +126,1 @@\n-                log.println(\"Actor waiting to read\");\n+                log.println(\"Initiator waiting to read\");\n@@ -117,1 +131,1 @@\n-                log.println(\"Actor received from Reactor at \" + socketAddress + \": \" + cb);\n+                log.println(\"Initiator received from Responder at \" + connectSocketAddress + \": \" + cb);\n@@ -119,1 +133,1 @@\n-                log.println(\"Actor threw exception: \" + ex);\n+                log.println(\"Initiator threw exception: \" + ex);\n@@ -122,1 +136,1 @@\n-                log.println(\"Actor finished\");\n+                log.println(\"Initiator finished\");\n@@ -132,1 +146,1 @@\n-    public static class Reactor implements AutoCloseable, Runnable {\n+    public static class Responder implements AutoCloseable, Runnable {\n@@ -135,2 +149,3 @@\n-        Reactor() throws IOException {\n-            dc = DatagramChannel.open().bind(new InetSocketAddress(InetAddress.getLoopbackAddress(), 0));\n+        Responder() throws IOException {\n+            var address = new InetSocketAddress(InetAddress.getLoopbackAddress(), 0);\n+            dc = DatagramChannel.open().bind(address);\n@@ -147,1 +162,1 @@\n-                log.println(\"Reactor waiting to receive\");\n+                log.println(\"Responder waiting to receive\");\n@@ -152,1 +167,1 @@\n-                log.println(\"Reactor received from Actor at\" + sa +  \": \" + cb);\n+                log.println(\"Responder received from Initiator at\" + sa +  \": \" + cb);\n@@ -157,1 +172,1 @@\n-                log.println(\"Reactor attempting to write: \" + dc.getRemoteAddress().toString());\n+                log.println(\"Responder attempting to write: \" + dc.getRemoteAddress().toString());\n@@ -160,1 +175,1 @@\n-                log.println(\"Reactor threw exception: \" + ex);\n+                log.println(\"Responder threw exception: \" + ex);\n@@ -163,1 +178,1 @@\n-                log.println(\"Reactor finished\");\n+                log.println(\"Responder finished\");\n","filename":"test\/jdk\/java\/nio\/channels\/DatagramChannel\/Connect.java","additions":37,"deletions":22,"binary":false,"changes":59,"status":"modified"}]}