{"files":[{"patch":"@@ -177,0 +177,17 @@\n+JNIEXPORT jboolean JNICALL\n+Java_nsk_jvmti_scenarios_hotswap_HS203_hs203t003_hs203t003_isSuspended(JNIEnv * jni,\n+        jclass clas,\n+        jthread thread) {\n+    jboolean retvalue;\n+    jint state;\n+    retvalue = JNI_FALSE;\n+    if ( ! NSK_JVMTI_VERIFY( NSK_CPP_STUB3(GetThreadState, jvmti, thread, &state) )  ) {\n+        nsk_printf(\" Agent :: Error while getting thread state.\\n\");\n+        nsk_jvmti_agentFailed();\n+    } else {\n+        if ( state & JVMTI_THREAD_STATE_SUSPENDED) {\n+          retvalue = JNI_TRUE;\n+        }\n+    }\n+    return retvalue;\n+}\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/scenarios\/hotswap\/HS203\/hs203t003\/hs203t003.cpp","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -65,1 +65,2 @@\n-        public native boolean resumeThread(Thread thread);\n+    public native boolean isSuspended(Thread thread);\n+    public native boolean resumeThread(Thread thread);\n@@ -85,2 +86,2 @@\n-            \/\/ check if we can can pop the thread.\n-            \/\/ we can not do redefine\/pop frame on run method.\n+            \/\/ Check if we can can pop the thread.\n+            \/\/ We can not do redefine\/pop frame on run method.\n@@ -88,1 +89,1 @@\n-            \/\/ sleep for some few secs to get redefined.\n+            \/\/ Sleep for some few secs to get redefined.\n@@ -96,2 +97,19 @@\n-            popThreadFrame(mt); \/\/ pop the frame.\n-            resumeThread(mt);   \/\/ resume the thread.\n+            \/\/ Wait for the thread to be suspended.\n+            while (!isSuspended(mt)) {\n+                if (!agentStatus()) {\n+                    System.out.println(\"Failed to suspend thread\");\n+                    return passed;\n+                }\n+                Thread.sleep(100);\n+            }\n+            \/\/ Pop the frame.\n+            if (!popThreadFrame(mt)) {\n+                System.out.println(\"Failed to pop a frame = \"\n+                                   + mt.threadState);\n+            }\n+            \/\/ Resume the thread.\n+            if(!resumeThread(mt)) {\n+                System.out.println(\"Failed to resume the thread = \"\n+                                   + mt.threadState);\n+            }\n+            \/\/ Wait till the other thread completes its execution.\n@@ -99,1 +117,0 @@\n-            \/\/ wait till the other thread completes its execution.\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/scenarios\/hotswap\/HS203\/hs203t003\/hs203t003.java","additions":24,"deletions":7,"binary":false,"changes":31,"status":"modified"}]}