{"files":[{"patch":"@@ -211,2 +211,2 @@\n-lib_info* add_lib_info(struct ps_prochandle* ph, const char* libname, uintptr_t base, size_t memsz) {\n-  return add_lib_info_fd(ph, libname, -1, base, memsz);\n+lib_info* add_lib_info(struct ps_prochandle* ph, const char* libname, uintptr_t base) {\n+  return add_lib_info_fd(ph, libname, -1, base);\n@@ -215,2 +215,2 @@\n-lib_info* add_lib_info_fd(struct ps_prochandle* ph, const char* libname, int fd, uintptr_t base, size_t memsz) {\n-   lib_info* newlib;\n+lib_info* add_lib_info_fd(struct ps_prochandle* ph, const char* libname, int fd, uintptr_t base) {\n+  lib_info* newlib;\n@@ -232,1 +232,0 @@\n-  newlib->memsz = memsz;\n@@ -262,1 +261,1 @@\n-  newlib->symtab = build_symtab(newlib->fd);\n+  newlib->symtab = build_symtab(newlib->fd, &newlib->memsz);\n@@ -266,1 +265,1 @@\n-    print_debug(\"built symbol table for 0x%lx %s\\n\", newlib, newlib->name);\n+    print_debug(\"built symbol table for 0x%lx memsz=0x%lx %s\\n\", newlib, newlib->memsz, newlib->name);\n","filename":"src\/jdk.hotspot.agent\/macosx\/native\/libsaproc\/libproc_impl.c","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -50,0 +50,1 @@\n+#include <mach-o\/stab.h>\n@@ -228,1 +229,1 @@\n-lib_info* add_lib_info(struct ps_prochandle* ph, const char* libname, uintptr_t base, size_t memsz);\n+lib_info* add_lib_info(struct ps_prochandle* ph, const char* libname, uintptr_t base);\n@@ -231,2 +232,1 @@\n-lib_info* add_lib_info_fd(struct ps_prochandle* ph, const char* libname, int fd,\n-                          uintptr_t base, size_t memsz);\n+lib_info* add_lib_info_fd(struct ps_prochandle* ph, const char* libname, int fd, uintptr_t base);\n","filename":"src\/jdk.hotspot.agent\/macosx\/native\/libsaproc\/libproc_impl.h","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -968,1 +968,1 @@\n-          add_lib_info(ph, name, iter->vaddr, iter->memsz);\n+          add_lib_info(ph, name, iter->vaddr);\n","filename":"src\/jdk.hotspot.agent\/macosx\/native\/libsaproc\/ps_core.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -96,1 +96,1 @@\n-struct symtab* build_symtab(int fd) {\n+struct symtab* build_symtab(int fd, size_t *p_max_offset) {\n@@ -101,0 +101,1 @@\n+  size_t max_offset = 0;\n@@ -190,0 +191,5 @@\n+    if (lentry.n_type == N_OSO) {\n+      \/\/ This is an object file name\/path. These entries have something other than\n+      \/\/ an offset in lentry.n_value, so we need to ignore them.\n+      continue;\n+    }\n@@ -198,0 +204,5 @@\n+    \/\/ Track the maximum offset we've seen. This is used to determine the address range\n+    \/\/ that the library covers.\n+    if (offset > max_offset) {\n+      max_offset = (offset + 4096) & ~0xfff; \/\/ Round up to next page boundary\n+    }\n@@ -215,0 +226,1 @@\n+  *p_max_offset = max_offset;\n","filename":"src\/jdk.hotspot.agent\/macosx\/native\/libsaproc\/symtab.c","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,1 +35,1 @@\n-struct symtab* build_symtab(int fd);\n+struct symtab* build_symtab(int fd, size_t *p_max_offset);\n","filename":"src\/jdk.hotspot.agent\/macosx\/native\/libsaproc\/symtab.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}