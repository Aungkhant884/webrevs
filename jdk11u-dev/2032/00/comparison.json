{"files":[{"patch":"@@ -974,0 +974,20 @@\n+\/\/ Class for 128 bit register v4\n+reg_class v4_reg(\n+    V4, V4_H\n+);\n+\n+\/\/ Class for 128 bit register v5\n+reg_class v5_reg(\n+    V5, V5_H\n+);\n+\n+\/\/ Class for 128 bit register v6\n+reg_class v6_reg(\n+    V6, V6_H\n+);\n+\n+\/\/ Class for 128 bit register v7\n+reg_class v7_reg(\n+    V7, V7_H\n+);\n+\n@@ -4887,0 +4907,36 @@\n+operand vRegD_V4()\n+%{\n+  constraint(ALLOC_IN_RC(v4_reg));\n+  match(RegD);\n+  op_cost(0);\n+  format %{ %}\n+  interface(REG_INTER);\n+%}\n+\n+operand vRegD_V5()\n+%{\n+  constraint(ALLOC_IN_RC(v5_reg));\n+  match(RegD);\n+  op_cost(0);\n+  format %{ %}\n+  interface(REG_INTER);\n+%}\n+\n+operand vRegD_V6()\n+%{\n+  constraint(ALLOC_IN_RC(v6_reg));\n+  match(RegD);\n+  op_cost(0);\n+  format %{ %}\n+  interface(REG_INTER);\n+%}\n+\n+operand vRegD_V7()\n+%{\n+  constraint(ALLOC_IN_RC(v7_reg));\n+  match(RegD);\n+  op_cost(0);\n+  format %{ %}\n+  interface(REG_INTER);\n+%}\n+\n@@ -15393,2 +15449,3 @@\n-       iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3,\n-       iRegINoSp tmp4, iRegINoSp tmp5, iRegINoSp tmp6, rFlagsReg cr)\n+                          iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2,\n+                          iRegINoSp tmp3, iRegINoSp tmp4, iRegINoSp tmp5, iRegINoSp tmp6,\n+                          vRegD_V0 vtmp0, vRegD_V1 vtmp1, rFlagsReg cr)\n@@ -15399,2 +15456,4 @@\n-         TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, TEMP tmp5, TEMP tmp6, KILL cr);\n-  format %{ \"String IndexOf $str1,$cnt1,$str2,$cnt2 -> $result (UU)\" %}\n+         TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, TEMP tmp5, TEMP tmp6,\n+         TEMP vtmp0, TEMP vtmp1, KILL cr);\n+  format %{ \"String IndexOf $str1,$cnt1,$str2,$cnt2 -> $result (UU) \"\n+            \"# KILL $str1 $cnt1 $str2 $cnt2 $tmp1 $tmp2 $tmp3 $tmp4 $tmp5 $tmp6 V0-V1 cr\" %}\n@@ -15414,2 +15473,3 @@\n-       iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3,\n-       iRegINoSp tmp4, iRegINoSp tmp5, iRegINoSp tmp6, rFlagsReg cr)\n+                          iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3,\n+                          iRegINoSp tmp4, iRegINoSp tmp5, iRegINoSp tmp6,\n+                          vRegD_V0 vtmp0, vRegD_V1 vtmp1, rFlagsReg cr)\n@@ -15420,2 +15480,4 @@\n-         TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, TEMP tmp5, TEMP tmp6, KILL cr);\n-  format %{ \"String IndexOf $str1,$cnt1,$str2,$cnt2 -> $result (LL)\" %}\n+         TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, TEMP tmp5, TEMP tmp6,\n+         TEMP vtmp0, TEMP vtmp1, KILL cr);\n+  format %{ \"String IndexOf $str1,$cnt1,$str2,$cnt2 -> $result (LL) \"\n+            \"# KILL $str1 $cnt1 $str2 $cnt2 $tmp1 $tmp2 $tmp3 $tmp4 $tmp5 $tmp6 V0-V1 cr\" %}\n@@ -15435,2 +15497,3 @@\n-       iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3,\n-       iRegINoSp tmp4, iRegINoSp tmp5, iRegINoSp tmp6, rFlagsReg cr)\n+                          iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2, iRegINoSp tmp3,\n+                          iRegINoSp tmp4, iRegINoSp tmp5, iRegINoSp tmp6,\n+                          vRegD_V0 vtmp0, vRegD_V1 vtmp1, rFlagsReg cr)\n@@ -15441,2 +15504,4 @@\n-         TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, TEMP tmp5, TEMP tmp6, KILL cr);\n-  format %{ \"String IndexOf $str1,$cnt1,$str2,$cnt2 -> $result (UL)\" %}\n+         TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, TEMP tmp5,\n+         TEMP tmp6, TEMP vtmp0, TEMP vtmp1, KILL cr);\n+  format %{ \"String IndexOf $str1,$cnt1,$str2,$cnt2 -> $result (UL) \"\n+            \"# KILL $str1 cnt1 $str2 $cnt2 $tmp1 $tmp2 $tmp3 $tmp4 $tmp5 $tmp6 V0-V1 cr\" %}\n@@ -15456,2 +15521,2 @@\n-                 immI_le_4 int_cnt2, iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2,\n-                 iRegINoSp tmp3, iRegINoSp tmp4, rFlagsReg cr)\n+                              immI_le_4 int_cnt2, iRegI_R0 result, iRegINoSp tmp1,\n+                              iRegINoSp tmp2, iRegINoSp tmp3, iRegINoSp tmp4, rFlagsReg cr)\n@@ -15463,1 +15528,2 @@\n-  format %{ \"String IndexOf $str1,$cnt1,$str2,$int_cnt2 -> $result (UU)\" %}\n+  format %{ \"String IndexOf $str1,$cnt1,$str2,$int_cnt2 -> $result (UU) \"\n+            \"# KILL $str1 $cnt1 $str2 $tmp1 $tmp2 $tmp3 $tmp4 cr\" %}\n@@ -15477,2 +15543,2 @@\n-                 immI_le_4 int_cnt2, iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2,\n-                 iRegINoSp tmp3, iRegINoSp tmp4, rFlagsReg cr)\n+                              immI_le_4 int_cnt2, iRegI_R0 result, iRegINoSp tmp1,\n+                              iRegINoSp tmp2, iRegINoSp tmp3, iRegINoSp tmp4, rFlagsReg cr)\n@@ -15484,1 +15550,2 @@\n-  format %{ \"String IndexOf $str1,$cnt1,$str2,$int_cnt2 -> $result (LL)\" %}\n+  format %{ \"String IndexOf $str1,$cnt1,$str2,$int_cnt2 -> $result (LL) \"\n+            \"# KILL $str1 $cnt1 $str2 $tmp1 $tmp2 $tmp3 $tmp4 cr\" %}\n@@ -15498,2 +15565,2 @@\n-                 immI_1 int_cnt2, iRegI_R0 result, iRegINoSp tmp1, iRegINoSp tmp2,\n-                 iRegINoSp tmp3, iRegINoSp tmp4, rFlagsReg cr)\n+                              immI_1 int_cnt2, iRegI_R0 result, iRegINoSp tmp1,\n+                              iRegINoSp tmp2, iRegINoSp tmp3, iRegINoSp tmp4, rFlagsReg cr)\n@@ -15505,1 +15572,2 @@\n-  format %{ \"String IndexOf $str1,$cnt1,$str2,$int_cnt2 -> $result (UL)\" %}\n+  format %{ \"String IndexOf $str1,$cnt1,$str2,$int_cnt2 -> $result (UL) \"\n+            \"# KILL $str1 $cnt1 $str2 $tmp1 $tmp2 $tmp3 $tmp4 cr\" %}\n@@ -15570,0 +15638,2 @@\n+                       vRegD_V0 vtmp0, vRegD_V1 vtmp1, vRegD_V2 vtmp2, vRegD_V3 vtmp3,\n+                       vRegD_V4 vtmp4, vRegD_V5 vtmp5, vRegD_V6 vtmp6, vRegD_V7 vtmp7,\n@@ -15574,1 +15644,3 @@\n-  effect(KILL tmp, USE_KILL ary1, USE_KILL ary2, TEMP tmp1, TEMP tmp2, TEMP tmp3, KILL cr);\n+  effect(KILL tmp, USE_KILL ary1, USE_KILL ary2, TEMP tmp1, TEMP tmp2, TEMP tmp3,\n+         TEMP vtmp0, TEMP vtmp1, TEMP vtmp2, TEMP vtmp3, TEMP vtmp4, TEMP vtmp5,\n+         TEMP vtmp6, TEMP vtmp7, KILL cr);\n@@ -15576,1 +15648,1 @@\n-  format %{ \"Array Equals $ary1,ary2 -> $result    \/\/ KILL $tmp\" %}\n+  format %{ \"Array Equals $ary1,ary2 -> $result # KILL $ary1 $ary2 $tmp $tmp1 $tmp2 $tmp3 V0-V7 cr\" %}\n@@ -15591,0 +15663,2 @@\n+                       vRegD_V0 vtmp0, vRegD_V1 vtmp1, vRegD_V2 vtmp2, vRegD_V3 vtmp3,\n+                       vRegD_V4 vtmp4, vRegD_V5 vtmp5, vRegD_V6 vtmp6, vRegD_V7 vtmp7,\n@@ -15595,1 +15669,3 @@\n-  effect(KILL tmp, USE_KILL ary1, USE_KILL ary2, TEMP tmp1, TEMP tmp2, TEMP tmp3, KILL cr);\n+  effect(KILL tmp, USE_KILL ary1, USE_KILL ary2, TEMP tmp1, TEMP tmp2, TEMP tmp3,\n+         TEMP vtmp0, TEMP vtmp1, TEMP vtmp2, TEMP vtmp3, TEMP vtmp4, TEMP vtmp5,\n+         TEMP vtmp6, TEMP vtmp7, KILL cr);\n@@ -15597,1 +15673,1 @@\n-  format %{ \"Array Equals $ary1,ary2 -> $result    \/\/ KILL $tmp\" %}\n+  format %{ \"Array Equals $ary1,ary2 -> $result # KILL $ary1 $ary2 $tmp $tmp1 $tmp2 $tmp3 V0-V7 cr\" %}\n@@ -15627,2 +15703,2 @@\n-                         vRegD_V0 tmp1, vRegD_V1 tmp2,\n-                         vRegD_V2 tmp3, vRegD_V3 tmp4,\n+                         vRegD_V0 vtmp0, vRegD_V1 vtmp1, vRegD_V2 vtmp2,\n+                         vRegD_V3 vtmp3, vRegD_V4 vtmp4, vRegD_V5 vtmp5,\n@@ -15632,1 +15708,2 @@\n-  effect(TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, USE_KILL src, USE_KILL dst, USE_KILL len, KILL cr);\n+  effect(TEMP vtmp0, TEMP vtmp1, TEMP vtmp2, TEMP vtmp3, TEMP vtmp4, TEMP vtmp5,\n+         USE_KILL src, USE_KILL dst, USE_KILL len, KILL cr);\n@@ -15634,1 +15711,1 @@\n-  format %{ \"String Compress $src,$dst -> $result    \/\/ KILL R1, R2, R3, R4\" %}\n+  format %{ \"String Compress $src,$dst -> $result # KILL $src $dst $len V0-V5 cr\" %}\n@@ -15637,2 +15714,3 @@\n-                           $tmp1$$FloatRegister, $tmp2$$FloatRegister,\n-                           $tmp3$$FloatRegister, $tmp4$$FloatRegister,\n+                           $vtmp0$$FloatRegister, $vtmp1$$FloatRegister,\n+                           $vtmp2$$FloatRegister, $vtmp3$$FloatRegister,\n+                           $vtmp4$$FloatRegister, $vtmp5$$FloatRegister,\n@@ -15645,2 +15723,3 @@\n-instruct string_inflate(Universe dummy, iRegP_R0 src, iRegP_R1 dst, iRegI_R2 len,\n-                        vRegD_V0 tmp1, vRegD_V1 tmp2, vRegD_V2 tmp3, iRegP_R3 tmp4, rFlagsReg cr)\n+instruct string_inflate(Universe dummy, iRegP_R0 src, iRegP_R1 dst, iRegI_R2 len, iRegP_R3 tmp,\n+                        vRegD_V0 vtmp0, vRegD_V1 vtmp1, vRegD_V2 vtmp2, vRegD_V3 vtmp3,\n+                        vRegD_V4 vtmp4, vRegD_V5 vtmp5, vRegD_V6 vtmp6, rFlagsReg cr)\n@@ -15649,1 +15728,3 @@\n-  effect(TEMP tmp1, TEMP tmp2, TEMP tmp3, TEMP tmp4, USE_KILL src, USE_KILL dst, USE_KILL len, KILL cr);\n+  effect(TEMP vtmp0, TEMP vtmp1, TEMP vtmp2, TEMP vtmp3,\n+         TEMP vtmp4, TEMP vtmp5, TEMP vtmp6, TEMP tmp,\n+         USE_KILL src, USE_KILL dst, USE_KILL len, KILL cr);\n@@ -15651,1 +15732,1 @@\n-  format %{ \"String Inflate $src,$dst    \/\/ KILL $tmp1, $tmp2\" %}\n+  format %{ \"String Inflate $src,$dst # KILL $tmp $src $dst $len V0-V6 cr\" %}\n@@ -15654,2 +15735,2 @@\n-                                        $tmp1$$FloatRegister, $tmp2$$FloatRegister,\n-                                        $tmp3$$FloatRegister, $tmp4$$Register);\n+                                        $vtmp0$$FloatRegister, $vtmp1$$FloatRegister,\n+                                        $vtmp2$$FloatRegister, $tmp$$Register);\n@@ -15666,2 +15747,2 @@\n-                          vRegD_V0 Vtmp1, vRegD_V1 Vtmp2,\n-                          vRegD_V2 Vtmp3, vRegD_V3 Vtmp4,\n+                          vRegD_V0 vtmp0, vRegD_V1 vtmp1, vRegD_V2 vtmp2,\n+                          vRegD_V3 vtmp3, vRegD_V4 vtmp4, vRegD_V5 vtmp5,\n@@ -15671,2 +15752,2 @@\n-  effect(USE_KILL src, USE_KILL dst, USE_KILL len,\n-         KILL Vtmp1, KILL Vtmp2, KILL Vtmp3, KILL Vtmp4, KILL cr);\n+  effect(USE_KILL src, USE_KILL dst, USE_KILL len, KILL vtmp0, KILL vtmp1,\n+         KILL vtmp2, KILL vtmp3, KILL vtmp4, KILL vtmp5, KILL cr);\n@@ -15674,1 +15755,1 @@\n-  format %{ \"Encode array $src,$dst,$len -> $result\" %}\n+  format %{ \"Encode array $src,$dst,$len -> $result # KILL $src $dst $len V0-V5 cr\" %}\n@@ -15677,2 +15758,3 @@\n-         $result$$Register, $Vtmp1$$FloatRegister,  $Vtmp2$$FloatRegister,\n-         $Vtmp3$$FloatRegister,  $Vtmp4$$FloatRegister);\n+                        $result$$Register, $vtmp0$$FloatRegister, $vtmp1$$FloatRegister,\n+                        $vtmp2$$FloatRegister, $vtmp3$$FloatRegister,\n+                        $vtmp4$$FloatRegister, $vtmp5$$FloatRegister);\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":126,"deletions":44,"binary":false,"changes":170,"status":"modified"},{"patch":"@@ -4335,0 +4335,1 @@\n+\/\/ Clobbers: rscratch1, rscratch2, rflags. May also clobber v0-v1, when icnt1==-1.\n@@ -5126,0 +5127,2 @@\n+\/\/ Clobbers: rscratch1, rscratch2, rflags\n+\/\/ May also clobber v0-v7 when (!UseSimpleArrayEquals && UseSIMDForArrayEquals)\n@@ -5618,0 +5621,2 @@\n+\/\/\n+\/\/ Clobbers: src, dst, res, rscratch1, rscratch2, rflags\n@@ -5619,3 +5624,4 @@\n-                      Register len, Register result,\n-                      FloatRegister Vtmp1, FloatRegister Vtmp2,\n-                      FloatRegister Vtmp3, FloatRegister Vtmp4)\n+                                      Register len, Register result,\n+                                      FloatRegister Vtmp1, FloatRegister Vtmp2,\n+                                      FloatRegister Vtmp3, FloatRegister Vtmp4,\n+                                      FloatRegister Vtmp5, FloatRegister Vtmp6)\n@@ -5644,2 +5650,2 @@\n-          orr(v4, T16B, Vtmp1, Vtmp2);\n-          orr(v5, T16B, Vtmp3, Vtmp4);\n+          orr(Vtmp5, T16B, Vtmp1, Vtmp2);\n+          orr(Vtmp6, T16B, Vtmp3, Vtmp4);\n@@ -5648,3 +5654,3 @@\n-          uzp2(v5, T16B, v4, v5); \/\/ high bytes\n-          umov(tmp2, v5, D, 1);\n-          fmovd(tmp1, v5);\n+          uzp2(Vtmp6, T16B, Vtmp5, Vtmp6); \/\/ high bytes\n+          umov(tmp2, Vtmp6, D, 1);\n+          fmovd(tmp1, Vtmp6);\n@@ -5669,2 +5675,2 @@\n-      uzp1(v4, T16B, Vtmp1, Vtmp2);\n-      uzp1(v5, T16B, Vtmp3, Vtmp4);\n+      uzp1(Vtmp5, T16B, Vtmp1, Vtmp2);\n+      uzp1(Vtmp6, T16B, Vtmp3, Vtmp4);\n@@ -5678,1 +5684,1 @@\n-      stpq(v4, v5, dst);\n+      stpq(Vtmp5, Vtmp6, dst);\n@@ -5723,0 +5729,1 @@\n+\/\/ Clobbers: src, dst, len, rflags, rscratch1, v0-v6\n@@ -5831,0 +5838,1 @@\n+                                         FloatRegister tmp5Reg, FloatRegister tmp6Reg,\n@@ -5833,1 +5841,1 @@\n-                   tmp1Reg, tmp2Reg, tmp3Reg, tmp4Reg);\n+                   tmp1Reg, tmp2Reg, tmp3Reg, tmp4Reg, tmp5Reg, tmp6Reg);\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp","additions":20,"deletions":12,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -1248,0 +1248,1 @@\n+                           FloatRegister tmp5Reg, FloatRegister tmp6Reg,\n@@ -1253,1 +1254,2 @@\n-                        FloatRegister Vtmp3, FloatRegister Vtmp4);\n+                        FloatRegister Vtmp3, FloatRegister Vtmp4,\n+                        FloatRegister Vtmp5, FloatRegister Vtmp6);\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4102,0 +4102,1 @@\n+  \/\/ Clobbers: v0-v7 when UseSIMDForArrayEquals, rscratch1, rscratch2\n@@ -4506,0 +4507,2 @@\n+  \/\/ Clobbers: rscratch1, rscratch2, v0, v1, rflags\n+  \/\/\n@@ -4820,0 +4823,1 @@\n+  \/\/ Clobbers: r0, r1, r3, rscratch1, rflags, v0-v6\n","filename":"src\/hotspot\/cpu\/aarch64\/stubGenerator_aarch64.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,296 @@\n+\/*\n+ * Copyright (c) 2023, Arm Limited. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8307572\n+ * @summary Verify vector register clobbering in some aarch64 intrinsics\n+ * @library \/compiler\/patches \/test\/lib\n+ * @build java.base\/java.lang.Helper\n+ * @run main\/othervm -Xbatch -XX:CompileThreshold=100 -XX:-TieredCompilation compiler.c2.aarch64.TestIntrinsicsRegStress\n+ *\/\n+\n+package compiler.c2.aarch64;\n+\n+import java.util.Arrays;\n+\n+public class TestIntrinsicsRegStress {\n+\n+    final int LENGTH = 1024;\n+    final int ITER = 10000;\n+    final int NUM = 32;\n+\n+    byte[] ba;\n+    char[] ca;\n+    char[] cb;\n+    float[] fv;\n+\n+    String str;\n+    String[] strings;\n+    String needle = \"01234567890123456789\";\n+\n+    public void init() {\n+        ca = new char[LENGTH];\n+        fv = new float[NUM];\n+        strings = new String[NUM];\n+        for (int i = 0; i < LENGTH; i++) {\n+            ca[i] = (char) ('a' + i % NUM);\n+        }\n+        cb = ca.clone();\n+        str = new String(ca);\n+        for (int i = 0; i < NUM; i++) {\n+            fv[i] = 1;\n+        }\n+        for (int i = 0; i < NUM; i++) {\n+            strings[i] = str.substring(i) + needle;\n+        }\n+    }\n+\n+    public void checkIndexOf(int iter) {\n+        float t0 = 0;\n+        float t1 = fv[1] * fv[0];\n+        float t2 = fv[2] * fv[0];\n+        float t3 = fv[3] * fv[0];\n+        float t4 = fv[4] * fv[0];\n+        float t5 = fv[5] * fv[0];\n+        float t6 = fv[6] * fv[0];\n+        float t7 = fv[7] * fv[0];\n+        float t8 = fv[8] * fv[0];\n+        float t9 = fv[9] * fv[0];\n+        float t10 = fv[10] * fv[0];\n+        float t11 = fv[11] * fv[0];\n+        float t12 = fv[12] * fv[0];\n+        float t13 = fv[13] * fv[0];\n+        float t14 = fv[14] * fv[0];\n+        float t15 = fv[15] * fv[0];\n+        float t16 = fv[16] * fv[0];\n+        float t17 = fv[17] * fv[0];\n+        float t18 = fv[18] * fv[0];\n+        float t19 = fv[19] * fv[0];\n+        float t20 = fv[20] * fv[0];\n+        float t21 = fv[21] * fv[0];\n+        float t22 = fv[22] * fv[0];\n+        float t23 = fv[23] * fv[0];\n+        float t24 = fv[24] * fv[0];\n+        float t25 = fv[25] * fv[0];\n+        float t26 = fv[26] * fv[0];\n+        float t27 = fv[27] * fv[0];\n+        float t28 = fv[28] * fv[0];\n+        float t29 = fv[29] * fv[0];\n+        float t30 = fv[30] * fv[0];\n+\n+        int result = strings[iter % NUM].indexOf(needle);\n+\n+        if (result > LENGTH - NUM \/ 2) {\n+            \/\/ Use fp registers as many as possible and try to make them\n+            \/\/ live across above intrinsic function.\n+            t0 += t1 - t2 + t3 - t4 + t5 - t6 + t7 - t8 + t9 - t10 + t11 - t12 + t13 - t14 + t15\n+                    - t16 + t17 - t18 + t19 - t20 + t21 - t22 + t23 - t24 + t25 - t26 + t27 - t28\n+                    + t29 - t30; \/\/ 0\n+        }\n+        fv[31] += t0 + t2 - t11 + t16 - t29;\n+    }\n+\n+    public void testIndexOf() {\n+        for (int i = 0; i < ITER; i++) {\n+            checkIndexOf(i);\n+        }\n+    }\n+\n+    public void checkArraysEquals() {\n+        float t0 = 0;\n+        float t1 = fv[1] * fv[0];\n+        float t2 = fv[2] * fv[0];\n+        float t3 = fv[3] * fv[0];\n+        float t4 = fv[4] * fv[0];\n+        float t5 = fv[5] * fv[0];\n+        float t6 = fv[6] * fv[0];\n+        float t7 = fv[7] * fv[0];\n+        float t8 = fv[8] * fv[0];\n+        float t9 = fv[9] * fv[0];\n+        float t10 = fv[10] * fv[0];\n+        float t11 = fv[11] * fv[0];\n+        float t12 = fv[12] * fv[0];\n+        float t13 = fv[13] * fv[0];\n+        float t14 = fv[14] * fv[0];\n+        float t15 = fv[15] * fv[0];\n+        float t16 = fv[16] * fv[0];\n+        float t17 = fv[17] * fv[0];\n+        float t18 = fv[18] * fv[0];\n+        float t19 = fv[19] * fv[0];\n+        float t20 = fv[20] * fv[0];\n+        float t21 = fv[21] * fv[0];\n+        float t22 = fv[22] * fv[0];\n+        float t23 = fv[23] * fv[0];\n+        float t24 = fv[24] * fv[0];\n+        float t25 = fv[25] * fv[0];\n+        float t26 = fv[26] * fv[0];\n+        float t27 = fv[27] * fv[0];\n+        float t28 = fv[28] * fv[0];\n+        float t29 = fv[29] * fv[0];\n+        float t30 = fv[30] * fv[0];\n+\n+        if (Arrays.equals(ca, cb)) {\n+            \/\/ Use fp registers as many as possible and try to make them\n+            \/\/ live across above intrinsic function.\n+            t0 += t1 - t2 + t3 - t4 + t5 - t6 + t7 - t8 + t9 - t10 + t11 - t12 + t13 - t14 + t15\n+                    - t16 + t17 - t18 + t19 - t20 + t21 - t22 + t23 - t24 + t25 - t26 + t27 - t28\n+                    + t29 - t30; \/\/ 0\n+        }\n+        fv[31] += t0 + t2 - t11 + t16 - t29;\n+    }\n+\n+    public void testArraysEquals() {\n+        for (int i = 0; i < ITER; i++) {\n+            checkArraysEquals();\n+        }\n+    }\n+\n+    public void checkCompress(int iter) {\n+        float t0 = 0;\n+        float t1 = fv[1] * fv[0];\n+        float t2 = fv[2] * fv[0];\n+        float t3 = fv[3] * fv[0];\n+        float t4 = fv[4] * fv[0];\n+        float t5 = fv[5] * fv[0];\n+        float t6 = fv[6] * fv[0];\n+        float t7 = fv[7] * fv[0];\n+        float t8 = fv[8] * fv[0];\n+        float t9 = fv[9] * fv[0];\n+        float t10 = fv[10] * fv[0];\n+        float t11 = fv[11] * fv[0];\n+        float t12 = fv[12] * fv[0];\n+        float t13 = fv[13] * fv[0];\n+        float t14 = fv[14] * fv[0];\n+        float t15 = fv[15] * fv[0];\n+        float t16 = fv[16] * fv[0];\n+        float t17 = fv[17] * fv[0];\n+        float t18 = fv[18] * fv[0];\n+        float t19 = fv[19] * fv[0];\n+        float t20 = fv[20] * fv[0];\n+        float t21 = fv[21] * fv[0];\n+        float t22 = fv[22] * fv[0];\n+        float t23 = fv[23] * fv[0];\n+        float t24 = fv[24] * fv[0];\n+        float t25 = fv[25] * fv[0];\n+        float t26 = fv[26] * fv[0];\n+        float t27 = fv[27] * fv[0];\n+        float t28 = fv[28] * fv[0];\n+        float t29 = fv[29] * fv[0];\n+        float t30 = fv[30] * fv[0];\n+\n+        ba = Helper.compressChar(ca, 0, LENGTH, 0, LENGTH);\n+\n+        if (ba[iter % LENGTH] > (byte) ('a' + 5)) {\n+            \/\/ Use fp registers as many as possible and try to make them\n+            \/\/ live across above intrinsic function.\n+            t0 += t1 - t2 + t3 - t4 + t5 - t6 + t7 - t8 + t9 - t10 + t11 - t12 + t13 - t14 + t15\n+                    - t16 + t17 - t18 + t19 - t20 + t21 - t22 + t23 - t24 + t25 - t26 + t27 - t28\n+                    + t29 - t30; \/\/ 0\n+        }\n+        fv[31] += t0 + t2 - t11 + t16 - t29;\n+    }\n+\n+    public void testCompress() {\n+        for (int i = 0; i < ITER; i++) {\n+            checkCompress(i);\n+        }\n+    }\n+\n+    public void checkInflate(int iter) {\n+        float t0 = 0;\n+        float t1 = fv[1] * fv[0];\n+        float t2 = fv[2] * fv[0];\n+        float t3 = fv[3] * fv[0];\n+        float t4 = fv[4] * fv[0];\n+        float t5 = fv[5] * fv[0];\n+        float t6 = fv[6] * fv[0];\n+        float t7 = fv[7] * fv[0];\n+        float t8 = fv[8] * fv[0];\n+        float t9 = fv[9] * fv[0];\n+        float t10 = fv[10] * fv[0];\n+        float t11 = fv[11] * fv[0];\n+        float t12 = fv[12] * fv[0];\n+        float t13 = fv[13] * fv[0];\n+        float t14 = fv[14] * fv[0];\n+        float t15 = fv[15] * fv[0];\n+        float t16 = fv[16] * fv[0];\n+        float t17 = fv[17] * fv[0];\n+        float t18 = fv[18] * fv[0];\n+        float t19 = fv[19] * fv[0];\n+        float t20 = fv[20] * fv[0];\n+        float t21 = fv[21] * fv[0];\n+        float t22 = fv[22] * fv[0];\n+        float t23 = fv[23] * fv[0];\n+        float t24 = fv[24] * fv[0];\n+        float t25 = fv[25] * fv[0];\n+        float t26 = fv[26] * fv[0];\n+        float t27 = fv[27] * fv[0];\n+        float t28 = fv[28] * fv[0];\n+        float t29 = fv[29] * fv[0];\n+        float t30 = fv[30] * fv[0];\n+\n+        str.getChars(0, LENGTH, ca, 0);\n+\n+        if (ca[iter % LENGTH] > (byte) ('a' + NUM \/ 2)) {\n+            \/\/ Use fp registers as many as possible and try to make them\n+            \/\/ live across above intrinsic function.\n+            t0 += t1 - t2 + t3 - t4 + t5 - t6 + t7 - t8 + t9 - t10 + t11 - t12 + t13 - t14 + t15\n+                    - t16 + t17 - t18 + t19 - t20 + t21 - t22 + t23 - t24 + t25 - t26 + t27 - t28\n+                    + t29 - t30; \/\/ 0\n+        }\n+        fv[31] += t0 + t2 - t11 + t16 - t29;\n+    }\n+\n+    public void testInflate() {\n+        for (int i = 0; i < ITER; i++) {\n+            checkInflate(i);\n+        }\n+    }\n+\n+    public void verifyAndReset() {\n+        if (fv[31] != 1.0) {\n+            throw new RuntimeException(\"Failed with \" + Float.toString(fv[31]));\n+        } else {\n+            System.out.println(\"Success!\");\n+        }\n+        fv[31] = 1.0f;\n+    }\n+\n+    public static void main(String[] args) {\n+        TestIntrinsicsRegStress t = new TestIntrinsicsRegStress();\n+        t.init();\n+\n+        t.testIndexOf();\n+        t.verifyAndReset();\n+\n+        t.testArraysEquals();\n+        t.verifyAndReset();\n+\n+        t.testCompress();\n+        t.verifyAndReset();\n+\n+        t.testInflate();\n+        t.verifyAndReset();\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/compiler\/c2\/aarch64\/TestIntrinsicsRegStress.java","additions":296,"deletions":0,"binary":false,"changes":296,"status":"added"}]}