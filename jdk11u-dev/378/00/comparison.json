{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2014, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,1 +29,1 @@\n- * @bug 6583251\n+ * @bug 6583251 8217377\n@@ -60,0 +60,6 @@\n+        if (SystemTray.isSupported()) {\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                public void run() {\n+                    createGui();\n+                }\n+            });\n@@ -61,5 +67,4 @@\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            public void run() {\n-                createGui();\n-            }\n-        });\n+            Robot robot = new Robot();\n+            robot.waitForIdle();\n+            menu.show(frame, 0, 0);\n+            robot.waitForIdle();\n@@ -67,4 +72,5 @@\n-        Robot robot = new Robot();\n-        robot.waitForIdle();\n-        menu.show(frame, 0, 0);\n-        robot.waitForIdle();\n+            TrayIcon trayIcon = new TrayIcon(new BufferedImage(1, 1, BufferedImage.TYPE_INT_ARGB));\n+            MouseEvent ev = new MouseEvent(\n+                    new JButton(), MouseEvent.MOUSE_PRESSED, System.currentTimeMillis(), 0, 0, 0, 1, false);\n+            ev.setSource(trayIcon);\n+            Toolkit.getDefaultToolkit().getSystemEventQueue().postEvent(ev);\n@@ -72,5 +78,9 @@\n-        TrayIcon trayIcon = new TrayIcon(new BufferedImage(1, 1, BufferedImage.TYPE_INT_ARGB));\n-        MouseEvent ev = new MouseEvent(\n-                new JButton(), MouseEvent.MOUSE_PRESSED, System.currentTimeMillis(), 0, 0, 0, 1, false);\n-        ev.setSource(trayIcon);\n-        Toolkit.getDefaultToolkit().getSystemEventQueue().postEvent(ev);\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                public void run() {\n+                    frame.dispose();\n+                }\n+            });\n+\n+        } else {\n+            System.out.println(\"SystemTray not supported. \" + \"Skipping the test.\");\n+        }\n","filename":"test\/jdk\/javax\/swing\/JPopupMenu\/6583251\/bug6583251.java","additions":26,"deletions":16,"binary":false,"changes":42,"status":"modified"}]}