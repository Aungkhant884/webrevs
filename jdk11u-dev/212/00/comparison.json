{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,2 @@\n- * @summary Checks for LD_LIBRARY_PATH on *nixes\n+ * @summary Ensure that the launcher defends against user settings of the\n+ *          LD_LIBRARY_PATH environment variable on Unixes\n@@ -32,5 +33,0 @@\n-\/*\n- * 7029048: test for LD_LIBRARY_PATH set to different paths which may or\n- * may not contain a libjvm.so, but we test to ensure that the launcher\n- * behaves correctly in all cases.\n- *\/\n@@ -73,1 +69,0 @@\n-\n@@ -105,1 +100,0 @@\n-            System.out.println(tr);\n@@ -108,3 +102,4 @@\n-        String values[] = envValue.split(File.pathSeparator);\n-        if (values.length == nLLPComponents) {\n-            System.out.println(caseID + \" :OK\");\n+        int len = (envValue.equals(\"null\")\n+                   ? 0 : envValue.split(File.pathSeparator).length);\n+        if (len == nLLPComponents) {\n+            System.out.println(caseID + \": OK\");\n@@ -115,1 +110,1 @@\n-                    + \" but got \" + values.length);\n+                               + \" but got \" + len);\n@@ -117,1 +112,0 @@\n-            System.out.println(tr);\n@@ -123,6 +117,4 @@\n-     * A crucial piece, specifies what we should expect, given the conditions.\n-     * That is for a given enum type, the value indicates how many absolute\n-     * environment variables that can be expected. This value is used to base\n-     * the actual expected values by adding the set environment variable usually\n-     * it is 1, but it could be more if the test wishes to set more paths in\n-     * the future.\n+     * Describe the cases that we test.  Each case sets the environment\n+     * variable LD_LIBRARY_PATH to a different value.  The value associated\n+     * with a case is the number of path elements that we expect the launcher\n+     * to add to that variable.\n@@ -130,4 +122,4 @@\n-    private static enum LLP_VAR {\n-        LLP_SET_NON_EXISTENT_PATH(0),   \/\/ env set, but the path does not exist\n-        LLP_SET_EMPTY_PATH(0),          \/\/ env set, with a path but no libjvm.so\n-        LLP_SET_WITH_JVM(3);            \/\/ env set, with a libjvm.so\n+    private static enum TestCase {\n+        NO_DIR(0),                      \/\/ Directory does not exist\n+        NO_LIBJVM(0),                   \/\/ Directory exists, but no libjvm.so\n+        LIBJVM(3);                      \/\/ Directory exists, with a libjvm.so\n@@ -135,1 +127,1 @@\n-        LLP_VAR(int i) {\n+        TestCase(int i) {\n@@ -145,1 +137,1 @@\n-        for (LLP_VAR v : LLP_VAR.values()) {\n+        for (TestCase v : TestCase.values()) {\n@@ -147,1 +139,1 @@\n-                case LLP_SET_WITH_JVM:\n+                case LIBJVM:\n@@ -154,1 +146,1 @@\n-                case LLP_SET_EMPTY_PATH:\n+                case NO_LIBJVM:\n@@ -167,1 +159,1 @@\n-                    desc = \"LD_LIBRARY_PATH should not be set\";\n+                    desc = \"LD_LIBRARY_PATH should not be set (no libjvm.so)\";\n@@ -169,1 +161,1 @@\n-                case LLP_SET_NON_EXISTENT_PATH:\n+                case NO_DIR:\n@@ -173,1 +165,1 @@\n-                    desc = \"LD_LIBRARY_PATH should not be set\";\n+                    desc = \"LD_LIBRARY_PATH should not be set (no directory)\";\n@@ -184,1 +176,3 @@\n-            run(env, v.value + 1, \"Case 1: \" + desc);\n+            run(env,\n+                v.value + 1,            \/\/ Add one to account for our setting\n+                \"Case 1: \" + desc);\n@@ -191,1 +185,3 @@\n-            run(env, v.value + 1, \"Case 2: \" + desc);\n+            run(env,\n+                v.value + 1,            \/\/ Add one to account for our setting\n+                \"Case 2: \" + desc);\n@@ -200,1 +196,4 @@\n-                run(env, v.value + 1, \"Case 3: \" + desc);\n+                run(env,\n+                    v.value,            \/\/ Do not add one, since we didn't set\n+                                        \/\/ LD_LIBRARY_PATH here\n+                    \"Case 3: \" + desc);\n@@ -233,0 +232,1 @@\n+\n","filename":"test\/jdk\/tools\/launcher\/Test7029048.java","additions":34,"deletions":34,"binary":false,"changes":68,"status":"modified"}]}