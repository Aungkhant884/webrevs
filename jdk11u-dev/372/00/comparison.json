{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,2 +24,5 @@\n-import java.awt.*;\n-import java.awt.event.*;\n+import java.awt.Button;\n+import java.awt.FlowLayout;\n+import java.awt.Frame;\n+import java.awt.event.FocusEvent;\n+import java.awt.event.FocusListener;\n@@ -27,9 +30,6 @@\n-\/*\n-  @test\n-  @key headful\n-  @bug 4411534 4517274\n-  @summary ensures that user's requestFocus() during applet initialization\n-           is not ignored\n-  @library ..\/..\/regtesthelpers\n-  @build   Util\n-  @run main AppletInitialFocusTest1\n+\/**\n+ * @test\n+ * @key headful\n+ * @bug 4411534 4517274\n+ * @summary ensures that user's requestFocus() during applet initialization\n+ *          is not ignored\n@@ -41,2 +41,1 @@\n-\n-    Object lock = new Object();\n+    private static volatile Object focused;\n@@ -46,8 +45,4 @@\n-        app.init();\n-        Thread.sleep(10000);\n-    }\n-\n-    public void init() {\n-        setSize(200, 200);\n-        setLocationRelativeTo(null);\n-        setLayout(new FlowLayout());\n+        try {\n+            app.setSize(200, 200);\n+            app.setLocationRelativeTo(null);\n+            app.setLayout(new FlowLayout());\n@@ -55,12 +50,10 @@\n-        Component parent = this;\n-        while (parent != null && !(parent instanceof Window)) {\n-            parent = parent.getParent();\n-        }\n-        \/*\n-         * This applet is designed to be run only with appletviewer,\n-         * so there always should be a toplevel frame.\n-         *\/\n-        if (parent == null) {\n-            synchronized (lock) {\n-                System.err.println(\"appletviewer not running\");\n-                System.exit(3);\n+            app.button1.addFocusListener(app);\n+            app.button2.addFocusListener(app);\n+            app.add(app.button1);\n+            app.add(app.button2);\n+            app.setVisible(true);\n+            app.button2.requestFocus();\n+            \/\/ wait for the very very last focus event\n+            Thread.sleep(10000);\n+            if (app.button2 != focused) {\n+                throw new RuntimeException(\"Wrong focus owner: \" + focused);\n@@ -68,0 +61,2 @@\n+        } finally {\n+            app.dispose();\n@@ -69,6 +64,0 @@\n-        button1.addFocusListener(this);\n-        button2.addFocusListener(this);\n-        add(button1);\n-        add(button2);\n-        setVisible(true);\n-        button2.requestFocus();\n@@ -78,5 +67,2 @@\n-        if (e.getSource() == button1) {\n-            synchronized (lock) {\n-                throw new RuntimeException(\"failed: focus on the wrong button\");\n-            }\n-        }\n+        focused = e.getSource();\n+        System.out.println(\"focused = \" + focused);\n","filename":"test\/jdk\/java\/awt\/Focus\/AppletInitialFocusTest\/AppletInitialFocusTest1.java","additions":31,"deletions":45,"binary":false,"changes":76,"status":"modified"}]}