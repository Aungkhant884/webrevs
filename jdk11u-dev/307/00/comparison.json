{"files":[{"patch":"@@ -415,1 +415,1 @@\n-       test \"x$OPENJDK_TARGET_OS-$OPENJDK_TARGET_CPU\" = \"xlinux-aarch64\" ; then\n+       test \"x$OPENJDK_TARGET_CPU\" = \"xaarch64\" ; then\n@@ -446,1 +446,1 @@\n-      # By default enable graal build on x64 or where AOT is available.\n+      # By default enable graal build on x64\/aarch64 or where AOT is available.\n@@ -450,0 +450,1 @@\n+           test \"x$OPENJDK_TARGET_CPU\" = \"xaarch64\" || \\\n","filename":"make\/autoconf\/hotspot.m4","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -24,0 +24,1 @@\n+#include \"precompiled.hpp\"\n","filename":"src\/hotspot\/cpu\/aarch64\/jvmciCodeInstaller_aarch64.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -131,1 +131,5 @@\n-        return new AArch64HotSpotRegisterConfig(target, config.useCompressedOops);\n+        \/\/ ARMv8 defines r18 as being available to the platform ABI. Windows\n+        \/\/ and Darwin use it for such. Linux doesn't assign it and thus r18 can\n+        \/\/ be used as an additional register.\n+        boolean canUsePlatformRegister = config.linuxOs;\n+        return new AArch64HotSpotRegisterConfig(target, config.useCompressedOops, canUsePlatformRegister);\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot.aarch64\/src\/jdk\/vm\/ci\/hotspot\/aarch64\/AArch64HotSpotJVMCIBackendFactory.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+import static jdk.vm.ci.aarch64.AArch64.r18;\n@@ -125,0 +126,6 @@\n+    \/**\n+     * The platform ABI can use r18 to carry inter-procedural state (e.g. thread\n+     * context). If not defined as such by the platform ABI, it can be used as\n+     * additional temporary register.\n+     *\/\n+    public static final Register platformRegister = r18;\n@@ -132,1 +139,1 @@\n-    private static RegisterArray initAllocatable(Architecture arch, boolean reserveForHeapBase) {\n+    private static RegisterArray initAllocatable(Architecture arch, boolean reserveForHeapBase, boolean canUsePlatformRegister) {\n@@ -134,1 +141,1 @@\n-        Register[] registers = new Register[allRegisters.size() - reservedRegisters.size() - (reserveForHeapBase ? 1 : 0)];\n+        Register[] registers = new Register[allRegisters.size() - reservedRegisters.size() - (reserveForHeapBase ? 1 : 0) - (!canUsePlatformRegister ? 1 : 0)];\n@@ -143,0 +150,3 @@\n+            if (!canUsePlatformRegister && reg.equals(platformRegister)) {\n+                continue;\n+            }\n@@ -156,2 +166,2 @@\n-    public AArch64HotSpotRegisterConfig(TargetDescription target, boolean useCompressedOops) {\n-        this(target, initAllocatable(target.arch, useCompressedOops));\n+    public AArch64HotSpotRegisterConfig(TargetDescription target, boolean useCompressedOops, boolean canUsePlatformRegister) {\n+        this(target, initAllocatable(target.arch, useCompressedOops, canUsePlatformRegister));\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot.aarch64\/src\/jdk\/vm\/ci\/hotspot\/aarch64\/AArch64HotSpotRegisterConfig.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"}]}