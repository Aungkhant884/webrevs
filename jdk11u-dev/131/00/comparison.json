{"files":[{"patch":"@@ -3792,3 +3792,1 @@\n-  if (!rewrite_existing) {\n-    oflags |= O_EXCL;\n-  }\n+  oflags |= rewrite_existing ? O_TRUNC : O_EXCL;\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -3631,3 +3631,1 @@\n-  if (!rewrite_existing) {\n-    oflags |= O_EXCL;\n-  }\n+  oflags |= rewrite_existing ? O_TRUNC : O_EXCL;\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -5746,3 +5746,1 @@\n-  if (!rewrite_existing) {\n-    oflags |= O_EXCL;\n-  }\n+  oflags |= rewrite_existing ? O_TRUNC : O_EXCL;\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -4603,3 +4603,1 @@\n-  if (!rewrite_existing) {\n-    oflags |= _O_EXCL;\n-  }\n+  oflags |= rewrite_existing ? _O_TRUNC : _O_EXCL;\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -509,1 +509,3 @@\n-       \"BOOLEAN\", false, \"false\") {\n+       \"BOOLEAN\", false, \"false\"),\n+  _overwrite(\"-overwrite\", \"If specified, the dump file will be overwritten if it exists\",\n+           \"BOOLEAN\", false, \"false\") {\n@@ -512,0 +514,1 @@\n+  _dcmdparser.add_dcmd_option(&_overwrite);\n@@ -519,1 +522,1 @@\n-  int res = dumper.dump(_filename.value());\n+  int res = dumper.dump(_filename.value(), _overwrite.value());\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -334,0 +334,1 @@\n+  DCmdArgument<bool> _overwrite;\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -409,1 +409,1 @@\n-  DumpWriter(const char* path);\n+  DumpWriter(const char* path, bool overwrite);\n@@ -447,1 +447,1 @@\n-DumpWriter::DumpWriter(const char* path) {\n+DumpWriter::DumpWriter(const char* path, bool overwrite) {\n@@ -462,1 +462,1 @@\n-  _fd = os::create_binary_file(path, false);    \/\/ don't replace existing file\n+  _fd = os::create_binary_file(path, overwrite);\n@@ -1938,1 +1938,1 @@\n-int HeapDumper::dump(const char* path) {\n+int HeapDumper::dump(const char* path, bool overwrite) {\n@@ -1948,1 +1948,1 @@\n-  DumpWriter writer(path);\n+  DumpWriter writer(path, overwrite);\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -74,1 +74,1 @@\n-  int dump(const char* path);\n+  int dump(const char* path, bool overwrite = false);\n","filename":"src\/hotspot\/share\/services\/heapDumper.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-    public void run(CommandExecutor executor) throws IOException {\n+    public void run(CommandExecutor executor, boolean overwrite) throws IOException {\n@@ -55,1 +55,1 @@\n-        if (dump.exists()) {\n+        if (!overwrite && dump.exists()) {\n@@ -57,0 +57,2 @@\n+        } else if (overwrite) {\n+            dump.createNewFile();\n@@ -59,1 +61,1 @@\n-        String cmd = \"GC.heap_dump \" + heapDumpArgs + \" \" + dump.getAbsolutePath();\n+        String cmd = \"GC.heap_dump \" + (overwrite ? \"-overwrite \" : \"\") + heapDumpArgs + \" \" + dump.getAbsolutePath();\n@@ -88,1 +90,6 @@\n-        run(new PidJcmdExecutor());\n+        run(new PidJcmdExecutor(), false);\n+    }\n+\n+    @Test\n+    public void pidRewrite() throws IOException {\n+        run(new PidJcmdExecutor(), true);\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/gc\/HeapDumpTest.java","additions":11,"deletions":4,"binary":false,"changes":15,"status":"modified"}]}