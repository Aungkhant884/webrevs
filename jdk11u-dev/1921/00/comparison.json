{"files":[{"patch":"@@ -329,1 +329,1 @@\n-        return dumpHexBytes(data, 16, \"\\n\", \" \");\n+        return dumpHexBytes(data, data.length, 16, \"\\n\", \" \");\n@@ -334,1 +334,2 @@\n-     * @param data the array of bytes to dump to stdout.\n+     * @param data the array of bytes to dump to stdout\n+     * @param dataLen the length of the data to be displayed\n@@ -343,2 +344,2 @@\n-    private static String dumpHexBytes(byte[] data, int itemsPerLine,\n-            String lineDelim, String itemDelim) {\n+    private static String dumpHexBytes(byte[] data, int dataLen,\n+            int itemsPerLine, String lineDelim, String itemDelim) {\n@@ -347,1 +348,1 @@\n-            for (int i = 0; i < data.length; i++) {\n+            for (int i = 0; i < dataLen; i++) {\n@@ -497,0 +498,1 @@\n+            log(\"Signature algorithm set to \" + sigAlgId.getName());\n@@ -560,0 +562,2 @@\n+            log(\"Response Content-Length field \" +\n+                    (isDisabled ? \"disabled\" : \"enabled\"));\n@@ -734,0 +738,4 @@\n+\n+                \/\/ Read in the first line which will be the request line.\n+                \/\/ This will be tokenized so we know if we are dealing with\n+                \/\/ a GET or POST.\n@@ -742,1 +750,1 @@\n-                        switch (headerTokens[0]) {\n+                        switch (headerTokens[0].toUpperCase()) {\n@@ -747,1 +755,1 @@\n-                                ocspReq = parseHttpOcspGet(headerTokens);\n+                                ocspReq = parseHttpOcspGet(headerTokens, in);\n@@ -781,0 +789,3 @@\n+                out.flush();\n+\n+                log(\"Closing \" + ocspSocket);\n@@ -878,0 +889,2 @@\n+         * @param inStream the input stream from the socket bound to this\n+         * {@code OcspHandler}.\n@@ -886,2 +899,20 @@\n-        private LocalOcspRequest parseHttpOcspGet(String[] headerTokens)\n-                throws IOException, CertificateException {\n+        private LocalOcspRequest parseHttpOcspGet(String[] headerTokens,\n+                InputStream inStream) throws IOException, CertificateException {\n+            \/\/ Before we process the remainder of the GET URL, we should drain\n+            \/\/ the InputStream of any other header data.  We (for now) won't\n+            \/\/ use it, but will display the contents if logging is enabled.\n+            boolean endOfHeader = false;\n+            while (!endOfHeader) {\n+                String[] lineTokens = readLine(inStream).split(\":\", 2);\n+                \/\/ We expect to see a type and value pair delimited by a colon.\n+                if (lineTokens[0].isEmpty()) {\n+                    endOfHeader = true;\n+                } else if (lineTokens.length == 2) {\n+                    log(String.format(\"ReqHdr: %s: %s\", lineTokens[0].trim(),\n+                            lineTokens[1].trim()));\n+                } else {\n+                    \/\/ A colon wasn't found and token 0 should be the whole line\n+                    log(\"ReqHdr: \" + lineTokens[0].trim());\n+                }\n+            }\n+\n@@ -1208,1 +1239,3 @@\n-                sb.append(dumpHexBytes(cid.getIssuerNameHash(), 256, \"\", \"\"));\n+                byte[] cidHashBuf = cid.getIssuerNameHash();\n+                sb.append(dumpHexBytes(cidHashBuf, cidHashBuf.length,\n+                        256, \"\", \"\"));\n@@ -1211,1 +1244,3 @@\n-                sb.append(dumpHexBytes(cid.getIssuerKeyHash(), 256, \"\", \"\"));\n+                cidHashBuf = cid.getIssuerKeyHash();\n+                sb.append(dumpHexBytes(cidHashBuf, cidHashBuf.length,\n+                        256, \"\", \"\"));\n@@ -1551,1 +1586,3 @@\n-                sb.append(dumpHexBytes(certId.getIssuerNameHash(), 256, \"\", \"\"));\n+                byte[] cidHashBuf = certId.getIssuerNameHash();\n+                sb.append(dumpHexBytes(cidHashBuf, cidHashBuf.length,\n+                        256, \"\", \"\"));\n@@ -1554,1 +1591,3 @@\n-                sb.append(dumpHexBytes(certId.getIssuerKeyHash(), 256, \"\", \"\"));\n+                cidHashBuf = certId.getIssuerKeyHash();\n+                sb.append(dumpHexBytes(cidHashBuf, cidHashBuf.length,\n+                        256, \"\", \"\"));\n","filename":"test\/jdk\/java\/security\/testlibrary\/SimpleOCSPServer.java","additions":52,"deletions":13,"binary":false,"changes":65,"status":"modified"},{"patch":"@@ -59,1 +59,1 @@\n-    static final boolean debug = false;\n+    static final boolean debug = true;\n@@ -70,1 +70,0 @@\n-\n","filename":"test\/jdk\/sun\/security\/provider\/certpath\/OCSP\/OCSPNoContentLength.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}