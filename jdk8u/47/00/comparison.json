{"files":[{"patch":"@@ -60,2 +60,2 @@\n-                                const gss_buffer_t input_name_buffer,\n-                                const gss_OID input_name_type,\n+                                gss_const_buffer_t input_name_buffer,\n+                                gss_const_OID input_name_type,\n@@ -73,1 +73,1 @@\n-                                const gss_OID mech_type,\n+                                gss_const_OID mech_type,\n@@ -91,1 +91,1 @@\n-                                const gss_OID_set desired_mech,\n+                                gss_const_OID_set desired_mech,\n@@ -111,1 +111,1 @@\n-                                const gss_buffer_t interprocess_token,\n+                                gss_const_buffer_t interprocess_token,\n@@ -119,1 +119,1 @@\n-                                const gss_OID mech_type,\n+                                gss_const_OID mech_type,\n@@ -122,2 +122,2 @@\n-                                const gss_channel_bindings_t input_chan_bindings,\n-                                const gss_buffer_t input_token,\n+                                gss_const_channel_bindings_t input_chan_bindings,\n+                                gss_const_buffer_t input_token,\n@@ -133,2 +133,2 @@\n-                                const gss_buffer_t input_token,\n-                                const gss_channel_bindings_t input_chan_bindings,\n+                                gss_const_buffer_t input_token,\n+                                gss_const_channel_bindings_t input_chan_bindings,\n@@ -180,1 +180,1 @@\n-                                const gss_buffer_t message_buffer,\n+                                gss_const_buffer_t message_buffer,\n@@ -186,2 +186,2 @@\n-                                const gss_buffer_t message_buffer,\n-                                const gss_buffer_t token_buffer,\n+                                gss_const_buffer_t message_buffer,\n+                                gss_const_buffer_t token_buffer,\n@@ -195,1 +195,1 @@\n-                                const gss_buffer_t input_message_buffer,\n+                                gss_const_buffer_t input_message_buffer,\n@@ -202,1 +202,1 @@\n-                                const gss_buffer_t input_message_buffer,\n+                                gss_const_buffer_t input_message_buffer,\n@@ -213,1 +213,1 @@\n-                                const gss_OID mechanism,\n+                                gss_const_OID mechanism,\n@@ -218,1 +218,1 @@\n-                                const gss_OID member_oid,\n+                                gss_const_OID member_oid,\n@@ -225,1 +225,1 @@\n-                                const gss_OID mech_type,\n+                                gss_const_OID mech_type,\n","filename":"jdk\/src\/share\/native\/sun\/security\/jgss\/wrapper\/NativeFunc.h","additions":18,"deletions":18,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -407,1 +407,1 @@\n-        const gss_OID_set,      \/* desired_mechs *\/\n+        gss_const_OID_set,      \/* desired_mechs *\/\n@@ -424,1 +424,1 @@\n-        const gss_OID,          \/* mech_type *\/\n+        gss_const_OID,          \/* mech_type *\/\n@@ -427,2 +427,2 @@\n-        const gss_channel_bindings_t, \/* input_chan_bindings *\/\n-        const gss_buffer_t,     \/* input_token *\/\n+        gss_const_channel_bindings_t, \/* input_chan_bindings *\/\n+        gss_const_buffer_t,     \/* input_token *\/\n@@ -439,2 +439,2 @@\n-        const gss_buffer_t,     \/* input_token_buffer *\/\n-        const gss_channel_bindings_t, \/* input_chan_bindings *\/\n+        gss_const_buffer_t,     \/* input_token_buffer *\/\n+        gss_const_channel_bindings_t, \/* input_chan_bindings *\/\n@@ -452,1 +452,1 @@\n-        const gss_buffer_t      \/* token_buffer *\/\n+        gss_const_buffer_t      \/* token_buffer *\/\n@@ -472,1 +472,1 @@\n-        const gss_buffer_t,     \/* message_buffer *\/\n+        gss_const_buffer_t,     \/* message_buffer *\/\n@@ -480,2 +480,2 @@\n-        const gss_buffer_t,     \/* message_buffer *\/\n-        const gss_buffer_t,     \/* message_token *\/\n+        gss_const_buffer_t,     \/* message_buffer *\/\n+        gss_const_buffer_t,     \/* message_token *\/\n@@ -491,1 +491,1 @@\n-        const gss_buffer_t,     \/* input_message_buffer *\/\n+        gss_const_buffer_t,     \/* input_message_buffer *\/\n@@ -500,1 +500,1 @@\n-        const gss_buffer_t,     \/* input_message_buffer *\/\n+        gss_const_buffer_t,     \/* input_message_buffer *\/\n@@ -510,1 +510,1 @@\n-        const gss_OID,          \/* mech_type (used to be const) *\/\n+        gss_const_OID,          \/* mech_type (used to be const) *\/\n@@ -536,2 +536,2 @@\n-        const gss_buffer_t,     \/* input_name_buffer *\/\n-        const gss_OID,          \/* input_name_type(used to be const) *\/\n+        gss_const_buffer_t,     \/* input_name_buffer *\/\n+        gss_const_OID,          \/* input_name_type(used to be const) *\/\n@@ -593,1 +593,1 @@\n-        const gss_OID,          \/* desired_mech *\/\n+        gss_const_OID,          \/* desired_mech *\/\n@@ -607,1 +607,1 @@\n-        const gss_OID,          \/* mech_type *\/\n+        gss_const_OID,          \/* mech_type *\/\n@@ -624,1 +624,1 @@\n-        const gss_buffer_t,     \/* interprocess_token *\/\n+        gss_const_buffer_t,     \/* interprocess_token *\/\n@@ -643,1 +643,1 @@\n-        const gss_OID,          \/* member_oid *\/\n+        gss_const_OID,          \/* member_oid *\/\n@@ -650,2 +650,2 @@\n-        const gss_OID,          \/* member *\/\n-        const gss_OID_set,      \/* set *\/\n+        gss_const_OID,          \/* member *\/\n+        gss_const_OID_set,      \/* set *\/\n@@ -658,1 +658,1 @@\n-        const gss_buffer_t,     \/* oid_str *\/\n+        gss_const_buffer_t,     \/* oid_str *\/\n@@ -672,1 +672,1 @@\n-        const gss_OID,          \/* mechanism *\/\n+        gss_const_OID,          \/* mechanism *\/\n@@ -694,1 +694,1 @@\n-        const gss_OID,          \/* mech_type *\/\n+        gss_const_OID,          \/* mech_type *\/\n","filename":"jdk\/src\/share\/native\/sun\/security\/jgss\/wrapper\/gssapi.h","additions":24,"deletions":24,"binary":false,"changes":48,"status":"modified"},{"patch":"@@ -212,1 +212,1 @@\n-is_same_oid(gss_OID o2, gss_OID o1)\n+is_same_oid(gss_const_OID o2, gss_const_OID o1)\n@@ -219,1 +219,1 @@\n-has_oid(gss_OID_set set, gss_OID oid)\n+has_oid(gss_const_OID_set set, gss_const_OID oid)\n@@ -230,1 +230,1 @@\n-get_oid_desc(gss_OID mech)\n+show_oid(gss_const_OID mech)\n@@ -252,1 +252,1 @@\n-get_oid_set_desc(gss_OID_set mechs)\n+show_oid_set(gss_const_OID_set mechs)\n@@ -261,1 +261,1 @@\n-            get_oid_desc(&mechs->elements[i]);\n+            show_oid(&mechs->elements[i]);\n@@ -335,2 +335,2 @@\n-                const gss_buffer_t input_name_buffer,\n-                const gss_OID input_name_type,\n+                gss_const_buffer_t input_name_buffer,\n+                gss_const_OID input_name_type,\n@@ -347,0 +347,3 @@\n+        if (len < 4 || input[0] != 4 || input[1] != 1 || input[2] != 0) {\n+            return GSS_S_FAILURE;\n+        }\n@@ -432,0 +435,1 @@\n+\n@@ -434,2 +438,28 @@\n-    if (l1 < l2 && n2[l1] != L'@'\n-            || l2 < l1 && n1[l2] != L'@') {\n+    int r1 = l1; \/\/ position of @ or the end if none\n+    int r2 = l2;\n+    int i;\n+\n+    for (i = 0; i < l1; i++) {\n+        if (n1[i] == L'\\\\') {\n+            i++;\n+            continue;\n+        }\n+        if (n1[i] == L'@') {\n+            r1 = i;\n+            break;\n+        }\n+    }\n+\n+    for (i = 0; i < l2; i++) {\n+        if (n2[i] == L'\\\\') {\n+            i++;\n+            continue;\n+        }\n+        if (n2[i] == L'@') {\n+            r2 = i;\n+            break;\n+        }\n+    }\n+\n+    if (l1 < l2 && l1 != r2\n+            || l2 < l1 && l2 != l1) {\n@@ -438,0 +468,1 @@\n+\n@@ -441,0 +472,7 @@\n+\n+    \/\/ Two names are equal if they are the same or one has no realm and\n+    \/\/ one has realm but they have the same name. If both have realm but\n+    \/\/ different, they are treated different even if the names are the same.\n+    \/\/ Note: the default name concept is not used here.\n+    \/\/ Principal names on Windows are case-insensitive, both user name\n+    \/\/ and service principal name.\n@@ -451,1 +489,1 @@\n-                      const gss_OID mech_type,\n+                      gss_const_OID mech_type,\n@@ -459,0 +497,4 @@\n+    if (!is_same_oid(mech_type, &KRB5_OID)) {\n+        PP(\"Cannot canonicalize to non-krb5 OID\");\n+        return GSS_S_BAD_MECH;\n+    }\n@@ -561,1 +603,1 @@\n-                 const gss_OID_set desired_mechs,\n+                 gss_const_OID_set desired_mechs,\n@@ -575,1 +617,1 @@\n-    get_oid_set_desc(desired_mechs);\n+    show_oid_set(desired_mechs);\n@@ -790,1 +832,1 @@\n-                       const gss_buffer_t interprocess_token,\n+                       gss_const_buffer_t interprocess_token,\n@@ -804,1 +846,1 @@\n-                     const gss_OID mech_type,\n+                     gss_const_OID mech_type,\n@@ -807,2 +849,2 @@\n-                     const gss_channel_bindings_t input_chan_bindings,\n-                     const gss_buffer_t input_token,\n+                     gss_const_channel_bindings_t input_chan_bindings,\n+                     gss_const_buffer_t input_token,\n@@ -930,1 +972,0 @@\n-        \/\/ TODO: seems NativeGSSContext has not failed here.\n@@ -986,2 +1027,2 @@\n-                       const gss_buffer_t input_token,\n-                       const gss_channel_bindings_t input_chan_bindings,\n+                       gss_const_buffer_t input_token,\n+                       gss_const_channel_bindings_t input_chan_bindings,\n@@ -1171,1 +1212,1 @@\n-            const gss_buffer_t message_buffer,\n+            gss_const_buffer_t message_buffer,\n@@ -1175,3 +1216,3 @@\n-    CHECK_CONTEXT(context_handle);\n-    CHECK_BUFFER(message_buffer);\n-    CHECK_OUTPUT(msg_token);\n+    CHECK_CONTEXT(context_handle)\n+    CHECK_BUFFER(message_buffer)\n+    CHECK_OUTPUT(msg_token)\n@@ -1211,2 +1252,2 @@\n-               const gss_buffer_t message_buffer,\n-               const gss_buffer_t token_buffer,\n+               gss_const_buffer_t message_buffer,\n+               gss_const_buffer_t token_buffer,\n@@ -1216,3 +1257,3 @@\n-    CHECK_CONTEXT(context_handle);\n-    CHECK_BUFFER(message_buffer);\n-    CHECK_BUFFER(token_buffer);\n+    CHECK_CONTEXT(context_handle)\n+    CHECK_BUFFER(message_buffer)\n+    CHECK_BUFFER(token_buffer)\n@@ -1256,1 +1297,1 @@\n-         const gss_buffer_t input_message_buffer,\n+         gss_const_buffer_t input_message_buffer,\n@@ -1261,3 +1302,3 @@\n-    CHECK_CONTEXT(context_handle);\n-    CHECK_BUFFER(input_message_buffer);\n-    CHECK_OUTPUT(output_message_buffer);\n+    CHECK_CONTEXT(context_handle)\n+    CHECK_BUFFER(input_message_buffer)\n+    CHECK_OUTPUT(output_message_buffer)\n@@ -1326,1 +1367,1 @@\n-           const gss_buffer_t input_message_buffer,\n+           gss_const_buffer_t input_message_buffer,\n@@ -1332,3 +1373,3 @@\n-    CHECK_CONTEXT(context_handle);\n-    CHECK_BUFFER(input_message_buffer);\n-    CHECK_OUTPUT(output_message_buffer);\n+    CHECK_CONTEXT(context_handle)\n+    CHECK_BUFFER(input_message_buffer)\n+    CHECK_OUTPUT(output_message_buffer)\n@@ -1420,1 +1461,1 @@\n-                           const gss_OID mechanism,\n+                           gss_const_OID mechanism,\n@@ -1424,1 +1465,1 @@\n-    CHECK_OID(mechanism);\n+    CHECK_OID(mechanism)\n@@ -1448,1 +1489,1 @@\n-                       const gss_OID member_oid,\n+                       gss_const_OID member_oid,\n@@ -1452,2 +1493,2 @@\n-    CHECK_OID(member_oid);\n-    CHECK_OUTPUT(oid_set);\n+    CHECK_OID(member_oid)\n+    CHECK_OUTPUT(oid_set)\n@@ -1493,1 +1534,1 @@\n-                   const gss_OID mech_type,\n+                   gss_const_OID mech_type,\n@@ -1529,1 +1570,1 @@\n-    CHECK_OUTPUT(oid_set);\n+    CHECK_OUTPUT(oid_set)\n","filename":"jdk\/src\/windows\/native\/sun\/security\/jgss\/sspi_bridge\/sspi.cpp","additions":84,"deletions":43,"binary":false,"changes":127,"status":"modified"}]}