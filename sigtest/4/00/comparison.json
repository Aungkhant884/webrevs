{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2021 Oracle and\/or its affiliates. All rights reserved.\n@@ -30,2 +30,0 @@\n-import java.lang.reflect.Array;\n-\n@@ -47,8 +45,6 @@\n-            Object permClasses = Class.class.getMethod(\"getPermittedSubclasses\").invoke(classObject);\n-            int n;\n-            if (permClasses.getClass().isArray() && (n=Array.getLength(permClasses)) > 0) {\n-                PermittedSubClass[] permittedSubClassesArray = new PermittedSubClass[n];\n-                for (int i = 0; i < n; i++) {\n-                    Object classDesc = Array.get(permClasses, i);\n-                    String permittedSubClassName = (String) classDesc.getClass().getMethod(\"displayName\").invoke(classDesc);\n-                    String permittedSubClassPackageName = (String) classDesc.getClass().getMethod(\"packageName\").invoke(classDesc);\n+            Object permClassesObj = Class.class.getMethod(\"getPermittedSubclasses\").invoke(classObject);\n+            if (permClassesObj instanceof Class<?>[]) {\n+                Class<?>[] permClasses = (Class<?>[]) permClassesObj;\n+\n+                if (permClasses.length > 0) {\n+                    PermittedSubClass[] permittedSubClassesArray = new PermittedSubClass[permClasses.length];\n@@ -56,3 +52,3 @@\n-                    String fullQualifiedName = permittedSubClassPackageName.isEmpty()\n-                            ? permittedSubClassName\n-                            : permittedSubClassPackageName + \".\" + permittedSubClassName;\n+                    for (int i = 0; i < permClasses.length; i++) {\n+                        Class<?> clss = permClasses[i];\n+                        String fullQualifiedName = clss.getName();\n@@ -60,3 +56,5 @@\n-                    PermittedSubClass permittedSubClass = new PermittedSubClass();\n-                    permittedSubClass.setupGenericClassName(fullQualifiedName);\n-                    permittedSubClassesArray[i] = permittedSubClass;\n+                        PermittedSubClass permittedSubClass = new PermittedSubClass();\n+                        permittedSubClass.setupGenericClassName(fullQualifiedName);\n+                        permittedSubClassesArray[i] = permittedSubClass;\n+                    }\n+                    cd.setPermittedSubclasses(permittedSubClassesArray);\n@@ -64,1 +62,0 @@\n-                cd.setPermittedSubclasses(permittedSubClassesArray);\n@@ -67,1 +64,1 @@\n-            \/\/just skipping since getPermittedSubclasses method is not available\n+            \/\/just skipping since getPermittedSubclasses might not be available\n","filename":"src\/classes\/com\/sun\/tdk\/signaturetest\/loaders\/CommonLoaderHelper.java","additions":16,"deletions":19,"binary":false,"changes":35,"status":"modified"}]}