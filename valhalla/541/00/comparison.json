{"files":[{"patch":"@@ -400,0 +400,1 @@\n+        factory.params = init.params;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/jvm\/TransPrimitiveClass.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -0,0 +1,84 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+ \/*\n+ * @test\n+ * @summary [lworld] test for equal treatment of annotations on primitive records (copy of ApplicableAnnotationsOnRecords)\n+ * @bug 8273018\n+ * @library \/tools\/lib\n+ * @modules jdk.compiler\/com.sun.tools.javac.util\n+ *          jdk.jdeps\/com.sun.tools.classfile\n+ * @run main ApplicableAnnotationsOnPrimitiveRecords\n+ *\/\n+import com.sun.tools.classfile.*;\n+import com.sun.tools.javac.util.Assert;\n+import java.lang.annotation.*;\n+import java.io.InputStream;\n+\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.FIELD})\n+@interface FieldAnnotation {\n+}\n+\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.METHOD})\n+@interface MethodAnnotation {\n+}\n+\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target({ElementType.PARAMETER})\n+@interface ParameterAnnotation {\n+}\n+\n+public primitive record ApplicableAnnotationsOnPrimitiveRecords(@FieldAnnotation @MethodAnnotation @ParameterAnnotation String s, @FieldAnnotation @MethodAnnotation @ParameterAnnotation int i) {\n+\n+    public static void main(String... args) throws Exception {\n+        try ( InputStream in = ApplicableAnnotationsOnPrimitiveRecords.class.getResourceAsStream(\"ApplicableAnnotationsOnPrimitiveRecords.class\")) {\n+            ClassFile cf = ClassFile.read(in);\n+            Assert.check(cf.methods.length > 5);\n+            for (Method m : cf.methods) {\n+                String methodName = m.getName(cf.constant_pool);\n+                if (methodName.equals(\"toString\") || methodName.equals(\"hashCode\") || methodName.equals(\"equals\") || methodName.equals(\"main\")) {\n+                    \/\/ ignore\n+                } else if (methodName.equals(\"<init>\")) {\n+                    var paAnnos = ((RuntimeVisibleParameterAnnotations_attribute) m.attributes.get(Attribute.RuntimeVisibleParameterAnnotations)).parameter_annotations;\n+                    Assert.check(paAnnos != null && paAnnos.length > 0);\n+                    for (var pa : paAnnos) {\n+                        Assert.check(pa.length == 1);\n+                        Assert.check(cf.constant_pool.getUTF8Value(pa[0].type_index).equals(\"LParameterAnnotation;\"));\n+                    }\n+                } else {\n+                    var annos = ((RuntimeAnnotations_attribute) m.attributes.get(Attribute.RuntimeVisibleAnnotations)).annotations;\n+                    Assert.check(annos.length == 1);\n+                    Assert.check(cf.constant_pool.getUTF8Value(annos[0].type_index).equals(\"LMethodAnnotation;\"));\n+                }\n+            }\n+            Assert.check(cf.fields.length > 0);\n+            for (Field field : cf.fields) {\n+                var annos = ((RuntimeAnnotations_attribute) field.attributes.get(Attribute.RuntimeVisibleAnnotations)).annotations;\n+                Assert.check(annos.length == 1);\n+                Assert.check(cf.constant_pool.getUTF8Value(annos[0].type_index).equals(\"LFieldAnnotation;\"));\n+            }\n+        }\n+    }\n+}\n","filename":"test\/langtools\/tools\/javac\/valhalla\/lworld-values\/records\/ApplicableAnnotationsOnPrimitiveRecords.java","additions":84,"deletions":0,"binary":false,"changes":84,"status":"added"}]}