{"files":[{"patch":"@@ -6481,4 +6481,3 @@\n-      not_null_free = !k->as_array_klass()->element_klass()->can_be_inline_klass(false);\n-      not_flat = !UseFlatArray || not_null_free || (k->as_array_klass()->element_klass() != NULL &&\n-                                                    k->as_array_klass()->element_klass()->is_inlinetype() &&\n-                                                    !k->as_array_klass()->element_klass()->flatten_array());\n+      const TypeOopPtr* exact_etype = TypeOopPtr::make_from_klass_unique(k->as_array_klass()->element_klass());\n+      not_null_free = !exact_etype->can_be_inline_type();\n+      not_flat = !UseFlatArray || not_null_free || (exact_etype->is_inlinetypeptr() && !exact_etype->inline_klass()->flatten_array());\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -3525,0 +3525,35 @@\n+\n+    \/\/ Abstract class without any primitive class implementers\n+    static abstract class MyAbstract149 {\n+        public abstract int get();\n+    }\n+\n+    static class TestClass149 extends MyAbstract149 {\n+        final int x;\n+\n+        public int get() { return x; };\n+\n+        public TestClass149(int x) {\n+            this.x = x;\n+        }\n+    }\n+\n+    \/\/ Test OSR compilation with array known to be not null-free\/flat\n+    @Test\n+    public int test149(MyAbstract149[] array) {\n+        int res = 0;\n+        \/\/ Trigger OSR compilation\n+        for (int i = 0; i < 10_000; ++i) {\n+            res += array[i % 10].get();\n+        }\n+        return res;\n+    }\n+\n+    @Run(test = \"test149\")\n+    public void test149_verifier() {\n+        TestClass149[] array = new TestClass149[10];\n+        for (int i = 0; i < 10; ++i) {\n+            array[i] = new TestClass149(i);\n+        }\n+        Asserts.assertEquals(test149(array), 45000);\n+    }\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestArrays.java","additions":35,"deletions":0,"binary":false,"changes":35,"status":"modified"}]}