{"files":[{"patch":"@@ -2077,1 +2077,1 @@\n-  if (!holder->is_loaded()) {\n+  if (!holder->is_loaded() || !holder->is_inlinetype()) {\n@@ -2086,1 +2086,0 @@\n-  assert(holder->is_inlinetype(), \"must be an inline klass\");\n","filename":"src\/hotspot\/share\/c1\/c1_GraphBuilder.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n- * @build jdk.experimental.bytecode.BasicClassBuilder test.java.lang.invoke.lib.InstructionHelper\n+ * @build test.java.lang.invoke.lib.InstructionHelper\n@@ -1082,0 +1082,1 @@\n+    @Warmup(10000)\n@@ -1409,0 +1410,1 @@\n+    @Warmup(10000)\n@@ -3887,0 +3889,30 @@\n+\n+    public int intField;\n+\n+    private static final MethodHandle withfieldWithInvalidHolder = InstructionHelper.loadCode(MethodHandles.lookup(),\n+        \"withfieldWithInvalidHolder\",\n+        MethodType.methodType(void.class, TestLWorld.class, int.class),\n+        CODE -> {\n+            CODE.\n+            aload_0().\n+            iload_1().\n+            withfield(TestLWorld.class, \"intField\", \"I\").\n+            return_();\n+        });\n+\n+    \/\/ Test withfield on identity class\n+    @Test\n+    public void test143() throws Throwable {\n+        withfieldWithInvalidHolder.invoke(this, 0);\n+    }\n+\n+    @Run(test = \"test143\")\n+    @Warmup(10000)\n+    public void test143_verifier() throws Throwable {\n+        try {\n+            test143();\n+            throw new RuntimeException(\"IncompatibleClassChangeError expected\");\n+        } catch (IncompatibleClassChangeError e) {\n+            \/\/ Expected\n+        }\n+    }\n","filename":"test\/hotspot\/jtreg\/compiler\/valhalla\/inlinetypes\/TestLWorld.java","additions":33,"deletions":1,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n- * @run main\/othervm -Xverify:remote -Xint RunWithfieldTests\n+ * @run main\/othervm -Xverify:remote RunWithfieldTests\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/withfieldTests\/RunWithfieldTests.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}