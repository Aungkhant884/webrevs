{"files":[{"patch":"@@ -2767,9 +2767,13 @@\n-\n-        if (cIsValue || cHasIdentity) {\n-            for (Type t : types.closure(c)) {\n-                if (t != c) {\n-                    if (cIsValue && (t.tsym.flags() & IDENTITY_TYPE) != 0) {\n-                        log.error(pos, Errors.ValueTypeHasIdentitySuperType(c, t));\n-                    } else if (cHasIdentity && (t.tsym.flags() & VALUE_CLASS) != 0) {\n-                        log.error(pos, Errors.IdentityTypeHasValueSuperType(c, t));\n-                    }\n+        Type identitySuper = null, valueSuper = null;\n+        for (Type t : types.closure(c)) {\n+            if (t != c) {\n+                if ((t.tsym.flags() & IDENTITY_TYPE) != 0)\n+                    identitySuper = t;\n+                else if ((t.tsym.flags() & VALUE_CLASS) != 0)\n+                    valueSuper = t;\n+                if (cIsValue &&  identitySuper != null) {\n+                    log.error(pos, Errors.ValueTypeHasIdentitySuperType(c, identitySuper));\n+                } else if (cHasIdentity &&  valueSuper != null) {\n+                    log.error(pos, Errors.IdentityTypeHasValueSuperType(c, valueSuper));\n+                } else if (identitySuper != null && valueSuper != null) {\n+                    log.error(pos, Errors.MutuallyIncompatibleSupers(c, identitySuper, valueSuper));\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Check.java","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -3960,0 +3960,4 @@\n+# 0: type, 1: type, 2: type\n+compiler.err.mutually.incompatible.supers=\\\n+    The type {0} has mutually incompatible supertypes: the identity type {1} and the value type {2}\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler.properties","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+\/\/ key: compiler.err.mutually.incompatible.supers\n@@ -35,0 +36,1 @@\n+abstract class B implements VI, II {}\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/IdentityValueClash.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,23 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @bug 8287767\n+ * @summary [lw4] Javac tolerates mutually incompatible super types.\n+ * @compile\/fail\/ref=MutuallyIncompatibleSupers.out -XDrawDiagnostics -XDdev MutuallyIncompatibleSupers.java\n+ *\/\n+\n+public class MutuallyIncompatibleSupers {\n+\n+    identity interface II {}\n+    value interface VI {}\n+\n+    static abstract class X implements II, VI {} \/\/ mutually incompatible supers.\n+\n+    interface GII extends II {} \/\/ OK.\n+    value interface BVI extends GII {} \/\/ Error\n+\n+    interface GVI extends VI {} \/\/ OK.\n+    identity interface BII extends GVI {} \/\/ Error\n+\n+    static value class BVC implements II {} \/\/ Error\n+    class BIC implements VI {} \/\/ Error\n+}\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/MutuallyIncompatibleSupers.java","additions":23,"deletions":0,"binary":false,"changes":23,"status":"added"},{"patch":"@@ -0,0 +1,6 @@\n+MutuallyIncompatibleSupers.java:13:21: compiler.err.mutually.incompatible.supers: MutuallyIncompatibleSupers.X, MutuallyIncompatibleSupers.II, MutuallyIncompatibleSupers.VI\n+MutuallyIncompatibleSupers.java:16:11: compiler.err.value.type.has.identity.super.type: MutuallyIncompatibleSupers.BVI, MutuallyIncompatibleSupers.II\n+MutuallyIncompatibleSupers.java:19:14: compiler.err.identity.type.has.value.super.type: MutuallyIncompatibleSupers.BII, MutuallyIncompatibleSupers.VI\n+MutuallyIncompatibleSupers.java:21:18: compiler.err.value.type.has.identity.super.type: MutuallyIncompatibleSupers.BVC, MutuallyIncompatibleSupers.II\n+MutuallyIncompatibleSupers.java:22:5: compiler.err.identity.type.has.value.super.type: MutuallyIncompatibleSupers.BIC, MutuallyIncompatibleSupers.VI\n+5 errors\n","filename":"test\/langtools\/tools\/javac\/valhalla\/value-objects\/MutuallyIncompatibleSupers.out","additions":6,"deletions":0,"binary":false,"changes":6,"status":"added"}]}