{"files":[{"patch":"@@ -152,0 +152,5 @@\n+void FlatArrayKlass::metaspace_pointers_do(MetaspaceClosure* it) {\n+  ArrayKlass::metaspace_pointers_do(it);\n+  it->push(&_element_klass);\n+}\n+\n@@ -429,0 +434,8 @@\n+jint FlatArrayKlass::compute_modifier_flags() const {\n+  \/\/ The modifier for an flatArray is the same as its element\n+  jint element_flags = element_klass()->compute_modifier_flags();\n+\n+  return (element_flags & (JVM_ACC_PUBLIC | JVM_ACC_PRIVATE | JVM_ACC_PROTECTED))\n+                        | (JVM_ACC_ABSTRACT | JVM_ACC_FINAL);\n+}\n+\n","filename":"src\/hotspot\/share\/oops\/flatArrayKlass.cpp","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -94,0 +94,2 @@\n+  virtual void metaspace_pointers_do(MetaspaceClosure* iter);\n+\n@@ -143,0 +145,2 @@\n+  jint compute_modifier_flags() const;\n+\n","filename":"src\/hotspot\/share\/oops\/flatArrayKlass.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -212,10 +212,5 @@\n-\n-void InlineKlass::remove_unshareable_info() {\n-  InstanceKlass::remove_unshareable_info();\n-\n-  *((Array<SigEntry>**)adr_extended_sig()) = NULL;\n-  *((Array<VMRegPair>**)adr_return_regs()) = NULL;\n-  *((address*)adr_pack_handler()) = NULL;\n-  *((address*)adr_pack_handler_jobject()) = NULL;\n-  *((address*)adr_unpack_handler()) = NULL;\n-  assert(pack_handler() == NULL, \"pack handler not null\");\n+void InlineKlass::array_klasses_do(void f(Klass* k)) {\n+  InstanceKlass::array_klasses_do(f);\n+  if (null_free_inline_array_klasses() != NULL) {\n+    null_free_inline_array_klasses()->array_klasses_do(f);\n+  }\n@@ -224,2 +219,5 @@\n-void InlineKlass::restore_unshareable_info(ClassLoaderData* loader_data, Handle protection_domain, PackageEntry* pkg_entry, TRAPS) {\n-  InstanceKlass::restore_unshareable_info(loader_data, protection_domain, pkg_entry, CHECK);\n+void InlineKlass::array_klasses_do(void f(Klass* k, TRAPS), TRAPS) {\n+  InstanceKlass::array_klasses_do(f, THREAD);\n+  if (null_free_inline_array_klasses() != NULL) {\n+    null_free_inline_array_klasses()->array_klasses_do(f, THREAD);\n+  }\n@@ -523,0 +521,40 @@\n+\/\/ CDS support\n+\n+void InlineKlass::metaspace_pointers_do(MetaspaceClosure* it) {\n+  InstanceKlass::metaspace_pointers_do(it);\n+\n+  InlineKlass* this_ptr = this;\n+  it->push_internal_pointer(&this_ptr, (intptr_t*)&_adr_inlineklass_fixed_block);\n+  it->push((Klass**)adr_null_free_inline_array_klasses());\n+}\n+\n+void InlineKlass::remove_unshareable_info() {\n+  InstanceKlass::remove_unshareable_info();\n+\n+  *((Array<SigEntry>**)adr_extended_sig()) = NULL;\n+  *((Array<VMRegPair>**)adr_return_regs()) = NULL;\n+  *((address*)adr_pack_handler()) = NULL;\n+  *((address*)adr_pack_handler_jobject()) = NULL;\n+  *((address*)adr_unpack_handler()) = NULL;\n+  assert(pack_handler() == NULL, \"pack handler not null\");\n+  if (null_free_inline_array_klasses() != NULL) {\n+    null_free_inline_array_klasses()->remove_unshareable_info();\n+  }\n+}\n+\n+void InlineKlass::remove_java_mirror() {\n+  InstanceKlass::remove_java_mirror();\n+  if (null_free_inline_array_klasses() != NULL) {\n+    null_free_inline_array_klasses()->remove_java_mirror();\n+  }\n+}\n+\n+void InlineKlass::restore_unshareable_info(ClassLoaderData* loader_data, Handle protection_domain, PackageEntry* pkg_entry, TRAPS) {\n+  InstanceKlass::restore_unshareable_info(loader_data, protection_domain, pkg_entry, CHECK);\n+  if (null_free_inline_array_klasses() != NULL) {\n+    null_free_inline_array_klasses()->restore_unshareable_info(ClassLoaderData::the_null_class_loader_data(), Handle(), CHECK);\n+  }\n+}\n+\n+\/\/ oop verify\n+\n@@ -532,7 +570,0 @@\n-\n-void InlineKlass::metaspace_pointers_do(MetaspaceClosure* it) {\n-  InstanceKlass::metaspace_pointers_do(it);\n-\n-  InlineKlass* this_ptr = this;\n-  it->push_internal_pointer(&this_ptr, (intptr_t*)&_adr_inlineklass_fixed_block);\n-}\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.cpp","additions":50,"deletions":19,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -132,0 +132,1 @@\n+  virtual void remove_java_mirror();\n@@ -144,0 +145,4 @@\n+  \/\/ Iterators\n+  virtual void array_klasses_do(void f(Klass* k));\n+  virtual void array_klasses_do(void f(Klass* k, TRAPS), TRAPS);\n+\n","filename":"src\/hotspot\/share\/oops\/inlineKlass.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"}]}