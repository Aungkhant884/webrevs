{"files":[{"patch":"@@ -2223,7 +2223,2 @@\n-    Node* cls = null_check(argument(4));\n-    if (stopped()) {\n-      return true;\n-    }\n-    Node* kls = load_klass_from_mirror(cls, false, NULL, 0);\n-    const TypeKlassPtr* kls_t = _gvn.type(kls)->isa_klassptr();\n-    if (!kls_t->klass_is_exact()) {\n+    const TypeInstPtr* cls = _gvn.type(argument(4))->isa_instptr();\n+    if (cls == NULL || cls->const_oop() == NULL) {\n@@ -2232,2 +2227,2 @@\n-    ciKlass* klass = kls_t->klass();\n-    if (!klass->is_inlinetype()) {\n+    ciType* mirror_type = cls->const_oop()->as_instance()->java_mirror_type();\n+    if (!mirror_type->is_inlinetype()) {\n@@ -2236,6 +2231,1 @@\n-    inline_klass = klass->as_inline_klass();\n-  }\n-\n-  receiver = null_check(receiver);\n-  if (stopped()) {\n-    return true;\n+    inline_klass = mirror_type->as_inline_klass();\n@@ -2405,0 +2395,4 @@\n+  receiver = null_check(receiver);\n+  if (stopped()) {\n+    return true;\n+  }\n@@ -2501,0 +2495,3 @@\n+  if (!value->is_InlineType()) {\n+    return false;\n+  }\n@@ -2507,4 +2504,0 @@\n-  if (!value->is_InlineType()) {\n-    return false;\n-  }\n-\n@@ -2512,1 +2505,0 @@\n-\n@@ -2519,6 +2511,0 @@\n-\n-  receiver = null_check(receiver);\n-  if (stopped()) {\n-    return true;\n-  }\n-\n@@ -2528,1 +2514,0 @@\n-\n@@ -2534,1 +2519,4 @@\n-  set_result(vt->finish_larval(this));\n+  receiver = null_check(receiver);\n+  if (stopped()) {\n+    return true;\n+  }\n@@ -2536,0 +2524,1 @@\n+  set_result(vt->finish_larval(this));\n@@ -3259,0 +3248,1 @@\n+  bool requires_null_check = false;\n@@ -3265,7 +3255,3 @@\n-      if (!obj->is_InlineType() && tm->as_klass()->is_inlinetype()) {\n-        \/\/ Casting to .val, check for null\n-        obj = null_check(obj);\n-        if (stopped()) {\n-          return true;\n-        }\n-      }\n+      \/\/ Check for null if casting to .val\n+      requires_null_check = !obj->is_InlineType() && tm->as_klass()->is_inlinetype();\n+\n@@ -3275,0 +3261,3 @@\n+        if (requires_null_check) {\n+          obj = null_check(obj);\n+        }\n@@ -3295,0 +3284,3 @@\n+  if (requires_null_check) {\n+    obj = null_check(obj);\n+  }\n@@ -3313,1 +3305,1 @@\n-    if (EnableValhalla && !obj->is_InlineType()) {\n+    if (EnableValhalla && !obj->is_InlineType() && !requires_null_check) {\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":28,"deletions":36,"binary":false,"changes":64,"status":"modified"}]}