{"files":[{"patch":"@@ -367,1 +367,1 @@\n-  for (const zpointer* const end = src + length; (check_status = oop_copy_check_ok) && (src < end); src++, dst++) {\n+  for (const zpointer* const end = src + length; (check_status == oop_copy_check_ok) && (src < end); src++, dst++) {\n","filename":"src\/hotspot\/share\/gc\/z\/zBarrierSet.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"utilities\/globalDefinitions.hpp\"\n@@ -56,1 +57,1 @@\n-  if (payload_size <= segment_max) {\n+  if (payload_size <= segment_max || ArrayKlass::cast(_klass)->is_flatArray_klass()) {\n@@ -138,1 +139,1 @@\n-  oopDesc::release_set_mark(mem, markWord::prototype());\n+  oopDesc::release_set_mark(mem, Klass::default_prototype_header(_klass));\n","filename":"src\/hotspot\/share\/gc\/z\/zObjArrayAllocator.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -101,0 +101,17 @@\n+\n+\/**\n+ * @test InlineOops_int_ZGen\n+ * @requires vm.gc.Z\n+ * @summary Test embedding oops into Inline types\n+ * @modules java.base\/jdk.internal.value\n+ * @library \/test\/lib \/test\/jdk\/lib\/testlibrary\/bytecode \/test\/jdk\/java\/lang\/invoke\/common\n+ * @build jdk.experimental.bytecode.BasicClassBuilder test.java.lang.invoke.lib.InstructionHelper\n+ * @compile -XDenablePrimitiveClasses Person.java InlineOops.java\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller jdk.test.whitebox.WhiteBox\n+ *                   jdk.test.whitebox.WhiteBox$WhiteBoxPermission\n+ * @run main\/othervm -XX:+EnableValhalla -XX:+EnablePrimitiveClasses\n+ *                   -XX:+UnlockExperimentalVMOptions -XX:+UseZGC -XX:+ZGenerational -Xmx128m\n+ *                   -XX:+UnlockDiagnosticVMOptions -XX:+ZVerifyViews -XX:InlineFieldMaxFlatSize=128\n+ *                   -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n+ *                   runtime.valhalla.inlinetypes.InlineOops\n+ *\/\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/InlineOops.java","additions":17,"deletions":0,"binary":false,"changes":17,"status":"modified"}]}