{"files":[{"patch":"@@ -509,0 +509,3 @@\n+    if (outcnt() == 0) {\n+      return NULL;\n+    }\n","filename":"src\/hotspot\/share\/opto\/inlinetypenode.cpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1759,1 +1759,1 @@\n-PhaseCCP::PhaseCCP( PhaseIterGVN *igvn ) : PhaseIterGVN(igvn) {\n+PhaseCCP::PhaseCCP(PhaseIterGVN* igvn) : PhaseIterGVN(igvn), _trstack(C->live_nodes() >> 1) {\n@@ -1813,0 +1813,5 @@\n+    if (n->is_SafePoint()) {\n+      \/\/ Make sure safepoints are processed by PhaseCCP::transform even if they are\n+      \/\/ not reachable from the bottom. Otherwise, infinite loops would be removed.\n+      _trstack.push(n);\n+    }\n@@ -1934,6 +1939,3 @@\n-  \/\/ Allocate stack of size _nodes.Size()\/2 to avoid frequent realloc\n-  GrowableArray <Node *> trstack(C->live_nodes() >> 1);\n-\n-  trstack.push(new_node);           \/\/ Process children of cloned node\n-  while ( trstack.is_nonempty() ) {\n-    Node *clone = trstack.pop();\n+  _trstack.push(new_node);           \/\/ Process children of cloned node\n+  while (_trstack.is_nonempty()) {\n+    Node* clone = _trstack.pop();\n@@ -1949,1 +1951,1 @@\n-          trstack.push(new_input);\n+          _trstack.push(new_input);\n@@ -1956,1 +1958,8 @@\n-  \/\/ Aggressively remove all useless nodes, similar to PhaseRemoveUseless\n+  \/\/ The above transformation might lead to subgraphs becoming unreachable from the\n+  \/\/ bottom while still being reachable from the top. As a result, nodes in that\n+  \/\/ subgraph are not transformed and their bottom types are not updated, leading to\n+  \/\/ an inconsistency between bottom_type() and type(). In rare cases, LoadNodes in\n+  \/\/ such a subgraph, kept alive by InlineTypePtrNodes, might be re-enqueued for IGVN\n+  \/\/ indefinitely by MemNode::Ideal_common because their address type is inconsistent.\n+  \/\/ Therefore, we aggressively remove all useless nodes here even before\n+  \/\/ PhaseIdealLoop::build_loop_late gets a chance to remove them anyway.\n","filename":"src\/hotspot\/share\/opto\/phaseX.cpp","additions":18,"deletions":9,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -570,1 +570,2 @@\n-  Unique_Node_List _useful; \/\/ Nodes reachable from the bottom\n+  GrowableArray<Node*> _trstack; \/\/ Stack for transform operation\n+  Unique_Node_List _useful;      \/\/ Nodes reachable from the bottom\n","filename":"src\/hotspot\/share\/opto\/phaseX.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}