{"files":[{"patch":"@@ -4728,0 +4728,1 @@\n+    return;\n@@ -4899,1 +4900,0 @@\n-\n@@ -5302,0 +5302,3 @@\n+  if (!supports_inline_types() && (signature->is_Q_signature() || signature->is_Q_array_signature())) {\n+    throwIllegalSignature(\"Field\", name, signature, CHECK);\n+  }\n@@ -6596,1 +6599,1 @@\n-      assert(klass->access_flags().is_inline_type(), \"Value type expected\");\n+      assert(klass->access_flags().is_inline_type(), \"Inline type expected\");\n","filename":"src\/hotspot\/share\/classfile\/classFileParser.cpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -63,0 +63,8 @@\n+        \/\/ Test that a class with an old class file version cannot contain a Q signature.\n+        runTest(\"OldClassWithQSig\",\n+                \"Field \\\"this\\\" in class OldClassWithQSig has illegal signature \\\"QOldClassWithQSig;\\\"\");\n+\n+        \/\/ Test that a class with an old class file version cannot contain an array Q signature.\n+        runTest(\"OldClassWithQArraySig\",\n+                \"Field \\\"ia\\\" in class OldClassWithQArraySig has illegal signature \\\"[Qjava\/lang\/Integer;\\\"\");\n+\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/classfileparser\/BadInlineTypes.java","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2228,0 +2228,265 @@\n+\n+\n+\/\/ Test that a class with an old class file version cannot contain a Q signature.\n+class OldClassWithQSig {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  52; \/\/ version\n+  [29] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Utf8 \"OldClassWithQSig\"; \/\/ #1     at 0x0A\n+    class #1; \/\/ #2     at 0x1A\n+    Utf8 \"java\/lang\/Object\"; \/\/ #3     at 0x1D\n+    class #3; \/\/ #4     at 0x30\n+    Utf8 \"inlineclasses.scala\"; \/\/ #5     at 0x33\n+    Utf8 \"Lscala\/reflect\/ScalaSignature;\"; \/\/ #6     at 0x49\n+    Utf8 \"bytes\"; \/\/ #7     at 0x6A\n+    Utf8 \"i1QB\\t!AAC\\bI\\t\\tQ!!Q\\nEAQ!YQ\\\"T=J]2Lg.Z\\\"mCN(\\\"q*W;z}\\r1C\\n!\\tQQ\\\"D\\fa!B:dC2\\fB\\b\\f\\te.*fM\\t.F!\\tQ!#\\tJ;%Aj]&$h\\b3AA!)qba#\"; \/\/ #8     at 0x72\n+    Utf8 \"i\"; \/\/ #9     at 0x0128\n+    Utf8 \"I\"; \/\/ #10     at 0x012C\n+    Utf8 \"()I\"; \/\/ #11     at 0x0130\n+    NameAndType #9 #10; \/\/ #12     at 0x0136\n+    Field #2 #12; \/\/ #13     at 0x013B\n+    Utf8 \"this\"; \/\/ #14     at 0x0140\n+    Utf8 \"QOldClassWithQSig;\"; \/\/ #15     at 0x0147\n+    Utf8 \"<init>\"; \/\/ #16     at 0x0159\n+    Utf8 \"(I)V\"; \/\/ #17     at 0x0162\n+    Utf8 \"()V\"; \/\/ #18     at 0x0169\n+    NameAndType #16 #18; \/\/ #19     at 0x016F\n+    Method #4 #19; \/\/ #20     at 0x0174\n+    Utf8 \"Code\"; \/\/ #21     at 0x0179\n+    Utf8 \"LineNumberTable\"; \/\/ #22     at 0x0180\n+    Utf8 \"LocalVariableTable\"; \/\/ #23     at 0x0192\n+    Utf8 \"MethodParameters\"; \/\/ #24     at 0x01A7\n+    Utf8 \"SourceFile\"; \/\/ #25     at 0x01BA\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #26     at 0x01C7\n+    Utf8 \"ScalaInlineInfo\"; \/\/ #27     at 0x01E3\n+    Utf8 \"ScalaSig\"; \/\/ #28     at 0x01F5\n+  } \/\/ Constant Pool\n+\n+  0x0121; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #2;\/\/ this_cpx\n+  #4;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [1] { \/\/ Fields\n+    {  \/\/ field at 0x020A\n+      0x0012; \/\/ access\n+      #9; \/\/ name_index       : i\n+      #10; \/\/ descriptor_index : I\n+      [0] { \/\/ Attributes\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0x0214\n+      0x0001; \/\/ access\n+      #9; \/\/ name_index       : i\n+      #11; \/\/ descriptor_index : ()I\n+      [1] { \/\/ Attributes\n+        Attr(#21, 47) { \/\/ Code at 0x021C\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB4000DAC;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [2] { \/\/ Attributes\n+            Attr(#22, 6) { \/\/ LineNumberTable at 0x0233\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0x023F\n+              }\n+            } \/\/ end LineNumberTable\n+            ;\n+            Attr(#23, 12) { \/\/ LocalVariableTable at 0x023F\n+              [1] { \/\/ LocalVariableTable\n+                0 5 14 15 0; \/\/  at 0x0251\n+              }\n+            } \/\/ end LocalVariableTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0x0251\n+      0x0001; \/\/ access\n+      #16; \/\/ name_index       : <init>\n+      #17; \/\/ descriptor_index : (I)V\n+      [2] { \/\/ Attributes\n+        Attr(#21, 70) { \/\/ Code at 0x0259\n+          2; \/\/ max_stack\n+          2; \/\/ max_locals\n+          Bytes[10]{\n+            0x2A1BB5000D2AB700;\n+            0x14B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [2] { \/\/ Attributes\n+            Attr(#22, 14) { \/\/ LineNumberTable at 0x0275\n+              [3] { \/\/ line_number_table\n+                0  1; \/\/  at 0x0281\n+                5  3; \/\/  at 0x0285\n+                9  1; \/\/  at 0x0289\n+              }\n+            } \/\/ end LineNumberTable\n+            ;\n+            Attr(#23, 22) { \/\/ LocalVariableTable at 0x0289\n+              [2] { \/\/ LocalVariableTable\n+                0 10 14 15 0; \/\/  at 0x029B\n+                0 10 9 10 1; \/\/  at 0x02A5\n+              }\n+            } \/\/ end LocalVariableTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+        ;\n+        Attr(#24, 5) { \/\/ MethodParameters at 0x02A5\n+          [1]b { \/\/ MethodParameters\n+            #9  0x0010; \/\/  at 0x02B0\n+          }\n+        } \/\/ end MethodParameters\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [4] { \/\/ Attributes\n+    Attr(#25, 2) { \/\/ SourceFile at 0x02B2\n+      #5;\n+    } \/\/ end SourceFile\n+    ;\n+    Attr(#26, 11) { \/\/ RuntimeVisibleAnnotations at 0x02BA\n+      [1] { \/\/ annotations\n+        {  \/\/  annotation\n+          #6;\n+          [1] { \/\/ element_value_pairs\n+            {  \/\/  element value pair\n+              #7;\n+              {  \/\/  element_value\n+                's';\n+                #8;\n+              }  \/\/  element_value\n+            }  \/\/  element value pair\n+          }  \/\/  element_value_pairs\n+        }  \/\/  annotation\n+      }\n+    } \/\/ end RuntimeVisibleAnnotations\n+    ;\n+    Attr(#27, 14) { \/\/ ScalaInlineInfo at 0x02CB\n+      0x0100000200100011;\n+      0x000009000B00;\n+    } \/\/ end ScalaInlineInfo\n+    ;\n+    Attr(#28, 3) { \/\/ ScalaSig at 0x02DF\n+      0x050200;\n+    } \/\/ end ScalaSig\n+  } \/\/ Attributes\n+} \/\/ end class OldClassWithQSig\n+\n+\n+\/\/ Test that a class with an old class file version cannot contain an array Q signature.\n+class OldClassWithQArraySig {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  52; \/\/ version\n+  [20] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Method #2 #3; \/\/ #1     at 0x0A\n+    class #4; \/\/ #2     at 0x0F\n+    NameAndType #5 #6; \/\/ #3     at 0x12\n+    Utf8 \"java\/lang\/Object\"; \/\/ #4     at 0x17\n+    Utf8 \"<init>\"; \/\/ #5     at 0x2A\n+    Utf8 \"()V\"; \/\/ #6     at 0x33\n+    class #8; \/\/ #7     at 0x39\n+    Utf8 \"java\/lang\/Integer\"; \/\/ #8     at 0x3C\n+    Field #10 #11; \/\/ #9     at 0x50\n+    class #12; \/\/ #10     at 0x55\n+    NameAndType #13 #14; \/\/ #11     at 0x58\n+    Utf8 \"OldClassWithQArraySig\"; \/\/ #12     at 0x5D\n+    Utf8 \"ia\"; \/\/ #13     at 0x65\n+    Utf8 \"[Qjava\/lang\/Integer;\"; \/\/ #14     at 0x6A\n+    Utf8 \"Code\"; \/\/ #15     at 0x81\n+    Utf8 \"LineNumberTable\"; \/\/ #16     at 0x88\n+    Utf8 \"runIt\"; \/\/ #17     at 0x9A\n+    Utf8 \"SourceFile\"; \/\/ #18     at 0xA2\n+    Utf8 \"OldClassWithQArraySig.java\"; \/\/ #19     at 0xAF\n+  } \/\/ Constant Pool\n+\n+  0x0021; \/\/ access [ ACC_PUBLIC ACC_SUPER ]\n+  #10;\/\/ this_cpx\n+  #2;\/\/ super_cpx\n+\n+  [0] { \/\/ Interfaces\n+  } \/\/ Interfaces\n+\n+  [1] { \/\/ Fields\n+    {  \/\/ field at 0xC6\n+      0x0000; \/\/ access\n+      #13; \/\/ name_index       : ia\n+      #14; \/\/ descriptor_index : [Qjava\/lang\/Integer;\n+      [0] { \/\/ Attributes\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Fields\n+\n+  [2] { \/\/ Methods\n+    {  \/\/ method at 0xD0\n+      0x0001; \/\/ access\n+      #5; \/\/ name_index       : <init>\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#15, 29) { \/\/ Code at 0xD8\n+          1; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[5]{\n+            0x2AB70001B1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#16, 6) { \/\/ LineNumberTable at 0xEF\n+              [1] { \/\/ line_number_table\n+                0  1; \/\/  at 0xFB\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+    ;\n+    {  \/\/ method at 0xFB\n+      0x0001; \/\/ access\n+      #17; \/\/ name_index       : runIt\n+      #6; \/\/ descriptor_index : ()V\n+      [1] { \/\/ Attributes\n+        Attr(#15, 37) { \/\/ Code at 0x0103\n+          2; \/\/ max_stack\n+          1; \/\/ max_locals\n+          Bytes[9]{\n+            0x2A05BD0007B50009;\n+            0xB1;\n+          }\n+          [0] { \/\/ Traps\n+          } \/\/ end Traps\n+          [1] { \/\/ Attributes\n+            Attr(#16, 10) { \/\/ LineNumberTable at 0x011E\n+              [2] { \/\/ line_number_table\n+                0  6; \/\/  at 0x012A\n+                8  7; \/\/  at 0x012E\n+              }\n+            } \/\/ end LineNumberTable\n+          } \/\/ Attributes\n+        } \/\/ end Code\n+      } \/\/ Attributes\n+    }\n+  } \/\/ Methods\n+\n+  [1] { \/\/ Attributes\n+    Attr(#18, 2) { \/\/ SourceFile at 0x0130\n+      #19;\n+    } \/\/ end SourceFile\n+  } \/\/ Attributes\n+} \/\/ end class OldClassWithQArraySig\n","filename":"test\/hotspot\/jtreg\/runtime\/valhalla\/inlinetypes\/classfileparser\/cfpTests.jcod","additions":265,"deletions":0,"binary":false,"changes":265,"status":"modified"}]}