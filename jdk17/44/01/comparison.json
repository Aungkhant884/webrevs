{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -1840,0 +1840,3 @@\n+#ifdef __APPLE__\n+    int res;\n+#endif\n@@ -1996,2 +1999,2 @@\n-        if (setsockopt(fd, IPPROTO_IP, (join ? IP_ADD_MEMBERSHIP:IP_DROP_MEMBERSHIP),\n-                       (char *) &mname, mname_len) < 0) {\n+        res = setsockopt(fd, IPPROTO_IP, (join ? IP_ADD_MEMBERSHIP:IP_DROP_MEMBERSHIP),\n+                       (char *) &mname, mname_len);\n@@ -1999,0 +2002,8 @@\n+#ifdef __APPLE__\n+        if (res < 0 && errno == ENOMEM) {\n+            res = setsockopt(fd, IPPROTO_IP, (join ? IP_ADD_MEMBERSHIP:IP_DROP_MEMBERSHIP),\n+                       (char *) &mname, mname_len);\n+        }\n+#endif\n+\n+        if (res < 0) {\n@@ -2099,2 +2110,2 @@\n-        if (setsockopt(fd, IPPROTO_IPV6, (join ? ADD_MEMBERSHIP : DRP_MEMBERSHIP),\n-                       (char *) &mname6, sizeof (mname6)) < 0) {\n+        res = setsockopt(fd, IPPROTO_IPV6, (join ? ADD_MEMBERSHIP : DRP_MEMBERSHIP),\n+                       (char *) &mname6, sizeof (mname6));\n@@ -2102,0 +2113,7 @@\n+#ifdef __APPLE__\n+        if (res < 0 && errno == ENOMEM) {\n+            res = setsockopt(fd, IPPROTO_IPV6, (join ? ADD_MEMBERSHIP : DRP_MEMBERSHIP),\n+                       (char *) &mname6, sizeof(mname6));\n+        }\n+#endif\n+        if (res < 0) {\n@@ -2103,1 +2121,1 @@\n-                NET_ThrowCurrent(env, \"setsockopt \" S_ADD_MEMBERSHIP \" failed\");\n+                    NET_ThrowCurrent(env, \"setsockopt \" S_ADD_MEMBERSHIP \" failed\");\n","filename":"src\/java.base\/unix\/native\/libnet\/PlainDatagramSocketImpl.c","additions":24,"deletions":6,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -609,1 +609,0 @@\n-java\/net\/MulticastSocket\/Promiscuous.java                       8265369 macosx-aarch64\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}