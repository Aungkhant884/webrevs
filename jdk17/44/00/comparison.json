{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -1999,0 +1999,19 @@\n+#ifdef __APPLE__\n+            if (errno == ENOMEM) {\n+                if (setsockopt(fd, IPPROTO_IP, (join ? IP_ADD_MEMBERSHIP:IP_DROP_MEMBERSHIP),\n+                           (char *) &mname, mname_len) < 0 ) {\n+                        if (errno) {\n+                            if (join) {\n+                                NET_ThrowCurrent(env, \"setsockopt IP_ADD_MEMBERSHIP failed\");\n+                            } else {\n+                                if (errno == ENOENT)\n+                                    JNU_ThrowByName(env, JNU_JAVANETPKG \"SocketException\",\n+                                        \"Not a member of the multicast group\");\n+                                else\n+                                    NET_ThrowCurrent(env, \"setsockopt IP_DROP_MEMBERSHIP failed\");\n+                            }\n+                            return;\n+                        }\n+                }\n+            } else {\n+#endif\n@@ -2031,0 +2050,3 @@\n+#ifdef __APPLE__\n+          }\n+#endif\n@@ -2102,2 +2124,15 @@\n-            if (join) {\n-                NET_ThrowCurrent(env, \"setsockopt \" S_ADD_MEMBERSHIP \" failed\");\n+#ifdef __APPLE__\n+            if (errno == ENOMEM) {\n+                if (setsockopt(fd, IPPROTO_IPV6, (join ? ADD_MEMBERSHIP : DRP_MEMBERSHIP),\n+                           (char *) &mname6, sizeof(mname6)) < 0) {\n+                    if (join) {\n+                        NET_ThrowCurrent(env, \"setsockopt \" S_ADD_MEMBERSHIP \" failed\");\n+                    } else {\n+                        if (errno == ENOENT) {\n+                           JNU_ThrowByName(env, JNU_JAVANETPKG \"SocketException\",\n+                                \"Not a member of the multicast group\");\n+                        } else {\n+                            NET_ThrowCurrent(env, \"setsockopt \" S_DRP_MEMBERSHIP \" failed\");\n+                        }\n+                    }\n+                }\n@@ -2105,3 +2140,4 @@\n-                if (errno == ENOENT) {\n-                   JNU_ThrowByName(env, JNU_JAVANETPKG \"SocketException\",\n-                        \"Not a member of the multicast group\");\n+#endif\n+\n+                if (join) {\n+                    NET_ThrowCurrent(env, \"setsockopt \" S_ADD_MEMBERSHIP \" failed\");\n@@ -2109,1 +2145,6 @@\n-                    NET_ThrowCurrent(env, \"setsockopt \" S_DRP_MEMBERSHIP \" failed\");\n+                    if (errno == ENOENT) {\n+                       JNU_ThrowByName(env, JNU_JAVANETPKG \"SocketException\",\n+                            \"Not a member of the multicast group\");\n+                    } else {\n+                        NET_ThrowCurrent(env, \"setsockopt \" S_DRP_MEMBERSHIP \" failed\");\n+                    }\n@@ -2111,0 +2152,1 @@\n+#ifdef __APPLE__\n@@ -2112,0 +2154,1 @@\n+#endif\n","filename":"src\/java.base\/unix\/native\/libnet\/PlainDatagramSocketImpl.c","additions":50,"deletions":7,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -609,1 +609,0 @@\n-java\/net\/MulticastSocket\/Promiscuous.java                       8265369 macosx-aarch64\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}