{"files":[{"patch":"@@ -55,1 +55,1 @@\n-  Thread* thread = Thread::current_or_null();\n+  JavaThread* thread = JavaThread::current_or_null();\n@@ -62,2 +62,2 @@\n-    thread = Thread::current();\n-    assert(!thread->as_Java_thread()->has_last_Java_frame(), \"newly-attached thread not expected to have last Java frame\");\n+    thread = JavaThread::current();\n+    assert(!thread->has_last_Java_frame(), \"newly-attached thread not expected to have last Java frame\");\n@@ -67,1 +67,1 @@\n-  return thread->as_Java_thread();\n+  return thread;\n@@ -70,1 +70,1 @@\n-void ProgrammableUpcallHandler::detach_thread(Thread* thread) {\n+void ProgrammableUpcallHandler::detach_current_thread() {\n@@ -138,1 +138,1 @@\n-  \/\/ Old thread-local info. has been restored. We are not back in native code.\n+  \/\/ Old thread-local info. has been restored. We are now back in native code.\n@@ -150,1 +150,1 @@\n-    detach_thread(thread);\n+    detach_current_thread();\n@@ -160,1 +160,1 @@\n-    upcall_helper(thread->as_Java_thread(), rec, buff);\n+    upcall_helper(thread, rec, buff);\n@@ -164,1 +164,1 @@\n-    detach_thread(thread);\n+    detach_current_thread();\n","filename":"src\/hotspot\/share\/prims\/universalUpcallHandler.cpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-  static void detach_thread(Thread* thread);\n+  static void detach_current_thread();\n","filename":"src\/hotspot\/share\/prims\/universalUpcallHandler.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1426,0 +1426,2 @@\n+  \/\/ Returns the current thread as a JavaThread, or NULL if not attached\n+  static inline JavaThread* current_or_null();\n@@ -1596,0 +1598,5 @@\n+inline JavaThread* JavaThread::current_or_null() {\n+  Thread* current = Thread::current_or_null();\n+  return current != nullptr ? current->as_Java_thread() : nullptr;\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"}]}