{"files":[{"patch":"@@ -47,0 +47,1 @@\n+import sun.nio.fs.DefaultFileSystemProvider;\n@@ -279,0 +280,7 @@\n+    \/**\n+     * Use the platform's default file system to avoid recursive initialization\n+     * issues when the VM is configured to use a custom file system provider.\n+     *\/\n+    private static final java.nio.file.FileSystem builtInFS =\n+        DefaultFileSystemProvider.theFileSystem();\n+\n@@ -478,1 +486,1 @@\n-        Path defaultPolicy = Path.of(StaticProperty.javaHome(),\n+        Path defaultPolicy = builtInFS.getPath(StaticProperty.javaHome(),\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/PolicyFile.java","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+ * @bug 8266345\n@@ -75,0 +76,16 @@\n+    \/**\n+     * Test override of default FileSystemProvider with the main application\n+     * on the class path and a SecurityManager enabled.\n+     *\/\n+    public void testClassPathWithSecurityManager() throws Exception {\n+        String moduleClasses = moduleClasses();\n+        String testClasses = System.getProperty(\"test.classes\");\n+        String classpath = moduleClasses + File.pathSeparator + testClasses;\n+        String policyFile = System.getProperty(\"test.src\", \".\")\n+            + File.separator + \"fs.policy\";\n+        int exitValue = exec(SET_DEFAULT_FSP, \"-cp\", classpath,\n+            \"-Dtest.classes=\" + testClasses, \"-Djava.security.manager\",\n+            \"-Djava.security.policy==\" + policyFile, \"p.Main\");\n+        assertTrue(exitValue == 0);\n+    }\n+\n","filename":"test\/jdk\/java\/nio\/file\/spi\/SetDefaultProvider.java","additions":18,"deletions":1,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -0,0 +1,3 @@\n+grant codeBase \"file:${test.classes}${\/}-\" {\n+    permission java.io.FilePermission \"${java.io.tmpdir}${\/}-\", \"write\";\n+};\n","filename":"test\/jdk\/java\/nio\/file\/spi\/fs.policy","additions":3,"deletions":0,"binary":false,"changes":3,"status":"added"}]}