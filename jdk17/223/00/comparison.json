{"files":[{"patch":"@@ -354,0 +354,1 @@\n+  assert(Threads_lock->owned_by_self(), \"Holding the thread table lock.\");\n@@ -356,0 +357,1 @@\n+  MutexLocker ml(JfrThreadSampler::transition_block(), Mutex::_no_safepoint_check_flag);\n@@ -357,2 +359,1 @@\n-    MutexLocker ml(JfrThreadSampler::transition_block(), Mutex::_no_safepoint_check_flag);\n-    JfrThreadSampler::transition_block()->notify_all();\n+    JfrThreadSampler::transition_block()->notify();\n@@ -406,0 +407,4 @@\n+static inline bool is_released(JavaThread* jt) {\n+  return !jt->is_trace_suspend();\n+}\n+\n@@ -407,0 +412,3 @@\n+  if (is_released(thread)) {\n+    return;\n+  }\n@@ -408,0 +416,1 @@\n+  MonitorLocker ml(transition_block(), Mutex::_no_safepoint_check_flag);\n@@ -409,6 +418,2 @@\n-  {\n-    MonitorLocker ml(transition_block(), Mutex::_no_safepoint_check_flag);\n-    while (thread->is_trace_suspend()) {\n-      ml.wait();\n-    }\n-    tl->clear_trace_block();\n+  while (!is_released(thread)) {\n+    ml.wait();\n@@ -416,0 +421,1 @@\n+  tl->clear_trace_block();\n","filename":"src\/hotspot\/share\/jfr\/periodic\/sampling\/jfrThreadSampler.cpp","additions":14,"deletions":8,"binary":false,"changes":22,"status":"modified"}]}