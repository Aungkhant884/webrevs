{"files":[{"patch":"@@ -820,0 +820,20 @@\n+    \/\/ This method is called from the native in ComboBoxAccessibility.m\n+    private static Accessible getAccessibleComboboxValue(Accessible a, Component c) {\n+        if (a == null) return null;\n+\n+        return invokeAndWait(new Callable<Accessible>() {\n+            @Override\n+            public Accessible call() throws Exception {\n+                AccessibleContext ac = a.getAccessibleContext();\n+                if (ac != null) {\n+                    AccessibleSelection as = ac.getAccessibleSelection();\n+                    if (as != null) {\n+                        return as.getAccessibleSelection(0);\n+                    }\n+                }\n+\n+                return null;\n+            }\n+        }, c);\n+    }\n+\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CAccessibility.java","additions":20,"deletions":0,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -40,6 +40,0 @@\n-static jmethodID sjm_getAccessibleSelection = NULL;\n-#define GET_ACCESSIBLESELECTION_METHOD_RETURN(ret) \\\n-    GET_CACCESSIBILITY_CLASS_RETURN(ret); \\\n-    GET_STATIC_METHOD_RETURN(sjm_getAccessibleSelection, sjc_CAccessibility, \"getAccessibleSelection\", \\\n-    \"(Ljavax\/accessibility\/AccessibleContext;Ljava\/awt\/Component;)Ljavax\/accessibility\/AccessibleSelection;\", ret);\n-\n@@ -48,3 +42,2 @@\n-\/\/ NSAccessibilityElement protocol methods\n-\n-- (id)accessibilityValue {\n+- (CommonComponentAccessibility *)accessibleSelection\n+{\n@@ -52,11 +45,3 @@\n-    jobject axContext = [self axContextWithEnv:env];\n-    if (axContext == NULL) return nil;\n-    GET_ACCESSIBLESELECTION_METHOD_RETURN(nil);\n-    jobject axSelection = (*env)->CallStaticObjectMethod(env, sjc_CAccessibility, sjm_getAccessibleSelection, axContext, self->fComponent);\n-    CHECK_EXCEPTION();\n-    if (axSelection == NULL) {\n-        return nil;\n-    }\n-    jclass axSelectionClass = (*env)->GetObjectClass(env, axSelection);\n-    DECLARE_METHOD_RETURN(jm_getAccessibleSelection, axSelectionClass, \"getAccessibleSelection\", \"(I)Ljavax\/accessibility\/Accessible;\", nil);\n-    jobject axSelectedChild = (*env)->CallObjectMethod(env, axSelection, jm_getAccessibleSelection, 0);\n+    GET_CACCESSIBILITY_CLASS_RETURN(nil);\n+    DECLARE_STATIC_METHOD_RETURN(sjm_getAccessibleComboboxValue, sjc_CAccessibility, \"getAccessibleComboboxValue\", \"(Ljavax\/accessibility\/Accessible;Ljava\/awt\/Component;)Ljavax\/accessibility\/Accessible;\", nil);\n+    jobject axSelectedChild = (*env)->CallStaticObjectMethod(env, sjc_CAccessibility, sjm_getAccessibleComboboxValue, fAccessible, fComponent);\n@@ -64,2 +49,0 @@\n-    (*env)->DeleteLocalRef(env, axSelection);\n-    (*env)->DeleteLocalRef(env, axContext);\n@@ -69,11 +52,8 @@\n-    GET_ACCESSIBLENAME_METHOD_RETURN(nil);\n-    jobject childName = (*env)->CallStaticObjectMethod(env, sjc_CAccessibility, sjm_getAccessibleName, axSelectedChild, fComponent);\n-    CHECK_EXCEPTION();\n-    if (childName == NULL) {\n-        (*env)->DeleteLocalRef(env, axSelectedChild);\n-        return nil;\n-    }\n-    NSString *selectedText = JavaStringToNSString(env, childName);\n-    (*env)->DeleteLocalRef(env, axSelectedChild);\n-    (*env)->DeleteLocalRef(env, childName);\n-    return selectedText;\n+    return [CommonComponentAccessibility createWithAccessible:axSelectedChild withEnv:env withView:fView];\n+}\n+\n+\/\/ NSAccessibilityElement protocol methods\n+\n+- (id)accessibilityValue\n+{\n+    return [[self accessibleSelection] accessibilityLabel];\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/a11y\/ComboBoxAccessibility.m","additions":13,"deletions":33,"binary":false,"changes":46,"status":"modified"}]}