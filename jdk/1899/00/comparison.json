{"files":[{"patch":"@@ -634,0 +634,4 @@\n+void JVMState::bind_map(SafePointNode* map) {\n+  set_map(map);\n+  _map->set_jvms(this);\n+}\n","filename":"src\/hotspot\/share\/opto\/callnode.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -297,1 +297,3 @@\n-  void              set_map(SafePointNode *map) { _map = map; }\n+  void              set_map(SafePointNode* map) { _map = map; }\n+  \/\/ set_map() and set_jvms() for the map.\n+  void              bind_map(SafePointNode* map);\n@@ -326,0 +328,2 @@\n+  friend class GraphKit;\n+  friend class JVMState;\n@@ -329,0 +333,5 @@\n+protected:\n+  JVMState* _jvms;      \/\/ Pointer to list of JVM State objects\n+  void set_jvms(JVMState* s) {\n+    _jvms = s;  \/\/ override const attribute in the accessor\n+  }\n@@ -341,1 +350,0 @@\n-  JVMState* const _jvms;      \/\/ Pointer to list of JVM State objects\n@@ -350,5 +358,1 @@\n-  virtual JVMState* jvms() const { return _jvms; }\n-  void set_jvms(JVMState* s) {\n-    *(JVMState**)&_jvms = s;  \/\/ override const attribute in the accessor\n-  }\n-\n+  JVMState* jvms() const { return _jvms; }\n@@ -582,2 +586,2 @@\n-  CallNode(const TypeFunc* tf, address addr, const TypePtr* adr_type)\n-    : SafePointNode(tf->domain()->cnt(), NULL, adr_type),\n+  CallNode(const TypeFunc* tf, address addr, const TypePtr* adr_type, JVMState* jvms = nullptr)\n+    : SafePointNode(tf->domain()->cnt(), jvms, adr_type),\n@@ -790,2 +794,2 @@\n-                  const TypePtr* adr_type)\n-    : CallNode(tf, addr, adr_type)\n+                  const TypePtr* adr_type, JVMState* jvms = nullptr)\n+    : CallNode(tf, addr, adr_type, jvms)\n","filename":"src\/hotspot\/share\/opto\/callnode.hpp","additions":15,"deletions":11,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -168,1 +168,1 @@\n-  CallRuntimeNode *call = new CallRuntimeNode(c_sig, C_function, name, TypePtr::BOTTOM);\n+  CallRuntimeNode *call = new CallRuntimeNode(c_sig, C_function, name, TypePtr::BOTTOM, new (C) JVMState(0));\n@@ -172,1 +172,0 @@\n-  call->set_jvms(new (C) JVMState(0));\n","filename":"src\/hotspot\/share\/opto\/generateOptoStub.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -818,1 +818,1 @@\n-  SafePointNode* map  = new SafePointNode(max_size, NULL);\n+  SafePointNode* map  = new SafePointNode(max_size, jvms);\n@@ -842,1 +842,0 @@\n-  map->set_jvms(jvms);\n@@ -1077,2 +1076,1 @@\n-      ex_jvms->set_map(kit.clone_map());\n-      ex_jvms->map()->set_jvms(ex_jvms);\n+      ex_jvms->bind_map(kit.clone_map());\n@@ -1097,2 +1095,1 @@\n-      ex_map->set_jvms(caller->clone_shallow(C));\n-      ex_map->jvms()->set_map(ex_map);\n+      caller->clone_shallow(C)->bind_map(ex_map);\n","filename":"src\/hotspot\/share\/opto\/parse1.cpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -944,2 +944,0 @@\n-  c2_nonstatic_field(SafePointNode,            _jvms,                                         JVMState* const)                       \\\n-                                                                                                                                     \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"}]}