{"files":[{"patch":"@@ -30,0 +30,2 @@\n+#include \"metaprogramming\/removePointer.hpp\"\n+#include \"metaprogramming\/removeCV.hpp\"\n@@ -64,1 +66,1 @@\n-  static void free_metadata(ClassLoaderData* loader_data, T md) {\n+  static void free_metadata(ClassLoaderData* loader_data, T md, bool invoke_destructor = false) {\n@@ -72,1 +74,6 @@\n-      loader_data->metaspace_non_null()->deallocate((MetaWord*)md, size, md->is_klass());\n+      bool is_klass = md->is_klass();\n+      if (invoke_destructor) {\n+        using U = typename RemoveCV<typename RemovePointer<T>::type>::type;\n+        md->~U();\n+      }\n+      loader_data->metaspace_non_null()->deallocate((MetaWord*)md, size, is_klass);\n","filename":"src\/hotspot\/share\/memory\/metadataFactory.hpp","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -134,1 +134,1 @@\n-  MetadataFactory::free_metadata(loader_data, method_data());\n+  MetadataFactory::free_metadata(loader_data, method_data(), \/*invoke_destructor*\/ true);\n@@ -147,2 +147,0 @@\n-    \/\/ Destroy MethodData\n-    method_data()->~MethodData();\n@@ -602,2 +600,1 @@\n-    method_data->~MethodData();\n-    MetadataFactory::free_metadata(loader_data, method_data);\n+    MetadataFactory::free_metadata(loader_data, method_data, \/*invoke_destructor*\/ true);\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"}]}