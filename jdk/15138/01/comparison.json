{"files":[{"patch":"@@ -150,4 +150,5 @@\n-  if test -e $BINUTILS_DIR\/bfd\/libbfd.a && \\\n-      test -e $BINUTILS_DIR\/opcodes\/libopcodes.a && \\\n-      test -e $BINUTILS_DIR\/libiberty\/libiberty.a && \\\n-      test -e $BINUTILS_DIR\/zlib\/libz.a; then\n+  # We don't know the version, not checking for libsframe.a\n+  if test -e $BINUTILS_DIR\/bfd\/.libs\/libbfd.a && \\\n+     test -e $BINUTILS_DIR\/opcodes\/libopcodes.a && \\\n+     test -e $BINUTILS_DIR\/libiberty\/libiberty.a && \\\n+     test -e $BINUTILS_DIR\/zlib\/libz.a ; then\n@@ -193,1 +194,1 @@\n-    AC_MSG_NOTICE([configure command line: cd $BINUTILS_DIR && $BINUTILS_SRC\/configure --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target])\n+    AC_MSG_NOTICE([configure command line: cd $BINUTILS_DIR && $BINUTILS_SRC\/configure --without-zstd --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target])\n@@ -196,1 +197,1 @@\n-    $BINUTILS_SRC\/configure --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target\n+    $BINUTILS_SRC\/configure --without-zstd --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target\n@@ -241,0 +242,1 @@\n+    AC_CHECK_LIB(sframe, frame, [ HSDIS_LIBS=\"$HSDIS_LIBS -lsframe\" ], )\n@@ -243,1 +245,1 @@\n-    if test -e $BINUTILS_DIR\/bfd\/libbfd.a && \\\n+    if test -e $BINUTILS_DIR\/bfd\/.libs\/libbfd.a && \\\n@@ -254,1 +256,5 @@\n-      HSDIS_LIBS=\"$BINUTILS_DIR\/bfd\/libbfd.a $BINUTILS_DIR\/opcodes\/libopcodes.a $BINUTILS_DIR\/libiberty\/libiberty.a $BINUTILS_DIR\/zlib\/libz.a\"\n+      HSDIS_LIBS=\"$BINUTILS_DIR\/bfd\/.libs\/libbfd.a $BINUTILS_DIR\/opcodes\/libopcodes.a $BINUTILS_DIR\/libiberty\/libiberty.a $BINUTILS_DIR\/zlib\/libz.a\"\n+      # If we have libsframe add it.\n+      if test -e $BINUTILS_DIR\/libsframe\/.libs\/libsframe.a; then\n+        HSDIS_LIBS=\"$BINUTILS_DIR\/bfd\/.libs\/libbfd.a $BINUTILS_DIR\/opcodes\/libopcodes.a $BINUTILS_DIR\/libiberty\/libiberty.a $BINUTILS_DIR\/zlib\/libz.a $BINUTILS_DIR\/libsframe\/.libs\/libsframe.a\"\n+      fi\n","filename":"make\/autoconf\/lib-hsdis.m4","additions":14,"deletions":8,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -62,0 +62,1 @@\n+#include <bfdver.h>\n@@ -338,0 +339,4 @@\n+#ifdef LIBARCH_riscv64\n+                                 \/* On RISC-V we don't get the 'standard' instruction set if not empty string *\/\n+                                 app_data->insn_options);\n+#else\n@@ -340,0 +345,1 @@\n+#endif\n@@ -559,0 +565,17 @@\n+static fprintf_ftype target_fprintf_func = NULL;\n+\n+#if BFD_VERSION >= 239000000\n+static int wrapper_fprintf_styled_ftype(void *v, enum disassembler_style style_unused, const char* fmt, ...) {\n+  char buffer[1024] = {};\n+  va_list args;\n+  int r;\n+  va_start(args, fmt);\n+  r = vsnprintf(buffer, sizeof(buffer), fmt, args);\n+  va_end(args);\n+  if (target_fprintf_func != NULL) {\n+    return target_fprintf_func(v, \"%s\", buffer);\n+  }\n+  return r;\n+}\n+#endif\n+\n@@ -564,0 +587,4 @@\n+  target_fprintf_func = fprintf_func;\n+#if BFD_VERSION >= 239000000\n+  init_disassemble_info(dinfo, stream, fprintf_func, wrapper_fprintf_styled_ftype);\n+#else\n@@ -565,0 +592,1 @@\n+#endif\n","filename":"src\/utils\/hsdis\/binutils\/hsdis-binutils.c","additions":28,"deletions":0,"binary":false,"changes":28,"status":"modified"}]}