{"files":[{"patch":"@@ -150,4 +150,5 @@\n-  if test -e $BINUTILS_DIR\/bfd\/libbfd.a && \\\n-      test -e $BINUTILS_DIR\/opcodes\/libopcodes.a && \\\n-      test -e $BINUTILS_DIR\/libiberty\/libiberty.a && \\\n-      test -e $BINUTILS_DIR\/zlib\/libz.a; then\n+  # We don't know the version, not checking for libsframe.a\n+  if test -e $BINUTILS_DIR\/bfd\/.libs\/libbfd.a && \\\n+     test -e $BINUTILS_DIR\/opcodes\/libopcodes.a && \\\n+     test -e $BINUTILS_DIR\/libiberty\/libiberty.a && \\\n+     test -e $BINUTILS_DIR\/zlib\/libz.a ; then\n@@ -241,0 +242,1 @@\n+    AC_CHECK_LIB(sframe, frame, [ HSDIS_LIBS=\"$HSDIS_LIBS -lsframe\" ], )\n@@ -243,1 +245,1 @@\n-    if test -e $BINUTILS_DIR\/bfd\/libbfd.a && \\\n+    if test -e $BINUTILS_DIR\/bfd\/.libs\/libbfd.a && \\\n@@ -254,1 +256,5 @@\n-      HSDIS_LIBS=\"$BINUTILS_DIR\/bfd\/libbfd.a $BINUTILS_DIR\/opcodes\/libopcodes.a $BINUTILS_DIR\/libiberty\/libiberty.a $BINUTILS_DIR\/zlib\/libz.a\"\n+      HSDIS_LIBS=\"$BINUTILS_DIR\/bfd\/.libs\/libbfd.a $BINUTILS_DIR\/opcodes\/libopcodes.a $BINUTILS_DIR\/libiberty\/libiberty.a $BINUTILS_DIR\/zlib\/libz.a\"\n+      # If we have libsframe add it.\n+      if test -e $BINUTILS_DIR\/libsframe\/.libs\/libsframe.a; then\n+        HSDIS_LIBS=\"$HSDIS_LIBS $BINUTILS_DIR\/libsframe\/.libs\/libsframe.a\"\n+      fi\n@@ -258,0 +264,17 @@\n+  AC_MSG_CHECKING([Checking binutils API])\n+  if test -n \"$BINUTILS_SRC\"; then\n+    binutils_include_dir=$BINUTILS_SRC\/include\n+  else\n+    binutils_include_dir=$BINUTILS_DIR\/include\n+  fi\n+\n+  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([#include \"$binutils_include_dir\/dis-asm.h\"],[[void foo() {init_disassemble_info(0, 0, 0, 0);}]])],\n+    [\n+      AC_MSG_RESULT([New API])\n+      HSDIS_CFLAGS=\"$HSDIS_CFLAGS -DBINUTILS_NEW_API\"\n+    ],\n+    [\n+      AC_MSG_RESULT([Old API])\n+    ]\n+  )\n+\n","filename":"make\/autoconf\/lib-hsdis.m4","additions":29,"deletions":6,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -559,0 +559,17 @@\n+static fprintf_ftype target_fprintf_func = NULL;\n+\n+#ifdef BINUTILS_NEW_API\n+static int wrapper_fprintf_styled_ftype(void *v, enum disassembler_style style_unused, const char* fmt, ...) {\n+  char buffer[1024] = {};\n+  va_list args;\n+  int r;\n+  va_start(args, fmt);\n+  r = vsnprintf(buffer, sizeof(buffer), fmt, args);\n+  va_end(args);\n+  if (target_fprintf_func != NULL) {\n+    return target_fprintf_func(v, \"%s\", buffer);\n+  }\n+  return r;\n+}\n+#endif\n+\n@@ -564,0 +581,4 @@\n+  target_fprintf_func = fprintf_func;\n+#ifdef BINUTILS_NEW_API\n+  init_disassemble_info(dinfo, stream, fprintf_func, wrapper_fprintf_styled_ftype);\n+#else\n@@ -565,0 +586,1 @@\n+#endif\n","filename":"src\/utils\/hsdis\/binutils\/hsdis-binutils.c","additions":22,"deletions":0,"binary":false,"changes":22,"status":"modified"}]}