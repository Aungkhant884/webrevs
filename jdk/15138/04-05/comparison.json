{"files":[{"patch":"@@ -137,1 +137,2 @@\n-  BINUTILS_DIR=\"$CONFIGURESUPPORT_OUTPUTDIR\/binutils\"\n+  BINUTILS_BUILD_DIR=\"$CONFIGURESUPPORT_OUTPUTDIR\/binutils\"\n+  BINUTILS_INSTALL_DIR=\"$CONFIGURESUPPORT_OUTPUTDIR\/binutils-install\"\n@@ -146,2 +147,2 @@\n-  if ! test -d $BINUTILS_DIR; then\n-    $MKDIR -p $BINUTILS_DIR\n+  if ! test -d $BINUTILS_BUILD_DIR; then\n+    $MKDIR -p $BINUTILS_BUILD_DIR\n@@ -151,5 +152,4 @@\n-  if test -e $BINUTILS_DIR\/bfd\/.libs\/libbfd.a && \\\n-     test -e $BINUTILS_DIR\/opcodes\/libopcodes.a && \\\n-     test -e $BINUTILS_DIR\/libiberty\/libiberty.a && \\\n-     test -e $BINUTILS_DIR\/zlib\/libz.a ; then\n-    AC_MSG_NOTICE([Found binutils binaries in binutils source directory -- not building])\n+  if test -e $BINUTILS_INSTALL_DIR\/lib\/libbfd.a && \\\n+     test -e $BINUTILS_INSTALL_DIR\/lib\/libopcodes.a && \\\n+     test -e $BINUTILS_INSTALL_DIR\/lib\/libiberty.a; then\n+    AC_MSG_NOTICE([Found binutils binaries in binutils install directory -- not building])\n@@ -194,1 +194,1 @@\n-    AC_MSG_NOTICE([configure command line: cd $BINUTILS_DIR && $BINUTILS_SRC\/configure --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target])\n+    AC_MSG_NOTICE([configure command line: cd $BINUTILS_BUILD_DIR && $BINUTILS_SRC\/configure --disable-werror --prefix=$BINUTILS_INSTALL_DIR --enable-install-libiberty --with-system-zlib --without-zstd --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target])\n@@ -196,3 +196,3 @@\n-    cd \"$BINUTILS_DIR\"\n-    $BINUTILS_SRC\/configure --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target\n-    if test $? -ne 0 || ! test -e $BINUTILS_DIR\/Makefile; then\n+    cd \"$BINUTILS_BUILD_DIR\"\n+    $BINUTILS_SRC\/configure --disable-werror --prefix=$BINUTILS_INSTALL_DIR --enable-install-libiberty --with-system-zlib --without-zstd --disable-nls CFLAGS=\"$binutils_cflags\" CC=\"$binutils_cc\" AR=\"$AR\" $binutils_target\n+    if test $? -ne 0 || ! test -e $BINUTILS_BUILD_DIR\/Makefile; then\n@@ -203,1 +203,1 @@\n-    $MAKE all-opcodes\n+    $MAKE all-opcodes all-libiberty\n@@ -208,0 +208,6 @@\n+    AC_MSG_NOTICE([Running binutils make install])\n+    $MAKE install-opcodes install-libiberty\n+    if test $? -ne 0; then\n+      AC_MSG_NOTICE([Automatic building, install step, of binutils failed on make. Try building it manually])\n+      AC_MSG_ERROR([Cannot continue])\n+    fi\n@@ -227,1 +233,1 @@\n-    # Try building the source first. If it succeeds, it sets $BINUTILS_DIR.\n+    # Try building the source first. If it succeeds, it sets $BINUTILS_INSTALL_DIR.\n@@ -232,1 +238,1 @@\n-    BINUTILS_DIR=\"$with_binutils\"\n+    BINUTILS_INSTALL_DIR=\"$with_binutils\"\n@@ -236,0 +242,1 @@\n+  HSDIS_LDFLAGS=\"\"\n@@ -237,1 +244,3 @@\n-  if test \"x$BINUTILS_DIR\" = xsystem; then\n+  disasm_header=\"<dis-asm.h>\"\n+\n+  if test \"x$BINUTILS_INSTALL_DIR\" = xsystem; then\n@@ -240,1 +249,0 @@\n-    AC_CHECK_LIB(iberty, xmalloc, [ HSDIS_LIBS=\"$HSDIS_LIBS -liberty\" ], [ binutils_system_error=\"libiberty not found\" ])\n@@ -242,0 +250,2 @@\n+    \/\/ If we find them\n+    AC_CHECK_LIB(iberty, xmalloc, [ HSDIS_LIBS=\"$HSDIS_LIBS -liberty\" ])\n@@ -244,13 +254,7 @@\n-  elif test \"x$BINUTILS_DIR\" != x; then\n-    if test -e $BINUTILS_DIR\/bfd\/.libs\/libbfd.a && \\\n-        test -e $BINUTILS_DIR\/opcodes\/libopcodes.a && \\\n-        test -e $BINUTILS_DIR\/libiberty\/libiberty.a && \\\n-        test -e $BINUTILS_DIR\/zlib\/libz.a; then\n-      HSDIS_CFLAGS=\"-DLIBARCH_$OPENJDK_TARGET_CPU_LEGACY_LIB\"\n-      if test -n \"$BINUTILS_SRC\"; then\n-        HSDIS_CFLAGS=\"$HSDIS_CFLAGS -I$BINUTILS_SRC\/include -I$BINUTILS_DIR\/bfd\"\n-      else\n-        HSDIS_CFLAGS=\"$HSDIS_CFLAGS -I$BINUTILS_DIR\/include -I$BINUTILS_DIR\/bfd\"\n-      fi\n-      HSDIS_LDFLAGS=\"\"\n-      HSDIS_LIBS=\"$BINUTILS_DIR\/bfd\/.libs\/libbfd.a $BINUTILS_DIR\/opcodes\/libopcodes.a $BINUTILS_DIR\/libiberty\/libiberty.a $BINUTILS_DIR\/zlib\/libz.a\"\n+  elif test \"x$BINUTILS_INSTALL_DIR\" != x; then\n+    disasm_header=\"\\\"$BINUTILS_INSTALL_DIR\/include\/dis-asm.h\\\"\"\n+    if test -e $BINUTILS_INSTALL_DIR\/lib\/libbfd.a && \\\n+       test -e $BINUTILS_INSTALL_DIR\/lib\/libopcodes.a && \\\n+       test -e $BINUTILS_INSTALL_DIR\/lib\/libiberty.a; then\n+      HSDIS_CFLAGS=\"-DLIBARCH_$OPENJDK_TARGET_CPU_LEGACY_LIB -I$BINUTILS_INSTALL_DIR\/include\"\n+      HSDIS_LIBS=\"$BINUTILS_INSTALL_DIR\/lib\/libbfd.a $BINUTILS_INSTALL_DIR\/lib\/libopcodes.a $BINUTILS_INSTALL_DIR\/lib\/libiberty.a\"\n@@ -258,2 +262,2 @@\n-      if test -e $BINUTILS_DIR\/libsframe\/.libs\/libsframe.a; then\n-        HSDIS_LIBS=\"$HSDIS_LIBS $BINUTILS_DIR\/libsframe\/.libs\/libsframe.a\"\n+      if test -e $BINUTILS_INSTALL_DIR\/lib\/libsframe.a; then\n+        HSDIS_LIBS=\"$HSDIS_LIBS $BINUTILS_INSTALL_DIR\/lib\/libsframe.a\"\n@@ -261,0 +265,3 @@\n+      AC_CHECK_LIB(z, deflate, [ HSDIS_LIBS=\"$HSDIS_LIBS -lz\" ], AC_MSG_ERROR([libz not found]))\n+    else\n+      AC_MSG_ERROR([\"$BINUTILS_INSTALL_DIR\/libs\/ must contain libbfd.a, libopcodes.a, libiberty.a\"])\n@@ -265,7 +272,1 @@\n-  if test -n \"$BINUTILS_SRC\"; then\n-    binutils_include_dir=$BINUTILS_SRC\/include\n-  else\n-    binutils_include_dir=$BINUTILS_DIR\/include\n-  fi\n-\n-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([#include \"$binutils_include_dir\/dis-asm.h\"],[[void foo() {init_disassemble_info(0, 0, 0, 0);}]])],\n+  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([#include $disasm_header],[[void foo() {init_disassemble_info(0, 0, 0, 0);}]])],\n@@ -282,1 +283,1 @@\n-  case \"x$BINUTILS_DIR\" in\n+  case \"x$BINUTILS_INSTALL_DIR\" in\n@@ -305,1 +306,1 @@\n-        AC_MSG_RESULT([$BINUTILS_DIR])\n+        AC_MSG_RESULT([$BINUTILS_INSTALL_DIR])\n@@ -308,1 +309,1 @@\n-        AC_MSG_ERROR([$BINUTILS_DIR does not contain a proper binutils installation])\n+        AC_MSG_ERROR([$BINUTILS_INSTALL_DIR does not contain a proper binutils installation])\n","filename":"make\/autoconf\/lib-hsdis.m4","additions":43,"deletions":42,"binary":false,"changes":85,"status":"modified"},{"patch":"@@ -52,4 +52,0 @@\n-#ifndef SYSTEM_BINUTILS\n-#include <config.h> \/* required by bfd.h *\/\n-#endif\n-\n@@ -60,1 +56,4 @@\n-#include <libiberty.h>\n+\/* defines for bfd.h *\/\n+#define PACKAGE \"hsdis\"\n+#define PACKAGE_VERSION 1\n+\n","filename":"src\/utils\/hsdis\/binutils\/hsdis-binutils.c","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"}]}