{"files":[{"patch":"@@ -112,2 +112,1 @@\n-        if ((availinfo & (ImageObserver.ERROR | ImageObserver.FRAMEBITS)) == 0\n-            && missinginfo != 0) {\n+        if ((availinfo & ImageObserver.ERROR) == 0 && missinginfo != 0) {\n@@ -118,1 +117,2 @@\n-                while ((availinfo & ImageObserver.ERROR) == 0 &&\n+                while ((availinfo &\n+                        (ImageObserver.ERROR | ImageObserver.FRAMEBITS)) == 0 &&\n","filename":"src\/java.desktop\/share\/classes\/sun\/awt\/image\/ImageRepresentation.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -24,0 +24,1 @@\n+import java.awt.AWTException;\n@@ -36,0 +37,1 @@\n+import java.lang.reflect.InvocationTargetException;\n@@ -45,1 +47,2 @@\n- * gif image to the system clipboard\n+ * gif image to the system clipboard. We run the test two times. First with\n+ * image displayed on screen and second with it not displayed.\n@@ -52,1 +55,0 @@\n-\n@@ -54,0 +56,1 @@\n+    private static final CopyAnimatedGIFTest test = new CopyAnimatedGIFTest();\n@@ -82,0 +85,4 @@\n+    private void getImage() {\n+        img = Toolkit.getDefaultToolkit().createImage(imageData);\n+    }\n+\n@@ -99,4 +106,1 @@\n-    public static void main(String[] args) throws Exception {\n-\n-        final CopyAnimatedGIFTest test = new CopyAnimatedGIFTest();\n-\n+    private void runTest(boolean isImageDisplayed) throws AWTException, InterruptedException, InvocationTargetException {\n@@ -105,1 +109,6 @@\n-        EventQueue.invokeAndWait(test::createGUI);\n+        if (isImageDisplayed) {\n+            EventQueue.invokeAndWait(test::createGUI);\n+        }\n+        else {\n+            EventQueue.invokeAndWait(test::getImage);\n+        }\n@@ -116,1 +125,3 @@\n-            throw new RuntimeException(\"Image copying taking too long.\");\n+            String str = isImageDisplayed ? \" displayed\":\" not displayed\";\n+            throw new RuntimeException(\"Image copying taking too long for image\"\n+                                       + str + \" case\");\n@@ -118,0 +129,9 @@\n+\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+        \/\/ run test with Image showing up on screen\n+        test.runTest(true);\n+\n+        \/\/ run test without Image showing up\n+        test.runTest(false);\n","filename":"test\/jdk\/java\/awt\/Clipboard\/CopyAnimatedGIFTest.java","additions":28,"deletions":8,"binary":false,"changes":36,"status":"modified"}]}