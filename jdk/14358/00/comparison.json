{"files":[{"patch":"@@ -175,1 +175,1 @@\n-  static bool platform_print_native_stack(outputStream* st, const void* context, char *buf, int buf_size);\n+  static bool platform_print_native_stack(outputStream* st, const void* context, char *buf, int buf_size, address& lastpc);\n","filename":"src\/hotspot\/os\/aix\/os_aix.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -51,1 +51,1 @@\n-                                          char *buf, int buf_size);\n+                                          char *buf, int buf_size, address& lastpc);\n","filename":"src\/hotspot\/os\/windows\/os_windows.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -519,1 +519,1 @@\n-bool os::Aix::platform_print_native_stack(outputStream* st, const void* context, char *buf, int buf_size) {\n+bool os::Aix::platform_print_native_stack(outputStream* st, const void* context, char *buf, int buf_size, address& lastpc) {\n","filename":"src\/hotspot\/os_cpu\/aix_ppc\/os_aix_ppc.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -33,2 +33,2 @@\n-                                            char *buf, int buf_size) {\n-  return os::Aix::platform_print_native_stack(st, context, buf, buf_size);\n+                                            char *buf, int buf_size, address& lastpc) {\n+  return os::Aix::platform_print_native_stack(st, context, buf, buf_size, lastpc);\n","filename":"src\/hotspot\/os_cpu\/aix_ppc\/os_aix_ppc.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -227,1 +227,1 @@\n-                                            char *buf, int buf_size)\n+                                            char *buf, int buf_size, address& lastpc)\n@@ -248,1 +248,1 @@\n-  address lastpc = 0;\n+  address lastpc_internal = 0;\n@@ -255,1 +255,1 @@\n-      if (count == 2 && lastpc == pc) {\n+      if (count == 2 && lastpc_internal == pc) {\n@@ -271,1 +271,1 @@\n-      lastpc = pc;\n+      lastpc_internal = pc;\n@@ -277,0 +277,1 @@\n+      lastpc = lastpc_internal;\n","filename":"src\/hotspot\/os_cpu\/windows_x86\/os_windows_x86.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -34,2 +34,2 @@\n-                                     char *buf, int buf_size) {\n-  return os::win32::platform_print_native_stack(st, context, buf, buf_size);\n+                                     char *buf, int buf_size, address& lastpc) {\n+  return os::win32::platform_print_native_stack(st, context, buf, buf_size, lastpc);\n","filename":"src\/hotspot\/os_cpu\/windows_x86\/os_windows_x86.inline.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1011,1 +1011,1 @@\n-                                                 char *buf, int buf_size);\n+                                                 char *buf, int buf_size, address& lastpc);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-                                     char *buf, int buf_size) {\n+                                     char *buf, int buf_size, address& lastpc) {\n","filename":"src\/hotspot\/share\/runtime\/os.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -657,1 +657,2 @@\n-  if (os::platform_print_native_stack(tty, nullptr, buf, sizeof(buf))) {\n+  address lastpc = nullptr;\n+  if (os::platform_print_native_stack(tty, nullptr, buf, sizeof(buf), lastpc)) {\n","filename":"src\/hotspot\/share\/utilities\/debug.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -678,0 +678,6 @@\n+  \/\/ keep track of which code has already been printed\n+  const int printed_capacity = max_error_log_print_code;\n+  address printed[printed_capacity];\n+  printed[0] = nullptr;\n+  int printed_len = 0;\n+\n@@ -966,1 +972,2 @@\n-    if (os::platform_print_native_stack(st, _context, buf, sizeof(buf))) {\n+    address lastpc = nullptr;\n+    if (os::platform_print_native_stack(st, _context, buf, sizeof(buf), lastpc)) {\n@@ -969,0 +976,5 @@\n+      \/\/ Stack walking may got stuck. Try to print the calling code.\n+      if (lastpc != nullptr) {\n+        st->print_cr(\"called by the following code:\");\n+        print_code(st, _thread, lastpc, true, printed, printed_capacity);\n+      }\n@@ -1063,4 +1075,0 @@\n-    const int printed_capacity = max_error_log_print_code;\n-    address printed[printed_capacity];\n-    printed[0] = nullptr;\n-    int printed_len = 0;\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"}]}