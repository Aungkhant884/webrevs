{"files":[{"patch":"@@ -1153,0 +1153,1 @@\n+      set_total_selected_for_rebuild(cl.total_selected_for_rebuild());\n@@ -1323,2 +1324,2 @@\n-\n-  {\n+  bool has_rebuilt_remembered_sets = (total_selected_for_rebuild() > 0);\n+  if (has_rebuilt_remembered_sets) {\n@@ -1328,0 +1329,2 @@\n+  } else {\n+    log_debug(gc, remset, tracking)(\"No Remembered Sets To Update After Rebuild\");\n@@ -1343,1 +1346,1 @@\n-    policy->record_concurrent_mark_cleanup_end();\n+    policy->record_concurrent_mark_cleanup_end(has_rebuilt_remembered_sets);\n@@ -1956,0 +1959,6 @@\n+  \/\/ If Remark did not select any regions for RemSet rebuild,\n+  \/\/ skip the rebuild remembered set phase\n+  if (total_selected_for_rebuild() == 0) {\n+    log_debug(gc, remset, tracking)(\"Skipping Remembered Set Rebuild. No Regions Selected For Rebuild.\");\n+    return;\n+  }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.cpp","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -460,0 +460,1 @@\n+  uint _total_selected_for_rebuild;\n@@ -598,0 +599,4 @@\n+\n+  uint total_selected_for_rebuild() const { return _total_selected_for_rebuild; }\n+  void set_total_selected_for_rebuild(uint num) { _total_selected_for_rebuild = num; }\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -552,1 +552,0 @@\n-\n@@ -1101,3 +1100,5 @@\n-void G1Policy::record_concurrent_mark_cleanup_end() {\n-  G1CollectionSetCandidates* candidates = G1CollectionSetChooser::build(_g1h->workers(), _g1h->num_regions());\n-  _collection_set->set_candidates(candidates);\n+void G1Policy::record_concurrent_mark_cleanup_end(bool has_rebuilt_remembered_sets) {\n+  if (has_rebuilt_remembered_sets) {\n+    G1CollectionSetCandidates* candidates = G1CollectionSetChooser::build(_g1h->workers(), _g1h->num_regions());\n+    _collection_set->set_candidates(candidates);\n+  }\n@@ -1137,0 +1138,3 @@\n+  if (_collection_set->candidates() == NULL) {\n+    return;\n+  }\n@@ -1232,1 +1236,1 @@\n-  if (candidates->is_empty()) {\n+  if (candidates == NULL || candidates->is_empty()) {\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -324,1 +324,1 @@\n-  void record_concurrent_mark_cleanup_end();\n+  void record_concurrent_mark_cleanup_end(bool has_rebuilt_remembered_sets);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}