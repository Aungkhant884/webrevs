{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,0 +40,1 @@\n+#include \"memory\/allocation.hpp\"\n@@ -3383,1 +3384,1 @@\n-    if (p->is_readable()) {\n+    if (p->readable()) {\n@@ -3430,2 +3431,0 @@\n-  jvmtiError err =JVMTI_ERROR_NOT_AVAILABLE;\n-\n@@ -3434,2 +3433,9 @@\n-      if (p->set_writeable_value(value_ptr)) {\n-        err =  JVMTI_ERROR_NONE;\n+      if (p->writeable()) {\n+        if (p->set_value(value_ptr, AllocFailStrategy::RETURN_NULL)) {\n+          return JVMTI_ERROR_NONE;\n+        } else {\n+          return JVMTI_ERROR_OUT_OF_MEMORY;\n+        }\n+      } else {\n+        \/\/ We found a property, but it's not writeable\n+        return JVMTI_ERROR_NOT_AVAILABLE;\n@@ -3439,1 +3445,3 @@\n-  return err;\n+\n+  \/\/ We cannot find a property of the given name\n+  return JVMTI_ERROR_NOT_AVAILABLE;\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnv.cpp","additions":15,"deletions":7,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -128,3 +128,5 @@\n-bool PathString::set_value(const char *value) {\n-  if (_value != NULL) {\n-    FreeHeap(_value);\n+bool PathString::set_value(const char *value, AllocFailType alloc_failmode) {\n+  char* new_value = AllocateHeap(strlen(value)+1, mtArguments, alloc_failmode);\n+  if (new_value == NULL) {\n+    assert(alloc_failmode == AllocFailStrategy::RETURN_NULL, \"must be\");\n+    return false;\n@@ -132,2 +134,0 @@\n-  _value = AllocateHeap(strlen(value)+1, mtArguments);\n-  assert(_value != NULL, \"Unable to allocate space for new path value\");\n@@ -135,4 +135,1 @@\n-    strcpy(_value, value);\n-  } else {\n-    \/\/ not able to allocate\n-    return false;\n+    FreeHeap(_value);\n@@ -140,0 +137,2 @@\n+  _value = new_value;\n+  strcpy(_value, value);\n@@ -4257,1 +4256,1 @@\n-    if (pl->is_readable()) {\n+    if (pl->readable()) {\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":9,"deletions":10,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"memory\/allocation.hpp\"\n@@ -69,1 +70,2 @@\n-  bool set_value(const char *value);\n+  \/\/ return false iff OOM && alloc_failmode == AllocFailStrategy::RETURN_NULL\n+  bool set_value(const char *value, AllocFailType alloc_failmode = AllocFailStrategy::EXIT_OOM);\n@@ -101,1 +103,0 @@\n-  bool writeable() { return _writeable; }\n@@ -110,0 +111,1 @@\n+  bool writeable() const              { return _writeable; }\n@@ -111,1 +113,1 @@\n-  bool is_readable() const {\n+  bool readable() const {\n@@ -123,1 +125,1 @@\n-  bool set_writeable_value(const char *value) {\n+  void set_writeable_value(const char *value) {\n@@ -125,1 +127,1 @@\n-      return set_value(value);\n+      set_value(value);\n@@ -127,1 +129,0 @@\n-    return false;\n","filename":"src\/hotspot\/share\/runtime\/arguments.hpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -749,1 +749,1 @@\n-        if (p->is_readable()) {\n+        if (p->readable()) {\n","filename":"src\/hotspot\/share\/utilities\/ostream.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}