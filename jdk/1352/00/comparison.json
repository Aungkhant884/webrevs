{"files":[{"patch":"@@ -1854,0 +1854,3 @@\n+    \/\/ Setup EvacOOM scope below reentrant lock to avoid deadlock with\n+    \/\/ nmethod_entry_barrier\n+    ShenandoahEvacOOMScope oom;\n@@ -1890,1 +1893,0 @@\n-    ShenandoahEvacOOMScope oom;\n@@ -1892,5 +1894,7 @@\n-      \/\/ vm_roots and weak_roots are OopStorage backed roots, concurrent iteration\n-      \/\/ may race against OopStorage::release() calls.\n-      ShenandoahEvacUpdateOopStorageRootsClosure cl;\n-      _vm_roots.oops_do<ShenandoahEvacUpdateOopStorageRootsClosure>(&cl, worker_id);\n-    }\n+      ShenandoahEvacOOMScope oom;\n+      {\n+        \/\/ vm_roots and weak_roots are OopStorage backed roots, concurrent iteration\n+        \/\/ may race against OopStorage::release() calls.\n+        ShenandoahEvacUpdateOopStorageRootsClosure cl;\n+        _vm_roots.oops_do<ShenandoahEvacUpdateOopStorageRootsClosure>(&cl, worker_id);\n+      }\n@@ -1898,4 +1902,5 @@\n-    {\n-      ShenandoahEvacuateUpdateRootsClosure<> cl;\n-      CLDToOopClosure clds(&cl, ClassLoaderData::_claim_strong);\n-      _cld_roots.cld_do(&clds, worker_id);\n+      {\n+        ShenandoahEvacuateUpdateRootsClosure<> cl;\n+        CLDToOopClosure clds(&cl, ClassLoaderData::_claim_strong);\n+        _cld_roots.cld_do(&clds, worker_id);\n+      }\n@@ -1904,0 +1909,1 @@\n+    \/\/ Cannot setup ShenandoahEvacOOMScope here, due to potential deadlock with nmethod_entry_barrier.\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":16,"deletions":10,"binary":false,"changes":26,"status":"modified"}]}