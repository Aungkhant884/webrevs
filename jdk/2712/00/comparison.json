{"files":[{"patch":"@@ -115,2 +115,1 @@\n-  Klass* k = SystemDictionary::find_instance_or_array_klass(sym, loader, protection_domain, thread);\n-  assert(!thread->has_pending_exception(), \"should not throw\");\n+  Klass* k = SystemDictionary::find_instance_or_array_klass(sym, loader, protection_domain);\n","filename":"src\/hotspot\/share\/aot\/aotCodeHeap.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -307,1 +307,1 @@\n-    Klass* k = SystemDictionary::find(name, Handle(), Handle(), THREAD);\n+    InstanceKlass* ik = SystemDictionary::find_instance_klass(name, Handle(), Handle());\n@@ -309,2 +309,2 @@\n-    if (!HAS_PENDING_EXCEPTION && k != NULL) {\n-      oop obj = InstanceKlass::cast(k)->allocate_instance(THREAD);\n+    if (ik != NULL) {\n+      oop obj = ik->allocate_instance(THREAD);\n@@ -451,2 +451,1 @@\n-      kls = SystemDictionary::find_instance_or_array_klass(sym, loader, domain,\n-                                                           CHECK_AND_CLEAR_(fail_type));\n+      kls = SystemDictionary::find_instance_or_array_klass(sym, loader, domain);\n","filename":"src\/hotspot\/share\/ci\/ciEnv.cpp","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -902,4 +902,3 @@\n-Klass* SystemDictionary::find(Symbol* class_name,\n-                              Handle class_loader,\n-                              Handle protection_domain,\n-                              TRAPS) {\n+InstanceKlass* SystemDictionary::find_instance_klass(Symbol* class_name,\n+                                                     Handle class_loader,\n+                                                     Handle protection_domain) {\n@@ -910,2 +909,2 @@\n-  class_loader = Handle(THREAD, java_lang_ClassLoader::non_reflection_class_loader(class_loader()));\n-  ClassLoaderData* loader_data = ClassLoaderData::class_loader_data_or_null(class_loader());\n+  oop class_loader_oop = java_lang_ClassLoader::non_reflection_class_loader(class_loader());\n+  ClassLoaderData* loader_data = ClassLoaderData::class_loader_data_or_null(class_loader_oop);\n@@ -921,2 +920,1 @@\n-  return dictionary->find(name_hash, class_name,\n-                          protection_domain);\n+  return dictionary->find(name_hash, class_name, protection_domain);\n@@ -929,2 +927,1 @@\n-                                                      Handle protection_domain,\n-                                                      TRAPS) {\n+                                                      Handle protection_domain) {\n@@ -944,1 +941,1 @@\n-      k = SystemDictionary::find(ss.as_symbol(), class_loader, protection_domain, THREAD);\n+      k = SystemDictionary::find_instance_klass(ss.as_symbol(), class_loader, protection_domain);\n@@ -950,1 +947,1 @@\n-    k = find(class_name, class_loader, protection_domain, THREAD);\n+    k = find_instance_klass(class_name, class_loader, protection_domain);\n@@ -1222,1 +1219,1 @@\n-    Klass* check = find(name, class_loader, protection_domain, CHECK_0);\n+    InstanceKlass* check = find_instance_klass(name, class_loader, protection_domain);\n@@ -1900,1 +1897,1 @@\n-                                              no_protection_domain, CHECK_NULL);\n+                                              no_protection_domain);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":11,"deletions":14,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -142,1 +142,1 @@\n-  static Klass* find(Symbol* class_name, Handle class_loader, Handle protection_domain, TRAPS);\n+  static InstanceKlass* find_instance_klass(Symbol* class_name, Handle class_loader, Handle protection_domain);\n@@ -149,2 +149,1 @@\n-                                             Handle protection_domain,\n-                                             TRAPS);\n+                                             Handle protection_domain);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1516,1 +1516,1 @@\n-  return SystemDictionary::find(name, class_loader, protection_domain, THREAD) != NULL;\n+  return SystemDictionary::find_instance_klass(name, class_loader, protection_domain) != NULL;\n","filename":"src\/hotspot\/share\/jfr\/instrumentation\/jfrEventClassTransformer.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -550,1 +550,3 @@\n-      resolved_klass = SystemDictionary::find(strippedsym, class_loader, protection_domain, CHECK_NULL);\n+      resolved_klass = SystemDictionary::find_instance_klass(strippedsym,\n+                                                             class_loader,\n+                                                             protection_domain);\n@@ -556,4 +558,3 @@\n-        resolved_klass = SystemDictionary::find(strippedsym,\n-                                                class_loader,\n-                                                protection_domain,\n-                                                CHECK_NULL);\n+        resolved_klass = SystemDictionary::find_instance_klass(strippedsym,\n+                                                               class_loader,\n+                                                               protection_domain);\n@@ -567,1 +568,3 @@\n-      resolved_klass = SystemDictionary::find(class_name, class_loader, protection_domain, CHECK_NULL);\n+      resolved_klass = SystemDictionary::find_instance_klass(class_name,\n+                                                             class_loader,\n+                                                             protection_domain);\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCompilerToVM.cpp","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -1165,1 +1165,1 @@\n-      found_klass = SystemDictionary::find_instance_or_array_klass(sym, loader, domain, CHECK_NULL);\n+      found_klass = SystemDictionary::find_instance_or_array_klass(sym, loader, domain);\n","filename":"src\/hotspot\/share\/jvmci\/jvmciRuntime.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -585,1 +585,1 @@\n-    Klass* k = SystemDictionary::find(name, h_loader, h_prot, thread);\n+    Klass* k = SystemDictionary::find_instance_klass(name, h_loader, h_prot);\n","filename":"src\/hotspot\/share\/oops\/constantPool.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -894,1 +894,1 @@\n-    return SystemDictionary::find(klass_name, loader, prot, thread) != NULL;\n+    return SystemDictionary::find_instance_klass(klass_name, loader, prot) != NULL;\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1073,2 +1073,1 @@\n-                                                              Handle(),\n-                                                              CHECK_NULL);\n+                                                              Handle());\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -906,1 +906,1 @@\n-  static InstanceKlass* find_cache_klass(Symbol* klass_name, TRAPS) {\n+  static InstanceKlass* find_cache_klass(Symbol* klass_name) {\n@@ -909,3 +909,2 @@\n-    Klass* k = SystemDictionary::find(klass_name, Handle(), Handle(), THREAD);\n-    guarantee(k != NULL, \"%s must be loaded\", klass_name_str);\n-    InstanceKlass* ik = InstanceKlass::cast(k);\n+    InstanceKlass* ik = SystemDictionary::find_instance_klass(klass_name, Handle(), Handle());\n+    guarantee(ik != NULL, \"%s must be loaded\", klass_name_str);\n@@ -925,1 +924,1 @@\n-    InstanceKlass* ik = BoxCacheBase<CacheType>::find_cache_klass(CacheType::symbol(), thread);\n+    InstanceKlass* ik = BoxCacheBase<CacheType>::find_cache_klass(CacheType::symbol());\n@@ -981,1 +980,1 @@\n-    InstanceKlass* ik = find_cache_klass(java_lang_Boolean::symbol(), thread);\n+    InstanceKlass* ik = find_cache_klass(java_lang_Boolean::symbol());\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -396,1 +396,1 @@\n-    k = SystemDictionary::find(name, class_loader, protection_domain, CHECK_NULL);\n+    k = SystemDictionary::find_instance_klass(name, class_loader, protection_domain);\n","filename":"src\/hotspot\/share\/runtime\/signature.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -906,3 +906,1 @@\n-static const char* get_java_version(TRAPS) {\n-  Klass* k = SystemDictionary::find(vmSymbols::java_lang_VersionProps(),\n-                                    Handle(), Handle(), CHECK_AND_CLEAR_NULL);\n+static const char* get_java_version(InstanceKlass* ik) {\n@@ -910,3 +908,3 @@\n-  bool found = k != NULL &&\n-               InstanceKlass::cast(k)->find_local_field(vmSymbols::java_version_name(),\n-                                                        vmSymbols::string_signature(), &fd);\n+  bool found = ik != NULL &&\n+               ik->find_local_field(vmSymbols::java_version_name(),\n+                                    vmSymbols::string_signature(), &fd);\n@@ -914,1 +912,1 @@\n-    oop name_oop = k->java_mirror()->obj_field(fd.offset());\n+    oop name_oop = ik->java_mirror()->obj_field(fd.offset());\n@@ -928,3 +926,1 @@\n-static const char* get_java_runtime_name(TRAPS) {\n-  Klass* k = SystemDictionary::find(vmSymbols::java_lang_VersionProps(),\n-                                    Handle(), Handle(), CHECK_AND_CLEAR_NULL);\n+static const char* get_java_runtime_name(InstanceKlass* ik) {\n@@ -932,3 +928,3 @@\n-  bool found = k != NULL &&\n-               InstanceKlass::cast(k)->find_local_field(vmSymbols::java_runtime_name_name(),\n-                                                        vmSymbols::string_signature(), &fd);\n+  bool found = ik != NULL &&\n+               ik->find_local_field(vmSymbols::java_runtime_name_name(),\n+                                    vmSymbols::string_signature(), &fd);\n@@ -936,1 +932,1 @@\n-    oop name_oop = k->java_mirror()->obj_field(fd.offset());\n+    oop name_oop = ik->java_mirror()->obj_field(fd.offset());\n@@ -950,3 +946,1 @@\n-static const char* get_java_runtime_version(TRAPS) {\n-  Klass* k = SystemDictionary::find(vmSymbols::java_lang_VersionProps(),\n-                                    Handle(), Handle(), CHECK_AND_CLEAR_NULL);\n+static const char* get_java_runtime_version(InstanceKlass* ik) {\n@@ -954,3 +948,3 @@\n-  bool found = k != NULL &&\n-               InstanceKlass::cast(k)->find_local_field(vmSymbols::java_runtime_version_name(),\n-                                                        vmSymbols::string_signature(), &fd);\n+  bool found = ik != NULL &&\n+               ik->find_local_field(vmSymbols::java_runtime_version_name(),\n+                                    vmSymbols::string_signature(), &fd);\n@@ -958,1 +952,1 @@\n-    oop name_oop = k->java_mirror()->obj_field(fd.offset());\n+    oop name_oop = ik->java_mirror()->obj_field(fd.offset());\n@@ -972,3 +966,1 @@\n-static const char* get_java_runtime_vendor_version(TRAPS) {\n-  Klass* k = SystemDictionary::find(vmSymbols::java_lang_VersionProps(),\n-                                    Handle(), Handle(), CHECK_AND_CLEAR_NULL);\n+static const char* get_java_runtime_vendor_version(InstanceKlass* ik) {\n@@ -976,3 +968,3 @@\n-  bool found = k != NULL &&\n-               InstanceKlass::cast(k)->find_local_field(vmSymbols::java_runtime_vendor_version_name(),\n-                                                        vmSymbols::string_signature(), &fd);\n+  bool found = ik != NULL &&\n+               ik->find_local_field(vmSymbols::java_runtime_vendor_version_name(),\n+                                    vmSymbols::string_signature(), &fd);\n@@ -980,1 +972,1 @@\n-    oop name_oop = k->java_mirror()->obj_field(fd.offset());\n+    oop name_oop = ik->java_mirror()->obj_field(fd.offset());\n@@ -994,3 +986,1 @@\n-static const char* get_java_runtime_vendor_vm_bug_url(TRAPS) {\n-  Klass* k = SystemDictionary::find(vmSymbols::java_lang_VersionProps(),\n-                                    Handle(), Handle(), CHECK_AND_CLEAR_NULL);\n+static const char* get_java_runtime_vendor_vm_bug_url(InstanceKlass* ik) {\n@@ -998,3 +988,3 @@\n-  bool found = k != NULL &&\n-               InstanceKlass::cast(k)->find_local_field(vmSymbols::java_runtime_vendor_vm_bug_url_name(),\n-                                                        vmSymbols::string_signature(), &fd);\n+  bool found = ik != NULL &&\n+               ik->find_local_field(vmSymbols::java_runtime_vendor_vm_bug_url_name(),\n+                                    vmSymbols::string_signature(), &fd);\n@@ -1002,1 +992,1 @@\n-    oop name_oop = k->java_mirror()->obj_field(fd.offset());\n+    oop name_oop = ik->java_mirror()->obj_field(fd.offset());\n@@ -3025,5 +3015,7 @@\n-  JDK_Version::set_java_version(get_java_version(THREAD));\n-  JDK_Version::set_runtime_name(get_java_runtime_name(THREAD));\n-  JDK_Version::set_runtime_version(get_java_runtime_version(THREAD));\n-  JDK_Version::set_runtime_vendor_version(get_java_runtime_vendor_version(THREAD));\n-  JDK_Version::set_runtime_vendor_vm_bug_url(get_java_runtime_vendor_vm_bug_url(THREAD));\n+  InstanceKlass* ik = SystemDictionary::find_instance_klass(vmSymbols::java_lang_VersionProps(),\n+                                                            Handle(), Handle());\n+  JDK_Version::set_java_version(get_java_version(ik));\n+  JDK_Version::set_runtime_name(get_java_runtime_name(ik));\n+  JDK_Version::set_runtime_version(get_java_runtime_version(ik));\n+  JDK_Version::set_runtime_vendor_version(get_java_runtime_vendor_version(ik));\n+  JDK_Version::set_runtime_vendor_vm_bug_url(get_java_runtime_vendor_vm_bug_url(ik));\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":32,"deletions":40,"binary":false,"changes":72,"status":"modified"}]}