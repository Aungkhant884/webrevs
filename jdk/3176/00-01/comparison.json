{"files":[{"patch":"@@ -408,1 +408,1 @@\n-  EXCEPTION_CONTEXT;\n+  Thread* current = Thread::current();\n@@ -431,2 +431,2 @@\n-    loader = Handle(THREAD, accessing_klass->loader());\n-    domain = Handle(THREAD, accessing_klass->protection_domain());\n+    loader = Handle(current, accessing_klass->loader());\n+    domain = Handle(current, accessing_klass->protection_domain());\n","filename":"src\/hotspot\/share\/ci\/ciEnv.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1234,2 +1234,1 @@\n-  bool visible = is_shared_class_visible(class_name, ik, pkg_entry, class_loader);\n-  if (!visible) {\n+  if (!is_shared_class_visible(class_name, ik, pkg_entry, class_loader)) {\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1864,11 +1864,14 @@\n-  if (Thread::current()->is_VM_thread()) {\n-    assert(DynamicDumpSharedSpaces, \"must be\");\n-    \/\/ We are re-laying out the vtable\/itables of the *copy* of\n-    \/\/ a class during the final stage of dynamic dumping. The\n-    \/\/ linking constraints for this class has already been recorded.\n-    return;\n-  }\n-  Arguments::assert_is_dumping_archive();\n-  DumpTimeSharedClassInfo* info = find_or_allocate_info_for(klass);\n-  if (info != NULL) {\n-    info->record_linking_constraint(name, loader1, loader2);\n+  if (DynamicDumpSharedSpaces) {\n+    if (Thread::current()->is_VM_thread()) {\n+      \/\/ We are re-laying out the vtable\/itables of the *copy* of\n+      \/\/ a class during the final stage of dynamic dumping. The\n+      \/\/ linking constraints for this class has already been recorded.\n+      return;\n+    }\n+  } else {\n+    assert(!Thread::current()->is_VM_thread(), \"must not be\");\n+    Arguments::assert_is_dumping_archive();\n+    DumpTimeSharedClassInfo* info = find_or_allocate_info_for(klass);\n+    if (info != NULL) {\n+      info->record_linking_constraint(name, loader1, loader2);\n+    }\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":14,"deletions":11,"binary":false,"changes":25,"status":"modified"}]}