{"files":[{"patch":"@@ -199,3 +199,2 @@\n-    EntryCountType volatile* _value;\n-    EntryCountType volatile _original_value;\n-    bool _success;\n+    EntryCountType volatile* _num_entries_addr;\n+    EntryCountType _local_num_entries;\n@@ -205,2 +204,5 @@\n-    EntryCountType num_entries() const { return _original_value; }\n-    void inc_num_entries() { _success = true; }\n+    EntryCountType num_entries() const { return _local_num_entries; }\n+    void inc_num_entries() {\n+      assert(((_local_num_entries + 1) & EntryMask) == (EntryCountType)(_local_num_entries + 1), \"no overflow\" );\n+      _local_num_entries++;\n+    }\n@@ -209,3 +211,1 @@\n-      assert(((_original_value + _success) & EntryMask) == (EntryCountType)(_original_value + _success), \"precondition!\" );\n-\n-      Atomic::release_store(_value, (EntryCountType)(_original_value + _success));\n+      Atomic::release_store(_num_entries_addr, _local_num_entries);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSetContainers.hpp","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -148,3 +148,2 @@\n-inline G1CardSetArray::G1CardSetArrayLocker::G1CardSetArrayLocker(EntryCountType volatile* value) :\n-  _value(value),\n-  _success(false) {\n+inline G1CardSetArray::G1CardSetArrayLocker::G1CardSetArrayLocker(EntryCountType volatile* num_entries_addr) :\n+  _num_entries_addr(num_entries_addr) {\n@@ -152,1 +151,1 @@\n-  EntryCountType original_value = (*_value) & EntryMask;\n+  EntryCountType num_entries = Atomic::load(_num_entries_addr) & EntryMask;\n@@ -154,4 +153,4 @@\n-    EntryCountType old_value = Atomic::cmpxchg(_value,\n-                                               original_value,\n-                                               (EntryCountType)(original_value | LockBitMask));\n-    if (old_value == original_value) {\n+    EntryCountType old_value = Atomic::cmpxchg(_num_entries_addr,\n+                                               num_entries,\n+                                               (EntryCountType)(num_entries | LockBitMask));\n+    if (old_value == num_entries) {\n@@ -159,1 +158,1 @@\n-      _original_value = original_value;\n+      _local_num_entries = num_entries;\n@@ -163,1 +162,1 @@\n-    original_value = old_value & EntryMask;\n+    num_entries = old_value & EntryMask;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSetContainers.inline.hpp","additions":9,"deletions":10,"binary":false,"changes":19,"status":"modified"}]}