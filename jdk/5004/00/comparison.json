{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -867,0 +867,16 @@\n+     \/*\n+      * isFileSigned()\n+      * We cannot use this internally to decide whether to unsign a file\n+      * or not before resigning, because both unsigned and badly signed\n+      * return false. It can be used to differentiate between a signed and\n+      * unsigned app-image.\n+      *\/\n+     public static boolean isFileSigned(Path file) {\n+         try {\n+             IOUtils.exec(new ProcessBuilder(\"\/usr\/bin\/codesign\",\n+                         \"--verify\", file.toString()));\n+         } catch (IOException ex) {\n+             return false;\n+         }\n+         return true;\n+     }\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/MacAppImageBuilder.java","additions":17,"deletions":1,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -44,0 +44,1 @@\n+import static jdk.jpackage.internal.MacAppImageBuilder.SIGN_BUNDLE;\n@@ -137,0 +138,12 @@\n+            if (SIGN_BUNDLE.fetchFrom(params)) {\n+                \/\/ if signing bundle with app-image, warn user if app-image\n+                \/\/ is not allready signed.\n+                Path launcher = applicationImage.resolve(\"Contents\/MacOS\")\n+                        .resolve(APP_NAME.fetchFrom(params));\n+\n+                if (IOUtils.exists(launcher) &&\n+                        !MacAppImageBuilder.isFileSigned(launcher)) {\n+                    Log.info(MessageFormat.format(I18N.getString(\n+                             \"warning.unsigned.app.image\"), getID()));\n+                }\n+            }\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/MacBaseInstallerBundler.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -91,0 +91,1 @@\n+warning.unsigned.app.image=Warning: Using unsigned app-image to build signed {0}.\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources.properties","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -90,0 +90,1 @@\n+warning.unsigned.app.image=Warning: Using unsigned app-image to build signed {0}.\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources_ja.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -90,0 +90,1 @@\n+warning.unsigned.app.image=Warning: Using unsigned app-image to build signed {0}.\n","filename":"src\/jdk.jpackage\/macosx\/classes\/jdk\/jpackage\/internal\/resources\/MacResources_zh_CN.properties","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}