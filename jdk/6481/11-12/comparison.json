{"files":[{"patch":"@@ -33,0 +33,1 @@\n+import java.nio.file.Files;\n@@ -34,0 +35,1 @@\n+import java.util.Arrays;\n@@ -94,1 +96,2 @@\n-        File jarFileSourceDate = new File(\"JarEntryTimeSourceDate.jar\");\n+        File jarFileSourceDate1 = new File(\"JarEntryTimeSourceDate1.jar\");\n+        File jarFileSourceDate2 = new File(\"JarEntryTimeSourceDate2.jar\");\n@@ -179,1 +182,1 @@\n-            jarFileSourceDate.delete();\n+            jarFileSourceDate1.delete();\n@@ -183,1 +186,1 @@\n-                           \"--file\", jarFileSourceDate.getName(),\n+                           \"--file\", jarFileSourceDate1.getName(),\n@@ -186,1 +189,1 @@\n-            check(jarFileSourceDate.exists());\n+            check(jarFileSourceDate1.exists());\n@@ -188,2 +191,2 @@\n-            \/\/ Extract jarFileSourceDate and check last modified values\n-            extractJar(jarFileSourceDate, false);\n+            \/\/ Extract jarFileSourceDate1 and check last modified values\n+            extractJar(jarFileSourceDate1, false);\n@@ -209,0 +212,37 @@\n+        \/\/ Test jars are reproducible across timezones\n+        TimeZone tz0    = TimeZone.getDefault();\n+        TimeZone tzAsia = TimeZone.getTimeZone(\"Asia\/Shanghai\");\n+        TimeZone tzLA   = TimeZone.getTimeZone(\"America\/Los_Angeles\");\n+        for (String sourceDate : sourceDates) {\n+            jarFileSourceDate1.delete();\n+            jarFileSourceDate2.delete();\n+            createOuterInnerDirs(dirOuter, dirInner);\n+            TimeZone.setDefault(tzAsia);\n+            check(JAR_TOOL.run(System.out, System.err,\n+                           \"--create\",\n+                           \"--file\", jarFileSourceDate1.getName(),\n+                           \"--date\", sourceDate,\n+                           dirOuter.getName()) == 0);\n+            check(jarFileSourceDate1.exists());\n+\n+            try {\n+                \/\/ Sleep 5 seconds to ensure jar timestamps might be different if they could be\n+                Thread.sleep(5000);\n+            } catch(InterruptedException ex) {}\n+\n+            TimeZone.setDefault(tzLA);\n+            check(JAR_TOOL.run(System.out, System.err,\n+                           \"--create\",\n+                           \"--file\", jarFileSourceDate2.getName(),\n+                           \"--date\", sourceDate,\n+                           dirOuter.getName()) == 0);\n+            check(jarFileSourceDate2.exists());\n+\n+            \/\/ Check jar are identical\n+            checkSameContent(jarFileSourceDate1, jarFileSourceDate2);\n+\n+            check(cleanup(dirInner));\n+            check(cleanup(dirOuter));\n+        }\n+        TimeZone.setDefault(tz0);\n+\n@@ -216,1 +256,1 @@\n-                           \"--file\", jarFileSourceDate.getName(),\n+                           \"--file\", jarFileSourceDate1.getName(),\n@@ -225,1 +265,2 @@\n-        check(jarFileSourceDate.delete());\n+        check(jarFileSourceDate1.delete());\n+        check(jarFileSourceDate2.delete());\n@@ -283,0 +324,9 @@\n+    static void checkSameContent(File f1, File f2) throws Throwable {\n+        byte[] ba1 = Files.readAllBytes(f1.toPath());\n+        byte[] ba2 = Files.readAllBytes(f2.toPath());\n+        if (!Arrays.equals(ba1, ba2)) {\n+            System.out.format(\"jar content differs: %s != %s%n\", f1, f2);\n+            fail();\n+        }\n+    }\n+\n","filename":"test\/jdk\/tools\/jar\/JarEntryTime.java","additions":58,"deletions":8,"binary":false,"changes":66,"status":"modified"}]}