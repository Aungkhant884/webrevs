{"files":[{"patch":"@@ -42,0 +42,1 @@\n+import java.io.BufferedReader;\n@@ -43,0 +44,1 @@\n+import java.io.InputStreamReader;\n@@ -55,1 +57,1 @@\n-    private static final String USER = System.getProperty(\"user.name\");\n+    private static final String ROOT_USER_ID = \"0\";\n@@ -77,1 +79,1 @@\n-    private void test() {\n+    private void test() throws InterruptedException, IOException {\n@@ -80,2 +82,14 @@\n-        if (!\"root\".equalsIgnoreCase(USER)) {\n-            throw new RuntimeException(\"This test needs to be run with root privilege.\");\n+        Process process = Runtime.getRuntime().exec(\"id -u\");\n+        process.waitFor();\n+        if (process.exitValue() != 0) {\n+            throw new RuntimeException(\"Failed to retrieve user id.\");\n+        }\n+\n+        try (BufferedReader reader = new BufferedReader(\n+                new InputStreamReader(process.getInputStream()))) {\n+            String line = reader.readLine();\n+\n+            if (!ROOT_USER_ID.equals(line)) {\n+                throw new RuntimeException(\n+                        \"This test needs to be run with root privilege.\");\n+            }\n","filename":"test\/jdk\/java\/security\/Policy\/Root\/Root.java","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"}]}