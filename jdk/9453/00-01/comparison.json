{"files":[{"patch":"@@ -403,2 +403,0 @@\n-\n- private:\n@@ -408,0 +406,1 @@\n+  int _frame_size;\n@@ -413,1 +412,3 @@\n-    const int total_regs_amount = iterate_over_register_mask(ACTION_SAVE);\n+    const int register_save_size = iterate_over_register_mask(ACTION_COUNT_ONLY) * BytesPerWord;\n+    _frame_size = align_up(register_save_size, frame::alignment_in_bytes)\n+                  + frame::abi_reg_args_size;\n@@ -416,1 +417,3 @@\n-    __ push_frame_reg_args(total_regs_amount * BytesPerWord, R0);\n+    __ push_frame(_frame_size, R0);\n+\n+    iterate_over_register_mask(ACTION_SAVE, _frame_size);\n@@ -420,2 +423,1 @@\n-    __ pop_frame();\n-    __ restore_LR_CR(R0);\n+    iterate_over_register_mask(ACTION_RESTORE, _frame_size);\n@@ -423,1 +425,2 @@\n-    iterate_over_register_mask(ACTION_RESTORE);\n+    __ addi(R1_SP, R1_SP, _frame_size);\n+    __ restore_LR_CR(R0);\n@@ -428,2 +431,3 @@\n-    ACTION_SAVE = 0,\n-    ACTION_RESTORE = 1\n+    ACTION_SAVE,\n+    ACTION_RESTORE,\n+    ACTION_COUNT_ONLY\n@@ -432,1 +436,1 @@\n-  int iterate_over_register_mask(IterationAction action) {\n+  int iterate_over_register_mask(IterationAction action, int offset = 0) {\n@@ -457,1 +461,1 @@\n-            _masm->std(std_reg, (intptr_t) -reg_save_index * BytesPerWord, R1_SP);\n+            _masm->std(std_reg, offset - reg_save_index * BytesPerWord, R1_SP);\n@@ -459,1 +463,1 @@\n-            _masm->ld(std_reg, (intptr_t) -reg_save_index * BytesPerWord, R1_SP);\n+            _masm->ld(std_reg, offset - reg_save_index * BytesPerWord, R1_SP);\n@@ -461,1 +465,1 @@\n-            fatal(\"Sanity\");\n+            assert(action == ACTION_COUNT_ONLY, \"Sanity\");\n@@ -470,1 +474,1 @@\n-            _masm->stfd(fp_reg, (intptr_t) -reg_save_index * BytesPerWord, R1_SP);\n+            _masm->stfd(fp_reg, offset - reg_save_index * BytesPerWord, R1_SP);\n@@ -472,1 +476,1 @@\n-            _masm->lfd(fp_reg, (intptr_t) -reg_save_index * BytesPerWord, R1_SP);\n+            _masm->lfd(fp_reg, offset - reg_save_index * BytesPerWord, R1_SP);\n@@ -474,1 +478,1 @@\n-            fatal(\"Sanity\");\n+            assert(action == ACTION_COUNT_ONLY, \"Sanity\");\n@@ -486,1 +490,0 @@\n-          _masm->addi(spill_addr, R1_SP, -reg_save_index * BytesPerWord);\n@@ -488,0 +491,1 @@\n+            _masm->addi(spill_addr, R1_SP, offset - reg_save_index * BytesPerWord);\n@@ -490,0 +494,1 @@\n+            _masm->addi(spill_addr, R1_SP, offset - reg_save_index * BytesPerWord);\n@@ -491,0 +496,2 @@\n+          } else {\n+            assert(action == ACTION_COUNT_ONLY, \"Sanity\");\n@@ -510,1 +517,0 @@\n- private:\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/z\/zBarrierSetAssembler_ppc.cpp","additions":24,"deletions":18,"binary":false,"changes":42,"status":"modified"}]}