{"files":[{"patch":"@@ -111,0 +111,5 @@\n+    private static final String releaseSuffix(Map<String, ? super Object> params) {\n+        return Optional.ofNullable(RELEASE.fetchFrom(params, false)).map(\n+                rel -> \"-\" + rel).orElse(\"\");\n+    }\n+\n@@ -116,1 +121,1 @@\n-                            + \"-\" + RELEASE.fetchFrom(params)\n+                            + releaseSuffix(params)\n@@ -278,3 +283,3 @@\n-                new PackageProperty(\"Version\", String.format(\"%s-%s\",\n-                        VERSION.fetchFrom(params), RELEASE.fetchFrom(params)),\n-                        \"APPLICATION_VERSION-APPLICATION_RELEASE\",\n+                new PackageProperty(\"Version\", String.format(\"%s%s\",\n+                        VERSION.fetchFrom(params), releaseSuffix(params)),\n+                        \"APPLICATION_VERSION_WITH_RELEASE\",\n@@ -445,0 +450,2 @@\n+        data.put(\"APPLICATION_VERSION_WITH_RELEASE\", String.format(\"%s%s\",\n+                VERSION.fetchFrom(params), releaseSuffix(params)));\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/LinuxDebBundler.java","additions":11,"deletions":4,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -223,1 +223,0 @@\n-        data.put(\"APPLICATION_RELEASE\", RELEASE.fetchFrom(params));\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/LinuxPackageBundler.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -180,0 +180,1 @@\n+        data.put(\"APPLICATION_RELEASE\", RELEASE.fetchFrom(params));\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/LinuxRpmBundler.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-Version: APPLICATION_VERSION-APPLICATION_RELEASE\n+Version: APPLICATION_VERSION_WITH_RELEASE\n","filename":"src\/jdk.jpackage\/linux\/classes\/jdk\/jpackage\/internal\/resources\/template.control","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -47,2 +47,16 @@\n-    private static String getRelease(JPackageCommand cmd) {\n-        return cmd.getArgumentValue(\"--linux-app-release\", () -> \"1\");\n+    private static String getReleaseSuffix(JPackageCommand cmd) {\n+        String value = null;\n+        final PackageType packageType = cmd.packageType();\n+        switch (packageType) {\n+            case LINUX_DEB:\n+                value = Optional.ofNullable(cmd.getArgumentValue(\n+                        \"--linux-app-release\", () -> null)).map(v -> \"-\" + v).orElse(\n+                        \"\");\n+                break;\n+\n+            case LINUX_RPM:\n+                value = \"-\" + cmd.getArgumentValue(\"--linux-app-release\",\n+                        () -> \"1\");\n+                break;\n+        }\n+        return value;\n@@ -77,1 +91,1 @@\n-                format = \"%s_%s-%s_%s\";\n+                format = \"%s_%s%s_%s\";\n@@ -81,1 +95,1 @@\n-                format = \"%s-%s-%s.%s\";\n+                format = \"%s-%s%s.%s\";\n@@ -85,1 +99,1 @@\n-        final String release = getRelease(cmd);\n+        final String releaseSuffix = getReleaseSuffix(cmd);\n@@ -88,1 +102,1 @@\n-        return String.format(format, getPackageName(cmd), version, release,\n+        return String.format(format, getPackageName(cmd), version, releaseSuffix,\n","filename":"test\/jdk\/tools\/jpackage\/helpers\/jdk\/jpackage\/test\/LinuxHelper.java","additions":20,"deletions":6,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -84,1 +84,1 @@\n-                    \"Expected value of \\\"Version\\\" property is [1.0-1]. Actual value in output package is [1.2.3-R2]\")\n+                    \"Expected value of \\\"Version\\\" property is [1.0]. Actual value in output package is [1.2.3-R2]\")\n","filename":"test\/jdk\/tools\/jpackage\/linux\/LinuxResourceTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+import jdk.jpackage.test.JPackageCommand;\n@@ -50,0 +51,1 @@\n+ * @requires (jpackage.test.SQETest == null)\n@@ -54,0 +56,15 @@\n+\n+\/*\n+ * @test\n+ * @summary jpackage with --linux-app-release\n+ * @library ..\/helpers\n+ * @key jpackagePlatformPackage\n+ * @build jdk.jpackage.test.*\n+ * @build ReleaseTest\n+ * @requires (os.family == \"linux\")\n+ * @requires (jpackage.test.SQETest != null)\n+ * @modules jdk.jpackage\/jdk.jpackage.internal\n+ * @run main\/othervm\/timeout=360 -Xmx512m jdk.jpackage.test.Main\n+ *  --jpt-run=ReleaseTest.test\n+ *\/\n+\n@@ -74,0 +91,13 @@\n+\n+    @Test\n+    public static void testNoExplitRelease() {\n+        new PackageTest()\n+                .forTypes(PackageType.LINUX)\n+                .configureHelloApp()\n+                .addInitializer(JPackageCommand::setFakeRuntime)\n+                .forTypes(PackageType.LINUX_RPM)\n+                .addBundlePropertyVerifier(\"Release\", \"1\")\n+                .forTypes(PackageType.LINUX_DEB)\n+                .addBundlePropertyVerifier(\"Version\", \"1.0\")\n+                .run();\n+    }\n","filename":"test\/jdk\/tools\/jpackage\/linux\/ReleaseTest.java","additions":30,"deletions":0,"binary":false,"changes":30,"status":"modified"}]}