{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,2 @@\n+ * @library ..\/..\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -28,1 +30,1 @@\n- * @run main\/manual=yesno PrintGlyphVectorTest\n+ * @run main\/manual PrintGlyphVectorTest\n@@ -31,6 +33,19 @@\n-import java.io.*;\n-import java.awt.*;\n-import java.awt.event.*;\n-import java.awt.font.*;\n-import java.awt.geom.*;\n-import java.awt.print.*;\n+import java.awt.BorderLayout;\n+import java.awt.Button;\n+import java.awt.Color;\n+import java.awt.Component;\n+import java.awt.Dialog;\n+import java.awt.Dimension;\n+import java.awt.Font;\n+import java.awt.Frame;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.Label;\n+import java.awt.font.FontRenderContext;\n+import java.awt.font.GlyphVector;\n+import java.awt.geom.Point2D;\n+import java.awt.geom.Rectangle2D;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n@@ -40,0 +55,12 @@\n+    private static final String INSTRUCTIONS = \"\"\"\n+            Note: You must have a printer installed for this test.\n+            If printer is not available, the test passes automatically.\n+\n+            Press the PRINT button on the 'Test PrintGlyphVector' frame\n+            and press OK\/print button on the print dialog.\n+\n+            Retrieve the output and compare the printed and on-screen\n+            text to confirm that in both cases the text is aligned and\n+            the boxes are around the text, not offset from the text.\n+            \"\"\";\n+\n@@ -49,3 +76,2 @@\n-\n-        float x = 50f,\n-              y = 50f;\n+        float x = 50f;\n+        float y = 50f;\n@@ -72,3 +98,0 @@\n-\n-\n-\n@@ -77,5 +100,5 @@\n-     public void paint(Graphics g) {\n-       g.setColor(Color.white);\n-       g.fillRect(0,0,getSize().width, getSize().height);\n-       drawGVs(g);\n-     }\n+    public void paint(Graphics g) {\n+        g.setColor(Color.white);\n+        g.fillRect(0, 0, getSize().width, getSize().height);\n+        drawGVs(g);\n+    }\n@@ -100,0 +123,7 @@\n+    private static void createTestUI() {\n+        PrinterJob pj = PrinterJob.getPrinterJob();\n+        if (pj.getPrintService() == null) {\n+            System.out.println(\"Printer not configured or available.\"\n+                    + \" Test cannot continue.\");\n+            PassFailJFrame.forcePass();\n+        }\n@@ -101,9 +131,29 @@\n-    public static void main(String arg[]) throws Exception {\n-\n-       Frame f = new Frame();\n-       PrintGlyphVectorTest pvt = new PrintGlyphVectorTest();\n-       f.add(\"Center\", pvt);\n-       f.add(\"South\", new PrintInstructions());\n-       f.pack();\n-       f.show();\n-\n+        Frame f = new Frame(\"Test PrintGlyphVector\");\n+        PrintGlyphVectorTest pvt = new PrintGlyphVectorTest();\n+        f.add(pvt, BorderLayout.CENTER);\n+\n+        Button printButton = new Button(\"PRINT\");\n+        printButton.addActionListener((e) -> {\n+            pj.setPrintable(new PrintGlyphVectorTest());\n+            if (pj.printDialog()) {\n+                try {\n+                    pj.print();\n+                } catch (PrinterException ex) {\n+                    throw new RuntimeException(ex.getMessage());\n+                }\n+            } else {\n+                throw new RuntimeException(\"Test failed : \"\n+                        + \"User selected 'Cancel' button on the print dialog\");\n+            }\n+        });\n+\n+        f.add(printButton, BorderLayout.SOUTH);\n+        f.pack();\n+        f.setVisible(true);\n+\n+        \/\/ add the test frame to dispose\n+        PassFailJFrame.addTestFrame(f);\n+\n+        \/\/ Arrange the test instruction frame and test frame side by side\n+        PassFailJFrame.positionTestFrame(f, PassFailJFrame.Position.HORIZONTAL);\n+    }\n@@ -111,0 +161,4 @@\n+    public static void main(String[] arg) throws Exception {\n+        PassFailJFrame passFailJFrame = new PassFailJFrame(INSTRUCTIONS);\n+        createTestUI();\n+        passFailJFrame.awaitAndCheck();\n@@ -114,37 +168,0 @@\n-class PrintInstructions extends Panel implements ActionListener {\n-\n-   static final String INSTRUCTIONS =\n-       \"You must have a printer installed for this test.\\n\" +\n-       \"Press the PRINT button below and OK the print dialog\\n\" +\n-       \"Retrieve the output and compare the printed and on-screen text\\n\" +\n-       \" to confirm that in both cases the text is aligned and the boxes\\n\" +\n-       \"are around the text, not offset from the text.\";\n-\n-  PrintInstructions() {\n-\n-     setLayout(new GridLayout(2,1));\n-     TextArea t = new TextArea(INSTRUCTIONS, 8, 80);\n-     add(t);\n-     Button b = new Button(\"PRINT\");\n-     b.setFont(new Font(\"Dialog\", Font.BOLD, 30));\n-     b.addActionListener(this);\n-     add(b);\n-  }\n-\n-  public void actionPerformed(ActionEvent e) {\n-       PrinterJob pj = PrinterJob.getPrinterJob();\n-       if (pj == null ||\n-           pj.getPrintService() == null ||\n-           !pj.printDialog()) {\n-           return;\n-       }\n-\n-       pj.setPrintable(new PrintGlyphVectorTest());\n-       try {\n-           pj.print();\n-       } catch (PrinterException ex) {\n-           System.err.println(ex);\n-       }\n-  }\n-\n-}\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/PrintGlyphVectorTest.java","additions":82,"deletions":65,"binary":false,"changes":147,"status":"modified"},{"patch":"@@ -27,1 +27,0 @@\n-import java.awt.HeadlessException;\n@@ -50,1 +49,9 @@\n-    private final static CountDownLatch latch = new CountDownLatch(1);\n+    private static final String TITLE = \"Test Instruction Frame\";\n+    private static final long TEST_TIMEOUT = 5;\n+    private static final int ROWS = 10;\n+    private static final int COLUMNS = 40;\n+\n+    private static final List<Frame> frameList = new ArrayList<>();\n+    private static final Timer timer = new Timer(0, null);\n+    private static final CountDownLatch latch = new CountDownLatch(1);\n+\n@@ -55,2 +62,0 @@\n-    private static final List<Frame> frameList = new ArrayList<>();\n-    private static final Timer timer = new Timer(0, null);\n@@ -60,0 +65,16 @@\n+    public PassFailJFrame(String instructions) throws InterruptedException,\n+            InvocationTargetException {\n+        this(instructions, TEST_TIMEOUT);\n+    }\n+\n+    public PassFailJFrame(String instructions, long testTimeOut) throws\n+            InterruptedException, InvocationTargetException {\n+        this(TITLE, instructions, testTimeOut);\n+    }\n+\n+    public PassFailJFrame(String title, String instructions,\n+                          long testTimeOut) throws InterruptedException,\n+            InvocationTargetException {\n+        this(title, instructions, testTimeOut, ROWS, COLUMNS);\n+    }\n+\n@@ -68,11 +89,14 @@\n-     * @param title                title of the Frame.\n-     * @param instructions         specified instruction that user should follow.\n-     * @param rows                 number of visible rows of the JTextArea where the\n-     *                             instruction is show.\n-     * @param columns              Number of columns of the instructional\n-     *                             JTextArea\n-     * @param testTimeOutInMinutes timeout of the test where time is specified in\n-     *                             minutes.\n-     * @throws HeadlessException         HeadlessException\n-     * @throws InterruptedException      exception thrown for invokeAndWait\n-     * @throws InvocationTargetException exception thrown for invokeAndWait\n+     * @param title        title of the Frame.\n+     * @param instructions the instruction for the tester on how to test\n+     *                     and what is expected (pass) and what is not\n+     *                     expected (fail).\n+     * @param testTimeOut  test timeout where time is specified in minutes.\n+     * @param rows         number of visible rows of the JTextArea where the\n+     *                     instruction is show.\n+     * @param columns      Number of columns of the instructional\n+     *                     JTextArea\n+     * @throws InterruptedException      exception thrown when thread is\n+     *                                   interrupted\n+     * @throws InvocationTargetException if an exception is thrown while\n+     *                                   creating the test instruction frame on\n+     *                                   EDT\n@@ -80,5 +104,3 @@\n-    public PassFailJFrame(String title, String instructions,\n-                          int rows, int columns,\n-                          int testTimeOutInMinutes) throws HeadlessException,\n-            InterruptedException, InvocationTargetException {\n-\n+    public PassFailJFrame(String title, String instructions, long testTimeOut,\n+                          int rows, int columns) throws InterruptedException,\n+            InvocationTargetException {\n@@ -86,1 +108,1 @@\n-            createUI(title, instructions, rows, columns, testTimeOutInMinutes);\n+            createUI(title, instructions, testTimeOut, rows, columns);\n@@ -88,2 +110,2 @@\n-            invokeAndWait(() -> createUI(title, instructions, rows, columns,\n-                    testTimeOutInMinutes));\n+            invokeAndWait(() -> createUI(title, instructions, testTimeOut,\n+                    rows, columns));\n@@ -94,2 +116,1 @@\n-                                 int rows, int columns,\n-                                 int timeoutInMinutes) {\n+                                 long testTimeOut, int rows, int columns) {\n@@ -102,1 +123,1 @@\n-        long testTimeout = TimeUnit.MINUTES.toMillis(timeoutInMinutes);\n+        long tTimeout = TimeUnit.MINUTES.toMillis(testTimeOut);\n@@ -105,1 +126,1 @@\n-                \"timeout: %s\", convertMillisToTimeStr(testTimeout)), JLabel.CENTER);\n+                \"timeout: %s\", convertMillisToTimeStr(tTimeout)), JLabel.CENTER);\n@@ -109,1 +130,1 @@\n-            long leftTime = testTimeout - (System.currentTimeMillis() - startTime);\n+            long leftTime = tTimeout - (System.currentTimeMillis() - startTime);\n@@ -154,1 +175,0 @@\n-\n@@ -174,2 +194,4 @@\n-     * @throws InterruptedException      if the thread is interrupted\n-     * @throws InvocationTargetException exception thrown for invokeAndWait\n+     * @throws InterruptedException      exception thrown when thread is\n+     *                                   interrupted\n+     * @throws InvocationTargetException if an exception is thrown while\n+     *                                   dispose frames on EDT\n@@ -275,0 +297,23 @@\n+\n+    \/**\n+     * Forcibly pass the test.\n+     * <p>The sample usage:\n+     * <pre><code>\n+     *      PrinterJob pj = PrinterJob.getPrinterJob();\n+     *      if (pj == null || pj.getPrintService() == null) {\n+     *          System.out.println(\"\"Printer not configured or available.\");\n+     *          PassFailJFrame.forcePass();\n+     *      }\n+     * <\/code><\/pre>\n+     *\/\n+    public static void forcePass() {\n+        latch.countDown();\n+    }\n+\n+    \/**\n+     *  Forcibly fail the test.\n+     *\/\n+    public static void forceFail() {\n+        failed = true;\n+        latch.countDown();\n+    }\n","filename":"test\/jdk\/java\/awt\/regtesthelpers\/PassFailJFrame.java","additions":76,"deletions":31,"binary":false,"changes":107,"status":"modified"}]}