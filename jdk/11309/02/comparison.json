{"files":[{"patch":"@@ -103,1 +103,1 @@\n-                    t.setDaemon(true);\n+                    privilegedThreadSetDaemon(t, true);\n@@ -118,0 +118,16 @@\n+    @SuppressWarnings(\"removal\")\n+    private static void privilegedThreadSetName(Thread thread, String name) {\n+        AccessController.doPrivileged((PrivilegedAction<Void>) () -> {\n+            thread.setName(name);\n+            return null;\n+        });\n+    }\n+\n+    @SuppressWarnings(\"removal\")\n+    private static void privilegedThreadSetDaemon(Thread thread, boolean on) {\n+        AccessController.doPrivileged((PrivilegedAction<Void>) () -> {\n+            thread.setDaemon(on);\n+            return null;\n+        });\n+    }\n+\n@@ -143,2 +159,3 @@\n-                        String threadName = Thread.currentThread().getName();\n-                        Thread.currentThread().setName(\"process reaper (pid \" + pid + \")\");\n+                        Thread t = Thread.currentThread();\n+                        String threadName = t.getName();\n+                        privilegedThreadSetName(t, \"process reaper (pid \" + pid + \")\");\n@@ -175,1 +192,1 @@\n-                            Thread.currentThread().setName(threadName);\n+                            privilegedThreadSetName(t, threadName);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ProcessHandleImpl.java","additions":21,"deletions":4,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -27,1 +27,1 @@\n- * @bug 6980747\n+ * @bug 6980747 8297451\n@@ -55,0 +55,11 @@\n+    \/\/ Security manager that unconditionally performs Thread Modify Access checks.\n+    @SuppressWarnings(\"removal\")\n+    private static class TMACSecurityManager extends SecurityManager {\n+        static final RuntimePermission MODIFY_THREAD_PERMISSION =\n+                new RuntimePermission(\"modifyThread\");\n+        @Override\n+        public void checkAccess(Thread thread) {\n+            checkPermission(MODIFY_THREAD_PERMISSION);\n+        }\n+    }\n+\n@@ -63,1 +74,2 @@\n-             new RuntimePermission(\"setSecurityManager\"));\n+             new RuntimePermission(\"setSecurityManager\"),\n+             new RuntimePermission(\"modifyThread\"));\n@@ -66,1 +78,1 @@\n-        System.setSecurityManager(new SecurityManager());\n+        System.setSecurityManager(new TMACSecurityManager());\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/SecurityManagerClinit.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"}]}