{"files":[{"patch":"@@ -35,0 +35,1 @@\n+#include \"runtime\/thread.hpp\"\n@@ -566,1 +567,3 @@\n-  JavaThread* thread = JavaThread::current_or_null();\n+  \/\/ Can't use thread_from_jni_environment as it may also perform a VM exit check that is unsafe to\n+  \/\/ do from this context.\n+  Thread* raw_thread = Thread::current_or_null_safe();\n@@ -568,1 +571,1 @@\n-  if (trace->env_id == NULL || thread == NULL || thread->is_terminated() || thread->is_exiting()) {\n+  if (trace->env_id == NULL || raw_thread == NULL || !raw_thread->is_Java_thread() || ((JavaThread*)raw_thread)->is_exiting()) {\n@@ -574,0 +577,2 @@\n+  JavaThread* thread = (JavaThread*)raw_thread;\n+\n@@ -580,0 +585,1 @@\n+  \/\/ This is safe now as the thread has not terminated and so no VM exit check occurs.\n","filename":"src\/hotspot\/share\/prims\/forte.cpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"}]}