{"files":[{"patch":"@@ -453,1 +453,0 @@\n-java\/awt\/PopupMenu\/PopupMenuLocation.java 8238720 windows-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+import java.awt.event.MouseAdapter;\n@@ -37,1 +38,4 @@\n-import java.awt.event.*;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicReference;\n+import javax.swing.SwingUtilities;\n@@ -43,1 +47,1 @@\n- * @run main\/timeout=300 PopupMenuLocation\n+ * @run main\/timeout=300\/othervm -Dsun.java2d.uiScale=1 PopupMenuLocation\n@@ -50,1 +54,1 @@\n-    private static volatile boolean action = false;\n+    private static CountDownLatch actionEventReceivedLatch;\n@@ -73,0 +77,1 @@\n+        actionEventReceivedLatch = new CountDownLatch(1);\n@@ -77,1 +82,1 @@\n-        pm.addActionListener(e -> action = true);\n+        pm.addActionListener(e -> actionEventReceivedLatch.countDown());\n@@ -112,2 +117,6 @@\n-        Point pt = frame.getLocationOnScreen();\n-        robot.mouseMove(pt.x + frame.getWidth() \/ 2, pt.y + 50);\n+        final AtomicReference<Point> pt = new AtomicReference<>();\n+        SwingUtilities.invokeAndWait(() -> {\n+                                          pt.set(frame.getLocationOnScreen());\n+                                     });\n+        Point loc = pt.get();\n+        robot.mouseMove(loc.x + frame.getWidth() \/ 2, loc.y + 50);\n@@ -116,2 +125,2 @@\n-        int x = pt.x + frame.getWidth() \/ 2;\n-        int y = pt.y + 130;\n+        int x = loc.x + frame.getWidth() \/ 2;\n+        int y = loc.y + 130;\n@@ -122,2 +131,3 @@\n-        if (!action) {\n-            throw new RuntimeException();\n+        if (!actionEventReceivedLatch.await(5, TimeUnit.SECONDS)) {\n+            throw new RuntimeException(\"Waited too long, but haven't received \" +\n+                                       \"the PopupMenu ActionEvent yet\");\n@@ -125,1 +135,0 @@\n-        action = false;\n","filename":"test\/jdk\/java\/awt\/PopupMenu\/PopupMenuLocation.java","additions":20,"deletions":11,"binary":false,"changes":31,"status":"modified"}]}