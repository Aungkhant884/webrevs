{"files":[{"patch":"@@ -453,1 +453,0 @@\n-java\/awt\/PopupMenu\/PopupMenuLocation.java 8238720 windows-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -24,0 +24,1 @@\n+import java.awt.Dimension;\n@@ -36,0 +37,1 @@\n+import java.awt.event.MouseAdapter;\n@@ -37,1 +39,6 @@\n-import java.awt.event.*;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+import java.util.stream.IntStream;\n+import javax.imageio.ImageIO;\n@@ -47,1 +54,0 @@\n-    private static final int SIZE = 350;\n@@ -50,1 +56,3 @@\n-    private static volatile boolean action = false;\n+    private static final int SIZE = 350;\n+    private static Robot robot;\n+    private static volatile CountDownLatch actionEventReceivedLatch;\n@@ -53,0 +61,2 @@\n+        robot = new Robot();\n+        robot.setAutoDelay(200);\n@@ -59,1 +69,1 @@\n-            Point point = new Point(bounds.x, bounds.y);\n+            Point point = new Point(bounds.x + 20, bounds.y + 20);\n@@ -62,2 +72,2 @@\n-                while (point.x\n-                        < bounds.x + bounds.width - insets.right - SIZE) {\n+                while (point.x <\n+                       bounds.x + bounds.width - insets.right - SIZE) {\n@@ -73,0 +83,1 @@\n+        actionEventReceivedLatch = new CountDownLatch(1);\n@@ -74,4 +85,2 @@\n-        for (int i = 1; i < 7; i++) {\n-            pm.add(TEXT + i);\n-        }\n-        pm.addActionListener(e -> action = true);\n+        IntStream.rangeClosed(1, 6).forEach(i -> pm.add(TEXT + i));\n+        pm.addActionListener(e -> actionEventReceivedLatch.countDown());\n@@ -109,2 +118,0 @@\n-        Robot robot = new Robot();\n-        robot.setAutoDelay(200);\n@@ -112,2 +119,2 @@\n-        Point pt = frame.getLocationOnScreen();\n-        robot.mouseMove(pt.x + frame.getWidth() \/ 2, pt.y + 50);\n+        Point loc = frame.getLocationOnScreen();\n+        robot.mouseMove(loc.x + frame.getWidth() \/ 2, loc.y + 50);\n@@ -116,2 +123,2 @@\n-        int x = pt.x + frame.getWidth() \/ 2;\n-        int y = pt.y + 130;\n+        int x = loc.x + frame.getWidth() \/ 2;\n+        int y = loc.y + 130;\n@@ -122,2 +129,5 @@\n-        if (!action) {\n-            throw new RuntimeException();\n+        if (!actionEventReceivedLatch.await(5, TimeUnit.SECONDS)) {\n+            captureScreen();\n+            throw new RuntimeException(\n+                    \"Waited too long, but haven't received \" +\n+                    \"the PopupMenu ActionEvent yet\");\n@@ -125,1 +135,0 @@\n-        action = false;\n@@ -127,0 +136,11 @@\n+\n+    private static void captureScreen() {\n+        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();\n+        try {\n+            ImageIO.write(robot.createScreenCapture(\n+                    new Rectangle(0, 0, screenSize.width, screenSize.height)),\n+                          \"png\", new File(\"screen1.png\"));\n+        } catch (IOException ignore) {\n+        }\n+    }\n+\n","filename":"test\/jdk\/java\/awt\/PopupMenu\/PopupMenuLocation.java","additions":39,"deletions":19,"binary":false,"changes":58,"status":"modified"}]}