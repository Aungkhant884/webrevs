{"files":[{"patch":"@@ -24,0 +24,1 @@\n+import java.awt.Dimension;\n@@ -38,0 +39,2 @@\n+import java.io.File;\n+import java.io.IOException;\n@@ -40,2 +43,2 @@\n-import java.util.concurrent.atomic.AtomicReference;\n-import javax.swing.SwingUtilities;\n+import java.util.stream.IntStream;\n+import javax.imageio.ImageIO;\n@@ -47,1 +50,1 @@\n- * @run main\/timeout=300\/othervm -Dsun.java2d.uiScale=1 PopupMenuLocation\n+ * @run main\/timeout=300 PopupMenuLocation\n@@ -51,1 +54,0 @@\n-    private static final int SIZE = 350;\n@@ -54,1 +56,3 @@\n-    private static CountDownLatch actionEventReceivedLatch;\n+    private static final int SIZE = 350;\n+    private static Robot robot;\n+    private static volatile CountDownLatch actionEventReceivedLatch;\n@@ -57,0 +61,2 @@\n+        robot = new Robot();\n+        robot.setAutoDelay(200);\n@@ -63,1 +69,1 @@\n-            Point point = new Point(bounds.x, bounds.y);\n+            Point point = new Point(bounds.x + 20, bounds.y + 20);\n@@ -66,2 +72,2 @@\n-                while (point.x\n-                        < bounds.x + bounds.width - insets.right - SIZE) {\n+                while (point.x <\n+                       bounds.x + bounds.width - insets.right - SIZE) {\n@@ -79,3 +85,1 @@\n-        for (int i = 1; i < 7; i++) {\n-            pm.add(TEXT + i);\n-        }\n+        IntStream.rangeClosed(1, 6).forEach(i -> pm.add(TEXT + i));\n@@ -114,2 +118,0 @@\n-        Robot robot = new Robot();\n-        robot.setAutoDelay(200);\n@@ -117,5 +119,1 @@\n-        final AtomicReference<Point> pt = new AtomicReference<>();\n-        SwingUtilities.invokeAndWait(() -> {\n-                                          pt.set(frame.getLocationOnScreen());\n-                                     });\n-        Point loc = pt.get();\n+        Point loc = frame.getLocationOnScreen();\n@@ -132,2 +130,4 @@\n-            throw new RuntimeException(\"Waited too long, but haven't received \" +\n-                                       \"the PopupMenu ActionEvent yet\");\n+            captureScreen();\n+            throw new RuntimeException(\n+                    \"Waited too long, but haven't received \" +\n+                    \"the PopupMenu ActionEvent yet\");\n@@ -136,0 +136,11 @@\n+\n+    private static void captureScreen() {\n+        Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize();\n+        try {\n+            ImageIO.write(robot.createScreenCapture(\n+                    new Rectangle(0, 0, screenSize.width, screenSize.height)),\n+                          \"png\", new File(\"screen1.png\"));\n+        } catch (IOException ignore) {\n+        }\n+    }\n+\n","filename":"test\/jdk\/java\/awt\/PopupMenu\/PopupMenuLocation.java","additions":31,"deletions":20,"binary":false,"changes":51,"status":"modified"}]}