{"files":[{"patch":"@@ -151,1 +151,3 @@\n-      return read_memory_limit_in_bytes();\n+      jlong memlimit = read_memory_limit_in_bytes();\n+      log_trace(os, container)(\"Memory and Swap Limit has been reset to \" JULONG_FORMAT \" because of Swappiness is 0\", memlimit);\n+      return memlimit;\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-        DockerTestUtils.buildJdkContainerImage(imageName);\n+        DockerTestUtils.buildJdkDockerImage(imageName, \"Dockerfile-BasicTest\", \"jdk-docker\");\n@@ -69,2 +69,1 @@\n-                \"150M\", Integer.toString(((int) Math.pow(2, 20)) * (150 - 100)),\n-                true\n+                \"150M\", Integer.toString(((int) Math.pow(2, 20)) * (150 - 100))\n@@ -74,2 +73,1 @@\n-                \"256M\", Integer.toString(((int) Math.pow(2, 20)) * (256 - 128)),\n-                true\n+                \"256M\", Integer.toString(((int) Math.pow(2, 20)) * (256 - 128))\n@@ -79,7 +77,1 @@\n-                \"1500M\", Integer.toString(((int) Math.pow(2, 20)) * (1500 - 1024)),\n-                true\n-            );\n-            testOperatingSystemMXBeanAwareness(\n-                \"1G\", Integer.toString(((int) Math.pow(2, 20)) * 1024),\n-                \"1500M\", Integer.toString(0),\n-                false\n+                \"1500M\", Integer.toString(((int) Math.pow(2, 20)) * (1500 - 1024))\n@@ -148,1 +140,1 @@\n-            String swapAllocation, String expectedSwap, boolean isUseSwap) throws Exception {\n+            String swapAllocation, String expectedSwap) throws Exception {\n@@ -161,6 +153,0 @@\n-        if (!isUseSwap) {\n-            opts.addDockerOpts(\"--memory-swappiness\", \"0\");\n-        } else {\n-            opts.addDockerOpts(\"--memory-swappiness\", \"60\");\n-        }\n-\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMemoryAwareness.java","additions":5,"deletions":19,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -60,0 +60,1 @@\n+            testPrintContainerMemoryInfo(\"100M\", \"150M\");\n@@ -128,0 +129,15 @@\n+    private static void testPrintContainerMemoryInfo(String dockerMemLimit, String dockerSwapMemLimit)\n+            throws Exception {\n+        Common.logNewTestCase(\"Test print_container_info()\");\n+\n+        DockerRunOptions opts = Common.newOpts(imageName, \"PrintContainerInfo\").addJavaOpts(\"-XshowSettings:system\");\n+        opts.addDockerOpts(\"--memory\", dockerMemLimit, \"--memory-swappiness\", \"0\", \"--memory-swap\", dockerSwapMemLimit);\n+        Common.addWhiteBoxOpts(opts);\n+\n+        OutputAnalyzer out = Common.run(opts);\n+        System.out.println(out.getOutput());\n+        out.shouldContain(\"Memory and Swap Limit is: 157286400\")\n+           .shouldContain(\"Memory and Swap Limit has been reset to 104857600 because of Swappiness is 0\")\n+           .shouldContain(\"Memory & Swap Limit: 100.00M\");\n+    }\n+\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMisc.java","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"}]}