{"files":[{"patch":"@@ -171,1 +171,1 @@\n-void VM_Version::get_compatible_board(char *buf, int buflen) {\n+static bool read_fully(const char *fname, char *buf, int buflen) {\n@@ -174,2 +174,1 @@\n-  *buf = '\\0';\n-  int fd = open(\"\/proc\/device-tree\/compatible\", O_RDONLY);\n+  int fd = open(fname, O_RDONLY);\n@@ -178,1 +177,2 @@\n-    if (read_sz > 0) {\n+    close(fd);\n+    if ((read_sz > 0) && isgraph(*buf)) {\n@@ -180,1 +180,1 @@\n-      \/\/ Replace '\\0' to ' '\n+      \/\/ Replace control chars to ' '\n@@ -182,1 +182,1 @@\n-        if (*ch == '\\0') {\n+        if (iscntrl(*ch)) {\n@@ -186,2 +186,1 @@\n-    } else {\n-      *buf = '\\0';\n+      return true;\n@@ -189,1 +188,0 @@\n-    close(fd);\n@@ -191,0 +189,12 @@\n+  *buf = '\\0';\n+  return false;\n+}\n+\n+void VM_Version::get_compatible_board(char *buf, int buflen) {\n+  if (read_fully(\"\/proc\/device-tree\/compatible\", buf, buflen)) {\n+    return;\n+  }\n+  if (read_fully(\"\/sys\/devices\/virtual\/dmi\/id\/board_name\", buf, buflen)) {\n+    return;\n+  }\n+  read_fully(\"\/sys\/devices\/virtual\/dmi\/id\/product_name\", buf, buflen);\n","filename":"src\/hotspot\/os_cpu\/linux_aarch64\/vm_version_linux_aarch64.cpp","additions":19,"deletions":9,"binary":false,"changes":28,"status":"modified"}]}