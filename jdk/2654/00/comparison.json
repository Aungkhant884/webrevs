{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,1 @@\n-    \/\/ It's off by default as it caused significant test time increase\\\n+    \/\/ It's off by default as it caused significant test time increase\n@@ -57,0 +57,3 @@\n+    \/\/ A flag to exclude testcases which can cause intermittent CI failures.\n+    private static boolean testPotentiallyUnstableCases = false;\n+\n@@ -85,1 +88,1 @@\n-        \/\/ we should be able to attach to both IPv4 and IPv6 addresses (127.0.0.1 & ::1)\n+        \/\/ we should be able to attach to both IPv4 and IPv6 addresses (127.0.0.1 & ::1).\n@@ -88,1 +91,3 @@\n-            attachTest(localAddresses[i].getHostAddress(), \"\", true);\n+            if (testPotentiallyUnstableCases || addressIfSafeToConnectToLocalhost(localAddresses[i])) {\n+                attachTest(localAddresses[i].getHostAddress(), \"\", true);\n+            }\n@@ -171,0 +176,9 @@\n+    \/\/ Attach to localhost tries to connect to both IPv4 and IPv6 loopback addresses.\n+    \/\/ But sometimes it causes interference with other processes which can listen on the same port but different\n+    \/\/ loopback address.\n+    \/\/ The method checks if the address is safe to test with current network config.\n+    private static boolean addressIfSafeToConnectToLocalhost(InetAddress addr) {\n+        boolean ipv6 = Boolean.parseBoolean(System.getProperty(\"java.net.preferIPv6Addresses\"));\n+        return ipv6 == (addr instanceof Inet6Address);\n+    }\n+\n","filename":"test\/jdk\/com\/sun\/jdi\/JdwpAttachTest.java","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"}]}