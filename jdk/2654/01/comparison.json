{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -53,1 +53,1 @@\n-    \/\/ It's off by default as it caused significant test time increase\\\n+    \/\/ It's off by default as it caused significant test time increase\n@@ -57,0 +57,3 @@\n+    \/\/ A flag to exclude testcases which can cause intermittent CI failures.\n+    private static boolean testPotentiallyUnstableCases = false;\n+\n@@ -84,2 +87,4 @@\n-        \/\/ by using \"localhost\" or empty hostname\n-        \/\/ we should be able to attach to both IPv4 and IPv6 addresses (127.0.0.1 & ::1)\n+        \/\/ By using \"localhost\" or empty hostname we should be able to attach\n+        \/\/ to both IPv4 and IPv6 addresses (127.0.0.1 & ::1).\n+        \/\/ By default test verifies only \"preferred\" family (IPv4 or IPv6).\n+        \/\/ Need to set testPotentiallyUnstableCases to true to perform full testing.\n@@ -88,1 +93,3 @@\n-            attachTest(localAddresses[i].getHostAddress(), \"\", true);\n+            if (testPotentiallyUnstableCases || addressIsSafeToConnectToLocalhost(localAddresses[i])) {\n+                attachTest(localAddresses[i].getHostAddress(), \"\", true);\n+            }\n@@ -171,0 +178,9 @@\n+    \/\/ Attach to localhost tries to connect to both IPv4 and IPv6 loopback addresses.\n+    \/\/ But sometimes it causes interference with other processes which can listen\n+    \/\/ on the same port but different loopback address.\n+    \/\/ The method checks if the address is safe to test with current network config.\n+    private static boolean addressIsSafeToConnectToLocalhost(InetAddress addr) {\n+        boolean ipv6 = Boolean.parseBoolean(System.getProperty(\"java.net.preferIPv6Addresses\"));\n+        return ipv6 == (addr instanceof Inet6Address);\n+    }\n+\n","filename":"test\/jdk\/com\/sun\/jdi\/JdwpAttachTest.java","additions":21,"deletions":5,"binary":false,"changes":26,"status":"modified"}]}