{"files":[{"patch":"@@ -2903,1 +2903,0 @@\n-    Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n@@ -2905,3 +2904,2 @@\n-    __ vmclr_m(as_VectorRegister($dst$$reg));\n-    __ vsetvli(t0, $src$$Register, sew);\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n+    __ vid_v(as_VectorRegister($dst$$reg));\n+    __ vmsltu_vx(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), $src$$Register);\n@@ -2917,1 +2915,0 @@\n-    Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n@@ -2919,3 +2916,2 @@\n-    __ vmclr_m(as_VectorRegister($dst$$reg));\n-    __ vsetvli(t0, $src$$Register, sew);\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n+    __ vid_v(as_VectorRegister($dst$$reg));\n+    __ vmsltu_vx(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), $src$$Register);\n@@ -2927,0 +2923,2 @@\n+  predicate(n->in(1)->get_long() <= 16 ||\n+            n->in(1)->get_long() == Matcher::vector_length(n));\n@@ -2931,2 +2929,2 @@\n-    if ($con$$constant != Matcher::vector_length(this)) {\n-      __ vsetvli_helper(bt, Matcher::vector_length(this));\n+    __ vsetvli_helper(bt, Matcher::vector_length(this));\n+    if ((uint)($con$$constant) == 0) {\n@@ -2934,0 +2932,6 @@\n+    } else if ((uint)($con$$constant) == Matcher::vector_length(this)) {\n+      __ vmset_m(as_VectorRegister($dst$$reg));\n+    } else {\n+      assert((uint)($con$$constant) < Matcher::vector_length(this), \"unsupported input lane_cnt\");\n+      __ vid_v(as_VectorRegister($dst$$reg));\n+      __ vmsleu_vi(as_VectorRegister($dst$$reg), as_VectorRegister($dst$$reg), (uint)($con$$constant) - 1);\n@@ -2935,2 +2939,0 @@\n-    __ vsetvli_helper(bt, (uint)($con$$constant));\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n@@ -3500,1 +3502,1 @@\n-instruct mcompress(vRegMask dst, vRegMask src, iRegLNoSp tmp) %{\n+instruct mcompress(vRegMask dst, vRegMask src, vReg tmp) %{\n@@ -3502,1 +3504,1 @@\n-  effect(TEMP_DEF dst, TEMP tmp);\n+  effect(TEMP tmp);\n@@ -3506,1 +3508,0 @@\n-    Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n@@ -3508,4 +3509,3 @@\n-    __ vmclr_m(as_VectorRegister($dst$$reg));\n-    __ vcpop_m($tmp$$Register, as_VectorRegister($src$$reg));\n-    __ vsetvli(t0, $tmp$$Register, sew);\n-    __ vmset_m(as_VectorRegister($dst$$reg));\n+    __ vid_v(as_VectorRegister($tmp$$reg));\n+    __ vcpop_m(t0, as_VectorRegister($src$$reg));\n+    __ vmsltu_vx(as_VectorRegister($dst$$reg), as_VectorRegister($tmp$$reg), t0);\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":19,"deletions":19,"binary":false,"changes":38,"status":"modified"}]}