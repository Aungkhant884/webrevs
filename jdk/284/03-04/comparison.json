{"files":[{"patch":"@@ -84,1 +84,1 @@\n-      - name: Store jtreg for later steps\n+      - name: Store jtreg for use by later steps\n@@ -87,1 +87,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -147,1 +147,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -182,1 +182,1 @@\n-          name: jdk-linux-x64${{ matrix.artifact }}_${{ env.bundleid }}\n+          name: transient_jdk-linux-x64${{ matrix.artifact }}_${{ env.bundleid }}\n@@ -266,1 +266,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -272,1 +272,1 @@\n-          name: jdk-linux-x64${{ matrix.artifact }}_${{ env.bundleid }}\n+          name: transient_jdk-linux-x64${{ matrix.artifact }}_${{ env.bundleid }}\n@@ -306,1 +306,0 @@\n-        if: ${{ failure() }}\n@@ -308,1 +307,1 @@\n-      - name: Persist test logs if any test fails\n+      - name: Persist test logs\n@@ -310,1 +309,0 @@\n-        if: ${{ failure() }}\n@@ -314,0 +312,1 @@\n+        continue-on-error: true\n@@ -388,1 +387,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -395,1 +394,1 @@\n-          & bash configure \n+          & bash configure\n@@ -398,4 +397,4 @@\n-          --with-version-opt=\"$env:GITHUB_ACTOR-$env:GITHUB_SHA\" \n-          --with-version-build=0 \n-          --with-boot-jdk=\"$HOME\/bootjdk\/$env:BOOT_JDK_VERSION\" \n-          --with-jtreg=\"$HOME\/jtreg\" \n+          --with-version-opt=\"$env:GITHUB_ACTOR-$env:GITHUB_SHA\"\n+          --with-version-build=0\n+          --with-boot-jdk=\"$HOME\/bootjdk\/$env:BOOT_JDK_VERSION\"\n+          --with-jtreg=\"$HOME\/jtreg\"\n@@ -417,1 +416,1 @@\n-          name: jdk-windows-x64${{ matrix.artifact }}_${{ env.bundleid }}\n+          name: transient_jdk-windows-x64${{ matrix.artifact }}_${{ env.bundleid }}\n@@ -516,1 +515,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -522,1 +521,1 @@\n-          name: jdk-windows-x64${{ matrix.artifact }}_${{ env.bundleid }}\n+          name: transient_jdk-windows-x64${{ matrix.artifact }}_${{ env.bundleid }}\n@@ -562,1 +561,0 @@\n-        if: ${{ failure() }}\n@@ -564,1 +562,1 @@\n-      - name: Persist test logs if any test fails\n+      - name: Persist test logs\n@@ -566,1 +564,0 @@\n-        if: ${{ failure() }}\n@@ -570,0 +567,1 @@\n+        continue-on-error: true\n@@ -624,1 +622,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -659,1 +657,1 @@\n-          name: jdk-macos-x64${{ matrix.artifact }}_${{ env.bundleid }}\n+          name: transient_jdk-macos-x64${{ matrix.artifact }}_${{ env.bundleid }}\n@@ -743,1 +741,1 @@\n-          name: jtreg_${{ env.bundleid }}\n+          name: transient_jtreg_${{ env.bundleid }}\n@@ -749,1 +747,1 @@\n-          name: jdk-macos-x64${{ matrix.artifact }}_${{ env.bundleid }}\n+          name: transient_jdk-macos-x64${{ matrix.artifact }}_${{ env.bundleid }}\n@@ -786,1 +784,0 @@\n-        if: ${{ failure() }}\n@@ -788,1 +785,1 @@\n-      - name: Persist test logs if any test fails\n+      - name: Persist test logs\n@@ -790,1 +787,0 @@\n-        if: ${{ failure() }}\n@@ -794,0 +790,62 @@\n+        continue-on-error: true\n+\n+  artifacts:\n+    name: Post-process artifacts\n+    runs-on: \"ubuntu-latest\"\n+    if: always()\n+    continue-on-error: true\n+    needs:\n+      - linux_x64_test\n+      - windows_x64_test\n+      - macos_x64_test\n+\n+    steps:\n+      - name: Determine current artifacts endpoint\n+        id: actions_runtime\n+        uses: actions\/github-script@v3\n+        with:\n+          script: \"return { url: process.env['ACTIONS_RUNTIME_URL'], token: process.env['ACTIONS_RUNTIME_TOKEN'] }\"\n+\n+      - name: Display current artifacts\n+        run: >\n+          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n+          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n+          '${{ fromJson(steps.actions_runtime.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview'\n+\n+      - name: Delete transient artifacts\n+        run: >\n+          for url in `\n+          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n+          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n+          '${{ fromJson(steps.actions_runtime.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview' |\n+          jq -r -c '.value | map(select(.name|startswith(\"transient_\"))) | .[].url'`; do\n+          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n+          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n+          -X DELETE \"${url}\";\n+          done\n+\n+      - name: Fetch remaining artifacts (test results)\n+        uses: actions\/download-artifact@v2\n+        with:\n+          path: test-results\n+\n+      - name: Delete remaining artifacts\n+        run: >\n+          for url in `\n+          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n+          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n+          '${{ fromJson(steps.actions_runtime.outputs.result).url }}_apis\/pipelines\/workflows\/${{ github.run_id }}\/artifacts?api-version=6.0-preview' |\n+          jq -r -c '.value | .[].url'`; do\n+          curl -s -H 'Accept: application\/json;api-version=6.0-preview'\n+          -H 'Authorization: Bearer ${{ fromJson(steps.actions_runtime.outputs.result).token }}'\n+          -X DELETE \"${url}\";\n+          done\n+\n+      - name: Determine unique bundle identifier\n+        run: echo \"::set-env name=bundleid::${GITHUB_ACTOR}_${GITHUB_SHA:0:8}\"\n+\n+      - name: Upload a combined test results artifact\n+        uses: actions\/upload-artifact@v2\n+        with:\n+          name: test-results_${{ env.bundleid }}\n+          path: test-results\n","filename":".github\/workflows\/submit.yml","additions":86,"deletions":28,"binary":false,"changes":114,"status":"modified"}]}