{"files":[{"patch":"@@ -31,3 +31,0 @@\n-Semaphore AsyncLogWriter::_sem(0);\n-Semaphore AsyncLogWriter::_io_sem(1);\n-\n@@ -35,2 +32,2 @@\n- private:\n-  static Semaphore _lock;\n+  Semaphore* _sem;\n+\n@@ -38,2 +35,4 @@\n-  AsyncLogLocker() {\n-    _lock.wait();\n+  AsyncLogLocker(Semaphore* sem): _sem(sem) {\n+    assert(sem != nullptr && sem->value() == 1,\n+          \"given semaphore must guarantee mutual exclusion!\");\n+    _sem->wait();\n@@ -43,1 +42,1 @@\n-    _lock.signal();\n+    _sem->signal();\n@@ -47,2 +46,0 @@\n-Semaphore AsyncLogLocker::_lock(1);\n-\n@@ -67,1 +64,1 @@\n-    AsyncLogLocker lock;\n+    AsyncLogLocker locker(&_lock);\n@@ -75,1 +72,1 @@\n-  AsyncLogLocker lock;\n+  AsyncLogLocker locker(&_lock);\n@@ -84,1 +81,2 @@\n-  : _initialized(false),\n+  : _lock(1), _sem(0), _io_sem(1),\n+    _initialized(false),\n@@ -128,1 +126,1 @@\n-    AsyncLogLocker lock;\n+    AsyncLogLocker locker(&_lock);\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.cpp","additions":12,"deletions":14,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -137,0 +137,2 @@\n+  \/\/ _lock(1) denotes a critional region.\n+  Semaphore _lock;\n@@ -139,1 +141,1 @@\n-  static Semaphore _sem;\n+  Semaphore _sem;\n@@ -141,1 +143,1 @@\n-  static Semaphore _io_sem;\n+  Semaphore _io_sem;\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.hpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,0 +46,1 @@\n+  DEBUG_ONLY(const uint _value;)\n@@ -50,1 +51,1 @@\n-  Semaphore(uint value = 0) : _impl(value) {}\n+  Semaphore(uint value = 0) : _impl(value) DEBUG_ONLY(COMMA _value(value)) {}\n@@ -60,0 +61,4 @@\n+\n+#ifdef ASSERT\n+  uint value() const { return _value; }\n+#endif\n","filename":"src\/hotspot\/share\/runtime\/semaphore.hpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"}]}