{"files":[{"patch":"@@ -4,1 +4,1 @@\n-# Copyright (c) 2010, 2020, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n-# Script to update the Copyright YEAR range in Mercurial sources.\n+# Script to update the Copyright YEAR range in Mercurial & Git sources.\n@@ -29,1 +29,6 @@\n-awk=awk\n+#------------------------------------------------------------\n+copyright=\"Copyright (c)\"\n+company=\"Oracle\"\n+#------------------------------------------------------------\n+\n+awk=\"awk\"\n@@ -34,0 +39,7 @@\n+# To allow total changes counting\n+shopt -s lastpipe\n+\n+# Get an absolute path to this script, since that determines the top-level directory.\n+this_script_dir=`dirname $0`\n+this_script_dir=`cd $this_script_dir > \/dev\/null && pwd`\n+\n@@ -40,0 +52,5 @@\n+# Default or supplied company name\n+if [ \"$3\" != \"\" ] ; then\n+  company=\"$3\"\n+fi\n+\n@@ -41,2 +58,2 @@\n-if [ \"$1\" != \"\" ] ; then\n-  year=\"$1\"\n+if [ \"$2\" != \"\" ] ; then\n+  year=\"$2\"\n@@ -47,0 +64,43 @@\n+# VCS select\n+vcs=\"$1\"\n+\n+if [ -z \"$vcs\" ] ; then\n+  git_found=false\n+  hg_found=false\n+\n+  [ -d \"${this_script_dir}\/..\/..\/.git\" ] && git_found=true\n+  [ -d \"${this_script_dir}\/..\/..\/.hg\" ] && hg_found=true\n+\n+  if [ \"$git_found\" == \"true\" ] && [ \"$hg_found\" == \"false\" ] ; then\n+    vcs=\"git\"\n+  elif [ \"$hg_found\" == \"true\" ] && [ \"$git_found\" == \"false\" ] ; then\n+    vcs=\"hg\"\n+  else\n+    echo \"Error: could not auto-detect version control system\"\n+    vcs=\"\"\n+  fi\n+fi\n+\n+case \"$vcs\" in\n+  \"git\")\n+    echo \"Using Git version control system\"\n+    vcs_status=(git ls-files -m)\n+    vcs_list_changesets=(git log --no-merges --since=\"${year}-01-01T00:00:00Z\" --until=\"${year}-12-31T23:59:59Z\" --pretty=tformat:\"%H\")\n+    vcs_changeset_message=(git log -1 --pretty=tformat:\"%B\") # followed by ${changeset}\n+    vcs_changeset_files=(git diff-tree --no-commit-id --name-only -r) # followed by ${changeset}\n+    ;;\n+\n+  \"hg\")\n+    echo \"Using Mercurial version control system\"\n+    vcs_status=(hg status)\n+    vcs_list_changesets=(hg log --no-merges -v -d \"${year}-01-01 to ${year}-12-31\" --template '{node}\\n')\n+    vcs_changeset_message=(hg log -l1 --template '{desc}\\n' --rev) # followed by ${changeset}\n+    vcs_changeset_files=(hg log -l1 -v --template '{files}\\n' --rev) # followed by ${changeset}\n+    ;;\n+\n+  *)\n+    echo \"Usage: `basename \"$0\"` <git|hg> [year [company]]\"\n+    exit 1\n+    ;;\n+esac\n+\n@@ -71,2 +131,0 @@\n-    copyright=\"Copyright (c)\"\n-    company=\"Oracle\"\n@@ -97,1 +155,1 @@\n-  hg log -l1 --rev $1 -v --template '{files}\\n' | expand \\\n+  \"${vcs_changeset_files[@]}\" \"$1\" | expand \\\n@@ -101,2 +159,0 @@\n-    copyright=\"Copyright (c)\"\n-    company=\"Oracle\"\n@@ -119,2 +175,2 @@\n-    hg log -l1 --rev $1 -v --template '{files}\\n'\n-    hg log -l1 --rev $1 -v --template '{files}\\n' | expand \\\n+    \"${vcs_changeset_files[@]}\" \"$1\"\n+    \"${vcs_changeset_files[@]}\" \"$1\" | expand \\\n@@ -129,1 +185,1 @@\n-previous=`hg status|wc -l`\n+previous=`\"${vcs_status[@]}\"|wc -l`\n@@ -132,1 +188,1 @@\n-  echo \"  hg status | wc -l = `hg status | wc -l`\"\n+  echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n@@ -138,1 +194,1 @@\n-hg log --no-merges -v -d \"${year}-01-01 to ${year}-12-31\" --template '{node}\\n' > ${all_changesets}\n+\"${vcs_list_changesets[@]}\" > ${all_changesets}\n@@ -149,1 +205,1 @@\n-    hg log -l1 --rev ${changeset} --template '{desc}\\n' > ${desc}\n+    \"${vcs_changeset_message[@]}\" \"${changeset}\" > ${desc}\n@@ -178,1 +234,1 @@\n-     echo \"This count should match the count of modified files in the repository: hg status -m\"\n+     echo \"This count should match the count of modified files in the repository: ${vcs_status[*]}\"\n@@ -182,1 +238,1 @@\n-   echo \"  hg status -m | wc -l = `hg status -m | wc -l`\"\n+   echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n@@ -189,1 +245,1 @@\n-   echo \"  hg status -m | wc -l = `hg status -m | wc -l`\"\n+   echo \"  ${vcs_status[*]} | wc -l = `\"${vcs_status[@]}\" | wc -l`\"\n","filename":"make\/scripts\/update_copyright_year.sh","additions":75,"deletions":19,"binary":false,"changes":94,"status":"modified"}]}