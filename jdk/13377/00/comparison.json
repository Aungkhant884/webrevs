{"files":[{"patch":"@@ -36,0 +36,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -40,1 +41,1 @@\n-AgeTable::AgeTable(bool global) {\n+AgeTable::AgeTable(bool global) : _use_perf_data(UsePerfData && global) {\n@@ -44,1 +45,1 @@\n-  if (UsePerfData && global) {\n+  if (_use_perf_data) {\n@@ -73,1 +74,1 @@\n-void AgeTable::merge(AgeTable* subTable) {\n+void AgeTable::merge(const AgeTable* subTable) {\n@@ -108,19 +109,4 @@\n-  if (log_is_enabled(Trace, gc, age) || UsePerfData || AgeTableTracer::is_tenuring_distribution_event_enabled()) {\n-    log_trace(gc, age)(\"Age table with threshold %u (max threshold \" UINTX_FORMAT \")\",\n-                       tenuring_threshold, MaxTenuringThreshold);\n-\n-    size_t total = 0;\n-    uint age = 1;\n-    while (age < table_size) {\n-      size_t wordSize = sizes[age];\n-      total += wordSize;\n-      if (wordSize > 0) {\n-        log_trace(gc, age)(\"- age %3u: \" SIZE_FORMAT_W(10) \" bytes, \" SIZE_FORMAT_W(10) \" total\",\n-                            age, wordSize * oopSize, total * oopSize);\n-      }\n-      AgeTableTracer::send_tenuring_distribution_event(age, wordSize * oopSize);\n-      if (UsePerfData) {\n-        _perf_sizes[age]->set_value(wordSize * oopSize);\n-      }\n-      age++;\n-    }\n+  LogTarget(Trace, gc, age) lt;\n+  if (lt.is_enabled() || _use_perf_data || AgeTableTracer::is_tenuring_distribution_event_enabled()) {\n+    LogStream st(lt);\n+    print_on(&st, tenuring_threshold);\n@@ -130,0 +116,20 @@\n+void AgeTable::print_on(outputStream* st, uint tenuring_threshold) {\n+  st->print_cr(\"Age table with threshold %u (max threshold \" UINTX_FORMAT \")\",\n+           tenuring_threshold, MaxTenuringThreshold);\n+\n+  size_t total = 0;\n+  uint age = 1;\n+  while (age < table_size) {\n+    size_t word_size = sizes[age];\n+    total += word_size;\n+    if (word_size > 0) {\n+      st->print_cr(\"- age %3u: \" SIZE_FORMAT_W(10) \" bytes, \" SIZE_FORMAT_W(10) \" total\",\n+                   age, word_size * oopSize, total * oopSize);\n+    }\n+    AgeTableTracer::send_tenuring_distribution_event(age, word_size * oopSize);\n+    if (_use_perf_data) {\n+      _perf_sizes[age]->set_value(word_size * oopSize);\n+    }\n+    age++;\n+  }\n+}\n\\ No newline at end of file\n","filename":"src\/hotspot\/share\/gc\/shared\/ageTable.cpp","additions":28,"deletions":22,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -66,1 +66,1 @@\n-  void merge(AgeTable* subTable);\n+  void merge(const AgeTable* subTable);\n@@ -71,0 +71,1 @@\n+  void print_on(outputStream* st, uint tenuring_threshold);\n@@ -73,1 +74,1 @@\n-\n+  bool _use_perf_data;\n","filename":"src\/hotspot\/share\/gc\/shared\/ageTable.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}