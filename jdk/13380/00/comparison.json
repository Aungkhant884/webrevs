{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,3 +24,0 @@\n-import test.java.awt.regtesthelpers.Util;\n-\n-import javax.swing.SwingUtilities;\n@@ -32,0 +29,16 @@\n+import javax.swing.SwingUtilities;\n+\n+\/*\n+ * @test\n+ * @key headful\n+ * @bug 8012026 8027154\n+ * @summary Component.getMousePosition() does not work in an applet on MacOS\n+ *\n+ * @requires (os.family == \"windows\")\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=1 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=1.25 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=1.5 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=1.75 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=2 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=3 GetMousePositionWithPopup\n+ *\/\n@@ -33,1 +46,1 @@\n-\/**\n+\/*\n@@ -38,4 +51,5 @@\n- * @library ..\/..\/regtesthelpers\n- * @build Util\n- * @compile GetMousePositionWithPopup.java\n- * @run main GetMousePositionWithPopup\n+ *\n+ * @requires (os.family == \"mac\" | os.family == \"linux\")\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=1 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=2 GetMousePositionWithPopup\n+ * @run main\/othervm -Dsun.java2d.uiScale.enabled=true -Dsun.java2d.uiScale=3 GetMousePositionWithPopup\n@@ -49,0 +63,4 @@\n+    \/\/expected mouse position w.r.t to Component\n+    \/\/(2nd Frame in this test) after final mouse move.\n+    private static final int EXPECTED_MOUSE_POS = 50;\n+\n@@ -51,4 +69,2 @@\n-        Robot r = Util.createRobot();\n-        r.setAutoDelay(100);\n-        r.mouseMove(0, 0);\n-        Util.waitForIdle(null);\n+            Robot r = new Robot();\n+            r.setAutoDelay(300);\n@@ -56,6 +72,8 @@\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            @Override\n-            public void run() {\n-                constructTestUI();\n-            }\n-        });\n+            \/\/1st mouse move\n+            r.mouseMove(0, 0);\n+            r.waitForIdle();\n+            r.delay(100);\n+\n+            SwingUtilities.invokeAndWait(GetMousePositionWithPopup::createTestUI);\n+            r.waitForIdle();\n+            r.delay(200);\n@@ -63,5 +81,10 @@\n-        Util.waitForIdle(null);\n-        r.mouseMove(149, 149);\n-        Util.waitForIdle(null);\n-        r.mouseMove(170, 170);\n-        Util.waitForIdle(null);\n+            \/\/2nd mouse move\n+            r.mouseMove(149, 149);\n+            r.waitForIdle();\n+            r.delay(200);\n+\n+            SwingUtilities.invokeAndWait(GetMousePositionWithPopup::addMouseListenerToFrame2);\n+            \/\/3rd mouse move\n+            r.mouseMove(170, 170);\n+            r.waitForIdle();\n+            r.delay(100);\n@@ -70,6 +93,3 @@\n-            SwingUtilities.invokeLater(new Runnable() {\n-                @Override\n-                public void run() {\n-                    frame1.dispose();\n-                    frame2.dispose();\n-                }\n+            SwingUtilities.invokeLater(() -> {\n+                frame1.dispose();\n+                frame2.dispose();\n@@ -80,1 +100,1 @@\n-    private static void constructTestUI() {\n+    private static void createTestUI() {\n@@ -93,11 +113,3 @@\n-                frame2.addMouseMotionListener(new MouseMotionAdapter() {\n-                    @Override\n-                    public void mouseMoved(MouseEvent e)\n-                    {\n-                        Point positionInFrame2 = frame2.getMousePosition();\n-                        int deltaX = Math.abs(50 - positionInFrame2.x);\n-                        int deltaY = Math.abs(50 - positionInFrame2.y);\n-                        if (deltaX > 2 || deltaY > 2) {\n-                            throw new RuntimeException(\"Wrong position reported. Should be [50, 50] but was [\" +\n-                                    positionInFrame2.x + \", \" + positionInFrame2.y + \"]\");\n-                        }\n+            }\n+        });\n+    }\n@@ -105,6 +117,18 @@\n-                        Point positionInFrame1 = frame1.getMousePosition();\n-                        if (positionInFrame1 != null) {\n-                            throw new RuntimeException(\"Wrong position reported. Should be null\");\n-                        }\n-                    }\n-                });\n+    private static void addMouseListenerToFrame2() {\n+        frame2.addMouseMotionListener(new MouseMotionAdapter() {\n+            @Override\n+            public void mouseMoved(MouseEvent e) {\n+                Point positionInFrame2 = frame2.getMousePosition();\n+                int deltaX = Math.abs(EXPECTED_MOUSE_POS - positionInFrame2.x);\n+                int deltaY = Math.abs(EXPECTED_MOUSE_POS - positionInFrame2.y);\n+                if (deltaX > 2 || deltaY > 2) {\n+                    throw new RuntimeException(\"Wrong position reported for Frame 2.\"\n+                            + \" Should be [50, 50] but was \" + \"[\" + positionInFrame2.x\n+                            + \", \" + positionInFrame2.y + \"]\");\n+                }\n+\n+                Point positionInFrame1 = frame1.getMousePosition();\n+                if (positionInFrame1 != null) {\n+                    throw new RuntimeException(\"Wrong position reported for Frame 1.\"\n+                            + \" Should be null\");\n+                }\n","filename":"test\/jdk\/java\/awt\/Mouse\/GetMousePositionTest\/GetMousePositionWithPopup.java","additions":72,"deletions":48,"binary":false,"changes":120,"status":"modified"}]}