{"files":[{"patch":"@@ -35,10 +35,1 @@\n-\/*\n- * Allocation events are throttled so not each event will get written to JFR.\n- * _skipped_allocations and _skipped_events are maintained for tracking\n- * information about discarded allocation events, and are included in an event\n- * that is accepted.\n- *\/\n-static THREAD_LOCAL size_t _skipped_allocations = 0;\n-static THREAD_LOCAL size_t _skipped_events = 0;\n-\n-static void send_allocation_sample(Klass* klass, HeapWord* obj, size_t obj_alloc_size, size_t memory_alloc_size, Thread* thread) {\n+static void send_allocation_sample(Klass* klass, HeapWord* obj, size_t alloc_size, Thread* thread) {\n@@ -48,3 +39,1 @@\n-    event.set_allocationSize(obj_alloc_size);\n-    event.set_allocatedSinceLast(_skipped_allocations + memory_alloc_size);\n-    event.set_skippedEvents(_skipped_events);\n+    event.set_allocatedBytes(thread->allocated_bytes() + alloc_size);\n@@ -52,5 +41,0 @@\n-    _skipped_allocations = 0;\n-    _skipped_events = 0;\n-  } else {\n-    _skipped_events++;\n-    _skipped_allocations += memory_alloc_size;\n@@ -68,1 +52,1 @@\n-  send_allocation_sample(klass, obj, alloc_size, alloc_size, thread);\n+  send_allocation_sample(klass, obj, 0, thread); \/\/ 0 as alloc_size, because it is already attributed to thread->allocated_bytes()\n@@ -80,1 +64,1 @@\n-  send_allocation_sample(klass, obj, alloc_size, tlab_size, thread);\n+  send_allocation_sample(klass, obj, alloc_size, thread);\n","filename":"src\/hotspot\/share\/gc\/shared\/allocTracer.cpp","additions":4,"deletions":20,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -620,3 +620,1 @@\n-    <Field type=\"ulong\" contentType=\"bytes\" name=\"allocationSize\" label=\"Allocation Size\" \/>\n-    <Field type=\"ulong\" contentType=\"bytes\" name=\"allocatedSinceLast\" label=\"Allocated since last sample\"\/>\n-    <Field type=\"ulong\" name=\"skippedEvents\" label=\"Number of events skipped since last sample\"\/>\n+    <Field type=\"long\" contentType=\"bytes\" name=\"allocatedBytes\" label=\"Allocated Bytes\" description=\"Cumulative number of bytes allocated on the Java heap by this thread\"\/>\n","filename":"src\/hotspot\/share\/jfr\/metadata\/metadata.xml","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"}]}