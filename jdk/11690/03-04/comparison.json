{"files":[{"patch":"@@ -1683,0 +1683,1 @@\n+int java_lang_Thread::_jvmti_is_in_VTMS_transition_offset;\n@@ -1750,0 +1751,8 @@\n+bool java_lang_Thread::is_in_VTMS_transition(oop java_thread) {\n+  return java_thread->bool_field_volatile(_jvmti_is_in_VTMS_transition_offset);\n+}\n+\n+void java_lang_Thread::set_is_in_VTMS_transition(oop java_thread, bool val) {\n+  java_thread->bool_field_put_volatile(_jvmti_is_in_VTMS_transition_offset, val);\n+}\n+\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -339,0 +339,1 @@\n+  macro(java_lang_Thread, jvmti_is_in_VTMS_transition, bool_signature, false) \\\n@@ -353,0 +354,1 @@\n+  static int _jvmti_is_in_VTMS_transition_offset;\n@@ -405,0 +407,2 @@\n+  static bool is_in_VTMS_transition(oop java_thread);\n+  static void set_is_in_VTMS_transition(oop java_thread, bool val);\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -524,0 +524,1 @@\n+  template(jvmti_is_in_VTMS_transition_name,          \"jvmti_is_in_VTMS_transition\")              \\\n","filename":"src\/hotspot\/share\/classfile\/vmSymbols.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -683,1 +683,1 @@\n-  jvf = check_and_skip_hidden_frames(state->is_in_VTMS_transition(), jvf);\n+  jvf = check_and_skip_hidden_frames(java_lang_Thread::is_in_VTMS_transition(vthread), jvf);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -379,1 +379,0 @@\n-    assert(!jvmti_thread_state()->is_in_VTMS_transition(), \"sanity check\");\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvThreadState.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -87,1 +87,0 @@\n-  _is_in_VTMS_transition = false;\n@@ -302,2 +301,0 @@\n-  JvmtiThreadState* vstate = java_lang_Thread::jvmti_thread_state(vth());\n-\n@@ -311,0 +308,1 @@\n+  java_lang_Thread::inc_VTMS_transition_disable_count(vth());\n@@ -312,1 +310,1 @@\n-  while (vstate != NULL && vstate->is_in_VTMS_transition()) {\n+  while (java_lang_Thread::is_in_VTMS_transition(vth())) {\n@@ -315,1 +313,0 @@\n-  java_lang_Thread::inc_VTMS_transition_disable_count(vth());\n@@ -378,1 +375,1 @@\n-  if (_VTMS_transition_disable_for_all_count == 0 || _is_SR) {\n+  if (_VTMS_transition_disable_for_one_count == 0 || _is_SR) {\n@@ -417,0 +414,1 @@\n+  java_lang_Thread::set_is_in_VTMS_transition(vth(), true);\n@@ -430,0 +428,1 @@\n+    java_lang_Thread::set_is_in_VTMS_transition(vth(), false);\n@@ -450,0 +449,1 @@\n+      java_lang_Thread::set_is_in_VTMS_transition(vth(), true);\n@@ -464,4 +464,0 @@\n-  JvmtiThreadState* vstate = java_lang_Thread::jvmti_thread_state(vth());\n-  if (vstate != NULL) {\n-    vstate->set_is_in_VTMS_transition(true);\n-  }\n@@ -478,4 +474,1 @@\n-  JvmtiThreadState* vstate = java_lang_Thread::jvmti_thread_state(vt);\n-  if (vstate != NULL) {\n-    vstate->set_is_in_VTMS_transition(false);\n-  }\n+  java_lang_Thread::set_is_in_VTMS_transition(vt, false);\n","filename":"src\/hotspot\/share\/prims\/jvmtiThreadState.cpp","additions":7,"deletions":14,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -161,1 +161,0 @@\n-  bool              _is_in_VTMS_transition; \/\/ saved JavaThread.is_in_VTMS_transition()\n@@ -278,3 +277,0 @@\n-  \/\/ The JavaThread is_in_VTMS_transition() bit saved at unmount to restore at mount.\n-  inline bool is_in_VTMS_transition() { return _is_in_VTMS_transition; }\n-  inline void set_is_in_VTMS_transition(bool val) { _is_in_VTMS_transition = val; }\n","filename":"src\/hotspot\/share\/prims\/jvmtiThreadState.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"}]}