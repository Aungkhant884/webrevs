{"files":[{"patch":"@@ -44,0 +44,7 @@\n+    private static final int[] VARINT_LENGTHS = new int[65];\n+    static {\n+        for (int i = 0; i <= 64; i++) {\n+            VARINT_LENGTHS[i] = (63 - i) \/ 7;\n+        }\n+    }\n+\n@@ -324,46 +331,14 @@\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 0-6\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 0-6\n-        v >>>= 7;\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 7-13\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 7-13\n-        v >>>= 7;\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 14-20\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 14-20\n-        v >>>= 7;\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 21-27\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 21-27\n-        v >>>= 7;\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 28-34\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 28-34\n-        v >>>= 7;\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 35-41\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 35-41\n-        v >>>= 7;\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 42-48\n-            return;\n-        }\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 42-48\n-        v >>>= 7;\n-\n-        if ((v & ~0x7FL) == 0L) {\n-            putUncheckedByte((byte) v); \/\/ 49-55\n-            return;\n+        if ((v & ~0x7FL) != 0) {\n+            putUncheckedByte((byte)((v & 0x7F) | 0x80));\n+            v >>>= 7;\n+            if ((v & ~0x7FL) != 0) {\n+                putUncheckedByte((byte)((v & 0x7F) | 0x80));\n+                v >>>= 7;\n+                if ((v & ~0x7FL) != 0) {\n+                    int length = VARINT_LENGTHS[Long.numberOfLeadingZeros(v)];\n+                    for (int i = 0; i < length; i++) {\n+                        putUncheckedByte(((byte) ((v & 0x7F) | 0x80)));\n+                        v >>>= 7;\n+                    }\n+                }\n+            }\n@@ -371,2 +346,1 @@\n-        putUncheckedByte((byte) (v | 0x80L)); \/\/ 49-55\n-        putUncheckedByte((byte) (v >>> 7)); \/\/ 56-63, last byte as is.\n+        putUncheckedByte((byte) v);\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/EventWriter.java","additions":22,"deletions":48,"binary":false,"changes":70,"status":"modified"}]}