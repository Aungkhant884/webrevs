{"files":[{"patch":"@@ -167,2 +167,6 @@\n-        TableHeader tableHeader= new TableHeader(contents.packageLabel, contents.descriptionLabel);\n-        addPackageSummary(relatedPackages, contents.relatedPackages, tableHeader, summaryContentTree);\n+        boolean showModules = hasRelatedPackagesInOtherModules(relatedPackages);\n+        TableHeader tableHeader= showModules\n+                ? new TableHeader(contents.packageLabel, contents.moduleLabel, contents.descriptionLabel)\n+                : new TableHeader(contents.packageLabel, contents.descriptionLabel);\n+        addPackageSummary(relatedPackages, contents.relatedPackages, tableHeader,\n+                summaryContentTree, showModules);\n@@ -245,1 +249,2 @@\n-                                  TableHeader tableHeader, Content summaryContentTree) {\n+                                  TableHeader tableHeader, Content summaryContentTree,\n+                                  boolean showModules) {\n@@ -249,2 +254,6 @@\n-                    .setHeader(tableHeader)\n-                    .setColumnStyles(HtmlStyle.colFirst, HtmlStyle.colLast);\n+                    .setHeader(tableHeader);\n+            if (showModules) {\n+                table.setColumnStyles(HtmlStyle.colFirst, HtmlStyle.colExtra, HtmlStyle.colLast);\n+            } else {\n+                table.setColumnStyles(HtmlStyle.colFirst, HtmlStyle.colLast);\n+            }\n@@ -253,1 +262,8 @@\n-                Content classLink = getPackageLink(pkg, Text.of(pkg.getQualifiedName()));\n+                Content packageLink = getPackageLink(pkg, Text.of(pkg.getQualifiedName()));\n+                Content moduleLink = HtmlTree.EMPTY;\n+                if (showModules) {\n+                    ModuleElement module = (ModuleElement) pkg.getEnclosingElement();\n+                    if (module != null && !module.isUnnamed()) {\n+                        moduleLink = getModuleLink(module, Text.of(module.getQualifiedName()));\n+                    }\n+                }\n@@ -265,1 +281,5 @@\n-                table.addRow(classLink, description);\n+                if (showModules) {\n+                    table.addRow(packageLink, moduleLink, description);\n+                } else {\n+                    table.addRow(packageLink, description);\n+                }\n@@ -318,0 +338,5 @@\n+\n+    private boolean hasRelatedPackagesInOtherModules(List<PackageElement> relatedPackages) {\n+        final ModuleElement module = (ModuleElement) packageElement.getEnclosingElement();\n+        return relatedPackages.stream().anyMatch(pkg -> module != pkg.getEnclosingElement());\n+    }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PackageWriterImpl.java","additions":32,"deletions":7,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -444,0 +444,6 @@\n+    \/**\n+     * The class of the cells in a table column used to display additional\n+     * information without any particular style.\n+     *\/\n+    colExtra,\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/HtmlStyle.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import toolbox.ModuleBuilder;\n@@ -42,0 +43,2 @@\n+    ToolBox tb = new ToolBox();\n+\n@@ -49,7 +52,7 @@\n-        ToolBox tb = new ToolBox();\n-        tb.writeFile(base.resolve(\"p1\/package-info.java\"), \"package p1;\\n\");\n-        tb.writeFile(base.resolve(\"p1\/s1\/A.java\"), \"package p1.s1; public class A {}\\n\");\n-        tb.writeFile(base.resolve(\"p1\/s2\/package-info.java\"), \"package p1.s1;\\n\");\n-        tb.writeFile(base.resolve(\"p1\/s3\/B.java\"), \"package p1.s3; public class B {}\\n\");\n-        tb.writeFile(base.resolve(\"p1\/s3\/t1\/package-info.java\"), \"package p1.s3.t1;\\n\");\n-        tb.writeFile(base.resolve(\"p1\/s3\/t2\/C.java\"), \"package p1.s3.t2; public class C {}\\n\");\n+        Path src = base.resolve(\"src-packages\");\n+        tb.writeFile(src.resolve(\"p1\/package-info.java\"), \"package p1;\\n\");\n+        tb.writeFile(src.resolve(\"p1\/s1\/A.java\"), \"package p1.s1; public class A {}\\n\");\n+        tb.writeFile(src.resolve(\"p1\/s2\/package-info.java\"), \"package p1.s1;\\n\");\n+        tb.writeFile(src.resolve(\"p1\/s3\/B.java\"), \"package p1.s3; public class B {}\\n\");\n+        tb.writeFile(src.resolve(\"p1\/s3\/t1\/package-info.java\"), \"package p1.s3.t1;\\n\");\n+        tb.writeFile(src.resolve(\"p1\/s3\/t2\/C.java\"), \"package p1.s3.t2; public class C {}\\n\");\n@@ -57,2 +60,2 @@\n-        javadoc(\"-d\", \"out\",\n-                \"-sourcepath\", base.toString(),\n+        javadoc(\"-d\", \"out-packages\",\n+                \"-sourcepath\", src.toString(),\n@@ -141,0 +144,77 @@\n+    @Test\n+    public void testCrossModuleRelatedPackages(Path base) throws Exception {\n+        Path src = base.resolve(\"src-modules\");\n+        new ModuleBuilder(tb, \"m\")\n+                .exports(\"pkg\")\n+                .exports(\"pkg.sub1\")\n+                .classes(\"package pkg; public class A { }\",\n+                         \"package pkg.sub1; public class B { }\")\n+                .write(src);\n+        new ModuleBuilder(tb, \"o\")\n+                .exports(\"pkg.sub2\")\n+                .exports(\"pkg.sub2.sub\")\n+                .classes(\"package pkg.sub2; public class C { }\",\n+                         \"package pkg.sub2.sub; public class D { }\")\n+                .write(src);\n+\n+        javadoc(\"-d\", \"out-modules\",\n+                \"-quiet\",\n+                \"--module-source-path\", src.toString(),\n+                \"--module\", \"m,o\");\n+        checkExit(Exit.OK);\n+        checkOutput(\"m\/pkg\/package-summary.html\", true,\n+                \"\"\"\n+                        <div class=\"caption\"><span>Related Packages<\/span><\/div>\n+                        <div class=\"summary-table three-column-summary\">\n+                        <div class=\"table-header col-first\">Package<\/div>\n+                        <div class=\"table-header col-second\">Module<\/div>\n+                        <div class=\"table-header col-last\">Description<\/div>\n+                        <div class=\"col-first even-row-color\"><a href=\"sub1\/package-summary.html\">pkg.sub1<\/a><\/div>\n+                        <div class=\"col-extra even-row-color\"><a href=\"..\/module-summary.html\">m<\/a><\/div>\n+                        <div class=\"col-last even-row-color\">&nbsp;<\/div>\n+                        <div class=\"col-first odd-row-color\"><a href=\"..\/..\/o\/pkg\/sub2\/package-summary.html\">pkg.sub2<\/a><\/div>\n+                        <div class=\"col-extra odd-row-color\"><a href=\"..\/..\/o\/module-summary.html\">o<\/a><\/div>\n+                        <div class=\"col-last odd-row-color\">&nbsp;<\/div>\n+                        <\/div>\"\"\");\n+        checkOutput(\"m\/pkg\/sub1\/package-summary.html\", true,\n+                \"\"\"\n+                        <div class=\"caption\"><span>Related Packages<\/span><\/div>\n+                        <div class=\"summary-table three-column-summary\">\n+                        <div class=\"table-header col-first\">Package<\/div>\n+                        <div class=\"table-header col-second\">Module<\/div>\n+                        <div class=\"table-header col-last\">Description<\/div>\n+                        <div class=\"col-first even-row-color\"><a href=\"..\/package-summary.html\">pkg<\/a><\/div>\n+                        <div class=\"col-extra even-row-color\"><a href=\"..\/..\/module-summary.html\">m<\/a><\/div>\n+                        <div class=\"col-last even-row-color\">&nbsp;<\/div>\n+                        <div class=\"col-first odd-row-color\"><a href=\"..\/..\/..\/o\/pkg\/sub2\/package-summary.html\">pkg.sub2<\/a><\/div>\n+                        <div class=\"col-extra odd-row-color\"><a href=\"..\/..\/..\/o\/module-summary.html\">o<\/a><\/div>\n+                        <div class=\"col-last odd-row-color\">&nbsp;<\/div>\n+                        <\/div>\"\"\");\n+        checkOutput(\"o\/pkg\/sub2\/package-summary.html\", true,\n+                \"\"\"\n+                        <div class=\"caption\"><span>Related Packages<\/span><\/div>\n+                        <div class=\"summary-table three-column-summary\">\n+                        <div class=\"table-header col-first\">Package<\/div>\n+                        <div class=\"table-header col-second\">Module<\/div>\n+                        <div class=\"table-header col-last\">Description<\/div>\n+                        <div class=\"col-first even-row-color\"><a href=\"..\/..\/..\/m\/pkg\/package-summary.html\">pkg<\/a><\/div>\n+                        <div class=\"col-extra even-row-color\"><a href=\"..\/..\/..\/m\/module-summary.html\">m<\/a><\/div>\n+                        <div class=\"col-last even-row-color\">&nbsp;<\/div>\n+                        <div class=\"col-first odd-row-color\"><a href=\"sub\/package-summary.html\">pkg.sub2.sub<\/a><\/div>\n+                        <div class=\"col-extra odd-row-color\"><a href=\"..\/..\/module-summary.html\">o<\/a><\/div>\n+                        <div class=\"col-last odd-row-color\">&nbsp;<\/div>\n+                        <div class=\"col-first even-row-color\"><a href=\"..\/..\/..\/m\/pkg\/sub1\/package-summary.html\">pkg.sub1<\/a><\/div>\n+                        <div class=\"col-extra even-row-color\"><a href=\"..\/..\/..\/m\/module-summary.html\">m<\/a><\/div>\n+                        <div class=\"col-last even-row-color\">&nbsp;<\/div>\n+                        <\/div>\"\"\");\n+        checkOutput(\"o\/pkg\/sub2\/sub\/package-summary.html\", true,\n+                \"\"\"\n+                        <div class=\"caption\"><span>Related Packages<\/span><\/div>\n+                        <div class=\"summary-table two-column-summary\">\n+                        <div class=\"table-header col-first\">Package<\/div>\n+                        <div class=\"table-header col-last\">Description<\/div>\n+                        <div class=\"col-first even-row-color\"><a href=\"..\/package-summary.html\">pkg.sub2<\/a><\/div>\n+                        <div class=\"col-last even-row-color\">&nbsp;<\/div>\n+                        <\/div>\"\"\");\n+    }\n+\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testRelatedPackages\/TestRelatedPackages.java","additions":89,"deletions":9,"binary":false,"changes":98,"status":"modified"}]}