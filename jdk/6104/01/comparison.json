{"files":[{"patch":"@@ -742,1 +742,0 @@\n-javax\/swing\/JPopupMenu\/4634626\/bug4634626.java 8017175 macosx-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,3 +34,15 @@\n-import javax.swing.*;\n-import java.awt.event.*;\n-import java.awt.*;\n+import javax.swing.JButton;\n+import javax.swing.JComponent;\n+import javax.swing.JFrame;\n+import javax.swing.JPanel;\n+import javax.swing.JPopupMenu;\n+import javax.swing.JTextArea;\n+import javax.swing.SwingUtilities;\n+import java.awt.BorderLayout;\n+import java.awt.Component;\n+import java.awt.event.KeyEvent;\n+import java.awt.event.MouseAdapter;\n+import java.awt.event.MouseEvent;\n+import java.awt.event.WindowAdapter;\n+import java.awt.event.WindowEvent;\n+import java.util.concurrent.atomic.AtomicBoolean;\n@@ -40,2 +52,2 @@\n-    public boolean passed = true;\n-    public boolean done = false;\n+    public volatile boolean passed = true;\n+    public volatile boolean done = false;\n@@ -44,1 +56,0 @@\n-    public JRootPane rootPane = mainFrame.getRootPane();\n@@ -64,1 +75,1 @@\n-                  new Error(\"The event got thru the component with popup: \"\n+                  new Error(\"The event got through the component with popup: \"\n@@ -68,0 +79,1 @@\n+\n@@ -75,1 +87,1 @@\n-                  new Error(\"The event got thru the component with popup: \"\n+                  new Error(\"The event got through the component with popup: \"\n@@ -96,2 +108,1 @@\n-    public void init() {\n-\n+    public void init() throws Exception {\n@@ -126,6 +137,7 @@\n-        mainFrame.pack();\n-        mainFrame.setLocation(50, 50);\n-\n-        mainFrame.addWindowListener(new TestStateListener());\n-        mainFrame.setLocationRelativeTo(null);\n-        mainFrame.setVisible(true);\n+        SwingUtilities.invokeAndWait(() -> {\n+            mainFrame.pack();\n+            mainFrame.setLocation(50, 50);\n+            mainFrame.addWindowListener(new TestStateListener());\n+            mainFrame.setLocationRelativeTo(null);\n+            mainFrame.setVisible(true);\n+        });\n@@ -138,1 +150,0 @@\n-\n@@ -168,1 +179,1 @@\n-            robo.delay(500);\n+            robo.delay(1000);\n@@ -175,1 +186,5 @@\n-            someText.setInheritsPopupMenu(true);\n+            try {\n+                SwingUtilities.invokeAndWait(() -> someText.setInheritsPopupMenu(true));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not assign popup to button\", ex);\n+            }\n@@ -178,2 +193,9 @@\n-            robo.delay(500);\n-            if(!commonPopup.isVisible()) {\n+            robo.delay(1000);\n+            AtomicBoolean popupVisible = new AtomicBoolean(false);\n+            try {\n+                SwingUtilities.invokeAndWait(() ->\n+                        popupVisible.set(commonPopup.isVisible()));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not get commonPopup status\");\n+            }\n+            if(!popupVisible.get()) {\n@@ -186,1 +208,5 @@\n-            someText.setInheritsPopupMenu(false);\n+            try {\n+                SwingUtilities.invokeAndWait(() -> someText.setInheritsPopupMenu(false));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not unassign popup on button\", ex);\n+            }\n@@ -191,2 +217,8 @@\n-            robo.delay(500);\n-            if(!btnPopup.isVisible()) {\n+            robo.delay(1000);\n+            try {\n+                SwingUtilities.invokeAndWait(() ->\n+                    popupVisible.set(btnPopup.isVisible()));\n+            } catch (Exception ex) {\n+                throw new RuntimeException(\"Can not get btnPopup status\");\n+            }\n+            if(!popupVisible.get()) {\n@@ -203,2 +235,0 @@\n-\n-\n@@ -210,0 +240,1 @@\n+\n","filename":"test\/jdk\/javax\/swing\/JPopupMenu\/4634626\/bug4634626.java","additions":58,"deletions":27,"binary":false,"changes":85,"status":"modified"}]}