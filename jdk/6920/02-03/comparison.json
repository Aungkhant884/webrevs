{"files":[{"patch":"@@ -183,1 +183,1 @@\n-  FileMapInfo* mapinfo = new FileMapInfo(false);\n+  FileMapInfo* mapinfo = new FileMapInfo(_archive_name, false);\n@@ -323,1 +323,1 @@\n-  dynamic_info->open_for_write(_archive_name);\n+  dynamic_info->open_for_write();\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -169,1 +169,1 @@\n-FileMapInfo::FileMapInfo(bool is_static) {\n+FileMapInfo::FileMapInfo(const char* full_path, bool is_static) {\n@@ -171,0 +171,1 @@\n+  _full_path = full_path;\n@@ -175,1 +176,0 @@\n-    _full_path = Arguments::GetSharedArchivePath();\n@@ -179,1 +179,0 @@\n-    _full_path = Arguments::GetSharedDynamicArchivePath();\n@@ -1281,8 +1280,0 @@\n-  unsigned int expected_magic = is_static() ? CDS_ARCHIVE_MAGIC : CDS_DYNAMIC_ARCHIVE_MAGIC;\n-  if (gen_header->_magic != expected_magic) {\n-    log_info(cds)(\"_magic expected: 0x%08x\", expected_magic);\n-    log_info(cds)(\"         actual: 0x%08x\", gen_header->_magic);\n-    FileMapInfo::fail_continue(\"The shared archive file has a bad magic number.\");\n-    return false;\n-  }\n-\n@@ -1363,5 +1354,0 @@\n-  if (is_static()) {\n-    _full_path = Arguments::GetSharedArchivePath();\n-  } else {\n-    _full_path = Arguments::GetSharedDynamicArchivePath();\n-  }\n@@ -1389,6 +1375,1 @@\n-void FileMapInfo::open_for_write(const char* path) {\n-  if (path == NULL) {\n-    _full_path = Arguments::GetSharedArchivePath();\n-  } else {\n-    _full_path = path;\n-  }\n+void FileMapInfo::open_for_write() {\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":3,"deletions":22,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -375,1 +375,1 @@\n-  FileMapInfo(bool is_static);\n+  FileMapInfo(const char* full_apth, bool is_static);\n@@ -448,1 +448,1 @@\n-  void  open_for_write(const char* path = NULL);\n+  void  open_for_write();\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -559,1 +559,3 @@\n-  FileMapInfo* mapinfo = new FileMapInfo(true);\n+  const char* static_archive = Arguments::GetSharedArchivePath();\n+  assert(static_archive != nullptr, \"SharedArchiveFile not set?\");\n+  FileMapInfo* mapinfo = new FileMapInfo(static_archive, true);\n@@ -980,1 +982,3 @@\n-  FileMapInfo* mapinfo = new FileMapInfo(true);\n+  const char* static_archive = Arguments::GetSharedArchivePath();\n+  assert(static_archive != nullptr, \"SharedArchivePath is NULL\");\n+  FileMapInfo* mapinfo = new FileMapInfo(static_archive, true);\n@@ -989,1 +993,1 @@\n-  if (DynamicDumpSharedSpaces && !AutoCreateSharedArchive) {\n+  if (DynamicDumpSharedSpaces) {\n@@ -992,1 +996,2 @@\n-  if (Arguments::GetSharedDynamicArchivePath() == NULL) {\n+  const char* dynamic_archive = Arguments::GetSharedDynamicArchivePath();\n+  if (dynamic_archive == nullptr) {\n@@ -996,1 +1001,1 @@\n-  FileMapInfo* mapinfo = new FileMapInfo(false);\n+  FileMapInfo* mapinfo = new FileMapInfo(dynamic_archive, false);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":10,"deletions":5,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -3567,2 +3567,0 @@\n-            SharedDynamicArchivePath = const_cast<char *>(SharedArchiveFile);\n-            SharedArchivePath = get_default_shared_archive_path();\n@@ -3570,0 +3568,2 @@\n+            ArchiveClassesAtExit = const_cast<char *>(SharedArchiveFile);\n+            SharedArchivePath = get_default_shared_archive_path();\n@@ -3602,1 +3602,1 @@\n-      if (ArchiveClassesAtExit != nullptr && os::same_files(SharedArchiveFile, ArchiveClassesAtExit)) {\n+      if (!AutoCreateSharedArchive && ArchiveClassesAtExit != nullptr && os::same_files(SharedArchiveFile, ArchiveClassesAtExit)) {\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}