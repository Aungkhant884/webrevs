{"files":[{"patch":"@@ -56,1 +56,1 @@\n-        this(target, value, coordinates, handleFactory, new VarForm(value, coordinates));\n+        this(target, value, coordinates, handleFactory, new VarForm(value, coordinates), false);\n@@ -60,2 +60,2 @@\n-                      BiFunction<AccessMode, MethodHandle, MethodHandle> handleFactory, VarForm form) {\n-        super(form);\n+                      BiFunction<AccessMode, MethodHandle, MethodHandle> handleFactory, VarForm form, boolean exact) {\n+        super(form, exact);\n@@ -81,1 +81,1 @@\n-        return accessMode.at.accessModeType(directTarget.getClass(), value, coordinates);\n+        return accessMode.at.accessModeType(null, value, coordinates);\n@@ -99,2 +99,7 @@\n-    IndirectVarHandle withVarForm(VarForm varForm) {\n-        return new IndirectVarHandle(target, value, coordinates, handleFactory, varForm);\n+    public VarHandle asExact() {\n+        return new IndirectVarHandle(target, value, coordinates, handleFactory, vform, true);\n+    }\n+\n+    @Override\n+    public VarHandle asGeneric() {\n+        return new IndirectVarHandle(target, value, coordinates, handleFactory, vform, false);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/IndirectVarHandle.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -469,2 +469,2 @@\n-        if (handle.isExact() && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/Invokers.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -45,2 +45,2 @@\n-    MemoryAccessVarHandleBase(VarForm form, boolean be, long length, long offset, long alignmentMask) {\n-        super(form);\n+    MemoryAccessVarHandleBase(VarForm form, boolean be, long length, long offset, long alignmentMask, boolean exact) {\n+        super(form, exact);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/MemoryAccessVarHandleBase.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -100,1 +100,1 @@\n-            boolean.class, long.class, long.class, long.class, long[].class);\n+            boolean.class, long.class, long.class, long.class, boolean.class, long[].class);\n@@ -103,1 +103,1 @@\n-            boolean.class, long.class, long.class, long.class);\n+            boolean.class, long.class, long.class, long.class, boolean.class);\n@@ -211,1 +211,2 @@\n-        addWithVarForm(cw);\n+        addAsExact(cw);\n+        addAsGeneric(cw);\n@@ -268,1 +269,1 @@\n-        mv.visitVarInsn(ALOAD, 1);\n+        mv.visitVarInsn(ALOAD, 1); \/\/ vform\n@@ -270,4 +271,5 @@\n-        mv.visitVarInsn(ILOAD, 2);\n-        mv.visitVarInsn(LLOAD, 3);\n-        mv.visitVarInsn(LLOAD, 5);\n-        mv.visitVarInsn(LLOAD, 7);\n+        mv.visitVarInsn(ILOAD, 2); \/\/ be\n+        mv.visitVarInsn(LLOAD, 3); \/\/ length\n+        mv.visitVarInsn(LLOAD, 5); \/\/ offset\n+        mv.visitVarInsn(LLOAD, 7); \/\/ alignmentMask\n+        mv.visitVarInsn(ILOAD, 8); \/\/ exact\n@@ -279,1 +281,1 @@\n-            mv.visitVarInsn(ALOAD, 9);\n+            mv.visitVarInsn(ALOAD, 10);\n@@ -419,2 +421,10 @@\n-    private void addWithVarForm(ClassWriter cw) {\n-        MethodVisitor mv = cw.visitMethod(ACC_FINAL, \"withVarForm\", \"(Ljava\/lang\/invoke\/VarForm;)Ljava\/lang\/invoke\/VarHandle;\", null, null);\n+    private void addAsExact(ClassWriter cw) {\n+        addAsExactOrAsGeneric(cw, \"asExact\", true);\n+    }\n+\n+    private void addAsGeneric(ClassWriter cw) {\n+        addAsExactOrAsGeneric(cw, \"asGeneric\", false);\n+    }\n+\n+    private void addAsExactOrAsGeneric(ClassWriter cw, String name, boolean exact) {\n+        MethodVisitor mv = cw.visitMethod(ACC_FINAL, name, \"()Ljava\/lang\/invoke\/VarHandle;\", null, null);\n@@ -424,1 +434,2 @@\n-        mv.visitVarInsn(ALOAD, 1); \/\/ form\n+        mv.visitVarInsn(ALOAD, 0);\n+        mv.visitFieldInsn(GETFIELD, internalName(VarHandle.class), \"vform\", VarForm.class.descriptorString());\n@@ -433,0 +444,1 @@\n+        mv.visitIntInsn(BIPUSH, exact ? 1 : 0);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/MemoryAccessVarHandleGenerator.java","additions":24,"deletions":12,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -33,0 +33,2 @@\n+import java.util.ArrayList;\n+import java.util.List;\n@@ -40,2 +42,0 @@\n-    final boolean exact;\n-\n@@ -43,1 +43,0 @@\n-    final @Stable MethodType[] methodType_table_exact;\n@@ -48,1 +47,0 @@\n-        this.exact = false;\n@@ -50,1 +48,0 @@\n-        this.methodType_table_exact = new MethodType[VarHandle.AccessType.values().length];\n@@ -65,1 +62,0 @@\n-        this.exact = false;\n@@ -67,1 +63,0 @@\n-        this.methodType_table_exact = new MethodType[VarHandle.AccessType.values().length];\n@@ -72,14 +67,0 @@\n-    private VarForm(boolean exact, MethodType[] methodType_table, MethodType[] methodType_table_exact,\n-                    MemberName[] memberName_table, MethodType[] methodType_V_table) {\n-        this.exact = exact;\n-        this.methodType_table = methodType_table;\n-        this.methodType_table_exact = methodType_table_exact;\n-        this.memberName_table = memberName_table;\n-        this.methodType_V_table = methodType_V_table;\n-    }\n-\n-    private void initMethodTypePair(int index, MethodType type) {\n-        methodType_table_exact[index] = type;\n-        methodType_table[index] = type.erase();\n-    }\n-\n@@ -88,1 +69,2 @@\n-        initMethodTypePair(VarHandle.AccessType.GET.ordinal(), MethodType.methodType(value, coordinates));\n+        methodType_table[VarHandle.AccessType.GET.ordinal()] =\n+                MethodType.methodType(value, coordinates).erase();\n@@ -91,2 +73,2 @@\n-        initMethodTypePair(VarHandle.AccessType.SET.ordinal(),\n-                MethodType.methodType(void.class, coordinates).appendParameterTypes(value));\n+        methodType_table[VarHandle.AccessType.SET.ordinal()] =\n+                MethodType.methodType(void.class, coordinates).appendParameterTypes(value).erase();\n@@ -95,2 +77,2 @@\n-        initMethodTypePair(VarHandle.AccessType.GET_AND_UPDATE.ordinal(),\n-                MethodType.methodType(value, coordinates).appendParameterTypes(value));\n+        methodType_table[VarHandle.AccessType.GET_AND_UPDATE.ordinal()] =\n+                MethodType.methodType(value, coordinates).appendParameterTypes(value).erase();\n@@ -99,2 +81,2 @@\n-        initMethodTypePair(VarHandle.AccessType.COMPARE_AND_SET.ordinal(),\n-                MethodType.methodType(boolean.class, coordinates).appendParameterTypes(value, value));\n+        methodType_table[VarHandle.AccessType.COMPARE_AND_SET.ordinal()] =\n+                MethodType.methodType(boolean.class, coordinates).appendParameterTypes(value, value).erase();\n@@ -103,10 +85,2 @@\n-        initMethodTypePair(VarHandle.AccessType.COMPARE_AND_EXCHANGE.ordinal(),\n-                MethodType.methodType(value, coordinates).appendParameterTypes(value, value));\n-    }\n-\n-    VarForm asExact() {\n-        return new VarForm(true, methodType_table, methodType_table_exact, memberName_table, methodType_V_table);\n-    }\n-\n-    VarForm asGeneric() {\n-        return new VarForm(false, methodType_table, methodType_table_exact, memberName_table, methodType_V_table);\n+        methodType_table[VarHandle.AccessType.COMPARE_AND_EXCHANGE.ordinal()] =\n+                MethodType.methodType(value, coordinates).appendParameterTypes(value, value).erase();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarForm.java","additions":12,"deletions":38,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -449,0 +449,1 @@\n+    final boolean exact;\n@@ -451,0 +452,4 @@\n+        this(vform, false);\n+    }\n+\n+    VarHandle(VarForm vform, boolean exact) {\n@@ -452,0 +457,1 @@\n+        this.exact = exact;\n@@ -469,1 +475,1 @@\n-        return vform.exact;\n+        return exact;\n@@ -472,8 +478,0 @@\n-    \/**\n-     *  Create a clone of this var handle, but with the given {@code VarForm}\n-     *\n-     * @param varForm the new {@code VarForm} to use\n-     * @return the new var handle\n-     *\/\n-    abstract VarHandle withVarForm(VarForm varForm);\n-\n@@ -1561,3 +1559,1 @@\n-    public VarHandle asExact() {\n-        return withVarForm(vform.asExact());\n-    }\n+    public abstract VarHandle asExact();\n@@ -1570,3 +1566,1 @@\n-    public VarHandle asGeneric() {\n-        return withVarForm(vform.asGeneric());\n-    }\n+    public abstract VarHandle asGeneric();\n@@ -1835,0 +1829,2 @@\n+        @Stable\n+        static final AccessMode[] stableValues = values();\n@@ -1964,0 +1960,3 @@\n+    final MethodType accessModeType(int accessMode) {\n+        return accessModeType(AccessMode.stableValues[accessMode]);\n+    }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandle.java","additions":14,"deletions":15,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -37,2 +37,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -54,2 +54,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -72,2 +72,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -88,2 +88,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -105,2 +105,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -122,2 +122,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -138,2 +138,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -156,2 +156,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -172,2 +172,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -188,2 +188,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -204,2 +204,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -220,2 +220,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -238,2 +238,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -254,2 +254,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -270,2 +270,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -286,2 +286,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -302,2 +302,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -320,2 +320,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -336,2 +336,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -352,2 +352,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -368,2 +368,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -384,2 +384,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -402,2 +402,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -418,2 +418,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -434,2 +434,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -450,2 +450,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -467,2 +467,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -485,2 +485,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -501,2 +501,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -517,2 +517,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -535,2 +535,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -551,2 +551,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -567,2 +567,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -583,2 +583,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -599,2 +599,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -617,2 +617,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -633,2 +633,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -649,2 +649,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -665,2 +665,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -681,2 +681,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -699,2 +699,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -715,2 +715,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -731,2 +731,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -747,2 +747,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -763,2 +763,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -781,2 +781,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -797,2 +797,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -813,2 +813,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -829,2 +829,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -846,2 +846,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -864,2 +864,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -880,2 +880,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -897,2 +897,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -914,2 +914,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -932,2 +932,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -948,2 +948,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -964,2 +964,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -980,2 +980,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -998,2 +998,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1014,2 +1014,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1030,2 +1030,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1046,2 +1046,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1062,2 +1062,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1080,2 +1080,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1096,2 +1096,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1112,2 +1112,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1128,2 +1128,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1144,2 +1144,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1162,2 +1162,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1178,2 +1178,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1194,2 +1194,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1210,2 +1210,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1226,2 +1226,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1244,2 +1244,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1260,2 +1260,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1276,2 +1276,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1292,2 +1292,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1310,2 +1310,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -1326,2 +1326,2 @@\n-        if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-            throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+        if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+            throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandleGuards.java","additions":158,"deletions":158,"binary":false,"changes":316,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import java.lang.reflect.Parameter;\n@@ -36,0 +37,1 @@\n+import java.util.LinkedHashMap;\n@@ -46,0 +48,2 @@\n+import static java.util.stream.Collectors.joining;\n+import static java.util.stream.Collectors.toList;\n@@ -334,1 +338,2 @@\n-            return maybeAdapt((VarHandle)fac.invoke(be, size, offset, alignmentMask, strides));\n+            boolean exact = false;\n+            return maybeAdapt((VarHandle)fac.invoke(be, size, offset, alignmentMask, exact, strides));\n@@ -344,1 +349,1 @@\n-        MethodType mtype = target.accessModeType(VarHandle.AccessMode.GET).dropParameterTypes(0, 1);\n+        MethodType mtype = target.accessModeType(VarHandle.AccessMode.GET);\n@@ -679,2 +684,2 @@\n-\/\/                    if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-\/\/                        throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+\/\/                    if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+\/\/                        throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n@@ -697,2 +702,2 @@\n-\/\/                    if (handle.vform.exact && handle.vform.methodType_table_exact[ad.type] != ad.symbolicMethodTypeExact) {\n-\/\/                        throw new WrongMethodTypeException(\"expected \" + handle.vform.methodType_table_exact[ad.type] + \" but found \"\n+\/\/                    if (handle.isExact() && handle.accessModeType(ad.mode) != ad.symbolicMethodTypeExact) {\n+\/\/                        throw new WrongMethodTypeException(\"expected \" + handle.accessModeType(ad.mode) + \" but found \"\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandles.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -48,1 +48,1 @@\n-            this(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadOnly.FORM);\n+            this(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadOnly.FORM, false);\n@@ -52,2 +52,2 @@\n-                                        VarForm form) {\n-            super(form);\n+                                        VarForm form, boolean exact) {\n+            super(form, exact);\n@@ -62,2 +62,7 @@\n-        FieldInstanceReadOnly withVarForm(VarForm varForm) {\n-            return new FieldInstanceReadOnly(receiverType, fieldOffset{#if[Object]?, fieldType}, varForm);\n+        public FieldInstanceReadOnly asExact() {\n+            return new FieldInstanceReadOnly(receiverType, fieldOffset{#if[Object]?, fieldType}, vform, true);\n+        }\n+\n+        @Override\n+        public FieldInstanceReadOnly asGeneric() {\n+            return new FieldInstanceReadOnly(receiverType, fieldOffset{#if[Object]?, fieldType}, vform, false);\n@@ -118,1 +123,1 @@\n-            this(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadWrite.FORM);\n+            this(receiverType, fieldOffset{#if[Object]?, fieldType}, false);\n@@ -122,7 +127,2 @@\n-                               VarForm form) {\n-            super(receiverType, fieldOffset{#if[Object]?, fieldType}, form);\n-        }\n-\n-        @Override\n-        FieldInstanceReadWrite withVarForm(VarForm varForm) {\n-            return new FieldInstanceReadWrite(receiverType, fieldOffset{#if[Object]?, fieldType}, varForm);\n+                                       boolean exact) {\n+            super(receiverType, fieldOffset{#if[Object]?, fieldType}, FieldInstanceReadWrite.FORM, exact);\n@@ -133,1 +133,1 @@\n-            return withVarForm(FORM_EXACT);\n+            return new FieldInstanceReadWrite(receiverType, fieldOffset{#if[Object]?, fieldType}, true);\n@@ -138,1 +138,1 @@\n-            return withVarForm(FORM);\n+            return new FieldInstanceReadWrite(receiverType, fieldOffset{#if[Object]?, fieldType}, false);\n@@ -373,1 +373,0 @@\n-        static final VarForm FORM_EXACT = FORM.asExact();\n@@ -385,1 +384,1 @@\n-            this(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadOnly.FORM);\n+            this(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadOnly.FORM, false);\n@@ -389,2 +388,2 @@\n-                                      VarForm form) {\n-            super(form);\n+                                      VarForm form, boolean exact) {\n+            super(form, exact);\n@@ -399,2 +398,7 @@\n-        FieldStaticReadOnly withVarForm(VarForm varForm) {\n-            return new FieldStaticReadOnly(base, fieldOffset{#if[Object]?, fieldType}, varForm);\n+        public FieldStaticReadOnly asExact() {\n+            return new FieldStaticReadOnly(base, fieldOffset{#if[Object]?, fieldType}, vform, true);\n+        }\n+\n+        @Override\n+        public FieldStaticReadOnly asGeneric() {\n+            return new FieldStaticReadOnly(base, fieldOffset{#if[Object]?, fieldType}, vform, false);\n@@ -457,1 +461,1 @@\n-            this(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM);\n+            this(base, fieldOffset{#if[Object]?, fieldType}, false);\n@@ -461,2 +465,2 @@\n-                             VarForm form) {\n-            super(base, fieldOffset{#if[Object]?, fieldType}, form);\n+                                     boolean exact) {\n+            super(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM, exact);\n@@ -466,5 +470,0 @@\n-        public FieldStaticReadWrite withVarForm(VarForm varForm) {\n-            return new FieldStaticReadWrite(base, fieldOffset{#if[Object]?, fieldType}, varForm);\n-        }\n-\n-       @Override\n@@ -472,1 +471,1 @@\n-            return withVarForm(FORM_EXACT);\n+            return new FieldStaticReadWrite(base, fieldOffset{#if[Object]?, fieldType}, true);\n@@ -477,1 +476,1 @@\n-            return withVarForm(FORM);\n+            return new FieldStaticReadWrite(base, fieldOffset{#if[Object]?, fieldType}, false);\n@@ -712,1 +711,0 @@\n-        static final VarForm FORM_EXACT = FORM.asExact();\n@@ -725,1 +723,1 @@\n-            this(abase, ashift{#if[Object]?, arrayType}, Array.FORM);\n+            this(abase, ashift{#if[Object]?, arrayType}, false);\n@@ -728,2 +726,2 @@\n-        private Array(int abase, int ashift{#if[Object]?, Class<?> arrayType}, VarForm form) {\n-            super(form);\n+        private Array(int abase, int ashift{#if[Object]?, Class<?> arrayType}, boolean exact) {\n+            super(Array.FORM, exact);\n@@ -738,5 +736,0 @@\n-        @Override\n-        Array withVarForm(VarForm varForm) {\n-            return new Array(abase, ashift{#if[Object]?, arrayType}, varForm);\n-        }\n-\n@@ -745,1 +738,1 @@\n-            return withVarForm(FORM_EXACT);\n+            return new Array(abase, ashift{#if[Object]?, arrayType}, true);\n@@ -750,1 +743,1 @@\n-            return withVarForm(FORM);\n+            return new Array(abase, ashift{#if[Object]?, arrayType}, false);\n@@ -1152,1 +1145,0 @@\n-        static final VarForm FORM_EXACT = FORM.asExact();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/X-VarHandle.java.template","additions":35,"deletions":43,"binary":false,"changes":78,"status":"modified"},{"patch":"@@ -71,2 +71,2 @@\n-        ByteArrayViewVarHandle(VarForm form, boolean be) {\n-            super(form);\n+        ByteArrayViewVarHandle(VarForm form, boolean be, boolean exact) {\n+            super(form, exact);\n@@ -80,1 +80,1 @@\n-            this(ArrayHandle.FORM, be);\n+            this(be, false);\n@@ -83,7 +83,2 @@\n-        private ArrayHandle(VarForm form, boolean be) {\n-            super(form, be);\n-        }\n-\n-        @Override\n-        ArrayHandle withVarForm(VarForm varForm) {\n-            return new ArrayHandle(varForm, be);\n+        private ArrayHandle(boolean be, boolean exact) {\n+            super(ArrayHandle.FORM, be, exact);\n@@ -94,1 +89,1 @@\n-            return withVarForm(FORM_EXACT);\n+            return new ArrayHandle(be, true);\n@@ -99,1 +94,1 @@\n-            return withVarForm(FORM);\n+            return new ArrayHandle(be, false);\n@@ -571,1 +566,0 @@\n-        static final VarForm FORM_EXACT = FORM.asExact();\n@@ -578,1 +572,1 @@\n-            this(ByteBufferHandle.FORM, be);\n+            this(be, false);\n@@ -581,7 +575,2 @@\n-        private ByteBufferHandle(VarForm form, boolean be) {\n-            super(form, be);\n-        }\n-\n-        @Override\n-        ByteBufferHandle withVarForm(VarForm varForm) {\n-            return new ByteBufferHandle(varForm, be);\n+        private ByteBufferHandle(boolean be, boolean exact) {\n+            super(ByteBufferHandle.FORM, be, exact);\n@@ -592,1 +581,1 @@\n-            return withVarForm(FORM_EXACT);\n+            return new ByteBufferHandle(be, true);\n@@ -597,1 +586,1 @@\n-            return withVarForm(FORM);\n+            return new ByteBufferHandle(be, false);\n@@ -1085,1 +1074,0 @@\n-        static final VarForm FORM_EXACT = FORM.asExact();\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/X-VarHandleByteArrayView.java.template","additions":12,"deletions":24,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -76,1 +76,1 @@\n-    @Test(dataProvider = \"dataObjectAccess\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataObjectAccess\")\n@@ -93,1 +93,6 @@\n-        setter.set(vh, w, testValue); \/\/ should throw\n+        try {\n+            setter.set(vh, w, testValue); \/\/ should throw\n+            fail(\"Exception expected\");\n+        } catch (WrongMethodTypeException wmte) {\n+            assertMatches(wmte.getMessage(),\".*\\\\Qexpected (Widget,\" + fieldType.getSimpleName() + \")void \\\\E.*\");\n+        }\n@@ -96,1 +101,1 @@\n-    @Test(dataProvider = \"dataObjectAccess\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataObjectAccess\")\n@@ -112,1 +117,6 @@\n-        getter.get(vh, w); \/\/ should throw\n+        try {\n+            getter.get(vh, w); \/\/ should throw\n+            fail(\"Exception expected\");\n+        } catch (WrongMethodTypeException wmte) {\n+            assertMatches(wmte.getMessage(),\".*\\\\Qexpected (Widget)\" + fieldType.getSimpleName() + \" \\\\E.*\");\n+        }\n@@ -115,1 +125,1 @@\n-    @Test(dataProvider = \"dataObjectAccess\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataObjectAccess\")\n@@ -131,1 +141,6 @@\n-        staticSetter.set(vh, testValue); \/\/ should throw\n+        try {\n+            staticSetter.set(vh, testValue); \/\/ should throw\n+            fail(\"Exception expected\");\n+        } catch (WrongMethodTypeException wmte) {\n+            assertMatches(wmte.getMessage(),\".*\\\\Qexpected (\" + fieldType.getSimpleName() + \")void \\\\E.*\");\n+        }\n@@ -134,1 +149,1 @@\n-    @Test(dataProvider = \"dataObjectAccess\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataObjectAccess\")\n@@ -149,1 +164,6 @@\n-        staticGetter.get(vh); \/\/ should throw\n+        try {\n+            staticGetter.get(vh); \/\/ should throw\n+            fail(\"Exception expected\");\n+        } catch (WrongMethodTypeException wmte) {\n+            assertMatches(wmte.getMessage(),\".*\\\\Qexpected ()\" + fieldType.getSimpleName() + \" \\\\E.*\");\n+        }\n@@ -152,1 +172,1 @@\n-    @Test(dataProvider = \"dataSetArray\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataSetArray\")\n@@ -165,1 +185,7 @@\n-        setter.set(vh, arr, testValue); \/\/ should throw\n+        try {\n+            setter.set(vh, arr, testValue); \/\/ should throw\n+            fail(\"Exception expected\");\n+        } catch (WrongMethodTypeException wmte) {\n+            assertMatches(wmte.getMessage(),\n+                \".*\\\\Qexpected (\" + arrayClass.getSimpleName() + \",int,\" + arrayClass.componentType().getSimpleName() + \")void \\\\E.*\");\n+        }\n@@ -168,1 +194,1 @@\n-    @Test(dataProvider = \"dataSetBuffer\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataSetBuffer\")\n@@ -181,1 +207,7 @@\n-        setter.set(vh, buff, testValue); \/\/ should throw\n+        try {\n+            setter.set(vh, buff, testValue); \/\/ should throw\n+            fail(\"Exception expected\");\n+        } catch (WrongMethodTypeException wmte) {\n+            assertMatches(wmte.getMessage(),\n+                \".*\\\\Qexpected (ByteBuffer,int,\" + arrayClass.componentType().getSimpleName() + \")void \\\\E.*\");\n+        }\n@@ -184,1 +216,1 @@\n-    @Test(dataProvider = \"dataSetMemorySegment\", expectedExceptions = WrongMethodTypeException.class)\n+    @Test(dataProvider = \"dataSetMemorySegment\")\n@@ -197,1 +229,13 @@\n-            setter.set(vh, base, testValue); \/\/ should throw\n+            try {\n+                setter.set(vh, base, testValue); \/\/ should throw\n+                fail(\"Exception expected\");\n+            } catch (WrongMethodTypeException wmte) {\n+                assertMatches(wmte.getMessage(),\n+                    \".*\\\\Qexpected (MemoryAddress,\" + carrier.getSimpleName() + \")void \\\\E.*\");\n+            }\n+        }\n+    }\n+\n+    private static void assertMatches(String str, String pattern) {\n+        if (!str.matches(pattern)) {\n+            throw new AssertionError(\"'\" + str + \"' did not match the pattern '\" + pattern + \"'.\");\n","filename":"test\/jdk\/java\/lang\/invoke\/VarHandles\/VarHandleTestExact.java","additions":58,"deletions":14,"binary":false,"changes":72,"status":"modified"}]}