{"files":[{"patch":"@@ -2297,0 +2297,6 @@\n+    case Op_ExpandBits:\n+    case Op_CompressBits:\n+      if (!(UseSVE > 1 && VM_Version::supports_svebitperm())) {\n+        ret_value = false;\n+      }\n+      break;\n@@ -16938,0 +16944,73 @@\n+\/\/----------------------------- CompressBits\/ExpandBits ------------------------\n+\n+instruct compressBitsI_reg(iRegINoSp dst, iRegIorL2I src, iRegIorL2I mask,\n+                           vRegF tdst, vRegF tsrc, vRegF tmask) %{\n+  match(Set dst (CompressBits src mask));\n+  effect(TEMP tdst, TEMP tsrc, TEMP tmask);\n+  format %{ \"mov    $tsrc, $src\\n\\t\"\n+            \"mov    $tmask, $mask\\n\\t\"\n+            \"bext   $tdst, $tsrc, $tmask\\t# parallel bit extract\\n\\t\"\n+            \"mov    $dst, $tdst\"\n+          %}\n+  ins_encode %{\n+    __ mov($tsrc$$FloatRegister, __ S, 0, $src$$Register);\n+    __ mov($tmask$$FloatRegister, __ S, 0, $mask$$Register);\n+    __ sve_bext($tdst$$FloatRegister, __ S, $tsrc$$FloatRegister, $tmask$$FloatRegister);\n+    __ mov($dst$$Register, $tdst$$FloatRegister, __ S, 0);\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n+instruct compressBitsL_reg(iRegLNoSp dst, iRegL src, iRegL mask,\n+                           vRegD tdst, vRegD tsrc, vRegD tmask) %{\n+  match(Set dst (CompressBits src mask));\n+  effect(TEMP tdst, TEMP tsrc, TEMP tmask);\n+  format %{ \"mov    $tsrc, $src\\n\\t\"\n+            \"mov    $tmask, $mask\\n\\t\"\n+            \"bext   $tdst, $tsrc, $tmask\\t# parallel bit extract\\n\\t\"\n+            \"mov    $dst, $tdst\"\n+          %}\n+  ins_encode %{\n+    __ mov($tsrc$$FloatRegister, __ D, 0, $src$$Register);\n+    __ mov($tmask$$FloatRegister, __ D, 0, $mask$$Register);\n+    __ sve_bext($tdst$$FloatRegister, __ D, $tsrc$$FloatRegister, $tmask$$FloatRegister);\n+    __ mov($dst$$Register, $tdst$$FloatRegister, __ D, 0);  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n+instruct expandBitsI_reg(iRegINoSp dst, iRegIorL2I src, iRegIorL2I mask,\n+                         vRegF tdst, vRegF tsrc, vRegF tmask) %{\n+  match(Set dst (ExpandBits src mask));\n+  effect(TEMP tdst, TEMP tsrc, TEMP tmask);\n+  format %{ \"mov    $tsrc, $src\\n\\t\"\n+            \"mov    $tmask, $mask\\n\\t\"\n+            \"bdep   $tdst, $tsrc, $tmask\\t# parallel bit deposit\\n\\t\"\n+            \"mov    $dst, $tdst\"\n+          %}\n+  ins_encode %{\n+    __ mov($tsrc$$FloatRegister, __ S, 0, $src$$Register);\n+    __ mov($tmask$$FloatRegister, __ S, 0, $mask$$Register);\n+    __ sve_bdep($tdst$$FloatRegister, __ S, $tsrc$$FloatRegister, $tmask$$FloatRegister);\n+    __ mov($dst$$Register, $tdst$$FloatRegister, __ S, 0);\n+    %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n+instruct expandBitsL_reg(iRegLNoSp dst, iRegL src, iRegL mask,\n+                         vRegD tdst, vRegD tsrc, vRegD tmask) %{\n+  match(Set dst (ExpandBits src mask));\n+  effect(TEMP tdst, TEMP tsrc, TEMP tmask);\n+  format %{ \"mov    $tsrc, $src\\n\\t\"\n+            \"mov    $tmask, $mask\\n\\t\"\n+            \"bdep   $tdst, $tsrc, $tmask\\t# parallel bit deposit\\n\\t\"\n+            \"mov    $dst, $tdst\"\n+          %}\n+  ins_encode %{\n+    __ mov($tsrc$$FloatRegister, __ D, 0, $src$$Register);\n+    __ mov($tmask$$FloatRegister, __ D, 0, $mask$$Register);\n+    __ sve_bdep($tdst$$FloatRegister, __ D, $tsrc$$FloatRegister, $tmask$$FloatRegister);\n+    __ mov($dst$$Register, $tdst$$FloatRegister, __ D, 0);\n+  %}\n+  ins_pipe(pipe_slow);\n+%}\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":79,"deletions":0,"binary":false,"changes":79,"status":"modified"},{"patch":"@@ -30,3 +30,5 @@\n- * @requires vm.cpu.features ~= \".*bmi2.*\"\n- * @requires vm.cpu.features ~= \".*bmi1.*\"\n- * @requires vm.cpu.features ~= \".*sse2.*\"\n+ * @requires (((os.arch==\"x86\" | os.arch==\"amd64\" | os.arch==\"x86_64\") &\n+ *            (vm.cpu.features ~= \".*bmi2.*\" & vm.cpu.features ~= \".*bmi1.*\" &\n+ *             vm.cpu.features ~= \".*sse2.*\")) |\n+ *            ((vm.opt.UseSVE == \"null\" | vm.opt.UseSVE > 1) &\n+ *             os.arch==\"aarch64\" & vm.cpu.features ~= \".*svebitperm.*\"))\n@@ -36,1 +38,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/TestBitShuffleOpers.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"}]}