{"files":[{"patch":"@@ -58,1 +58,1 @@\n-    drain_stack();\n+    follow_marking_stacks();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -82,3 +82,3 @@\n-  inline void drain_oop_stack();\n-  \/\/ Transfer contents from the objArray task queue overflow stack to the shared\n-  \/\/ objArray stack.\n+  inline void publish_and_drain_oop_tasks();\n+  \/\/ Try to publish all contents from the objArray task queue overflow stack to\n+  \/\/ the shared objArray stack.\n@@ -86,2 +86,2 @@\n-  \/\/ objArray stack, otherwise the task is invalid.\n-  inline bool transfer_objArray_overflow_stack(ObjArrayTask& task);\n+  \/\/ objArray stack, otherwise returns false and the task is invalid.\n+  inline bool publish_or_pop_objarray_tasks(ObjArrayTask& task);\n@@ -106,1 +106,1 @@\n-  inline void drain_stack();\n+  inline void follow_marking_stacks();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -154,1 +154,1 @@\n-inline void G1FullGCMarker::drain_oop_stack() {\n+inline void G1FullGCMarker::publish_and_drain_oop_tasks() {\n@@ -168,1 +168,1 @@\n-inline bool G1FullGCMarker::transfer_objArray_overflow_stack(ObjArrayTask& task) {\n+inline bool G1FullGCMarker::publish_or_pop_objarray_tasks(ObjArrayTask& task) {\n@@ -179,1 +179,1 @@\n-void G1FullGCMarker::drain_stack() {\n+void G1FullGCMarker::follow_marking_stacks() {\n@@ -182,1 +182,1 @@\n-    drain_oop_stack();\n+    publish_and_drain_oop_tasks();\n@@ -186,1 +186,1 @@\n-    if (transfer_objArray_overflow_stack(task) ||\n+    if (publish_or_pop_objarray_tasks(task) ||\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.inline.hpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n-void G1FollowStackClosure::do_void() { _marker->drain_stack(); }\n+void G1FollowStackClosure::do_void() { _marker->follow_marking_stacks(); }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCOopClosures.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -116,1 +116,13 @@\n-bool ParCompactionManager::transfer_from_overflow_stack(ObjArrayTask& task) {\n+inline void ParCompactionManager::publish_and_drain_oop_tasks() {\n+  oop obj;\n+  while (marking_stack()->pop_overflow(obj)) {\n+    if (!marking_stack()->try_push_to_taskqueue(obj)) {\n+      follow_contents(obj);\n+    }\n+  }\n+  while (marking_stack()->pop_local(obj)) {\n+    follow_contents(obj);\n+  }\n+}\n+\n+bool ParCompactionManager::publish_or_pop_objarray_tasks(ObjArrayTask& task) {\n@@ -129,9 +141,1 @@\n-    oop obj;\n-    while (marking_stack()->pop_overflow(obj)) {\n-      if (!marking_stack()->try_push_to_taskqueue(obj)) {\n-        follow_contents(obj);\n-      }\n-    }\n-    while (marking_stack()->pop_local(obj)) {\n-      follow_contents(obj);\n-    }\n+    publish_and_drain_oop_tasks();\n@@ -141,1 +145,2 @@\n-    if (transfer_from_overflow_stack(task) || _objarray_stack.pop_local(task)) {\n+    if (publish_or_pop_objarray_tasks(task) ||\n+      _objarray_stack.pop_local(task)) {\n","filename":"src\/hotspot\/share\/gc\/parallel\/psCompactionManager.cpp","additions":16,"deletions":11,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -100,1 +100,6 @@\n-  bool transfer_from_overflow_stack(ObjArrayTask& task);\n+  void publish_and_drain_oop_tasks();\n+  \/\/ Try to publish all contents from the objArray task queue overflow stack to\n+  \/\/ the shared objArray stack.\n+  \/\/ Returns true and a valid task if there has not been enough space in the shared\n+  \/\/ objArray stack, otherwise returns false and the task is invalid.\n+  bool publish_or_pop_objarray_tasks(ObjArrayTask& task);\n","filename":"src\/hotspot\/share\/gc\/parallel\/psCompactionManager.hpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"}]}