{"files":[{"patch":"@@ -103,0 +103,3 @@\n+\/\/ VM option strings that need to be freed along with the options array above.\n+static char** optionStrings = NULL;\n+static int numOptionStrings = 0, maxOptionStrings = 0;\n@@ -122,0 +125,1 @@\n+static void AddAllocatedOption(char* str);\n@@ -861,1 +865,1 @@\n-    options[numOptions].optionString = JLI_StringDup(str);\n+    options[numOptions].optionString = str;\n@@ -896,0 +900,19 @@\n+void\n+AddAllocatedOption(char* str) {\n+  if (numOptionStrings >= maxOptionStrings) {\n+      if (optionStrings == NULL) {\n+          maxOptionStrings = 4;\n+          optionStrings = JLI_MemAlloc(maxOptionStrings * sizeof(char*));\n+      } else {\n+          char** tmp;\n+          maxOptionStrings *= 2;\n+          tmp = JLI_MemAlloc(maxOptionStrings * sizeof(char*));\n+          memcpy(tmp, optionStrings, numOptionStrings * sizeof(char*));\n+          JLI_MemFree(optionStrings);\n+          optionStrings = tmp;\n+      }\n+  }\n+  options[numOptionStrings++] = str;\n+  AddOption(str);\n+}\n+\n@@ -898,3 +921,3 @@\n-  for (int i = 0; i < numOptions; i++) {\n-    JLI_MemFree(options[i].optionString);\n-    options[i].optionString = NULL;\n+  for (int i = 0; i < numOptionStrings; i++) {\n+    JLI_MemFree(optionStrings[i]);\n+    optionStrings[i] = NULL;\n@@ -902,0 +925,3 @@\n+  JLI_MemFree(optionStrings);\n+  optionStrings = NULL;\n+  numOptionStrings = maxOptionStrings = 0;\n@@ -928,2 +954,1 @@\n-    AddOption(def);\n-    JLI_MemFree(def);\n+    AddAllocatedOption(def);\n@@ -945,2 +970,1 @@\n-    AddOption(def);\n-    JLI_MemFree(def);\n+    AddAllocatedOption(def);\n@@ -968,2 +992,1 @@\n-    AddOption(def);\n-    JLI_MemFree(def);\n+    AddAllocatedOption(def);\n@@ -1260,2 +1283,1 @@\n-                AddOption(propValue);\n-                JLI_MemFree(propValue);\n+                AddAllocatedOption(propValue);\n@@ -1386,2 +1408,1 @@\n-            AddOption(tmp);\n-            JLI_MemFree(tmp);\n+            AddAllocatedOption(tmp);\n@@ -1722,2 +1743,1 @@\n-                AddOption(envcp);\n-                JLI_MemFree(envcp);\n+                AddAllocatedOption(envcp);\n@@ -1736,2 +1756,1 @@\n-    AddOption(apphome);\n-    JLI_MemFree(apphome);\n+    AddAllocatedOption(apphome);\n@@ -1753,2 +1772,1 @@\n-        AddOption(appcp);\n-        JLI_MemFree(appcp);\n+        AddAllocatedOption(appcp);\n@@ -1811,2 +1829,1 @@\n-    AddOption(javaCommand);\n-    JLI_MemFree(javaCommand);\n+    AddAllocatedOption(javaCommand);\n","filename":"src\/java.base\/share\/native\/libjli\/java.c","additions":39,"deletions":22,"binary":false,"changes":61,"status":"modified"}]}