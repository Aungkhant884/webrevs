{"files":[{"patch":"@@ -101,2 +101,5 @@\n-static JavaVMOption *options;\n-static int numOptions, maxOptions;\n+static JavaVMOption *options = NULL;\n+static int numOptions = 0, maxOptions = 0;\n+\/\/ VM option strings that need to be freed along with the options array above.\n+static char** optionStrings = NULL;\n+static int numOptionStrings = 0, maxOptionStrings = 0;\n@@ -121,0 +124,3 @@\n+static void AddOption(const char *str);\n+static void AddAllocatedOption(char* str);\n+static void FreeOptions();\n@@ -268,1 +274,1 @@\n-        AddOption(\"-Dsun.java.launcher.diag=true\", NULL);\n+        AddOption(\"-Dsun.java.launcher.diag=true\");\n@@ -840,1 +846,1 @@\n-AddOption(char *str, void *info)\n+AddOption(const char *str)\n@@ -860,1 +866,1 @@\n-    options[numOptions++].extraInfo = info;\n+    options[numOptions++].extraInfo = NULL;\n@@ -894,0 +900,33 @@\n+void\n+AddAllocatedOption(char* str) {\n+  if (numOptionStrings >= maxOptionStrings) {\n+      if (optionStrings == NULL) {\n+          maxOptionStrings = 4;\n+          optionStrings = JLI_MemAlloc(maxOptionStrings * sizeof(char*));\n+      } else {\n+          char** tmp;\n+          maxOptionStrings *= 2;\n+          tmp = JLI_MemAlloc(maxOptionStrings * sizeof(char*));\n+          memcpy(tmp, optionStrings, numOptionStrings * sizeof(char*));\n+          JLI_MemFree(optionStrings);\n+          optionStrings = tmp;\n+      }\n+  }\n+  options[numOptionStrings++] = str;\n+  AddOption(str);\n+}\n+\n+void\n+FreeOptions() {\n+  for (int i = 0; i < numOptionStrings; i++) {\n+    JLI_MemFree(optionStrings[i]);\n+    optionStrings[i] = NULL;\n+  }\n+  JLI_MemFree(optionStrings);\n+  optionStrings = NULL;\n+  numOptionStrings = maxOptionStrings = 0;\n+  JLI_MemFree(options);\n+  options = NULL;\n+  numOptions = maxOptions = 0;\n+}\n+\n@@ -915,1 +954,1 @@\n-    AddOption(def, NULL);\n+    AddAllocatedOption(def);\n@@ -931,1 +970,1 @@\n-    AddOption(def, NULL);\n+    AddAllocatedOption(def);\n@@ -953,1 +992,1 @@\n-    AddOption(def, NULL);\n+    AddAllocatedOption(def);\n@@ -1244,1 +1283,1 @@\n-                AddOption(propValue, NULL);\n+                AddAllocatedOption(propValue);\n@@ -1260,1 +1299,1 @@\n-            AddOption(\"-Djdk.module.validation=true\", NULL);\n+            AddOption(\"-Djdk.module.validation=true\");\n@@ -1272,1 +1311,1 @@\n-                AddOption(option, NULL);\n+                AddOption(option);\n@@ -1327,1 +1366,1 @@\n-            AddOption(\"-Dsun.java.launcher.diag=true\", NULL);\n+            AddOption(\"-Dsun.java.launcher.diag=true\");\n@@ -1329,1 +1368,1 @@\n-            AddOption(\"-Djdk.module.showModuleResolution=true\", NULL);\n+            AddOption(\"-Djdk.module.showModuleResolution=true\");\n@@ -1341,1 +1380,1 @@\n-            AddOption(\"-verbose:gc\", NULL);\n+            AddOption(\"-verbose:gc\");\n@@ -1343,1 +1382,1 @@\n-            AddOption(\"-Xt\", NULL);\n+            AddOption(\"-Xt\");\n@@ -1345,1 +1384,1 @@\n-            AddOption(\"-Xtm\", NULL);\n+            AddOption(\"-Xtm\");\n@@ -1347,1 +1386,1 @@\n-            AddOption(\"-Xdebug\", NULL);\n+            AddOption(\"-Xdebug\");\n@@ -1349,1 +1388,1 @@\n-            AddOption(\"-Xnoclassgc\", NULL);\n+            AddOption(\"-Xnoclassgc\");\n@@ -1352,1 +1391,1 @@\n-            AddOption(\"-Xverify:all\", NULL);\n+            AddOption(\"-Xverify:all\");\n@@ -1354,1 +1393,1 @@\n-            AddOption(\"-Xverify:all\", NULL);\n+            AddOption(\"-Xverify:all\");\n@@ -1356,1 +1395,1 @@\n-            AddOption(\"-Xverify:remote\", NULL);\n+            AddOption(\"-Xverify:remote\");\n@@ -1362,1 +1401,1 @@\n-            AddOption(\"-Xverify:none\", NULL);\n+            AddOption(\"-Xverify:none\");\n@@ -1369,1 +1408,1 @@\n-            AddOption(tmp, NULL);\n+            AddAllocatedOption(tmp);\n@@ -1386,1 +1425,1 @@\n-            AddOption(arg, NULL);\n+            AddOption(arg);\n@@ -1412,1 +1451,1 @@\n-        AddOption(\"--add-modules=ALL-DEFAULT\", NULL);\n+        AddOption(\"--add-modules=ALL-DEFAULT\");\n@@ -1460,1 +1499,1 @@\n-    JLI_MemFree(options);\n+    FreeOptions();\n@@ -1704,1 +1743,1 @@\n-                AddOption(envcp, NULL);\n+                AddAllocatedOption(envcp);\n@@ -1717,1 +1756,1 @@\n-    AddOption(apphome, NULL);\n+    AddAllocatedOption(apphome);\n@@ -1733,1 +1772,1 @@\n-        AddOption(appcp, NULL);\n+        AddAllocatedOption(appcp);\n@@ -1790,1 +1829,1 @@\n-    AddOption(javaCommand, NULL);\n+    AddAllocatedOption(javaCommand);\n@@ -1798,1 +1837,1 @@\n-  AddOption(\"-Dsun.java.launcher=SUN_STANDARD\", NULL);\n+  AddOption(\"-Dsun.java.launcher=SUN_STANDARD\");\n","filename":"src\/java.base\/share\/native\/libjli\/java.c","additions":70,"deletions":31,"binary":false,"changes":101,"status":"modified"},{"patch":"@@ -171,1 +171,0 @@\n-void AddOption(char *str, void *info);\n","filename":"src\/java.base\/share\/native\/libjli\/java.h","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}