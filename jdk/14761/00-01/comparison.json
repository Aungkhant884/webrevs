{"files":[{"patch":"@@ -288,5 +288,7 @@\n-      \/\/ Transition java thread to vm so it can issue a notify.\n-      ThreadInVMfromNative transition(JavaThread::cast(thread));\n-      _post_box.post(MSG_FULLBUFFER);\n-    } else {\n-      _post_box.post(MSG_FULLBUFFER);\n+      JavaThread* jt = JavaThread::cast(thread);\n+      if (jt->thread_state() == _thread_in_native) {\n+        \/\/ Transition java thread to vm so it can issue a notify.\n+        ThreadInVMfromNative transition(jt);\n+        _post_box.post(MSG_FULLBUFFER);\n+        return;\n+      }\n@@ -294,0 +296,1 @@\n+    _post_box.post(MSG_FULLBUFFER);\n","filename":"src\/hotspot\/share\/jfr\/recorder\/storage\/jfrStorage.cpp","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"}]}