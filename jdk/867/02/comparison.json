{"files":[{"patch":"@@ -32,2 +32,4 @@\n-import java.text.ParseException;\n-import java.text.SimpleDateFormat;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n@@ -40,1 +42,0 @@\n-import java.util.TimeZone;\n@@ -1742,13 +1743,2 @@\n-    private static final SimpleDateFormat[] dateFormats;\n-\n-    static {\n-        String[] formats = {\n-            \"yyyyMMddHHmmss.SSS\",\n-            \"yyyyMMddHHmmss\"\n-        };\n-        dateFormats = new SimpleDateFormat[formats.length];\n-        for (int i = 0; i < formats.length; ++i) {\n-            dateFormats[i] = new SimpleDateFormat(formats[i]);\n-            dateFormats[i].setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n-        }\n-    }\n+    private static final DateTimeFormatter RFC3659_DATETIME_FORMAT = DateTimeFormatter.ofPattern(\"yyyyMMddHHmmss[.SSS]\")\n+                                                                                      .withZone(ZoneOffset.UTC);\n@@ -1771,2 +1761,2 @@\n-            String s = getResponseString().substring(4);\n-            return parseRfc3659TimeValue(s);\n+            String s = getResponseString();\n+            return parseRfc3659TimeValue(s.substring(4, s.length() - 1));\n@@ -1778,9 +1768,5 @@\n-        Date d = null;\n-        for (SimpleDateFormat dateFormat : dateFormats) {\n-            try {\n-                d = dateFormat.parse(s);\n-            } catch (ParseException ex) {\n-            }\n-            if (d != null) {\n-                return d;\n-            }\n+        Date result = null;\n+        try {\n+            var d = ZonedDateTime.parse(s, RFC3659_DATETIME_FORMAT);\n+            result = Date.from(d.toInstant());\n+        } catch (DateTimeParseException ex) {\n@@ -1788,1 +1774,1 @@\n-        return d;\n+        return result;\n","filename":"src\/java.base\/share\/classes\/sun\/net\/ftp\/impl\/FtpClient.java","additions":14,"deletions":28,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -31,1 +31,2 @@\n- * @run main TestFtpTimeValue\n+ * @run main\/othervm -Duser.timezone=UTC TestFtpTimeValue\n+ * @run main\/othervm -Duser.timezone=America\/Los_Angeles TestFtpTimeValue\n@@ -64,1 +65,1 @@\n-            var s = String.format(\"%4d%2d%2d%2d%2d%2d\", year, month, day, hrs, min, sec);\n+            var s = String.format(\"%4d%02d%02d%02d%02d%02d\", year, month, day, hrs, min, sec);\n@@ -66,1 +67,1 @@\n-                s += \".\" + String.format(\"%3d\", milliseconds);\n+                s += \".\" + String.format(\"%03d\", milliseconds);\n@@ -72,1 +73,1 @@\n-            s = String.format(\"%4d%2d%2d%2d%2d%2d\", year, month, day, hrs, min, sec + 1);\n+            s = String.format(\"%4d%02d%02d%02d%02d%02d\", year, month, day, hrs, min, sec + 1);\n@@ -74,1 +75,1 @@\n-                s += \".\" + String.format(\"%3d\", milliseconds);\n+                s += \".\" + String.format(\"%03d\", milliseconds);\n@@ -81,0 +82,1 @@\n+        System.out.println(\"user.timezone: \" + System.getProperty(\"user.timezone\"));\n","filename":"test\/jdk\/sun\/net\/ftp\/TestFtpTimeValue.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"}]}