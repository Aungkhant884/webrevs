{"files":[{"patch":"@@ -90,1 +90,1 @@\n-  enum ScanningInYoungValues {\n+  enum SkipCardEnqueueTristate {\n@@ -96,1 +96,1 @@\n-  ScanningInYoungValues _skip_card_enqueue;\n+  SkipCardEnqueueTristate _skip_card_enqueue;\n@@ -114,1 +114,0 @@\n-\/\/ RAII object to properly set the _scanning_in_young field in G1ScanEvacuatedObjClosure.\n@@ -119,1 +118,1 @@\n-  G1SkipCardEnqueueSetter(G1ScanEvacuatedObjClosure* closure, bool skip_enqueue_cards) : _closure(closure) {\n+  G1SkipCardEnqueueSetter(G1ScanEvacuatedObjClosure* closure, bool skip_card_enqueue) : _closure(closure) {\n@@ -121,1 +120,1 @@\n-    _closure->_skip_card_enqueue = skip_enqueue_cards ? G1ScanEvacuatedObjClosure::True : G1ScanEvacuatedObjClosure::False;\n+    _closure->_skip_card_enqueue = skip_card_enqueue ? G1ScanEvacuatedObjClosure::True : G1ScanEvacuatedObjClosure::False;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1OopClosures.hpp","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -247,2 +247,1 @@\n-  assert(!dest_attr.is_in_cset(), \"must not scan object from cset here\");\n-  G1SkipCardEnqueueSetter x(&_scanner, dest_attr.is_new_survivor() || dest_attr.is_in_cset());\n+  G1SkipCardEnqueueSetter x(&_scanner, dest_attr.is_new_survivor());\n@@ -280,4 +279,6 @@\n-  \/\/ FIXME: check if we could just use dest_attr\n-  dest_attr = _g1h->region_attr(to_array);\n-  assert(!_g1h->region_attr(to_array).is_in_cset(), \"must not scan object from cset here\");\n-  G1SkipCardEnqueueSetter x(&_scanner, dest_attr.is_new_survivor() || dest_attr.is_in_cset());\n+  \/\/ Same reason to use dest_attr.is_young() here as for the successfully evacuated\n+  \/\/ regular object case. Is_survivor() may not have been set, but to_array must\n+  \/\/ be in a Survivor region (if dest_attr.is_young()) or Old here.\n+  \/\/ Assert this here as it is not immediately obvious.\n+  assert(!dest_attr.is_young() || _g1h->heap_region_containing(to_array)->is_survivor(), \"must be\");\n+  G1SkipCardEnqueueSetter x(&_scanner, dest_attr.is_young());\n@@ -543,0 +544,2 @@\n+    \/\/ Assert this here although almost obvious.\n+    assert(!dest_attr.is_young() || _g1h->heap_region_containing(obj)->is_survivor(), \"must be\");\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ParScanThreadState.cpp","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"}]}