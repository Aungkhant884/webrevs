{"files":[{"patch":"@@ -84,5 +84,0 @@\n-    @Override\n-    boolean isDirect() {\n-        return false;\n-    }\n-\n@@ -105,0 +100,7 @@\n+    @ForceInline\n+    boolean checkAccessModeThenIsDirect(VarHandle.AccessDescriptor ad) {\n+        super.checkAccessModeThenIsDirect(ad);\n+        \/\/ return false to indicate this is an IndirectVarHandle\n+        return false;\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/IndirectVarHandle.java","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -525,4 +525,0 @@\n-    boolean isDirect() {\n-        return true;\n-    }\n-\n@@ -2070,1 +2066,1 @@\n-    final void checkExactAccessMode(VarHandle.AccessDescriptor ad) {\n+    boolean checkAccessModeThenIsDirect(VarHandle.AccessDescriptor ad) {\n@@ -2074,0 +2070,2 @@\n+        \/\/ return true unless overridden in an IndirectVarHandle\n+        return true;\n@@ -2084,2 +2082,5 @@\n-        TypesAndInvokers tis = getTypesAndInvokers();\n-        MethodType mt = tis.methodType_table[accessTypeOrdinal];\n+        MethodType[] mtTable = methodTypeTable;\n+        if (mtTable == null) {\n+            mtTable = methodTypeTable = new MethodType[VarHandle.AccessType.COUNT];\n+        }\n+        MethodType mt = mtTable[accessTypeOrdinal];\n@@ -2087,1 +2088,1 @@\n-            mt = tis.methodType_table[accessTypeOrdinal] =\n+            mt = mtTable[accessTypeOrdinal] =\n@@ -2162,9 +2163,1 @@\n-    TypesAndInvokers typesAndInvokers;\n-\n-    static class TypesAndInvokers {\n-        final @Stable\n-        MethodType[] methodType_table = new MethodType[VarHandle.AccessType.COUNT];\n-\n-        final @Stable\n-        MethodHandle[] methodHandle_table = new MethodHandle[AccessMode.COUNT];\n-    }\n+    MethodType[] methodTypeTable;\n@@ -2172,8 +2165,2 @@\n-    @ForceInline\n-    private final TypesAndInvokers getTypesAndInvokers() {\n-        TypesAndInvokers tis = typesAndInvokers;\n-        if (tis == null) {\n-            tis = typesAndInvokers = new TypesAndInvokers();\n-        }\n-        return tis;\n-    }\n+    @Stable\n+    MethodHandle[] methodHandleTable;\n@@ -2183,2 +2170,5 @@\n-        TypesAndInvokers tis = getTypesAndInvokers();\n-        MethodHandle mh = tis.methodHandle_table[mode];\n+        MethodHandle[] mhTable = methodHandleTable;\n+        if (mhTable == null) {\n+            mhTable = methodHandleTable = new MethodHandle[AccessMode.COUNT];\n+        }\n+        MethodHandle mh = mhTable[mode];\n@@ -2186,1 +2176,1 @@\n-            mh = tis.methodHandle_table[mode] = getMethodHandleUncached(mode);\n+            mh = mhTable[mode] = getMethodHandleUncached(mode);\n@@ -2190,0 +2180,1 @@\n+\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandle.java","additions":19,"deletions":28,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -37,2 +37,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -51,2 +51,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -54,1 +54,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -66,2 +66,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -79,2 +79,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -93,2 +93,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -107,2 +107,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -120,2 +120,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -123,1 +123,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -135,2 +135,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -148,2 +148,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -161,2 +161,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -174,2 +174,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -187,2 +187,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -190,1 +190,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -202,2 +202,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -215,2 +215,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -228,2 +228,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -241,2 +241,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -254,2 +254,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -257,1 +257,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -269,2 +269,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -282,2 +282,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -295,2 +295,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -308,2 +308,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -321,2 +321,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -324,1 +324,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -336,2 +336,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -349,2 +349,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -362,2 +362,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -375,2 +375,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -389,2 +389,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -392,1 +392,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -404,2 +404,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -417,2 +417,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -430,2 +430,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -433,1 +433,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -445,2 +445,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -458,2 +458,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -471,2 +471,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -484,2 +484,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -497,2 +497,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -500,1 +500,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -512,2 +512,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -525,2 +525,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -538,2 +538,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -551,2 +551,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -564,2 +564,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -567,1 +567,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -579,2 +579,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -592,2 +592,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -605,2 +605,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -618,2 +618,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -631,2 +631,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -634,1 +634,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -646,2 +646,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -659,2 +659,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -672,2 +672,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -685,2 +685,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -699,2 +699,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -702,1 +702,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -714,2 +714,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -727,2 +727,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -741,2 +741,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -755,2 +755,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -758,1 +758,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -770,2 +770,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -783,2 +783,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -796,2 +796,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -809,2 +809,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -812,1 +812,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -824,2 +824,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -837,2 +837,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -850,2 +850,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -863,2 +863,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -876,2 +876,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -879,1 +879,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -891,2 +891,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -904,2 +904,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -917,2 +917,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -930,2 +930,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -943,2 +943,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -946,1 +946,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -958,2 +958,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -971,2 +971,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -984,2 +984,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -997,2 +997,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1010,2 +1010,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1013,1 +1013,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -1025,2 +1025,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1038,2 +1038,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1051,2 +1051,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1064,2 +1064,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1067,1 +1067,1 @@\n-        } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+        } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -1079,2 +1079,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -1092,2 +1092,2 @@\n-        handle.checkExactAccessMode(ad);\n-        if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+        boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+        if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandleGuards.java","additions":175,"deletions":175,"binary":false,"changes":350,"status":"modified"},{"patch":"@@ -698,2 +698,2 @@\n-\/\/                    handle.checkExactAccessMode(ad);\n-\/\/                    if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+\/\/                    boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+\/\/                    if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -713,2 +713,2 @@\n-\/\/                    handle.checkExactAccessMode(ad);\n-\/\/                    if (handle.isDirect() && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n+\/\/                    boolean direct = handle.checkAccessModeThenIsDirect(ad);\n+\/\/                    if (direct && handle.vform.methodType_table[ad.type] == ad.symbolicMethodTypeErased) {\n@@ -716,1 +716,1 @@\n-\/\/                    } else if (handle.isDirect() && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n+\/\/                    } else if (direct && handle.vform.getMethodType_V(ad.type) == ad.symbolicMethodTypeErased) {\n@@ -862,3 +862,0 @@\n-\/\/            List<String> LINK_TO_STATIC_ARGS_V = params.keySet().stream().\n-\/\/                    collect(toList());\n-\/\/            LINK_TO_STATIC_ARGS_V.add(\"handle.vform.getMemberName_V(ad.mode)\");\n@@ -897,2 +894,0 @@\n-\/\/                    replaceAll(\"<LINK_TO_STATIC_ARGS_V>\", LINK_TO_STATIC_ARGS_V.stream().\n-\/\/                            collect(joining(\", \"))).\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandles.java","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"}]}