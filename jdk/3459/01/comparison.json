{"files":[{"patch":"@@ -70,0 +70,9 @@\n+      if (hr->is_young()) {\n+        \/\/ Old regions have BOTs info for performance consideration, but young regions\n+        \/\/ lack of BOTs info.\n+        \/\/ Young regions with high live ratio might not be compacted during full gc,\n+        \/\/ and they will be converted to old regions after full gc, at this situation\n+        \/\/ we need to update the BOTs of these \"young\" regions to ensure better BOTs\n+        \/\/ access performance after full gc.\n+        update_bot(hr);\n+      }\n@@ -160,0 +169,16 @@\n+void G1FullGCPrepareTask::G1CalculatePointersClosure::update_bot(HeapRegion* hr) {\n+  HeapWord* limit = hr->top();\n+  HeapWord* next_addr = hr->bottom();\n+  HeapWord* threshold = hr->initialize_threshold();\n+  HeapWord* pre_addr;\n+  while (next_addr < limit) {\n+    pre_addr = next_addr;\n+    next_addr = _bitmap->get_next_marked_addr(next_addr + 1, limit);\n+\n+    if (next_addr > threshold) {\n+      threshold = hr->cross_threshold(pre_addr, next_addr);\n+    }\n+  }\n+  assert(next_addr == limit, \"Should stop the scan at the limit.\");\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCPrepareTask.cpp","additions":25,"deletions":0,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -66,0 +66,1 @@\n+    void update_bot(HeapRegion* hr);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCPrepareTask.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}