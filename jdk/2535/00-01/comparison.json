{"files":[{"patch":"@@ -281,8 +281,3 @@\n-  ThreadsListHandle tlh;\n-  JavaThread* jt = thread->as_Java_thread();\n-  if (Thread::current()->is_JavaThread_protected(jt)) {\n-    \/\/ The target JavaThread is protected so get_thread_name_string() is safe:\n-    return jt->get_thread_name_string();\n-  }\n-  \/\/ The target JavaThread is not protected so we return a non-NULL string:\n-  return \"<NOT FILLED IN>\";\n+  \/\/ If the target JavaThread is not protected, then we return the\n+  \/\/ specified non-NULL string:\n+  return thread->as_Java_thread()->get_thread_name(\"<NOT FILLED IN>\");\n","filename":"src\/hotspot\/share\/prims\/jvmtiTrace.cpp","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -487,0 +487,1 @@\n+\/\/ Is the target JavaThread protected by this Thread:\n@@ -2849,1 +2850,1 @@\n-\/\/ seen prior to having it's threadObj set (e.g., JNI attaching threads and\n+\/\/ seen prior to having its threadObj set (e.g., JNI attaching threads and\n@@ -2852,2 +2853,3 @@\n-const char* JavaThread::get_thread_name() const {\n-  ThreadsListHandle tlh;\n+const char* JavaThread::get_thread_name(const char* default_name) const {\n+  Thread* thread = Thread::current();\n+  ThreadsListHandle tlh(thread);\n@@ -2855,1 +2857,1 @@\n-  if (Thread::current()->is_JavaThread_protected(this)) {\n+  if (thread->is_JavaThread_protected(this)) {\n@@ -2860,2 +2862,2 @@\n-  \/\/ The target JavaThread is not protected so we return \"Unknown thread\":\n-  return Thread::name();\n+  \/\/ The target JavaThread is not protected so we return the default:\n+  return (default_name != NULL) ? default_name : Thread::name();\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -1690,1 +1690,1 @@\n-  const char* get_thread_name() const;\n+  const char* get_thread_name(const char* default_name = NULL) const;\n@@ -1692,1 +1692,0 @@\n-  friend class JvmtiTrace;  \/\/ so get_thread_name_string() can be called\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}