{"files":[{"patch":"@@ -512,1 +512,1 @@\n-           \"archived full module should have been disabled\");\n+           \"archived full module should have been disabled if -Djava.system.class.loader is specified\");\n","filename":"src\/hotspot\/share\/classfile\/modules.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -137,9 +137,10 @@\n-    JavaValue result(T_OBJECT);\n-    InstanceKlass* class_loader_klass = vmClasses::ClassLoader_klass();\n-    JavaCalls::call_static(&result,\n-                           class_loader_klass,\n-                           vmSymbols::getPlatformClassLoader_name(),\n-                           vmSymbols::void_classloader_signature(),\n-                           CHECK);\n-\n-    _java_platform_loader = OopHandle(Universe::vm_global(), result.get_oop());\n+    oop platform_loader = get_platform_class_loader_impl(CHECK);\n+    _java_platform_loader = OopHandle(Universe::vm_global(), platform_loader);\n+  } else {\n+    \/\/ It must have been restored from the archived module graph\n+    assert(UseSharedSpaces, \"must be\");\n+    assert(MetaspaceShared::use_full_module_graph(), \"must be\");\n+    DEBUG_ONLY(\n+      oop platform_loader = get_platform_class_loader_impl(CHECK);\n+      assert(_java_platform_loader.resolve() == platform_loader, \"must be\");\n+    )\n@@ -160,0 +161,11 @@\n+oop SystemDictionary::get_platform_class_loader_impl(TRAPS) {\n+  JavaValue result(T_OBJECT);\n+  InstanceKlass* class_loader_klass = vmClasses::ClassLoader_klass();\n+  JavaCalls::call_static(&result,\n+                         class_loader_klass,\n+                         vmSymbols::getPlatformClassLoader_name(),\n+                         vmSymbols::void_classloader_signature(),\n+                         CHECK_NULL);\n+  return result.get_oop();\n+}\n+\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":21,"deletions":9,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -137,0 +137,1 @@\n+  static oop get_platform_class_loader_impl(TRAPS);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}