{"files":[{"patch":"@@ -1567,1 +1567,1 @@\n-     * <a href=\"http:\/\/www.w3.org\/TR\/CSS21\/syndata.html#length-units\">\n+     * <a href=\"https:\/\/www.w3.org\/TR\/CSS22\/syndata.html#length-units\">\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/JEditorPane.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-import java.awt.HeadlessException;\n@@ -2865,12 +2864,7 @@\n-            int res = 72;\n-            try {\n-                res = Toolkit.getDefaultToolkit().getScreenResolution();\n-            } catch (HeadlessException e) {\n-            }\n-            \/\/ mapping according to the CSS2 spec\n-            w3cLengthMapping.put(\"pt\", res \/ 72f);\n-            w3cLengthMapping.put(\"px\", 1f);\n-            w3cLengthMapping.put(\"mm\", res \/ 25.4f);\n-            w3cLengthMapping.put(\"cm\", res \/ 2.54f);\n-            w3cLengthMapping.put(\"pc\", res \/ 6f);\n-            w3cLengthMapping.put(\"in\", (float) res);\n+            \/\/ mapping according to the CSS2.2 spec\n+            w3cLengthMapping.put(\"pt\", 1.3f); \/\/1\/72 of 1in\n+            w3cLengthMapping.put(\"px\", 1f); \/\/1\/96 of 1in\n+            w3cLengthMapping.put(\"mm\", 3.77952f); \/\/1\/10 of 1cm\n+            w3cLengthMapping.put(\"cm\", 37.7952f); \/\/96px\/2.54\n+            w3cLengthMapping.put(\"pc\", 16f); \/\/1\/6 of 1in\n+            w3cLengthMapping.put(\"in\", 96f); \/\/96px\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/CSS.java","additions":7,"deletions":13,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -0,0 +1,100 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\/*\n+ * @test\n+ * @bug 8231286\n+ * @key headful\n+ * @summary  Verifies if HTML font size too large with high-DPI scaling and W3C_LENGTH_UNITS\n+ * @run main\/othervm -Dsun.java2d.uiScale=1.0 HtmlFontSizeTest\n+ *\/\n+\n+import java.awt.BorderLayout;\n+import java.awt.Rectangle;\n+\n+import javax.swing.JFrame;\n+import javax.swing.JEditorPane;\n+import javax.swing.SwingUtilities;\n+import javax.swing.text.Document;\n+import javax.swing.text.html.HTMLEditorKit;\n+import javax.swing.text.html.StyleSheet;\n+\n+public class HtmlFontSizeTest {\n+    static Rectangle w3cFrameSize, stdFrameSize;\n+\n+    private static Rectangle test(boolean w3ccheck) {\n+        JFrame frame = new JFrame();\n+        try {\n+            frame.setLayout(new BorderLayout());\n+\n+            JEditorPane htmlPane = new JEditorPane();\n+            htmlPane.setEditable(false);\n+\n+            if (w3ccheck) {\n+                htmlPane.putClientProperty(JEditorPane.W3C_LENGTH_UNITS, Boolean.TRUE);\n+            }\n+\n+            HTMLEditorKit kit = new HTMLEditorKit();\n+            htmlPane.setEditorKit(kit);\n+\n+            StyleSheet styleSheet = kit.getStyleSheet();\n+            styleSheet.addRule(\"body { font-family: SansSerif; font-size: 16pt; }\");\n+\n+            String htmlString = \"<html>\\n\"\n+                + \"<body>\\n\"\n+                + \"<p>This should be 16 pt.<\/p>\\n\"\n+                + \"<\/body>\\n\"\n+                + \"<\/html>\";\n+\n+            Document doc = kit.createDefaultDocument();\n+            htmlPane.setDocument(doc);\n+            htmlPane.setText(htmlString);\n+\n+            frame.add(htmlPane, BorderLayout.CENTER);\n+            frame.setUndecorated(true);\n+            frame.pack();\n+            frame.setVisible(true);\n+            frame.setLocationRelativeTo(null);\n+\n+            return frame.getBounds();\n+        } finally {\n+            frame.dispose();\n+        }\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+        SwingUtilities.invokeAndWait(() -> {\n+            w3cFrameSize = test(true);\n+            stdFrameSize = test(false);\n+        });\n+        System.out.println(\"frame height with W3C:\" + w3cFrameSize);\n+        System.out.println(\"frame height without W3C:\" + stdFrameSize);\n+\n+        float ratio = (float)w3cFrameSize.width \/ (float)stdFrameSize.width;\n+        System.out.println(\"w3cFrameSize.width\/stdFrameSize.width \" + ratio);\n+\n+        String str = String.format(\"%.1g%n\", ratio);\n+        if (str.compareTo(String.format(\"%.1g%n\", 1.3f)) != 0) {\n+            throw new RuntimeException(\"HTML font size too large with high-DPI scaling and W3C_LENGTH_UNITS\");\n+        }\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/text\/html\/HtmlFontSizeTest.java","additions":100,"deletions":0,"binary":false,"changes":100,"status":"added"}]}