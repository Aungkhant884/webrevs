{"files":[{"patch":"@@ -898,1 +898,0 @@\n-\n@@ -901,1 +900,0 @@\n-\n@@ -903,2 +901,1 @@\n-  bool is_vm_dumper(uint worker_id) { return worker_id == VMDumperWorkerId; }\n-\n+  static bool is_vm_dumper(uint worker_id) { return worker_id == VMDumperWorkerId; }\n@@ -983,0 +980,8 @@\n+  bool can_parallel_dump() {\n+    const char* base_path = writer()->get_file_path();\n+    if ((strlen(base_path) + 7\/*.p\\d\\d\\d\\d\\0*\/) >= JVM_MAXPATHLEN) {\n+      \/\/ no extra path room for separate heap dump files\n+      return false;\n+    }\n+    return true;\n+  }\n@@ -1207,1 +1212,1 @@\n-  uint  num_active_workers = workers->active_workers();\n+  uint  num_active_workers = workers != nullptr ? workers->active_workers() : 0;\n@@ -1210,1 +1215,3 @@\n-  if (workers == nullptr || num_active_workers <= 1 || requested_num_dump_thread <= 1) {\n+  if (num_active_workers <= 1 ||         \/\/ serial gc?\n+      requested_num_dump_thread <= 1 ||  \/\/ request serial dump?\n+     !can_parallel_dump()) {             \/\/ can not dump in parallel?\n@@ -1291,1 +1298,1 @@\n-DumpWriter* VM_HeapDumper::create_dump_writer(){\n+DumpWriter* VM_HeapDumper::create_dump_writer() {\n@@ -1349,2 +1356,0 @@\n-\n-    writer()->finish_dump_segment();\n@@ -1361,0 +1366,1 @@\n+    assert(worker_id == 0, \"must be\");\n@@ -1365,0 +1371,1 @@\n+    writer()->finish_dump_segment();\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":16,"deletions":9,"binary":false,"changes":25,"status":"modified"}]}