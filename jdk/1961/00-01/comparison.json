{"files":[{"patch":"@@ -90,10 +90,14 @@\n-            p = AccessController.doPrivileged(\n-                new PrivilegedAction<Provider>() {\n-                    public Provider run() {\n-                        try {\n-                            @SuppressWarnings(\"deprecation\")\n-                            Object o = Class.forName(className).newInstance();\n-                            return (Provider) o;\n-                        } catch (Exception e) {\n-                            throw new ProviderException\n-                                    (\"Could not find provider \" + providerName, e);\n+            try {\n+                final Class<?> c = Class.forName(className);\n+                p = AccessController.doPrivileged(\n+                    new PrivilegedAction<Provider>() {\n+                        public Provider run() {\n+                            try {\n+                                @SuppressWarnings(\"deprecation\")\n+                                Object o = c.newInstance();\n+                                return (Provider) o;\n+                            } catch (Exception e) {\n+                                throw new ProviderException(\n+                                        \"Could not find provider \" +\n+                                                providerName, e);\n+                            }\n@@ -101,2 +105,8 @@\n-                    }\n-                });\n+                    }, null, new RuntimePermission(\n+                            \"accessClassInPackage.\" + c.getPackageName()));\n+            } catch (ClassNotFoundException e) {\n+                \/\/ Unexpected, as className is not a user but a\n+                \/\/ P11Util-internal value.\n+                throw new ProviderException(\"Could not find provider \" +\n+                        providerName, e);\n+            }\n","filename":"src\/jdk.crypto.cryptoki\/share\/classes\/sun\/security\/pkcs11\/P11Util.java","additions":22,"deletions":12,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -96,1 +96,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"test\/jdk\/sun\/security\/pkcs11\/KeyAgreement\/IllegalPackageAccess.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}