{"files":[{"patch":"@@ -672,3 +672,16 @@\n-  RemoveForwardedPointerClosure rspc;\n-  eden()->object_iterate(&rspc);\n-  from()->object_iterate(&rspc);\n+  assert(_promotion_failed, \"precondition\");\n+\n+  \/\/ Will enter Full GC soon due to failed promotion. Must reset the mark word\n+  \/\/ of objs in young-gen so that no objs are marked (forwarded) when Full GC\n+  \/\/ starts. (The mark word is overloaded: `is_marked()` == `is_forwarded()`.)\n+  struct ResetForwardedMarkWord : ObjectClosure {\n+    void do_object(oop obj) override {\n+      if (obj->is_forwarded()) {\n+        obj->init_mark();\n+      }\n+    }\n+  };\n+  ResetForwardedMarkWord cl;\n+  eden()->object_iterate(&cl);\n+  from()->object_iterate(&cl);\n+\n","filename":"src\/hotspot\/share\/gc\/serial\/defNewGeneration.cpp","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -74,6 +74,0 @@\n-void RemoveForwardedPointerClosure::do_object(oop obj) {\n-  if (obj->is_forwarded()) {\n-    PreservedMarks::init_forwarded_mark(obj);\n-  }\n-}\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/preservedMarks.cpp","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -78,5 +78,0 @@\n-class RemoveForwardedPointerClosure: public ObjectClosure {\n-public:\n-  virtual void do_object(oop obj);\n-};\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/preservedMarks.hpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"}]}