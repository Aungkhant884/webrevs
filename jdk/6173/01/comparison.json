{"files":[{"patch":"@@ -388,0 +388,7 @@\n+    public List<DocPath> getAdditionalScripts() {\n+        return options.additionalScripts().stream()\n+                .map(sf -> DocFile.createFileForInput(this, sf))\n+                .map(file -> DocPath.create(file.getName()))\n+                .collect(Collectors.toCollection(ArrayList::new));\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlConfiguration.java","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -29,2 +29,0 @@\n-import java.io.OutputStream;\n-import java.io.Writer;\n@@ -218,1 +216,1 @@\n-            SourceToHTMLConverter.convertRoot(configuration,DocPaths.SOURCE_OUTPUT);\n+            SourceToHTMLConverter.convertRoot(configuration, DocPaths.SOURCE_OUTPUT);\n@@ -228,2 +226,2 @@\n-        performCopy(options.helpFile());\n-        performCopy(options.stylesheetFile());\n+        performCopy(options.helpFile(), DocPath.empty);\n+        performCopy(options.stylesheetFile(), DocPath.empty);\n@@ -231,1 +229,4 @@\n-            performCopy(stylesheet);\n+            performCopy(stylesheet, DocPath.empty);\n+        }\n+        for (String script : options.additionalScripts()) {\n+            performCopy(script, DocPaths.SCRIPT_DIR);\n@@ -330,1 +331,1 @@\n-            DocPath filePath = DocPaths.JQUERY_FILES.resolve(file);\n+            DocPath filePath = DocPaths.SCRIPT_DIR.resolve(file);\n@@ -429,2 +430,2 @@\n-    private void performCopy(String filename) throws DocFileIOException {\n-        if (filename.isEmpty())\n+    private void performCopy(String filename, DocPath targetPath) throws DocFileIOException {\n+        if (filename.isEmpty()) {\n@@ -432,0 +433,1 @@\n+        }\n@@ -434,1 +436,1 @@\n-        DocPath path = DocPath.create(fromfile.getName());\n+        DocPath path = targetPath.resolve(fromfile.getName());\n@@ -436,1 +438,1 @@\n-        if (toFile.isSameFile(fromfile))\n+        if (toFile.isSameFile(fromfile)) {\n@@ -438,0 +440,1 @@\n+        }\n@@ -440,1 +443,1 @@\n-                fromfile.toString(), path.getPath());\n+                fromfile.getPath(), path.getPath());\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDoclet.java","additions":15,"deletions":12,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -467,0 +467,1 @@\n+                .setAdditionalScripts(configuration.getAdditionalScripts())\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,0 +62,5 @@\n+    \/**\n+     * Argument for command-line option {@code --add-script}.\n+     *\/\n+    private List<String> additionalScripts = new ArrayList<>();\n+\n@@ -202,0 +207,8 @@\n+                new Option(resources, \"--add-script\", 1) {\n+                    @Override\n+                    public boolean process(String opt, List<String> args) {\n+                        additionalScripts.add(args.get(0));\n+                        return true;\n+                    }\n+                },\n+\n@@ -503,1 +516,8 @@\n-\n+        \/\/ check if additional scripts exists\n+        for (String script : additionalScripts) {\n+            DocFile sfile = DocFile.createFileForInput(config, script);\n+            if (!sfile.exists()) {\n+                messages.error(\"doclet.File_not_found\", script);\n+                return false;\n+            }\n+        }\n@@ -517,0 +537,7 @@\n+    \/**\n+     * Argument for command-line option {@code --add-script}.\n+     *\/\n+    List<String> additionalScripts() {\n+        return additionalScripts;\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlOptions.java","additions":29,"deletions":2,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -66,0 +66,2 @@\n+    \/\/ Scripts added via --add-script option\n+    private List<DocPath> additionalScripts = Collections.emptyList();\n@@ -171,0 +173,13 @@\n+    \/**\n+     * Sets the list of additional script files to be added to the HEAD element.\n+     * The path for the script files must be relative to the root of the generated\n+     * documentation hierarchy.\n+     *\n+     * @param scripts the list of additional script files\n+     * @return this object\n+     *\/\n+    public Head setAdditionalScripts(List<DocPath> scripts) {\n+        this.additionalScripts = scripts;\n+        return this;\n+    }\n+\n@@ -318,1 +333,1 @@\n-            addStylesheet(tree, DocPaths.JQUERY_FILES.resolve(DocPaths.JQUERY_UI_CSS));\n+            addStylesheet(tree, DocPaths.SCRIPT_DIR.resolve(DocPaths.JQUERY_UI_CSS));\n@@ -340,2 +355,5 @@\n-            addJQueryFile(tree, DocPaths.JQUERY_JS);\n-            addJQueryFile(tree, DocPaths.JQUERY_UI_JS);\n+            addScriptElement(tree, DocPaths.JQUERY_JS);\n+            addScriptElement(tree, DocPaths.JQUERY_UI_JS);\n+        }\n+        for (DocPath path : additionalScripts) {\n+            addScriptElement(tree, path);\n@@ -348,3 +366,3 @@\n-    private void addJQueryFile(HtmlTree tree, DocPath filePath) {\n-        DocPath jqueryFile = pathToRoot.resolve(DocPaths.JQUERY_FILES.resolve(filePath));\n-        tree.add(HtmlTree.SCRIPT(jqueryFile.getPath()));\n+    private void addScriptElement(HtmlTree tree, DocPath filePath) {\n+        DocPath scriptFile = pathToRoot.resolve(DocPaths.SCRIPT_DIR).resolve(filePath);\n+        tree.add(HtmlTree.SCRIPT(scriptFile.getPath()));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/Head.java","additions":25,"deletions":7,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -384,0 +384,4 @@\n+doclet.usage.add-script.parameters=\\\n+    <file>\n+doclet.usage.add-script.description=\\\n+    Add a script file to the generated documentation\n@@ -387,1 +391,1 @@\n-    Additional stylesheet file for the generated documentation\n+    Add a stylesheet file to the generated documentation\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/standard.properties","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -103,3 +103,0 @@\n-    \/** The name of the directory for the jQuery files. *\/\n-    public static final DocPath JQUERY_FILES = DocPath.create(\"script-dir\");\n-\n@@ -124,0 +121,3 @@\n+    \/** The name of the file for new elements. *\/\n+    public static final DocPath NEW_LIST = DocPath.create(\"new-list.html\");\n+\n@@ -148,2 +148,2 @@\n-    \/** The name of the file for new elements. *\/\n-    public static final DocPath NEW_LIST = DocPath.create(\"new-list.html\");\n+    \/** The name of the directory for the script files. *\/\n+    public static final DocPath SCRIPT_DIR = DocPath.create(\"script-dir\");\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/DocPaths.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -168,0 +168,1 @@\n+                \"--add-script\",\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testHelpOption\/TestHelpOption.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -27,2 +27,4 @@\n- * @summary  Test the output for -header, -footer, -nooverview, -nodeprecatedlist, -nonavbar, -notree,\n- *           -stylesheetfile, --main-stylesheet, --add-stylesheet options.\n+ *           8275786\n+ * @summary  Test the output for -header, -footer, -nooverview, -nodeprecatedlist,\n+ *           -nonavbar, -notree, -stylesheetfile, --main-stylesheet, --add-stylesheet,\n+ *           --add-script options.\n@@ -181,0 +183,31 @@\n+    @Test\n+    public void testAdditionalScriptFile() {\n+        javadoc(\"-d\", \"out-additional-script\",\n+                \"--add-script\", new File(testSrc, \"additional-script-1.js\").getAbsolutePath(),\n+                \"--add-script\", new File(testSrc, \"additional-script-2.js\").getAbsolutePath(),\n+                \"-sourcepath\", testSrc,\n+                \"pkg\");\n+        checkExit(Exit.OK);\n+\n+        checkOutput(\"script-dir\/additional-script-1.js\", true, \"Additional script file 1\");\n+        checkOutput(\"script-dir\/additional-script-2.js\", true, \"Additional script file 2\");\n+        checkOutput(\"pkg\/Foo.html\", true,\n+                \"\"\"\n+                    <script type=\"text\/javascript\" src=\"..\/script-dir\/additional-script-1.js\"><\/script>\n+                    <script type=\"text\/javascript\" src=\"..\/script-dir\/additional-script-2.js\"><\/script>\n+                    \"\"\");\n+    }\n+\n+    @Test\n+    public void testInvalidAdditionalScriptFile() {\n+        javadoc(\"-d\", \"out-invalid-additional-script\",\n+                \"--add-script\", new File(testSrc, \"additional-script-3.js\").getAbsolutePath(),\n+                \"-sourcepath\", testSrc,\n+                \"pkg\");\n+        checkExit(Exit.ERROR);\n+\n+        checkOutput(Output.OUT, true,\n+                \"error: File not found:\",\n+                \"additional-script-3.js\");\n+    }\n+\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testOptions\/TestOptions.java","additions":35,"deletions":2,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -0,0 +1,3 @@\n+\/\/ Additional script file 1\n+\n+console.log(\"hello world\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testOptions\/additional-script-1.js","additions":3,"deletions":0,"binary":false,"changes":3,"status":"added"},{"patch":"@@ -0,0 +1,3 @@\n+\/\/ Additional script file 2\n+\n+console.log(\"goodbye\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testOptions\/additional-script-2.js","additions":3,"deletions":0,"binary":false,"changes":3,"status":"added"},{"patch":"@@ -65,0 +65,1 @@\n+            \"--add-script\",\n","filename":"test\/langtools\/jdk\/javadoc\/tool\/CheckManPageOptions.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}