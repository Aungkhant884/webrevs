{"files":[{"patch":"@@ -304,1 +304,1 @@\n-    private Socket createConnectionSocket(String host, int port,  int connectTimeout)throws Exception {\n+    private Socket createConnectionSocket(String host, int port, int connectTimeout) throws Exception {\n@@ -306,2 +306,11 @@\n-        if (connectTimeout <= 0) {\n-            connectTimeout = 0; \/\/ the value of zero means never time out or network timed out\n+        Socket socket = null;\n+        if (connectTimeout > 0) {\n+\n+            InetSocketAddress endpoint = createInetSocketAddress(host, port);\n+            socket = new Socket();\n+\n+            socket.connect(endpoint, connectTimeout);\n+            if (debug) {\n+                System.err.println(\"Connection: creating socket with \" +\n+                        \"a timeout\");\n+            }\n@@ -309,5 +318,8 @@\n-        Socket socket = new Socket();\n-        socket.connect(createInetSocketAddress(host, port), connectTimeout);\n-        if (debug) {\n-            System.err.println(\"Connection.createSocket: creating socket with \" +\n-                    \"a timeout\");\n+\n+        \/\/ continue (but ignore connectTimeout)\n+        if (socket == null) {\n+            \/\/ connected socket\n+            socket = new Socket(host, port);\n+            if (debug) {\n+                System.err.println(\"Connection: creating socket\");\n+            }\n@@ -329,10 +341,22 @@\n-        if (connectTimeout <= 0) {\n-            connectTimeout = 0; \/\/ the value of zero means never time out or network timeout\n-        }\n-        \/\/ create unconnected socket\n-        socket = factory.createSocket();\n-        socket.connect(createInetSocketAddress(host, port), connectTimeout);\n-\n-        if (debug) {\n-            System.err.println(\"Connection.createSocket: creating socket with \" +\n-                    \"a timeout using supplied socket factory\");\n+        \/\/ create the socket\n+        if (connectTimeout > 0) {\n+            InetSocketAddress endpoint =\n+                    createInetSocketAddress(host, port);\n+            \/\/ unconnected socket\n+            socket = factory.createSocket();\n+            \/\/ connected socket\n+            socket.connect(endpoint, connectTimeout);\n+            if (debug) {\n+                System.err.println(\"Connection: creating socket with \" +\n+                        \"a timeout using supplied socket factory\");\n+            }\n+        } else {\n+            \/\/ continue (but ignore connectTimeout)\n+            if (socket == null) {\n+                \/\/ connected socket\n+                socket = factory.createSocket(host, port);\n+                if (debug) {\n+                    System.err.println(\"Connection: creating socket using \" +\n+                            \"supplied socket factory\");\n+                }\n+            }\n@@ -698,1 +722,1 @@\n-            if(socket != null && !socket.isClosed())\n+            if (socket != null && !socket.isClosed())\n","filename":"src\/java.naming\/share\/classes\/com\/sun\/jndi\/ldap\/Connection.java","additions":43,"deletions":19,"binary":false,"changes":62,"status":"modified"}]}