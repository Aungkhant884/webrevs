{"files":[{"patch":"@@ -285,6 +285,10 @@\n-            \/\/ create socket with or without socket factory\n-            socket = newCreateSocket (socketFactory);\n-\n-            \/\/ connect the socket with or without timeout\n-            connectSocket (socket, host, port, connectTimeout);\n-\n+            InetSocketAddress endpoint =\n+                    createInetSocketAddress(host, port);\n+\n+            if (socketFactory != null) {\n+                \/\/ create a connected socket with factory\n+                socket = createConnectionSocket(endpoint, socketFactory, connectTimeout);\n+            } else { \/\/ NO SocketFactory\n+                \/\/ create a connected socket without factory\n+                createConnectionSocket(endpoint, connectTimeout);\n+            }\n@@ -292,1 +296,1 @@\n-            initialSSLHandshake (socket, connectTimeout);\n+            initialSSLHandshake(socket, connectTimeout);\n@@ -296,1 +300,1 @@\n-            closeSocket (socket);\n+            closeSocket(socket);\n@@ -302,12 +306,4 @@\n-    \/\/ create the socket with or without factory\n-    private Socket newCreateSocket(String socketFactory) throws Exception {\n-\n-        Socket socket;\n-        if (socketFactory != null) {\n-            @SuppressWarnings(\"unchecked\")\n-            Class<? extends SocketFactory> socketFactoryClass = (Class<? extends SocketFactory>)\n-                    Obj.helper.loadClass(socketFactory);\n-            Method getDefault =\n-                    socketFactoryClass.getMethod(\"getDefault\", new Class<?>[]{});\n-            SocketFactory factory = (SocketFactory) getDefault.invoke(null, new Object[]{});\n-            socket = factory.createSocket();\n+    \/\/ create a connected socket without factory\n+    private Socket createConnectionSocket(InetSocketAddress endpoint,  int connectTimeout)throws Exception {\n+        Socket socket = new Socket();\n+        if (connectTimeout > 0) {\n@@ -315,1 +311,2 @@\n-                System.err.println(\"Socket Created by the Factory\");\n+                System.err.println(\"Connection.createSocket: creating socket with \" +\n+                        \"a timeout\");\n@@ -317,0 +314,1 @@\n+            socket.connect(endpoint, connectTimeout);\n@@ -318,1 +316,0 @@\n-            socket = new Socket();\n@@ -320,1 +317,1 @@\n-                System.err.println(\"New Socket Created\");\n+                System.err.println(\"Connection.createSocket: creating socket\");\n@@ -322,0 +319,1 @@\n+            socket.connect(endpoint);\n@@ -326,5 +324,9 @@\n-    \/\/ connect the socket with setting of timeout\n-    private void connectSocket( Socket socket, String host, int port, int connectTimeout)\n-            throws IOException {\n-        InetSocketAddress endpoint =\n-                createInetSocketAddress(host, port);\n+    \/\/ create a connected socket with factory\n+    private Socket createConnectionSocket(InetSocketAddress endpoint, String socketFactory,\n+                                          int connectTimeout) throws Exception {\n+        @SuppressWarnings(\"unchecked\")\n+        Class<? extends SocketFactory> socketFactoryClass =\n+                (Class<? extends SocketFactory>) Obj.helper.loadClass(socketFactory);\n+        Method getDefault =\n+                socketFactoryClass.getMethod(\"getDefault\", new Class<?>[]{});\n+        SocketFactory factory = (SocketFactory) getDefault.invoke(null, new Object[]{});\n@@ -332,9 +334,7 @@\n-        if (connectTimeout <= 0) {\n-            connectTimeout = 0;\n-        }\n-        socket.connect(endpoint, connectTimeout);\n-        if (debug) {\n-            if( connectTimeout > 0 ) {\n-                System.err.println(\"Socket connected with timeout \" + connectTimeout);\n-            } else {\n-                System.err.println(\"Socket connected without timeout \");\n+        \/\/ create unconnected socket\n+        Socket socket = factory.createSocket();\n+\n+        if (connectTimeout > 0) {\n+            if (debug) {\n+                System.err.println(\"Connection.createSocket: creating socket with \" +\n+                        \"a timeout using supplied socket factory\");\n@@ -342,0 +342,9 @@\n+            \/\/ connect socket\n+            socket.connect(endpoint, connectTimeout);\n+        } else {\n+            if (debug) {\n+                System.err.println(\"Connection.createSocket: creating socket using \" +\n+                        \"supplied socket factory\");\n+            }\n+            \/\/ connect socket\n+            socket.connect(endpoint);\n@@ -343,0 +352,1 @@\n+        return socket;\n","filename":"src\/java.naming\/share\/classes\/com\/sun\/jndi\/ldap\/Connection.java","additions":47,"deletions":37,"binary":false,"changes":84,"status":"modified"}]}