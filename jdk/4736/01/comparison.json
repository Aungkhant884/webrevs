{"files":[{"patch":"@@ -349,1 +349,1 @@\n-void DynamicArchive::prepare_for_dynamic_dumping_at_exit() {\n+void DynamicArchive::prepare_for_dynamic_dumping() {\n@@ -352,1 +352,1 @@\n-  MetaspaceShared::link_and_cleanup_shared_classes(THREAD);\n+  MetaspaceShared::link_shared_classes(THREAD);\n@@ -354,1 +354,1 @@\n-    log_error(cds)(\"ArchiveClassesAtExit has failed\");\n+    log_error(cds)(\"Dynamic dump has failed\");\n@@ -368,1 +368,4 @@\n-    dump(CHECK);\n+    prepare_for_dynamic_dumping();\n+    if (DynamicDumpSharedSpaces) {\n+      dump(CHECK);\n+    }\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-  static void prepare_for_dynamic_dumping_at_exit();\n+  static void prepare_for_dynamic_dumping();\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -595,1 +595,1 @@\n-void MetaspaceShared::link_and_cleanup_shared_classes(TRAPS) {\n+void MetaspaceShared::link_shared_classes(TRAPS) {\n@@ -729,1 +729,1 @@\n-  link_and_cleanup_shared_classes(CHECK);\n+  link_shared_classes(CHECK);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -132,1 +132,1 @@\n-  static void link_and_cleanup_shared_classes(TRAPS) NOT_CDS_RETURN;\n+  static void link_shared_classes(TRAPS) NOT_CDS_RETURN;\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -427,1 +427,1 @@\n-    DynamicArchive::prepare_for_dynamic_dumping_at_exit();\n+    DynamicArchive::prepare_for_dynamic_dumping();\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3261,1 +3261,1 @@\n-  \/\/ it will cause MetaspaceShared::link_and_cleanup_shared_classes to\n+  \/\/ it will cause MetaspaceShared::link_shared_classes to\n@@ -3272,1 +3272,1 @@\n-    DynamicArchive::prepare_for_dynamic_dumping_at_exit();\n+    DynamicArchive::prepare_for_dynamic_dumping();\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -56,1 +56,1 @@\n-                 output.shouldContain(\"ArchiveClassesAtExit has failed\")\n+                 output.shouldContain(\"Dynamic dump has failed\")\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/TestDynamicDumpAtOom.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}