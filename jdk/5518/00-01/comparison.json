{"files":[{"patch":"@@ -231,0 +231,3 @@\n+  MetaWord* p = NULL;\n+  const size_t raw_word_size = get_raw_word_size_for_requested_word_size(requested_word_size);\n+\n@@ -233,2 +236,1 @@\n-    size_t raw_word_size = get_raw_word_size_for_requested_word_size(requested_word_size);\n-    MetaWord* p = _fbl->remove_block(raw_word_size);\n+    p = _fbl->remove_block(raw_word_size);\n@@ -239,3 +241,3 @@\n-      \/\/ Note: Space which is kept in the freeblock dictionary still counts as used as far\n-      \/\/  as statistics go; therefore we skip the epilogue in this function to avoid double\n-      \/\/  accounting.\n+      \/\/ Note: free blocks in freeblock dictionary still count as \"used\" as far as statistics go;\n+      \/\/ therefore we have no need to adjust any usage counters (see epilogue of allocate_inner())\n+      \/\/ and can just return here.\n@@ -247,1 +249,1 @@\n-  MetaWord* p = allocate_inner(requested_word_size);\n+  p = allocate_inner(requested_word_size);\n@@ -255,4 +257,5 @@\n-      \/\/ For now, we just ignore allocation errors for the fence to keep things simple.\n-      \/\/ We may miss adding a fence, but that is not such a big deal, esp. since this\n-      \/\/ should be rare (chances are much higher we would have failed the primary\n-      \/\/ allocation too).\n+      \/\/ Ignore allocation errors for the fence to keep coding simple. If this\n+      \/\/ happens (e.g. because right at this time we hit the Metaspace GC threshold)\n+      \/\/ we miss adding this one fence. Not a big deal. Note that his would\n+      \/\/ be pretty rare. Chances are much higher the primary allocation above\n+      \/\/ would have already failed).\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceArena.cpp","additions":13,"deletions":10,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -113,1 +113,3 @@\n-  \/\/  the preceding or the following block.\n+  \/\/  the preceding or the following user block. All fences are linked together;\n+  \/\/  validating the fences just means walking that linked list.\n+  \/\/ Note that for the Arena, fence blocks are just another form of user blocks.\n@@ -117,0 +119,1 @@\n+    \/\/ Two eyecatchers to easily spot a corrupted _next pointer\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceArena.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"}]}