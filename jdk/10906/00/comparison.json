{"files":[{"patch":"@@ -152,2 +152,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -159,2 +158,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/AuthorityInfoAccessExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -221,2 +221,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -228,2 +227,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/AuthorityKeyIdentifierExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -193,2 +193,1 @@\n-     public void encode(OutputStream out) throws IOException {\n-         DerOutputStream tmp = new DerOutputStream();\n+     public void encode(DerOutputStream out) throws IOException {\n@@ -200,3 +199,1 @@\n-         super.encode(tmp);\n-\n-         out.write(tmp.toByteArray());\n+         super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/BasicConstraintsExtension.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -202,1 +202,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -210,2 +210,2 @@\n-    protected void encode(OutputStream out, ObjectIdentifier extensionId,\n-        boolean isCritical) throws IOException {\n+    protected void encode(DerOutputStream out, ObjectIdentifier extensionId,\n+            boolean isCritical) throws IOException {\n@@ -213,1 +213,0 @@\n-        DerOutputStream tmp = new DerOutputStream();\n@@ -219,2 +218,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CRLDistributionPointsExtension.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -148,10 +148,2 @@\n-            Collection<Extension> allExts = map.values();\n-            Object[] objs = allExts.toArray();\n-\n-            for (int i = 0; i < objs.length; i++) {\n-                if (objs[i] instanceof CertAttrSet)\n-                    ((CertAttrSet)objs[i]).encode(extOut);\n-                else if (objs[i] instanceof Extension)\n-                    ((Extension)objs[i]).encode(extOut);\n-                else\n-                    throw new CRLException(\"Illegal extension object\");\n+            for (Extension ext : map.values()) {\n+                ext.encode(extOut);\n@@ -171,1 +163,1 @@\n-        } catch (IOException | CertificateException e) {\n+        } catch (IOException e) {\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CRLExtensions.java","additions":3,"deletions":11,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -201,1 +201,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -209,4 +209,2 @@\n-    protected void encode(OutputStream out, ObjectIdentifier extensionId,\n-        boolean isCritical) throws IOException {\n-\n-       DerOutputStream  tmp = new DerOutputStream();\n+    protected void encode(DerOutputStream out, ObjectIdentifier extensionId,\n+            boolean isCritical) throws IOException {\n@@ -219,2 +217,1 @@\n-       super.encode(tmp);\n-       out.write(tmp.toByteArray());\n+       super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CRLNumberExtension.java","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -161,3 +161,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream  tmp = new DerOutputStream();\n-\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -169,2 +167,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CRLReasonCodeExtension.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+import sun.security.util.DerOutputStream;\n+\n@@ -29,1 +31,0 @@\n-import java.io.OutputStream;\n@@ -66,1 +67,1 @@\n-    void encode(OutputStream out)\n+    void encode(DerOutputStream out)\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertAttrSet.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -108,5 +108,2 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n-        algId.encode(tmp);\n-\n-        out.write(tmp.toByteArray());\n+    public void encode(DerOutputStream out) throws IOException {\n+        algId.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateAlgorithmId.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -151,2 +151,2 @@\n-    public void encode(OutputStream out)\n-    throws CertificateException, IOException {\n+    public void encode(DerOutputStream out)\n+            throws CertificateException, IOException {\n@@ -164,1 +164,1 @@\n-    public void encode(OutputStream out, boolean isCertReq)\n+    public void encode(DerOutputStream out, boolean isCertReq)\n@@ -167,10 +167,2 @@\n-        Collection<Extension> allExts = map.values();\n-        Object[] objs = allExts.toArray();\n-\n-        for (int i = 0; i < objs.length; i++) {\n-            if (objs[i] instanceof CertAttrSet)\n-                ((CertAttrSet)objs[i]).encode(extOut);\n-            else if (objs[i] instanceof Extension)\n-                ((Extension)objs[i]).encode(extOut);\n-            else\n-                throw new CertificateException(\"Illegal extension object\");\n+        for (Extension ext : map.values()) {\n+            ext.encode(extOut);\n@@ -179,4 +171,0 @@\n-        DerOutputStream seq = new DerOutputStream();\n-        seq.write(DerValue.tag_Sequence, extOut);\n-\n-        DerOutputStream tmp;\n@@ -184,2 +172,3 @@\n-            tmp = new DerOutputStream();\n-            tmp.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)3),\n+            DerOutputStream seq = new DerOutputStream();\n+            seq.write(DerValue.tag_Sequence, extOut);\n+            out.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)3),\n@@ -187,4 +176,3 @@\n-        } else\n-            tmp = seq; \/\/ pkcs#10 certificateRequest\n-\n-        out.write(tmp.toByteArray());\n+        } else {\n+            out.write(DerValue.tag_Sequence, extOut);\n+        }\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateExtensions.java","additions":11,"deletions":23,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -182,2 +182,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream  tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -189,2 +188,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateIssuerExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -110,5 +110,2 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n-        dnName.encode(tmp);\n-\n-        out.write(tmp.toByteArray());\n+    public void encode(DerOutputStream out) throws IOException {\n+        dnName.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateIssuerName.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -180,2 +180,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -187,2 +186,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificatePoliciesExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -120,5 +120,2 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n-        serial.encode(tmp);\n-\n-        out.write(tmp.toByteArray());\n+    public void encode(DerOutputStream out) throws IOException {\n+        serial.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateSerialNumber.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -110,5 +110,2 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n-        dnName.encode(tmp);\n-\n-        out.write(tmp.toByteArray());\n+    public void encode(DerOutputStream out) throws IOException {\n+        dnName.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateSubjectName.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -150,1 +150,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -170,4 +170,1 @@\n-        DerOutputStream seq = new DerOutputStream();\n-        seq.write(DerValue.tag_Sequence, pair);\n-\n-        out.write(seq.toByteArray());\n+        out.write(DerValue.tag_Sequence, pair);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateValidity.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -161,1 +161,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -169,2 +169,1 @@\n-        DerOutputStream seq = new DerOutputStream();\n-        seq.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0),\n+        out.write(DerValue.createTag(DerValue.TAG_CONTEXT, true, (byte)0),\n@@ -172,2 +171,0 @@\n-\n-        out.write(seq.toByteArray());\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateVersion.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -103,5 +103,2 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n-        tmp.write(key.getEncoded());\n-\n-        out.write(tmp.toByteArray());\n+    public void encode(DerOutputStream out) throws IOException {\n+        out.write(key.getEncoded());\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/CertificateX509Key.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+import sun.security.util.DerOutputStream;\n+\n@@ -109,1 +111,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public void encode(DerOutputStream out) throws IOException {\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/DeltaCRLIndicatorExtension.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -201,2 +201,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -208,2 +207,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/ExtendedKeyUsageExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -143,1 +143,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public final void encode(OutputStream out) throws IOException {\n@@ -147,7 +147,6 @@\n-\n-        DerOutputStream dos1 = new DerOutputStream();\n-        DerOutputStream dos2 = new DerOutputStream();\n-\n-        dos1.putOID(extensionId);\n-        if (critical) {\n-            dos1.putBoolean(true);\n+        if (out instanceof DerOutputStream dos) {\n+            encode(dos);\n+        } else {\n+            DerOutputStream dos = new DerOutputStream();\n+            encode(dos);\n+            out.write(dos.toByteArray());\n@@ -155,4 +154,0 @@\n-        dos1.putOctetString(extensionValue);\n-\n-        dos2.write(DerValue.tag_Sequence, dos1);\n-        out.write(dos2.toByteArray());\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/Extension.java","additions":7,"deletions":12,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+import sun.security.util.DerOutputStream;\n+\n@@ -92,1 +94,1 @@\n-    public void encode(OutputStream out) throws IOException {\n+    public void encode(DerOutputStream out) throws IOException {\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/FreshestCRLExtension.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -162,2 +162,1 @@\n-     public void encode(OutputStream out) throws IOException {\n-         DerOutputStream tmp = new DerOutputStream();\n+     public void encode(DerOutputStream out) throws IOException {\n@@ -169,3 +168,1 @@\n-         super.encode(tmp);\n-\n-         out.write(tmp.toByteArray());\n+         super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/InhibitAnyPolicyExtension.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -180,3 +180,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream  tmp = new DerOutputStream();\n-\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -188,2 +186,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/InvalidityDateExtension.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -165,2 +165,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -172,2 +171,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/IssuerAlternativeNameExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -237,2 +237,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -244,2 +243,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/IssuingDistributionPointExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -321,3 +321,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-       DerOutputStream  tmp = new DerOutputStream();\n-\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -329,2 +327,1 @@\n-       super.encode(tmp);\n-       out.write(tmp.toByteArray());\n+       super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/KeyUsageExtension.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -239,2 +239,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -246,2 +245,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/NameConstraintsExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -267,3 +267,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream  tmp = new DerOutputStream();\n-\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -275,2 +273,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/NetscapeCertTypeExtension.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -204,2 +204,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -211,2 +210,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/PolicyConstraintsExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -151,2 +151,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -158,2 +157,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/PolicyMappingsExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -243,2 +243,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -250,2 +249,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/PrivateKeyUsageExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -167,2 +167,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -174,2 +173,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/SubjectAlternativeNameExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -157,2 +157,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -164,2 +163,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/SubjectInfoAccessExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -128,2 +128,1 @@\n-    public void encode(OutputStream out) throws IOException {\n-        DerOutputStream tmp = new DerOutputStream();\n+    public void encode(DerOutputStream out) throws IOException {\n@@ -135,2 +134,1 @@\n-        super.encode(tmp);\n-        out.write(tmp.toByteArray());\n+        super.encode(out);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/SubjectKeyIdentifierExtension.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -182,2 +182,2 @@\n-    public void encode(OutputStream out)\n-    throws CertificateException, IOException {\n+    public void encode(DerOutputStream out)\n+            throws CertificateException, IOException {\n@@ -185,3 +185,4 @@\n-            DerOutputStream tmp = new DerOutputStream();\n-            emit(tmp);\n-            rawCertInfo = tmp.toByteArray();\n+            emit(out);\n+            rawCertInfo = out.toByteArray();\n+        } else {\n+            out.write(rawCertInfo.clone());\n@@ -189,1 +190,0 @@\n-        out.write(rawCertInfo.clone());\n","filename":"src\/java.base\/share\/classes\/sun\/security\/x509\/X509CertInfo.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"}]}