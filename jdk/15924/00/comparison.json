{"files":[{"patch":"@@ -155,1 +155,0 @@\n-vmTestbase\/nsk\/jvmti\/scenarios\/jni_interception\/JI05\/ji05t001\/TestDescription.java 8219652 aix-ppc64\n","filename":"test\/hotspot\/jtreg\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -32,0 +32,2 @@\n+#define STACK_SIZE 1024*1024\n+\n@@ -83,1 +85,4 @@\n-  if ((res = pthread_create(&thread, NULL, thread_start, NULL)) != 0) {\n+  pthread_attr_t attr;\n+  pthread_attr_init(&attr);\n+  pthread_attr_setstacksize(&attr, STACK_SIZE);\n+  if ((res = pthread_create(&thread, &attr, thread_start, NULL)) != 0) {\n@@ -88,0 +93,2 @@\n+  pthread_attr_destroy(&attr);\n+\n","filename":"test\/hotspot\/jtreg\/runtime\/jni\/terminatedThread\/libterminatedThread.c","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+#define STACK_SIZE 1024*1024\n@@ -216,1 +217,1 @@\n-static int waitingThread(void *context) {\n+static void *waitingThread1(void *context) {\n@@ -230,1 +231,1 @@\n-        return STATUS_FAILED;\n+        exit(STATUS_FAILED);\n@@ -241,1 +242,1 @@\n-        return STATUS_FAILED;\n+         exit(STATUS_FAILED);\n@@ -246,1 +247,18 @@\n-    return exitCode;\n+    return 0;\n+}\n+\n+static int waitingThread(void *context) {\n+   pthread_t id;\n+   int result;\n+   pthread_attr_t attr;\n+   pthread_attr_init(&attr);\n+   pthread_attr_setstacksize(&attr, STACK_SIZE);\n+   if ((result = pthread_create(&id, &attr, waitingThread1, NULL)) != 0) {\n+      fprintf(stderr, \"Error: waitingThread failed with error code %d \\n\", result);\n+      exit(-1);\n+   }\n+   if ((result = pthread_join(id, NULL)) != 0) {\n+      fprintf(stderr, \"Failed to join thread %d \\n\", result);\n+      exit(-1);\n+   }\n+   return 0;\n@@ -322,0 +340,29 @@\n+static void *run(void *unused){\n+    JNIEnv *nextEnv = NULL;\n+    int res = vm->AttachCurrentThread((void **) &nextEnv, (void *) 0);\n+    if (res != 0) {\n+       printf(\"(%s,%d): TEST FAILURE: waitingThread: AttachCurrentThread() returns: %d\\n\",\n+             __FILE__, __LINE__, res);\n+       exit(STATUS_FAILED);\n+    }\n+    return 0;\n+}\n+\n+static int attachCurrentThread(){\n+   pthread_t id;\n+   int result;\n+   pthread_attr_t attr;\n+   pthread_attr_init(&attr);\n+   pthread_attr_setstacksize(&attr, STACK_SIZE);\n+   if ((result = pthread_create(&id, &attr, run, NULL)) != 0) {\n+      fprintf(stderr, \"Error: pthread_create failed with error code %d \\n\", result);\n+      exit(-1);\n+   }\n+   pthread_attr_destroy(&attr);\n+   if ((result = pthread_join(id, NULL)) != 0) {\n+      fprintf(stderr, \"Failed to join thread %d \\n\", result);\n+      exit(-1);\n+   }\n+   return 0;\n+}\n+\n@@ -369,6 +416,1 @@\n-        res = vm->AttachCurrentThread((void **) &nextEnv, (void *) 0);\n-        if (res != 0) {\n-            printf(\"(%s,%d): TEST FAILURE: waitingThread: AttachCurrentThread() returns: %d\\n\",\n-                __FILE__, __LINE__, res);\n-            return STATUS_FAILED;\n-        }\n+        attachCurrentThread();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/SetJNIFunctionTable\/setjniftab001\/setjniftab001.cpp","additions":52,"deletions":10,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -44,1 +44,1 @@\n-\n+#define STACK_SIZE 1024*1024\n@@ -251,1 +251,0 @@\n-\n@@ -253,1 +252,1 @@\n-static int agentA(void *context) {\n+static void  *agentA_1(void *context) {\n@@ -315,1 +314,1 @@\n-    return exitCode;\n+    return 0;\n@@ -317,2 +316,19 @@\n-\n-static int agentB(void *context) {\n+static int agentA(void *context){\n+    size_t adjusted_stack_size = 1024*1024;\n+    pthread_t id;\n+    int result;\n+    pthread_attr_t attr;\n+    pthread_attr_init(&attr);\n+    pthread_attr_setstacksize(&attr, adjusted_stack_size);\n+    if ((result = pthread_create(&id, &attr, agentA_1, NULL)) != 0) {\n+      fprintf(stderr, \"Error: agentA thread failed with error code %d \\n\", result);\n+       exit(-1);\n+    }\n+    pthread_attr_destroy(&attr);\n+    if ((result = pthread_join(id, NULL)) != 0) {\n+       fprintf(stderr, \"Error : failed to join thread %d \\n\", result);\n+       exit(-1);\n+    }\n+    return 0;\n+ }\n+static  void  *agentB_1(void *context) {\n@@ -379,1 +395,1 @@\n-    return exitCode;\n+    return 0;\n@@ -381,0 +397,20 @@\n+\n+static int agentB(void* unused){\n+   size_t adjusted_stack_size = 1024*1024;\n+   pthread_t id;\n+   int result;\n+   pthread_attr_t attr;\n+   pthread_attr_init(&attr);\n+   pthread_attr_setstacksize(&attr, adjusted_stack_size);\n+   if ((result = pthread_create(&id, &attr, agentB_1, NULL)) != 0) {\n+     fprintf(stderr, \"Error: agentB thread failed with error code %d \\n\", result);\n+     exit(-1);\n+   }\n+   pthread_attr_destroy(&attr);\n+   if ((result = pthread_join(id, NULL)) != 0) {\n+     fprintf(stderr, \"Error : failed to join thread %d \\n\", result);\n+     exit(-1);\n+   }\n+   return 0;\n+}\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/scenarios\/jni_interception\/JI05\/ji05t001\/ji05t001.cpp","additions":43,"deletions":7,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -39,2 +39,1 @@\n-#define PASSED  0\n-#define STATUS_FAILED  2\n+#define PASSED 0\n@@ -44,0 +43,1 @@\n+#define STACK_SIZE 1024*1024\n@@ -49,3 +49,1 @@\n-      if (res != 0) \\\n-          NSK_COMPLAIN1(\"TEST WARNING: DetachCurrentThread() returns: %d\\n\", res); \\\n-      else \\\n+      if (res == 0) \\\n@@ -53,3 +51,3 @@\n-      return status; \\\n-  } while (0)\n-\n+          return 0; \\\n+      exit(-1); \\\n+  } while(0)\n@@ -61,0 +59,1 @@\n+static int STATUS_FAILED = 2;\n@@ -191,1 +190,1 @@\n-static int waitingThread(void *context) {\n+static void *waitingThread1(void *context) {\n@@ -207,1 +206,1 @@\n-        return STATUS_FAILED;\n+        exit(STATUS_FAILED);\n@@ -228,1 +227,19 @@\n-static int ownerThread(void *context) {\n+static int waitingThread(void *unused){\n+    pthread_t id;\n+    int result;\n+    pthread_attr_t attr;\n+    pthread_attr_init(&attr);\n+    pthread_attr_setstacksize(&attr, STACK_SIZE);\n+    if ((result = pthread_create(&id, &attr, waitingThread1, NULL)) != 0) {\n+     fprintf(stderr, \"Error: waitingThread failed with error code %d \\n\", result);\n+     exit( -1);\n+   }\n+   pthread_attr_destroy(&attr);\n+   if ((result = pthread_join(id, NULL)) != 0) {\n+     fprintf(stderr, \"Failed to join thread %d \\n\", result);\n+     exit(-1);\n+   }\n+   return 0;\n+}\n+\n+static void *ownerThread1(void *context) {\n@@ -239,1 +256,1 @@\n-        return STATUS_FAILED;\n+        exit(STATUS_FAILED);\n@@ -270,1 +287,20 @@\n-static int redirectorThread(void *context) {\n+static int ownerThread(void *unused){\n+    pthread_t id;\n+    int result;\n+    pthread_attr_t attr;\n+    pthread_attr_init(&attr);\n+    pthread_attr_setstacksize(&attr, STACK_SIZE);\n+    if ((result = pthread_create(&id, &attr, ownerThread1, NULL)) != 0) {\n+        fprintf(stderr, \"Error: ownerThread failed with error code %d \\n\", result);\n+        exit(-1);\n+    }\n+    pthread_attr_destroy(&attr);\n+    if ((result = pthread_join(id, NULL)) != 0){\n+        fprintf(stderr, \"Failed to join thread %d \\n\", result);\n+        exit(-1);\n+    }\n+\n+    return 0;\n+}\n+\n+static void *redirectorThread1(void *context) {\n@@ -281,1 +317,1 @@\n-        return STATUS_FAILED;\n+        exit(STATUS_FAILED);\n@@ -292,0 +328,18 @@\n+\n+static int redirectorThread(void *context) {\n+    pthread_t id;\n+    int result;\n+    pthread_attr_t attr;\n+    pthread_attr_init(&attr);\n+    pthread_attr_setstacksize(&attr, STACK_SIZE);\n+    if ((result = pthread_create(&id, &attr, redirectorThread1, NULL)) != 0) {\n+        fprintf(stderr, \"Error: redirectorThread failed with error code %d \\n\", result);\n+        exit(-1);\n+    }\n+    pthread_attr_destroy(&attr);\n+    if ((result = pthread_join(id, NULL)) != 0){\n+        fprintf(stderr, \"Failed to join thread %d \\n\", result);\n+        exit(-1);\n+    }\n+    return 0;\n+}\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/scenarios\/jni_interception\/JI06\/ji06t001\/ji06t001.cpp","additions":68,"deletions":14,"binary":false,"changes":82,"status":"modified"}]}