{"files":[{"patch":"@@ -1642,6 +1642,1 @@\n-  if (length_in_bytes != MaxVectorSize) {\n-    mv(t0, length_in_bytes \/ type2aelembytes(is_double ? T_DOUBLE : T_FLOAT));\n-    vsetvli(t0, t0, is_double ? Assembler::e64 : Assembler::e32);\n-  } else {\n-    vsetvli(t0, x0, is_double ? Assembler::e64 : Assembler::e32);\n-  }\n+  rvv_vsetvli(is_double ? T_DOUBLE : T_FLOAT, length_in_bytes);\n@@ -1683,7 +1678,1 @@\n-  Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n-  if (length_in_bytes != MaxVectorSize) {\n-    mv(t0, length_in_bytes \/ type2aelembytes(bt));\n-    vsetvli(t0, t0, sew);\n-  } else {\n-    vsetvli(t0, x0, sew);\n-  }\n+  rvv_vsetvli(bt, length_in_bytes);\n@@ -1719,0 +1708,10 @@\n+\n+void C2_MacroAssembler::rvv_vsetvli(BasicType bt, int length_in_bytes) {\n+  Assembler::SEW sew = Assembler::elemtype_to_sew(bt);\n+  if (length_in_bytes != MaxVectorSize) {\n+    mv(t0, length_in_bytes \/ type2aelembytes(bt));\n+    vsetvli(t0, t0, sew);\n+  } else {\n+    vsetvli(t0, x0, sew);\n+  }\n+}\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":12,"deletions":13,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -199,0 +199,2 @@\n+ void rvv_vsetvli(BasicType bt, int length_in_bytes);\n+\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,6 +40,1 @@\n-    if (length_in_bytes != MaxVectorSize) {\n-      masm.mv(t0, length_in_bytes \/ type2aelembytes(bt));\n-      masm.vsetvli(t0, t0, sew);\n-    } else {\n-      masm.vsetvli(t0, x0, sew);\n-    }\n+    masm.rvv_vsetvli(bt, length_in_bytes);\n@@ -976,7 +971,1 @@\n-    int length_in_bytes = Matcher::vector_length_in_bytes(this, $src2);\n-    if (length_in_bytes != MaxVectorSize) {\n-      __ mv(t0, length_in_bytes \/ type2aelembytes(T_FLOAT));\n-      __ vsetvli(t0, t0, Assembler::e32);\n-    } else {\n-      __ vsetvli(t0, x0, Assembler::e32);\n-    }\n+    __ rvv_vsetvli(T_FLOAT, Matcher::vector_length_in_bytes(this, $src2));\n@@ -999,7 +988,1 @@\n-    int length_in_bytes = Matcher::vector_length_in_bytes(this, $src2);\n-    if (length_in_bytes != MaxVectorSize) {\n-      __ mv(t0, length_in_bytes \/ type2aelembytes(T_DOUBLE));\n-      __ vsetvli(t0, t0, Assembler::e64);\n-    } else {\n-      __ vsetvli(t0, x0, Assembler::e64);\n-    }\n+    __ rvv_vsetvli(T_DOUBLE, Matcher::vector_length_in_bytes(this, $src2));\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":3,"deletions":20,"binary":false,"changes":23,"status":"modified"}]}