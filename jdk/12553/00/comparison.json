{"files":[{"patch":"@@ -1925,1 +1925,6 @@\n-    return MaxVectorSize;\n+    int size = MaxVectorSize;\n+    \/\/ Minimum 2 values in vector\n+    if (size < 2 * type2aelembytes(bt)) size = 0;\n+    \/\/ But never < 4\n+    if (size < 4) size = 0;\n+    return size;\n@@ -1935,1 +1940,12 @@\n-  return max_vector_size(bt);\n+  int max_size = max_vector_size(bt);\n+  \/\/ Limit the min vector size to 8 bytes.\n+  int size = 8 \/ type2aelembytes(bt);\n+  if (bt == T_BYTE) {\n+    \/\/ To support vector api shuffle\/rearrange.\n+    size = 4;\n+  } else if (bt == T_BOOLEAN) {\n+    \/\/ To support vector api load\/store mask.\n+    size = 2;\n+  }\n+  if (size < 2) size = 2;\n+  return MIN2(size, max_size);\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":18,"deletions":2,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-                        VectorRegister reg, BasicType bt, Register base) {\n+                        VectorRegister reg, BasicType bt, Register base, int length_in_bytes) {\n@@ -40,1 +40,7 @@\n-    masm.vsetvli(t0, x0, sew);\n+    if (length_in_bytes != MaxVectorSize) {\n+      masm.mv(t0, length_in_bytes \/ type2aelembytes(bt));\n+      masm.vsetvli(t0, t0, sew);\n+    } else {\n+      masm.vsetvli(t0, x0, sew);\n+    }\n+\n@@ -104,1 +110,1 @@\n-  format %{ \"vle $dst, $mem\\t#@loadV\" %}\n+  format %{ \"loadV $dst, $mem\\t# vector (rvv)\" %}\n@@ -108,1 +114,1 @@\n-              Matcher::vector_element_basic_type(this), as_Register($mem$$base));\n+              Matcher::vector_element_basic_type(this), as_Register($mem$$base), Matcher::vector_length_in_bytes(this));\n@@ -116,1 +122,1 @@\n-  format %{ \"vse $src, $mem\\t#@storeV\" %}\n+  format %{ \"storeV $mem, $src\\t# vector (rvv)\" %}\n@@ -120,1 +126,1 @@\n-              Matcher::vector_element_basic_type(this, $src), as_Register($mem$$base));\n+              Matcher::vector_element_basic_type(this, $src), as_Register($mem$$base), Matcher::vector_length_in_bytes(this, $src));\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"}]}