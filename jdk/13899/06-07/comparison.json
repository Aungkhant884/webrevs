{"files":[{"patch":"@@ -266,1 +266,1 @@\n-\/\/ For statically linked agents we cant't rely on os_lib == nullptr because\n+\/\/ For statically linked agents we can't rely on os_lib == nullptr because\n@@ -268,1 +268,1 @@\n-\/\/ If this function returns true, then agent->is_static_lib().&& agent->is_loaded().\n+\/\/ If this function returns true, then agent->is_static_lib() && agent->is_loaded().\n@@ -497,1 +497,4 @@\n-  if (!load_agent_from_executable(agent, &on_attach_symbols[0], num_symbol_entries)) {\n+  bool previously_loaded;\n+  if (load_agent_from_executable(agent, &on_attach_symbols[0], num_symbol_entries)) {\n+    previously_loaded = JvmtiAgentList::is_static_lib_loaded(agent->name());\n+  } else {\n@@ -509,0 +512,1 @@\n+    previously_loaded = JvmtiAgentList::is_dynamic_lib_loaded(library);\n@@ -511,2 +515,2 @@\n-  \/\/ Print warning if EnableDynamicAgentLoading not enabled on the command line\n-  if (!FLAG_IS_CMDLINE(EnableDynamicAgentLoading) && !agent->is_instrument_lib() && !JvmtiAgentList::is_loaded(library)) {\n+  \/\/ Print warning if agent was not previously loaded and EnableDynamicAgentLoading not enabled on the command line.\n+  if (!previously_loaded && !FLAG_IS_CMDLINE(EnableDynamicAgentLoading) && !agent->is_instrument_lib()) {\n@@ -514,1 +518,1 @@\n-      \"WARNING: A JVM TI agent has been dynamically loaded (%s)\\n\"\n+      \"WARNING: A JVM TI agent has been loaded dynamically (%s)\\n\"\n","filename":"src\/hotspot\/share\/prims\/jvmtiAgent.cpp","additions":10,"deletions":6,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -223,2 +223,2 @@\n-\/\/ Return true if a library is a loaded agent library\n-bool JvmtiAgentList::is_loaded(void* os_lib) {\n+\/\/ Return true if a statically linked agent is on the list\n+bool JvmtiAgentList::is_static_lib_loaded(const char* name) {\n@@ -228,5 +228,13 @@\n-    if (os_lib == nullptr) {\n-      if (agent->is_static_lib() && agent->is_loaded()) {\n-        return true;\n-      }\n-    } else if (agent->os_lib() == os_lib) {\n+    if (agent->is_static_lib() && strcmp(agent->name(), name) == 0) {\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n+\n+\/\/ Return true if a agent library on the list\n+bool JvmtiAgentList::is_dynamic_lib_loaded(void* os_lib) {\n+  JvmtiAgentList::Iterator it = JvmtiAgentList::agents();\n+  while (it.has_next()) {\n+    JvmtiAgent* const agent = it.next();\n+    if (!agent->is_static_lib() && agent->os_lib() == os_lib) {\n","filename":"src\/hotspot\/share\/prims\/jvmtiAgentList.cpp","additions":15,"deletions":7,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -78,1 +78,3 @@\n-  static bool is_loaded(void* os_lib);\n+\n+  static bool is_static_lib_loaded(const char* name);\n+  static bool is_dynamic_lib_loaded(void* os_lib);\n","filename":"src\/hotspot\/share\/prims\/jvmtiAgentList.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -66,2 +66,2 @@\n-    private static final String JVMTI_AGENT_WARNING = \"WARNING: A JVM TI agent has been dynamically loaded\";\n-    private static final String JAVA_AGENT_WARNING = \"WARNING: A Java agent has been loaded dynamically\";\n+    private static final String JVMTI_AGENT_WARNING = \"WARNING: A JVM TI agent has been loaded dynamically\";\n+    private static final String JAVA_AGENT_WARNING  = \"WARNING: A Java agent has been loaded dynamically\";\n","filename":"test\/jdk\/com\/sun\/tools\/attach\/warnings\/DynamicLoadWarningTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}