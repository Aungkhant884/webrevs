{"files":[{"patch":"@@ -967,0 +967,5 @@\n+    disallowAlg http:\/\/www.w3.org\/2000\/09\/xmldsig#sha1,\\\n+    disallowAlg http:\/\/www.w3.org\/2000\/09\/xmldsig#dsa-sha1,\\\n+    disallowAlg http:\/\/www.w3.org\/2000\/09\/xmldsig#rsa-sha1,\\\n+    disallowAlg http:\/\/www.w3.org\/2007\/05\/xmldsig-more#sha1-rsa-MGF1,\\\n+    disallowAlg http:\/\/www.w3.org\/2001\/04\/xmldsig-more#ecdsa-sha1,\\\n","filename":"src\/java.base\/share\/conf\/security\/java.security","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+ * @library \/test\/lib\n@@ -94,0 +95,2 @@\n+import jdk.test.lib.security.SecurityUtils;\n+\n@@ -287,0 +290,3 @@\n+        \/\/ Re-enable sha1 algs\n+        SecurityUtils.removeAlgsFromDSigPolicy(List.of(\"sha1\"));\n+\n","filename":"test\/jdk\/javax\/xml\/crypto\/dsig\/GenerationTests.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8151893\n+ * @bug 8151893 8259709\n@@ -45,1 +45,6 @@\n-            \"http:\/\/www.w3.org\/2001\/04\/xmldsig-more#md5\");\n+            \"http:\/\/www.w3.org\/2001\/04\/xmldsig-more#md5\",\n+            \"http:\/\/www.w3.org\/2000\/09\/xmldsig#sha1\",\n+            \"http:\/\/www.w3.org\/2000\/09\/xmldsig#dsa-sha1\",\n+            \"http:\/\/www.w3.org\/2000\/09\/xmldsig#rsa-sha1\",\n+            \"http:\/\/www.w3.org\/2007\/05\/xmldsig-more#sha1-rsa-MGF1\",\n+            \"http:\/\/www.w3.org\/2001\/04\/xmldsig-more#ecdsa-sha1\");\n","filename":"test\/jdk\/javax\/xml\/crypto\/dsig\/SecureValidationPolicy.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,1 @@\n+ * @library \/test\/lib\n@@ -39,0 +40,1 @@\n+import java.util.List;\n@@ -50,0 +52,2 @@\n+import jdk.test.lib.security.SecurityUtils;\n+\n@@ -141,0 +145,3 @@\n+        \/\/ Re-enable sha1 algs\n+        SecurityUtils.removeAlgsFromDSigPolicy(List.of(\"sha1\"));\n+\n","filename":"test\/jdk\/javax\/xml\/crypto\/dsig\/ValidationTests.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,0 +73,27 @@\n+    \/**\n+     * Removes the specified algorithms from the\n+     * jdk.xml.dsig.secureValidationPolicy security property. Matches any\n+     * part of the algorithm URI.\n+     *\/\n+    public static void removeAlgsFromDSigPolicy(List<String> algs) {\n+        removeFromDSigPolicy(\"disallowAlg\", algs);\n+    }\n+\n+    private static void removeFromDSigPolicy(String rule, List<String> algs) {\n+        String value = Security.getProperty(\"jdk.xml.dsig.secureValidationPolicy\");\n+        value = Arrays.stream(value.split(\",\"))\n+                      .filter(v -> !v.contains(rule) ||\n+                              !anyMatch(v, algs))\n+                      .collect(Collectors.joining(\",\"));\n+        Security.setProperty(\"jdk.xml.dsig.secureValidationPolicy\", value);\n+    }\n+\n+    private static boolean anyMatch(String value, List<String> algs) {\n+        for (String alg : algs) {\n+           if (value.contains(alg)) {\n+               return true;\n+           }\n+        }\n+        return false;\n+    }\n+\n","filename":"test\/lib\/jdk\/test\/lib\/security\/SecurityUtils.java","additions":28,"deletions":1,"binary":false,"changes":29,"status":"modified"}]}