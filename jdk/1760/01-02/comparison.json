{"files":[{"patch":"@@ -235,4 +235,5 @@\n-        HttpURLConnection con;\n-        String encodedGetReq = responderURI.toString() + \"\/\" +\n-                URLEncoder.encode(Base64.getMimeEncoder(0, new byte[0]).\n-                        encodeToString(bytes), \"UTF-8\");\n+        HttpURLConnection con = null;\n+        try {\n+            String encodedGetReq = responderURI.toString() + \"\/\" +\n+                    URLEncoder.encode(Base64.getEncoder().encodeToString(bytes),\n+                            \"UTF-8\");\n@@ -240,19 +241,19 @@\n-        if (encodedGetReq.length() <= 255) {\n-            url = new URL(encodedGetReq);\n-            con = (HttpURLConnection)url.openConnection();\n-            con.setDoOutput(true);\n-            con.setDoInput(true);\n-            con.setRequestMethod(\"GET\");\n-        } else {\n-            url = responderURI.toURL();\n-            con = (HttpURLConnection)url.openConnection();\n-            con.setConnectTimeout(CONNECT_TIMEOUT);\n-            con.setReadTimeout(CONNECT_TIMEOUT);\n-            con.setDoOutput(true);\n-            con.setDoInput(true);\n-            con.setRequestMethod(\"POST\");\n-            con.setRequestProperty\n-                (\"Content-type\", \"application\/ocsp-request\");\n-            con.setRequestProperty\n-                (\"Content-length\", String.valueOf(bytes.length));\n-            try (OutputStream out = con.getOutputStream()) {\n+            if (encodedGetReq.length() <= 255) {\n+                url = new URL(encodedGetReq);\n+                con = (HttpURLConnection)url.openConnection();\n+                con.setDoOutput(true);\n+                con.setDoInput(true);\n+                con.setRequestMethod(\"GET\");\n+            } else {\n+                url = responderURI.toURL();\n+                con = (HttpURLConnection)url.openConnection();\n+                con.setConnectTimeout(CONNECT_TIMEOUT);\n+                con.setReadTimeout(CONNECT_TIMEOUT);\n+                con.setDoOutput(true);\n+                con.setDoInput(true);\n+                con.setRequestMethod(\"POST\");\n+                con.setRequestProperty\n+                    (\"Content-type\", \"application\/ocsp-request\");\n+                con.setRequestProperty\n+                    (\"Content-length\", String.valueOf(bytes.length));\n+                OutputStream out = con.getOutputStream();\n@@ -262,1 +263,0 @@\n-        }\n@@ -264,6 +264,6 @@\n-        \/\/ Check the response\n-        if (debug != null &&\n-            con.getResponseCode() != HttpURLConnection.HTTP_OK) {\n-            debug.println(\"Received HTTP error: \" + con.getResponseCode()\n-                + \" - \" + con.getResponseMessage());\n-        }\n+            \/\/ Check the response\n+            if (debug != null &&\n+                con.getResponseCode() != HttpURLConnection.HTTP_OK) {\n+                debug.println(\"Received HTTP error: \" + con.getResponseCode()\n+                    + \" - \" + con.getResponseMessage());\n+            }\n@@ -271,4 +271,4 @@\n-        int contentLength = con.getContentLength();\n-        if (contentLength == -1) {\n-            contentLength = Integer.MAX_VALUE;\n-        }\n+            int contentLength = con.getContentLength();\n+            if (contentLength == -1) {\n+                contentLength = Integer.MAX_VALUE;\n+            }\n@@ -276,1 +276,7 @@\n-        return IOUtils.readExactlyNBytes(con.getInputStream(), contentLength);\n+            return IOUtils.readExactlyNBytes(con.getInputStream(),\n+                    contentLength);\n+        } finally {\n+            if (con != null) {\n+                con.disconnect();\n+            }\n+        }\n","filename":"src\/java.base\/share\/classes\/sun\/security\/provider\/certpath\/OCSP.java","additions":41,"deletions":35,"binary":false,"changes":76,"status":"modified"}]}