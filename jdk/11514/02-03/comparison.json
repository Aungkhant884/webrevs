{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -74,1 +74,1 @@\n-  inline int64_t diff_in_current_scale(size_t s1, size_t s2) const {\n+  int64_t diff_in_current_scale(size_t s1, size_t s2) const {\n@@ -86,4 +86,11 @@\n-    amount = (amount + _scale \/ 2) \/ _scale;\n-    \/\/ We assume the valid range for deltas [INT64_MIN, INT64_MAX] to simplify the code.\n-    assert((sizeof(size_t) < sizeof(int64_t)) || (sizeof(size_t) == sizeof(int64_t) && amount <= INT64_MAX), \"cannot fit scaled diff into size_t\");\n-    return (is_negative) ? -(int64_t)amount : (int64_t)amount;\n+    size_t scaled = (amount \/ _scale);\n+    if ((amount % _scale) > (_scale - 1)\/2) {\n+      scaled += 1;\n+    }\n+\n+    if (scaled == 0) {\n+      return 0;\n+    }\n+    assert(scaled <= INT64_MAX, \"overflow\");\n+    int64_t result = static_cast<int64_t>(scaled);\n+    return is_negative ? -result : result;\n","filename":"src\/hotspot\/share\/services\/memReporter.hpp","additions":13,"deletions":6,"binary":false,"changes":19,"status":"modified"}]}