{"files":[{"patch":"@@ -54,2 +54,0 @@\n-import static org.testng.Assert.assertNotNull;\n-import static org.testng.Assert.assertNull;\n@@ -62,1 +60,2 @@\n-    static final String GET_BODY_STRING = \"Get with body\";\n+    static final String GET_BODY = \"Get with body\";\n+    static final String RESPONSE_BODY = \"Test Response Body\";\n@@ -66,1 +65,0 @@\n-    static String responseString = \"Test Response Body\";\n@@ -100,1 +98,3 @@\n-        hc.send(req, HttpResponse.BodyHandlers.ofString(UTF_8));\n+        HttpResponse<String> resp = hc.send(req, HttpResponse.BodyHandlers.ofString(UTF_8));\n+        assertEquals(resp.statusCode(), 200,\n+                \"Content-length header was set in request but should not be present.\");\n@@ -108,1 +108,1 @@\n-                .method(\"GET\", HttpRequest.BodyPublishers.ofString(GET_BODY_STRING))\n+                .method(\"GET\", HttpRequest.BodyPublishers.ofString(GET_BODY))\n@@ -112,1 +112,3 @@\n-        hc.send(req, HttpResponse.BodyHandlers.ofString(UTF_8));\n+        HttpResponse<String> resp = hc.send(req, HttpResponse.BodyHandlers.ofString(UTF_8));\n+        assertEquals(resp.statusCode(), 200,\n+                \"Content-length header was not set in request but should be present.\");\n@@ -115,2 +117,1 @@\n-    public static void handleResponse(HttpExchange ex) throws IOException {\n-        \/\/ Meaningless response to finish off the exchange\n+    public static void handleResponse(HttpExchange ex, int rCode) throws IOException {\n@@ -118,2 +119,2 @@\n-            byte[] bytes = responseString.getBytes(UTF_8);\n-            ex.sendResponseHeaders(200, bytes.length);\n+            byte[] bytes = RESPONSE_BODY.getBytes(UTF_8);\n+            ex.sendResponseHeaders(rCode, bytes.length);\n@@ -128,1 +129,2 @@\n-            testLog.println(\"NoContentLengthHandler Received Headers: \" + exchange.getRequestHeaders().entrySet());\n+            testLog.println(\"NoContentLengthHandler: Received Headers \" +\n+                            exchange.getRequestHeaders().entrySet());\n@@ -131,4 +133,7 @@\n-            \/\/ Check that content length was not set\n-            assertNull(contentLength);\n-            \/\/ Finish exchange with canned response\n-            handleResponse(exchange);\n+            \/\/ Check Content-length header was not set\n+            if (contentLength == null) {\n+                handleResponse(exchange, 200);\n+            } else {\n+                testLog.println(\"NoContentLengthHandler: Request contained an unexpected Content-length header\");\n+                handleResponse(exchange, 400);\n+            }\n@@ -142,1 +147,1 @@\n-            testLog.println(\"ContentLengthHandler Received Headers: \" +\n+            testLog.println(\"ContentLengthHandler: Received Headers \" +\n@@ -146,5 +151,7 @@\n-            \/\/ Check that the Content-length is correctly set\n-            assertNotNull(contentLength);\n-            assertEquals(Integer.valueOf(contentLength), Integer.valueOf(GET_BODY_STRING.getBytes(UTF_8).length));\n-            \/\/ Finish exchange with canned response\n-            handleResponse(exchange);\n+            \/\/ Check Content-length header was set\n+            if (contentLength != null) {\n+                handleResponse(exchange, 200);\n+            } else {\n+                testLog.println(\"ContentLengthHandler: Expected a Content-length header in request but was not present\");\n+                handleResponse(exchange, 400);\n+            }\n","filename":"test\/jdk\/java\/net\/httpclient\/ContentLengthHeaderTest.java","additions":29,"deletions":22,"binary":false,"changes":51,"status":"modified"}]}