{"files":[{"patch":"@@ -151,5 +151,6 @@\n-    public static native void colorConvert(long trans,\n-                                           LCMSImageLayout src,\n-                                           LCMSImageLayout dest);\n-\n-    public static native void initLCMS(Class<?> Trans, Class<?> IL, Class<?> Pf);\n+    static native void colorConvert(long trans, int width, int height,\n+                                    int srcOffset, int srcNextRowOffset,\n+                                    int dstOffset, int dstNextRowOffset,\n+                                    boolean srcAtOnce, boolean dstAtOnce,\n+                                    Object srcData, Object dstData,\n+                                    int srcType, int dstType);\n@@ -179,2 +180,0 @@\n-        initLCMS(LCMSTransform.class, LCMSImageLayout.class, ICC_Profile.class);\n-\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMS.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -86,1 +86,1 @@\n-    private boolean imageAtOnce = false;\n+    boolean imageAtOnce = false;\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMSImageLayout.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -159,1 +159,5 @@\n-        LCMS.colorConvert(tfm.ID, in, out);\n+        LCMS.colorConvert(tfm.ID, in.width, in.height, in.offset,\n+                          in.nextRowOffset, out.offset, out.nextRowOffset,\n+                          in.imageAtOnce, out.imageAtOnce,\n+                          in.dataArray, out.dataArray,\n+                          in.dataType, out.dataType);\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMSTransform.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -73,11 +73,0 @@\n-static jfieldID Trans_renderType_fID;\n-static jfieldID IL_isIntPacked_fID;\n-static jfieldID IL_dataType_fID;\n-static jfieldID IL_pixelType_fID;\n-static jfieldID IL_dataArray_fID;\n-static jfieldID IL_offset_fID;\n-static jfieldID IL_nextRowOffset_fID;\n-static jfieldID IL_width_fID;\n-static jfieldID IL_height_fID;\n-static jfieldID IL_imageAtOnce_fID;\n-\n@@ -464,6 +453,2 @@\n-void* getILData (JNIEnv *env, jobject img, jint* pDataType,\n-                 jobject* pDataObject) {\n-    void* result = NULL;\n-    *pDataType = (*env)->GetIntField (env, img, IL_dataType_fID);\n-    *pDataObject = (*env)->GetObjectField(env, img, IL_dataArray_fID);\n-    switch (*pDataType) {\n+static void *getILData(JNIEnv *env, jobject data, jint type) {\n+    switch (type) {\n@@ -471,2 +456,1 @@\n-            result = (*env)->GetByteArrayElements (env, *pDataObject, 0);\n-            break;\n+            return (*env)->GetByteArrayElements(env, data, 0);\n@@ -474,2 +458,1 @@\n-            result = (*env)->GetShortArrayElements (env, *pDataObject, 0);\n-            break;\n+            return (*env)->GetShortArrayElements(env, data, 0);\n@@ -477,2 +460,1 @@\n-            result = (*env)->GetIntArrayElements (env, *pDataObject, 0);\n-            break;\n+            return (*env)->GetIntArrayElements(env, data, 0);\n@@ -480,2 +462,3 @@\n-            result = (*env)->GetDoubleArrayElements (env, *pDataObject, 0);\n-            break;\n+            return (*env)->GetDoubleArrayElements(env, data, 0);\n+        default:\n+            return NULL;\n@@ -483,2 +466,0 @@\n-\n-    return result;\n@@ -487,3 +468,2 @@\n-void releaseILData (JNIEnv *env, void* pData, jint dataType,\n-                    jobject dataObject) {\n-    switch (dataType) {\n+static void releaseILData(JNIEnv *env, void *pData, jint type, jobject data) {\n+    switch (type) {\n@@ -491,1 +471,1 @@\n-            (*env)->ReleaseByteArrayElements(env,dataObject,(jbyte*)pData,0);\n+            (*env)->ReleaseByteArrayElements(env, data, (jbyte *) pData, 0);\n@@ -494,1 +474,1 @@\n-            (*env)->ReleaseShortArrayElements(env,dataObject,(jshort*)pData, 0);\n+            (*env)->ReleaseShortArrayElements(env, data, (jshort *) pData, 0);\n@@ -497,1 +477,1 @@\n-            (*env)->ReleaseIntArrayElements(env,dataObject,(jint*)pData,0);\n+            (*env)->ReleaseIntArrayElements(env, data, (jint *) pData, 0);\n@@ -500,2 +480,1 @@\n-            (*env)->ReleaseDoubleArrayElements(env,dataObject,(jdouble*)pData,\n-                                               0);\n+            (*env)->ReleaseDoubleArrayElements(env, data, (jdouble *) pData, 0);\n@@ -509,1 +488,1 @@\n- * Signature: (Lsun\/java2d\/cmm\/lcms\/LCMSTransform;Lsun\/java2d\/cmm\/lcms\/LCMSImageLayout;Lsun\/java2d\/cmm\/lcms\/LCMSImageLayout;)V\n+ * Signature: (JIIIIIIZZLjava\/lang\/Object;Ljava\/lang\/Object;)V\n@@ -512,1 +491,4 @@\n-  (JNIEnv *env, jclass cls, jlong ID, jobject src, jobject dst)\n+  (JNIEnv *env, jclass cls, jlong ID, jint width, jint height, jint srcOffset,\n+   jint srcNextRowOffset, jint dstOffset, jint dstNextRowOffset,\n+   jboolean srcAtOnce, jboolean dstAtOnce,\n+   jobject srcData, jobject dstData, jint srcDType, jint dstDType)\n@@ -515,19 +497,0 @@\n-    int srcDType, dstDType;\n-    int srcOffset, srcNextRowOffset, dstOffset, dstNextRowOffset;\n-    int width, height, i;\n-    void* inputBuffer;\n-    void* outputBuffer;\n-    char* inputRow;\n-    char* outputRow;\n-    jobject srcData, dstData;\n-    jboolean srcAtOnce = JNI_FALSE, dstAtOnce = JNI_FALSE;\n-\n-    srcOffset = (*env)->GetIntField (env, src, IL_offset_fID);\n-    srcNextRowOffset = (*env)->GetIntField (env, src, IL_nextRowOffset_fID);\n-    dstOffset = (*env)->GetIntField (env, dst, IL_offset_fID);\n-    dstNextRowOffset = (*env)->GetIntField (env, dst, IL_nextRowOffset_fID);\n-    width = (*env)->GetIntField (env, src, IL_width_fID);\n-    height = (*env)->GetIntField (env, src, IL_height_fID);\n-\n-    srcAtOnce = (*env)->GetBooleanField(env, src, IL_imageAtOnce_fID);\n-    dstAtOnce = (*env)->GetBooleanField(env, dst, IL_imageAtOnce_fID);\n@@ -542,3 +505,1 @@\n-\n-    inputBuffer = getILData (env, src, &srcDType, &srcData);\n-\n+    void *inputBuffer = getILData(env, srcData, srcDType);\n@@ -551,2 +512,1 @@\n-    outputBuffer = getILData (env, dst, &dstDType, &dstData);\n-\n+    void *outputBuffer = getILData(env, dstData, dstDType);\n@@ -559,2 +519,2 @@\n-    inputRow = (char*)inputBuffer + srcOffset;\n-    outputRow = (char*)outputBuffer + dstOffset;\n+    char *inputRow = (char *) inputBuffer + srcOffset;\n+    char *outputRow = (char *) outputBuffer + dstOffset;\n@@ -565,1 +525,1 @@\n-        for (i = 0; i < height; i++) {\n+        for (int i = 0; i < height; i++) {\n@@ -610,55 +570,0 @@\n-\/*\n- * Class:     sun_java2d_cmm_lcms_LCMS\n- * Method:    initLCMS\n- * Signature: (Ljava\/lang\/Class;Ljava\/lang\/Class;Ljava\/lang\/Class;)V\n- *\/\n-JNIEXPORT void JNICALL Java_sun_java2d_cmm_lcms_LCMS_initLCMS\n-  (JNIEnv *env, jclass cls, jclass Trans, jclass IL, jclass Pf)\n-{\n-    \/* TODO: move initialization of the IDs to the static blocks of\n-     * corresponding classes to avoid problems with invalidating ids by class\n-     * unloading\n-     *\/\n-    Trans_renderType_fID = (*env)->GetFieldID (env, Trans, \"renderType\", \"I\");\n-    if (Trans_renderType_fID == NULL) {\n-        return;\n-    }\n-    IL_isIntPacked_fID = (*env)->GetFieldID (env, IL, \"isIntPacked\", \"Z\");\n-    if (IL_isIntPacked_fID == NULL) {\n-        return;\n-    }\n-    IL_dataType_fID = (*env)->GetFieldID (env, IL, \"dataType\", \"I\");\n-    if (IL_dataType_fID == NULL) {\n-        return;\n-    }\n-    IL_pixelType_fID = (*env)->GetFieldID (env, IL, \"pixelType\", \"I\");\n-    if (IL_pixelType_fID == NULL) {\n-        return;\n-    }\n-    IL_dataArray_fID = (*env)->GetFieldID(env, IL, \"dataArray\",\n-                                          \"Ljava\/lang\/Object;\");\n-    if (IL_dataArray_fID == NULL) {\n-        return;\n-    }\n-    IL_width_fID = (*env)->GetFieldID (env, IL, \"width\", \"I\");\n-    if (IL_width_fID == NULL) {\n-        return;\n-    }\n-    IL_height_fID = (*env)->GetFieldID (env, IL, \"height\", \"I\");\n-    if (IL_height_fID == NULL) {\n-        return;\n-    }\n-    IL_offset_fID = (*env)->GetFieldID (env, IL, \"offset\", \"I\");\n-    if (IL_offset_fID == NULL) {\n-        return;\n-    }\n-    IL_imageAtOnce_fID = (*env)->GetFieldID (env, IL, \"imageAtOnce\", \"Z\");\n-    if (IL_imageAtOnce_fID == NULL) {\n-        return;\n-    }\n-    IL_nextRowOffset_fID = (*env)->GetFieldID (env, IL, \"nextRowOffset\", \"I\");\n-    if (IL_nextRowOffset_fID == NULL) {\n-        return;\n-    }\n-}\n-\n","filename":"src\/java.desktop\/share\/native\/liblcms\/LCMS.c","additions":24,"deletions":119,"binary":false,"changes":143,"status":"modified"}]}