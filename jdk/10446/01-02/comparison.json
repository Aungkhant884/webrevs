{"files":[{"patch":"@@ -45,0 +45,6 @@\n+        testEnd();\n+        Thread.sleep(1000);\n+        testMiddle();\n+        Thread.sleep(1000);\n+        testBeginning();\n+    }\n@@ -46,6 +52,6 @@\n-        try {\n-            SwingUtilities.invokeAndWait(() -> {\n-                textArea = new JTextArea();\n-                manager = new UndoManager();\n-                frame = new JFrame(\"Undo - Redo Error\");\n-                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+    private static void createUI() throws Exception {\n+        SwingUtilities.invokeAndWait(() -> {\n+            textArea = new JTextArea();\n+            manager = new UndoManager();\n+            frame = new JFrame(\"Undo - Redo Error\");\n+            frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n@@ -53,1 +59,1 @@\n-                JScrollPane scrollPane = new JScrollPane(textArea);\n+            JScrollPane scrollPane = new JScrollPane(textArea);\n@@ -55,1 +61,1 @@\n-                textArea.getDocument().addUndoableEditListener(manager);\n+            textArea.getDocument().addUndoableEditListener(manager);\n@@ -57,6 +63,27 @@\n-                frame.getContentPane().setLayout(new BorderLayout());\n-                frame.getContentPane().add(scrollPane, BorderLayout.CENTER);\n-                frame.setLocationRelativeTo(null);\n-                frame.setSize(100, 100);\n-                frame.setVisible(true);\n-            });\n+            frame.getContentPane().setLayout(new BorderLayout());\n+            frame.getContentPane().add(scrollPane, BorderLayout.CENTER);\n+            frame.setLocationRelativeTo(null);\n+            frame.setSize(100, 100);\n+            frame.setVisible(true);\n+        });\n+    }\n+\n+    private static void undoAndCheck() throws Exception {\n+\n+        if (textArea.getText().contains(\"\\u0633\")) {\n+            System.out.println(\"\\u0633 is present\");\n+        }\n+        SwingUtilities.invokeAndWait(() -> {\n+            if (manager.canUndo()) {\n+                manager.undo();\n+            }\n+        });\n+        Thread.sleep(1000);\n+        if (textArea.getText().contains(\"\\u0633\")) {\n+            throw new RuntimeException(\"Undo-ed arabic character still present\");\n+        }\n+    }\n+\n+    private static void testEnd() throws Exception {\n+        try {\n+            createUI();\n@@ -66,3 +93,3 @@\n-                for (int i = 0; i < 5 ; i++) {\n-                    textArea.insert(\"\\u0633\", textArea.getText().length());\n-                }\n+                textArea.insert(\"\\u0631\", textArea.getText().length());\n+                textArea.insert(\"\\u0632\", textArea.getText().length());\n+                textArea.insert(\"\\u0633\", textArea.getText().length());\n@@ -71,0 +98,1 @@\n+\n@@ -72,0 +100,2 @@\n+            undoAndCheck();\n+        } finally {\n@@ -73,2 +103,2 @@\n-                if (manager.canUndo()) {\n-                    manager.undo();\n+                if (frame != null) {\n+                    frame.dispose();\n@@ -77,0 +107,7 @@\n+        }\n+\n+    }\n+\n+    private static void testBeginning() throws Exception {\n+        try {\n+            createUI();\n@@ -81,0 +118,2 @@\n+                textArea.insert(\"\\u0631\", textArea.getText().length());\n+                textArea.insert(\"\\u0632\", textArea.getText().length());\n@@ -83,0 +122,1 @@\n+                textArea.setComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT);\n@@ -85,0 +125,2 @@\n+            undoAndCheck();\n+        } finally {\n@@ -86,2 +128,2 @@\n-                if (manager.canUndo()) {\n-                    manager.undo();\n+                if (frame != null) {\n+                    frame.dispose();\n@@ -90,0 +132,7 @@\n+        }\n+\n+    }\n+\n+    private static void testMiddle() throws Exception {\n+        try {\n+            createUI();\n@@ -94,0 +143,4 @@\n+                textArea.insert(\"\\u0631\", textArea.getText().length());\n+                textArea.insert(\"\\u0632\", textArea.getText().length());\n+                textArea.insert(\"\\u0634\", textArea.getText().length());\n+                textArea.insert(\"\\u0635\", textArea.getText().length());\n@@ -96,0 +149,1 @@\n+                textArea.setComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT);\n@@ -98,6 +152,1 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                if (manager.canUndo()) {\n-                    manager.undo();\n-                }\n-            });\n-            Thread.sleep(1000);\n+            undoAndCheck();\n","filename":"test\/jdk\/javax\/swing\/text\/AbstractDocument\/TestUndoInsertArabicText.java","additions":76,"deletions":27,"binary":false,"changes":103,"status":"modified"}]}