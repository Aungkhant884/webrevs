{"files":[{"patch":"@@ -1,33 +0,0 @@\n-#\n-# Copyright (c) 2003, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-# Execute the test. \n-# No need to compile (now done by JTReg tags in calling file)\n-#\n-echo ${TESTJAVA}\/bin\/java ${TESTVMOPTS} -Dtest.src=${TESTCLASSES} \\\n-     -classpath ${TESTCLASSPATH} $* || exit 20\n-\n-${TESTJAVA}\/bin\/java ${TESTVMOPTS} -Dtest.src=${TESTCLASSES} \\\n-     -classpath ${TESTCLASSPATH} $* || exit 20\n-\n-exit 0\n","filename":"test\/jdk\/sun\/management\/jmxremote\/RunTest.sh","additions":0,"deletions":33,"binary":false,"changes":33,"status":"deleted"},{"patch":"@@ -1,131 +0,0 @@\n-#\n-# Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# Utility Shell Script for generating .properties files or .password files\n-# or .access files from a list of input .in files.\n-#\n-# Source in this GeneratePropertyPassword.sh and call the function\n-# generatePropertyPasswordFiles.\n-# Call restoreFilePermissions to restore file permissions after the test completes\n-#\n-\n-\n-OS=`uname -s`\n-UMASK=`umask`\n-\n-case $OS in\n-CYGWIN_NT*)\n-    OS=\"Windows_NT\"\n-    if [ -z \"$SystemRoot\" ] ;  then\n-        SystemRoot=`cygpath $SYSTEMROOT`\n-    fi\n-esac\n-\n-case $OS in\n-Linux | Darwin | AIX )\n-    PATHSEP=\":\"\n-    FILESEP=\"\/\"\n-    DFILESEP=$FILESEP\n-    TMP_FILE=${TESTCLASSES}${FILESEP}${TESTCLASS}.sed.tmpfile\n-\n-cat <<EOF > ${TMP_FILE}\n-s^@TEST-SRC@\/^${TESTCLASSES}${DFILESEP}^g\n-EOF\n-    ;;\n-Windows_95 | Windows_98 | Windows_NT | Windows_ME | CYGWIN*)\n-    PATHSEP=\";\"\n-    FILESEP=\"\\\\\"\n-    DFILESEP=$FILESEP$FILESEP\n-    TMP_FILE=${TESTCLASSES}${FILESEP}${TESTCLASS}.sed.tmpfile\n-\n-cat <<EOF > ${TMP_FILE}0\n-s^@TEST-SRC@\/^${TESTCLASSES}${DFILESEP}^g\n-EOF\n-    # Need to put double backslash in the .properties files\n-    cat ${TMP_FILE}0 | sed -e 's^\\\\\\\\^ZZZZ^g' | \\\n-        sed -e 's^\\\\^ZZZZ^g' | \\\n-        sed -e 's^ZZZZ^\\\\\\\\\\\\\\\\^g' > ${TMP_FILE}\n-\n-    if [ \"$OS\" = \"Windows_NT\" ]; then\n-        USER=`id -u -n`\n-        CACLS=\"$SystemRoot\/system32\/cacls.exe\"\n-        REVOKEALL=\"$TESTNATIVEPATH\/revokeall.exe\"\n-        if [ ! -x \"$REVOKEALL\" ] ; then\n-            echo \"$REVOKEALL doesn't exist or is not executable\"\n-            exit 1\n-        fi\n-    fi\n-    ;;\n-*)\n-    echo \"Unrecognized system! $OS\"\n-    exit 1\n-    ;;\n-esac\n-\n-generatePropertyPasswordFiles()\n-{\n-   for f in $@\n-   do\n-        echo processing $f\n-        suffix=`basename $f .in`\n-        f2=\"${TESTCLASSES}${FILESEP}${suffix}\"\n-\n-        if [ -f \"$f2\" ] ; then\n-            rm -f $f2 || echo WARNING: $f2 already exits - unable to remove old copy\n-        fi\n-\n-        echo creating $f2\n-        sed -f $TMP_FILE $f > $f2\n-\n-        if [ \"$OS\" = \"Windows_NT\" ]; then\n-            chown $USER $f2\n-            # Grant this user full access\n-            echo Y|$CACLS $f2 \\\/E \\\/G $USER:F\n-            # Revoke everyone else\n-            $REVOKEALL $f2\n-            # Display ACLs\n-            $CACLS $f2\n-        else\n-            chmod 600 $f2\n-        fi\n-   done\n-}\n-\n-restoreFilePermissions()\n-{\n-    for f in $@\n-    do\n-        suffix=`basename $f .in`\n-        f2=\"${TESTCLASSES}${FILESEP}${suffix}\"\n-\n-        if [ \"$OS\" = \"Windows_NT\" ]; then\n-            # Grant everyone full control\n-            $CACLS $f2 \\\/E \\\/G Everyone:F\n-        else\n-            chmod 777 $f2\n-        fi\n-\n-    done\n-}\n-\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/GeneratePropertyPassword.sh","additions":0,"deletions":131,"binary":false,"changes":131,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,0 +23,1 @@\n+\n@@ -27,1 +28,0 @@\n-import java.io.FilenameFilter;\n@@ -30,0 +30,1 @@\n+import java.nio.file.Path;\n@@ -32,7 +33,1 @@\n-import java.util.Properties;\n-import java.util.Iterator;\n-import java.util.Set;\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.Map;\n-import java.util.Enumeration;\n+import java.util.*;\n@@ -47,0 +42,22 @@\n+\/*\n+ * @test\n+ * @bug     6528083\n+ * @key     intermittent\n+ * @summary Test RMI Bootstrap\n+ *\n+ * @library \/test\/lib\n+ *\n+ * @run main\/timeout=300 RmiBootstrapTest .*_test.*.in\n+ * *\/\n+\n+\/*\n+ * @test\n+ * @bug     6528083\n+ * @key     intermittent\n+ * @summary Test RMI Bootstrap\n+ *\n+ * @library \/test\/lib\n+ *\n+ * @run main\/timeout=300 RmiBootstrapTest .*_ssltest.*.in\n+ * *\/\n+\n@@ -59,1 +76,1 @@\n- * <p>When called with some argument, the main() will interprete its args to\n+ * <p>When called with some argument, the main() will interpret its args to\n@@ -71,1 +88,3 @@\n-public class RmiBootstrapTest {\n+public class RmiBootstrapTest extends RmiTestBase {\n+    static TestLogger log =\n+            new TestLogger(\"RmiBootstrapTest\");\n@@ -74,97 +93,0 @@\n-    static TestLogger log =\n-        new TestLogger(\"RmiBootstrapTest\");\n-\n-    \/**\n-     * Default values for RMI configuration properties.\n-     **\/\n-    public static interface DefaultValues {\n-        public static final String PORT=\"0\";\n-        public static final String CONFIG_FILE_NAME=\"management.properties\";\n-        public static final String USE_SSL=\"true\";\n-        public static final String USE_AUTHENTICATION=\"true\";\n-        public static final String PASSWORD_FILE_NAME=\"jmxremote.password\";\n-        public static final String ACCESS_FILE_NAME=\"jmxremote.access\";\n-        public static final String KEYSTORE=\"keystore\";\n-        public static final String KEYSTORE_PASSWD=\"password\";\n-        public static final String TRUSTSTORE=\"truststore\";\n-        public static final String TRUSTSTORE_PASSWD=\"trustword\";\n-        public static final String SSL_NEED_CLIENT_AUTH=\"false\";\n-    }\n-\n-    \/**\n-     * Names of RMI configuration properties.\n-     **\/\n-    public static interface PropertyNames {\n-        public static final String PORT=\n-            \"com.sun.management.jmxremote.port\";\n-        public static final String CONFIG_FILE_NAME=\n-            \"com.sun.management.config.file\";\n-        public static final String USE_SSL=\n-            \"com.sun.management.jmxremote.ssl\";\n-        public static final String USE_AUTHENTICATION=\n-            \"com.sun.management.jmxremote.authenticate\";\n-        public static final String PASSWORD_FILE_NAME=\n-            \"com.sun.management.jmxremote.password.file\";\n-        public static final String ACCESS_FILE_NAME=\n-            \"com.sun.management.jmxremote.access.file\";\n-        public static final String INSTRUMENT_ALL=\n-            \"com.sun.management.instrumentall\";\n-        public static final String CREDENTIALS =\n-            \"jmx.remote.credentials\";\n-        public static final String KEYSTORE=\n-            \"javax.net.ssl.keyStore\";\n-        public static final String KEYSTORE_PASSWD=\n-            \"javax.net.ssl.keyStorePassword\";\n-        public static final String TRUSTSTORE=\n-            \"javax.net.ssl.trustStore\";\n-        public static final String TRUSTSTORE_PASSWD=\n-            \"javax.net.ssl.trustStorePassword\";\n-        public static final String SSL_ENABLED_CIPHER_SUITES =\n-            \"com.sun.management.jmxremote.ssl.enabled.cipher.suites\";\n-        public static final String SSL_ENABLED_PROTOCOLS =\n-            \"com.sun.management.jmxremote.ssl.enabled.protocols\";\n-        public static final String SSL_NEED_CLIENT_AUTH =\n-            \"com.sun.management.jmxremote.ssl.need.client.auth\";\n-        public static final String SSL_CLIENT_ENABLED_CIPHER_SUITES =\n-            \"javax.rmi.ssl.client.enabledCipherSuites\";\n-    }\n-\n-    \/**\n-     * A filter to find all filenames who match <prefix>*<suffix>.\n-     * Note that <prefix> and <suffix> can overlap.\n-     **\/\n-    private static class ConfigFilenameFilter implements FilenameFilter {\n-        final String suffix;\n-        final String prefix;\n-        ConfigFilenameFilter(String prefix, String suffix) {\n-            this.suffix=suffix;\n-            this.prefix=prefix;\n-        }\n-        public boolean accept(File dir, String name) {\n-            return (name.startsWith(prefix) && name.endsWith(suffix));\n-        }\n-    }\n-\n-    \/**\n-     * Get all \"management*ok.properties\" files in the directory\n-     * indicated by the \"test.src\" management property.\n-     **\/\n-    private static File[] findConfigurationFilesOk() {\n-        final String testSrc = System.getProperty(\"test.src\");\n-        final File dir = new File(testSrc);\n-        final FilenameFilter filter =\n-            new ConfigFilenameFilter(\"management_test\",\"ok.properties\");\n-        return dir.listFiles(filter);\n-    }\n-\n-    \/**\n-     * Get all \"management*ko.properties\" files in the directory\n-     * indicated by the \"test.src\" management property.\n-     **\/\n-    private static File[] findConfigurationFilesKo() {\n-        final String testSrc = System.getProperty(\"test.src\");\n-        final File dir = new File(testSrc);\n-        final FilenameFilter filter =\n-            new ConfigFilenameFilter(\"management_test\",\"ko.properties\");\n-        return dir.listFiles(filter);\n-    }\n@@ -175,0 +97,1 @@\n+     *\n@@ -178,2 +101,2 @@\n-        throws IOException {\n-        return listMBeans(server,null,null);\n+            throws IOException {\n+        return listMBeans(server, null, null);\n@@ -185,0 +108,1 @@\n+     *\n@@ -188,2 +112,2 @@\n-                                  ObjectName pattern, QueryExp query)\n-        throws IOException {\n+            ObjectName pattern, QueryExp query)\n+            throws IOException {\n@@ -191,4 +115,4 @@\n-        final Set names = server.queryNames(pattern,query);\n-        for (final Iterator i=names.iterator(); i.hasNext(); ) {\n-            ObjectName name = (ObjectName)i.next();\n-            log.trace(\"listMBeans\",\"Got MBean: \"+name);\n+        final Set names = server.queryNames(pattern, query);\n+        for (final Iterator i = names.iterator(); i.hasNext(); ) {\n+            ObjectName name = (ObjectName) i.next();\n+            log.trace(\"listMBeans\", \"Got MBean: \" + name);\n@@ -196,2 +120,1 @@\n-                MBeanInfo info =\n-                    server.getMBeanInfo((ObjectName)name);\n+                MBeanInfo info = server.getMBeanInfo(name);\n@@ -199,2 +122,4 @@\n-                if (attrs == null) continue;\n-                for (int j=0; j<attrs.length; j++) {\n+                if (attrs == null) {\n+                    continue;\n+                }\n+                for (int j = 0; j < attrs.length; j++) {\n@@ -203,6 +128,7 @@\n-                            Object o =\n-                                server.getAttribute(name,attrs[j].getName());\n-                            if (log.isDebugOn())\n-                                log.debug(\"listMBeans\",\"\\t\\t\" +\n-                                          attrs[j].getName() +\n-                                          \" = \"+o);\n+                            Object o = server.getAttribute(name,\n+                                    attrs[j].getName());\n+                            if (log.isDebugOn()) {\n+                                log.debug(\"listMBeans\", \"\\t\\t\" +\n+                                        attrs[j].getName() +\n+                                        \" = \" + o);\n+                            }\n@@ -210,2 +136,2 @@\n-                            log.trace(\"listMBeans\",\"JmxClient failed to get \" +\n-                                      attrs[j].getName() + \": \" + x);\n+                            log.trace(\"listMBeans\", \"JmxClient failed to get \" +\n+                                    attrs[j].getName() + \": \" + x);\n@@ -213,2 +139,2 @@\n-                                new IOException(\"JmxClient failed to get \" +\n-                                                attrs[j].getName());\n+                                    new IOException(\"JmxClient failed to get \" +\n+                                            attrs[j].getName());\n@@ -221,2 +147,2 @@\n-               log.trace(\"listMBeans\",\n-                         \"JmxClient failed to get MBeanInfo: \"  + x);\n+                log.trace(\"listMBeans\",\n+                        \"JmxClient failed to get MBeanInfo: \" + x);\n@@ -224,1 +150,2 @@\n-                    new IOException(\"JmxClient failed to get MBeanInfo: \"+x);\n+                        new IOException(\n+                                \"JmxClient failed to get MBeanInfo: \" + x);\n@@ -233,3 +160,2 @@\n-     * Compute the full path name for a default file.\n-     * @param basename basename (with extension) of the default file.\n-     * @return ${JRE}\/conf\/management\/${basename}\n+     * Calls run(args[]).\n+     * exit(1) if the test fails.\n@@ -237,9 +163,5 @@\n-    private static String getDefaultFileName(String basename) {\n-        final String fileSeparator = File.separator;\n-        final StringBuffer defaultFileName =\n-            new StringBuffer(System.getProperty(\"java.home\")).\n-            append(fileSeparator).append(\"conf\").append(fileSeparator).\n-            append(\"management\").append(fileSeparator).\n-            append(basename);\n-        return defaultFileName.toString();\n-    }\n+    public static void main(String args[]) throws Exception {\n+        if (args.length == 0) {\n+            throw new IllegalArgumentException(\"Argument is required for this\" +\n+                    \" test\");\n+        }\n@@ -247,13 +169,9 @@\n-    \/**\n-     * Compute the full path name for a default file.\n-     * @param basename basename (with extension) of the default file.\n-     * @return ${JRE}\/conf\/management\/${basename}\n-     **\/\n-    private static String getDefaultStoreName(String basename) {\n-        final String fileSeparator = File.separator;\n-        final StringBuffer defaultFileName =\n-            new StringBuffer(System.getProperty(\"test.src\")).\n-            append(fileSeparator).append(\"ssl\").append(fileSeparator).\n-            append(basename);\n-        return defaultFileName.toString();\n-    }\n+        final List<Path> credentialFiles = prepareTestFiles(args[0]);\n+\n+        Security.setProperty(\"jdk.tls.disabledAlgorithms\", \"\");\n+\n+        try {\n+            MAX_GET_FREE_PORT_TRIES = Integer.parseInt(\n+                    System.getProperty(\"test.getfreeport.max.tries\", \"10\"));\n+        } catch (NumberFormatException ex) {\n+        }\n@@ -261,0 +179,15 @@\n+        RmiBootstrapTest manager = new RmiBootstrapTest();\n+        try {\n+            manager.run(args);\n+        } catch (RuntimeException r) {\n+            System.out.println(\"Test Failed: \" + r.getMessage());\n+            System.exit(1);\n+        } catch (Throwable t) {\n+            System.out.println(\"Test Failed: \" + t);\n+            t.printStackTrace();\n+            System.exit(2);\n+        }\n+        System.out.println(\"**** Test  RmiBootstrap Passed ****\");\n+\n+        grantFilesAccess(credentialFiles, AccessControl.EVERYONE);\n+    }\n@@ -270,1 +203,1 @@\n-        throws IOException {\n+            throws IOException {\n@@ -272,1 +205,1 @@\n-        final ArrayList  result = new ArrayList();\n+        final ArrayList result = new ArrayList();\n@@ -274,1 +207,3 @@\n-        if (!f.exists()) return result;\n+        if (!f.exists()) {\n+            return result;\n+        }\n@@ -276,2 +211,6 @@\n-        try {pws.load(fin);}finally{fin.close();}\n-        for (Enumeration en=pws.propertyNames();en.hasMoreElements();) {\n+        try {\n+            pws.load(fin);\n+        } finally {\n+            fin.close();\n+        }\n+        for (Enumeration en = pws.propertyNames(); en.hasMoreElements(); ) {\n@@ -279,2 +218,2 @@\n-            cred[0]=(String)en.nextElement();\n-            cred[1]=pws.getProperty(cred[0]);\n+            cred[0] = (String) en.nextElement();\n+            cred[1] = pws.getProperty(cred[0]);\n@@ -286,1 +225,0 @@\n-\n@@ -291,7 +229,9 @@\n-     * @param url JMXServiceURL of the server.\n-     * @param useCredentials An array of credentials (a credential\n-     *        is a two String array, so this is an array of arrays\n-     *        of strings:\n-     *           useCredentials[i][0]=subject\n-     *           useCredentials[i][1]=password\n-     *        if useCredentials[i] == null means no credentials.\n+     *\n+     * @param url             JMXServiceURL of the server.\n+     * @param useCredentials  An array of credentials (a credential\n+     *                        is a two String array, so this is an array of\n+     *                        arrays\n+     *                        of strings:\n+     *                        useCredentials[i][0]=subject\n+     *                        useCredentials[i][1]=password\n+     *                        if useCredentials[i] == null means no credentials.\n@@ -299,10 +239,16 @@\n-     *    Note: if expectConnectOk=false and the test fails to connect\n-     *          the number of failure is not incremented. Conversely,\n-     *          if expectConnectOk=false and the test does not fail to\n-     *          connect the number of failure is incremented.\n-     * @param expectReadOk true if communication (listMBeans) is expected\n-     *        to succeed.\n-     *    Note: if expectReadOk=false and the test fails to read MBeans\n-     *          the number of failure is not incremented. Conversely,\n-     *          if expectReadOk=false and the test does not fail to\n-     *          read MBeans the number of failure is incremented.\n+     *                        Note: if expectConnectOk=false and the test\n+     *                        fails to connect\n+     *                        the number of failure is not incremented.\n+     *                        Conversely,\n+     *                        if expectConnectOk=false and the test does not\n+     *                        fail to\n+     *                        connect the number of failure is incremented.\n+     * @param expectReadOk    true if communication (listMBeans) is expected\n+     *                        to succeed.\n+     *                        Note: if expectReadOk=false and the test fails\n+     *                        to read MBeans\n+     *                        the number of failure is not incremented.\n+     *                        Conversely,\n+     *                        if expectReadOk=false and the test does not\n+     *                        fail to\n+     *                        read MBeans the number of failure is incremented.\n@@ -312,4 +258,4 @@\n-                              Object[] useCredentials,\n-                              boolean  expectConnectOk,\n-                              boolean  expectReadOk)\n-        throws IOException {\n+            Object[] useCredentials,\n+            boolean expectConnectOk,\n+            boolean expectReadOk)\n+            throws IOException {\n@@ -319,1 +265,1 @@\n-        for (int i=0 ; i<useCredentials.length ; i++) {\n+        for (int i = 0; i < useCredentials.length; i++) {\n@@ -321,2 +267,2 @@\n-            final String[] credentials = (String[])useCredentials[i];\n-            final String   crinfo;\n+            final String[] credentials = (String[]) useCredentials[i];\n+            final String crinfo;\n@@ -324,2 +270,2 @@\n-                crinfo = \"{\"+credentials[0] + \", \" + credentials[1] + \"}\";\n-                m.put(PropertyNames.CREDENTIALS,credentials);\n+                crinfo = \"{\" + credentials[0] + \", \" + credentials[1] + \"}\";\n+                m.put(PropertyNames.CREDENTIALS, credentials);\n@@ -327,1 +273,1 @@\n-                crinfo=\"no credentials\";\n+                crinfo = \"no credentials\";\n@@ -329,1 +275,1 @@\n-            log.trace(\"testCommunication\",\"using credentials: \" + crinfo);\n+            log.trace(\"testCommunication\", \"using credentials: \" + crinfo);\n@@ -333,2 +279,2 @@\n-                c = JMXConnectorFactory.connect(url,m);\n-            } catch (IOException x ) {\n+                c = JMXConnectorFactory.connect(url, m);\n+            } catch (IOException x) {\n@@ -337,1 +283,1 @@\n-                        \": \" + x;\n+                            \": \" + x;\n@@ -339,2 +285,2 @@\n-                    log.trace(\"testCommunication\",err);\n-                    log.debug(\"testCommunication\",x);\n+                    log.trace(\"testCommunication\", err);\n+                    log.debug(\"testCommunication\", x);\n@@ -345,1 +291,1 @@\n-                                       crinfo + \": \" + x);\n+                            crinfo + \": \" + x);\n@@ -348,1 +294,1 @@\n-            } catch (RuntimeException x ) {\n+            } catch (RuntimeException x) {\n@@ -351,1 +297,1 @@\n-                        \": \" + x;\n+                            \": \" + x;\n@@ -353,2 +299,2 @@\n-                    log.trace(\"testCommunication\",err);\n-                    log.debug(\"testCommunication\",x);\n+                    log.trace(\"testCommunication\", err);\n+                    log.debug(\"testCommunication\", x);\n@@ -359,1 +305,1 @@\n-                                       crinfo + \": \" + x);\n+                            crinfo + \": \" + x);\n@@ -365,1 +311,1 @@\n-                    c.getMBeanServerConnection();\n+                        c.getMBeanServerConnection();\n@@ -367,3 +313,3 @@\n-                    log.debug(\"testCommunication\",\"Connection is:\" + conn);\n-                    log.debug(\"testCommunication\",\"Server domain is: \" +\n-                              conn.getDefaultDomain());\n+                    log.debug(\"testCommunication\", \"Connection is:\" + conn);\n+                    log.debug(\"testCommunication\", \"Server domain is: \" +\n+                            conn.getDefaultDomain());\n@@ -372,5 +318,6 @@\n-                    new ObjectName(\"java.lang:type=Memory,*\");\n-                final int count = listMBeans(conn,pattern,null);\n-                if (count == 0)\n-                    throw new Exception(\"Expected at least one matching \"+\n-                                        \"MBean for \"+pattern);\n+                        new ObjectName(\"java.lang:type=Memory,*\");\n+                final int count = listMBeans(conn, pattern, null);\n+                if (count == 0) {\n+                    throw new Exception(\"Expected at least one matching \" +\n+                            \"MBean for \" + pattern);\n+                }\n@@ -379,3 +326,3 @@\n-                                       \"as expected for \"+\n-                                       crinfo + \": found \" + count\n-                                       + ((count<2)?\"MBean\":\"MBeans\"));\n+                            \"as expected for \" +\n+                            crinfo + \": found \" + count\n+                            + ((count < 2) ? \"MBean\" : \"MBeans\"));\n@@ -384,1 +331,1 @@\n-                        crinfo;\n+                            crinfo;\n@@ -388,3 +335,2 @@\n-            } catch (IOException x ) {\n-                if (expectReadOk) {\n-                    final String err = \"Communication failed with \" + crinfo +\n+            } catch (IOException x) {\n+                final String err = \"Communication failed with \" + crinfo +\n@@ -392,0 +338,1 @@\n+                if (expectReadOk) {\n@@ -393,2 +340,2 @@\n-                    log.trace(\"testCommunication\",err);\n-                    log.debug(\"testCommunication\",x);\n+                    log.trace(\"testCommunication\", err);\n+                    log.debug(\"testCommunication\", x);\n@@ -398,2 +345,2 @@\n-                    System.out.println(\"Communication failed as expected for \"+\n-                                       crinfo + \": \" + x);\n+                    System.out.println(\"Communication failed as expected for \" +\n+                            crinfo + \": \" + x);\n@@ -402,1 +349,1 @@\n-            } catch (RuntimeException x ) {\n+            } catch (RuntimeException x) {\n@@ -405,1 +352,1 @@\n-                        \": \" + x;\n+                            \": \" + x;\n@@ -407,2 +354,2 @@\n-                    log.trace(\"testCommunication\",err);\n-                    log.debug(\"testCommunication\",x);\n+                    log.trace(\"testCommunication\", err);\n+                    log.debug(\"testCommunication\", x);\n@@ -412,2 +359,2 @@\n-                    System.out.println(\"Communication failed as expected for \"+\n-                                       crinfo + \": \" + x);\n+                    System.out.println(\"Communication failed as expected for \" +\n+                            crinfo + \": \" + x);\n@@ -417,1 +364,1 @@\n-                    \": \" + x;\n+                        \": \" + x;\n@@ -419,2 +366,2 @@\n-                log.trace(\"testCommunication\",err);\n-                log.debug(\"testCommunication\",x);\n+                log.trace(\"testCommunication\", err);\n+                log.debug(\"testCommunication\", x);\n@@ -430,1 +377,0 @@\n-\n@@ -433,1 +379,1 @@\n-            getDefaultStoreName(DefaultValues.KEYSTORE);\n+                getDefaultStoreName(DefaultValues.KEYSTORE);\n@@ -435,1 +381,1 @@\n-            getDefaultStoreName(DefaultValues.TRUSTSTORE);\n+                getDefaultStoreName(DefaultValues.TRUSTSTORE);\n@@ -438,3 +384,3 @@\n-            System.getProperty(PropertyNames.KEYSTORE, defaultKeyStore);\n-        System.setProperty(PropertyNames.KEYSTORE,keyStore);\n-        log.trace(\"setSslProperties\",PropertyNames.KEYSTORE+\"=\"+keyStore);\n+                System.getProperty(PropertyNames.KEYSTORE, defaultKeyStore);\n+        System.setProperty(PropertyNames.KEYSTORE, keyStore);\n+        log.trace(\"setSslProperties\", PropertyNames.KEYSTORE + \"=\" + keyStore);\n@@ -443,3 +389,3 @@\n-            System.getProperty(PropertyNames.KEYSTORE_PASSWD,\n-                               DefaultValues.KEYSTORE_PASSWD);\n-        System.setProperty(PropertyNames.KEYSTORE_PASSWD,password);\n+                System.getProperty(PropertyNames.KEYSTORE_PASSWD,\n+                        DefaultValues.KEYSTORE_PASSWD);\n+        System.setProperty(PropertyNames.KEYSTORE_PASSWD, password);\n@@ -447,1 +393,1 @@\n-                  PropertyNames.KEYSTORE_PASSWD+\"=\"+password);\n+                PropertyNames.KEYSTORE_PASSWD + \"=\" + password);\n@@ -450,3 +396,3 @@\n-            System.getProperty(PropertyNames.TRUSTSTORE,\n-                               defaultTrustStore);\n-        System.setProperty(PropertyNames.TRUSTSTORE,trustStore);\n+                System.getProperty(PropertyNames.TRUSTSTORE,\n+                        defaultTrustStore);\n+        System.setProperty(PropertyNames.TRUSTSTORE, trustStore);\n@@ -454,1 +400,1 @@\n-                  PropertyNames.TRUSTSTORE+\"=\"+trustStore);\n+                PropertyNames.TRUSTSTORE + \"=\" + trustStore);\n@@ -457,3 +403,3 @@\n-            System.getProperty(PropertyNames.TRUSTSTORE_PASSWD,\n-                               DefaultValues.TRUSTSTORE_PASSWD);\n-        System.setProperty(PropertyNames.TRUSTSTORE_PASSWD,trustword);\n+                System.getProperty(PropertyNames.TRUSTSTORE_PASSWD,\n+                        DefaultValues.TRUSTSTORE_PASSWD);\n+        System.setProperty(PropertyNames.TRUSTSTORE_PASSWD, trustword);\n@@ -461,1 +407,1 @@\n-                  PropertyNames.TRUSTSTORE_PASSWD+\"=\"+trustword);\n+                PropertyNames.TRUSTSTORE_PASSWD + \"=\" + trustword);\n@@ -474,1 +420,1 @@\n-                getDefaultFileName(DefaultValues.CONFIG_FILE_NAME);\n+                    getDefaultFileName(DefaultValues.CONFIG_FILE_NAME);\n@@ -476,1 +422,2 @@\n-                System.getProperty(PropertyNames.CONFIG_FILE_NAME,defaultConf);\n+                    System.getProperty(PropertyNames.CONFIG_FILE_NAME,\n+                            defaultConf);\n@@ -482,1 +429,5 @@\n-                try {props.load(fin);} finally {fin.close();}\n+                try {\n+                    props.load(fin);\n+                } finally {\n+                    fin.close();\n+                }\n@@ -486,3 +437,3 @@\n-            final String  useSslStr =\n-                props.getProperty(PropertyNames.USE_SSL,\n-                                  DefaultValues.USE_SSL);\n+            final String useSslStr =\n+                    props.getProperty(PropertyNames.USE_SSL,\n+                            DefaultValues.USE_SSL);\n@@ -490,1 +441,1 @@\n-                Boolean.valueOf(useSslStr).booleanValue();\n+                    Boolean.valueOf(useSslStr).booleanValue();\n@@ -493,2 +444,2 @@\n-                      PropertyNames.USE_SSL+\"=\"+useSsl+\n-                      \": setting SSL\");\n+                    PropertyNames.USE_SSL + \"=\" + useSsl +\n+                            \": setting SSL\");\n@@ -496,3 +447,3 @@\n-            final String  useSslClientAuthStr =\n-                props.getProperty(PropertyNames.SSL_NEED_CLIENT_AUTH,\n-                                  DefaultValues.SSL_NEED_CLIENT_AUTH);\n+            final String useSslClientAuthStr =\n+                    props.getProperty(PropertyNames.SSL_NEED_CLIENT_AUTH,\n+                            DefaultValues.SSL_NEED_CLIENT_AUTH);\n@@ -500,1 +451,1 @@\n-                Boolean.valueOf(useSslClientAuthStr).booleanValue();\n+                    Boolean.valueOf(useSslClientAuthStr).booleanValue();\n@@ -503,1 +454,2 @@\n-                      PropertyNames.SSL_NEED_CLIENT_AUTH+\"=\"+useSslClientAuth);\n+                    PropertyNames.SSL_NEED_CLIENT_AUTH + \"=\" +\n+                            useSslClientAuth);\n@@ -507,1 +459,1 @@\n-                props.getProperty(PropertyNames.SSL_ENABLED_CIPHER_SUITES);\n+                    props.getProperty(PropertyNames.SSL_ENABLED_CIPHER_SUITES);\n@@ -510,2 +462,2 @@\n-                      PropertyNames.SSL_ENABLED_CIPHER_SUITES + \"=\" +\n-                      sslCipherSuites);\n+                    PropertyNames.SSL_ENABLED_CIPHER_SUITES + \"=\" +\n+                            sslCipherSuites);\n@@ -515,1 +467,1 @@\n-                props.getProperty(PropertyNames.SSL_ENABLED_PROTOCOLS);\n+                    props.getProperty(PropertyNames.SSL_ENABLED_PROTOCOLS);\n@@ -518,2 +470,2 @@\n-                      PropertyNames.SSL_ENABLED_PROTOCOLS + \"=\" +\n-                      sslProtocols);\n+                    PropertyNames.SSL_ENABLED_PROTOCOLS + \"=\" +\n+                            sslProtocols);\n@@ -527,1 +479,1 @@\n-            log.debug(\"checkSslConfiguration\",x);\n+            log.debug(\"checkSslConfiguration\", x);\n@@ -538,1 +490,1 @@\n-     *\n+     * <p>\n@@ -542,1 +494,1 @@\n-        throws IOException {\n+            throws IOException {\n@@ -545,1 +497,1 @@\n-            getDefaultFileName(DefaultValues.CONFIG_FILE_NAME);\n+                getDefaultFileName(DefaultValues.CONFIG_FILE_NAME);\n@@ -547,1 +499,1 @@\n-            System.getProperty(PropertyNames.CONFIG_FILE_NAME,defaultConf);\n+                System.getProperty(PropertyNames.CONFIG_FILE_NAME, defaultConf);\n@@ -553,1 +505,5 @@\n-            try {props.load(fin);} finally {fin.close();}\n+            try {\n+                props.load(fin);\n+            } finally {\n+                fin.close();\n+            }\n@@ -557,3 +513,3 @@\n-        final String  useAuthenticationStr =\n-            props.getProperty(PropertyNames.USE_AUTHENTICATION,\n-                              DefaultValues.USE_AUTHENTICATION);\n+        final String useAuthenticationStr =\n+                props.getProperty(PropertyNames.USE_AUTHENTICATION,\n+                        DefaultValues.USE_AUTHENTICATION);\n@@ -561,1 +517,1 @@\n-            Boolean.valueOf(useAuthenticationStr).booleanValue();\n+                Boolean.valueOf(useAuthenticationStr).booleanValue();\n@@ -565,1 +521,1 @@\n-            getDefaultFileName(DefaultValues.PASSWORD_FILE_NAME));\n+                getDefaultFileName(DefaultValues.PASSWORD_FILE_NAME));\n@@ -567,2 +523,2 @@\n-            props.getProperty(PropertyNames.PASSWORD_FILE_NAME,\n-                              defaultPasswordFileName));\n+                props.getProperty(PropertyNames.PASSWORD_FILE_NAME,\n+                        defaultPasswordFileName));\n@@ -572,1 +528,1 @@\n-            getDefaultFileName(DefaultValues.ACCESS_FILE_NAME));\n+                getDefaultFileName(DefaultValues.ACCESS_FILE_NAME));\n@@ -574,2 +530,2 @@\n-            props.getProperty(PropertyNames.ACCESS_FILE_NAME,\n-                              defaultAccessFileName));\n+                props.getProperty(PropertyNames.ACCESS_FILE_NAME,\n+                        defaultAccessFileName));\n@@ -583,1 +539,1 @@\n-        final Object[] noCredentials = { null };\n+        final Object[] noCredentials = {null};\n@@ -586,3 +542,8 @@\n-            if (l.size() == 0) allCredentials = null;\n-            else allCredentials = l.toArray();\n-        } else allCredentials = noCredentials;\n+            if (l.size() == 0) {\n+                allCredentials = null;\n+            } else {\n+                allCredentials = l.toArray();\n+            }\n+        } else {\n+            allCredentials = noCredentials;\n+        }\n@@ -591,1 +552,1 @@\n-        if (allCredentials!=null) {\n+        if (allCredentials != null) {\n@@ -595,1 +556,1 @@\n-            errorCount += connectAndRead(url,allCredentials,true,true);\n+            errorCount += connectAndRead(url, allCredentials, true, true);\n@@ -601,3 +562,3 @@\n-                null,\n-                { \"modify\", \"R&D\" },\n-                { \"measure\", \"QED\" }\n+                    null,\n+                    {\"modify\", \"R&D\"},\n+                    {\"measure\", \"QED\"}\n@@ -605,1 +566,1 @@\n-            errorCount += connectAndRead(url,someCredentials,false,false);\n+            errorCount += connectAndRead(url, someCredentials, false, false);\n@@ -613,2 +574,2 @@\n-                { \"bad.user\", \"R&D\" },\n-                { \"measure\", \"bad.password\" }\n+                    {\"bad.user\", \"R&D\"},\n+                    {\"measure\", \"bad.password\"}\n@@ -616,1 +577,1 @@\n-            errorCount += connectAndRead(url,badCredentials,false,false);\n+            errorCount += connectAndRead(url, badCredentials, false, false);\n@@ -620,2 +581,2 @@\n-                errorCount + \" error(s)\";\n-            log.debug(\"testCommunication\",err);\n+                    errorCount + \" error(s)\";\n+            log.debug(\"testCommunication\", err);\n@@ -626,1 +587,0 @@\n-\n@@ -632,0 +592,1 @@\n+     *\n@@ -634,1 +595,2 @@\n-    private String testConfiguration(File file) throws IOException, InterruptedException {\n+    private String testConfiguration(File file)\n+            throws IOException, InterruptedException {\n@@ -641,2 +603,2 @@\n-                    path=(file==null)?null:file.getCanonicalPath();\n-                } catch(IOException x) {\n+                    path = (file == null) ? null : file.getCanonicalPath();\n+                } catch (IOException x) {\n@@ -644,3 +606,3 @@\n-                        \": \" + x;\n-                    log.trace(\"testConfiguration\",err);\n-                    log.debug(\"testConfiguration\",x);\n+                            \": \" + x;\n+                    log.trace(\"testConfiguration\", err);\n+                    log.debug(\"testConfiguration\", x);\n@@ -649,1 +611,2 @@\n-                final String config = (path==null)?\"Default config file\":path;\n+                final String config =\n+                        (path == null) ? \"Default config file\" : path;\n@@ -652,2 +615,3 @@\n-                System.out.println(\"*** Testing configuration (port=\" + port + \"): \"\n-                                   + path);\n+                System.out.println(\n+                        \"*** Testing configuration (port=\" + port + \"): \"\n+                                + path);\n@@ -657,2 +621,2 @@\n-                                    Integer.toString(port));\n-                if (path != null)\n+                        Integer.toString(port));\n+                if (path != null) {\n@@ -660,2 +624,4 @@\n-                else\n-                    System.getProperties().remove(\"com.sun.management.config.file\");\n+                } else {\n+                    System.getProperties()\n+                            .remove(\"com.sun.management.config.file\");\n+                }\n@@ -663,2 +629,3 @@\n-                log.trace(\"testConfiguration\",\"com.sun.management.jmxremote.port=\"+port);\n-                if (path != null && log.isDebugOn())\n+                log.trace(\"testConfiguration\",\n+                        \"com.sun.management.jmxremote.port=\" + port);\n+                if (path != null && log.isDebugOn()) {\n@@ -666,1 +633,2 @@\n-                              \"com.sun.management.config.file=\"+path);\n+                            \"com.sun.management.config.file=\" + path);\n+                }\n@@ -676,1 +644,1 @@\n-                            throw (BindException)x.getCause().getCause();\n+                            throw (BindException) x.getCause().getCause();\n@@ -680,6 +648,8 @@\n-                        \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n-                        ((path!=null)?\"\\n\\tcom.sun.management.config.file=\"+path:\n-                         \"\\n\\t\"+config) +\n-                        \"\\n\\tError is: \" + x;\n-                    log.trace(\"testConfiguration\",err);\n-                    log.debug(\"testConfiguration\",x);\n+                            \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n+                            ((path != null) ?\n+                                    \"\\n\\tcom.sun.management.config.file=\" +\n+                                            path :\n+                                    \"\\n\\t\" + config) +\n+                            \"\\n\\tError is: \" + x;\n+                    log.trace(\"testConfiguration\", err);\n+                    log.debug(\"testConfiguration\", x);\n@@ -688,1 +658,1 @@\n-                    log.debug(\"testConfiguration\",x);\n+                    log.debug(\"testConfiguration\", x);\n@@ -694,2 +664,3 @@\n-                        new JMXServiceURL(\"rmi\",null,0,\"\/jndi\/rmi:\/\/localhost:\"+\n-                                          port+\"\/jmxrmi\");\n+                            new JMXServiceURL(\"rmi\", null, 0,\n+                                    \"\/jndi\/rmi:\/\/localhost:\" +\n+                                            port + \"\/jmxrmi\");\n@@ -700,4 +671,5 @@\n-                        final String err = \"Failed to connect to agent {url=\"+url+\n-                            \"}: \" + x;\n-                        log.trace(\"testConfiguration\",err);\n-                        log.debug(\"testConfiguration\",x);\n+                        final String err =\n+                                \"Failed to connect to agent {url=\" + url +\n+                                        \"}: \" + x;\n+                        log.trace(\"testConfiguration\", err);\n+                        log.debug(\"testConfiguration\", x);\n@@ -707,4 +679,5 @@\n-                    final String err = \"Failed to test configuration \"+config+\n-                        \": \"+x;\n-                    log.trace(\"testConfiguration\",err);\n-                    log.debug(\"testConfiguration\",x);\n+                    final String err =\n+                            \"Failed to test configuration \" + config +\n+                                    \": \" + x;\n+                    log.trace(\"testConfiguration\", err);\n+                    log.debug(\"testConfiguration\", x);\n@@ -716,3 +689,3 @@\n-                        final String err = \"Failed to terminate: \"+x;\n-                        log.trace(\"testConfiguration\",err);\n-                        log.debug(\"testConfiguration\",x);\n+                        final String err = \"Failed to terminate: \" + x;\n+                        log.trace(\"testConfiguration\", err);\n+                        log.debug(\"testConfiguration\", x);\n@@ -721,1 +694,2 @@\n-                System.out.println(\"Configuration \" + config + \" successfully tested\");\n+                System.out.println(\n+                        \"Configuration \" + config + \" successfully tested\");\n@@ -723,1 +697,1 @@\n-            } catch(BindException ex) {\n+            } catch (BindException ex) {\n@@ -726,2 +700,5 @@\n-        System.err.println(\"Cannot find a free port after \" + MAX_GET_FREE_PORT_TRIES + \" tries\");\n-        return \"Failed: cannot find a free port after \" + MAX_GET_FREE_PORT_TRIES + \" tries\";\n+        System.err.println(\n+                \"Cannot find a free port after \" + MAX_GET_FREE_PORT_TRIES +\n+                        \" tries\");\n+        return \"Failed: cannot find a free port after \" +\n+                MAX_GET_FREE_PORT_TRIES + \" tries\";\n@@ -733,0 +710,1 @@\n+     *\n@@ -735,1 +713,2 @@\n-    private String testConfigurationKo(File conf) throws InterruptedException, IOException {\n+    private String testConfigurationKo(File conf)\n+            throws InterruptedException, IOException {\n@@ -740,1 +719,1 @@\n-                conf + \" should have failed!\";\n+                    conf + \" should have failed!\";\n@@ -743,1 +722,1 @@\n-                           conf + \" failed as expected\");\n+                conf + \" failed as expected\");\n@@ -751,2 +730,3 @@\n-     *     *ok.properties: bootstrap should succeed.\n-     *     *ko.properties: bootstrap or connection should fail.\n+     * *ok.properties: bootstrap should succeed.\n+     * *ko.properties: bootstrap or connection should fail.\n+     *\n@@ -755,1 +735,2 @@\n-    private String testConfigurationFile(String fileName) throws InterruptedException, IOException {\n+    private String testConfigurationFile(String fileName)\n+            throws InterruptedException, IOException {\n@@ -767,1 +748,1 @@\n-            \": test file suffix must be one of [ko|ok].properties\";\n+                \": test file suffix must be one of [ko|ok].properties\";\n@@ -773,0 +754,1 @@\n+     *\n@@ -775,3 +757,3 @@\n-    public void runko() throws InterruptedException, IOException {\n-        final File[] conf = findConfigurationFilesKo();\n-        if ((conf == null)||(conf.length == 0))\n+    public void runko(boolean useSsl) throws InterruptedException, IOException {\n+        final File[] conf = RmiTestBase.findConfigurationFilesKo(useSsl);\n+        if ((conf == null) || (conf.length == 0)) {\n@@ -779,0 +761,1 @@\n+        }\n@@ -781,1 +764,1 @@\n-        for (int i=0;i<conf.length;i++) {\n+        for (int i = 0; i < conf.length; i++) {\n@@ -793,0 +776,1 @@\n+     *\n@@ -795,3 +779,3 @@\n-    public void runok() throws InterruptedException, IOException {\n-        final File[] conf = findConfigurationFilesOk();\n-        if ((conf == null)||(conf.length == 0))\n+    public void runok(boolean useSsl) throws InterruptedException, IOException {\n+        final File[] conf = RmiTestBase.findConfigurationFilesOk(useSsl);\n+        if ((conf == null) || (conf.length == 0)) {\n@@ -799,0 +783,1 @@\n+        }\n@@ -801,1 +786,1 @@\n-        for (int i=0;i<conf.length;i++) {\n+        for (int i = 0; i < conf.length; i++) {\n@@ -823,0 +808,1 @@\n+     *\n@@ -825,3 +811,3 @@\n-    public void run() throws InterruptedException, IOException {\n-        runok();\n-        runko();\n+    public void run(boolean useSsl) throws InterruptedException, IOException {\n+        runok(useSsl);\n+        runko(useSsl);\n@@ -837,0 +823,1 @@\n+     *\n@@ -839,8 +826,9 @@\n-    public void run(String args[]) throws InterruptedException, IOException {\n-        if (args.length == 0) {\n-            run() ; return;\n-        }\n-        for (int i=0; i<args.length; i++) {\n-            final String errStr =testConfigurationFile(args[i]);\n-            if (errStr != null) {\n-                throw new RuntimeException(errStr);\n+    public void run(String[] args) throws InterruptedException, IOException {\n+        if (args.length == 1) {\n+            run(args[0].contains(\"ssl\"));\n+        } else {\n+            for (int i = 1; i < args.length; i++) {\n+                final String errStr = testConfigurationFile(args[i]);\n+                if (errStr != null) {\n+                    throw new RuntimeException(errStr);\n+                }\n@@ -850,27 +838,0 @@\n-\n-    \/**\n-     * Calls run(args[]).\n-     * exit(1) if the test fails.\n-     **\/\n-    public static void main(String args[]) throws Exception {\n-        Security.setProperty(\"jdk.tls.disabledAlgorithms\", \"\");\n-\n-        try {\n-            MAX_GET_FREE_PORT_TRIES = Integer.parseInt(System.getProperty(\"test.getfreeport.max.tries\", \"10\"));\n-        } catch (NumberFormatException ex) {\n-        }\n-\n-        RmiBootstrapTest manager = new RmiBootstrapTest();\n-        try {\n-            manager.run(args);\n-        } catch (RuntimeException r) {\n-            System.out.println(\"Test Failed: \"+ r.getMessage());\n-            System.exit(1);\n-        } catch (Throwable t) {\n-            System.out.println(\"Test Failed: \"+ t);\n-            t.printStackTrace();\n-            System.exit(2);\n-        }\n-        System.out.println(\"**** Test  RmiBootstrap Passed ****\");\n-    }\n-\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/RmiBootstrapTest.java","additions":359,"deletions":398,"binary":false,"changes":757,"status":"modified"},{"patch":"@@ -1,66 +0,0 @@\n-#\n-# Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     6528083\n-# @key intermittent\n-# @summary Test RMI Bootstrap\n-#\n-# @library \/test\/lib\n-#\n-# @build TestLogger Utils RmiBootstrapTest\n-# @run shell\/timeout=300  RmiBootstrapTest.sh\n-\n-# Define the Java class test name\n-TESTCLASS=\"RmiBootstrapTest\"\n-export TESTCLASS\n-\n-# Source in utility shell script to generate and remove .properties and .acl files\n-. ${TESTSRC}\/GeneratePropertyPassword.sh\n-\n-generatePropertyPasswordFiles `ls ${TESTSRC}\/*_test*.in`\n-\n-rm -rf ${TESTCLASSES}\/ssl\n-mkdir -p ${TESTCLASSES}\/ssl\n-cp -rf ${TESTSRC}\/ssl\/*store ${TESTCLASSES}\/ssl\n-chmod -R 777 ${TESTCLASSES}\/ssl\n-\n-DEBUGOPTIONS=\"\"\n-export DEBUGOPTIONS\n-\n-EXTRAOPTIONS=\"--add-exports jdk.management.agent\/jdk.internal.agent=ALL-UNNAMED \\\n- --add-exports jdk.management.agent\/sun.management.jmxremote=ALL-UNNAMED\"\n-export EXTRAOPTIONS\n-\n-# Call the common generic test\n-#\n-# No need to since bug 4267864 is now fixed.\n-#\n-echo -------------------------------------------------------------\n-echo Launching test for `basename $0 .sh`\n-echo -------------------------------------------------------------\n-sh ${TESTSRC}\/..\/RunTest.sh ${DEBUGOPTIONS} ${EXTRAOPTIONS} ${TESTCLASS}\n-result=$?\n-restoreFilePermissions `ls ${TESTSRC}\/*_test*.in`\n-exit $result\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/RmiBootstrapTest.sh","additions":0,"deletions":66,"binary":false,"changes":66,"status":"deleted"},{"patch":"@@ -1,64 +0,0 @@\n-#\n-# Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     6528083\n-# @summary Test RMI Bootstrap with SSL\n-#\n-# @library \/test\/lib\n-#\n-# @build TestLogger Utils RmiBootstrapTest\n-# @run shell\/timeout=300  RmiSslBootstrapTest.sh\n-\n-# Define the Java class test name\n-TESTCLASS=\"RmiBootstrapTest\"\n-export TESTCLASS\n-\n-# Source in utility shell script to generate and remove .properties and .acl files\n-. ${TESTSRC}\/GeneratePropertyPassword.sh\n-\n-generatePropertyPasswordFiles `ls ${TESTSRC}\/*_ssltest*.in`\n-\n-rm -rf ${TESTCLASSES}\/ssl\n-mkdir -p ${TESTCLASSES}\/ssl\n-cp -rf ${TESTSRC}\/ssl\/*store ${TESTCLASSES}\/ssl\n-chmod -R 777 ${TESTCLASSES}\/ssl\n-\n-DEBUGOPTIONS=\"\"\n-export DEBUGOPTIONS\n-\n-EXTRAOPTIONS=\"--add-exports jdk.management.agent\/jdk.internal.agent=ALL-UNNAMED \\\n- --add-exports jdk.management.agent\/sun.management.jmxremote=ALL-UNNAMED\"\n-export EXTRAOPTIONS\n-\n-# Call the common generic test\n-#\n-echo -------------------------------------------------------------\n-echo Launching test for `basename $0 .sh`\n-echo -------------------------------------------------------------\n-sh ${TESTSRC}\/..\/RunTest.sh ${DEBUGOPTIONS} ${EXTRAOPTIONS} ${TESTCLASS} \\\n-    ${TESTCLASSES}\/management_ssltest*.properties\n-result=$?\n-restoreFilePermissions `ls ${TESTSRC}\/*_ssltest*.in`\n-exit $result\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/RmiSslBootstrapTest.sh","additions":0,"deletions":64,"binary":false,"changes":64,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2004, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,0 +23,1 @@\n+\n@@ -27,2 +28,0 @@\n-import java.io.InputStream;\n-import java.io.FilenameFilter;\n@@ -31,0 +30,1 @@\n+import java.nio.file.Path;\n@@ -34,8 +34,1 @@\n-import java.util.Properties;\n-import java.util.Iterator;\n-import java.util.Set;\n-import java.util.Arrays;\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.Map;\n-import java.util.Enumeration;\n+import java.util.*;\n@@ -44,1 +37,0 @@\n-import javax.management.*;\n@@ -48,0 +40,11 @@\n+\/*\n+ * @test\n+ * @bug     4932854\n+ * @key     intermittent\n+ * @summary Test RMI Bootstrap with SSL and no keystore.\n+ *\n+ * @library \/test\/lib\n+ *\n+ * @run main\/timeout=300 RmiSslNoKeyStoreTest .*_ssltest.*.in\n+ * *\/\n+\n@@ -72,1 +75,1 @@\n-public class RmiSslNoKeyStoreTest {\n+public class RmiSslNoKeyStoreTest extends RmiTestBase {\n@@ -75,2 +78,1 @@\n-        new TestLogger(\"RmiSslNoKeyStoreTest\");\n-\n+            new TestLogger(\"RmiSslNoKeyStoreTest\");\n@@ -82,72 +84,4 @@\n-\n-    \/**\n-     * Default values for RMI configuration properties.\n-     **\/\n-    public static interface DefaultValues {\n-        public static final String PORT=\"0\";\n-        public static final String CONFIG_FILE_NAME=\"management.properties\";\n-        public static final String USE_SSL=\"true\";\n-        public static final String USE_AUTHENTICATION=\"true\";\n-        public static final String PASSWORD_FILE_NAME=\"jmxremote.password\";\n-        public static final String ACCESS_FILE_NAME=\"jmxremote.access\";\n-        public static final String KEYSTORE=\"keystore\";\n-        public static final String KEYSTORE_PASSWD=\"password\";\n-        public static final String TRUSTSTORE=\"truststore\";\n-        public static final String TRUSTSTORE_PASSWD=\"trustword\";\n-    }\n-\n-    \/**\n-     * Names of RMI configuration properties.\n-     **\/\n-    public static interface PropertyNames {\n-        public static final String PORT=\"com.sun.management.jmxremote.port\";\n-        public static final String CONFIG_FILE_NAME=\n-            \"com.sun.management.config.file\";\n-        public static final String USE_SSL=\"com.sun.management.jmxremote.ssl\";\n-        public static final String USE_AUTHENTICATION=\n-            \"com.sun.management.jmxremote.authenticate\";\n-        public static final String PASSWORD_FILE_NAME=\n-            \"com.sun.management.jmxremote.password.file\";\n-        public static final String ACCESS_FILE_NAME=\n-            \"com.sun.management.jmxremote.access.file\";\n-        public static final String INSTRUMENT_ALL=\n-            \"com.sun.management.instrumentall\";\n-        public static final String CREDENTIALS =\n-            \"jmx.remote.credentials\";\n-        public static final String KEYSTORE=\"javax.net.ssl.keyStore\";\n-        public static final String KEYSTORE_PASSWD=\n-            \"javax.net.ssl.keyStorePassword\";\n-        public static final String KEYSTORE_TYPE=\"javax.net.ssl.keyStoreType\";\n-        public static final String TRUSTSTORE=\"javax.net.ssl.trustStore\";\n-        public static final String TRUSTSTORE_PASSWD=\n-            \"javax.net.ssl.trustStorePassword\";\n-    }\n-\n-    \/**\n-     * Compute the full path name for a default file.\n-     * @param basename basename (with extension) of the default file.\n-     * @return ${JRE}\/conf\/management\/${basename}\n-     **\/\n-    private static String getDefaultFileName(String basename) {\n-        final String fileSeparator = File.separator;\n-        final StringBuffer defaultFileName =\n-            new StringBuffer(System.getProperty(\"java.home\")).\n-            append(fileSeparator).append(\"conf\").append(fileSeparator).\n-            append(\"management\").append(fileSeparator).\n-            append(basename);\n-        return defaultFileName.toString();\n-    }\n-\n-    \/**\n-     * Compute the full path name for a default file.\n-     * @param basename basename (with extension) of the default file.\n-     * @return ${JRE}\/conf\/management\/${basename}\n-     **\/\n-    private static String getDefaultStoreName(String basename) {\n-        final String fileSeparator = File.separator;\n-        final StringBuffer defaultFileName =\n-            new StringBuffer(System.getProperty(\"test.src\")).\n-            append(fileSeparator).append(\"ssl\").append(fileSeparator).\n-            append(basename);\n-        return defaultFileName.toString();\n-    }\n+    final String DEFAULT_KEY_STORE =\n+            getDefaultStoreName(DefaultValues.KEYSTORE);\n+    final String KEY_STORE =\n+            System.getProperty(PropertyNames.KEYSTORE, DEFAULT_KEY_STORE);\n@@ -156,3 +90,4 @@\n-        throws IOException, GeneralSecurityException {\n-        if (log.isDebugOn())\n-            log.debug(\"checkKeystore\",\"Checking Keystore configuration\");\n+            throws IOException, GeneralSecurityException {\n+        if (log.isDebugOn()) {\n+            log.debug(\"checkKeystore\", \"Checking Keystore configuration\");\n+        }\n@@ -161,2 +96,2 @@\n-            System.getProperty(PropertyNames.KEYSTORE);\n-        if (keyStore == null)\n+                System.getProperty(PropertyNames.KEYSTORE);\n+        if (keyStore == null) {\n@@ -164,2 +99,3 @@\n-                                               PropertyNames.KEYSTORE +\n-                                               \" not specified\");\n+                    PropertyNames.KEYSTORE +\n+                    \" not specified\");\n+        }\n@@ -168,1 +104,1 @@\n-            System.getProperty(PropertyNames.KEYSTORE_PASSWD);\n+                System.getProperty(PropertyNames.KEYSTORE_PASSWD);\n@@ -174,1 +110,1 @@\n-            if (! ksf.canRead())\n+            if (!ksf.canRead()) {\n@@ -176,0 +112,1 @@\n+            }\n@@ -177,1 +114,1 @@\n-            if (log.isDebugOn())\n+            if (log.isDebugOn()) {\n@@ -179,0 +116,1 @@\n+            }\n@@ -180,2 +118,2 @@\n-                                               PropertyNames.KEYSTORE_PASSWD +\n-                                               \" not specified\");\n+                    PropertyNames.KEYSTORE_PASSWD +\n+                    \" not specified\");\n@@ -188,3 +126,3 @@\n-            System.getProperty(PropertyNames.KEYSTORE_TYPE,\n-                               KeyStore.getDefaultType());\n-        final KeyStore ks         = KeyStore.getInstance(keyStoreType);\n+                System.getProperty(PropertyNames.KEYSTORE_TYPE,\n+                        KeyStore.getDefaultType());\n+        final KeyStore ks = KeyStore.getInstance(keyStoreType);\n@@ -192,1 +130,1 @@\n-        final char keypassword[]  = keyStorePass.toCharArray();\n+        final char keypassword[] = keyStorePass.toCharArray();\n@@ -195,1 +133,1 @@\n-            ks.load(fin,keypassword);\n+            ks.load(fin, keypassword);\n@@ -197,1 +135,1 @@\n-            Arrays.fill(keypassword,' ');\n+            Arrays.fill(keypassword, ' ');\n@@ -201,2 +139,31 @@\n-        if (log.isDebugOn())\n-            log.debug(\"checkSSL\",\"SSL configuration successfully checked\");\n+        if (log.isDebugOn()) {\n+            log.debug(\"checkSSL\", \"SSL configuration successfully checked\");\n+        }\n+    }\n+\n+    \/**\n+     * Calls run(args[]).\n+     * exit(1) if the test fails.\n+     **\/\n+    public static void main(String args[]) throws Exception {\n+        if (args.length == 0) {\n+            throw new IllegalArgumentException(\"Argument is required for this\" +\n+                    \" test\");\n+        }\n+\n+        final List<Path> credentialFiles = prepareTestFiles(args[0]);\n+\n+        RmiSslNoKeyStoreTest manager = new RmiSslNoKeyStoreTest();\n+        try {\n+            manager.run(args);\n+        } catch (RuntimeException r) {\n+            System.err.println(\"Test Failed: \" + r.getMessage());\n+            System.exit(1);\n+        } catch (Throwable t) {\n+            System.err.println(\"Test Failed: \" + t);\n+            t.printStackTrace();\n+            System.exit(2);\n+        }\n+        System.out.println(\"**** Test RmiSslNoKeyStoreTest Passed ****\");\n+\n+        grantFilesAccess(credentialFiles, AccessControl.EVERYONE);\n@@ -207,1 +174,1 @@\n-            getDefaultFileName(DefaultValues.CONFIG_FILE_NAME);\n+                getDefaultFileName(DefaultValues.CONFIG_FILE_NAME);\n@@ -209,1 +176,1 @@\n-            System.getProperty(PropertyNames.CONFIG_FILE_NAME,defaultConf);\n+                System.getProperty(PropertyNames.CONFIG_FILE_NAME, defaultConf);\n@@ -215,1 +182,5 @@\n-            try {props.load(fin);} finally {fin.close();}\n+            try {\n+                props.load(fin);\n+            } finally {\n+                fin.close();\n+            }\n@@ -219,3 +190,3 @@\n-        final String  useSslStr =\n-            props.getProperty(PropertyNames.USE_SSL,\n-                              DefaultValues.USE_SSL);\n+        final String useSslStr =\n+                props.getProperty(PropertyNames.USE_SSL,\n+                        DefaultValues.USE_SSL);\n@@ -223,1 +194,1 @@\n-            Boolean.valueOf(useSslStr).booleanValue();\n+                Boolean.valueOf(useSslStr).booleanValue();\n@@ -225,1 +196,2 @@\n-        log.debug(\"checkSslConfiguration\",PropertyNames.USE_SSL+\"=\"+useSsl);\n+        log.debug(\"checkSslConfiguration\",\n+                PropertyNames.USE_SSL + \"=\" + useSsl);\n@@ -228,1 +200,1 @@\n-                PropertyNames.USE_SSL+\"=\"+useSsl+\", can't run test\";\n+                    PropertyNames.USE_SSL + \"=\" + useSsl + \", can't run test\";\n@@ -236,1 +208,1 @@\n-            log.debug(\"checkSslConfiguration\",\"Test configuration OK: \" + x);\n+            log.debug(\"checkSslConfiguration\", \"Test configuration OK: \" + x);\n@@ -249,0 +221,1 @@\n+     *\n@@ -251,1 +224,1 @@\n-    private String testConfiguration(File file,int port) {\n+    private String testConfiguration(File file, int port) {\n@@ -253,2 +226,2 @@\n-        final String path = (file==null)?null:file.getAbsolutePath();\n-        final String config = (path==null)?\"Default config file\":path;\n+        final String path = (file == null) ? null : file.getAbsolutePath();\n+        final String config = (path == null) ? \"Default config file\" : path;\n@@ -258,2 +231,2 @@\n-            System.out.println(\"*** Testing configuration (port=\"+\n-                               port + \"): \"+ path);\n+            System.out.println(\"*** Testing configuration (port=\" +\n+                    port + \"): \" + path);\n@@ -263,2 +236,2 @@\n-                               Integer.toString(port));\n-            if (path != null)\n+                    Integer.toString(port));\n+            if (path != null) {\n@@ -266,1 +239,1 @@\n-            else\n+            } else {\n@@ -268,1 +241,2 @@\n-                    remove(\"com.sun.management.config.file\");\n+                        remove(\"com.sun.management.config.file\");\n+            }\n@@ -270,2 +244,3 @@\n-            log.trace(\"testConfiguration\",\"com.sun.management.jmxremote.port=\"+port);\n-            if (path != null && log.isDebugOn())\n+            log.trace(\"testConfiguration\",\n+                    \"com.sun.management.jmxremote.port=\" + port);\n+            if (path != null && log.isDebugOn()) {\n@@ -273,1 +248,2 @@\n-                          \"com.sun.management.config.file=\"+path);\n+                        \"com.sun.management.config.file=\" + path);\n+            }\n@@ -282,7 +258,8 @@\n-                    \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n-                    ((path!=null)?\"\\n\\tcom.sun.management.config.file=\"+path:\n-                     \"\\n\\t\"+config) +\n-                    \"\\n\\tError is: \" + x;\n-\n-                log.trace(\"testConfiguration\",\"Expected failure: \" + err);\n-                log.debug(\"testConfiguration\",x);\n+                        \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n+                        ((path != null) ?\n+                                \"\\n\\tcom.sun.management.config.file=\" + path :\n+                                \"\\n\\t\" + config) +\n+                        \"\\n\\tError is: \" + x;\n+\n+                log.trace(\"testConfiguration\", \"Expected failure: \" + err);\n+                log.debug(\"testConfiguration\", x);\n@@ -292,1 +269,1 @@\n-                log.debug(\"testConfiguration\",x);\n+                log.debug(\"testConfiguration\", x);\n@@ -297,1 +274,1 @@\n-                    JMXConnectorFactory.connect(cs.getAddress(), null);\n+                        JMXConnectorFactory.connect(cs.getAddress(), null);\n@@ -301,7 +278,8 @@\n-                    \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n-                    ((path!=null)?\"\\n\\tcom.sun.management.config.file=\"+path:\n-                     \"\\n\\t\"+config) +\n-                    \"\\n\\tError is: \" + x;\n-\n-                log.trace(\"testConfiguration\",\"Expected failure: \" + err);\n-                log.debug(\"testConfiguration\",x);\n+                        \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n+                        ((path != null) ?\n+                                \"\\n\\tcom.sun.management.config.file=\" + path :\n+                                \"\\n\\t\" + config) +\n+                        \"\\n\\tError is: \" + x;\n+\n+                log.trace(\"testConfiguration\", \"Expected failure: \" + err);\n+                log.debug(\"testConfiguration\", x);\n@@ -311,1 +289,1 @@\n-                log.debug(\"testConfiguration\",x);\n+                log.debug(\"testConfiguration\", x);\n@@ -317,3 +295,3 @@\n-                final String err = \"Failed to terminate: \"+x;\n-                log.trace(\"testConfiguration\",err);\n-                log.debug(\"testConfiguration\",x);\n+                final String err = \"Failed to terminate: \" + x;\n+                log.trace(\"testConfiguration\", err);\n+                log.debug(\"testConfiguration\", x);\n@@ -322,4 +300,5 @@\n-                \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n-                ((path!=null)?\"\\n\\tcom.sun.management.config.file=\"+path:\n-                 \"\\n\\t\"+config);\n-            log.trace(\"testConfiguration\",err);\n+                    \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n+                    ((path != null) ?\n+                            \"\\n\\tcom.sun.management.config.file=\" + path :\n+                            \"\\n\\t\" + config);\n+            log.trace(\"testConfiguration\", err);\n@@ -329,4 +308,5 @@\n-                \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n-                ((path!=null)?\"\\n\\tcom.sun.management.config.file=\"+path:\n-                 \"\\n\\t\"+config)+\n-                \"\\n\\tError is: \" + x;\n+                    \"\\n\\tcom.sun.management.jmxremote.port=\" + port +\n+                    ((path != null) ?\n+                            \"\\n\\tcom.sun.management.config.file=\" + path :\n+                            \"\\n\\t\" + config) +\n+                    \"\\n\\tError is: \" + x;\n@@ -334,2 +314,2 @@\n-            log.trace(\"testConfiguration\",err);\n-            log.debug(\"testConfiguration\",x);\n+            log.trace(\"testConfiguration\", err);\n+            log.debug(\"testConfiguration\", x);\n@@ -343,2 +323,3 @@\n-     *     *ok.properties: bootstrap should succeed.\n-     *     *ko.properties: bootstrap or connection should fail.\n+     * *ok.properties: bootstrap should succeed.\n+     * *ko.properties: bootstrap or connection should fail.\n+     *\n@@ -349,2 +330,2 @@\n-        final String portStr = System.getProperty(\"rmi.port\",\"12424\");\n-        final int port       = Integer.parseInt(portStr);\n+        final String portStr = System.getProperty(\"rmi.port\", \"12424\");\n+        final int port = Integer.parseInt(portStr);\n@@ -352,1 +333,1 @@\n-        return testConfiguration(file,port+testPort++);\n+        return testConfiguration(file, port + testPort++);\n@@ -355,1 +336,0 @@\n-\n@@ -357,7 +337,1 @@\n-     * Tests the specified configuration files.\n-     * If args[] is not empty, each element in args[] is expected to be\n-     * a filename ending either by ok.properties or ko.properties.\n-     * Otherwise, the configuration files will be automatically determined\n-     * by looking at all *.properties files located in the directory\n-     * indicated by the System property \"test.src\".\n-     * @throws RuntimeException if the test fails.\n+     * Test a configuration file.\n@@ -365,5 +339,5 @@\n-    public void run(String args[]) {\n-        final String defaultKeyStore =\n-            getDefaultStoreName(DefaultValues.KEYSTORE);\n-        final String keyStore =\n-            System.getProperty(PropertyNames.KEYSTORE, defaultKeyStore);\n+    private void runConfigurationFile(String fileName) {\n+        String errStr = testConfigurationFile(fileName);\n+        if (errStr != null) {\n+            throw new RuntimeException(errStr);\n+        }\n@@ -371,1 +345,3 @@\n-        for (int i=0; i<args.length; i++) {\n+        if ((System.getProperty(PropertyNames.KEYSTORE) == null) &&\n+                (System.getProperty(PropertyNames.KEYSTORE_PASSWD) == null)) {\n+            try {\n@@ -373,4 +349,5 @@\n-            String errStr =testConfigurationFile(args[i]);\n-            if (errStr != null) {\n-                throw new RuntimeException(errStr);\n-            }\n+                \/\/ Specify the keystore, but don't specify the\n+                \/\/ password.\n+                \/\/\n+                System.setProperty(PropertyNames.KEYSTORE, KEY_STORE);\n+                log.trace(\"run\", PropertyNames.KEYSTORE + \"=\" + KEY_STORE);\n@@ -378,16 +355,3 @@\n-            if ((System.getProperty(PropertyNames.KEYSTORE) == null) &&\n-                (System.getProperty(PropertyNames.KEYSTORE_PASSWD) == null)) {\n-                try {\n-\n-                    \/\/ Specify the keystore, but don't specify the\n-                    \/\/ password.\n-                    \/\/\n-                    System.setProperty(PropertyNames.KEYSTORE,keyStore);\n-                    log.trace(\"run\",PropertyNames.KEYSTORE+\"=\"+keyStore);\n-\n-                    errStr =testConfigurationFile(args[i]);\n-                    if (errStr != null) {\n-                        throw new RuntimeException(errStr);\n-                    }\n-                } finally {\n-                    System.getProperties().remove(PropertyNames.KEYSTORE);\n+                errStr = testConfigurationFile(fileName);\n+                if (errStr != null) {\n+                    throw new RuntimeException(errStr);\n@@ -395,0 +359,2 @@\n+            } finally {\n+                System.getProperties().remove(PropertyNames.KEYSTORE);\n@@ -400,2 +366,4 @@\n-     * Calls run(args[]).\n-     * exit(1) if the test fails.\n+     * Finds all configuration files (*ok.properties and *ko.properties)\n+     * and tests them.\n+     *\n+     * @throws RuntimeException if the test fails.\n@@ -403,11 +371,8 @@\n-    public static void main(String args[]) {\n-        RmiSslNoKeyStoreTest manager = new RmiSslNoKeyStoreTest();\n-        try {\n-            manager.run(args);\n-        } catch (RuntimeException r) {\n-            System.err.println(\"Test Failed: \"+ r.getMessage());\n-            System.exit(1);\n-        } catch (Throwable t) {\n-            System.err.println(\"Test Failed: \"+ t);\n-            t.printStackTrace();\n-            System.exit(2);\n+    public void run(boolean useSsl) throws IOException {\n+        final File[] conf = findAllConfigurationFiles(useSsl);\n+        if ((conf == null) || (conf.length == 0)) {\n+            throw new RuntimeException(\"No configuration found\");\n+        }\n+\n+        for (int i = 0; i < conf.length; i++) {\n+            runConfigurationFile(conf[i].toPath().toString());\n@@ -415,1 +380,0 @@\n-        System.out.println(\"**** Test RmiSslNoKeyStoreTest Passed ****\");\n@@ -418,0 +382,19 @@\n+    \/**\n+     * Tests the specified configuration files.\n+     * If args[] is not empty, each element in args[] is expected to be\n+     * a filename ending either by ok.properties or ko.properties.\n+     * Otherwise, the configuration files will be automatically determined\n+     * by looking at all *.properties files located in the directory\n+     * indicated by the System property \"test.src\".\n+     *\n+     * @throws RuntimeException if the test fails.\n+     **\/\n+    public void run(String args[]) throws IOException {\n+        if (args.length == 1) {\n+            run(args[0].contains(\"ssl\"));\n+        } else {\n+            for (int i = 1; i < args.length; i++) {\n+                runConfigurationFile(args[i]);\n+            }\n+        }\n+    }\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/RmiSslNoKeyStoreTest.java","additions":195,"deletions":212,"binary":false,"changes":407,"status":"modified"},{"patch":"@@ -1,62 +0,0 @@\n-#\n-# Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @summary Test RMI Bootstrap with SSL and no keystore.\n-# @bug 4932854\n-#\n-# @build TestLogger RmiSslNoKeyStoreTest\n-# @run shell\/timeout=300  RmiSslNoKeyStoreTest.sh\n-\n-# Define the Java class test name\n-TESTCLASS=\"RmiSslNoKeyStoreTest\"\n-export TESTCLASS\n-\n-# Source in utility shell script to generate and remove .properties and .acl files\n-. ${TESTSRC}\/GeneratePropertyPassword.sh\n-\n-generatePropertyPasswordFiles `ls ${TESTSRC}\/*_ssltest*.in`\n-\n-rm -rf ${TESTCLASSES}\/ssl\n-mkdir -p ${TESTCLASSES}\/ssl\n-cp -rf ${TESTSRC}\/ssl\/*store ${TESTCLASSES}\/ssl\n-chmod -R 777 ${TESTCLASSES}\/ssl\n-\n-DEBUGOPTIONS=\"\"\n-export DEBUGOPTIONS\n-\n-EXTRAOPTIONS=\"--add-exports jdk.management.agent\/jdk.internal.agent=ALL-UNNAMED \\\n- --add-exports jdk.management.agent\/sun.management.jmxremote=ALL-UNNAMED\"\n-export EXTRAOPTIONS\n-\n-# Call the common generic test\n-#\n-echo -------------------------------------------------------------\n-echo Launching test for `basename $0 .sh`\n-echo -------------------------------------------------------------\n-sh ${TESTSRC}\/..\/RunTest.sh ${DEBUGOPTIONS} ${EXTRAOPTIONS} ${TESTCLASS} \\\n-    ${TESTCLASSES}\/management_ssltest*.properties\n-result=$?\n-restoreFilePermissions `ls ${TESTSRC}\/*_ssltest*.in`\n-exit $result\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/RmiSslNoKeyStoreTest.sh","additions":0,"deletions":62,"binary":false,"changes":62,"status":"deleted"},{"patch":"@@ -0,0 +1,303 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import java.io.File;\n+import java.io.FilenameFilter;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.nio.file.StandardCopyOption;\n+import java.nio.file.attribute.AclEntry;\n+import java.nio.file.attribute.AclEntryType;\n+import java.nio.file.attribute.AclFileAttributeView;\n+import java.nio.file.attribute.PosixFilePermissions;\n+import java.util.*;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+public class RmiTestBase {\n+    static final String SEP = System.getProperty(\"file.separator\");\n+    static final String SRC = System.getProperty(\"test.src\");\n+    static final String DEST = System.getProperty(\"test.classes\");\n+    static final String SRC_SSL = SRC + SEP + \"ssl\";\n+    static final String DEST_SSL = DEST + SEP + \"ssl\";\n+    static final String TEST_SRC = \"@TEST-SRC@\";\n+\n+    static final boolean isWindows = System.getProperty(\"os.name\").contains(\n+            \"Win\");\n+\n+    \/**\n+     * A filter to find all filenames who match <prefix>*<suffix>.\n+     * Note that <prefix> and <suffix> can overlap.\n+     **\/\n+    static class FilenameFilterFactory {\n+        static FilenameFilter prefixSuffix(final String p, final String s) {\n+            return (dir, name) -> name.startsWith(p) && name.endsWith(s);\n+        }\n+    }\n+\n+    enum AccessControl {\n+        OWNER,\n+        EVERYONE,\n+    }\n+\n+    \/**\n+     * Default values for RMI configuration properties.\n+     **\/\n+    public interface DefaultValues {\n+        String PORT = \"0\";\n+        String CONFIG_FILE_NAME = \"management.properties\";\n+        String USE_SSL = \"true\";\n+        String USE_AUTHENTICATION = \"true\";\n+        String PASSWORD_FILE_NAME = \"jmxremote.password\";\n+        String ACCESS_FILE_NAME = \"jmxremote.access\";\n+        String KEYSTORE = \"keystore\";\n+        String KEYSTORE_PASSWD = \"password\";\n+        String TRUSTSTORE = \"truststore\";\n+        String TRUSTSTORE_PASSWD = \"trustword\";\n+        String SSL_NEED_CLIENT_AUTH = \"false\";\n+    }\n+\n+    \/**\n+     * Names of RMI configuration properties.\n+     **\/\n+    public interface PropertyNames {\n+        String PORT = \"com.sun.management.jmxremote.port\";\n+        String CONFIG_FILE_NAME = \"com.sun.management.config.file\";\n+        String USE_SSL = \"com.sun.management.jmxremote.ssl\";\n+        String USE_AUTHENTICATION = \"com.sun.management.jmxremote.authenticate\";\n+        String PASSWORD_FILE_NAME =\n+                \"com.sun.management.jmxremote.password.file\";\n+        String ACCESS_FILE_NAME =\n+                \"com.sun.management.jmxremote.access.file\";\n+        String INSTRUMENT_ALL = \"com.sun.management.instrumentall\";\n+        String CREDENTIALS = \"jmx.remote.credentials\";\n+        String KEYSTORE = \"javax.net.ssl.keyStore\";\n+        String KEYSTORE_PASSWD = \"javax.net.ssl.keyStorePassword\";\n+        String KEYSTORE_TYPE = \"javax.net.ssl.keyStoreType\";\n+        String TRUSTSTORE = \"javax.net.ssl.trustStore\";\n+        String TRUSTSTORE_PASSWD = \"javax.net.ssl.trustStorePassword\";\n+        String SSL_ENABLED_CIPHER_SUITES =\n+                \"com.sun.management.jmxremote.ssl.enabled.cipher.suites\";\n+        String SSL_ENABLED_PROTOCOLS =\n+                \"com.sun.management.jmxremote.ssl.enabled.protocols\";\n+        String SSL_NEED_CLIENT_AUTH =\n+                \"com.sun.management.jmxremote.ssl.need.client.auth\";\n+        String SSL_CLIENT_ENABLED_CIPHER_SUITES =\n+                \"javax.rmi.ssl.client.enabledCipherSuites\";\n+    }\n+\n+    static String getDefaultFileName(String basename) {\n+        final StringBuffer defaultFileName =\n+                new StringBuffer(System.getProperty(\"java.home\"))\n+                        .append(SEP)\n+                        .append(\"conf\")\n+                        .append(SEP)\n+                        .append(\"management\")\n+                        .append(SEP)\n+                        .append(basename);\n+        return defaultFileName.toString();\n+    }\n+\n+    \/**\n+     * Compute the full path name for a default file.\n+     *\n+     * @param basename basename (with extension) of the default file.\n+     * @return ${JRE}\/conf\/management\/${basename}\n+     **\/\n+    static String getDefaultStoreName(String basename) {\n+        final StringBuffer defaultFileName =\n+                new StringBuffer(SRC)\n+                        .append(SEP)\n+                        .append(\"ssl\")\n+                        .append(SEP)\n+                        .append(basename);\n+        return defaultFileName.toString();\n+    }\n+\n+    \/**\n+     * Copy test artifacts to test folder.\n+     *\n+     * @param filenamePattern the filename pattern to look for\n+     * @return                files who match the filename pattern\n+     * @throws IOException    if error occurs\n+     *\/\n+    static List<Path> prepareTestFiles(String filenamePattern)\n+            throws IOException {\n+        copySsl();\n+        List<Path> files = Utils.findFiles(Paths.get(SRC),\n+                (dir, name) -> name.matches(filenamePattern));\n+\n+        final Function<String, String> removeSuffix = (s) -> s.substring(0,\n+                s.lastIndexOf(\".\"));\n+\n+        List<Path> propertyFiles = Utils.copyFiles(files, Paths.get(DEST),\n+                removeSuffix,\n+                StandardCopyOption.REPLACE_EXISTING);\n+\n+        if (isWindows) {\n+            Utils.replaceFilesString(propertyFiles,\n+                    (s) -> s.replace(TEST_SRC, DEST)\n+                            .replaceAll(\"[\/\\\\\\\\]\", \"\\\\\\\\\\\\\\\\\"));\n+        } else {\n+            Utils.replaceFilesString(propertyFiles,\n+                    (s) -> s.replace(TEST_SRC, DEST));\n+        }\n+\n+        grantFilesAccess(propertyFiles, AccessControl.OWNER);\n+\n+        return Collections.unmodifiableList(files);\n+    }\n+\n+    \/**\n+     * Grant file access.\n+     *\n+     * @param file   file to grant access\n+     * @param access user access or full access\n+     * @throws IOException if error occurs\n+     *\/\n+    static void grantAccess(Path file, AccessControl access)\n+            throws IOException {\n+        Set<String> attr = file.getFileSystem().supportedFileAttributeViews();\n+        if (attr.contains(\"posix\")) {\n+            String perms = access == AccessControl.OWNER ? \"rw-------\" :\n+                    \"rwxrwxrwx\";\n+            Files.setPosixFilePermissions(file,\n+                    PosixFilePermissions.fromString(perms));\n+        } else if (attr.contains(\"acl\")) {\n+            AclFileAttributeView view = Files.getFileAttributeView(file,\n+                    AclFileAttributeView.class);\n+            List<AclEntry> acl = new ArrayList<>();\n+            for (AclEntry thisEntry : view.getAcl()) {\n+                if (access == AccessControl.OWNER) {\n+                    if (thisEntry.principal().getName()\n+                            .equals(view.getOwner().getName())) {\n+                        acl.add(Utils.allowAccess(thisEntry));\n+                    } else if (thisEntry.type() == AclEntryType.ALLOW) {\n+                        acl.add(Utils.revokeAccess(thisEntry));\n+                    } else {\n+                        acl.add(thisEntry);\n+                    }\n+                } else {\n+                    if (!thisEntry.principal().getName().contains(\"NULL SID\")\n+                            && thisEntry.type() != AclEntryType.ALLOW) {\n+                        acl.add(Utils.allowAccess(thisEntry));\n+                    } else {\n+                        acl.add(thisEntry);\n+                    }\n+                }\n+            }\n+            view.setAcl(acl);\n+        } else {\n+            throw new RuntimeException(\"Unsupported file attributes: \" + attr);\n+        }\n+    }\n+\n+    \/**\n+     * Grant files' access.\n+     *\n+     * @param files  files to grant access\n+     * @param access user access or full access\n+     * @throws IOException if error occurs\n+     *\/\n+    static void grantFilesAccess(List<Path> files, AccessControl access)\n+            throws IOException {\n+        for (Path thisFile : files) {\n+            grantAccess(thisFile, access);\n+        }\n+    }\n+\n+    \/**\n+     * Copy SSL files to test folder.\n+     *\n+     * @throws IOException\n+     *\/\n+    static void copySsl() throws IOException {\n+        Path sslSource = Paths.get(SRC_SSL);\n+        Path sslTarget = Paths.get(DEST_SSL);\n+\n+        List<Path> files = Arrays.stream(sslSource.toFile().listFiles())\n+                .map(File::toPath)\n+                .collect(Collectors.toList());\n+        Utils.copyFiles(\n+                files,\n+                sslTarget,\n+                StandardCopyOption.REPLACE_EXISTING);\n+\n+        for (Path file : files) {\n+            grantAccess(sslTarget.resolve(file.getFileName()),\n+                    AccessControl.EVERYONE);\n+        }\n+    }\n+\n+    \/**\n+     * Get all \"management*ok.properties\" files in the directory\n+     * indicated by the \"test.src\" management property.\n+     *\n+     * @param useSsl boolean that indicates if test uses SSL\n+     * @return       configuration files\n+     **\/\n+    static File[] findConfigurationFilesOk(boolean useSsl) {\n+        String prefix = useSsl ? \"management_ssltest\" : \"management_test\";\n+        return findAllConfigurationFiles(prefix, \"ok.properties\");\n+    }\n+\n+    \/**\n+     * Get all \"management*ko.properties\" files in the directory\n+     * indicated by the \"test.src\" management property.\n+     * @param useSsl boolean that indicates if test uses SSL\n+     * @return       configuration files\n+     **\/\n+    static File[] findConfigurationFilesKo(boolean useSsl) {\n+        String prefix = useSsl ? \"management_ssltest\" : \"management_test\";\n+        return findAllConfigurationFiles(prefix, \"ko.properties\");\n+    }\n+\n+    \/**\n+     * Get all \"management*.properties\" files in the directory\n+     * indicated by the \"test.src\" management property.\n+     *\n+     * @param useSsl boolean that indicates if test uses SSL\n+     * @return       configuration files\n+     **\/\n+    static File[] findAllConfigurationFiles(boolean useSsl) {\n+        String prefix = useSsl ? \"management_ssltest\" : \"management_test\";\n+        return findAllConfigurationFiles(prefix, \"properties\");\n+    }\n+\n+    \/**\n+     * Get all \"management*.properties\" files in the directory\n+     * indicated by the \"test.src\" management property.\n+     *\n+     * @param prefix  filename prefix\n+     * @param suffix  filename suffix\n+     * @return        configuration files\n+     **\/\n+     static File[] findAllConfigurationFiles(String prefix, String suffix) {\n+        final File dir = new File(DEST);\n+        final FilenameFilter filter =\n+                FilenameFilterFactory.prefixSuffix(prefix, suffix);\n+        return dir.listFiles(filter);\n+    }\n+}\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/RmiTestBase.java","additions":303,"deletions":0,"binary":false,"changes":303,"status":"added"},{"patch":"@@ -24,0 +24,9 @@\n+import java.io.*;\n+import java.nio.file.CopyOption;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.attribute.*;\n+import java.util.*;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n@@ -49,0 +58,137 @@\n+\n+    \/**\n+     * Return file directories that satisfy the specified filter.\n+     *\n+     * @param searchDirectory the base directory to search\n+     * @param filter          a filename filter\n+     * @return                file directories\n+     *\/\n+    public static List<Path> findFiles(Path searchDirectory,\n+            FilenameFilter filter) {\n+        return Arrays.stream(searchDirectory.toFile().listFiles(filter))\n+                .map(f -> f.toPath())\n+                .collect(Collectors.toList());\n+    }\n+\n+    \/**\n+     * Copy files to the target path.\n+     *\n+     * @param source         the paths to the files to copy\n+     * @param target         the path to the target files\n+     * @param filenameMapper mapper function applied to filenames\n+     * @param options        options specifying how the copy should be done\n+     * @return               the paths to the target files\n+     * @throws IOException   if error occurs\n+     *\/\n+    public static List<Path> copyFiles(List<Path> source, Path target,\n+            Function<String, String> filenameMapper,\n+            CopyOption... options) throws IOException {\n+        List<Path> result = new ArrayList<>();\n+\n+        if (!target.toFile().exists()) {\n+            Files.createDirectory(target);\n+        }\n+\n+        for (Path file : source) {\n+            if (!file.toFile().exists()) {\n+                continue;\n+            }\n+\n+            String baseName = file.getFileName().toString();\n+\n+            Path targetFile = target.resolve(filenameMapper.apply(baseName));\n+            Files.copy(file, targetFile, options);\n+            result.add(targetFile);\n+        }\n+        return result;\n+    }\n+\n+    \/**\n+     * Copy files to the target path.\n+     *\n+     * @param source         the paths to the files to copy\n+     * @param target         the path to the target files\n+     * @param options        options specifying how the copy should be done\n+     * @return               the paths to the target files\n+     * @throws IOException   if error occurs\n+     *\/\n+    public static List<Path> copyFiles(List<Path> source, Path target,\n+            CopyOption... options) throws IOException {\n+        return copyFiles(source, target, (s) -> s, options);\n+    }\n+\n+    \/**\n+     * Return an ACL entry that revokes owner access.\n+     *\n+     * @param acl   original ACL entry to build from\n+     * @return      an ACL entry that revokes all access\n+     *\/\n+    public static AclEntry revokeAccess(AclEntry acl) {\n+        return buildAclEntry(acl, AclEntryType.DENY);\n+    }\n+\n+    \/**\n+     * Return an ACL entry that allow owner access.\n+     * @param acl   original ACL entry to build from\n+     * @return      an ACL entry that allows all access\n+     *\/\n+    public static AclEntry allowAccess(AclEntry acl) {\n+        return buildAclEntry(acl, AclEntryType.ALLOW);\n+    }\n+\n+    \/**\n+     * Build an ACL entry with a given ACL entry type.\n+     *\n+     * @param acl   original ACL entry to build from\n+     * @return      an ACL entry with a given ACL entry type\n+     *\/\n+    public static AclEntry buildAclEntry(AclEntry acl, AclEntryType type) {\n+        return AclEntry.newBuilder()\n+                .setType(type)\n+                .setPrincipal(acl.principal())\n+                .setPermissions(acl.permissions())\n+                .build();\n+    }\n+\n+    \/**\n+     * Replace file string by applying the given mapper function.\n+     *\n+     * @param source        the file to read\n+     * @param contentMapper the mapper function applied to file's content\n+     * @throws IOException  if an I\/O error occurs\n+     *\/\n+    public static void replaceFileString(Path source,\n+            Function<String, String> contentMapper) throws IOException {\n+        StringBuilder sb = new StringBuilder();\n+        String lineSep = System.getProperty(\"line.separator\");\n+\n+        try (BufferedReader reader =\n+                new BufferedReader(new FileReader(source.toFile()))) {\n+\n+            String line;\n+\n+            \/\/ read all and replace all at once??\n+            while ((line = reader.readLine()) != null) {\n+                sb.append(contentMapper.apply(line))\n+                        .append(lineSep);\n+            }\n+        }\n+\n+        try (FileWriter writer = new FileWriter(source.toFile())) {\n+            writer.write(sb.toString());\n+        }\n+    }\n+\n+    \/**\n+     * Replace files' string by applying the given mapper function.\n+     *\n+     * @param source        the file to read\n+     * @param contentMapper the mapper function applied to files' content\n+     * @throws IOException  if an I\/O error occurs\n+     *\/\n+    public static void replaceFilesString(List<Path> source,\n+            Function<String, String> contentMapper) throws IOException {\n+        for (Path file : source) {\n+            replaceFileString(file, contentMapper);\n+        }\n+    }\n","filename":"test\/jdk\/sun\/management\/jmxremote\/bootstrap\/Utils.java","additions":146,"deletions":0,"binary":false,"changes":146,"status":"modified"}]}