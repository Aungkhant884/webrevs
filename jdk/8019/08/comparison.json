{"files":[{"patch":"@@ -257,0 +257,2 @@\n+    ConnectionGraph::print_statistics();\n+    PhaseMacroExpand::print_statistics();\n@@ -2177,0 +2179,1 @@\n+\n@@ -2207,0 +2210,1 @@\n+\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -98,0 +98,6 @@\n+#ifndef PRODUCT\n+  elapsedTimer et;\n+  if (PrintOptoStatistics) {\n+    et.start();\n+  }\n+#endif\n@@ -119,0 +125,8 @@\n+\n+#ifndef PRODUCT\n+  if (PrintOptoStatistics) {\n+    et.stop();\n+    \/\/ casting jlong to long since Atomic needs Integral type\n+    Atomic::add(&ConnectionGraph::_time_elapsed, (long)et.milliseconds());\n+  }\n+#endif\n@@ -236,0 +250,3 @@\n+#ifndef PRODUCT\n+    escape_state_statistics(java_objects_worklist);\n+#endif\n@@ -265,1 +282,4 @@\n-  if (C->failing())  return false;\n+  if (C->failing()) {\n+    NOT_PRODUCT(escape_state_statistics(java_objects_worklist);)\n+    return false;\n+  }\n@@ -273,0 +293,1 @@\n+    NOT_PRODUCT(escape_state_statistics(java_objects_worklist);)\n@@ -342,1 +363,4 @@\n-    if (C->failing())  return false;\n+    if (C->failing()) {\n+      NOT_PRODUCT(escape_state_statistics(java_objects_worklist);)\n+      return false;\n+    }\n@@ -377,1 +401,2 @@\n-\n+  \n+  NOT_PRODUCT(escape_state_statistics(java_objects_worklist);)\n@@ -3634,0 +3659,5 @@\n+int ConnectionGraph::_no_escape_counter = 0;\n+int ConnectionGraph::_arg_escape_counter = 0;\n+int ConnectionGraph::_global_escape_counter = 0;\n+long ConnectionGraph::_time_elapsed = 0;\n+\n@@ -3742,0 +3772,26 @@\n+void ConnectionGraph::print_statistics() {\n+  tty->print(\"No escape = %d, Arg escape = %d, Global escape = %d\", Atomic::load(&_no_escape_counter), Atomic::load(&_arg_escape_counter), Atomic::load(&_global_escape_counter));\n+  tty->print(\" (EA executed in %7.2f seconds)\", Atomic::load(&_time_elapsed) * 0.001);\n+  tty->print_cr(\"   ** EA stats might be slightly off since objects might be double counted due to iterative EA **\");\n+}\n+\n+void ConnectionGraph::escape_state_statistics(GrowableArray<JavaObjectNode*>& java_objects_worklist) {\n+  if (!PrintOptoStatistics) {\n+    return;\n+  }\n+  for (int next = 0; next < java_objects_worklist.length(); ++next) {\n+    JavaObjectNode* ptn = java_objects_worklist.at(next);\n+    if (ptn->ideal_node()->is_Allocate()) {\n+      if(ptn->escape_state() == PointsToNode::NoEscape) {\n+        _no_escape_counter++;\n+      } else if (ptn->escape_state() == PointsToNode::ArgEscape) {\n+        _arg_escape_counter++;\n+      } else if (ptn->escape_state() == PointsToNode::GlobalEscape) {\n+        _global_escape_counter++;\n+      } else {\n+        assert(false, \"Unexpected Escape State\");\n+      }\n+    }\n+  }\n+}\n+\n","filename":"src\/hotspot\/share\/opto\/escape.cpp","additions":59,"deletions":3,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -639,0 +639,4 @@\n+  static int _no_escape_counter;\n+  static int _arg_escape_counter;\n+  static int _global_escape_counter;\n+  static long _time_elapsed;\n@@ -640,0 +644,2 @@\n+  static void print_statistics();\n+  void escape_state_statistics(GrowableArray<JavaObjectNode*>& java_objects_worklist);\n","filename":"src\/hotspot\/share\/opto\/escape.hpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -162,0 +162,5 @@\n+#ifndef PRODUCT\n+  if (PrintOptoStatistics) {\n+    Atomic::add(&PhaseMacroExpand::_GC_barriers_removed_counter, 1);\n+  }\n+#endif\n@@ -2312,0 +2317,2 @@\n+    NOT_PRODUCT(int membar_before = count_MemBar();)\n+\n@@ -2337,0 +2344,5 @@\n+#ifndef PRODUCT\n+        if(success && PrintOptoStatistics) {\n+          Atomic::add(&PhaseMacroExpand::_monitor_objects_removed_counter, 1);\n+        }\n+#endif\n@@ -2355,0 +2367,5 @@\n+#ifndef PRODUCT\n+        if (success && PrintOptoStatistics) {\n+          Atomic::add(&PhaseMacroExpand::_objs_scalar_replaced_counter, 1);\n+        }\n+#endif\n@@ -2384,0 +2401,6 @@\n+#ifndef PRODUCT\n+  if (PrintOptoStatistics) {\n+    int membar_after = count_MemBar();\n+    Atomic::add(&PhaseMacroExpand::_memory_barriers_removed_counter, membar_before - membar_after);\n+  }\n+#endif\n@@ -2572,0 +2595,35 @@\n+\n+#ifndef PRODUCT\n+int PhaseMacroExpand::_objs_scalar_replaced_counter = 0;\n+int PhaseMacroExpand::_monitor_objects_removed_counter = 0;\n+int PhaseMacroExpand::_GC_barriers_removed_counter = 0;\n+int PhaseMacroExpand::_memory_barriers_removed_counter = 0;\n+\n+void PhaseMacroExpand::print_statistics() {\n+  tty->print(\"Objects scalar replaced = %d, \", Atomic::load(&_objs_scalar_replaced_counter));\n+  tty->print(\"Monitor objects removed = %d, \", Atomic::load(&_monitor_objects_removed_counter));\n+  tty->print(\"GC barriers removed = %d, \", Atomic::load(&_GC_barriers_removed_counter));\n+  tty->print_cr(\"Memory barriers removed = %d\", Atomic::load(&_memory_barriers_removed_counter));\n+}\n+\n+int PhaseMacroExpand::count_MemBar() {\n+  if(!PrintOptoStatistics) { \n+    return 0; \n+  }\n+  Unique_Node_List ideal_nodes;\n+  int total = 0;\n+  ideal_nodes.map(C->live_nodes(), NULL);\n+  ideal_nodes.push(C->root());\n+  for( uint next = 0; next < ideal_nodes.size(); ++next ) {\n+    Node* n = ideal_nodes.at(next);\n+    if (n->is_MemBar()) {\n+      total++;\n+    }\n+    for (DUIterator_Fast imax, i = n->fast_outs(imax); i < imax; i++) {\n+      Node* m = n->fast_out(i);\n+      ideal_nodes.push(m);\n+    }\n+  }\n+  return total;\n+}\n+#endif\n","filename":"src\/hotspot\/share\/opto\/macro.cpp","additions":58,"deletions":0,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -211,0 +211,9 @@\n+#ifndef PRODUCT\n+    static int _objs_scalar_replaced_counter;\n+    static int _monitor_objects_removed_counter;\n+    static int _GC_barriers_removed_counter;\n+    static int _memory_barriers_removed_counter;\n+    static void print_statistics();\n+    int count_MemBar();\n+#endif\n+\n","filename":"src\/hotspot\/share\/opto\/macro.hpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}