{"files":[{"patch":"@@ -260,1 +260,1 @@\n-                  r->has_surv_rate_group() ? r->age_in_surv_rate_group() : -1);\n+                  r->has_surv_rate_group() ? checked_cast<int>(r->age_in_surv_rate_group()) : -1);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectionSet.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -35,0 +35,1 @@\n+  _num_added_regions(0),\n@@ -37,2 +38,1 @@\n-  _surv_rate_predictors(nullptr),\n-  _num_added_regions(0) {\n+  _surv_rate_predictors(nullptr) {\n@@ -85,3 +85,2 @@\n-void G1SurvRateGroup::record_surviving_words(int age_in_group, size_t surv_words) {\n-  guarantee(0 <= age_in_group && (size_t)age_in_group < _num_added_regions,\n-            \"age_in_group is %d not between 0 and \" SIZE_FORMAT, age_in_group, _num_added_regions);\n+void G1SurvRateGroup::record_surviving_words(uint age, size_t surv_words) {\n+  assert(is_valid_age(age), \"age is %u not between 0 and %u\", age, _num_added_regions);\n@@ -90,1 +89,1 @@\n-  _surv_rate_predictors[age_in_group]->add(surv_rate);\n+  _surv_rate_predictors[age]->add(surv_rate);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1SurvRateGroup.cpp","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -52,1 +52,3 @@\n-  size_t  _stats_arrays_length;\n+  uint _stats_arrays_length;\n+  uint _num_added_regions;   \/\/ The number of regions in this survivor rate group.\n+\n@@ -57,2 +59,0 @@\n-  size_t _num_added_regions;   \/\/ The number of regions in this survivor rate group.\n-\n@@ -63,2 +63,5 @@\n-  static const int InvalidAgeIndex = -1;\n-  static bool is_valid_age_index(int age) { return age >= 0; }\n+  static const uint InvalidAgeIndex = UINT_MAX;\n+  bool is_valid_age_index(uint age_index) const {\n+    return age_index >= 1 && age_index <= _num_added_regions;\n+  }\n+  bool is_valid_age(uint age) const { return age < _num_added_regions; }\n@@ -70,1 +73,1 @@\n-  void record_surviving_words(int age_in_group, size_t surv_words);\n+  void record_surviving_words(uint age, size_t surv_words);\n@@ -73,1 +76,1 @@\n-  double accum_surv_rate_pred(int age) const {\n+  double accum_surv_rate_pred(uint age) const {\n@@ -75,2 +78,1 @@\n-    assert(is_valid_age_index(age), \"must be\");\n-    if ((size_t)age < _stats_arrays_length)\n+    if (age < _stats_arrays_length)\n@@ -84,4 +86,2 @@\n-  double surv_rate_pred(G1Predictions const& predictor, int age) const {\n-    assert(is_valid_age_index(age), \"must be\");\n-\n-    age = MIN2(age, (int)_stats_arrays_length - 1);\n+  double surv_rate_pred(G1Predictions const& predictor, uint age) const {\n+    assert(is_valid_age(age), \"must be\");\n@@ -92,2 +92,2 @@\n-  int next_age_index() {\n-    return (int)++_num_added_regions;\n+  uint next_age_index() {\n+    return ++_num_added_regions;\n@@ -96,4 +96,3 @@\n-  int age_in_group(int age_index) const {\n-    int result = (int)(_num_added_regions - age_index);\n-    assert(is_valid_age_index(result), \"invariant\" );\n-    return result;\n+  uint age_in_group(uint age_index) const {\n+    assert(is_valid_age_index(age_index), \"invariant\" );\n+    return _num_added_regions - age_index;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1SurvRateGroup.hpp","additions":18,"deletions":19,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -247,1 +247,1 @@\n-  int  _age_index;\n+  uint  _age_index;\n@@ -510,1 +510,1 @@\n-  int age_in_surv_rate_group() const;\n+  uint age_in_surv_rate_group() const;\n","filename":"src\/hotspot\/share\/gc\/g1\/heapRegion.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -504,1 +504,1 @@\n-inline int HeapRegion::age_in_surv_rate_group() const {\n+inline uint HeapRegion::age_in_surv_rate_group() const {\n@@ -511,1 +511,1 @@\n-  return G1SurvRateGroup::is_valid_age_index(_age_index);\n+  return _surv_rate_group->is_valid_age_index(_age_index);\n@@ -540,1 +540,1 @@\n-    assert(!has_valid_age_in_surv_rate(), \"pre-condition\");\n+    assert(_age_index == G1SurvRateGroup::InvalidAgeIndex, \"inv\");\n@@ -545,4 +545,2 @@\n-  assert(has_surv_rate_group(), \"pre-condition\");\n-  assert(has_valid_age_in_surv_rate(), \"pre-condition\");\n-  int age_in_group = age_in_surv_rate_group();\n-  _surv_rate_group->record_surviving_words(age_in_group, words_survived);\n+  uint age = age_in_surv_rate_group();\n+  _surv_rate_group->record_surviving_words(age, words_survived);\n","filename":"src\/hotspot\/share\/gc\/g1\/heapRegion.inline.hpp","additions":5,"deletions":7,"binary":false,"changes":12,"status":"modified"}]}