{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -357,0 +357,6 @@\n+static void reportFcloseExit(FILE *fptr, const char* fmt, const char* arg) {\n+    if (fmt != NULL) JLI_ReportMessage(fmt, arg);\n+    if (fptr != NULL) fclose(fptr);\n+    exit(1);\n+}\n+\n@@ -363,2 +369,0 @@\n-    FILE *fptr;\n-    struct stat st;\n@@ -366,0 +370,2 @@\n+    struct stat st;\n+    FILE *fptr = fopen(arg, \"r\");\n@@ -367,12 +373,0 @@\n-    \/* failed to access the file *\/\n-    if (stat(arg, &st) != 0) {\n-        JLI_ReportMessage(CFG_ERROR6, arg);\n-        exit(1);\n-    }\n-\n-    if (st.st_size > MAX_ARGF_SIZE) {\n-        JLI_ReportMessage(CFG_ERROR10, MAX_ARGF_SIZE);\n-        exit(1);\n-    }\n-\n-    fptr = fopen(arg, \"r\");\n@@ -380,3 +374,7 @@\n-    if (fptr == NULL) {\n-        JLI_ReportMessage(CFG_ERROR6, arg);\n-        exit(1);\n+    if (fptr == NULL || fstat(fileno(fptr), &st) != 0) {\n+        reportFcloseExit(fptr, CFG_ERROR6, arg);\n+    } else {\n+        if (st.st_size > MAX_ARGF_SIZE) {\n+            JLI_ReportMessage(CFG_ERROR10, MAX_ARGF_SIZE);\n+            reportFcloseExit(fptr, NULL, NULL);\n+        }\n@@ -386,1 +384,0 @@\n-    fclose(fptr);\n@@ -390,2 +387,1 @@\n-        JLI_ReportMessage(DLL_ERROR4, arg);\n-        exit(1);\n+        reportFcloseExit(fptr, DLL_ERROR4, arg);\n@@ -393,0 +389,1 @@\n+    fclose(fptr);\n","filename":"src\/java.base\/share\/native\/libjli\/args.c","additions":18,"deletions":21,"binary":false,"changes":39,"status":"modified"}]}