{"files":[{"patch":"@@ -877,1 +877,1 @@\n-  BUILD_HOTSPOT_JTREG_EXCLUDE += exesigtest.c libterminatedThread.c libTestJNI.c libCompleteExit.c\n+  BUILD_HOTSPOT_JTREG_EXCLUDE += exesigtest.c libterminatedThread.c libTestJNI.c libCompleteExit.c libTestPsig.c\n","filename":"make\/test\/JtregNativeHotspot.gmk","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,69 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test TestPosixSig.java\n+ * @bug 8292559\n+ * @summary test that -XX:+CheckJNICalss displays changed signal handlers.\n+ * @requires os.family != \"windows\"\n+ * @library \/test\/lib\n+ * @run driver TestPosixSig\n+ *\/\n+\n+import jdk.test.lib.process.ProcessTools;\n+import jdk.test.lib.process.OutputAnalyzer;\n+\n+public class TestPosixSig {\n+\n+    private static native void changeSigActionFor(int val);\n+\n+    public static void main(String[] args) throws Throwable {\n+        \/\/ Get the library path property.\n+        String libpath = System.getProperty(\"java.library.path\");\n+\n+        if (args.length == 0) {\n+\n+            \/\/ Create a new java process for the TestPsig Java\/JNI test.\n+            ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(\n+                \"-XX:+CheckJNICalls\",\n+                \"-Djava.library.path=\" + libpath + \":.\",\n+                \"TestPosixSig\", \"dummy\");\n+\n+            \/\/ Start the process and check the output.\n+            OutputAnalyzer output = new OutputAnalyzer(pb.start());\n+            String outputString = output.getOutput();\n+            if (!outputString.contains(\"Warning: SIGILL handler modified!\") ||\n+                !outputString.contains(\"Warning: SIGFPE handler modified!\")) {\n+                System.out.println(\"output: \" + outputString);\n+                throw new RuntimeException(\"Test failed, missing signal Warning\");\n+            }\n+            output.shouldHaveExitValue(0);\n+\n+        } else {\n+            System.loadLibrary(\"TestPsig\");\n+            TestPosixSig.changeSigActionFor(8); \/\/ SIGFPE\n+            TestPosixSig.changeSigActionFor(4); \/\/ SIGILL\n+            Thread.sleep(600);\n+        }\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/posixSig\/TestPosixSig.java","additions":69,"deletions":0,"binary":false,"changes":69,"status":"added"},{"patch":"@@ -0,0 +1,44 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#include <stdio.h>\n+#include <jni.h>\n+#include <signal.h>\n+#include <sys\/ucontext.h>\n+#include <errno.h>\n+#include <string.h>\n+\n+static void sig_handler(int sig, siginfo_t *info, ucontext_t *context) {\n+    printf( \" HANDLER (1) \" );\n+}\n+\n+JNIEXPORT void JNICALL Java_TestPosixSig_changeSigActionFor(JNIEnv *env, jclass klass, jint val) {\n+    struct sigaction act;\n+    act.sa_handler = (void (*)())sig_handler;\n+    sigemptyset(&act.sa_mask);\n+    act.sa_flags = 0;\n+    int retval = sigaction(val, &act, 0);\n+    if (retval != 0) {\n+        printf(\"ERROR: failed to set %d signal handler error=%s\\n\", val, strerror(errno));\n+    }\n+}\n","filename":"test\/hotspot\/jtreg\/runtime\/posixSig\/libTestPsig.c","additions":44,"deletions":0,"binary":false,"changes":44,"status":"added"}]}