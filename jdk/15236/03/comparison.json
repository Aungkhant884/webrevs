{"files":[{"patch":"@@ -670,0 +670,38 @@\n+        \/\/ Manage the extended state when showing\n+        if (visible) {\n+                \/* Frame or Dialog should be set property WINDOW_FULLSCREENABLE to true if the\n+                Frame or Dialog is resizable.\n+                *\/\n+            final boolean resizable = (target instanceof Frame) ? ((Frame)target).isResizable() :\n+                    ((target instanceof Dialog) ? ((Dialog)target).isResizable() : false);\n+            if (resizable) {\n+                setCanFullscreen(true);\n+            }\n+\n+            \/\/ Apply the extended state as expected in shared code\n+            if (target instanceof Frame) {\n+                if (!wasMaximized && isMaximized()) {\n+                    \/\/ setVisible could have changed the native maximized state\n+                    deliverZoom(true);\n+                } else {\n+                    int frameState = ((Frame)target).getExtendedState();\n+                    if ((frameState & Frame.ICONIFIED) != 0) {\n+                        \/\/ Treat all state bit masks with ICONIFIED bit as ICONIFIED state.\n+                        frameState = Frame.ICONIFIED;\n+                    }\n+\n+                    switch (frameState) {\n+                        case Frame.ICONIFIED:\n+                            execute(CWrapper.NSWindow::miniaturize);\n+                            break;\n+                        case Frame.MAXIMIZED_BOTH:\n+                            maximize();\n+                            break;\n+                        default: \/\/ NORMAL\n+                            unmaximize(); \/\/ in case it was maximized, otherwise this is a no-op\n+                            break;\n+                    }\n+                }\n+            }\n+        }\n+\n@@ -730,38 +768,0 @@\n-        \/\/ Manage the extended state when showing\n-        if (visible) {\n-            \/* Frame or Dialog should be set property WINDOW_FULLSCREENABLE to true if the\n-            Frame or Dialog is resizable.\n-            **\/\n-            final boolean resizable = (target instanceof Frame) ? ((Frame)target).isResizable() :\n-            ((target instanceof Dialog) ? ((Dialog)target).isResizable() : false);\n-            if (resizable) {\n-                setCanFullscreen(true);\n-            }\n-\n-            \/\/ Apply the extended state as expected in shared code\n-            if (target instanceof Frame) {\n-                if (!wasMaximized && isMaximized()) {\n-                    \/\/ setVisible could have changed the native maximized state\n-                    deliverZoom(true);\n-                } else {\n-                    int frameState = ((Frame)target).getExtendedState();\n-                    if ((frameState & Frame.ICONIFIED) != 0) {\n-                        \/\/ Treat all state bit masks with ICONIFIED bit as ICONIFIED state.\n-                        frameState = Frame.ICONIFIED;\n-                    }\n-\n-                    switch (frameState) {\n-                        case Frame.ICONIFIED:\n-                            execute(CWrapper.NSWindow::miniaturize);\n-                            break;\n-                        case Frame.MAXIMIZED_BOTH:\n-                            maximize();\n-                            break;\n-                        default: \/\/ NORMAL\n-                            unmaximize(); \/\/ in case it was maximized, otherwise this is a no-op\n-                            break;\n-                    }\n-                }\n-            }\n-        }\n-\n@@ -1026,1 +1026,0 @@\n-\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CPlatformWindow.java","additions":38,"deletions":39,"binary":false,"changes":77,"status":"modified"},{"patch":"@@ -0,0 +1,60 @@\n+import javax.swing.JFrame;\n+import javax.swing.JSplitPane;\n+import javax.swing.SwingUtilities;\n+import java.awt.Dimension;\n+import java.awt.Robot;\n+import java.awt.event.ComponentAdapter;\n+import java.awt.event.ComponentEvent;\n+import java.lang.reflect.InvocationTargetException;\n+\n+\/*\n+ * @test\n+ * @key headful\n+ * @summary setExtendedFrame not executed immediately\n+ * @run main MaximizeWindowTest\n+ *\/\n+@SuppressWarnings(\"serial\")\n+public class MaximizeWindowTest extends JFrame {\n+    private static JFrame frame;\n+    private static final Dimension ORIGINAL_SIZE = new Dimension(200, 200);\n+\n+    public static void main(String[] arguments) throws Exception {\n+        Robot robot = new Robot();\n+        try {\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                @Override\n+                public void run() {\n+                    JSplitPane splitPane = new JSplitPane();\n+\n+                    frame = new JFrame();\n+                    frame.setDefaultCloseOperation(EXIT_ON_CLOSE);\n+                    frame.setSize(200, 200);\n+                    frame.setLocation(400, 400);\n+                    frame.add(splitPane);\n+                    frame.setExtendedState(MAXIMIZED_BOTH);\n+\n+                    frame.addComponentListener(new ComponentAdapter() {\n+                        @Override\n+                        public void componentResized(ComponentEvent e) {\n+                            System.out.println(\"Component size: \" + e.getComponent().getSize());\n+                            if (e.getComponent().getSize().equals(new Dimension(200, 200))) {\n+                                throw new RuntimeException(\"Test Failed! \" +\n+                                        \"Frame was visible at original size before maximizing\");\n+                            }\n+                        }\n+                    });\n+\n+                    splitPane.setDividerLocation(1000);\n+\n+                    frame.setVisible(true);\n+\n+                }\n+            });\n+            robot.delay(1000);\n+        } finally {\n+            if (frame != null) {\n+                SwingUtilities.invokeAndWait(() -> frame.dispose());\n+            }\n+        }\n+    }\n+}\n","filename":"test\/jdk\/javax\/swing\/JFrame\/MaximizeWindowTest.java","additions":60,"deletions":0,"binary":false,"changes":60,"status":"added"}]}