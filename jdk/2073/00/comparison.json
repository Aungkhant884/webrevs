{"files":[{"patch":"@@ -1795,3 +1795,5 @@\n-    ShenandoahGCPhase phase(full_gc ?\n-                            ShenandoahPhaseTimings::full_gc_purge_class_unload :\n-                            ShenandoahPhaseTimings::degen_gc_purge_class_unload);\n+    ShenandoahPhaseTimings::Phase p = full_gc ?\n+                                      ShenandoahPhaseTimings::full_gc_purge_class_unload :\n+                                      ShenandoahPhaseTimings::degen_gc_purge_class_unload;\n+    ShenandoahGCPhase phase(p);\n+    ShenandoahGCWorkerPhase worker_phase(p);\n@@ -1802,1 +1804,1 @@\n-    ShenandoahClassUnloadingTask unlink_task(is_alive.is_alive_closure(), num_workers, purged_class);\n+    ShenandoahClassUnloadingTask unlink_task(p, is_alive.is_alive_closure(), num_workers, purged_class);\n@@ -1822,3 +1824,0 @@\n-  ShenandoahGCPhase root_phase(full_gc ?\n-                               ShenandoahPhaseTimings::full_gc_purge :\n-                               ShenandoahPhaseTimings::degen_gc_purge);\n@@ -1831,1 +1830,0 @@\n-\n@@ -1856,0 +1854,3 @@\n+  ShenandoahGCPhase root_phase(full_gc ?\n+                               ShenandoahPhaseTimings::full_gc_purge :\n+                               ShenandoahPhaseTimings::degen_gc_purge);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -34,1 +34,2 @@\n-ShenandoahClassUnloadingTask::ShenandoahClassUnloadingTask(BoolObjectClosure* is_alive,\n+ShenandoahClassUnloadingTask::ShenandoahClassUnloadingTask(ShenandoahPhaseTimings::Phase phase,\n+                                                           BoolObjectClosure* is_alive,\n@@ -38,0 +39,1 @@\n+  _phase(phase),\n@@ -45,1 +47,4 @@\n-  _code_cache_task.work(worker_id);\n+  {\n+    ShenandoahWorkerTimingsTracker x(_phase, ShenandoahPhaseTimings::CodeCacheRoots, worker_id);\n+    _code_cache_task.work(worker_id);\n+  }\n@@ -50,0 +55,1 @@\n+    ShenandoahWorkerTimingsTracker x(_phase, ShenandoahPhaseTimings::CLDGRoots, worker_id);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahParallelCleaning.cpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"gc\/shenandoah\/shenandoahPhaseTimings.hpp\"\n@@ -38,4 +39,5 @@\n-  ShenandoahPhaseTimings::Phase _phase;\n-  WeakProcessor::Task       _weak_processing_task;\n-  IsAlive*                  _is_alive;\n-  KeepAlive*                _keep_alive;\n+  ShenandoahPhaseTimings::Phase const _phase;\n+  WeakProcessor::Task                 _weak_processing_task;\n+  ShenandoahStringDedupRoots          _dedup_roots;\n+  IsAlive*                            _is_alive;\n+  KeepAlive*                          _keep_alive;\n@@ -56,3 +58,4 @@\n-  bool                            _unloading_occurred;\n-  CodeCacheUnloadingTask          _code_cache_task;\n-  KlassCleaningTask               _klass_cleaning_task;\n+  ShenandoahPhaseTimings::Phase const _phase;\n+  bool                                _unloading_occurred;\n+  CodeCacheUnloadingTask              _code_cache_task;\n+  KlassCleaningTask                   _klass_cleaning_task;\n@@ -60,1 +63,2 @@\n-  ShenandoahClassUnloadingTask(BoolObjectClosure* is_alive,\n+  ShenandoahClassUnloadingTask(ShenandoahPhaseTimings::Phase phase,\n+                               BoolObjectClosure* is_alive,\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahParallelCleaning.hpp","additions":12,"deletions":8,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -41,2 +41,5 @@\n-  _phase(phase), _weak_processing_task(num_workers),\n-  _is_alive(is_alive), _keep_alive(keep_alive) {\n+  _phase(phase),\n+  _weak_processing_task(num_workers),\n+  _dedup_roots(phase),\n+  _is_alive(is_alive),\n+  _keep_alive(keep_alive) {\n@@ -44,4 +47,0 @@\n-\n-  if (ShenandoahStringDedup::is_enabled()) {\n-    StringDedup::gc_prologue(false);\n-  }\n@@ -52,3 +51,0 @@\n-  if (StringDedup::is_enabled()) {\n-    StringDedup::gc_epilogue();\n-  }\n@@ -60,4 +56,3 @@\n-  _weak_processing_task.work<IsAlive, KeepAlive>(worker_id, _is_alive, _keep_alive);\n-\n-  if (ShenandoahStringDedup::is_enabled()) {\n-    ShenandoahStringDedup::parallel_oops_do(_phase, _is_alive, _keep_alive, worker_id);\n+  {\n+    ShenandoahWorkerTimingsTracker x(_phase, ShenandoahPhaseTimings::VMWeakRoots, worker_id);\n+    _weak_processing_task.work<IsAlive, KeepAlive>(worker_id, _is_alive, _keep_alive);\n@@ -65,0 +60,1 @@\n+  _dedup_roots.oops_do(_is_alive, _keep_alive, worker_id);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahParallelCleaning.inline.hpp","additions":9,"deletions":13,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -129,3 +129,3 @@\n-  f(degen_gc_purge_weak_par,                        \"     Weak Roots\")                 \\\n-  SHENANDOAH_PAR_PHASE_DO(degen_gc_purge_weak_p_,   \"       DWR: \", f)                 \\\n-  f(degen_gc_purge_cldg,                            \"     CLDG\")                       \\\n+  f(degen_gc_purge_weak_par,                        \"      Weak Roots\")                \\\n+  SHENANDOAH_PAR_PHASE_DO(degen_gc_purge_weak_p_,   \"        DWR: \", f)                \\\n+  f(degen_gc_purge_cldg,                            \"      CLDG\")                      \\\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahPhaseTimings.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}