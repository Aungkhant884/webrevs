{"files":[{"patch":"@@ -349,1 +349,1 @@\n-        JLI_ReportErrorMessageSys(\"Could not create main thread: %s\\n\", strerror(errno));\n+        JLI_ReportErrorMessageSys(\"Could not create main thread\");\n@@ -353,1 +353,1 @@\n-        JLI_ReportErrorMessageSys(\"pthread_detach() failed: %s\\n\", strerror(errno));\n+        JLI_ReportErrorMessageSys(\"pthread_detach() failed\");\n","filename":"src\/java.base\/macosx\/native\/libjli\/java_md_macosx.m","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -139,1 +139,7 @@\n-\/* Reports a system error message to stderr or a window *\/\n+\/*\n+ * Just like JLI_ReportErrorMessage, except that it also displays the system\n+ * error message, if any, after the message passed to it by the caller.\n+ * The system errors reported depend on the platform, the only guarantee\n+ * is that the message passed to JLI_ReportErrorMessageSys will always be\n+ * displayed first\n+ *\/\n","filename":"src\/java.base\/share\/native\/libjli\/java.h","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -203,1 +203,5 @@\n-    char *emsg;\n+\n+    va_start(vl, fmt);\n+    vfprintf(stderr, fmt, vl);\n+\n+    char *err;\n@@ -209,3 +213,5 @@\n-    emsg = strerror(errno);\n-    if (emsg != NULL) {\n-        fprintf(stderr, \"%s\\n\", emsg);\n+    err = strerror(errno);\n+    if (err != NULL) {\n+        fprintf(stderr, \"\\n%s\\n\", err);\n+    } else {\n+        fprintf(stderr, \"\\n\");\n@@ -214,3 +220,0 @@\n-    va_start(vl, fmt);\n-    vfprintf(stderr, fmt, vl);\n-    fprintf(stderr, \"\\n\");\n","filename":"src\/java.base\/unix\/native\/libjli\/java_md_common.c","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -608,5 +608,0 @@\n-\/*\n- * Just like JLI_ReportErrorMessage, except that it concatenates the system\n- * error message if any, it's up to the calling routine to correctly\n- * format the separation of the messages.\n- *\/\n@@ -618,1 +613,2 @@\n-    int save_errno = errno;\n+    \/* C runtime error that has no corresponding DOS error code *\/\n+    char* crterr = strerror(errno);\n@@ -621,1 +617,1 @@\n-    char  *errtext = NULL;\n+    char  *winerr = NULL;\n@@ -628,3 +624,3 @@\n-            NULL, errval, 0, (LPTSTR)&errtext, 0, NULL);\n-        if (errtext == NULL || n == 0) {                \/* Paranoia check *\/\n-            errtext = \"\";\n+            NULL, errval, 0, (LPTSTR)&winerr, 0, NULL);\n+        if (n == 0) {\n+            winerr = \"Java could not correctly determine the native platform error\";\n@@ -634,4 +630,5 @@\n-            if (n > 2) {                                \/* Drop final CR, LF *\/\n-                if (errtext[n - 1] == '\\n') n--;\n-                if (errtext[n - 1] == '\\r') n--;\n-                errtext[n] = '\\0';\n+            \/* Paranoia check *\/\n+            if (winerr != NULL && n > 2) {                                \/* Drop final CR, LF *\/\n+                if (winerr[n - 1] == '\\n') n--;\n+                if (winerr[n - 1] == '\\r') n--;\n+                winerr[n] = '\\0';\n@@ -640,2 +637,0 @@\n-    } else {   \/* C runtime error that has no corresponding DOS error code *\/\n-        errtext = strerror(save_errno);\n@@ -649,2 +644,8 @@\n-        if (freeit) {\n-           mlen += (int)JLI_StrLen(errtext);\n+        if (crterr != NULL) {\n+            mlen += 1 + (int) JLI_StrLen(crterr);\n+        }\n+\n+        if (winerr != NULL) {\n+            mlen += 1 + (int) JLI_StrLen(winerr);\n+        } else {\n+            ++mlen;\n@@ -657,2 +658,10 @@\n-        if (freeit) {\n-           JLI_StrCat(message, errtext);\n+        if (crterr != NULL) {\n+            JLI_StrCat(message, '\\n');\n+            JLI_StrCat(message, crterr);\n+        }\n+\n+        if (winerr != NULL) {\n+            JLI_StrCat(message, '\\n');\n+            JLI_StrCat(message, winerr);\n+        } else {\n+            JLI_StrCat(message, '\\0');\n@@ -667,2 +676,7 @@\n-        if (freeit) {\n-           fprintf(stderr, \"%s\", errtext);\n+        if (crterr != NULL) {\n+            fprintf(stderr, \"\\nC Runtime Error: %s\", crterr);\n+        }\n+        if (winerr != NULL) {\n+            fprintf(stderr, \"\\nWindows API Error: %s\\n\", winerr);\n+        } else {\n+            fprintf(stderr, \"\\n\");\n@@ -672,1 +686,1 @@\n-        (void)LocalFree((HLOCAL)errtext);\n+        (void)LocalFree((HLOCAL)winerr);\n","filename":"src\/java.base\/windows\/native\/libjli\/java_md.c","additions":37,"deletions":23,"binary":false,"changes":60,"status":"modified"}]}