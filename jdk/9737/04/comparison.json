{"files":[{"patch":"@@ -2485,1 +2485,2 @@\n-       (dst_type->isa_vectmask() == NULL && src_type->isa_vectmask()))) {\n+       (dst_type->isa_vectmask() == NULL && src_type->isa_vectmask()) ||\n+       num_elem_from != num_elem_to)) {\n@@ -2496,0 +2497,3 @@\n+    if (is_mask && is_floating_point_type(elem_bt_to)) {\n+      new_elem_bt_to = elem_bt_to == T_FLOAT ? T_INT : T_LONG;\n+    }\n@@ -2497,2 +2501,5 @@\n-    \/\/ Make sure that cast is implemented to particular type\/size combination.\n-    if (!arch_supports_vector(cast_vopc, num_elem_to, elem_bt_to, VecMaskNotUsed)) {\n+\n+    \/\/ Make sure that vector cast is implemented to particular type\/size combination.\n+    bool no_vec_cast_check = is_mask && (src_type->isa_vectmask() ||\n+                             type2aelembytes(elem_bt_from) == type2aelembytes(elem_bt_to));\n+    if (!no_vec_cast_check && !arch_supports_vector(cast_vopc, num_elem_to, new_elem_bt_to, VecMaskNotUsed)) {\n@@ -2501,2 +2508,1 @@\n-                      cast_vopc,\n-                      num_elem_to, type2name(elem_bt_to), is_mask);\n+                      cast_vopc, num_elem_to, type2name(new_elem_bt_to), is_mask);\n@@ -2527,2 +2533,2 @@\n-      \/\/ Since number elements from input is larger than output, simply reduce size of input (we are supposed to\n-      \/\/ drop top elements anyway).\n+      \/\/ Since number of elements from input is larger than output, simply reduce size of input\n+      \/\/ (we are supposed to drop top elements anyway).\n@@ -2544,4 +2550,2 @@\n-      op = gvn().transform(new VectorReinterpretNode(op,\n-                                                     src_type,\n-                                                     TypeVect::make(elem_bt_from,\n-                                                                    num_elem_for_resize)));\n+      const TypeVect* resize_type = TypeVect::make(elem_bt_from, num_elem_for_resize);\n+      op = gvn().transform(new VectorReinterpretNode(op, src_type, resize_type));\n@@ -2549,1 +2553,1 @@\n-    } else {\n+    } else { \/\/ num_elem_from == num_elem_to\n","filename":"src\/hotspot\/share\/opto\/vectorIntrinsics.cpp","additions":16,"deletions":12,"binary":false,"changes":28,"status":"modified"}]}