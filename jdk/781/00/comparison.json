{"files":[{"patch":"@@ -43,0 +43,12 @@\n+ShenandoahGCStateResetter::ShenandoahGCStateResetter() :\n+  _gc_state(ShenandoahHeap::heap()->gc_state()),\n+  _concurrent_weak_root_in_progress(ShenandoahHeap::heap()->is_concurrent_weak_root_in_progress()) {\n+}\n+\n+ShenandoahGCStateResetter::~ShenandoahGCStateResetter() {\n+  ShenandoahHeap* const heap = ShenandoahHeap::heap();\n+  heap->_gc_state.set(_gc_state);\n+  assert(heap->gc_state() == _gc_state, \"Should be restored\");\n+  heap->set_concurrent_weak_root_in_progress(_concurrent_weak_root_in_progress);\n+}\n+\n@@ -63,0 +75,2 @@\n+  ShenandoahGCStateResetter resetter;\n+\n@@ -111,0 +125,1 @@\n+  ShenandoahGCStateResetter resetter;\n@@ -136,0 +151,1 @@\n+  ShenandoahGCStateResetter resetter;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahRootVerifier.cpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -31,0 +31,10 @@\n+class ShenandoahGCStateResetter : public StackObj {\n+private:\n+  const char _gc_state;\n+  const bool _concurrent_weak_root_in_progress;\n+\n+public:\n+  ShenandoahGCStateResetter();\n+  ~ShenandoahGCStateResetter();\n+};\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahRootVerifier.hpp","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -595,17 +595,0 @@\n-class ShenandoahGCStateResetter : public StackObj {\n-private:\n-  ShenandoahHeap* const _heap;\n-  char _gc_state;\n-\n-public:\n-  ShenandoahGCStateResetter() : _heap(ShenandoahHeap::heap()) {\n-    _gc_state = _heap->gc_state();\n-    _heap->_gc_state.clear();\n-  }\n-\n-  ~ShenandoahGCStateResetter() {\n-    _heap->_gc_state.set(_gc_state);\n-    assert(_heap->gc_state() == _gc_state, \"Should be restored\");\n-  }\n-};\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahVerifier.cpp","additions":0,"deletions":17,"binary":false,"changes":17,"status":"modified"}]}