{"files":[{"patch":"@@ -24,2 +24,0 @@\n-import javax.swing.JFrame;\n-import javax.swing.JScrollPane;\n@@ -28,0 +26,2 @@\n+import javax.swing.table.JTableHeader;\n+import javax.swing.table.TableCellRenderer;\n@@ -30,0 +30,4 @@\n+import java.awt.Dimension;\n+import java.awt.Graphics2D;\n+import java.awt.image.BufferedImage;\n+\n@@ -33,1 +37,0 @@\n- * @key headful\n@@ -38,1 +41,1 @@\n- * @run main\/manual\/othervm -Dsun.java2d.uiScale=2.25 TableHeaderBorderPositionTest\n+ * @run main TableHeaderBorderPositionTest\n@@ -42,14 +45,15 @@\n-    static JFrame f;\n-    static JTable j;\n-    static PassFailJFrame passFailJFrame;\n-    public static void showTable() throws Exception {\n-        final String INSTRUCTIONS = \"\"\"\n-                Instructions to Test:\n-                1. Ensure the test is running 225% scaling.\n-                2. Check if the Table header border vertical lines are\n-                aligned with table data grid lines.\n-                3. If there is a mismatch between them press FAIL,\n-                else press PASS.\n-                \"\"\";\n-        f = new JFrame();\n-        f.setTitle(\"Sample - 225% scaling\");\n+    static JTable table;\n+    private static final int WIDTH = 300;\n+    private static final int HEIGHT = 150;\n+    private static final double SCALE = 2.25;\n+\n+    public static void main(String[] args) throws Exception {\n+        UIManager.setLookAndFeel(\"javax.swing.plaf.metal.MetalLookAndFeel\");\n+        SwingUtilities.invokeAndWait(() -> {\n+            try {\n+                TableHeaderBorderPositionTest.Test();\n+            } catch (Exception e) {\n+                throw new RuntimeException(e);\n+            }\n+        });\n+    }\n@@ -57,0 +61,7 @@\n+    public static void Test() throws Exception {\n+        int verticalLineCol;\n+        int expectedRGB;\n+        BufferedImage imgDate;\n+        BufferedImage imgHeader;\n+        double w;\n+        double h;\n@@ -64,3 +75,2 @@\n-        j = new JTable(data, columnNames);\n-        passFailJFrame = new PassFailJFrame(\"Test Instructions\",\n-                INSTRUCTIONS, 5L, 8, 30);\n+        table = new JTable(data, columnNames);\n+        table.setSize(WIDTH,HEIGHT);\n@@ -68,3 +78,4 @@\n-        PassFailJFrame.addTestWindow(f);\n-        PassFailJFrame.positionTestWindow(f, PassFailJFrame.Position.VERTICAL);\n-        j.setBounds(30, 40, 200, 300);\n+        final JTableHeader header = table.getTableHeader();\n+        TableCellRenderer renderer = header.getDefaultRenderer();\n+        header.setDefaultRenderer(renderer);\n+        table.updateUI();\n@@ -72,5 +83,12 @@\n-        JScrollPane sp = new JScrollPane(j);\n-        f.add(sp);\n-        f.setSize(500, 200);\n-        f.setVisible(true);\n-    }\n+        Dimension size = header.getPreferredSize();\n+        header.setSize(size);\n+        w = SCALE * size.width;\n+        h = SCALE * size.height;\n+        imgHeader = new BufferedImage((int)(w),(int)(h),BufferedImage.TYPE_INT_RGB);\n+        Graphics2D g2d = imgHeader.createGraphics();\n+        g2d.scale(SCALE, SCALE);\n+        try {\n+            header.paint(g2d);\n+        } finally {\n+            g2d.dispose();\n+        }\n@@ -78,7 +96,21 @@\n-    public static void main(String[] args) throws Exception {\n-        UIManager.setLookAndFeel(\"javax.swing.plaf.metal.MetalLookAndFeel\");\n-        SwingUtilities.invokeAndWait(() -> {\n-            try {\n-                TableHeaderBorderPositionTest.showTable();\n-            } catch (Exception e) {\n-                throw new RuntimeException(e);\n+        w = SCALE * WIDTH;\n+        h = SCALE * HEIGHT;\n+\n+        imgDate = new BufferedImage((int)w, (int)h, BufferedImage.TYPE_INT_RGB);\n+        g2d = imgDate.createGraphics();\n+        g2d.scale(SCALE, SCALE);\n+        try {\n+            table.paint(g2d);\n+        } finally {\n+            g2d.dispose();\n+        }\n+\n+        verticalLineCol = (int)(table.getTableHeader().\n+                getColumnModel().getColumn(0).getWidth() * SCALE) - 2;\n+        expectedRGB = imgDate.getRGB(verticalLineCol,0);\n+\n+        for(int i = 0; i < imgHeader.getHeight();i++) {\n+            for(int j = verticalLineCol; j < verticalLineCol + 3; j++) {\n+                if(expectedRGB != imgHeader.getRGB(j,i)) {\n+                    throw new RuntimeException(\"Test Failed\");\n+                }\n@@ -86,2 +118,10 @@\n-        });\n-        passFailJFrame.awaitAndCheck();\n+        }\n+\n+        for(int i = 0; i < table.getRowCount() * table.getRowHeight() * SCALE;i++) {\n+            for(int j = verticalLineCol; j < verticalLineCol + 3; j++) {\n+                if(expectedRGB != imgDate.getRGB(j,i)) {\n+                    throw new RuntimeException(\"Test Failed\");\n+                }\n+            }\n+        }\n+        System.out.println(\"Test Pass!!\");\n","filename":"test\/jdk\/javax\/swing\/JTableHeader\/TableHeaderBorderPositionTest.java","additions":78,"deletions":38,"binary":false,"changes":116,"status":"modified"}]}