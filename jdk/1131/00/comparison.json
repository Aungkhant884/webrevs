{"files":[{"patch":"@@ -92,3 +92,4 @@\n-#define DEF_XMM_OFFS(regnum) xmm ## regnum ## _off = xmm_off + (regnum)*16\/BytesPerInt, xmm ## regnum ## H_off\n-#define DEF_YMM_OFFS(regnum) ymm ## regnum ## _off = ymm_off + (regnum)*16\/BytesPerInt, ymm ## regnum ## H_off\n-#define DEF_ZMM_OFFS(regnum) zmm ## regnum ## _off = zmm_off + (regnum-16)*64\/BytesPerInt, zmm ## regnum ## H_off\n+#define DEF_XMM_OFFS(regnum)       xmm ## regnum ## _off = xmm_off + (regnum)*16\/BytesPerInt, xmm ## regnum ## H_off\n+#define DEF_YMM_OFFS(regnum)       ymm ## regnum ## _off = ymm_off + (regnum)*16\/BytesPerInt, ymm ## regnum ## H_off\n+#define DEF_ZMM_OFFS(regnum)       zmm ## regnum ## _off = zmm_off + (regnum)*32\/BytesPerInt, zmm ## regnum ## H_off\n+#define DEF_ZMM_UPPER_OFFS(regnum) zmm ## regnum ## _off = zmm_upper_off + (regnum-16)*64\/BytesPerInt, zmm ## regnum ## H_off\n@@ -105,4 +106,6 @@\n-    zmm_high = xmm_off + (XSAVE_AREA_ZMM_BEGIN - XSAVE_AREA_BEGIN)\/BytesPerInt,\n-    zmm_off = xmm_off + (XSAVE_AREA_UPPERBANK - XSAVE_AREA_BEGIN)\/BytesPerInt,\n-    DEF_ZMM_OFFS(16),\n-    DEF_ZMM_OFFS(17),\n+    zmm_off = xmm_off + (XSAVE_AREA_ZMM_BEGIN - XSAVE_AREA_BEGIN)\/BytesPerInt,\n+    DEF_ZMM_OFFS(0),\n+    DEF_ZMM_OFFS(1),\n+    zmm_upper_off = xmm_off + (XSAVE_AREA_UPPERBANK - XSAVE_AREA_BEGIN)\/BytesPerInt,\n+    DEF_ZMM_UPPER_OFFS(16),\n+    DEF_ZMM_UPPER_OFFS(17),\n@@ -262,1 +265,1 @@\n-  if(UseAVX > 2) {\n+  if (UseAVX > 2) {\n@@ -275,0 +278,1 @@\n+    \/\/ Save upper half of YMM registers(0..15)\n@@ -276,1 +280,1 @@\n-    int delta = ymm1_off - off;\n+    delta = ymm1_off - ymm0_off;\n@@ -282,0 +286,10 @@\n+    if (VM_Version::supports_evex()) {\n+      \/\/ Save upper half of ZMM registers(0..15)\n+      off = zmm0_off;\n+      delta = zmm1_off - zmm0_off;\n+      for (int n = 0; n < 16; n++) {\n+        XMMRegister zmm_name = as_XMMRegister(n);\n+        map->set_callee_saved(STACK_OFFSET(off), zmm_name->as_VMReg()->next(8));\n+        off += delta;\n+      }\n+    }\n","filename":"src\/hotspot\/cpu\/x86\/sharedRuntime_x86_64.cpp","additions":23,"deletions":9,"binary":false,"changes":32,"status":"modified"}]}