{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -704,0 +704,23 @@\n+    @SuppressWarnings(\"removal\")\n+    private static final String osName = AccessController.doPrivileged(\n+          (PrivilegedAction<String>)()->System.getProperty(\"os.name\"));\n+\n+    private static String getErrorString(int errCode) {\n+        if (errCode == 35 && (osName.contains(\"Mac\") || osName.contains(\"Darwin\"))) return \"EAGAIN\";\n+        switch (errCode) {\n+            case 13: return \"EACCES\";\n+            case 11: return \"EAGAIN\"; \/\/ macOS has for this 35\n+            case 9:  return \"EBADF\";\n+            case 16: return \"EBUSY\";\n+            case 17: return \"EEXIST\";\n+            case 14: return \"EFAULT\";\n+            case 4:  return \"EINTR\";\n+            case 22: return \"EINVAL\";\n+            case 24: return \"EMFILE\";\n+            case 19: return \"ENODEV\";\n+            case 2:  return \"ENOENT\";\n+            case 1:  return \"EPERM\";\n+        }\n+        return \"\";\n+    }\n+\n@@ -707,3 +730,7 @@\n-            if (!lockFile(false))\n-                throw(new BackingStoreException(\"Couldn't get file lock.\"));\n-           try {\n+            int errCode = lockFile(false);\n+            if (errCode != 0) {\n+                String errStr = getErrorString(errCode);\n+                if (!errStr.equals(\"\")) errStr = \" (\" + errStr + \")\";\n+                throw new BackingStoreException(\"Couldn't get file lock. errno is \" + errCode + errStr);\n+            }\n+            try {\n@@ -711,1 +738,1 @@\n-           } finally {\n+            } finally {\n@@ -713,1 +740,1 @@\n-           }\n+            }\n@@ -768,2 +795,8 @@\n-           if (!lockFile(shared))\n-               throw(new BackingStoreException(\"Couldn't get file lock.\"));\n+           int errCode = lockFile(shared);\n+           if (errCode != 0) {\n+               String sharingMode = \"shared\";\n+               if (!shared) sharingMode = \"nonshared\";\n+               String errStr = getErrorString(errCode);\n+               if (!errStr.equals(\"\")) errStr = \" (\" + errStr + \")\";\n+               throw new BackingStoreException(\"Couldn't get file lock. errno is \" + errCode + errStr + \" mode is \" + sharingMode);\n+           }\n@@ -930,1 +963,1 @@\n-     * returns false.\n+     * returns the error code.\n@@ -933,1 +966,1 @@\n-    private boolean lockFile(boolean shared) throws SecurityException{\n+    private int lockFile(boolean shared) throws SecurityException{\n@@ -951,1 +984,1 @@\n-                     return true;\n+                     return 0;\n@@ -961,1 +994,1 @@\n-                return false;\n+                return errorCode;\n@@ -966,1 +999,1 @@\n-        return false;\n+        return errorCode;\n","filename":"src\/java.prefs\/unix\/classes\/java\/util\/prefs\/FileSystemPreferences.java","additions":46,"deletions":13,"binary":false,"changes":59,"status":"modified"}]}