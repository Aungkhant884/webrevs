{"files":[{"patch":"@@ -0,0 +1,31 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#include \"gc\/z\/zAbort.hpp\"\n+#include \"runtime\/atomic.hpp\"\n+\n+volatile bool ZAbort::_should_abort = false;\n+\n+void ZAbort::abort() {\n+  Atomic::release_store_fence(&_should_abort, true);\n+}\n","filename":"src\/hotspot\/share\/gc\/z\/zAbort.cpp","additions":31,"deletions":0,"binary":false,"changes":31,"status":"added"},{"patch":"@@ -0,0 +1,38 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#ifndef SHARE_GC_Z_ZABORT_HPP\n+#define SHARE_GC_Z_ZABORT_HPP\n+\n+#include \"memory\/allocation.hpp\"\n+\n+class ZAbort : public AllStatic {\n+private:\n+  static volatile bool _should_abort;\n+\n+public:\n+  static bool should_abort();\n+  static void abort();\n+};\n+\n+#endif \/\/ SHARE_GC_Z_ZABORT_HPP\n","filename":"src\/hotspot\/share\/gc\/z\/zAbort.hpp","additions":38,"deletions":0,"binary":false,"changes":38,"status":"added"},{"patch":"@@ -0,0 +1,34 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#ifndef SHARE_GC_Z_ZABORT_INLINE_HPP\n+#define SHARE_GC_Z_ZABORT_INLINE_HPP\n+\n+#include \"gc\/z\/zAbort.hpp\"\n+#include \"runtime\/atomic.hpp\"\n+\n+inline bool ZAbort::should_abort() {\n+  return Atomic::load_acquire(&_should_abort);\n+}\n+\n+#endif \/\/ SHARE_GC_Z_ZABORT_INLINE_HPP\n","filename":"src\/hotspot\/share\/gc\/z\/zAbort.inline.hpp","additions":34,"deletions":0,"binary":false,"changes":34,"status":"added"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"gc\/z\/zAbort.inline.hpp\"\n@@ -400,0 +401,11 @@\n+#define concurrent(f)                 \\\n+  do {                                \\\n+    if (should_terminate()) {         \\\n+      return;                         \\\n+    }                                 \\\n+    concurrent_##f();                 \\\n+    if (should_terminate()) {         \\\n+      return;                         \\\n+    }                                 \\\n+  } while (false)\n+\n@@ -407,1 +419,1 @@\n-  concurrent_mark();\n+  concurrent(mark);\n@@ -412,1 +424,1 @@\n-    concurrent_mark_continue();\n+    concurrent(mark_continue);\n@@ -416,1 +428,1 @@\n-  concurrent_process_non_strong_references();\n+  concurrent(process_non_strong_references);\n@@ -419,1 +431,1 @@\n-  concurrent_reset_relocation_set();\n+  concurrent(reset_relocation_set);\n@@ -425,1 +437,1 @@\n-  concurrent_select_relocation_set();\n+  concurrent(select_relocation_set);\n@@ -431,1 +443,1 @@\n-  concurrent_relocate();\n+  concurrent(relocate);\n@@ -459,0 +471,1 @@\n+  ZAbort::abort();\n","filename":"src\/hotspot\/share\/gc\/z\/zDriver.cpp","additions":19,"deletions":6,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -29,0 +29,1 @@\n+#include \"gc\/z\/zAbort.inline.hpp\"\n@@ -349,1 +350,1 @@\n-  return true;\n+  return !timeout->has_expired();\n@@ -489,1 +490,2 @@\n-    return false;\n+    \/\/ No timeout, but check for signal to abort\n+    return ZAbort::should_abort();\n@@ -498,1 +500,4 @@\n-    drain_and_flush(stripe, stacks, cache, &no_timeout);\n+    if (!drain_and_flush(stripe, stacks, cache, &no_timeout)) {\n+      \/\/ Abort\n+      break;\n+    }\n","filename":"src\/hotspot\/share\/gc\/z\/zMark.cpp","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+#include \"gc\/z\/zAbort.inline.hpp\"\n@@ -399,0 +400,4 @@\n+\n+      if (ZAbort::should_abort()) {\n+        break;\n+      }\n","filename":"src\/hotspot\/share\/gc\/z\/zRelocate.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+#include \"gc\/z\/zAbort.inline.hpp\"\n@@ -645,0 +646,6 @@\n+  if (ZAbort::should_abort()) {\n+    log_info(gc)(\"Garbage Collection (%s) Aborted\",\n+                 GCCause::to_string(ZCollectedHeap::heap()->gc_cause()));\n+    return;\n+  }\n+\n@@ -715,0 +722,4 @@\n+  if (ZAbort::should_abort()) {\n+    return;\n+  }\n+\n@@ -733,0 +744,4 @@\n+  if (ZAbort::should_abort()) {\n+    return;\n+  }\n+\n","filename":"src\/hotspot\/share\/gc\/z\/zStat.cpp","additions":15,"deletions":0,"binary":false,"changes":15,"status":"modified"}]}