{"files":[{"patch":"@@ -175,1 +175,1 @@\n-    private final Set<String> headerIds = new HashSet<>();\n+    private final Set<String> headingIds = new HashSet<>();\n@@ -1685,1 +1685,1 @@\n-                        generateHeaderId(node, trees, attrs);\n+                        generateHeadingId(node, trees, attrs);\n@@ -1762,1 +1762,1 @@\n-                dt -> equalsIgnoreCase(((AttributeTree)dt).getName(), \"id\"));\n+                dt -> dt instanceof AttributeTree at && equalsIgnoreCase(at.getName(), \"id\"));\n@@ -1765,1 +1765,1 @@\n-    private void generateHeaderId(StartElementTree node, List<? extends DocTree> trees, Content content) {\n+    private void generateHeadingId(StartElementTree node, List<? extends DocTree> trees, Content content) {\n@@ -1785,16 +1785,2 @@\n-        String idValue = sb.toString()\n-                .toLowerCase(Locale.ROOT)\n-                .trim()\n-                .replaceAll(\"[^\\\\w_-]+\", \"-\");\n-        if (!idValue.isEmpty()) {\n-            \/\/ Make id unique\n-            idValue = idValue + \"-hdr\";\n-            if (!headerIds.add(idValue)) {\n-                int counter = 1;\n-                while (!headerIds.add(idValue + counter)) {\n-                    counter++;\n-                }\n-                idValue = idValue + counter;\n-            }\n-            content.add(\"id=\\\"\").add(idValue).add(\"\\\"\");\n-        }\n+        HtmlId htmlId = htmlIds.forHeading(sb, headingIds);\n+        content.add(\"id=\\\"\").add(htmlId.name()).add(\"\\\"\");\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":6,"deletions":20,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import java.util.Set;\n@@ -514,0 +515,25 @@\n+\n+    \/**\n+     * Returns an id for a heading in a doc comment. The id value is derived from the contents\n+     * of the heading with additional checks to make it unique within its containing page.\n+     *\n+     * @param headingText the text contained by the heading\n+     * @param headingIds the set of heading ids already generated for the current page\n+     * @return a unique id value for the heading\n+     *\/\n+    public HtmlId forHeading(CharSequence headingText, Set<String> headingIds) {\n+        String idValue = headingText.toString()\n+                .toLowerCase(Locale.ROOT)\n+                .trim()\n+                .replaceAll(\"[^\\\\w_-]+\", \"-\");\n+        \/\/ Make id value unique\n+        idValue = idValue + \"-heading\";\n+        if (!headingIds.add(idValue)) {\n+            int counter = 1;\n+            while (!headingIds.add(idValue + counter)) {\n+                counter++;\n+            }\n+            idValue = idValue + counter;\n+        }\n+        return HtmlId.of(idValue);\n+    }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlIds.java","additions":26,"deletions":0,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -80,0 +80,2 @@\n+                         * <h4><\/h4>\n+                         *\n@@ -94,1 +96,1 @@\n-                    <h2 id=\"first-header-hdr\">First Header<\/h2>\n+                    <h2 id=\"first-header-heading\">First Header<\/h2>\n@@ -103,1 +105,4 @@\n-                    <h5 id=\"embedded-code-tag-hdr\"><code>Embedded Code Tag<\/code><\/h5>\n+                    <h5 id=\"embedded-code-tag-heading\"><code>Embedded Code Tag<\/code><\/h5>\n+                    \"\"\",\n+                \"\"\"\n+                    <h6 id=\"embedded-link-tag-heading\"><a href=\"C.html\" title=\"class in p\">Embedded Link Tag<\/a><\/h6>\n@@ -106,1 +111,1 @@\n-                    <h6 id=\"embedded-link-tag-hdr\"><a href=\"C.html\" title=\"class in p\">Embedded Link Tag<\/a><\/h6>\n+                    <h3 id=\"duplicate-text-heading\">Duplicate Text<\/h3>\n@@ -109,1 +114,1 @@\n-                    <h3 id=\"duplicate-text-hdr\">Duplicate Text<\/h3>\n+                    <h4 id=\"duplicate-text-heading1\">Duplicate Text<\/h4>\n@@ -112,1 +117,1 @@\n-                    <h4 id=\"duplicate-text-hdr1\">Duplicate Text<\/h4>\n+                    <h2 id=\"extra-chars-heading\">Extra (#*!. chars<\/h2>\n@@ -115,1 +120,1 @@\n-                    <h2 id=\"extra-chars-hdr\">Extra (#*!. chars<\/h2>\n+                    <h3 id=\"other-attributes-heading\" style=\"color: red;\" class=\"some-class\">Other attributes<\/h3>\n@@ -118,1 +123,1 @@\n-                    <h3 id=\"other-attributes-hdr\" style=\"color: red;\" class=\"some-class\">Other attributes<\/h3>\n+                    <h4 id=\"-heading\"><\/h4>\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testAutoHeaderId\/TestAutoHeaderId.java","additions":12,"deletions":7,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -103,1 +103,1 @@\n-                    <h1 id=\"package-html-file-hdr\">Package HTML file<\/h1>\n+                    <h1 id=\"package-html-file-heading\">Package HTML file<\/h1>\n@@ -109,1 +109,1 @@\n-                    <h1 id=\"package-html-file-hdr\">Package HTML file<\/h1>\n+                    <h1 id=\"package-html-file-heading\">Package HTML file<\/h1>\n@@ -173,1 +173,1 @@\n-                    <h1 id=\"module-html-file-hdr\">Module HTML file<\/h1>\n+                    <h1 id=\"module-html-file-heading\">Module HTML file<\/h1>\n@@ -179,1 +179,1 @@\n-                    <h1 id=\"package-html-file-hdr\">Package HTML file<\/h1>\n+                    <h1 id=\"package-html-file-heading\">Package HTML file<\/h1>\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testIndexInDocFiles\/TestIndexInDocFiles.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}