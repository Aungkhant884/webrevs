{"files":[{"patch":"@@ -31,0 +31,1 @@\n+import java.util.regex.*;\n@@ -35,0 +36,1 @@\n+    private static final Pattern CONNECT_PATTERN = Pattern.compile(\"^((?<id>.+?)@)?(?<host>.+?)(\/(?<prefix>.+))?$\");\n@@ -91,1 +93,1 @@\n-        \/\/ debugServerID follows the pattern [unique_id@]host[:port]\n+        \/\/ debugServerID follows the pattern [unique_id@]host[:port][\/prefix]\n@@ -93,0 +95,2 @@\n+        Matcher matcher = CONNECT_PATTERN.matcher(debugServerID);\n+        matcher.find();\n@@ -94,1 +98,0 @@\n-        int index = debugServerID.indexOf('@');\n@@ -96,8 +99,1 @@\n-        String uniqueID = null;\n-        if (index != -1) {\n-            nameBuf.append(debugServerID.substring(index + 1));\n-            uniqueID = debugServerID.substring(0, index);\n-        } else {\n-            nameBuf.append(debugServerID);\n-        }\n-\n+        nameBuf.append(matcher.group(\"host\"));\n@@ -105,2 +101,2 @@\n-        nameBuf.append(serverNamePrefix);\n-        if (uniqueID != null) {\n+        nameBuf.append(matcher.group(\"prefix\") == null ? serverNamePrefix : matcher.group(\"prefix\"));\n+        if (matcher.group(\"id\") != null) {\n@@ -108,1 +104,1 @@\n-            nameBuf.append(uniqueID);\n+            nameBuf.append(matcher.group(\"id\"));\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/RMIHelper.java","additions":9,"deletions":13,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -71,1 +71,1 @@\n-            System.out.println(\"    --connect [<id>@]<host>[:registryport] To connect to a remote debug server (debugd).\");\n+            System.out.println(\"    --connect [<id>@]<host>[:registryport][\/prefix] To connect to a remote debug server (debugd).\");\n@@ -88,1 +88,1 @@\n-            System.out.println(\"          or  jhsdb \" + mode + \" --connect id@debugserver:1234\");\n+            System.out.println(\"          or  jhsdb \" + mode + \" --connect id@debugserver:1234\/prefix\");\n@@ -107,0 +107,1 @@\n+        System.out.println(\"    --prefix   <url prefix> Sets the prefix to distinguish SA debugee.\");\n@@ -379,1 +380,2 @@\n-                \"hostname=\", \"hostname\");\n+                \"hostname=\", \"hostname\",\n+                \"prefix=\", \"prefix\");\n@@ -394,0 +396,1 @@\n+        String prefix = argMap.get(\"prefix\");\n@@ -425,0 +428,5 @@\n+        \/\/ Set RMI URL prefix if specified\n+        if (prefix != null) {\n+            System.setProperty(\"sun.jvm.hotspot.rmi.serverNamePrefix\", prefix);\n+        }\n+\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/SALauncher.java","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -35,1 +35,1 @@\n-\\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R]\\]\n+\\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R]\\]\n@@ -39,1 +39,1 @@\n-\\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R]\\]\n+\\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R]\\]\n@@ -47,1 +47,1 @@\n-| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R])\n+| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R])\n@@ -52,1 +52,1 @@\n-| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R])\n+| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R])\n@@ -57,1 +57,1 @@\n-| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R])\n+| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R])\n@@ -62,1 +62,1 @@\n-| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R])\n+| \\f[CB]\\-\\-connect\\f[R] \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R])\n@@ -84,1 +84,1 @@\n-.B \\f[I][server\\-id\\@]debugd\\-host[:registryport]\\f[R]\n+.B \\f[I][server\\-id\\@]debugd\\-host[:registryport][\/prefix]\\f[R]\n@@ -201,0 +201,9 @@\n+.TP\n+.B \\f[CB]\\-\\-prefix\\f[R] \\f[I]prefix\\f[R]\n+Sets the prefix to distinguish SA debugee.\n+This option overrides the system property\n+\\[aq]sun.jvm.hotspot.rmi.serverNamePrefix\\[aq].\n+If not specified, the system property is used.\n+If the system property is not set, \"SARemoteDebugger\" will be set.\n+.RS\n+.RE\n","filename":"src\/jdk.hotspot.agent\/share\/man\/jhsdb.1","additions":16,"deletions":7,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -63,3 +63,0 @@\n-        if (prefix != null) {\n-            jhsdbLauncher.addToolArg(\"-J-Dsun.jvm.hotspot.rmi.serverNamePrefix=\" + prefix);\n-        }\n@@ -80,0 +77,4 @@\n+        if (prefix != null) {\n+            jhsdbLauncher.addToolArg(\"--prefix\");\n+            jhsdbLauncher.addToolArg(prefix);\n+        }\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/sadebugd\/DebugdUtils.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -36,1 +36,1 @@\n- * @bug 8263636\n+ * @bug 8263636 8263635\n@@ -59,0 +59,2 @@\n+        assert prefix != null;\n+\n@@ -60,3 +62,0 @@\n-        if (prefix != null) {\n-            jhsdbLauncher.addToolArg(\"-J-Dsun.jvm.hotspot.rmi.serverNamePrefix=\" + prefix);\n-        }\n@@ -65,1 +64,1 @@\n-        jhsdbLauncher.addToolArg(\"localhost:\" + REGISTRY_PORT);\n+        jhsdbLauncher.addToolArg(\"localhost:\" + REGISTRY_PORT + \"\/\" + prefix);\n@@ -74,1 +73,1 @@\n-        out.shouldContain(\"Attaching to remote server localhost:10000, please wait...\");\n+        out.shouldContain(\"Attaching to remote server localhost:10000\");\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/sadebugd\/DisableRegistryTest.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"}]}