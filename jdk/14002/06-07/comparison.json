{"files":[{"patch":"@@ -2215,1 +2215,1 @@\n-  if (!self && java_thread->popframe_condition() != JavaThread::popframe_inactive) {\n+  if (java_thread->popframe_condition() != JavaThread::popframe_inactive) {\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -64,1 +64,1 @@\n-    static native void prepareAgent(Class taskClass);\n+    static native void prepareAgent(Class taskClass, boolean doPopFrame);\n@@ -98,2 +98,0 @@\n-        prepareAgent(TestTask.class);\n-\n@@ -160,1 +158,1 @@\n-            \/\/ PopFrame is called from the test task (own thread) and expected to succeed.\n+            \/\/ PopFrame is called from method C() on own thread. Expected to return OPAQUE_FRAME.\n@@ -212,0 +210,1 @@\n+            prepareAgent(TestTask.class, false); \/\/ No doPopFrame\n@@ -215,0 +214,1 @@\n+            prepareAgent(TestTask.class, true); \/\/ doPopFrame\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/vthread\/PopFrameTest\/PopFrameTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -31,4 +31,5 @@\n-static jvmtiEnv *jvmti = NULL;\n-static jmethodID mid_B = NULL;\n-static jrawMonitorID monitor = NULL;\n-static volatile bool bp_sync_reached = false;\n+static jvmtiEnv *jvmti;\n+static jmethodID mid_B;\n+static jrawMonitorID monitor;\n+static jboolean do_pop_frame;\n+static volatile bool bp_sync_reached;\n@@ -47,1 +48,1 @@\n-  LOG(\"Breakpoint: In method TestTask.B(): before sync section enter\\n\");\n+  LOG(\"Breakpoint: In method TestTask.B(): before sync section\\n\");\n@@ -53,3 +54,1 @@\n-  err = jvmti->PopFrame(thread);\n-  LOG(\"Breakpoint: PopFrame returned code: %s (%d)\\n\", TranslateError(err), err);\n-  check_jvmti_status(jni, err, \"Breakpoint: Failed in PopFrame\");\n+  LOG(\"Breakpoint: In method TestTask.B(): after sync section\\n\");\n@@ -57,1 +56,6 @@\n-  LOG(\"Breakpoint: In method TestTask.B(): after sync section exit\\n\");\n+  if (do_pop_frame != 0) {\n+    err = jvmti->PopFrame(thread);\n+    LOG(\"Breakpoint: PopFrame returned code: %s (%d)\\n\", TranslateError(err), err);\n+    check_jvmti_status(jni, err, \"Breakpoint: Failed in PopFrame\");\n+  }\n+  LOG(\"Breakpoint: In method TestTask.B() finished\\n\");\n@@ -108,1 +112,1 @@\n-Java_PopFrameTest_prepareAgent(JNIEnv *jni, jclass cls, jclass task_clazz) {\n+Java_PopFrameTest_prepareAgent(JNIEnv *jni, jclass cls, jclass task_clazz, jboolean do_pop) {\n@@ -116,0 +120,2 @@\n+  do_pop_frame = do_pop;\n+\n@@ -163,0 +169,1 @@\n+  bp_sync_reached = false;\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/vthread\/PopFrameTest\/libPopFrameTest.cpp","additions":17,"deletions":10,"binary":false,"changes":27,"status":"modified"}]}