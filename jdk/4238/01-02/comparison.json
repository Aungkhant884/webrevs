{"files":[{"patch":"@@ -3985,0 +3985,1 @@\n+      ccast = _gvn.transform(ccast);\n","filename":"src\/hotspot\/share\/opto\/graphKit.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -4447,9 +4447,4 @@\n-    \/\/ Replace InitializeNode's output_control uses' control to AllocateArrayNode's input control.\n-    \/\/ CastIINode might created in GraphKit::new_array (in AllocateArrayNode::make_ideal_length) and later uses.\n-    \/\/ CastIINode's input_control should still use InitializeNode's output_control after move allocation.\n-    \/\/ Otherwise it breaks constraint assumption.\n-    \/\/\n-    \/\/ Because alloc is tightly coupled, checking InitializeNode's control proj's output for\n-    \/\/ for CastIINode. After finding CastIINode, actions include:\n-    \/\/ 1. Replace CastIINode with AllocateArrayNode's length.\n-    \/\/ 2. Create CastIINode again in arraycopy_move_allocation_here after control flow adjustion.\n+    \/\/ The CastIINode created in GraphKit::new_array (in AllocateArrayNode::make_ideal_length) must stay below\n+    \/\/ the allocation (i.e. is only valid if the allocation succeeds):\n+    \/\/ 1) replace CastIINode with AllocateArrayNode's length here\n+    \/\/ 2) Create CastIINode again once allocation has moved (see below) at the end of this method\n@@ -4467,0 +4462,1 @@\n+          assert(_gvn.hash_find(prev_cast) != NULL, \"not found\");\n@@ -4468,6 +4464,1 @@\n-          \/\/ CastII must be same\n-          CastIINode* prev = prev_cast->as_CastII();\n-          CastIINode* cur = init_out->as_CastII();\n-          assert(prev->has_range_check() == cur->has_range_check(), \"not same\");\n-          assert(prev->type()->is_int()->_lo == cur->type()->is_int()->_lo, \"not same\");\n-          assert(prev->type()->is_int()->_hi == cur->type()->is_int()->_hi, \"not same\");\n+          assert(_gvn.hash_find(prev_cast) == _gvn.hash_find(init_out), \"not equal CastIINode\");\n@@ -4520,0 +4511,1 @@\n+        ccast = _gvn.transform(ccast);\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":7,"deletions":15,"binary":false,"changes":22,"status":"modified"}]}