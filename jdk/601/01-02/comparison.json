{"files":[{"patch":"@@ -57,0 +57,19 @@\n+class ZRelocateRootsTask : public ZTask {\n+private:\n+  ZRelocateRootsIteratorClosure _cl;\n+\n+public:\n+  ZRelocateRootsTask() :\n+      ZTask(\"ZRelocateRootsTask\") {}\n+\n+  virtual void work() {\n+    \/\/ Allocation path assumes that relocating GC threads are ZWorkers\n+    assert(ZThread::is_worker(), \"Relocation code needs to be run as a worker\");\n+    assert(ZThread::worker_id() == 0, \"No multi-thread support\");\n+\n+    \/\/ During relocation we need to visit the JVMTI\n+    \/\/ export weak roots to rehash the JVMTI tag map\n+    ZRelocateRoots::oops_do(&_cl);\n+  }\n+};\n+\n@@ -58,2 +77,2 @@\n-  ZRelocateRootsIteratorClosure cl;\n-  ZRelocateRoots::oops_do(&cl);\n+  ZRelocateRootsTask task;\n+  _workers->run_serial(&task);\n","filename":"src\/hotspot\/share\/gc\/z\/zRelocate.cpp","additions":21,"deletions":2,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -104,0 +104,4 @@\n+void ZWorkers::run_serial(ZTask* task) {\n+  run(task, 1  \/* nworkers *\/);\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/z\/zWorkers.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -51,0 +51,1 @@\n+  void run_serial(ZTask* task);\n","filename":"src\/hotspot\/share\/gc\/z\/zWorkers.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}