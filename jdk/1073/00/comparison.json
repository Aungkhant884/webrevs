{"files":[{"patch":"@@ -4577,2 +4577,6 @@\n-            if (x->is_CFG() && x != m && x != iff)\n-              { cfg = x; break; }\n+            if (x != m && x != iff && !x->is_Phi()) {\n+                _igvn.rehash_node_delayed(x);\n+                int nb = x->replace_edge(m, if_t);\n+                assert(nb > 0, \"use should have been updated\");\n+              --j, jmax -= nb;\n+              }\n@@ -4580,5 +4584,0 @@\n-          assert(cfg != NULL, \"must find the control user of m\");\n-          uint k = 0;             \/\/ Probably cfg->in(0)\n-          while( cfg->in(k) != m ) k++; \/\/ But check incase cfg is a Region\n-          cfg->set_req( k, if_t ); \/\/ Now point to NeverBranch\n-          _igvn._worklist.push(cfg);\n","filename":"src\/hotspot\/share\/opto\/loopnode.cpp","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -33,0 +33,2 @@\n+ * @run main\/othervm -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCMode=iu -Xcomp -XX:CompileOnly=BarrierInInfiniteLoop::test1\n+ *                   -XX:CompileOnly=BarrierInInfiniteLoop::test2 -XX:CompileOnly=BarrierInInfiniteLoop::test3 -XX:CompileCommand=quiet BarrierInInfiniteLoop\n","filename":"test\/hotspot\/jtreg\/gc\/shenandoah\/compiler\/BarrierInInfiniteLoop.java","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}