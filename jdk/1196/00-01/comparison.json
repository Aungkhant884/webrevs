{"files":[{"patch":"@@ -230,1 +230,2 @@\n-os::PlatformMutex* ObjectSynchronizer::gInflationLocks[ObjectSynchronizer::NINFLATIONLOCKS];\n+static const int NINFLATIONLOCKS = 256;\n+static os::PlatformMutex* gInflationLocks[NINFLATIONLOCKS];\n@@ -233,0 +234,1 @@\n+  static_assert(is_power_of_2(NINFLATIONLOCKS), \"must be\");\n@@ -775,7 +777,1 @@\n-    \/\/ Avoid live-lock\n-    \/\/ TODO: consider calling SafepointSynchronize::do_call_back() while\n-    \/\/ spinning to see if there's a safepoint pending.  If so, immediately\n-    \/\/ yielding or blocking would be appropriate.  Avoid spinning while\n-    \/\/ there is a safepoint pending.\n-    \/\/ TODO: add inflation contention performance counters.\n-    \/\/ TODO: restrict the aggregate number of spinners.\n+    \/\/ Avoid live-lock.\n@@ -801,1 +797,3 @@\n-        int ix = (cast_from_oop<intptr_t>(obj) >> 5) & (ObjectSynchronizer::NINFLATIONLOCKS-1);\n+\n+        \/\/ Index into the lock array based on the current object address.\n+        int ix = (cast_from_oop<intptr_t>(obj) >> 5) & (NINFLATIONLOCKS-1);\n@@ -803,3 +801,3 @@\n-        assert(ix >= 0 && ix < ObjectSynchronizer::NINFLATIONLOCKS, \"invariant\");\n-        assert((ObjectSynchronizer::NINFLATIONLOCKS & (ObjectSynchronizer::NINFLATIONLOCKS-1)) == 0, \"invariant\");\n-        ObjectSynchronizer::gInflationLocks[ix]->lock();\n+        assert(ix >= 0 && ix < NINFLATIONLOCKS, \"invariant\");\n+        assert((NINFLATIONLOCKS & (NINFLATIONLOCKS-1)) == 0, \"invariant\");\n+        gInflationLocks[ix]->lock();\n@@ -816,1 +814,1 @@\n-        ObjectSynchronizer::gInflationLocks[ix]->unlock();\n+        gInflationLocks[ix]->unlock();\n","filename":"src\/hotspot\/share\/runtime\/synchronizer.cpp","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -118,2 +118,1 @@\n-  static const int NINFLATIONLOCKS = 256;\n-  static os::PlatformMutex* gInflationLocks[NINFLATIONLOCKS];\n+  \/\/ Initialize the gInflationLocks\n","filename":"src\/hotspot\/share\/runtime\/synchronizer.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}