{"files":[{"patch":"@@ -29,4 +29,0 @@\n-#ifdef MACOSX\n-#include <stdlib.h>\n-#include <sys\/utsname.h>\n-#endif\n@@ -181,24 +177,0 @@\n-#ifdef MACOSX\n-\/\/\n-\/\/ Returns the Darwin version or -1 if it is indeterminate\n-\/\/\n-static int get_darwin_version() {\n-    struct utsname name;\n-    if (uname(&name) < 0)\n-        return -1;\n-\n-    char *dotp = strchr(name.release, '.');\n-    if (dotp != NULL) {\n-        size_t len = dotp - name.release;\n-        if (len > 0) {\n-            char major_version[_SYS_NAMELEN];\n-            strncpy(major_version, name.release, len);\n-            major_version[len]= '\\0';\n-            return atoi(major_version);\n-        }\n-    }\n-\n-    return -1;\n-}\n-#endif\n-\n@@ -208,1 +180,1 @@\n-#ifdef MACOSX\n+#if defined(MACOSX) || defined(__linux__)\n@@ -210,2 +182,2 @@\n-    \/\/ As of macOS 11 Big Sur, Darwin version 20, writev() started to\n-    \/\/ enforce the constraint\n+    \/\/ The man pages of writev() on both Linux and macOS specify this\n+    \/\/ constraint on the sum of all byte lengths in the iovec array:\n@@ -216,7 +188,2 @@\n-    int darwin_version = get_darwin_version();\n-\n-    \/\/ Return a conservative value if the Darwin version is either\n-    \/\/ indeterminate or at least 20.\n-    if (darwin_version < 0 || darwin_version >= 20)\n-        return java_lang_Integer_MAX_VALUE;\n-#elif defined(__linux__)\n+    \/\/ As of macOS 11 Big Sur, Darwin version 20, writev() started to\n+    \/\/ actually enforce the constraint which had been previously ignored.\n@@ -224,3 +191,1 @@\n-    \/\/ The Linux specification of writev() has the same constraint on\n-    \/\/ the sum of the iov_len values in the iov array as above, but in\n-    \/\/ practice on Linux writev() has been observed not to write more\n+    \/\/ In practice on Linux writev() has been observed not to write more\n@@ -230,1 +195,1 @@\n-#endif\n+#else\n@@ -232,0 +197,1 @@\n+#endif\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/IOUtil.c","additions":8,"deletions":42,"binary":false,"changes":50,"status":"modified"}]}