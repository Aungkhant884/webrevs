{"files":[{"patch":"@@ -38,2 +38,1 @@\n- * @compile --enable-preview -source ${jdk.version} StopThreadTest.java\n- * @run main\/othervm\/native --enable-preview -agentlib:StopThreadTest StopThreadTest\n+ * @run main\/othervm\/native -agentlib:StopThreadTest StopThreadTest\n@@ -62,1 +61,9 @@\n-    static void setFailed() { status = FAILED; }\n+    static void setFailed(String msg) {\n+        log(\"\\nFAILED: \" + msg); \n+        status = FAILED;\n+    }\n+\n+    static void throwFailed(String msg) {\n+        log(\"\\nFAILED: \" + msg); \n+        throw new RuntimeException(\"StopThreadTest failed!\");\n+    }\n@@ -64,3 +71,4 @@\n-    public static void main(String args[]) throws Exception {\n-        if (run(args) == FAILED) {\n-            throw new RuntimeException(\"StopThreadTest failed!\");\n+    public static void main(String args[]) {\n+        run();\n+        if (status == FAILED) {\n+            throwFailed(\"StopThreadTest!\");\n@@ -71,1 +79,1 @@\n-    public static int run(String args[]) {\n+    public static void run() {\n@@ -87,2 +95,1 @@\n-                log(\"Failed: Main #A.1: expected THREAD_NOT_SUSPENDED instead of: \" + retCode);\n-                setFailed();\n+                throwFailed(\"Main #A.1: expected THREAD_NOT_SUSPENDED instead of: \" + retCode);\n@@ -97,2 +104,1 @@\n-                log(\"Failed: Main #A.2: expected JVMTI_ERROR_NONE instead of: \" + retCode);\n-                setFailed();\n+                throwFailed(\"Main #A.2: expected JVMTI_ERROR_NONE instead of: \" + retCode);\n@@ -111,2 +117,1 @@\n-                log(\"Failed: Main #B.1: expected THREAD_NOT_SUSPENDED instead of: \" + retCode);\n-                setFailed();\n+                throwFailed(\"Main #B.1: expected THREAD_NOT_SUSPENDED instead of: \" + retCode);\n@@ -119,2 +124,1 @@\n-                log(\"Failed: Main #B.2: expected JVMTI_ERROR_NONE\");\n-                setFailed();\n+                throwFailed(\"Main #B.2: expected JVMTI_ERROR_NONE\");\n@@ -136,2 +140,1 @@\n-            System.out.println(\"# Unexpected \" + ex);\n-            setFailed();\n+            throwFailed(\"Unexpected \" + ex);\n@@ -139,1 +142,0 @@\n-        return status;\n@@ -184,2 +186,1 @@\n-                log(\"Failed: TestTask.run: expected AssertionError from method A()\");\n-                StopThreadTest.setFailed();\n+                StopThreadTest.setFailed(\"TestTask.run: expected AssertionError from method A()\");\n@@ -197,2 +198,1 @@\n-                log(\"Failed: TestTask.run: expected AssertionError from method B()\");\n-                StopThreadTest.setFailed();\n+                StopThreadTest.setFailed(\"TestTask.run: expected AssertionError from method B()\");\n@@ -210,2 +210,1 @@\n-                log(\"Failed: TestTask.run: expected AssertionError from method C()\");\n-                StopThreadTest.setFailed();\n+                StopThreadTest.setFailed(\"TestTask.run: expected AssertionError from method C()\");\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/vthread\/StopThreadTest\/StopThreadTest.java","additions":23,"deletions":24,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -135,2 +135,1 @@\n-  err = jvmti->SetEventNotificationMode(JVMTI_ENABLE, JVMTI_EVENT_BREAKPOINT, NULL);\n-  check_jvmti_status(jni, err, \"prepareAgent: Failed to enable BREAKPOINT event\");\n+  set_event_notification_mode(jvmti, JVMTI_ENABLE, JVMTI_EVENT_BREAKPOINT, NULL);\n@@ -144,2 +143,1 @@\n-  jvmtiError err = jvmti->SuspendThread(thread);\n-  check_jvmti_status(jni, err, \"Agent suspendThread: Failed in JVMTI SuspendThread\");\n+  suspend_thread(jvmti, jni, thread);\n@@ -151,2 +149,1 @@\n-  jvmtiError err = jvmti->ResumeThread(thread);\n-  check_jvmti_status(jni, err, \"Agent resumeThread: Failed in JVMTI ResumeThread\");\n+  resume_thread(jvmti, jni, thread);\n","filename":"test\/hotspot\/jtreg\/serviceability\/jvmti\/vthread\/StopThreadTest\/libStopThreadTest.cpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"}]}