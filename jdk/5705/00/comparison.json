{"files":[{"patch":"@@ -908,1 +908,1 @@\n-        \/\/ Fall-thru case in succs[0], so flip targets in succs map\n+        \/\/ Fall-thru case in succs[0], should be in succs[1], so flip targets in _succs map\n@@ -917,1 +917,0 @@\n-\n@@ -1651,2 +1650,1 @@\n-\/\/ Order the sequence of the traces in some desirable way, and fixup the\n-\/\/ jumps at the end of each block.\n+\/\/ Order the sequence of the traces in some desirable way\n@@ -1674,1 +1672,1 @@\n-  \/\/ Patch up the successor blocks\n+  \/\/ Collect all blocks from existing Traces\n@@ -1679,1 +1677,4 @@\n-      tr->fixup_blocks(_cfg);\n+      \/\/ push blocks onto the CFG list\n+      for (Block* b = tr->first_block(); b != NULL; b = tr->next(b)) {\n+        _cfg.add_block(b);\n+      }\n@@ -1785,37 +1786,0 @@\n-\n-\/\/ push blocks onto the CFG list\n-\/\/ ensure that blocks have the correct two-way branch sense\n-void Trace::fixup_blocks(PhaseCFG &cfg) {\n-  Block *last = last_block();\n-  for (Block *b = first_block(); b != NULL; b = next(b)) {\n-    cfg.add_block(b);\n-    if (!b->is_connector()) {\n-      int nfallthru = b->num_fall_throughs();\n-      if (b != last) {\n-        if (nfallthru == 2) {\n-          \/\/ Ensure that the sense of the branch is correct\n-          Block *bnext = next(b);\n-          Block *bs0 = b->non_connector_successor(0);\n-\n-          MachNode *iff = b->get_node(b->number_of_nodes() - 3)->as_Mach();\n-          ProjNode *proj0 = b->get_node(b->number_of_nodes() - 2)->as_Proj();\n-          ProjNode *proj1 = b->get_node(b->number_of_nodes() - 1)->as_Proj();\n-\n-          if (bnext == bs0) {\n-            \/\/ Fall-thru case in succs[0], should be in succs[1]\n-\n-            \/\/ Flip targets in _succs map\n-            Block *tbs0 = b->_succs[0];\n-            Block *tbs1 = b->_succs[1];\n-            b->_succs.map( 0, tbs1 );\n-            b->_succs.map( 1, tbs0 );\n-\n-            \/\/ Flip projections to match targets\n-            b->map_node(proj1, b->number_of_nodes() - 2);\n-            b->map_node(proj0, b->number_of_nodes() - 1);\n-          }\n-        }\n-      }\n-    }\n-  }\n-}\n","filename":"src\/hotspot\/share\/opto\/block.cpp","additions":7,"deletions":43,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -800,2 +800,0 @@\n-  \/\/ Return the block that follows \"b\" in the trace.\n-  Block * next(Block *b) const { return _next_list[b->_pre_order]; }\n@@ -839,0 +837,3 @@\n+  \/\/ Return the block that follows \"b\" in the trace.\n+  Block * next(Block *b) const { return _next_list[b->_pre_order]; }\n+\n@@ -872,2 +873,0 @@\n-  \/\/ Adjust the the blocks in this trace\n-  void fixup_blocks(PhaseCFG &cfg);\n","filename":"src\/hotspot\/share\/opto\/block.hpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"}]}