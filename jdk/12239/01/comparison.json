{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2016, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,2 @@\n+import java.io.File;\n+import java.nio.charset.Charset;\n@@ -34,0 +36,1 @@\n+import java.time.Instant;\n@@ -90,0 +93,1 @@\n+        log(\"Entering call()\");\n@@ -130,0 +134,1 @@\n+        log(\"Leaving call()\");\n@@ -406,0 +411,1 @@\n+        log(\"vmCDS()\");\n@@ -476,0 +482,2 @@\n+        log(\"Entering dockerSupport()\");\n+\n@@ -494,0 +502,2 @@\n+        log(\"dockerSupport(): platform check: isSupported = \" + isSupported);\n+\n@@ -502,0 +512,1 @@\n+        log(\"dockerSupport(): returning isSupported = \" + isSupported);\n@@ -505,0 +516,15 @@\n+    private void redirectOutputToLogFile(String msg, ProcessBuilder pb, String fileNameBase) {\n+        if (!Boolean.getBoolean(\"jtreg.log.vmprops\")) {\n+            return;\n+        }\n+        String timeStamp = Instant.now().toString().replace(\":\", \"-\").replace(\".\", \"-\");\n+\n+        String stdoutFileName = String.format(\".\/%s-stdout--%s.log\", fileNameBase, timeStamp);\n+        pb.redirectOutput(new File(stdoutFileName));\n+        log(msg + \": child process stdout redirected to \" + stdoutFileName);\n+\n+        String stderrFileName = String.format(\".\/%s-stderr--%s.log\", fileNameBase, timeStamp);\n+        pb.redirectError(new File(stderrFileName));\n+        log(msg + \": child process stderr redirected to \" + stderrFileName);\n+   }\n+\n@@ -506,0 +532,1 @@\n+        log(\"checkDockerSupport(): entering\");\n@@ -507,0 +534,1 @@\n+        redirectOutputToLogFile(\"checkDockerSupport(): <container> ps\", pb, \"container-ps\");\n@@ -509,0 +537,1 @@\n+        int exitValue = p.exitValue();\n@@ -510,1 +539,2 @@\n-        return (p.exitValue() == 0);\n+        log(String.format(\"checkDockerSupport(): exitValue = %s, pid = %s\", exitValue, p.pid()));\n+        return (exitValue == 0);\n@@ -625,0 +655,16 @@\n+    \/**\n+     * Logs diagnostic message.\n+     *\n+     * @param msg\n+     *\/\n+    protected static void log(String msg) {\n+        if (!Boolean.getBoolean(\"jtreg.log.vmprops\")) {\n+            return;\n+        }\n+        \/\/ By jtreg design stderr produced here will be visible\n+        \/\/ in the output of a parent process.\n+        \/\/ Avoid logging to stdout as it will be filtered out by the jtreg\n+        \/\/ main process.\n+        System.err.println(\"VMProps: \" + msg);\n+    }\n+\n","filename":"test\/jtreg-ext\/requires\/VMProps.java","additions":48,"deletions":2,"binary":false,"changes":50,"status":"modified"}]}