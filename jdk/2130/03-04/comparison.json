{"files":[{"patch":"@@ -48,6 +48,15 @@\n-#define EXCEPTION_CHECK_AND_FREE(x) do { \\\n-                                        if ((*env)->ExceptionCheck(env)) { \\\n-                                            free(x); \\\n-                                            return NULL; \\\n-                                        } \\\n-                                    } while(0)\n+\/\/\n+\/\/ Checks for an exception and if one occurred,\n+\/\/ pops 'pops' local frames and frees 'x' before\n+\/\/ returning NULL\n+\/\/\n+#define POP_EXCEPTION_CHECK_AND_FREE(pops, x) do { \\\n+                                                  if ((*env)->ExceptionCheck(env)) { \\\n+                                                      int i; \\\n+                                                      for (i = 0; i < pops; i++) { \\\n+                                                          (*env)->PopLocalFrame(env, NULL); \\\n+                                                      } \\\n+                                                      free(x); \\\n+                                                      return NULL; \\\n+                                                  } \\\n+                                              } while(0)\n@@ -76,1 +85,1 @@\n-  EXCEPTION_CHECK_AND_FREE(dcmd_arg_info_array);\n+  POP_EXCEPTION_CHECK_AND_FREE(0, dcmd_arg_info_array);\n@@ -89,1 +98,1 @@\n-    EXCEPTION_CHECK_AND_FREE(dcmd_arg_info_array);\n+    POP_EXCEPTION_CHECK_AND_FREE(1, dcmd_arg_info_array);\n@@ -92,1 +101,1 @@\n-    EXCEPTION_CHECK_AND_FREE(dcmd_arg_info_array);\n+    POP_EXCEPTION_CHECK_AND_FREE(1, dcmd_arg_info_array);\n@@ -95,1 +104,1 @@\n-    EXCEPTION_CHECK_AND_FREE(dcmd_arg_info_array);\n+    POP_EXCEPTION_CHECK_AND_FREE(1, dcmd_arg_info_array);\n@@ -98,1 +107,1 @@\n-    EXCEPTION_CHECK_AND_FREE(dcmd_arg_info_array);\n+    POP_EXCEPTION_CHECK_AND_FREE(1, dcmd_arg_info_array);\n@@ -115,1 +124,1 @@\n-    EXCEPTION_CHECK_AND_FREE(dcmd_arg_info_array);\n+    POP_EXCEPTION_CHECK_AND_FREE(0, dcmd_arg_info_array);\n@@ -194,0 +203,1 @@\n+          (*env)->PopLocalFrame(env, NULL);\n@@ -200,1 +210,1 @@\n-      EXCEPTION_CHECK_AND_FREE(dcmd_info_array);\n+      POP_EXCEPTION_CHECK_AND_FREE(2, dcmd_info_array);\n@@ -203,1 +213,1 @@\n-      EXCEPTION_CHECK_AND_FREE(dcmd_info_array);\n+      POP_EXCEPTION_CHECK_AND_FREE(2, dcmd_info_array);\n@@ -206,1 +216,1 @@\n-      EXCEPTION_CHECK_AND_FREE(dcmd_info_array);\n+      POP_EXCEPTION_CHECK_AND_FREE(2, dcmd_info_array);\n@@ -218,0 +228,1 @@\n+          (*env)->PopLocalFrame(env, NULL);\n@@ -225,1 +236,1 @@\n-      EXCEPTION_CHECK_AND_FREE(dcmd_info_array);\n+      POP_EXCEPTION_CHECK_AND_FREE(1, dcmd_info_array);\n","filename":"src\/jdk.management\/share\/native\/libmanagement_ext\/DiagnosticCommandImpl.c","additions":27,"deletions":16,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -60,1 +60,1 @@\n-    private static String HOTSPOT_DIAGNOSTIC_MXBEAN_NAME =\n+    private static final String HOTSPOT_DIAGNOSTIC_MXBEAN_NAME =\n","filename":"test\/jdk\/com\/sun\/management\/DiagnosticCommandMBean\/DcmdMBeanTestCheckJni.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}