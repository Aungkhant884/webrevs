{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import java.awt.color.CMMException;\n@@ -40,1 +41,1 @@\n-    public static int BYTES_SH(int x) {\n+    static int BYTES_SH(int x) {\n@@ -44,1 +45,1 @@\n-    public static int EXTRA_SH(int x) {\n+    private static int EXTRA_SH(int x) {\n@@ -48,1 +49,1 @@\n-    public static int CHANNELS_SH(int x) {\n+    static int CHANNELS_SH(int x) {\n@@ -51,22 +52,15 @@\n-    public static final int SWAPFIRST = 1 << 14;\n-    public static final int DOSWAP = 1 << 10;\n-    public static final int PT_RGB_8 =\n-            CHANNELS_SH(3) | BYTES_SH(1);\n-    public static final int PT_GRAY_8 =\n-            CHANNELS_SH(1) | BYTES_SH(1);\n-    public static final int PT_GRAY_16 =\n-            CHANNELS_SH(1) | BYTES_SH(2);\n-    public static final int PT_RGBA_8 =\n-            EXTRA_SH(1) | CHANNELS_SH(3) | BYTES_SH(1);\n-    public static final int PT_ARGB_8 =\n-            EXTRA_SH(1) | CHANNELS_SH(3) | BYTES_SH(1) | SWAPFIRST;\n-    public static final int PT_BGR_8 =\n-            DOSWAP | CHANNELS_SH(3) | BYTES_SH(1);\n-    public static final int PT_ABGR_8 =\n-            DOSWAP | EXTRA_SH(1) | CHANNELS_SH(3) | BYTES_SH(1);\n-    public static final int PT_BGRA_8 = EXTRA_SH(1) | CHANNELS_SH(3)\n-            | BYTES_SH(1) | DOSWAP | SWAPFIRST;\n-    public static final int DT_BYTE = 0;\n-    public static final int DT_SHORT = 1;\n-    public static final int DT_INT = 2;\n-    public static final int DT_DOUBLE = 3;\n+    private static final int SWAPFIRST  = 1 << 14;\n+    private static final int DOSWAP     = 1 << 10;\n+    private static final int PT_GRAY_8  = CHANNELS_SH(1) | BYTES_SH(1);\n+    private static final int PT_GRAY_16 = CHANNELS_SH(1) | BYTES_SH(2);\n+    private static final int PT_RGB_8   = CHANNELS_SH(3) | BYTES_SH(1);\n+    private static final int PT_RGBA_8  = PT_RGB_8  | EXTRA_SH(1);\n+    private static final int PT_ARGB_8  = PT_RGBA_8 | SWAPFIRST;\n+    private static final int PT_BGR_8   = PT_RGB_8  | DOSWAP;\n+    private static final int PT_ABGR_8  = PT_BGR_8  | EXTRA_SH(1);\n+\/\/  private static final int PT_BGRA_8  = PT_ABGR_8 | SWAPFIRST;\n+\n+    private static final int DT_BYTE = 0;\n+    private static final int DT_SHORT = 1;\n+    private static final int DT_INT = 2;\n+    private static final int DT_DOUBLE = 3;\n@@ -86,3 +80,1 @@\n-    private LCMSImageLayout(int np, int pixelType, int pixelSize)\n-            throws ImageLayoutException\n-    {\n+    private LCMSImageLayout(int np, int pixelType, int pixelSize) {\n@@ -97,3 +89,1 @@\n-    private LCMSImageLayout(int width, int height, int pixelType,\n-                            int pixelSize)\n-            throws ImageLayoutException\n+    private LCMSImageLayout(int width, int height, int pixelType, int pixelSize)\n@@ -109,4 +99,1 @@\n-\n-    public LCMSImageLayout(byte[] data, int np, int pixelType, int pixelSize)\n-            throws ImageLayoutException\n-    {\n+    LCMSImageLayout(byte[] data, int np, int pixelType, int pixelSize) {\n@@ -121,3 +108,1 @@\n-    public LCMSImageLayout(short[] data, int np, int pixelType, int pixelSize)\n-            throws ImageLayoutException\n-    {\n+    LCMSImageLayout(short[] data, int np, int pixelType, int pixelSize) {\n@@ -132,3 +117,1 @@\n-    public LCMSImageLayout(int[] data, int np, int pixelType, int pixelSize)\n-            throws ImageLayoutException\n-    {\n+    LCMSImageLayout(int[] data, int np, int pixelType, int pixelSize) {\n@@ -143,3 +126,1 @@\n-    public LCMSImageLayout(double[] data, int np, int pixelType, int pixelSize)\n-            throws ImageLayoutException\n-    {\n+    LCMSImageLayout(double[] data, int np, int pixelType, int pixelSize) {\n@@ -160,1 +141,1 @@\n-    public static LCMSImageLayout createImageLayout(BufferedImage image) throws ImageLayoutException {\n+    static LCMSImageLayout createImageLayout(BufferedImage image) {\n@@ -291,1 +272,1 @@\n-        public static BandOrder getBandOrder(int[] bandOffsets) {\n+        static BandOrder getBandOrder(int[] bandOffsets) {\n@@ -323,1 +304,1 @@\n-    private void verify() throws ImageLayoutException {\n+    private void verify() {\n@@ -326,1 +307,1 @@\n-            throw new ImageLayoutException(\"Invalid image layout\");\n+            throw new CMMException(\"Invalid image layout\");\n@@ -336,3 +317,1 @@\n-    private static int checkIndex(long index, int length)\n-            throws ImageLayoutException\n-    {\n+    private static int checkIndex(long index, int length) {\n@@ -340,1 +319,1 @@\n-            throw new ImageLayoutException(\"Invalid image layout\");\n+            throw new CMMException(\"Invalid image layout\");\n@@ -345,1 +324,1 @@\n-    private static int safeMult(int a, int b) throws ImageLayoutException {\n+    private static int safeMult(int a, int b) {\n@@ -350,7 +329,1 @@\n-    @SuppressWarnings(\"serial\") \/\/ JDK-implementation class\n-    public static class ImageLayoutException extends Exception {\n-        public ImageLayoutException(String message) {\n-            super(message);\n-        }\n-    }\n-    public static LCMSImageLayout createImageLayout(Raster r) {\n+    static LCMSImageLayout createImageLayout(Raster r) {\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMSImageLayout.java","additions":33,"deletions":60,"binary":false,"changes":93,"status":"modified"},{"patch":"@@ -38,1 +38,0 @@\n-import java.awt.color.CMMException;\n@@ -52,2 +51,0 @@\n-import static sun.java2d.cmm.lcms.LCMSImageLayout.ImageLayoutException;\n-\n@@ -161,10 +158,8 @@\n-        try {\n-            if (isLCMSSupport(src, dst)) {\n-                dstIL = LCMSImageLayout.createImageLayout(dst);\n-\n-                if (dstIL != null) {\n-                    srcIL = LCMSImageLayout.createImageLayout(src);\n-                    if (srcIL != null) {\n-                        doTransform(srcIL, dstIL);\n-                        return;\n-                    }\n+        if (isLCMSSupport(src, dst)) {\n+            dstIL = LCMSImageLayout.createImageLayout(dst);\n+\n+            if (dstIL != null) {\n+                srcIL = LCMSImageLayout.createImageLayout(src);\n+                if (srcIL != null) {\n+                    doTransform(srcIL, dstIL);\n+                    return;\n@@ -173,2 +168,0 @@\n-        }  catch (ImageLayoutException e) {\n-            throw new CMMException(\"Unable to convert images\");\n@@ -176,1 +169,0 @@\n-\n@@ -232,12 +224,8 @@\n-            try {\n-                srcIL = new LCMSImageLayout(\n-                        srcLine, srcLine.length\/getNumInComponents(),\n-                        LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n-                        LCMSImageLayout.BYTES_SH(1), getNumInComponents());\n-                dstIL = new LCMSImageLayout(\n-                        dstLine, dstLine.length\/getNumOutComponents(),\n-                        LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n-                        LCMSImageLayout.BYTES_SH(1), getNumOutComponents());\n-            } catch (ImageLayoutException e) {\n-                throw new CMMException(\"Unable to convert images\");\n-            }\n+            srcIL = new LCMSImageLayout(\n+                    srcLine, srcLine.length\/getNumInComponents(),\n+                    LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n+                    LCMSImageLayout.BYTES_SH(1), getNumInComponents());\n+            dstIL = new LCMSImageLayout(\n+                    dstLine, dstLine.length\/getNumOutComponents(),\n+                    LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n+                    LCMSImageLayout.BYTES_SH(1), getNumOutComponents());\n@@ -292,2 +280,1 @@\n-            try {\n-                srcIL = new LCMSImageLayout(\n+            srcIL = new LCMSImageLayout(\n@@ -298,1 +285,1 @@\n-                dstIL = new LCMSImageLayout(\n+            dstIL = new LCMSImageLayout(\n@@ -302,3 +289,0 @@\n-            } catch (ImageLayoutException e) {\n-                throw new CMMException(\"Unable to convert images\");\n-            }\n@@ -413,13 +397,9 @@\n-        try {\n-            srcIL = new LCMSImageLayout(\n-                    srcLine, srcLine.length\/getNumInComponents(),\n-                    LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n-                    LCMSImageLayout.BYTES_SH(2), getNumInComponents()*2);\n-\n-            dstIL = new LCMSImageLayout(\n-                    dstLine, dstLine.length\/getNumOutComponents(),\n-                    LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n-                    LCMSImageLayout.BYTES_SH(2), getNumOutComponents()*2);\n-        } catch (ImageLayoutException e) {\n-            throw new CMMException(\"Unable to convert rasters\");\n-        }\n+        srcIL = new LCMSImageLayout(\n+                srcLine, srcLine.length\/getNumInComponents(),\n+                LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n+                LCMSImageLayout.BYTES_SH(2), getNumInComponents()*2);\n+\n+        dstIL = new LCMSImageLayout(\n+                dstLine, dstLine.length\/getNumOutComponents(),\n+                LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n+                LCMSImageLayout.BYTES_SH(2), getNumOutComponents()*2);\n@@ -516,12 +496,8 @@\n-            try {\n-                srcIL = new LCMSImageLayout(\n-                        srcLine, srcLine.length\/getNumInComponents(),\n-                        LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n-                        LCMSImageLayout.BYTES_SH(1), getNumInComponents());\n-                dstIL = new LCMSImageLayout(\n-                        dstLine, dstLine.length\/getNumOutComponents(),\n-                        LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n-                        LCMSImageLayout.BYTES_SH(1), getNumOutComponents());\n-            } catch (ImageLayoutException e) {\n-                throw new CMMException(\"Unable to convert rasters\");\n-            }\n+            srcIL = new LCMSImageLayout(\n+                    srcLine, srcLine.length\/getNumInComponents(),\n+                    LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n+                    LCMSImageLayout.BYTES_SH(1), getNumInComponents());\n+            dstIL = new LCMSImageLayout(\n+                    dstLine, dstLine.length\/getNumOutComponents(),\n+                    LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n+                    LCMSImageLayout.BYTES_SH(1), getNumOutComponents());\n@@ -559,0 +535,4 @@\n+            srcIL = new LCMSImageLayout(\n+                    srcLine, srcLine.length\/getNumInComponents(),\n+                    LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n+                    LCMSImageLayout.BYTES_SH(2), getNumInComponents()*2);\n@@ -560,13 +540,4 @@\n-            try {\n-                srcIL = new LCMSImageLayout(\n-                        srcLine, srcLine.length\/getNumInComponents(),\n-                        LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n-                        LCMSImageLayout.BYTES_SH(2), getNumInComponents()*2);\n-\n-                dstIL = new LCMSImageLayout(\n-                        dstLine, dstLine.length\/getNumOutComponents(),\n-                        LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n-                        LCMSImageLayout.BYTES_SH(2), getNumOutComponents()*2);\n-            } catch (ImageLayoutException e) {\n-                throw new CMMException(\"Unable to convert rasters\");\n-            }\n+            dstIL = new LCMSImageLayout(\n+                    dstLine, dstLine.length\/getNumOutComponents(),\n+                    LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n+                    LCMSImageLayout.BYTES_SH(2), getNumOutComponents()*2);\n@@ -612,0 +583,4 @@\n+        LCMSImageLayout srcIL = new LCMSImageLayout(\n+                src, src.length\/getNumInComponents(),\n+                LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n+                LCMSImageLayout.BYTES_SH(2), getNumInComponents()*2);\n@@ -613,5 +588,4 @@\n-        try {\n-            LCMSImageLayout srcIL = new LCMSImageLayout(\n-                    src, src.length\/getNumInComponents(),\n-                    LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n-                    LCMSImageLayout.BYTES_SH(2), getNumInComponents()*2);\n+        LCMSImageLayout dstIL = new LCMSImageLayout(\n+                dst, dst.length\/getNumOutComponents(),\n+                LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n+                LCMSImageLayout.BYTES_SH(2), getNumOutComponents()*2);\n@@ -619,4 +593,1 @@\n-            LCMSImageLayout dstIL = new LCMSImageLayout(\n-                    dst, dst.length\/getNumOutComponents(),\n-                    LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n-                    LCMSImageLayout.BYTES_SH(2), getNumOutComponents()*2);\n+        doTransform(srcIL, dstIL);\n@@ -624,6 +595,1 @@\n-            doTransform(srcIL, dstIL);\n-\n-            return dst;\n-        } catch (ImageLayoutException e) {\n-            throw new CMMException(\"Unable to convert data\");\n-        }\n+        return dst;\n@@ -636,0 +602,4 @@\n+        LCMSImageLayout srcIL = new LCMSImageLayout(\n+                src, src.length\/getNumInComponents(),\n+                LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n+                LCMSImageLayout.BYTES_SH(1), getNumInComponents());\n@@ -637,5 +607,4 @@\n-        try {\n-            LCMSImageLayout srcIL = new LCMSImageLayout(\n-                    src, src.length\/getNumInComponents(),\n-                    LCMSImageLayout.CHANNELS_SH(getNumInComponents()) |\n-                    LCMSImageLayout.BYTES_SH(1), getNumInComponents());\n+        LCMSImageLayout dstIL = new LCMSImageLayout(\n+                dst, dst.length\/getNumOutComponents(),\n+                LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n+                LCMSImageLayout.BYTES_SH(1), getNumOutComponents());\n@@ -643,4 +612,1 @@\n-            LCMSImageLayout dstIL = new LCMSImageLayout(\n-                    dst, dst.length\/getNumOutComponents(),\n-                    LCMSImageLayout.CHANNELS_SH(getNumOutComponents()) |\n-                    LCMSImageLayout.BYTES_SH(1), getNumOutComponents());\n+        doTransform(srcIL, dstIL);\n@@ -648,6 +614,1 @@\n-            doTransform(srcIL, dstIL);\n-\n-            return dst;\n-        } catch (ImageLayoutException e) {\n-            throw new CMMException(\"Unable to convert data\");\n-        }\n+        return dst;\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMSTransform.java","additions":63,"deletions":102,"binary":false,"changes":165,"status":"modified"}]}