{"files":[{"patch":"@@ -32,1 +32,0 @@\n-import java.util.List;\n@@ -34,4 +33,1 @@\n-import org.openide.nodes.AbstractNode;\n-import org.openide.nodes.Children;\n-import org.openide.nodes.Node;\n-import org.openide.nodes.Sheet;\n+import org.openide.nodes.*;\n@@ -52,1 +48,1 @@\n-    private static final Map<InputGraph, GraphNode> graphNode = new HashMap<>();\n+    private static final Map<InputGraph, GraphNode> graphNodeMap = new HashMap<>();\n@@ -69,8 +65,8 @@\n-        protected Node[] createNodes(FolderElement e) {\n-            if (e instanceof InputGraph) {\n-                InputGraph g = (InputGraph) e;\n-                GraphNode n = new GraphNode(g);\n-                graphNode.put(g, n);\n-                return new Node[]{n};\n-            } else if (e instanceof Folder) {\n-                return new Node[]{new FolderNode((Folder) e)};\n+        protected Node[] createNodes(FolderElement folderElement) {\n+            if (folderElement instanceof InputGraph) {\n+                InputGraph inputGraph = (InputGraph) folderElement;\n+                GraphNode graphNode = new GraphNode(inputGraph);\n+                graphNodeMap.put(inputGraph, graphNode);\n+                return new Node[]{graphNode};\n+            } else if (folderElement instanceof Group) {\n+                return new Node[]{new FolderNode((Group) folderElement)};\n@@ -86,1 +82,4 @@\n-                graphNode.values().remove(n);\n+                graphNodeMap.values().remove(n);\n+            }\n+            for (Node node : getNodes()) {\n+                node.setDisplayName(node.getDisplayName());\n@@ -92,1 +91,2 @@\n-            this.setKeys(folder.getElements());\n+            super.addNotify();\n+            setKeys(folder.getElements());\n@@ -98,1 +98,1 @@\n-         }\n+        }\n@@ -131,1 +131,1 @@\n-            content.add((RemoveCookie) () -> {\n+            this.content.add((RemoveCookie) () -> {\n@@ -144,0 +144,21 @@\n+    @Override\n+    public boolean canRename() {\n+        return true;\n+    }\n+\n+    @Override\n+    public void setName(String name) {\n+        children.getFolder().setName(name);\n+        fireDisplayNameChange(null, null);\n+    }\n+    @Override\n+    public String getName() {\n+        return children.getFolder().getName();\n+    }\n+\n+    @Override\n+    public String getDisplayName() {\n+        return children.getFolder().getDisplayName();\n+    }\n+\n+    @Override\n@@ -152,9 +173,0 @@\n-    public void init(String name, List<Group> groups) {\n-        this.setDisplayName(name);\n-        children.addNotify();\n-\n-        for (Group g : groups) {\n-            content.add(g);\n-        }\n-    }\n-\n@@ -172,1 +184,1 @@\n-        graphNode.clear();\n+        graphNodeMap.clear();\n@@ -176,1 +188,1 @@\n-        return graphNode.get(graph);\n+        return graphNodeMap.get(graph);\n","filename":"src\/utils\/IdealGraphVisualizer\/Coordinator\/src\/main\/java\/com\/sun\/hotspot\/igv\/coordinator\/FolderNode.java","additions":41,"deletions":29,"binary":false,"changes":70,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-    private InputGraph graph;\n+    private final InputGraph graph;\n@@ -55,0 +55,15 @@\n+    @Override\n+    public boolean canRename() {\n+        return true;\n+    }\n+\n+    @Override\n+    public void setName(String name) {\n+        graph.setName(name);\n+        fireDisplayNameChange(null, null);\n+    }\n+    @Override\n+    public String getName() {\n+        return graph.getName();\n+    }\n+\n@@ -61,0 +76,1 @@\n+    @Override\n@@ -68,0 +84,6 @@\n+\n+    @Override\n+    public String getDisplayName() {\n+        return graph.getDisplayName();\n+    }\n+\n@@ -89,7 +111,0 @@\n-\n-        this.addNodeListener(new NodeAdapter() {\n-            @Override\n-            public void childrenRemoved(NodeMemberEvent ev) {\n-                GraphNode.this.graph = null;\n-            }\n-        });\n","filename":"src\/utils\/IdealGraphVisualizer\/Coordinator\/src\/main\/java\/com\/sun\/hotspot\/igv\/coordinator\/GraphNode.java","additions":23,"deletions":8,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -29,0 +29,3 @@\n+    void setName(String name);\n+    String getName();\n+    String getDisplayName();\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/Folder.java","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -27,2 +27,2 @@\n-\n-    Folder getParent();\n+    ChangedEvent<? extends FolderElement> getDisplayNameChangedEvent();\n+    void setName(String name);\n@@ -30,0 +30,1 @@\n+    String getDisplayName();\n@@ -31,0 +32,1 @@\n+    Folder getParent();\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/FolderElement.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+    private String name;\n@@ -41,0 +42,1 @@\n+        setName(\"GraphDocument\");\n@@ -64,0 +66,14 @@\n+    @Override\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    @Override\n+    public String getDisplayName() {\n+        return getName();\n+    }\n+\n@@ -67,1 +83,0 @@\n-\n@@ -87,0 +102,3 @@\n+        for (FolderElement folderElement : elements) {\n+            folderElement.getDisplayNameChangedEvent().fire();\n+        }\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/GraphDocument.java","additions":19,"deletions":1,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -37,0 +37,2 @@\n+    private final ChangedEvent<Group> displayNameChangedEvent = new ChangedEvent<>(this);\n+\n@@ -75,0 +77,4 @@\n+        for (InputGraph inputGraph : graphs) {\n+            assert inputGraph.getDisplayNameChangedEvent() != null;\n+            inputGraph.getDisplayNameChangedEvent().fire();\n+        }\n@@ -105,0 +111,11 @@\n+    @Override\n+    public ChangedEvent<Group> getDisplayNameChangedEvent() {\n+        return displayNameChangedEvent;\n+    }\n+\n+    @Override\n+    public void setName(String name) {\n+        getProperties().setProperty(\"name\", name);\n+        displayNameChangedEvent.fire();\n+    }\n+\n@@ -110,0 +127,5 @@\n+    @Override\n+    public String getDisplayName() {\n+        return getParent().getElements().indexOf(this)+1 + \" - \" + getName();\n+    }\n+\n@@ -112,1 +134,0 @@\n-\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/Group.java","additions":22,"deletions":1,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -41,4 +41,4 @@\n-    private boolean isDiffGraph;\n-    private InputGraph firstGraph;\n-    private InputGraph secondGraph;\n-\n+    private final boolean isDiffGraph;\n+    private final InputGraph firstGraph;\n+    private final InputGraph secondGraph;\n+    private final ChangedEvent<InputGraph> displayNameChangedEvent = new ChangedEvent<>(this);\n@@ -47,1 +47,1 @@\n-        this(firstGraph.getName() + \" Δ \" + secondGraph.getName());\n+        this(firstGraph.getName() + \" Δ \" + secondGraph.getName(), firstGraph, secondGraph);\n@@ -49,3 +49,1 @@\n-        this.firstGraph = firstGraph;\n-        this.secondGraph = secondGraph;\n-        isDiffGraph = true;\n+\n@@ -55,0 +53,4 @@\n+        this(name, null, null);\n+    }\n+\n+    private InputGraph(String name, InputGraph firstGraph, InputGraph secondGraph) {\n@@ -61,3 +63,7 @@\n-        firstGraph = null;\n-        secondGraph = null;\n-        isDiffGraph = false;\n+        isDiffGraph = firstGraph != null && secondGraph != null;\n+        this.firstGraph = firstGraph;\n+        this.secondGraph = secondGraph;\n+        if (isDiffGraph) {\n+            this.firstGraph.getDisplayNameChangedEvent().addListener(l -> displayNameChangedEvent.fire());\n+            this.secondGraph.getDisplayNameChangedEvent().addListener(l -> displayNameChangedEvent.fire());\n+        }\n@@ -84,0 +90,3 @@\n+            assert displayNameChangedEvent != null;\n+            assert this.parentGroup.getDisplayNameChangedEvent() != null;\n+            this.parentGroup.getDisplayNameChangedEvent().addListener(l -> displayNameChangedEvent.fire());\n@@ -223,2 +232,9 @@\n-    private void setName(String name) {\n-        this.getProperties().setProperty(\"name\", name);\n+    @Override\n+    public ChangedEvent<InputGraph> getDisplayNameChangedEvent() {\n+        return displayNameChangedEvent;\n+    }\n+\n+    @Override\n+    public void setName(String name) {\n+        getProperties().setProperty(\"name\", name);\n+        displayNameChangedEvent.fire();\n@@ -232,0 +248,13 @@\n+    @Override\n+    public String getDisplayName() {\n+        if (isDiffGraph) {\n+            return firstGraph.getDisplayName() + \" Δ \" + secondGraph.getDisplayName();\n+        } else {\n+            return getIndex()+1 + \". \" + getName();\n+        }\n+    }\n+\n+    public int getIndex() {\n+        return getGroup().getGraphs().indexOf(this);\n+    }\n+\n","filename":"src\/utils\/IdealGraphVisualizer\/Data\/src\/main\/java\/com\/sun\/hotspot\/igv\/data\/InputGraph.java","additions":42,"deletions":13,"binary":false,"changes":55,"status":"modified"},{"patch":"@@ -40,0 +40,1 @@\n+import java.util.function.Consumer;\n@@ -48,1 +49,0 @@\n-    \/\/ Warning: Update setData method if fields are added\n@@ -61,0 +61,1 @@\n+    private ChangedListener<InputGraph> titleChangedListener = g -> {};\n@@ -393,0 +394,3 @@\n+        if (cachedInputGraph != null) {\n+            cachedInputGraph.getDisplayNameChangedEvent().removeListener(titleChangedListener);\n+        }\n@@ -400,0 +404,6 @@\n+        assert titleChangedListener != null;\n+        cachedInputGraph.getDisplayNameChangedEvent().addListener(titleChangedListener);\n+    }\n+\n+    void addTitleCallback(Consumer<InputGraph> titleCallback) {\n+        titleChangedListener = titleCallback::accept;\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/DiagramViewModel.java","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -138,6 +138,0 @@\n-        diagramViewModel.getDiagramChangedEvent().addListener(model -> {\n-            setDisplayName(model.getGraph().getName());\n-            setToolTipText(model.getGroup().getName());\n-            graphContent.set(Collections.singletonList(new EditorInputGraphProvider(this)), null);\n-        });\n-\n@@ -151,0 +145,11 @@\n+        diagramViewModel.addTitleCallback(changedGraph -> {\n+            setDisplayName(changedGraph.getDisplayName());\n+            setToolTipText(diagramViewModel.getGroup().getDisplayName());\n+        });\n+\n+        diagramViewModel.getDiagramChangedEvent().addListener(model -> {\n+            setDisplayName(model.getGraph().getDisplayName());\n+            setToolTipText(model.getGroup().getDisplayName());\n+            graphContent.set(Collections.singletonList(new EditorInputGraphProvider(this)), null);\n+        });\n+\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/EditorTopComponent.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"}]}