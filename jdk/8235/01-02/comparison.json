{"files":[{"patch":"@@ -56,2 +56,2 @@\n-\/\/ The default size of a stack-allocated buffer.\n-#define BUF_SIZE 8192\n+\/\/ The size of a stack-allocated buffer.\n+#define STACK_BUF_SIZE 8192\n@@ -79,2 +79,1 @@\n-    jint n, nread, read_size;\n-    char stackBuf[BUF_SIZE];\n+    char stackBuf[STACK_BUF_SIZE];\n@@ -82,1 +81,2 @@\n-    jint remaining, buf_size;\n+    jint buf_size, read_size;;\n+    jint n, nread;\n@@ -97,1 +97,1 @@\n-    } else if (len > BUF_SIZE) {\n+    } else if (len > STACK_BUF_SIZE) {\n@@ -106,1 +106,1 @@\n-        buf_size = BUF_SIZE;\n+        buf_size = STACK_BUF_SIZE;\n@@ -111,2 +111,3 @@\n-        remaining = len - nread;\n-        read_size = remaining <= buf_size ? remaining : buf_size;\n+        read_size = len - nread;\n+        if (read_size > buf_size)\n+            read_size = buf_size;\n@@ -167,2 +168,1 @@\n-    jint n, nwritten, write_size;\n-    char stackBuf[BUF_SIZE];\n+    char stackBuf[STACK_BUF_SIZE];\n@@ -170,1 +170,2 @@\n-    jint remaining, buf_size;\n+    jint buf_size, write_size;\n+    jint n;\n@@ -185,1 +186,1 @@\n-    } else if (len > BUF_SIZE) {\n+    } else if (len > STACK_BUF_SIZE) {\n@@ -194,1 +195,1 @@\n-        buf_size = BUF_SIZE;\n+        buf_size = STACK_BUF_SIZE;\n@@ -197,4 +198,2 @@\n-    nwritten = 0;\n-    while (nwritten < len) {\n-        remaining = len - nwritten;\n-        write_size = remaining <= buf_size ? remaining : buf_size;\n+    while (len > 0) {\n+        write_size = len < buf_size ? len : buf_size;\n@@ -213,4 +212,1 @@\n-            if (n > 0) {\n-                off += n;\n-                nwritten += n;\n-            } else if (n == -1) {\n+            if (n == -1) {\n@@ -220,0 +216,2 @@\n+            off += n;\n+            len -= n;\n","filename":"src\/java.base\/share\/native\/libjava\/io_util.c","additions":20,"deletions":22,"binary":false,"changes":42,"status":"modified"}]}