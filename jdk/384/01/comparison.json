{"files":[{"patch":"@@ -160,0 +160,5 @@\n+\/\/ Note that for cgroups v2 the actual limits set for swap and\n+\/\/ memory live in two different files, memory.swap.max and memory.max\n+\/\/ respectively. In order to properly report a cgroup v1 like\n+\/\/ compound value we need to sum the two values. Setting a swap limit\n+\/\/ without also setting a memory limit is not allowed.\n@@ -162,1 +167,9 @@\n-  return limit_from_str(mem_swp_limit_str);\n+  jlong swap_limit = limit_from_str(mem_swp_limit_str);\n+  if (swap_limit >= 0) {\n+    jlong memory_limit = read_memory_limit_in_bytes();\n+    if (memory_limit == -1) {\n+      return -1; \/\/ unlimited\n+    }\n+    return (memory_limit < 0 ? 0 : memory_limit) + swap_limit;\n+  }\n+  return swap_limit;\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":14,"deletions":1,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -277,0 +277,7 @@\n+    \/**\n+     * Note that for cgroups v2 the actual limits set for swap and\n+     * memory live in two different files, memory.swap.max and memory.max\n+     * respectively. In order to properly report a cgroup v1 like\n+     * compound value we need to sum the two values. Setting a swap limit\n+     * without also setting a memory limit is not allowed.\n+     *\/\n@@ -280,1 +287,9 @@\n-        return limitFromString(strVal);\n+        long swapLimit = limitFromString(strVal);\n+        if (swapLimit >= 0) {\n+            long memoryLimit = getMemoryLimit();\n+            if (memoryLimit == CgroupSubsystem.LONG_RETVAL_UNLIMITED) {\n+                return CgroupSubsystem.LONG_RETVAL_UNLIMITED;\n+            }\n+            return (memoryLimit < 0 ? 0 : memoryLimit) + swapLimit;\n+        }\n+        return swapLimit;\n","filename":"src\/java.base\/linux\/classes\/jdk\/internal\/platform\/cgroupv2\/CgroupV2Subsystem.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -243,1 +243,9 @@\n-        newVal = getLongLimitValueFromFile(\"memory.swap.max\");\n+        long valSwap = getLongLimitValueFromFile(\"memory.swap.max\");\n+        long valMemory = getLongLimitValueFromFile(\"memory.max\");\n+        if (valSwap == UNLIMITED) {\n+            newVal = valSwap;\n+        } else {\n+            \/\/ ignore error values for valMemory, since the container runtime\n+            \/\/ should prevent this from actually occurring.\n+            newVal = valSwap + valMemory;\n+        }\n","filename":"test\/lib\/jdk\/test\/lib\/containers\/cgroup\/MetricsTesterCgroupV2.java","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"}]}