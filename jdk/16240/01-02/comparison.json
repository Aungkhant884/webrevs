{"files":[{"patch":"@@ -1674,1 +1674,1 @@\n-static char* reserve_mmaped_memory(size_t bytes, char* requested_addr, int *fail_reason) {\n+static char* reserve_mmaped_memory(size_t bytes, char* requested_addr) {\n@@ -1730,2 +1730,0 @@\n-    if (fail_reason != nullptr)\n-      *fail_reason = errno;\n@@ -2153,1 +2151,1 @@\n-char* os::pd_attempt_reserve_memory_at(char* requested_addr, size_t bytes, bool exec, int *fail_reason) {\n+char* os::pd_attempt_reserve_memory_at(char* requested_addr, size_t bytes, bool exec) {\n@@ -2162,1 +2160,1 @@\n-    return reserve_mmaped_memory(bytes, requested_addr, fail_reason);\n+    return reserve_mmaped_memory(bytes, requested_addr);\n@@ -2167,1 +2165,1 @@\n-      return reserve_mmaped_memory(bytes, requested_addr, fail_reason);\n+      return reserve_mmaped_memory(bytes, requested_addr);\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1802,1 +1802,1 @@\n-char* os::pd_attempt_reserve_memory_at(char* requested_addr, size_t bytes, bool exec, int *fail_reason) {\n+char* os::pd_attempt_reserve_memory_at(char* requested_addr, size_t bytes, bool exec) {\n@@ -1813,3 +1813,0 @@\n-  \/\/ Keep the error number to report it back\n-  if (fail_reason != nullptr)\n-    *fail_reason = errno;\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -3485,1 +3485,1 @@\n-static char* anon_mmap(char* requested_addr, size_t bytes, int *fail_reason) {\n+static char* anon_mmap(char* requested_addr, size_t bytes) {\n@@ -3509,3 +3509,0 @@\n-  if (fail_reason != nullptr)\n-    *fail_reason = errno;\n-\n@@ -3529,1 +3526,1 @@\n-  char* start = anon_mmap(req_addr, extra_size, nullptr);\n+  char* start = anon_mmap(req_addr, extra_size);\n@@ -3557,1 +3554,1 @@\n-  return anon_mmap(nullptr, bytes, nullptr);\n+  return anon_mmap(nullptr, bytes);\n@@ -4216,1 +4213,1 @@\n-  char* result = pd_attempt_reserve_memory_at(requested_addr, bytes, !ExecMem, nullptr);\n+  char* result = pd_attempt_reserve_memory_at(requested_addr, bytes, !ExecMem);\n@@ -4228,1 +4225,1 @@\n-char* os::pd_attempt_reserve_memory_at(char* requested_addr, size_t bytes, bool exec, int *fail_reason) {\n+char* os::pd_attempt_reserve_memory_at(char* requested_addr, size_t bytes, bool exec) {\n@@ -4238,1 +4235,1 @@\n-  char * addr = anon_mmap(requested_addr, bytes, fail_reason);\n+  char * addr = anon_mmap(requested_addr, bytes);\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -3422,1 +3422,1 @@\n-char* os::pd_attempt_reserve_memory_at(char* addr, size_t bytes, bool exec, int *fail_reason) {\n+char* os::pd_attempt_reserve_memory_at(char* addr, size_t bytes, bool exec) {\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1811,2 +1811,2 @@\n-char* os::attempt_reserve_memory_at(char* addr, size_t bytes, bool executable, int *fail_reason) {\n-  char* result = pd_attempt_reserve_memory_at(addr, bytes, executable, fail_reason);\n+char* os::attempt_reserve_memory_at(char* addr, size_t bytes, bool executable) {\n+  char* result = pd_attempt_reserve_memory_at(addr, bytes, executable);\n@@ -1989,1 +1989,1 @@\n-    result = os::pd_attempt_reserve_memory_at(candidate, bytes, false, nullptr);\n+    result = os::pd_attempt_reserve_memory_at(candidate, bytes, false);\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -200,1 +200,1 @@\n-  static char*  pd_attempt_reserve_memory_at(char* addr, size_t bytes, bool executable, int *fail_reason);\n+  static char*  pd_attempt_reserve_memory_at(char* addr, size_t bytes, bool executable);\n@@ -441,1 +441,1 @@\n-  static char*  attempt_reserve_memory_at(char* addr, size_t bytes, bool executable = false, int *fail_reason = nullptr);\n+  static char*  attempt_reserve_memory_at(char* addr, size_t bytes, bool executable = false);\n","filename":"src\/hotspot\/share\/runtime\/os.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -509,1 +509,1 @@\n-  int fail_reason = 0;\n+  address p2 = (address)os::attempt_reserve_memory_at((char*)p_middle_stripes, middle_stripe_len, false);\n@@ -511,3 +511,1 @@\n-  address p2 = (address)os::attempt_reserve_memory_at((char*)p_middle_stripes, middle_stripe_len, false, &fail_reason);\n-\n-  ASSERT_EQ(p2, p_middle_stripes) << err_msg(\"allocation failed errno = %d, err-text: %s\\n\" , fail_reason, os::strerror(fail_reason));\n+  ASSERT_EQ(p2, p_middle_stripes);\n@@ -558,2 +556,2 @@\n-  const size_t stripe_len = 4 * M;\n-  const int num_stripes = 4;\n+  const size_t stripe_len = os::vm_allocation_granularity();\n+  const int num_stripes = 6;\n@@ -564,1 +562,0 @@\n-  ASSERT_NE(p, (address)NULL);\n@@ -566,0 +563,1 @@\n+  ASSERT_NE(p, (address)nullptr);\n@@ -567,2 +565,3 @@\n-  \/\/ .. release it...\n-  ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n+  \/\/ reserve at border of the region\n+  address border = p + num_stripes * stripe_len;\n+  address p2 = (address)os::attempt_reserve_memory_at((char*)border, stripe_len, false);\n@@ -571,6 +570,1 @@\n-  \/\/ re-reserve it. If failed, the reason is reported back through fail_reason.\n-  int fail_reason = 0;\n-\n-  address p2 = (address)os::attempt_reserve_memory_at((char*)p, total_range_len, false, &fail_reason);\n-\n-  ASSERT_EQ(p2, p) << err_msg(\"allocation at address failed errno = %d, err-text: %s\" , fail_reason, os::strerror(fail_reason));\n+  ASSERT_TRUE(p2 == nullptr || p2 == border);\n@@ -578,0 +572,1 @@\n+  ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n@@ -580,2 +575,4 @@\n-  ASSERT_TRUE(os::release_memory((char*)p, total_range_len));\n-  PRINT_MAPPINGS(\"D\");\n+  if (p2 != nullptr) {\n+    ASSERT_TRUE(os::release_memory((char*)p2, stripe_len));\n+    PRINT_MAPPINGS(\"D\");\n+  }\n","filename":"test\/hotspot\/gtest\/runtime\/test_os.cpp","additions":14,"deletions":17,"binary":false,"changes":31,"status":"modified"}]}