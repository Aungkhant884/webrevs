{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1998, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,0 +41,1 @@\n+import java.util.regex.Pattern;\n@@ -1353,12 +1354,12 @@\n-     \/**\n-      * Convert a \"#FFFFFF\" hex string to a Color.\n-      * If the color specification is bad, an attempt\n-      * will be made to fix it up.\n-      *\/\n-    static final Color hexToColor(String value) {\n-        String digits;\n-        int n = value.length();\n-        if (value.startsWith(\"#\")) {\n-            digits = value.substring(1, Math.min(value.length(), 7));\n-        } else {\n-            digits = value;\n+    private static final Pattern hex = Pattern.compile(\"\\\\p{XDigit}+\");\n+\n+    \/**\n+     * Convert a \"#FFF\", \"#FFFF\", \"#FFFFFF\" or \"#FFFFFFFF\" hex string to a Color.\n+     * If the color specification is bad, an attempt\n+     * will be made to fix it up.\n+     *\/\n+    static final Color hexToColor(String digits) {\n+        int n = digits.length();\n+        if (digits.startsWith(\"#\")) {\n+            digits = digits.substring(1, Math.min(n, 9));\n+            n--;\n@@ -1366,0 +1367,15 @@\n+        \/\/ CSS level 4\n+        \/\/ - defines color hex code as #[2 digits Red][2 digits Green][2 digits Blue][2 digits Alpha]. With digit 0 ... f.\n+        \/\/ - allows, webpage passes 3, 4, 6 or 8 digit color code.\n+        \/\/   - 3 digits #[R][G][B] ........ represents #[RR][GG][BB]FF\n+        \/\/   - 4 digits #[R][G][B][A] ..... represents #[RR][GG][BB][AA]\n+        \/\/   - 6 digits #[RR][GG][BB] ..... represents #[RR][GG][BB]FF\n+        \/\/   - 8 digits #[RR][GG][BB][AA] . represents #[RR][GG][BB][AA]\n+        \/\/\n+        \/\/ Becareful ! In java.awt.Color hex #[2 digits Alpha][2 digits Red][2 digits Green][2 digits Blue]\n+        \/\/ Since this method is defined in CSS.java, it must only take in charge CSS Level 4 color format.\n+        \/\/\n+        \/\/ According notes below the current OpenJDK implementation is\n+        \/\/ - 3 digits #[R][G][B]    represents #[RR][GG][BB]FF\n+        \/\/ - 6 digits #[R][G][B]    represents #[RR][GG][BB]FF\n+        \/\/\n@@ -1373,1 +1389,6 @@\n-        if (digits.length() == 3) {\n+        if (n == 3 && hex.matcher(digits).matches()) {\n+            final String r = digits.substring(0, 1);\n+            final String g = digits.substring(1, 2);\n+            final String b = digits.substring(2, 3);\n+            digits = String.format(\"%s%s%s%s%s%sff\", r, r, g, g, b, b);\n+        } else if (n == 4 && hex.matcher(digits).matches()) {\n@@ -1377,1 +1398,6 @@\n-            digits = String.format(\"%s%s%s%s%s%s\", r, r, g, g, b, b);\n+            final String a = digits.substring(3, 4);\n+            digits = String.format(\"%s%s%s%s%s%s%s%s\", r, r, g, g, b, b, a, a);\n+        } else if (n == 6 && hex.matcher(digits).matches()) {\n+            digits = String.format(\"%sff\", digits);\n+        } else if (n != 8 || !hex.matcher(digits).matches()) {\n+            return null;\n@@ -1379,2 +1405,0 @@\n-        String hstr = \"0x\" + digits;\n-        Color c;\n@@ -1382,1 +1406,3 @@\n-            c = Color.decode(hstr);\n+            Integer intValue = Integer.parseUnsignedInt(digits, 16);\n+            int l = intValue.intValue();\n+            return new Color((l >> 24) & 0xFF, (l >> 16) & 0xFF, (l >> 8) & 0xFF, l & 0xFF);\n@@ -1384,1 +1410,1 @@\n-            c = null;\n+            return null;\n@@ -1386,2 +1412,1 @@\n-         return c;\n-     }\n+    }\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/CSS.java","additions":46,"deletions":21,"binary":false,"changes":67,"status":"modified"}]}