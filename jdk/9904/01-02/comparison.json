{"files":[{"patch":"@@ -52,2 +52,2 @@\n-    set_loader(class_loader1);\n-    set_loader(class_loader2);\n+    add_loader(class_loader1);\n+    add_loader(class_loader2);\n@@ -56,1 +56,1 @@\n-  LoaderConstraint() { delete _loaders; }\n+  ~LoaderConstraint() { delete _loaders; }\n@@ -65,1 +65,1 @@\n-  void set_loader_data(ClassLoaderData* p) { _loaders->push(p); }\n+  void add_loader_data(ClassLoaderData* p) { _loaders->push(p); }\n@@ -73,1 +73,1 @@\n-  void set_loader(oop p) {\n+  void add_loader(oop p) {\n@@ -78,1 +78,1 @@\n-class LoaderConstraintEntry : public StackObj {      \/\/ copied into hashtable as value\n+class LoaderConstraintEntry {                        \/\/ copied into hashtable as value\n@@ -81,0 +81,1 @@\n+\n@@ -82,0 +83,3 @@\n+  LoaderConstraintEntry() : _constraints(nullptr) {}\n+  LoaderConstraintEntry(const LoaderConstraintEntry&) = delete;\n+  LoaderConstraintEntry& operator=(const LoaderConstraintEntry&) = delete;\n@@ -83,1 +87,1 @@\n-  LoaderConstraintEntry(LoaderConstraint* constraint) {\n+  void initialize(LoaderConstraint* constraint) {\n@@ -88,1 +92,1 @@\n-  void clean_up() {  \/\/ No dtor, dtors are dangerous\n+  ~LoaderConstraintEntry() {\n@@ -111,1 +115,1 @@\n-  set_loader(loader());\n+  add_loader(loader());\n@@ -162,5 +166,5 @@\n-  \/\/ an parameter name to a method call.  We impose this constraint that the\n-  \/\/ class that is eventually loaded much match between these two loaders.\n-  LoaderConstraintEntry* entry = _loader_constraint_table.get(name);\n-  if (entry == nullptr) {\n-    LoaderConstraintEntry entry(constraint);\n+  \/\/ a parameter name to a method call.  We impose this constraint that the\n+  \/\/ class that is eventually loaded must match between these two loaders.\n+  bool created;\n+  LoaderConstraintEntry* entry = _loader_constraint_table.put_if_absent(name, &created);\n+  if (created) {\n@@ -169,1 +173,1 @@\n-    _loader_constraint_table.put(name, entry);\n+    entry->initialize(constraint);\n@@ -240,1 +244,0 @@\n-      entry.clean_up();\n@@ -415,1 +418,1 @@\n-    dest->set_loader_data(src->loader_data(i));\n+    dest->add_loader_data(src->loader_data(i));\n","filename":"src\/hotspot\/share\/classfile\/loaderConstraints.cpp","additions":20,"deletions":17,"binary":false,"changes":37,"status":"modified"}]}