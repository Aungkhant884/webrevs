{"files":[{"patch":"@@ -362,2 +362,2 @@\n-        String saVersion = saProps.getProperty(versionProp);\n-        if (saVersion == null)\n+        String versionPropVal = saProps.getProperty(versionProp);\n+        if (versionPropVal == null) {\n@@ -365,0 +365,1 @@\n+        }\n@@ -366,2 +367,2 @@\n-        \/\/ Strip nonproduct VM version substring (note: saVersion doesn't have it).\n-        String vmVersion = vmRelease.replaceAll(\"(-fastdebug)|(-debug)|(-jvmg)|(-optimized)|(-profiled)\",\"\");\n+        var saVersion = Runtime.Version.parse(versionPropVal);\n+        var vmVersion = Runtime.Version.parse(vmRelease);\n@@ -373,2 +374,1 @@\n-        if (saVersion.indexOf('-') == saVersion.lastIndexOf('-') &&\n-            vmVersion.indexOf('-') == vmVersion.lastIndexOf('-')) {\n+        if (!saVersion.equalsIgnoreOptional(vmVersion)) {\n@@ -376,2 +376,2 @@\n-           \/\/ <major>.<minor>-b<n>\n-           throw new VMVersionMismatchException(saVersion, vmRelease);\n+           \/\/ <version>+<build>\n+           throw new VMVersionMismatchException(saVersion, vmVersion);\n@@ -381,2 +381,2 @@\n-           System.err.println(\"WARNING: Hotspot VM version \" + vmRelease +\n-                              \" does not match with SA version \" + saVersion +\n+           System.err.println(\"WARNING: Hotspot VM version \" + vmVersion.toString() +\n+                              \" does not match with SA version \" + saVersion.toString() +\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/VM.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-    public VMVersionMismatchException(String supported, String target) {\n+    public VMVersionMismatchException(Runtime.Version supported, Runtime.Version target) {\n@@ -37,2 +37,2 @@\n-        return \"Supported versions are \" + supportedVersions +\n-                \". Target VM is \" + targetVersion;\n+        return \"Supported versions are \" + supportedVersions.toString() +\n+                \". Target VM is \" + targetVersion.toString();\n@@ -41,1 +41,1 @@\n-    public String getSupportedVersions() {\n+    public Runtime.Version getSupportedVersions() {\n@@ -45,1 +45,1 @@\n-    public String getTargetVersion() {\n+    public Runtime.Version getTargetVersion() {\n@@ -49,2 +49,2 @@\n-    private String supportedVersions;\n-    private String targetVersion;\n+    private final Runtime.Version supportedVersions;\n+    private final Runtime.Version targetVersion;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/VMVersionMismatchException.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"}]}