{"files":[{"patch":"@@ -42,2 +42,1 @@\n-static void check_internal_types(JavaThread* jt) {\n-  DEBUG_ONLY(JfrJavaSupport::check_java_thread_in_vm(jt));\n+static void check_internal_types() {\n@@ -45,4 +44,6 @@\n-  if (!visible) {\n-    if (JfrEventSetting::is_internal_types_visible()) {\n-      visible = JfrUpcalls::unhide_internal_types(jt);\n-    }\n+  if (!visible && JfrEventSetting::is_internal_types_visible()) {\n+    JavaThread* const jt = JavaThread::current();\n+    DEBUG_ONLY(JfrJavaSupport::check_java_thread_in_native(jt));\n+    \/\/ can safepoint here\n+    ThreadInVMfromNative transition(jt);\n+    visible = JfrUpcalls::unhide_internal_types(jt);\n@@ -69,0 +70,1 @@\n+  check_internal_types();\n@@ -76,1 +78,1 @@\n-  check_internal_types(jt);\n+  check_internal_types();\n","filename":"src\/hotspot\/share\/jfr\/recorder\/checkpoint\/jfrMetadataEvent.cpp","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"}]}