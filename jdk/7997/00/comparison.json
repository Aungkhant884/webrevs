{"files":[{"patch":"@@ -165,7 +165,9 @@\n-    assert (oopDesc::is_oop(RawAccess<IS_NOT_NULL>::oop_load(p)),\n-            \"expected an oop while scanning weak refs\");\n-\n-    \/\/ Weak refs may be visited more than once.\n-    if (PSScavenge::should_scavenge(p, _to_space)) {\n-      _promotion_manager->copy_and_push_safe_barrier<\/*promote_immediately=*\/false>(p);\n-    }\n+#ifdef ASSERT\n+    \/\/ Referent must be non-null and in from-space\n+    oop obj = RawAccess<IS_NOT_NULL>::oop_load(p);\n+    assert(oopDesc::is_oop(obj), \"referent must be an oop\");\n+    assert(PSScavenge::is_obj_in_young(obj), \"must be in young-gen\");\n+    assert(!PSScavenge::is_obj_in_to_space(obj), \"must be in from-space\");\n+#endif\n+\n+    _promotion_manager->copy_and_push_safe_barrier<\/*promote_immediately=*\/false>(p);\n","filename":"src\/hotspot\/share\/gc\/parallel\/psScavenge.cpp","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"}]}