{"files":[{"patch":"@@ -100,1 +100,1 @@\n-    private static final DisabledAlgorithmConstraints DISABLED_CHECK =\n+    private static final DisabledAlgorithmConstraints JAR_DISABLED_CHECK =\n@@ -104,0 +104,4 @@\n+    private static final DisabledAlgorithmConstraints CERTPATH_DISABLED_CHECK =\n+            new DisabledAlgorithmConstraints(\n+                    DisabledAlgorithmConstraints.PROPERTY_CERTPATH_DISABLED_ALGS);\n+\n@@ -1324,1 +1328,1 @@\n-        if (DISABLED_CHECK.permits(primitiveSet, alg, null)) {\n+        if (JAR_DISABLED_CHECK.permits(primitiveSet, alg, null)) {\n@@ -1350,1 +1354,1 @@\n-        if (DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, key)) {\n+        if (JAR_DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, key)) {\n@@ -1369,1 +1373,1 @@\n-        if (DISABLED_CHECK.permits(primitiveSet, alg, null)) {\n+        if (JAR_DISABLED_CHECK.permits(primitiveSet, alg, null)) {\n@@ -1395,1 +1399,1 @@\n-        if (DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, key)) {\n+        if (JAR_DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, key)) {\n@@ -1406,1 +1410,1 @@\n-        if (DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, key)) {\n+        if (CERTPATH_DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, key)) {\n@@ -1422,1 +1426,1 @@\n-        if (DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, alg, null)) {\n+        if (CERTPATH_DISABLED_CHECK.permits(SIG_PRIMITIVE_SET, alg, null)) {\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/Main.java","additions":11,"deletions":7,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8259401\n+ * @bug 8259401 8266225\n@@ -91,0 +91,27 @@\n+\n+        \/*\n+         * Generate a non-self-signed certificate using MD5withRSA as its signature\n+         * algorithm to sign a JAR file.\n+         *\/\n+        kt(\"-genkeypair -keyalg rsa -alias cacert -dname CN=CACERT -ext bc:c \", \"ks\");\n+        kt(\"-genkeypair -keyalg rsa -alias ee -dname CN=EE -ext bc:c \", \"ks\");\n+        gencert(\"ee\", \"-alias cacert -ext san=dns:ee -sigalg MD5withRSA\");\n+\n+        SecurityTools.jarsigner(\"-keystore ks -storepass changeit \" +\n+                \"-signedjar signeda.jar \" +\n+                \"-verbose\" +\n+                \" a.jar ee\")\n+                .shouldContain(\"Signature algorithm: MD5withRSA (disabled), 2048-bit key\")\n+                .shouldContain(\"Signature algorithm: SHA256withRSA, 2048-bit key\")\n+                .shouldContain(\"Invalid certificate chain: Algorithm constraints check failed on signature algorithm: MD5withRSA\")\n+                .shouldHaveExitValue(0);\n+\n+        kt(\"-exportcert -alias cacert -rfc -file cacert\", \"ks\");\n+        kt(\"-importcert -noprompt -file cacert\", \"caks1\");\n+\n+        SecurityTools.jarsigner(\"-verify -certs signeda.jar \" +\n+                \"-keystore caks1 -storepass changeit -verbose -debug\")\n+                .shouldContain(\"Signature algorithm: MD5withRSA (disabled), 2048-bit key\")\n+                .shouldContain(\"Signature algorithm: SHA256withRSA, 2048-bit key\")\n+                .shouldContain(\"Invalid certificate chain: Algorithm constraints check failed on signature algorithm: MD5withRSA\")\n+                .shouldHaveExitValue(0);\n","filename":"test\/jdk\/sun\/security\/tools\/jarsigner\/CheckSignerCertChain.java","additions":28,"deletions":1,"binary":false,"changes":29,"status":"modified"}]}