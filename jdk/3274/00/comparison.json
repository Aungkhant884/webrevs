{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,2 +26,0 @@\n-import static jaxp.library.JAXPTestUtilities.runWithAllPerm;\n-\n@@ -30,1 +28,0 @@\n-import javax.xml.transform.TransformerFactoryConfigurationError;\n@@ -32,0 +29,1 @@\n+import static jaxp.library.JAXPTestUtilities.runWithAllPerm;\n@@ -49,11 +47,5 @@\n-        try {\n-            runWithAllPerm(() -> Thread.currentThread().setContextClassLoader(null));\n-            if (Bug6350682.class.getClassLoader() == null)\n-                System.out.println(\"this class loader is NULL\");\n-            else\n-                System.out.println(\"this class loader is NOT NULL\");\n-            SAXParserFactory factory = SAXParserFactory.newInstance();\n-            Assert.assertTrue(factory != null, \"Failed to get an instance of a SAXParserFactory\");\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            Assert.fail(\"Exception occured: \" + e.getMessage());\n+        runWithAllPerm(() -> Thread.currentThread().setContextClassLoader(null));\n+        if (Bug6350682.class.getClassLoader() == null) {\n+            System.out.println(\"this class loader is NULL\");\n+        } else {\n+            System.out.println(\"this class loader is NOT NULL\");\n@@ -61,0 +53,2 @@\n+        SAXParserFactory factory = SAXParserFactory.newInstance();\n+        Assert.assertNotNull(factory, \"Failed to get an instance of a SAXParserFactory\");\n@@ -65,11 +59,3 @@\n-        try {\n-            runWithAllPerm(() -> Thread.currentThread().setContextClassLoader(null));\n-            TransformerFactory factory = TransformerFactory.newInstance();\n-            Assert.assertTrue(factory != null, \"Failed to get an instance of a TransformerFactory\");\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            Assert.fail(\"Exception occured: \" + e.getMessage());\n-        } catch (TransformerFactoryConfigurationError error) {\n-            error.printStackTrace();\n-            Assert.fail(error.toString());\n-        }\n+        runWithAllPerm(() -> Thread.currentThread().setContextClassLoader(null));\n+        TransformerFactory factory = TransformerFactory.newInstance();\n+        Assert.assertNotNull(factory, \"Failed to get an instance of a TransformerFactory\");\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/Bug6350682.java","additions":12,"deletions":26,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -26,3 +26,0 @@\n-import org.testng.annotations.Listeners;\n-import org.testng.annotations.Test;\n-import org.testng.Assert;\n@@ -34,0 +31,4 @@\n+import org.testng.Assert;\n+import org.testng.annotations.Listeners;\n+import org.testng.annotations.Test;\n+\n@@ -44,0 +45,1 @@\n+    private static final String ERR_MSG = \"org.apache.xerces.jaxp.SAXParserFactoryImpl not found\";\n@@ -46,1 +48,1 @@\n-    public void test1() {\n+    public void testSAXParserFactoryCreationWithDefaultContextClassLoader() {\n@@ -50,1 +52,1 @@\n-            if (e.getMessage().indexOf(\"org.apache.xerces.jaxp.SAXParserFactoryImpl not found\") > 0) {\n+            if (e.getMessage().contains(ERR_MSG)) {\n@@ -57,1 +59,1 @@\n-    public void test2() {\n+    public void testSAXParserFactoryCreationWithGivenURLContextClassLoader() {\n@@ -64,1 +66,1 @@\n-            if (e.getMessage().indexOf(\"org.apache.xerces.jaxp.SAXParserFactoryImpl not found\") > 0) {\n+            if (e.getMessage().contains(ERR_MSG)) {\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/Bug6723276Test.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -1,10 +0,0 @@\n-<?xml version=\"1.0\"?>\n-<root xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"Bug6941169.xsd\">\n-\t<fooTest>\n-    test\n-\n-\n-\n-    information\n-\t<\/fooTest>\n-<\/root>\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/Bug6941169.xml","additions":0,"deletions":10,"binary":false,"changes":10,"status":"deleted"},{"patch":"@@ -1,11 +0,0 @@\n-<?xml version=\"1.0\"?>\n-<xs:schema xmlns:xs=\"http:\/\/www.w3.org\/2001\/XMLSchema\">\n-    <xs:element name=\"root\">\n-        <xs:complexType>\n-            <xs:sequence>\n-                <xs:element name=\"fooTest\" type=\"xs:anySimpleType\" fixed=\"test information\"\/>\n-            <\/xs:sequence>\n-        <\/xs:complexType>\n-    <\/xs:element>\n-<\/xs:schema>\n-\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/Bug6941169.xsd","additions":0,"deletions":11,"binary":false,"changes":11,"status":"deleted"},{"patch":"@@ -1,496 +0,0 @@\n-\/*\n- * Copyright (c) 2014, 2017, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-package common;\n-\n-import static jaxp.library.JAXPTestUtilities.clearSystemProperty;\n-import static jaxp.library.JAXPTestUtilities.getSystemProperty;\n-import static jaxp.library.JAXPTestUtilities.setSystemProperty;\n-\n-import java.io.FilePermission;\n-import java.io.InputStream;\n-import java.io.StringWriter;\n-\n-import javax.xml.XMLConstants;\n-import javax.xml.parsers.DocumentBuilder;\n-import javax.xml.parsers.DocumentBuilderFactory;\n-import javax.xml.transform.Transformer;\n-import javax.xml.transform.TransformerFactory;\n-import javax.xml.transform.dom.DOMSource;\n-import javax.xml.transform.sax.SAXSource;\n-import javax.xml.transform.stream.StreamResult;\n-import javax.xml.transform.stream.StreamSource;\n-import javax.xml.validation.Schema;\n-import javax.xml.validation.SchemaFactory;\n-import javax.xml.validation.Validator;\n-import javax.xml.xpath.XPath;\n-import javax.xml.xpath.XPathFactory;\n-\n-import jaxp.library.JAXPTestUtilities;\n-\n-import org.testng.Assert;\n-import org.testng.annotations.Listeners;\n-import org.testng.annotations.Test;\n-import org.w3c.dom.Document;\n-import org.xml.sax.InputSource;\n-\n-\/*\n- * @test\n- * @bug 6941169\n- * @library \/javax\/xml\/jaxp\/libs \/javax\/xml\/jaxp\/unittest\n- * @run testng\/othervm -DrunSecMngr=true common.Bug6941169Test\n- * @run testng\/othervm common.Bug6941169Test\n- * @summary Test use-service-mechanism feature.\n- *\/\n-@Test(singleThreaded = true)\n-@Listeners({ jaxp.library.FilePolicy.class })\n-public class Bug6941169Test {\n-    static final String SCHEMA_LANGUAGE = \"http:\/\/java.sun.com\/xml\/jaxp\/properties\/schemaLanguage\";\n-    static final String SCHEMA_SOURCE = \"http:\/\/java.sun.com\/xml\/jaxp\/properties\/schemaSource\";\n-\n-    private static final String DOM_FACTORY_ID = \"javax.xml.parsers.DocumentBuilderFactory\";\n-    private static final String SAX_FACTORY_ID = \"javax.xml.parsers.SAXParserFactory\";\n-\n-    \/\/ impl specific feature\n-    final String ORACLE_FEATURE_SERVICE_MECHANISM = \"http:\/\/www.oracle.com\/feature\/use-service-mechanism\";\n-\n-    static String _xml = Bug6941169Test.class.getResource(\"Bug6941169.xml\").getPath();\n-    static String _xsd = Bug6941169Test.class.getResource(\"Bug6941169.xsd\").getPath();\n-\n-    @Test\n-    public void testValidation_SAX_withoutServiceMech() {\n-        System.out.println(\"Validation using SAX Source;  Service mechnism is turned off;  SAX Impl should be the default:\");\n-        InputSource is = new InputSource(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\"));\n-        SAXSource ss = new SAXSource(is);\n-        setSystemProperty(SAX_FACTORY_ID, \"MySAXFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n-            factory.setFeature(ORACLE_FEATURE_SERVICE_MECHANISM, false);\n-            Schema schema = factory.newSchema(new StreamSource(_xsd));\n-            Validator validator = schema.newValidator();\n-            validator.validate(ss, null);\n-        } catch (Exception e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"javax.xml.parsers.FactoryConfigurationError: Provider MySAXFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        }\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-        clearSystemProperty(SAX_FACTORY_ID);\n-    }\n-\n-    @Test\n-    public void testValidation_SAX_withServiceMech() {\n-        System.out.println(\"Validation using SAX Source. Using service mechnism (by default) to find SAX Impl:\");\n-        InputSource is = new InputSource(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\"));\n-        SAXSource ss = new SAXSource(is);\n-        setSystemProperty(SAX_FACTORY_ID, \"MySAXFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n-            Schema schema = factory.newSchema(new StreamSource(_xsd));\n-            Validator validator = schema.newValidator();\n-            validator.validate(ss, null);\n-            Assert.fail(\"User impl MySAXFactoryImpl should be used.\");\n-        } catch (Exception e) {\n-            String error = e.getMessage();\n-            if (error.indexOf(\"javax.xml.parsers.FactoryConfigurationError: Provider MySAXFactoryImpl not found\") > 0) {\n-                \/\/ expected\n-            }\n-            \/\/ System.out.println(e.getMessage());\n-\n-        }\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-        clearSystemProperty(SAX_FACTORY_ID);\n-    }\n-\n-    @Test\n-    public void testValidation_SAX_withSM() throws Exception {\n-        if(System.getSecurityManager() == null)\n-            return;\n-\n-        System.out.println(\"Validation using SAX Source with security manager:\");\n-        InputSource is = new InputSource(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\"));\n-        SAXSource ss = new SAXSource(is);\n-        setSystemProperty(SAX_FACTORY_ID, \"MySAXFactoryImpl\");\n-\n-        long start = System.currentTimeMillis();\n-        try {\n-            SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n-            factory.setFeature(ORACLE_FEATURE_SERVICE_MECHANISM, false);\n-            Schema schema = factory.newSchema(new StreamSource(_xsd));\n-            Validator validator = schema.newValidator();\n-            validator.validate(ss, null);\n-        } catch (Exception e) {\n-            String error = e.getMessage();\n-            if (error.indexOf(\"javax.xml.parsers.FactoryConfigurationError: Provider MySAXFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } finally {\n-            clearSystemProperty(SAX_FACTORY_ID);\n-        }\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-\n-    }\n-\n-    @Test\n-    public void testTransform_DOM_withoutServiceMech() {\n-        System.out.println(\"Transform using DOM Source;  Service mechnism is turned off;  Default DOM Impl should be the default:\");\n-        DOMSource domSource = new DOMSource();\n-        domSource.setSystemId(_xml);\n-\n-        \/\/ DOMSource domSource = new\n-        \/\/ DOMSource(getDocument(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\")));\n-        setSystemProperty(DOM_FACTORY_ID, \"MyDOMFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            TransformerFactory factory = TransformerFactory.newInstance();\n-            factory.setFeature(ORACLE_FEATURE_SERVICE_MECHANISM, false);\n-\n-            Transformer t = factory.newTransformer();\n-\n-            StringWriter result = new StringWriter();\n-            StreamResult streamResult = new StreamResult(result);\n-            t.transform(domSource, streamResult);\n-            System.out.println(\"Writing to \" + result.toString());\n-\n-        } catch (Exception e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"Provider MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } catch (Error e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"Provider MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        }\n-\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-        clearSystemProperty(DOM_FACTORY_ID);\n-    }\n-\n-    \/** this is by default *\/\n-    @Test\n-    public void testTransform_DOM_withServiceMech() {\n-        System.out.println(\"Transform using DOM Source;  By default, the factory uses services mechanism to look up impl:\");\n-        DOMSource domSource = new DOMSource();\n-        domSource.setSystemId(_xml);\n-\n-        \/\/ DOMSource domSource = new\n-        \/\/ DOMSource(getDocument(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\")));\n-        setSystemProperty(DOM_FACTORY_ID, \"MyDOMFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            TransformerFactory factory = TransformerFactory.newInstance();\n-            Transformer t = factory.newTransformer();\n-\n-            StringWriter result = new StringWriter();\n-            StreamResult streamResult = new StreamResult(result);\n-            t.transform(domSource, streamResult);\n-            System.out.println(\"Writing to \" + result.toString());\n-\n-            Assert.fail(\"User impl MyDOMFactoryImpl should be used.\");\n-\n-        } catch (Exception e) {\n-            String error = e.getMessage();\n-            if (error.indexOf(\"Provider MyDOMFactoryImpl not found\") > 0) {\n-                \/\/ expected\n-            }\n-            System.out.println(error);\n-\n-        } catch (Error e) {\n-            String error = e.getMessage();\n-            if (error.indexOf(\"Provider MyDOMFactoryImpl not found\") > 0) {\n-                \/\/ expected\n-            }\n-            System.out.println(error);\n-\n-        }\n-\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-        clearSystemProperty(DOM_FACTORY_ID);\n-    }\n-\n-    @Test\n-    public void testTransform_DOM_withSM() throws Exception {\n-        if(System.getSecurityManager() == null)\n-            return;\n-        System.out.println(\"Transform using DOM Source;  Security Manager is set:\");\n-        DOMSource domSource = new DOMSource();\n-        domSource.setSystemId(_xml);\n-\n-        \/\/ DOMSource domSource = new\n-        \/\/ DOMSource(getDocument(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\")));\n-        setSystemProperty(DOM_FACTORY_ID, \"MyDOMFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            TransformerFactory factory = TransformerFactory.newInstance(\"com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl\",\n-                    TransformerFactory.class.getClassLoader());\n-            Transformer t = factory.newTransformer();\n-\n-            StringWriter result = new StringWriter();\n-            StreamResult streamResult = new StreamResult(result);\n-            t.transform(domSource, streamResult);\n-            System.out.println(\"Writing to \" + result.toString());\n-\n-        } catch (Exception e) {\n-            String error = e.getMessage();\n-            if (error.indexOf(\"Provider MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } catch (Error e) {\n-            String error = e.getMessage();\n-            if (error.indexOf(\"Provider MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } finally {\n-            clearSystemProperty(DOM_FACTORY_ID);\n-        }\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-\n-    }\n-\n-    @Test\n-    public void testXPath_DOM_withoutServiceMech() {\n-        final String XPATH_EXPRESSION = \"\/fooTest\";\n-        System.out.println(\"Evaluate DOM Source;  Service mechnism is turned off;  Default DOM Impl should be used:\");\n-        Document doc = getDocument(Bug6941169Test.class.getResourceAsStream(\"Bug6941169.xml\"));\n-        setSystemProperty(DOM_FACTORY_ID, \"MyDOMFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            XPathFactory xPathFactory = XPathFactory.newInstance();\n-            xPathFactory.setFeature(ORACLE_FEATURE_SERVICE_MECHANISM, false);\n-\n-            XPath xPath = xPathFactory.newXPath();\n-\n-            String xPathResult = xPath.evaluate(XPATH_EXPRESSION, doc);\n-\n-        } catch (Exception e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } catch (Error e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl is used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        }\n-\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-        clearSystemProperty(DOM_FACTORY_ID);\n-    }\n-\n-    @Test\n-    public void testXPath_DOM_withServiceMech() {\n-        \/**\n-         * This is in conflict with the test testXPath_DOM_withSM where the system\n-         * default parser is used when the security manager is present. The test\n-         * is therefore skipped when the security manager is present.\n-         *\/\n-        if (System.getSecurityManager() != null) {\n-            return;\n-        }\n-        final String XPATH_EXPRESSION = \"\/fooTest\";\n-        System.out.println(\"Evaluate DOM Source;  Service mechnism is on by default;  It would try to use MyDOMFactoryImpl:\");\n-        InputStream input = getClass().getResourceAsStream(\"Bug6941169.xml\");\n-        InputSource source = new InputSource(input);\n-        setSystemProperty(DOM_FACTORY_ID, \"MyDOMFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            XPathFactory xPathFactory = XPathFactory.newInstance();\n-\n-            XPath xPath = xPathFactory.newXPath();\n-\n-            String xPathResult = xPath.evaluate(XPATH_EXPRESSION, source);\n-            Assert.fail(\"User impl MyDOMFactoryImpl should be used.\");\n-\n-        } catch (Exception e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"MyDOMFactoryImpl not found\") > 0) {\n-                System.out.println(\"Tried to locate MyDOMFactoryImpl\");\n-            } else {\n-                Assert.fail(e.getMessage());\n-\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } catch (Error e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"MyDOMFactoryImpl not found\") > 0) {\n-                System.out.println(\"Tried to locate MyDOMFactoryImpl\");\n-            } else {\n-                Assert.fail(e.getMessage());\n-\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        }\n-\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-        clearSystemProperty(DOM_FACTORY_ID);\n-    }\n-\n-    @Test\n-    public void testXPath_DOM_withSM() throws Exception {\n-        if(System.getSecurityManager() == null)\n-            return;\n-        final String XPATH_EXPRESSION = \"\/fooTest\";\n-        System.out.println(\"Evaluate DOM Source;  Security Manager is set:\");\n-        InputStream input = getClass().getResourceAsStream(\"Bug6941169.xml\");\n-        InputSource source = new InputSource(input);\n-        setSystemProperty(DOM_FACTORY_ID, \"MyDOMFactoryImpl\");\n-        long start = System.currentTimeMillis();\n-        try {\n-            XPathFactory xPathFactory = XPathFactory.newInstance(\"http:\/\/java.sun.com\/jaxp\/xpath\/dom\",\n-                    \"com.sun.org.apache.xpath.internal.jaxp.XPathFactoryImpl\", null);\n-\n-            XPath xPath = xPathFactory.newXPath();\n-\n-            String xPathResult = xPath.evaluate(XPATH_EXPRESSION, source);\n-            System.out.println(\"Use default impl\");\n-        } catch (Exception e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl should be used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } catch (Error e) {\n-            \/\/ e.printStackTrace();\n-            String error = e.getMessage();\n-            if (error.indexOf(\"MyDOMFactoryImpl not found\") > 0) {\n-                Assert.fail(e.getMessage());\n-            } else {\n-                System.out.println(\"Default impl should be used\");\n-            }\n-\n-            \/\/ System.out.println(e.getMessage());\n-\n-        } finally {\n-            clearSystemProperty(DOM_FACTORY_ID);\n-        }\n-        long end = System.currentTimeMillis();\n-        double elapsedTime = ((end - start));\n-        System.out.println(\"Time elapsed: \" + elapsedTime);\n-\n-    }\n-\n-    @Test\n-    public void testSM() {\n-        SecurityManager sm = System.getSecurityManager();\n-        if (System.getSecurityManager() != null) {\n-            System.out.println(\"Security manager not cleared: \" + sm.toString());\n-        } else {\n-            System.out.println(\"Security manager cleared: \");\n-        }\n-    }\n-\n-    private static Document getDocument(InputStream in) {\n-\n-        Document document = null;\n-\n-        try {\n-            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n-            dbf.setNamespaceAware(true);\n-            DocumentBuilder db = dbf.newDocumentBuilder();\n-            document = db.parse(in);\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            Assert.fail(e.toString());\n-        }\n-\n-        return document;\n-    }\n-}\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/Bug6941169Test.java","additions":0,"deletions":496,"binary":false,"changes":496,"status":"deleted"},{"patch":"@@ -26,3 +26,0 @@\n-import static jaxp.library.JAXPTestUtilities.clearSystemProperty;\n-import static jaxp.library.JAXPTestUtilities.setSystemProperty;\n-\n@@ -34,0 +31,2 @@\n+import static jaxp.library.JAXPTestUtilities.clearSystemProperty;\n+import static jaxp.library.JAXPTestUtilities.setSystemProperty;\n@@ -48,2 +47,2 @@\n-    static final String SCHEMA_LANGUAGE = \"http:\/\/java.sun.com\/xml\/jaxp\/properties\/schemaLanguage\";\n-    static final String SCHEMA_SOURCE = \"http:\/\/java.sun.com\/xml\/jaxp\/properties\/schemaSource\";\n+    private static final String SCHEMA_LANGUAGE = \"http:\/\/java.sun.com\/xml\/jaxp\/properties\/schemaLanguage\";\n+    private static final String SCHEMA_SOURCE = \"http:\/\/java.sun.com\/xml\/jaxp\/properties\/schemaSource\";\n@@ -55,1 +54,1 @@\n-    final String ORACLE_FEATURE_SERVICE_MECHANISM = \"http:\/\/www.oracle.com\/feature\/use-service-mechanism\";\n+    private static final String ORACLE_FEATURE_SERVICE_MECHANISM = \"http:\/\/www.oracle.com\/feature\/use-service-mechanism\";\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/common\/Bug7143711Test.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+import org.testng.annotations.BeforeClass;\n@@ -47,0 +48,5 @@\n+    @BeforeClass\n+    public void createDataTypeFactory() throws DatatypeConfigurationException {\n+        df = DatatypeFactory.newInstance();\n+    }\n+\n@@ -49,11 +55,5 @@\n-        try {\n-            df = DatatypeFactory.newInstance();\n-        } catch (DatatypeConfigurationException e) {\n-            Assert.fail(e.getMessage());\n-        }\n-\n-        try {\n-            XMLGregorianCalendar calendar = df.newXMLGregorianCalendar(1970, 1, 1, 24, 0, 0, 0, 0);\n-        } catch (IllegalArgumentException e) {\n-            Assert.fail(e.getMessage());\n-        }\n+        XMLGregorianCalendar calendar = df.newXMLGregorianCalendar(1970, 1, 1, 24, 0, 0, 0, 0);\n+        Assert.assertEquals(calendar.getYear(), 1970);\n+        Assert.assertEquals(calendar.getMonth(), 1);\n+        Assert.assertEquals(calendar.getDay(), 2);\n+        Assert.assertEquals(calendar.getHour(), 0, \"hour 24 needs to be treated as hour 0 of next day\");\n@@ -64,11 +64,2 @@\n-        try {\n-            df = DatatypeFactory.newInstance();\n-        } catch (DatatypeConfigurationException e) {\n-            Assert.fail(e.getMessage());\n-        }\n-\n-        try {\n-            XMLGregorianCalendar calendar = df.newXMLGregorianCalendarTime(24, 0, 0, 0);\n-        } catch (IllegalArgumentException e) {\n-            Assert.fail(e.getMessage());\n-        }\n+        XMLGregorianCalendar calendar = df.newXMLGregorianCalendarTime(24, 0, 0, 0);\n+        Assert.assertEquals(calendar.getHour(), 0, \"hour 24 needs to be treated as hour 0 of next day\");\n@@ -77,1 +68,1 @@\n-    @Test\n+    @Test(expectedExceptions = IllegalArgumentException.class)\n@@ -79,13 +70,3 @@\n-        try {\n-            df = DatatypeFactory.newInstance();\n-        } catch (DatatypeConfigurationException e) {\n-            Assert.fail(e.getMessage());\n-        }\n-        try {\n-            XMLGregorianCalendar calendar = df.newXMLGregorianCalendar();\n-            \/\/ Must fail as other params are not 0 but undefined\n-            calendar.setHour(24);\n-            Assert.fail(\"test3() - Expected IllegalArgumentException not thrown\");\n-        } catch (IllegalArgumentException e) {\n-            \/\/ falls through\n-        }\n+        XMLGregorianCalendar calendar = df.newXMLGregorianCalendar();\n+        \/\/ Must fail as other params are not 0 but undefined\n+        calendar.setHour(24);\n@@ -96,12 +77,3 @@\n-        try {\n-            df = DatatypeFactory.newInstance();\n-        } catch (DatatypeConfigurationException e) {\n-            Assert.fail(e.getMessage());\n-        }\n-\n-        try {\n-            XMLGregorianCalendar calendar = df.newXMLGregorianCalendar();\n-            calendar.setTime(24, 0, 0, 0);\n-        } catch (IllegalArgumentException e) {\n-            Assert.fail(e.getMessage());\n-        }\n+        XMLGregorianCalendar calendar = df.newXMLGregorianCalendar();\n+        calendar.setTime(24, 0, 0, 0);\n+        Assert.assertEquals(calendar.getHour(), 0, \"hour 24 needs to be treated as hour 0 of next day\");\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/datatype\/Bug6320118.java","additions":20,"deletions":48,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -36,0 +36,1 @@\n+import org.testng.annotations.DataProvider;\n@@ -59,1 +60,1 @@\n-    static final DatatypeConstants.Field[] fields = { DatatypeConstants.YEARS, DatatypeConstants.MONTHS, DatatypeConstants.DAYS, DatatypeConstants.HOURS,\n+    private static final DatatypeConstants.Field[] FIELDS = { DatatypeConstants.YEARS, DatatypeConstants.MONTHS, DatatypeConstants.DAYS, DatatypeConstants.HOURS,\n@@ -75,1 +76,1 @@\n-        Assert.assertTrue(years == 21, \"Return value should be normalized\");\n+        Assert.assertEquals(years, 21, \"Return value should be normalized\");\n@@ -84,1 +85,1 @@\n-        Assert.assertTrue(years == 21, \"Return value should be normalized\");\n+        Assert.assertEquals(years, 21, \"Return value should be normalized\");\n@@ -94,1 +95,1 @@\n-        Assert.assertTrue(years == 21, \"Return value should be normalized\");\n+        Assert.assertEquals(years, 21, \"Return value should be normalized\");\n@@ -102,1 +103,1 @@\n-        Assert.assertTrue(years == 21, \"Return value should be normalized\");\n+        Assert.assertEquals(years, 21, \"Return value should be normalized\");\n@@ -110,1 +111,1 @@\n-        Assert.assertTrue(days == 2, \"Return value should be normalized\");\n+        Assert.assertEquals(days, 2, \"Return value should be normalized\");\n@@ -118,1 +119,1 @@\n-        Assert.assertTrue(days == 2, \"Return value should be normalized\");\n+        Assert.assertEquals(days, 2, \"Return value should be normalized\");\n@@ -131,1 +132,1 @@\n-        Assert.assertTrue(days == 2, \"Return value should be normalized\");\n+        Assert.assertEquals(days, 2, \"Return value should be normalized\");\n@@ -140,1 +141,1 @@\n-        Assert.assertTrue(days == 2, \"Return value should be normalized\");\n+        Assert.assertEquals(days, 2, \"Return value should be normalized\");\n@@ -143,2 +144,12 @@\n-    @Test\n-    public final void testNewDurationYearMonthLexicalRepresentation1() {\n+    @DataProvider(name = \"lexicalvalues\")\n+    public Object[][] actualAndExpectedLexicals() {\n+        Object actualAndExpected [][] = {\n+                {\"P13M\", \"P1Y1M\"},\n+                {\"-P13M\", \"-P1Y1M\"},\n+                {\"P1Y\", \"P1Y\"},\n+                {\"-P1Y\", \"-P1Y\"},\n+                {\"P1Y25M\", \"P3Y1M\"},\n+                {\"-P1Y25M\", \"-P3Y1M\"}\n+        };\n+        return actualAndExpected;\n+    }\n@@ -146,0 +157,2 @@\n+    @Test(dataProvider = \"lexicalvalues\")\n+    public void testNewDurationYearMonthLexicalRepresentation1(String actualLex, String expectedLex) {\n@@ -149,1 +162,0 @@\n-        final String[] TEST_VALUES_LEXICAL = { \"P13M\", \"P1Y1M\", \"-P13M\", \"-P1Y1M\", \"P1Y\", \"P1Y\", \"-P1Y\", \"-P1Y\", \"P1Y25M\", \"P3Y1M\", \"-P1Y25M\", \"-P3Y1M\" };\n@@ -161,0 +173,3 @@\n+        if (DEBUG) {\n+            System.err.println(\"testing value: \\\"\" + actualLex + \"\\\", expecting: \\\"\" + expectedLex + \"\\\"\");\n+        }\n@@ -162,2 +177,2 @@\n-        \/\/ test each value\n-        for (int onTestValue = 0; onTestValue < TEST_VALUES_LEXICAL.length; onTestValue = onTestValue + 2) {\n+        try {\n+            Duration duration = datatypeFactory.newDurationYearMonth(actualLex);\n@@ -166,1 +181,1 @@\n-                System.err.println(\"testing value: \\\"\" + TEST_VALUES_LEXICAL[onTestValue] + \"\\\", expecting: \\\"\" + TEST_VALUES_LEXICAL[onTestValue + 1] + \"\\\"\");\n+                System.err.println(\"Duration created: \\\"\" + duration.toString() + \"\\\"\");\n@@ -169,11 +184,4 @@\n-            try {\n-                Duration duration = datatypeFactory.newDurationYearMonth(TEST_VALUES_LEXICAL[onTestValue]);\n-\n-                if (DEBUG) {\n-                    System.err.println(\"Duration created: \\\"\" + duration.toString() + \"\\\"\");\n-                }\n-\n-                \/\/ was this expected to fail?\n-                if (TEST_VALUES_LEXICAL[onTestValue + 1].equals(TEST_VALUE_FAIL)) {\n-                    Assert.fail(\"the value \\\"\" + TEST_VALUES_LEXICAL[onTestValue] + \"\\\" is invalid yet it created the Duration \\\"\" + duration.toString() + \"\\\"\");\n-                }\n+            \/\/ was this expected to fail?\n+            if (expectedLex.equals(TEST_VALUE_FAIL)) {\n+                Assert.fail(\"the value \\\"\" + actualLex + \"\\\" is invalid yet it created the Duration \\\"\" + duration.toString() + \"\\\"\");\n+            }\n@@ -181,7 +189,7 @@\n-                \/\/ right XMLSchemaType?\n-                \/\/ TODO: enable test, it should pass, it fails with Exception(s)\n-                \/\/ for now due to a bug\n-                try {\n-                    QName xmlSchemaType = duration.getXMLSchemaType();\n-                    if (!xmlSchemaType.equals(DatatypeConstants.DURATION_YEARMONTH)) {\n-                        Assert.fail(\"Duration created with XMLSchemaType of\\\"\" + xmlSchemaType + \"\\\" was expected to be \\\"\"\n+            \/\/ right XMLSchemaType?\n+            \/\/ TODO: enable test, it should pass, it fails with Exception(s)\n+            \/\/ for now due to a bug\n+            try {\n+                QName xmlSchemaType = duration.getXMLSchemaType();\n+                if (!xmlSchemaType.equals(DatatypeConstants.DURATION_YEARMONTH)) {\n+                    Assert.fail(\"Duration created with XMLSchemaType of\\\"\" + xmlSchemaType + \"\\\" was expected to be \\\"\"\n@@ -189,1 +197,1 @@\n-                    }\n+                }\n@@ -196,3 +204,3 @@\n-                if (!TEST_VALUES_LEXICAL[onTestValue + 1].equals(duration.toString())) {\n-                    Assert.fail(\"Duration created with \\\"\" + TEST_VALUES_LEXICAL[onTestValue] + \"\\\" was expected to be \\\"\"\n-                            + TEST_VALUES_LEXICAL[onTestValue + 1] + \"\\\" and has the value \\\"\" + duration.toString() + \"\\\"\");\n+                if (!expectedLex.equals(duration.toString())) {\n+                    Assert.fail(\"Duration created with \\\"\" + actualLex + \"\\\" was expected to be \\\"\"\n+                            + expectedLex + \"\\\" and has the value \\\"\" + duration.toString() + \"\\\"\");\n@@ -209,2 +217,2 @@\n-                if (!TEST_VALUES_LEXICAL[onTestValue + 1].equals(TEST_VALUE_FAIL)) {\n-                    Assert.fail(\"the value \\\"\" + TEST_VALUES_LEXICAL[onTestValue] + \"\\\" is valid yet it failed with \\\"\" + exception.toString() + \"\\\"\");\n+                if (!expectedLex.equals(TEST_VALUE_FAIL)) {\n+                    Assert.fail(\"the value \\\"\" + actualLex + \"\\\" is valid yet it failed with \\\"\" + exception.toString() + \"\\\"\");\n@@ -214,1 +222,0 @@\n-        }\n@@ -217,5 +224,2 @@\n-    \/**\n-     * TCK test failure\n-     *\/\n-    @Test\n-    public void testNewDurationDayTime005() {\n+    @DataProvider(name = \"lexDayTime\")\n+    public Object[][] lexDayTimeData() {\n@@ -226,1 +230,0 @@\n-\n@@ -232,0 +235,2 @@\n+        return values;\n+    }\n@@ -233,0 +238,6 @@\n+    \/**\n+     * TCK test failure\n+     *\/\n+    @Test(dataProvider = \"lexDayTime\")\n+    public void testNewDurationDayTime005(String lex, boolean isPositive, BigInteger year, BigInteger month, BigInteger days,\n+                                          BigInteger hour, BigInteger minutes, BigDecimal seconds) {\n@@ -242,8 +253,9 @@\n-        for (int valueIndex = 0; valueIndex < values.length; ++valueIndex) {\n-            Duration duration = null;\n-            try {\n-                duration = df.newDurationDayTime(values[valueIndex][1].equals(Boolean.TRUE), ((BigInteger) values[valueIndex][4]).intValue(),\n-                        ((BigInteger) values[valueIndex][5]).intValue(), ((BigInteger) values[valueIndex][6]).intValue(),\n-                        ((BigDecimal) values[valueIndex][7]).intValue());\n-            } catch (IllegalArgumentException e) {\n-                result.append(\"; unexpected \" + e + \" trying to create duration \\'\" + values[valueIndex][0] + \"\\'\");\n+        Duration duration = null;\n+        try {\n+            duration = df.newDurationDayTime(isPositive, days, hour, minutes, seconds.toBigInteger());\n+        } catch (IllegalArgumentException e) {\n+            result.append(\"; unexpected \" + e + \" trying to create duration \\'\" + lex + \"\\'\");\n+        }\n+        if (duration != null) {\n+            if ((duration.getSign() == 1) != isPositive) {\n+                result.append(\"; \" + lex + \": wrong sign \" + duration.getSign() + \", expected \" + isPositive);\n@@ -251,12 +263,5 @@\n-            if (duration != null) {\n-                if ((duration.getSign() == 1) != values[valueIndex][1].equals(Boolean.TRUE)) {\n-                    result.append(\"; \" + values[valueIndex][0] + \": wrong sign \" + duration.getSign() + \", expected \" + values[valueIndex][1]);\n-                }\n-                for (int i = 0; i < fields.length; ++i) {\n-                    Number value = duration.getField(fields[i]);\n-                    if ((value != null && values[valueIndex][2 + i] == null) || (value == null && values[valueIndex][2 + i] != null)\n-                            || (value != null && !value.equals(values[valueIndex][2 + i]))) {\n-                        result.append(\"; \" + values[valueIndex][0] + \": wrong value of the field \" + fields[i] + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n-                                + values[valueIndex][2 + i] + \"\\'\");\n-                    }\n-                }\n+\n+            Number value = duration.getField(DatatypeConstants.YEARS);\n+            if ((value != null && year == null) || (value == null && year != null) || (value != null && !value.equals(year))) {\n+                result.append(\"; \" + lex + \": wrong value of the field \" + DatatypeConstants.YEARS + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n+                        + year + \"\\'\");\n@@ -264,1 +269,0 @@\n-        }\n@@ -266,0 +270,30 @@\n+            value = duration.getField(DatatypeConstants.MONTHS);\n+            if ((value != null && month == null) || (value == null && month != null) || (value != null && !value.equals(month))) {\n+                result.append(\"; \" + lex + \": wrong value of the field \" + DatatypeConstants.MONTHS + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n+                        + month + \"\\'\");\n+            }\n+\n+            value = duration.getField(DatatypeConstants.DAYS);\n+            if ((value != null && days == null) || (value == null && days != null) || (value != null && !value.equals(days))) {\n+                result.append(\"; \" + lex + \": wrong value of the field \" + DatatypeConstants.DAYS + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n+                        + days + \"\\'\");\n+            }\n+\n+            value = duration.getField(DatatypeConstants.HOURS);\n+            if ((value != null && hour == null) || (value == null && hour != null) || (value != null && !value.equals(hour))) {\n+                result.append(\"; \" + lex + \": wrong value of the field \" + DatatypeConstants.HOURS + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n+                        + hour + \"\\'\");\n+            }\n+\n+            value = duration.getField(DatatypeConstants.MINUTES);\n+            if ((value != null && minutes == null) || (value == null && minutes != null) || (value != null && !value.equals(minutes))) {\n+                result.append(\"; \" + lex + \": wrong value of the field \" + DatatypeConstants.MINUTES + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n+                        + minutes + \"\\'\");\n+            }\n+\n+            value = duration.getField(DatatypeConstants.SECONDS);\n+            if ((value != null && seconds == null) || (value == null && seconds != null) || (value != null && !value.equals(seconds))) {\n+                result.append(\"; \" + lex + \": wrong value of the field \" + DatatypeConstants.SECONDS + \": \\'\" + value + \"\\'\" + \", expected \\'\"\n+                        + seconds + \"\\'\");\n+            }\n+        }\n@@ -270,1 +304,0 @@\n-\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/datatype\/Bug6937964Test.java","additions":101,"deletions":68,"binary":false,"changes":169,"status":"modified"}]}