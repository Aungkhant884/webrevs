{"files":[{"patch":"@@ -1497,1 +1497,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1513,1 +1512,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1529,1 +1527,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1545,1 +1542,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1561,1 +1557,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1577,1 +1572,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1675,1 +1669,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1693,1 +1686,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1709,1 +1701,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1725,1 +1716,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1789,1 +1779,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1805,1 +1794,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -2140,1 +2128,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2142,1 +2129,1 @@\n-  predicate(UseFMA && !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -2162,1 +2149,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2164,1 +2150,1 @@\n-  predicate(UseFMA && !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -2186,1 +2172,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2188,2 +2173,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2204,1 +2188,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2206,3 +2189,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2221,1 +2202,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2223,3 +2203,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2240,1 +2218,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2242,3 +2219,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2259,1 +2234,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2261,2 +2235,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2277,1 +2250,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2279,2 +2251,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -4641,2 +4612,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) == T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) == T_BYTE);\n@@ -4654,2 +4624,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) != T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) != T_BYTE);\n@@ -4762,1 +4731,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -4805,1 +4774,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -5259,1 +5228,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5421,1 +5390,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5470,1 +5439,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5543,1 +5512,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -5581,2 +5549,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_LONG &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_LONG);\n@@ -5604,2 +5571,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_INT &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_INT);\n@@ -6056,1 +6022,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -6104,1 +6069,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -6166,1 +6130,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -6213,1 +6176,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_vector.ad","additions":17,"deletions":55,"binary":false,"changes":72,"status":"modified"},{"patch":"@@ -809,1 +809,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -891,1 +890,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1172,1 +1170,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1174,1 +1171,1 @@\n-  predicate(UseFMA && !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -1194,1 +1191,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1196,1 +1192,1 @@\n-  predicate(UseFMA && !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -1218,1 +1214,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1220,2 +1215,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1236,1 +1230,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1238,3 +1231,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1253,1 +1244,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1255,3 +1245,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1272,1 +1260,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1274,3 +1261,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1291,1 +1276,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1293,2 +1277,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1309,1 +1292,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1311,2 +1293,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -3065,2 +3046,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) == T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) == T_BYTE);\n@@ -3078,2 +3058,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) != T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) != T_BYTE);\n@@ -3186,1 +3165,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -3229,1 +3208,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -3665,1 +3644,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -3833,1 +3812,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -3916,1 +3895,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -3954,2 +3932,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_LONG &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_LONG);\n@@ -3977,2 +3954,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_INT &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_INT);\n@@ -4418,1 +4394,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4455,1 +4430,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4517,1 +4491,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4553,1 +4526,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_vector_ad.m4","additions":16,"deletions":44,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -6336,1 +6336,0 @@\n-  ins_cost(400);\n@@ -6349,1 +6348,0 @@\n-  ins_cost(400);\n@@ -6362,1 +6360,0 @@\n-  ins_cost(400);\n@@ -6375,1 +6372,0 @@\n-  ins_cost(400);\n@@ -7918,1 +7914,0 @@\n-  ins_cost(450);\n@@ -7934,1 +7929,0 @@\n-  ins_cost(450);\n@@ -7951,1 +7945,0 @@\n-  ins_cost(250);\n@@ -7966,1 +7959,0 @@\n-  ins_cost(450);\n@@ -8894,1 +8886,0 @@\n-  ins_cost(400);\n@@ -9719,1 +9710,0 @@\n-  ins_cost(100);\n@@ -10045,1 +10035,0 @@\n-  ins_cost(100);\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":0,"deletions":11,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -131,1 +131,2 @@\n-  void gen_match(FILE *fp, MatchList &mlist, ProductionState &status, Dict &operands_chained_from);\n+  void gen_match(FILE *fp, MatchList &mlist, ProductionState &status,\n+                 Dict &operands_chained_from, bool is_vector_unary_op);\n","filename":"src\/hotspot\/share\/adlc\/archDesc.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -185,1 +185,1 @@\n-static void child_test(FILE *fp, MatchList &mList) {\n+static void child_test(FILE *fp, MatchList &mList, bool is_vector_unary_op) {\n@@ -190,3 +190,8 @@\n-  }\n-  if (mList._lchild && mList._rchild) { \/\/ If both, add the \"&&\"\n-    fprintf(fp, \" && \");\n+\n+    if (mList._rchild) { \/\/ If both, add the \"&&\"\n+      fprintf(fp, \" && \");\n+    } else if (is_vector_unary_op) {\n+      \/\/ If unpredicated vector unary operation, add one extra check, i.e. right\n+      \/\/ child should be NULL, to distinguish from the predicated version.\n+      fprintf(fp, \" && _kids[1] == NULL\");\n+    }\n@@ -231,1 +236,2 @@\n-void ArchDesc::gen_match(FILE *fp, MatchList &mList, ProductionState &status, Dict &operands_chained_from) {\n+void ArchDesc::gen_match(FILE *fp, MatchList &mList, ProductionState &status,\n+                         Dict &operands_chained_from, bool is_vector_unary_op) {\n@@ -243,1 +249,1 @@\n-    child_test(fp, mList);\n+    child_test(fp, mList, is_vector_unary_op);\n@@ -574,0 +580,20 @@\n+\/\/ Helper method to check whether a node is vector unary operation.\n+static bool is_vector_unary_op_name(const char* op_name) {\n+  static const char* vector_unary_op_list[] = {\n+    \"AbsVB\", \"AbsVS\", \"AbsVI\", \"AbsVL\", \"AbsVF\", \"AbsVD\",\n+    \"NegVI\", \"NegVL\", \"NegVF\", \"NegVD\",\n+    \"SqrtVF\", \"SqrtVD\",\n+    \"PopCountVI\", \"PopCountVL\",\n+    \"CountLeadingZerosV\", \"CountTrailingZerosV\",\n+    \"ReverseV\", \"ReverseBytesV\",\n+    \"MaskAll\", \"VectorLoadMask\", \"VectorMaskFirstTrue\"\n+  };\n+  int cnt = sizeof(vector_unary_op_list) \/ sizeof(char*);\n+  for (int i = 0; i < cnt; i++) {\n+    if (strcmp(op_name, vector_unary_op_list[i]) == 0) {\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n+\n@@ -595,0 +621,1 @@\n+  bool is_vector_unary_op = is_vector_unary_op_name(NodeClassNames[i]);\n@@ -600,1 +627,1 @@\n-    gen_match(fp, *mList, status, operands_chained_from);\n+    gen_match(fp, *mList, status, operands_chained_from, is_vector_unary_op);\n","filename":"src\/hotspot\/share\/adlc\/dfa.cpp","additions":34,"deletions":7,"binary":false,"changes":41,"status":"modified"}]}