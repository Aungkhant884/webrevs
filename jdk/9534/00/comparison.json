{"files":[{"patch":"@@ -520,2 +520,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -533,2 +532,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -546,2 +544,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -559,2 +556,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -572,2 +568,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -585,2 +580,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -1459,1 +1453,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1461,2 +1454,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1474,1 +1466,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1476,2 +1467,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1489,1 +1479,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1491,2 +1480,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1504,1 +1492,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1506,2 +1493,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1521,1 +1507,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1523,2 +1508,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1536,1 +1520,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1538,2 +1521,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1553,1 +1535,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1555,3 +1536,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1569,1 +1548,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1571,3 +1549,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1585,1 +1561,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1587,3 +1562,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1601,1 +1574,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1603,3 +1575,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1619,1 +1589,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1621,3 +1590,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1635,1 +1602,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1637,3 +1603,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1653,1 +1617,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1655,2 +1618,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1668,1 +1630,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1670,2 +1631,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1685,1 +1645,0 @@\n-\/\/ The NegVF must not be predicated.\n@@ -1687,2 +1646,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1700,1 +1658,0 @@\n-\/\/ The NegVD must not be predicated.\n@@ -1702,2 +1659,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2105,2 +2061,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -2119,2 +2074,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -2132,2 +2086,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -2145,2 +2098,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -2215,2 +2167,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -2230,1 +2181,0 @@\n-            !n->as_Vector()->is_predicated_vector() &&\n@@ -2248,1 +2198,0 @@\n-            !n->as_Vector()->is_predicated_vector() &&\n@@ -2341,1 +2290,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -2386,1 +2335,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -4044,2 +3993,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -4057,2 +4005,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5358,1 +5305,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5458,1 +5405,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5494,1 +5441,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5580,2 +5527,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n+  predicate(UseSVE > 0 && n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n@@ -5594,2 +5540,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            n->bottom_type()->is_vect()->element_basic_type() != T_BYTE);\n+  predicate(UseSVE > 0 && n->bottom_type()->is_vect()->element_basic_type() != T_BYTE);\n@@ -5610,2 +5555,1 @@\n-  predicate(UseSVE > 0 &&\n-            n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n+  predicate(UseSVE > 0 && n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n@@ -5783,2 +5727,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5815,2 +5758,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5852,2 +5794,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5884,2 +5825,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve.ad","additions":41,"deletions":101,"binary":false,"changes":142,"status":"modified"},{"patch":"@@ -435,2 +435,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -869,1 +868,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -871,2 +869,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -887,1 +884,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -889,2 +885,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -912,1 +907,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -914,2 +908,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -935,1 +928,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -937,3 +929,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -954,1 +944,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -956,3 +945,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -980,1 +967,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -982,3 +968,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1004,1 +988,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -1006,2 +989,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1027,1 +1009,0 @@\n-\/\/ The NegV$1 must not be predicated.\n@@ -1029,2 +1010,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1190,2 +1170,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector()`'ifelse($1, `L', ` &&\n+  predicate(UseSVE > 0`'ifelse($1, `L', ` &&\n@@ -1215,1 +1194,0 @@\n-            !n->as_Vector()->is_predicated_vector() &&\n@@ -1302,1 +1280,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -1347,1 +1325,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -3025,1 +3003,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -3124,1 +3102,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -3204,2 +3182,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n+  predicate(UseSVE > 0 && n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n@@ -3218,2 +3195,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            n->bottom_type()->is_vect()->element_basic_type() != T_BYTE);\n+  predicate(UseSVE > 0 && n->bottom_type()->is_vect()->element_basic_type() != T_BYTE);\n@@ -3234,2 +3210,1 @@\n-  predicate(UseSVE > 0 &&\n-            n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n+  predicate(UseSVE > 0 && n->bottom_type()->is_vect()->element_basic_type() == T_BYTE);\n@@ -3401,2 +3376,1 @@\n-  predicate(UseSVE > 0 &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(UseSVE > 0);\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve_ad.m4","additions":18,"deletions":44,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -6334,1 +6334,0 @@\n-  ins_cost(400);\n@@ -6347,1 +6346,0 @@\n-  ins_cost(400);\n@@ -6360,1 +6358,0 @@\n-  ins_cost(400);\n@@ -6373,1 +6370,0 @@\n-  ins_cost(400);\n@@ -7916,1 +7912,0 @@\n-  ins_cost(450);\n@@ -7932,1 +7927,0 @@\n-  ins_cost(450);\n@@ -7949,1 +7943,0 @@\n-  ins_cost(250);\n@@ -7964,1 +7957,0 @@\n-  ins_cost(450);\n@@ -8892,1 +8884,0 @@\n-  ins_cost(400);\n@@ -9690,1 +9681,0 @@\n-  ins_cost(100);\n@@ -10016,1 +10006,0 @@\n-  ins_cost(100);\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":0,"deletions":11,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -131,1 +131,2 @@\n-  void gen_match(FILE *fp, MatchList &mlist, ProductionState &status, Dict &operands_chained_from);\n+  void gen_match(FILE *fp, MatchList &mlist, ProductionState &status,\n+                 Dict &operands_chained_from, bool is_vector_unary_op);\n","filename":"src\/hotspot\/share\/adlc\/archDesc.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -185,1 +185,1 @@\n-static void child_test(FILE *fp, MatchList &mList) {\n+static void child_test(FILE *fp, MatchList &mList, bool is_vector_unary_op) {\n@@ -190,3 +190,8 @@\n-  }\n-  if (mList._lchild && mList._rchild) { \/\/ If both, add the \"&&\"\n-    fprintf(fp, \" && \");\n+\n+    if (mList._rchild) { \/\/ If both, add the \"&&\"\n+      fprintf(fp, \" && \");\n+    } else if (is_vector_unary_op) {\n+      \/\/ If unpredicated vector unary operation, add one extra check, i.e. right\n+      \/\/ child should be NULL, to distinguish from the predicated version.\n+      fprintf(fp, \" && _kids[1] == NULL\");\n+    }\n@@ -231,1 +236,2 @@\n-void ArchDesc::gen_match(FILE *fp, MatchList &mList, ProductionState &status, Dict &operands_chained_from) {\n+void ArchDesc::gen_match(FILE *fp, MatchList &mList, ProductionState &status,\n+                         Dict &operands_chained_from, bool is_vector_unary_op) {\n@@ -243,1 +249,1 @@\n-    child_test(fp, mList);\n+    child_test(fp, mList, is_vector_unary_op);\n@@ -574,0 +580,20 @@\n+\/\/ Helper method to check whether a node is vector unary operation.\n+static bool is_vector_unary_op_name(const char* op_name) {\n+  static const char* vector_unary_op_list[] = {\n+    \"AbsVB\", \"AbsVS\", \"AbsVI\", \"AbsVL\", \"AbsVF\", \"AbsVD\",\n+    \"NegVI\", \"NegVL\", \"NegVF\", \"NegVD\",\n+    \"SqrtVF\", \"SqrtVD\",\n+    \"PopCountVI\", \"PopCountVL\",\n+    \"CountLeadingZerosV\", \"CountTrailingZerosV\",\n+    \"ReverseV\", \"ReverseBytesV\",\n+    \"MaskAll\", \"VectorLoadMask\", \"VectorMaskFirstTrue\"\n+  };\n+  int cnt = sizeof(vector_unary_op_list) \/ sizeof(char*);\n+  for (int i = 0; i < cnt; i++) {\n+    if (strcmp(op_name, vector_unary_op_list[i]) == 0) {\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n+\n@@ -595,0 +621,1 @@\n+  bool is_vector_unary_op = is_vector_unary_op_name(NodeClassNames[i]);\n@@ -600,1 +627,1 @@\n-    gen_match(fp, *mList, status, operands_chained_from);\n+    gen_match(fp, *mList, status, operands_chained_from, is_vector_unary_op);\n","filename":"src\/hotspot\/share\/adlc\/dfa.cpp","additions":34,"deletions":7,"binary":false,"changes":41,"status":"modified"}]}