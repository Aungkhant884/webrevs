{"files":[{"patch":"@@ -1499,1 +1499,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1515,1 +1514,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1531,1 +1529,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1547,1 +1544,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1563,1 +1559,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1579,1 +1574,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1661,2 +1655,1 @@\n-  predicate(VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)) &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)));\n@@ -1674,2 +1667,1 @@\n-  predicate(!VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)) &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(!VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)));\n@@ -1708,1 +1700,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1726,1 +1717,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1742,1 +1732,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1758,1 +1747,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1822,1 +1810,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1838,1 +1825,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -2193,1 +2179,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2195,1 +2180,1 @@\n-  predicate(UseFMA && !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -2215,1 +2200,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2217,1 +2201,1 @@\n-  predicate(UseFMA && !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -2239,1 +2223,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2241,2 +2224,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2257,1 +2239,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2259,3 +2240,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2274,1 +2253,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2276,3 +2254,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2293,1 +2269,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2295,3 +2270,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2312,1 +2285,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2314,2 +2286,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -2330,1 +2301,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -2332,2 +2302,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -4694,2 +4663,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) == T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) == T_BYTE);\n@@ -4707,2 +4675,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) != T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) != T_BYTE);\n@@ -4815,1 +4782,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -4858,1 +4825,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -5312,1 +5279,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5474,1 +5441,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5523,1 +5490,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -5596,1 +5563,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -5634,2 +5600,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_LONG &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_LONG);\n@@ -5657,2 +5622,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_INT &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_INT);\n@@ -6109,1 +6073,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -6157,1 +6120,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -6219,1 +6181,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -6266,1 +6227,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_vector.ad","additions":19,"deletions":59,"binary":false,"changes":78,"status":"modified"},{"patch":"@@ -811,1 +811,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -877,2 +876,1 @@\n-  predicate(VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)) &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)));\n@@ -890,2 +888,1 @@\n-  predicate(!VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)) &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(!VM_Version::use_neon_for_vector(Matcher::vector_length_in_bytes(n)));\n@@ -924,1 +921,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -1225,1 +1221,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1227,1 +1222,1 @@\n-  predicate(UseFMA && !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -1247,1 +1242,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1249,1 +1243,1 @@\n-  predicate(UseFMA && !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA);\n@@ -1271,1 +1265,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1273,2 +1266,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1289,1 +1281,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1291,3 +1282,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1306,1 +1295,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1308,3 +1296,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(2)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1325,1 +1311,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1327,3 +1312,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->in(2)->as_Vector()->is_predicated_vector() &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1344,1 +1327,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1346,2 +1328,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -1362,1 +1343,0 @@\n-\/\/ The NegVF\/NegVD must not be predicated.\n@@ -1364,2 +1344,1 @@\n-  predicate(UseFMA && UseSVE > 0 &&\n-            !n->in(2)->in(1)->as_Vector()->is_predicated_vector());\n+  predicate(UseFMA && UseSVE > 0);\n@@ -3118,2 +3097,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) == T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) == T_BYTE);\n@@ -3131,2 +3109,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n-            Matcher::vector_element_basic_type(n) != T_BYTE);\n+  predicate(UseSVE > 0 && Matcher::vector_element_basic_type(n) != T_BYTE);\n@@ -3239,1 +3216,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -3282,1 +3259,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector() &&\n+  predicate(UseSVE > 0 &&\n@@ -3718,1 +3695,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -3886,1 +3863,1 @@\n-  predicate(UseSVE > 0 && !n->is_predicated_vector());\n+  predicate(UseSVE > 0);\n@@ -3969,1 +3946,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4007,2 +3983,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_LONG &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_LONG);\n@@ -4030,2 +4005,1 @@\n-  predicate(Matcher::vector_element_basic_type(n) == T_INT &&\n-            !n->as_Vector()->is_predicated_vector());\n+  predicate(Matcher::vector_element_basic_type(n) == T_INT);\n@@ -4471,1 +4445,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4508,1 +4481,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4570,1 +4542,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n@@ -4606,1 +4577,0 @@\n-  predicate(!n->as_Vector()->is_predicated_vector());\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_vector_ad.m4","additions":18,"deletions":48,"binary":false,"changes":66,"status":"modified"},{"patch":"@@ -6328,1 +6328,0 @@\n-  ins_cost(400);\n@@ -6341,1 +6340,0 @@\n-  ins_cost(400);\n@@ -6354,1 +6352,0 @@\n-  ins_cost(400);\n@@ -6367,1 +6364,0 @@\n-  ins_cost(400);\n@@ -7908,1 +7904,0 @@\n-  ins_cost(450);\n@@ -7924,1 +7919,0 @@\n-  ins_cost(450);\n@@ -7941,1 +7935,0 @@\n-  ins_cost(250);\n@@ -7956,1 +7949,0 @@\n-  ins_cost(450);\n@@ -8896,1 +8888,0 @@\n-  ins_cost(400);\n@@ -9721,1 +9712,0 @@\n-  ins_cost(100);\n@@ -10047,1 +10037,0 @@\n-  ins_cost(100);\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":0,"deletions":11,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -131,1 +131,2 @@\n-  void gen_match(FILE *fp, MatchList &mlist, ProductionState &status, Dict &operands_chained_from);\n+  void gen_match(FILE *fp, MatchList &mlist, ProductionState &status,\n+                 Dict &operands_chained_from, bool is_vector_unary_op);\n","filename":"src\/hotspot\/share\/adlc\/archDesc.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -185,1 +185,1 @@\n-static void child_test(FILE *fp, MatchList &mList) {\n+static void child_test(FILE *fp, MatchList &mList, bool is_vector_unary_op) {\n@@ -190,3 +190,8 @@\n-  }\n-  if (mList._lchild && mList._rchild) { \/\/ If both, add the \"&&\"\n-    fprintf(fp, \" && \");\n+\n+    if (mList._rchild) { \/\/ If both, add the \"&&\"\n+      fprintf(fp, \" && \");\n+    } else if (is_vector_unary_op) {\n+      \/\/ If unpredicated vector unary operation, add one extra check, i.e. right\n+      \/\/ child should be NULL, to distinguish from the predicated version.\n+      fprintf(fp, \" && _kids[1] == NULL\");\n+    }\n@@ -231,1 +236,2 @@\n-void ArchDesc::gen_match(FILE *fp, MatchList &mList, ProductionState &status, Dict &operands_chained_from) {\n+void ArchDesc::gen_match(FILE *fp, MatchList &mList, ProductionState &status,\n+                         Dict &operands_chained_from, bool is_vector_unary_op) {\n@@ -243,1 +249,1 @@\n-    child_test(fp, mList);\n+    child_test(fp, mList, is_vector_unary_op);\n@@ -574,0 +580,20 @@\n+\/\/ Helper method to check whether a node is vector unary operation.\n+static bool is_vector_unary_op_name(const char* op_name) {\n+  static const char* vector_unary_op_list[] = {\n+    \"AbsVB\", \"AbsVS\", \"AbsVI\", \"AbsVL\", \"AbsVF\", \"AbsVD\",\n+    \"NegVI\", \"NegVL\", \"NegVF\", \"NegVD\",\n+    \"SqrtVF\", \"SqrtVD\",\n+    \"PopCountVI\", \"PopCountVL\",\n+    \"CountLeadingZerosV\", \"CountTrailingZerosV\",\n+    \"ReverseV\", \"ReverseBytesV\",\n+    \"MaskAll\", \"VectorLoadMask\", \"VectorMaskFirstTrue\"\n+  };\n+  int cnt = sizeof(vector_unary_op_list) \/ sizeof(char*);\n+  for (int i = 0; i < cnt; i++) {\n+    if (strcmp(op_name, vector_unary_op_list[i]) == 0) {\n+      return true;\n+    }\n+  }\n+  return false;\n+}\n+\n@@ -595,0 +621,1 @@\n+  bool is_vector_unary_op = is_vector_unary_op_name(NodeClassNames[i]);\n@@ -600,1 +627,1 @@\n-    gen_match(fp, *mList, status, operands_chained_from);\n+    gen_match(fp, *mList, status, operands_chained_from, is_vector_unary_op);\n","filename":"src\/hotspot\/share\/adlc\/dfa.cpp","additions":34,"deletions":7,"binary":false,"changes":41,"status":"modified"}]}