{"files":[{"patch":"@@ -1615,0 +1615,4 @@\n+int java_lang_Thread::is_in_VTMS_transition_offset() {\n+  return _jvmti_is_in_VTMS_transition_offset;\n+}\n+\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -409,0 +409,1 @@\n+  static int  is_in_VTMS_transition_offset();\n","filename":"src\/hotspot\/share\/classfile\/javaClasses.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2879,1 +2879,2 @@\n-    \/\/ set hide value to the VTMS transition bit in current JavaThread\n+    \/\/ set hide value to the VTMS transition bit in current JavaThread and VirtualThread object\n+    Node* vt_oop = _gvn.transform(argument(0)); \/\/ this argument - VirtualThread oop\n@@ -2881,1 +2882,2 @@\n-    Node* addr = basic_plus_adr(thread, in_bytes(JavaThread::is_in_VTMS_transition_offset()));\n+    Node* jt_addr = basic_plus_adr(thread, in_bytes(JavaThread::is_in_VTMS_transition_offset()));\n+    Node* vt_addr = basic_plus_adr(vt_oop, java_lang_Thread::is_in_VTMS_transition_offset());\n@@ -2885,1 +2887,3 @@\n-    access_store_at(nullptr, addr, addr_type, hide, _gvn.type(hide), T_BOOLEAN, IN_NATIVE | MO_UNORDERED);\n+    access_store_at(nullptr, jt_addr, addr_type, hide, _gvn.type(hide), T_BOOLEAN, IN_NATIVE | MO_UNORDERED);\n+    access_store_at(nullptr, vt_addr, addr_type, hide, _gvn.type(hide), T_BOOLEAN, IN_NATIVE | MO_UNORDERED);\n+\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -3930,0 +3930,2 @@\n+    oop vt = JNIHandles::resolve_external_guard(vthread);\n+    java_lang_Thread::set_is_in_VTMS_transition(vt, hide);\n@@ -3952,0 +3954,2 @@\n+    oop vt = JNIHandles::resolve_external_guard(vthread);\n+    java_lang_Thread::set_is_in_VTMS_transition(vt, hide);\n","filename":"src\/hotspot\/share\/prims\/jvm.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1570,5 +1570,0 @@\n-        oop  vt_oop = jt->vthread();\n-        if (vt_oop != nullptr && java_lang_VirtualThread::is_instance(vt_oop)) {\n-          \/\/ restore VTMS transition bit in j.l.Thread object\n-          java_lang_Thread::set_is_in_VTMS_transition(vt_oop, true);\n-        }\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"}]}