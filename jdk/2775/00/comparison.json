{"files":[{"patch":"@@ -111,1 +111,3 @@\n-\n+#ifdef ASSERT\n+  Node* ctrl = kit.control();\n+#endif\n@@ -135,0 +137,1 @@\n+  assert(ctrl == kit.control(), \"Control flow was added although the intrinsic bailed out\");\n@@ -2201,1 +2204,0 @@\n-  Node* adr;\n@@ -2203,2 +2205,0 @@\n-  Node* offset = top();\n-  Node* val;\n@@ -2209,1 +2209,1 @@\n-  offset = argument(2);  \/\/ type: long\n+  Node* offset = argument(2);  \/\/ type: long\n@@ -2217,1 +2217,6 @@\n-  adr = make_unsafe_address(base, offset, is_store ? ACCESS_WRITE : ACCESS_READ, type, kind == Relaxed);\n+\n+  \/\/ Save state and restore on bailout\n+  uint old_sp = sp();\n+  SafePointNode* old_map = clone_map();\n+\n+  Node* adr = make_unsafe_address(base, offset, is_store ? ACCESS_WRITE : ACCESS_READ, type, kind == Relaxed);\n@@ -2223,0 +2228,2 @@\n+      set_map(old_map);\n+      set_sp(old_sp);\n@@ -2236,1 +2243,1 @@\n-  val = is_store ? argument(4) : NULL;\n+  Node* val = is_store ? argument(4) : NULL;\n@@ -2240,0 +2247,2 @@\n+    set_map(old_map);\n+    set_sp(old_sp);\n@@ -2249,0 +2258,2 @@\n+    set_map(old_map);\n+    set_sp(old_sp);\n@@ -2267,0 +2278,2 @@\n+      set_map(old_map);\n+      set_sp(old_sp);\n@@ -2274,0 +2287,1 @@\n+  old_map->destruct(&_gvn);\n@@ -2508,0 +2522,3 @@\n+  \/\/ Save state and restore on bailout\n+  uint old_sp = sp();\n+  SafePointNode* old_map = clone_map();\n@@ -2516,0 +2533,2 @@\n+    set_map(old_map);\n+    set_sp(old_sp);\n@@ -2519,0 +2538,2 @@\n+  old_map->destruct(&_gvn);\n+\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":28,"deletions":7,"binary":false,"changes":35,"status":"modified"}]}