{"files":[{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -48,1 +48,1 @@\n-    jvmci jvmti link-time-opt management minimal nmt opt-size parallelgc \\\n+    jvmci jvmti link-time-opt management minimal opt-size parallelgc \\\n@@ -71,1 +71,0 @@\n-m4_define(jvm_feature_desc_nmt, [include native memory tracking (NMT)])\n@@ -446,1 +445,1 @@\n-        jfr jni-check jvmci jvmti management nmt parallelgc services \\\n+        jfr jni-check jvmci jvmti management parallelgc services \\\n@@ -541,4 +540,0 @@\n-  if JVM_FEATURES_IS_ACTIVE(management) && ! JVM_FEATURES_IS_ACTIVE(nmt); then\n-    AC_MSG_ERROR([Specified JVM feature 'management' requires feature 'nmt' for variant '$variant'])\n-  fi\n-\n","filename":"make\/autoconf\/jvm-features.m4","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -133,7 +133,0 @@\n-ifneq ($(call check-jvm-feature, nmt), true)\n-  JVM_CFLAGS_FEATURES += -DINCLUDE_NMT=0\n-  JVM_EXCLUDE_FILES += \\\n-      memBaseline.cpp memReporter.cpp mallocTracker.cpp virtualMemoryTracker.cpp nmtCommon.cpp \\\n-      memTracker.cpp nmtDCmd.cpp mallocSiteTable.cpp threadStackTracker.cpp\n-endif\n-\n","filename":"make\/hotspot\/lib\/JvmFeatures.gmk","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -173,2 +173,0 @@\n-#if INCLUDE_NMT\n-\n@@ -177,6 +175,0 @@\n-#else\n-\n-const bool NMT_track_callsite = false;\n-\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/memory\/allocation.hpp","additions":1,"deletions":9,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n- * Copyright (c) 2018, 2020 SAP SE. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022 SAP SE. All rights reserved.\n@@ -80,1 +80,1 @@\n-      scale = NMT_ONLY(NMTUtil::scale_from_name(scale_value)) NOT_NMT(0);\n+      scale = NMTUtil::scale_from_name(scale_value);\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceDCmd.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -90,0 +90,1 @@\n+#include \"services\/mallocSiteTable.hpp\"\n@@ -91,0 +92,1 @@\n+#include \"services\/memTracker.hpp\"\n@@ -96,0 +98,1 @@\n+#include \"utilities\/nativeCallStack.hpp\"\n@@ -108,5 +111,0 @@\n-#if INCLUDE_NMT\n-#include \"services\/mallocSiteTable.hpp\"\n-#include \"services\/memTracker.hpp\"\n-#include \"utilities\/nativeCallStack.hpp\"\n-#endif \/\/ INCLUDE_NMT\n@@ -649,1 +647,0 @@\n-#if INCLUDE_NMT\n@@ -727,1 +724,0 @@\n-#endif \/\/ INCLUDE_NMT\n@@ -2548,1 +2544,0 @@\n-#if INCLUDE_NMT\n@@ -2562,1 +2557,0 @@\n-#endif \/\/ INCLUDE_NMT\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":4,"deletions":10,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -4015,1 +4015,0 @@\n-#if INCLUDE_NMT\n@@ -4027,7 +4026,0 @@\n-#else\n-  if (!FLAG_IS_DEFAULT(NativeMemoryTracking) || PrintNMTStatistics) {\n-    warning(\"Native Memory Tracking is not supported in this VM\");\n-    FLAG_SET_DEFAULT(NativeMemoryTracking, \"off\");\n-    FLAG_SET_DEFAULT(PrintNMTStatistics, false);\n-  }\n-#endif \/\/ INCLUDE_NMT\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -140,1 +140,0 @@\n-#if INCLUDE_NMT\n@@ -142,1 +141,1 @@\n-#endif\n+\n@@ -323,1 +322,0 @@\n-#if INCLUDE_NMT\n@@ -325,1 +323,0 @@\n-#endif\n","filename":"src\/hotspot\/share\/runtime\/mutexLocker.cpp","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -117,1 +117,0 @@\n-#if INCLUDE_NMT\n@@ -119,1 +118,0 @@\n-#endif\n","filename":"src\/hotspot\/share\/runtime\/mutexLocker.hpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -634,6 +634,4 @@\n-#if INCLUDE_NMT\n-  {\n-    void* rc = NULL;\n-    if (NMTPreInit::handle_malloc(&rc, size)) {\n-      return rc;\n-    }\n+  \/\/ Special handling for NMT preinit phase before arguments are parsed\n+  void* rc = NULL;\n+  if (NMTPreInit::handle_malloc(&rc, size)) {\n+    return rc;\n@@ -641,1 +639,0 @@\n-#endif\n@@ -680,6 +677,4 @@\n-#if INCLUDE_NMT\n-  {\n-    void* rc = NULL;\n-    if (NMTPreInit::handle_realloc(&rc, memblock, size)) {\n-      return rc;\n-    }\n+  \/\/ Special handling for NMT preinit phase before arguments are parsed\n+  void* rc = NULL;\n+  if (NMTPreInit::handle_realloc(&rc, memblock, size)) {\n+    return rc;\n@@ -687,1 +682,0 @@\n-#endif\n@@ -726,1 +720,1 @@\n-#if INCLUDE_NMT\n+  \/\/ Special handling for NMT preinit phase before arguments are parsed\n@@ -730,1 +724,0 @@\n-#endif\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":9,"deletions":16,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -320,1 +320,0 @@\n-#if INCLUDE_NMT\n@@ -328,1 +327,0 @@\n-#endif \/\/ INCLUDE_NMT\n@@ -2707,1 +2705,0 @@\n-#if INCLUDE_NMT\n@@ -2710,1 +2707,0 @@\n-#endif \/\/ INCLUDE_NMT\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -553,2 +553,2 @@\n-  void    register_thread_stack_with_NMT() NOT_NMT_RETURN;\n-  void    unregister_thread_stack_with_NMT() NOT_NMT_RETURN;\n+  void    register_thread_stack_with_NMT();\n+  void    unregister_thread_stack_with_NMT();\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,4 +28,0 @@\n-#include \"utilities\/macros.hpp\"\n-\n-#if INCLUDE_NMT\n-\n@@ -37,0 +33,1 @@\n+#include \"utilities\/macros.hpp\"\n@@ -202,1 +199,0 @@\n-#endif \/\/ INCLUDE_NMT\n","filename":"src\/hotspot\/share\/services\/mallocSiteTable.hpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -28,2 +28,0 @@\n-#if INCLUDE_NMT\n-\n@@ -451,3 +449,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n-\n","filename":"src\/hotspot\/share\/services\/mallocTracker.hpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-#if INCLUDE_NMT\n-\n@@ -215,2 +213,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/services\/memBaseline.hpp","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-#if INCLUDE_NMT\n-\n@@ -242,2 +240,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/services\/memReporter.hpp","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,56 +28,0 @@\n-#include \"services\/nmtCommon.hpp\"\n-#include \"utilities\/nativeCallStack.hpp\"\n-\n-\n-#if !INCLUDE_NMT\n-\n-#define CURRENT_PC   NativeCallStack::empty_stack()\n-#define CALLER_PC    NativeCallStack::empty_stack()\n-\n-class Tracker : public StackObj {\n- public:\n-  enum TrackerType {\n-     uncommit,\n-     release\n-  };\n-  Tracker(enum TrackerType type) : _type(type) { }\n-  void record(address addr, size_t size) { }\n- private:\n-  enum TrackerType  _type;\n-};\n-\n-class MemTracker : AllStatic {\n- public:\n-  static inline NMT_TrackingLevel tracking_level() { return NMT_off; }\n-  static inline bool enabled() { return false; }\n-  static inline void init() { }\n-  static bool check_launcher_nmt_support(const char* value) { return true; }\n-  static bool verify_nmt_option() { return true; }\n-\n-  static inline void* record_malloc(void* mem_base, size_t size, MEMFLAGS flag,\n-    const NativeCallStack& stack, NMT_TrackingLevel level) { return mem_base; }\n-  static inline size_t malloc_header_size(NMT_TrackingLevel level) { return 0; }\n-  static inline size_t malloc_header_size(void* memblock) { return 0; }\n-  static inline size_t malloc_footer_size(NMT_TrackingLevel level) { return 0; }\n-  static inline void* malloc_base(void* memblock) { return memblock; }\n-  static inline void* record_free(void* memblock, NMT_TrackingLevel level) { return memblock; }\n-\n-  static inline void record_new_arena(MEMFLAGS flag) { }\n-  static inline void record_arena_free(MEMFLAGS flag) { }\n-  static inline void record_arena_size_change(ssize_t diff, MEMFLAGS flag) { }\n-  static inline void record_virtual_memory_reserve(void* addr, size_t size, const NativeCallStack& stack,\n-                       MEMFLAGS flag = mtNone) { }\n-  static inline void record_virtual_memory_reserve_and_commit(void* addr, size_t size,\n-    const NativeCallStack& stack, MEMFLAGS flag = mtNone) { }\n-  static inline void record_virtual_memory_split_reserved(void* addr, size_t size, size_t split) { }\n-  static inline void record_virtual_memory_commit(void* addr, size_t size, const NativeCallStack& stack) { }\n-  static inline void record_virtual_memory_type(void* addr, MEMFLAGS flag) { }\n-  static inline void record_thread_stack(void* addr, size_t size) { }\n-  static inline void release_thread_stack(void* addr, size_t size) { }\n-\n-  static void final_report(outputStream*) { }\n-  static void error_report(outputStream*) { }\n-};\n-\n-#else\n-\n@@ -87,0 +31,1 @@\n+#include \"services\/nmtCommon.hpp\"\n@@ -89,0 +34,1 @@\n+#include \"utilities\/nativeCallStack.hpp\"\n@@ -312,2 +258,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/services\/memTracker.hpp","additions":3,"deletions":59,"binary":false,"changes":62,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,2 +28,0 @@\n-#if INCLUDE_NMT\n-\n@@ -74,2 +72,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/services\/nmtDCmd.hpp","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2021 SAP SE. All rights reserved.\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022 SAP SE. All rights reserved.\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,0 @@\n-#if INCLUDE_NMT\n-\n@@ -193,2 +191,0 @@\n-\n-#endif \/\/ INCLUDE_NMT\n","filename":"src\/hotspot\/share\/services\/nmtPreInit.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2021 SAP SE. All rights reserved.\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022 SAP SE. All rights reserved.\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -37,2 +37,0 @@\n-#if INCLUDE_NMT\n-\n@@ -356,2 +354,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/services\/nmtPreInit.hpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -28,2 +28,0 @@\n-#if INCLUDE_NMT\n-\n@@ -87,1 +85,0 @@\n-#endif \/\/ INCLUDE_NMT\n@@ -89,0 +86,1 @@\n+\n","filename":"src\/hotspot\/share\/services\/threadStackTracker.hpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,2 +28,0 @@\n-#if INCLUDE_NMT\n-\n@@ -399,2 +397,0 @@\n-#endif \/\/ INCLUDE_NMT\n-\n@@ -402,0 +398,1 @@\n+\n","filename":"src\/hotspot\/share\/services\/virtualMemoryTracker.hpp","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -486,2 +486,0 @@\n-#if INCLUDE_NMT\n-    \/\/ With NMT\n@@ -520,1 +518,0 @@\n-#endif \/\/ INCLUDE_NMT\n","filename":"src\/hotspot\/share\/utilities\/debug.cpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -244,16 +244,0 @@\n-#ifndef INCLUDE_NMT\n-#define INCLUDE_NMT 1\n-#endif \/\/ INCLUDE_NMT\n-\n-#if INCLUDE_NMT\n-#define NOT_NMT_RETURN        \/* next token must be ; *\/\n-#define NOT_NMT_RETURN_(code) \/* next token must be ; *\/\n-#define NMT_ONLY(x) x\n-#define NOT_NMT(x)\n-#else\n-#define NOT_NMT_RETURN        {}\n-#define NOT_NMT_RETURN_(code) { return code; }\n-#define NMT_ONLY(x)\n-#define NOT_NMT(x) x\n-#endif \/\/ INCLUDE_NMT\n-\n","filename":"src\/hotspot\/share\/utilities\/macros.hpp","additions":1,"deletions":17,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2021 SAP SE. All rights reserved.\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022 SAP SE. All rights reserved.\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,0 @@\n-#if INCLUDE_NMT\n-\n@@ -40,2 +38,0 @@\n-\n-\n@@ -168,2 +164,0 @@\n-\n-#endif \/\/ INCLUDE_NMT\n","filename":"test\/hotspot\/gtest\/nmt\/test_nmt_buffer_overflow_detection.cpp","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2021 SAP SE. All rights reserved.\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022 SAP SE. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -57,2 +57,0 @@\n-#if INCLUDE_NMT\n-\n@@ -130,2 +128,0 @@\n-\n-#endif \/\/ INCLUDE_NMT\n","filename":"test\/hotspot\/gtest\/nmt\/test_nmtpreinit.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 2021 SAP SE. All rights reserved.\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022 SAP SE. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,2 +34,0 @@\n-#if INCLUDE_NMT\n-\n@@ -135,2 +133,0 @@\n-\n-#endif \/\/ INCLUDE_NMT\n","filename":"test\/hotspot\/gtest\/nmt\/test_nmtpreinitmap.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,2 +29,0 @@\n-#if INCLUDE_NMT\n-\n@@ -226,2 +224,0 @@\n-\n-#endif \/\/ INCLUDE_NMT\n","filename":"test\/hotspot\/gtest\/runtime\/test_committed_virtualmemory.cpp","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -35,5 +35,0 @@\n-\/\/ Included early because the NMT flags don't include it.\n-#include \"utilities\/macros.hpp\"\n-\n-#if INCLUDE_NMT\n-\n@@ -44,0 +39,1 @@\n+#include \"utilities\/macros.hpp\"\n@@ -45,0 +41,1 @@\n+\n@@ -569,2 +566,0 @@\n-\n-#endif \/\/ INCLUDE_NMT\n","filename":"test\/hotspot\/gtest\/runtime\/test_virtualMemoryTracker.cpp","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"}]}