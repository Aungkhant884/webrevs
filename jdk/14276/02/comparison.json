{"files":[{"patch":"@@ -63,2 +63,2 @@\n-    const jchar* chars = (*env)->GetStringChars(env, root, NULL);\n-    if (chars == NULL) {\n+    const jchar* strchars = (*env)->GetStringChars(env, root, NULL);\n+    if (strchars == NULL) {\n@@ -80,1 +80,1 @@\n-    LPCWSTR path = (LPCWSTR)chars;\n+    LPCWSTR path = (LPCWSTR)strchars;\n@@ -86,0 +86,1 @@\n+        (*env)->ReleaseStringChars(env, root, strchars);\n@@ -111,2 +112,4 @@\n-        if (GetDiskFreeSpaceExW(path, &freeBytesAvailable, &totalNumberOfBytes,\n-            &totalNumberOfFreeBytes) == 0) {\n+        BOOL hres = GetDiskFreeSpaceExW(path, &freeBytesAvailable,\n+            &totalNumberOfBytes, &totalNumberOfFreeBytes);\n+        (*env)->ReleaseStringChars(env, root, strchars);\n+        if (FAILED(hres)) {\n@@ -127,0 +130,15 @@\n+    int len = (int)(*env)->GetStringLength(env, root);\n+    char* chars = (char*)malloc((len + 1)*sizeof(char));\n+    if (chars == NULL) {\n+        (*env)->ReleaseStringChars(env, root, strchars);\n+        JNU_ThrowByNameWithLastError(env, \"java\/lang\/RuntimeException\",\n+                                     \"malloc\");\n+        return JNI_FALSE;\n+    }\n+\n+    for (int i = 0; i < len; i++) {\n+        chars[i] = (char)strchars[i];\n+    }\n+    chars[len] = '\\0';\n+    (*env)->ReleaseStringChars(env, root, strchars);\n+\n@@ -129,1 +147,1 @@\n-    (*env)->ReleaseStringChars(env, root, chars);\n+    free(chars);\n","filename":"test\/jdk\/java\/io\/File\/libGetXSpace.c","additions":24,"deletions":6,"binary":false,"changes":30,"status":"modified"}]}