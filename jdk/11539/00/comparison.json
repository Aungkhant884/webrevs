{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -262,0 +262,8 @@\n+#define JNU_CHECK_EXCEPTION_FREE(env, x)        \\\n+    do {                                        \\\n+        if ((env)->ExceptionCheck()) {          \\\n+            free (x);                           \\\n+            return;                             \\\n+        }                                       \\\n+    } while (0)                                 \\\n+\n@@ -268,0 +276,8 @@\n+\n+#define JNU_CHECK_EXCEPTION_FREE_RETURN(env, x, y) \\\n+    do {                                        \\\n+        if ((env)->ExceptionCheck()) {          \\\n+            free (x);                           \\\n+            return (y);                         \\\n+        }                                       \\\n+    } while (0)\n@@ -276,0 +292,8 @@\n+#define JNU_CHECK_EXCEPTION_FREE(env, x)        \\\n+    do {                                        \\\n+        if ((*env)->ExceptionCheck(env)) {      \\\n+            free (x);                           \\\n+            return;                             \\\n+        }                                       \\\n+    } while (0)                                 \\\n+\n@@ -282,0 +306,8 @@\n+\n+#define JNU_CHECK_EXCEPTION_FREE_RETURN(env, x, y) \\\n+    do {                                        \\\n+        if ((*env)->ExceptionCheck(env)) {      \\\n+            free (x);                           \\\n+            return (y);                         \\\n+        }                                       \\\n+    } while (0)\n","filename":"src\/java.base\/share\/native\/libjava\/jni_util.h","additions":33,"deletions":1,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -370,6 +370,1 @@\n-\n-            if ((*env)->ExceptionCheck(env))\n-            {\n-                free(cData);\n-                return (ColorData*)NULL;\n-            }\n+            JNU_CHECK_EXCEPTION_FREE_RETURN(env, cData, NULL);\n","filename":"src\/java.desktop\/share\/native\/libawt\/awt\/image\/BufImgSurfaceData.c","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -609,7 +609,3 @@\n-      if ((*env)->ExceptionCheck(env)) {\n-        free(value);\n-        return;\n-      } else {\n-        cbytes->length = len;\n-        cbytes->value = value;\n-      }\n+      JNU_CHECK_EXCEPTION_FREE(env, value);\n+      cbytes->length = len;\n+      cbytes->value = value;\n","filename":"src\/java.security.jgss\/share\/native\/libj2gss\/NativeUtil.c","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -163,4 +163,1 @@\n-            if ((*env)->ExceptionCheck(env)) {\n-                free(tab);\n-                return NULL;\n-            }\n+            JNU_CHECK_EXCEPTION_FREE_RETURN(env, tab, NULL);\n@@ -168,4 +165,1 @@\n-            if ((*env)->ExceptionCheck(env)) {\n-                free(tab);\n-                return NULL;\n-            }\n+            JNU_CHECK_EXCEPTION_FREE_RETURN(env, tab, NULL);\n","filename":"src\/java.smartcardio\/share\/native\/libj2pcsc\/pcsc.c","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -1625,4 +1625,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(ckParamPtr);\n-        return NULL;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE_RETURN(env, ckParamPtr, NULL);\n","filename":"src\/jdk.crypto.cryptoki\/share\/native\/libj2pkcs11\/p11_convert.c","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -814,4 +814,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(ckpPin);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, ckpPin);\n@@ -894,4 +891,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(ckpOldPin);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, ckpOldPin);\n","filename":"src\/jdk.crypto.cryptoki\/share\/native\/libj2pkcs11\/p11_general.c","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -531,4 +531,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(jpTemp);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, jpTemp);\n@@ -573,4 +570,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(jpTemp);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, jpTemp);\n@@ -620,4 +614,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(jTemp);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, jTemp);\n@@ -662,4 +653,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(jpTemp);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, jpTemp);\n@@ -704,4 +692,1 @@\n-    if ((*env)->ExceptionCheck(env)) {\n-        free(jTemp);\n-        return;\n-    }\n+    JNU_CHECK_EXCEPTION_FREE(env, jTemp);\n","filename":"src\/jdk.crypto.cryptoki\/share\/native\/libj2pkcs11\/p11_util.c","additions":5,"deletions":20,"binary":false,"changes":25,"status":"modified"}]}