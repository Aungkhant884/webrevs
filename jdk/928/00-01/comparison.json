{"files":[{"patch":"@@ -265,1 +265,25 @@\n-typedef ThreadToOopClosure ZHeapIteratorThreadClosure;\n+class ZHeapIteratorThreadClosure : public ThreadClosure {\n+private:\n+  OopClosure* const _cl;\n+\n+  class NMethodVisitor : public CodeBlobToOopClosure {\n+  public:\n+    NMethodVisitor(OopClosure* cl) :\n+        CodeBlobToOopClosure(cl, false \/* fix_oop_relocations *\/) {}\n+\n+    void do_code_blob(CodeBlob* cb) {\n+      assert(!cb->is_nmethod() || !ZNMethod::is_armed(cb->as_nmethod()),\n+          \"NMethods on stack should have been fixed and disarmed\");\n+\n+      CodeBlobToOopClosure::do_code_blob(cb);\n+    }\n+  };\n+\n+public:\n+  ZHeapIteratorThreadClosure(OopClosure* cl) : _cl(cl) {}\n+\n+  void do_thread(Thread* thread) {\n+    NMethodVisitor code_cl(_cl);\n+    thread->oops_do(_cl, &code_cl);\n+  }\n+};\n","filename":"src\/hotspot\/share\/gc\/z\/zHeapIterator.cpp","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -30,1 +30,0 @@\n-#include \"runtime\/thread.hpp\"\n@@ -40,5 +39,0 @@\n-void ThreadToOopClosure::do_thread(Thread* thread) {\n-  CodeBlobToOopClosure code_cl(_cl, false \/* fix_oop_relocations *\/);\n-  thread->oops_do(_cl, &code_cl);\n-}\n-\n","filename":"src\/hotspot\/share\/memory\/iterator.cpp","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -174,9 +174,0 @@\n-class ThreadToOopClosure : public ThreadClosure {\n-private:\n-  OopClosure* const _cl;\n-\n-public:\n-  ThreadToOopClosure(OopClosure* cl) : _cl(cl) {}\n-  void do_thread(Thread* thread);\n-};\n-\n","filename":"src\/hotspot\/share\/memory\/iterator.hpp","additions":0,"deletions":9,"binary":false,"changes":9,"status":"modified"}]}