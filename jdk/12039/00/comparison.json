{"files":[{"patch":"@@ -413,1 +413,1 @@\n-  UTIL_ARG_ENABLE(NAME: asan, DEFAULT: false,\n+  UTIL_ARG_ENABLE(NAME: asan, DEFAULT: false, RESULT: ASAN_ENABLED,\n@@ -429,1 +429,1 @@\n-        ASAN_CFLAGS=\"-fsanitize=address -Wno-stringop-truncation -fno-omit-frame-pointer\"\n+        ASAN_CFLAGS=\"-fsanitize=address -Wno-stringop-truncation -fno-omit-frame-pointer -DADDRESS_SANITIZER\"\n@@ -439,4 +439,0 @@\n-        ASAN_ENABLED=\"yes\"\n-      ],\n-      IF_DISABLED: [\n-        ASAN_ENABLED=\"no\"\n","filename":"make\/autoconf\/jdk-options.m4","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -449,8 +449,1 @@\n-export ASAN_ENABLED:=@ASAN_ENABLED@\n-export DEVKIT_LIB_DIR:=@DEVKIT_LIB_DIR@\n-ifeq ($(ASAN_ENABLED), yes)\n-  export ASAN_OPTIONS=handle_segv=0 detect_leaks=0\n-  ifneq ($(DEVKIT_LIB_DIR),)\n-    export LD_LIBRARY_PATH:=$(LD_LIBRARY_PATH):$(DEVKIT_LIB_DIR)\n-  endif\n-endif\n+ASAN_ENABLED:=@ASAN_ENABLED@\n","filename":"make\/autoconf\/spec.gmk.in","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -147,0 +147,6 @@\n+  $1_EXTRA_FILES := $(LAUNCHER_SRC)\/main.c\n+\n+  ifeq ($(ASAN_ENABLED), true)\n+    $1_EXTRA_FILES += $(TOPDIR)\/make\/data\/asan\/asan_default_options.c\n+  endif\n+\n@@ -149,1 +155,1 @@\n-      EXTRA_FILES := $(LAUNCHER_SRC)\/main.c, \\\n+      EXTRA_FILES := $$($1_EXTRA_FILES), \\\n","filename":"make\/common\/modules\/LauncherCommon.gmk","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -0,0 +1,57 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.  Oracle designates this\n+ * particular file as subject to the \"Classpath\" exception as provided\n+ * by Oracle in the LICENSE file that accompanied this code.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#ifndef ADDRESS_SANITIZER\n+#error \"Build misconfigured, preprocessor macro ADDRESS_SANITIZER should be defined\"\n+#endif\n+\n+#ifndef __has_attribute\n+#define __has_attribute(x) 0\n+#endif\n+\n+#if (defined(__GNUC__) && !defined(__clang__)) || __has_attribute(visibility)\n+#define ATTRIBUTE_DEFAULT_VISIBILITY __attribute__((visibility(\"default\")))\n+#else\n+#define ATTRIBUTE_DEFAULT_VISIBILITY\n+#endif\n+\n+#if (defined(__GNUC__) && !defined(__clang__)) || __has_attribute(used)\n+#define ATTRIBUTE_USED __attribute__((used))\n+#else\n+#define ATTRIBUTE_USED\n+#endif\n+\n+\/\/ Override weak symbol exposed by ASan to override default options. This is called by ASan\n+\/\/ extremely early during library loading, before main is called. We need to override the default\n+\/\/ options because LSan is enabled by default and Hotspot is not yet compatible with it.\n+\/\/ Additionally we need to prevent ASan from handling SIGSEGV, so that Hotspot's crash handler is\n+\/\/ used. You can override these options by setting the environment variable ASAN_OPTIONS.\n+ATTRIBUTE_DEFAULT_VISIBILITY ATTRIBUTE_USED const char* __asan_default_options() {\n+  return\n+#ifndef LEAK_SANITIZER\n+    \"detect_leaks=0,\"\n+#endif\n+    \"handle_segv=0\";\n+}\n","filename":"make\/data\/asan\/asan_default_options.c","additions":57,"deletions":0,"binary":false,"changes":57,"status":"added"}]}