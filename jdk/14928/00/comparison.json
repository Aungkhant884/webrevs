{"files":[{"patch":"@@ -93,1 +93,3 @@\n-        super.checkAccessModeThenIsDirect(ad);\n+        if (exact && accessModeType(ad.type) != ad.symbolicMethodTypeExact) {\n+            throwWrongMethodTypeException(ad);\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/IndirectVarHandle.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -118,1 +118,1 @@\n-                throw new UnsupportedOperationException();\n+                throw new UnsupportedOperationException(AccessMode.valueFromOrdinal(mode).methodName());\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarForm.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import java.util.HashMap;\n@@ -35,0 +36,1 @@\n+import java.util.Map;\n@@ -2006,0 +2008,14 @@\n+\n+        \/\/ Mapping from the ordinal to AccessMode\n+        private static final Map<Integer, AccessMode> modeToAccessMode = initOrdinalToAccessModeMap();\n+        private static Map<Integer, AccessMode> initOrdinalToAccessModeMap() {\n+            Map<Integer, AccessMode> map = new HashMap<>();\n+            for (AccessMode am : AccessMode.values()) {\n+                map.put(am.ordinal(), am);\n+            }\n+            return map;\n+        }\n+\n+        static AccessMode valueFromOrdinal(int mode) {\n+            return modeToAccessMode.get(mode);\n+        }\n@@ -2090,0 +2106,2 @@\n+     * @throws UnsupportedOperationException if this VarHandle does not support\n+     *         the given access mode\n@@ -2095,0 +2113,3 @@\n+        if (vform.getMemberNameOrNull(ad.mode) == null) {\n+            throwUnsupportedOperationException(ad.mode);\n+        }\n@@ -2103,1 +2124,1 @@\n-    private final void throwWrongMethodTypeException(VarHandle.AccessDescriptor ad) {\n+    final void throwWrongMethodTypeException(VarHandle.AccessDescriptor ad) {\n@@ -2108,0 +2129,6 @@\n+    @DontInline\n+    final void throwUnsupportedOperationException(int mode) {\n+        throw new UnsupportedOperationException(AccessMode.valueFromOrdinal(mode).methodName()\n+                + \" is not supported for \" + this);\n+    }\n+\n@@ -2220,1 +2247,3 @@\n-        MemberName mn = vform.getMemberName(mode);\n+        MemberName mn = vform.getMemberNameOrNull(mode);\n+        if (mn == null)\n+            throwUnsupportedOperationException(mode);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandle.java","additions":31,"deletions":2,"binary":false,"changes":33,"status":"modified"}]}