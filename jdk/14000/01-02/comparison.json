{"files":[{"patch":"@@ -49,0 +49,1 @@\n+#include \"runtime\/arguments.hpp\"\n@@ -2046,3 +2047,5 @@\n-#ifdef ASSERT\n-  if (JVMCIENV->has_pending_exception() && JVMCICompileMethodExceptionIsFatal) {\n-    fatal_exception(JVMCIENV, \"testing JVMCI fatal exception handling\");\n+  if (JVMCIENV->has_pending_exception()) {\n+    const char* val = Arguments::PropertyList_get_value(Arguments::system_properties(), \"test.jvmci.compileMethodExceptionIsFatal\");\n+    if (val != nullptr && strcmp(val, \"true\") == 0) {\n+      fatal_exception(JVMCIENV, \"testing JVMCI fatal exception handling\");\n+    }\n@@ -2050,1 +2053,1 @@\n-#endif\n+\n","filename":"src\/hotspot\/share\/jvmci\/jvmciRuntime.cpp","additions":7,"deletions":4,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -128,1 +128,0 @@\n-  CHECK_NOT_SET(JVMCICompileMethodExceptionIsFatal,  EnableJVMCI)\n","filename":"src\/hotspot\/share\/jvmci\/jvmci_globals.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -155,4 +155,0 @@\n-  notproduct(bool, JVMCICompileMethodExceptionIsFatal, false,               \\\n-          \"An exception thrown by HotSpotJVMCIRuntime::compileMethod \"      \\\n-          \"is fatal. Used to test error handling only.\")                    \\\n-                                                                            \\\n","filename":"src\/hotspot\/share\/jvmci\/jvmci_globals.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n- * @requires vm.debug\n@@ -75,2 +74,3 @@\n-            \/\/ Use a 5 sec timeout just in case the compiler creation fails\n-            while (System.currentTimeMillis() - start < 5000) {\n+            \/\/ Use a 10 sec timeout to prevent endless loop if\n+            \/\/ JVMCI compiler creation fails\n+            while (System.currentTimeMillis() - start < 10_000) {\n@@ -98,1 +98,1 @@\n-            \"-XX:\" + (fatalError ? \"+\" : \"-\") + \"JVMCICompileMethodExceptionIsFatal\",\n+            \"-Dtest.jvmci.compileMethodExceptionIsFatal=\" + (fatalError ? \"true\" : \"false\"),\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmci\/TestUncaughtErrorInCompileMethod.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}