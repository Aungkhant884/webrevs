{"files":[{"patch":"@@ -81,1 +81,2 @@\n-    _rs_length_diff_seq(new TruncatedSeq(TruncatedSeqLength)),\n+    _young_rs_length_diff_seq(new TruncatedSeq(TruncatedSeqLength)),\n+    _mixed_rs_length_diff_seq(new TruncatedSeq(TruncatedSeqLength)),\n@@ -94,2 +95,4 @@\n-    _pending_cards_seq(new TruncatedSeq(TruncatedSeqLength)),\n-    _rs_length_seq(new TruncatedSeq(TruncatedSeqLength)),\n+    _young_pending_cards_seq(new TruncatedSeq(TruncatedSeqLength)),\n+    _mixed_pending_cards_seq(new TruncatedSeq(TruncatedSeqLength)),\n+    _young_rs_length_seq(new TruncatedSeq(TruncatedSeqLength)),\n+    _mixed_rs_length_seq(new TruncatedSeq(TruncatedSeqLength)),\n@@ -107,1 +110,1 @@\n-  _rs_length_diff_seq->add(rs_length_diff_defaults[index]);\n+  _young_rs_length_diff_seq->add(rs_length_diff_defaults[index]);\n@@ -196,2 +199,6 @@\n-void G1Analytics::report_rs_length_diff(double rs_length_diff) {\n-  _rs_length_diff_seq->add(rs_length_diff);\n+void G1Analytics::report_rs_length_diff(double rs_length_diff, bool for_young_gc) {\n+  if (for_young_gc) {\n+    _young_rs_length_diff_seq->add(rs_length_diff);\n+  } else {\n+    _mixed_rs_length_diff_seq->add(rs_length_diff);\n+  }\n@@ -220,2 +227,6 @@\n-void G1Analytics::report_pending_cards(double pending_cards) {\n-  _pending_cards_seq->add(pending_cards);\n+void G1Analytics::report_pending_cards(double pending_cards, bool for_young_gc) {\n+  if (for_young_gc) {\n+    _young_pending_cards_seq->add(pending_cards);\n+  } else {\n+    _mixed_pending_cards_seq->add(pending_cards);\n+  }\n@@ -224,2 +235,6 @@\n-void G1Analytics::report_rs_length(double rs_length) {\n-  _rs_length_seq->add(rs_length);\n+void G1Analytics::report_rs_length(double rs_length, bool for_young_gc) {\n+  if (for_young_gc) {\n+    _young_rs_length_seq->add(rs_length);\n+  } else {\n+    _mixed_rs_length_seq->add(rs_length);\n+  }\n@@ -304,2 +319,6 @@\n-size_t G1Analytics::predict_rs_length() const {\n-  return predict_size(_rs_length_seq) + predict_size(_rs_length_diff_seq);\n+size_t G1Analytics::predict_rs_length(bool for_young_gc) const {\n+  if (for_young_gc || !enough_samples_available(_mixed_rs_length_seq)) {\n+    return predict_size(_young_rs_length_seq) + predict_size(_young_rs_length_diff_seq);\n+  } else {\n+    return predict_size(_mixed_rs_length_seq) + predict_size(_mixed_rs_length_diff_seq);\n+  }\n@@ -308,2 +327,6 @@\n-size_t G1Analytics::predict_pending_cards() const {\n-  return predict_size(_pending_cards_seq);\n+size_t G1Analytics::predict_pending_cards(bool for_young_gc) const {\n+  if (for_young_gc || !enough_samples_available(_mixed_pending_cards_seq)) {\n+    return predict_size(_young_pending_cards_seq);\n+  } else {\n+    return predict_size(_mixed_pending_cards_seq);\n+  }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Analytics.cpp","additions":37,"deletions":14,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -48,1 +48,2 @@\n-  TruncatedSeq* _rs_length_diff_seq;\n+  TruncatedSeq* _young_rs_length_diff_seq;\n+  TruncatedSeq* _mixed_rs_length_diff_seq;\n@@ -70,2 +71,4 @@\n-  TruncatedSeq* _pending_cards_seq;\n-  TruncatedSeq* _rs_length_seq;\n+  TruncatedSeq* _young_pending_cards_seq;\n+  TruncatedSeq* _mixed_pending_cards_seq;\n+  TruncatedSeq* _young_rs_length_seq;\n+  TruncatedSeq* _mixed_rs_length_seq;\n@@ -129,1 +132,1 @@\n-  void report_rs_length_diff(double rs_length_diff);\n+  void report_rs_length_diff(double rs_length_diff, bool for_young_gc);\n@@ -134,2 +137,2 @@\n-  void report_pending_cards(double pending_cards);\n-  void report_rs_length(double rs_length);\n+  void report_pending_cards(double pending_cards, bool for_young_gc);\n+  void report_rs_length(double rs_length, bool for_young_gc);\n@@ -164,2 +167,2 @@\n-  size_t predict_rs_length() const;\n-  size_t predict_pending_cards() const;\n+  size_t predict_rs_length(bool for_young_gc) const;\n+  size_t predict_pending_cards(bool for_young_gc) const;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Analytics.hpp","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -199,2 +199,3 @@\n-  update_young_length_bounds(_analytics->predict_pending_cards(),\n-                             _analytics->predict_rs_length());\n+  bool for_young_gc = collector_state()->in_young_only_phase();\n+  update_young_length_bounds(_analytics->predict_pending_cards(for_young_gc),\n+                             _analytics->predict_rs_length(for_young_gc));\n@@ -537,1 +538,2 @@\n-  update_rs_length_prediction(_analytics->predict_rs_length());\n+  bool for_young_gc = collector_state()->in_young_only_phase();\n+  update_rs_length_prediction(_analytics->predict_rs_length(for_young_gc));\n@@ -758,0 +760,1 @@\n+  bool is_young_only_pause = G1GCPauseTypeHelper::is_young_only_pause(this_pause);\n@@ -811,1 +814,1 @@\n-    assert(G1GCPauseTypeHelper::is_young_only_pause(this_pause), \"must be\");\n+    assert(is_young_only_pause, \"must be\");\n@@ -835,2 +838,1 @@\n-      _analytics->report_cost_per_card_merge_ms(avg_time_merge_cards \/ total_cards_merged,\n-                                                G1GCPauseTypeHelper::is_young_only_pause(this_pause));\n+      _analytics->report_cost_per_card_merge_ms(avg_time_merge_cards \/ total_cards_merged, is_young_only_pause);\n@@ -847,2 +849,1 @@\n-      _analytics->report_cost_per_card_scan_ms(avg_time_dirty_card_scan \/ total_cards_scanned,\n-                                               G1GCPauseTypeHelper::is_young_only_pause(this_pause));\n+      _analytics->report_cost_per_card_scan_ms(avg_time_dirty_card_scan \/ total_cards_scanned, is_young_only_pause);\n@@ -862,2 +863,1 @@\n-    _analytics->report_card_merge_to_scan_ratio(merge_to_scan_ratio,\n-                                                G1GCPauseTypeHelper::is_young_only_pause(this_pause));\n+    _analytics->report_card_merge_to_scan_ratio(merge_to_scan_ratio, is_young_only_pause);\n@@ -867,1 +867,1 @@\n-    _analytics->report_rs_length_diff(rs_length_diff);\n+    _analytics->report_rs_length_diff(rs_length_diff, is_young_only_pause);\n@@ -892,5 +892,2 @@\n-    \/\/ During mixed gc we do not use them for young gen sizing.\n-    if (G1GCPauseTypeHelper::is_young_only_pause(this_pause)) {\n-      _analytics->report_pending_cards((double) _pending_cards_at_gc_start);\n-      _analytics->report_rs_length((double) _rs_length);\n-    }\n+    _analytics->report_pending_cards((double) _pending_cards_at_gc_start, is_young_only_pause);\n+    _analytics->report_rs_length((double) _rs_length, is_young_only_pause);\n@@ -1036,1 +1033,2 @@\n-  size_t rs_length = _analytics->predict_rs_length();\n+  bool for_young_gc = collector_state()->in_young_only_phase();\n+  size_t rs_length = _analytics->predict_rs_length(for_young_gc);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":15,"deletions":17,"binary":false,"changes":32,"status":"modified"}]}