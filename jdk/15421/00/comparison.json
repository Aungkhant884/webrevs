{"files":[{"patch":"@@ -178,1 +178,0 @@\n-  assert(loader_data == ClassLoaderData::the_null_class_loader_data(), \"array classes belong to null loader\");\n","filename":"src\/hotspot\/share\/oops\/arrayKlass.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2706,1 +2706,2 @@\n-     MutexLocker ml(MultiArray_lock);\n+    MutexLocker ml(MultiArray_lock);\n+    assert(this == array_klasses()->bottom_klass(), \"sanity\");\n@@ -2709,1 +2710,1 @@\n-    array_klasses()->restore_unshareable_info(ClassLoaderData::the_null_class_loader_data(), Handle(), CHECK);\n+    array_klasses()->restore_unshareable_info(class_loader_data(), Handle(), CHECK);\n","filename":"src\/hotspot\/share\/oops\/instanceKlass.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -573,1 +573,3 @@\n-    log_trace(cds, unshareable)(\"restore: %s\", external_name());\n+    oop class_loader = loader_data->class_loader();\n+    log_trace(cds, unshareable)(\"restore: %s with class loader: %s\", external_name(),\n+      class_loader != nullptr ? class_loader->klass()->external_name() : \"boot\");\n","filename":"src\/hotspot\/share\/oops\/klass.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -47,2 +47,4 @@\n-        String appJar = ClassFileInstaller.getJarPath(\"ArrayKlasses.jar\");\n-        String mainClass = \"ArrayKlassesApp\";\n+        final String appJar = ClassFileInstaller.getJarPath(\"ArrayKlasses.jar\");\n+        final String mainClass = \"ArrayKlassesApp\";\n+        final String runtimeLogOptions =\n+            \"-Xlog:class+load,class+load+array=debug,cds+dynamic=debug,cds=debug,cds+unshareable=trace\";\n@@ -65,2 +67,1 @@\n-        run2(null, topArchiveName,\n-             \"-Xlog:class+load,class+load+array=debug,cds+dynamic=debug,cds=debug\",\n+        run2(null, topArchiveName, runtimeLogOptions,\n@@ -70,0 +71,1 @@\n+                           .shouldContain(\"restore: ArrayKlassesApp with class loader: jdk.internal.loader.ClassLoaders$AppClassLoader\")\n@@ -71,0 +73,1 @@\n+                           .shouldContain(\"restore: [LArrayKlassesApp; with class loader: jdk.internal.loader.ClassLoaders$AppClassLoader\")\n@@ -72,0 +75,1 @@\n+                           .shouldContain(\"restore: [[LArrayKlassesApp; with class loader: jdk.internal.loader.ClassLoaders$AppClassLoader\")\n@@ -73,0 +77,1 @@\n+                           .shouldContain(\"restore: [[[LArrayKlassesApp; with class loader: jdk.internal.loader.ClassLoaders$AppClassLoader\")\n@@ -93,2 +98,1 @@\n-        run2(null, topArchiveName,\n-             \"-Xlog:class+load,class+load+array=debug,cds+dynamic=debug,cds=debug\",\n+        run2(null, topArchiveName, runtimeLogOptions,\n@@ -98,0 +102,1 @@\n+                           .shouldContain(\"restore: java.util.Date with class loader: boot\")\n@@ -99,0 +104,1 @@\n+                           .shouldContain(\"restore: [Ljava.util.Date; with class loader: boot\")\n@@ -100,0 +106,1 @@\n+                           .shouldContain(\"restore: [[Ljava.util.Date; with class loader: boot\")\n@@ -101,0 +108,1 @@\n+                           .shouldContain(\"restore: [[[Ljava.util.Date; with class loader: boot\")\n@@ -119,2 +127,1 @@\n-        run2(null, topArchiveName,\n-             \"-Xlog:class+load,class+load+array=debug,cds+dynamic=debug,cds=debug\",\n+        run2(null, topArchiveName, runtimeLogOptions,\n@@ -124,0 +131,1 @@\n+                           .shouldContain(\"restore: [J with class loader: boot\")\n@@ -125,0 +133,1 @@\n+                           .shouldContain(\"restore: [[J with class loader: boot\")\n@@ -126,0 +135,1 @@\n+                           .shouldContain(\"restore: [[[J with class loader: boot\")\n@@ -145,2 +155,1 @@\n-        run2(null, topArchiveName,\n-             \"-Xlog:class+load,class+load+array=debug,cds+dynamic=debug,cds=debug\",\n+        run2(null, topArchiveName, runtimeLogOptions,\n@@ -149,1 +158,5 @@\n-                     output.shouldContain(\"[[Ljava.lang.Integer; source: shared objects file (top)\")\n+                     output.shouldContain(\"java.lang.Integer source: shared objects file\")\n+                           .shouldContain(\"restore: java.lang.Integer with class loader: boot\")\n+                           .shouldContain(\"restore: [Ljava.lang.Integer; with class loader: boot\")\n+                           .shouldContain(\"[[Ljava.lang.Integer; source: shared objects file (top)\")\n+                           .shouldContain(\"restore: [[Ljava.lang.Integer; with class loader: boot\")\n@@ -151,0 +164,1 @@\n+                           .shouldContain(\"restore: [[[Ljava.lang.Integer; with class loader: boot\")\n@@ -152,0 +166,1 @@\n+                           .shouldContain(\"restore: [[[[Ljava.lang.Integer; with class loader: boot\")\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/ArrayKlasses.java","additions":26,"deletions":11,"binary":false,"changes":37,"status":"modified"}]}