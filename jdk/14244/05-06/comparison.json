{"files":[{"patch":"@@ -27,0 +27,1 @@\n+import java.lang.management.ManagementFactory;\n@@ -32,0 +33,2 @@\n+import com.sun.management.HotSpotDiagnosticMXBean;\n+import com.sun.management.VMOption;\n@@ -36,1 +39,1 @@\n- * @test\n+ * @test id=default\n@@ -38,2 +41,9 @@\n- * @summary JVMTI.agent_load should obey EnableDynamicAgentLoading\n- *\n+ * @summary JVMTI.agent_load should obey EnableDynamicAgentLoading (by default)\n+ * @library \/test\/lib\n+ * @run main\/othervm TestJcmdNoAgentLoad\n+ *\/\n+\n+\/*\n+ * @test id=disabled\n+ * @bug 8304438\n+ * @summary JVMTI.agent_load should obey EnableDynamicAgentLoading (disabled)\n@@ -41,1 +51,0 @@\n- *\n@@ -44,0 +53,10 @@\n+\n+\/*\n+ * @test id=enabled\n+ * @bug 8304438\n+ * @summary JVMTI.agent_load should obey EnableDynamicAgentLoading (enabled)\n+ * @library \/test\/lib\n+ * @run main\/othervm -XX:+EnableDynamicAgentLoading TestJcmdNoAgentLoad\n+ *\/\n+\n+\n@@ -49,0 +68,7 @@\n+    private static boolean enableDynLoad = true;\n+\n+    static {\n+        HotSpotDiagnosticMXBean bean = ManagementFactory.getPlatformMXBean(HotSpotDiagnosticMXBean.class);\n+        VMOption enableDynLoadOpt = bean.getVMOption(\"EnableDynamicAgentLoading\");\n+        enableDynLoad = enableDynLoadOpt.getValue().equals(\"true\");\n+    }\n@@ -58,1 +84,5 @@\n-        output.shouldContain(PTRN);\n+        if (enableDynLoad) {\n+            output.shouldNotContain(PTRN);\n+        } else {\n+            output.shouldContain(PTRN);\n+        }\n","filename":"test\/jdk\/sun\/tools\/jcmd\/TestJcmdNoAgentLoad.java","additions":35,"deletions":5,"binary":false,"changes":40,"status":"modified"}]}