{"files":[{"patch":"@@ -38,0 +38,1 @@\n+#include \"runtime\/mutexLocker.hpp\"\n@@ -66,7 +67,8 @@\n-    \/\/ To get deterministic output from -Xshare:dump, we ensure that Symbols are allocated in\n-    \/\/ increasing addresses. When the symbols are copied into the archive, we preserve their\n-    \/\/ relative address order (see SortedSymbolClosure in metaspaceShared.cpp)\n-    \/\/\n-    \/\/ We cannot use arena because arena chunks are allocated by the OS. As a result, for example,\n-    \/\/ the archived symbol of \"java\/lang\/Object\" may sometimes be lower than \"java\/lang\/String\", and\n-    \/\/ sometimes be higher. This would cause non-deterministic contents in the archive.\n+   MutexLocker ml(DumpRegion_lock, Mutex::_no_safepoint_check_flag);\n+   \/\/ To get deterministic output from -Xshare:dump, we ensure that Symbols are allocated in\n+   \/\/ increasing addresses. When the symbols are copied into the archive, we preserve their\n+   \/\/ relative address order (sorted, see ArchiveBuilder::gather_klasses_and_symbols).\n+   \/\/\n+   \/\/ We cannot use arena because arena chunks are allocated by the OS. As a result, for example,\n+   \/\/ the archived symbol of \"java\/lang\/Object\" may sometimes be lower than \"java\/lang\/String\", and\n+   \/\/ sometimes be higher. This would cause non-deterministic contents in the archive.\n","filename":"src\/hotspot\/share\/oops\/symbol.cpp","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -154,0 +154,1 @@\n+Mutex*   DumpRegion_lock              = NULL;\n@@ -349,0 +350,1 @@\n+  def(DumpRegion_lock              , PaddedMutex  , leaf,        true,  _safepoint_check_never);\n","filename":"src\/hotspot\/share\/runtime\/mutexLocker.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -133,0 +133,1 @@\n+extern Mutex*   DumpRegion_lock;                 \/\/ Symbol::operator new(size_t sz, int len)\n","filename":"src\/hotspot\/share\/runtime\/mutexLocker.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}