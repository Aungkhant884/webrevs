{"files":[{"patch":"@@ -67,1 +67,1 @@\n-  void prepare(JavaThread* current_target, Thread* executioner);\n+  void prepare(JavaThread* current_target, Thread* executing_thread);\n@@ -283,1 +283,1 @@\n-void HandshakeOperation::prepare(JavaThread* current_target, Thread* executioner) {\n+void HandshakeOperation::prepare(JavaThread* current_target, Thread* executing_thread) {\n@@ -288,3 +288,6 @@\n-  StackWatermarkSet::start_processing(current_target, StackWatermarkKind::gc);\n-  if (_requester != NULL && _requester != executioner && _requester->is_Java_thread()) {\n-    \/\/ The handshake closure may contains oop Handles from the _requester.\n+  if (current_target != executing_thread) {\n+    \/\/ Only when the target is not executing the handshake it self.\n+    StackWatermarkSet::start_processing(current_target, StackWatermarkKind::gc);\n+  }\n+  if (_requester != NULL && _requester != executing_thread && _requester->is_Java_thread()) {\n+    \/\/ The handshake closure may contain oop Handles from the _requester.\n@@ -450,0 +453,1 @@\n+      op->prepare(_handshakee, _handshakee);\n","filename":"src\/hotspot\/share\/runtime\/handshake.cpp","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"}]}