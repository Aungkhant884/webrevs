{"files":[{"patch":"@@ -26,0 +26,2 @@\n+import static org.testng.Assert.fail;\n+\n@@ -42,0 +44,3 @@\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n@@ -48,1 +53,1 @@\n- * @run main TransferTo\n+ * @run testng TransferTo\n@@ -62,3 +67,6 @@\n-    public static void main(String[] args) throws Exception {\n-        test(fileChannelInput(), fileChannelOutput());\n-        test(readableByteChannelInput(), defaultOutput());\n+    @DataProvider\n+    public static Object[][] streamCombinations() throws Exception {\n+        return new Object[][] {\n+            { fileChannelInput(), fileChannelOutput() },\n+            { readableByteChannelInput(), defaultOutput() }\n+        };\n@@ -67,4 +75,4 @@\n-    private static void test(InputStreamProvider inputStreamProvider, OutputStreamProvider outputStreamProvider)\n-            throws Exception {\n-        testNullPointerException(inputStreamProvider);\n-        testStreamContents(inputStreamProvider, outputStreamProvider);\n+    @Test(dataProvider = \"streamCombinations\", expectedExceptions = NullPointerException.class)\n+    public void testNullPointerExceptionWithEmptyStream(InputStreamProvider inputStreamProvider,\n+            OutputStreamProvider outputStreamProvider) throws Exception {\n+        inputStreamProvider.input().transferTo(null);\n@@ -73,8 +81,5 @@\n-    private static void testNullPointerException(InputStreamProvider inputStreamProvider) throws Exception {\n-        try (InputStream in = inputStreamProvider.input()) {\n-            assertThrowsNPE(() -> in.transferTo(null), \"out\");\n-        }\n-\n-        try (InputStream in = inputStreamProvider.input((byte) 1)) {\n-            assertThrowsNPE(() -> in.transferTo(null), \"out\");\n-        }\n+    @Test(dataProvider = \"streamCombinations\", expectedExceptions = NullPointerException.class)\n+    public void testNullPointerExceptionWithSingleByteStream(InputStreamProvider inputStreamProvider,\n+            OutputStreamProvider outputStreamProvider) throws Exception {\n+        inputStreamProvider.input((byte) 1).transferTo(null);\n+    }\n@@ -82,3 +87,4 @@\n-        try (InputStream in = inputStreamProvider.input((byte) 1, (byte) 2)) {\n-            assertThrowsNPE(() -> in.transferTo(null), \"out\");\n-        }\n+    @Test(dataProvider = \"streamCombinations\", expectedExceptions = NullPointerException.class)\n+    public void testNullPointerExceptionWithTwoByteStream(InputStreamProvider inputStreamProvider,\n+            OutputStreamProvider outputStreamProvider) throws Exception {\n+        inputStreamProvider.input((byte) 1, (byte) 2).transferTo(null);\n@@ -87,1 +93,2 @@\n-    private static void testStreamContents(InputStreamProvider inputStreamProvider,\n+    @Test(dataProvider = \"streamCombinations\")\n+    public void testStreamContents(InputStreamProvider inputStreamProvider,\n@@ -128,2 +135,1 @@\n-                throw new AssertionError(\n-                        format(\"reported %d bytes but should report %d\", reported, count));\n+                fail(format(\"reported %d bytes but should report %d\", reported, count));\n@@ -133,2 +139,1 @@\n-                throw new AssertionError(\n-                        format(\"inBytes.length=%d, outBytes.length=%d\", count, outBytes.length));\n+                fail(format(\"inBytes.length=%d, outBytes.length=%d\", count, outBytes.length));\n@@ -201,27 +206,0 @@\n-    public interface Thrower {\n-        public void run() throws Throwable;\n-    }\n-\n-    public static void assertThrowsNPE(Thrower thrower, String message) {\n-        assertThrows(thrower, NullPointerException.class, message);\n-    }\n-\n-    public static <T extends Throwable> void assertThrows(Thrower thrower, Class<T> throwable, String message) {\n-        Throwable thrown;\n-        try {\n-            thrower.run();\n-            thrown = null;\n-        } catch (Throwable caught) {\n-            thrown = caught;\n-        }\n-\n-        if (!throwable.isInstance(thrown)) {\n-            String caught = thrown == null ? \"nothing\" : thrown.getClass().getCanonicalName();\n-            throw new AssertionError(format(\"Expected to catch %s, but caught %s\", throwable, caught), thrown);\n-        }\n-\n-        if (thrown != null && !message.equals(thrown.getMessage())) {\n-            throw new AssertionError(\n-                    format(\"Expected exception message to be '%s', but it's '%s'\", message, thrown.getMessage()));\n-        }\n-    }\n","filename":"test\/jdk\/java\/nio\/channels\/Channels\/TransferTo.java","additions":29,"deletions":51,"binary":false,"changes":80,"status":"modified"}]}