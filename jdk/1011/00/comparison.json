{"files":[{"patch":"@@ -253,3 +253,1 @@\n-    assert(!ClassUnloading, \"Only used if class unloading is turned off\");\n-\n-    \/\/ ClassUnloading is turned off, all nmethods are considered strong,\n+    \/\/ If ClassUnloading is turned off, all nmethods are considered strong,\n@@ -267,14 +265,2 @@\n-  OopClosure* const _cl;\n-\n-  class NMethodVisitor : public CodeBlobToOopClosure {\n-  public:\n-    NMethodVisitor(OopClosure* cl) :\n-        CodeBlobToOopClosure(cl, false \/* fix_oop_relocations *\/) {}\n-\n-    void do_code_blob(CodeBlob* cb) {\n-      assert(!cb->is_nmethod() || !ZNMethod::is_armed(cb->as_nmethod()),\n-          \"NMethods on stack should have been fixed and disarmed\");\n-\n-      CodeBlobToOopClosure::do_code_blob(cb);\n-    }\n-  };\n+  OopClosure* const        _cl;\n+  CodeBlobToNMethodClosure _cb_cl;\n@@ -283,1 +269,3 @@\n-  ZHeapIteratorThreadClosure(OopClosure* cl) : _cl(cl) {}\n+  ZHeapIteratorThreadClosure(OopClosure* cl, NMethodClosure* nm_cl) :\n+      _cl(cl),\n+      _cb_cl(nm_cl) {}\n@@ -286,2 +274,1 @@\n-    NMethodVisitor code_cl(_cl);\n-    thread->oops_do(_cl, &code_cl);\n+    thread->oops_do(_cl, &_cb_cl);\n@@ -295,1 +282,1 @@\n-  ZHeapIteratorThreadClosure thread_cl(&cl);\n+  ZHeapIteratorThreadClosure thread_cl(&cl, &nm_cl);\n","filename":"src\/hotspot\/share\/gc\/z\/zHeapIterator.cpp","additions":8,"deletions":21,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -67,0 +67,7 @@\n+\n+void CodeBlobToNMethodClosure::do_code_blob(CodeBlob* cb) {\n+  nmethod* nm = cb->as_nmethod_or_null();\n+  if (nm != NULL) {\n+    _nm_cl->do_nmethod(nm);\n+  }\n+}\n","filename":"src\/hotspot\/share\/memory\/iterator.cpp","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -264,0 +264,9 @@\n+class CodeBlobToNMethodClosure : public CodeBlobClosure {\n+  NMethodClosure* const _nm_cl;\n+\n+ public:\n+  CodeBlobToNMethodClosure(NMethodClosure* nm_cl) : _nm_cl(nm_cl) {}\n+\n+  virtual void do_code_blob(CodeBlob* cb);\n+};\n+\n","filename":"src\/hotspot\/share\/memory\/iterator.hpp","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}