{"files":[{"patch":"@@ -284,1 +284,1 @@\n-\/\/ Implementation of \"dumpheap\" command with extra options.\n+\/\/ Implementation of \"dumpheapext\" command.\n@@ -290,1 +290,1 @@\n-\/\/   arg2: more_args: \"compress_level,noparallel\"\n+\/\/   arg2: more_args: \"compress_level,parallel\"\n@@ -318,1 +318,1 @@\n-  \/\/ Format: \"compress_level,noparallel\".\n+  \/\/ Format: \"compress_level,parallel\".\n@@ -336,1 +336,1 @@\n-    \/\/ noparallel\n+    \/\/ parallel\n@@ -339,2 +339,7 @@\n-    if (par_str != NULL && par_str[0] != '\\0' && (strcmp(\"true\", par_str) == 0)) {\n-      parallel_thread_num = 1;\n+    if (par_str != NULL && par_str[0] != '\\0') {\n+      uintx num;\n+      if (!Arguments::parse_uintx(par_str, &num, 0)) {\n+        out->print_cr(\"Invalid parallel thread number: [%s]\", par_str);\n+        return JNI_ERR;\n+      }\n+      parallel_thread_num = num == 0 ? parallel_thread_num : (uint)num;\n","filename":"src\/hotspot\/share\/services\/attachListener.cpp","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -213,0 +213,1 @@\n+        String parallel = \"\";\n@@ -214,1 +215,0 @@\n-        boolean noParallel = false;\n@@ -236,2 +236,7 @@\n-            } else if (subopt.equals(\"noparallel\")) {\n-                hasExtraArgs = noParallel = true;\n+            } else if (subopt.startsWith(\"parallel=\")) {\n+                parallel = subopt.substring(\"parallel=\".length());\n+                if (parallel.length() == 0) {\n+                    System.err.println(\"Fail: no number provided in option: '\" + subopt + \"'\");\n+                    usage(1);\n+                }\n+                hasExtraArgs = true;\n@@ -256,1 +261,1 @@\n-            \/\/        \"compress_level,noparallel\"\n+            \/\/        \"compress_level,parallel\"\n@@ -260,1 +265,1 @@\n-            String more_args = compress_level + \",\" + Boolean.toString(noParallel);\n+            String more_args = compress_level + \",\" + parallel;\n@@ -333,1 +338,4 @@\n-        System.err.println(\"      noparallel   If specified, the heap is inspected serially.\");\n+        System.err.println(\"      parallel=<number>  parallel threads number for heap dump:\");\n+        System.err.println(\"                                  parallel=0 default behavior, use predefined number of threads\");\n+        System.err.println(\"                                  parallel=1 disable parallel heap iteration\");\n+        System.err.println(\"                                  parallel=<N> use N threads for parallel heap iteration\");\n","filename":"src\/jdk.jcmd\/share\/classes\/sun\/tools\/jmap\/JMap.java","additions":14,"deletions":6,"binary":false,"changes":20,"status":"modified"}]}