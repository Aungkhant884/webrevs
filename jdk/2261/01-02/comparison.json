{"files":[{"patch":"@@ -648,13 +648,4 @@\n-  bool enqueue(char* buffer, size_t size) {\n-      if (_head == NULL) {\n-        assert(is_empty() && _tail == NULL, \"Sanity check\");\n-        _head = _tail =\n-          (ParWriterBufferQueueElem*)os::malloc(sizeof(ParWriterBufferQueueElem), mtInternal);\n-        if (_head == NULL) {\n-          \/\/ \"Could not allocate buffer list for writer\"\n-          return false;\n-        }\n-      _tail->_buffer = buffer;\n-      _tail->_used = size;\n-      _tail->_next = NULL;\n-      _length++;\n+  void enqueue(ParWriterBufferQueueElem* entry) {\n+    if (_head == NULL) {\n+      assert(is_empty() && _tail == NULL, \"Sanity check\");\n+      _head = _tail = entry;\n@@ -663,10 +654,0 @@\n-\n-      ParWriterBufferQueueElem* entry =\n-          (ParWriterBufferQueueElem*)os::malloc(sizeof(ParWriterBufferQueueElem), mtInternal);\n-      if (entry == NULL) {\n-        \/\/ \"Could not allocate buffer list for writer\"\n-        return false;\n-      }\n-      entry->_buffer = buffer;\n-      entry->_used = size;\n-      entry->_next = NULL;\n@@ -675,1 +656,0 @@\n-      _length++;\n@@ -677,1 +657,2 @@\n-    return true;\n+    _length++;\n+    assert(_tail->_next == NULL, \"Bufer queue is polluted\");\n@@ -731,1 +712,1 @@\n-    _buffer_queue(NULL),\n+    _buffer_queue((new (std::nothrow) ParWriterBufferQueue())),\n@@ -734,1 +715,2 @@\n-    initialize();\n+    \/\/ prepare internal buffer\n+    allocate_internal_buffer();\n@@ -786,5 +768,0 @@\n-  void initialize() {\n-    \/\/ allocate_work\n-    allocate_internal_buffer();\n-  }\n-\n@@ -792,0 +769,1 @@\n+    assert(_buffer_queue != NULL, \"Internal buffer queue is not ready when allocate internal buffer\");\n@@ -793,6 +771,0 @@\n-    _buffer_queue = (new (std::nothrow) ParWriterBufferQueue());\n-    if (_buffer_queue == NULL) {\n-      set_error(\"Could not allocate buffer queue for writer\");\n-      return;\n-    }\n-\n@@ -832,1 +804,4 @@\n-    if (!_buffer_queue->enqueue(_buffer_base, expected_total)) {\n+    ParWriterBufferQueueElem* entry =\n+        (ParWriterBufferQueueElem*)os::malloc(sizeof(ParWriterBufferQueueElem), mtInternal);\n+    if (entry == NULL) {\n+      \/\/ \"Could not allocate buffer list for writer\"\n@@ -836,0 +811,5 @@\n+    entry->_buffer = _buffer_base;\n+    entry->_used = expected_total;\n+    entry->_next = NULL;\n+    \/\/ add to internal buffer queue\n+    _buffer_queue->enqueue(entry);\n","filename":"src\/hotspot\/share\/services\/heapDumper.cpp","additions":19,"deletions":39,"binary":false,"changes":58,"status":"modified"}]}