{"files":[{"patch":"@@ -151,2 +151,0 @@\n-\n-\n@@ -155,0 +153,7 @@\n+inline intptr_t* frame::link_or_null() const {\n+  auto ptr = (intptr_t **)addr_at(link_offset);\n+  if (os::is_readable_pointer((const void*)ptr)) {\n+    return *ptr;\n+  }\n+  return NULL;\n+}\n","filename":"src\/hotspot\/cpu\/aarch64\/frame_aarch64.inline.hpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -127,1 +127,0 @@\n-\n@@ -130,0 +129,8 @@\n+inline intptr_t* frame::link_or_null() const {\n+  auto ptr = (intptr_t **)addr_at(link_offset);\n+  if (os::is_readable_pointer((const void*)ptr)) {\n+    return *ptr;\n+  }\n+  return NULL;\n+}\n+\n","filename":"src\/hotspot\/cpu\/arm\/frame_arm.inline.hpp","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -120,0 +120,4 @@\n+inline intptr_t* frame::link_or_null() const {\n+  return link();\n+}\n+\n","filename":"src\/hotspot\/cpu\/ppc\/frame_ppc.inline.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -158,0 +158,4 @@\n+inline intptr_t* frame::link_or_null() const {\n+  return link();\n+}\n+\n","filename":"src\/hotspot\/cpu\/s390\/frame_s390.inline.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -141,2 +141,0 @@\n-\n-\n@@ -145,0 +143,8 @@\n+inline intptr_t* frame::link_or_null() const {\n+  auto ptr = (intptr_t **)addr_at(link_offset);\n+  if (os::is_readable_pointer((const void*)ptr)) {\n+    return *ptr;\n+  }\n+  return NULL;\n+}\n+\n","filename":"src\/hotspot\/cpu\/x86\/frame_x86.inline.hpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -85,0 +85,5 @@\n+inline intptr_t* frame::link_or_null() const {\n+  ShouldNotCallThis();\n+  return NULL;\n+}\n+\n","filename":"src\/hotspot\/cpu\/zero\/frame_zero.inline.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -210,0 +210,1 @@\n+  \/\/ might crash if the frame has no parent\n@@ -212,0 +213,3 @@\n+  \/\/ Link (i.e., the pointer to the previous frame) or null if the link cannot be accessed\n+  intptr_t* link_or_null() const;\n+\n","filename":"src\/hotspot\/share\/runtime\/frame.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1179,0 +1179,1 @@\n+\/\/ Returns false if this is the cas\n@@ -1183,2 +1184,1 @@\n-#endif\n-\n+#else\n@@ -1193,1 +1193,1 @@\n-  if ((usp & sp_align_mask) != 0) return true;\n+  if ((usp & sp_align_mask) != 0 || !os::is_readable_pointer((const void*)usp)) return true;\n@@ -1196,1 +1196,1 @@\n-  if ((ufp & fp_align_mask) != 0) return true;\n+  if ((ufp & fp_align_mask) != 0 || !os::is_readable_pointer((const void*)ufp)) return true;\n@@ -1200,1 +1200,2 @@\n-  if (old_sp == 0 || old_sp == (uintptr_t)-1) return true;\n+  if (old_sp == 0 || old_sp == (uintptr_t)-1 ||\n+    !os::is_readable_pointer((const void*)old_sp)) return true;\n@@ -1202,1 +1203,1 @@\n-  uintptr_t old_fp = (uintptr_t)fr->link();\n+  uintptr_t old_fp = (uintptr_t)fr->link_or_null();\n@@ -1204,1 +1205,2 @@\n-  if (old_fp == 0 || old_fp == (uintptr_t)-1 || old_fp == ufp) return true;\n+  if (old_fp == 0 || old_fp == (uintptr_t)-1 || old_fp == ufp ||\n+    !os::is_readable_pointer((const void*)old_fp)) return true;\n@@ -1214,1 +1216,1 @@\n-}\n+#endif\n@@ -1216,0 +1218,1 @@\n+}\n","filename":"src\/hotspot\/share\/runtime\/os.cpp","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -212,1 +212,33 @@\n-#ifndef _WIN32\n+TEST_VM(os, iso8601_time) {\n+  char buffer[os::iso8601_timestamp_size + 1]; \/\/ + space for canary\n+  buffer[os::iso8601_timestamp_size] = 'X'; \/\/ canary\n+  const char* result = NULL;\n+  \/\/ YYYY-MM-DDThh:mm:ss.mmm+zzzz\n+  const char* const pattern_utc = \"dddd-dd-dd.dd:dd:dd.ddd.0000\";\n+  const char* const pattern_local = \"dddd-dd-dd.dd:dd:dd.ddd.dddd\";\n+\n+  result = os::iso8601_time(buffer, sizeof(buffer), true);\n+  tty->print_cr(\"%s\", result);\n+  EXPECT_EQ(result, buffer);\n+  EXPECT_TRUE(very_simple_string_matcher(pattern_utc, result));\n+\n+  result = os::iso8601_time(buffer, sizeof(buffer), false);\n+  tty->print_cr(\"%s\", result);\n+  EXPECT_EQ(result, buffer);\n+  EXPECT_TRUE(very_simple_string_matcher(pattern_local, result));\n+\n+  \/\/ Test with explicit timestamps\n+  result = os::iso8601_time(0, buffer, sizeof(buffer), true);\n+  tty->print_cr(\"%s\", result);\n+  EXPECT_EQ(result, buffer);\n+  EXPECT_TRUE(very_simple_string_matcher(\"1970-01-01.00:00:00.000+0000\", result));\n+\n+  result = os::iso8601_time(17, buffer, sizeof(buffer), true);\n+  tty->print_cr(\"%s\", result);\n+  EXPECT_EQ(result, buffer);\n+  EXPECT_TRUE(very_simple_string_matcher(\"1970-01-01.00:00:00.017+0000\", result));\n+\n+  \/\/ Canary should still be intact\n+  EXPECT_EQ(buffer[os::iso8601_timestamp_size], 'X');\n+}\n+\n@@ -868,0 +900,11 @@\n+\n+\n+TEST_VM(os, is_first_C_frame) {\n+  #ifndef _WIN32\n+  frame invalid_frame;\n+  EXPECT_TRUE(os::is_first_C_frame(&invalid_frame)); \/\/ the frame has zeroes for all values\n+\n+  auto cur_frame = os::current_frame(); \/\/ this frame has to have a sender\n+  EXPECT_FALSE(!os::is_first_C_frame(&cur_frame));\n+  #endif \/\/ _WIN32\n+}\n\\ No newline at end of file\n","filename":"test\/hotspot\/gtest\/runtime\/test_os.cpp","additions":44,"deletions":1,"binary":false,"changes":45,"status":"modified"}]}