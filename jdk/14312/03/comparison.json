{"files":[{"patch":"@@ -303,1 +303,8 @@\n-        return s.isEmpty() ? '*' : Character.toUpperCase(s.charAt(0));\n+        \/\/ Use first valid java identifier start character as key,\n+        \/\/ or '*' for strings that do not contain one.\n+        for (int i = 0; i < s.length(); i++) {\n+            if (Character.isJavaIdentifierStart(s.charAt(i))) {\n+                return Character.toUpperCase(s.charAt(i));\n+            }\n+        }\n+        return '*';\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/IndexBuilder.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/IndexItem.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8289332 8286470\n+ * @bug 8289332 8286470 8309471\n@@ -62,1 +62,1 @@\n-                         * <h2>First Header<\/h2>\n+                         * <h2>1.0 First Header<\/h2>\n@@ -64,1 +64,1 @@\n-                         * <h3 id=\"fixed-id-1\">Header with ID<\/h3>\n+                         * <h3 id=\"fixed-id-1\">1.1 Header with ID<\/h3>\n@@ -76,1 +76,1 @@\n-                         * <h2>Extra (#*!. chars<\/h2>\n+                         * <h2>2.0 Extra (#*!. chars<\/h2>\n@@ -82,1 +82,1 @@\n-                         * <h2>  Multi-line\n+                         * <h2> 3.0 Multi-line\n@@ -97,0 +97,4 @@\n+        checkIds();\n+        checkSearchIndex();\n+        checkHtmlIndex();\n+    }\n@@ -98,0 +102,1 @@\n+    private void checkIds() {\n@@ -100,1 +105,1 @@\n-                    <h2 id=\"first-header-heading\">First Header<\/h2>\n+                    <h2 id=\"1-0-first-header-heading\">1.0 First Header<\/h2>\n@@ -103,1 +108,1 @@\n-                    <h3 id=\"fixed-id-1\">Header with ID<\/h3>\n+                    <h3 id=\"fixed-id-1\">1.1 Header with ID<\/h3>\n@@ -121,1 +126,1 @@\n-                    <h2 id=\"extra-chars-heading\">Extra (#*!. chars<\/h2>\n+                    <h2 id=\"2-0-extra-chars-heading\">2.0 Extra (#*!. chars<\/h2>\n@@ -130,1 +135,1 @@\n-                    <h2 id=\"multi-line-heading-with-extra-whitespace-heading\">  Multi-line\n+                    <h2 id=\"3-0-multi-line-heading-with-extra-whitespace-heading\"> 3.0 Multi-line\n@@ -133,0 +138,3 @@\n+    }\n+\n+    private void checkSearchIndex() {\n@@ -145,1 +153,1 @@\n-                    {\"l\":\"Extra (#*!. chars\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html#extra-chars-heading\"}\"\"\",\n+                    {\"l\":\"2.0 Extra (#*!. chars\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html#2-0-extra-chars-heading\"}\"\"\",\n@@ -147,1 +155,1 @@\n-                    {\"l\":\"First Header\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html#first-header-heading\"}\"\"\",\n+                    {\"l\":\"1.0 First Header\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html#1-0-first-header-heading\"}\"\"\",\n@@ -149,1 +157,1 @@\n-                    {\"l\":\"Header with ID\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html#fixed-id-1\"}\"\"\",\n+                    {\"l\":\"1.1 Header with ID\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html#fixed-id-1\"}\"\"\",\n@@ -151,2 +159,2 @@\n-                    {\"l\":\"Multi-line heading with extra whitespace\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html\\\n-                    #multi-line-heading-with-extra-whitespace-heading\"}\"\"\",\n+                    {\"l\":\"3.0 Multi-line heading with extra whitespace\",\"h\":\"class p.C\",\"d\":\"Section\",\"u\":\"p\/C.html\\\n+                    #3-0-multi-line-heading-with-extra-whitespace-heading\"}\"\"\",\n@@ -156,0 +164,72 @@\n+\n+    private void checkHtmlIndex() {\n+        \/\/ Make sure section links are not included in static index pages\n+        checkOutput(\"index-all.html\", true,\n+                \"\"\"\n+                    <a href=\"#I:C\">C<\/a>&nbsp;<a href=\"#I:D\">D<\/a>&nbsp;<a href=\"#I:E\">E<\/a>&nbsp;<a href=\"#I\\\n+                    :F\">F<\/a>&nbsp;<a href=\"#I:H\">H<\/a>&nbsp;<a href=\"#I:M\">M<\/a>&nbsp;<a href=\"#I:O\">O<\/a>&n\\\n+                    bsp;<a href=\"#I:P\">P<\/a>&nbsp;<br><a href=\"allclasses-index.html\">All&nbsp;Classes&nbsp;a\\\n+                    nd&nbsp;Interfaces<\/a><span class=\"vertical-separator\">|<\/span><a href=\"allpackages-index\\\n+                    .html\">All&nbsp;Packages<\/a>\n+                    <h2 class=\"title\" id=\"I:C\">C<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html\" class=\"type-name-link\" title=\"class in p\">C<\/a> - Class in <a href\\\n+                    =\"p\/package-summary.html\">p<\/a><\/dt>\n+                    <dd>\n+                    <div class=\"block\">First sentence.<\/div>\n+                    <\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:D\">D<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html#duplicate-text-heading\" class=\"search-tag-link\">Duplicate Text<\/a> \\\n+                    - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <dt><a href=\"p\/C.html#duplicate-text-heading1\" class=\"search-tag-link\">Duplicate Text<\/a>\\\n+                     - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:E\">E<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html#2-0-extra-chars-heading\" class=\"search-tag-link\">2.0 Extra (#*!. ch\\\n+                    ars<\/a> - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <dt><a href=\"p\/C.html#fixed-id-2\" class=\"search-tag-link\">Embedded A-Tag with ID<\/a> - Se\\\n+                    arch tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <dt><a href=\"p\/C.html#embedded-code-tag-heading\" class=\"search-tag-link\">Embedded Code Ta\\\n+                    g<\/a> - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <dt><a href=\"p\/C.html#embedded-link-tag-heading\" class=\"search-tag-link\">Embedded Link Ta\\\n+                    g<\/a> - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:F\">F<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html#1-0-first-header-heading\" class=\"search-tag-link\">1.0 First Header<\\\n+                    \/a> - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:H\">H<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html#fixed-id-1\" class=\"search-tag-link\">1.1 Header with ID<\/a> - Search\\\n+                     tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:M\">M<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html#3-0-multi-line-heading-with-extra-whitespace-heading\" class=\"search\\\n+                    -tag-link\">3.0 Multi-line heading with extra whitespace<\/a> - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:O\">O<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/C.html#other-attributes-heading\" class=\"search-tag-link\">Other attributes<\\\n+                    \/a> - Search tag in class p.C<\/dt>\n+                    <dd>Section<\/dd>\n+                    <\/dl>\n+                    <h2 class=\"title\" id=\"I:P\">P<\/h2>\n+                    <dl class=\"index\">\n+                    <dt><a href=\"p\/package-summary.html\">p<\/a> - package p<\/dt>\n+                    <dd>&nbsp;<\/dd>\n+                    <\/dl>\"\"\");\n+    }\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testAutoHeaderId\/TestAutoHeaderId.java","additions":94,"deletions":14,"binary":false,"changes":108,"status":"modified"}]}