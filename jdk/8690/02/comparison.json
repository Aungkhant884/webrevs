{"files":[{"patch":"@@ -156,2 +156,2 @@\n-  static OopMap* save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_vectors);\n-  static void restore_live_registers(MacroAssembler* masm, bool restore_vectors = false);\n+  static OopMap* save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_wide_vectors);\n+  static void restore_live_registers(MacroAssembler* masm, bool restore_wide_vectors = false);\n@@ -178,1 +178,1 @@\n-OopMap* RegisterSaver::save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_vectors) {\n+OopMap* RegisterSaver::save_live_registers(MacroAssembler* masm, int additional_frame_words, int* total_frame_words, bool save_wide_vectors) {\n@@ -182,2 +182,2 @@\n-  if (save_vectors && UseAVX == 0) {\n-    save_vectors = false; \/\/ vectors larger than 16 byte long are supported only with AVX\n+  if (save_wide_vectors && UseAVX == 0) {\n+    save_wide_vectors = false; \/\/ vectors larger than 16 byte long are supported only with AVX\n@@ -185,1 +185,1 @@\n-  assert(!save_vectors || MaxVectorSize <= 64, \"Only up to 64 byte long vectors are supported\");\n+  assert(!save_wide_vectors || MaxVectorSize <= 64, \"Only up to 64 byte long vectors are supported\");\n@@ -187,1 +187,1 @@\n-  save_vectors = false; \/\/ vectors are generated only by C2 and JVMCI\n+  save_wide_vectors = false; \/\/ vectors are generated only by C2 and JVMCI\n@@ -208,1 +208,1 @@\n-  if (save_vectors) {\n+  if (save_wide_vectors) {\n@@ -237,1 +237,1 @@\n-      \/\/ Save upper bank of ZMM registers(16..31) for double\/float usage\n+      \/\/ Save upper bank of XMM registers(16..31) for scalar or 16-byte vector usage\n@@ -241,1 +241,1 @@\n-        __ movsd(Address(rsp, base_addr+(off++*64)), as_XMMRegister(n));\n+        __ evmovdqul(Address(rsp, base_addr+(off++*64)), as_XMMRegister(n), Assembler::AVX_128bit);\n@@ -305,1 +305,1 @@\n-  if (save_vectors) {\n+  if (save_wide_vectors) {\n@@ -369,1 +369,1 @@\n-void RegisterSaver::restore_live_registers(MacroAssembler* masm, bool restore_vectors) {\n+void RegisterSaver::restore_live_registers(MacroAssembler* masm, bool restore_wide_vectors) {\n@@ -377,1 +377,1 @@\n-  if (restore_vectors) {\n+  if (restore_wide_vectors) {\n@@ -382,1 +382,1 @@\n-  assert(!restore_vectors, \"vectors are generated only by C2\");\n+  assert(!restore_wide_vectors, \"vectors are generated only by C2\");\n@@ -388,1 +388,1 @@\n-  if (restore_vectors) {\n+  if (restore_wide_vectors) {\n@@ -417,1 +417,1 @@\n-      \/\/ Restore upper bank of ZMM registers(16..31) for double\/float usage\n+      \/\/ Restore upper bank of XMM registers(16..31) for scalar or 16-byte vector usage\n@@ -421,1 +421,1 @@\n-        __ movsd(as_XMMRegister(n), Address(rsp, base_addr+(off++*64)));\n+        __ evmovdqul(as_XMMRegister(n), Address(rsp, base_addr+(off++*64)), Assembler::AVX_128bit);\n@@ -2459,1 +2459,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2477,1 +2477,1 @@\n-  (void) RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+  (void) RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2496,1 +2496,1 @@\n-    RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+    RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2543,1 +2543,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ true);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ true);\n@@ -2974,1 +2974,1 @@\n-  bool save_vectors = (poll_type == POLL_AT_VECTOR_LOOP);\n+  bool save_wide_vectors = (poll_type == POLL_AT_VECTOR_LOOP);\n@@ -2989,1 +2989,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, save_vectors);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, save_wide_vectors);\n@@ -3028,1 +3028,1 @@\n-  RegisterSaver::restore_live_registers(masm, save_vectors);\n+  RegisterSaver::restore_live_registers(masm, save_wide_vectors);\n@@ -3101,1 +3101,1 @@\n-  RegisterSaver::restore_live_registers(masm, save_vectors);\n+  RegisterSaver::restore_live_registers(masm, save_wide_vectors);\n@@ -3141,1 +3141,1 @@\n-  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_vectors*\/ false);\n+  map = RegisterSaver::save_live_registers(masm, 0, &frame_size_in_words, \/*save_wide_vectors*\/ false);\n","filename":"src\/hotspot\/cpu\/x86\/sharedRuntime_x86_64.cpp","additions":26,"deletions":26,"binary":false,"changes":52,"status":"modified"}]}