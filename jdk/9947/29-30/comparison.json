{"files":[{"patch":"@@ -85,7 +85,5 @@\n-\/*\n-magic_divide_constants in utilities\/javaArithmetic.hpp calculates the constant c, s\n-such that division(x \/ d) = floor(x * c \/ m) + (x < 0 ? 1 : 0) for every integer x in\n-the input range. The functions in this file try to derive from the formula in real\n-arithmetic to arrive at a formula in int\/long arithmetic. More details can be found in\n-each individual function.\n-*\/\n+\/\/ magic_divide_constants in utilities\/javaArithmetic.hpp calculates the constant c, s\n+\/\/ such that division(x \/ d) = floor(x * c \/ m) + (x < 0 ? 1 : 0) for every integer x in\n+\/\/ the input range. The functions in this file try to derive from the formula in real\n+\/\/ arithmetic to arrive at a formula in int\/long arithmetic. More details can be found in\n+\/\/ each individual function.\n","filename":"src\/hotspot\/share\/opto\/divnode.cpp","additions":5,"deletions":7,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -30,3 +30,0 @@\n-\/*\n-Compute magic multiplier and shift constant for converting a 32\/64 bit\n-division by constant into a multiply\/shift series.\n@@ -34,2 +31,5 @@\n-(1) Theory:\n-Motivated by Henry S. Warren. 2012. Hacker's Delight (2nd. ed.). Addison-Wesley Professional.\n+\/\/ Compute magic multiplier and shift constant for converting a 32\/64 bit\n+\/\/ division by constant into a multiply\/shift series.\n+\n+\/\/ (1) Theory:\n+\/\/ Motivated by Henry S. Warren. 2012. Hacker's Delight (2nd. ed.). Addison-Wesley Professional.\n@@ -37,2 +37,2 @@\n-Given positive integers d <= N, call v the largest integer not larger than\n-N such that v + 1 is divisible by d.\n+\/\/ Given positive integers d <= N, call v the largest integer not larger than\n+\/\/ N such that v + 1 is divisible by d.\n@@ -40,1 +40,1 @@\n-(a) For positive values c, m such that:\n+\/\/ (a) For positive values c, m such that:\n@@ -42,1 +42,1 @@\n-m <= c * d < m + m \/ v\n+\/\/ m <= c * d < m + m \/ v\n@@ -44,1 +44,1 @@\n-We have:\n+\/\/ We have:\n@@ -46,1 +46,1 @@\n-floor(x \/ d) = floor(x * c \/ m) for every integer x in [0, N]\n+\/\/ floor(x \/ d) = floor(x * c \/ m) for every integer x in [0, N]\n@@ -48,1 +48,1 @@\n-(b) For positive values c, m such that:\n+\/\/ (b) For positive values c, m such that:\n@@ -50,1 +50,1 @@\n-m < c * d <= m + m \/ v\n+\/\/ m < c * d <= m + m \/ v\n@@ -52,1 +52,1 @@\n-We have:\n+\/\/ We have:\n@@ -54,1 +54,1 @@\n-ceil(x \/ d) = floor(x * c \/ m) + 1 for every integer x in [-N, 0)\n+\/\/ ceil(x \/ d) = floor(x * c \/ m) + 1 for every integer x in [-N, 0)\n@@ -56,1 +56,1 @@\n-(2) Proof:\n+\/\/ (2) Proof:\n@@ -58,1 +58,1 @@\n-(a) The conclusion is trivial for x = 0\n+\/\/ (a) The conclusion is trivial for x = 0\n@@ -60,1 +60,1 @@\n-For 0 < x <= v\n+\/\/ For 0 < x <= v\n@@ -62,1 +62,1 @@\n-Since 1 \/ d <= c \/ m < (1 \/ d) * ((v + 1) \/ v)\n+\/\/ Since 1 \/ d <= c \/ m < (1 \/ d) * ((v + 1) \/ v)\n@@ -64,1 +64,1 @@\n-We have x \/ d <= x * c \/ m < (x * ((v + 1) \/ v)) \/ d\n+\/\/ We have x \/ d <= x * c \/ m < (x * ((v + 1) \/ v)) \/ d\n@@ -66,1 +66,1 @@\n-As a result, since x * ((v + 1) \/ v) <= x * ((x + 1) \/ x) = x + 1\n+\/\/ As a result, since x * ((v + 1) \/ v) <= x * ((x + 1) \/ x) = x + 1\n@@ -68,2 +68,2 @@\n-x \/ d <= x * c \/ m < (x + 1) \/ d, which implies floor(x \/ d) = floor(x * c \/ m) since\n-there can be no integer in (x \/ d, (x + 1) \/ d)\n+\/\/ x \/ d <= x * c \/ m < (x + 1) \/ d, which implies floor(x \/ d) = floor(x * c \/ m) since\n+\/\/ there can be no integer in (x \/ d, (x + 1) \/ d)\n@@ -71,2 +71,2 @@\n-For v + 1 <= x <= v + d - 1, since v >= d - 1, we have x <= 2v\n-As a result, x * ((v + 1) \/ v) <= x * ((x + 2) \/ x)\n+\/\/ For v + 1 <= x <= v + d - 1, since v >= d - 1, we have x <= 2v\n+\/\/ As a result, x * ((v + 1) \/ v) <= x * ((x + 2) \/ x)\n@@ -74,5 +74,5 @@\n-floor(x \/ d) = (v + 1) \/ d\n-floor(x * ((v + 1) \/ v) \/ d) <= floor(x * ((x + 2) \/ x) \/ d) = floor((x + 2) \/ d)\n-                             <= floor((v + d - 1 + 2) \/ d) = (v + 1) \/ d + 1\n-Which means (v + 1) \/ d <= floor(x * c \/ m) < (v + 1) \/ d + 1 with (v + 1) \/ d being an integer\n-This implies floor(x \/ d) = floor(x * c \/ m) for v + 1 <= x <= v + d - 1\n+\/\/ floor(x \/ d) = (v + 1) \/ d\n+\/\/ floor(x * ((v + 1) \/ v) \/ d) <= floor(x * ((x + 2) \/ x) \/ d) = floor((x + 2) \/ d)\n+\/\/                              <= floor((v + d - 1 + 2) \/ d) = (v + 1) \/ d + 1\n+\/\/ Which means (v + 1) \/ d <= floor(x * c \/ m) < (v + 1) \/ d + 1 with (v + 1) \/ d being an integer\n+\/\/ This implies floor(x \/ d) = floor(x * c \/ m) for v + 1 <= x <= v + d - 1\n@@ -80,1 +80,1 @@\n-Combining all the cases gives us the conclusion.\n+\/\/ Combining all the cases gives us the conclusion.\n@@ -82,1 +82,1 @@\n-(b) Since ceil(a \/ b) = floor((a - 1) \/ b) + 1, we need to prove:\n+\/\/ (b) Since ceil(a \/ b) = floor((a - 1) \/ b) + 1, we need to prove:\n@@ -84,1 +84,1 @@\n-floor((x - 1) \/ d) = floor(x * c \/ m)\n+\/\/ floor((x - 1) \/ d) = floor(x * c \/ m)\n@@ -86,1 +86,1 @@\n-For 0 > x >= -v\n+\/\/ For 0 > x >= -v\n@@ -88,1 +88,1 @@\n-Since 1 \/ d < c \/ m <= (1 \/ d) * ((v + 1) \/ v)\n+\/\/ Since 1 \/ d < c \/ m <= (1 \/ d) * ((v + 1) \/ v)\n@@ -90,1 +90,1 @@\n-We have x \/ d > x * c \/ m >= (x \/ d) * ((v + 1) \/ v)\n+\/\/ We have x \/ d > x * c \/ m >= (x \/ d) * ((v + 1) \/ v)\n@@ -92,3 +92,3 @@\n-since x * ((v + 1) \/ v) >= x * ((x - 1) \/ x) = x - 1\n-x \/ d > x * c \/ m >= (x - 1) \/ d, which implies floor((x - 1) \/ d) = floor(x * c \/ m) since\n-there can be no integer in ((x - 1) \/ d, x \/ d)\n+\/\/ since x * ((v + 1) \/ v) >= x * ((x - 1) \/ x) = x - 1\n+\/\/ x \/ d > x * c \/ m >= (x - 1) \/ d, which implies floor((x - 1) \/ d) = floor(x * c \/ m) since\n+\/\/ there can be no integer in ((x - 1) \/ d, x \/ d)\n@@ -96,2 +96,2 @@\n-For -v - d + 1 <= x <= -v - 1, since v >= d - 1, we have x >= -2v\n-As a result, x * ((v + 1) \/ v) >= x * ((x - 2) \/ x) = x - 2\n+\/\/ For -v - d + 1 <= x <= -v - 1, since v >= d - 1, we have x >= -2v\n+\/\/ As a result, x * ((v + 1) \/ v) >= x * ((x - 2) \/ x) = x - 2\n@@ -99,5 +99,5 @@\n-x \/ d <= (-v - 1) \/ d\n-floor((x - 1) \/ d) = (-v - 1) \/ d - 1\n-floor(x * ((v + 1) \/ v) \/ d) >= floor((x - 2) \/ d) >= (-v - d + 1 - 2) \/ d = (-v - 1) \/ d - 1\n-which means (-v - 1) \/ d >= x \/ d > x * c \/ m >= floor(x * c \/ m) >= (-v - 1) \/ d - 1\n-This implies floor((x - 1) \/ d) = floor(x * c \/ m) for -v - 1 >= x >= -v - d + 1\n+\/\/ x \/ d <= (-v - 1) \/ d\n+\/\/ floor((x - 1) \/ d) = (-v - 1) \/ d - 1\n+\/\/ floor(x * ((v + 1) \/ v) \/ d) >= floor((x - 2) \/ d) >= (-v - d + 1 - 2) \/ d = (-v - 1) \/ d - 1\n+\/\/ which means (-v - 1) \/ d >= x \/ d > x * c \/ m >= floor(x * c \/ m) >= (-v - 1) \/ d - 1\n+\/\/ This implies floor((x - 1) \/ d) = floor(x * c \/ m) for -v - 1 >= x >= -v - d + 1\n@@ -105,1 +105,1 @@\n-Combining all the cases gives us the conclusion.\n+\/\/ Combining all the cases gives us the conclusion.\n@@ -107,1 +107,1 @@\n-(3) Discussion:\n+\/\/ (3) Discussion:\n@@ -109,1 +109,1 @@\n-Let x be v, v - d + 1, -v, -v + d - 1, it can be seen that these bounds are indeed optimal\n+\/\/ Let x be v, v - d + 1, -v, -v + d - 1, it can be seen that these bounds are indeed optimal\n@@ -111,1 +111,1 @@\n-(4) Implementation:\n+\/\/ (4) Implementation:\n@@ -113,3 +113,3 @@\n-For computation efficiency, we only consider the values m = 2**s.\n-This function does not handle the cases d being a power of 2, which means\n-that c * d is never equal to m.\n+\/\/ For computation efficiency, we only consider the values m = 2**s.\n+\/\/ This function does not handle the cases d being a power of 2, which means\n+\/\/ that c * d is never equal to m.\n@@ -117,4 +117,4 @@\n-We find the value of c, m such that it satisfies the bounds for both the nonnegative\n-and negative ranges of x. This can be done by finding v_neg and v_pos and the bounds of\n-c * d - m is the intersection of (0, m \/ v_neg] and (0, m \/ v_pos). Which is (0, m \/ v_pos)\n-if v_pos >= v_neg and (0, m \/ v_neg] otherwise.\n+\/\/ We find the value of c, m such that it satisfies the bounds for both the nonnegative\n+\/\/ and negative ranges of x. This can be done by finding v_neg and v_pos and the bounds of\n+\/\/ c * d - m is the intersection of (0, m \/ v_neg] and (0, m \/ v_pos). Which is (0, m \/ v_pos)\n+\/\/ if v_pos >= v_neg and (0, m \/ v_neg] otherwise.\n@@ -122,1 +122,1 @@\n-Given v = max(v_neg, v_pos). The function inductively calculates c, rc, qv, rv such that:\n+\/\/ Given v = max(v_neg, v_pos). The function inductively calculates c, rc, qv, rv such that:\n@@ -124,3 +124,2 @@\n-c * d - rc = 2**s with 0 < rc <= d\n-qv * v + rv = 2**s with 0 <= rv < v\n-*\/\n+\/\/ c * d - rc = 2**s with 0 < rc <= d\n+\/\/ qv * v + rv = 2**s with 0 <= rv < v\n","filename":"src\/hotspot\/share\/utilities\/javaArithmetic.cpp","additions":60,"deletions":61,"binary":false,"changes":121,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-\/\/----------------------------------------------------------------------------------------------------\n+\/\/-----------------------------------------------------------------------------\n@@ -135,1 +135,1 @@\n-\/\/----------------------------------------------------------------------------------------------------\n+\/\/-----------------------------------------------------------------------------\n@@ -189,1 +189,1 @@\n-\/\/----------------------------------------------------------------------------------------------------\n+\/\/-----------------------------------------------------------------------------\n","filename":"src\/hotspot\/share\/utilities\/javaArithmetic.hpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}