{"files":[{"patch":"@@ -25,0 +25,4 @@\n+import java.util.Arrays;\n+import java.util.ArrayList;\n+import jdk.test.whitebox.code.Compiler;\n+\n@@ -32,1 +36,2 @@\n- * @run main\/othervm\/native ReplaceCriticalClassesForSubgraphs\n+ * @run main\/othervm\/native -Xbootclasspath\/a:whitebox.jar -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI\n+ *                          ReplaceCriticalClassesForSubgraphs\n@@ -42,1 +47,2 @@\n-        String tests[] = {\n+        ArrayList<String> tests = new ArrayList<>();\n+        tests.addAll(Arrays.asList(new String[] {\n@@ -51,0 +57,1 @@\n+        }));\n@@ -52,8 +59,13 @@\n-            \/\/ Tests for archived full module graph. We cannot use whitebox, which requires appending to bootclasspath.\n-            \/\/ VM will disable full module graph if bootclasspath is appended.\n-            \"-nowhitebox -early -notshared -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n-            \"-nowhitebox -early -notshared -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n-            \"-nowhitebox -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n-            \"-nowhitebox -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n-        };\n-        return tests;\n+        if (!Compiler.isJVMCIEnabled()) {\n+            \/\/ EnableJVMCI appends the jdk.internal.vm.ci module and disables full module graph.\n+            \/\/ Temporarily bypasses these tests with EnableJVMCI until JDK-8266329 is resolved.\n+            tests.addAll(Arrays.asList(new String[] {\n+                \/\/ Tests for archived full module graph. We cannot use whitebox, which requires appending to bootclasspath.\n+                \/\/ VM will disable full module graph if bootclasspath is appended.\n+                \"-nowhitebox -early -notshared -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n+                \"-nowhitebox -early -notshared -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n+                \"-nowhitebox -subgraph java\/lang\/Module jdk.internal.module.ArchivedBootLayer\",\n+                \"-nowhitebox -subgraph java\/lang\/ModuleLayer jdk.internal.module.ArchivedBootLayer\",\n+            }));\n+        }\n+        return tests.toArray(new String[0]);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/serviceability\/ReplaceCriticalClassesForSubgraphs.java","additions":22,"deletions":10,"binary":false,"changes":32,"status":"modified"}]}