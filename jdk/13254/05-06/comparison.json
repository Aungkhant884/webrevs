{"files":[{"patch":"@@ -2872,8 +2872,8 @@\n-    if (!JvmtiEnvBase::is_vthread_alive(vt)) {\n-        return true;\n-    }\n-    ContinuationWrapper c(java_lang_VirtualThread::continuation(vt));\n-    if (c.is_empty()) {\n-        return true;\n-    }\n-    assert(!c.is_mounted(), \"sanity check\");\n+  if (!JvmtiEnvBase::is_vthread_alive(vt)) {\n+    return true;\n+  }\n+  ContinuationWrapper c(java_lang_VirtualThread::continuation(vt));\n+  if (c.is_empty()) {\n+    return true;\n+  }\n+  assert(!c.is_mounted(), \"sanity check\");\n@@ -2881,4 +2881,4 @@\n-    stackChunkOop chunk = c.last_nonempty_chunk();\n-    if (chunk == nullptr || chunk->is_empty()) {\n-        return true;\n-    }\n+  stackChunkOop chunk = c.last_nonempty_chunk();\n+  if (chunk == nullptr || chunk->is_empty()) {\n+    return true;\n+  }\n@@ -2886,4 +2886,4 @@\n-    \/\/ vframes are resource allocated\n-    Thread* current_thread = Thread::current();\n-    ResourceMark rm(current_thread);\n-    HandleMark hm(current_thread);\n+  \/\/ vframes are resource allocated\n+  Thread* current_thread = Thread::current();\n+  ResourceMark rm(current_thread);\n+  HandleMark hm(current_thread);\n@@ -2891,13 +2891,6 @@\n-    StackChunkFrameStream<ChunkFrames::Mixed> fs(chunk);\n-    RegisterMap reg_map(nullptr,\n-        RegisterMap::UpdateMap::include,\n-        RegisterMap::ProcessFrames::include,\n-        RegisterMap::WalkContinuation::include);\n-    fs.initialize_register_map(&reg_map);\n-\n-    JNILocalRootsClosure blk;\n-    \/\/ JavaThread is not required for unmounted virtual threads\n-    StackRootCollector stack_collector(tag_map(), &blk, nullptr);\n-    if (!stack_collector.set_thread(vt)) {\n-        return false;\n-    }\n+  StackChunkFrameStream<ChunkFrames::Mixed> fs(chunk);\n+  RegisterMap reg_map(nullptr,\n+                      RegisterMap::UpdateMap::include,\n+                      RegisterMap::ProcessFrames::include,\n+                      RegisterMap::WalkContinuation::include);\n+  fs.initialize_register_map(&reg_map);\n@@ -2905,6 +2898,12 @@\n-    for (; !fs.is_done(); fs.next(&reg_map)) {\n-        frame fr = fs.to_frame();\n-        vframe* vf = vframe::new_vframe(&fr, &reg_map, nullptr);\n-        if (!stack_collector.do_frame(vf)) {\n-            return false;\n-        }\n+  JNILocalRootsClosure blk;\n+  \/\/ JavaThread is not required for unmounted virtual threads\n+  StackRootCollector stack_collector(tag_map(), &blk, nullptr);\n+  if (!stack_collector.set_thread(vt)) {\n+    return false;\n+  }\n+\n+  for (; !fs.is_done(); fs.next(&reg_map)) {\n+    frame fr = fs.to_frame();\n+    vframe* vf = vframe::new_vframe(&fr, &reg_map, nullptr);\n+    if (!stack_collector.do_frame(vf)) {\n+      return false;\n@@ -2912,1 +2911,2 @@\n-    return true;\n+  }\n+  return true;\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.cpp","additions":36,"deletions":36,"binary":false,"changes":72,"status":"modified"}]}