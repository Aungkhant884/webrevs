{"files":[{"patch":"@@ -223,5 +223,8 @@\n-    int fd = VMError::prepare_log_file(JVMCINativeLibraryErrorFile, LIBJVMCI_ERR_FILE, true, name_buffer, sizeof(name_buffer));\n-    if (fd != -1) {\n-      FILE* fp = os::open(fd, \"w\");\n-      if (fp != NULL) {\n-        _fatal_log_stream = new fileStream(fp);\n+    static fdStream log(-1);\n+    if (ErrorFileToStdout) {\n+      log.set_fd(1);\n+    } else if (ErrorFileToStderr) {\n+      log.set_fd(2);\n+    } else {\n+      int fd = VMError::prepare_log_file(JVMCINativeLibraryErrorFile, LIBJVMCI_ERR_FILE, true, name_buffer, sizeof(name_buffer));\n+      if (fd != -1) {\n@@ -229,0 +232,1 @@\n+        log.set_fd(fd);\n@@ -231,1 +235,1 @@\n-        tty->print(\"Can't open file to dump JVMCI shared library crash data. Error: \");\n+        tty->print(\"Can't open JVMCI shared library report file. Error: \");\n@@ -233,2 +237,4 @@\n-        tty->print_cr(\"JVMCI shared library crash data will be written to console.\");\n-        _fatal_log_stream = tty;\n+        tty->print_cr(\"JVMCI shared library report will be written to console.\");\n+\n+        \/\/ See notes in VMError::report_and_die about hard coding tty to 1\n+        log.set_fd(1);\n@@ -236,0 +242,1 @@\n+      _fatal_log_stream = &log;\n","filename":"src\/hotspot\/share\/jvmci\/jvmci.cpp","additions":15,"deletions":8,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1592,1 +1592,1 @@\n-    out.print_raw(\"#\\n# The JVMCI shared library error data is saved as:\\n# \");\n+    out.print_raw(\"#\\n# The JVMCI shared library report file is saved as:\\n# \");\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}