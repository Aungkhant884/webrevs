{"files":[{"patch":"@@ -865,0 +865,3 @@\n+    if ((!is_neg && v > max_jint) || (is_neg && -(intx)v < min_jint)) {\n+      return false;\n+    }\n@@ -867,0 +870,3 @@\n+    if (v > max_juint) {\n+      return false;\n+    }\n@@ -872,1 +878,10 @@\n-      intx_v = -intx_v;\n+      if (intx_v != min_intx) {\n+        intx_v = - intx_v;\n+        if (intx_v > 0) {\n+          return false; \/\/ underflow\n+        }\n+      }\n+    } else {\n+      if (intx_v < 0) {\n+        return false; \/\/ overflow\n+      }\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -240,0 +240,1 @@\n+  friend class LargeOptionsTest;\n","filename":"src\/hotspot\/share\/runtime\/arguments.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -0,0 +1,110 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+#include \"precompiled.hpp\"\n+#include \"compiler\/compiler_globals.hpp\"\n+#include \"runtime\/arguments.hpp\"\n+#include \"runtime\/flags\/jvmFlag.hpp\"\n+#include \"runtime\/globals.hpp\"\n+#include \"unittest.hpp\"\n+\n+class LargeOptionsTest : public ::testing::Test {\n+public:\n+  static bool test_option_value(const char* option, intx value) {\n+    char buffer[100];\n+    UnlockDiagnosticVMOptions = true;\n+    os::snprintf(buffer, 100, \"%s=\" INTX_FORMAT, option, value);\n+    return Arguments::parse_argument(buffer, JVMFlagOrigin::COMMAND_LINE);\n+  }\n+\n+  static bool test_option_value(const char* option) {\n+    UnlockDiagnosticVMOptions = true;\n+    return Arguments::parse_argument(option, JVMFlagOrigin::COMMAND_LINE);\n+  }\n+};\n+\n+\n+\/\/ CompilerDirectivesLimit is a diagnostic int option.\n+TEST_VM(LARGE_OPTION, large_ints) {\n+  for (intx x = max_jint - 1; x <= (intx)max_jint + 1; x++) {\n+    bool result = LargeOptionsTest::test_option_value(\"CompilerDirectivesLimit\", x);\n+    if (x > max_jint) {\n+      ASSERT_FALSE(result);\n+    } else {\n+      ASSERT_TRUE(result);\n+      ASSERT_EQ(CompilerDirectivesLimit, x);\n+    }\n+  }\n+}\n+\n+\n+TEST_VM(LARGE_OPTION, small_ints) {\n+  for (intx x = min_jint + 1; x >= (intx)min_jint - 1; x--) {\n+    bool result = LargeOptionsTest::test_option_value(\"CompilerDirectivesLimit\", x);\n+    if (x < min_jint) {\n+      ASSERT_FALSE(result);\n+    } else {\n+      ASSERT_TRUE(result);\n+      ASSERT_EQ(CompilerDirectivesLimit, x);\n+    }\n+  }\n+}\n+\n+\n+TEST_VM(LARGE_OPTION, large_int_overflow) { \/\/ Test 0x100000000\n+  ASSERT_FALSE(LargeOptionsTest::test_option_value(\"CompilerDirectivesLimit\", 4294967296));\n+}\n+\n+\n+\/\/ HandshakeTimeout is a diagnostic uint option.\n+TEST_VM(LARGE_OPTION, large_uints) {\n+  for (uintx x = max_juint - 1; x <= (uintx)max_juint + 1; x++) {\n+    bool result = LargeOptionsTest::test_option_value(\"HandshakeTimeout\", x);\n+    if (x <= max_juint) {\n+      ASSERT_TRUE(result);\n+      ASSERT_EQ(HandshakeTimeout, x);\n+    } else {\n+      ASSERT_FALSE(result);\n+    }\n+  }\n+}\n+\n+\n+\/\/ MaxJNILocalCapacity is an intx option.\n+TEST_VM(LARGE_OPTION, large_intxs) {\n+  \/\/ max_intx + 1 equals min_intx!\n+  for (julong x = max_intx - 1; x <= (julong)max_intx + 1; x++) {\n+    ASSERT_TRUE(LargeOptionsTest::test_option_value(\"MaxJNILocalCapacity\", x));\n+    ASSERT_EQ((julong)MaxJNILocalCapacity, x);\n+  }\n+}\n+\n+\n+TEST_VM(LARGE_OPTION, small_intxs) {\n+  ASSERT_TRUE(LargeOptionsTest::test_option_value(\"MaxJNILocalCapacity\", min_intx + 1));\n+  ASSERT_EQ(MaxJNILocalCapacity, -9223372036854775807);\n+  ASSERT_TRUE(LargeOptionsTest::test_option_value(\"MaxJNILocalCapacity\", min_intx));\n+  ASSERT_EQ(MaxJNILocalCapacity, min_intx);\n+  \/\/ Test value that's less than min_intx (-0x8000000000000001).\n+  ASSERT_FALSE(LargeOptionsTest::test_option_value(\"MaxJNILocalCapacity=-9223372036854775809\"));\n+}\n","filename":"test\/hotspot\/gtest\/runtime\/test_largeOptions.cpp","additions":110,"deletions":0,"binary":false,"changes":110,"status":"added"},{"patch":"@@ -118,9 +118,6 @@\n-    \/\/ and setting ParallelGCThreads=4294967296 should give back 0. (SerialGC is ok with ParallelGCThreads=0)\n-    for (long i = 4294967295L; i <= 4294967296L; i++) {\n-      long count = getParallelGCThreadCount(\n-          \"-XX:+UseSerialGC\",\n-          \"-XX:ParallelGCThreads=\" + i,\n-          \"-XX:+PrintFlagsFinal\",\n-          \"-version\");\n-      Asserts.assertEQ(count, i % 4294967296L, \"Specifying ParallelGCThreads=\" + i + \" does not set the thread count properly!\");\n-    }\n+    long count = getParallelGCThreadCount(\n+        \"-XX:+UseSerialGC\",\n+        \"-XX:ParallelGCThreads=4294967295\",\n+        \"-XX:+PrintFlagsFinal\",\n+        \"-version\");\n+    Asserts.assertEQ(count, 4294967295L, \"Specifying ParallelGCThreads=4294967295 does not set the thread count properly!\");\n","filename":"test\/hotspot\/jtreg\/gc\/arguments\/TestParallelGCThreads.java","additions":6,"deletions":9,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -294,1 +294,1 @@\n-                    \"-XX:StressSeed=\" + Math.abs(rng.nextLong()),\n+                    \"-XX:StressSeed=\" + Math.abs(rng.nextInt()),\n","filename":"test\/hotspot\/jtreg\/testlibrary\/ctw\/src\/sun\/hotspot\/tools\/ctw\/CtwRunner.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}