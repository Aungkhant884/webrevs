{"files":[{"patch":"@@ -570,1 +570,3 @@\n-    counters = MethodCounters::allocate(mh, THREAD);\n+    \/\/ Use the TRAPS version for a JavaThread so it will adjust the GC threshold\n+    \/\/ if needed.\n+    counters = MethodCounters::allocate_with_exception(mh, THREAD);\n@@ -572,4 +574,1 @@\n-      CLEAR_PENDING_EXCEPTION;  \/\/ MethodData above doesn't clear exception\n-      CompileBroker::log_metaspace_failure();\n-      ClassLoaderDataGraph::set_metaspace_oom(true);\n-      return NULL;\n+      CLEAR_PENDING_EXCEPTION;\n@@ -580,6 +579,1 @@\n-    counters = MethodCounters::allocate(mh);\n-    if (counters == NULL) {\n-      CompileBroker::log_metaspace_failure();\n-      ClassLoaderDataGraph::set_metaspace_oom(true);\n-      return NULL;\n-    }\n+    counters = MethodCounters::allocate_no_exception(mh);\n@@ -587,0 +581,7 @@\n+\n+  if (counters == NULL) {\n+    CompileBroker::log_metaspace_failure();\n+    ClassLoaderDataGraph::set_metaspace_oom(true);\n+    return NULL;\n+  }\n+\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":12,"deletions":11,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -58,1 +58,1 @@\n-MethodCounters* MethodCounters::allocate(const methodHandle& mh) {\n+MethodCounters* MethodCounters::allocate_no_exception(const methodHandle& mh) {\n@@ -63,1 +63,1 @@\n-MethodCounters* MethodCounters::allocate(const methodHandle& mh, TRAPS) {\n+MethodCounters* MethodCounters::allocate_with_exception(const methodHandle& mh, TRAPS) {\n","filename":"src\/hotspot\/share\/oops\/methodCounters.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -72,2 +72,2 @@\n-  static MethodCounters* allocate(const methodHandle& mh);\n-  static MethodCounters* allocate(const methodHandle& mh, TRAPS);\n+  static MethodCounters* allocate_no_exception(const methodHandle& mh);\n+  static MethodCounters* allocate_with_exception(const methodHandle& mh, TRAPS);\n","filename":"src\/hotspot\/share\/oops\/methodCounters.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}