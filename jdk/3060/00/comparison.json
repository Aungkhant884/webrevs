{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,1 @@\n-    native static void enableEv();\n+    native static void enableEv(Thread notifyFramePopThread);\n@@ -58,1 +58,1 @@\n-        enableEv();\n+        enableEv(Thread.currentThread());\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/SetEventNotificationMode\/setnotif001.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,0 +41,1 @@\n+static jobject notifyFramePopThread = NULL;\n@@ -191,11 +192,3 @@\n-        err = jvmti_env->IsMethodNative(method, &isNative);\n-        if (err != JVMTI_ERROR_NONE) {\n-            result = STATUS_FAILED;\n-            printf(\"(IsMethodNative) unexpected error: %s (%d)\\n\",\n-                   TranslateError(err), err);\n-        }\n-        if (isNative == JNI_FALSE) {\n-            err = jvmti_env->NotifyFramePop(thr, 0);\n-            if (err == JVMTI_ERROR_NONE) {\n-                enable(jvmti_env, JVMTI_EVENT_FRAME_POP);\n-            } else {\n+        if (env->IsSameObject(notifyFramePopThread, thr)) {\n+            err = jvmti_env->IsMethodNative(method, &isNative);\n+            if (err != JVMTI_ERROR_NONE) {\n@@ -203,1 +196,1 @@\n-                printf(\"(NotifyFramePop) unexpected error: %s (%d)\\n\",\n+                printf(\"(IsMethodNative) unexpected error: %s (%d)\\n\",\n@@ -206,0 +199,13 @@\n+            if (isNative == JNI_FALSE) {\n+                err = jvmti_env->NotifyFramePop(thr, 0);\n+                if (err == JVMTI_ERROR_NONE) {\n+                    enable(jvmti_env, JVMTI_EVENT_FRAME_POP);\n+                } else {\n+                    result = STATUS_FAILED;\n+                    printf(\"(NotifyFramePop) unexpected error: %s (%d)\\n\",\n+                           TranslateError(err), err);\n+                }\n+            }\n+            enable(jvmti_env, JVMTI_EVENT_CLASS_LOAD);\n+            enable(jvmti_env, JVMTI_EVENT_CLASS_PREPARE);\n+            disable(jvmti_env, JVMTI_EVENT_METHOD_ENTRY);\n@@ -207,3 +213,0 @@\n-        enable(jvmti_env, JVMTI_EVENT_CLASS_LOAD);\n-        enable(jvmti_env, JVMTI_EVENT_CLASS_PREPARE);\n-        disable(jvmti_env, JVMTI_EVENT_METHOD_ENTRY);\n@@ -395,1 +398,1 @@\n-        jclass cls) {\n+        jclass cls, jobject framePopThread) {\n@@ -397,0 +400,1 @@\n+    notifyFramePopThread = env->NewGlobalRef(framePopThread);\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/jvmti\/SetEventNotificationMode\/setnotif001\/setnotif001.cpp","additions":21,"deletions":17,"binary":false,"changes":38,"status":"modified"}]}