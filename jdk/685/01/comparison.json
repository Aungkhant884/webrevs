{"files":[{"patch":"@@ -309,1 +309,1 @@\n-    elif test \"x$OPENJDK_TARGET_OS-$OPENJDK_TARGET_CPU\" = \"xlinux-aarch64\"; then\n+    elif test \"x$OPENJDK_TARGET_CPU\" = \"xaarch64\"; then\n@@ -343,1 +343,1 @@\n-    elif test \"x$OPENJDK_TARGET_OS-$OPENJDK_TARGET_CPU\" = \"xlinux-aarch64\"; then\n+    elif test \"x$OPENJDK_TARGET_CPU\" = \"xaarch64\"; then\n","filename":"make\/autoconf\/jvm-features.m4","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -125,1 +125,5 @@\n-        return new AArch64HotSpotRegisterConfig(target, config.useCompressedOops);\n+        \/\/ ARMv8 defines r18 as being available to the platform ABI. Windows\n+        \/\/ and Darwin use it for such. Linux doesn't assign it and thus r18 can\n+        \/\/ be used as an additional register.\n+        boolean canUsePlatformRegister = config.linuxOs;\n+        return new AArch64HotSpotRegisterConfig(target, config.useCompressedOops, canUsePlatformRegister);\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot.aarch64\/src\/jdk\/vm\/ci\/hotspot\/aarch64\/AArch64HotSpotJVMCIBackendFactory.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+import static jdk.vm.ci.aarch64.AArch64.r18;\n@@ -125,0 +126,6 @@\n+    \/**\n+     * The platform ABI can use r18 to carry inter-procedural state (e.g. thread\n+     * context). If not defined as such by the platform ABI, it can be used as\n+     * additional temporary register.\n+     *\/\n+    public static final Register platformRegister = r18;\n@@ -131,1 +138,1 @@\n-    private static RegisterArray initAllocatable(Architecture arch, boolean reserveForHeapBase) {\n+    private static RegisterArray initAllocatable(Architecture arch, boolean reserveForHeapBase, boolean canUsePlatformRegister) {\n@@ -133,1 +140,1 @@\n-        Register[] registers = new Register[allRegisters.size() - reservedRegisters.size() - (reserveForHeapBase ? 1 : 0)];\n+        Register[] registers = new Register[allRegisters.size() - reservedRegisters.size() - (reserveForHeapBase ? 1 : 0) - (!canUsePlatformRegister ? 1 : 0)];\n@@ -142,0 +149,3 @@\n+            if (!canUsePlatformRegister && reg.equals(platformRegister)) {\n+                continue;\n+            }\n@@ -155,2 +165,2 @@\n-    public AArch64HotSpotRegisterConfig(TargetDescription target, boolean useCompressedOops) {\n-        this(target, initAllocatable(target.arch, useCompressedOops));\n+    public AArch64HotSpotRegisterConfig(TargetDescription target, boolean useCompressedOops, boolean canUsePlatformRegister) {\n+        this(target, initAllocatable(target.arch, useCompressedOops, canUsePlatformRegister));\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot.aarch64\/src\/jdk\/vm\/ci\/hotspot\/aarch64\/AArch64HotSpotRegisterConfig.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"}]}