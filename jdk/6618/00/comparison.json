{"files":[{"patch":"@@ -53,3 +53,0 @@\n-  _shutdown(\"shutdown\", \"request runtime to shutdown itself and free the \" \\\n-            \"memory used by runtime.\",\n-            \"BOOLEAN\", false, \"false\"),\n@@ -65,1 +62,0 @@\n-  _dcmdparser.add_dcmd_option(&_shutdown);\n@@ -82,3 +78,0 @@\n-  } else if (MemTracker::tracking_level() == NMT_minimal) {\n-     output()->print_cr(\"Native memory tracking has been shutdown\");\n-     return;\n@@ -100,1 +93,0 @@\n-  if (_shutdown.is_set() && _shutdown.value()) { ++nopt; }\n@@ -105,1 +97,1 @@\n-        \"summary, detail, metadata, baseline, summary.diff, detail.diff, shutdown\");\n+        \"summary, detail, metadata, baseline, summary.diff, detail.diff\");\n@@ -150,3 +142,0 @@\n-  } else if (_shutdown.value()) {\n-    MemTracker::shutdown();\n-    output()->print_cr(\"Native memory tracking has been turned off\");\n","filename":"src\/hotspot\/share\/services\/nmtDCmd.cpp","additions":1,"deletions":12,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -45,1 +45,0 @@\n-  DCmdArgument<bool>  _shutdown;\n","filename":"src\/hotspot\/share\/services\/nmtDCmd.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,0 @@\n-    jcmdCommand(\"shutdown\");\n","filename":"test\/hotspot\/jtreg\/runtime\/NMT\/JcmdWithNMTDisabled.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1,59 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @summary Run shutdown twice\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @run main\/othervm -XX:NativeMemoryTracking=detail ShutdownTwice\n- *\/\n-\n-import jdk.test.lib.process.ProcessTools;\n-import jdk.test.lib.process.OutputAnalyzer;\n-import jdk.test.lib.JDKToolFinder;\n-\n-public class ShutdownTwice {\n-\n-  public static void main(String args[]) throws Exception {\n-    \/\/ Grab my own PID\n-    String pid = Long.toString(ProcessTools.getProcessId());\n-    OutputAnalyzer output;\n-\n-    ProcessBuilder pb = new ProcessBuilder();\n-\n-    \/\/ Run 'jcmd <pid> VM.native_memory shutdown'\n-    pb.command(new String[] { JDKToolFinder.getJDKTool(\"jcmd\"), pid, \"VM.native_memory\", \"shutdown\"});\n-    output = new OutputAnalyzer(pb.start());\n-\n-    \/\/ Verify that jcmd reports that NMT is shutting down\n-    output.shouldContain(\"Native memory tracking has been turned off\");\n-\n-    \/\/ Run shutdown again\n-    output = new OutputAnalyzer(pb.start());\n-\n-    \/\/ Verify that jcmd reports that NMT has been shutdown already\n-    output.shouldContain(\"Native memory tracking has been shutdown\");\n-  }\n-}\n","filename":"test\/hotspot\/jtreg\/runtime\/NMT\/ShutdownTwice.java","additions":0,"deletions":59,"binary":false,"changes":59,"status":"deleted"},{"patch":"@@ -1,59 +0,0 @@\n-\/*\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-\/*\n- * @test\n- * @summary Verify that jcmd correctly reports that NMT is not enabled after a shutdown\n- * @library \/test\/lib\n- * @modules java.base\/jdk.internal.misc\n- *          java.management\n- * @run main\/othervm -XX:NativeMemoryTracking=detail SummaryAfterShutdown\n- *\/\n-\n-import jdk.test.lib.process.ProcessTools;\n-import jdk.test.lib.process.OutputAnalyzer;\n-import jdk.test.lib.JDKToolFinder;\n-\n-public class SummaryAfterShutdown {\n-\n-  public static void main(String args[]) throws Exception {\n-    OutputAnalyzer output;\n-    \/\/ Grab my own PID\n-    String pid = Long.toString(ProcessTools.getProcessId());\n-    ProcessBuilder pb = new ProcessBuilder();\n-\n-    \/\/ Run 'jcmd <pid> VM.native_memory shutdown'\n-    pb.command(new String[] { JDKToolFinder.getJDKTool(\"jcmd\"), pid, \"VM.native_memory\", \"shutdown\"});\n-    output = new OutputAnalyzer(pb.start());\n-\n-    \/\/ Verify that jcmd reports that NMT is shutting down\n-    output.shouldContain(\"Native memory tracking has been turned off\");\n-\n-    \/\/ Run 'jcmd <pid> VM.native_memory summary'\n-    pb.command(new String[] { JDKToolFinder.getJDKTool(\"jcmd\"), pid, \"VM.native_memory\", \"summary\"});\n-    output = new OutputAnalyzer(pb.start());\n-\n-    \/\/ Verify that jcmd reports that NMT has been shutdown\n-    output.shouldContain(\"Native memory tracking has been shutdown\");\n-  }\n-}\n","filename":"test\/hotspot\/jtreg\/runtime\/NMT\/SummaryAfterShutdown.java","additions":0,"deletions":59,"binary":false,"changes":59,"status":"deleted"}]}