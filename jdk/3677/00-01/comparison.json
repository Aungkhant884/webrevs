{"files":[{"patch":"@@ -2541,0 +2541,1 @@\n+  Label L_NOT_DOUBLE2;\n@@ -2545,0 +2546,1 @@\n+  static double DOUBLE2 = 2.0;\n@@ -2552,0 +2554,9 @@\n+\n+  \/\/ Special case: pow(x, 2.0) => x * x\n+  ucomisd(xmm1, ExternalAddress((address) &DOUBLE2));\n+  jccb(Assembler::notEqual, L_NOT_DOUBLE2);\n+  jccb(Assembler::parity, L_NOT_DOUBLE2);\n+  mulsd(xmm0, xmm0);\n+  jmp(L_2TAG_PACKET_21_0_2);\n+\n+  bind(L_NOT_DOUBLE2);\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86_pow.cpp","additions":11,"deletions":0,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -1642,1 +1642,0 @@\n-#if !(defined(X86) && !defined(_LP64)) \/\/ excludes x86_32\n@@ -1647,1 +1646,0 @@\n-#endif\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,2 @@\n+ * @run main\/othervm TestPow2Opt\n+ * @run main\/othervm -Xint TestPow2Opt\n@@ -34,2 +36,6 @@\n-  static double test(double a) {\n-    return Math.pow(a, 2.0);\n+  static void test(double a) {\n+    double r1 = a * a;\n+    double r2 = Math.pow(a, 2.0);\n+    if (r1 != r2) {\n+      throw new RuntimeException(\"pow(\" + a + \", 2.0), expected: \" + r1 + \", actual: \" + r2);\n+    }\n@@ -39,14 +45,5 @@\n-    \/\/ v1: value returned by the interpreter\n-    double v1 = test(1.0 \/ 2047);\n-\n-    \/\/ Warmup\n-    double sum = 0.0;\n-    for (int i = 1; i < 100000; i++) {\n-      sum += test(i + 0.0);\n-    }\n-\n-    \/\/ v2: value returned by the compiler\n-    double v2 = test(1.0 \/ 2047);\n-\n-    if (v1 != v2) {\n-      throw new RuntimeException(\"v1 should be equal to v2, actual: \" + \"v1 = \" + v1 + \" v2 = \" + v2);\n+    for (int i = 0; i < 10; i++) {\n+      for (int j = 1; j < 100000; j++) {\n+        test(j * 1.0);\n+        test(1.0 \/ j);\n+      }\n@@ -54,2 +51,0 @@\n-\n-    System.out.println(sum);\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/math\/TestPow2Opt.java","additions":13,"deletions":18,"binary":false,"changes":31,"status":"modified"}]}