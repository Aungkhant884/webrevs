{"files":[{"patch":"@@ -212,2 +212,5 @@\n-    if (!FLAG_IS_DEFAULT(SharedArchiveFile)) {\n-      base_archive_name_size = strlen(Arguments::GetSharedArchivePath()) + 1;\n+\n+    const char* default_base_archive_name = Arguments::get_default_shared_archive_path();\n+    const char* current_base_archive_name = Arguments::GetSharedArchivePath();\n+    if (!os::same_files(current_base_archive_name, default_base_archive_name)) {\n+      base_archive_name_size = strlen(current_base_archive_name) + 1;\n@@ -217,0 +220,1 @@\n+    FREE_C_HEAP_ARRAY(const char, default_base_archive_name);\n@@ -304,1 +308,1 @@\n-  st->print_cr(\"- version:                        %d\", version());\n+  st->print_cr(\"- version:                        0x%x\", version());\n@@ -1154,1 +1158,1 @@\n-      FileMapInfo::fail_continue(\"Cannot handle shared archive file version %d. Must be at least %d\",\n+      FileMapInfo::fail_continue(\"Cannot handle shared archive file version 0x%x. Must be at least 0x%x.\",\n@@ -1160,2 +1164,2 @@\n-      FileMapInfo::fail_continue(\"The shared archive file version %d does not match the required version %d\",\n-                                    gen_header._version, CURRENT_CDS_ARCHIVE_VERSION);\n+      FileMapInfo::fail_continue(\"The shared archive file version 0x%x does not match the required version 0x%x.\",\n+                                 gen_header._version, CURRENT_CDS_ARCHIVE_VERSION);\n@@ -1335,2 +1339,2 @@\n-    log_info(cds)(\"_version expected: %d\", CURRENT_CDS_ARCHIVE_VERSION);\n-    log_info(cds)(\"           actual: %d\", header()->version());\n+    log_info(cds)(\"_version expected: 0x%x\", CURRENT_CDS_ARCHIVE_VERSION);\n+    log_info(cds)(\"           actual: 0x%x\", header()->version());\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":12,"deletions":8,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -64,1 +64,1 @@\n-\/\/ _version >= CDS_GENERIC_HEADER_SUPPORTED_MIN_VERSION (12).\n+\/\/ _version >= CDS_GENERIC_HEADER_SUPPORTED_MIN_VERSION (13).\n","filename":"src\/hotspot\/share\/include\/cds.h","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -100,0 +100,4 @@\n+    private static String hex(int version) {\n+        return String.format(\"0x%x\", version);\n+    }\n+\n@@ -192,1 +196,1 @@\n-        output.shouldContain(\"The shared archive file version \" + version + \" does not match the required version \" + currentCDSArchiveVersion);\n+        output.shouldContain(\"The shared archive file version \" + hex(version) + \" does not match the required version \" + hex(currentCDSArchiveVersion));\n@@ -203,1 +207,1 @@\n-        output.shouldContain(\"Cannot handle shared archive file version \" + version + \". Must be at least \" + genericHeaderMinVersion);\n+        output.shouldContain(\"Cannot handle shared archive file version \" + hex(version) + \". Must be at least \" + hex(genericHeaderMinVersion));\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/SharedArchiveConsistency.java","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -154,0 +154,4 @@\n+    private static String hex(int version) {\n+        return String.format(\"0x%x\", version);\n+    }\n+\n@@ -306,1 +310,1 @@\n-                      .shouldContain(\"Cannot handle shared archive file version \" + version1 + \". Must be at least \" + genericHeaderMinVersion)\n+                      .shouldContain(\"Cannot handle shared archive file version \" + hex(version1) + \". Must be at least \" + hex(genericHeaderMinVersion))\n@@ -334,1 +338,1 @@\n-                      .shouldContain(\"The shared archive file version \" + version2 + \" does not match the required version \" + currentCDSVersion)\n+                      .shouldContain(\"The shared archive file version \" + hex(version2) + \" does not match the required version \" + hex(currentCDSVersion))\n@@ -526,1 +530,1 @@\n-                       .shouldContain(\"Cannot handle shared archive file version \" + version1)\n+                       .shouldContain(\"Cannot handle shared archive file version \" + hex(version1))\n@@ -551,1 +555,1 @@\n-                 output.shouldContain(\"The shared archive file version \" + version2 + \" does not match the required version \" + currentCDSVersion)\n+                 output.shouldContain(\"The shared archive file version \" + hex(version2) + \" does not match the required version \" + hex(currentCDSVersion))\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/TestAutoCreateSharedArchive.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"}]}