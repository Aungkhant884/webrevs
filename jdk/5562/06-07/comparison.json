{"files":[{"patch":"@@ -114,1 +114,1 @@\n-  product(ccstr, OnSpinWaitImpl, \"none\",                                \\\n+  product(ccstr, OnSpinWaitInst, \"none\",                                \\\n@@ -116,1 +116,4 @@\n-          \"Options: none, Nnop, Nisb, Nyield, where optional N is 2..9.\")\n+          \"Options: none, nop, isb, yield.\")                            \\\n+  product(uint, OnSpinWaitInstCount, 1,                                 \\\n+          \"Use a number of OnSpinWaitInst.\")                            \\\n+          range(1, 99)\n","filename":"src\/hotspot\/cpu\/aarch64\/globals_aarch64.hpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -52,8 +52,8 @@\n-  const char *s = OnSpinWaitImpl;\n-  unsigned int count = 1;\n-  if (isdigit(*s)) {\n-    count = *s - '0';\n-    if (count == 0) {\n-      vm_exit_during_initialization(\"Invalid value for OnSpinWaitImpl: zero instruction count\", OnSpinWaitImpl);\n-    }\n-    s += 1;\n+  if (strcmp(OnSpinWaitInst, \"nop\") == 0) {\n+    return SpinWait(SpinWait::NOP, OnSpinWaitInstCount);\n+  } else if (strcmp(OnSpinWaitInst, \"isb\") == 0) {\n+    return SpinWait(SpinWait::ISB, OnSpinWaitInstCount);\n+  } else if (strcmp(OnSpinWaitInst, \"yield\") == 0) {\n+    return SpinWait(SpinWait::YIELD, OnSpinWaitInstCount);\n+  } else if (strcmp(OnSpinWaitInst, \"none\") != 0) {\n+    vm_exit_during_initialization(\"The options for OnSpinWaitInst are nop, isb, yield, and none\", OnSpinWaitInst);\n@@ -61,8 +61,3 @@\n-  if (strcmp(s, \"nop\") == 0) {\n-    return SpinWait(SpinWait::NOP, count);\n-  } else if (strcmp(s, \"isb\") == 0) {\n-    return SpinWait(SpinWait::ISB, count);\n-  } else if (strcmp(s, \"yield\") == 0) {\n-    return SpinWait(SpinWait::YIELD, count);\n-  } else if (strcmp(s, \"none\") != 0) {\n-    vm_exit_during_initialization(\"Invalid value for OnSpinWaitImpl\", OnSpinWaitImpl);\n+\n+  if (!FLAG_IS_DEFAULT(OnSpinWaitInstCount) && OnSpinWaitInstCount > 0) {\n+    vm_exit_during_initialization(\"OnSpinWaitInstCount cannot be used for OnSpinWaitInst 'none'\");\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":11,"deletions":16,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @summary Checks that java.lang.Thread.onSpinWait is intrinsified with instructions specified in '-XX:OnSpinWaitImpl'\n+ * @summary Checks that java.lang.Thread.onSpinWait is intrinsified with instructions specified with '-XX:OnSpinWaitInst' and '-XX:OnSpinWaitInstCount'\n@@ -33,6 +33,6 @@\n- * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c2 7 nop\n- * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c2 3 isb\n- * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c2 1 yield\n- * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c1 7 nop\n- * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c1 3 isb\n- * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c1 1 yield\n+ * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c2 nop 7\n+ * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c2 isb 3\n+ * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c2 yield 1\n+ * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c1 nop 7\n+ * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c1 isb 3\n+ * @run driver compiler.onSpinWait.TestOnSpinWaitAArch64 c1 yield\n@@ -52,2 +52,2 @@\n-        String spinWaitInstCount = args[1];\n-        String spinWaitInst = args[2];\n+        String spinWaitInst = args[1];\n+        String spinWaitInstCount = (args.length == 3) ? args[2] : \"1\";\n@@ -69,1 +69,2 @@\n-        command.add(\"-XX:OnSpinWaitImpl=\" + spinWaitInstCount + spinWaitInst);\n+        command.add(\"-XX:OnSpinWaitInst=\" + spinWaitInst);\n+        command.add(\"-XX:OnSpinWaitInstCount=\" + spinWaitInstCount);\n","filename":"test\/hotspot\/jtreg\/compiler\/onSpinWait\/TestOnSpinWaitAArch64.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @summary Checks that java.lang.Thread.onSpinWait is not intrinsified when '-XX:OnSpinWaitImpl=none' is used\n+ * @summary Checks that java.lang.Thread.onSpinWait is not intrinsified when '-XX:OnSpinWaitInst=none' is used\n@@ -53,1 +53,1 @@\n-        command.add(\"-XX:OnSpinWaitImpl=none\");\n+        command.add(\"-XX:OnSpinWaitInst=none\");\n","filename":"test\/hotspot\/jtreg\/compiler\/onSpinWait\/TestOnSpinWaitNoneAArch64.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}