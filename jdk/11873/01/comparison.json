{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -2995,1 +2995,1 @@\n-    directByteBufferConstructor = env->GetMethodID(directByteBufferClass, \"<init>\", \"(JI)V\");\n+    directByteBufferConstructor = env->GetMethodID(directByteBufferClass, \"<init>\", \"(JJ)V\");\n@@ -3047,4 +3047,1 @@\n-  \/\/ NOTE that package-private DirectByteBuffer constructor currently\n-  \/\/ takes int capacity\n-  jint  cap  = (jint)  capacity;\n-  jobject ret = env->NewObject(directByteBufferClass, directByteBufferConstructor, addr, cap);\n+  jobject ret = env->NewObject(directByteBufferClass, directByteBufferConstructor, addr, capacity);\n","filename":"src\/hotspot\/share\/prims\/jni.cpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -181,0 +181,1 @@\n+    \/\/ The long-valued capacity is restricted to int range.\n@@ -182,2 +183,2 @@\n-    private Direct$Type$Buffer(long addr, int cap) {\n-        super(-1, 0, cap, cap, null);\n+    private Direct$Type$Buffer(long addr, long cap) {\n+        super(-1, 0, clampCapacity(cap), clampCapacity(cap), null);\n@@ -242,0 +243,11 @@\n+    \/\/ Constrain the capacity to int range throwing IAE if not possible\n+    \/\/\n+    private static int clampCapacity(long capacity) {\n+        try {\n+            return Math.toIntExact(capacity);\n+        } catch (ArithmeticException ignore) {\n+            throw new IllegalArgumentException(\"capacity \" + capacity +\n+                \" in upcall from JNI NewDirectByteBuffer overflows int range\");\n+        }\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/nio\/Direct-X-Buffer.java.template","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"}]}