{"files":[{"patch":"@@ -107,2 +107,44 @@\n-    \/*\n-     * Private constructor which uses a byte array to construct the new UUID.\n+    \/**\n+     * Constructs new {@code UUID} from the given {@code bytes}.\n+     * <p>\n+     * The {@link #version()} is set to the given {@code version} and the\n+     * {@link #variant()} is <strong>always<\/strong> set to RFC&nbsp;4122.\n+     *\n+     * @param bytes   to construct the {@code UUID} from.\n+     * @param version to set for this {@code UUID}.\n+     * @throws AssertionError if {@code bytes} is not of length 16.\n+     * @since 16\n+     *\/\n+    private UUID(final byte[] bytes, final int version) {\n+        assert bytes.length == 16 : \"UUID bytes must be exactly of length 16, got: \" + bytes.length;\n+\n+        long msb = (long) (bytes[0]  & 0xFF) << 56;\n+        msb     |= (long) (bytes[1]  & 0xFF) << 48;\n+        msb     |= (long) (bytes[2]  & 0xFF) << 40;\n+        msb     |= (long) (bytes[3]  & 0xFF) << 32;\n+        msb     |= (long) (bytes[4]  & 0xFF) << 24;\n+        msb     |= (long) (bytes[5]  & 0xFF) << 16;\n+        msb     |= (long) (bytes[6]  & 0x0F | version) << 8;\n+        msb     |=         bytes[7]  & 0xFF;\n+        this.mostSigBits = msb;\n+\n+        long lsb = (long) (bytes[8]  & 0x3F | 0x80) << 56;\n+        lsb     |= (long) (bytes[9]  & 0xFF) << 48;\n+        lsb     |= (long) (bytes[10] & 0xFF) << 40;\n+        lsb     |= (long) (bytes[11] & 0xFF) << 32;\n+        lsb     |= (long) (bytes[12] & 0xFF) << 24;\n+        lsb     |= (long) (bytes[13] & 0xFF) << 16;\n+        lsb     |= (long) (bytes[14] & 0xFF) << 8;\n+        lsb     |=         bytes[15] & 0xFF;\n+        this.leastSigBits = lsb;\n+    }\n+\n+    \/**\n+     * Constructs a new {@code UUID} from the given {@code bytes}.\n+     * <p>\n+     * It is impossible to verify if the given data is a <em>valid<\/em> UUID\n+     * according to RFC&nbsp;4122 or just 16 random bytes.\n+     *\n+     * @param bytes to construct the {@code UUID} from.\n+     * @throws IllegalArgumentException if {@code bytes} is not of length 16.\n+     * @since 16\n@@ -110,1 +152,6 @@\n-    private UUID(byte[] data) {\n+    public UUID(final byte[] bytes) {\n+        if (bytes.length != 16) {\n+            throw new IllegalArgumentException(\"UUID bytes must be exactly of length 16, got: \" + bytes.length);\n+        }\n+\n+        int i = 0;\n@@ -113,5 +160,2 @@\n-        assert data.length == 16 : \"data must be 16 bytes in length\";\n-        for (int i=0; i<8; i++)\n-            msb = (msb << 8) | (data[i] & 0xff);\n-        for (int i=8; i<16; i++)\n-            lsb = (lsb << 8) | (data[i] & 0xff);\n+        for (; i <  8; ++i) msb = (msb << 8) | (bytes[i] & 0xFF);\n+        for (; i < 16; ++i) lsb = (lsb << 8) | (bytes[i] & 0xFF);\n@@ -148,9 +192,3 @@\n-        SecureRandom ng = Holder.numberGenerator;\n-\n-        byte[] randomBytes = new byte[16];\n-        ng.nextBytes(randomBytes);\n-        randomBytes[6]  &= 0x0f;  \/* clear version        *\/\n-        randomBytes[6]  |= 0x40;  \/* set to version 4     *\/\n-        randomBytes[8]  &= 0x3f;  \/* clear variant        *\/\n-        randomBytes[8]  |= 0x80;  \/* set to IETF variant  *\/\n-        return new UUID(randomBytes);\n+        final byte[] bytes = new byte[16];\n+        Holder.numberGenerator.nextBytes(bytes);\n+        return new UUID(bytes, 0x40);\n@@ -169,1 +207,1 @@\n-        MessageDigest md;\n+        final MessageDigest md;\n@@ -175,6 +213,1 @@\n-        byte[] md5Bytes = md.digest(name);\n-        md5Bytes[6]  &= 0x0f;  \/* clear version        *\/\n-        md5Bytes[6]  |= 0x30;  \/* set to version 3     *\/\n-        md5Bytes[8]  &= 0x3f;  \/* clear variant        *\/\n-        md5Bytes[8]  |= 0x80;  \/* set to IETF variant  *\/\n-        return new UUID(md5Bytes);\n+        return new UUID(md.digest(name), 0x30);\n@@ -433,0 +466,27 @@\n+    \/**\n+     * Gets the raw byte representation of this {@code UUID}.\n+     *\n+     * @return the raw bytes of this {@code UUID}.\n+     * @since 16\n+     *\/\n+    public byte[] getBytes() {\n+        byte[] bytes = new byte[16];\n+        bytes[0]  = (byte) (mostSigBits >>> 56);\n+        bytes[1]  = (byte) (mostSigBits >>> 48);\n+        bytes[2]  = (byte) (mostSigBits >>> 40);\n+        bytes[3]  = (byte) (mostSigBits >>> 32);\n+        bytes[4]  = (byte) (mostSigBits >>> 24);\n+        bytes[5]  = (byte) (mostSigBits >>> 16);\n+        bytes[6]  = (byte) (mostSigBits >>> 8);\n+        bytes[7]  = (byte) (mostSigBits);\n+        bytes[8]  = (byte) (leastSigBits >>> 56);\n+        bytes[9]  = (byte) (leastSigBits >>> 48);\n+        bytes[10] = (byte) (leastSigBits >>> 40);\n+        bytes[11] = (byte) (leastSigBits >>> 32);\n+        bytes[12] = (byte) (leastSigBits >>> 24);\n+        bytes[13] = (byte) (leastSigBits >>> 16);\n+        bytes[14] = (byte) (leastSigBits >>> 8);\n+        bytes[15] = (byte) (leastSigBits);\n+        return bytes;\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/java\/util\/UUID.java","additions":84,"deletions":24,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -42,0 +42,1 @@\n+        bytesTest();\n@@ -122,0 +123,19 @@\n+    private static void bytesTest() throws Exception {\n+        final UUID a = UUID.randomUUID();\n+        final UUID b = new UUID(a.getBytes());\n+        if (!a.equals(b)) {\n+            throw new Exception(\"UUID -> byte[] -> UUID failed\");\n+        }\n+\n+        final byte[] dnsBytes = {\n+                (byte) 0x6B, (byte) 0xA7, (byte) 0xB8, (byte) 0x10, (byte) 0x9D,\n+                (byte) 0xAD, (byte) 0x11, (byte) 0xD1, (byte) 0x80, (byte) 0xB4,\n+                (byte) 0x00, (byte) 0xC0, (byte) 0x4F, (byte) 0xD4, (byte) 0x30,\n+                (byte) 0xC8\n+        };\n+        final String dnsUuid = new UUID(dnsBytes).toString();\n+        if (!\"6ba7b810-9dad-11d1-80b4-00c04fd430c8\".equals(dnsUuid)) {\n+            throw new Exception(\"DNS UUID was not correctly reconstructed from raw bytes, got: \" + dnsUuid);\n+        }\n+    }\n+\n","filename":"test\/jdk\/java\/util\/UUID\/UUIDTest.java","additions":20,"deletions":0,"binary":false,"changes":20,"status":"modified"}]}