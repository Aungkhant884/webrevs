{"files":[{"patch":"@@ -31,0 +31,1 @@\n+#include \"gc\/shared\/collectedHeap.hpp\"\n@@ -33,0 +34,1 @@\n+#include \"memory\/universe.hpp\"\n@@ -41,1 +43,3 @@\n-class LoadPhantomOopClosure : public OopClosure {\n+class OopKeepaliveClosure : public OopClosure {\n+  CollectedHeap* _heap;\n+\n@@ -43,0 +47,3 @@\n+  OopKeepaliveClosure()\n+    : _heap(Universe::heap()) {}\n+\n@@ -44,1 +51,2 @@\n-    NativeAccess<ON_PHANTOM_OOP_REF>::oop_load(p);\n+    oop obj = NativeAccess<ON_PHANTOM_OOP_REF | AS_NO_KEEPALIVE>::oop_load(p);\n+    _heap->keep_alive(obj);\n@@ -46,0 +54,1 @@\n+\n@@ -71,3 +80,2 @@\n-  \/\/ SATB GC, then it is important that this code marks them live. This is done\n-  \/\/ by the phantom load.\n-  LoadPhantomOopClosure cl;\n+  \/\/ SATB GC, then it is important that this code marks them live.\n+  OopKeepaliveClosure cl;\n","filename":"src\/hotspot\/share\/gc\/shared\/barrierSetNMethod.cpp","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"}]}