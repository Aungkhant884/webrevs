{"files":[{"patch":"@@ -922,1 +922,1 @@\n-  void preclean(uint worker_id) {\n+  void preclean() {\n@@ -928,2 +928,1 @@\n-                                           _cm->_gc_timer_cm,\n-                                           worker_id);\n+                                           _cm->_gc_timer_cm);\n@@ -949,1 +948,1 @@\n-          preclean(worker_id);\n+          preclean();\n","filename":"src\/hotspot\/share\/gc\/g1\/g1ConcurrentMark.cpp","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -1070,2 +1070,1 @@\n-                                                        GCTimer* gc_timer,\n-                                                        uint worker_id) {\n+                                                        GCTimer* gc_timer) {\n@@ -1074,4 +1073,2 @@\n-  size_t soft_count    = _discoveredSoftRefs[worker_id].length();\n-  size_t weak_count    = _discoveredWeakRefs[worker_id].length();\n-  size_t final_count   = _discoveredFinalRefs[worker_id].length();\n-  size_t phantom_count = _discoveredPhantomRefs[worker_id].length();\n+  ReferenceType ref_type_arr[4] = { REF_SOFT, REF_WEAK, REF_FINAL, REF_PHANTOM };\n+  size_t ref_count_arr[4] = {};\n@@ -1079,4 +1076,19 @@\n-  preclean_discovered_reflist(_discoveredSoftRefs[worker_id], is_alive, enqueue, yield);\n-  preclean_discovered_reflist(_discoveredWeakRefs[worker_id], is_alive, enqueue, yield);\n-  preclean_discovered_reflist(_discoveredFinalRefs[worker_id], is_alive, enqueue, yield);\n-  preclean_discovered_reflist(_discoveredPhantomRefs[worker_id], is_alive, enqueue, yield);\n+  if (discovery_is_mt()) {\n+    for (int i = 0; i < 4; ++i) {\n+      ReferenceType ref_type = ref_type_arr[i];\n+      DiscoveredList* list = get_discovered_list(ref_type);\n+      ref_count_arr[i] = list->length();\n+      preclean_discovered_reflist(*list, is_alive, enqueue, yield);\n+    }\n+  } else {\n+    for (int i = 0; i < 4; ++i) {\n+      ReferenceType ref_type = ref_type_arr[i];\n+      \/\/ When discovery is *not* multi-threaded, discovered refs are stored in\n+      \/\/ list[0.._num_queues-1]. Loop _num_queues times to cover all lists.\n+      for (uint j = 0; j < _num_queues; ++j) {\n+        DiscoveredList* list = get_discovered_list(ref_type);\n+        ref_count_arr[i] += list->length();\n+        preclean_discovered_reflist(*list, is_alive, enqueue, yield);\n+      }\n+    }\n+  }\n@@ -1084,0 +1096,1 @@\n+  uint worker_id = WorkerThread::current()->id();\n@@ -1085,1 +1098,1 @@\n-      worker_id, soft_count, weak_count, final_count, phantom_count,\n+      worker_id, ref_count_arr[0], ref_count_arr[1], ref_count_arr[2], ref_count_arr[3],\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.cpp","additions":24,"deletions":11,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -321,2 +321,1 @@\n-                                      GCTimer*           gc_timer,\n-                                      uint               worker_id);\n+                                      GCTimer*           gc_timer);\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}