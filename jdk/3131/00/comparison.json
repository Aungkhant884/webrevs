{"files":[{"patch":"@@ -96,0 +96,1 @@\n+  {\"java\/lang\/ModuleLayer\",                       \"EMPTY_LAYER\"},\n","filename":"src\/hotspot\/share\/memory\/heapShared.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -51,0 +51,2 @@\n+import jdk.internal.misc.CDS;\n+import jdk.internal.vm.annotation.Stable;\n@@ -150,3 +152,11 @@\n-    \/\/ the empty layer\n-    private static final ModuleLayer EMPTY_LAYER\n-        = new ModuleLayer(Configuration.empty(), List.of(), null);\n+    \/\/ the empty layer (may be initialized from the CDS archive)\n+    private static @Stable ModuleLayer EMPTY_LAYER;\n+\n+    static {\n+        \/\/ Initialize EMPTY_LAYER from the archive.\n+        CDS.initializeFromArchive(ModuleLayer.class);\n+        if (EMPTY_LAYER == null) {\n+            \/\/ create a new empty layer if there is no archived version.\n+            EMPTY_LAYER = new ModuleLayer(Configuration.empty(), List.of(), null);\n+        }\n+    }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ModuleLayer.java","additions":13,"deletions":3,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -64,0 +64,1 @@\n+        checkEmptyLayer();\n@@ -142,0 +143,9 @@\n+\n+    private static void checkEmptyLayer() {\n+        \/\/ ModuleLayer.EMPTY_FIELD returned by empty() method is singleton.\n+        \/\/ Check that with CDS there is still a single instance of EMPTY_LAYER\n+        \/\/ and boot() layer parent is THE empty layer.\n+        if (ModuleLayer.empty() != ModuleLayer.boot().parents().get(0)) {\n+            throw new RuntimeException(\"FAILED. Empty module layer is not singleton\");\n+        }\n+    }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/cacheObject\/CheckArchivedModuleApp.java","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"}]}