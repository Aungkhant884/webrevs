{"files":[{"patch":"@@ -32,1 +32,0 @@\n-#include \"runtime\/globals_extension.hpp\"\n@@ -51,3 +50,19 @@\n-static const char* z_gen[]     = {\"  \",   \"G1\",   \"G2\", \"G3\",    \"G4\",     \"G5\",      \"G6\",   \"G7\"   };\n-static const char* z_machine[] = {\"  \", \"2064\", \"2084\", \"2094\",  \"2097\",   \"2817\",    \"  \",   \"2964\" };\n-static const char* z_name[]    = {\"  \", \"z900\", \"z990\", \"z9 EC\", \"z10 EC\", \"z196 EC\", \"ec12\", \"z13\"  };\n+\/\/ The following list contains the (approximate) announcement\/availability\n+\/\/ dates of the many System z generations in existence as of now.\n+\/\/ Information compiled from https:\/\/www.ibm.com\/support\/techdocs\/atsmastr.nsf\/WebIndex\/TD105503\n+\/\/   z900: 2000-10\n+\/\/   z990: 2003-06\n+\/\/   z9:   2005-09\n+\/\/   z10:  2007-04\n+\/\/   z10:  2008-02\n+\/\/   z196: 2010-08\n+\/\/   ec12: 2012-09\n+\/\/   z13:  2015-03\n+\/\/   z14:  2017-09\n+\/\/   z15:  2019-09\n+\n+static const char* z_gen[]     = {\"  \", \"G1\",         \"G2\",         \"G3\",         \"G4\",         \"G5\",         \"G6\",         \"G7\",         \"G8\",         \"G9\"  };\n+static const char* z_machine[] = {\"  \", \"2064\",       \"2084\",       \"2094\",       \"2097\",       \"2817\",       \"2827\",       \"2964\",       \"3906\",       \"8561\" };\n+static const char* z_name[]    = {\"  \", \"z900\",       \"z990\",       \"z9 EC\",      \"z10 EC\",     \"z196 EC\",    \"ec12\",       \"z13\",        \"z14\",        \"z15\" };\n+static const char* z_WDFM[]    = {\"  \", \"2006-06-30\", \"2008-06-30\", \"2010-06-30\", \"2012-06-30\", \"2014-06-30\", \"2016-12-31\", \"2019-06-30\", \"2021-06-30\", \"tbd\" };\n+static const char* z_EOS[]     = {\"  \", \"2014-12-31\", \"2014-12-31\", \"2017-10-31\", \"2019-12-31\", \"2021-12-31\", \"tbd\",        \"tbd\",        \"tbd\",        \"tbd\" };\n@@ -276,1 +291,11 @@\n-  _model_string = z_name[0];\n+  unsigned int model_ix  = 0;\n+  if (is_z15()) {\n+    _features_string = \"system-z g9-z15 ldisp_fast, extimm, pcrel_load\/store, cmpb, cond_load\/store, interlocked_update, txm, vectorinstr, instrext2, venh1, instrext3, VEnh2 )\";\n+    model_ix = 9;\n+    ambiguity++;\n+  }\n+  if (is_z14()) {\n+    _features_string = \"system-z g8-z14 ldisp_fast, extimm, pcrel_load\/store, cmpb, cond_load\/store, interlocked_update, txm, vectorinstr, instrext2, venh1)\";\n+    model_ix = 8;\n+    ambiguity++;\n+  }\n@@ -279,1 +304,1 @@\n-    _model_string = z_name[7];\n+    model_ix = 7;\n@@ -284,1 +309,1 @@\n-    _model_string = z_name[6];\n+    model_ix = 6;\n@@ -289,1 +314,1 @@\n-    _model_string = z_name[5];\n+    model_ix = 5;\n@@ -294,1 +319,1 @@\n-    _model_string = z_name[4];\n+    model_ix = 4;\n@@ -298,2 +323,2 @@\n-    _features_string = \"system-z, g3-z9, ldisp_fast, extimm, out-of-support as of 2016-04-01\";\n-    _model_string = z_name[3];\n+    _features_string = \"system-z, g3-z9, ldisp_fast, extimm\";\n+    model_ix = 3;\n@@ -303,2 +328,2 @@\n-    _features_string = \"system-z, g2-z990, ldisp_fast, out-of-support as of 2014-07-01\";\n-    _model_string = z_name[2];\n+    _features_string = \"system-z, g2-z990, ldisp_fast\";\n+    model_ix = 2;\n@@ -308,2 +333,2 @@\n-    _features_string = \"system-z, g1-z900, ldisp, out-of-support as of 2014-07-01\";\n-    _model_string = z_name[1];\n+    _features_string = \"system-z, g1-z900, ldisp\";\n+    model_ix = 1;\n@@ -313,0 +338,1 @@\n+  char buf[512];\n@@ -314,1 +340,4 @@\n-    _features_string = \"z\/Architecture (unknown generation)\";\n+    strcpy(buf, \"z\/Architecture (unknown generation)\");\n+  } else if (ambiguity == 1) {\n+    _model_string = z_name[model_ix];\n+    jio_snprintf(buf, sizeof(buf), \"%s, out-of-support_as_of_\", _features_string, z_EOS[model_ix]);\n@@ -318,1 +347,1 @@\n-    _features_string = \"z\/Architecture (ambiguous detection)\";\n+    strcpy(buf, \"z\/Architecture (ambiguous detection)\");\n@@ -320,0 +349,1 @@\n+  _features_string = os::strdup(buf);\n@@ -322,1 +352,0 @@\n-    char buf[256];\n@@ -329,0 +358,1 @@\n+    os::free((void *)_features_string);\n@@ -333,1 +363,0 @@\n-    char buf[256];\n@@ -341,1 +370,1 @@\n-    if (has_Crypto_AES()) { os::free((void *)_features_string); }\n+    os::free((void *)_features_string);\n@@ -434,5 +463,8 @@\n-    \/\/ test switches\n-    if (has_TestFeature1Impl()         ) tty->print_cr(\"available: %s\", \"TestFeature1Impl\");\n-    if (has_TestFeature2Impl()         ) tty->print_cr(\"available: %s\", \"TestFeature2Impl\");\n-    if (has_TestFeature4Impl()         ) tty->print_cr(\"available: %s\", \"TestFeature4Impl\");\n-    if (has_TestFeature8Impl()         ) tty->print_cr(\"available: %s\", \"TestFeature8Impl\");\n+    \/\/ z14\n+    if (has_MiscInstrExt2()            ) tty->print_cr(\"available: %s\", \"Miscelaneous Instruction Extensions 2\");\n+    if (has_VectorEnhancements1()      ) tty->print_cr(\"available: %s\", \"Vector Facility Enhancements 3\");\n+    if (has_CryptoExt8()               ) tty->print_cr(\"available: %s\", \"Crypto Extensions 8\");\n+    \/\/ z15\n+    if (has_MiscInstrExt3()            ) tty->print_cr(\"available: %s\", \"Miscelaneous Instruction Extensions 3\");\n+    if (has_VectorEnhancements2()      ) tty->print_cr(\"available: %s\", \"Vector Facility Enhancements 3\");\n+    if (has_CryptoExt9()               ) tty->print_cr(\"available: %s\", \"Crypto Extensions 9\");\n@@ -646,0 +678,20 @@\n+void VM_Version::set_features_z14(bool reset) {\n+  reset_features(reset);\n+\n+  set_features_z13(false);\n+  set_has_MiscInstrExt2();\n+  set_has_VectorEnhancements1();\n+  has_VectorPackedDecimal();\n+  set_has_CryptoExt8();\n+}\n+\n+void VM_Version::set_features_z15(bool reset) {\n+  reset_features(reset);\n+\n+  set_features_z14(false);\n+  set_has_MiscInstrExt3();\n+  set_has_VectorEnhancements2();\n+  has_VectorPackedDecimalEnh();\n+  set_has_CryptoExt9();\n+}\n+\n@@ -675,27 +727,4 @@\n-    } else if (!strcmp(buf, \"ztest\")) {\n-      assert(!has_TestFeaturesImpl(), \"possible facility list flag conflict\");\n-      if (strlen(march) > hdr_len) {\n-        int itest = 0;\n-        if ((strlen(march)-hdr_len) >= buf_len) err = true;\n-        if (!err) {\n-          memcpy(buf, &march[hdr_len], strlen(march)-hdr_len);\n-          buf[strlen(march)-hdr_len] = '\\00';\n-          for (size_t i = 0; !err && (i < strlen(buf)); i++) {\n-            itest = itest*10 + buf[i]-'0';\n-            err   = err || ((buf[i]-'0') < 0) || ((buf[i]-'0') > 9) || (itest > 15);\n-          }\n-        }\n-        if (!err) {\n-          prt = true;\n-          if (itest & 0x01) { set_has_TestFeature1Impl(); }\n-          if (itest & 0x02) { set_has_TestFeature2Impl(); }\n-          if (itest & 0x04) { set_has_TestFeature4Impl(); }\n-          if (itest & 0x08) { set_has_TestFeature8Impl(); }\n-        }\n-      } else {\n-        prt = true;\n-        set_has_TestFeature1Impl();\n-        set_has_TestFeature2Impl();\n-        set_has_TestFeature4Impl();\n-        set_has_TestFeature8Impl();\n-      }\n+    } else if (!strcmp(march, \"z14\")) {\n+        set_features_z14();\n+    } else if (!strcmp(march, \"z15\")) {\n+        set_features_z15();\n","filename":"src\/hotspot\/cpu\/s390\/vm_version_s390.cpp","additions":81,"deletions":52,"binary":false,"changes":133,"status":"modified"},{"patch":"@@ -36,12 +36,0 @@\n-\/\/ The following list contains the (approximate) announcement\/availability\n-\/\/ dates of the many System z generations in existence as of now which\n-\/\/ implement the z\/Architecture.\n-\/\/   z900: 2000-10\n-\/\/   z990: 2003-06\n-\/\/   z9:   2005-09\n-\/\/   z10:  2007-04\n-\/\/   z10:  2008-02\n-\/\/   z196: 2010-08\n-\/\/   ec12: 2012-09\n-\/\/   z13:  2015-03\n-\/\/\n@@ -51,0 +39,4 @@\n+\/\/ For information concerning the life span of the individual\n+\/\/ z\/Architecture models, please check out the comments\/tables\n+\/\/ in vm_version_s390.cpp\n+\n@@ -97,5 +89,2 @@\n-\/\/ Feature-DW[0] starts to fill up. Use of these masks is risky.\n-#define  TestFeature1ImplMask           0x0000000000000001UL\n-#define  TestFeature2ImplMask           0x0000000000000002UL\n-#define  TestFeature4ImplMask           0x0000000000000004UL\n-#define  TestFeature8ImplMask           0x0000000000000008UL\n+#define  MiscInstrExt2Mask              0x0000000000000020UL  \/\/ z14\n+#define  MiscInstrExt3Mask              0x0000000000000004UL  \/\/ z15\n@@ -119,0 +108,9 @@\n+#define  ExecutionProtectionMask        0x2000000000000000UL  \/\/ z14\n+#define  GuardedStorageMask             0x0400000000000000UL  \/\/ z14\n+#define  VectorEnhancements1Mask        0x0100000000000000UL  \/\/ z14\n+#define  VectorPackedDecimalMask        0x0200000000000000UL  \/\/ z14\n+#define  CryptoExtension8Mask           0x0000200000000040UL  \/\/ z14\n+#define  VectorEnhancements2Mask        0x0000080000000000UL  \/\/ z15\n+#define  VectorPackedDecimalEnhMask     0x0000008000000000UL  \/\/ z15\n+#define  CryptoExtension9Mask           0x0000001000000040UL  \/\/ z15\n+#define  DeflateMask                    0x0000010000000040UL  \/\/ z15\n@@ -146,1 +144,1 @@\n-  \/\/ Setting features via march=z900|z990|z9|z10|z196|ec12|z13|ztest commandline option.\n+  \/\/ Setting features via march=z900|z990|z9|z10|z196|ec12|z13|z14|z15 commandline option.\n@@ -155,0 +153,2 @@\n+  static void set_features_z14(bool reset = true);\n+  static void set_features_z15(bool reset = true);\n@@ -157,0 +157,7 @@\n+  \/\/ Get information about cache line sizes.\n+  \/\/ As of now and the foreseeable future, line size of all levels will be the same and 256.\n+  static unsigned int Dcache_lineSize(unsigned int level = 0) { return _Dcache_lineSize; }\n+  static unsigned int Icache_lineSize(unsigned int level = 0) { return _Icache_lineSize; }\n+\n+ public:\n+\n@@ -164,8 +171,3 @@\n-  static bool is_z13()  { return has_CryptoExt5();}\n-\n-  \/\/ Get information about cache line sizes.\n-  \/\/ As of now and the foreseeable future, line size of all levels will be the same and 256.\n-  static unsigned int Dcache_lineSize(unsigned int level = 0) { return _Dcache_lineSize; }\n-  static unsigned int Icache_lineSize(unsigned int level = 0) { return _Icache_lineSize; }\n-\n- public:\n+  static bool is_z13()  { return has_CryptoExt5()             && !has_MiscInstrExt2();}\n+  static bool is_z14()  { return has_MiscInstrExt2()          && !has_MiscInstrExt3();}\n+  static bool is_z15()  { return has_MiscInstrExt3();}\n@@ -405,0 +407,2 @@\n+  static bool has_MiscInstrExt2()             { return  (_features[0] & MiscInstrExt2Mask)             == MiscInstrExt2Mask; }\n+  static bool has_MiscInstrExt3()             { return  (_features[0] & MiscInstrExt3Mask)             == MiscInstrExt3Mask; }\n@@ -413,0 +417,2 @@\n+  static bool has_CryptoExt8()                { return  (_features[2] & CryptoExtension8Mask)          == CryptoExtension8Mask; }\n+  static bool has_CryptoExt9()                { return  (_features[2] & CryptoExtension9Mask)          == CryptoExtension9Mask; }\n@@ -415,7 +421,4 @@\n-\n-  static bool has_TestFeatureImpl()           { return  (_features[0] & TestFeature1ImplMask)          == TestFeature1ImplMask; }\n-  static bool has_TestFeature1Impl()          { return  (_features[0] & TestFeature1ImplMask)          == TestFeature1ImplMask; }\n-  static bool has_TestFeature2Impl()          { return  (_features[0] & TestFeature2ImplMask)          == TestFeature2ImplMask; }\n-  static bool has_TestFeature4Impl()          { return  (_features[0] & TestFeature4ImplMask)          == TestFeature4ImplMask; }\n-  static bool has_TestFeature8Impl()          { return  (_features[0] & TestFeature8ImplMask)          == TestFeature8ImplMask; }\n-  static bool has_TestFeaturesImpl()          { return  has_TestFeature1Impl() || has_TestFeature2Impl() || has_TestFeature4Impl() || has_TestFeature8Impl(); }\n+  static bool has_VectorEnhancements1()       { return  (_features[2] & VectorEnhancements1Mask)       == VectorEnhancements1Mask; }\n+  static bool has_VectorEnhancements2()       { return  (_features[2] & VectorEnhancements2Mask)       == VectorEnhancements2Mask; }\n+  static bool has_VectorPackedDecimal()       { return  (_features[2] & VectorPackedDecimalMask)       == VectorPackedDecimalMask; }\n+  static bool has_VectorPackedDecimalEnh()    { return  (_features[2] & VectorPackedDecimalEnhMask)    == VectorPackedDecimalEnhMask; }\n@@ -436,4 +439,0 @@\n-  static void set_has_TestFeature1Impl()          { _features[0] |= TestFeature1ImplMask; }\n-  static void set_has_TestFeature2Impl()          { _features[0] |= TestFeature2ImplMask; }\n-  static void set_has_TestFeature4Impl()          { _features[0] |= TestFeature4ImplMask; }\n-  static void set_has_TestFeature8Impl()          { _features[0] |= TestFeature8ImplMask; }\n@@ -474,0 +473,2 @@\n+  static void set_has_MiscInstrExt2()             { _features[0] |= MiscInstrExt2Mask; }\n+  static void set_has_MiscInstrExt3()             { _features[0] |= MiscInstrExt3Mask; }\n@@ -482,0 +483,2 @@\n+  static void set_has_CryptoExt8()                { _features[2] |= CryptoExtension8Mask; }\n+  static void set_has_CryptoExt9()                { _features[2] |= CryptoExtension9Mask; }\n@@ -483,0 +486,4 @@\n+  static void set_has_VectorEnhancements1()       { _features[2] |= VectorEnhancements1Mask; }\n+  static void set_has_VectorEnhancements2()       { _features[2] |= VectorEnhancements2Mask; }\n+  static void set_has_VectorPackedDecimal()       { _features[2] |= VectorPackedDecimalMask; }\n+  static void set_has_VectorPackedDecimalEnh()    { _features[2] |= VectorPackedDecimalEnhMask; }\n","filename":"src\/hotspot\/cpu\/s390\/vm_version_s390.hpp","additions":44,"deletions":37,"binary":false,"changes":81,"status":"modified"}]}