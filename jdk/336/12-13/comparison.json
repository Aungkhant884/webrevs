{"files":[{"patch":"@@ -40,3 +40,3 @@\n-\/\/ A Metachunk is a contiguous metaspace memory region. It is part of\n-\/\/ a MetaspaceArena, which keeps a list of MetaChunk and allocates via\n-\/\/ pointer bump from the top element in the list.\n+\/\/ A Metachunk is a contiguous metaspace memory region. It is used by\n+\/\/ a MetaspaceArena to allocate from via pointer bump (somewhat similar\n+\/\/ to a TLAB in java heap.\n@@ -49,0 +49,18 @@\n+\/\/\n+\/\/ +---------+                 +---------+                 +---------+\n+\/\/ |MetaChunk| <--next\/prev--> |MetaChunk| <--next\/prev--> |MetaChunk|   Chunk headers\n+\/\/ +---------+                 +---------+                 +---------+   in C-heap\n+\/\/     |                           |                          |\n+\/\/    base                        base                       base\n+\/\/     |                          \/                           |\n+\/\/    \/            ---------------                           \/\n+\/\/   \/            \/              ----------------------------\n+\/\/  |            |              \/\n+\/\/  v            v              v\n+\/\/ +---------+  +---------+    +-------------------+\n+\/\/ |         |  |         |    |                   |\n+\/\/ |  chunk  |  |  chunk  |    |      chunk        |    The real chunks (\"payload\")\n+\/\/ |         |  |         |    |                   |    live in Metaspace\n+\/\/ +---------+  +---------+    +-------------------+\n+\/\/\n+\/\/\n@@ -62,0 +80,6 @@\n+\/\/ A Metachunk is always part of a linked list. In-use chunks are part of\n+\/\/  the chunk list of a MetaspaceArena. Free chunks are in a freelist in\n+\/\/  the ChunkManager. Dead chunk headers are in a linked list as part\n+\/\/  of the ChunkHeaderPool.\n+\/\/\n+\/\/\n@@ -70,0 +94,1 @@\n+\/\/\n@@ -72,5 +97,5 @@\n-\/\/ A Metachunk payload may be committed, partly committed or completely\n-\/\/ uncommitted. Technically, a payload may be committed \"checkered\" -\n-\/\/ i.e. committed and uncommitted parts may interleave - but the\n-\/\/ important part is how much contiguous space is committed starting\n-\/\/ at the base of the payload (since that's where we allocate).\n+\/\/ A Metachunk payload (the \"real chunk\") may be committed, partly committed\n+\/\/  or completely uncommitted. Technically, a payload may be committed\n+\/\/  \"checkered\" - i.e. committed and uncommitted parts may interleave - but the\n+\/\/  important part is how much contiguous space is committed starting\n+\/\/  at the base of the payload (since that's where we allocate).\n@@ -103,0 +128,39 @@\n+\/\/\n+\/\/\n+\/\/ -- Relationships --\n+\/\/\n+\/\/ Chunks are managed by a binary buddy style allocator\n+\/\/  (see https:\/\/en.wikipedia.org\/wiki\/Buddy_memory_allocation).\n+\/\/ Chunks which are not a root chunk always have an adjoining buddy.\n+\/\/  The first chunk in a buddy pair is called the leader, the second\n+\/\/  one the follower.\n+\/\/\n+\/\/ +----------+----------+\n+\/\/ | leader   | follower |\n+\/\/ +----------+----------+\n+\/\/\n+\/\/\n+\/\/ -- Layout in address space --\n+\/\/\n+\/\/ In order to implement buddy style allocation, we need an easy way to get\n+\/\/  from one chunk to the Metachunk representing the neighboring chunks\n+\/\/  (preceding resp. following it in memory).\n+\/\/ But Metachunk headers and chunks are physically separated, and it is not\n+\/\/  possible to get the Metachunk* from the start of the chunk. Therefore\n+\/\/  Metachunk headers are part of a second linked list, describing the order\n+\/\/  in which their payload appears in memory:\n+\/\/\n+\/\/ +---------+                       +---------+                       +---------+\n+\/\/ |MetaChunk| <--next\/prev_in_vs--> |MetaChunk| <--next\/prev_in_vs--> |MetaChunk|\n+\/\/ +---------+                       +---------+                       +---------+\n+\/\/     |                                 |                                  |\n+\/\/    base                              base                               base\n+\/\/     |                                 \/                                  |\n+\/\/    \/        --------------------------                                  \/\n+\/\/   \/        \/          --------------------------------------------------\n+\/\/  |         |         \/\n+\/\/  v         v         v\n+\/\/ +---------+---------+-------------------+\n+\/\/ |  chunk  |  chunk  |      chunk        |\n+\/\/ +---------+---------+-------------------+\n+\/\/\n@@ -104,2 +168,0 @@\n-\/\/ Note: this is a chunk **descriptor**. The real Payload area lives in metaspace,\n-\/\/ this class lives somewhere else.\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metachunk.hpp","additions":72,"deletions":10,"binary":false,"changes":82,"status":"modified"}]}