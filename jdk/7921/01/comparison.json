{"files":[{"patch":"@@ -64,7 +64,0 @@\n-void G1BarrierSet::enqueue(oop pre_val) {\n-  \/\/ Nulls should have been already filtered.\n-  assert(oopDesc::is_oop(pre_val, true), \"Error\");\n-  SATBMarkQueue& queue = G1ThreadLocalData::satb_mark_queue(Thread::current());\n-  G1BarrierSet::satb_mark_queue_set().enqueue(queue, pre_val);\n-}\n-\n","filename":"src\/hotspot\/share\/gc\/g1\/g1BarrierSet.cpp","additions":0,"deletions":7,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -59,1 +59,3 @@\n-  \/\/ pre-marking object graph.\n+  \/\/ pre-marking object graph. Prefer the version that takes location, as it\n+  \/\/ can avoid touching the heap unnecessarily.\n+  template <class T> static void enqueue_loc(T* dst);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1BarrierSet.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -31,0 +31,1 @@\n+#include \"gc\/g1\/g1ThreadLocalData.hpp\"\n@@ -36,0 +37,23 @@\n+inline void G1BarrierSet::enqueue(oop pre_val) {\n+  \/\/ Nulls should have been already filtered.\n+  assert(oopDesc::is_oop(pre_val, true), \"Error\");\n+\n+  G1SATBMarkQueueSet& queue_set = G1BarrierSet::satb_mark_queue_set();\n+  if (!queue_set.is_active()) return;\n+\n+  SATBMarkQueue& queue = G1ThreadLocalData::satb_mark_queue(Thread::current());\n+  queue_set.enqueue_known_active(queue, pre_val);\n+}\n+\n+template <class T>\n+inline void G1BarrierSet::enqueue_loc(T* dst) {\n+  G1SATBMarkQueueSet& queue_set = G1BarrierSet::satb_mark_queue_set();\n+  if (!queue_set.is_active()) return;\n+\n+  T heap_oop = RawAccess<MO_RELAXED>::oop_load(dst);\n+  if (!CompressedOops::is_null(heap_oop)) {\n+    SATBMarkQueue& queue = G1ThreadLocalData::satb_mark_queue(Thread::current());\n+    queue_set.enqueue_known_active(queue, CompressedOops::decode_not_null(heap_oop));\n+  }\n+}\n+\n@@ -43,4 +67,1 @@\n-  T heap_oop = RawAccess<MO_RELAXED>::oop_load(field);\n-  if (!CompressedOops::is_null(heap_oop)) {\n-    enqueue(CompressedOops::decode_not_null(heap_oop));\n-  }\n+  enqueue_loc(field);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1BarrierSet.inline.hpp","additions":25,"deletions":4,"binary":false,"changes":29,"status":"modified"}]}