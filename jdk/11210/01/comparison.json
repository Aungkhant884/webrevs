{"files":[{"patch":"@@ -189,6 +189,7 @@\n-    gch->full_process_roots(false, \/\/ not the adjust phase\n-                            GenCollectedHeap::SO_None,\n-                            ClassUnloading, \/\/ only strong roots if ClassUnloading\n-                                            \/\/ is enabled\n-                            &follow_root_closure,\n-                            &follow_cld_closure);\n+    CLDClosure* weak_cld_closure = ClassUnloading ? NULL : &follow_cld_closure;\n+    MarkingCodeBlobClosure mark_code_closure(&follow_root_closure, !CodeBlobToOopClosure::FixRelocations, true);\n+    gch->process_roots(GenCollectedHeap::SO_None,\n+                       &follow_root_closure,\n+                       &follow_cld_closure,\n+                       weak_cld_closure,\n+                       &mark_code_closure);\n@@ -267,9 +268,6 @@\n-  {\n-    StrongRootsScope srs(0);\n-\n-    gch->full_process_roots(true,  \/\/ this is the adjust phase\n-                            GenCollectedHeap::SO_AllCodeCache,\n-                            false, \/\/ all roots\n-                            &adjust_pointer_closure,\n-                            &adjust_cld_closure);\n-  }\n+  CodeBlobToOopClosure code_closure(&adjust_pointer_closure, CodeBlobToOopClosure::FixRelocations);\n+  gch->process_roots(GenCollectedHeap::SO_AllCodeCache,\n+                     &adjust_pointer_closure,\n+                     &adjust_cld_closure,\n+                     &adjust_cld_closure,\n+                     &code_closure);\n","filename":"src\/hotspot\/share\/gc\/serial\/genMarkSweep.cpp","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -792,14 +792,0 @@\n-void GenCollectedHeap::full_process_roots(bool is_adjust_phase,\n-                                          ScanningOption so,\n-                                          bool only_strong_roots,\n-                                          OopClosure* root_closure,\n-                                          CLDClosure* cld_closure) {\n-  \/\/ Called from either the marking phase or the adjust phase.\n-  const bool is_marking_phase = !is_adjust_phase;\n-\n-  MarkingCodeBlobClosure mark_code_closure(root_closure, is_adjust_phase, is_marking_phase);\n-  CLDClosure* weak_cld_closure = only_strong_roots ? NULL : cld_closure;\n-\n-  process_roots(so, root_closure, cld_closure, weak_cld_closure, &mark_code_closure);\n-}\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/genCollectedHeap.cpp","additions":0,"deletions":14,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -329,0 +329,5 @@\n+  virtual void gc_prologue(bool full);\n+  virtual void gc_epilogue(bool full);\n+\n+ public:\n+  \/\/ Apply closures on various roots in Young GC or marking\/adjust phases of Full GC.\n@@ -335,10 +340,0 @@\n-  virtual void gc_prologue(bool full);\n-  virtual void gc_epilogue(bool full);\n-\n- public:\n-  void full_process_roots(bool is_adjust_phase,\n-                          ScanningOption so,\n-                          bool only_strong_roots,\n-                          OopClosure* root_closure,\n-                          CLDClosure* cld_closure);\n-\n","filename":"src\/hotspot\/share\/gc\/shared\/genCollectedHeap.hpp","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"}]}