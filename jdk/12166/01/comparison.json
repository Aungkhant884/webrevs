{"files":[{"patch":"@@ -162,0 +162,2 @@\n+\/\/ log_fmt can be different than scan_fmt. For example\n+\/\/ cpu_period() for cgv2 uses log_fmt='%d' and scan_fmt='%*s %d'\n@@ -163,1 +165,1 @@\n-                           logstring, scan_fmt, variable)                 \\\n+                           logstring, log_fmt, scan_fmt, variable)        \\\n@@ -173,1 +175,1 @@\n-    log_trace(os, container)(logstring, (return_type) OSCONTAINER_ERROR); \\\n+    log_trace(os, container)(logstring \"%d\", OSCONTAINER_ERROR);          \\\n@@ -177,1 +179,1 @@\n-  log_trace(os, container)(logstring, variable);                          \\\n+  log_trace(os, container)(logstring log_fmt, variable);                  \\\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.hpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -79,1 +79,1 @@\n-                    \"Use Hierarchy is: \" JLONG_FORMAT, JLONG_FORMAT, use_hierarchy);\n+                    \"Use Hierarchy is: \", JLONG_FORMAT, JLONG_FORMAT, use_hierarchy);\n@@ -93,1 +93,1 @@\n-                     \"Memory Limit is: \" JULONG_FORMAT, JULONG_FORMAT, memlimit);\n+                     \"Memory Limit is: \", JULONG_FORMAT, JULONG_FORMAT, memlimit);\n@@ -117,1 +117,1 @@\n-                     \"Memory and Swap Limit is: \" JULONG_FORMAT, JULONG_FORMAT, memswlimit);\n+                     \"Memory and Swap Limit is: \", JULONG_FORMAT, JULONG_FORMAT, memswlimit);\n@@ -154,1 +154,1 @@\n-                     \"Swappiness is: \" JULONG_FORMAT, JULONG_FORMAT, swappiness);\n+                     \"Swappiness is: \", JULONG_FORMAT, JULONG_FORMAT, swappiness);\n@@ -160,1 +160,1 @@\n-                     \"Memory Soft Limit is: \" JULONG_FORMAT, JULONG_FORMAT, memsoftlimit);\n+                     \"Memory Soft Limit is: \", JULONG_FORMAT, JULONG_FORMAT, memsoftlimit);\n@@ -180,1 +180,1 @@\n-                     \"Memory Usage is: \" JLONG_FORMAT, JLONG_FORMAT, memusage);\n+                     \"Memory Usage is: \", JLONG_FORMAT, JLONG_FORMAT, memusage);\n@@ -194,1 +194,1 @@\n-                     \"Maximum Memory Usage is: \" JLONG_FORMAT, JLONG_FORMAT, memmaxusage);\n+                     \"Maximum Memory Usage is: \", JLONG_FORMAT, JLONG_FORMAT, memmaxusage);\n@@ -201,1 +201,1 @@\n-                     \"Kernel Memory Usage is: \" JLONG_FORMAT, JLONG_FORMAT, kmem_usage);\n+                     \"Kernel Memory Usage is: \", JLONG_FORMAT, JLONG_FORMAT, kmem_usage);\n@@ -207,1 +207,1 @@\n-                     \"Kernel Memory Limit is: \" JULONG_FORMAT, JULONG_FORMAT, kmem_limit);\n+                     \"Kernel Memory Limit is: \", JULONG_FORMAT, JULONG_FORMAT, kmem_limit);\n@@ -216,1 +216,1 @@\n-                     \"Maximum Kernel Memory Usage is: \" JLONG_FORMAT, JLONG_FORMAT, kmem_max_usage);\n+                     \"Maximum Kernel Memory Usage is: \", JLONG_FORMAT, JLONG_FORMAT, kmem_max_usage);\n@@ -254,1 +254,1 @@\n-                     \"CPU Quota is: %d\", \"%d\", quota);\n+                     \"CPU Quota is: \", \"%d\", \"%d\", quota);\n@@ -260,1 +260,1 @@\n-                     \"CPU Period is: %d\", \"%d\", period);\n+                     \"CPU Period is: \", \"%d\", \"%d\", period);\n@@ -276,1 +276,1 @@\n-                     \"CPU Shares is: %d\", \"%d\", shares);\n+                     \"CPU Shares is: \", \"%d\", \"%d\", shares);\n@@ -316,1 +316,1 @@\n-                     \"Current number of tasks is: \" JLONG_FORMAT, JLONG_FORMAT, pids_current);\n+                     \"Current number of tasks is: \", JLONG_FORMAT, JLONG_FORMAT, pids_current);\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":14,"deletions":14,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n-                     \"Raw value for CPU Shares is: %d\", \"%d\", shares);\n+                     \"Raw value for CPU Shares is: \", \"%d\", \"%d\", shares);\n@@ -112,1 +112,1 @@\n-                     \"CPU Period is: %d\", \"%*s %d\", period);\n+                     \"CPU Period is: \", \"%d\", \"%*s %d\", period);\n@@ -127,1 +127,1 @@\n-                     \"Memory Usage is: \" JLONG_FORMAT, JLONG_FORMAT, memusage);\n+                     \"Memory Usage is: \", JLONG_FORMAT, JLONG_FORMAT, memusage);\n@@ -161,0 +161,1 @@\n+  log_trace(os, container)(\"Memory and Swap Limit is: \" JLONG_FORMAT, swap_limit);\n@@ -254,1 +255,1 @@\n-                     \"Current number of tasks is: \" JLONG_FORMAT, JLONG_FORMAT, pids_current);\n+                     \"Current number of tasks is: \", JLONG_FORMAT, JLONG_FORMAT, pids_current);\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -78,0 +78,1 @@\n+            testMemorySwapLimitSanity();\n@@ -156,0 +157,25 @@\n+    \/*\n+     * This test verifies that no confusingly large positive numbers get printed on\n+     * systems with swapaccount=0 kernel option. On some systems -2 were converted\n+     * to unsigned long and printed that way. Ensure this oddity doesn't occur.\n+     *\/\n+    private static void testMemorySwapLimitSanity() throws Exception {\n+        String valueToSet = \"500m\";\n+        String expectedTraceValue = \"524288000\";\n+        Common.logNewTestCase(\"memory swap sanity: \" + valueToSet);\n+\n+        DockerRunOptions opts = Common.newOpts(imageName, \"PrintContainerInfo\");\n+        Common.addWhiteBoxOpts(opts);\n+        opts.addDockerOpts(\"--memory=\" + valueToSet);\n+        opts.addDockerOpts(\"--memory-swap=\" + valueToSet);\n+\n+        String neg2InUnsignedLong = \"18446744073709551614\";\n+\n+        Common.run(opts)\n+            .shouldMatch(\"Memory Limit is:.*\" + expectedTraceValue)\n+            \/\/ Either for cgroup v1: a_1) same as memory limit, or b_1) -2 on systems with swapaccount=0\n+            \/\/ Either for cgroup v2: a_2) 0, or b_2) -2 on systems with swapaccount=0\n+            .shouldMatch(\"Memory and Swap Limit is:.*(\" + expectedTraceValue + \"|-2|0)\")\n+            .shouldNotMatch(\"Memory and Swap Limit is:.*\" + neg2InUnsignedLong);\n+    }\n+\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMemoryAwareness.java","additions":26,"deletions":0,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -86,1 +86,1 @@\n-        \/\/ we only have Memory and Swap Limit is: <huge integer> in the output\n+        \/\/ we only have 'Memory and Swap Limit is: -2' in the output\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMemoryWithCgroupV1.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}