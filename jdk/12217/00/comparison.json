{"files":[{"patch":"@@ -567,1 +567,0 @@\n-void VM_Version::check_virtualizations() {\n@@ -569,2 +568,1 @@\n-  const char* info_file = \"\/sys\/devices\/virtual\/dmi\/id\/product_name\";\n-  \/\/ check for various strings in the dmi data indicating virtualizations\n+static bool check_info_file(const char* fpath, const char* virt) {\n@@ -572,1 +570,1 @@\n-  FILE* fp = os::fopen(info_file, \"r\");\n+  FILE* fp = os::fopen(fpath, \"r\");\n@@ -574,1 +572,1 @@\n-    return;\n+    return false;\n@@ -577,7 +575,3 @@\n-    if (strcasestr(line, \"KVM\") != 0) {\n-      Abstract_VM_Version::_detected_virtualization = KVM;\n-      break;\n-    }\n-    if (strcasestr(line, \"VMware\") != 0) {\n-      Abstract_VM_Version::_detected_virtualization = VMWare;\n-      break;\n+    if (strcasestr(line, virt) != 0) {\n+      fclose(fp);\n+      return true;\n@@ -587,0 +581,17 @@\n+  return false;\n+}\n+#endif\n+\n+void VM_Version::check_virtualizations() {\n+#if defined(LINUX)\n+  const char* pname_file = \"\/sys\/devices\/virtual\/dmi\/id\/product_name\";\n+  const char* tname_file = \"\/sys\/hypervisor\/type\";\n+  if (check_info_file(pname_file, \"KVM\")) {\n+    Abstract_VM_Version::_detected_virtualization = KVM; return;\n+  }\n+  if (check_info_file(pname_file, \"VMWare\")) {\n+    Abstract_VM_Version::_detected_virtualization = VMWare; return;\n+  }\n+  if (check_info_file(tname_file, \"Xen\")) {\n+    Abstract_VM_Version::_detected_virtualization = XenHVM;\n+  }\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":23,"deletions":12,"binary":false,"changes":35,"status":"modified"}]}