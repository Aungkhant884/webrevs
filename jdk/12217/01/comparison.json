{"files":[{"patch":"@@ -567,1 +567,0 @@\n-void VM_Version::check_virtualizations() {\n@@ -569,2 +568,2 @@\n-  const char* info_file = \"\/sys\/devices\/virtual\/dmi\/id\/product_name\";\n-  \/\/ check for various strings in the dmi data indicating virtualizations\n+static int check_info_file(const char* fpath, const char* virt1,\n+                           const char* virt2) {\n@@ -572,1 +571,1 @@\n-  FILE* fp = os::fopen(info_file, \"r\");\n+  FILE* fp = os::fopen(fpath, \"r\");\n@@ -574,1 +573,1 @@\n-    return;\n+    return false;\n@@ -577,3 +576,3 @@\n-    if (strcasestr(line, \"KVM\") != 0) {\n-      Abstract_VM_Version::_detected_virtualization = KVM;\n-      break;\n+    if (strcasestr(line, virt1) != 0) {\n+      fclose(fp);\n+      return 1;\n@@ -581,3 +580,3 @@\n-    if (strcasestr(line, \"VMware\") != 0) {\n-      Abstract_VM_Version::_detected_virtualization = VMWare;\n-      break;\n+    if (virt2 != NULL && strcasestr(line, virt2) != 0) {\n+      fclose(fp);\n+      return 2;\n@@ -587,0 +586,20 @@\n+  return 0;\n+}\n+#endif\n+\n+void VM_Version::check_virtualizations() {\n+#if defined(LINUX)\n+  const char* pname_file = \"\/sys\/devices\/virtual\/dmi\/id\/product_name\";\n+  const char* tname_file = \"\/sys\/hypervisor\/type\";\n+  int resp = check_info_file(pname_file, \"KVM\", \"VMWare\");\n+  if (resp == 1) {\n+    Abstract_VM_Version::_detected_virtualization = KVM;\n+    return;\n+  }\n+  if (resp == 2) {\n+    Abstract_VM_Version::_detected_virtualization = VMWare;\n+    return;\n+  }\n+  if (check_info_file(tname_file, \"Xen\", NULL) == 1) {\n+    Abstract_VM_Version::_detected_virtualization = XenHVM;\n+  }\n","filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp","additions":30,"deletions":11,"binary":false,"changes":41,"status":"modified"}]}