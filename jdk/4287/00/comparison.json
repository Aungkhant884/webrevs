{"files":[{"patch":"@@ -25,1 +25,1 @@\n- * @test\n+ * @test id=default-cl\n@@ -28,1 +28,0 @@\n- * @bug 8267347\n@@ -40,0 +39,16 @@\n+\/**\n+ * @test id=custom-cl\n+ * @requires vm.cds.custom.loaders\n+ * @summary Test class loader constraint checks for archived classes (dynamic archive) with custom class loader\n+ * @bug 8267347\n+ * @library \/test\/lib\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\n+ * @modules java.base\/jdk.internal.misc\n+ *          jdk.httpserver\n+ * @build sun.hotspot.WhiteBox\n+ * @run driver jdk.test.lib.helpers.ClassFileInstaller sun.hotspot.WhiteBox\n+ * @run main\/othervm -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -Xbootclasspath\/a:. DynamicLoaderConstraintsTest custom\n+ *\/\n+\n@@ -66,0 +81,6 @@\n+    \/*\n+     * useCustomLoader: if true, load the LoaderConstraintsApp in a custom loader before executing it.\n+     *                  if false, LoaderConstraintsApp will be loaded by the built-in AppClassLoader.\n+     *\/\n+    static boolean useCustomLoader;\n+\n@@ -67,0 +88,1 @@\n+        useCustomLoader = (args.length != 0);\n@@ -72,5 +94,1 @@\n-        doTest(false, false);\n-        doTest(true,  false);\n-\n-        if (!Platform.isWindows()) {\n-            \/\/ custom loaders are not supported on Windows yet.\n+        if (useCustomLoader) {\n@@ -78,2 +96,0 @@\n-            doTest(false, true);\n-            doTest(true,  true);\n@@ -81,0 +97,2 @@\n+        doTest(false);\n+        doTest(true);\n@@ -92,3 +110,0 @@\n-     *\n-     * useCustomLoader: if true, load the LoaderConstraintsApp in a custom loader before executing it.\n-     *                  if false, LoaderConstraintsApp will be loaded by the built-in AppClassLoader.\n@@ -96,1 +111,1 @@\n-  static void doTest(boolean errorInDump, boolean useCustomLoader) throws Exception  {\n+  static void doTest(boolean errorInDump) throws Exception  {\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/loaderConstraints\/DynamicLoaderConstraintsTest.java","additions":28,"deletions":13,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -25,1 +25,1 @@\n- * @test\n+ * @test id=default-cl\n@@ -28,1 +28,0 @@\n- * @bug 8267347 8267754\n@@ -37,0 +36,14 @@\n+\/**\n+ * @test id=custom-cl\n+ * @requires vm.cds.custom.loaders\n+ * @summary Test class loader constraint checks for archived classes with custom class loader\n+ * @bug 8267347\n+ * @library \/test\/lib\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\n+ *          \/test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\n+ * @modules java.base\/jdk.internal.misc\n+ *          jdk.httpserver\n+ * @run driver LoaderConstraintsTest custom\n+ *\/\n+\n+\n@@ -112,2 +125,3 @@\n-        doTest();\n-        if (Platform.areCustomLoadersSupportedForCDS()) {\n+        if (args.length == 0) {\n+            doTest();\n+        } else {\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/loaderConstraints\/LoaderConstraintsTest.java","additions":18,"deletions":4,"binary":false,"changes":22,"status":"modified"}]}