{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -626,5 +626,0 @@\n-                case '@':\n-                    if (newline)\n-                        break loop;\n-                    \/\/ fallthrough\n-\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/parser\/DocCommentParser.java","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -898,0 +898,5 @@\n+            var annos = (path.getLeaf() instanceof MethodTree m)\n+                    ? m.getModifiers().getAnnotations().toString()\n+                    : \"\";\n+            boolean normalizeTags = !annos.equals(\"@NormalizeTags(false)\");\n+\n@@ -899,1 +904,1 @@\n-            String normRaw = normalize(raw);\n+            String normRaw = normalize(raw, normalizeTags);\n@@ -916,2 +921,9 @@\n-         * Normalize white space in places where the tree does not preserve it.\n-         * Maintain contents of at-code and at-literal inline tags.\n+         * Normalize whitespace in places where the tree does not preserve it.\n+         * Maintain contents of inline tags unless {@code normalizeTags} is\n+         * {@code false}. This should normally be {@code true}, but should be\n+         * set to {@code false} when there is syntactically invalid content\n+         * that might resemble an inline tag, but which is not so.\n+         *\n+         * @param s the comment text to be normalized\n+         * @param normalizeTags whether to normalize inline tags\n+         * @return the normalized content\n@@ -919,1 +931,1 @@\n-        String normalize(String s) {\n+        String normalize(String s, boolean normalizeTags) {\n@@ -922,1 +934,1 @@\n-            Pattern p = Pattern.compile(\"\\\\{@(code|literal)( )?\");\n+            Pattern p = Pattern.compile(\"(?i)\\\\{@([a-z][a-z0-9.:-]*)( )?\");\n@@ -925,4 +937,6 @@\n-            while (m.find(start)) {\n-                sb.append(normalizeFragment(s2.substring(start, m.start())));\n-                sb.append(m.group().trim());\n-                start = copyLiteral(s2, m.end(), sb);\n+            if (normalizeTags) {\n+                while (m.find(start)) {\n+                    sb.append(normalizeFragment(s2.substring(start, m.start())));\n+                    sb.append(m.group().trim());\n+                    start = copyLiteral(s2, m.end(), sb);\n+                }\n@@ -931,1 +945,3 @@\n-            return sb.toString();\n+            return sb.toString()\n+                    .replaceAll(\"(?i)\\\\{@([a-z][a-z0-9.:-]*)\\\\s+}\", \"{@$1}\")\n+                    .replaceAll(\"(\\\\{@value\\\\s+[^}]+)\\\\s+(})\", \"$1$2\");\n@@ -935,4 +951,1 @@\n-            return s.replaceAll(\"\\\\{@docRoot\\\\s+}\", \"{@docRoot}\")\n-                    .replaceAll(\"\\\\{@inheritDoc\\\\s+}\", \"{@inheritDoc}\")\n-                    .replaceAll(\"(\\\\{@value\\\\s+[^}]+)\\\\s+(})\", \"$1$2\")\n-                    .replaceAll(\"\\n[ \\t]+@\", \"\\n@\");\n+            return s.replaceAll(\"\\n[ \\t]+@\", \"\\n@\");\n@@ -945,1 +958,1 @@\n-                if (i == start && !Character.isWhitespace(ch)) {\n+                if (i == start && !Character.isWhitespace(ch) && ch != '}') {\n","filename":"test\/langtools\/tools\/javac\/doctree\/DocCommentTester.java","additions":29,"deletions":16,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -244,0 +244,1 @@\n+    @NormalizeTags(false) \/\/ see DocCommentTester.PrettyChecker\n","filename":"test\/langtools\/tools\/javac\/doctree\/IndexTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7021614 8078320 8273244 8284908\n+ * @bug 7021614 8078320 8273244 8284908 8301201\n@@ -185,0 +185,37 @@\n+*\/\n+\n+    \/**\n+     * {@code\n+     * abc\n+     * @def\n+     * ghi\n+     * }\n+     *\/\n+    void inline_text_at() { }\n+\/*\n+DocComment[DOC_COMMENT, pos:1\n+  firstSentence: 1\n+    Literal[CODE, pos:1, |_abc|_@def|_ghi|_]\n+  body: empty\n+  block tags: empty\n+]\n+*\/\n+\n+    \/**\n+     * {@tag abc\n+     * @def\n+     * ghi\n+     * }\n+     *\/\n+    void inline_content_at() { }\n+\/*\n+DocComment[DOC_COMMENT, pos:1\n+  firstSentence: 1\n+    UnknownInlineTag[UNKNOWN_INLINE_TAG, pos:1\n+      tag:tag\n+      content: 1\n+        Text[TEXT, pos:7, abc|_@def|_ghi|_]\n+    ]\n+  body: empty\n+  block tags: empty\n+]\n","filename":"test\/langtools\/tools\/javac\/doctree\/TagTest.java","additions":39,"deletions":2,"binary":false,"changes":41,"status":"modified"}]}