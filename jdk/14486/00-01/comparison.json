{"files":[{"patch":"@@ -142,5 +142,0 @@\n-static void do_trace_pagesize(const char* description, size_t req_size, size_t req_page_size, const ReservedSpace* rs) {\n-  os::trace_page_sizes_for_requested_size(description, req_size, rs->page_size(),  req_page_size,\n-                                          rs->base(), rs->size());\n-}\n-\n@@ -200,1 +195,2 @@\n-  do_trace_pagesize(\"Heap\", max_byte_size, heap_alignment, &heap_rs);\n+  os::trace_page_sizes_for_requested_size(\"Heap\", max_byte_size, heap_alignment,\n+                                          heap_rs.base(), heap_rs.size(), heap_rs.page_size());\n@@ -251,1 +247,2 @@\n-  do_trace_pagesize(\"Mark Bitmap\", bitmap_size_orig, bitmap_page_size, &bitmap);\n+  os::trace_page_sizes_for_requested_size(\"Mark Bitmap\", bitmap_size_orig, bitmap_page_size,\n+                                          bitmap.base(), bitmap.size(), bitmap.page_size());\n@@ -268,1 +265,2 @@\n-    do_trace_pagesize(\"Verify Bitmap\", bitmap_size_orig, bitmap_page_size, &bitmap);\n+    os::trace_page_sizes_for_requested_size(\"Verify Bitmap\", bitmap_size_orig, bitmap_page_size,\n+                                            verify_bitmap.base(), verify_bitmap.size(), verify_bitmap.page_size());\n@@ -281,1 +279,2 @@\n-  do_trace_pagesize(\"Aux Bitmap\", bitmap_size_orig, bitmap_page_size, &bitmap);\n+  os::trace_page_sizes_for_requested_size(\"Aux Bitmap\", bitmap_size_orig, bitmap_page_size,\n+                                          aux_bitmap.base(), aux_bitmap.size(), aux_bitmap.page_size());\n@@ -296,1 +295,2 @@\n-  do_trace_pagesize(\"Region Storage\", region_storage_size_orig, region_page_size, &region_storage);\n+  os::trace_page_sizes_for_requested_size(\"Region Storage\", region_storage_size_orig, region_page_size,\n+                                          region_storage.base(), region_storage.size(), region_storage.page_size());\n@@ -307,2 +307,3 @@\n-    size_t cset_align = MAX2<size_t>(os::vm_page_size(), os::vm_allocation_granularity());\n-    size_t cset_size = align_up(((size_t) sh_rs.base() + sh_rs.size()) >> ShenandoahHeapRegion::region_size_bytes_shift(), cset_align);\n+    const size_t cset_align = MAX2<size_t>(os::vm_page_size(), os::vm_allocation_granularity());\n+    const size_t cset_size = align_up(((size_t) sh_rs.base() + sh_rs.size()) >> ShenandoahHeapRegion::region_size_bytes_shift(), cset_align);\n+    const size_t cset_page_size = os::vm_page_size();\n@@ -317,1 +318,1 @@\n-      ReservedSpace cset_rs(cset_size, cset_align, os::vm_page_size(), req_addr);\n+      ReservedSpace cset_rs(cset_size, cset_align, cset_page_size, req_addr);\n@@ -331,1 +332,2 @@\n-    do_trace_pagesize(\"Collection Set\", cset_size, os::vm_page_size(), rs);\n+    os::trace_page_sizes_for_requested_size(\"Collection Set\", cset_size, cset_page_size,\n+                                            rs->base(), rs->size(), rs->page_size());\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":16,"deletions":14,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-*\/\n+ *\/\n@@ -82,1 +82,1 @@\n-*\/\n+ *\/\n@@ -94,1 +94,13 @@\n-*\/\n+ *\/\n+\n+\/*\n+ * @test id=Shenandoah\n+ * @summary Run tests with ShenandoahGC\n+ * @library \/test\/lib\n+ * @build jdk.test.lib.Platform\n+ * @requires os.family == \"linux\"\n+ * @requires vm.gc.Shenandoah\n+ * @run main\/othervm -XX:+AlwaysPreTouch -Xmx128m -Xlog:pagesize:ps-%p.log -XX:+UseShenandoahGC TestTracePageSizes\n+ * @run main\/othervm -XX:+AlwaysPreTouch -Xmx128m -Xlog:pagesize:ps-%p.log -XX:+UseShenandoahGC -XX:+UseLargePages TestTracePageSizes\n+ * @run main\/othervm -XX:+AlwaysPreTouch -Xmx128m -Xlog:pagesize:ps-%p.log -XX:+UseShenandoahGC -XX:+UseTransparentHugePages TestTracePageSizes\n+ *\/\n","filename":"test\/hotspot\/jtreg\/runtime\/os\/TestTracePageSizes.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"}]}