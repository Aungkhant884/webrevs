{"files":[{"patch":"@@ -824,1 +824,1 @@\n-    id = WorkerThread::current()->id();\n+    id = WorkerThread::worker_id();\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -62,1 +62,1 @@\n-  \/\/ Get worker id.\n+  \/\/ Get and set worker id.\n@@ -64,0 +64,1 @@\n+  WorkerThread::set_worker_id(worker_id);\n@@ -94,1 +95,1 @@\n-WorkerThread* WorkerThreads::create_worker(uint id) {\n+WorkerThread* WorkerThreads::create_worker(uint name_suffix) {\n@@ -99,1 +100,1 @@\n-  WorkerThread* const worker = new WorkerThread(_name, id, &_dispatcher);\n+  WorkerThread* const worker = new WorkerThread(_name, name_suffix, &_dispatcher);\n@@ -106,0 +107,2 @@\n+  on_create_worker(worker);\n+\n@@ -149,4 +152,5 @@\n-WorkerThread::WorkerThread(const char* name_prefix, uint id, WorkerTaskDispatcher* dispatcher) :\n-    _dispatcher(dispatcher),\n-    _id(id) {\n-  set_name(\"%s#%d\", name_prefix, id);\n+THREAD_LOCAL uint WorkerThread::_worker_id = UINT_MAX;\n+\n+WorkerThread::WorkerThread(const char* name_prefix, uint name_suffix, WorkerTaskDispatcher* dispatcher) :\n+    _dispatcher(dispatcher) {\n+  set_name(\"%s#%u\", name_prefix, name_suffix);\n","filename":"src\/hotspot\/share\/gc\/shared\/workerThread.cpp","additions":11,"deletions":7,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -94,0 +94,2 @@\n+  WorkerThread* create_worker(uint name_suffix);\n+\n@@ -95,1 +97,1 @@\n-  virtual WorkerThread* create_worker(uint id);\n+  virtual void on_create_worker(WorkerThread* worker) {}\n@@ -120,0 +122,2 @@\n+  friend class WorkerTaskDispatcher;\n+\n@@ -121,2 +125,1 @@\n-  WorkerTaskDispatcher* const _dispatcher;\n-  const uint                  _id;\n+  static THREAD_LOCAL uint _worker_id;\n@@ -124,4 +127,1 @@\n-public:\n-  static WorkerThread* current() {\n-    return WorkerThread::cast(Thread::current());\n-  }\n+  WorkerTaskDispatcher* const _dispatcher;\n@@ -129,4 +129,1 @@\n-  static WorkerThread* cast(Thread* t) {\n-    assert(t->is_Worker_thread(), \"incorrect cast to WorkerThread\");\n-    return static_cast<WorkerThread*>(t);\n-  }\n+  static void set_worker_id(uint worker_id) { _worker_id = worker_id; }\n@@ -134,1 +131,2 @@\n-  WorkerThread(const char* name_prefix, uint id, WorkerTaskDispatcher* dispatcher);\n+public:\n+  static uint worker_id() { return _worker_id; }\n@@ -136,1 +134,1 @@\n-  uint id() const                        { return _id; }\n+  WorkerThread(const char* name_prefix, uint which, WorkerTaskDispatcher* dispatcher);\n","filename":"src\/hotspot\/share\/gc\/shared\/workerThread.hpp","additions":11,"deletions":13,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -74,2 +74,1 @@\n-WorkerThread* ShenandoahWorkerThreads::create_worker(uint id) {\n-  WorkerThread* worker = WorkerThreads::create_worker(id);\n+void ShenandoahWorkerThreads::on_create_worker(WorkerThread* worker) {\n@@ -80,1 +79,0 @@\n-  return worker;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahWorkGroup.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -63,1 +63,0 @@\n-  \/\/ Create a GC worker.\n@@ -65,1 +64,1 @@\n-  WorkerThread* create_worker(uint id);\n+  void on_create_worker(WorkerThread* worker);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahWorkGroup.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}