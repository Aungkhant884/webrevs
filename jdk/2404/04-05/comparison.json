{"files":[{"patch":"@@ -67,1 +67,1 @@\n-        boolean match = true;\n+        int match = 0;\n@@ -69,1 +69,1 @@\n-            match &= (ivAndLen[i] == iv[i]);\n+            match |= (ivAndLen[i] ^ iv[i]);\n@@ -71,1 +71,1 @@\n-        if (!match) {\n+        if (match != 0) {\n@@ -78,1 +78,1 @@\n-                outLen <<= SEMI_BLKSIZE;\n+                outLen <<= 8;\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/AESKeyWrapPadded.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -247,1 +247,4 @@\n-        Cipher c = Cipher.getInstance(algo, \"SunJCE\");\n+        Cipher c1 = Cipher.getInstance(algo, \"SunJCE\");\n+        Cipher c2 = Cipher.getInstance(algo, \"SunJCE\");\n+        Cipher c3 = Cipher.getInstance(algo, \"SunJCE\");\n+\n@@ -252,1 +255,0 @@\n-        c.init(Cipher.WRAP_MODE, cipherKey);\n@@ -255,0 +257,7 @@\n+        c1.init(Cipher.WRAP_MODE, cipherKey);\n+        IvParameterSpec ivSpec = new IvParameterSpec(c1.getIV());\n+        c2.init(Cipher.WRAP_MODE, cipherKey, ivSpec);\n+        AlgorithmParameters params = AlgorithmParameters.getInstance(\"AES\");\n+        params.init(ivSpec);\n+        c3.init(Cipher.WRAP_MODE, cipherKey, params);\n+\n@@ -256,1 +265,4 @@\n-        byte[] wrapped = c.wrap(toBeWrappedKey);\n+        byte[] wrapped = c1.wrap(toBeWrappedKey);\n+        byte[] wrapped2 = c2.wrap(toBeWrappedKey);\n+        byte[] wrapped3 = c3.wrap(toBeWrappedKey);\n+\n@@ -259,2 +271,4 @@\n-        if (!Arrays.equals(wrapped, expectedVal)) {\n-            throw new Exception(\"Wrap failed; got different result\");\n+        if (!Arrays.equals(wrapped, expectedVal) ||\n+                !Arrays.equals(wrapped2, expectedVal) ||\n+                !Arrays.equals(wrapped3, expectedVal)) {\n+            throw new Exception(\"Wrap test failed; got different result\");\n@@ -264,3 +278,14 @@\n-        c.init(Cipher.UNWRAP_MODE, cipherKey);\n-        Key unwrapped = c.unwrap(wrapped, \"AES\", Cipher.SECRET_KEY);\n-        if (!Arrays.equals(unwrapped.getEncoded(), dataVal)) {\n+        c1.init(Cipher.UNWRAP_MODE, cipherKey);\n+        ivSpec = new IvParameterSpec(c1.getIV());\n+        c2.init(Cipher.UNWRAP_MODE, cipherKey, ivSpec);\n+        params = AlgorithmParameters.getInstance(\"AES\");\n+        params.init(ivSpec);\n+        c3.init(Cipher.UNWRAP_MODE, cipherKey, params);\n+\n+        Key unwrapped = c1.unwrap(wrapped, \"AES\", Cipher.SECRET_KEY);\n+        Key unwrapped2 = c2.unwrap(wrapped, \"AES\", Cipher.SECRET_KEY);\n+        Key unwrapped3 = c3.unwrap(wrapped, \"AES\", Cipher.SECRET_KEY);\n+\n+        if (!Arrays.equals(unwrapped.getEncoded(), dataVal) ||\n+                !Arrays.equals(unwrapped2.getEncoded(), dataVal) ||\n+                !Arrays.equals(unwrapped3.getEncoded(), dataVal)) {\n@@ -281,1 +306,3 @@\n-        Cipher c = Cipher.getInstance(algo, \"SunJCE\");\n+        Cipher c1 = Cipher.getInstance(algo, \"SunJCE\");\n+        Cipher c2 = Cipher.getInstance(algo, \"SunJCE\");\n+        Cipher c3 = Cipher.getInstance(algo, \"SunJCE\");\n@@ -287,1 +314,6 @@\n-        c.init(Cipher.ENCRYPT_MODE, cipherKey);\n+        c1.init(Cipher.ENCRYPT_MODE, cipherKey);\n+        IvParameterSpec ivSpec = new IvParameterSpec(c1.getIV());\n+        c2.init(Cipher.ENCRYPT_MODE, cipherKey, ivSpec);\n+        AlgorithmParameters params = AlgorithmParameters.getInstance(\"AES\");\n+        params.init(ivSpec);\n+        c3.init(Cipher.ENCRYPT_MODE, cipherKey, params);\n@@ -290,3 +322,6 @@\n-        byte[] ct11 = c.update(dataVal);\n-        byte[] ct12 = c.doFinal();\n-        byte[] ct2 = c.doFinal(dataVal);\n+        byte[] ct11 = c1.update(dataVal);\n+        byte[] ct12 = c1.doFinal();\n+        byte[] ct2 = c1.doFinal(dataVal);\n+        byte[] ct22 = c2.doFinal(dataVal);\n+        byte[] ct32 = c3.doFinal(dataVal);\n+\n@@ -296,1 +331,3 @@\n-            !Arrays.equals(ct2, expectedVal)) {\n+                !Arrays.equals(ct2, expectedVal) ||\n+                !Arrays.equals(ct22, expectedVal) ||\n+                !Arrays.equals(ct32, expectedVal)) {\n@@ -301,4 +338,13 @@\n-        c.init(Cipher.DECRYPT_MODE, cipherKey);\n-        byte[] pt11 = c.update(ct12);\n-        byte[] pt12 = c.doFinal();\n-        byte[] pt2 = c.doFinal(ct2);\n+        c1.init(Cipher.DECRYPT_MODE, cipherKey);\n+        ivSpec = new IvParameterSpec(c1.getIV());\n+        c2.init(Cipher.DECRYPT_MODE, cipherKey, ivSpec);\n+        params = AlgorithmParameters.getInstance(\"AES\");\n+        params.init(ivSpec);\n+        c3.init(Cipher.DECRYPT_MODE, cipherKey, params);\n+\n+        byte[] pt11 = c1.update(ct12);\n+        byte[] pt12 = c1.doFinal();\n+        byte[] pt2 = c1.doFinal(ct2);\n+        byte[] pt22 = c2.doFinal(ct2);\n+        byte[] pt32 = c3.doFinal(ct2);\n+\n@@ -306,1 +352,2 @@\n-            !Arrays.equals(pt2, dataVal)) {\n+                !Arrays.equals(pt2, dataVal) || !Arrays.equals(pt22, dataVal) ||\n+                !Arrays.equals(pt32, dataVal)) {\n","filename":"test\/jdk\/com\/sun\/crypto\/provider\/Cipher\/KeyWrap\/NISTWrapKAT.java","additions":66,"deletions":19,"binary":false,"changes":85,"status":"modified"}]}