{"files":[{"patch":"@@ -197,4 +197,5 @@\n-    jlong mem_limit, mem_usage;\n-    mem_limit = os::physical_memory();\n-    if (mem_limit > 0 && (mem_usage = OSContainer::memory_usage_in_bytes()) < 1) {\n-      log_debug(os, container)(\"container memory usage failed: \" JLONG_FORMAT \", using host value\", mem_usage);\n+    jlong mem_limit, mem_usage, host_mem;\n+    host_mem = Linux::physical_memory();\n+    mem_limit = OSContainer::memory_limit_in_bytes();\n+    if (mem_limit > host_mem) {\n+      mem_limit = -1; \/\/ bail out of container code\n@@ -202,4 +203,9 @@\n-    if (mem_limit > 0 && mem_usage > 0 ) {\n-      avail_mem = mem_limit > mem_usage ? (julong)mem_limit - (julong)mem_usage : 0;\n-      log_trace(os)(\"available container memory: \" JULONG_FORMAT, avail_mem);\n-      return avail_mem;\n+    if (mem_limit > 0) {\n+      if (mem_usage = OSContainer::memory_usage_in_bytes() < 1) {\n+        log_debug(os, container)(\"container memory usage failed: \" JLONG_FORMAT \", using host value\", mem_usage);\n+      }\n+      if (mem_usage > 0) {\n+        avail_mem = mem_limit > mem_usage ? (julong)mem_limit - (julong)mem_usage : 0;\n+        log_trace(os)(\"available container memory: \" JULONG_FORMAT, avail_mem);\n+        return avail_mem;\n+      }\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":14,"deletions":8,"binary":false,"changes":22,"status":"modified"}]}