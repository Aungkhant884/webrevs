{"files":[{"patch":"@@ -220,0 +220,1 @@\n+  log_debug(os, container)(\"total physical memory: \" JLONG_FORMAT, phys_mem);\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -45,2 +45,0 @@\n-import java.lang.management.ManagementFactory;\n-\n@@ -105,4 +103,0 @@\n-    \/\/\n-    \/\/ let the host's physical memory be P; request 2P memory in the container.\n-    \/\/ set java's InitialRAMPercentage to 25%, and check the calculated InitialHeapSize\n-    \/\/ to see if that was calculated relative to P (P\/4) or 2P (P\/2).\n@@ -112,5 +106,1 @@\n-        com.sun.management.OperatingSystemMXBean os = (com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();\n-        long realMem = os.getTotalMemorySize();\n-        long badMem = 2 * realMem;\n-\n-        Common.logNewTestCase(\"bad memory limit: \" + badMem);\n+        Common.logNewTestCase(\"container memory limit exceeds physical memory\");\n@@ -119,3 +109,0 @@\n-        opts.addDockerOpts(\"--memory\", Long.toString(badMem));\n-        opts.addJavaOpts(\"-XX:InitialRAMPercentage=25.0\");\n-        opts.addJavaOpts(\"-XX:+PrintFlagsFinal\");\n@@ -123,2 +110,8 @@\n-        \/\/ one significant digit, to avoid precision\/rounding issues\n-        String goodDigit = Long.toString(realMem\/4).substring(0,1);\n+        \/\/ first run: establish physical memory in test environment and derive\n+        \/\/ a bad value one power of ten larger\n+        String goodMem = Common.run(opts).firstMatch(\"total physical memory: (\\\\d+)\", 1);\n+        String badMem = goodMem + \"0\";\n+\n+        \/\/ second run: set a container memory limit to the bad value\n+        opts = Common.newOpts(imageName)\n+            .addDockerOpts(\"--memory\", badMem);\n@@ -126,1 +119,1 @@\n-            .shouldMatch(\"size_t InitialHeapSize.*= \"+goodDigit);\n+            .shouldMatch(\"container memory limit ignored: \"+badMem+\", using host value \"+goodMem);\n","filename":"test\/hotspot\/jtreg\/containers\/docker\/TestMemoryAwareness.java","additions":10,"deletions":17,"binary":false,"changes":27,"status":"modified"}]}