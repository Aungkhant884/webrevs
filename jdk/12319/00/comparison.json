{"files":[{"patch":"@@ -2865,1 +2865,1 @@\n-            boolean waiting = false;\n+            Thread current = Thread.currentThread(), w;\n@@ -2869,2 +2869,2 @@\n-                        if (waiting)\n-                            waiter = null;\n+                        if (waiter == current)\n+                            U.compareAndSetReference(this, WAITERTHREAD, current, null);\n@@ -2874,7 +2874,5 @@\n-                else if ((s & WAITER) == 0) {\n-                    if (U.compareAndSetInt(this, LOCKSTATE, s, s | WAITER)) {\n-                        waiting = true;\n-                        waiter = Thread.currentThread();\n-                    }\n-                }\n-                else if (waiting)\n+                else if ((s & WAITER) == 0)\n+                    U.compareAndSetInt(this, LOCKSTATE, s, s | WAITER);\n+                else if ((w = waiter) == null)\n+                    U.compareAndSetReference(this, WAITERTHREAD, null, current);\n+                else if (w == current)\n@@ -3299,0 +3297,2 @@\n+        private static final long WAITERTHREAD\n+            = U.objectFieldOffset(TreeBin.class, \"waiter\");\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ConcurrentHashMap.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"}]}