{"files":[{"patch":"@@ -55,0 +55,1 @@\n+import sun.awt.AWTAccessor;\n@@ -137,0 +138,4 @@\n+    static {\n+        AWTAccessor.setICC_ProfileAccessor(ICC_Profile::cmmProfile);\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/color\/ICC_Profile.java","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+import java.awt.color.ICC_Profile;\n@@ -53,0 +54,2 @@\n+import sun.java2d.cmm.Profile;\n+\n@@ -70,0 +73,10 @@\n+    \/*\n+     * An interface of accessor for the java.awt.color.ICC_Profile class.\n+     *\/\n+    public interface ICC_ProfileAccessor {\n+        \/*\n+         * Activates and returns the deferred standard profiles.\n+         *\/\n+        Profile cmmProfile(ICC_Profile profile);\n+    }\n+\n@@ -834,0 +847,1 @@\n+    private static ICC_ProfileAccessor iccProfileAccessor;\n@@ -866,0 +880,17 @@\n+    \/*\n+     * Set an accessor object for the java.awt.color.ICC_Profile class.\n+     *\/\n+    public static void setICC_ProfileAccessor(ICC_ProfileAccessor ipa) {\n+        iccProfileAccessor = ipa;\n+    }\n+\n+    \/*\n+     * Retrieve the accessor object for the java.awt.color.ICC_Profile class.\n+     *\/\n+    public static ICC_ProfileAccessor getICC_ProfileAccessor() {\n+        if (iccProfileAccessor == null) {\n+            ensureClassInitialized(ICC_Profile.class);\n+        }\n+        return iccProfileAccessor;\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/sun\/awt\/AWTAccessor.java","additions":32,"deletions":1,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -56,1 +56,1 @@\n-    private static LCMSProfile getLcmsProfile(Profile p) {\n+    static LCMSProfile getLcmsProfile(Profile p) {\n@@ -98,2 +98,0 @@\n-    static synchronized native LCMSProfile getProfileID(ICC_Profile profile);\n-\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMS.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -49,0 +49,1 @@\n+import sun.awt.AWTAccessor;\n@@ -88,0 +89,1 @@\n+        var acc = AWTAccessor.getICC_ProfileAccessor();\n@@ -90,1 +92,1 @@\n-            lcmsProfiles[i] = LCMS.getProfileID(profiles[i]);\n+            lcmsProfiles[i] = LCMS.getLcmsProfile(acc.cmmProfile(profiles[i]));\n","filename":"src\/java.desktop\/share\/classes\/sun\/java2d\/cmm\/lcms\/LCMSTransform.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -560,34 +560,0 @@\n-\/*\n- * Class:     sun_java2d_cmm_lcms_LCMS\n- * Method:    getProfileID\n- * Signature: (Ljava\/awt\/color\/ICC_Profile;)Lsun\/java2d\/cmm\/lcms\/LCMSProfile;\n- *\/\n-JNIEXPORT jobject JNICALL Java_sun_java2d_cmm_lcms_LCMS_getProfileID\n-  (JNIEnv *env, jclass cls, jobject pf)\n-{\n-    if (pf == NULL) {\n-        return NULL;\n-    }\n-    jclass pcls = (*env)->GetObjectClass(env, pf);\n-    if (pcls == NULL) {\n-        return NULL;\n-    }\n-    jmethodID mid = (*env)->GetMethodID(env, pcls, \"cmmProfile\",\n-                                        \"()Lsun\/java2d\/cmm\/Profile;\");\n-    if (mid == NULL) {\n-        return NULL;\n-    }\n-    jobject cmmProfile = (*env)->CallObjectMethod(env, pf, mid);\n-    if ((*env)->ExceptionCheck(env)) {\n-        return NULL;\n-    }\n-    jclass lcmsPCls = (*env)->FindClass(env, \"sun\/java2d\/cmm\/lcms\/LCMSProfile\");\n-    if (lcmsPCls == NULL) {\n-        return NULL;\n-    }\n-    if ((*env)->IsInstanceOf(env, cmmProfile, lcmsPCls)) {\n-        return cmmProfile;\n-    }\n-    return NULL;\n-}\n-\n","filename":"src\/java.desktop\/share\/native\/liblcms\/LCMS.c","additions":0,"deletions":34,"binary":false,"changes":34,"status":"modified"}]}