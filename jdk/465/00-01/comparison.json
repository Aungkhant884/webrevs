{"files":[{"patch":"@@ -2293,2 +2293,1 @@\n-WB_ENTRY(jboolean, WB_WaitUnsafe(JNIEnv* env, jobject wb, jint time))\n-    SafepointStateTracker tracker = SafepointSynchronize::safepoint_state_tracker();\n+WB_ENTRY(void, WB_WaitUnsafe(JNIEnv* env, jobject wb, jint time))\n@@ -2296,1 +2295,0 @@\n-    return tracker.safepoint_state_changed();\n@@ -2550,1 +2548,1 @@\n-  {CC\"waitUnsafe\", CC\"(I)Z\",                          (void*)&WB_WaitUnsafe},\n+  {CC\"waitUnsafe\", CC\"(I)V\",                          (void*)&WB_WaitUnsafe},\n","filename":"src\/hotspot\/share\/prims\/whitebox.cpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,0 +2,1 @@\n+ * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -41,13 +42,0 @@\n-        if (args.length > 0) {\n-            Integer waitTime = Integer.parseInt(args[0]);\n-            WhiteBox wb = WhiteBox.getWhiteBox();\n-            while (!wb.waitUnsafe(waitTime)) {\n-                System.out.println(\"Waiting for safepoint\");\n-            }\n-            System.out.println(\"This message would occur after some time.\");\n-        } else {\n-            testWith(50, 1, 999);\n-        }\n-    }\n-\n-    public static void testWith(int sfpt_interval, int timeout_delay, int unsafe_wait) throws Exception {\n@@ -61,2 +49,2 @@\n-                \"-XX:SafepointTimeoutDelay=\" + timeout_delay,\n-                \"-XX:GuaranteedSafepointInterval=\" + sfpt_interval,\n+                \"-XX:SafepointTimeoutDelay=50\",\n+                \"-XX:GuaranteedSafepointInterval=1\",\n@@ -65,2 +53,2 @@\n-                \"TestAbortVMOnSafepointTimeout\",\n-                \"\" + unsafe_wait\n+                \"TestAbortVMOnSafepointTimeout$Test\",\n+                \"999\" \/* 999 is max unsafe sleep *\/\n@@ -81,0 +69,11 @@\n+\n+    public static class Test {\n+        public static void main(String[] args) throws Exception {\n+            Integer waitTime = Integer.parseInt(args[0]);\n+            WhiteBox wb = WhiteBox.getWhiteBox();\n+            \/\/ While no safepoint timeout.\n+            while (true) {\n+                wb.waitUnsafe(waitTime);\n+            }\n+        }\n+    }\n","filename":"test\/hotspot\/jtreg\/runtime\/Safepoint\/TestAbortVMOnSafepointTimeout.java","additions":16,"deletions":17,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -621,1 +621,1 @@\n-  public native boolean waitUnsafe(int time_ms);\n+  public native void waitUnsafe(int time_ms);\n","filename":"test\/lib\/sun\/hotspot\/WhiteBox.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}