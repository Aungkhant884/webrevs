{"files":[{"patch":"@@ -691,1 +691,4 @@\n-    Uncontrolled shutdown is, of course, an exception to this rule.\n+    Uncontrolled shutdown and Agent Start-Up failure\n+    (<internallink id=\"onload\"><code>Agent_OnLoad<\/code><\/internallink> and\n+    <internallink id=\"onattach\"><code>Agent_OnAttach<\/code><\/internallink>) are, of course,\n+    an exception to this rule.\n","filename":"src\/hotspot\/share\/prims\/jvmti.xml","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2667,3 +2667,1 @@\n-  size_t num_onattach_symbol_entries = ARRAY_SIZE(on_attach_symbols);\n-  const char *on_unload_symbols[] = AGENT_ONUNLOAD_SYMBOLS;\n-  size_t num_onunload_symbol_entries = ARRAY_SIZE(on_unload_symbols);\n+  size_t num_symbol_entries = ARRAY_SIZE(on_attach_symbols);\n@@ -2681,1 +2679,1 @@\n-  if (!os::find_builtin_agent(agent_lib, on_attach_symbols, num_onattach_symbol_entries)) {\n+  if (!os::find_builtin_agent(agent_lib, on_attach_symbols, num_symbol_entries)) {\n@@ -2705,3 +2703,0 @@\n-    JavaThread* THREAD = JavaThread::current();\n-    extern struct JavaVM_ main_vm;\n-\n@@ -2711,1 +2706,1 @@\n-       os::find_agent_function(agent_lib, false, on_attach_symbols, num_onattach_symbol_entries));\n+       os::find_agent_function(agent_lib, false, on_attach_symbols, num_symbol_entries));\n@@ -2722,0 +2717,1 @@\n+      JavaThread* THREAD = JavaThread::current();\n@@ -2723,0 +2719,1 @@\n+        extern struct JavaVM_ main_vm;\n@@ -2739,14 +2736,0 @@\n-        \/\/ Find the Agent_OnUnload function.\n-        Agent_OnUnload_t unload_entry = CAST_TO_FN_PTR(Agent_OnUnload_t,\n-                                                       os::find_agent_function(agent_lib,\n-                                                       false,\n-                                                       on_unload_symbols,\n-                                                       num_onunload_symbol_entries));\n-        \/\/ Invoke the Agent_OnUnload function\n-        if (unload_entry != NULL) {\n-          JvmtiThreadEventMark jem(THREAD);\n-          JvmtiJavaThreadEventTransition jet(THREAD);\n-\n-          (*unload_entry)(&main_vm);\n-        }\n-\n","filename":"src\/hotspot\/share\/prims\/jvmtiExport.cpp","additions":5,"deletions":22,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -43,5 +43,0 @@\n-\/\/ type for the Agent_OnUnload entry point\n-extern \"C\" {\n-  typedef void (JNICALL *Agent_OnUnload_t)(JavaVM *);\n-}\n-\n","filename":"src\/hotspot\/share\/prims\/jvmtiExport.hpp","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -3963,0 +3963,4 @@\n+extern \"C\" {\n+  typedef void (JNICALL *Agent_OnUnload_t)(JavaVM *);\n+}\n+\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-            \/\/ Check agent unloading\n+            \/\/ Check loaded libraries\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/jvmti\/AttachFailed\/AttachReturnError.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}