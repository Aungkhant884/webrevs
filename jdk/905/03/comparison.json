{"files":[{"patch":"@@ -2249,1 +2249,1 @@\n-      vm_exit_during_initialization(err_msg(\"Error in mapping Java heap at the given filesystem directory\"));\n+      vm_exit_during_initialization(\"Error in mapping Java heap at the given filesystem directory\");\n","filename":"src\/hotspot\/os\/aix\/os_aix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1913,1 +1913,1 @@\n-      vm_exit_during_initialization(err_msg(\"Error in mapping Java heap at the given filesystem directory\"));\n+      vm_exit_during_initialization(\"Error in mapping Java heap at the given filesystem directory\");\n","filename":"src\/hotspot\/os\/bsd\/os_bsd.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -4222,1 +4222,1 @@\n-      vm_exit_during_initialization(err_msg(\"Error in mapping Java heap at the given filesystem directory\"));\n+      vm_exit_during_initialization(\"Error in mapping Java heap at the given filesystem directory\");\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -363,1 +363,1 @@\n-    vm_exit_during_initialization(err_msg(\"Error in mapping Java heap at the given filesystem directory\"));\n+    vm_exit_during_initialization(\"Error in mapping Java heap at the given filesystem directory\");\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -3091,1 +3091,1 @@\n-      vm_exit_during_initialization(err_msg(\"Could not allocate sufficient disk space for Java heap\"));\n+      vm_exit_during_initialization(\"Could not allocate sufficient disk space for Java heap\");\n@@ -3094,1 +3094,1 @@\n-      vm_exit_during_initialization(err_msg(\"Error in mapping Java heap at the given filesystem directory\"));\n+      vm_exit_during_initialization(\"Error in mapping Java heap at the given filesystem directory\");\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -173,1 +173,1 @@\n-                err_msg(\"Bad package name\"));\n+                \"Bad package name\");\n@@ -330,1 +330,1 @@\n-                err_msg(\"Bad package name\"));\n+                \"Bad package name\");\n","filename":"src\/hotspot\/share\/classfile\/modules.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -163,1 +163,1 @@\n-  err_msg message(\"NonNMethodCodeHeapSize (\" SIZE_FORMAT \"K) + ProfiledCodeHeapSize (\" SIZE_FORMAT \"K)\"\n+  FormatBuffer<> message(\"NonNMethodCodeHeapSize (\" SIZE_FORMAT \"K) + ProfiledCodeHeapSize (\" SIZE_FORMAT \"K)\"\n","filename":"src\/hotspot\/share\/code\/codeCache.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -35,2 +35,2 @@\n-      err_msg message(\"GC mode needs -XX:+\" #name \" to work correctly\");    \\\n-      vm_exit_during_initialization(\"Error\", message);                      \\\n+      vm_exit_during_initialization(\"Error\",                                \\\n+              \"GC mode needs -XX:+\" #name \" to work correctly\");            \\\n@@ -43,2 +43,2 @@\n-      err_msg message(\"GC mode needs -XX:-\" #name \" to work correctly\");    \\\n-      vm_exit_during_initialization(\"Error\", message);                      \\\n+      vm_exit_during_initialization(\"Error\",                                \\\n+              \"GC mode needs -XX:-\" #name \" to work correctly\");            \\\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/mode\/shenandoahMode.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -155,1 +155,1 @@\n-        err_msg(\"Cannot call into HotSpot from JVMCI shared library without attaching current thread\")); \\\n+        \"Cannot call into HotSpot from JVMCI shared library without attaching current thread\"); \\\n@@ -166,1 +166,1 @@\n-        err_msg(\"Cannot call into HotSpot from JVMCI shared library without attaching current thread\")); \\\n+        \"Cannot call into HotSpot from JVMCI shared library without attaching current thread\"); \\\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCompilerToVM.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -61,2 +61,2 @@\n-  char* buffer() { return _buf; }\n-  int size() { return bufsz; }\n+  char* buffer() const { return _buf; }\n+  int size() const { return bufsz; }\n@@ -116,2 +116,24 @@\n-\/\/ Used to format messages.\n-typedef FormatBuffer<> err_msg;\n+template <size_t bufsz = FormatBufferBase::BufferSize>\n+class FormatErrBuffer : private FormatBuffer<bufsz> {\n+public:\n+  inline FormatErrBuffer(const char* format, ...) ATTRIBUTE_PRINTF(2, 3);\n+\n+  operator const char *() const { return FormatBuffer<bufsz>::buffer(); }\n+\n+  \/\/ Dummy overload preventing misuse of err_msg for a string without format arguments.\n+  \/\/ If compilation fails because of ambiguity between this and real constructor, you\n+  \/\/ could drop err_msg use at all.\n+  \/\/ It is also intentionally not defined to produce a link-time failure, in case of\n+  \/\/ (not sane) compiler selects this by some way.\n+  FormatErrBuffer(const char* msg);\n+};\n+\n+template <size_t bufsz>\n+FormatErrBuffer<bufsz>::FormatErrBuffer(const char * format, ...) : FormatBuffer<bufsz>() {\n+  va_list argp;\n+  va_start(argp, format);\n+  FormatBuffer<bufsz>::printv(format, argp);\n+  va_end(argp);\n+}\n+\n+typedef FormatErrBuffer<> err_msg;\n","filename":"src\/hotspot\/share\/utilities\/formatBuffer.hpp","additions":26,"deletions":4,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -180,1 +180,1 @@\n-    SCOPED_TRACE(err_msg(\"Running test with %u threads\", nthreads).buffer());\n+    SCOPED_TRACE((const char*)err_msg(\"Running test with %u threads\", nthreads));\n","filename":"test\/hotspot\/gtest\/gc\/shared\/test_oopStorage_parperf.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,1 +40,1 @@\n-#define log(...) SCOPED_TRACE(err_msg(__VA_ARGS__).buffer())\n+#define log(...) SCOPED_TRACE((const char*)err_msg(__VA_ARGS__))\n","filename":"test\/hotspot\/gtest\/utilities\/test_align.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}