{"files":[{"patch":"@@ -42,4 +42,1 @@\n-\/\/ Memory blocks are kept in linked lists. Each list\n-\/\/ contains blocks of only one size. There is a list for blocks of two words,\n-\/\/ for blocks of three words, etc. The list heads are kept in a vector,\n-\/\/ ordered by block size.\n+\/\/ Memory blocks are kept in a vector of linked lists of equi-sized blocks:\n@@ -47,1 +44,0 @@\n-\n@@ -106,0 +102,1 @@\n+  \/\/ Given a word size, returns the index of the list holding blocks of that size\n@@ -112,0 +109,1 @@\n+  \/\/ Given an index of a list, return the word size that list serves\n@@ -154,1 +152,1 @@\n-    Block* new_head = new(p)Block(old_head);\n+    Block* new_head = new (p) Block(old_head);\n","filename":"src\/hotspot\/share\/memory\/metaspace\/binList.hpp","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -44,2 +44,1 @@\n-\/\/  imposes a minimum size to the managed memory blocks.\n-\/\/  See get_raw_word_size_for_requested_word_size() (msCommon.hpp).\n+\/\/  imposes a minimum size to the managed memory blocks (1 word)\n","filename":"src\/hotspot\/share\/memory\/metaspace\/blockTree.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -231,1 +231,1 @@\n-  const size_t raw_word_size = get_raw_word_size_for_requested_word_size(requested_word_size);\n+  const size_t aligned_word_size = get_raw_word_size_for_requested_word_size(requested_word_size);\n@@ -235,1 +235,1 @@\n-    p = _fbl->remove_block(raw_word_size);\n+    p = _fbl->remove_block(aligned_word_size);\n@@ -249,1 +249,1 @@\n-  p = allocate_inner(raw_word_size);\n+  p = allocate_inner(aligned_word_size);\n@@ -272,1 +272,1 @@\n-MetaWord* MetaspaceArena::allocate_inner(size_t requested_word_size) {\n+MetaWord* MetaspaceArena::allocate_inner(size_t word_size) {\n@@ -275,0 +275,1 @@\n+  assert_is_aligned(word_size, metaspace::AllocationAlignmentWordSize);\n@@ -276,1 +277,0 @@\n-  const size_t raw_word_size = get_raw_word_size_for_requested_word_size(requested_word_size);\n@@ -287,2 +287,2 @@\n-    if (current_chunk()->free_words() < raw_word_size) {\n-      if (!attempt_enlarge_current_chunk(raw_word_size)) {\n+    if (current_chunk()->free_words() < word_size) {\n+      if (!attempt_enlarge_current_chunk(word_size)) {\n@@ -300,2 +300,2 @@\n-      if (!current_chunk()->ensure_committed_additional(raw_word_size)) {\n-        UL2(info, \"commit failure (requested size: \" SIZE_FORMAT \")\", raw_word_size);\n+      if (!current_chunk()->ensure_committed_additional(word_size)) {\n+        UL2(info, \"commit failure (requested size: \" SIZE_FORMAT \")\", word_size);\n@@ -308,1 +308,1 @@\n-      p = current_chunk()->allocate(raw_word_size);\n+      p = current_chunk()->allocate(word_size);\n@@ -318,1 +318,1 @@\n-    Metachunk* new_chunk = allocate_new_chunk(raw_word_size);\n+    Metachunk* new_chunk = allocate_new_chunk(word_size);\n@@ -321,1 +321,1 @@\n-          METACHUNK_FORMAT_ARGS(new_chunk), requested_word_size);\n+          METACHUNK_FORMAT_ARGS(new_chunk), word_size);\n@@ -323,1 +323,1 @@\n-      assert(new_chunk->free_below_committed_words() >= raw_word_size, \"Sanity\");\n+      assert(new_chunk->free_below_committed_words() >= word_size, \"Sanity\");\n@@ -334,1 +334,1 @@\n-      p = current_chunk()->allocate(raw_word_size);\n+      p = current_chunk()->allocate(word_size);\n@@ -337,1 +337,1 @@\n-      UL2(info, \"failed to allocate new chunk for requested word size \" SIZE_FORMAT \".\", requested_word_size);\n+      UL2(info, \"failed to allocate new chunk for requested word size \" SIZE_FORMAT \".\", word_size);\n@@ -345,1 +345,1 @@\n-    _total_used_words_counter->increment_by(raw_word_size);\n+    _total_used_words_counter->increment_by(word_size);\n","filename":"src\/hotspot\/share\/memory\/metaspace\/metaspaceArena.cpp","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-    static const size_t maxws;\n+  static const size_t maxws;\n","filename":"test\/hotspot\/gtest\/metaspace\/test_binlist.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -102,1 +102,1 @@\n-    size_t word_size = MAX2(_rgen_allocations.get(), size_t(1));\n+    size_t word_size = MAX2(_rgen_allocations.get(), _freeblocks.MinWordSize);\n","filename":"test\/hotspot\/gtest\/metaspace\/test_freeblocks.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}