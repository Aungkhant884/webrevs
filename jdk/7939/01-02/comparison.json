{"files":[{"patch":"@@ -3277,2 +3277,1 @@\n-    __ dup(as_FloatRegister($dst$$reg), __ T2S,\n-           as_FloatRegister($src$$reg));\n+    __ dup(as_FloatRegister($dst$$reg), __ T2S, as_FloatRegister($src$$reg));\n@@ -3290,2 +3289,1 @@\n-    __ dup(as_FloatRegister($dst$$reg), __ T4S,\n-           as_FloatRegister($src$$reg));\n+    __ dup(as_FloatRegister($dst$$reg), __ T4S, as_FloatRegister($src$$reg));\n@@ -3303,2 +3301,1 @@\n-    __ dup(as_FloatRegister($dst$$reg), __ T2D,\n-           as_FloatRegister($src$$reg));\n+    __ dup(as_FloatRegister($dst$$reg), __ T2D, as_FloatRegister($src$$reg));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon.ad","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -1555,2 +1555,2 @@\n-define(`VREPLICATE', `\n-instruct replicate$2$3$4`'(vec$5 dst, $6 ifelse($4, _imm, con, src))\n+define(`VREPLICATE_REG', `\n+instruct replicate$2$3`'(vec$4 dst, $5 src)\n@@ -1558,1 +1558,1 @@\n-  predicate(UseSVE == 0 && ifelse($7, `',\n+  predicate(UseSVE == 0 && ifelse($6, `',\n@@ -1561,2 +1561,2 @@\n-                            'n->as_Vector()->length() == $7)));\n-  match(Set dst (Replicate$3 ifelse($4, _imm, con, src)));\n+                            'n->as_Vector()->length() == $6)));\n+  match(Set dst (Replicate$3 src));\n@@ -1564,17 +1564,22 @@\n-  format %{ \"ifelse($1, mov, movi, $1)  $dst, $ifelse($4, _imm, con, src)`\\t# vector ('ifelse($3$4, S_imm, $2H, $2$3)`)\"' %}\n-  ins_encode %{\n-    __ $1(as_FloatRegister($dst$$reg), __ T$2$8,ifelse(\n-            `$3 $4', `B _imm', ` '$con$$constant & 0xff,\n-            `$3 $4', `S _imm', ` '$con$$constant & 0xffff,\n-            `$3 $4', `I _imm', ` '$con$$constant,\n-            `$3 $4', `L _imm', ` '$con$$constant,\n-            `$6', vRegF,`\n-           as_FloatRegister($src$$reg)',\n-            `$6', vRegD,`\n-           as_FloatRegister($src$$reg)',\n-           ` 'as_Register($src$$reg)));\n-  %}\n-  ins_pipe(ifelse($4, _imm,  vmovi_reg_imm,\n-                  $6, iRegIorL2I, v$1_reg_reg,\n-                  $6, iRegL, vdup_reg_reg,\n-                  $3, F, vdup_reg_freg, vdup_reg_dreg)`'ifelse($5, X, 128, 64));\n+  format %{ \"dup  $dst, $src\\t# vector ($2$3)\" %}\n+  ins_encode %{\n+    __ dup(as_FloatRegister($dst$$reg), __ T$2$1, $7($src$$reg));\n+  %}\n+  ins_pipe(ifelse($5, iRegIorL2I, vdup_reg_reg,\n+                  $5, iRegL, vdup_reg_reg,\n+                  $3, F, vdup_reg_freg, vdup_reg_dreg)`'ifelse($4, X, 128, 64));\n+%}')dnl\n+define(`VREPLICATE_IMM', `\n+instruct replicate$2$3_imm`'(vec$4 dst, $5 con)\n+%{\n+  predicate(UseSVE == 0 && ifelse($6, `',\n+                                  n->as_Vector()->length() == $2,\n+                                  (n->as_Vector()->length() == $2 ||`\n+                            'n->as_Vector()->length() == $6)));\n+  match(Set dst (Replicate$3 con));\n+  ins_cost(INSN_COST);\n+  format %{ \"movi  $dst, $con\\t`#' vector ($2`'ifelse($3, S, H, $3))\" %}\n+  ins_encode %{\n+    __ mov(as_FloatRegister($dst$$reg), __ T$2`'iTYPE2SIMD($3), $con$$constant`'ifelse($7, `', `)', ` & $7)');\n+  %}\n+  ins_pipe(vmovi_reg_imm`'ifelse($4, X, 128, 64));\n@@ -1582,18 +1587,18 @@\n-dnl        $1   $2  $3 $4     $5 $6          $7 $8\n-VREPLICATE(dup, 8,  B, ,      D, iRegIorL2I, 4, B)\n-VREPLICATE(dup, 16, B, ,      X, iRegIorL2I,  , B)\n-VREPLICATE(mov, 8,  B, _imm,  D, immI,       4, B)\n-VREPLICATE(mov, 16, B, _imm,  X, immI,        , B)\n-VREPLICATE(dup, 4,  S, ,      D, iRegIorL2I, 2, H)\n-VREPLICATE(dup, 8,  S, ,      X, iRegIorL2I,  , H)\n-VREPLICATE(mov, 4,  S, _imm,  D, immI,       2, H)\n-VREPLICATE(mov, 8,  S, _imm,  X, immI,        , H)\n-VREPLICATE(dup, 2,  I, ,      D, iRegIorL2I,  , S)\n-VREPLICATE(dup, 4,  I, ,      X, iRegIorL2I,  , S)\n-VREPLICATE(mov, 2,  I, _imm,  D, immI,        , S)\n-VREPLICATE(mov, 4,  I, _imm,  X, immI,        , S)\n-VREPLICATE(dup, 2,  L, ,      X, iRegL,       , D)\n-VREPLICATE(mov, 2,  L, _imm,  X, immL,        , D)\n-VREPLICATE(dup, 2,  F, ,      D, vRegF,       , S)\n-VREPLICATE(dup, 4,  F, ,      X, vRegF,       , S)\n-VREPLICATE(dup, 2,  D, ,      X, vRegD,       , D)\n+dnl            $1 $2  $3 $4 $5          $6 $7\n+VREPLICATE_REG(B, 8,  B, D, iRegIorL2I, 4, as_Register)\n+VREPLICATE_REG(B, 16, B, X, iRegIorL2I,  , as_Register)\n+VREPLICATE_IMM(B, 8,  B, D, immI,       4, 0xff)\n+VREPLICATE_IMM(B, 16, B, X, immI,        , 0xff)\n+VREPLICATE_REG(H, 4,  S, D, iRegIorL2I, 2, as_Register)\n+VREPLICATE_REG(H, 8,  S, X, iRegIorL2I,  , as_Register)\n+VREPLICATE_IMM(H, 4,  S, D, immI,       2, 0xffff)\n+VREPLICATE_IMM(H, 8,  S, X, immI,        , 0xffff)\n+VREPLICATE_REG(S, 2,  I, D, iRegIorL2I,  , as_Register)\n+VREPLICATE_REG(S, 4,  I, X, iRegIorL2I,  , as_Register)\n+VREPLICATE_IMM(S, 2,  I, D, immI,        , )\n+VREPLICATE_IMM(S, 4,  I, X, immI,        , )\n+VREPLICATE_REG(D, 2,  L, X, iRegL,       , as_Register)\n+VREPLICATE_IMM(D, 2,  L, X, immL,        , )\n+VREPLICATE_REG(S, 2,  F, D, vRegF,       , as_FloatRegister)\n+VREPLICATE_REG(S, 4,  F, X, vRegF,       , as_FloatRegister)\n+VREPLICATE_REG(D, 2,  D, X, vRegD,       , as_FloatRegister)\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon_ad.m4","additions":45,"deletions":40,"binary":false,"changes":85,"status":"modified"}]}