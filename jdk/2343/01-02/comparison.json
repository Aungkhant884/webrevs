{"files":[{"patch":"@@ -29,0 +29,1 @@\n+ * @modules java.base\/sun.security.util\n@@ -34,0 +35,8 @@\n+import java.io.*;\n+import java.security.KeyStore;\n+import java.security.cert.X509Certificate;\n+import java.util.Arrays;\n+import sun.security.util.DerValue;\n+import sun.security.util.KnownOIDs;\n+import static sun.security.util.KnownOIDs.*;\n+\n@@ -63,0 +72,1 @@\n+        kt(\"-importcert -alias e1 -file tmp.cert\", \"ks\");\n@@ -64,6 +74,21 @@\n-        SecurityTools.keytool(\"-keystore ks -storepass changeit \" +\n-                \"-printcert -file tmp.cert\")\n-                .shouldContain(\"AuthorityKeyIdentifier\")\n-                .shouldContain(\"0000: 00 01 02 03 04 05 06 07   08 09 10 11 12 13 14 15\")\n-                .shouldContain(\"0010: 16 17 18 19\")\n-                .shouldHaveExitValue(0);\n+        byte[] expectedId = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n+                0x08, 0x09, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19};\n+\n+        KeyStore kstore = KeyStore.getInstance(new File(\"ks\"),\n+                \"changeit\".toCharArray());\n+        X509Certificate cert = (X509Certificate)kstore.getCertificate(\"e1\");\n+        byte[] authorityKeyIdExt = cert.getExtensionValue(\n+                KnownOIDs.AuthorityKeyID.value());\n+\n+        byte[] authorityKeyId = null;\n+        if (authorityKeyIdExt == null) {\n+            System.out.println(\"Failed to get AKID extension from the cert\");\n+            System.exit(1);\n+        } else {\n+            try {\n+                authorityKeyId = new DerValue(authorityKeyIdExt).getOctetString();\n+            } catch (IOException e) {\n+                System.out.println(\"Failed to get AKID encoded OctetString in the cert\");\n+                System.exit(1);\n+            }\n+        }\n@@ -71,0 +96,5 @@\n+        authorityKeyId = Arrays.copyOfRange(authorityKeyId, 4, authorityKeyId.length);\n+        if (!Arrays.equals(authorityKeyId, expectedId)) {\n+            System.out.println(\"Failed due to AKID mismatch\");\n+            System.exit(1);\n+        }\n","filename":"test\/jdk\/sun\/security\/tools\/keytool\/CheckCertAKID.java","additions":36,"deletions":6,"binary":false,"changes":42,"status":"modified"}]}