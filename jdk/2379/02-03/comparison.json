{"files":[{"patch":"@@ -559,4 +559,4 @@\n-       \"parallel threads number for heap iteration. \"\n-       \"0 use system determined number of threads, \"\n-       \"1 use one thread, i.e., disable parallelism, \"\n-       \"n use n threads, n must be positive.\",\n+       \"Number of parallel threads for heap iteration. \"\n+       \"0 means let the VM determined the number of threads. \"\n+       \"1 means use one thread, i.e. disable parallelism. \"\n+       \"n means use n threads. n must be positive.\",\n@@ -569,1 +569,5 @@\n-  uint num = (uint)_parallel_thread_num.value();\n+  jlong num = _parallel_thread_num.value();\n+  if (num < 0) {\n+    output()->print_cr(\"Parallel thread number out of range (>=0): \" JLONG_FORMAT, num);\n+    return;\n+  }\n","filename":"src\/hotspot\/share\/services\/diagnosticCommand.cpp","additions":9,"deletions":5,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -53,1 +53,1 @@\n-    public void run(CommandExecutor executor, String classHistogramArgs) {\n+    public void run(CommandExecutor executor, String classHistogramArgs, String expactedErrMsg) {\n@@ -55,0 +55,4 @@\n+        if (!expactedErrMsg.isEmpty()) {\n+            output.shouldMatch(expactedErrMsg);\n+            return;\n+        }\n@@ -92,0 +96,1 @@\n+        String parallelErr = \"Parallel thread number out of range\";\n@@ -93,12 +98,19 @@\n-                {\"\"},\n-                {\"-parallel=0\"},\n-                {\"-parallel=1\"},\n-                {\"-parallel=2\"},\n-                {\"-all=false -parallel=0\"},\n-                {\"-all=false -parallel=1\"},\n-                {\"-all=false -parallel=2\"},\n-                {\"-all=true\"},\n-                {\"-all=true -parallel=0\"},\n-                {\"-all=true -parallel=1\"},\n-                {\"-all=true -parallel=2\"},\n-                {\"-parallel=2 -all=true\"}\n+                \/\/ valid args\n+                {\"\", \"\"},\n+                {\"-parallel=0\", \"\"},\n+                {\"-parallel=1\", \"\"},\n+                {\"-parallel=2\", \"\"},\n+                {\"-parallel=\"+Long.MAX_VALUE, \"\"},\n+                {\"-all=false -parallel=0\", \"\"},\n+                {\"-all=false -parallel=1\", \"\"},\n+                {\"-all=false -parallel=2\", \"\"},\n+                {\"-all=true\", \"\"},\n+                {\"-all=true -parallel=0\", \"\"},\n+                {\"-all=true -parallel=1\", \"\"},\n+                {\"-all=true -parallel=2\", \"\"},\n+                {\"-parallel=2 -all=true\", \"\"},\n+                \/\/ invalid args\n+                {\"-parallel=-1\", parallelErr},\n+                {\"-parallel=\"+Long.MIN_VALUE, parallelErr},\n+                {\"-all=false -parallel=-10\", parallelErr},\n+                {\"-all=true -parallel=-100\", parallelErr},\n@@ -109,2 +121,2 @@\n-    public void jmx(String args) {\n-        run(new JMXExecutor(), args);\n+    public void valid(String args, String expactedErrMsg) {\n+        run(new JMXExecutor(), args, expactedErrMsg);\n","filename":"test\/hotspot\/jtreg\/serviceability\/dcmd\/gc\/ClassHistogramTest.java","additions":27,"deletions":15,"binary":false,"changes":42,"status":"modified"}]}