{"files":[{"patch":"@@ -30,2 +30,0 @@\n-include MakeIO.gmk\n-include Utils.gmk\n@@ -34,0 +32,29 @@\n+# Language Settings Providers example\n+# <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n+# <project>\n+#     <configuration id=\"cdt.managedbuild.toolchain.gnu.cross.base.3911442301\" name=\"Java SE\">\n+#         <extension point=\"org.eclipse.cdt.core.LanguageSettingsProvider\">\n+#             <provider class=\"org.eclipse.cdt.core.language.settings.providers.LanguageSettingsGenericProvider\" id=\"org.eclipse.cdt.ui.UserLanguageSettingsProvider\" name=\"CDT User Setting Entries\" prefer-non-shared=\"true\" store-entries-with-project=\"true\">\n+#                 <language id=\"org.eclipse.cdt.core.g++\">\n+#                     <resource project-relative-path=\"\">\n+#                         <entry kind=\"macro\" name=\"PRODUCT\" value=\"\"\/>\n+#                         <entry kind=\"macro\" name=\"_WINDOWS\" value=\"\"\/>\n+#                     <\/resource>\n+#                 <\/language>\n+#             <\/provider>\n+#             <provider class=\"org.eclipse.cdt.managedbuilder.language.settings.providers.GCCBuildCommandParser\" id=\"org.eclipse.cdt.managedbuilder.core.GCCBuildCommandParser\" keep-relative-paths=\"false\" name=\"CDT GCC Build Output Parser\" parameter=\"([^\/\\\\\\\\]*)((g?cc)|([gc]\\+\\+)|(clang))\" prefer-non-shared=\"true\" store-entries-with-project=\"true\"\/>\n+#             <provider class=\"org.eclipse.cdt.internal.build.crossgcc.CrossGCCBuiltinSpecsDetector\" console=\"false\" env-hash=\"1294172661456\" id=\"org.eclipse.cdt.build.crossgcc.CrossGCCBuiltinSpecsDetector\" keep-relative-paths=\"false\" name=\"CDT Cross GCC Built-in Compiler Settings\" parameter=\"${COMMAND} ${FLAGS} -E -P -v -dD &quot;${INPUTS}&quot;\" prefer-non-shared=\"true\" store-entries-with-project=\"true\">\n+#                 <language-scope id=\"org.eclipse.cdt.core.gcc\"\/>\n+#                 <language-scope id=\"org.eclipse.cdt.core.g++\"\/>\n+#             <\/provider>\n+#             <provider class=\"org.eclipse.cdt.managedbuilder.language.settings.providers.GCCBuiltinSpecsDetector\" console=\"false\" env-hash=\"1294172661456\" id=\"org.eclipse.cdt.managedbuilder.core.GCCBuiltinSpecsDetector\" keep-relative-paths=\"false\" name=\"CDT GCC Built-in Compiler Settings\" parameter=\"${COMMAND} ${FLAGS} -E -P -v -dD &quot;${INPUTS}&quot;\" prefer-non-shared=\"true\" store-entries-with-project=\"true\">\n+#                 <language-scope id=\"org.eclipse.cdt.core.gcc\"\/>\n+#                 <language-scope id=\"org.eclipse.cdt.core.g++\"\/>\n+#             <\/provider>\n+#             <provider build-parser-id=\"\" cdb-modified-time=\"\" class=\"org.eclipse.cdt.managedbuilder.internal.language.settings.providers.CompilationDatabaseParser\" id=\"org.eclipse.cdt.managedbuilder.core.CompilationDatabaseParser\" name=\"Compilation Database Parser\" prefer-non-shared=\"true\" store-entries-with-project=\"true\"\/>\n+#         <\/extension>\n+#     <\/configuration>\n+# <\/project>\n+\n+SINGLE_DOLLAR:=$\n+\n@@ -39,0 +66,1 @@\n+LANGUAGE_SETTINGS := $(IDE_OUTPUTDIR)\/.settings\/language.settings.xml\n@@ -45,1 +73,3 @@\n-# This currently does not support Visual C++\n+#\n+# Note that the workspace setup system currently does not support Visual C++ when\n+# extracting compiler and\/or system headers vital to the build!\n@@ -63,0 +93,5 @@\n+# Cache a 10 digit number as the configuration id for the workspace where needed\n+# This needs to be the same everywhere it's used anyway, and doing this also avoids\n+# regenerating the number every time\n+RANDOM := $(call RandomDigits, 10)\n+\n@@ -136,1 +171,2 @@\n-  $$(shell mkdir -p $(IDE_OUTPUTDIR))\n+  # Create both unconditionally and kill 2 birds with one stone\n+  $$(shell mkdir -p $(IDE_OUTPUTDIR)\/.settings)\n@@ -229,1 +265,1 @@\n-    $$(call AppendFile,        <cconfiguration id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(call RandomDigits, 10)\">, $(NATIVE_FILE))\n+    $$(call AppendFile,        <cconfiguration id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(RANDOM)\">, $(NATIVE_FILE))\n@@ -232,1 +268,1 @@\n-    $$(call AppendFile,            <storageModule buildSystemId=\"org.eclipse.cdt.managedbuilder.core.configurationDataProvider\" id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(call RandomDigits, 10)\" moduleId=\"org.eclipse.cdt.core.settings\" name=\"Java SE\">, $(NATIVE_FILE))\n+    $$(call AppendFile,            <storageModule buildSystemId=\"org.eclipse.cdt.managedbuilder.core.configurationDataProvider\" id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(RANDOM)\" moduleId=\"org.eclipse.cdt.core.settings\" name=\"Java SE\">, $(NATIVE_FILE))\n@@ -235,2 +271,1 @@\n-    # For some strange reason Eclipse requires the binary parsers be listed for the\n-    # workspace to be recognised as a C\/C++ one\n+    # For some strange reason Eclipse requires the binary parsers be listed for the workspace to be recognised as a C\/C++ one\n@@ -248,2 +283,2 @@\n-    $$(call AppendFile,                <configuration buildProperties=\"\" description=\"\" id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(call RandomDigits, 10)\" name=\"Java SE\" parent=\"org.eclipse.cdt.build.core.emptycfg\">, $(NATIVE_FILE))\n-    $$(call AppendFile,                    <folderInfo id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(call RandomDigits, 10).$(call RandomDigits, 9)\" name=\"\/\" resourcePath=\"\">, $(NATIVE_FILE))\n+    $$(call AppendFile,                <configuration buildProperties=\"\" description=\"\" id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(RANDOM)\" name=\"Java SE\" parent=\"org.eclipse.cdt.build.core.emptycfg\">, $(NATIVE_FILE))\n+    $$(call AppendFile,                    <folderInfo id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(RANDOM).$(call RandomDigits, 9)\" name=\"\/\" resourcePath=\"\">, $(NATIVE_FILE))\n@@ -252,1 +287,1 @@\n-    $$(call AppendFile,                            <targetPlatform archList=\"all\" binaryParser=\"\" id=\"cdt.managedbuild.targetPlatform.gnu.cross.1546530650\" isAbstract=\"false\" osList=\"all\" superClass=\"cdt.managedbuild.targetPlatform.gnu.cross\"\/>, $(NATIVE_FILE))\n+    $$(call AppendFile,                            <targetPlatform archList=\"all\" binaryParser=\"\" id=\"cdt.managedbuild.targetPlatform.gnu.cross.$(RANDOM)\" isAbstract=\"false\" osList=\"all\" superClass=\"cdt.managedbuild.targetPlatform.gnu.cross\"\/>, $(NATIVE_FILE))\n@@ -297,0 +332,47 @@\n+    $$(call WriteFile,<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,<project>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,    <configuration id=\"cdt.managedbuild.toolchain.gnu.cross.base.$(RANDOM)\" name=\"Java SE\">, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,        <extension point=\"org.eclipse.cdt.core.LanguageSettingsProvider\">, $(LANGUAGE_SETTINGS))\n+    $$(call EmitEmptyLine, $(LANGUAGE_SETTINGS))\n+\n+    # Doesn't hurt to include compilation database and build output parsing support\n+    $$(call AppendFile,            <provider build-parser-id=\"\" cdb-modified-time=\"\" class=\"org.eclipse.cdt.managedbuilder.internal.language.settings.providers.CompilationDatabaseParser\" id=\"org.eclipse.cdt.managedbuilder.core.CompilationDatabaseParser\" name=\"Compilation Database Parser\" prefer-non-shared=\"true\" store-entries-with-project=\"true\"\/>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,            <provider class=\"org.eclipse.cdt.managedbuilder.language.settings.providers.GCCBuildCommandParser\" id=\"org.eclipse.cdt.managedbuilder.core.GCCBuildCommandParser\" keep-relative-paths=\"false\" name=\"CDT GCC Build Output Parser\" parameter=\"$$(LEFT_PAREN)[^\/\\\\\\\\]*$$(RIGHT_PAREN)$$(LEFT_PAREN)$$(LEFT_PAREN)g?cc$$(RIGHT_PAREN)|$$(LEFT_PAREN)[gc]\\+\\+$$(RIGHT_PAREN)|$$(LEFT_PAREN)clang$$(RIGHT_PAREN)$$(RIGHT_PAREN)\" prefer-non-shared=\"true\" store-entries-with-project=\"true\"\/>, $(LANGUAGE_SETTINGS))\n+    $$(call EmitEmptyLine, $(LANGUAGE_SETTINGS))\n+\n+    # Get the compiler environment settings out of the way\n+    # Note that the Managed Build Setting Entries are left out, this is intentional as\n+    # we don't want to mix the CDT Managed Builder with make if we don't need it\n+    $$(call AppendFile,            <provider class=\"org.eclipse.cdt.internal.build.crossgcc.CrossGCCBuiltinSpecsDetector\" console=\"true\" env-hash=\"\" id=\"org.eclipse.cdt.build.crossgcc.CrossGCCBuiltinSpecsDetector\" keep-relative-paths=\"false\" name=\"CDT Cross GCC Built-in Compiler Settings\" parameter=\"$$(SINGLE_DOLLAR){COMMAND} $$(SINGLE_DOLLAR){FLAGS} -E -P -v -dD &quot;$$(SINGLE_DOLLAR){INPUTS}&quot;\" prefer-non-shared=\"true\" store-entries-with-project=\"true\">, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,                <language-scope id=\"org.eclipse.cdt.core.gcc\"\/>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,                <language-scope id=\"org.eclipse.cdt.core.g++\"\/>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,            <\/provider>, $(LANGUAGE_SETTINGS))\n+    $$(call EmitEmptyLine, $(LANGUAGE_SETTINGS))\n+\n+    # Eclipse seems to work without this, but I'll leave this here in case we suddenly\n+    # need it in the future if the way Language Settings Providers work suddenly change\n+    # in the future.\n+    # This would also be helpful for when we eventually make this system more flexible\n+    # and able to work with Visual C++ too.\n+    # $$(call AppendFile,            <provider class=\"org.eclipse.cdt.managedbuilder.language.settings.providers.GCCBuiltinSpecsDetector\" console=\"true\" env-hash=\"\" id=\"org.eclipse.cdt.managedbuilder.core.GCCBuiltinSpecsDetector\" keep-relative-paths=\"false\" name=\"CDT GCC Built-in Compiler Settings\" parameter=\"$$(SINGLE_DOLLAR){COMMAND} $$(SINGLE_DOLLAR){FLAGS} -E -P -v -dD &quot;$$(SINGLE_DOLLAR){INPUTS}&quot;\" prefer-non-shared=\"true\" store-entries-with-project=\"true\">, $(LANGUAGE_SETTINGS))\n+    # $$(call AppendFile,                <language-scope id=\"org.eclipse.cdt.core.gcc\"\/>, $(LANGUAGE_SETTINGS))\n+    # $$(call AppendFile,                <language-scope id=\"org.eclipse.cdt.core.g++\"\/>, $(LANGUAGE_SETTINGS))\n+    # $$(call AppendFile,            <\/provider>, $(LANGUAGE_SETTINGS))\n+    # $$(call EmitEmptyLine, $(LANGUAGE_SETTINGS))\n+\n+    # Now for the tricky part: Setting up the proper environment and macros that were defined\n+    # during configure...\n+    $$(call AppendFile,            <provider class=\"org.eclipse.cdt.core.language.settings.providers.LanguageSettingsGenericProvider\" id=\"org.eclipse.cdt.ui.UserLanguageSettingsProvider\" name=\"CDT User Setting Entries\" prefer-non-shared=\"true\" store-entries-with-project=\"true\">, $(LANGUAGE_SETTINGS))\n+    #                <language id=\"org.eclipse.cdt.core.g++\">\n+    #                    <resource project-relative-path=\"\">\n+    #                        <entry kind=\"macro\" name=\"PRODUCT\" value=\"\"\/>\n+    #                         <entry kind=\"macro\" name=\"_WINDOWS\" value=\"\"\/>\n+    #                    <\/resource>\n+    #                <\/language>\n+    $$(call AppendFile,           <\/provider>, $(LANGUAGE_SETTINGS))\n+\n+    $$(call EmitEmptyLine, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,        <\/extension>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,    <\/configuration>, $(LANGUAGE_SETTINGS))\n+    $$(call AppendFile,<\/project>, $(LANGUAGE_SETTINGS))\n+\n","filename":"make\/ide\/eclipse\/CreateWorkspace.gmk","additions":93,"deletions":11,"binary":false,"changes":104,"status":"modified"}]}