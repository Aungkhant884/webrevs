{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1994, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1994, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -419,0 +419,3 @@\n+                if (nread < buf.length) {\n+                    buf = Arrays.copyOfRange(buf, 0, nread);\n+                }\n","filename":"src\/java.base\/share\/classes\/java\/io\/InputStream.java","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -34,1 +34,1 @@\n- * @bug 8080835 8139206\n+ * @bug 8080835 8139206 8254742\n@@ -47,0 +47,1 @@\n+        test();\n@@ -138,0 +139,13 @@\n+    static void test() throws IOException {\n+        final int chunkSize = 8192;\n+        int size = (10 + generator.nextInt(11))*chunkSize;\n+\n+        byte[] buf = new byte[size];\n+        generator.nextBytes(buf);\n+        InputStream s = new ThrottledByteArrayInputStream(buf);\n+\n+        byte[] b = s.readNBytes(size);\n+\n+        check(Arrays.equals(b, buf), \"Arrays not equal\");\n+    }\n+\n@@ -153,1 +167,0 @@\n-\n@@ -160,0 +173,22 @@\n+\n+    static class ThrottledByteArrayInputStream extends ByteArrayInputStream {\n+        private int count = 0;\n+\n+        ThrottledByteArrayInputStream(byte[] buf) {\n+            super(buf);\n+        }\n+\n+        @Override\n+        \/\/\n+        \/\/ Sometimes return zero or a smaller count than requested.\n+        \/\/\n+        public int read(byte[] buf, int off, int len) {\n+            if (generator.nextBoolean()) {\n+                return 0;\n+            } else if (++count \/ 3 == 0) {\n+                len \/= 3;\n+            }\n+\n+            return super.read(buf, off, len);\n+        }\n+    }\n","filename":"test\/jdk\/java\/io\/InputStream\/ReadNBytes.java","additions":38,"deletions":3,"binary":false,"changes":41,"status":"modified"}]}