{"files":[{"patch":"@@ -31,4 +31,1 @@\n-import javax.swing.JFrame;\n-import javax.swing.JTextField;\n-import javax.swing.JLabel;\n-import javax.swing.SwingUtilities;\n+\n@@ -46,0 +43,1 @@\n+import java.lang.reflect.InvocationTargetException;\n@@ -49,0 +47,5 @@\n+import javax.swing.JFrame;\n+import javax.swing.JTextField;\n+import javax.swing.JLabel;\n+import javax.swing.SwingUtilities;\n+\n@@ -57,1 +60,1 @@\n-    public JFrame createUIAndTest() throws Exception {\n+    public static void createUIAndTest() throws Exception {\n@@ -115,3 +118,2 @@\n-        boolean isFrameVisible = frameVisibleLatch.await(TIMEOUT, TimeUnit.SECONDS);\n-        if (!isFrameVisible) {\n-            throw new RuntimeException(\"Frame is not visible after \" + TIMEOUT + \"  seconds\");\n+        if (!isTopLevelVisible(frame, frameVisibleLatch)) {\n+            throw new RuntimeException(\"Dialog is not visible after \" + TIMEOUT + \"  seconds\");\n@@ -119,0 +121,1 @@\n+        System.out.println(\"frame is visible \" + frame.toString());\n@@ -120,1 +123,1 @@\n-        if (!isComponentVisible(jTextField, componentVisibleLatch)) {\n+        if (!isJComponentVisible(jTextField, componentVisibleLatch)) {\n@@ -125,1 +128,1 @@\n-        robot.delay(DELAY);\n+        robot.setAutoDelay(DELAY);\n@@ -136,1 +139,1 @@\n-        robot.delay(DELAY);\n+        robot.waitForIdle();\n@@ -138,1 +141,0 @@\n-        robot.delay(DELAY);\n@@ -140,3 +142,0 @@\n-        robot.delay(DELAY);\n-        robot.keyRelease(KeyEvent.VK_SHIFT);\n-        robot.delay(DELAY);\n@@ -144,1 +143,1 @@\n-        robot.delay(DELAY);\n+        robot.keyRelease(KeyEvent.VK_SHIFT);\n@@ -150,1 +149,0 @@\n-        return frame;\n@@ -155,1 +153,0 @@\n-        robot.delay(DELAY);\n@@ -160,1 +157,0 @@\n-        robot.delay(DELAY);\n@@ -162,1 +158,0 @@\n-        robot.delay(DELAY);\n@@ -164,1 +159,0 @@\n-        robot.delay(DELAY);\n@@ -168,3 +162,12 @@\n-    public static boolean isComponentVisible(java.awt.Component component, CountDownLatch componentVisibleLatch) throws Exception {\n-        int count = 1;\n-        if (!component.isVisible()) {\n+    public static void checkSwingTopLevelVisible(javax.swing.JFrame jFrame, CountDownLatch topLevelVisibleLatch) throws InterruptedException, InvocationTargetException {\n+        SwingUtilities.invokeAndWait(() -> {\n+            if (jFrame.isVisible()) {\n+                topLevelVisibleLatch.countDown();\n+            }\n+        });\n+    }\n+\n+    public static boolean isTopLevelVisible(javax.swing.JFrame jFrame, CountDownLatch topLevelVisibleLatch) throws Exception {\n+        checkSwingTopLevelVisible(jFrame, topLevelVisibleLatch);\n+        if (topLevelVisibleLatch.getCount() != 0) {\n+            int count = 1;\n@@ -173,3 +176,26 @@\n-                if (component.isVisible()) {\n-                    componentVisibleLatch.countDown();\n-                    System.out.println(\"Component is visible \" + component.toString());\n+                checkSwingTopLevelVisible(jFrame, topLevelVisibleLatch);\n+                if (topLevelVisibleLatch.getCount() == 0) {\n+                    break;\n+                }\n+                count++;\n+            }\n+        }\n+        return topLevelVisibleLatch.await(TIMEOUT, TimeUnit.SECONDS);\n+    }\n+\n+    public static void checkJComponentVisible(javax.swing.JComponent jComponent, CountDownLatch componentVisibleLatch) throws InterruptedException, InvocationTargetException {\n+        SwingUtilities.invokeAndWait(() -> {\n+            if (jComponent.isVisible()) {\n+                componentVisibleLatch.countDown();\n+            }\n+        });\n+    }\n+\n+    public static boolean isJComponentVisible(javax.swing.JComponent jComponent, CountDownLatch componentVisibleLatch) throws InterruptedException, InvocationTargetException {\n+        checkJComponentVisible(jComponent, componentVisibleLatch);\n+        if (componentVisibleLatch.getCount() != 0) {\n+            int count = 1;\n+            while (count <= 5) {\n+                TimeUnit.SECONDS.sleep(1);\n+                checkJComponentVisible(jComponent, componentVisibleLatch);\n+                if (componentVisibleLatch.getCount() == 0) {\n@@ -180,3 +206,0 @@\n-        } else {\n-            componentVisibleLatch.countDown();\n-            System.out.println(\"Component is visible \" + component.toString());\n@@ -188,2 +211,0 @@\n-        bug4959409 bug4959409 = new bug4959409();\n-        final JFrame[] jFrames = new JFrame[1];\n@@ -191,1 +212,1 @@\n-            jFrames[0] = bug4959409.createUIAndTest();\n+            createUIAndTest();\n@@ -193,4 +214,2 @@\n-            if (jFrames[0] != null) {\n-                SwingUtilities.invokeAndWait(()-> {\n-                    jFrames[0].dispose();\n-                });\n+            if (frame != null) {\n+                SwingUtilities.invokeAndWait(frame::dispose);\n","filename":"test\/jdk\/java\/awt\/im\/4959409\/bug4959409.java","additions":56,"deletions":37,"binary":false,"changes":93,"status":"modified"}]}