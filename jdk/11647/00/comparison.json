{"files":[{"patch":"@@ -66,5 +66,15 @@\n-        static void readRequest(Socket s) throws IOException {\n-            InputStream is = s.getInputStream();\n-            is.read();\n-            while (is.available() > 0)\n-                is.read();\n+        static final byte[] requestEnd = new byte[] {'\\r', '\\n', '\\r', '\\n' };\n+\n+        \/\/ Read until the end of a HTTP request\n+        static void readOneRequest(InputStream is) throws IOException {\n+            int requestEndCount = 0, r;\n+            while ((r = is.read()) != -1) {\n+                if (r == requestEnd[requestEndCount]) {\n+                    requestEndCount++;\n+                    if (requestEndCount == 4) {\n+                        break;\n+                    }\n+                } else {\n+                    requestEndCount = 0;\n+                }\n+            }\n@@ -77,1 +87,1 @@\n-                    readRequest(s);\n+                    readOneRequest(s.getInputStream());\n@@ -90,1 +100,4 @@\n-                    is.read();\n+                    int readResult = is.read();\n+                    if (readResult != -1) {\n+                        System.out.println(\"Unexpected byte received: \" + readResult);\n+                    }\n","filename":"test\/jdk\/sun\/net\/www\/http\/KeepAliveCache\/B8291637.java","additions":20,"deletions":7,"binary":false,"changes":27,"status":"modified"}]}