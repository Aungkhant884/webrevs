{"files":[{"patch":"@@ -2352,1 +2352,1 @@\n-C2V_VMENTRY_PREFIX(jboolean, attachCurrentThread, (JNIEnv* env, jobject c2vm, jboolean as_daemon))\n+C2V_VMENTRY_PREFIX(jboolean, attachCurrentThread, (JNIEnv* env, jobject c2vm, jbyteArray name, jboolean as_daemon))\n@@ -2355,0 +2355,2 @@\n+    guarantee(name != NULL, \"libjvmci caller must pass non-null name\");\n+\n@@ -2357,2 +2359,12 @@\n-    jint res = as_daemon ? main_vm.AttachCurrentThreadAsDaemon((void**) &hotspotEnv, NULL) :\n-                           main_vm.AttachCurrentThread((void**) &hotspotEnv, NULL);\n+\n+    int name_len = env->GetArrayLength(name);\n+    char name_buf[64]; \/\/ Cannot use Resource heap as it requires a current thread\n+    int to_copy = MIN2(name_len, (int) sizeof(name_buf) - 1);\n+    env->GetByteArrayRegion(name, 0, to_copy, (jbyte*) name_buf);\n+    name_buf[to_copy] = '\\0';\n+    JavaVMAttachArgs attach_args;\n+    attach_args.version = JNI_VERSION_1_2;\n+    attach_args.name = name_buf;\n+    attach_args.group = NULL;\n+    jint res = as_daemon ? main_vm.AttachCurrentThreadAsDaemon((void**) &hotspotEnv, &attach_args) :\n+                           main_vm.AttachCurrentThread((void**) &hotspotEnv, &attach_args);\n@@ -2806,1 +2818,1 @@\n-  {CC \"attachCurrentThread\",                          CC \"(Z)Z\",                                                                            FN_PTR(attachCurrentThread)},\n+  {CC \"attachCurrentThread\",                          CC \"([BZ)Z\",                                                                          FN_PTR(attachCurrentThread)},\n","filename":"src\/hotspot\/share\/jvmci\/jvmciCompilerToVM.cpp","additions":16,"deletions":4,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -980,0 +980,1 @@\n+     * @param name name of current thread if in a native image otherwise {@code null}\n@@ -982,1 +983,1 @@\n-    native boolean attachCurrentThread(boolean asDaemon);\n+    native boolean attachCurrentThread(byte[] name, boolean asDaemon);\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/CompilerToVM.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1120,1 +1120,2 @@\n-        return compilerToVm.attachCurrentThread(asDaemon);\n+        byte[] name = IS_IN_NATIVE_IMAGE ? Thread.currentThread().getName().getBytes() : null;\n+        return compilerToVm.attachCurrentThread(name, asDaemon);\n","filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.hotspot\/src\/jdk\/vm\/ci\/hotspot\/HotSpotJVMCIRuntime.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}