{"files":[{"patch":"@@ -224,3 +224,1 @@\n-  \/\/ values in struct sysinfo are \"unsigned long\"\n-  struct sysinfo si;\n-  julong avail_mem;\n+  julong avail_mem = 0UL;\n@@ -241,2 +239,18 @@\n-  sysinfo(&si);\n-  avail_mem = (julong)si.freeram * si.mem_unit;\n+  FILE *fp = os::fopen(\"\/proc\/meminfo\", \"r\");\n+  if (fp) {\n+    char buf[80];\n+    do {\n+      julong mem_available;\n+      if (fscanf(fp, \"MemAvailable: \" JULONG_FORMAT \" kB\", &mem_available) == 1) {\n+        avail_mem = mem_available;\n+        break;\n+      }\n+    } while (fgets(buf, sizeof(buf), fp) != nullptr);\n+    fclose(fp);\n+  }\n+  if (avail_mem == 0UL) {\n+    \/\/ values in struct sysinfo are \"unsigned long\"\n+    struct sysinfo si;\n+    sysinfo(&si);\n+    avail_mem = (julong)si.freeram * si.mem_unit;\n+  }\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":19,"deletions":5,"binary":false,"changes":24,"status":"modified"}]}