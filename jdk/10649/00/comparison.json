{"files":[{"patch":"@@ -197,1 +197,4 @@\n-  update_young_length_bounds(_analytics->predict_rs_length());\n+  \/\/ We have no measure of the number of pending cards in the thread buffers,\n+  \/\/ assume these are very few.\n+  update_young_length_bounds(_analytics->predict_pending_cards(),\n+                             _analytics->predict_rs_length());\n@@ -200,2 +203,2 @@\n-void G1Policy::update_young_length_bounds(size_t rs_length) {\n-  _young_list_desired_length = calculate_young_desired_length(rs_length);\n+void G1Policy::update_young_length_bounds(size_t pending_cards, size_t rs_length) {\n+  _young_list_desired_length = calculate_young_desired_length(pending_cards, rs_length);\n@@ -224,1 +227,1 @@\n-uint G1Policy::calculate_young_desired_length(size_t rs_length) const {\n+uint G1Policy::calculate_young_desired_length(size_t pending_cards, size_t rs_length) const {\n@@ -259,1 +262,0 @@\n-    const size_t pending_cards = _analytics->predict_pending_cards();\n@@ -526,1 +528,5 @@\n-    update_young_length_bounds(rs_length_prediction);\n+\n+    G1DirtyCardQueueSet& dcqs = G1BarrierSet::dirty_card_queue_set();\n+    \/\/ We have no measure of the number of cards in the thread buffers, assume\n+    \/\/ these are very few compared to the ones in the DCQS.\n+    update_young_length_bounds(dcqs.num_cards(), rs_length_prediction);\n@@ -917,1 +923,1 @@\n-    \/\/ the marking threads may have received an uncharacterisic amount of cpu time\n+    \/\/ the marking threads may have received an uncharacteristic amount of cpu time\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -197,2 +197,2 @@\n-  \/\/ If no rs_length parameter is passed, predict the RS length using the\n-  \/\/ prediction model, otherwise use the given rs_length as the prediction.\n+  \/\/ If no parameters are passed, predict pending cards and the RS length using\n+  \/\/ the prediction model.\n@@ -200,1 +200,1 @@\n-  void update_young_length_bounds(size_t rs_length);\n+  void update_young_length_bounds(size_t pending_cards, size_t rs_length);\n@@ -228,1 +228,1 @@\n-  uint calculate_young_desired_length(size_t rs_length) const;\n+  uint calculate_young_desired_length(size_t pending_cards, size_t rs_length) const;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}