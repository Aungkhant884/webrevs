{"files":[{"patch":"@@ -120,1 +120,1 @@\n-        JNFDeleteGlobalRef(env, fInputMethodLOCKABLE);\n+        (*env)->DeleteGlobalRef(env, fInputMethodLOCKABLE);\n@@ -1362,1 +1362,1 @@\n-        JNFDeleteGlobalRef(env, fInputMethodLOCKABLE);\n+        (*env)->DeleteGlobalRef(env, fInputMethodLOCKABLE);\n@@ -1365,5 +1365,1 @@\n-    \/\/ Save a global ref to the new input method.\n-    if (inputMethod != NULL)\n-        fInputMethodLOCKABLE = JNFNewGlobalRef(env, inputMethod);\n-    else\n-        fInputMethodLOCKABLE = NULL;\n+    fInputMethodLOCKABLE = inputMethod; \/\/ input method arg must be a GlobalRef\n@@ -1411,0 +1407,1 @@\n+    CHECK_EXCEPTION();\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/AWTView.m","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -35,1 +35,0 @@\n-@class JNFWeakJObjectWrapper;\n@@ -39,1 +38,1 @@\n-    JNFWeakJObjectWrapper *javaPlatformWindow;\n+    jobject javaPlatformWindow;\n@@ -56,1 +55,1 @@\n-@property (nonatomic, retain) JNFWeakJObjectWrapper *javaPlatformWindow;\n+@property (nonatomic) jobject javaPlatformWindow;\n@@ -68,1 +67,1 @@\n-- (id) initWithPlatformWindow:(JNFWeakJObjectWrapper *)javaPlatformWindow\n+- (id) initWithPlatformWindow:(jobject)javaPlatformWindow\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/AWTWindow.h","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -119,1 +119,1 @@\n-    jobject platformWindow = [((AWTWindow *)self.delegate).javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, ((AWTWindow *)self.delegate).javaPlatformWindow);\n@@ -284,1 +284,1 @@\n-- (id) initWithPlatformWindow:(JNFWeakJObjectWrapper *)platformWindow\n+- (id) initWithPlatformWindow:(jobject)platformWindow\n@@ -485,1 +485,1 @@\n-    [self.javaPlatformWindow setJObject:nil withEnv:env];\n+    (*env)->DeleteWeakGlobalRef(env, self.javaPlatformWindow);\n@@ -497,1 +497,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -514,1 +514,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -535,1 +535,1 @@\n-        jobject platformWindow = [awtWindow.javaPlatformWindow jObjectWithEnv:env];\n+        jobject platformWindow = (*env)->NewLocalRef(env, awtWindow.javaPlatformWindow);\n@@ -606,1 +606,1 @@\n-        jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+        jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -635,1 +635,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -713,1 +713,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -729,1 +729,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -760,1 +760,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -762,1 +762,1 @@\n-        jobject oppositeWindow = [opposite.javaPlatformWindow jObjectWithEnv:env];\n+        jobject oppositeWindow = (*env)->NewLocalRef(env, opposite.javaPlatformWindow);\n@@ -791,1 +791,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -907,1 +907,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -925,1 +925,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -942,1 +942,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -955,1 +955,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -974,1 +974,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -985,1 +985,1 @@\n-    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -1004,1 +1004,1 @@\n-                    jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+                    jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -1023,1 +1023,1 @@\n-                jobject platformWindow = [self.javaPlatformWindow jObjectWithEnv:env];\n+                jobject platformWindow = (*env)->NewLocalRef(env, self.javaPlatformWindow);\n@@ -1106,1 +1106,1 @@\n-    JNFWeakJObjectWrapper *platformWindow = [JNFWeakJObjectWrapper wrapperWithJObject:obj withEnv:env];\n+    jobject platformWindow = (*env)->NewWeakGlobalRef(env, obj);\n@@ -1547,1 +1547,1 @@\n-            topmostWindowUnderMouse = [awtWindow.javaPlatformWindow jObject];\n+            topmostWindowUnderMouse = awtWindow.javaPlatformWindow;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/AWTWindow.m","additions":23,"deletions":23,"binary":false,"changes":46,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-                JNFDeleteGlobalRef(env, self.clipboardOwner);\n+                (*env)->DeleteGlobalRef(env, self.clipboardOwner);\n@@ -71,1 +71,1 @@\n-            self.clipboardOwner = JNFNewGlobalRef(env, owner);\n+            self.clipboardOwner = (*env)->NewGlobalRef(env, owner);\n@@ -104,1 +104,1 @@\n-                JNFDeleteGlobalRef(env, self.clipboardOwner);\n+                (*env)->DeleteGlobalRef(env, self.clipboardOwner);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CClipboard.m","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -172,1 +172,1 @@\n-        JNFDeleteGlobalRef(env, fComponent);\n+        (*env)->DeleteGlobalRef(env, fComponent);\n@@ -177,1 +177,1 @@\n-        JNFDeleteGlobalRef(env, fDragSourceContextPeer);\n+        (*env)->DeleteGlobalRef(env, fDragSourceContextPeer);\n@@ -182,1 +182,1 @@\n-        JNFDeleteGlobalRef(env, fTransferable);\n+        (*env)->DeleteGlobalRef(env, fTransferable);\n@@ -187,1 +187,1 @@\n-        JNFDeleteGlobalRef(env, fTriggerEvent);\n+        (*env)->DeleteGlobalRef(env, fTriggerEvent);\n@@ -192,1 +192,1 @@\n-        JNFDeleteGlobalRef(env, fFormats);\n+        (*env)->DeleteGlobalRef(env, fFormats);\n@@ -197,1 +197,1 @@\n-        JNFDeleteGlobalRef(env, fFormatMap);\n+        (*env)->DeleteGlobalRef(env, fFormatMap);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CDragSource.m","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -53,6 +53,6 @@\n-    jobject gComponent = JNFNewGlobalRef(env, jcomponent);\n-    jobject gDragSourceContextPeer = JNFNewGlobalRef(env, jthis);\n-    jobject gTransferable = JNFNewGlobalRef(env, jtransferable);\n-    jobject gTriggerEvent = JNFNewGlobalRef(env, jtrigger);\n-    jlongArray gFormats = JNFNewGlobalRef(env, jformats);\n-    jobject gFormatMap = JNFNewGlobalRef(env, jformatmap);\n+    jobject gComponent = (*env)->NewGlobalRef(env, jcomponent);\n+    jobject gDragSourceContextPeer = (*env)->NewGlobalRef(env, jthis);\n+    jobject gTransferable = (*env)->NewGlobalRef(env, jtransferable);\n+    jobject gTriggerEvent = (*env)->NewGlobalRef(env, jtrigger);\n+    jlongArray gFormats = (*env)->NewGlobalRef(env, jformats);\n+    jobject gFormatMap = (*env)->NewGlobalRef(env, jformatmap);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CDragSourceContextPeer.m","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -87,2 +87,2 @@\n-        fComponent = JNFNewGlobalRef(env, jcomponent);\n-        fDropTarget = JNFNewGlobalRef(env, jdropTarget);\n+        fComponent = (*env)->NewGlobalRef(env, jcomponent);\n+        fDropTarget = (*env)->NewGlobalRef(env, jdropTarget);\n@@ -151,1 +151,1 @@\n-        JNFDeleteGlobalRef(env, sDraggingFormats);\n+        (*env)->DeleteGlobalRef(env, sDraggingFormats);\n@@ -168,1 +168,1 @@\n-        JNFDeleteGlobalRef(env, fComponent);\n+        (*env)->DeleteGlobalRef(env, fComponent);\n@@ -172,1 +172,1 @@\n-        JNFDeleteGlobalRef(env, fDropTarget);\n+        (*env)->DeleteGlobalRef(env, fDropTarget);\n@@ -176,1 +176,1 @@\n-        JNFDeleteGlobalRef(env, fDropTargetContextPeer);\n+        (*env)->DeleteGlobalRef(env, fDropTargetContextPeer);\n@@ -242,1 +242,1 @@\n-    sDraggingFormats = (jlongArray) JNFNewGlobalRef(env, formats);\n+    sDraggingFormats = (jlongArray) (*env)->NewGlobalRef(env, formats);\n@@ -359,1 +359,1 @@\n-    jbyteArray gbyteArray = (jbyteArray) JNFNewGlobalRef(env, lbyteArray);\n+    jbyteArray gbyteArray = (jbyteArray) (*env)->NewGlobalRef(env, lbyteArray);\n@@ -462,1 +462,1 @@\n-            JNFDeleteGlobalRef(env, fDropTargetContextPeer);\n+            (*env)->DeleteGlobalRef(env, fDropTargetContextPeer);\n@@ -476,1 +476,1 @@\n-                fDropTargetContextPeer = JNFNewGlobalRef(env, dropTargetContextPeer);\n+                fDropTargetContextPeer = (*env)->NewGlobalRef(env, dropTargetContextPeer);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CDropTarget.m","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -109,1 +109,1 @@\n-        JNFDeleteGlobalRef(env, jdropdata);\n+        (*env)->DeleteGlobalRef(env, jdropdata);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CDropTargetContextPeer.m","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-        fFileDialog = JNFNewGlobalRef(env, inDialog);\n+        fFileDialog = (*env)->NewGlobalRef(env, inDialog);\n@@ -72,1 +72,1 @@\n-        JNFDeleteGlobalRef(env, fFileDialog);\n+        (*env)->DeleteGlobalRef(env, fFileDialog);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CFileDialog.m","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -118,1 +118,1 @@\n-            JNFWeakJObjectWrapper *wrapper = (JNFWeakJObjectWrapper *)userInfo;\n+            jobject cgeRef = (jobject)userInfo;\n@@ -120,1 +120,1 @@\n-            jobject graphicsEnv = [wrapper jObjectWithEnv:env];\n+            jobject graphicsEnv = (*env)->NewLocalRef(env, cgeRef);\n@@ -146,1 +146,1 @@\n-    JNFWeakJObjectWrapper *wrapper = [[JNFWeakJObjectWrapper wrapperWithJObject:this withEnv:env] retain];\n+    jobject cgeRef = (*env)->NewWeakGlobalRef(env, this);\n@@ -149,1 +149,1 @@\n-    if (CGDisplayRegisterReconfigurationCallback(&displaycb_handle, wrapper) != kCGErrorSuccess) {\n+    if (CGDisplayRegisterReconfigurationCallback(&displaycb_handle, cgeRef) != kCGErrorSuccess) {\n@@ -154,1 +154,1 @@\n-    ret = ptr_to_jlong(wrapper);\n+    ret = ptr_to_jlong(cgeRef);\n@@ -172,2 +172,2 @@\n-    JNFWeakJObjectWrapper *wrapper = (JNFWeakJObjectWrapper *)jlong_to_ptr(p);\n-    if (!wrapper) return;\n+    jobject cgeRef = (jobject)jlong_to_ptr(p);\n+    if (!cgeRef) return;\n@@ -176,1 +176,1 @@\n-    if (CGDisplayRemoveReconfigurationCallback(&displaycb_handle, wrapper) != kCGErrorSuccess) {\n+    if (CGDisplayRemoveReconfigurationCallback(&displaycb_handle, cgeRef) != kCGErrorSuccess) {\n@@ -181,2 +181,1 @@\n-    [wrapper setJObject:NULL withEnv:env]; \/\/ more efficient to pre-clear\n-    [wrapper release];\n+    (*env)->DeleteWeakGlobalRef(env, cgeRef);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CGraphicsEnv.m","additions":9,"deletions":10,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -115,1 +115,1 @@\n-+ (void) _nativeNotifyPeerWithView:(AWTView *)view inputMethod:(JNFJObjectWrapper *) inputMethod {\n++ (void) _nativeNotifyPeerWithView:(AWTView *)view inputMethod:(jobject) inputMethod {\n@@ -121,1 +121,1 @@\n-    [view setInputMethod:[inputMethod jObject]];\n+    [view setInputMethod:inputMethod]; \/\/ inputMethod is a GlobalRef\n@@ -180,1 +180,1 @@\n-    JNFJObjectWrapper *inputMethodWrapper = [[JNFJObjectWrapper alloc] initWithJObject:inputMethod withEnv:env];\n+    jobject inputMethodRef = (*env)->NewGlobalRef(env, inputMethod);\n@@ -182,1 +182,1 @@\n-        [CInputMethod _nativeNotifyPeerWithView:view inputMethod:inputMethodWrapper];\n+        [CInputMethod _nativeNotifyPeerWithView:view inputMethod:inputMethodRef];\n@@ -237,1 +237,1 @@\n-            JNFDeleteGlobalRef(env, sLastKeyboardLocaleObj);\n+            (*env)->DeleteGlobalRef(env, sLastKeyboardLocaleObj);\n@@ -241,1 +241,1 @@\n-            sLastKeyboardLocaleObj = JNFNewGlobalRef(env, localObj);\n+            sLastKeyboardLocaleObj = (*env)->NewGlobalRef(env, localObj);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CInputMethod.m","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -46,1 +46,1 @@\n-    JNFDeleteGlobalRef(env, fPeer);\n+    (*env)->DeleteGlobalRef(env, fPeer);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CMenuComponent.m","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -65,1 +65,1 @@\n-    jobject cPeerObjGlobal = JNFNewGlobalRef(env, peer);\n+    jobject cPeerObjGlobal = (*env)->NewGlobalRef(env, peer);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CPopupMenu.m","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -78,1 +78,1 @@\n-    JNFDeleteGlobalRef(env, peer);\n+    (*env)->DeleteGlobalRef(env, peer);\n@@ -314,1 +314,1 @@\n-    jobject thePeer = JNFNewGlobalRef(env, peer);\n+    jobject thePeer = (*env)->NewGlobalRef(env, peer);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CTrayIcon.m","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1455,1 +1455,1 @@\n-    JNFDeleteGlobalRef(env, qsdo->javaGraphicsStatesObjects);\n+    (*env)->DeleteGlobalRef(env, qsdo->javaGraphicsStatesObjects);\n@@ -1487,1 +1487,1 @@\n-        JNFDeleteGlobalRef(env, isdo->array);\n+        (*env)->DeleteGlobalRef(env, isdo->array);\n@@ -1492,1 +1492,1 @@\n-        JNFDeleteGlobalRef(env, isdo->icm);\n+        (*env)->DeleteGlobalRef(env, isdo->icm);\n@@ -1851,1 +1851,1 @@\n-    isdo->array                            = (array != NULL) ? JNFNewGlobalRef(env, array) : NULL;\n+    isdo->array                            = (array != NULL) ? (*env)->NewGlobalRef(env, array) : NULL;\n@@ -1857,1 +1857,1 @@\n-    isdo->icm                            = (icm != NULL) ? JNFNewGlobalRef(env, icm) : NULL;\n+    isdo->icm                            = (icm != NULL) ? (*env)->NewGlobalRef(env, icm) : NULL;\n@@ -1965,1 +1965,1 @@\n-    qsdo->javaGraphicsStatesObjects        = JNFNewGlobalRef(env, jGraphicsStateObject);\n+    qsdo->javaGraphicsStatesObjects        = (*env)->NewGlobalRef(env, jGraphicsStateObject);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/ImageSurfaceData.m","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -39,1 +39,2 @@\n-        fAccessibleAction = JNFNewWeakGlobalRef(env, accessibleAction);\n+        fAccessibleAction = (*env)->NewWeakGlobalRef(env, accessibleAction);\n+        CHECK_EXCEPTION();\n@@ -41,1 +42,2 @@\n-        fComponent = JNFNewWeakGlobalRef(env, component);\n+        fComponent = (*env)->NewWeakGlobalRef(env, component);\n+        CHECK_EXCEPTION();\n@@ -50,1 +52,1 @@\n-    JNFDeleteWeakGlobalRef(env, fAccessibleAction);\n+    (*env)->DeleteWeakGlobalRef(env, fAccessibleAction);\n@@ -53,1 +55,1 @@\n-    JNFDeleteWeakGlobalRef(env, fComponent);\n+    (*env)->DeleteWeakGlobalRef(env, fComponent);\n@@ -67,0 +69,1 @@\n+    \/* WeakGlobalRefs can be cleared at any time, so first get strong local refs and use those *\/\n@@ -71,0 +74,5 @@\n+    jobject fAccessibleActionLocal = (*env)->NewLocalRef(env, fAccessibleAction);\n+    if ((*env)->IsSameObject(env, fAccessibleActionLocal, NULL)) {\n+        (*env)->DeleteLocalRef(env, fCompLocal);\n+        return nil;\n+    }\n@@ -74,1 +82,1 @@\n-                                              fAccessibleAction,\n+                                              fAccessibleActionLocal,\n@@ -83,0 +91,1 @@\n+    (*env)->DeleteLocalRef(env, fAccessibleActionLocal);\n@@ -107,1 +116,2 @@\n-        fTabGroup = JNFNewWeakGlobalRef(env, tabGroup);\n+        fTabGroup = (*env)->NewWeakGlobalRef(env, tabGroup);\n+        CHECK_EXCEPTION();\n@@ -109,1 +119,2 @@\n-        fComponent = JNFNewWeakGlobalRef(env, component);\n+        fComponent = (*env)->NewWeakGlobalRef(env, component);\n+        CHECK_EXCEPTION();\n@@ -118,1 +129,1 @@\n-    JNFDeleteWeakGlobalRef(env, fTabGroup);\n+    (*env)->DeleteWeakGlobalRef(env, fTabGroup);\n@@ -121,1 +132,1 @@\n-    JNFDeleteWeakGlobalRef(env, fComponent);\n+    (*env)->DeleteWeakGlobalRef(env, fComponent);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/JavaAccessibilityAction.m","additions":20,"deletions":9,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -1840,1 +1840,2 @@\n-            fTabGroupAxContext = JNFNewWeakGlobalRef(env, tabGroup);\n+            fTabGroupAxContext = (*env)->NewWeakGlobalRef(env, tabGroup);\n+            CHECK_EXCEPTION();\n@@ -1853,1 +1854,1 @@\n-        JNFDeleteWeakGlobalRef(env, fTabGroupAxContext);\n+        (*env)->DeleteWeakGlobalRef(env, fTabGroupAxContext);\n@@ -1886,1 +1887,2 @@\n-        fTabGroupAxContext = JNFNewWeakGlobalRef(env, tabGroupAxContext);\n+        fTabGroupAxContext = (*env)->NewWeakGlobalRef(env, tabGroupAxContext);\n+        CHECK_EXCEPTION();\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/JavaComponentAccessibility.m","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -48,1 +48,1 @@\n-        fPrinterJob = JNFNewGlobalRef(env, printerJob);\n+        fPrinterJob = (*env)->NewGlobalRef(env, printerJob);\n@@ -60,1 +60,1 @@\n-        JNFDeleteGlobalRef(env, fCurPageFormat);\n+        (*env)->DeleteGlobalRef(env, fCurPageFormat);\n@@ -65,1 +65,1 @@\n-        JNFDeleteGlobalRef(env, fCurPainter);\n+        (*env)->DeleteGlobalRef(env, fCurPainter);\n@@ -70,1 +70,1 @@\n-        JNFDeleteGlobalRef(env, fCurPeekGraphics);\n+        (*env)->DeleteGlobalRef(env, fCurPeekGraphics);\n@@ -169,1 +169,1 @@\n-    \/\/ Assertions removed, and corresponding JNFDeleteGlobalRefs added, for radr:\/\/3962543\n+    \/\/ Assertions removed, and corresponding DeleteGlobalRefs added, for radr:\/\/3962543\n@@ -177,1 +177,1 @@\n-        JNFDeleteGlobalRef(env, fCurPageFormat);\n+        (*env)->DeleteGlobalRef(env, fCurPageFormat);\n@@ -180,1 +180,1 @@\n-        JNFDeleteGlobalRef(env, fCurPainter);\n+        (*env)->DeleteGlobalRef(env, fCurPainter);\n@@ -183,1 +183,1 @@\n-        JNFDeleteGlobalRef(env, fCurPeekGraphics);\n+        (*env)->DeleteGlobalRef(env, fCurPeekGraphics);\n@@ -204,1 +204,1 @@\n-        fCurPageFormat = JNFNewGlobalRef(env, pageFormat);\n+        fCurPageFormat = (*env)->NewGlobalRef(env, pageFormat);\n@@ -208,1 +208,1 @@\n-        fCurPainter = JNFNewGlobalRef(env, painter);\n+        fCurPainter = (*env)->NewGlobalRef(env, painter);\n@@ -212,1 +212,1 @@\n-        fCurPeekGraphics = JNFNewGlobalRef(env, peekGraphics);\n+        fCurPeekGraphics = (*env)->NewGlobalRef(env, peekGraphics);\n@@ -283,1 +283,1 @@\n-        JNFDeleteGlobalRef(env, fPrinterJob);\n+        (*env)->DeleteGlobalRef(env, fPrinterJob);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/PrinterView.m","additions":12,"deletions":12,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-    JNFWeakJObjectWrapper *javaLayer;\n+    jobject javaLayer;\n@@ -43,1 +43,1 @@\n-@property (nonatomic, retain) JNFWeakJObjectWrapper *javaLayer;\n+@property (nonatomic) jobject javaLayer;\n@@ -49,1 +49,1 @@\n-- (id) initWithJavaLayer:(JNFWeakJObjectWrapper *)javaLayer;\n+- (id) initWithJavaLayer:(jobject)javaLayer;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/opengl\/CGLLayer.h","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-- (id) initWithJavaLayer:(JNFWeakJObjectWrapper *)layer;\n+- (id) initWithJavaLayer:(jobject)layer;\n@@ -82,0 +82,2 @@\n+    JNIEnv *env = [ThreadUtilities getJNIEnvUncached];\n+    (*env)->DeleteWeakGlobalRef(env, self.javaLayer);\n@@ -136,1 +138,1 @@\n-    jobject javaLayerLocalRef = [self.javaLayer jObjectWithEnv:env];\n+    jobject javaLayerLocalRef = (*env)->NewLocalRef(env, self.javaLayer);\n@@ -175,1 +177,1 @@\n-    JNFWeakJObjectWrapper *javaLayer = [JNFWeakJObjectWrapper wrapperWithJObject:obj withEnv:env];\n+    jobject javaLayer = (*env)->NewWeakGlobalRef(env, obj);\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/opengl\/CGLLayer.m","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-    JNFJObjectWrapper *javaObjectWrapper;\n+    jobject javaObject;\n@@ -72,1 +72,1 @@\n-@property (nonatomic, retain) JNFJObjectWrapper *javaObjectWrapper;\n+@property (nonatomic) jobject javaObject;\n@@ -74,1 +74,1 @@\n-- (id)initFromMenu:(NSMenu *)menu javaObj:(JNFJObjectWrapper *)obj;\n+- (id)initFromMenu:(NSMenu *)menu javaObj:(jobject)obj;\n@@ -82,1 +82,1 @@\n-@synthesize javaObjectWrapper;\n+@synthesize javaObject;\n@@ -84,1 +84,1 @@\n-- (id)initFromMenu:(NSMenu *)aMenu javaObj:(JNFJObjectWrapper *)obj\n+- (id)initFromMenu:(NSMenu *)aMenu javaObj:(jobject)obj\n@@ -89,1 +89,1 @@\n-        self.javaObjectWrapper = obj;\n+        self.javaObject = obj;\n@@ -100,1 +100,1 @@\n-    if (self.javaObjectWrapper == nil) {\n+    if (self.javaObject == nil) {\n@@ -112,1 +112,1 @@\n-    (*env)->CallVoidMethod(env, [self.javaObjectWrapper jObject], jm_ScreenMenu_invokeOpenLater); \/\/ AWT_THREADING Safe (AWTRunLoopMode)\n+    (*env)->CallVoidMethod(env, self.javaObject, jm_ScreenMenu_invokeOpenLater); \/\/ AWT_THREADING Safe (AWTRunLoopMode)\n@@ -120,1 +120,1 @@\n-    if (self.javaObjectWrapper == nil) {\n+    if (self.javaObject == nil) {\n@@ -132,1 +132,1 @@\n-    (*env)->CallVoidMethod(env, [self.javaObjectWrapper jObject], jm_ScreenMenu_invokeMenuClosing); \/\/ AWT_THREADING Safe (AWTRunLoopMode)\n+    (*env)->CallVoidMethod(env, self.javaObject, jm_ScreenMenu_invokeMenuClosing); \/\/ AWT_THREADING Safe (AWTRunLoopMode)\n@@ -140,1 +140,1 @@\n-    if (self.javaObjectWrapper == nil) {\n+    if (self.javaObject== nil) {\n@@ -152,1 +152,1 @@\n-    (*env)->CallVoidMethod(env, [self.javaObjectWrapper jObject], jm_ScreenMenu_updateSelectedItem, menuIndex,\n+    (*env)->CallVoidMethod(env, self.javaObject, jm_ScreenMenu_updateSelectedItem, menuIndex,\n@@ -197,1 +197,1 @@\n-    (*env)->CallVoidMethod(env, [self.javaObjectWrapper jObject], jm_ScreenMenu_handleMouseEvent,\n+    (*env)->CallVoidMethod(env, self.javaObject, jm_ScreenMenu_handleMouseEvent,\n@@ -218,1 +218,1 @@\n-    JNFJObjectWrapper *wrapper = [JNFJObjectWrapper wrapperWithJObject:listener withEnv:env];\n+    jobject listenerRef = (*env)->NewGlobalRef(env, listener);\n@@ -221,1 +221,1 @@\n-    delegate = [[[NativeToJavaDelegate alloc] initFromMenu:menu javaObj:wrapper] autorelease];\n+    delegate = [[[NativeToJavaDelegate alloc] initFromMenu:menu javaObj:listenerRef] autorelease];\n@@ -256,1 +256,0 @@\n-        delegate.javaObjectWrapper = nil;\n@@ -259,0 +258,3 @@\n+    (*env)->DeleteGlobalRef(env, delegate.javaObject);\n+    delegate.javaObject = nil;\n+\n","filename":"src\/java.desktop\/macosx\/native\/libosxui\/ScreenMenu.m","additions":18,"deletions":16,"binary":false,"changes":34,"status":"modified"}]}