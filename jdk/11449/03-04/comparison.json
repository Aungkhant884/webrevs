{"files":[{"patch":"@@ -33,0 +33,15 @@\n+\/\/ Helper class to avoid refreshing the NMTUsage to often and allow\n+\/\/ the two JFR events to use the same data.\n+class MemJFRCurrentUsage : public AllStatic {\n+private:\n+  \/\/ The age threshold in milliseconds. If older than this refresh the usage.\n+  static const uint64_t AgeThreshold = 50;\n+\n+  static Ticks _timestamp;\n+  static NMTUsage* _usage;\n+\n+public:\n+  static NMTUsage* get_usage();\n+  static Ticks get_timestamp();\n+};\n+\n@@ -36,1 +51,0 @@\n-\n@@ -67,1 +81,1 @@\n-  EventNativeMemoryUsageTotal event;\n+  EventNativeMemoryUsageTotal event(UNTIMED);\n@@ -75,1 +89,1 @@\n-  EventNativeMemoryUsage event;\n+  EventNativeMemoryUsage event(UNTIMED);\n","filename":"src\/hotspot\/share\/services\/memJfrReporter.cpp","additions":17,"deletions":3,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -33,2 +33,3 @@\n-\/\/ The MemJFRReporter and MemJFRCurrentUsage classes are only to be used from the\n-\/\/ thread sending periodic JFR events. So no synchronization is needed.\n+\/\/ MemJFRReporter is only used by threads sending periodic JFR\n+\/\/ events. These threads are synchronized at a higher level,\n+\/\/ so no more synchronization is needed.\n@@ -43,15 +44,0 @@\n-\/\/ Helper class to avoid refreshing the NMTUsage to often and allow\n-\/\/ the two JFR events to use the same data.\n-class MemJFRCurrentUsage : public AllStatic {\n-private:\n-  \/\/ The age threshold in milliseconds. If older that this refresh the usage.\n-  static const uint64_t AgeThreshold = 50;\n-\n-  static Ticks _timestamp;\n-  static NMTUsage* _usage;\n-\n-public:\n-  static NMTUsage* get_usage();\n-  static Ticks get_timestamp();\n-};\n-\n","filename":"src\/hotspot\/share\/services\/memJfrReporter.hpp","additions":3,"deletions":17,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-        \/\/ an event att the beginning of the chunk as well as the end.\n+        \/\/ an event at the beginning of the chunk as well as at the end.\n","filename":"test\/jdk\/jdk\/jfr\/event\/runtime\/TestNativeMemoryUsageEvents.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}