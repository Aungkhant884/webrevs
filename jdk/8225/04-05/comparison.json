{"files":[{"patch":"@@ -1153,1 +1153,0 @@\n-Thread* os::ThreadCrashProtection::_protected_thread = NULL;\n@@ -1155,0 +1154,2 @@\n+sigset_t os::ThreadCrashProtection::_saved_sig_mask;\n+\n@@ -1167,2 +1168,0 @@\n-  sigset_t saved_sig_mask;\n-\n@@ -1172,1 +1171,3 @@\n-  pthread_sigmask(0, NULL, &saved_sig_mask);\n+  if (_outer_protection == NULL) { \/\/ only for the outer most crash protection\n+    pthread_sigmask(0, NULL, &_saved_sig_mask);\n+  }\n@@ -1174,0 +1175,3 @@\n+    \/\/ store the currently active crash protection\n+    \/\/ this happens if crash protections are nested\n+    _outer_protection = _crash_protection;\n@@ -1178,3 +1182,2 @@\n-    \/\/ and clear the crash protection\n-    _crash_protection = NULL;\n-    _protected_thread = NULL;\n+    \/\/ and reset the crash protection\n+    _crash_protection = _outer_protection;\n@@ -1184,3 +1187,2 @@\n-  pthread_sigmask(SIG_SETMASK, &saved_sig_mask, NULL);\n-  _crash_protection = NULL;\n-  _protected_thread = NULL;\n+  pthread_sigmask(SIG_SETMASK, &_saved_sig_mask, NULL);\n+  _crash_protection = _outer_protection;\n@@ -1197,5 +1199,1 @@\n-\n-  if (thread != NULL &&\n-      thread == _protected_thread &&\n-      _crash_protection != NULL) {\n-\n+  if (thread != NULL && is_crash_protected(thread)) {\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -121,1 +121,1 @@\n-    return _crash_protection != NULL && _protected_thread == thr;\n+    return _crash_protection != NULL && _crash_protection->_protected_thread == thr;\n@@ -129,1 +129,1 @@\n-  static Thread* _protected_thread;\n+\n@@ -131,0 +131,2 @@\n+  ThreadCrashProtection* _outer_protection;\n+  Thread* _protected_thread;\n@@ -133,0 +135,1 @@\n+  static sigset_t _saved_sig_mask;\n","filename":"src\/hotspot\/os\/posix\/os_posix.hpp","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -461,0 +461,1 @@\n+\n","filename":"src\/hotspot\/share\/prims\/forte.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}