{"files":[{"patch":"@@ -121,2 +121,2 @@\n-                       ? new VarHandleReferences.FieldStaticReadOnly(base, foffset, type)\n-                       : new VarHandleReferences.FieldStaticReadWrite(base, foffset, type));\n+                       ? new VarHandleReferences.FieldStaticReadOnly(refc, base, foffset, type)\n+                       : new VarHandleReferences.FieldStaticReadWrite(refc, base, foffset, type));\n@@ -126,2 +126,2 @@\n-                       ? new VarHandleBooleans.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleBooleans.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleBooleans.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleBooleans.FieldStaticReadWrite(refc, base, foffset));\n@@ -131,2 +131,2 @@\n-                       ? new VarHandleBytes.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleBytes.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleBytes.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleBytes.FieldStaticReadWrite(refc, base, foffset));\n@@ -136,2 +136,2 @@\n-                       ? new VarHandleShorts.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleShorts.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleShorts.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleShorts.FieldStaticReadWrite(refc, base, foffset));\n@@ -141,2 +141,2 @@\n-                       ? new VarHandleChars.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleChars.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleChars.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleChars.FieldStaticReadWrite(refc, base, foffset));\n@@ -146,2 +146,2 @@\n-                       ? new VarHandleInts.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleInts.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleInts.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleInts.FieldStaticReadWrite(refc, base, foffset));\n@@ -151,2 +151,2 @@\n-                       ? new VarHandleLongs.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleLongs.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleLongs.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleLongs.FieldStaticReadWrite(refc, base, foffset));\n@@ -156,2 +156,2 @@\n-                       ? new VarHandleFloats.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleFloats.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleFloats.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleFloats.FieldStaticReadWrite(refc, base, foffset));\n@@ -161,2 +161,2 @@\n-                       ? new VarHandleDoubles.FieldStaticReadOnly(base, foffset)\n-                       : new VarHandleDoubles.FieldStaticReadWrite(base, foffset));\n+                       ? new VarHandleDoubles.FieldStaticReadOnly(refc, base, foffset)\n+                       : new VarHandleDoubles.FieldStaticReadWrite(refc, base, foffset));\n@@ -186,1 +186,1 @@\n-    static Field getStaticFieldFromBaseAndOffset(Object base,\n+    static Field getStaticFieldFromBaseAndOffset(Class<?> receiverType,\n@@ -189,2 +189,0 @@\n-        \/\/ @@@ This is a little fragile assuming the base is the class\n-        Class<?> receiverType = (Class<?>) base;\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/VarHandles.java","additions":19,"deletions":21,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -385,0 +385,1 @@\n+        final Class<?> receiverType;\n@@ -391,2 +392,2 @@\n-        FieldStaticReadOnly(Object base, long fieldOffset{#if[Object]?, Class<?> fieldType}) {\n-            this(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadOnly.FORM, false);\n+        FieldStaticReadOnly(Class<?> receiverType, Object base, long fieldOffset{#if[Object]?, Class<?> fieldType}) {\n+            this(receiverType, base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadOnly.FORM, false);\n@@ -395,1 +396,1 @@\n-        protected FieldStaticReadOnly(Object base, long fieldOffset{#if[Object]?, Class<?> fieldType},\n+        protected FieldStaticReadOnly(Class<?> receiverType, Object base, long fieldOffset{#if[Object]?, Class<?> fieldType},\n@@ -398,0 +399,1 @@\n+            this.receiverType = receiverType;\n@@ -409,1 +411,1 @@\n-                : new FieldStaticReadOnly(base, fieldOffset{#if[Object]?, fieldType}, vform, true);\n+                : new FieldStaticReadOnly(receiverType, base, fieldOffset{#if[Object]?, fieldType}, vform, true);\n@@ -416,1 +418,1 @@\n-                : new FieldStaticReadOnly(base, fieldOffset{#if[Object]?, fieldType}, vform, false);\n+                : new FieldStaticReadOnly(receiverType, base, fieldOffset{#if[Object]?, fieldType}, vform, false);\n@@ -427,1 +429,1 @@\n-                base, fieldOffset, {#if[Object]?fieldType:$type$.class});\n+                receiverType, fieldOffset, {#if[Object]?fieldType:$type$.class});\n@@ -472,2 +474,2 @@\n-        FieldStaticReadWrite(Object base, long fieldOffset{#if[Object]?, Class<?> fieldType}) {\n-            this(base, fieldOffset{#if[Object]?, fieldType}, false);\n+        FieldStaticReadWrite(Class<?> receiverType, Object base, long fieldOffset{#if[Object]?, Class<?> fieldType}) {\n+            this(receiverType, base, fieldOffset{#if[Object]?, fieldType}, false);\n@@ -476,1 +478,1 @@\n-        private FieldStaticReadWrite(Object base, long fieldOffset{#if[Object]?, Class<?> fieldType},\n+        private FieldStaticReadWrite(Class<?> receiverType, Object base, long fieldOffset{#if[Object]?, Class<?> fieldType},\n@@ -478,1 +480,1 @@\n-            super(base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM, exact);\n+            super(receiverType, base, fieldOffset{#if[Object]?, fieldType}, FieldStaticReadWrite.FORM, exact);\n@@ -485,1 +487,1 @@\n-                : new FieldStaticReadWrite(base, fieldOffset{#if[Object]?, fieldType}, true);\n+                : new FieldStaticReadWrite(receiverType, base, fieldOffset{#if[Object]?, fieldType}, true);\n@@ -492,1 +494,1 @@\n-                : new FieldStaticReadWrite(base, fieldOffset{#if[Object]?, fieldType}, false);\n+                : new FieldStaticReadWrite(receiverType, base, fieldOffset{#if[Object]?, fieldType}, false);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/invoke\/X-VarHandle.java.template","additions":14,"deletions":12,"binary":false,"changes":26,"status":"modified"}]}