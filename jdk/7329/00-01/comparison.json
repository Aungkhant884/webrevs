{"files":[{"patch":"@@ -2,1 +2,1 @@\n-* Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+* Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,6 +56,0 @@\n-  \/\/ CFLH check is skipped for VM hidden classes (see KlassFactory::create_from_stream).\n-  \/\/ It will be skipped for shared VM hidden lambda proxy classes.\n-  \/\/ Also skipped for shared regenerated classes.\n-  if (ik->is_hidden() || ik->is_regenerated()) {\n-    return NULL;\n-  }\n","filename":"src\/hotspot\/share\/classfile\/klassFactory.cpp","additions":1,"deletions":7,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1997, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1997, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -1152,2 +1152,7 @@\n-  InstanceKlass* new_ik = KlassFactory::check_shared_class_file_load_hook(ik, class_name,\n-                            class_loader, protection_domain, cfs, CHECK_NULL);\n+  InstanceKlass* new_ik = NULL;\n+  \/\/ CFLH check is skipped for VM hidden classes (see KlassFactory::create_from_stream).\n+  \/\/ It will be skipped for shared VM hidden lambda proxy classes.\n+  if (!SystemDictionaryShared::is_hidden_lambda_proxy(ik)) {\n+    new_ik = KlassFactory::check_shared_class_file_load_hook(\n+      ik, class_name, class_loader, protection_domain, cfs, CHECK_NULL);\n+  }\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -266,0 +266,9 @@\n+bool SystemDictionaryShared::is_hidden_lambda_proxy(InstanceKlass* ik) {\n+  assert(ik->is_shared(), \"applicable to only a shared class\");\n+  if (ik->is_hidden()) {\n+    return true;\n+  } else {\n+    return false;\n+  }\n+}\n+\n@@ -1409,0 +1418,4 @@\n+    \/\/ The regenerated lamdbda Holder classes are not saved, should avoid call CFLH\n+    if (record->_klass->is_regenerated() && JvmtiExport::should_post_class_file_load_hook()) {\n+       return NULL;\n+    }\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -194,0 +194,1 @@\n+  static bool is_hidden_lambda_proxy(InstanceKlass* ik);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}