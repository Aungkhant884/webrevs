{"files":[{"patch":"@@ -1616,21 +1616,0 @@\n-        \/**\n-         * Unless already deregistered, interrupts if a worker, and cancels tasks\n-         *\/\n-        final void onStop() {\n-            Thread o = owner;\n-            if (source != DEREGISTERED) {\n-                if (o != null) {\n-                    try {\n-                        o.interrupt();\n-                    } catch (Throwable ignore) {\n-                    }\n-                }\n-                for (ForkJoinTask<?> t; (t = poll(null)) != null; ) {\n-                    try {\n-                        t.cancel(false);\n-                    } catch (Throwable ignore) {\n-                    }\n-                }\n-            }\n-        }\n-\n@@ -1890,6 +1869,0 @@\n-                    for (ForkJoinTask<?> t; (t = w.nextLocalTask()) != null; ) {\n-                        try {\n-                            t.cancel(false);\n-                        } catch (Throwable ignore) {\n-                        }\n-                    }\n@@ -1907,1 +1880,8 @@\n-\n+        if (w != null) {                  \/\/ cancel remaining tasks\n+            for (ForkJoinTask<?> t; (t = w.nextLocalTask()) != null; ) {\n+                try {\n+                    t.cancel(false);\n+                } catch (Throwable ignore) {\n+                }\n+            }\n+        }\n@@ -2049,1 +2029,2 @@\n-                if ((window = scan(w, window, r)) >= 0L) { \/\/ empty scan\n+                if (window == (window = scan(w, window, r)) &&\n+                    window >= 0L) {                        \/\/ empty scan\n@@ -2759,2 +2740,2 @@\n-        int e, s, isShutdown;\n-        if (((e = runState) & STOP) == 0) {\n+        int e = runState;\n+        if ((e & STOP) == 0) {\n@@ -2762,1 +2743,2 @@\n-                runState = ((s = lockRunState()) + RS_LOCK) | STOP | SHUTDOWN;\n+                int s = lockRunState();\n+                runState = e = (s + RS_LOCK) | STOP | SHUTDOWN;\n@@ -2767,1 +2749,2 @@\n-                if ((isShutdown = (e & SHUTDOWN)) == 0 && enable)\n+                int isShutdown = (e & SHUTDOWN);\n+                if (isShutdown == 0 && enable)\n@@ -2771,0 +2754,1 @@\n+                e = runState;\n@@ -2772,1 +2756,0 @@\n-            e = runState;\n@@ -2779,3 +2762,2 @@\n-                int j; WorkQueue q; ForkJoinTask<?> t;\n-                while ((q = qs[r & SMASK & (n - 1)]) != null &&\n-                       q.source != DEREGISTERED &&\n+                int j = r & SMASK & (n - 1); WorkQueue q; ForkJoinTask<?> t;\n+                while ((q = qs[j]) != null && q.source != DEREGISTERED &&\n@@ -3360,0 +3342,9 @@\n+    \/\/ for jdk version < 22, replace with\n+    \/\/ \/**\n+    \/\/  * @throws NullPointerException       {@inheritDoc}\n+    \/\/  * @throws RejectedExecutionException {@inheritDoc}\n+    \/\/  *\/\n+    \/\/ @Override\n+    \/\/ public <T> List<Future<T>> invokeAll(Collection<? extends Callable<T>> tasks) {\n+    \/\/     return invokeAllUninterruptibly(tasks);\n+    \/\/ }\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":28,"deletions":37,"binary":false,"changes":65,"status":"modified"}]}