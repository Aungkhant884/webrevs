{"files":[{"patch":"@@ -1303,1 +1303,1 @@\n-            int s = top++, cap, m; ForkJoinTask<?>[] a;\n+            int s = top++, cap, m, d; ForkJoinTask<?>[] a;\n@@ -1305,1 +1305,1 @@\n-                if ((m = cap - 1) == s - base)\n+                if ((d = (m = cap - 1) - (s - base)) == 0)\n@@ -1315,2 +1315,0 @@\n-                    if (a[m & (s - 1)] == null && pool != null)\n-                        pool.signalWork();\n@@ -1318,0 +1316,2 @@\n+                if ((d == 0 || a[m & (s - 1)] == null) && pool != null)\n+                    pool.signalWork();\n@@ -1994,1 +1994,1 @@\n-            long phaseSum = -1L;\n+            long phaseSum = 0L;\n@@ -2000,1 +2000,1 @@\n-                else if ((c & RC_MASK) > 0L)\n+                else if ((c & RC_MASK) != 0L)\n@@ -2008,7 +2008,8 @@\n-                        if ((q = qs[i]) == null)\n-                            sum += (long)(i + 1) << 48;\n-                        else if (((p = q.phase) & IDLE) == 0 ||\n-                                 q.top - q.base > 0) {\n-                            if ((i & 1) == 0)\n-                                signalWork();             \/\/ ensure live\n-                            return false;\n+                        if ((q = qs[i]) != null) {\n+                            if (((p = q.phase) & IDLE) == 0 ||\n+                                q.top - q.base > 0) {\n+                                if ((i & 1) == 0)\n+                                    signalWork();         \/\/ ensure live\n+                                return false;\n+                            }\n+                            sum += p & 0xffffffffL;\n@@ -2016,2 +2017,0 @@\n-                        else\n-                            sum += p;\n@@ -2135,1 +2134,1 @@\n-        boolean quiescent = (queuedCtl & RC_MASK) <= 0L && isQuiescent(true);\n+        boolean quiescent = (queuedCtl & RC_MASK) == 0L && isQuiescent(true);\n","filename":"src\/java.base\/share\/classes\/java\/util\/concurrent\/ForkJoinPool.java","additions":15,"deletions":16,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2449,1 +2449,1 @@\n-        } while (!compareAndSetInt(o, offset, v, v + delta));\n+        } while (!weakCompareAndSetInt(o, offset, v, v + delta));\n@@ -2487,1 +2487,1 @@\n-        } while (!compareAndSetLong(o, offset, v, v + delta));\n+        } while (!weakCompareAndSetLong(o, offset, v, v + delta));\n@@ -2514,1 +2514,1 @@\n-        } while (!compareAndSetByte(o, offset, v, (byte) (v + delta)));\n+        } while (!weakCompareAndSetByte(o, offset, v, (byte) (v + delta)));\n@@ -2541,1 +2541,1 @@\n-        } while (!compareAndSetShort(o, offset, v, (short) (v + delta)));\n+        } while (!weakCompareAndSetShort(o, offset, v, (short) (v + delta)));\n@@ -2588,1 +2588,1 @@\n-        } while (!compareAndSetInt(o, offset,\n+        } while (!weakCompareAndSetInt(o, offset,\n@@ -2633,1 +2633,1 @@\n-        } while (!compareAndSetLong(o, offset,\n+        } while (!weakCompareAndSetLong(o, offset,\n@@ -2684,1 +2684,1 @@\n-        } while (!compareAndSetInt(o, offset, v, newValue));\n+        } while (!weakCompareAndSetInt(o, offset, v, newValue));\n@@ -2722,1 +2722,1 @@\n-        } while (!compareAndSetLong(o, offset, v, newValue));\n+        } while (!weakCompareAndSetLong(o, offset, v, newValue));\n@@ -2760,1 +2760,1 @@\n-        } while (!compareAndSetReference(o, offset, v, newValue));\n+        } while (!weakCompareAndSetReference(o, offset, v, newValue));\n@@ -2787,1 +2787,1 @@\n-        } while (!compareAndSetByte(o, offset, v, newValue));\n+        } while (!weakCompareAndSetByte(o, offset, v, newValue));\n@@ -2829,1 +2829,1 @@\n-        } while (!compareAndSetShort(o, offset, v, newValue));\n+        } while (!weakCompareAndSetShort(o, offset, v, newValue));\n@@ -2957,1 +2957,1 @@\n-        } while (!compareAndSetByte(o, offset,\n+        } while (!weakCompareAndSetByte(o, offset,\n@@ -2988,1 +2988,1 @@\n-        } while (!compareAndSetByte(o, offset,\n+        } while (!weakCompareAndSetByte(o, offset,\n@@ -3019,1 +3019,1 @@\n-        } while (!compareAndSetByte(o, offset,\n+        } while (!weakCompareAndSetByte(o, offset,\n@@ -3097,1 +3097,1 @@\n-        } while (!compareAndSetShort(o, offset,\n+        } while (!weakCompareAndSetShort(o, offset,\n@@ -3128,1 +3128,1 @@\n-        } while (!compareAndSetShort(o, offset,\n+        } while (!weakCompareAndSetShort(o, offset,\n@@ -3159,1 +3159,1 @@\n-        } while (!compareAndSetShort(o, offset,\n+        } while (!weakCompareAndSetShort(o, offset,\n@@ -3191,1 +3191,1 @@\n-        } while (!compareAndSetInt(o, offset,\n+        } while (!weakCompareAndSetInt(o, offset,\n@@ -3233,1 +3233,1 @@\n-        } while (!compareAndSetInt(o, offset,\n+        } while (!weakCompareAndSetInt(o, offset,\n@@ -3264,1 +3264,1 @@\n-        } while (!compareAndSetInt(o, offset,\n+        } while (!weakCompareAndSetInt(o, offset,\n@@ -3296,1 +3296,1 @@\n-        } while (!compareAndSetLong(o, offset,\n+        } while (!weakCompareAndSetLong(o, offset,\n@@ -3327,1 +3327,1 @@\n-        } while (!compareAndSetLong(o, offset,\n+        } while (!weakCompareAndSetLong(o, offset,\n@@ -3358,1 +3358,1 @@\n-        } while (!compareAndSetLong(o, offset,\n+        } while (!weakCompareAndSetLong(o, offset,\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/misc\/Unsafe.java","additions":23,"deletions":23,"binary":false,"changes":46,"status":"modified"}]}