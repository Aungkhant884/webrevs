{"files":[{"patch":"@@ -32,0 +32,5 @@\n+import org.testng.annotations.Test;\n+import static org.testng.Assert.assertNotNull;\n+import static org.testng.Assert.assertTrue;\n+\n+import jdk.test.lib.util.ForceGC;\n@@ -35,0 +40,2 @@\n+ * @library \/test\/lib\/\n+ * @build jdk.test.lib.util.ForceGC\n@@ -36,1 +43,1 @@\n- * @run main\/othervm -XX:+UseParallelGC TestOSCClassLoaderLeak\n+ * @run testng TestOSCClassLoaderLeak\n@@ -40,1 +47,2 @@\n-    public static void main(String[] args) throws Exception {\n+    @Test\n+    public void run() throws Exception {\n@@ -49,1 +57,1 @@\n-        assert myOwnClassLoaderWeakReference.get() != null;\n+        assertNotNull(myOwnClassLoaderWeakReference.get());\n@@ -54,7 +62,1 @@\n-        assert myOwnClassLoaderWeakReference.get() != null;\n-\n-        gc();\n-\n-        assert myOwnClassLoaderWeakReference.get() == null;\n-\n-    }\n+        assertNotNull(myOwnClassLoaderWeakReference.get());\n@@ -62,3 +64,2 @@\n-    private static void gc() {\n-        System.runFinalization();\n-        System.gc();\n+        ForceGC gc = new ForceGC();\n+        assertTrue(gc.await(() -> myOwnClassLoaderWeakReference.get() == null));\n","filename":"test\/jdk\/java\/io\/ObjectStreamClass\/TestOSCClassLoaderLeak.java","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"}]}