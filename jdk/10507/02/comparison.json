{"files":[{"patch":"@@ -305,0 +305,2 @@\n+com.sun.management.jmxremote.serial.filter.pattern=java.lang.*;java.math.BigInteger;java.math.BigDecimal;java.util.*;javax.management.openmbean.*;javax.management.ObjectName;java.rmi.MarshalledObject;javax.security.auth.Subject;!*\n+\n","filename":"src\/jdk.management.agent\/share\/conf\/management.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8159377\n+ * @bug 8159377 8283093\n@@ -175,0 +175,4 @@\n+        testDefaultAgent(propertyFile, null);\n+    }\n+\n+    private static void testDefaultAgent(String propertyFile, String additionalArgument) throws Exception {\n@@ -177,1 +181,3 @@\n-            System.out.println(\"Attempting testDefaultAgent(\" + propertyFile + \") with port: \" + port);\n+            System.out.println(\"Attempting testDefaultAgent(\" +\n+                               (propertyFile != null ? propertyFile : \"no properties\")\n+                               + \") with port: \" + port);\n@@ -179,1 +185,1 @@\n-                testDefaultAgent(propertyFile, port);\n+                testDefaultAgent(propertyFile, additionalArgument, port);\n@@ -190,2 +196,1 @@\n-    private static void testDefaultAgent(String propertyFile, int port) throws Exception {\n-        String propFile = System.getProperty(\"test.src\") + File.separator + propertyFile;\n+    private static void testDefaultAgent(String propertyFile, String additionalArgument, int port) throws Exception {\n@@ -197,7 +202,11 @@\n-        String[] args = new String[]{\n-            \"-Dcom.sun.management.jmxremote.port=\" + port,\n-            \"-Dcom.sun.management.jmxremote.authenticate=false\",\n-            \"-Dcom.sun.management.jmxremote.ssl=false\",\n-            \"-Dcom.sun.management.config.file=\" + propFile\n-        };\n-        pbArgs.addAll(Arrays.asList(args));\n+        \/\/ JMX config arguments, using propertyFile if non-null:\n+        pbArgs.add(\"-Dcom.sun.management.jmxremote.port=\" + port);\n+        pbArgs.add(\"-Dcom.sun.management.jmxremote.authenticate=false\");\n+        pbArgs.add(\"-Dcom.sun.management.jmxremote.ssl=false\");\n+        if (propertyFile != null) {\n+            String propFile = System.getProperty(\"test.src\") + File.separator + propertyFile;\n+            pbArgs.add(\"-Dcom.sun.management.config.file=\" + propFile);\n+        }\n+        if (additionalArgument != null) {\n+            pbArgs.add(additionalArgument);\n+        }\n@@ -285,0 +294,22 @@\n+        try {\n+            \/\/ Use default filter, should fail with: java.io.InvalidClassException: filter status: REJECTED\n+            testDefaultAgent(null \/* no properties file *\/);\n+            throw new RuntimeException(\"---\" + DefaultAgentFilterTest.class.getName() + \" - No exception reported\");\n+        } catch (Exception ex) {\n+            System.out.println(ex);\n+            if (ex instanceof InvalidClassException) {\n+                System.out.println(\"----\\tTest PASSED: expected InvalidClassException received.\");\n+            } else {\n+                System.out.println(\"----\\tTest FAILED: unexpected Exception\");\n+                throw ex;\n+            }\n+        }\n+        try {\n+            \/\/ Add custom filter on command-line.\n+            testDefaultAgent(null, \"-Dcom.sun.management.jmxremote.serial.filter.pattern=\\\"java.lang.*;java.math.BigInteger;java.math.BigDecimal;java.util.*;javax.management.openmbean.*;javax.management.ObjectName;java.rmi.MarshalledObject;javax.security.auth.Subject;DefaultAgentFilterTest$MyTestObject;!*\\\"\");\n+            System.out.println(\"----\\tTest PASSED: with custom filter on command-line\");\n+        } catch (Exception ex) {\n+            System.out.println(ex);\n+            System.out.println(\"----\\tTest FAILED: unexpected Exception\");\n+            throw ex;\n+        }\n","filename":"test\/jdk\/javax\/management\/remote\/mandatory\/connection\/DefaultAgentFilterTest.java","additions":43,"deletions":12,"binary":false,"changes":55,"status":"modified"}]}