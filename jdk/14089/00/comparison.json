{"files":[{"patch":"@@ -60,2 +60,1 @@\n-    \/\/ only accessed from within synchronized blocks\n-    private boolean stopping;\n+    private volatile boolean stopping;\n@@ -296,0 +295,4 @@\n+\n+    public boolean stopping() {\n+        return stopping;\n+    }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http2ClientImpl.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -1366,0 +1366,13 @@\n+        Throwable cause = null;\n+        synchronized (this) {\n+            if (isMarked(closedState, SHUTDOWN_REQUESTED)) {\n+                cause = this.cause;\n+                if (cause == null) {\n+                    cause = new IOException(\"Connection closed\");\n+                }\n+            }\n+        }\n+        if (cause != null) {\n+            stream.cancelImpl(cause);\n+            return null;\n+        }\n@@ -1402,2 +1415,6 @@\n-                Log.logError(e);\n-                shutdown(e);\n+                if (!client2.stopping()) {\n+                    Log.logError(e);\n+                    shutdown(e);\n+                } else if (debug.on()) {\n+                    debug.log(\"Failed to send %s while stopping: %s\", frame, e);\n+                }\n@@ -1420,2 +1437,6 @@\n-                Log.logError(e);\n-                shutdown(e);\n+                if (!client2.stopping()) {\n+                    Log.logError(e);\n+                    shutdown(e);\n+                } else if (debug.on()) {\n+                    debug.log(\"Failed to send %s while stopping: %s\", frame, e);\n+                }\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Http2Connection.java","additions":25,"deletions":4,"binary":false,"changes":29,"status":"modified"}]}