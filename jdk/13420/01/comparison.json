{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,1 +36,1 @@\n-     * This method will be invoked by <tt>Finalizer<\/tt> when virtual mashine\n+     * This method will be invoked by <tt>Finalizer<\/tt> when virtual machine\n@@ -43,0 +43,7 @@\n+    \/*\n+     * This method will register a cleanup method and creates an instance of Finalizer\n+     * to register the object for finalization at VM exit.\n+     * It is implemented in FinalizableObject.\n+     *\/\n+    public void registerCleanup();\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/Finalizable.java","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +25,2 @@\n+import java.lang.ref.Cleaner;\n+\n@@ -28,2 +30,1 @@\n- * <code>Finalizable<\/code> and invokes standard <code>finalize()<\/code> method\n- * as finalization.\n+ * <code>Finalizable<\/code>.\n@@ -36,0 +37,11 @@\n+\n+    \/**\n+     * This method will be invoked by <tt>Finalizer<\/tt> when virtual mashine\n+     * shuts down.\n+     *\n+     * @throws Throwable if any throwable exception thrown during finalization\n+     *\n+     * @see Finalizer\n+     *\/\n+\n+    public void cleanup() {}\n@@ -39,2 +51,0 @@\n-     * For <code>FinalizableObject<\/code> this method just invoke\n-     * <code>finalize()<\/code>.\n@@ -44,1 +54,0 @@\n-     * @see Object#finalize()\n@@ -48,1 +57,10 @@\n-        finalize();\n+        cleanup();\n+    }\n+\n+    public void registerCleanup() {\n+       \/\/ install finalizer to print errors summary at exit\n+       Finalizer finalizer = new Finalizer(this);\n+       finalizer.activate();\n+\n+       \/\/ register the cleanup method to be called when this Log instance becomes unreachable.\n+       Cleaner.create().register(this, () -> cleanup());\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/FinalizableObject.java","additions":25,"deletions":7,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -63,2 +63,1 @@\n-        Finalizer finalizer = new Finalizer(this);\n-        finalizer.activate();\n+        registerCleanup();\n@@ -72,2 +71,1 @@\n-        Finalizer finalizer = new Finalizer(this);\n-        finalizer.activate();\n+        registerCleanup();\n@@ -169,1 +167,1 @@\n-     * Finalize mirror by invoking <code>close()<\/code>.\n+     * This method is called at finalization and calls  <code>kill()<\/code>.\n@@ -171,1 +169,0 @@\n-     * @throws Throwable if any throwable exception is thrown during finalization\n@@ -173,1 +170,1 @@\n-    protected void finalize() throws Throwable {\n+    public void cleanup() {\n@@ -175,1 +172,0 @@\n-        super.finalize();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/LocalProcess.java","additions":5,"deletions":9,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -192,3 +192,1 @@\n-        Finalizer finalizer = new Finalizer(this);\n-        finalizer.activate();\n-\n+        registerCleanup();\n@@ -199,0 +197,1 @@\n+\n@@ -473,1 +472,1 @@\n-        finalize(); \/\/ flush older log stream\n+        cleanup(); \/\/ flush older log stream\n@@ -608,0 +607,4 @@\n+     *\n+     * This is replacement of the finalize() method and is called when this\n+     * Log instance becomes unreachable.\n+     *\n@@ -609,1 +612,2 @@\n-    protected void finalize() {\n+    @Override\n+    public void cleanup() {\n@@ -622,1 +626,1 @@\n-        finalize();\n+        cleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/Log.java","additions":11,"deletions":7,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,4 +46,2 @@\n-        Finalizer finalizer = new Finalizer(new FinalizableObject());\n-        finalizer.activate();\n-\n-\n+        FinalizableObject finalizableObject = new FinalizableObject();\n+        finalizableObject.registerCleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/MainWrapper.java","additions":3,"deletions":5,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -132,3 +132,1 @@\n-        Finalizer finalizer = new Finalizer(debugee);\n-        finalizer.activate();\n-\n+        debugee.registerCleanup();\n@@ -947,2 +945,1 @@\n-        Finalizer finalizer = new Finalizer(debugee);\n-        finalizer.activate();\n+        debugee.registerCleanup();\n@@ -961,2 +958,1 @@\n-        Finalizer finalizer = new Finalizer(debugee);\n-        finalizer.activate();\n+        debugee.registerCleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jdi\/Binder.java","additions":4,"deletions":8,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -109,2 +109,1 @@\n-        Finalizer finalizer = new Finalizer(debugee);\n-        finalizer.activate();\n+        debugee.registerCleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jdwp\/Binder.java","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,0 +27,1 @@\n+import java.lang.ref.Cleaner;\n@@ -98,0 +99,1 @@\n+\n@@ -122,1 +124,9 @@\n-\n+    @Override\n+    public void registerCleanup() {\n+        \/\/ install finalizer to print errors summary at exit\n+        Finalizer finalizer = new Finalizer(this);\n+        finalizer.activate();\n+\n+        \/\/ register the cleanup method to be called when this Log instance becomes unreachable.\n+        Cleaner.create().register(this, () -> cleanup());\n+     }\n@@ -155,2 +165,2 @@\n-        Finalizer bindFinalizer = new Finalizer(this);\n-        bindFinalizer.activate();\n+        registerCleanup();\n+\n@@ -220,1 +230,1 @@\n-            finalize();\n+            cleanup();\n@@ -409,0 +419,3 @@\n+     * This is replacement of the deprecated finalize() and is called\n+     * when this instance becomes unreachable.\n+     *\n@@ -411,1 +424,1 @@\n-    protected void finalize() throws Throwable {\n+    public void cleanup() {\n@@ -413,1 +426,0 @@\n-        super.finalize();\n@@ -418,1 +430,1 @@\n-     * by invoking method <code>finalize()<\/code>.\n+     * by invoking method <code>cleanup()<\/code>.\n@@ -420,1 +432,0 @@\n-     * @see #finalize()\n@@ -423,1 +434,1 @@\n-        finalize();\n+        cleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jpda\/BindServer.java","additions":21,"deletions":10,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import java.lang.ref.Cleaner;\n@@ -112,0 +113,5 @@\n+    @Override\n+    public void registerCleanup() {\n+        \/\/ install finalizer to print errors summary at exit\n+        Finalizer finalizer = new Finalizer(this);\n+        finalizer.activate();\n@@ -113,0 +119,3 @@\n+        \/\/ register the cleanup method to be called when this Log instance becomes unreachable.\n+        Cleaner.create().register(this, () -> cleanup());\n+     }\n@@ -121,2 +130,2 @@\n-        Finalizer finalizer = new Finalizer(this);\n-        finalizer.activate();\n+\n+        registerCleanup();\n@@ -561,0 +570,4 @@\n+     *\n+     * This is replacement of the finalize() method and is called when this\n+     * instance becomes unreachable.\n+     *\n@@ -562,1 +575,1 @@\n-    protected void finalize() throws Throwable {\n+    public void cleanup() {\n@@ -564,1 +577,0 @@\n-        super.finalize();\n@@ -568,1 +580,1 @@\n-     * Finalize binder at exit by invoking <code>finalize()<\/code>.\n+     * Finalize binder at exit by invoking <code>cleanup()<\/code>.\n@@ -573,1 +585,1 @@\n-        finalize();\n+        cleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jpda\/DebugeeBinder.java","additions":19,"deletions":7,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import java.lang.ref.Cleaner;\n@@ -87,0 +88,4 @@\n+\n+        \/\/ As the alternative to finalize(), register the cleanup() method\n+        \/\/ to be called when this instance becomes unreachable.\n+        Cleaner.create().register(this, () -> cleanup());\n@@ -463,1 +468,1 @@\n-    protected void finalize() throws Throwable {\n+    public void cleanup() {\n@@ -465,1 +470,0 @@\n-        super.finalize();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jpda\/DebugeeProcess.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+import java.lang.ref.Cleaner;\n@@ -85,1 +86,9 @@\n-\n+    @Override\n+    public void registerCleanup() {\n+        \/\/ install finalizer to print errors summary at exit\n+        Finalizer finalizer = new Finalizer(this);\n+        finalizer.activate();\n+\n+        \/\/ register the cleanup method to be called when this Log instance becomes unreachable.\n+        Cleaner.create().register(this, () -> cleanup());\n+     }\n@@ -96,0 +105,2 @@\n+\n+        registerCleanup();\n@@ -107,0 +118,2 @@\n+\n+        registerCleanup();\n@@ -311,0 +324,4 @@\n+     *\n+     * This is replacement of finalize() method and is called\n+     * when this instance becomes unreachable.\n+     *\n@@ -312,1 +329,1 @@\n-    protected void finalize() throws Throwable {\n+    public void cleanup() {\n@@ -314,1 +331,0 @@\n-        super.finalize();\n@@ -321,1 +337,1 @@\n-        finalize();\n+        cleanup();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/jpda\/SocketIOPipe.java","additions":21,"deletions":5,"binary":false,"changes":26,"status":"modified"}]}