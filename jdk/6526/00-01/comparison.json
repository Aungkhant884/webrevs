{"files":[{"patch":"@@ -57,1 +57,0 @@\n-    \/\/DEBUG_ONLY(verify_raw_mem(C->root());)\n@@ -1879,99 +1878,0 @@\n-#ifdef ASSERT\n-void ShenandoahBarrierC2Support::verify_raw_mem(RootNode* root) {\n-  const bool trace = false;\n-  ResourceMark rm;\n-  Unique_Node_List nodes;\n-  Unique_Node_List controls;\n-  Unique_Node_List memories;\n-\n-  nodes.push(root);\n-  for (uint next = 0; next < nodes.size(); next++) {\n-    Node *n  = nodes.at(next);\n-    if (ShenandoahBarrierSetC2::is_shenandoah_lrb_call(n)) {\n-      controls.push(n);\n-      if (trace) { tty->print(\"XXXXXX verifying\"); n->dump(); }\n-      for (uint next2 = 0; next2 < controls.size(); next2++) {\n-        Node *m = controls.at(next2);\n-        for (DUIterator_Fast imax, i = m->fast_outs(imax); i < imax; i++) {\n-          Node* u = m->fast_out(i);\n-          if (u->is_CFG() && !u->is_Root() &&\n-              !(u->Opcode() == Op_CProj && u->in(0)->Opcode() == Op_NeverBranch && u->as_Proj()->_con == 1) &&\n-              !(u->is_Region() && u->unique_ctrl_out()->Opcode() == Op_Halt)) {\n-            if (trace) { tty->print(\"XXXXXX pushing control\"); u->dump(); }\n-            controls.push(u);\n-          }\n-        }\n-      }\n-      memories.push(n->as_Call()->proj_out(TypeFunc::Memory));\n-      for (uint next2 = 0; next2 < memories.size(); next2++) {\n-        Node *m = memories.at(next2);\n-        assert(m->bottom_type() == Type::MEMORY, \"\");\n-        for (DUIterator_Fast imax, i = m->fast_outs(imax); i < imax; i++) {\n-          Node* u = m->fast_out(i);\n-          if (u->bottom_type() == Type::MEMORY && (u->is_Mem() || u->is_ClearArray())) {\n-            if (trace) { tty->print(\"XXXXXX pushing memory\"); u->dump(); }\n-            memories.push(u);\n-          } else if (u->is_LoadStore()) {\n-            if (trace) { tty->print(\"XXXXXX pushing memory\"); u->find_out_with(Op_SCMemProj)->dump(); }\n-            memories.push(u->find_out_with(Op_SCMemProj));\n-          } else if (u->is_MergeMem() && u->as_MergeMem()->memory_at(Compile::AliasIdxRaw) == m) {\n-            if (trace) { tty->print(\"XXXXXX pushing memory\"); u->dump(); }\n-            memories.push(u);\n-          } else if (u->is_Phi()) {\n-            assert(u->bottom_type() == Type::MEMORY, \"\");\n-            if (u->adr_type() == TypeRawPtr::BOTTOM || u->adr_type() == TypePtr::BOTTOM) {\n-              assert(controls.member(u->in(0)), \"\");\n-              if (trace) { tty->print(\"XXXXXX pushing memory\"); u->dump(); }\n-              memories.push(u);\n-            }\n-          } else if (u->is_SafePoint() || u->is_MemBar()) {\n-            for (DUIterator_Fast jmax, j = u->fast_outs(jmax); j < jmax; j++) {\n-              Node* uu = u->fast_out(j);\n-              if (uu->bottom_type() == Type::MEMORY) {\n-                if (trace) { tty->print(\"XXXXXX pushing memory\"); uu->dump(); }\n-                memories.push(uu);\n-              }\n-            }\n-          }\n-        }\n-      }\n-      for (uint next2 = 0; next2 < controls.size(); next2++) {\n-        Node *m = controls.at(next2);\n-        if (m->is_Region()) {\n-          bool all_in = true;\n-          for (uint i = 1; i < m->req(); i++) {\n-            if (!controls.member(m->in(i))) {\n-              all_in = false;\n-              break;\n-            }\n-          }\n-          if (trace) { tty->print(\"XXX verifying %s\", all_in ? \"all in\" : \"\"); m->dump(); }\n-          bool found_phi = false;\n-          for (DUIterator_Fast jmax, j = m->fast_outs(jmax); j < jmax && !found_phi; j++) {\n-            Node* u = m->fast_out(j);\n-            if (u->is_Phi() && memories.member(u)) {\n-              found_phi = true;\n-              for (uint i = 1; i < u->req() && found_phi; i++) {\n-                Node* k = u->in(i);\n-                if (memories.member(k) != controls.member(m->in(i))) {\n-                  found_phi = false;\n-                }\n-              }\n-            }\n-          }\n-          assert(found_phi || all_in, \"\");\n-        }\n-      }\n-      controls.clear();\n-      memories.clear();\n-    }\n-    for( uint i = 0; i < n->len(); ++i ) {\n-      Node *m = n->in(i);\n-      if (m != NULL) {\n-        nodes.push(m);\n-      }\n-    }\n-  }\n-}\n-#endif\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahSupport.cpp","additions":0,"deletions":100,"binary":false,"changes":100,"status":"modified"},{"patch":"@@ -53,1 +53,0 @@\n-  static void verify_raw_mem(RootNode* root);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/c2\/shenandoahSupport.hpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"}]}