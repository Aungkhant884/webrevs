{"files":[{"patch":"@@ -109,1 +109,1 @@\n-  DEBUG_ONLY(_thread_last_allocated = ARENA;)\n+  DEBUG_ONLY(set_type(ARENA);)\n@@ -118,1 +118,1 @@\n-    DEBUG_ONLY(_thread_last_allocated = C_HEAP;)\n+    DEBUG_ONLY(set_type(C_HEAP);)\n@@ -137,1 +137,1 @@\n-    DEBUG_ONLY(if (res!= NULL) _thread_last_allocated = C_HEAP;)\n+    DEBUG_ONLY(if (res!= NULL) set_type(C_HEAP);)\n@@ -159,1 +159,1 @@\n-  _thread_last_allocated = STACK_OR_EMBEDDED; \/\/ reset _thread_last_allocated as the default STACK_OR_EMBEDDED can not be set by an operator new\n+  set_type(STACK_OR_EMBEDDED); \/\/ reset _thread_last_allocated as the default STACK_OR_EMBEDDED can not be set by an operator new\n@@ -163,1 +163,1 @@\n-  _thread_last_allocated = STACK_OR_EMBEDDED; \/\/ reset _thread_last_allocated as the default STACK_OR_EMBEDDED can not be set by an operator new\n+  set_type(STACK_OR_EMBEDDED); \/\/ reset _thread_last_allocated as the default STACK_OR_EMBEDDED can not be set by an operator new\n","filename":"src\/hotspot\/share\/memory\/allocation.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -398,1 +398,1 @@\n-  enum allocation_type { STACK_OR_EMBEDDED = 0, RESOURCE_AREA, C_HEAP, ARENA, allocation_mask = 0x3 };\n+  enum allocation_type : u8 { STACK_OR_EMBEDDED, RESOURCE_AREA, C_HEAP, ARENA };\n@@ -409,0 +409,7 @@\n+  static void set_type(allocation_type t) {\n+    if (t != STACK_OR_EMBEDDED) {\n+      assert(_thread_last_allocated == STACK_OR_EMBEDDED, \"_thread_last_allocated should always be reset to STACK_OR_EMBEDDED by ResourceOBJ() before being set again\");\n+    }\n+    _thread_last_allocated = t;\n+  }\n+\n@@ -433,1 +440,1 @@\n-      DEBUG_ONLY(_thread_last_allocated = RESOURCE_AREA;)\n+      DEBUG_ONLY(set_type(RESOURCE_AREA);)\n@@ -439,1 +446,1 @@\n-      DEBUG_ONLY(if (res != NULL) _thread_last_allocated = RESOURCE_AREA;)\n+      DEBUG_ONLY(if (res != NULL) set_type(RESOURCE_AREA);)\n","filename":"src\/hotspot\/share\/memory\/allocation.hpp","additions":10,"deletions":3,"binary":false,"changes":13,"status":"modified"}]}