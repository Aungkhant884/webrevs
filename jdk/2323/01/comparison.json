{"files":[{"patch":"@@ -31,0 +31,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -45,3 +46,0 @@\n-\/\/\n-\/\/ Invariant: bottom() <= top() <= end()\n-\/\/ top() and end() are exclusive.\n@@ -59,3 +57,5 @@\n-  HeapWord* _bottom;\n-  HeapWord* volatile _top;\n-  HeapWord* _end;\n+  \/\/ Supports CAS-based allocation.\n+  \/\/ Invariant: bottom() <= top() <= end()\n+  HeapWord* _bottom;            \/\/ Start of the region.\n+  HeapWord* volatile _top;      \/\/ Current allocation pointer.\n+  HeapWord* volatile _end;      \/\/ Current allocation limit.  expand() advances.\n@@ -70,0 +70,4 @@\n+ protected:\n+  HeapWord* volatile* top_addr()           { return &_top; }\n+  HeapWord* volatile* end_addr()           { return &_end; }\n+\n@@ -76,2 +80,2 @@\n-  HeapWord* top() const                    { return _top;    }\n-  HeapWord* end() const                    { return _end; }\n+  HeapWord* top() const                    { return Atomic::load(&_top); }\n+  HeapWord* end() const                    { return Atomic::load(&_end); }\n@@ -80,5 +84,2 @@\n-  virtual void set_top(HeapWord* value)    { _top = value;   }\n-  void set_end(HeapWord* value)            { _end = value; }\n-\n-  HeapWord* volatile* top_addr()           { return &_top; }\n-  HeapWord** end_addr()                    { return &_end; }\n+  virtual void set_top(HeapWord* value)    { Atomic::store(&_top, value); }\n+  void set_end(HeapWord* value)            { Atomic::store(&_end, value); }\n","filename":"src\/hotspot\/share\/gc\/parallel\/mutableSpace.hpp","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -203,3 +203,0 @@\n-  HeapWord* volatile* top_addr() const { return !UseNUMA ? young_gen()->top_addr() : (HeapWord* volatile*)-1; }\n-  HeapWord** end_addr() const { return !UseNUMA ? young_gen()->end_addr() : (HeapWord**)-1; }\n-\n","filename":"src\/hotspot\/share\/gc\/parallel\/parallelScavengeHeap.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -136,3 +136,0 @@\n-  HeapWord* volatile* top_addr() const   { return eden_space()->top_addr(); }\n-  HeapWord** end_addr() const   { return eden_space()->end_addr(); }\n-\n","filename":"src\/hotspot\/share\/gc\/parallel\/psYoungGen.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-  nonstatic_field(MutableSpace,                _end,                                          HeapWord*)                             \\\n+  volatile_nonstatic_field(MutableSpace,       _end,                                          HeapWord*)                             \\\n","filename":"src\/hotspot\/share\/gc\/parallel\/vmStructs_parallelgc.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}