{"files":[{"patch":"@@ -28,2 +28,2 @@\n-import java.nio.file.attribute.*;\n-import java.util.*;\n+import java.nio.file.attribute.FileAttributeView;\n+import java.nio.file.attribute.UserDefinedFileAttributeView;\n@@ -31,0 +31,2 @@\n+import java.util.Arrays;\n+import sun.security.action.GetPropertyAction;\n@@ -114,2 +116,2 @@\n-            if (entry().fstype().equals(\"apfs\")\n-                || entry().fstype().equals(\"hfs\")) {\n+            String fstype = entry().fstype();\n+            if (\"hfs\".equals(fstype))\n@@ -117,0 +119,3 @@\n+            if (\"apfs\".equals(fstype)) {\n+                \/\/ fgetxattr broken on APFS prior to 10.14\n+                return isOsVersionGte(10, 14);\n@@ -132,0 +137,13 @@\n+\n+    \/**\n+     * Returns true if the OS major\/minor version is greater than, or equal, to the\n+     * given major\/minor version.\n+     *\/\n+    private static boolean isOsVersionGte(int requiredMajor, int requiredMinor) {\n+        String osVersion = GetPropertyAction.privilegedGetProperty(\"os.version\");\n+        String[] vers = Util.split(osVersion, '.');\n+        int majorVersion = Integer.parseInt(vers[0]);\n+        int minorVersion = Integer.parseInt(vers[1]);\n+        return (majorVersion > requiredMajor)\n+                || (majorVersion == requiredMajor && minorVersion >= requiredMinor);\n+    }\n","filename":"src\/java.base\/macosx\/classes\/sun\/nio\/fs\/BsdFileStore.java","additions":22,"deletions":4,"binary":false,"changes":26,"status":"modified"}]}