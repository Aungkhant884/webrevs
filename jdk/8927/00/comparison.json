{"files":[{"patch":"@@ -36,0 +36,2 @@\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -47,1 +49,0 @@\n-import jdk.jfr.internal.PlatformRecording;\n@@ -57,1 +58,1 @@\n-    private final Object terminated = new Object();\n+    private final CountDownLatch terminated = new CountDownLatch(1);\n@@ -181,4 +182,1 @@\n-        long base = System.currentTimeMillis();\n-        long now = 0;\n-\n-        long millis;\n+        long nanos;\n@@ -186,1 +184,1 @@\n-            millis = Math.multiplyExact(timeout.getSeconds(), 1000);\n+            nanos = timeout.toNanos();\n@@ -188,1 +186,1 @@\n-            millis = Long.MAX_VALUE;\n+            nanos = Long.MAX_VALUE;\n@@ -190,7 +188,2 @@\n-        int nanos = timeout.toNanosPart();\n-        if (nanos == 0 && millis == 0) {\n-            synchronized (terminated) {\n-                while (!isClosed()) {\n-                    terminated.wait(0);\n-                }\n-            }\n+        if (nanos == 0) {\n+            terminated.await();\n@@ -198,10 +191,1 @@\n-            while (!isClosed()) {\n-                long delay = millis - now;\n-                if (delay <= 0) {\n-                    break;\n-                }\n-                synchronized (terminated) {\n-                    terminated.wait(delay, nanos);\n-                }\n-                now = System.currentTimeMillis() - base;\n-            }\n+            terminated.await(nanos, TimeUnit.NANOSECONDS);\n@@ -278,3 +262,1 @@\n-                synchronized (terminated) {\n-                    terminated.notifyAll();\n-                }\n+                terminated.countDown();\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/AbstractEventStream.java","additions":10,"deletions":28,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n- * @run main\/othervm jdk.jfr.jmx.streaming.TestClose\n+ * @run main\/othervm -Xlog:jfr=debug jdk.jfr.jmx.streaming.TestClose\n","filename":"test\/jdk\/jdk\/jfr\/jmx\/streaming\/TestClose.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}