{"files":[{"patch":"@@ -33,0 +33,1 @@\n+#include \"gc\/shenandoah\/shenandoahReferenceProcessor.hpp\"\n@@ -56,2 +57,2 @@\n-  bool weak = task->is_weak();\n-  cl->set_weak(weak);\n+  bool weak = cl->is_weak();\n+  ShenandoahRefStrengthScope<T> scope(cl, weak);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahMark.inline.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -340,2 +340,1 @@\n-    bool weak = cl->is_weak();\n-    cl->set_weak(true);\n+    ShenandoahRefStrengthScope<ShenandoahMarkRefsSuperClosure> scope(cl, true);\n@@ -347,1 +346,0 @@\n-    cl->set_weak(weak);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahReferenceProcessor.cpp","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -130,0 +130,16 @@\n+template <typename T>\n+class ShenandoahRefStrengthScope : public StackObj {\n+private:\n+  T* const   _cl;\n+  bool const _was_weak;\n+public:\n+  ShenandoahRefStrengthScope(T* cl, bool weak) :\n+    _cl(cl), _was_weak(cl->is_weak()) {\n+    _cl->set_weak(weak);\n+  }\n+\n+  ~ShenandoahRefStrengthScope() {\n+    _cl->set_weak(_was_weak);\n+  }\n+};\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahReferenceProcessor.hpp","additions":16,"deletions":0,"binary":false,"changes":16,"status":"modified"}]}