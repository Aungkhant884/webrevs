{"files":[{"patch":"@@ -288,0 +288,13 @@\n+class RotationLocker : public StackObj {\n+  Semaphore& _sem;\n+\n+ public:\n+  RotationLocker(Semaphore& sem) : _sem(sem) {\n+    sem.wait();\n+  }\n+\n+  ~RotationLocker() {\n+    _sem.signal();\n+  }\n+};\n+\n@@ -289,1 +302,6 @@\n-  _rotation_semaphore.wait();\n+  RotationLocker lock(_rotation_semaphore);\n+  if (_stream == NULL) {\n+    \/\/ An error has occurred with this output, avoid writing to it.\n+    return 0;\n+  }\n+\n@@ -298,1 +316,0 @@\n-  _rotation_semaphore.signal();\n@@ -330,1 +347,1 @@\n-  _rotation_semaphore.wait();\n+  RotationLocker lock(_rotation_semaphore);\n@@ -339,1 +356,0 @@\n-  _rotation_semaphore.signal();\n@@ -366,1 +382,2 @@\n-  _rotation_semaphore.wait();\n+\n+  RotationLocker lock(_rotation_semaphore);\n@@ -368,1 +385,0 @@\n-  _rotation_semaphore.signal();\n@@ -372,1 +388,0 @@\n-\n","filename":"src\/hotspot\/share\/logging\/logFileOutput.cpp","additions":22,"deletions":7,"binary":false,"changes":29,"status":"modified"}]}