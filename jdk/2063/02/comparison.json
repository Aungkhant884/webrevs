{"files":[{"patch":"@@ -4193,6 +4193,1 @@\n-    \/\/ Watch out: The memory initialized by the constructor call PrintInliningBuffer()\n-    \/\/ will be copied into the only initial element. The default destructor of\n-    \/\/ PrintInliningBuffer will be called when leaving the scope here. If it\n-    \/\/ would destuct the  enclosed stringStream _print_inlining_list[0]->_ss\n-    \/\/ would be destructed, too!\n-    _print_inlining_list = new (comp_arena())GrowableArray<PrintInliningBuffer>(comp_arena(), 1, 1, PrintInliningBuffer());\n+    _print_inlining_list = new (comp_arena())GrowableArray<PrintInliningBuffer*>(comp_arena(), 1, 1, new PrintInliningBuffer());\n@@ -4218,1 +4213,1 @@\n-  _print_inlining_list->at(_print_inlining_idx).ss()->write(_print_inlining_stream->base(), _print_inlining_stream->size());\n+  _print_inlining_list->at(_print_inlining_idx)->ss()->write(_print_inlining_stream->base(), _print_inlining_stream->size());\n@@ -4225,1 +4220,1 @@\n-  _print_inlining_list->insert_before(_print_inlining_idx, PrintInliningBuffer());\n+  _print_inlining_list->insert_before(_print_inlining_idx, new PrintInliningBuffer());\n@@ -4228,1 +4223,1 @@\n-Compile::PrintInliningBuffer& Compile::print_inlining_current() {\n+Compile::PrintInliningBuffer* Compile::print_inlining_current() {\n@@ -4235,3 +4230,3 @@\n-      if (print_inlining_current().cg() != cg &&\n-          (print_inlining_current().cg() != NULL ||\n-           print_inlining_current().ss()->size() != 0)) {\n+      if (print_inlining_current()->cg() != cg &&\n+          (print_inlining_current()->cg() != NULL ||\n+           print_inlining_current()->ss()->size() != 0)) {\n@@ -4241,1 +4236,1 @@\n-      print_inlining_current().set_cg(cg);\n+      print_inlining_current()->set_cg(cg);\n@@ -4243,1 +4238,1 @@\n-      if (print_inlining_current().cg() != NULL) {\n+      if (print_inlining_current()->cg() != NULL) {\n@@ -4256,1 +4251,1 @@\n-      if (_print_inlining_list->adr_at(i)->cg() == cg) {\n+      if (_print_inlining_list->at(i)->cg() == cg) {\n@@ -4268,1 +4263,1 @@\n-    assert(print_inlining_current().cg() == cg, \"wrong entry\");\n+    assert(print_inlining_current()->cg() == cg, \"wrong entry\");\n@@ -4270,1 +4265,1 @@\n-    _print_inlining_list->at_put(_print_inlining_idx, PrintInliningBuffer());\n+    _print_inlining_list->at_put(_print_inlining_idx, new PrintInliningBuffer());\n@@ -4272,1 +4267,1 @@\n-    print_inlining_current().set_cg(cg);\n+    print_inlining_current()->set_cg(cg);\n@@ -4287,2 +4282,4 @@\n-      ss.print(\"%s\", _print_inlining_list->adr_at(i)->ss()->as_string());\n-      _print_inlining_list->at(i).freeStream();\n+      PrintInliningBuffer* pib = _print_inlining_list->at(i);\n+      ss.print(\"%s\", pib->ss()->as_string());\n+      delete pib;\n+      DEBUG_ONLY(_print_inlining_list->at_put(i, NULL));\n","filename":"src\/hotspot\/share\/opto\/compile.cpp","additions":17,"deletions":20,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -395,1 +395,1 @@\n-  class PrintInliningBuffer : public ResourceObj {\n+  class PrintInliningBuffer : public CHeapObj<mtCompiler> {\n@@ -398,1 +398,2 @@\n-    stringStream* _ss;\n+    stringStream   _ss;\n+    static const size_t default_stream_buffer_size = 128;\n@@ -402,1 +403,1 @@\n-      : _cg(NULL) { _ss = new stringStream(); }\n+      : _cg(NULL), _ss(default_stream_buffer_size) {}\n@@ -404,4 +405,2 @@\n-    void freeStream() { _ss->~stringStream(); _ss = NULL; }\n-\n-    stringStream* ss() const { return _ss; }\n-    CallGenerator* cg() const { return _cg; }\n+    stringStream* ss()             { return &_ss; }\n+    CallGenerator* cg()            { return _cg; }\n@@ -412,1 +411,1 @@\n-  GrowableArray<PrintInliningBuffer>* _print_inlining_list;\n+  GrowableArray<PrintInliningBuffer*>* _print_inlining_list;\n@@ -432,1 +431,1 @@\n-  PrintInliningBuffer& print_inlining_current();\n+  PrintInliningBuffer* print_inlining_current();\n","filename":"src\/hotspot\/share\/opto\/compile.hpp","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"}]}