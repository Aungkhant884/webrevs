{"files":[{"patch":"@@ -365,1 +365,0 @@\n-#ifdef COMPILER2\n@@ -369,2 +368,10 @@\n-    return Matcher::max_vector_size(bt);\n-  }\n+    int min_lane_count = 8 \/ type2aelembytes(bt);\n+    \/\/ The return value should not be less than min_lane_count since the minimal vector size\n+    \/\/ supported by the Vector API is 64-bit (see VectorShape.preferredShape() for more details).\n+    \/\/ This is fine because the vector size is unlikely to be less than 64-bit on modern hardware.\n+    \/\/ And for the worst case, where the hardware doesn't support 64-bit long, the non-vector\n+    \/\/ implementation will be called, which is still fine.\n+#ifdef COMPILER2\n+    return MAX2(Matcher::max_vector_size(bt), min_lane_count);\n+#else\n+    return min_lane_count;\n@@ -372,0 +379,1 @@\n+  }\n","filename":"src\/hotspot\/share\/prims\/vectorSupport.cpp","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -249,5 +249,0 @@\n-            \/\/ FIXME: Consider removing, since unlikely to occur on modern hardware\n-            if (maxSize < Double.SIZE) {\n-                String msg = \"shape unavailable for lane type: \" + etype.getName();\n-                throw new UnsupportedOperationException(msg);\n-            }\n","filename":"src\/jdk.incubator.vector\/share\/classes\/jdk\/incubator\/vector\/VectorShape.java","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -36,0 +36,9 @@\n+\/*\n+ * @test\n+ * @bug 8262096\n+ * @summary Test the initialization of vector shapes\n+ * @modules jdk.incubator.vector java.base\/jdk.internal.vm.vector\n+ * @run testng\/othervm -XX:MaxVectorSize=8 PreferredSpeciesTest\n+ * @run testng\/othervm -XX:MaxVectorSize=4 PreferredSpeciesTest\n+ *\/\n+\n","filename":"test\/jdk\/jdk\/incubator\/vector\/PreferredSpeciesTest.java","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"}]}