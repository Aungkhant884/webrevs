{"files":[{"patch":"@@ -1673,1 +1673,1 @@\n-  Handle *group_objs  = NULL;\n+  objArrayHandle group_objs;\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnv.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -539,2 +539,2 @@\n-jobject *\n-JvmtiEnvBase::new_jobjectArray(int length, Handle *handles) {\n+jthread *\n+JvmtiEnvBase::new_jthreadArray(int length, Handle *handles) {\n@@ -554,5 +554,0 @@\n-jthread *\n-JvmtiEnvBase::new_jthreadArray(int length, Handle *handles) {\n-  return (jthread *) new_jobjectArray(length,handles);\n-}\n-\n@@ -560,2 +555,12 @@\n-JvmtiEnvBase::new_jthreadGroupArray(int length, Handle *handles) {\n-  return (jthreadGroup *) new_jobjectArray(length,handles);\n+JvmtiEnvBase::new_jthreadGroupArray(int length, objArrayHandle groups) {\n+  if (length == 0) {\n+    return NULL;\n+  }\n+\n+  jobject *objArray = (jobject *) jvmtiMalloc(sizeof(jobject) * length);\n+  NULL_CHECK(objArray, NULL);\n+\n+  for (int i=0; i<length; i++) {\n+    objArray[i] = JNIHandles::make_local(groups->obj_at(i));\n+  }\n+  return objArray;\n@@ -797,1 +802,1 @@\n-JvmtiEnvBase::get_subgroups(JavaThread* current_thread, Handle group_hdl, jint *count_ptr, Handle **group_objs_p) {\n+JvmtiEnvBase::get_subgroups(JavaThread* current_thread, Handle group_hdl, jint *count_ptr, objArrayHandle *group_objs_p) {\n@@ -821,2 +826,2 @@\n-  Handle* group_objs = nullptr;\n-  int count = 0;\n+  *group_objs_p = objArrayHandle(current_thread, groups);\n+  *count_ptr = groups->length();\n@@ -824,14 +829,0 @@\n-  int length = groups->length();\n-  if (length > 0) {\n-    group_objs = NEW_RESOURCE_ARRAY_RETURN_NULL(Handle, length);\n-    NULL_CHECK(group_objs, JVMTI_ERROR_OUT_OF_MEMORY);\n-\n-    for (int i = 0; i < length; i++) {\n-      oop group_obj = groups->obj_at(i);\n-      assert(group_obj != NULL, \"group_obj != NULL\");\n-      group_objs[count++] = Handle(current_thread, group_obj);\n-    }\n-  }\n-\n-  *group_objs_p = group_objs;\n-  *count_ptr = count;\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.cpp","additions":17,"deletions":26,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -335,1 +335,0 @@\n-  jobject * new_jobjectArray(int length, Handle *handles);\n@@ -337,1 +336,1 @@\n-  jthreadGroup * new_jthreadGroupArray(int length, Handle *handles);\n+  jthreadGroup * new_jthreadGroupArray(int length, objArrayHandle groups);\n@@ -381,1 +380,1 @@\n-  static jvmtiError get_subgroups(JavaThread* current_thread, Handle group_hdl, jint *count_ptr, Handle **group_objs_p);\n+  static jvmtiError get_subgroups(JavaThread* current_thread, Handle group_hdl, jint *count_ptr, objArrayHandle *group_objs_p);\n","filename":"src\/hotspot\/share\/prims\/jvmtiEnvBase.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"}]}