{"files":[{"patch":"@@ -168,3 +168,0 @@\n-  if (TraceDeoptimization) {\n-    tty->print_cr(\"Deoptimizing thread \" INTPTR_FORMAT, p2i(current));\n-  }\n@@ -730,9 +727,0 @@\n-\n-  if (TraceDeoptimization) {\n-    tty->print_cr(\"DEOPT UNPACKING thread \" INTPTR_FORMAT \" vframeArray \" INTPTR_FORMAT \" mode %d\",\n-                  p2i(thread), p2i(array), exec_mode);\n-    tty->cr();\n-  }\n-  Events::log_deopt_message(thread, \"DEOPT UNPACKING pc=\" INTPTR_FORMAT \" sp=\" INTPTR_FORMAT \" mode %d\",\n-              p2i(stub_frame.pc()), p2i(stub_frame.sp()), exec_mode);\n-\n@@ -1522,1 +1510,3 @@\n-    st.print(\"DEOPT PACKING thread \" INTPTR_FORMAT \" \", p2i(thread));\n+    \/\/st.print_cr(\"DEOPT PACKING thread \" INTPTR_FORMAT \" \", p2i(thread));\n+    st.print_cr(\"DEOPT PACKING thread=\" INTPTR_FORMAT \" vframeArray=\" INTPTR_FORMAT, p2i(thread), p2i(array));\n+    st.print(\"   \");\n@@ -1524,1 +1514,1 @@\n-    st.print_cr(\"     Virtual frames (innermost first):\");\n+    st.print_cr(\"   Virtual frames (innermost\/newest first):\");\n@@ -1527,3 +1517,1 @@\n-      st.print(\"       %2d - \", index);\n-      st.print(\"(\" INTPTR_FORMAT \")\", p2i(vf));\n-      int bci = chunk->at(index)->raw_bci();\n+      int bci = vf->raw_bci();\n@@ -1537,0 +1525,3 @@\n+\n+      st.print(\"      VFrame %d (\" INTPTR_FORMAT \")\", index, p2i(vf));\n+      st.print(\" - %s\", vf->method()->name_and_sig_as_C_string());\n@@ -1538,1 +1529,1 @@\n-      st.print_cr(\" @ bci %d \", bci);\n+      st.print_cr(\" @ bci=%d \", bci);\n@@ -1541,1 +1532,0 @@\n-    tty->print_cr(\"     Created vframeArray \" INTPTR_FORMAT, p2i(array));\n@@ -1810,0 +1800,1 @@\n+\n@@ -1847,1 +1838,1 @@\n-    if (TraceDeoptimization || is_receiver_constraint_failure) {\n+    if (is_receiver_constraint_failure) {\n@@ -1958,3 +1949,8 @@\n-        tty->print(\"Uncommon trap occurred in\");\n-        nm->method()->print_short_name(tty);\n-        tty->print(\" compiler=%s compile_id=%d\", nm->compiler_name(), nm->compile_id());\n+        stringStream st;\n+        st.print(\"UNCOMMON TRAP method=%s\", trap_scope->method()->name_and_sig_as_C_string());\n+        st.print(\"  bci=%d pc=\" INTPTR_FORMAT \", relative_pc=\" INTPTR_FORMAT JVMCI_ONLY(\", debug_id=%d\"), trap_scope->bci(), p2i(fr.pc()), fr.pc() - nm->code_begin()\n+#if INCLUDE_JVMCI\n+            , debug_id\n+#endif\n+        );\n+        st.print(\" compiler=%s compile_id=%d\", nm->compiler_name(), nm->compile_id());\n@@ -1965,1 +1961,1 @@\n-            tty->print(\" (JVMCI: installed code name=%s) \", installed_code_name);\n+            st.print(\" (JVMCI: installed code name=%s) \", installed_code_name);\n@@ -1969,1 +1965,1 @@\n-        tty->print(\" (@\" INTPTR_FORMAT \") thread=\" UINTX_FORMAT \" reason=%s action=%s unloaded_class_index=%d\" JVMCI_ONLY(\" debug_id=%d\"),\n+        st.print(\" (@\" INTPTR_FORMAT \") thread=\" UINTX_FORMAT \" reason=%s action=%s unloaded_class_index=%d\" JVMCI_ONLY(\" debug_id=%d\"),\n@@ -1980,2 +1976,2 @@\n-          tty->print(unresolved ? \" unresolved class: \" : \" symbol: \");\n-          class_name->print_symbol_on(tty);\n+          st.print(unresolved ? \" unresolved class: \" : \" symbol: \");\n+          class_name->print_symbol_on(&st);\n@@ -1983,1 +1979,2 @@\n-        tty->cr();\n+        st.cr();\n+        tty->print_raw(st.as_string());\n@@ -2361,3 +2358,0 @@\n-  if (TraceDeoptimization) {\n-    tty->print(\"Uncommon trap \");\n-  }\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":25,"deletions":31,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -462,0 +462,1 @@\n+#ifndef PRODUCT\n@@ -465,1 +466,0 @@\n-#ifndef PRODUCT\n@@ -470,1 +470,0 @@\n-#endif\n@@ -472,1 +471,2 @@\n-  NOT_PRODUCT(if (WizardMode && Verbose) Disassembler::decode(begin, end);)\n+  if (WizardMode && Verbose) Disassembler::decode(begin, end);\n+#endif\n","filename":"src\/hotspot\/share\/runtime\/frame.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -327,9 +327,0 @@\n-  if (TraceDeoptimization) {\n-    method()->print_value();\n-    Bytecodes::Code code = Bytecodes::java_code_at(method(), bcp);\n-    int bci = method()->bci_from(bcp);\n-    tty->print(\" - %s\", Bytecodes::name(code));\n-    tty->print(\" @ bci %d \", bci);\n-    tty->print_cr(\"sp = \" PTR_FORMAT, p2i(iframe()->sp()));\n-  }\n-\n@@ -342,1 +333,0 @@\n-\n@@ -578,0 +568,1 @@\n+\n@@ -588,0 +579,12 @@\n+  Events::log_deopt_message(current, \"DEOPT UNPACKING pc=\" INTPTR_FORMAT \" sp=\" INTPTR_FORMAT \" mode %d\",\n+                            p2i(unpack_frame.pc()), p2i(unpack_frame.sp()), exec_mode);\n+\n+  if (TraceDeoptimization) {\n+    ResourceMark rm;\n+    stringStream st;\n+    st.print_cr(\"DEOPT UNPACKING thread=\" INTPTR_FORMAT \" vframeArray=\" INTPTR_FORMAT \" mode=%d\",\n+               p2i(current), p2i(this), exec_mode);\n+    st.print_cr(\"   Virtual frames (outermost\/oldest first):\");\n+    tty->print_raw(st.as_string());\n+  }\n+\n@@ -607,0 +610,18 @@\n+    if (TraceDeoptimization) {\n+      ResourceMark rm;\n+      stringStream st;\n+      st.print(\"      VFrame %d (\" INTPTR_FORMAT \")\", index, p2i(elem));\n+      st.print(\" - %s\", elem->method()->name_and_sig_as_C_string());\n+      int bci = elem->raw_bci();\n+      const char* code_name;\n+      if (bci == SynchronizationEntryBCI) {\n+        code_name = \"sync entry\";\n+      } else {\n+        Bytecodes::Code code = elem->method()->code_at(bci);\n+        code_name = Bytecodes::name(code);\n+      }\n+      st.print(\" - %s\", code_name);\n+      st.print(\" @ bci=%d \", bci);\n+      st.print_cr(\"sp=\" PTR_FORMAT, p2i(elem->iframe()->sp()));\n+      tty->print_raw(st.as_string());\n+    }\n@@ -621,0 +642,3 @@\n+  if (TraceDeoptimization) {\n+    tty->cr();\n+  }\n","filename":"src\/hotspot\/share\/runtime\/vframeArray.cpp","additions":34,"deletions":10,"binary":false,"changes":44,"status":"modified"}]}