{"files":[{"patch":"@@ -168,3 +168,0 @@\n-  if (TraceDeoptimization) {\n-    tty->print_cr(\"Deoptimizing thread \" INTPTR_FORMAT, p2i(current));\n-  }\n@@ -184,1 +181,0 @@\n-#ifndef PRODUCT\n@@ -214,1 +210,0 @@\n-#endif\n@@ -248,0 +243,1 @@\n+      tty->cr();\n@@ -265,1 +261,0 @@\n-#ifndef PRODUCT\n@@ -269,1 +264,0 @@\n-#endif\n@@ -286,1 +280,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n@@ -432,0 +426,1 @@\n+#ifndef PRODUCT\n@@ -435,0 +430,2 @@\n+#endif \/\/ !PRODUCT\n+\n@@ -730,10 +727,0 @@\n-\n-#ifndef PRODUCT\n-  if (TraceDeoptimization) {\n-    tty->print_cr(\"DEOPT UNPACKING thread \" INTPTR_FORMAT \" vframeArray \" INTPTR_FORMAT \" mode %d\",\n-                  p2i(thread), p2i(array), exec_mode);\n-  }\n-#endif\n-  Events::log_deopt_message(thread, \"DEOPT UNPACKING pc=\" INTPTR_FORMAT \" sp=\" INTPTR_FORMAT \" mode %d\",\n-              p2i(stub_frame.pc()), p2i(stub_frame.sp()), exec_mode);\n-\n@@ -884,1 +871,1 @@\n-#endif \/* !PRODUCT *\/\n+#endif \/\/ !PRODUCT\n@@ -1411,0 +1398,1 @@\n+#ifndef PRODUCT\n@@ -1414,0 +1402,2 @@\n+#endif \/\/ !PRODUCT\n+\n@@ -1428,0 +1418,1 @@\n+#ifndef PRODUCT\n@@ -1435,0 +1426,1 @@\n+#endif \/\/ !PRODUCT\n@@ -1440,1 +1432,1 @@\n-#endif\n+#endif \/* !COMPILER2 *\/\n@@ -1498,30 +1490,0 @@\n-#ifndef PRODUCT\n-  if (PrintDeoptimizationDetails) {\n-    ResourceMark rm;\n-    stringStream st;\n-    st.print(\"DEOPT PACKING thread \" INTPTR_FORMAT \" \", p2i(thread));\n-    fr.print_on(&st);\n-    st.print_cr(\"     Virtual frames (innermost first):\");\n-    for (int index = 0; index < chunk->length(); index++) {\n-      compiledVFrame* vf = chunk->at(index);\n-      st.print(\"       %2d - \", index);\n-      vf->print_value_on(&st);\n-      int bci = chunk->at(index)->raw_bci();\n-      const char* code_name;\n-      if (bci == SynchronizationEntryBCI) {\n-        code_name = \"sync entry\";\n-      } else {\n-        Bytecodes::Code code = vf->method()->code_at(bci);\n-        code_name = Bytecodes::name(code);\n-      }\n-      st.print(\" - %s\", code_name);\n-      st.print_cr(\" @ bci %d \", bci);\n-      if (Verbose) {\n-        vf->print_on(&st);\n-        st.cr();\n-      }\n-    }\n-    tty->print_raw(st.as_string());\n-  }\n-#endif\n-\n@@ -1545,3 +1507,25 @@\n-#ifndef PRODUCT\n-  if (PrintDeoptimizationDetails) {\n-    tty->print_cr(\"     Created vframeArray \" INTPTR_FORMAT, p2i(array));\n+  if (TraceDeoptimization) {\n+    ResourceMark rm;\n+    stringStream st;\n+    st.print_cr(\"DEOPT PACKING thread=\" INTPTR_FORMAT \" vframeArray=\" INTPTR_FORMAT, p2i(thread), p2i(array));\n+    st.print(\"   \");\n+    fr.print_on(&st);\n+    st.print_cr(\"   Virtual frames (innermost\/newest first):\");\n+    for (int index = 0; index < chunk->length(); index++) {\n+      compiledVFrame* vf = chunk->at(index);\n+      int bci = vf->raw_bci();\n+      const char* code_name;\n+      if (bci == SynchronizationEntryBCI) {\n+        code_name = \"sync entry\";\n+      } else {\n+        Bytecodes::Code code = vf->method()->code_at(bci);\n+        code_name = Bytecodes::name(code);\n+      }\n+\n+      st.print(\"      VFrame %d (\" INTPTR_FORMAT \")\", index, p2i(vf));\n+      st.print(\" - %s\", vf->method()->name_and_sig_as_C_string());\n+      st.print(\" - %s\", code_name);\n+      st.print_cr(\" @ bci=%d \", bci);\n+    }\n+    tty->print_raw(st.as_string());\n+    tty->cr();\n@@ -1549,1 +1533,0 @@\n-#endif \/\/ PRODUCT\n@@ -1816,0 +1799,1 @@\n+\n@@ -1853,6 +1837,4 @@\n-    if (TraceDeoptimization || is_receiver_constraint_failure) {\n-      tty->print_cr(\"  bci=%d pc=\" INTPTR_FORMAT \", relative_pc=\" INTPTR_FORMAT \", method=%s\" JVMCI_ONLY(\", debug_id=%d\"), trap_scope->bci(), p2i(fr.pc()), fr.pc() - nm->code_begin(), trap_scope->method()->name_and_sig_as_C_string()\n-#if INCLUDE_JVMCI\n-          , debug_id\n-#endif\n-          );\n+    if (is_receiver_constraint_failure) {\n+      tty->print_cr(\"  bci=%d pc=\" INTPTR_FORMAT \", relative_pc=\" INTPTR_FORMAT \", method=%s\" JVMCI_ONLY(\", debug_id=%d\"),\n+                    trap_scope->bci(), p2i(fr.pc()), fr.pc() - nm->code_begin(), trap_scope->method()->name_and_sig_as_C_string()\n+                    JVMCI_ONLY(COMMA debug_id));\n@@ -1964,3 +1946,5 @@\n-        tty->print(\"Uncommon trap occurred in\");\n-        nm->method()->print_short_name(tty);\n-        tty->print(\" compiler=%s compile_id=%d\", nm->compiler_name(), nm->compile_id());\n+        stringStream st;\n+        st.print(\"UNCOMMON TRAP method=%s\", trap_scope->method()->name_and_sig_as_C_string());\n+        st.print(\"  bci=%d pc=\" INTPTR_FORMAT \", relative_pc=\" INTPTR_FORMAT JVMCI_ONLY(\", debug_id=%d\"),\n+                 trap_scope->bci(), p2i(fr.pc()), fr.pc() - nm->code_begin() JVMCI_ONLY(COMMA debug_id));\n+        st.print(\" compiler=%s compile_id=%d\", nm->compiler_name(), nm->compile_id());\n@@ -1971,1 +1955,1 @@\n-            tty->print(\" (JVMCI: installed code name=%s) \", installed_code_name);\n+            st.print(\" (JVMCI: installed code name=%s) \", installed_code_name);\n@@ -1975,1 +1959,1 @@\n-        tty->print(\" (@\" INTPTR_FORMAT \") thread=\" UINTX_FORMAT \" reason=%s action=%s unloaded_class_index=%d\" JVMCI_ONLY(\" debug_id=%d\"),\n+        st.print(\" (@\" INTPTR_FORMAT \") thread=\" UINTX_FORMAT \" reason=%s action=%s unloaded_class_index=%d\" JVMCI_ONLY(\" debug_id=%d\"),\n@@ -1986,2 +1970,2 @@\n-          tty->print(unresolved ? \" unresolved class: \" : \" symbol: \");\n-          class_name->print_symbol_on(tty);\n+          st.print(unresolved ? \" unresolved class: \" : \" symbol: \");\n+          class_name->print_symbol_on(&st);\n@@ -1989,1 +1973,2 @@\n-        tty->cr();\n+        st.cr();\n+        tty->print_raw(st.as_string());\n@@ -2367,3 +2352,0 @@\n-  if (TraceDeoptimization) {\n-    tty->print(\"Uncommon trap \");\n-  }\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":53,"deletions":71,"binary":false,"changes":124,"status":"modified"},{"patch":"@@ -445,0 +445,1 @@\n+  st->print_cr(\")\");\n@@ -447,2 +448,0 @@\n-    st->print_cr(\")\");\n-    st->print(\"(\");\n@@ -453,2 +452,0 @@\n-    st->print_cr(\")\");\n-    st->print(\"(\");\n@@ -464,1 +461,0 @@\n-  st->print_cr(\")\");\n@@ -466,0 +462,1 @@\n+#ifndef PRODUCT\n@@ -469,2 +466,0 @@\n-    st->cr();\n-#ifndef PRODUCT\n@@ -475,1 +470,0 @@\n-#endif\n@@ -477,1 +471,2 @@\n-  NOT_PRODUCT(if (WizardMode && Verbose) Disassembler::decode(begin, end);)\n+  if (WizardMode && Verbose) Disassembler::decode(begin, end);\n+#endif\n","filename":"src\/hotspot\/share\/runtime\/frame.cpp","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -611,1 +611,0 @@\n-\n@@ -617,1 +616,0 @@\n-\n","filename":"src\/hotspot\/share\/runtime\/vframe.cpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -327,0 +327,1 @@\n+#ifndef PRODUCT\n@@ -330,0 +331,1 @@\n+#endif \/\/ !PRODUCT\n@@ -346,1 +348,1 @@\n-          tty->print_cr(\"Reconstructed expression %d (INT): %d\", i, (int)(*addr));\n+          tty->print_cr(\" - Reconstructed expression %d (INT): %d\", i, (int)(*addr));\n@@ -348,1 +350,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n@@ -354,1 +356,1 @@\n-          tty->print(\"Reconstructed expression %d (OBJECT): \", i);\n+          tty->print(\" - Reconstructed expression %d (OBJECT): \", i);\n@@ -363,1 +365,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n@@ -374,0 +376,5 @@\n+#ifndef PRODUCT\n+  if (PrintDeoptimizationDetails) {\n+    tty->print_cr(\"Locals size: %d\", locals()->size());\n+  }\n+#endif \/\/ !PRODUCT\n@@ -385,1 +392,1 @@\n-          tty->print_cr(\"Reconstructed local %d (INT): %d\", i, (int)(*addr));\n+          tty->print_cr(\" - Reconstructed local %d (INT): %d\", i, (int)(*addr));\n@@ -387,1 +394,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n@@ -393,1 +400,1 @@\n-          tty->print(\"Reconstructed local %d (OBJECT): \", i);\n+          tty->print(\" - Reconstructed local %d (OBJECT): \", i);\n@@ -402,1 +409,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n@@ -446,1 +453,1 @@\n-    tty->print_cr(\"[%d Interpreted Frame]\", ++unpack_counter);\n+    tty->print_cr(\"[%d. Interpreted Frame]\", ++unpack_counter);\n@@ -451,5 +458,1 @@\n-\n-    tty->print_cr(\"locals size     %d\", locals()->size());\n-    tty->print_cr(\"expression size %d\", expressions()->size());\n-\n-    method()->print_value();\n+    if (WizardMode && Verbose) method()->print_codes();\n@@ -457,9 +460,0 @@\n-    \/\/ method()->print_codes();\n-  } else if (TraceDeoptimization) {\n-    tty->print(\"     \");\n-    method()->print_value();\n-    Bytecodes::Code code = Bytecodes::java_code_at(method(), bcp);\n-    int bci = method()->bci_from(bcp);\n-    tty->print(\" - %s\", Bytecodes::name(code));\n-    tty->print(\" @ bci %d \", bci);\n-    tty->print_cr(\"sp = \" PTR_FORMAT, p2i(iframe()->sp()));\n@@ -467,1 +461,1 @@\n-#endif \/\/ PRODUCT\n+#endif \/\/ !PRODUCT\n@@ -574,0 +568,1 @@\n+\n@@ -584,0 +579,12 @@\n+  Events::log_deopt_message(current, \"DEOPT UNPACKING pc=\" INTPTR_FORMAT \" sp=\" INTPTR_FORMAT \" mode %d\",\n+                            p2i(unpack_frame.pc()), p2i(unpack_frame.sp()), exec_mode);\n+\n+  if (TraceDeoptimization) {\n+    ResourceMark rm;\n+    stringStream st;\n+    st.print_cr(\"DEOPT UNPACKING thread=\" INTPTR_FORMAT \" vframeArray=\" INTPTR_FORMAT \" mode=%d\",\n+                p2i(current), p2i(this), exec_mode);\n+    st.print_cr(\"   Virtual frames (outermost\/oldest first):\");\n+    tty->print_raw(st.as_string());\n+  }\n+\n@@ -603,0 +610,18 @@\n+    if (TraceDeoptimization) {\n+      ResourceMark rm;\n+      stringStream st;\n+      st.print(\"      VFrame %d (\" INTPTR_FORMAT \")\", index, p2i(elem));\n+      st.print(\" - %s\", elem->method()->name_and_sig_as_C_string());\n+      int bci = elem->raw_bci();\n+      const char* code_name;\n+      if (bci == SynchronizationEntryBCI) {\n+        code_name = \"sync entry\";\n+      } else {\n+        Bytecodes::Code code = elem->method()->code_at(bci);\n+        code_name = Bytecodes::name(code);\n+      }\n+      st.print(\" - %s\", code_name);\n+      st.print(\" @ bci=%d \", bci);\n+      st.print_cr(\"sp=\" PTR_FORMAT, p2i(elem->iframe()->sp()));\n+      tty->print_raw(st.as_string());\n+    }\n@@ -617,0 +642,3 @@\n+  if (TraceDeoptimization) {\n+    tty->cr();\n+  }\n@@ -644,1 +672,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n@@ -676,1 +704,1 @@\n-#endif\n+#endif \/\/ !PRODUCT\n","filename":"src\/hotspot\/share\/runtime\/vframeArray.cpp","additions":54,"deletions":26,"binary":false,"changes":80,"status":"modified"}]}