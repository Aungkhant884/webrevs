{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2020 THL A29 Limited, a Tencent company. All rights reserved.\n+ * Copyright (C) 2020, 2022 THL A29 Limited, a Tencent company. All rights reserved.\n@@ -27,0 +27,2 @@\n+\/\/ Usage:\n+\/\/   GetFreeSwapSpaceSize <memoryAlloc> <expectedMemory> <memorySwapAlloc> <expectedSwap>\n@@ -29,1 +31,11 @@\n-        System.out.println(\"TestGetFreeSwapSpaceSize\");\n+        if (args.length != 4) {\n+            throw new RuntimeException(\"Unexpected arguments. Expected 4, got \" + args.length);\n+        }\n+        String memoryAlloc = args[0];\n+        long expectedMemory = Long.parseLong(args[1]);\n+        String memorySwapAlloc = args[2];\n+        long expectedSwap = Long.parseLong(args[3]);\n+        System.out.println(\"TestGetFreeSwapSpaceSize (memory=\" + memoryAlloc + \", memorySwap=\" + memorySwapAlloc + \")\");\n+        if (expectedSwap != 0) {\n+            throw new RuntimeException(\"Precondition of test not met: Expected swap size of 0, got: \" + expectedSwap);\n+        }\n@@ -31,0 +43,8 @@\n+        long osBeanTotalSwap = osBean.getTotalSwapSpaceSize();\n+        \/\/ Premise of this test is to test on a system where --memory and --memory-swap are set to\n+        \/\/ the same amount via the container engine (i.e. no swap). In that case the OSBean must\n+        \/\/ not report negative values for free swap space. Assert this precondition.\n+        if (osBeanTotalSwap != expectedSwap) {\n+            throw new RuntimeException(\"OperatingSystemMXBean.getTotalSwapSpaceSize() reported \" + osBeanTotalSwap + \" expected \" + expectedSwap);\n+        }\n+        System.out.println(\"TestGetFreeSwapSpaceSize precondition met, osBeanTotalSwap = \" + expectedSwap + \". Running test... \");\n@@ -34,2 +54,1 @@\n-                System.out.println(\"Error: getFreeSwapSpaceSize returns \" + size);\n-                System.exit(-1);\n+                throw new RuntimeException(\"Test failed! getFreeSwapSpaceSize returns \" + size);\n@@ -38,0 +57,1 @@\n+        System.out.println(\"TestGetFreeSwapSpaceSize PASSED.\" );\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/GetFreeSwapSpaceSize.java","additions":24,"deletions":4,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (C) 2020 THL A29 Limited, a Tencent company. All rights reserved.\n+ * Copyright (C) 2020, 2022 THL A29 Limited, a Tencent company. All rights reserved.\n@@ -39,1 +39,1 @@\n-    private static final String imageName = Common.imageName(\"memory\");\n+    private static final String imageName = Common.imageName(\"osbeanSwapSpace\");\n@@ -61,1 +61,1 @@\n-            String swapAllocation, String expectedSwap) throws Exception {\n+            String memorySwapAllocation, String expectedSwap) throws Exception {\n@@ -65,0 +65,1 @@\n+            .addClassOptions(memoryAllocation, expectedMemory, memorySwapAllocation, expectedSwap)\n@@ -67,1 +68,1 @@\n-                \"--memory-swap\", swapAllocation\n+                \"--memory-swap\", memorySwapAllocation\n@@ -72,1 +73,1 @@\n-           .shouldContain(\"TestGetFreeSwapSpaceSize\");\n+           .shouldContain(\"TestGetFreeSwapSpaceSize PASSED.\");\n","filename":"test\/jdk\/jdk\/internal\/platform\/docker\/TestGetFreeSwapSpaceSize.java","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"}]}