{"files":[{"patch":"@@ -198,1 +198,3 @@\n-  if (stub != NULL) {\n+  if (stub != NULL && (PrintStubCode ||\n+                       Forte::is_enabled() ||\n+                       JvmtiExport::should_post_dynamic_code_generated())) {\n@@ -215,1 +217,3 @@\n-    Forte::register_stub(stub_id, stub->code_begin(), stub->code_end());\n+    if (Forte::is_enabled()) {\n+      Forte::register_stub(stub_id, stub->code_begin(), stub->code_end());\n+    }\n","filename":"src\/hotspot\/share\/code\/codeBlob.cpp","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -44,1 +44,0 @@\n-#include \"prims\/forte.hpp\"\n","filename":"src\/hotspot\/share\/interpreter\/abstractInterpreter.cpp","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -74,2 +74,0 @@\n-#if !defined(IA64)\n-\n@@ -676,0 +674,1 @@\n+#define collector_func_load_enabled() false\n@@ -687,0 +686,1 @@\n+#define collector_func_load_enabled() (collector_func_load ? true : false)\n@@ -691,1 +691,8 @@\n-#endif \/\/ !IA64\n+\n+bool Forte::is_enabled() {\n+#if !defined(_WINDOWS)\n+  return collector_func_load_enabled();\n+#else\n+  return false;\n+#endif\n+}\n@@ -694,1 +701,1 @@\n-#if !defined(_WINDOWS) && !defined(IA64)\n+#if !defined(_WINDOWS)\n@@ -700,1 +707,1 @@\n-#endif \/\/ !_WINDOWS && !IA64\n+#endif \/\/ !_WINDOWS\n","filename":"src\/hotspot\/share\/prims\/forte.cpp","additions":12,"deletions":5,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2004, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2004, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,1 @@\n+   static bool is_enabled() NOT_JVMTI_RETURN_(false);\n","filename":"src\/hotspot\/share\/prims\/forte.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2687,10 +2687,14 @@\n-  char blob_id[256];\n-  jio_snprintf(blob_id,\n-                sizeof(blob_id),\n-                \"%s(%s)\",\n-                new_adapter->name(),\n-                entry->fingerprint()->as_string());\n-  Forte::register_stub(blob_id, new_adapter->content_begin(), new_adapter->content_end());\n-\n-  if (JvmtiExport::should_post_dynamic_code_generated()) {\n-    JvmtiExport::post_dynamic_code_generated(blob_id, new_adapter->content_begin(), new_adapter->content_end());\n+  if (Forte::is_enabled() || JvmtiExport::should_post_dynamic_code_generated()) {\n+    char blob_id[256];\n+    jio_snprintf(blob_id,\n+                 sizeof(blob_id),\n+                 \"%s(%s)\",\n+                 new_adapter->name(),\n+                 entry->fingerprint()->as_string());\n+    if (Forte::is_enabled()) {\n+      Forte::register_stub(blob_id, new_adapter->content_begin(), new_adapter->content_end());\n+    }\n+\n+    if (JvmtiExport::should_post_dynamic_code_generated()) {\n+      JvmtiExport::post_dynamic_code_generated(blob_id, new_adapter->content_begin(), new_adapter->content_end());\n+    }\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp","additions":14,"deletions":10,"binary":false,"changes":24,"status":"modified"}]}