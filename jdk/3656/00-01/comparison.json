{"files":[{"patch":"@@ -44,0 +44,1 @@\n+    private static final int PER_CPU_SHARES = 1024;\n@@ -138,0 +139,4 @@\n+            long share = containerMetrics.getCpuShares();\n+            long periodLength = containerMetrics.getCpuPeriod();\n+            long numPeriods = containerMetrics.getCpuNumPeriods();\n+            long usageNanos = containerMetrics.getCpuUsage();\n@@ -139,2 +144,0 @@\n-                long numPeriods = containerMetrics.getCpuNumPeriods();\n-                long usageNanos = containerMetrics.getCpuUsage();\n@@ -150,0 +153,10 @@\n+            } else if (share > 0) {\n+                if (periodLength > 0 && numPeriods > 0 && usageNanos > 0) {\n+                    long shareNanos = TimeUnit.MICROSECONDS.toNanos(periodLength * numPeriods * share \/ PER_CPU_SHARES);\n+                    double systemLoad = (double) usageNanos \/ shareNanos;\n+                    \/\/ Ensure the return value is in the range 0.0 -> 1.0\n+                    systemLoad = Math.max(0.0, systemLoad);\n+                    systemLoad = Math.min(1.0, systemLoad);\n+                    return systemLoad;\n+                }\n+                return -1;\n@@ -151,1 +164,1 @@\n-                \/\/ If CPU quotas are not active then find the average system load for\n+                \/\/ If CPU quotas and shares are not active then find the average system load for\n","filename":"src\/jdk.management\/unix\/classes\/com\/sun\/management\/internal\/OperatingSystemImpl.java","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"}]}