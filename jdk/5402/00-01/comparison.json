{"files":[{"patch":"@@ -151,0 +151,3 @@\n+  \/\/ number of htbl entries for aes-gcm intrinsic\n+  static const int htbl_entries = 96;\n+\n","filename":"src\/hotspot\/cpu\/x86\/matcher_x86.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -420,1 +420,1 @@\n-   do_name(gcm_crypt_name, \"implGCMCrypt\")                                                                                 \\\n+   do_name(gcm_crypt_name, \"implGCMCrypt0\")                                                                                 \\\n","filename":"src\/hotspot\/share\/classfile\/vmIntrinsics.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -6795,4 +6795,3 @@\n-  Node* avx512_subkeyHtbl = new_array(klass_node, intcon(96), 0);\n-  if (avx512_subkeyHtbl == NULL) return false;\n-\n-  Node* avx512_subkeyHtbl_start = array_element_address(avx512_subkeyHtbl, intcon(0), T_LONG);\n+  \/\/ new array to hold 48 computed htbl entries\n+  Node* subkeyHtbl_48_entries = new_array(klass_node, intcon(Matcher::htbl_entries), 0);\n+  if (subkeyHtbl_48_entries == NULL) return false;\n@@ -6800,0 +6799,1 @@\n+  Node* subkeyHtbl_48_entries_start = array_element_address(subkeyHtbl_48_entries, intcon(0), T_LONG);\n@@ -6805,1 +6805,1 @@\n-                               in_start, len, ct_start, out_start, k_start, state_start, subkeyHtbl_start, avx512_subkeyHtbl_start, cnt_start);\n+                               in_start, len, ct_start, out_start, k_start, state_start, subkeyHtbl_start, subkeyHtbl_48_entries_start, cnt_start);\n","filename":"src\/hotspot\/share\/opto\/library_call.cpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -90,0 +90,2 @@\n+    \/\/ max data size for x86-64 intrinsic\n+    private static final int SPLIT_LEN = 1048576;  \/\/ 1MB\n@@ -573,0 +575,22 @@\n+    \/\/ Wrapper function around AES-GCM interleaved intrinsic that splits\n+    \/\/ large chunks of data into 1MB sized chunks. This is to place\n+    \/\/ an upper limit on the number of blocks encrypted in the intrinsic.\n+    private static int implGCMCrypt(byte[] in, int inOfs, int inLen, byte[] ct,\n+                                    int ctOfs, byte[] out, int outOfs,\n+                                    GCTR gctr, GHASH ghash) {\n+\n+        int len = 0;\n+        if (inLen > SPLIT_LEN) {\n+            while (inLen >= SPLIT_LEN) {\n+                int partlen = implGCMCrypt0(in, inOfs+len, SPLIT_LEN, ct,\n+                    ctOfs+len, out, outOfs+len, gctr, ghash);\n+                len+= partlen;\n+                inLen-= len;\n+            }\n+        }\n+        if (inLen > 0) {\n+            len+= implGCMCrypt0(in, inOfs+len, inLen, ct,\n+                  ctOfs+len, out, outOfs+len, gctr, ghash);\n+        }\n+        return len;\n+    }\n@@ -593,1 +617,1 @@\n-    private static int implGCMCrypt(byte[] in, int inOfs, int inLen,\n+    private static int implGCMCrypt0(byte[] in, int inOfs, int inLen,\n","filename":"src\/java.base\/share\/classes\/com\/sun\/crypto\/provider\/GaloisCounterMode.java","additions":25,"deletions":1,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -101,1 +101,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DmsgSize=2054\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DmsgSize=8320\n@@ -104,1 +104,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DmsgSize=2054\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DmsgSize=8326\n@@ -107,1 +107,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencOutputOffset=1 -DmsgSize=2054\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencOutputOffset=1 -DmsgSize=8326\n@@ -110,1 +110,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DdecOutputOffset=1 -DmsgSize=2054\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DdecOutputOffset=1 -DmsgSize=8326\n@@ -113,1 +113,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DencOutputOffset=1 -DmsgSize=2054\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DencOutputOffset=1 -DmsgSize=8326\n@@ -116,1 +116,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DencOutputOffset=1 -DdecOutputOffset=1 -DmsgSize=2054\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DencOutputOffset=1 -DdecOutputOffset=1 -DmsgSize=8326\n@@ -119,1 +119,1 @@\n- * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DencOutputOffset=1 -DdecOutputOffset=1 -DpaddingStr=NoPadding -DmsgSize=2048\n+ * @run main\/othervm\/timeout=600 -Xbatch -DcheckOutput=true -Dmode=GCM -DencInputOffset=1 -DencOutputOffset=1 -DdecOutputOffset=1 -DpaddingStr=NoPadding -DmsgSize=8320\n","filename":"test\/hotspot\/jtreg\/compiler\/codegen\/aes\/TestAESMain.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"}]}