{"files":[{"patch":"@@ -40,0 +40,4 @@\n+#if ! defined(_ALLBSD_SOURCE)\n+void transfer(JNIEnv* env, jint dst, jint src, volatile jint* cancel);\n+#endif\n+\n@@ -81,19 +85,1 @@\n-#if defined(_ALLBSD_SOURCE)\n-    copyfile_state_t state;\n-    if (cancel != NULL) {\n-        state = copyfile_state_alloc();\n-        copyfile_state_set(state, COPYFILE_STATE_STATUS_CB, fcopyfile_callback);\n-        copyfile_state_set(state, COPYFILE_STATE_STATUS_CTX, (void*)cancel);\n-    } else {\n-        state = NULL;\n-    }\n-    if (fcopyfile(src, dst, state, COPYFILE_DATA) < 0) {\n-        int errno_fcopyfile = errno;\n-        if (state != NULL)\n-            copyfile_state_free(state);\n-        throwUnixException(env, errno_fcopyfile);\n-        return;\n-    }\n-    if (state != NULL)\n-        copyfile_state_free(state);\n-#elif defined(__linux__)\n+#if defined(__linux__)\n@@ -120,0 +106,22 @@\n+\n+    transfer(env, dst, src, cancel);\n+#elif defined(_ALLBSD_SOURCE)\n+    copyfile_state_t state;\n+    if (cancel != NULL) {\n+        state = copyfile_state_alloc();\n+        copyfile_state_set(state, COPYFILE_STATE_STATUS_CB, fcopyfile_callback);\n+        copyfile_state_set(state, COPYFILE_STATE_STATUS_CTX, (void*)cancel);\n+    } else {\n+        state = NULL;\n+    }\n+    if (fcopyfile(src, dst, state, COPYFILE_DATA) < 0) {\n+        int errno_fcopyfile = errno;\n+        if (state != NULL)\n+            copyfile_state_free(state);\n+        throwUnixException(env, errno_fcopyfile);\n+        return;\n+    }\n+    if (state != NULL)\n+        copyfile_state_free(state);\n+#else\n+    transfer(env, dst, src, cancel);\n@@ -121,2 +129,7 @@\n-#if !defined(_ALLBSD_SOURCE)\n-    \/\/ Transfer via user-space buffers\n+}\n+\n+\n+#if ! defined(_ALLBSD_SOURCE)\n+\/\/ Transfer via user-space buffers\n+void transfer(JNIEnv* env, jint dst, jint src, volatile jint* cancel)\n+{\n@@ -151,1 +164,0 @@\n-#endif\n@@ -153,0 +165,1 @@\n+#endif\n","filename":"src\/java.base\/unix\/native\/libnio\/fs\/UnixCopyFile.c","additions":35,"deletions":22,"binary":false,"changes":57,"status":"modified"}]}