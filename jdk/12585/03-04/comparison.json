{"files":[{"patch":"@@ -212,1 +212,1 @@\n-  SystemDictionary::add_to_hierarchy(result, THREAD);\n+  SystemDictionary::add_to_hierarchy(THREAD, result);\n","filename":"src\/hotspot\/share\/cds\/lambdaFormInvokers.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -903,0 +903,1 @@\n+  add_to_hierarchy(THREAD, k);\n@@ -904,1 +905,0 @@\n-  add_to_hierarchy(k, THREAD);\n@@ -1489,1 +1489,0 @@\n-  \/\/ Add the new class. We need recompile lock during update of CHA.\n@@ -1491,1 +1490,1 @@\n-  add_to_hierarchy(k, THREAD);\n+  add_to_hierarchy(THREAD, k);\n@@ -1611,2 +1610,1 @@\n-\/\/ is held, to ensure that the compiler is not using the class hierarchy, and that deoptimization will kick in\n-\/\/ before a new class is used.\n+\/\/ is held, to ensure that the compiler is not using the class hierarchy.\n@@ -1614,1 +1612,3 @@\n-void SystemDictionary::add_to_hierarchy(InstanceKlass* k, JavaThread* current) {\n+void SystemDictionary::add_to_hierarchy(JavaThread* current, InstanceKlass* k) {\n+  assert(k != nullptr, \"just checking\");\n+  assert(!SafepointSynchronize::is_at_safepoint(), \"must NOT be at safepoint\");\n@@ -1618,4 +1618,0 @@\n-    assert(k != nullptr, \"just checking\");\n-    if (Universe::is_fully_initialized()) {\n-      assert_locked_or_safepoint(Compile_lock);\n-    }\n@@ -1632,1 +1628,1 @@\n-    \/\/ Now flush all code that depended on old class hierarchy.\n+    \/\/ Now mark all code that depended on old class hierarchy.\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":7,"deletions":11,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -370,1 +370,1 @@\n-  static void add_to_hierarchy(InstanceKlass* k, JavaThread* current);\n+  static void add_to_hierarchy(JavaThread* current, InstanceKlass* k);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -855,1 +855,1 @@\n-  SystemDictionary::add_to_hierarchy(loaded_lambda, THREAD);\n+  SystemDictionary::add_to_hierarchy(THREAD, loaded_lambda);\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -252,1 +252,1 @@\n-  SystemDictionary::add_to_hierarchy(klass, THREAD);\n+  SystemDictionary::add_to_hierarchy(THREAD, klass);\n","filename":"src\/hotspot\/share\/classfile\/vmClasses.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -152,0 +152,6 @@\n+  \/\/ We are not alive yet.\n+  if (!Universe::is_fully_initialized()) {\n+    DEBUG_ONLY(_deopted = true;)\n+    return;\n+  }\n+\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"}]}