{"files":[{"patch":"@@ -40,1 +40,0 @@\n-serviceability\/tmtools\/jstat\/GcNewTest.java 8293218 linux-x64,macosx-x64\n","filename":"test\/hotspot\/jtreg\/ProblemList-Xcomp.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -61,0 +61,3 @@\n+        float targetFraction = 0;\n+        \/\/ Read sizes of eden and overall heap, to find eden size as a fraction of heap.\n+        \/\/ Recognise if heap is changing size, and retry (heap is expected to initially shrink).\n@@ -62,0 +65,5 @@\n+            \/\/ One retry is expected occasionally.  More \"should not happen\":\n+            if (i == 2) {\n+                throw new RuntimeException(\"Cannot calculate targetFraction.  Heap size not stable.\");\n+            }\n+            long heapSize0 = Pools.getHeapCommittedSize();\n@@ -64,3 +72,11 @@\n-            float targetPercent = ((float) edenSize) \/ (heapSize);\n-            if ((targetPercent < 0) || (targetPercent > 1.0)) {\n-                throw new RuntimeException(\"Error in the percent calculation\" + \" (eden size: \" + edenSize + \", heap size: \" + heapSize + \", calculated eden percent: \" + targetPercent + \")\");\n+            if (heapSize < heapSize0) {\n+                System.out.println(\"provokeGc: Heap shrinking, retry. eden: \" + edenSize + \", heap0: \" + heapSize0 + \", heap: \" + heapSize);\n+                System.gc();\n+                continue;\n+            } else {\n+                targetFraction = ((float) edenSize) \/ (heapSize);\n+                if ((targetFraction < 0) || (targetFraction > 1.0)) {\n+                    throw new RuntimeException(\"Error in fraction calculation\" + \" (eden size: \" + edenSize + \", heap size: \" + heapSize\n+                                               + \", calculated eden fraction: \" + targetFraction + \")\");\n+                }\n+                break;\n@@ -68,3 +84,0 @@\n-            allocateHeap(targetPercent);\n-            allocateHeap(targetPercent);\n-            System.gc();\n@@ -72,0 +85,3 @@\n+        allocateHeap(targetFraction);\n+        allocateHeap(targetFraction);\n+        System.gc();\n","filename":"test\/hotspot\/jtreg\/serviceability\/tmtools\/jstat\/utils\/GcProvoker.java","additions":23,"deletions":7,"binary":false,"changes":30,"status":"modified"}]}