{"files":[{"patch":"@@ -3062,8 +3062,0 @@\n-  \/\/ Armed page has poll_bit set.\n-  if (at_return) {\n-    Register fp = R1_SP;\n-    if (!in_nmethod) {\n-      \/\/ frame still on stack, need to get fp\n-      fp = R0;\n-      ld(fp, _abi0(callers_sp), R1_SP);\n-    }\n@@ -3071,7 +3063,8 @@\n-    if (UseSIGTRAP && in_nmethod) {\n-      \/\/ Use Signal Handler.\n-      relocate(relocInfo::poll_return_type);\n-      td(traptoGreaterThanUnsigned, fp, temp);\n-    } else {\n-      cmpld(CCR0, fp, temp);\n-      if (in_nmethod) {\n+  if (at_return) {\n+    if (in_nmethod) {\n+      if (UseSIGTRAP) {\n+        \/\/ Use Signal Handler.\n+        relocate(relocInfo::poll_return_type);\n+        td(traptoGreaterThanUnsigned, R1_SP, temp);\n+      } else {\n+        cmpld(CCR0, R1_SP, temp);\n@@ -3080,2 +3073,0 @@\n-      } else {\n-        bgt(CCR0, slow_path);\n@@ -3083,0 +3074,6 @@\n+    } else { \/\/ Not in nmethod.\n+      \/\/ Frame still on stack, need to get fp.\n+      Register fp = R0;\n+      ld(fp, _abi0(callers_sp), R1_SP);\n+      cmpld(CCR0, fp, temp);\n+      bgt(CCR0, slow_path);\n@@ -3084,2 +3081,2 @@\n-  } else {\n-    assert(!in_nmethod, \"unexpected\");\n+  } else { \/\/ Normal safepoint poll. Not at return.\n+    assert(!in_nmethod, \"should use load_from_polling_page\");\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":16,"deletions":19,"binary":false,"changes":35,"status":"modified"}]}