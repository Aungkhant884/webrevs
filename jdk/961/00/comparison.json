{"files":[{"patch":"@@ -95,2 +95,2 @@\n-  template <class T>\n-  inline oop load_reference_barrier_native(oop obj, T* load_addr);\n+  template <DecoratorSet decorators, class T>\n+  inline oop load_reference_barrier(oop obj, T* load_addr);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -102,5 +102,2 @@\n-template <class T>\n-inline oop ShenandoahBarrierSet::load_reference_barrier_native(oop obj, T* load_addr) {\n-  if (CompressedOops::is_null(obj)) {\n-    return NULL;\n-  }\n+template <DecoratorSet decorators, class T>\n+inline oop ShenandoahBarrierSet::load_reference_barrier(oop obj, T* load_addr) {\n@@ -108,2 +105,4 @@\n-  ShenandoahMarkingContext* const marking_context = _heap->marking_context();\n-  if (_heap->is_concurrent_weak_root_in_progress() && !marking_context->is_marked(obj)) {\n+  \/\/ Prevent resurrection of unreachable non-strorg references.\n+  if (!HasDecorator<decorators, ON_STRONG_OOP_REF>::value && obj != NULL &&\n+      _heap->is_concurrent_weak_root_in_progress() &&\n+      !_heap->marking_context()->is_marked(obj)) {\n@@ -114,0 +113,2 @@\n+      \/\/ This path is sometimes (rarely) taken by GC threads.\n+      \/\/ See e.g.: https:\/\/bugs.openjdk.java.net\/browse\/JDK-8237874\n@@ -189,1 +190,1 @@\n-    value = bs->load_reference_barrier_native(value, addr);\n+    value = bs->load_reference_barrier<decorators, T>(value, addr);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahBarrierSet.inline.hpp","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -70,1 +70,1 @@\n-  return (oopDesc*) ShenandoahBarrierSet::barrier_set()->load_reference_barrier_native(oop(src), load_addr);\n+  return (oopDesc*) ShenandoahBarrierSet::barrier_set()->load_reference_barrier<ON_UNKNOWN_OOP_REF, oop>(oop(src), load_addr);\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahRuntime.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}