{"files":[{"patch":"@@ -28,2 +28,11 @@\n-import sun.swing.StringUIClientPropertyKey;\n-import sun.swing.SwingUtilities2;\n+import java.awt.BasicStroke;\n+import java.awt.Color;\n+import java.awt.Component;\n+import java.awt.Dialog;\n+import java.awt.Frame;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.Insets;\n+import java.awt.Stroke;\n+import java.awt.Window;\n+import java.awt.geom.AffineTransform;\n@@ -55,11 +64,0 @@\n-import java.awt.BasicStroke;\n-import java.awt.Color;\n-import java.awt.Component;\n-import java.awt.Dialog;\n-import java.awt.Frame;\n-import java.awt.Graphics;\n-import java.awt.Graphics2D;\n-import java.awt.Insets;\n-import java.awt.Stroke;\n-import java.awt.Window;\n-import java.awt.geom.AffineTransform;\n@@ -67,0 +65,2 @@\n+import sun.swing.StringUIClientPropertyKey;\n+import sun.swing.SwingUtilities2;\n@@ -242,1 +242,1 @@\n-        private static final int corner = 14;\n+        private static final int CORNER = 14;\n@@ -248,0 +248,1 @@\n+\n@@ -313,1 +314,1 @@\n-            int scaledCorner = (int) Math.round(corner * at.getScaleX());\n+            int corner = (int) Math.round(CORNER * at.getScaleX());\n@@ -319,1 +320,1 @@\n-            int midPoint = loopCount\/2;\n+            int midPoint = loopCount \/ 2;\n@@ -323,4 +324,4 @@\n-            g.drawLine( 0, 0, width-1, 0);\n-            g.drawLine( 0, 1, 0, height-1);\n-            g.drawLine( width-1, 1, width-1, height-1);\n-            g.drawLine( 1, height-1, width-1, height-1);\n+            g.drawLine(0, 0, width - 1, 0);\n+            g.drawLine(0, 1, 0, height - 1);\n+            g.drawLine(width - 1, 1, width - 1, height - 1);\n+            g.drawLine(1, height - 1, width - 1, height - 1);\n@@ -336,8 +337,8 @@\n-                g.drawLine(scaledCorner + 1, midPoint+stkWidth,\n-                        width- scaledCorner, midPoint+stkWidth); \/\/top\n-                g.drawLine(midPoint+stkWidth, scaledCorner + 1,\n-                        midPoint+stkWidth, height- scaledCorner); \/\/left\n-                g.drawLine(width-midPoint, scaledCorner + 1,\n-                        width-midPoint, height- scaledCorner); \/\/right\n-                g.drawLine(scaledCorner + 1, height-midPoint,\n-                        width- scaledCorner, height-midPoint); \/\/bottom\n+                g.drawLine(corner + 1, midPoint + stkWidth,\n+                        width - corner, midPoint + stkWidth); \/\/top\n+                g.drawLine(midPoint + stkWidth, corner + 1,\n+                        midPoint + stkWidth, height - corner); \/\/left\n+                g.drawLine(width - midPoint, corner + 1,\n+                        width - midPoint, height - corner); \/\/right\n+                g.drawLine(corner + 1, height - midPoint,\n+                        width - corner, height - midPoint); \/\/bottom\n@@ -347,6 +348,6 @@\n-                g.drawLine(scaledCorner, midPoint, width- scaledCorner -1, midPoint);\n-                g.drawLine(midPoint, scaledCorner, midPoint, height- scaledCorner -1);\n-                g.drawLine(width-(midPoint+stkWidth), scaledCorner,\n-                        width-(midPoint+stkWidth), height- scaledCorner -1);\n-                g.drawLine(scaledCorner, height-(midPoint+stkWidth),\n-                        width- scaledCorner -1, height-(midPoint+stkWidth));\n+                g.drawLine(corner, midPoint, width - corner - 1, midPoint);\n+                g.drawLine(midPoint, corner, midPoint, height - corner - 1);\n+                g.drawLine(width - (midPoint + stkWidth), corner,\n+                        width - (midPoint + stkWidth), height - corner - 1);\n+                g.drawLine(corner, height - (midPoint + stkWidth),\n+                        width - corner - 1, height - (midPoint + stkWidth));\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/plaf\/metal\/MetalBorders.java","additions":35,"deletions":34,"binary":false,"changes":69,"status":"modified"},{"patch":"@@ -24,0 +24,6 @@\n+import javax.imageio.ImageIO;\n+import javax.swing.JFrame;\n+import javax.swing.JInternalFrame;\n+import javax.swing.JLabel;\n+import javax.swing.SwingUtilities;\n+import javax.swing.UIManager;\n@@ -26,0 +32,1 @@\n+import java.awt.Graphics2D;\n@@ -28,0 +35,1 @@\n+import java.awt.Rectangle;\n@@ -31,1 +39,0 @@\n-import java.io.IOException;\n@@ -33,6 +40,0 @@\n-import javax.imageio.ImageIO;\n-import javax.swing.JFrame;\n-import javax.swing.JInternalFrame;\n-import javax.swing.JLabel;\n-import javax.swing.SwingUtilities;\n-import javax.swing.UIManager;\n@@ -74,1 +75,1 @@\n-    private static final int MIDPOINT = INTFRAME_SIZE\/2;\n+    private static final int MIDPOINT = INTFRAME_SIZE \/ 2;\n@@ -76,0 +77,1 @@\n+\n@@ -77,0 +79,1 @@\n+    private static Rectangle jFrameBounds;\n@@ -85,1 +88,1 @@\n-    private static String uiScale;\n+    private static float uiScale;\n@@ -99,1 +102,1 @@\n-            uiScale = System.getProperty(\"sun.java2d.uiScale\");\n+            uiScale = Float.parseFloat(System.getProperty(\"sun.java2d.uiScale\"));\n@@ -109,0 +112,1 @@\n+                jFrameBounds = jFrame.getBounds();\n@@ -112,6 +116,4 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                checkBorderMidPoints(\"TOP\");\n-                checkBorderMidPoints(\"RIGHT\");\n-                checkBorderMidPoints(\"BOTTOM\");\n-                checkBorderMidPoints(\"LEFT\");\n-            });\n+            checkBorderMidPoints(\"TOP\");\n+            checkBorderMidPoints(\"RIGHT\");\n+            checkBorderMidPoints(\"BOTTOM\");\n+            checkBorderMidPoints(\"LEFT\");\n@@ -120,6 +122,5 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                checkCorners(\"TOP_LEFT\");\n-                checkCorners(\"TOP_RIGHT\");\n-                checkCorners(\"BOTTOM_RIGHT\");\n-                checkCorners(\"BOTTOM_LEFT\");\n-            });\n+            checkCorners(\"TOP_LEFT\");\n+            checkCorners(\"TOP_RIGHT\");\n+            checkCorners(\"BOTTOM_RIGHT\");\n+            checkCorners(\"BOTTOM_LEFT\");\n+\n@@ -139,1 +140,3 @@\n-        int x = 0, y = 0, start = 0, stop = 0;\n+        int x, y;\n+        int start, stop;\n+\n@@ -177,6 +180,6 @@\n-                    isVertical ? i : (iFrameLoc.x + MIDPOINT),\n-                    isHorizontal ? i : (iFrameLoc.y + MIDPOINT)))) {\n-                        saveScreenCapture(borderDirection + \"_\" + uiScale + \".png\");\n-                        errorLog.append(\"uiScale: \"+ uiScale +\n-                                \" Red background color\" + \" detected at \"\n-                                + borderDirection + \" border\\n\");\n+            isVertical ? i : (iFrameLoc.x + MIDPOINT),\n+            isHorizontal ? i : (iFrameLoc.y + MIDPOINT)))) {\n+                saveScreenCapture(borderDirection + \"_\" + uiScale + \".png\", uiScale);\n+                errorLog.append(\"At uiScale: \"+ uiScale +\n+                \", Red background color detected at \"\n+                + borderDirection + \" border\\n\");\n@@ -189,1 +192,1 @@\n-        int x, y = 0;\n+        int x, y;\n@@ -213,2 +216,2 @@\n-            saveScreenCapture(cornerLocation + \"_\" + uiScale + \".png\");\n-            errorLog.append(\"uiScale: \"+ uiScale + \" Red background color\" +\n+            saveScreenCapture(cornerLocation + \"_\" + uiScale + \".png\", uiScale);\n+            errorLog.append(\"At uiScale: \"+ uiScale + \", Red background color\" +\n@@ -225,1 +228,0 @@\n-        JLabel scale = new JLabel(\"UI Scale: \"+ uiScale);\n@@ -227,0 +229,1 @@\n+        JLabel scale = new JLabel(\"UI Scale: \"+ uiScale);\n@@ -239,3 +242,12 @@\n-    \/\/ for debugging purpose, saves screen capture when test fails.\n-    private static void saveScreenCapture(String filename) {\n-        BufferedImage image = robot.createScreenCapture(jFrame.getBounds());\n+\n+\n+    private static void saveScreenCapture(String filename, float scale) {\n+        BufferedImage image = robot.createScreenCapture(jFrameBounds);\n+        BufferedImage scaledImage = new BufferedImage((int) (scale * image.getWidth(null)),\n+            (int) (scale * image.getHeight(null)), BufferedImage.TYPE_INT_ARGB);\n+\n+        Graphics2D g2d = (Graphics2D) scaledImage.getGraphics();\n+        g2d.scale(scale, scale);\n+        g2d.drawImage(image, 0, 0, null);\n+        g2d.dispose();\n+\n@@ -243,2 +255,2 @@\n-            ImageIO.write(image,\"png\", new File(filename));\n-        } catch (IOException e) {\n+            ImageIO.write(scaledImage, \"png\", new File(filename));\n+        } catch (Exception e) {\n","filename":"test\/jdk\/javax\/swing\/JInternalFrame\/InternalFrameBorderTest.java","additions":50,"deletions":38,"binary":false,"changes":88,"status":"modified"}]}