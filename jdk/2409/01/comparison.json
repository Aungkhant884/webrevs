{"files":[{"patch":"@@ -2198,12 +2198,14 @@\n-  while (::fgets(buf, sizeof(buf), f) != NULL && num_found < num_values) {\n-    if ( (vmsize == -1    && sscanf(buf, \"VmSize: \" SSIZE_FORMAT \" kB\", &vmsize) == 1) ||\n-         (vmpeak == -1    && sscanf(buf, \"VmPeak: \" SSIZE_FORMAT \" kB\", &vmpeak) == 1) ||\n-         (vmswap == -1    && sscanf(buf, \"VmSwap: \" SSIZE_FORMAT \" kB\", &vmswap) == 1) ||\n-         (vmhwm == -1     && sscanf(buf, \"VmHWM: \" SSIZE_FORMAT \" kB\", &vmhwm) == 1) ||\n-         (vmrss == -1     && sscanf(buf, \"VmRSS: \" SSIZE_FORMAT \" kB\", &vmrss) == 1) ||\n-         (rssanon == -1   && sscanf(buf, \"RssAnon: \" SSIZE_FORMAT \" kB\", &rssanon) == 1) ||\n-         (rssfile == -1   && sscanf(buf, \"RssFile: \" SSIZE_FORMAT \" kB\", &rssfile) == 1) ||\n-         (rssshmem == -1  && sscanf(buf, \"RssShmem: \" SSIZE_FORMAT \" kB\", &rssshmem) == 1)\n-         )\n-    {\n-      num_found ++;\n+  if (f != NULL) {\n+    while (::fgets(buf, sizeof(buf), f) != NULL && num_found < num_values) {\n+      if ( (vmsize == -1    && sscanf(buf, \"VmSize: \" SSIZE_FORMAT \" kB\", &vmsize) == 1) ||\n+           (vmpeak == -1    && sscanf(buf, \"VmPeak: \" SSIZE_FORMAT \" kB\", &vmpeak) == 1) ||\n+           (vmswap == -1    && sscanf(buf, \"VmSwap: \" SSIZE_FORMAT \" kB\", &vmswap) == 1) ||\n+           (vmhwm == -1     && sscanf(buf, \"VmHWM: \" SSIZE_FORMAT \" kB\", &vmhwm) == 1) ||\n+           (vmrss == -1     && sscanf(buf, \"VmRSS: \" SSIZE_FORMAT \" kB\", &vmrss) == 1) ||\n+           (rssanon == -1   && sscanf(buf, \"RssAnon: \" SSIZE_FORMAT \" kB\", &rssanon) == 1) ||\n+           (rssfile == -1   && sscanf(buf, \"RssFile: \" SSIZE_FORMAT \" kB\", &rssfile) == 1) ||\n+           (rssshmem == -1  && sscanf(buf, \"RssShmem: \" SSIZE_FORMAT \" kB\", &rssshmem) == 1)\n+           )\n+      {\n+        num_found ++;\n+      }\n@@ -2211,10 +2213,14 @@\n-  }\n-  st->print_cr(\"Virtual Size: \" SSIZE_FORMAT \"K (peak: \" SSIZE_FORMAT \"K)\", vmsize, vmpeak);\n-  st->print(\"Resident Set Size: \" SSIZE_FORMAT \"K (peak: \" SSIZE_FORMAT \"K)\", vmrss, vmhwm);\n-  if (rssanon != -1) { \/\/ requires kernel >= 4.5\n-    st->print(\" (anon: \" SSIZE_FORMAT \"K, file: \" SSIZE_FORMAT \"K, shmem: \" SSIZE_FORMAT \"K)\",\n-                rssanon, rssfile, rssshmem);\n-  }\n-  st->cr();\n-  if (vmswap != -1) { \/\/ requires kernel >= 2.6.34\n-    st->print_cr(\"Swapped out: \" SSIZE_FORMAT \"K\", vmswap);\n+    fclose(f);\n+\n+    st->print_cr(\"Virtual Size: \" SSIZE_FORMAT \"K (peak: \" SSIZE_FORMAT \"K)\", vmsize, vmpeak);\n+    st->print(\"Resident Set Size: \" SSIZE_FORMAT \"K (peak: \" SSIZE_FORMAT \"K)\", vmrss, vmhwm);\n+    if (rssanon != -1) { \/\/ requires kernel >= 4.5\n+      st->print(\" (anon: \" SSIZE_FORMAT \"K, file: \" SSIZE_FORMAT \"K, shmem: \" SSIZE_FORMAT \"K)\",\n+                  rssanon, rssfile, rssshmem);\n+    }\n+    st->cr();\n+    if (vmswap != -1) { \/\/ requires kernel >= 2.6.34\n+      st->print_cr(\"Swapped out: \" SSIZE_FORMAT \"K\", vmswap);\n+    }\n+  } else {\n+    st->print_cr(\"Could not open \/proc\/self\/status to get process memory related information\");\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":28,"deletions":22,"binary":false,"changes":50,"status":"modified"}]}