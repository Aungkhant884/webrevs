{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -221,0 +221,13 @@\n+            \/*\n+             * Set socket read timeout to configured value for JRMP\n+             * connection handshake; this also serves to guard against\n+             * non-JRMP servers that do not respond (see 4322806).\n+             *\/\n+            int originalSoTimeout = 0;\n+            try {\n+                originalSoTimeout = sock.getSoTimeout();\n+                sock.setSoTimeout(handshakeTimeout);\n+            } catch (Exception e) {\n+                \/\/ if we fail to set this, ignore and proceed anyway\n+            }\n+\n@@ -232,13 +245,0 @@\n-                \/*\n-                 * Set socket read timeout to configured value for JRMP\n-                 * connection handshake; this also serves to guard against\n-                 * non-JRMP servers that do not respond (see 4322806).\n-                 *\/\n-                int originalSoTimeout = 0;\n-                try {\n-                    originalSoTimeout = sock.getSoTimeout();\n-                    sock.setSoTimeout(handshakeTimeout);\n-                } catch (Exception e) {\n-                    \/\/ if we fail to set this, ignore and proceed anyway\n-                }\n-\n","filename":"src\/java.rmi\/share\/classes\/sun\/rmi\/transport\/tcp\/TCPChannel.java","additions":14,"deletions":14,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,1 @@\n- * @bug 4322806\n+ * @bug 4322806 8189338\n@@ -41,0 +41,1 @@\n+ * @run main\/othervm HandshakeTimeout SSL\n@@ -43,0 +44,2 @@\n+import javax.rmi.ssl.SslRMIClientSocketFactory;\n+import java.net.InetSocketAddress;\n@@ -63,1 +66,1 @@\n-        int port = serverSocket.getLocalPort();\n+        InetSocketAddress address = (InetSocketAddress) serverSocket.getLocalSocketAddress();\n@@ -68,1 +71,8 @@\n-        Registry registry = LocateRegistry.getRegistry(port);\n+        Registry registry;\n+        if (args.length == 0) {\n+            registry = LocateRegistry.getRegistry(address.getPort());\n+        } else {\n+            registry = LocateRegistry.getRegistry(address.getHostString(),\n+                    address.getPort(), new SslRMIClientSocketFactory());\n+        }\n+\n","filename":"test\/jdk\/java\/rmi\/transport\/handshakeTimeout\/HandshakeTimeout.java","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"}]}