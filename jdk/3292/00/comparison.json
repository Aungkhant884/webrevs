{"files":[{"patch":"@@ -177,1 +177,1 @@\n-                    Status.CLOSED, getHandshakeStatus(), 0, 0);\n+                    Status.CLOSED, conContext.getHandshakeStatus(), 0, 0);\n@@ -187,1 +187,1 @@\n-            hsStatus = getHandshakeStatus();\n+            hsStatus = conContext.getHandshakeStatus();\n@@ -205,1 +205,1 @@\n-            hsStatus = getHandshakeStatus();\n+            hsStatus = conContext.getHandshakeStatus();\n@@ -229,1 +229,1 @@\n-                Status.BUFFER_OVERFLOW, getHandshakeStatus(), 0, 0);\n+                Status.BUFFER_OVERFLOW, conContext.getHandshakeStatus(), 0, 0);\n@@ -269,1 +269,1 @@\n-            hsStatus = getHandshakeStatus();\n+            hsStatus = conContext.getHandshakeStatus();\n@@ -539,1 +539,1 @@\n-                    Status.CLOSED, getHandshakeStatus(), 0, 0);\n+                    Status.CLOSED, conContext.getHandshakeStatus(), 0, 0);\n@@ -552,1 +552,1 @@\n-            hsStatus = getHandshakeStatus();\n+            hsStatus = conContext.getHandshakeStatus();\n@@ -559,1 +559,1 @@\n-            hsStatus = getHandshakeStatus();\n+            hsStatus = conContext.getHandshakeStatus();\n@@ -589,1 +589,1 @@\n-                hsStatus = getHandshakeStatus();\n+                hsStatus = conContext.getHandshakeStatus();\n@@ -628,1 +628,1 @@\n-                    hsStatus = getHandshakeStatus();\n+                    hsStatus = conContext.getHandshakeStatus();\n@@ -715,1 +715,1 @@\n-            hsStatus = getHandshakeStatus();\n+            hsStatus = conContext.getHandshakeStatus();\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLEngineImpl.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -1420,2 +1420,4 @@\n-            } catch (SSLException | InterruptedIOException | SocketException se) {\n-                \/\/ don't change exception in case of timeouts or interrupts or SocketException\n+            } catch (SSLException |\n+                    InterruptedIOException | SocketException se) {\n+                \/\/ Don't change exception in case of timeouts or interrupts\n+                \/\/ or SocketException.\n@@ -1477,2 +1479,4 @@\n-            } catch (SSLException | InterruptedIOException | SocketException se) {\n-                \/\/ don't change exception in case of timeouts or interrupts or SocketException.\n+            } catch (SSLException |\n+                    InterruptedIOException | SocketException se) {\n+                \/\/ Don't change exception in case of timeouts or interrupts\n+                \/\/ or SocketException.\n@@ -1486,1 +1490,2 @@\n-        \/\/ couldn't read, due to some kind of error\n+        \/\/ Couldn't read, due to some kind of error or inbound\n+        \/\/ has been closed.\n@@ -1689,1 +1694,1 @@\n-                conContext.fatal(alert, cause);\n+                throw conContext.fatal(alert, cause);\n@@ -1751,1 +1756,2 @@\n-                closeSocket(!conContext.isInputCloseNotified);\n+                closeSocket(conContext.isNegotiated &&\n+                        !conContext.isInputCloseNotified);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLSocketImpl.java","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -587,1 +587,1 @@\n-    \/\/ Note; HandshakeStatus.FINISHED status is retrieved in other places.\n+    \/\/ Note: HandshakeStatus.FINISHED status is retrieved in other places.\n@@ -592,1 +592,16 @@\n-            return HandshakeStatus.NEED_WRAP;\n+            if (!isOutboundClosed()) {\n+                \/\/ Outbound is open.\n+                return HandshakeStatus.NEED_WRAP;\n+            } else if (isInboundClosed()) {\n+                \/\/ Both inbound & outbound are closed.\n+                return HandshakeStatus.NOT_HANDSHAKING;\n+            } else if (handshakeContext != null) {\n+                \/\/ Inbound is open, and outbound is closed.\n+                if (!handshakeContext.delegatedActions.isEmpty()) {\n+                    return HandshakeStatus.NEED_TASK;\n+                } else if (sslContext.isDTLS() && !inputRecord.isEmpty()) {\n+                    return HandshakeStatus.NEED_UNWRAP_AGAIN;\n+                } else {\n+                    return HandshakeStatus.NEED_UNWRAP;\n+                }\n+            }   \/\/ Otherwise, return NOT_HANDSHAKING.\n@@ -599,2 +614,1 @@\n-                if (sslContext.isDTLS() &&\n-                        !inputRecord.isEmpty()) {\n+                if (sslContext.isDTLS() && !inputRecord.isEmpty()) {\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/TransportContext.java","additions":19,"deletions":5,"binary":false,"changes":24,"status":"modified"}]}