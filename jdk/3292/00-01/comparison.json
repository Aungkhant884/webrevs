{"files":[{"patch":"@@ -58,1 +58,1 @@\n-                if (fragmenter != null && fragmenter.hasAlert()) {\n+                if (fragmenter != null && !fragmenter.isEmpty()) {\n@@ -177,0 +177,1 @@\n+\n@@ -536,6 +537,10 @@\n-            if (hsMemo != null) {\n-                return new Ciphertext(hsMemo.contentType,\n-                        hsMemo.handshakeType, recordSN);\n-            } else {\n-                if (isCloseWaiting &&\n-                        memo.contentType == ContentType.ALERT.id) {\n+            try {\n+                if (hsMemo != null) {\n+                    return new Ciphertext(hsMemo.contentType,\n+                            hsMemo.handshakeType, recordSN);\n+                } else {\n+                    return new Ciphertext(memo.contentType,\n+                            SSLHandshake.NOT_APPLICABLE.id, recordSN);\n+                }\n+            } finally {\n+                if (isCloseWaiting && isEmpty()) {\n@@ -544,3 +549,0 @@\n-\n-                return new Ciphertext(memo.contentType,\n-                        SSLHandshake.NOT_APPLICABLE.id, recordSN);\n@@ -553,10 +555,0 @@\n-\n-        boolean hasAlert() {\n-            for (RecordMemo memo : handshakeMemos) {\n-                if (memo.contentType == ContentType.ALERT.id) {\n-                    return true;\n-                }\n-            }\n-\n-            return false;\n-        }\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLEngineOutputRecord.java","additions":12,"deletions":20,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -590,1 +590,1 @@\n-            \/\/ If no handshaking, special case to wrap alters or\n+            \/\/ If not handshaking, special case to wrap alerts or\n@@ -592,16 +592,1 @@\n-            if (!isOutboundClosed()) {\n-                \/\/ Outbound is open.\n-                return HandshakeStatus.NEED_WRAP;\n-            } else if (isInboundClosed()) {\n-                \/\/ Both inbound & outbound are closed.\n-                return HandshakeStatus.NOT_HANDSHAKING;\n-            } else if (handshakeContext != null) {\n-                \/\/ Inbound is open, and outbound is closed.\n-                if (!handshakeContext.delegatedActions.isEmpty()) {\n-                    return HandshakeStatus.NEED_TASK;\n-                } else if (sslContext.isDTLS() && !inputRecord.isEmpty()) {\n-                    return HandshakeStatus.NEED_UNWRAP_AGAIN;\n-                } else {\n-                    return HandshakeStatus.NEED_UNWRAP;\n-                }\n-            }   \/\/ Otherwise, return NOT_HANDSHAKING.\n+            return HandshakeStatus.NEED_WRAP;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/TransportContext.java","additions":2,"deletions":17,"binary":false,"changes":19,"status":"modified"}]}