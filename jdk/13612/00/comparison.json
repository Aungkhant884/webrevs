{"files":[{"patch":"@@ -279,12 +279,0 @@\n-  class G1CardSetHashTableScan : public StackObj {\n-    G1CardSet::ContainerPtrClosure* _scan_f;\n-  public:\n-    explicit G1CardSetHashTableScan(G1CardSet::ContainerPtrClosure* f) : _scan_f(f) { }\n-\n-    bool operator()(G1CardSetHashTableValue* value) {\n-      _scan_f->do_containerptr(value->_region_idx, value->_num_occupied, value->_container);\n-      return true;\n-    }\n-  };\n-\n-\n@@ -338,3 +326,3 @@\n-  void iterate_safepoint(G1CardSet::ContainerPtrClosure* cl2) {\n-    G1CardSetHashTableScan cl(cl2);\n-    _table_scanner.do_safepoint_scan(cl);\n+  template <typename SCAN_FUNC>\n+  void iterate_safepoint(SCAN_FUNC& scan_f) {\n+    _table_scanner.do_safepoint_scan(scan_f);\n@@ -343,3 +331,3 @@\n-  void iterate(G1CardSet::ContainerPtrClosure* cl2) {\n-    G1CardSetHashTableScan cl(cl2);\n-    _table.do_scan(Thread::current(), cl);\n+  template <typename SCAN_FUNC>\n+  void iterate(SCAN_FUNC& scan_f) {\n+    _table.do_scan(Thread::current(), scan_f);\n@@ -927,0 +915,6 @@\n+  auto do_value =\n+    [&] (G1CardSetHashTableValue* value) {\n+      cl->do_containerptr(value->_region_idx, value->_num_occupied, value->_container);\n+      return true;\n+    };\n+\n@@ -928,1 +922,1 @@\n-    _table->iterate_safepoint(cl);\n+    _table->iterate_safepoint(do_value);\n@@ -930,1 +924,1 @@\n-    _table->iterate(cl);\n+    _table->iterate(do_value);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.cpp","additions":14,"deletions":20,"binary":false,"changes":34,"status":"modified"}]}