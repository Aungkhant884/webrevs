{"files":[{"patch":"@@ -327,1 +327,1 @@\n-    sym = do_add_if_needed(name, len, hash, true);\n+    sym = do_add_if_needed(name, len, hash, \/* is_permanent *\/ false);\n@@ -342,1 +342,1 @@\n-    found = do_add_if_needed(name, len, hash, true);\n+    found = do_add_if_needed(name, len, hash, \/* is_permanent *\/ false);\n@@ -444,1 +444,1 @@\n-  \/\/ Note that c_heap will be true for non-strong hidden classes.\n+  \/\/ Note that is_permanent will be false for non-strong hidden classes.\n@@ -446,1 +446,1 @@\n-  bool c_heap = !loader_data->is_the_null_class_loader_data();\n+  bool is_permanent = loader_data->is_the_null_class_loader_data();\n@@ -452,1 +452,1 @@\n-    Symbol* sym = do_add_if_needed(name, len, hash, c_heap);\n+    Symbol* sym = do_add_if_needed(name, len, hash, is_permanent);\n@@ -458,1 +458,1 @@\n-Symbol* SymbolTable::do_add_if_needed(const char* name, int len, uintx hash, bool heap) {\n+Symbol* SymbolTable::do_add_if_needed(const char* name, int len, uintx hash, bool is_permanent) {\n@@ -468,2 +468,3 @@\n-  u1* u1_buf = NEW_RESOURCE_ARRAY(u1, alloc_size);\n-  Symbol* tmp = ::new ((void*)u1_buf) Symbol((const u1*)name, len, (heap && !DumpSharedSpaces) ? 1 : PERM_REFCOUNT);\n+  u1* u1_buf = NEW_RESOURCE_ARRAY_IN_THREAD(current, u1, alloc_size);\n+  Symbol* tmp = ::new ((void*)u1_buf) Symbol((const u1*)name, len,\n+                                             (is_permanent || DumpSharedSpaces) ? PERM_REFCOUNT : 1);\n@@ -509,1 +510,1 @@\n-    sym = do_add_if_needed(name, len, hash, false);\n+    sym = do_add_if_needed(name, len, hash, \/* is_permanent *\/ true);\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.cpp","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -79,1 +79,1 @@\n-  static Symbol* do_add_if_needed(const char* name, int len, uintx hash, bool heap);\n+  static Symbol* do_add_if_needed(const char* name, int len, uintx hash, bool is_permanent);\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -68,0 +68,1 @@\n+\/\/ This copies the symbol when it is added to the ConcurrentHashTable.\n","filename":"src\/hotspot\/share\/oops\/symbol.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}