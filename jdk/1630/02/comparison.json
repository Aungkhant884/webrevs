{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -32,0 +32,2 @@\n+ * @library \/test\/lib\/\n+ * @build jdk.test.lib.util.ForceGC\n@@ -44,0 +46,2 @@\n+import jdk.test.lib.util.ForceGC;\n+\n@@ -61,7 +65,6 @@\n-            \/\/ unloading the class loader and native library\n-            System.gc();\n-            \/\/ give Cleaner thread a chance to unload the native library\n-            Thread.sleep(100);\n-\n-            \/\/ unloadedCount is incremented when the native library is unloaded\n-            if (count != unloadedCount) {\n+            \/\/ Unload the class loader and native library, and give the Cleaner\n+            \/\/ thread a chance to unload the native library.\n+            \/\/ unloadedCount is incremented when the native library is unloaded.\n+            ForceGC gc = new ForceGC();\n+            final int finalCount = count;\n+            if (!gc.await(() -> finalCount == unloadedCount)) {\n","filename":"test\/jdk\/java\/lang\/ClassLoader\/nativeLibrary\/NativeLibraryTest.java","additions":11,"deletions":8,"binary":false,"changes":19,"status":"modified"}]}