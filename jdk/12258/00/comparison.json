{"files":[{"patch":"@@ -33,0 +33,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -185,10 +186,15 @@\n-  T* referent_addr   = (T*) java_lang_ref_Reference::referent_addr_raw(obj);\n-  T* discovered_addr = (T*) java_lang_ref_Reference::discovered_addr_raw(obj);\n-\n-  log_develop_trace(gc, ref)(\"InstanceRefKlass %s for obj \" PTR_FORMAT, s, p2i(obj));\n-  if (java_lang_ref_Reference::is_phantom(obj)) {\n-    log_develop_trace(gc, ref)(\"     referent_addr\/* \" PTR_FORMAT \" \/ \" PTR_FORMAT,\n-                               p2i(referent_addr), p2i((oop)HeapAccess<ON_PHANTOM_OOP_REF | AS_NO_KEEPALIVE>::oop_load(referent_addr)));\n-  } else {\n-    log_develop_trace(gc, ref)(\"     referent_addr\/* \" PTR_FORMAT \" \/ \" PTR_FORMAT,\n-                               p2i(referent_addr), p2i((oop)HeapAccess<ON_WEAK_OOP_REF | AS_NO_KEEPALIVE>::oop_load(referent_addr)));\n+  struct Stream : public LogStream {\n+    Stream() : LogStream(LogTarget(Trace, gc, ref)()) {}\n+    void print_contents_cr(oop* addr)       { print_cr(PTR_FORMAT,   *(uintptr_t*)addr); }\n+    void print_contents_cr(narrowOop* addr) { print_cr(UINT32_FORMAT_X_0, *(uint32_t*)addr); }\n+  } stream;\n+\n+  if (stream.is_enabled()) {\n+    T* referent_addr   = (T*) java_lang_ref_Reference::referent_addr_raw(obj);\n+    T* discovered_addr = (T*) java_lang_ref_Reference::discovered_addr_raw(obj);\n+\n+    stream.print_cr(\"InstanceRefKlass %s for obj \" PTR_FORMAT, s, p2i(obj));\n+    stream.print(\"     referent_addr\/* \" PTR_FORMAT \" \/ \", p2i(referent_addr));\n+    stream.print_contents_cr(referent_addr);\n+    stream.print(\"     discovered_addr\/* \" PTR_FORMAT \" \/ \", p2i(discovered_addr));\n+    stream.print_contents_cr(discovered_addr);\n@@ -196,2 +202,0 @@\n-  log_develop_trace(gc, ref)(\"     discovered_addr\/* \" PTR_FORMAT \" \/ \" PTR_FORMAT,\n-      p2i(discovered_addr), p2i((oop)HeapAccess<AS_NO_KEEPALIVE>::oop_load(discovered_addr)));\n","filename":"src\/hotspot\/share\/oops\/instanceRefKlass.inline.hpp","additions":16,"deletions":12,"binary":false,"changes":28,"status":"modified"}]}