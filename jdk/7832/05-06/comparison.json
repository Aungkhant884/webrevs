{"files":[{"patch":"@@ -4013,20 +4013,0 @@\n-instruct ReplB_imm(vec dst, immI con) %{\n-  match(Set dst (ReplicateB con));\n-  format %{ \"replicateB $dst,$con\" %}\n-  ins_encode %{\n-    InternalAddress addr = $constantaddress(T_BYTE, vreplicate_imm(T_BYTE, $con$$constant,\n-        VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 4 : 8) : 16));\n-    int vlen_enc = vector_length_encoding(this);\n-    if (VM_Version::supports_avx2()) {\n-      __ vpbroadcastd($dst$$XMMRegister, addr, vlen_enc);\n-    } else if (VM_Version::supports_avx()) {\n-      __ vbroadcastss($dst$$XMMRegister, addr, vlen_enc);\n-    } else if (VM_Version::supports_sse3()) {\n-      __ movddup($dst$$XMMRegister, addr);\n-    } else {\n-      __ load_vector(T_BYTE, $dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n-    }\n-  %}\n-  ins_pipe( pipe_slow );\n-%}\n-\n@@ -4070,20 +4050,0 @@\n-instruct ReplS_imm(vec dst, immI con) %{\n-  match(Set dst (ReplicateS con));\n-  format %{ \"replicateS $dst,$con\" %}\n-  ins_encode %{\n-    InternalAddress addr = $constantaddress(T_SHORT, vreplicate_imm(T_SHORT, $con$$constant,\n-        VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 2 : 4) : 8));\n-    int vlen_enc = vector_length_encoding(this);\n-    if (VM_Version::supports_avx2()) {\n-      __ vpbroadcastd($dst$$XMMRegister, addr, vlen_enc);\n-    } else if (VM_Version::supports_avx()) {\n-      __ vbroadcastss($dst$$XMMRegister, addr, vlen_enc);\n-    } else if (VM_Version::supports_sse3()) {\n-      __ movddup($dst$$XMMRegister, addr);\n-    } else {\n-      __ load_vector(T_SHORT, $dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n-    }\n-  %}\n-  ins_pipe( pipe_slow );\n-%}\n-\n@@ -4129,0 +4089,2 @@\n+  match(Set dst (ReplicateB con));\n+  match(Set dst (ReplicateS con));\n@@ -4132,2 +4094,5 @@\n-    InternalAddress addr = $constantaddress(T_INT, vreplicate_imm(T_INT, $con$$constant,\n-        VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 1 : 2) : 4));\n+    InternalAddress addr = $constantaddress(Matcher::vector_element_basic_type(this),\n+        vreplicate_imm(Matcher::vector_element_basic_type(this), $con$$constant,\n+            (VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 4 : 8) : 16) \/\n+                type2aelembytes(Matcher::vector_element_basic_type(this))));\n+    BasicType bt = Matcher::vector_element_basic_type(this);\n@@ -4142,1 +4107,1 @@\n-      __ load_vector(T_INT, $dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n+      __ load_vector(bt, $dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":8,"deletions":43,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -68,1 +68,1 @@\n-    _is_mach_constant(false),\n+    _is_mach_constant(instr->_is_mach_constant),\n","filename":"src\/hotspot\/share\/adlc\/formssel.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}