{"files":[{"patch":"@@ -4128,1 +4128,1 @@\n-instruct ReplB_reg(vec dst, rRegI src, vec xtmp) %{\n+instruct ReplB_reg(vec dst, rRegI src) %{\n@@ -4131,1 +4131,1 @@\n-  effect(TEMP dst, TEMP xtmp);\n+  effect(TEMP dst);\n@@ -4134,0 +4134,1 @@\n+    uint vlen = Matcher::vector_length(this);\n@@ -4135,2 +4136,6 @@\n-    __ pxor($xtmp$$XMMRegister, $xtmp$$XMMRegister);\n-    __ pshufb($dst$$XMMRegister, $xtmp$$XMMRegister);\n+    __ punpcklbw($dst$$XMMRegister, $dst$$XMMRegister);\n+    __ pshuflw($dst$$XMMRegister, $dst$$XMMRegister, 0x00);\n+    if (vlen >= 16) {\n+      assert(vlen == 16, \"\");\n+      __ punpcklqdq($dst$$XMMRegister, $dst$$XMMRegister);\n+    }\n@@ -4244,1 +4249,1 @@\n-            (VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 4 : 8) : 16) \/\n+            (VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 4 : 8) : 8) \/\n@@ -4253,1 +4258,4 @@\n-      __ load_vector($dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n+      __ movq($dst$$XMMRegister, addr);\n+      if (Matcher::vector_length_in_bytes(this) >= 16) {\n+        __ punpcklqdq($dst$$XMMRegister, $dst$$XMMRegister);\n+      }\n@@ -4389,2 +4397,1 @@\n-    InternalAddress addr = $constantaddress(T_LONG, vreplicate_imm(T_LONG, $con$$constant,\n-        VM_Version::supports_sse3() ? 1 : 2));\n+    InternalAddress addr = $constantaddress(T_LONG, vreplicate_imm(T_LONG, $con$$constant, 1));\n@@ -4397,1 +4404,4 @@\n-      __ load_vector($dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n+      __ movq($dst$$XMMRegister, addr);\n+      if (Matcher::vector_length_in_bytes(this) >= 16) {\n+        __ punpcklqdq($dst$$XMMRegister, $dst$$XMMRegister);\n+      }\n@@ -4477,1 +4487,1 @@\n-        VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 1 : 2) : 4));\n+        VM_Version::supports_sse3() ? (VM_Version::supports_avx() ? 1 : 2) : 2));\n@@ -4484,1 +4494,4 @@\n-      __ load_vector($dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n+      __ movq($dst$$XMMRegister, addr);\n+      if (Matcher::vector_length_in_bytes(this) >= 16) {\n+        __ punpcklqdq($dst$$XMMRegister, $dst$$XMMRegister);\n+      }\n@@ -4557,2 +4570,1 @@\n-    InternalAddress addr = $constantaddress(T_DOUBLE, vreplicate_imm(T_DOUBLE, $con$$constant,\n-        VM_Version::supports_sse3() ? 1 : 2));\n+    InternalAddress addr = $constantaddress(T_DOUBLE, vreplicate_imm(T_DOUBLE, $con$$constant, 1));\n@@ -4565,1 +4577,4 @@\n-      __ load_vector($dst$$XMMRegister, addr, Matcher::vector_length_in_bytes(this));\n+      __ movq($dst$$XMMRegister, addr);\n+      if (Matcher::vector_length_in_bytes(this) >= 16) {\n+        __ punpcklqdq($dst$$XMMRegister, $dst$$XMMRegister);\n+      }\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":29,"deletions":14,"binary":false,"changes":43,"status":"modified"}]}