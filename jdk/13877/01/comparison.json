{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -148,3 +148,8 @@\n-            for (TypeElement subNode : permittedSubclasses(node, exports)) {\n-                if (isInPublicApi(node, exports) && isInPublicApi(subNode, exports)) {\n-                    state.addEdge(node, subNode);\n+            if (!(node.getModifiers().contains(Modifier.SEALED) || node.getModifiers().contains(Modifier.FINAL))) {\n+                state.addNonSealedEdge(node);\n+            } else {\n+                for (TypeElement subNode : permittedSubclasses(node, exports)) {\n+                    if (isInPublicApi(node, exports) && isInPublicApi(subNode, exports)) {\n+                        state.addEdge(node, subNode);\n+                    }\n+                    traverse(state, subNode, exports);\n@@ -152,1 +157,0 @@\n-                traverse(state, subNode, exports);\n@@ -161,1 +165,0 @@\n-            private static final String STYLE = \"style\";\n@@ -167,1 +170,20 @@\n-            private final Map<String, Map<String, String>> nodeStyleMap;\n+            private final Map<String, Map<String, StyleItem>> nodeStyleMap;\n+\n+            private int nonSealedHierarchyCount = 0;\n+\n+            private sealed interface StyleItem {\n+                String valueString();\n+\n+                record PlainString(String text) implements StyleItem {\n+                    @Override\n+                    public String valueString() {\n+                        return \"\\\"\" + text + \"\\\"\";\n+                    }\n+                }\n+                record HtmlString(String text) implements StyleItem {\n+                    @Override\n+                    public String valueString() {\n+                        return \"<\" + text + \">\";\n+                    }\n+                }\n+            }\n@@ -191,7 +213,3 @@\n-                styles.put(LABEL, node.getSimpleName().toString());\n-                styles.put(TOOLTIP, node.getQualifiedName().toString());\n-                styles.put(LINK, relativeLink(node));\n-                if (!(node.getModifiers().contains(Modifier.SEALED) || node.getModifiers().contains(Modifier.FINAL))) {\n-                    \/\/ This indicates that the hierarchy is not closed\n-                    styles.put(STYLE, \"dashed\");\n-                }\n+                styles.put(LABEL, new StyleItem.PlainString(node.getSimpleName().toString()));\n+                styles.put(TOOLTIP, new StyleItem.PlainString(node.getQualifiedName().toString()));\n+                styles.put(LINK, new StyleItem.PlainString(relativeLink(node)));\n@@ -226,0 +244,20 @@\n+            public void addNonSealedEdge(TypeElement node) {\n+                \/\/ prepare open node\n+                var openNodeId = \"open node #\" + nonSealedHierarchyCount++;\n+                var styles = nodeStyleMap.computeIfAbsent(openNodeId, n -> new LinkedHashMap<>());\n+                styles.put(LABEL, new StyleItem.HtmlString(\"<I>&lt;any&gt;<\/I>\"));\n+                styles.put(TOOLTIP, new StyleItem.PlainString(\"Non-sealed Hierarchy\"));\n+\n+                \/\/ add link to parent node\n+                builder.append(\"  \")\n+                        .append('\"')\n+                        .append(openNodeId)\n+                        .append('\"')\n+                        .append(\" -> \")\n+                        .append(quotedId(node))\n+                        .append(\" \")\n+                        .append(\"[style=\\\"dashed\\\"]\")\n+                        .append(\";\")\n+                        .append(lineSeparator());\n+            }\n+\n@@ -231,1 +269,1 @@\n-                                    .map(e -> e.getKey() + \"=\\\"\" + e.getValue() + \"\\\"\")\n+                                    .map(e -> e.getKey() + \"=\" + e.getValue().valueString())\n","filename":"make\/jdk\/src\/classes\/build\/tools\/taglet\/SealedGraph.java","additions":53,"deletions":15,"binary":false,"changes":68,"status":"modified"}]}