{"files":[{"patch":"@@ -1233,0 +1233,4 @@\n+    \/* Setting this flag is needed by findThread(). It's ok to set it before\n+       the callbacks are cleared.*\/\n+    gdata->jvmtiCallBacksCleared = JNI_TRUE;\n+\n@@ -1242,4 +1246,0 @@\n-    \/* Setting this flag is needed for a very special case. See the reference in findThread(). *\/\n-    gdata->handlingVMDeath = JNI_TRUE;\n-\n-\n@@ -1300,2 +1300,0 @@\n-    gdata->handlingVMDeath = JNI_FALSE;\n-\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/eventHandler.c","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -271,2 +271,3 @@\n-         * The end result of all this is that if the TLS lookup failed, we still need to\n-         * check if the thread is on runningThreads, but only if we are handling VM_DEATH.\n+         * The end result of all this is that if the TLS lookup failed, we still need to check\n+         * if the thread is on runningThreads, but only if JVMTI callbacks have been cleared.\n+         * Otherwise the thread should not be on the runningThreads.\n@@ -274,2 +275,2 @@\n-        if ( !gdata->handlingVMDeath ) {\n-            \/* The thread better not be on runningThreads is the TLS lookup failed. *\/\n+        if ( !gdata->jvmtiCallBacksCleared ) {\n+            \/* The thread better not be on runningThreads if the TLS lookup failed. *\/\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/threadControl.c","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -139,2 +139,2 @@\n-    \/* Indication that we are currently handling VM_DEATH event. *\/\n-    jboolean handlingVMDeath;\n+    \/* Indication that VM_DEATH has been recieved and the JVMTI callbacks have been cleared. *\/\n+    volatile jboolean jvmtiCallBacksCleared;\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/util.h","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}