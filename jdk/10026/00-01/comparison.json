{"files":[{"patch":"@@ -105,3 +105,3 @@\n-    private static final double ZOOM_MAX_FACTOR = 4.0d;\n-    private static final double ZOOM_MIN_FACTOR = 0.1d;\n-    private static final double ZOOM_INCREMENT = 1.2d;\n+    private static final double ZOOM_MAX_FACTOR = 4.0;\n+    private static final double ZOOM_MIN_FACTOR = 0.1;\n+    private static final double ZOOM_INCREMENT = 1.2;\n@@ -155,0 +155,6 @@\n+    private double getZoomToFitFactor() {\n+        double factorWidth = getScrollPane().getViewport().getViewRect().getWidth() \/ getBounds().getWidth() ;\n+        double factorHeight = getScrollPane().getViewport().getViewRect().getHeight() \/ getBounds().getHeight();\n+        return Math.min(factorWidth, factorHeight);\n+    }\n+\n@@ -156,11 +162,3 @@\n-        double zoomToFit = getScrollPane().getHeight() \/ getBounds().getHeight();\n-        double zoomToFitWidth = getScrollPane().getWidth() \/ getBounds().getWidth();\n-        if (zoomToFitWidth < zoomToFit) {\n-            zoomToFit = zoomToFitWidth;\n-        }\n-        zoomToFit *= 0.95;\n-        if (zoomToFit < this.ZOOM_MIN_FACTOR) {\n-            zoomToFit = this.ZOOM_MIN_FACTOR;\n-        } else if (zoomToFit > 1.0) {\n-            zoomToFit = 1.0;\n-        }\n+        double zoomToFit = 0.98 * this.getZoomToFitFactor();\n+        zoomToFit = Math.max(zoomToFit, this.ZOOM_MIN_FACTOR);\n+        zoomToFit = Math.min(zoomToFit, 1.0);\n@@ -196,1 +194,1 @@\n-        this.zoomAnimator.animateZoomFactor((double)percentage \/ 100.0d, null);\n+        this.zoomAnimator.animateZoomFactor((double)percentage \/ 100.0, null);\n@@ -200,7 +198,0 @@\n-        double zoomFactor = this.getZoomFactor() * zoomMultiplier;\n-        if (zoomFactor < this.getZoomMinFactor()) {\n-            zoomFactor = this.getZoomMinFactor();\n-        } else if (zoomFactor > this.getZoomMaxFactor()) {\n-            zoomFactor = this.getZoomMaxFactor();\n-        }\n-\n@@ -212,0 +203,3 @@\n+        double zoomFactor = this.getZoomFactor() * zoomMultiplier;\n+        zoomFactor = Math.max(zoomFactor, this.getZoomMinFactor());\n+        zoomFactor = Math.min(zoomFactor,  this.getZoomMaxFactor());\n@@ -227,5 +221,2 @@\n-        if (zoomFactor < this.getZoomMinFactor()) {\n-            zoomFactor = this.getZoomMinFactor();\n-        } else if (zoomFactor > this.getZoomMaxFactor()) {\n-            zoomFactor = this.getZoomMaxFactor();\n-        }\n+        zoomFactor = Math.max(zoomFactor, this.getZoomMinFactor());\n+        zoomFactor = Math.min(zoomFactor,  this.getZoomMaxFactor());\n@@ -237,1 +228,0 @@\n-\n@@ -1091,16 +1081,5 @@\n-    private Point calcCenter(Rectangle r) {\n-\n-        Point center = new Point((int) r.getCenterX(), (int) r.getCenterY());\n-        center.x -= getScrollPane().getViewport().getViewRect().width \/ 2;\n-        center.y -= getScrollPane().getViewport().getViewRect().height \/ 2;\n-\n-        \/\/ Ensure to be within area\n-        center.x = Math.max(0, center.x);\n-        center.x = Math.min(getScrollPane().getViewport().getViewSize().width - getScrollPane().getViewport().getViewRect().width, center.x);\n-        center.y = Math.max(0, center.y);\n-        center.y = Math.min(getScrollPane().getViewport().getViewSize().height - getScrollPane().getViewport().getViewRect().height, center.y);\n-\n-        return center;\n-    }\n-\n-    private void centerRectangle(Rectangle r) {\n+    private void centerRectangle(Rectangle rect) {\n+        Rectangle oldViewRect = this.convertSceneToView(rect);\n+        \/\/ calculate the center\n+        Point zoomCenter = new Point(oldViewRect.width \/ 2, oldViewRect.height \/ 2);\n+        Point oldViewCenter = this.convertSceneToView(zoomCenter);\n@@ -1108,20 +1087,6 @@\n-        if (getScrollPane().getViewport().getViewRect().width == 0 || getScrollPane().getViewport().getViewRect().height == 0) {\n-            return;\n-        }\n-\n-        Rectangle r2 = new Rectangle(r.x, r.y, r.width, r.height);\n-        r2 = convertSceneToView(r2);\n-\n-        double factorX = (double) r2.width \/ (double) getScrollPane().getViewport().getViewRect().width;\n-        double factorY = (double) r2.height \/ (double) getScrollPane().getViewport().getViewRect().height;\n-        double factor = Math.max(factorX, factorY);\n-        if (factor >= 1.0) {\n-            Point p = getScrollPane().getViewport().getViewPosition();\n-            setZoomFactor(getZoomFactor() \/ factor);\n-            r2.x \/= factor;\n-            r2.y \/= factor;\n-            r2.width \/= factor;\n-            r2.height \/= factor;\n-            getScrollPane().getViewport().setViewPosition(calcCenter(r2));\n-        } else {\n-            getScrollPane().getViewport().setViewPosition(calcCenter(r2));\n+        double factorWidth = getScrollPane().getViewport().getViewRect().getWidth() \/ oldViewRect.getWidth() ;\n+        double factorHeight = getScrollPane().getViewport().getViewRect().getHeight() \/ oldViewRect.getHeight();\n+        double zoomFactor = Math.min(factorWidth, factorHeight);\n+        if (zoomFactor < 1.0) {\n+            this.setZoomFactor(getZoomFactor() * zoomFactor);\n+            this.validate();\n@@ -1129,0 +1094,8 @@\n+        Point newViewCenter = this.convertSceneToView(zoomCenter);\n+        Rectangle newVisibleRect = new Rectangle (\n+                newViewCenter.x - (oldViewCenter.x - oldViewRect.x),\n+                newViewCenter.y - (oldViewCenter.y - oldViewRect.y),\n+                oldViewRect.width,\n+                oldViewRect.height\n+        );\n+        this.getView().scrollRectToVisible(newVisibleRect);\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/DiagramScene.java","additions":37,"deletions":64,"binary":false,"changes":101,"status":"modified"}]}