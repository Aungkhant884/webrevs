{"files":[{"patch":"@@ -26,0 +26,1 @@\n+import java.awt.EventQueue;\n@@ -28,0 +29,1 @@\n+import javax.swing.JViewport;\n@@ -35,0 +37,2 @@\n+    private volatile double oldZoom;\n+    private volatile Rectangle visibleRect;\n@@ -52,0 +56,2 @@\n+            this.oldZoom = this.sourceZoom;\n+            this.visibleRect = this.getScene().getView().getVisibleRect();\n@@ -64,4 +70,1 @@\n-    public void tick(double progress) {\n-        Rectangle oldVisibleRect = this.getScene().getView().getVisibleRect();\n-        Point oldViewCenter = this.getScene().convertSceneToView(this.zoomCenter);\n-\n+    private synchronized void do_tick(double progress) {\n@@ -72,8 +75,14 @@\n-        Point newViewCenter = this.getScene().convertSceneToView(this.zoomCenter);\n-        Rectangle newVisibleRect = new Rectangle (\n-                newViewCenter.x - (oldViewCenter.x - oldVisibleRect.x),\n-                newViewCenter.y - (oldViewCenter.y - oldVisibleRect.y),\n-                oldVisibleRect.width,\n-                oldVisibleRect.height\n-        );\n-        this.getScene().getView().scrollRectToVisible(newVisibleRect);\n+        Point location = this.getScene().getLocation();\n+        visibleRect.x += (int)(newZoom * (double)(location.x + this.zoomCenter.x)) - (int)(this.oldZoom * (double)(location.x + this.zoomCenter.x));\n+        visibleRect.y += (int)(newZoom * (double)(location.y + this.zoomCenter.y)) - (int)(this.oldZoom * (double)(location.y + this.zoomCenter.y));\n+\n+        \/\/ Ensure to be within area\n+        visibleRect.x = Math.max(0, visibleRect.x);\n+        visibleRect.y = Math.max(0, visibleRect.y);\n+\n+        this.getScene().getView().scrollRectToVisible(visibleRect);\n+        this.oldZoom = newZoom;\n+    }\n+\n+    public void tick(double progress) {\n+        EventQueue.invokeLater(()->this.do_tick(progress));\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/CustomZoomAnimator.java","additions":21,"deletions":12,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -107,1 +107,1 @@\n-    private static final double ZOOM_INCREMENT = 1.2;\n+    private static final double ZOOM_INCREMENT = 1.3;\n@@ -194,1 +194,1 @@\n-        Rectangle visibleRect = this.getScene().getView().getVisibleRect();\n+        Rectangle visibleRect = this.getView().getVisibleRect();\n@@ -196,1 +196,1 @@\n-        zoomCenter = this.getScene().convertViewToScene(zoomCenter);\n+        zoomCenter = this.convertViewToScene(zoomCenter);\n@@ -201,4 +201,1 @@\n-        Rectangle oldVisibleRect = this.getView().getVisibleRect();\n-        Point zoomCenter = new Point(oldVisibleRect.x + oldVisibleRect.width \/ 2, oldVisibleRect.y + oldVisibleRect.height \/ 2);\n-        zoomCenter = this.convertViewToScene(zoomCenter);\n-        Point oldViewCenter = this.convertSceneToView(zoomCenter);\n+        Rectangle visibleRect = this.getView().getVisibleRect();\n@@ -206,4 +203,5 @@\n-        double zoomFactor = this.getZoomFactor() * zoomMultiplier;\n-        zoomFactor = Math.max(zoomFactor, this.getZoomMinFactor());\n-        zoomFactor = Math.min(zoomFactor,  this.getZoomMaxFactor());\n-        this.setZoomFactor(zoomFactor);\n+        double oldZoom = this.getZoomFactor();\n+        double newZoom = oldZoom * zoomMultiplier;\n+        newZoom = Math.max(newZoom, this.getZoomMinFactor());\n+        newZoom = Math.min(newZoom,  this.getZoomMaxFactor());\n+        this.setZoomFactor(newZoom);\n@@ -212,8 +210,6 @@\n-        Point newViewCenter = this.convertSceneToView(zoomCenter);\n-        Rectangle newVisibleRect = new Rectangle (\n-                newViewCenter.x - (oldViewCenter.x - oldVisibleRect.x),\n-                newViewCenter.y - (oldViewCenter.y - oldVisibleRect.y),\n-                oldVisibleRect.width,\n-                oldVisibleRect.height\n-        );\n-        this.getView().scrollRectToVisible(newVisibleRect);\n+        Point zoomCenter = new Point(visibleRect.x + visibleRect.width \/ 2, visibleRect.y + visibleRect.height \/ 2);\n+        visibleRect.x += (int)(newZoom \/ oldZoom * (double)zoomCenter.x) - zoomCenter.x;\n+        visibleRect.y += (int)(newZoom \/ oldZoom * (double)zoomCenter.y) - zoomCenter.y;\n+\n+        this.getView().scrollRectToVisible(visibleRect);\n+        this.validate();\n","filename":"src\/utils\/IdealGraphVisualizer\/View\/src\/main\/java\/com\/sun\/hotspot\/igv\/view\/DiagramScene.java","additions":15,"deletions":19,"binary":false,"changes":34,"status":"modified"}]}