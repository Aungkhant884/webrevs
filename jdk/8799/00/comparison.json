{"files":[{"patch":"@@ -412,0 +412,22 @@\n+    \/\/ Helper method for calling FileChannel.transferFrom and checking the\n+    \/\/ return value.\n+    private static void transferFrom(FileChannel inputChannel,\n+                                     FileChannel outputChannel,\n+                                     long offset,\n+                                     long length) throws Exception {\n+        long position = offset;\n+        long count = length;\n+        long n = count;\n+        \/\/ The count != offset check is for handling the case where the length\n+        \/\/ of the outputChannel is shorter than the inputChannel.\n+        while (count > 0 && n > 0 && count != offset) {\n+            n = (long)outputChannel.transferFrom(inputChannel, position, count);\n+            if (n < 0 || n > count) {\n+                throw new RuntimeException(\"Incorrect transfer length n = \" + n\n+                                           + \" (expected 0 <= n <= \" + length + \")\");\n+            }\n+            position += n;\n+            count -= n;\n+        }\n+    }\n+\n@@ -419,1 +441,1 @@\n-            outputChannel.transferFrom(inputChannel, 0, offset);\n+            transferFrom(inputChannel, outputChannel, 0, offset);\n@@ -422,1 +444,1 @@\n-            outputChannel.transferFrom(inputChannel, offset + bytes.length, orgSize - bytes.length);\n+            transferFrom(inputChannel, outputChannel, offset + bytes.length, orgSize - bytes.length);\n@@ -434,1 +456,1 @@\n-            outputChannel.transferFrom(inputChannel, 0, offset);\n+            transferFrom(inputChannel, outputChannel, 0, offset);\n@@ -436,1 +458,2 @@\n-            outputChannel.transferFrom(inputChannel, offset, orgSize - nBytes);\n+            long length = orgSize - nBytes;\n+            transferFrom(inputChannel, outputChannel, offset, orgSize - nBytes);\n","filename":"test\/lib\/jdk\/test\/lib\/cds\/CDSArchiveUtils.java","additions":27,"deletions":4,"binary":false,"changes":31,"status":"modified"}]}