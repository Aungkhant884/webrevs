{"files":[{"patch":"@@ -1330,0 +1330,13 @@\n+     *\n+     * <p> If the underlying class is an array class, then its\n+     * {@code PUBLIC}, {@code PRIVATE} and {@code PROTECTED}\n+     * access flags are the same as those of its component type.  If this\n+     * {@code Class} object represents a primitive type or void, the\n+     * {@code PUBLIC} access flag is present, and the\n+     * {@code PROTECTED} and {@code PRIVATE} access flags are always\n+     * absent. If this {@code Class} object represents an array class, a\n+     * primitive type or void, then the {@code FINAL} access flag is always\n+     * present and the interface access flag is always\n+     * absent. The values of its other access flags are not determined\n+     * by this specification.\n+     *\n@@ -1342,1 +1355,2 @@\n-                                            (isMemberClass() || isLocalClass() || isAnonymousClass()) ?\n+                                            (isMemberClass() || isLocalClass() ||\n+                                             isAnonymousClass() || isArray()) ?\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Class.java","additions":15,"deletions":1,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import java.util.*;\n@@ -50,0 +51,2 @@\n+        checkPrimitives();\n+        checkArrays();\n@@ -65,0 +68,85 @@\n+    private static void checkPrimitives() {\n+        final Class<?>[] primitives = {\n+            byte.class,\n+            int.class,\n+            long.class,\n+            short.class,\n+            char.class,\n+            float.class,\n+            double.class,\n+            boolean.class,\n+            void.class \/\/ same access flag rules\n+        };\n+\n+        var mustBePresent = Set.of(AccessFlag.PUBLIC, AccessFlag.FINAL);\n+        var mustBeAbsent = Set.of(AccessFlag.PRIVATE,\n+                                  AccessFlag.PROTECTED,\n+                                  AccessFlag.INTERFACE);\n+\n+        for(var primClass : primitives) {\n+            \/\/ PUBLIC must be present, PROTECTED and PRIVATE must be\n+            \/\/ absent.\n+            \/\/ FINAL must be present, INTERFACE must be absent.\n+            var accessFlags = primClass.accessFlags();\n+            if (!accessFlags.containsAll(mustBePresent)) {\n+                throw new RuntimeException(\"Missing mandatory flags on \" +\n+                                           primClass);\n+            }\n+\n+            if (containsAny(accessFlags, mustBeAbsent)) {\n+                throw new RuntimeException(\"Unexpected flags present on \" +\n+                                           primClass);\n+            }\n+        }\n+    }\n+\n+    private static boolean containsAny(Set<AccessFlag> input,\n+                                       Set<AccessFlag> test) {\n+        var copy = new HashSet<>(input);\n+        return copy.removeAll(test);\n+    }\n+\n+    private static void checkArrays() {\n+        Class<?>[] accessClasses = {\n+            PublicInterface.class,\n+            ProtectedInterface.class,\n+            PrivateInterface.class,\n+        };\n+\n+        for (var accessClass : accessClasses) {\n+            AccessFlag accessLevel;\n+            var flags = accessClass.accessFlags();\n+            if (flags.contains(AccessFlag.PUBLIC))\n+                accessLevel = AccessFlag.PUBLIC;\n+            else if (flags.contains(AccessFlag.PROTECTED))\n+                accessLevel = AccessFlag.PROTECTED;\n+            else if (flags.contains(AccessFlag.PRIVATE))\n+                accessLevel = AccessFlag.PRIVATE;\n+            else\n+                accessLevel = null;\n+\n+            var arrayClass = accessClass.arrayType();\n+            \/\/ Access modifier must match on the array type\n+            if (accessLevel != null) {\n+                if (!arrayClass.accessFlags().contains(accessLevel)) {\n+                    throw new RuntimeException(\"Mismatched access flags on \" +\n+                                               arrayClass);\n+                }\n+            } else {\n+                if (containsAny(arrayClass.accessFlags(),\n+                                Set.of(AccessFlag.PUBLIC,\n+                                       AccessFlag.PROTECTED,\n+                                       AccessFlag.PRIVATE))) {\n+                    throw new RuntimeException(\"Unexpected access flags on \" +\n+                                               arrayClass);\n+                }\n+            }\n+        }\n+\n+    }\n+\n+    public      interface PublicInterface {}\n+    protected   interface ProtectedInterface {}\n+    private     interface PrivateInterface {}\n+    \/*package*\/ interface PackageInterface {}\n+\n","filename":"test\/jdk\/java\/lang\/reflect\/AccessFlag\/ClassAccessFlagTest.java","additions":88,"deletions":0,"binary":false,"changes":88,"status":"modified"}]}