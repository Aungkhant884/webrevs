{"files":[{"patch":"@@ -173,0 +173,3 @@\n+void* os::Linux::_mallinfo_fun_ptr = NULL;\n+void* os::Linux::_mallinfo2_fun_ptr = NULL;\n+\n@@ -2232,1 +2235,0 @@\n-  void* mallinfo_ptr = NULL;\n@@ -2234,0 +2236,1 @@\n+  bool called_mallinfo = false;\n@@ -2236,3 +2239,3 @@\n-  mallinfo_ptr = dlsym(RTLD_DEFAULT, \"mallinfo2\");\n-  if (mallinfo_ptr != NULL) {\n-    struct mallinfo2 mi = CAST_TO_FN_PTR(struct mallinfo2 (*)(void), mallinfo_ptr)();\n+  if (_mallinfo2_fun_ptr != NULL) {\n+    called_mallinfo = true;\n+    struct mallinfo2 mi = CAST_TO_FN_PTR(struct mallinfo2 (*)(void), _mallinfo2_fun_ptr)();\n@@ -2242,13 +2245,11 @@\n-  if (mallinfo_ptr == NULL) {\n-    mallinfo_ptr = dlsym(RTLD_DEFAULT, \"mallinfo\");\n-    if (mallinfo_ptr != NULL) {\n-      \/\/ mallinfo is an old API. Member names mean next to nothing and, beyond that, are int.\n-      \/\/ So values may have wrapped around. Still useful enough to see how much glibc thinks\n-      \/\/ we allocated.\n-      struct mallinfo mi = CAST_TO_FN_PTR(struct mallinfo (*)(void), mallinfo_ptr)();\n-      total_allocated = (size_t)(unsigned)mi.uordblks;\n-      \/\/ Since mallinfo members are int, glibc values may have wrapped. Warn about this.\n-      might_have_wrapped = (vmrss * K) > UINT_MAX && (vmrss * K) > (total_allocated + UINT_MAX);\n-    }\n-  }\n-  if (mallinfo_ptr != NULL) {\n+  if (!called_mallinfo && _mallinfo_fun_ptr != NULL) {\n+    called_mallinfo = true;\n+    \/\/ mallinfo is an old API. Member names mean next to nothing and, beyond that, are int.\n+    \/\/ So values may have wrapped around. Still useful enough to see how much glibc thinks\n+    \/\/ we allocated.\n+    struct mallinfo mi = CAST_TO_FN_PTR(struct mallinfo (*)(void), _mallinfo_fun_ptr)();\n+    total_allocated = (size_t)(unsigned)mi.uordblks;\n+    \/\/ Since mallinfo members are int, glibc values may have wrapped. Warn about this.\n+    might_have_wrapped = (vmrss * K) > UINT_MAX && (vmrss * K) > (total_allocated + UINT_MAX);\n+  }\n+  if (called_mallinfo) {\n@@ -4423,0 +4424,3 @@\n+  Linux::_mallinfo_fun_ptr = dlsym(RTLD_DEFAULT, \"mallinfo\");\n+  Linux::_mallinfo2_fun_ptr = dlsym(RTLD_DEFAULT, \"mallinfo2\");\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":21,"deletions":17,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -256,0 +256,3 @@\n+  static void* _mallinfo_fun_ptr;\n+  static void* _mallinfo2_fun_ptr;\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}