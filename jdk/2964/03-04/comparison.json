{"files":[{"patch":"@@ -173,2 +173,4 @@\n-void* os::Linux::_mallinfo_fun_ptr = NULL;\n-void* os::Linux::_mallinfo2_fun_ptr = NULL;\n+#ifdef __GLIBC__\n+os::Linux::mallinfo_func_t os::Linux::_mallinfo = NULL;\n+os::Linux::mallinfo2_func_t os::Linux::_mallinfo2 = NULL;\n+#endif \/\/ __GLIBC__\n@@ -2236,1 +2238,0 @@\n-  bool called_mallinfo = false;\n@@ -2238,4 +2239,2 @@\n-#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ >= 33)\n-  if (_mallinfo2_fun_ptr != NULL) {\n-    called_mallinfo = true;\n-    struct mallinfo2 mi = CAST_TO_FN_PTR(struct mallinfo2 (*)(void), _mallinfo2_fun_ptr)();\n+  if (_mallinfo2 != NULL) {\n+    struct glibc_mallinfo2 mi = _mallinfo2();\n@@ -2243,4 +2242,1 @@\n-  }\n-#endif \/\/ __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ >= 33)\n-  if (!called_mallinfo && _mallinfo_fun_ptr != NULL) {\n-    called_mallinfo = true;\n+  } else if (_mallinfo != NULL) {\n@@ -2250,1 +2246,1 @@\n-    struct mallinfo mi = CAST_TO_FN_PTR(struct mallinfo (*)(void), _mallinfo_fun_ptr)();\n+    struct glibc_mallinfo mi = _mallinfo();\n@@ -2255,1 +2251,1 @@\n-  if (called_mallinfo) {\n+  if (_mallinfo2 != NULL || _mallinfo != NULL) {\n@@ -4424,2 +4420,4 @@\n-  Linux::_mallinfo_fun_ptr = dlsym(RTLD_DEFAULT, \"mallinfo\");\n-  Linux::_mallinfo2_fun_ptr = dlsym(RTLD_DEFAULT, \"mallinfo2\");\n+#ifdef __GLIBC__\n+  Linux::_mallinfo = CAST_TO_FN_PTR(Linux::mallinfo_func_t, dlsym(RTLD_DEFAULT, \"mallinfo\"));\n+  Linux::_mallinfo2 = CAST_TO_FN_PTR(Linux::mallinfo2_func_t, dlsym(RTLD_DEFAULT, \"mallinfo2\"));\n+#endif \/\/ __GLIBC__\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -256,2 +256,33 @@\n-  static void* _mallinfo_fun_ptr;\n-  static void* _mallinfo2_fun_ptr;\n+#ifdef __GLIBC__\n+  struct glibc_mallinfo {\n+    int arena;\n+    int ordblks;\n+    int smblks;\n+    int hblks;\n+    int hblkhd;\n+    int usmblks;\n+    int fsmblks;\n+    int uordblks;\n+    int fordblks;\n+    int keepcost;\n+  };\n+\n+  struct glibc_mallinfo2 {\n+    size_t arena;\n+    size_t ordblks;\n+    size_t smblks;\n+    size_t hblks;\n+    size_t hblkhd;\n+    size_t usmblks;\n+    size_t fsmblks;\n+    size_t uordblks;\n+    size_t fordblks;\n+    size_t keepcost;\n+  };\n+\n+  typedef struct glibc_mallinfo (*mallinfo_func_t)(void);\n+  typedef struct glibc_mallinfo2 (*mallinfo2_func_t)(void);\n+\n+  static mallinfo_func_t _mallinfo;\n+  static mallinfo2_func_t _mallinfo2;\n+#endif\n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":33,"deletions":2,"binary":false,"changes":35,"status":"modified"}]}