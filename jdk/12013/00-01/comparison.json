{"files":[{"patch":"@@ -133,3 +133,2 @@\n-            try {\n-                if (!sameClient || client == null)\n-                    client = newHttpClient();\n+            if (!sameClient || client == null)\n+                client = newHttpClient();\n@@ -137,14 +136,18 @@\n-                HttpRequest req = HttpRequest.newBuilder(URI.create(uri))\n-                        .build();\n-                BodyHandler<byte[]> handler = new CRSBodyHandler();\n-                HttpResponse<byte[]> response = client.send(req, handler);\n-                byte[] body = response.body();\n-                assertEquals(body, bytes);\n-            } finally {\n-                if (sameClient) continue;\n-                Tracker tracker = TRACKER.getTracker(client);\n-                client = null;\n-                System.gc();\n-                AssertionError error = TRACKER.check(tracker, 1500);\n-                if (error != null) throw error;\n-            }\n+            HttpRequest req = HttpRequest.newBuilder(URI.create(uri))\n+                    .build();\n+            BodyHandler<byte[]> handler = new CRSBodyHandler();\n+            HttpResponse<byte[]> response = client.send(req, handler);\n+            byte[] body = response.body();\n+            assertEquals(body, bytes);\n+\n+            \/\/ if sameClient we will reuse the client for the next\n+            \/\/ operation, so there's nothing more to do.\n+            if (sameClient) continue;\n+\n+            \/\/ if no error and not same client then wait for the\n+            \/\/ client to be GC'ed before performing the nex operation\n+            Tracker tracker = TRACKER.getTracker(client);\n+            client = null;\n+            System.gc();\n+            AssertionError error = TRACKER.check(tracker, 1500);\n+            if (error != null) throw error; \/\/ the client didn't shut down properly\n@@ -157,1 +160,1 @@\n-            if (error != null) throw error;\n+            if (error != null) throw error; \/\/ the client didn't shut down properly\n","filename":"test\/jdk\/java\/net\/httpclient\/MappingResponseSubscriber.java","additions":21,"deletions":18,"binary":false,"changes":39,"status":"modified"}]}