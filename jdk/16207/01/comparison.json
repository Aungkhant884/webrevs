{"files":[{"patch":"@@ -544,1 +544,3 @@\n-        return StreamEncoder.forEncoder(ch, enc.reset(), minBufferCap);\n+        Objects.requireNonNull(enc, \"enc\");\n+        return StreamEncoder.forOutputStreamWriter(newOutputStream(ch),\n+            new Object(), enc.reset());\n","filename":"src\/java.base\/share\/classes\/java\/nio\/channels\/Channels.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-import java.nio.channels.WritableByteChannel;\n@@ -82,11 +81,0 @@\n-\n-    \/\/ Factory for java.nio.channels.Channels.newWriter\n-\n-    public static StreamEncoder forEncoder(WritableByteChannel ch,\n-                                           CharsetEncoder enc,\n-                                           int minBufferCap)\n-    {\n-        return new StreamEncoder(ch, enc, minBufferCap);\n-    }\n-\n-\n@@ -255,1 +243,1 @@\n-    \/\/ Exactly one of these is non-null\n+    \/\/ This must be non-null\n@@ -257,1 +245,0 @@\n-    private final WritableByteChannel ch;\n@@ -274,1 +261,0 @@\n-        this.ch = null;\n@@ -282,15 +268,0 @@\n-    private StreamEncoder(WritableByteChannel ch, CharsetEncoder enc, int mbc) {\n-        this.out = null;\n-        this.ch = ch;\n-        this.cs = enc.charset();\n-        this.encoder = enc;\n-\n-        if (mbc > 0) {\n-            this.bb = ByteBuffer.allocate(mbc);\n-            this.maxBufferCapacity = mbc;\n-        } else {\n-            this.bb = ByteBuffer.allocate(INITIAL_BYTE_BUFFER_CAPACITY);\n-            this.maxBufferCapacity = MAX_BYTE_BUFFER_CAPACITY;\n-        }\n-    }\n-\n@@ -305,6 +276,1 @@\n-            if (ch != null) {\n-                int wc = ch.write(bb);\n-                assert wc == rem : rem;\n-            } else {\n-                out.write(bb.array(), bb.arrayOffset() + pos, rem);\n-            }\n+            out.write(bb.array(), bb.arrayOffset() + pos, rem);\n@@ -417,1 +383,1 @@\n-        try (ch; out) {\n+        try (out) {\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/cs\/StreamEncoder.java","additions":3,"deletions":37,"binary":false,"changes":40,"status":"modified"}]}