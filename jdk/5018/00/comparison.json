{"files":[{"patch":"@@ -551,2 +551,7 @@\n-                if (node.errs != null && node.errs.nonEmpty())\n-                    return getStartPos(node.errs.head);\n+                if (node.errs != null && node.errs.nonEmpty()) {\n+                    int pos = getStartPos(node.errs.head);\n+                    if (pos != Position.NOPOS) {\n+                        return pos;\n+                    }\n+                }\n+                break;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/tree\/TreeInfo.java","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 7073631 7159445 7156633 8028235 8065753 8205418 8205913 8228451 8237041 8253584 8246774 8256411 8256149 8259050 8266436 8267221\n+ * @bug 7073631 7159445 7156633 8028235 8065753 8205418 8205913 8228451 8237041 8253584 8246774 8256411 8256149 8259050 8266436 8267221 8271928\n@@ -1798,0 +1798,25 @@\n+    @Test \/\/JDK-8271928\n+    void testX() throws IOException {\n+        String code = \"\"\"\n+                      package test;\n+                          public static void test() {\n+                              return test;\n+                          }\n+                      \"\"\";\n+\n+        JavacTaskImpl ct = (JavacTaskImpl) tool.getTask(null, fm, null,\n+                null, null, Arrays.asList(new MyFileObject(code)));\n+        CompilationUnitTree cut = ct.parse().iterator().next();\n+        SourcePositions sp = Trees.instance(ct).getSourcePositions();\n+        new TreePathScanner<Void, Void>() {\n+            @Override\n+            public Void visitErroneous(ErroneousTree tree, Void p) {\n+                int pos = (int) sp.getStartPosition(cut, tree);\n+                if (pos == (-1)) {\n+                    fail(\"Invalid source position for an ErroneousTree\");\n+                }\n+                return scan(tree.getErrorTrees(), p);\n+            }\n+        }.scan(cut, null);\n+    }\n+\n","filename":"test\/langtools\/tools\/javac\/parser\/JavacParserTest.java","additions":26,"deletions":1,"binary":false,"changes":27,"status":"modified"}]}