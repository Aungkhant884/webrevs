{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2012, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,3 +25,2 @@\n- *\n- *\n- * @bug     6336608 6511738\n+ * @test\n+ * @bug     6336608 6511738 6367473\n@@ -30,0 +29,4 @@\n+ *\n+ * @library \/test\/lib\n+ *\n+ * @run testng GetSystemLoadAverage\n@@ -45,0 +48,3 @@\n+import jdk.test.lib.Platform;\n+import org.testng.annotations.Test;\n+\n@@ -55,1 +61,1 @@\n-    private static double DELTA = 0.05;\n+    private static final double DELTA = 0.05;\n@@ -57,4 +63,2 @@\n-    public static void main(String args[]) throws Exception {\n-        if (args.length > 1)  {\n-            throw new IllegalArgumentException(\"Unexpected number of args \" + args.length);\n-        }\n+    private static final int MAX_RETRIES = 5;\n+    private static final int WAIT_TIME_MS = 5000;\n@@ -62,13 +66,31 @@\n-        if (args.length == 0) {\n-            \/\/ On Linux or Solaris\n-            checkLoadAvg();\n-        } else {\n-            \/\/ On Windows, the system load average is expected to be -1.0\n-            if (!args[0].equals(\"-1.0\")) {\n-                throw new IllegalArgumentException(\"Invalid argument: \" + args[0]);\n-            } else {\n-                double loadavg = mbean.getSystemLoadAverage();\n-                if (loadavg != -1.0) {\n-                    throw new RuntimeException(\"Expected load average : -1.0\" +\n-                        \" but getSystemLoadAverage returned: \" +\n-                        loadavg);\n+    @Test(timeOut = (300 + WAIT_TIME_MS) * MAX_RETRIES)\n+    void testSystemLoadAvg() throws Exception {\n+        for (int i = 1; i <= MAX_RETRIES; i++) {\n+            try {\n+                System.out.println(\n+                        String.format(\"Run %d: TestSystemLoadAvg\", i));\n+                if (!Platform.isWindows()) {\n+                    \/\/ On Linux or Solaris\n+                    checkLoadAvg();\n+                } else {\n+                    \/\/ On Windows, the system load average is expected to be -1.0\n+                    double loadavg = mbean.getSystemLoadAverage();\n+                    if (loadavg != -1.0) {\n+                        throw new RuntimeException(\n+                                \"Expected load average : -1.0\" +\n+                                        \" but getSystemLoadAverage returned: \" +\n+                                        loadavg);\n+                    }\n+                }\n+                System.out.println(\n+                        String.format(\"Run %d: TestSystemLoadAvg test passed\",\n+                                i));\n+                return;\n+            } catch (Exception e) {\n+                System.out.println(\n+                        String.format(\"TEST FAILED: TestSystemLoadAvg test \" +\n+                                        \"failed %d runs\",\n+                                i));\n+                if (i == MAX_RETRIES)\n+                {\n+                    throw e;\n@@ -76,0 +98,3 @@\n+\n+                System.out.println(\"Wait for 5 seconds\");\n+                Thread.sleep(WAIT_TIME_MS);\n@@ -78,2 +103,0 @@\n-\n-        System.out.println(\"Test passed.\");\n","filename":"test\/jdk\/java\/lang\/management\/OperatingSystemMXBean\/GetSystemLoadAverage.java","additions":47,"deletions":24,"binary":false,"changes":71,"status":"modified"},{"patch":"@@ -1,83 +0,0 @@\n-#\n-# Copyright (c) 2005, 2020, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug      6336608 6367473 6511738\n-# @summary  Tests OperatingSystemMXBean.getSystemLoadAverage() api.\n-# @author   Mandy Chung\n-#\n-# @run build GetSystemLoadAverage\n-# @run shell\/timeout=300 TestSystemLoadAvg.sh\n-#\n-\n-#\n-# This test tests the system load average on linux and solaris.\n-# On windows tests if it returns -1.0 The verification is done\n-# by the GetSystemLoadAverage class.  By default it takes no\n-# input argument which verifies the system load average with\n-# \/usr\/bin\/uptime command. Or specify \"-1.0\" as the input argument\n-# indicatiing that the platform doesn't support the system load average.\n-\n-#Set appropriate jdk\n-#\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     jdk=\"$TESTJAVA\"\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-runOne()\n-{\n-   echo \"$TESTJAVA\/bin\/java -classpath $TESTCLASSES $@\"\n-   $TESTJAVA\/bin\/java ${TESTVMOPTS} -classpath $TESTCLASSES $@\n-}\n-\n-# Retry 5 times to be more resilent to system load fluctation.\n-MAX=5\n-i=1\n-while true; do\n-  echo \"Run $i: TestSystemLoadAvg\"\n-  case `uname -s` in\n-       Linux | Darwin | AIX )\n-         runOne GetSystemLoadAverage\n-         ;;\n-      * )\n-         # On Windows -1.0 should be returned\n-         runOne GetSystemLoadAverage \"-1.0\"\n-         ;;\n-  esac\n-  if [ $? -eq 0 ]; then\n-      # exit if the test passes\n-      echo \"Run $i: TestSystemLoadAvg test passed\"\n-      exit 0\n-  elif [ $i -eq $MAX ] ; then\n-      echo \"TEST FAILED: TestSystemLoadAvg test failed $i runs\"\n-      exit 1\n-  fi\n-  i=`expr $i + 1`\n-  # sleep for 5 seconds\n-  sleep 5\n-done\n","filename":"test\/jdk\/java\/lang\/management\/OperatingSystemMXBean\/TestSystemLoadAvg.sh","additions":0,"deletions":83,"binary":false,"changes":83,"status":"deleted"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2004, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +25,1 @@\n+ * @test\n@@ -30,0 +31,32 @@\n+ * @run main InputArgument\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug     4530538\n+ * @summary Basic unit test of RuntimeMXBean.getInputArguments().\n+ *\n+ * @author  Mandy Chung\n+ *\n+ * @run main\/othervm -XX:+UseFastJNIAccessors -Xlog:gc*=debug InputArgument\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug     4530538\n+ * @summary Basic unit test of RuntimeMXBean.getInputArguments().\n+ *\n+ * @author  Mandy Chung\n+ *\n+ * @run main\/othervm -XX:+UseFastJNIAccessors -Xlog:gc*=debug InputArgument\n+ * -XX:+UseFastJNIAccessors\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug     4530538\n+ * @summary Basic unit test of RuntimeMXBean.getInputArguments().\n+ *\n+ * @author  Mandy Chung\n+ *\n+ * @run main\/othervm -Dprops=something InputArgument -Dprops=something\n","filename":"test\/jdk\/java\/lang\/management\/RuntimeMXBean\/InputArgument.java","additions":34,"deletions":1,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -1,55 +0,0 @@\n-#\n-# Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#\n-# @test\n-# @bug     4530538\n-# @summary\n-# @author  Mandy Chung\n-#\n-# @run compile InputArgument.java\n-# @run shell TestInputArgument.sh\n-#\n-\n-#Set appropriate jdk\n-\n-if [ ! -z \"${TESTJAVA}\" ] ; then\n-     jdk=\"$TESTJAVA\"\n-else\n-     echo \"--Error: TESTJAVA must be defined as the pathname of a jdk to test.\"\n-     exit 1\n-fi\n-\n-runOne()\n-{\n-   echo \"runOne $@\"\n-   $TESTJAVA\/bin\/java $TESTVMOPTS -classpath $TESTCLASSES \"$@\" || exit 2\n-}\n-\n-runOne InputArgument\n-\n-runOne -XX:+UseFastJNIAccessors -Xlog:gc*=debug InputArgument\n-runOne -XX:+UseFastJNIAccessors -Xlog:gc*=debug InputArgument -XX:+UseFastJNIAccessors\n-runOne \"-Dprops=one two three\" InputArgument \"-Dprops=one two three\"\n-\n-exit 0\n","filename":"test\/jdk\/java\/lang\/management\/RuntimeMXBean\/TestInputArgument.sh","additions":0,"deletions":55,"binary":false,"changes":55,"status":"deleted"}]}