{"files":[{"patch":"@@ -256,7 +256,0 @@\n-    virtual jlong kernel_memory_usage_in_bytes() = 0;\n-    virtual jlong kernel_memory_limit_in_bytes() = 0;\n-    virtual jlong kernel_memory_max_usage_in_bytes() = 0;\n-\n-    virtual jlong memory_swap_current_in_bytes() = 0;\n-    virtual jlong memory_swap_max_limit_in_bytes() = 0;\n-\n@@ -269,0 +262,2 @@\n+\n+    virtual void print_version_specific_info(outputStream* st) = 0;\n","filename":"src\/hotspot\/os\/linux\/cgroupSubsystem_linux.hpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -198,9 +198,1 @@\n-\/* kernel_memory_usage_in_bytes\n- *\n- * Return the amount of used kernel memory for this process.\n- *\n- * return:\n- *    kernel memory usage in bytes or\n- *    -1 for unlimited\n- *    OSCONTAINER_ERROR for not supported\n- *\/\n+\n@@ -222,8 +214,0 @@\n-\/* kernel_memory_max_usage_in_bytes\n- *\n- * Return the maximum amount of used kernel memory for this process.\n- *\n- * return:\n- *    max kernel memory usage in bytes or\n- *    OSCONTAINER_ERROR for not supported\n- *\/\n@@ -236,3 +220,4 @@\n-jlong CgroupV1Subsystem::memory_swap_current_in_bytes() {\n-  return OSCONTAINER_ERROR;\n-}\n+void CgroupV1Subsystem::print_version_specific_info(outputStream* st) {\n+  jlong kmem_usage = kernel_memory_usage_in_bytes();\n+  jlong kmem_limit = kernel_memory_limit_in_bytes();\n+  jlong kmem_max_usage = kernel_memory_max_usage_in_bytes();\n@@ -240,2 +225,3 @@\n-jlong CgroupV1Subsystem::memory_swap_max_limit_in_bytes() {\n-  return OSCONTAINER_ERROR;\n+  OSContainer::print_container_helper(st, kmem_usage, \"kernel_memory_usage_in_bytes\");\n+  OSContainer::print_container_helper(st, kmem_limit, \"kernel_memory_max_usage_in_bytes\");\n+  OSContainer::print_container_helper(st, kmem_max_usage, \"kernel_memory_limit_in_bytes\");\n@@ -244,1 +230,0 @@\n-\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.cpp","additions":8,"deletions":23,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -87,3 +87,0 @@\n-    jlong memory_swap_current_in_bytes();\n-    jlong memory_swap_max_limit_in_bytes();\n-\n@@ -101,0 +98,2 @@\n+    void print_version_specific_info(outputStream* st);\n+\n","filename":"src\/hotspot\/os\/linux\/cgroupV1Subsystem_linux.hpp","additions":2,"deletions":3,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -195,12 +195,0 @@\n-jlong CgroupV2Subsystem::memory_swap_current_in_bytes() {\n-  char* mem_swp_current_str = mem_swp_current_val();\n-  jlong swap_current = limit_from_str(mem_swp_current_str);\n-  return swap_current;\n-}\n-\n-jlong CgroupV2Subsystem::memory_swap_max_limit_in_bytes() {\n-  char* mem_swp_limit_str = mem_swp_limit_val();\n-  jlong swap_limit = limit_from_str(mem_swp_limit_str);\n-  return swap_limit;\n-}\n-\n@@ -237,4 +225,3 @@\n-\/\/ the kmem (kernel memory limits) are not separately accounted in cgroups v2\n-jlong CgroupV2Subsystem::kernel_memory_usage_in_bytes() {\n-  return OSCONTAINER_ERROR;\n-}\n+void CgroupV2Subsystem::print_version_specific_info(outputStream* st) {\n+  char* mem_swp_current_str = mem_swp_current_val();\n+  jlong swap_current = limit_from_str(mem_swp_current_str);\n@@ -242,3 +229,2 @@\n-jlong CgroupV2Subsystem::kernel_memory_limit_in_bytes() {\n-  return OSCONTAINER_ERROR;\n-}\n+  char* mem_swp_limit_str = mem_swp_limit_val();\n+  jlong swap_limit = limit_from_str(mem_swp_limit_str);\n@@ -246,2 +232,2 @@\n-jlong CgroupV2Subsystem::kernel_memory_max_usage_in_bytes() {\n-  return OSCONTAINER_ERROR;\n+  OSContainer::print_container_helper(st, swap_current, \"memory_swap_current_in_bytes\");\n+  OSContainer::print_container_helper(st, swap_limit, \"memory_swap_max_limit_in_bytes\");\n@@ -250,1 +236,0 @@\n-\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.cpp","additions":7,"deletions":22,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -82,4 +82,0 @@\n-    jlong kernel_memory_usage_in_bytes();\n-    jlong kernel_memory_limit_in_bytes();\n-    jlong kernel_memory_max_usage_in_bytes();\n-\n@@ -91,2 +87,1 @@\n-    jlong memory_swap_current_in_bytes();\n-    jlong memory_swap_max_limit_in_bytes();\n+    void print_version_specific_info(outputStream* st);\n","filename":"src\/hotspot\/os\/linux\/cgroupV2Subsystem_linux.hpp","additions":1,"deletions":6,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -103,1 +103,1 @@\n-jlong OSContainer::kernel_memory_usage_in_bytes() {\n+void OSContainer::print_version_specific_info(outputStream* st) {\n@@ -105,21 +105,1 @@\n-  return cgroup_subsystem->kernel_memory_usage_in_bytes();\n-}\n-\n-jlong OSContainer::kernel_memory_limit_in_bytes() {\n-  assert(cgroup_subsystem != NULL, \"cgroup subsystem not available\");\n-  return cgroup_subsystem->kernel_memory_limit_in_bytes();\n-}\n-\n-jlong OSContainer::kernel_memory_max_usage_in_bytes() {\n-  assert(cgroup_subsystem != NULL, \"cgroup subsystem not available\");\n-  return cgroup_subsystem->kernel_memory_max_usage_in_bytes();\n-}\n-\n-jlong OSContainer::memory_swap_current_in_bytes() {\n-  assert(cgroup_subsystem != NULL, \"cgroup subsystem not available\");\n-  return cgroup_subsystem->memory_swap_current_in_bytes();\n-}\n-\n-jlong OSContainer::memory_swap_max_limit_in_bytes() {\n-  assert(cgroup_subsystem != NULL, \"cgroup subsystem not available\");\n-  return cgroup_subsystem->memory_swap_max_limit_in_bytes();\n+  cgroup_subsystem->print_version_specific_info(st);\n@@ -167,0 +147,13 @@\n+\n+void OSContainer::print_container_helper(outputStream* st, jlong j, const char* metrics) {\n+  st->print(\"%s: \", metrics);\n+  if (j > 0) {\n+    if (j >= 1024) {\n+      st->print_cr(UINT64_FORMAT \" k\", uint64_t(j) \/ 1024);\n+    } else {\n+      st->print_cr(UINT64_FORMAT, uint64_t(j));\n+    }\n+  } else {\n+    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n+  }\n+}\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.cpp","additions":15,"deletions":22,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -46,0 +46,3 @@\n+  static void print_version_specific_info(outputStream* st);\n+  static void print_container_helper(outputStream* st, jlong j, const char* metrics);\n+\n@@ -55,7 +58,0 @@\n-  static jlong kernel_memory_usage_in_bytes();\n-  static jlong kernel_memory_limit_in_bytes();\n-  static jlong kernel_memory_max_usage_in_bytes();\n-\n-  static jlong memory_swap_current_in_bytes();\n-  static jlong memory_swap_max_limit_in_bytes();\n-\n","filename":"src\/hotspot\/os\/linux\/osContainer_linux.hpp","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2207,13 +2207,0 @@\n-static void print_container_helper(outputStream* st, jlong j, const char* metrics) {\n-  st->print(\"%s: \", metrics);\n-  if (j > 0) {\n-    if (j >= 1024) {\n-      st->print_cr(UINT64_FORMAT \" k\", uint64_t(j) \/ 1024);\n-    } else {\n-      st->print_cr(UINT64_FORMAT, uint64_t(j));\n-    }\n-  } else {\n-    st->print_cr(\"%s\", j == OSCONTAINER_ERROR ? \"not supported\" : \"unlimited\");\n-  }\n-}\n-\n@@ -2275,5 +2262,5 @@\n-  print_container_helper(st, OSContainer::memory_limit_in_bytes(), \"memory_limit_in_bytes\");\n-  print_container_helper(st, OSContainer::memory_and_swap_limit_in_bytes(), \"memory_and_swap_limit_in_bytes\");\n-  print_container_helper(st, OSContainer::memory_soft_limit_in_bytes(), \"memory_soft_limit_in_bytes\");\n-  print_container_helper(st, OSContainer::memory_usage_in_bytes(), \"memory_usage_in_bytes\");\n-  print_container_helper(st, OSContainer::memory_max_usage_in_bytes(), \"memory_max_usage_in_bytes\");\n+  OSContainer::print_container_helper(st, OSContainer::memory_limit_in_bytes(), \"memory_limit_in_bytes\");\n+  OSContainer::print_container_helper(st, OSContainer::memory_and_swap_limit_in_bytes(), \"memory_and_swap_limit_in_bytes\");\n+  OSContainer::print_container_helper(st, OSContainer::memory_soft_limit_in_bytes(), \"memory_soft_limit_in_bytes\");\n+  OSContainer::print_container_helper(st, OSContainer::memory_usage_in_bytes(), \"memory_usage_in_bytes\");\n+  OSContainer::print_container_helper(st, OSContainer::memory_max_usage_in_bytes(), \"memory_max_usage_in_bytes\");\n@@ -2281,12 +2268,1 @@\n-  \/\/ the kmem (kernel memory) values are only available in cgroupv1\n-  if (p_ct != NULL && strcmp(p_ct, \"cgroupv1\") == 0) {\n-    print_container_helper(st, OSContainer::kernel_memory_usage_in_bytes(), \"kernel_memory_usage_in_bytes\");\n-    print_container_helper(st, OSContainer::kernel_memory_max_usage_in_bytes(), \"kernel_memory_max_usage_in_bytes\");\n-    print_container_helper(st, OSContainer::kernel_memory_limit_in_bytes(), \"kernel_memory_limit_in_bytes\");\n-  }\n-\n-  \/\/ cgroupv2 specific values\n-  if (p_ct != NULL && strcmp(p_ct, \"cgroupv2\") == 0) {\n-    print_container_helper(st, OSContainer::memory_swap_current_in_bytes(), \"memory_swap_current_in_bytes\");\n-    print_container_helper(st, OSContainer::memory_swap_max_limit_in_bytes(), \"memory_swap_max_limit_in_bytes\");\n-  }\n+  OSContainer::print_version_specific_info(st);\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":6,"deletions":30,"binary":false,"changes":36,"status":"modified"}]}