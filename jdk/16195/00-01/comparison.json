{"files":[{"patch":"@@ -33,2 +33,0 @@\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n@@ -72,6 +70,1 @@\n-        try {\n-            String name = \"\/Users\/egahlin\/DynamicEvent\" + (idCounter.longValue() - 1);\n-            Files.write(Path.of(name + \".class\"), bytes);\n-        } catch (Exception ioe) {\n-\n-        }\n+        Bytecode.log(fullClassName, bytes);\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/EventClassBuilder.java","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -32,1 +32,0 @@\n-import java.lang.reflect.Parameter;\n@@ -51,1 +50,0 @@\n-import jdk.internal.classfile.MethodElement;\n@@ -82,3 +80,3 @@\n-    private static final FieldDesc FIELD_DURATION = FieldDesc.of(Utils.FIELD_DURATION, long.class);\n-    private static final FieldDesc FIELD_EVENT_CONFIGURATION = FieldDesc.of(\"eventConfiguration\", Object.class);;\n-    private static final FieldDesc FIELD_START_TIME = FieldDesc.of(Utils.FIELD_START_TIME, long.class);\n+    private static final FieldDesc FIELD_DURATION = FieldDesc.of(long.class, Utils.FIELD_DURATION);\n+    private static final FieldDesc FIELD_EVENT_CONFIGURATION = FieldDesc.of(Object.class, \"eventConfiguration\");;\n+    private static final FieldDesc FIELD_START_TIME = FieldDesc.of(long.class, Utils.FIELD_START_TIME);\n@@ -201,1 +199,2 @@\n-    private static <T> T annotationValue(ClassModel classModel, ClassDesc classDesc, Class<?> type) {\n+    \/\/ Only supports String and Boolean values\n+    private static <T> T annotationValue(ClassModel classModel, ClassDesc classDesc, Class<T> type) {\n@@ -210,2 +209,7 @@\n-                                if (ae.value() instanceof AnnotationValue.OfString s) {\n-                                    return (T) s.stringValue();\n+                                if (ae.value() instanceof AnnotationValue.OfBoolean ofb && type.equals(Boolean.class)) {\n+                                    Boolean b = ofb.booleanValue();\n+                                    return (T)b;\n+                                }\n+                                if (ae.value() instanceof AnnotationValue.OfString ofs && type.equals(String.class)) {\n+                                    String s = ofs.stringValue();\n+                                    return (T)s;\n@@ -226,1 +230,1 @@\n-            for (MethodElement me : m.elements()) {\n+            for (var me : m.elements()) {\n@@ -251,2 +255,2 @@\n-                                    ClassDesc paramType = mtd.parameterList().getFirst();\n-                                    if (!paramType.isPrimitive()) {\n+                                    ClassDesc type = mtd.parameterList().getFirst();\n+                                    if (type.isClassOrInterface()) {\n@@ -255,1 +259,1 @@\n-                                        settingDescs.add(new SettingDesc(paramType, methodName));\n+                                        settingDescs.add(new SettingDesc(type, methodName));\n@@ -271,3 +275,3 @@\n-                                Parameter param = method.getParameters()[0];\n-                                if (!param.getType().isPrimitive()) {\n-                                    ClassDesc paramType = Bytecode.classDesc(param.getType());\n+                                Class<?> type = method.getParameters()[0].getType();\n+                                if (SettingControl.class.isAssignableFrom(type)) {\n+                                    ClassDesc paramType = Bytecode.classDesc(type);\n@@ -311,1 +315,1 @@\n-                            fieldDescs.add(FieldDesc.of(fieldName, field.getType()));\n+                            fieldDescs.add(FieldDesc.of(field.getType(), fieldName));\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/EventInstrumentation.java","additions":20,"deletions":16,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -58,1 +58,1 @@\n-        public static FieldDesc of(String name, Class<?> type) {\n+        public static FieldDesc of(Class<?> type, String name) {\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/util\/Bytecode.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}