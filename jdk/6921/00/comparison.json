{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -627,23 +627,2 @@\n-  \/\/ print phi functions\n-  bool has_phis_in_locals = false;\n-  bool has_phis_on_stack = false;\n-\n-  if (x->end() && x->end()->state()) {\n-    ValueStack* state = x->state();\n-\n-    int i = 0;\n-    while (!has_phis_on_stack && i < state->stack_size()) {\n-      Value v = state->stack_at_inc(i);\n-      has_phis_on_stack = is_phi_of_block(v, x);\n-    }\n-\n-    do {\n-      for (i = 0; !has_phis_in_locals && i < state->locals_size();) {\n-        Value v = state->local_at(i);\n-        has_phis_in_locals = is_phi_of_block(v, x);\n-        \/\/ also ignore illegal HiWords\n-        if (v && !v->type()->is_illegal()) i += v->type()->size(); else i ++;\n-      }\n-      state = state->caller_state();\n-    } while (state != NULL);\n-\n+  if (!x->end() || !x->end()->state()) {\n+    return;\n@@ -652,14 +631,10 @@\n-  \/\/ print values in locals\n-  if (has_phis_in_locals) {\n-    output()->cr(); output()->print_cr(\"Locals:\");\n-\n-    ValueStack* state = x->state();\n-    do {\n-      for (int i = 0; i < state->locals_size();) {\n-        Value v = state->local_at(i);\n-        if (v) {\n-          print_phi(i, v, x); output()->cr();\n-          \/\/ also ignore illegal HiWords\n-          i += (v->type()->is_illegal() ? 1 : v->type()->size());\n-        } else {\n-          i ++;\n+  \/\/ print values in locals related to phi functions\n+  ValueStack* state = x->state();\n+  bool printed_phis_in_locals_header = false;\n+  do {\n+    for (int i = 0; i < state->locals_size();) {\n+      Value v = state->local_at(i);\n+      if (v && is_phi_of_block(v, x)) {\n+        if (!printed_phis_in_locals_header) {\n+          output()->cr(); output()->print(\"Values in locals related to phi functions:\");\n+          printed_phis_in_locals_header = true;\n@@ -667,0 +642,5 @@\n+        output()->cr(); print_phi(i, v, x);\n+        \/\/ also ignore illegal HiWords\n+        i += (v->type()->is_illegal() ? 1 : v->type()->size());\n+      } else {\n+        i ++;\n@@ -668,14 +648,15 @@\n-      output()->cr();\n-      state = state->caller_state();\n-    } while (state != NULL);\n-  }\n-\n-  \/\/ print values on stack\n-  if (has_phis_on_stack) {\n-    output()->print_cr(\"Stack:\");\n-    int i = 0;\n-    while (i < x->state()->stack_size()) {\n-      int o = i;\n-      Value v = x->state()->stack_at_inc(i);\n-      if (v) {\n-        print_phi(o, v, x); output()->cr();\n+    }\n+    state = state->caller_state();\n+  } while (state != NULL);\n+\n+  \/\/ print values on stack related to phi functions\n+  state = x->state();\n+  bool printed_phis_in_stack_header = false;\n+  int i = 0;\n+  while (i < state->stack_size()) {\n+    int o = i;\n+    Value v = state->stack_at_inc(i);\n+    if (v && is_phi_of_block(v, x)) {\n+      if (!printed_phis_in_stack_header) {\n+        output()->cr(); output()->print(\"Values on stack related to phi functions:\");\n+        printed_phis_in_stack_header = true;\n@@ -683,0 +664,1 @@\n+      output()->cr(); print_phi(o, v, x);\n","filename":"src\/hotspot\/share\/c1\/c1_InstructionPrinter.cpp","additions":34,"deletions":52,"binary":false,"changes":86,"status":"modified"}]}