{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,0 +25,1 @@\n+ * @test\n@@ -29,1 +30,1 @@\n- * @run applet\/manual=yesno InitToBlack.html\n+ * @run main\/manual InitToBlack\n@@ -32,3 +33,18 @@\n-import java.awt.*;\n-import java.awt.print.*;\n-import java.applet.Applet;\n+import java.awt.BorderLayout;\n+import java.awt.Graphics;\n+import java.awt.Graphics2D;\n+import java.awt.print.Book;\n+import java.awt.print.PageFormat;\n+import java.awt.print.Printable;\n+import java.awt.print.PrinterException;\n+import java.awt.print.PrinterJob;\n+import java.lang.reflect.InvocationTargetException;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+import javax.swing.JButton;\n+import javax.swing.JDialog;\n+import javax.swing.JFrame;\n+import javax.swing.JLabel;\n+import javax.swing.JPanel;\n+import javax.swing.JTextArea;\n+import javax.swing.SwingUtilities;\n@@ -36,1 +52,1 @@\n-public class InitToBlack extends Applet implements Printable {\n+public class InitToBlack implements Printable {\n@@ -38,1 +54,17 @@\n-    public void init() {\n+    private static volatile JFrame frame;\n+    private static volatile boolean testResult = false;\n+    private static volatile CountDownLatch printButtonCountDownLatch =\n+            new CountDownLatch(1);\n+    private static volatile CountDownLatch CountDownLatch =\n+            new CountDownLatch(1);\n+    private static volatile String failureReason;\n+\n+    @Override\n+    public int print(Graphics graphics, PageFormat pageFormat, int pageIndex) throws PrinterException {\n+        Graphics2D g2d = (Graphics2D) graphics;\n+        g2d.translate(pageFormat.getImageableX(), pageFormat.getImageableY());\n+        graphics.drawString(\"Test Passes\", 200, 200);\n+        return PAGE_EXISTS;\n+    }\n+\n+    private void test() {\n@@ -40,0 +72,4 @@\n+        if (pjob.getPrintService() == null) {\n+            System.out.println(\"There is no printer configured on this system\");\n+            return;\n+        }\n@@ -52,3 +88,13 @@\n-    public int print(Graphics g, PageFormat pf, int pageIndex) {\n-        Graphics2D g2d = (Graphics2D) g;\n-        g2d.translate(pf.getImageableX(), pf.getImageableY());\n+    private static void createTestUI() {\n+        frame = new JFrame(\"Test InitToBlack\");\n+        String INSTRUCTION = \"\"\"\n+                Aim: This test checks whether the default foreground color on a printer\n+                graphics object is black so that rendering will appear without having\n+                to execute setColor.\n+                Step:\n+                1) Click on the \"Print\" button. Check whether page is printed on the printer.\n+                2) Check whether \"Test Passes\" is printed on the page and it should be in\n+                black color. If yes then press \"Pass\" button else press \"Fail\" button.\n+                \"\"\";\n+        JTextArea instructionTextArea = new JTextArea(INSTRUCTION, 4, 40);\n+        instructionTextArea.setEditable(false);\n@@ -56,1 +102,7 @@\n-        g.drawString(\"Test Passes\", 200, 200);\n+        JPanel buttonPanel = new JPanel();\n+        JButton printButton = new JButton(\"Print\");\n+        printButton.addActionListener((ae) -> {\n+            InitToBlack initToBlack = new InitToBlack();\n+            initToBlack.test();\n+            printButtonCountDownLatch.countDown();\n+        });\n@@ -58,1 +110,52 @@\n-        return PAGE_EXISTS;\n+        JButton passButton = new JButton(\"Pass\");\n+        passButton.addActionListener((ae) -> {\n+            testResult = true;\n+            CountDownLatch.countDown();\n+            frame.dispose();\n+        });\n+        JButton failButton = new JButton(\"Fail\");\n+        failButton.addActionListener((ae) -> {\n+            getFailureReason();\n+            frame.dispose();\n+        });\n+        buttonPanel.add(printButton);\n+        buttonPanel.add(passButton);\n+        buttonPanel.add(failButton);\n+\n+        JPanel panel = new JPanel(new BorderLayout());\n+        panel.add(instructionTextArea, BorderLayout.CENTER);\n+        panel.add(buttonPanel, BorderLayout.SOUTH);\n+\n+        frame.add(panel);\n+        frame.setLocationRelativeTo(null);\n+        frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);\n+        frame.pack();\n+        frame.setVisible(true);\n+    }\n+\n+    public static void getFailureReason() {\n+        final JDialog dialog = new JDialog();\n+        dialog.setTitle(\"Read testcase failure reason\");\n+        JPanel jPanel = new JPanel(new BorderLayout());\n+        JTextArea jTextArea = new JTextArea(5, 20);\n+\n+        JButton okButton = new JButton(\"Ok\");\n+        okButton.addActionListener((ae) -> {\n+            failureReason = jTextArea.getText();\n+            testResult = false;\n+            CountDownLatch.countDown();\n+            dialog.dispose();\n+        });\n+\n+        jPanel.add(new JLabel(\"Enter the testcase failed reason below and \" +\n+                \"click OK button\", JLabel.CENTER), BorderLayout.NORTH);\n+        jPanel.add(jTextArea, BorderLayout.CENTER);\n+\n+        JPanel okayBtnPanel = new JPanel();\n+        okayBtnPanel.add(okButton);\n+\n+        jPanel.add(okayBtnPanel, BorderLayout.SOUTH);\n+        dialog.add(jPanel);\n+        dialog.setLocationRelativeTo(null);\n+        dialog.pack();\n+        dialog.setVisible(true);\n@@ -61,3 +164,16 @@\n-    public static void main(String[] args) {\n-        new InitToBlack().init();\n-        System.exit(0);\n+    public static void main(String[] args) throws InterruptedException, InvocationTargetException {\n+        SwingUtilities.invokeAndWait(InitToBlack::createTestUI);\n+        if (!printButtonCountDownLatch.await(2, TimeUnit.MINUTES)) {\n+            throw new RuntimeException(\"Timeout: User did not perform action \" +\n+                    \"on Print button.\");\n+        }\n+        if (!CountDownLatch.await(2, TimeUnit.MINUTES)) {\n+            throw new RuntimeException(\"Timeout : User did not decided \" +\n+                    \"whether test passed or failed\");\n+        }\n+\n+        if (!testResult) {\n+            throw new RuntimeException(\"Test failed : \" + failureReason);\n+        } else {\n+            System.out.println(\"Test Passed\");\n+        }\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/InitToBlack.java","additions":131,"deletions":15,"binary":false,"changes":146,"status":"modified"}]}