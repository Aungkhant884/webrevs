{"files":[{"patch":"@@ -487,1 +487,1 @@\n-        this(bytes, offset, length, lookupCharset(charsetName));\n+        this(bytes, offset, length, lookupCharset(charsetName), checkBoundsOffCount(offset, length, bytes.length));\n@@ -520,1 +520,0 @@\n-    @SuppressWarnings(\"removal\")\n@@ -522,2 +521,5 @@\n-        Objects.requireNonNull(charset);\n-        checkBoundsOffCount(offset, length, bytes.length);\n+        this(bytes, offset, length, Objects.requireNonNull(charset), checkBoundsOffCount(offset, length, bytes.length));\n+    }\n+\n+    @SuppressWarnings(\"removal\")\n+    private String(byte[] bytes, int offset, int length, Charset charset, Void sig) {\n@@ -1373,1 +1375,1 @@\n-        this(bytes, 0, bytes.length, charsetName);\n+        this(bytes, 0, bytes.length, lookupCharset(charsetName), null);\n@@ -1397,1 +1399,1 @@\n-        this(bytes, 0, bytes.length, charset);\n+        this(bytes, 0, bytes.length, Objects.requireNonNull(charset), null);\n@@ -1427,1 +1429,1 @@\n-        this(bytes, offset, length, Charset.defaultCharset());\n+        this(bytes, offset, length, Charset.defaultCharset(), checkBoundsOffCount(offset, length, bytes.length));\n@@ -1447,1 +1449,1 @@\n-        this(bytes, 0, bytes.length);\n+        this(bytes, 0, bytes.length, Charset.defaultCharset(), null);\n@@ -4589,1 +4591,1 @@\n-    static void checkBoundsOffCount(int offset, int count, int length) {\n+    static Void checkBoundsOffCount(int offset, int count, int length) {\n@@ -4591,0 +4593,1 @@\n+        return null;\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -339,1 +339,1 @@\n-                name = new String(buf, 0, buf.length, UTF_8.INSTANCE);\n+                name = new String(buf, UTF_8.INSTANCE);\n","filename":"src\/java.base\/share\/classes\/java\/util\/jar\/Manifest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -117,1 +117,1 @@\n-        return new String(data, 0, data.length);\n+        return new String(data);\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/text\/html\/parser\/Entity.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -244,1 +244,1 @@\n-            String st = new String(bytes, 0, bytes.length, UTF_16LE);\n+            String st = new String(bytes, UTF_16LE);\n","filename":"src\/java.desktop\/windows\/classes\/sun\/awt\/windows\/WDataTransferer.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -0,0 +1,74 @@\n+\/*\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package micro.org.openjdk.bench.java.lang;\n+\n+import org.openjdk.jmh.annotations.*;\n+\n+import java.nio.charset.StandardCharsets;\n+import java.util.concurrent.TimeUnit;\n+\n+@Fork(5)\n+@State(Scope.Thread)\n+@BenchmarkMode(Mode.AverageTime)\n+@OutputTimeUnit(TimeUnit.NANOSECONDS)\n+@Warmup(iterations = 5, time = 5)\n+@Measurement(iterations = 10, time = 5)\n+public class StringConstructor {\n+  private byte[] array;\n+\n+  @Setup\n+  public void setup() {\n+    array = \"\".getBytes(StandardCharsets.UTF_8);\n+  }\n+\n+  @Benchmark\n+  public String newStringFromArray() {\n+    return new String(array);\n+  }\n+\n+  @Benchmark\n+  public String newStringFromArrayWithCharset() {\n+    return new String(array, StandardCharsets.UTF_8);\n+  }\n+\n+  @Benchmark\n+  public String newStringFromArrayWithCharsetName() throws Exception {\n+    return new String(array, StandardCharsets.UTF_8.name());\n+  }\n+\n+  @Benchmark\n+  public String newStringFromRangedArray() {\n+    return new String(array, 0, 0);\n+  }\n+\n+  @Benchmark\n+  public String newStringFromRangedArrayWithCharset() {\n+    return new String(array, 0, 0, StandardCharsets.UTF_8);\n+  }\n+\n+  @Benchmark\n+  public String newStringFromRangedArrayWithCharsetName() throws Exception {\n+    return new String(array, 0, 0, StandardCharsets.UTF_8.name());\n+  }\n+}\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/StringConstructor.java","additions":74,"deletions":0,"binary":false,"changes":74,"status":"added"}]}