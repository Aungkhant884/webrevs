{"files":[{"patch":"@@ -74,7 +74,0 @@\n-static inline void relativize_one(intptr_t* const vfp, intptr_t* const hfp, int offset) {\n-  assert(*(hfp + offset) == *(vfp + offset), \"\");\n-  intptr_t* addr = hfp + offset;\n-  intptr_t value = *(intptr_t**)addr - vfp;\n-  *addr = value;\n-}\n-\n@@ -93,1 +86,3 @@\n-  relativize_one(vfp, hfp, ijava_idx(esp));\n+  \/\/ Make sure that esp is already relativized.\n+  assert(hf.at_absolute(ijava_idx(esp)) <= hf.at_absolute(ijava_idx(monitors)), \"\");\n+\n@@ -539,5 +534,0 @@\n-static inline void derelativize_one(intptr_t* const fp, int offset) {\n-  intptr_t* addr = fp + offset;\n-  *addr = (intptr_t)(fp + *addr);\n-}\n-\n@@ -550,1 +540,3 @@\n-  derelativize_one(vfp, ijava_idx(esp));\n+  \/\/ Make sure that esp is still relativized.\n+  assert(f.at_absolute(ijava_idx(esp)) <= f.at_absolute(ijava_idx(monitors)), \"\");\n+\n","filename":"src\/hotspot\/cpu\/ppc\/continuationFreezeThaw_ppc.inline.hpp","additions":6,"deletions":14,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -227,1 +227,1 @@\n-  return (intptr_t*) at(ijava_idx(esp));\n+  return (intptr_t*) at_relative(ijava_idx(esp));\n@@ -238,1 +238,6 @@\n-inline void frame::interpreter_frame_set_esp(intptr_t* esp)                   { get_ijava_state()->esp = (intptr_t) esp; }\n+\n+inline void frame::interpreter_frame_set_esp(intptr_t* esp) {\n+  assert(is_interpreted_frame(), \"interpreted frame expected\");\n+  \/\/ set relativized esp\n+  get_ijava_state()->esp = (intptr_t) (esp - fp());\n+}\n@@ -255,1 +260,1 @@\n-  return (intptr_t*)at(ijava_idx(esp)) + Interpreter::stackElementWords;\n+  return interpreter_frame_esp() + Interpreter::stackElementWords;\n","filename":"src\/hotspot\/cpu\/ppc\/frame_ppc.inline.hpp","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2218,1 +2218,3 @@\n-  std(R15_esp, _ijava_state_neg(esp), scratch);\n+  subf(R0, scratch, R15_esp);\n+  sradi(R0, R0, Interpreter::logStackElementSize);\n+  std(R0, _ijava_state_neg(esp), scratch);\n@@ -2248,0 +2250,1 @@\n+    \/\/ Derelativize esp\n@@ -2249,0 +2252,2 @@\n+    sldi(R15_esp, R15_esp, Interpreter::logStackElementSize);\n+    add(R15_esp, R15_esp, scratch);\n","filename":"src\/hotspot\/cpu\/ppc\/interp_masm_ppc_64.cpp","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -1062,1 +1062,3 @@\n-  __ std(R15_esp, _ijava_state_neg(esp), R1_SP);\n+  __ sub(R12_scratch2, R15_esp, R1_SP);\n+  __ sradi(R12_scratch2, R12_scratch2, Interpreter::logStackElementSize);\n+  __ std(R12_scratch2, _ijava_state_neg(esp), R1_SP);\n","filename":"src\/hotspot\/cpu\/ppc\/templateInterpreterGenerator_ppc.cpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}