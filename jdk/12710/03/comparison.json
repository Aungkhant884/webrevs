{"files":[{"patch":"@@ -52,1 +52,0 @@\n-  size_t       _num_chunks;   \/\/ number of unused chunks in pool\n@@ -60,1 +59,1 @@\n-  ChunkPool(size_t size) : _first(nullptr), _num_chunks(0), _size(size) {}\n+  ChunkPool(size_t size) : _first(nullptr), _size(size) {}\n@@ -68,1 +67,0 @@\n-      _num_chunks--;\n@@ -79,1 +77,0 @@\n-    _num_chunks++;\n@@ -84,4 +81,2 @@\n-    static const int blocksToKeep = 5;\n-    Chunk* cur = nullptr;\n-    Chunk* next;\n-    \/\/ if we have more than n chunks, free all of them\n+    \/\/ Free all chunks while in ThreadCritical lock\n+    \/\/ so NMT adjustment is stable.\n@@ -89,9 +84,3 @@\n-    if (_num_chunks > blocksToKeep) {\n-      \/\/ free chunks at end of queue, for better locality\n-      cur = _first;\n-      for (size_t i = 0; i < (blocksToKeep - 1); i++) {\n-        assert(cur != nullptr, \"counter out of sync?\");\n-        cur = cur->next();\n-      }\n-      assert(cur != nullptr, \"counter out of sync?\");\n-\n+    Chunk* cur = _first;\n+    Chunk* next = nullptr;\n+    while (cur != nullptr) {\n@@ -99,1 +88,1 @@\n-      cur->set_next(nullptr);\n+      os::free(cur);\n@@ -101,9 +90,0 @@\n-\n-      \/\/ Free all remaining chunks while in ThreadCritical lock\n-      \/\/ so NMT adjustment is stable.\n-      while(cur != nullptr) {\n-        next = cur->next();\n-        os::free(cur);\n-        _num_chunks--;\n-        cur = next;\n-      }\n@@ -111,0 +91,1 @@\n+    _first = nullptr;\n@@ -138,1 +119,1 @@\n-  enum { CleaningInterval = 5000 };      \/\/ cleaning interval in ms\n+  static const int cleaning_interval = 5000; \/\/ cleaning interval in ms\n@@ -141,1 +122,1 @@\n-   ChunkPoolCleaner() : PeriodicTask(CleaningInterval) {}\n+   ChunkPoolCleaner() : PeriodicTask(cleaning_interval) {}\n","filename":"src\/hotspot\/share\/memory\/arena.cpp","additions":10,"deletions":29,"binary":false,"changes":39,"status":"modified"}]}