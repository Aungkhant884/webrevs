{"files":[{"patch":"@@ -70,0 +70,1 @@\n+  LOG_TAG(deoptimization) \\\n","filename":"src\/hotspot\/share\/logging\/logTag.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -41,0 +41,3 @@\n+#include \"logging\/log.hpp\"\n+#include \"logging\/logLevel.hpp\"\n+#include \"logging\/logMessage.hpp\"\n@@ -1837,0 +1840,9 @@\n+void Deoptimization::print_ul(CompiledMethod* nm, intptr_t pc, frame& fr, const char* name_sig,\n+                              int trap_bci, int osr_bci, const char* reason_name,\n+                              const char* reason_action) {\n+  log_debug(deoptimization)(\n+      \"cid=%d %s pc=\" INTPTR_FORMAT \" relative_pc=\" INTPTR_FORMAT \" level=%d %s @ %d %d %s -> %s\",\n+      nm->compile_id(), (nm->is_osr_method() ? \"%\" : \"\"), pc, fr.pc() - nm->code_begin(),\n+      nm->comp_level(), name_sig, trap_bci, osr_bci, reason_name, reason_action);\n+}\n+\n@@ -1930,6 +1942,15 @@\n-    JFR_ONLY(post_deoptimization_event(nm, trap_method(), trap_bci, trap_bc, reason, action);)\n-\n-    \/\/ Log a message\n-    Events::log_deopt_message(current, \"Uncommon trap: reason=%s action=%s pc=\" INTPTR_FORMAT \" method=%s @ %d %s\",\n-                              trap_reason_name(reason), trap_action_name(action), p2i(fr.pc()),\n-                              trap_method->name_and_sig_as_C_string(), trap_bci, nm->compiler_name());\n+    { \/\/ Log Deoptimization event for JFR, UL and event system\n+      bool is_osr = nm->is_osr_method();\n+      int osr_bci = is_osr ? nm->osr_entry_bci() : -1;\n+      Method* tm = trap_method();\n+      char* name_sig = tm->name_and_sig_as_C_string();\n+      const char* reason_name = trap_reason_name(reason);\n+      const char* reason_action = trap_action_name(action);\n+      intptr_t pc = p2i(fr.pc());\n+\n+      JFR_ONLY(post_deoptimization_event(nm, tm, trap_bci, trap_bc, reason, action);)\n+      print_ul(nm, pc, fr, name_sig, trap_bci, osr_bci, reason_name, reason_action);\n+      Events::log_deopt_message(current, \"Uncommon trap: reason=%s action=%s pc=\" INTPTR_FORMAT \" method=%s @ %d %s\",\n+                                reason_name, reason_action, pc,\n+                                name_sig, trap_bci, nm->compiler_name());\n+    }\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":27,"deletions":6,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -47,1 +47,2 @@\n- public:\n+\n+public:\n@@ -167,0 +168,5 @@\n+\n+  static void print_ul(CompiledMethod* nm, intptr_t pc, frame& fr, const char* name_sig,\n+                       int trap_bci, int osr_bci, const char* reason_name,\n+                       const char* reason_action);\n+\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}