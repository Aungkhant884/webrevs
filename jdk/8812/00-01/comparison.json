{"files":[{"patch":"@@ -1933,13 +1933,20 @@\n-    JFR_ONLY(post_deoptimization_event(nm, trap_method(), trap_bci, trap_bc, reason, action);)\n-\n-    if(Log(deoptimization)::is_info()) {\n-      LogMessage(deoptimization) lm;\n-      auto tm = trap_method();\n-      lm.info(\"Deoptimization start {\");\n-      lm.info(\"  compileId = %d\", nm->compile_id());\n-      lm.info(\"  compiler = %s\", compilertype2name(nm->compiler_type()));\n-      lm.info(\"  method:lineno:bci = %s:%d:%d\", tm->name_and_sig_as_C_string(), tm->line_number_from_bci(trap_bci), trap_bci);\n-      lm.info(\"  instruction = %s\", Bytecodes::name(trap_bc));\n-      lm.info(\"  reason = %s\", Deoptimization::trap_reason_name(reason));\n-      lm.info(\"  action = %s\", Deoptimization::trap_action_name(action));\n-      lm.info(\"} Deoptimization end\");\n+    { \/\/ Log Deoptimization event for JFR, UL and event system\n+      Method* tm = trap_method();\n+      char* name_sig = tm->name_and_sig_as_C_string();\n+      const char* reason_name = Deoptimization::trap_reason_name(reason);\n+      const char* reason_action = Deoptimization::trap_action_name(action);\n+      JFR_ONLY(post_deoptimization_event(nm, tm, trap_bci, trap_bc, reason, action);)\n+      if (Log(deoptimization)::is_info()) {\n+        log_debug(deoptimization)(\"cid: %d osr: %s level: %d %s @ %d %s -> %s\",\n+                                  nm->compile_id(),\n+                                  (nm->is_osr_method() ? \"true\" : \"false\"),\n+                                  nm->comp_level(),\n+                                  name_sig,\n+                                  trap_bci,\n+                                  reason_name,\n+                                  reason_action);\n+        }\n+      \/\/ Log a message\n+      Events::log_deopt_message(current, \"Uncommon trap: reason=%s action=%s pc=\" INTPTR_FORMAT \" method=%s @ %d %s\",\n+                                reason_name, reason_action, p2i(fr.pc()),\n+                                name_sig, trap_bci, nm->compiler_name());\n@@ -1948,5 +1955,0 @@\n-    \/\/ Log a message\n-    Events::log_deopt_message(current, \"Uncommon trap: reason=%s action=%s pc=\" INTPTR_FORMAT \" method=%s @ %d %s\",\n-                              trap_reason_name(reason), trap_action_name(action), p2i(fr.pc()),\n-                              trap_method->name_and_sig_as_C_string(), trap_bci, nm->compiler_name());\n-\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":20,"deletions":18,"binary":false,"changes":38,"status":"modified"}]}