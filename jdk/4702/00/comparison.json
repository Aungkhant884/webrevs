{"files":[{"patch":"@@ -47,0 +47,3 @@\n+    private long processUsageTicks = 0; \/\/ used for process cpu load calculation\n+    private long processTotalTicks = 0; \/\/ used for process cpu load calculation\n+\n@@ -220,0 +223,19 @@\n+    private double getProcessUsageDividesTotal(long usageTicks, long totalTicks) {\n+        if (usageTicks < 0 || totalTicks <= 0) {\n+            return -1;\n+        }\n+        long distance = usageTicks - this.processUsageTicks;\n+        this.processUsageTicks = usageTicks;\n+        long totalDistance = totalTicks - this.processTotalTicks;\n+        this.processTotalTicks = totalTicks;\n+\n+        double processLoad = 0.0;\n+        if (distance > 0 && totalDistance > 0) {\n+            processLoad = ((double)distance) \/ totalDistance;\n+        }\n+        \/\/ Ensure the return value is in the range 0.0 -> 1.0\n+        processLoad = Math.max(0.0, processLoad);\n+        processLoad = Math.min(1.0, processLoad);\n+        return processLoad;\n+    }\n+\n@@ -221,0 +243,19 @@\n+        if (containerMetrics != null) {\n+            long quota = containerMetrics.getCpuQuota();\n+            long share = containerMetrics.getCpuShares();\n+            long usageNanos = getProcessCpuTime();\n+            if (quota > 0) {\n+                long numPeriods = containerMetrics.getCpuNumPeriods();\n+                long quotaNanos = TimeUnit.MICROSECONDS.toNanos(quota * numPeriods);\n+                return getProcessUsageDividesTotal(usageNanos, quotaNanos);\n+            } else if (share > 0) {\n+                long hostTicks = getHostTotalCpuTicks0();\n+                int totalCPUs = getHostOnlineCpuCount0();\n+                int containerCPUs = getAvailableProcessors();\n+                \/\/ scale the total host load to the actual container cpus\n+                hostTicks = hostTicks * containerCPUs \/ totalCPUs;\n+                return getProcessUsageDividesTotal(usageNanos, hostTicks);\n+            } else {\n+                return getProcessCpuLoad0();\n+            }\n+        }\n","filename":"src\/jdk.management\/unix\/classes\/com\/sun\/management\/internal\/OperatingSystemImpl.java","additions":41,"deletions":0,"binary":false,"changes":41,"status":"modified"}]}