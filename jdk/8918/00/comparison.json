{"files":[{"patch":"@@ -196,2 +196,3 @@\n-  assert(preservation_level <= MacroAssembler::PRESERVATION_FRAME_LR,\n-         \"g1_write_barrier_pre doesn't support preservation levels higher than PRESERVATION_FRAME_LR\");\n+  const bool preserve_gp_registers = preservation_level >= MacroAssembler::PRESERVATION_FRAME_LR_GP_REGS;\n+  const bool preserve_fp_registers = preservation_level >= MacroAssembler::PRESERVATION_FRAME_LR_GP_FP_REGS;\n+  int nbytes_save = 0;\n@@ -201,0 +202,7 @@\n+    if (preserve_gp_registers) {\n+      nbytes_save = (MacroAssembler::num_volatile_gp_regs\n+                     + (preserve_fp_registers ? MacroAssembler::num_volatile_fp_regs : 0)\n+                    ) * BytesPerWord;\n+      __ save_volatile_gprs(R1_SP, -nbytes_save, preserve_fp_registers);\n+    }\n+\n@@ -202,1 +210,1 @@\n-    __ push_frame_reg_args(0, tmp2);\n+    __ push_frame_reg_args(nbytes_save, tmp2);\n@@ -205,1 +213,3 @@\n-  if (pre_val->is_volatile() && preloaded) { __ mr(nv_save, pre_val); } \/\/ Save pre_val across C call if it was preloaded.\n+  if (pre_val->is_volatile() && preloaded && !preserve_gp_registers) {\n+    __ mr(nv_save, pre_val); \/\/ Save pre_val across C call if it was preloaded.\n+  }\n@@ -207,1 +217,3 @@\n-  if (pre_val->is_volatile() && preloaded) { __ mr(pre_val, nv_save); } \/\/ restore\n+  if (pre_val->is_volatile() && preloaded && !preserve_gp_registers) {\n+    __ mr(pre_val, nv_save); \/\/ restore\n+  }\n@@ -212,0 +224,4 @@\n+\n+    if (preserve_gp_registers) {\n+      __ restore_volatile_gprs(R1_SP, -nbytes_save, preserve_fp_registers);\n+    }\n","filename":"src\/hotspot\/cpu\/ppc\/gc\/g1\/g1BarrierSetAssembler_ppc.cpp","additions":21,"deletions":5,"binary":false,"changes":26,"status":"modified"}]}