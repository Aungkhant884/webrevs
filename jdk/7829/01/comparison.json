{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,0 @@\n-#include <stdlib.h>\n@@ -28,0 +27,3 @@\n+#include <errno.h>\n+#include <stdlib.h>\n+#include <string.h>\n@@ -29,0 +31,3 @@\n+#include \"check_classname.h\"\n+#include \"java_lang_ClassLoader.h\"\n+#include \"jlong.h\"\n@@ -31,1 +36,0 @@\n-#include \"jlong.h\"\n@@ -33,3 +37,0 @@\n-#include \"check_classname.h\"\n-#include \"java_lang_ClassLoader.h\"\n-#include <string.h>\n@@ -91,1 +92,1 @@\n-        return 0;\n+        return NULL;\n@@ -99,1 +100,1 @@\n-        return 0;\n+        return NULL;\n@@ -102,1 +103,4 @@\n-    body = (jbyte *)malloc(length);\n+    \/\/ On malloc(0), implementators of malloc(3) have the choice to return either\n+    \/\/ NULL or a unique non-NULL pointer. To unify libc behavior across our platforms\n+    \/\/ we chose the latter. (see 8283225)\n+    body = (jbyte *)malloc(length < 1 ? 1 : length);\n@@ -104,1 +108,1 @@\n-    if (body == 0) {\n+    if (body == NULL) {\n@@ -106,1 +110,1 @@\n-        return 0;\n+        return NULL;\n@@ -111,1 +115,1 @@\n-    if ((*env)->ExceptionOccurred(env))\n+    if ((*env)->ExceptionOccurred(env)) {\n@@ -113,0 +117,1 @@\n+    }\n@@ -171,1 +176,1 @@\n-    if (body == 0) {\n+    if (body == NULL) {\n@@ -173,1 +178,1 @@\n-        return 0;\n+        return NULL;\n@@ -231,1 +236,1 @@\n-        return 0;\n+        return NULL;\n@@ -239,1 +244,1 @@\n-        return 0;\n+        return NULL;\n@@ -242,2 +247,6 @@\n-    body = (jbyte *)malloc(length);\n-    if (body == 0) {\n+    \/\/ On malloc(0), implementators of malloc(3) have the choice to return either\n+    \/\/ NULL or a unique non-NULL pointer. To unify libc behavior across our platforms\n+    \/\/ we chose the latter. (see 8283225)\n+    body = (jbyte *)malloc(length < 1 ? 1 : length);\n+\n+    if (body == NULL) {\n@@ -245,1 +254,1 @@\n-        return 0;\n+        return NULL;\n@@ -285,1 +294,1 @@\n-        return 0;\n+        return NULL;\n@@ -314,1 +323,1 @@\n-        return 0;\n+        return NULL;\n","filename":"src\/java.base\/share\/native\/libjava\/ClassLoader.c","additions":30,"deletions":21,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 8262913\n+ * @bug 8262913 8283225\n","filename":"test\/hotspot\/jtreg\/runtime\/DefineClass\/NullClassBytesTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}