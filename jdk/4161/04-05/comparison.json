{"files":[{"patch":"@@ -1480,1 +1480,0 @@\n-            Calendar cal;\n@@ -1492,2 +1491,2 @@\n-            switch (type) {\n-                case \"gregory\" -> cal = new GregorianCalendar(zone, locale, true);\n+            final Calendar cal = switch (type) {\n+                case \"gregory\" -> new GregorianCalendar(zone, locale, true);\n@@ -1500,1 +1499,1 @@\n-                    cal = gcal;\n+                    yield gcal;\n@@ -1503,2 +1502,3 @@\n-                    cal = new BuddhistCalendar(zone, locale);\n-                    cal.clear();\n+                    var buddhistCalendar = new BuddhistCalendar(zone, locale);\n+                    buddhistCalendar.clear();\n+                    yield buddhistCalendar;\n@@ -1506,1 +1506,1 @@\n-                case \"japanese\" -> cal = new JapaneseImperialCalendar(zone, locale, true);\n+                case \"japanese\" -> new JapaneseImperialCalendar(zone, locale, true);\n@@ -1508,1 +1508,1 @@\n-            }\n+            };\n","filename":"src\/java.base\/share\/classes\/java\/util\/Calendar.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -1118,1 +1118,1 @@\n-        switch (field) {\n+        return switch (field) {\n@@ -1122,1 +1122,1 @@\n-                return Math.max(LEAST_MAX_VALUES[YEAR], d.getYear());\n+                yield Math.max(LEAST_MAX_VALUES[YEAR], d.getYear());\n@@ -1124,2 +1124,2 @@\n-        }\n-        return MAX_VALUES[field];\n+            default -> MAX_VALUES[field];\n+        };\n@@ -1169,6 +1169,4 @@\n-        switch (field) {\n-            case YEAR -> {\n-                return Math.min(LEAST_MAX_VALUES[YEAR], getMaximum(YEAR));\n-            }\n-        }\n-        return LEAST_MAX_VALUES[field];\n+        return switch (field) {\n+            case YEAR -> Math.min(LEAST_MAX_VALUES[YEAR], getMaximum(YEAR));\n+            default -> LEAST_MAX_VALUES[field];\n+        };\n@@ -1305,1 +1303,0 @@\n-        int normalizedYear = date.getNormalizedYear();\n@@ -1307,2 +1304,1 @@\n-        int value = -1;\n-        switch (field) {\n+        return switch (field) {\n@@ -1310,1 +1306,1 @@\n-                value = DECEMBER;\n+                int month = DECEMBER;\n@@ -1324,1 +1320,1 @@\n-                        value = ldate.getMonth() - 1;\n+                        month = ldate.getMonth() - 1;\n@@ -1329,1 +1325,1 @@\n-                        value = d.getMonth() - 1;\n+                        month = d.getMonth() - 1;\n@@ -1332,0 +1328,1 @@\n+                yield month;\n@@ -1333,1 +1330,1 @@\n-            case DAY_OF_MONTH -> value = jcal.getMonthLength(date);\n+            case DAY_OF_MONTH -> jcal.getMonthLength(date);\n@@ -1348,4 +1345,1 @@\n-                        value = (int) (transition - gcal.getFixedDate(d));\n-                    } else {\n-                        d.addYear(+1);\n-                        value = (int) (gcal.getFixedDate(d) - transition);\n+                        yield (int) (transition - gcal.getFixedDate(d));\n@@ -1353,0 +1347,16 @@\n+                    d.addYear(1);\n+                    yield (int) (gcal.getFixedDate(d) - transition);\n+                }\n+                LocalGregorianCalendar.Date d = jcal.getCalendarDate(Long.MAX_VALUE, getZone());\n+                if (date.getEra() == d.getEra() && date.getYear() == d.getYear()) {\n+                    long fd = jcal.getFixedDate(d);\n+                    long jan1 = getFixedDateJan1(d, fd);\n+                    yield (int) (fd - jan1) + 1;\n+                } else if (date.getYear() == getMinimum(YEAR)) {\n+                    CalendarDate d1 = jcal.getCalendarDate(Long.MIN_VALUE, getZone());\n+                    long fd1 = jcal.getFixedDate(d1);\n+                    d1.addYear(1);\n+                    d1.setMonth(BaseCalendar.JANUARY).setDayOfMonth(1);\n+                    jcal.normalize(d1);\n+                    long fd2 = jcal.getFixedDate(d1);\n+                    yield (int) (fd2 - fd1);\n@@ -1354,16 +1364,1 @@\n-                    LocalGregorianCalendar.Date d = jcal.getCalendarDate(Long.MAX_VALUE, getZone());\n-                    if (date.getEra() == d.getEra() && date.getYear() == d.getYear()) {\n-                        long fd = jcal.getFixedDate(d);\n-                        long jan1 = getFixedDateJan1(d, fd);\n-                        value = (int) (fd - jan1) + 1;\n-                    } else if (date.getYear() == getMinimum(YEAR)) {\n-                        CalendarDate d1 = jcal.getCalendarDate(Long.MIN_VALUE, getZone());\n-                        long fd1 = jcal.getFixedDate(d1);\n-                        d1.addYear(1);\n-                        d1.setMonth(BaseCalendar.JANUARY).setDayOfMonth(1);\n-                        jcal.normalize(d1);\n-                        long fd2 = jcal.getFixedDate(d1);\n-                        value = (int) (fd2 - fd1);\n-                    } else {\n-                        value = jcal.getYearLength(date);\n-                    }\n+                    yield jcal.getYearLength(date);\n@@ -1378,1 +1373,1 @@\n-                        value = getWeekNumber(jan1, fd);\n+                        yield getWeekNumber(jan1, fd);\n@@ -1395,17 +1390,1 @@\n-                        value = getWeekNumber(jan1, nextJan1st);\n-                    } else {\n-                        \/\/ Get the day of week of January 1 of the year\n-                        CalendarDate d = gcal.newCalendarDate(TimeZone.NO_TIMEZONE);\n-                        d.setDate(date.getNormalizedYear(), BaseCalendar.JANUARY, 1);\n-                        int dayOfWeek = gcal.getDayOfWeek(d);\n-                        \/\/ Normalize the day of week with the firstDayOfWeek value\n-                        dayOfWeek -= getFirstDayOfWeek();\n-                        if (dayOfWeek < 0) {\n-                            dayOfWeek += 7;\n-                        }\n-                        value = 52;\n-                        int magic = dayOfWeek + getMinimalDaysInFirstWeek() - 1;\n-                        if ((magic == 6) ||\n-                            (date.isLeapYear() && (magic == 5 || magic == 12))) {\n-                            value++;\n-                        }\n+                        yield getWeekNumber(jan1, nextJan1st);\n@@ -1413,1 +1392,15 @@\n-                    break;\n+                    \/\/ Get the day of week of January 1 of the year\n+                    CalendarDate d = gcal.newCalendarDate(TimeZone.NO_TIMEZONE);\n+                    d.setDate(date.getNormalizedYear(), BaseCalendar.JANUARY, 1);\n+                    int dayOfWeek = gcal.getDayOfWeek(d);\n+                    \/\/ Normalize the day of week with the firstDayOfWeek value\n+                    dayOfWeek -= getFirstDayOfWeek();\n+                    if (dayOfWeek < 0) {\n+                        dayOfWeek += 7;\n+                    }\n+                    int magic = dayOfWeek + getMinimalDaysInFirstWeek() - 1;\n+                    if ((magic == 6) ||\n+                        (date.isLeapYear() && (magic == 5 || magic == 12))) {\n+                        yield 53;\n+                    }\n+                    yield 52;\n@@ -1421,2 +1414,2 @@\n-                value = jc.get(WEEK_OF_YEAR);\n-                if (value == 1 && max > 7) {\n+                int weekOfYear = jc.get(WEEK_OF_YEAR);\n+                if (weekOfYear == 1 && max > 7) {\n@@ -1424,1 +1417,1 @@\n-                    value = jc.get(WEEK_OF_YEAR);\n+                    weekOfYear = jc.get(WEEK_OF_YEAR);\n@@ -1426,0 +1419,1 @@\n+                yield weekOfYear;\n@@ -1429,22 +1423,1 @@\n-                if (!(date.getEra() == jd.getEra() && date.getYear() == jd.getYear())) {\n-                    CalendarDate d = gcal.newCalendarDate(TimeZone.NO_TIMEZONE);\n-                    d.setDate(date.getNormalizedYear(), date.getMonth(), 1);\n-                    int dayOfWeek = gcal.getDayOfWeek(d);\n-                    int monthLength = gcal.getMonthLength(d);\n-                    dayOfWeek -= getFirstDayOfWeek();\n-                    if (dayOfWeek < 0) {\n-                        dayOfWeek += 7;\n-                    }\n-                    int nDaysFirstWeek = 7 - dayOfWeek; \/\/ # of days in the first week\n-                    value = 3;\n-                    if (nDaysFirstWeek >= getMinimalDaysInFirstWeek()) {\n-                        value++;\n-                    }\n-                    monthLength -= nDaysFirstWeek + 7 * 3;\n-                    if (monthLength > 0) {\n-                        value++;\n-                        if (monthLength > 7) {\n-                            value++;\n-                        }\n-                    }\n-                } else {\n+                if (date.getEra() == jd.getEra() && date.getYear() == jd.getYear()) {\n@@ -1453,1 +1426,9 @@\n-                    value = getWeekNumber(month1, fd);\n+                    yield getWeekNumber(month1, fd);\n+                }\n+                CalendarDate d = gcal.newCalendarDate(TimeZone.NO_TIMEZONE);\n+                d.setDate(date.getNormalizedYear(), date.getMonth(), 1);\n+                int dayOfWeek = gcal.getDayOfWeek(d);\n+                int monthLength = gcal.getMonthLength(d);\n+                dayOfWeek -= getFirstDayOfWeek();\n+                if (dayOfWeek < 0) {\n+                    dayOfWeek += 7;\n@@ -1455,0 +1436,13 @@\n+                int nDaysFirstWeek = 7 - dayOfWeek; \/\/ # of days in the first week\n+                int weekOfMonth = 3;\n+                if (nDaysFirstWeek >= getMinimalDaysInFirstWeek()) {\n+                    weekOfMonth++;\n+                }\n+                monthLength -= nDaysFirstWeek + 7 * 3;\n+                if (monthLength > 0) {\n+                    weekOfMonth++;\n+                    if (monthLength > 7) {\n+                        weekOfMonth++;\n+                    }\n+                }\n+                yield weekOfMonth;\n@@ -1469,1 +1463,1 @@\n-                value = (ndays + 6) \/ 7;\n+                yield (ndays + 6) \/ 7;\n@@ -1475,0 +1469,1 @@\n+                int year;\n@@ -1477,1 +1472,1 @@\n-                    value = d.getYear();\n+                    year = d.getYear();\n@@ -1480,2 +1475,2 @@\n-                    if (value > 400) {\n-                        jd.setYear(value - 400);\n+                    if (year > 400) {\n+                        jd.setYear(year - 400);\n@@ -1485,1 +1480,1 @@\n-                    value = d.getYear();\n+                    year = d.getYear();\n@@ -1488,1 +1483,1 @@\n-                    jd.setYear(value);\n+                    jd.setYear(year);\n@@ -1492,1 +1487,1 @@\n-                    value--;\n+                    year--;\n@@ -1494,0 +1489,1 @@\n+                yield year;\n@@ -1496,2 +1492,1 @@\n-        }\n-        return value;\n+        };\n","filename":"src\/java.base\/share\/classes\/java\/util\/JapaneseImperialCalendar.java","additions":86,"deletions":91,"binary":false,"changes":177,"status":"modified"}]}