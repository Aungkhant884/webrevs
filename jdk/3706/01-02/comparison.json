{"files":[{"patch":"@@ -2778,0 +2778,42 @@\n+class AdapterSignatureIterator : public SignatureIterator {\n+ private:\n+  BasicType stack_sig_bt[16];\n+  BasicType* sig_bt;\n+  int index;\n+\n+ public:\n+  AdapterSignatureIterator(Symbol* signature,\n+                           fingerprint_t fingerprint,\n+                           bool is_static,\n+                           int total_args_passed) :\n+    SignatureIterator(signature, fingerprint),\n+    index(0)\n+  {\n+    sig_bt = (total_args_passed <= 16) ? stack_sig_bt : NEW_RESOURCE_ARRAY(BasicType, total_args_passed);\n+    if (!is_static) { \/\/ Pass in receiver first\n+      sig_bt[index++] = T_OBJECT;\n+    }\n+    do_parameters_on(this);\n+  }\n+\n+  BasicType* basic_types() {\n+    return sig_bt;\n+  }\n+\n+#ifdef ASSERT\n+  int slots() {\n+    return index;\n+  }\n+#endif\n+\n+ private:\n+\n+  friend class SignatureIterator;  \/\/ so do_parameters_on can call do_type\n+  void do_type(BasicType type) {\n+    sig_bt[index++] = type;\n+    if (type == T_LONG || type == T_DOUBLE) {\n+      sig_bt[index++] = T_VOID; \/\/ Longs & doubles take 2 Java slots\n+    }\n+  }\n+};\n+\n@@ -2797,12 +2839,2 @@\n-  BasicType stack_sig_bt[16];\n-  BasicType* sig_bt = (total_args_passed <= 16) ? stack_sig_bt : NEW_RESOURCE_ARRAY(BasicType, total_args_passed);\n-\n-  int i = 0;\n-  if (!method->is_static())  \/\/ Pass in receiver first\n-    sig_bt[i++] = T_OBJECT;\n-  for (SignatureStream ss(method->signature()); !ss.at_return_type(); ss.next()) {\n-    sig_bt[i++] = ss.type();  \/\/ Collect remaining bits of signature\n-    if (ss.type() == T_LONG || ss.type() == T_DOUBLE)\n-      sig_bt[i++] = T_VOID;   \/\/ Longs & doubles take 2 Java slots\n-  }\n-\n+  AdapterSignatureIterator si(method->signature(), method->constMethod()->fingerprint(), method->is_static(), total_args_passed);\n+  BasicType* sig_bt = si.basic_types();\n@@ -2812,1 +2844,1 @@\n-    assert(i == total_args_passed, \"\");\n+    assert(si.slots() == total_args_passed, \"\");\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp","additions":45,"deletions":13,"binary":false,"changes":58,"status":"modified"}]}