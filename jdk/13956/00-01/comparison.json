{"files":[{"patch":"@@ -87,0 +87,4 @@\n+#ifdef DEBUG\n+    jtregSimulateCrash(0, 5);\n+#endif\n+\n@@ -139,0 +143,3 @@\n+#ifdef DEBUG\n+    jtregSimulateCrash(0, 4);\n+#endif\n","filename":"src\/java.base\/unix\/native\/jspawnhelper\/jspawnhelper.c","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -530,1 +530,1 @@\n-                fcntl(c->fds[i], F_SETFD, flags & (~1));\n+                fcntl(c->fds[i], F_SETFD, flags & (~FD_CLOEXEC));\n@@ -541,0 +541,4 @@\n+#ifdef DEBUG\n+    jtregSimulateCrash(resultPid, 1);\n+#endif\n+\n@@ -557,0 +561,3 @@\n+#ifdef DEBUG\n+    jtregSimulateCrash(resultPid, 2);\n+#endif\n@@ -561,0 +568,3 @@\n+#ifdef DEBUG\n+    jtregSimulateCrash(resultPid, 3);\n+#endif\n","filename":"src\/java.base\/unix\/native\/libjava\/ProcessImpl_md.c","additions":11,"deletions":1,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -327,0 +327,3 @@\n+#ifdef DEBUG\n+    jtregSimulateCrash(0, 6);\n+#endif\n@@ -399,0 +402,16 @@\n+\n+#ifdef DEBUG\n+\/* This method is only used in debug builds for testing MODE_POSIX_SPAWN\n+ * in the light of abnormal program termination of either the parent JVM\n+ * or the newly created jspawnhelper child process during the execution of\n+ * Java_java_lang_ProcessImpl_forkAndExec().\n+ * See: test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperProtocol.java\n+ *\/\n+void jtregSimulateCrash(pid_t child, int stage) {\n+    const char* env = getenv(\"JTREG_JSPAWNHELPER_PROTOCOL_TEST\");\n+    if (env != NULL && atoi(env) == stage) {\n+        printf(\"posix_spawn:%d\\n\", child);\n+        exit(stage);\n+    }\n+}\n+#endif\n","filename":"src\/java.base\/unix\/native\/libjava\/childproc.c","additions":19,"deletions":0,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -151,0 +151,10 @@\n+#ifdef DEBUG\n+\/* This method is only used in debug builds for testing MODE_POSIX_SPAWN\n+ * in the light of abnormal program termination of either the parent JVM\n+ * or the newly created jspawnhelper child process during the execution of\n+ * Java_java_lang_ProcessImpl_forkAndExec().\n+ * See: test\/jdk\/java\/lang\/ProcessBuilder\/JspawnhelperProtocol.java\n+ *\/\n+void jtregSimulateCrash(pid_t child, int stage);\n+#endif\n+\n","filename":"src\/java.base\/unix\/native\/libjava\/childproc.h","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"}]}