{"files":[{"patch":"@@ -61,4 +61,1 @@\n-  \/\/ No store check needed if we're storing a NULL or an old object\n-  \/\/ (latter case is probably a string constant). The concurrent\n-  \/\/ mark sweep garbage collector, however, needs to have all nonNull\n-  \/\/ oop updates flagged via card-marks.\n+  \/\/ No store check needed if we're storing a NULL.\n@@ -66,1 +63,0 @@\n-    \/\/ must be either an oop or NULL\n@@ -68,2 +64,1 @@\n-    if (t == TypePtr::NULL_PTR || t == Type::TOP)\n-      \/\/ stores of null never (?) need barriers\n+    if (t == TypePtr::NULL_PTR || t == Type::TOP) {\n@@ -71,0 +66,1 @@\n+    }\n@@ -76,1 +72,1 @@\n-    \/\/ Keep this code in sync with new_deferred_store_barrier() in runtime.cpp.\n+    \/\/ Keep this code in sync with CardTableBarrierSet::on_slowpath_allocation_exit.\n@@ -86,0 +82,2 @@\n+  } else {\n+    \/\/ Else it's an array (or unknown), and we want more precise card marks.\n@@ -87,1 +85,1 @@\n-  \/\/ (Else it's an array (or unknown), and we want more precise card marks.)\n+\n@@ -96,1 +94,1 @@\n-  Node* card_offset = __ URShiftX( cast, __ ConI(CardTable::card_shift) );\n+  Node* card_offset = __ URShiftX(cast, __ ConI(CardTable::card_shift));\n@@ -99,1 +97,1 @@\n-  Node* card_adr = __ AddP(__ top(), byte_map_base_node(kit), card_offset );\n+  Node* card_adr = __ AddP(__ top(), byte_map_base_node(kit), card_offset);\n@@ -103,1 +101,3 @@\n-  Node*   zero = __ ConI(0); \/\/ Dirty card value\n+\n+  \/\/ Dirty card value to store\n+  Node* dirty = __ ConI(CardTable::dirty_card_val());\n@@ -114,1 +114,1 @@\n-    __ if_then(card_val, BoolTest::ne, zero);\n+    __ if_then(card_val, BoolTest::ne, dirty);\n@@ -117,2 +117,2 @@\n-  \/\/ Smash zero into card\n-  __ store(__ ctrl(), card_adr, zero, T_BYTE, adr_type, MemNode::unordered);\n+  \/\/ Smash dirty value into card\n+  __ store(__ ctrl(), card_adr, dirty, T_BYTE, adr_type, MemNode::unordered);\n","filename":"src\/hotspot\/share\/gc\/shared\/c2\/cardTableBarrierSetC2.cpp","additions":15,"deletions":15,"binary":false,"changes":30,"status":"modified"}]}