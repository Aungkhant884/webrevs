{"files":[{"patch":"@@ -28,0 +28,1 @@\n+#include \"runtime\/atomic.hpp\"\n@@ -29,1 +30,2 @@\n-static void pd_conjoint_jshorts_atomic(const jshort* from, jshort* to, size_t count) {\n+template <typename T>\n+static void pd_conjoint_atomic_helper(const T* from, T* to, size_t count) {\n@@ -33,1 +35,1 @@\n-      *to++ = *from++;\n+      Atomic::store(to++, Atomic::load(from++));\n@@ -40,1 +42,1 @@\n-      *to-- = *from--;\n+      Atomic::store(to--, Atomic::load(from--));\n@@ -45,0 +47,4 @@\n+static void pd_conjoint_jshorts_atomic(const jshort* from, jshort* to, size_t count) {\n+  pd_conjoint_atomic_helper(from, to, count);\n+}\n+\n@@ -46,13 +52,1 @@\n-  if (from > to) {\n-    while (count-- > 0) {\n-      \/\/ Copy forwards\n-      *to++ = *from++;\n-    }\n-  } else {\n-    from += count - 1;\n-    to   += count - 1;\n-    while (count-- > 0) {\n-      \/\/ Copy backwards\n-      *to-- = *from--;\n-    }\n-  }\n+  pd_conjoint_atomic_helper(from, to, count);\n@@ -63,2 +57,1 @@\n-  assert(BytesPerLong == BytesPerOop, \"jlongs and oops must be the same size\");\n-  pd_conjoint_oops_atomic((const oop*)from, (oop*)to, count);\n+  pd_conjoint_atomic_helper(from, to, count);\n@@ -95,14 +88,1 @@\n-  \/\/ Do better than this: inline memmove body  NEEDS CLEANUP\n-  if (from > to) {\n-    while (count-- > 0) {\n-      \/\/ Copy forwards\n-      *to++ = *from++;\n-    }\n-  } else {\n-    from += count - 1;\n-    to   += count - 1;\n-    while (count-- > 0) {\n-      \/\/ Copy backwards\n-      *to-- = *from--;\n-    }\n-  }\n+  pd_conjoint_atomic_helper(from, to, count);\n","filename":"src\/hotspot\/os_cpu\/windows_x86\/copy_windows_x86.hpp","additions":12,"deletions":32,"binary":false,"changes":44,"status":"modified"}]}