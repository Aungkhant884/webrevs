{"files":[{"patch":"@@ -159,8 +159,16 @@\n-                if (ch instanceof SelectableChannel sc && !sc.isBlocking())\n-                    throw new IllegalBlockingModeException();\n-\n-                if (ch instanceof SeekableByteChannel sbc) {\n-                    return transfer(sbc, fc);\n-                }\n-\n-                return transfer(ch, fc);\n+                if (ch instanceof SelectableChannel sc) {\n+                    synchronized (sc.blockingLock()) {\n+                        boolean bm = sc.isBlocking();\n+                        if (!bm)\n+                            throw new IllegalBlockingModeException();\n+\n+                        if (ch instanceof SeekableByteChannel sbc) {\n+                            return transfer(sbc, fc);\n+\n+                        return transfer(ch, fc);}\n+                    } else {\n+                        if (ch instanceof SeekableByteChannel sbc) {\n+                            return transfer(sbc, fc);\n+\n+                        return transfer(ch, fc);}\n+                    }\n","filename":"src\/java.base\/share\/classes\/sun\/nio\/ch\/ChannelInputStream.java","additions":16,"deletions":8,"binary":false,"changes":24,"status":"modified"}]}