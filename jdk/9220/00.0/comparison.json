{"files":[{"patch":"@@ -1168,1 +1168,1 @@\n-instruct vnotI_masked(vReg dst, vReg src, immI_M1 m1, pRegGov pg) %{\n+instruct vnotI_masked(vReg dst_src, immI_M1 m1, pRegGov pg) %{\n@@ -1170,3 +1170,3 @@\n-  match(Set dst (XorV (Binary src (ReplicateB m1)) pg));\n-  match(Set dst (XorV (Binary src (ReplicateS m1)) pg));\n-  match(Set dst (XorV (Binary src (ReplicateI m1)) pg));\n+  match(Set dst_src (XorV (Binary dst_src (ReplicateB m1)) pg));\n+  match(Set dst_src (XorV (Binary dst_src (ReplicateS m1)) pg));\n+  match(Set dst_src (XorV (Binary dst_src (ReplicateI m1)) pg));\n@@ -1174,1 +1174,1 @@\n-  format %{ \"sve_not $dst, $pg, $src\\t# vector (sve) B\/H\/S\" %}\n+  format %{ \"sve_not $dst_src, $pg, $dst_src\\t# vector (sve) B\/H\/S\" %}\n@@ -1177,2 +1177,2 @@\n-    __ sve_not(as_FloatRegister($dst$$reg), __ elemType_to_regVariant(bt),\n-               as_PRegister($pg$$reg), as_FloatRegister($src$$reg));\n+    __ sve_not(as_FloatRegister($dst_src$$reg), __ elemType_to_regVariant(bt),\n+               as_PRegister($pg$$reg), as_FloatRegister($dst_src$$reg));\n@@ -1183,1 +1183,1 @@\n-instruct vnotL_masked(vReg dst, vReg src, immL_M1 m1, pRegGov pg) %{\n+instruct vnotL_masked(vReg dst_src, immL_M1 m1, pRegGov pg) %{\n@@ -1185,1 +1185,1 @@\n-  match(Set dst (XorV (Binary src (ReplicateL m1)) pg));\n+  match(Set dst_src (XorV (Binary dst_src (ReplicateL m1)) pg));\n@@ -1187,1 +1187,1 @@\n-  format %{ \"sve_not $dst, $pg, $src\\t# vector (sve) D\" %}\n+  format %{ \"sve_not $dst_src, $pg, $dst_src\\t# vector (sve) D\" %}\n@@ -1190,2 +1190,2 @@\n-    __ sve_not(as_FloatRegister($dst$$reg), __ elemType_to_regVariant(bt),\n-               as_PRegister($pg$$reg), as_FloatRegister($src$$reg));\n+    __ sve_not(as_FloatRegister($dst_src$$reg), __ elemType_to_regVariant(bt),\n+               as_PRegister($pg$$reg), as_FloatRegister($dst_src$$reg));\n@@ -5259,1 +5259,1 @@\n-instruct gatherL(vReg dst, indirect mem, vReg idx) %{\n+instruct gatherL(vReg dst, indirect mem, vReg idx, vReg tmp) %{\n@@ -5265,0 +5265,1 @@\n+  effect(TEMP tmp);\n@@ -5268,1 +5269,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -5270,1 +5271,1 @@\n-                       as_FloatRegister($idx$$reg));\n+                       as_FloatRegister($tmp$$reg));\n@@ -5294,1 +5295,1 @@\n-instruct gatherL_partial(vReg dst, indirect mem, vReg idx, pRegGov ptmp, rFlagsReg cr) %{\n+instruct gatherL_partial(vReg dst, indirect mem, vReg idx, vReg vtmp, pRegGov ptmp, rFlagsReg cr) %{\n@@ -5300,1 +5301,1 @@\n-  effect(TEMP ptmp, KILL cr);\n+  effect(TEMP vtmp, TEMP ptmp, KILL cr);\n@@ -5305,1 +5306,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($vtmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -5307,1 +5308,1 @@\n-                       as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                       as_Register($mem$$base), as_FloatRegister($vtmp$$reg));\n@@ -5328,1 +5329,1 @@\n-instruct gatherL_masked(vReg dst, indirect mem, vReg idx, pRegGov pg) %{\n+instruct gatherL_masked(vReg dst, indirect mem, vReg idx, pRegGov pg, vReg tmp) %{\n@@ -5333,0 +5334,1 @@\n+  effect(TEMP tmp);\n@@ -5336,1 +5338,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -5338,1 +5340,1 @@\n-                       as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                       as_Register($mem$$base), as_FloatRegister($tmp$$reg));\n@@ -5360,1 +5362,1 @@\n-instruct scatterL(indirect mem, vReg src, vReg idx) %{\n+instruct scatterL(indirect mem, vReg src, vReg idx, vReg tmp) %{\n@@ -5366,0 +5368,1 @@\n+  effect(TEMP tmp);\n@@ -5369,1 +5372,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -5371,1 +5374,1 @@\n-                        as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                        as_Register($mem$$base), as_FloatRegister($tmp$$reg));\n@@ -5395,1 +5398,1 @@\n-instruct scatterL_partial(indirect mem, vReg src, vReg idx, pRegGov ptmp, rFlagsReg cr) %{\n+instruct scatterL_partial(indirect mem, vReg src, vReg idx, vReg vtmp, pRegGov ptmp, rFlagsReg cr) %{\n@@ -5401,1 +5404,1 @@\n-  effect(TEMP ptmp, KILL cr);\n+  effect(TEMP vtmp, TEMP ptmp, KILL cr);\n@@ -5406,1 +5409,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($vtmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -5408,1 +5411,1 @@\n-                        as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                        as_Register($mem$$base), as_FloatRegister($vtmp$$reg));\n@@ -5429,1 +5432,1 @@\n-instruct scatterL_masked(indirect mem, vReg src, vReg idx, pRegGov pg) %{\n+instruct scatterL_masked(indirect mem, vReg src, vReg idx, pRegGov pg, vReg tmp) %{\n@@ -5434,0 +5437,1 @@\n+  effect(TEMP tmp);\n@@ -5437,1 +5441,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -5439,1 +5443,1 @@\n-                        as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                        as_Register($mem$$base), as_FloatRegister($tmp$$reg));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve.ad","additions":36,"deletions":32,"binary":false,"changes":68,"status":"modified"},{"patch":"@@ -662,4 +662,4 @@\n-`match(Set dst (XorV (Binary src (ReplicateB m1)) pg));\n-  match(Set dst (XorV (Binary src (ReplicateS m1)) pg));\n-  match(Set dst (XorV (Binary src (ReplicateI m1)) pg));',\n-`match(Set dst (XorV (Binary src (ReplicateL m1)) pg));')')dnl\n+`match(Set dst_src (XorV (Binary dst_src (ReplicateB m1)) pg));\n+  match(Set dst_src (XorV (Binary dst_src (ReplicateS m1)) pg));\n+  match(Set dst_src (XorV (Binary dst_src (ReplicateI m1)) pg));',\n+`match(Set dst_src (XorV (Binary dst_src (ReplicateL m1)) pg));')')dnl\n@@ -668,1 +668,1 @@\n-instruct vnot$1_masked`'(vReg dst, vReg src, imm$1_M1 m1, pRegGov pg) %{\n+instruct vnot$1_masked`'(vReg dst_src, imm$1_M1 m1, pRegGov pg) %{\n@@ -672,1 +672,1 @@\n-  format %{ \"sve_not $dst, $pg, $src\\t# vector (sve) $2\" %}\n+  format %{ \"sve_not $dst_src, $pg, $dst_src\\t# vector (sve) $2\" %}\n@@ -675,2 +675,2 @@\n-    __ sve_not(as_FloatRegister($dst$$reg), __ elemType_to_regVariant(bt),\n-               as_PRegister($pg$$reg), as_FloatRegister($src$$reg));\n+    __ sve_not(as_FloatRegister($dst_src$$reg), __ elemType_to_regVariant(bt),\n+               as_PRegister($pg$$reg), as_FloatRegister($dst_src$$reg));\n@@ -2829,1 +2829,1 @@\n-instruct gatherL(vReg dst, indirect mem, vReg idx) %{\n+instruct gatherL(vReg dst, indirect mem, vReg idx, vReg tmp) %{\n@@ -2835,0 +2835,1 @@\n+  effect(TEMP tmp);\n@@ -2838,1 +2839,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -2840,1 +2841,1 @@\n-                       as_FloatRegister($idx$$reg));\n+                       as_FloatRegister($tmp$$reg));\n@@ -2864,1 +2865,1 @@\n-instruct gatherL_partial(vReg dst, indirect mem, vReg idx, pRegGov ptmp, rFlagsReg cr) %{\n+instruct gatherL_partial(vReg dst, indirect mem, vReg idx, vReg vtmp, pRegGov ptmp, rFlagsReg cr) %{\n@@ -2870,1 +2871,1 @@\n-  effect(TEMP ptmp, KILL cr);\n+  effect(TEMP vtmp, TEMP ptmp, KILL cr);\n@@ -2875,1 +2876,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($vtmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -2877,1 +2878,1 @@\n-                       as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                       as_Register($mem$$base), as_FloatRegister($vtmp$$reg));\n@@ -2898,1 +2899,1 @@\n-instruct gatherL_masked(vReg dst, indirect mem, vReg idx, pRegGov pg) %{\n+instruct gatherL_masked(vReg dst, indirect mem, vReg idx, pRegGov pg, vReg tmp) %{\n@@ -2903,0 +2904,1 @@\n+  effect(TEMP tmp);\n@@ -2906,1 +2908,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -2908,1 +2910,1 @@\n-                       as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                       as_Register($mem$$base), as_FloatRegister($tmp$$reg));\n@@ -2930,1 +2932,1 @@\n-instruct scatterL(indirect mem, vReg src, vReg idx) %{\n+instruct scatterL(indirect mem, vReg src, vReg idx, vReg tmp) %{\n@@ -2936,0 +2938,1 @@\n+  effect(TEMP tmp);\n@@ -2939,1 +2942,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -2941,1 +2944,1 @@\n-                        as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                        as_Register($mem$$base), as_FloatRegister($tmp$$reg));\n@@ -2965,1 +2968,1 @@\n-instruct scatterL_partial(indirect mem, vReg src, vReg idx, pRegGov ptmp, rFlagsReg cr) %{\n+instruct scatterL_partial(indirect mem, vReg src, vReg idx, vReg vtmp, pRegGov ptmp, rFlagsReg cr) %{\n@@ -2971,1 +2974,1 @@\n-  effect(TEMP ptmp, KILL cr);\n+  effect(TEMP vtmp, TEMP ptmp, KILL cr);\n@@ -2976,1 +2979,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($vtmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -2978,1 +2981,1 @@\n-                        as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                        as_Register($mem$$base), as_FloatRegister($vtmp$$reg));\n@@ -2999,1 +3002,1 @@\n-instruct scatterL_masked(indirect mem, vReg src, vReg idx, pRegGov pg) %{\n+instruct scatterL_masked(indirect mem, vReg src, vReg idx, pRegGov pg, vReg tmp) %{\n@@ -3004,0 +3007,1 @@\n+  effect(TEMP tmp);\n@@ -3007,1 +3011,1 @@\n-    __ sve_uunpklo(as_FloatRegister($idx$$reg), __ D, as_FloatRegister($idx$$reg));\n+    __ sve_uunpklo(as_FloatRegister($tmp$$reg), __ D, as_FloatRegister($idx$$reg));\n@@ -3009,1 +3013,1 @@\n-                        as_Register($mem$$base), as_FloatRegister($idx$$reg));\n+                        as_Register($mem$$base), as_FloatRegister($tmp$$reg));\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve_ad.m4","additions":32,"deletions":28,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -99,1 +99,0 @@\n-    private static Metrics[] metrics;\n@@ -703,3 +702,3 @@\n-    public static boolean shouldSkipBytecode(String eventName, Class<?> superClass) {\n-        if (superClass.getClassLoader() != null || !superClass.getName().equals(\"jdk.jfr.events.AbstractJDKEvent\")) {\n-            return false;\n+    public static boolean shouldInstrument(boolean isJDK, String name) {\n+        if (!isJDK) {\n+            return true;\n@@ -707,6 +706,3 @@\n-        return eventName.startsWith(\"jdk.Container\") && getMetrics() == null;\n-    }\n-\n-    private static Metrics getMetrics() {\n-        if (metrics == null) {\n-            metrics = new Metrics[]{Metrics.systemMetrics()};\n+        if (!name.contains(\".Container\")) {\n+            \/\/ Didn't match @Name(\"jdk.jfr.Container*\") or class name \"jdk.jfr.events.Container*\"\n+            return true;\n@@ -714,1 +710,1 @@\n-        return metrics[0];\n+        return JVM.getJVM().isContainerized();\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/Utils.java","additions":7,"deletions":11,"binary":false,"changes":18,"status":"modified"}]}