{"files":[{"patch":"@@ -1061,0 +1061,2 @@\n+            long *maskBits = NULL;\n+\n@@ -1064,5 +1066,0 @@\n-            } catch(std::bad_alloc&) {\n-                handle_bad_alloc();\n-            }\n-\n-            if (colorBits != NULL) {\n@@ -1083,14 +1080,8 @@\n-                    long *maskBits = NULL;\n-                    try {\n-                        entry_point();\n-                        maskBits = (long*)safe_Malloc(MAX_ICON_SIZE * MAX_ICON_SIZE * sizeof(long));\n-                    } catch(std::bad_alloc&) {\n-                        handle_bad_alloc();\n-                    }\n-                    if (maskBits != NULL) {\n-                        GetDIBits(dc, iconInfo.hbmMask, 0, iconSize, maskBits, &bmi, DIB_RGB_COLORS);\n-                        \/\/ Copy the mask alphas into the color bits\n-                        for (int i = 0; i < nBits; i++) {\n-                            if (maskBits[i] == 0) {\n-                                colorBits[i] |= 0xff000000;\n-                            }\n+\n+                    maskBits = (long*)safe_Malloc(MAX_ICON_SIZE * MAX_ICON_SIZE * sizeof(long));\n+\n+                    GetDIBits(dc, iconInfo.hbmMask, 0, iconSize, maskBits, &bmi, DIB_RGB_COLORS);\n+                    \/\/ Copy the mask alphas into the color bits\n+                    for (int i = 0; i < nBits; i++) {\n+                        if (maskBits[i] == 0) {\n+                            colorBits[i] |= 0xff000000;\n@@ -1098,1 +1089,0 @@\n-                        free(maskBits);\n@@ -1107,1 +1097,2 @@\n-                free(colorBits);\n+            } catch(std::bad_alloc&) {\n+                handle_bad_alloc();\n@@ -1109,0 +1100,1 @@\n+\n@@ -1111,0 +1103,9 @@\n+\n+            \/\/ Free bitmap buffers if they were allocated\n+            if (colorBits != NULL) {\n+                free(colorBits);\n+            }\n+\n+            if (maskBits != NULL) {\n+                free(maskBits);\n+            }\n","filename":"src\/java.desktop\/windows\/native\/libawt\/windows\/ShellFolder2.cpp","additions":22,"deletions":21,"binary":false,"changes":43,"status":"modified"}]}