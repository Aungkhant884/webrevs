{"files":[{"patch":"@@ -202,1 +202,1 @@\n-    RefProcTotalPhaseTimesTracker tt(RefPhase1, &phase_times);\n+    RefProcTotalPhaseTimesTracker tt(RefPhase2, &phase_times);\n@@ -207,1 +207,1 @@\n-    RefProcTotalPhaseTimesTracker tt(RefPhase2, &phase_times);\n+    RefProcTotalPhaseTimesTracker tt(RefPhase3, &phase_times);\n@@ -212,1 +212,1 @@\n-    RefProcTotalPhaseTimesTracker tt(RefPhase3, &phase_times);\n+    RefProcTotalPhaseTimesTracker tt(RefPhase4, &phase_times);\n@@ -455,2 +455,2 @@\n-class RefProcPhase1Task: public RefProcTask {\n-  void run_phase1(uint worker_id,\n+class RefProcPhase2Task: public RefProcTask {\n+  void run_phase2(uint worker_id,\n@@ -470,1 +470,1 @@\n-  RefProcPhase1Task(ReferenceProcessor& ref_processor,\n+  RefProcPhase2Task(ReferenceProcessor& ref_processor,\n@@ -480,1 +480,1 @@\n-    RefProcWorkerTimeTracker t(_phase_times->phase1_worker_time_sec(), tracker_id(worker_id));\n+    RefProcWorkerTimeTracker t(_phase_times->phase2_worker_time_sec(), tracker_id(worker_id));\n@@ -482,2 +482,2 @@\n-      RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::SoftRefSubPhase1, _phase_times, tracker_id(worker_id));\n-      run_phase1(worker_id, _ref_processor._discoveredSoftRefs, is_alive, keep_alive, true \/* do_enqueue_and_clear *\/, REF_SOFT);\n+      RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::SoftRefSubPhase2, _phase_times, tracker_id(worker_id));\n+      run_phase2(worker_id, _ref_processor._discoveredSoftRefs, is_alive, keep_alive, true \/* do_enqueue_and_clear *\/, REF_SOFT);\n@@ -486,2 +486,2 @@\n-      RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::WeakRefSubPhase1, _phase_times, tracker_id(worker_id));\n-      run_phase1(worker_id, _ref_processor._discoveredWeakRefs, is_alive, keep_alive, true \/* do_enqueue_and_clear *\/, REF_WEAK);\n+      RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::WeakRefSubPhase2, _phase_times, tracker_id(worker_id));\n+      run_phase2(worker_id, _ref_processor._discoveredWeakRefs, is_alive, keep_alive, true \/* do_enqueue_and_clear *\/, REF_WEAK);\n@@ -490,2 +490,2 @@\n-      RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::FinalRefSubPhase1, _phase_times, tracker_id(worker_id));\n-      run_phase1(worker_id, _ref_processor._discoveredFinalRefs, is_alive, keep_alive, false \/* do_enqueue_and_clear *\/, REF_FINAL);\n+      RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::FinalRefSubPhase2, _phase_times, tracker_id(worker_id));\n+      run_phase2(worker_id, _ref_processor._discoveredFinalRefs, is_alive, keep_alive, false \/* do_enqueue_and_clear *\/, REF_FINAL);\n@@ -499,1 +499,1 @@\n-class RefProcPhase2Task: public RefProcTask {\n+class RefProcPhase3Task: public RefProcTask {\n@@ -501,1 +501,1 @@\n-  RefProcPhase2Task(ReferenceProcessor& ref_processor,\n+  RefProcPhase3Task(ReferenceProcessor& ref_processor,\n@@ -511,1 +511,1 @@\n-    RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::FinalRefSubPhase2, _phase_times, tracker_id(worker_id));\n+    RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::FinalRefSubPhase3, _phase_times, tracker_id(worker_id));\n@@ -516,1 +516,1 @@\n-class RefProcPhase3Task: public RefProcTask {\n+class RefProcPhase4Task: public RefProcTask {\n@@ -518,1 +518,1 @@\n-  RefProcPhase3Task(ReferenceProcessor& ref_processor,\n+  RefProcPhase4Task(ReferenceProcessor& ref_processor,\n@@ -528,1 +528,1 @@\n-    RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::PhantomRefSubPhase3, _phase_times, tracker_id(worker_id));\n+    RefProcSubPhasesWorkerTimeTracker tt(ReferenceProcessor::PhantomRefSubPhase4, _phase_times, tracker_id(worker_id));\n@@ -723,1 +723,1 @@\n-    log_debug(gc, ref)(\"Skipped phase 1 of Reference Processing: no references\");\n+    log_debug(gc, ref)(\"Skipped phase 2 of Reference Processing: no references\");\n@@ -727,1 +727,1 @@\n-  RefProcMTDegreeAdjuster a(this, RefPhase1, num_total_refs);\n+  RefProcMTDegreeAdjuster a(this, RefPhase2, num_total_refs);\n@@ -730,1 +730,1 @@\n-    RefProcBalanceQueuesTimeTracker tt(RefPhase1, &phase_times);\n+    RefProcBalanceQueuesTimeTracker tt(RefPhase2, &phase_times);\n@@ -736,1 +736,1 @@\n-  RefProcPhaseTimeTracker tt(RefPhase1, &phase_times);\n+  RefProcPhaseTimeTracker tt(RefPhase2, &phase_times);\n@@ -738,3 +738,3 @@\n-  log_reflist(\"Phase 1 Soft before\", _discoveredSoftRefs, _max_num_queues);\n-  log_reflist(\"Phase 1 Weak before\", _discoveredWeakRefs, _max_num_queues);\n-  log_reflist(\"Phase 1 Final before\", _discoveredFinalRefs, _max_num_queues);\n+  log_reflist(\"Phase 2 Soft before\", _discoveredSoftRefs, _max_num_queues);\n+  log_reflist(\"Phase 2 Weak before\", _discoveredWeakRefs, _max_num_queues);\n+  log_reflist(\"Phase 2 Final before\", _discoveredFinalRefs, _max_num_queues);\n@@ -742,2 +742,2 @@\n-  RefProcPhase1Task phase1(*this, &phase_times);\n-  run_task(phase1, proxy_task, false);\n+  RefProcPhase2Task phase2(*this, &phase_times);\n+  run_task(phase2, proxy_task, false);\n@@ -747,1 +747,1 @@\n-  log_reflist(\"Phase 1 Final after\", _discoveredFinalRefs, _max_num_queues);\n+  log_reflist(\"Phase 2 Final after\", _discoveredFinalRefs, _max_num_queues);\n@@ -757,1 +757,1 @@\n-    log_debug(gc, ref)(\"Skipped phase 2 of Reference Processing: no references\");\n+    log_debug(gc, ref)(\"Skipped phase 3 of Reference Processing: no references\");\n@@ -761,1 +761,1 @@\n-  RefProcMTDegreeAdjuster a(this, RefPhase2, num_final_refs);\n+  RefProcMTDegreeAdjuster a(this, RefPhase3, num_final_refs);\n@@ -764,1 +764,1 @@\n-    RefProcBalanceQueuesTimeTracker tt(RefPhase2, &phase_times);\n+    RefProcBalanceQueuesTimeTracker tt(RefPhase3, &phase_times);\n@@ -768,1 +768,1 @@\n-  \/\/ Phase 2:\n+  \/\/ Phase 3:\n@@ -770,3 +770,3 @@\n-  RefProcPhaseTimeTracker tt(RefPhase2, &phase_times);\n-  RefProcPhase2Task phase2(*this, &phase_times);\n-  run_task(phase2, proxy_task, true);\n+  RefProcPhaseTimeTracker tt(RefPhase3, &phase_times);\n+  RefProcPhase3Task phase3(*this, &phase_times);\n+  run_task(phase3, proxy_task, true);\n@@ -785,1 +785,1 @@\n-    log_debug(gc, ref)(\"Skipped phase 3 of Reference Processing: no references\");\n+    log_debug(gc, ref)(\"Skipped phase 4 of Reference Processing: no references\");\n@@ -789,1 +789,1 @@\n-  RefProcMTDegreeAdjuster a(this, RefPhase3, num_phantom_refs);\n+  RefProcMTDegreeAdjuster a(this, RefPhase4, num_phantom_refs);\n@@ -792,1 +792,1 @@\n-    RefProcBalanceQueuesTimeTracker tt(RefPhase3, &phase_times);\n+    RefProcBalanceQueuesTimeTracker tt(RefPhase4, &phase_times);\n@@ -796,2 +796,2 @@\n-  \/\/ Phase 3: Walk phantom references appropriately.\n-  RefProcPhaseTimeTracker tt(RefPhase3, &phase_times);\n+  \/\/ Phase 4: Walk phantom references appropriately.\n+  RefProcPhaseTimeTracker tt(RefPhase4, &phase_times);\n@@ -801,2 +801,2 @@\n-  RefProcPhase3Task phase3(*this, &phase_times);\n-  run_task(phase3, proxy_task, false);\n+  RefProcPhase4Task phase4(*this, &phase_times);\n+  run_task(phase4, proxy_task, false);\n@@ -1193,1 +1193,1 @@\n-  return phase == ReferenceProcessor::RefPhase2;\n+  return phase == ReferenceProcessor::RefPhase3;\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.cpp","additions":44,"deletions":44,"binary":false,"changes":88,"status":"modified"},{"patch":"@@ -163,1 +163,0 @@\n-  friend class RefProcPhase1Task;\n@@ -166,0 +165,1 @@\n+  friend class RefProcPhase4Task;\n@@ -170,3 +170,2 @@\n-    SoftRefSubPhase1,\n-    WeakRefSubPhase1,\n-    FinalRefSubPhase1,\n+    SoftRefSubPhase2,\n+    WeakRefSubPhase2,\n@@ -174,1 +173,2 @@\n-    PhantomRefSubPhase3,\n+    FinalRefSubPhase3,\n+    PhantomRefSubPhase4,\n@@ -180,1 +180,0 @@\n-    RefPhase1,\n@@ -183,0 +182,1 @@\n+    RefPhase4,\n@@ -237,1 +237,1 @@\n-  \/\/ Phase 1: Drop Soft\/Weak\/Final references with a NULL or live referent, and clear\n+  \/\/ Phase 2: Drop Soft\/Weak\/Final references with a NULL or live referent, and clear\n@@ -242,1 +242,1 @@\n-  \/\/ Phase 2: Keep alive followers of Final references, and enqueue.\n+  \/\/ Phase 3: Keep alive followers of Final references, and enqueue.\n@@ -246,1 +246,1 @@\n-  \/\/ Phase 3: Drop and keep alive live Phantom references, or clear and enqueue if dead.\n+  \/\/ Phase 4: Drop and keep alive live Phantom references, or clear and enqueue if dead.\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.hpp","additions":9,"deletions":9,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -39,1 +39,1 @@\n-#define ASSERT_PHASE(phase) assert((phase) >= ReferenceProcessor::RefPhase1 && \\\n+#define ASSERT_PHASE(phase) assert((phase) >= ReferenceProcessor::RefPhase2 && \\\n@@ -43,1 +43,1 @@\n-#define ASSERT_SUB_PHASE(phase) assert((phase) >= ReferenceProcessor::SoftRefSubPhase1 && \\\n+#define ASSERT_SUB_PHASE(phase) assert((phase) >= ReferenceProcessor::SoftRefSubPhase2 && \\\n@@ -55,1 +55,1 @@\n-static const char* Phase1ParWorkTitle = \"Total (ms):\";\n+static const char* Phase2ParWorkTitle = \"Total (ms):\";\n@@ -65,1 +65,1 @@\n-static const char* Phase1SerWorkTitle = \"Total:\";\n+static const char* Phase2SerWorkTitle = \"Total:\";\n@@ -179,1 +179,1 @@\n-  _phase1_worker_time_sec = new WorkerDataArray<double>(NULL, Phase1ParWorkTitle, max_gc_threads);\n+  _phase2_worker_time_sec = new WorkerDataArray<double>(NULL, Phase2ParWorkTitle, max_gc_threads);\n@@ -215,1 +215,1 @@\n-  _phase1_worker_time_sec->reset();\n+  _phase2_worker_time_sec->reset();\n@@ -231,1 +231,1 @@\n-  delete _phase1_worker_time_sec;\n+  delete _phase2_worker_time_sec;\n@@ -279,1 +279,0 @@\n-  print_phase(ReferenceProcessor::RefPhase1, next_indent);\n@@ -282,0 +281,1 @@\n+  print_phase(ReferenceProcessor::RefPhase4, next_indent);\n@@ -332,5 +332,0 @@\n-      case ReferenceProcessor::RefPhase1:\n-        print_sub_phase(&ls, ReferenceProcessor::SoftRefSubPhase1, indent + 1);\n-        print_sub_phase(&ls, ReferenceProcessor::WeakRefSubPhase1, indent + 1);\n-        print_sub_phase(&ls, ReferenceProcessor::FinalRefSubPhase1, indent + 1);\n-        break;\n@@ -338,0 +333,2 @@\n+        print_sub_phase(&ls, ReferenceProcessor::SoftRefSubPhase2, indent + 1);\n+        print_sub_phase(&ls, ReferenceProcessor::WeakRefSubPhase2, indent + 1);\n@@ -341,1 +338,4 @@\n-        print_sub_phase(&ls, ReferenceProcessor::PhantomRefSubPhase3, indent + 1);\n+        print_sub_phase(&ls, ReferenceProcessor::FinalRefSubPhase3, indent + 1);\n+        break;\n+      case ReferenceProcessor::RefPhase4:\n+        print_sub_phase(&ls, ReferenceProcessor::PhantomRefSubPhase4, indent + 1);\n@@ -346,2 +346,2 @@\n-    if (phase == ReferenceProcessor::RefPhase1) {\n-      print_worker_time(&ls, _phase1_worker_time_sec, Phase1SerWorkTitle, indent + 1);\n+    if (phase == ReferenceProcessor::RefPhase2) {\n+      print_worker_time(&ls, _phase2_worker_time_sec, Phase2SerWorkTitle, indent + 1);\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessorPhaseTimes.cpp","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-  WorkerDataArray<double>* _phase1_worker_time_sec;\n+  WorkerDataArray<double>* _phase2_worker_time_sec;\n@@ -83,1 +83,1 @@\n-  WorkerDataArray<double>* phase1_worker_time_sec() const { return _phase1_worker_time_sec; }\n+  WorkerDataArray<double>* phase2_worker_time_sec() const { return _phase2_worker_time_sec; }\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessorPhaseTimes.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -139,1 +139,1 @@\n-        String phase1Regex = gcLogTimeRegex + phaseRegex(phaseNotifySoftWeakReferences) +\n+        String phase2Regex = gcLogTimeRegex + phaseRegex(phaseNotifySoftWeakReferences) +\n@@ -145,2 +145,2 @@\n-        String phase2Regex = gcLogTimeRegex + phaseRegex(phaseNotifyKeepAliveFinalizer) + balanceRegex + subphaseRegex(\"FinalRef\", p);\n-        String phase3Regex = gcLogTimeRegex + phaseRegex(phaseNotifyPhantomReferences) + balanceRegex + subphaseRegex(\"PhantomRef\", p);\n+        String phase3Regex = gcLogTimeRegex + phaseRegex(phaseNotifyKeepAliveFinalizer) + balanceRegex + subphaseRegex(\"FinalRef\", p);\n+        String phase4Regex = gcLogTimeRegex + phaseRegex(phaseNotifyPhantomReferences) + balanceRegex + subphaseRegex(\"PhantomRef\", p);\n@@ -149,1 +149,0 @@\n-                           phase1Regex +\n@@ -151,1 +150,2 @@\n-                           phase3Regex);\n+                           phase3Regex +\n+                           phase4Regex);\n","filename":"test\/hotspot\/jtreg\/gc\/logging\/TestPrintReferences.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"}]}