{"files":[{"patch":"@@ -391,0 +391,1 @@\n+    assert(current->current_pending_monitor() == NULL, \"invariant\");\n@@ -424,1 +425,4 @@\n-      exit(false, current);\n+      \/\/ make sure 'this' is still set as pending monitor so that exit()\n+      \/\/ doesn't set _previous_owner_tid for this special case.\n+      assert(current->current_pending_monitor() == this, \"invariant\");\n+      exit(current);\n@@ -1142,1 +1146,1 @@\n-void ObjectMonitor::exit(bool not_suspended, JavaThread* current) {\n+void ObjectMonitor::exit(JavaThread* current) {\n@@ -1181,3 +1185,5 @@\n-  \/\/ get the owner's thread id for the MonitorEnter event\n-  \/\/ if it is enabled and the thread isn't suspended\n-  if (not_suspended && EventJavaMonitorEnter::is_enabled()) {\n+  \/\/ Set _previous_owner_tid for the MonitorEnter event if it is enabled and\n+  \/\/ we legitimately owned this monitor. We can also get here if we need to self-suspend\n+  \/\/ in enter(), in which case we never really owned this monitor and so should not record\n+  \/\/ our thread id. In that case current_pending_monitor() is non-NULL.\n+  if (current->current_pending_monitor() == NULL && EventJavaMonitorEnter::is_enabled()) {\n@@ -1375,1 +1381,1 @@\n-  exit(true, current);     \/\/ exit the monitor\n+  exit(current);           \/\/ exit the monitor\n@@ -1509,1 +1515,1 @@\n-  exit(true, current);         \/\/ exit the monitor\n+  exit(current);               \/\/ exit the monitor\n","filename":"src\/hotspot\/share\/runtime\/objectMonitor.cpp","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -306,1 +306,1 @@\n-  void      exit(bool not_suspended, JavaThread* current);\n+  void      exit(JavaThread* current);\n","filename":"src\/hotspot\/share\/runtime\/objectMonitor.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -521,1 +521,1 @@\n-  monitor->exit(true, current);\n+  monitor->exit(current);\n@@ -611,1 +611,1 @@\n-    monitor->exit(true, current);\n+    monitor->exit(current);\n","filename":"src\/hotspot\/share\/runtime\/synchronizer.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}