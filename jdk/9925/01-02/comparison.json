{"files":[{"patch":"@@ -178,1 +178,9 @@\n-    off64_t offset = (off64_t)position;\n+    \/\/ Check whether the destination is in append mode: copy_file_range fails\n+    \/\/ with EBADF in this case and sendfile fails with EINVAL.\n+    int dstFlags = fcntl(dstFD, F_GETFL);\n+    if (dstFlags < 0) {\n+        JNU_ThrowIOExceptionWithLastError(env, \"Destination flags\");\n+        return IOS_THROWN;\n+    }\n+    if ((dstFlags & O_APPEND) != 0)\n+        return IOS_UNSUPPORTED_CASE;\n@@ -180,0 +188,1 @@\n+    off64_t offset = (off64_t)position;\n@@ -181,4 +190,1 @@\n-    int dstFlags;\n-    if (my_copy_file_range_func != NULL &&\n-        (dstFlags = fcntl(dstFD, F_GETFL)) != -1 &&\n-        (dstFlags & O_APPEND) == 0) { \/\/ don't use copy_file_range if appending\n+    if (my_copy_file_range_func) {\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/FileChannelImpl.c","additions":11,"deletions":5,"binary":false,"changes":16,"status":"modified"}]}