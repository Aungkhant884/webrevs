{"files":[{"patch":"@@ -181,2 +181,6 @@\n-    if (my_copy_file_range_func != NULL) {\n-        n = my_copy_file_range_func(srcFD, &offset, dstFD, NULL, count, 0);\n+    int dstFlags;\n+    if (my_copy_file_range_func != NULL &&\n+        (dstFlags = fcntl(dstFD, F_GETFL)) != -1 &&\n+        (dstFlags & O_APPEND) == 0) { \/\/ don't use copy_file_range if appending\n+        size_t len = (size_t)count;\n+        n = my_copy_file_range_func(srcFD, &offset, dstFD, NULL, len, 0);\n@@ -186,0 +190,1 @@\n+                    return IOS_INTERRUPTED;\n@@ -295,1 +300,2 @@\n-    jlong n = my_copy_file_range_func(srcFD, NULL, dstFD, &offset, count, 0);\n+    size_t len = (size_t)count;\n+    jlong n = my_copy_file_range_func(srcFD, NULL, dstFD, &offset, len, 0);\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/FileChannelImpl.c","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"}]}