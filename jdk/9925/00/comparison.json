{"files":[{"patch":"@@ -179,1 +179,21 @@\n-    jlong n = sendfile64(dstFD, srcFD, &offset, (size_t)count);\n+\n+    jlong n;\n+    if (my_copy_file_range_func != NULL) {\n+        n = my_copy_file_range_func(srcFD, &offset, dstFD, NULL, count, 0);\n+        if (n < 0) {\n+            switch (errno) {\n+                case EINTR:\n+                case EINVAL:\n+                case EXDEV:\n+                    \/\/ ignore and try sendfile()\n+                    break;\n+                default:\n+                    JNU_ThrowIOExceptionWithLastError(env, \"Copy failed\");\n+                    return IOS_THROWN;\n+            }\n+        }\n+        if (n >= 0)\n+            return n;\n+    }\n+\n+    n = sendfile64(dstFD, srcFD, &offset, (size_t)count);\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/FileChannelImpl.c","additions":21,"deletions":1,"binary":false,"changes":22,"status":"modified"}]}