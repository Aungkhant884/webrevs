{"files":[{"patch":"@@ -24,0 +24,2 @@\n+import java.util.concurrent.Semaphore;\n+\n@@ -27,1 +29,1 @@\n-    private Object thread_sync = null;\n+    private Semaphore mainSync = null;\n@@ -29,1 +31,1 @@\n-    public ClassLoadingThread(ClassLoader loader, Object sync) {\n+    public ClassLoadingThread(ClassLoader loader, Semaphore sem) {\n@@ -31,1 +33,1 @@\n-        thread_sync = sync;\n+        mainSync = sem;\n@@ -50,3 +52,3 @@\n-            \/\/ Wake up the second thread\n-            synchronized (thread_sync) {\n-                thread_sync.notify();\n+            \/\/ Signal main thread to start t2.\n+            if (mainSync != null) {\n+                mainSync.release();\n","filename":"test\/hotspot\/jtreg\/runtime\/ParallelLoad\/ClassLoadingThread.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -26,0 +26,1 @@\n+import java.util.concurrent.Semaphore;\n@@ -63,1 +64,0 @@\n-    private Object thread_sync = new Object();\n@@ -65,0 +65,1 @@\n+    private static Semaphore mainSem = new Semaphore(0);\n@@ -69,4 +70,3 @@\n-        \/\/ Wake up the second thread here.\n-        synchronized (thread_sync) {\n-            thread_sync.notify();\n-        }\n+        \/\/ Signal main thread to start t2.\n+        mainSem.release();\n+\n@@ -139,1 +139,1 @@\n-            threads[i] = new ClassLoadingThread(this, thread_sync);\n+            threads[i] = new ClassLoadingThread(this, parallel ? null : mainSem);\n@@ -145,6 +145,4 @@\n-                synchronized(thread_sync) {\n-                    try {\n-                        ThreadPrint.println(\"t2 waits\");\n-                        thread_sync.wait();\n-                    } catch (InterruptedException e) {}\n-                }\n+                try {\n+                    ThreadPrint.println(\"Main thread calls mainSem.acquire()\");\n+                    mainSem.acquire();\n+                } catch (InterruptedException e) {}\n","filename":"test\/hotspot\/jtreg\/runtime\/ParallelLoad\/MyLoader.java","additions":10,"deletions":12,"binary":false,"changes":22,"status":"modified"}]}