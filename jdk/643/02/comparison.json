{"files":[{"patch":"@@ -51,0 +51,1 @@\n+import jdk.javadoc.internal.doclets.toolkit.util.IndexItem;\n@@ -63,5 +64,0 @@\n-    \/**\n-     * The configuration used in this run of the standard doclet.\n-     *\/\n-    HtmlConfiguration configuration;\n-\n@@ -84,0 +80,2 @@\n+    private boolean hasConstants = false;\n+\n@@ -91,1 +89,0 @@\n-        this.configuration = configuration;\n@@ -187,0 +184,1 @@\n+        hasConstants = true;\n@@ -286,0 +284,5 @@\n+\n+        if (hasConstants && configuration.mainIndex != null) {\n+            configuration.mainIndex.add(IndexItem.of(IndexItem.Category.TAGS,\n+                    resources.getText(\"doclet.Constants_Summary\"), path));\n+        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/ConstantsSummaryWriterImpl.java","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+import java.util.Collection;\n@@ -106,1 +107,0 @@\n-    public final Content framesLabel;\n@@ -144,1 +144,0 @@\n-    public final Content noFramesLabel;\n@@ -192,1 +191,1 @@\n-        allClassesLabel = getNonBreakContent(\"doclet.All_Classes\");\n+        allClassesLabel = getNonBreakResource(\"doclet.All_Classes\");\n@@ -194,2 +193,2 @@\n-        allModulesLabel = getNonBreakContent(\"doclet.All_Modules\");\n-        allPackagesLabel = getNonBreakContent(\"doclet.All_Packages\");\n+        allModulesLabel = getNonBreakResource(\"doclet.All_Modules\");\n+        allPackagesLabel = getNonBreakResource(\"doclet.All_Packages\");\n@@ -242,1 +241,0 @@\n-        framesLabel = getContent(\"doclet.Frames\");\n@@ -280,1 +278,0 @@\n-        noFramesLabel = getNonBreakContent(\"doclet.No_Frames\");\n@@ -403,0 +400,21 @@\n+    \/**\n+     * Returns content composed of items joined together with the specified separator.\n+     *\n+     * @param separator the separator\n+     * @param items     the items\n+     * @return the content\n+     *\/\n+    public Content join(Content separator, Collection<Content> items) {\n+        Content result = new ContentBuilder();\n+        boolean first = true;\n+        for (Content c : items) {\n+            if (first) {\n+                first = false;\n+            } else {\n+                result.add(separator);\n+            }\n+            result.add(c);\n+        }\n+        return result;\n+    }\n+\n@@ -412,2 +430,13 @@\n-    private Content getNonBreakContent(String key) {\n-        String text = resources.getText(key); \/\/ TODO: cache\n+    private Content getNonBreakResource(String key) {\n+        return getNonBreakString(resources.getText(key));\n+    }\n+\n+    \/**\n+     * Gets a {@code Content} object for a string, substituting\n+     * <code>&nbsp;<\/code> for any space characters found in\n+     * the named resource string.\n+     *\n+     * @param text the string\n+     * @return a content tree for the string\n+     *\/\n+    public Content getNonBreakString(String text) {\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Contents.java","additions":38,"deletions":9,"binary":false,"changes":47,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+import jdk.javadoc.internal.doclets.toolkit.util.IndexItem;\n@@ -303,0 +304,5 @@\n+\n+        if (!deprapi.isEmpty() && configuration.mainIndex != null) {\n+            configuration.mainIndex.add(IndexItem.of(IndexItem.Category.TAGS,\n+                    resources.getText(\"doclet.Deprecated_API\"), path));\n+        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/DeprecatedListWriter.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -174,1 +174,0 @@\n-            IndexWriter.generate(configuration);\n@@ -182,0 +181,1 @@\n+            IndexWriter.generate(configuration);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDoclet.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -166,1 +166,1 @@\n-            IndexItem item = IndexItem.of(IndexItem.Category.PACKAGES,\n+            IndexItem item = IndexItem.of(IndexItem.Category.TAGS,\n@@ -171,1 +171,1 @@\n-        IndexItem item = IndexItem.of(IndexItem.Category.TYPES,\n+        IndexItem item = IndexItem.of(IndexItem.Category.TAGS,\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlIndexBuilder.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -31,0 +31,2 @@\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;\n@@ -372,16 +374,8 @@\n-\n-        contentTree.add(links.createLink(pathToRoot.resolve(DocPaths.ALLCLASSES_INDEX),\n-                contents.allClassesLabel));\n-\n-        if (!configuration.packages.isEmpty()) {\n-            contentTree.add(getVerticalSeparator());\n-            contentTree.add(links.createLink(pathToRoot.resolve(DocPaths.ALLPACKAGES_INDEX),\n-                    contents.allPackagesLabel));\n-        }\n-\n-        boolean anySystemProperties = !mainIndex.getItems(DocTree.Kind.SYSTEM_PROPERTY).isEmpty();\n-        if (anySystemProperties) {\n-            contentTree.add(getVerticalSeparator());\n-            contentTree.add(links.createLink(pathToRoot.resolve(DocPaths.SYSTEM_PROPERTIES),\n-                    contents.systemPropertiesLabel));\n-        }\n+        List<Content> pageLinks = Stream.of(IndexItem.Category.values())\n+                .flatMap(c -> mainIndex.getItems(c).stream())\n+                .filter(i -> !(i.isElementItem() || i.isTagItem()))\n+                .sorted((i1,i2)-> utils.compareStrings(i1.getLabel(), i2.getLabel()))\n+                .map(i -> links.createLink(pathToRoot.resolve(i.getUrl()),\n+                        contents.getNonBreakString(i.getLabel())))\n+                .collect(Collectors.toList());\n+        contentTree.add(contents.join(getVerticalSeparator(), pageLinks));\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/IndexWriter.java","additions":10,"deletions":16,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -43,0 +43,1 @@\n+import jdk.javadoc.internal.doclets.toolkit.util.IndexItem;\n@@ -253,0 +254,5 @@\n+\n+        if (configuration.mainIndex != null) {\n+            configuration.mainIndex.add(IndexItem.of(IndexItem.Category.TAGS,\n+                    resources.getText(\"doclet.Serialized_Form\"), path));\n+        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/SerializedFormWriterImpl.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -129,0 +129,4 @@\n+\n+        if (configuration.mainIndex != null) {\n+            configuration.mainIndex.add(IndexItem.of(IndexItem.Category.TAGS, title, path));\n+        }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/SystemPropertiesWriter.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -115,2 +115,0 @@\n-doclet.Frames=Frames\n-doclet.No_Frames=No Frames\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/resources\/standard.properties","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -52,0 +52,1 @@\n+\n@@ -68,0 +69,1 @@\n+\n@@ -84,0 +86,4 @@\n+    public boolean isEmpty() {\n+        return deprecatedMap.values().stream().allMatch(Collection::isEmpty);\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/DeprecatedAPIListBuilder.java","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -166,1 +166,4 @@\n-        itemsByFirstChar.computeIfAbsent(keyCharacter(item.getLabel()),\n+        if (item.isElementItem() || item.isTagItem()) {\n+            \/\/ don't put summary-page items in the A-Z index:\n+            \/\/ they are listed separately, at the top of the index page\n+            itemsByFirstChar.computeIfAbsent(keyCharacter(item.getLabel()),\n@@ -168,1 +171,2 @@\n-                .add(item);\n+                    .add(item);\n+        }\n@@ -213,1 +217,1 @@\n-                .filter(i -> i.getDocTree().getKind() == kind)\n+                .filter(i -> i.isKind(kind))\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/IndexBuilder.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -424,0 +424,10 @@\n+    \/**\n+     * Returns {@code true} if this index is for a specific kind of tag in a doc comment.\n+     *\n+     * @return {@code true} if this index is for a specific kind of tag in a doc comment\n+     *\/\n+    public boolean isKind(DocTree.Kind kind) {\n+        DocTree dt = getDocTree();\n+        return dt != null && dt.getKind() == kind;\n+    }\n+\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/IndexItem.java","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2663,1 +2663,1 @@\n-     * @see CommentUtils.dcInfoMap\n+     * @see CommentUtils#dcInfoMap\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/util\/Utils.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1423,1 +1423,1 @@\n-        checkOutput(\"type-search-index.js\", true,\n+        checkOutput(\"tag-search-index.js\", true,\n@@ -1425,4 +1425,1 @@\n-                    {\"l\":\"All Classes\",\"u\":\"allclasses-index.html\"}\"\"\");\n-        checkOutput(\"package-search-index.js\", true,\n-                \"\"\"\n-                    {\"l\":\"All Packages\",\"u\":\"allpackages-index.html\"}\"\"\");\n+                    {\"l\":\"All Classes\",\"h\":\"\",\"u\":\"allclasses-index.html\"},{\"l\":\"All Packages\",\"h\":\"\",\"u\":\"allpackages-index.html\"}\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testModules\/TestModules.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -73,4 +73,0 @@\n-    private static final String[][] TEST1 = {\n-    };\n-\n-\n@@ -106,4 +102,1 @@\n-        checkOutput(\"type-search-index.js\", true,\n-                \"\"\"\n-                    {\"l\":\"All Classes\",\"u\":\"allclasses-index.html\"}\"\"\");\n-        checkOutput(\"package-search-index.js\", true,\n+        checkOutput(\"tag-search-index.js\", true,\n@@ -111,1 +104,1 @@\n-                    {\"l\":\"All Packages\",\"u\":\"allpackages-index.html\"}\"\"\");\n+                    {\"l\":\"All Classes\",\"h\":\"\",\"u\":\"allclasses-index.html\"},{\"l\":\"All Packages\",\"h\":\"\",\"u\":\"allpackages-index.html\"}\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testPackagePage\/TestPackagePage.java","additions":2,"deletions":9,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -858,1 +858,1 @@\n-        checkOutput(\"type-search-index.js\", true,\n+        checkOutput(\"tag-search-index.js\", true,\n@@ -860,4 +860,1 @@\n-                    {\"l\":\"All Classes\",\"u\":\"allclasses-index.html\"}\"\"\");\n-        checkOutput(\"package-search-index.js\", true,\n-                \"\"\"\n-                    {\"l\":\"All Packages\",\"u\":\"allpackages-index.html\"}\"\"\");\n+                    {\"l\":\"All Classes\",\"h\":\"\",\"u\":\"allclasses-index.html\"},{\"l\":\"All Packages\",\"h\":\"\",\"u\":\"allpackages-index.html\"}\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSearch\/TestSearch.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -26,1 +26,1 @@\n- * @bug 8215038 8239487 8240476\n+ * @bug 8215038 8239487 8240476 8253559\n@@ -66,1 +66,1 @@\n-                    <a href=\"system-properties.html\">System Properties<\/a>\"\"\");\n+                    <a href=\"system-properties.html\">System&nbsp;Properties<\/a>\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testSystemPropertyPage\/TestSystemPropertyPage.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -97,1 +97,1 @@\n-        checkOutput(\"type-search-index.js\", true,\n+        checkOutput(\"tag-search-index.js\", true,\n@@ -99,5 +99,1 @@\n-                    {\"l\":\"All Classes\",\"u\":\"allclasses-index.html\"}\"\"\");\n-\n-        checkOutput(\"package-search-index.js\", true,\n-                \"\"\"\n-                    {\"l\":\"All Packages\",\"u\":\"allpackages-index.html\"}\"\"\");\n+                    {\"l\":\"All Classes\",\"h\":\"\",\"u\":\"allclasses-index.html\"},{\"l\":\"All Packages\",\"h\":\"\",\"u\":\"allpackages-index.html\"}\"\"\");\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testUnnamedPackage\/TestUnnamedPackage.java","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"}]}