{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2013, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -1137,1 +1137,1 @@\n-    private boolean checkName(String name) {\n+    private static boolean checkName(String name) {\n@@ -1257,1 +1257,1 @@\n-    Class<?> findBootstrapClassOrNull(String name) {\n+    static Class<?> findBootstrapClassOrNull(String name) {\n@@ -1264,1 +1264,1 @@\n-    private native Class<?> findBootstrapClass(String name);\n+    private static native Class<?> findBootstrapClass(String name);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/ClassLoader.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2221,2 +2221,2 @@\n-            public Class<?> findBootstrapClassOrNull(ClassLoader cl, String name) {\n-                return cl.findBootstrapClassOrNull(name);\n+            public Class<?> findBootstrapClassOrNull(String name) {\n+                return ClassLoader.findBootstrapClassOrNull(name);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/System.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -164,1 +164,1 @@\n-    Class<?> findBootstrapClassOrNull(ClassLoader cl, String name);\n+    Class<?> findBootstrapClassOrNull(String name);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/access\/JavaLangAccess.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2020, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,1 +50,1 @@\n-        servicesCatalogs[0] = BootLoader.getServicesCatalog();\n+        servicesCatalogs[0] = ServicesCatalog.getServicesCatalog(bootLoader);\n@@ -70,1 +70,1 @@\n-        if (loader == null) {\n+        if (loader == bootLoader) {\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/loader\/ArchivedClassLoaders.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,0 +58,2 @@\n+    private static final JavaLangAccess JLA = SharedSecrets.getJavaLangAccess();\n+\n@@ -67,11 +69,0 @@\n-    \/\/ ServiceCatalog for the boot class loader\n-    private static final ServicesCatalog SERVICES_CATALOG;\n-    static {\n-        ArchivedClassLoaders archivedClassLoaders = ArchivedClassLoaders.get();\n-        if (archivedClassLoaders != null) {\n-            SERVICES_CATALOG = archivedClassLoaders.servicesCatalog(null);\n-        } else {\n-            SERVICES_CATALOG = ServicesCatalog.create();\n-        }\n-    }\n-\n@@ -97,1 +88,1 @@\n-        return SERVICES_CATALOG;\n+        return ServicesCatalog.getServicesCatalog(ClassLoaders.bootLoader());\n@@ -134,1 +125,1 @@\n-        return ClassLoaders.bootLoader().loadClassOrNull(name);\n+        return JLA.findBootstrapClassOrNull(name);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/loader\/BootLoader.java","additions":5,"deletions":14,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,0 +58,6 @@\n+    \/\/ Sets the ServicesCatalog for the specified loader using archived objects.\n+    private static void setArchivedServicesCatalog(ClassLoader loader) {\n+        ServicesCatalog catalog = ArchivedClassLoaders.get().servicesCatalog(loader);\n+        ServicesCatalog.putServicesCatalog(loader, catalog);\n+    }\n+\n@@ -64,0 +70,1 @@\n+            setArchivedServicesCatalog(BOOT_LOADER);\n@@ -65,2 +72,1 @@\n-            ServicesCatalog catalog = archivedClassLoaders.servicesCatalog(PLATFORM_LOADER);\n-            ServicesCatalog.putServicesCatalog(PLATFORM_LOADER, catalog);\n+            setArchivedServicesCatalog(PLATFORM_LOADER);\n@@ -89,2 +95,1 @@\n-            ServicesCatalog catalog = archivedClassLoaders.servicesCatalog(APP_LOADER);\n-            ServicesCatalog.putServicesCatalog(APP_LOADER, catalog);\n+            setArchivedServicesCatalog(APP_LOADER);\n@@ -135,1 +140,1 @@\n-            return JLA.findBootstrapClassOrNull(this, cn);\n+            return JLA.findBootstrapClassOrNull(cn);\n","filename":"src\/java.base\/share\/classes\/jdk\/internal\/loader\/ClassLoaders.java","additions":11,"deletions":6,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1996, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1996, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -277,1 +277,1 @@\n-Java_java_lang_ClassLoader_findBootstrapClass(JNIEnv *env, jobject loader,\n+Java_java_lang_ClassLoader_findBootstrapClass(JNIEnv *env, jclass dummy,\n","filename":"src\/java.base\/share\/native\/libjava\/ClassLoader.c","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -49,1 +49,1 @@\n-            cls = jla.findBootstrapClassOrNull(appLoader, className);\n+            cls = jla.findBootstrapClassOrNull(className);\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/test-classes\/EmptyClassHelper.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}