{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -38,1 +38,1 @@\n- * @LastModified: Oct 2017\n+ * @LastModified: June 2021\n@@ -97,2 +97,2 @@\n-        final String name = variable.getName().getStringRep();\n-        return (Variable)_variables.put(name, variable);\n+        VariableBase v = _variables.put(variable.getName().getStringRep(), variable);\n+        return v instanceof Variable ? (Variable)v : null;\n@@ -103,2 +103,2 @@\n-        final String name = parameter.getName().getStringRep();\n-        return (Param)_variables.put(name, parameter);\n+        VariableBase v = _variables.put(parameter.getName().getStringRep(), parameter);\n+        return v instanceof Param ? (Param)v : null;\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xalan\/internal\/xsltc\/compiler\/SymbolTable.java","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -0,0 +1,64 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+package transform;\n+\n+import java.io.StringReader;\n+import javax.xml.transform.TransformerFactory;\n+import javax.xml.transform.stream.StreamSource;\n+import org.testng.annotations.Test;\n+\n+\/*\n+ * @test\n+ * @bug 8264766\n+ * @run testng transform.SymbolTableTest\n+ * @summary Tests SymbolTable\n+ *\/\n+public class SymbolTableTest {\n+    \/**\n+     * Verifies that the SymbolTable processes (adds) variables and params\n+     * properly. The SymbolTable holds variables and params in a map, it shall\n+     * therefore perform a type check before cast, or else result in a\n+     * ClassCastException when variables and\/or params have the same name (in\n+     * which case the later ones shadow the previous ones).\n+     *\n+     * @throws Exception if the test fails\n+     *\/\n+    @Test\n+    public void test() throws Exception {\n+        TransformerFactory transformerFactory = TransformerFactory.newInstance();\n+        String stylesheet = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" +\n+                \"<xsl:stylesheet xmlns:xsl=\\\"http:\/\/www.w3.org\/1999\/XSL\/Transform\\\" version=\\\"1.0\\\">\\n\" +\n+                \" <xsl:variable name=\\\"background-color\\\">#f4f4f4<\/xsl:variable>\\n\" +\n+                \" <xsl:param name=\\\"background-color\\\">pp<\/xsl:param>\\n\" +\n+                \" <xsl:template name=\\\"tName\\\"><xsl:param name=\\\"background-color\\\">black<\/xsl:param>\\n\" +\n+                \" OK <xsl:value-of select=\\\"$background-color\\\"\/>\\n\" +\n+                \" <\/xsl:template>\\n\" +\n+                \" <xsl:template match=\\\"\/root\\\">\\n\" +\n+                \" <xsl:call-template name=\\\"tName\\\">\\n\" +\n+                \" <xsl:with-param name=\\\"background-color\\\" select=\\\"$background-color\\\"\/>\\n\" +\n+                \" <\/xsl:call-template>\\n\" +\n+                \" <\/xsl:template>\\n\" +\n+                \"<\/xsl:stylesheet>\\n\";\n+        transformerFactory.newTransformer(new StreamSource(new StringReader(stylesheet)));\n+    }\n+}\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/transform\/SymbolTableTest.java","additions":64,"deletions":0,"binary":false,"changes":64,"status":"added"}]}