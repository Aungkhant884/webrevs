{"files":[{"patch":"@@ -1040,1 +1040,1 @@\n-                    if (inetAddresses == null) {\n+                    if (inetAddresses == null || inetAddresses.length == 0) {\n@@ -1661,2 +1661,3 @@\n-\n-        if (addresses == null) {\n+        InetAddress[] result = addresses == null ? null\n+                : addresses.toArray(InetAddress[]::new);\n+        if (result == null || result.length == 0) {\n@@ -1665,1 +1666,1 @@\n-        return addresses.toArray(InetAddress[]::new);\n+        return result;\n","filename":"src\/java.base\/share\/classes\/java\/net\/InetAddress.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -44,0 +44,2 @@\n+ *\n+ * @since 18\n@@ -94,0 +96,2 @@\n+     *\n+     * @since 18\n","filename":"src\/java.base\/share\/classes\/java\/net\/spi\/InetAddressResolver.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -45,0 +45,2 @@\n+ *\n+ * @since 18\n@@ -112,0 +114,2 @@\n+     *\n+     * @since 18\n","filename":"src\/java.base\/share\/classes\/java\/net\/spi\/InetAddressResolverProvider.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,52 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import org.testng.Assert;\n+import org.testng.annotations.Test;\n+\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.util.Arrays;\n+\n+\/*\n+ * @test\n+ * @summary checks that InetAddress forward lookup API throw UnknownHostException\n+ *   when resolver returns empty address stream.\n+ * @library providers\/empty\n+ * @build empty.results.provider\/impl.EmptyResultsProviderImpl\n+ * @run testng\/othervm EmptyResultsStreamTest\n+ *\/\n+public class EmptyResultsStreamTest {\n+\n+    @Test(expectedExceptions = UnknownHostException.class)\n+    public void getAllByNameTest() throws UnknownHostException {\n+        System.err.println(\"getAllByName unexpectedly completed: \" +\n+                Arrays.deepToString(InetAddress.getAllByName(\"test1.org\")));\n+    }\n+\n+    @Test(expectedExceptions = UnknownHostException.class)\n+    public void getByNameTest() throws UnknownHostException {\n+        System.err.println(\"getByName unexpectedly completed: \" +\n+                InetAddress.getByName(\"test2.org\"));\n+    }\n+}\n","filename":"test\/jdk\/java\/net\/spi\/InetAddressResolverProvider\/EmptyResultsStreamTest.java","additions":52,"deletions":0,"binary":false,"changes":52,"status":"added"},{"patch":"@@ -0,0 +1,56 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package impl;\n+\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.net.spi.InetAddressResolver;\n+import java.net.spi.InetAddressResolverProvider;\n+import java.util.stream.Stream;\n+\n+public class EmptyResultsProviderImpl extends InetAddressResolverProvider {\n+    @Override\n+    public InetAddressResolver get(Configuration configuration) {\n+        System.out.println(\"The following provider will be used by current test:\" +\n+                this.getClass().getCanonicalName());\n+\n+        return new InetAddressResolver() {\n+            @Override\n+            public Stream<InetAddress> lookupAddresses(String host, LookupPolicy lookupPolicy)\n+                    throws UnknownHostException {\n+                return Stream.empty();\n+            }\n+\n+            @Override\n+            public String lookupHostName(byte[] addr) throws UnknownHostException {\n+                return configuration.builtinResolver().lookupHostName(addr);\n+            }\n+        };\n+    }\n+\n+    @Override\n+    public String name() {\n+        return \"EmptyForwardLookupResultsProvider\";\n+    }\n+}\n","filename":"test\/jdk\/java\/net\/spi\/InetAddressResolverProvider\/providers\/empty\/empty.results.provider\/impl\/EmptyResultsProviderImpl.java","additions":56,"deletions":0,"binary":false,"changes":56,"status":"added"},{"patch":"@@ -0,0 +1,29 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+*\/\n+\n+import java.net.spi.InetAddressResolverProvider;\n+\n+module empty.results.provider {\n+    exports impl;\n+    provides InetAddressResolverProvider with impl.EmptyResultsProviderImpl;\n+}\n","filename":"test\/jdk\/java\/net\/spi\/InetAddressResolverProvider\/providers\/empty\/empty.results.provider\/module-info.java","additions":29,"deletions":0,"binary":false,"changes":29,"status":"added"}]}