{"files":[{"patch":"@@ -105,7 +105,10 @@\n-#define SAFEPOINT                                                      \\\n-    {                                                                  \\\n-       \/* zap freed handles rather than GC'ing them *\/                 \\\n-       HandleMarkCleaner __hmc(THREAD);                                \\\n-       if (SafepointMechanism::should_process(THREAD)) {               \\\n-         CALL_VM({ThreadInVMfromJava tiv(THREAD);}, handle_exception); \\\n-       }                                                               \\\n+#define SAFEPOINT                                                    \\\n+    {                                                                \\\n+       \/* zap freed handles rather than GC'ing them *\/               \\\n+       HandleMarkCleaner __hmc(THREAD);                              \\\n+       if (SafepointMechanism::should_process(THREAD)) {             \\\n+         CALL_VM(SafepointMechanism::process_if_requested(THREAD);   \\\n+                 if (THREAD->has_special_runtime_exit_condition()) { \\\n+                   THREAD->handle_special_runtime_exit_condition();  \\\n+                 }, handle_exception);                               \\\n+       }                                                             \\\n","filename":"src\/hotspot\/share\/interpreter\/zero\/bytecodeInterpreter.cpp","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -934,2 +934,3 @@\n-    {\n-      ThreadInVMfromJava tivm(self);\n+    SafepointMechanism::process_if_requested(self);\n+    if (self->has_special_runtime_exit_condition()) {\n+      self->handle_special_runtime_exit_condition();\n@@ -952,1 +953,2 @@\n-    {\n+    SafepointMechanism::process_if_requested(self);\n+    if (self->has_special_runtime_exit_condition()) {\n@@ -958,1 +960,1 @@\n-      ThreadInVMfromJavaNoAsyncException tivm(self);\n+      self->handle_special_runtime_exit_condition(false \/* check asyncs *\/);\n","filename":"src\/hotspot\/share\/runtime\/safepoint.cpp","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2502,2 +2502,3 @@\n-\n-  thread->handle_special_runtime_exit_condition(false);\n+  if (thread->has_special_runtime_exit_condition()) {\n+    thread->handle_special_runtime_exit_condition(false \/* check asyncs *\/);\n+  }\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}