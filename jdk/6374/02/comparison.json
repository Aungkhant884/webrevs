{"files":[{"patch":"@@ -147,1 +147,2 @@\n-        painter.paint(g, c, 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight());\n+        Rectangle trackBounds = getTrackBounds();\n+        painter.paint(g, c, trackBounds.x, trackBounds.y, trackBounds.width, trackBounds.height);\n@@ -191,1 +192,4 @@\n-        return new Rectangle(0, 0, fScrollBar.getWidth(), fScrollBar.getHeight());\n+        Insets insets = fScrollBar.getInsets();\n+        return new Rectangle(insets.left, 0,\n+                fScrollBar.getWidth() - (insets.left + insets.right),\n+                fScrollBar.getHeight());\n@@ -195,1 +199,4 @@\n-        return new Rectangle(0, 0, fScrollBar.getWidth(), fScrollBar.getHeight());\n+        Insets insets = fScrollBar.getInsets();\n+        return new Rectangle(insets.left, 0,\n+            fScrollBar.getWidth() - (insets.left + insets.right),\n+            fScrollBar.getHeight());\n@@ -231,1 +238,3 @@\n-        return JRSUIUtils.HitDetection.getHitForPoint(painter.getControl(), 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight(), x, y);\n+        Insets insets = fScrollBar.getInsets();\n+        return JRSUIUtils.HitDetection.getHitForPoint(painter.getControl(), 0, 0,\n+                fScrollBar.getWidth() - (insets.left + insets.right), fScrollBar.getHeight(), x, y);\n@@ -347,1 +356,3 @@\n-            final double offsetChange = JRSUIUtils.ScrollBar.getNativeOffsetChange(painter.getControl(), 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight(), offsetWeCareAbout, visibleAmt, extent);\n+            final Rectangle limitRect = getDragBounds(); \/\/ GetThemeTrackDragRect\n+            final double offsetChange = JRSUIUtils.ScrollBar.getNativeOffsetChange(painter.getControl(),\n+                    limitRect.x, limitRect.y, limitRect.width, limitRect.height, offsetWeCareAbout, visibleAmt, extent);\n@@ -600,1 +611,1 @@\n-        JRSUIUtils.ScrollBar.getPartBounds(rect, painter.getControl(), 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight(), ScrollBarPart.THUMB);\n+        JRSUIUtils.ScrollBar.getPartBounds(rect, painter.getControl(), limitRect.x, limitRect.y, limitRect.width, limitRect.height, ScrollBarPart.THUMB);\n","filename":"src\/java.desktop\/macosx\/classes\/com\/apple\/laf\/AquaScrollBarUI.java","additions":17,"deletions":6,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -0,0 +1,196 @@\n+import javax.swing.JScrollBar;\n+import javax.swing.JPanel;\n+import javax.swing.JFrame;\n+import javax.swing.BoxLayout;\n+import javax.swing.JLabel;\n+import javax.swing.Box;\n+import javax.swing.UIManager;\n+import javax.swing.border.Border;\n+import javax.swing.border.EmptyBorder;\n+import java.awt.Frame;\n+import java.awt.GridBagLayout;\n+import java.awt.GridBagConstraints;\n+import java.awt.Panel;\n+import java.awt.TextArea;\n+import java.awt.Button;\n+import java.awt.Scrollbar;\n+import java.awt.Component;\n+import java.awt.Graphics;\n+import java.awt.Color;\n+import java.awt.Insets;\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n+\n+\/*\n+ * @test\n+ * @run main\/manual ScrollBarBorderTest\n+ *\/\n+public class ScrollBarBorderTest implements ActionListener {\n+\n+    \/\/ On macOS 10.12.6 using the Mac look and feel (com.apple.laf.AquaLookAndFeel)\n+    \/\/ the scroll bar ignores the custom border and allows the scroll thumb to move\n+    \/\/ beneath the border. Run with:\n+    \/\/ java ScrollBarBorderTest\n+\n+    \/\/ If run using any other look and feel (e.g. Metal) then the right side of\n+    \/\/ the scroll bar stops at the border as expected. Run with:\n+    \/\/ java -Dswing.defaultlaf=javax.swing.plaf.metal.MetalLookAndFeel ScrollBarBorderTest\n+\n+    \/\/ Java version: 1.8.0_151\n+\n+    private static JScrollBar scrollBar;\n+    private static JPanel panel;\n+    private static JFrame frame;\n+    private static Frame instructionFrame;\n+    private static GridBagLayout layout;\n+    private static Panel mainControlPanel;\n+    private static Panel resultButtonPanel;\n+    private static TextArea instructionTextArea;\n+    private static Button passButton;\n+    private static Button failButton;\n+    private static Thread mainThread = null;\n+    private static boolean testPassed = false;\n+    private static boolean isInterrupted = false;\n+    private static final int testTimeOut = 300000;\n+    private static String testFailMessage = \"Test Failed. Thumb was able to move into border.\";\n+\n+\n+    public void createAndShowGUI() {\n+        \/\/ create scroll bar\n+        scrollBar = new JScrollBar(Scrollbar.HORIZONTAL);\n+        scrollBar.setBorder(new CustomBorder());\n+\n+        \/\/ create panel\n+        panel = new JPanel();\n+        panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));\n+        panel.setBorder(new EmptyBorder(20, 20, 20, 20));\n+        panel.add(new JLabel(UIManager.getLookAndFeel().toString()));\n+        panel.add(Box.createVerticalStrut(20));\n+        panel.add(scrollBar);\n+\n+        \/\/ create frame\n+        frame = new JFrame(\"ScrollBarBorderTest\");\n+        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+        frame.getContentPane().add(panel);\n+        frame.pack();\n+        frame.setVisible(true);\n+    }\n+\n+    private void createInstructionUI() {\n+        instructionFrame = new Frame(\"Scrollbar\");\n+        layout = new GridBagLayout();\n+        mainControlPanel = new Panel(layout);\n+        resultButtonPanel = new Panel(layout);\n+\n+        GridBagConstraints gbc = new GridBagConstraints();\n+        String instructions\n+                = \"\\nINSTRUCTIONS:\\n\"\n+                + \"\\n   Try to drag the thumb of the scrollbar into the red zone.\"\n+                + \"\\n   If the thumb is able to go into the red zone, click fail.\"\n+                + \"\\n   Otherwise, pass.\";\n+\n+        instructionTextArea = new TextArea(7, 70);\n+        instructionTextArea.setText(instructions);\n+        instructionTextArea.setEnabled(false);\n+        instructionTextArea.setBackground(Color.white);\n+\n+        gbc.gridx = 0;\n+        gbc.gridy = 0;\n+        gbc.weightx = 0.5;\n+        gbc.fill = GridBagConstraints.HORIZONTAL;\n+        mainControlPanel.add(instructionTextArea, gbc);\n+\n+        passButton = new Button(\"Pass\");\n+        passButton.setName(\"Pass\");\n+        passButton.addActionListener((ActionListener) this);\n+\n+        failButton = new Button(\"Fail\");\n+        failButton.setName(\"Fail\");\n+        failButton.addActionListener((ActionListener) this);\n+\n+        setButtonEnable(true);\n+\n+        gbc.gridx = 0;\n+        gbc.gridy = 0;\n+        resultButtonPanel.add(passButton, gbc);\n+        gbc.gridx = 1;\n+        gbc.gridy = 0;\n+        resultButtonPanel.add(failButton, gbc);\n+        gbc.gridx = 0;\n+        gbc.gridy = 1;\n+        mainControlPanel.add(resultButtonPanel, gbc);\n+\n+        instructionFrame.add(mainControlPanel);\n+        instructionFrame.pack();\n+        instructionFrame.setVisible(true);\n+    }\n+\n+    @Override\n+    public void actionPerformed(ActionEvent ae) {\n+        if (ae.getSource() instanceof Button) {\n+            Button btn = (Button) ae.getSource();\n+            switch (btn.getName()) {\n+                case \"Pass\":\n+                    testPassed = true;\n+                    isInterrupted = true;\n+                    mainThread.interrupt();\n+                    break;\n+                case \"Fail\":\n+                    testPassed = false;\n+                    isInterrupted = true;\n+                    mainThread.interrupt();\n+                    break;\n+            }\n+        }\n+    }\n+\n+    private static void setButtonEnable(boolean status) {\n+        passButton.setEnabled(status);\n+        failButton.setEnabled(status);\n+    }\n+\n+    private static void cleanUp() {\n+        frame.dispose();\n+        instructionFrame.dispose();\n+    }\n+\n+    public static void main(String[] args) {\n+        ScrollBarBorderTest borderTest = new ScrollBarBorderTest();\n+        borderTest.createInstructionUI();\n+        borderTest.createAndShowGUI();\n+\n+        mainThread = Thread.currentThread();\n+        try {\n+            mainThread.sleep(testTimeOut);\n+        } catch (InterruptedException ex) {\n+            if (!testPassed) {\n+                throw new RuntimeException(testFailMessage);\n+            }\n+        } finally {\n+            cleanUp();\n+        }\n+\n+        if (!isInterrupted) {\n+            throw new RuntimeException(\"Test Timed out after \"\n+                    + testTimeOut \/ 1000 + \" seconds\");\n+        }\n+    }\n+\n+\n+    \/\/ custom border\n+    private static class CustomBorder implements Border {\n+        public void paintBorder(Component c, Graphics g, int x, int y, int width, int height) {\n+            g.setColor(new Color(255, 0, 0, 100));\n+            g.fillRect(width - 150, y, width, height);\n+        }\n+\n+        public Insets getBorderInsets(Component c) {\n+            return new Insets(0, 0, 0, 150);\n+        }\n+\n+        public boolean isBorderOpaque() {\n+            return true;\n+        }\n+    }\n+\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/java\/awt\/Scrollbar\/AquaLFScrollbarTest\/ScrollBarBorderTest.java","additions":196,"deletions":0,"binary":false,"changes":196,"status":"added"}]}