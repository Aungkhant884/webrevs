{"files":[{"patch":"@@ -147,1 +147,2 @@\n-        painter.paint(g, c, 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight());\n+        Rectangle trackBounds = getTrackBounds();\n+        painter.paint(g, c, trackBounds.x, trackBounds.y, trackBounds.width, trackBounds.height);\n@@ -191,1 +192,4 @@\n-        return new Rectangle(0, 0, fScrollBar.getWidth(), fScrollBar.getHeight());\n+        Insets insets = fScrollBar.getInsets();\n+        return new Rectangle(insets.left, 0,\n+                fScrollBar.getWidth() - (insets.left + insets.right),\n+                fScrollBar.getHeight());\n@@ -195,1 +199,4 @@\n-        return new Rectangle(0, 0, fScrollBar.getWidth(), fScrollBar.getHeight());\n+        Insets insets = fScrollBar.getInsets();\n+        return new Rectangle(insets.left, 0,\n+            fScrollBar.getWidth() - (insets.left + insets.right),\n+            fScrollBar.getHeight());\n@@ -231,1 +238,3 @@\n-        return JRSUIUtils.HitDetection.getHitForPoint(painter.getControl(), 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight(), x, y);\n+        Insets insets = fScrollBar.getInsets();\n+        return JRSUIUtils.HitDetection.getHitForPoint(painter.getControl(), 0, 0,\n+                fScrollBar.getWidth() - (insets.left + insets.right), fScrollBar.getHeight(), x, y);\n@@ -347,1 +356,3 @@\n-            final double offsetChange = JRSUIUtils.ScrollBar.getNativeOffsetChange(painter.getControl(), 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight(), offsetWeCareAbout, visibleAmt, extent);\n+            final Rectangle limitRect = getDragBounds(); \/\/ GetThemeTrackDragRect\n+            final double offsetChange = JRSUIUtils.ScrollBar.getNativeOffsetChange(painter.getControl(),\n+                    limitRect.x, limitRect.y, limitRect.width, limitRect.height, offsetWeCareAbout, visibleAmt, extent);\n@@ -600,1 +611,1 @@\n-        JRSUIUtils.ScrollBar.getPartBounds(rect, painter.getControl(), 0, 0, fScrollBar.getWidth(), fScrollBar.getHeight(), ScrollBarPart.THUMB);\n+        JRSUIUtils.ScrollBar.getPartBounds(rect, painter.getControl(), limitRect.x, limitRect.y, limitRect.width, limitRect.height, ScrollBarPart.THUMB);\n","filename":"src\/java.desktop\/macosx\/classes\/com\/apple\/laf\/AquaScrollBarUI.java","additions":17,"deletions":6,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -0,0 +1,141 @@\n+\/*\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+import javax.swing.*;\n+import javax.swing.border.Border;\n+import javax.swing.border.EmptyBorder;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.nio.Buffer;\n+\n+import static java.awt.image.BufferedImage.TYPE_INT_ARGB;\n+import static java.awt.image.BufferedImage.TYPE_INT_RGB;\n+\n+\/*\n+ * @test\n+ * @bug 8190264\n+ * @summary JScrollBar ignores its border when using macOS Mac OS X Aqua look and feel\n+ * @run main ScrollBarBorderTest\n+ *\/\n+public class ScrollBarBorderTest {\n+\n+    \/\/ On macOS 10.12.6 using the Mac look and feel (com.apple.laf.AquaLookAndFeel)\n+    \/\/ the scroll bar ignores the custom border and allows the scroll thumb to move\n+    \/\/ beneath the border. Run with:\n+    \/\/ java ScrollBarBorderTest\n+\n+    \/\/ If run using any other look and feel (e.g. Metal) then the right side of\n+    \/\/ the scroll bar stops at the border as expected. Run with:\n+    \/\/ java -Dswing.defaultlaf=javax.swing.plaf.metal.MetalLookAndFeel ScrollBarBorderTest\n+\n+    \/\/ Java version: 1.8.0_151\n+\n+    private static JScrollBar scrollBar;\n+    private static JPanel panel;\n+    private static JFrame frame;\n+\n+    public void createAndShowGUI() throws Exception {\n+        SwingUtilities.invokeAndWait(new Runnable() {\n+            @Override\n+            public void run() {\n+                \/\/ create scroll bar\n+                scrollBar = new JScrollBar(Scrollbar.HORIZONTAL);\n+                scrollBar.setBorder(new CustomBorder());\n+\n+                \/\/ create panel\n+                panel = new JPanel();\n+                panel.setLayout(new BoxLayout(panel, BoxLayout.Y_AXIS));\n+                panel.setBorder(new EmptyBorder(20, 20, 20, 20));\n+                panel.setSize(200,90);\n+                panel.add(new JLabel(UIManager.getLookAndFeel().toString()));\n+                panel.add(Box.createVerticalStrut(20));\n+                panel.add(scrollBar);\n+\n+                \/\/ create frame\n+                frame = new JFrame(\"ScrollBarBorderTest\");\n+                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+                frame.getContentPane().add(panel);\n+                frame.pack();\n+\n+                frame.setVisible(true);\n+            }\n+        });\n+    }\n+\n+    public void test() throws Exception {\n+        createAndShowGUI();\n+        BufferedImage image = new BufferedImage(panel.getWidth(),panel.getHeight(),TYPE_INT_ARGB);\n+        Graphics2D graphics2D = image.createGraphics();\n+        panel.paint(graphics2D);\n+        graphics2D.dispose();\n+        scrollBar.setValue(Integer.MAX_VALUE);\n+        BufferedImage image2 = new BufferedImage(panel.getWidth(),panel.getHeight(),TYPE_INT_ARGB);\n+        Graphics2D graphics2D2 = image2.createGraphics();\n+        panel.paint(graphics2D2);\n+        graphics2D2.dispose();\n+\n+        for (int i = 450; i < image.getWidth(); i++) {\n+            for (int j = 50; j < image.getHeight(); j++) {\n+                int c1 = image.getRGB(i,j);\n+                int c2 = image2.getRGB(i,j);\n+                \/\/ need to find location of border but colors are always 0\n+                if(c1 != c2) {\n+                    System.out.println(i + \" \" + j + \" \" + \"Color1: \" + c1);\n+                    System.out.println(i + \" \" + j + \" \" + \"Color2: \" + c2);\n+                    throw new RuntimeException();\n+                }\n+            }\n+        }\n+    }\n+\n+    public void done() throws Exception {\n+        SwingUtilities.invokeAndWait(new Runnable() {\n+            @Override\n+            public void run() {\n+                frame.dispose();\n+            }\n+        });\n+    }\n+\n+    public static void main(String[] args) throws Exception {\n+        ScrollBarBorderTest borderTest = new ScrollBarBorderTest();\n+        borderTest.test();\n+        borderTest.done();\n+    }\n+\n+    \/\/ custom border\n+    private static class CustomBorder implements Border {\n+        public void paintBorder(Component c, Graphics g, int x, int y, int width, int height) {\n+            g.setColor(new Color(255, 0, 0, 100));\n+            g.fillRect(width - 150, y, width, height);\n+        }\n+\n+        public Insets getBorderInsets(Component c) {\n+            return new Insets(0, 0, 0, 150);\n+        }\n+\n+        public boolean isBorderOpaque() {\n+            return true;\n+        }\n+    }\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/java\/awt\/Scrollbar\/AquaLFScrollbarTest\/ScrollBarBorderTest.java","additions":141,"deletions":0,"binary":false,"changes":141,"status":"added"}]}