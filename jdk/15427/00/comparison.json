{"files":[{"patch":"@@ -368,1 +368,1 @@\n-                 int vector_len, KRegister ktmp, Register rscratch = noreg);\n+                 int vector_len, KRegister ktmp, XMMRegister ones);\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_64.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1640,1 +1640,1 @@\n-                            int vector_len, KRegister ktmp, Register rscratch) {\n+                              int vector_len, KRegister ktmp, XMMRegister ones) {\n@@ -1642,4 +1642,4 @@\n-  __ evpcmpuq(ktmp, xmmdst, xmmsrc2, __ lt, vector_len);\n-  __ kshiftlbl(ktmp, ktmp, 1);\n-  __ evpaddq(xmmdst, ktmp, xmmdst, ExternalAddress(counter_mask_ones_addr()), \/*merge*\/true,\n-             vector_len, rscratch);\n+  __ evpcmpuq(ktmp, xmmdst, xmmsrc2, __ lt, vector_len); \/\/ set mask[0\/1] bit if addq to dst[0\/1] wraps\n+  __ kshiftlbl(ktmp, ktmp, 1);                        \/\/ mask[1] <- mask[0], mask[0] <- 0, etc\n+\n+  __ evpaddq(xmmdst, ktmp, xmmdst, ones, \/*merge*\/true, vector_len); \/\/ dst[1]++ if mask[1] set\n@@ -2128,0 +2128,4 @@\n+  const XMMRegister ones = xmm17;\n+  \/\/ Vector value to propagate carries\n+  __ evmovdquq(ones, ExternalAddress(counter_mask_ones_addr()), Assembler::AVX_512bit, r15);\n+\n@@ -2129,9 +2133,9 @@\n-  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  __ evmovdquq(xmm19, ExternalAddress(counter_mask_linc4_addr()), Assembler::AVX_512bit, r15 \/*rscratch*\/);\n-  ev_add128(xmm9,  xmm8,  xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm10, xmm9,  xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm11, xmm10, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm12, xmm11, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm13, xmm12, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm14, xmm13, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm15, xmm14, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  __ evmovdquq(xmm19, ExternalAddress(counter_mask_linc4_addr()), Assembler::AVX_512bit);\n+  ev_add128(xmm9,  xmm8,  xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm10, xmm9,  xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm11, xmm10, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm12, xmm11, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm13, xmm12, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm14, xmm13, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm15, xmm14, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2185,1 +2189,1 @@\n-  ev_add128(xmm8,   xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm8,   xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2187,1 +2191,1 @@\n-  ev_add128(xmm9,   xmm9, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm9,   xmm9, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2189,1 +2193,1 @@\n-  ev_add128(xmm10, xmm10, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm10, xmm10, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2191,1 +2195,1 @@\n-  ev_add128(xmm11, xmm11, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm11, xmm11, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2193,1 +2197,1 @@\n-  ev_add128(xmm12, xmm12, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm12, xmm12, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2195,1 +2199,1 @@\n-  ev_add128(xmm13, xmm13, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm13, xmm13, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2197,1 +2201,1 @@\n-  ev_add128(xmm14, xmm14, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm14, xmm14, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2199,1 +2203,1 @@\n-  ev_add128(xmm15, xmm15, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm15, xmm15, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2277,2 +2281,2 @@\n-  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n-  ev_add128(xmm9, xmm9, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n+  ev_add128(xmm9, xmm9, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2345,1 +2349,1 @@\n-  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2404,1 +2408,1 @@\n-  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_512bit, \/*ktmp*\/k1, ones);\n@@ -2454,1 +2458,1 @@\n-  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_128bit, \/*ktmp*\/k1, r15 \/*rscratch*\/);\n+  ev_add128(xmm8, xmm8, xmm19, Assembler::AVX_128bit, \/*ktmp*\/k1, ones);\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_64_aes.cpp","additions":31,"deletions":27,"binary":false,"changes":58,"status":"modified"}]}