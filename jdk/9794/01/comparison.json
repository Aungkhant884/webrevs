{"files":[{"patch":"@@ -215,2 +215,1 @@\n-        NativeBuffer buffer = NativeBuffers.getNativeBuffer(size);\n-        try {\n+        try (NativeBuffer buffer = NativeBuffers.getNativeBuffer(size)) {\n@@ -246,2 +245,0 @@\n-        } finally {\n-            buffer.release();\n@@ -269,2 +266,1 @@\n-                NativeBuffer buffer = NativeBuffers.asNativeBuffer(value);\n-                try {\n+                try (NativeBuffer buffer = NativeBuffers.asNativeBuffer(value)) {\n@@ -273,2 +269,0 @@\n-                } finally {\n-                    buffer.release();\n","filename":"src\/java.base\/linux\/classes\/sun\/nio\/fs\/LinuxDosFileAttributeView.java","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,3 +39,2 @@\n-        NativeBuffer pathBuffer = NativeBuffers.asNativeBuffer(filename);\n-        NativeBuffer typeBuffer = NativeBuffers.asNativeBuffer(type);\n-        try {\n+        try (NativeBuffer pathBuffer = NativeBuffers.asNativeBuffer(filename);\n+             NativeBuffer typeBuffer = NativeBuffers.asNativeBuffer(type)) {\n@@ -43,3 +42,0 @@\n-        } finally {\n-            typeBuffer.release();\n-            pathBuffer.release();\n@@ -56,2 +52,1 @@\n-        NativeBuffer buffer = NativeBuffers.getNativeBuffer(buflen);\n-        try {\n+        try (NativeBuffer buffer = NativeBuffers.getNativeBuffer(buflen)) {\n@@ -59,2 +54,0 @@\n-        } finally {\n-            buffer.release();\n","filename":"src\/java.base\/linux\/classes\/sun\/nio\/fs\/LinuxNativeDispatcher.java","additions":4,"deletions":11,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -253,9 +253,4 @@\n-            int wd = -1;\n-            try {\n-                NativeBuffer buffer =\n-                    NativeBuffers.asNativeBuffer(dir.getByteArrayForSysCalls());\n-                try {\n-                    wd = inotifyAddWatch(ifd, buffer.address(), mask);\n-                } finally {\n-                    buffer.release();\n-                }\n+            int wd;\n+            try (NativeBuffer buffer =\n+                 NativeBuffers.asNativeBuffer(dir.getByteArrayForSysCalls())) {\n+                wd = inotifyAddWatch(ifd, buffer.address(), mask);\n","filename":"src\/java.base\/linux\/classes\/sun\/nio\/fs\/LinuxWatchService.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -56,2 +56,1 @@\n-        NativeBuffer pathBuffer = copyToNativeBuffer(path);\n-        try {\n+        try (NativeBuffer pathBuffer = copyToNativeBuffer(path)) {\n@@ -59,2 +58,0 @@\n-        } finally {\n-            pathBuffer.release();\n","filename":"src\/java.base\/macosx\/classes\/sun\/nio\/fs\/BsdNativeDispatcher.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -340,2 +340,1 @@\n-        NativeBuffer buffer = NativeBuffers.getNativeBuffer(size);\n-        try {\n+        try (NativeBuffer buffer = NativeBuffers.getNativeBuffer(size)) {\n@@ -345,2 +344,0 @@\n-        } finally {\n-            buffer.release();\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixUserDefinedFileAttributeView.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,5 +58,2 @@\n-        NativeBuffer keyBuffer = null;\n-        NativeBuffer nameBuffer = null;\n-        try {\n-            keyBuffer = WindowsNativeDispatcher.asNativeBuffer(key);\n-            nameBuffer = WindowsNativeDispatcher.asNativeBuffer(\"Content Type\");\n+        try (NativeBuffer keyBuffer = WindowsNativeDispatcher.asNativeBuffer(key);\n+             NativeBuffer nameBuffer = WindowsNativeDispatcher.asNativeBuffer(\"Content Type\")) {\n@@ -67,3 +64,0 @@\n-        } finally {\n-            nameBuffer.release();\n-            keyBuffer.release();\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/RegistryFileTypeDetector.java","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -122,2 +122,1 @@\n-        NativeBuffer buffer = getFileSecurity(path, OWNER_SECURITY_INFORMATION);\n-        try {\n+        try (NativeBuffer buffer = getFileSecurity(path, OWNER_SECURITY_INFORMATION)) {\n@@ -132,2 +131,0 @@\n-        } finally {\n-            buffer.release();\n@@ -149,2 +146,1 @@\n-        NativeBuffer buffer = getFileSecurity(path, DACL_SECURITY_INFORMATION);\n-        try {\n+        try (NativeBuffer buffer = getFileSecurity(path, DACL_SECURITY_INFORMATION)) {\n@@ -152,2 +148,0 @@\n-        } finally {\n-            buffer.release();\n@@ -176,1 +170,1 @@\n-        long pOwner = 0L;\n+        long pOwner;\n@@ -186,2 +180,6 @@\n-        try {\n-            NativeBuffer buffer = NativeBuffers.getNativeBuffer(SIZEOF_SECURITY_DESCRIPTOR);\n+        try (NativeBuffer buffer = NativeBuffers.getNativeBuffer(SIZEOF_SECURITY_DESCRIPTOR)) {\n+            InitializeSecurityDescriptor(buffer.address());\n+            SetSecurityDescriptorOwner(buffer.address(), pOwner);\n+            \/\/ may need SeRestorePrivilege to set the owner\n+            WindowsSecurity.Privilege priv =\n+                WindowsSecurity.enablePrivilege(\"SeRestorePrivilege\");\n@@ -189,14 +187,3 @@\n-                InitializeSecurityDescriptor(buffer.address());\n-                SetSecurityDescriptorOwner(buffer.address(), pOwner);\n-                \/\/ may need SeRestorePrivilege to set the owner\n-                WindowsSecurity.Privilege priv =\n-                    WindowsSecurity.enablePrivilege(\"SeRestorePrivilege\");\n-                try {\n-                    SetFileSecurity(path,\n-                                    OWNER_SECURITY_INFORMATION,\n-                                    buffer.address());\n-                } finally {\n-                    priv.drop();\n-                }\n-            } catch (WindowsException x) {\n-                x.rethrowAsIOException(file);\n+                SetFileSecurity(path,\n+                                OWNER_SECURITY_INFORMATION,\n+                                buffer.address());\n@@ -204,1 +191,1 @@\n-                buffer.release();\n+                priv.drop();\n@@ -206,0 +193,2 @@\n+        } catch (WindowsException x) {\n+            x.rethrowAsIOException(file);\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsAclFileAttributeView.java","additions":16,"deletions":27,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -266,3 +266,1 @@\n-        NativeBuffer buffer = NativeBuffers\n-            .getNativeBuffer(SIZEOF_FILE_INFORMATION);\n-        try {\n+        try (NativeBuffer buffer = NativeBuffers.getNativeBuffer(SIZEOF_FILE_INFORMATION)) {\n@@ -278,2 +276,1 @@\n-                NativeBuffer reparseBuffer = NativeBuffers.getNativeBuffer(size);\n-                try {\n+                try (NativeBuffer reparseBuffer = NativeBuffers.getNativeBuffer(size)) {\n@@ -282,2 +279,0 @@\n-                } finally {\n-                    reparseBuffer.release();\n@@ -288,2 +283,0 @@\n-        } finally {\n-            buffer.release();\n@@ -303,3 +296,2 @@\n-            NativeBuffer buffer =\n-                NativeBuffers.getNativeBuffer(SIZEOF_FILE_ATTRIBUTE_DATA);\n-            try {\n+            try (NativeBuffer buffer =\n+                NativeBuffers.getNativeBuffer(SIZEOF_FILE_ATTRIBUTE_DATA)) {\n@@ -318,2 +310,0 @@\n-            } finally {\n-                buffer.release();\n@@ -329,2 +319,1 @@\n-                buffer = getBufferForFindData();\n-                try {\n+                try (NativeBuffer buffer = getBufferForFindData()) {\n@@ -343,2 +332,0 @@\n-                } finally {\n-                    buffer.release();\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsFileAttributes.java","additions":6,"deletions":19,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -517,5 +517,3 @@\n-            NativeBuffer buffer =\n-                WindowsAclFileAttributeView.getFileSecurity(path, request);\n-            try {\n-                try {\n-                    SetFileSecurity(target.getPathForWin32Calls(), request,\n+            try (NativeBuffer buffer =\n+                 WindowsAclFileAttributeView.getFileSecurity(path, request)) {\n+                SetFileSecurity(target.getPathForWin32Calls(), request,\n@@ -523,5 +521,2 @@\n-                } catch (WindowsException x) {\n-                    x.rethrowAsIOException(target);\n-                }\n-            } finally {\n-                buffer.release();\n+            } catch (WindowsException x) {\n+                x.rethrowAsIOException(target);\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsFileCopy.java","additions":5,"deletions":10,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -36,2 +36,0 @@\n-import java.security.AccessController;\n-import jdk.internal.misc.Unsafe;\n@@ -305,1 +303,1 @@\n-        NativeBuffer aclBuffer = WindowsAclFileAttributeView\n+        try (NativeBuffer aclBuffer = WindowsAclFileAttributeView\n@@ -309,2 +307,1 @@\n-                | GROUP_SECURITY_INFORMATION);\n-        try {\n+                | GROUP_SECURITY_INFORMATION)) {\n@@ -318,2 +315,0 @@\n-        } finally {\n-            aclBuffer.release();\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsFileSystemProvider.java","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -272,2 +272,1 @@\n-        NativeBuffer buffer = NativeBuffers.getNativeBuffer(size);\n-        try {\n+        try (NativeBuffer buffer = NativeBuffers.getNativeBuffer(size)) {\n@@ -337,2 +336,0 @@\n-        } finally {\n-            buffer.release();\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsLinkSupport.java","additions":2,"deletions":5,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -498,2 +498,1 @@\n-        NativeBuffer buffer = asNativeBuffer(root);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(root)) {\n@@ -503,2 +502,0 @@\n-        } finally {\n-            buffer.release();\n@@ -529,2 +526,1 @@\n-        NativeBuffer buffer = asNativeBuffer(root);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(root)) {\n@@ -532,2 +528,0 @@\n-        } finally {\n-            buffer.release();\n@@ -549,2 +543,1 @@\n-        NativeBuffer buffer = asNativeBuffer(path);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(path)) {\n@@ -554,2 +547,0 @@\n-        } finally {\n-            buffer.release();\n@@ -571,2 +562,1 @@\n-        NativeBuffer buffer = asNativeBuffer(path);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(path)) {\n@@ -576,2 +566,0 @@\n-        } finally {\n-            buffer.release();\n@@ -612,2 +600,1 @@\n-        NativeBuffer buffer = asNativeBuffer(path);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(path)) {\n@@ -615,2 +602,0 @@\n-        } finally {\n-            buffer.release();\n@@ -656,2 +641,1 @@\n-        NativeBuffer buffer = asNativeBuffer(path);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(path)) {\n@@ -660,2 +644,0 @@\n-        } finally {\n-            buffer.release();\n@@ -681,2 +663,1 @@\n-        NativeBuffer buffer = asNativeBuffer(path);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(path)) {\n@@ -685,2 +666,0 @@\n-        } finally {\n-            buffer.release();\n@@ -838,2 +817,1 @@\n-        NativeBuffer buffer = asNativeBuffer(accountName);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(accountName)) {\n@@ -841,2 +819,0 @@\n-        } finally {\n-            buffer.release();\n@@ -877,2 +853,1 @@\n-        NativeBuffer buffer = asNativeBuffer(sidString);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(sidString)) {\n@@ -880,2 +855,0 @@\n-        } finally {\n-            buffer.release();\n@@ -977,2 +950,1 @@\n-        NativeBuffer buffer = asNativeBuffer(name);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(name)) {\n@@ -980,2 +952,0 @@\n-        } finally {\n-            buffer.release();\n@@ -1039,3 +1009,2 @@\n-        NativeBuffer newFileBuffer = asNativeBuffer(newFile);\n-        NativeBuffer existingFileBuffer = asNativeBuffer(existingFile);\n-        try {\n+        try (NativeBuffer newFileBuffer = asNativeBuffer(newFile);\n+             NativeBuffer existingFileBuffer = asNativeBuffer(existingFile)) {\n@@ -1043,3 +1012,0 @@\n-        } finally {\n-            existingFileBuffer.release();\n-            newFileBuffer.release();\n@@ -1060,2 +1026,1 @@\n-        NativeBuffer buffer = asNativeBuffer(path);\n-        try {\n+        try (NativeBuffer buffer = asNativeBuffer(path)) {\n@@ -1063,2 +1028,0 @@\n-        } finally {\n-            buffer.release();\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsNativeDispatcher.java","additions":13,"deletions":50,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -143,1 +143,1 @@\n-        int size = 0;\n+        int size;\n@@ -154,2 +154,1 @@\n-        NativeBuffer sidBuffer = NativeBuffers.getNativeBuffer(size);\n-        try {\n+        try (NativeBuffer sidBuffer = NativeBuffers.getNativeBuffer(size)) {\n@@ -166,2 +165,0 @@\n-        } finally {\n-            sidBuffer.release();\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsUserPrincipals.java","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"}]}