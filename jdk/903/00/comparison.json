{"files":[{"patch":"@@ -26,2 +26,1 @@\n-#include \"runtime\/mutex.hpp\"\n-#include \"runtime\/mutexLocker.hpp\"\n+#include \"runtime\/semaphore.hpp\"\n@@ -31,1 +30,1 @@\n-Mutex* GCLogPrecious::_lock = NULL;\n+Semaphore* GCLogPrecious::_lock = NULL;\n@@ -36,4 +35,1 @@\n-  _lock = new Mutex(Mutex::tty,\n-                    \"GCLogPrecious Lock\",\n-                    true,\n-                    Mutex::_safepoint_check_never);\n+  _lock = new Semaphore(1);\n@@ -57,1 +53,1 @@\n-  MutexLocker locker(_lock, Mutex::_no_safepoint_check_flag);\n+  _lock->wait();\n@@ -59,0 +55,1 @@\n+  _lock->signal();\n@@ -69,1 +66,1 @@\n-    MutexLocker locker(_lock, Mutex::_no_safepoint_check_flag);\n+    _lock->wait();\n@@ -72,0 +69,1 @@\n+   _lock->signal();\n@@ -80,3 +78,5 @@\n-  if (_lines != NULL) {\n-    MutexLocker locker(_lock, Mutex::_no_safepoint_check_flag);\n-    if (_lines->size() > 0) {\n+  if (_lines == NULL) {\n+    return;\n+  }\n+\n+  if (!_lock->trywait()) {\n@@ -84,2 +84,2 @@\n-      st->print_cr(\"%s\", _lines->base());\n-    }\n+      st->print_cr(\" ... skipping ...\");\n+      return;\n@@ -87,0 +87,7 @@\n+\n+  if (_lines->size() > 0) {\n+    st->print_cr(\"GC Precious Log:\");\n+    st->print_cr(\"%s\", _lines->base());\n+  }\n+\n+  _lock->signal();\n","filename":"src\/hotspot\/share\/gc\/shared\/gcLogPrecious.cpp","additions":21,"deletions":14,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -32,1 +32,1 @@\n-class Mutex;\n+class Semaphore;\n@@ -61,1 +61,1 @@\n-  static Mutex* _lock;\n+  static Semaphore* _lock;\n","filename":"src\/hotspot\/share\/gc\/shared\/gcLogPrecious.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}