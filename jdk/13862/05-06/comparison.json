{"files":[{"patch":"@@ -1646,2 +1646,2 @@\n-                                           VectorRegister vmask, int vector_length, VectorRegister tmp1,\n-                                           VectorRegister tmp2, bool is_double, bool is_min) {\n+                                           VectorRegister vmask, VectorRegister tmp1, VectorRegister tmp2,\n+                                           bool is_double, bool is_min, int vector_length) {\n@@ -1671,0 +1671,1 @@\n+  assert_different_registers(dst, src1);\n@@ -1673,2 +1674,2 @@\n-  Label L_done, L_done_check, L_NaN_v, L_NaN_f;\n-  \/\/ If src1 is NaN, set dst to src1 directly.\n+  Label L_done, L_NaN_1, L_NaN_2;\n+  \/\/ Set dst to src1 if src1 is NaN\n@@ -1677,1 +1678,1 @@\n-  beqz(t0, L_NaN_f);\n+  beqz(t0, L_NaN_2);\n@@ -1684,0 +1685,1 @@\n+  vfmv_f_s(dst, tmp1);\n@@ -1686,4 +1688,3 @@\n-  vmfne_vv(tmp2, src2, src2, vm);\n-  vcpop_m(t0, tmp2, vm);\n-  bnez(t0, L_NaN_v);\n-  j(L_done_check);\n+  vmfne_vv(tmp1, src2, src2, vm);\n+  vcpop_m(t0, tmp1, vm);\n+  beqz(t0, L_done);\n@@ -1691,2 +1692,1 @@\n-  bind(L_NaN_v);\n-  vfmv_s_f(tmp2, src1);\n+  bind(L_NaN_1);\n@@ -1694,2 +1694,0 @@\n-\n-  bind(L_done_check);\n@@ -1699,1 +1697,1 @@\n-  bind(L_NaN_f);\n+  bind(L_NaN_2);\n@@ -1715,3 +1713,3 @@\n-void C2_MacroAssembler::reduce_integral_v(Register dst, VectorRegister tmp,\n-                                          Register src1, VectorRegister src2,\n-                                          BasicType bt, int opc, int vector_length, VectorMask vm) {\n+void C2_MacroAssembler::reduce_integral_v(Register dst, Register src1,\n+                                          VectorRegister src2, VectorRegister tmp,\n+                                          int opc, BasicType bt, int vector_length, VectorMask vm) {\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.cpp","additions":15,"deletions":17,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -193,2 +193,2 @@\n-                         VectorRegister vmask, int vector_length, VectorRegister tmp1,\n-                         VectorRegister tmp2, bool is_double, bool is_min);\n+                         VectorRegister vmask, VectorRegister tmp1, VectorRegister tmp2,\n+                         bool is_double, bool is_min, int vector_length);\n@@ -202,3 +202,3 @@\n- void reduce_integral_v(Register dst, VectorRegister tmp,\n-                        Register src1, VectorRegister src2,\n-                        BasicType bt, int opc, int vector_length,\n+ void reduce_integral_v(Register dst, Register src1,\n+                        VectorRegister src2, VectorRegister tmp,\n+                        int opc, BasicType bt, int vector_length,\n","filename":"src\/hotspot\/cpu\/riscv\/c2_MacroAssembler_riscv.hpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -735,2 +735,2 @@\n-                          Matcher::vector_length(this), as_VectorRegister($tmp1$$reg),\n-                          as_VectorRegister($tmp2$$reg), false \/* is_double *\/, false \/* is_min *\/);\n+                          as_VectorRegister($tmp1$$reg), as_VectorRegister($tmp2$$reg),\n+                          false \/* is_double *\/, false \/* is_min *\/, Matcher::vector_length(this));\n@@ -750,2 +750,2 @@\n-                          Matcher::vector_length(this), as_VectorRegister($tmp1$$reg),\n-                          as_VectorRegister($tmp2$$reg), true \/* is_double *\/, false \/* is_min *\/);\n+                          as_VectorRegister($tmp1$$reg), as_VectorRegister($tmp2$$reg),\n+                          true \/* is_double *\/, false \/* is_min *\/, Matcher::vector_length(this));\n@@ -765,2 +765,2 @@\n-                          Matcher::vector_length(this), as_VectorRegister($tmp1$$reg),\n-                          as_VectorRegister($tmp2$$reg), false \/* is_double *\/, true \/* is_min *\/);\n+                          as_VectorRegister($tmp1$$reg), as_VectorRegister($tmp2$$reg),\n+                          false \/* is_double *\/, true \/* is_min *\/, Matcher::vector_length(this));\n@@ -780,2 +780,2 @@\n-                          Matcher::vector_length(this), as_VectorRegister($tmp1$$reg),\n-                          as_VectorRegister($tmp2$$reg), true \/* is_double *\/, true \/* is_min *\/);\n+                          as_VectorRegister($tmp1$$reg), as_VectorRegister($tmp2$$reg),\n+                          true \/* is_double *\/, true \/* is_min *\/, Matcher::vector_length(this));\n@@ -1325,3 +1325,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1342,3 +1342,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1361,3 +1361,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1377,3 +1377,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1399,3 +1399,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1416,3 +1416,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1435,3 +1435,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1451,3 +1451,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1473,3 +1473,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1490,3 +1490,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1509,3 +1509,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1525,3 +1525,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1547,3 +1547,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1564,3 +1564,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1617,3 +1617,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1633,3 +1633,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1683,3 +1683,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1698,3 +1698,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1717,3 +1717,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1733,3 +1733,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1753,3 +1753,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1768,3 +1768,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2));\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2));\n@@ -1787,3 +1787,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n@@ -1803,3 +1803,3 @@\n-    __ reduce_integral_v($dst$$Register, as_VectorRegister($tmp$$reg),\n-                         $src1$$Register, as_VectorRegister($src2$$reg), bt,\n-                         this->ideal_Opcode(), Matcher::vector_length(this, $src2),\n+    __ reduce_integral_v($dst$$Register, $src1$$Register,\n+                         as_VectorRegister($src2$$reg), as_VectorRegister($tmp$$reg),\n+                         this->ideal_Opcode(), bt, Matcher::vector_length(this, $src2),\n","filename":"src\/hotspot\/cpu\/riscv\/riscv_v.ad","additions":80,"deletions":80,"binary":false,"changes":160,"status":"modified"}]}