{"files":[{"patch":"@@ -2886,1 +2886,1 @@\n-                        return findDiamond(env, site, argtypes, typeargtypes,\n+                        return findDiamond(pos, env, site, argtypes, typeargtypes,\n@@ -2909,0 +2909,23 @@\n+    \/** Find the constructor using diamond inference and do some checks(deprecated and preview).\n+     *  @param pos          The position to use for error reporting.\n+     *  @param env          The environment current at the constructor invocation.\n+     *  @param site         The type of class for which a constructor is searched.\n+     *                      The scope of this class has been touched in attribution.\n+     *  @param argtypes     The types of the constructor invocation's value arguments.\n+     *  @param typeargtypes The types of the constructor invocation's type arguments.\n+     *  @param allowBoxing  Allow boxing conversions of arguments.\n+     *  @param useVarargs   Box trailing arguments into an array for varargs.\n+     *\/\n+    private Symbol findDiamond(DiagnosticPosition pos,\n+                               Env<AttrContext> env,\n+                               Type site,\n+                               List<Type> argtypes,\n+                               List<Type> typeargtypes,\n+                               boolean allowBoxing,\n+                               boolean useVarargs) {\n+        Symbol sym = findDiamond(env, site, argtypes, typeargtypes, allowBoxing, useVarargs);\n+        chk.checkDeprecated(pos, env.info.scope.owner, sym);\n+        chk.checkPreview(pos, sym);\n+        return sym;\n+    }\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Resolve.java","additions":24,"deletions":1,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -0,0 +1,15 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @bug 8257307\n+ * @summary No javac warning when calling deprecated constructor with diamond\n+ * @run compile\/ref=T8257037.out -Xlint -XDrawDiagnostics T8257037.java\n+ *\/\n+\n+public class T8257037 {\n+    T8257037_GenericClass<Object> test = new T8257037_GenericClass<>(); \/\/ use diamond\n+}\n+\n+class T8257037_GenericClass<T> {\n+    @Deprecated\n+    public T8257037_GenericClass() {}\n+}\n","filename":"test\/langtools\/tools\/javac\/T8257037\/T8257037.java","additions":15,"deletions":0,"binary":false,"changes":15,"status":"added"},{"patch":"@@ -0,0 +1,2 @@\n+T8257037.java:9:42: compiler.warn.has.been.deprecated: <T>T8257037_GenericClass(), T8257037_GenericClass\n+1 warning\n","filename":"test\/langtools\/tools\/javac\/T8257037\/T8257037.out","additions":2,"deletions":0,"binary":false,"changes":2,"status":"added"}]}