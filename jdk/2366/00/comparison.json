{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -458,1 +458,2 @@\n-static bool read_exec_segments(struct ps_prochandle* ph, ELF_EHDR* exec_ehdr) {\n+\/\/ returns base address of executable.\n+static uintptr_t read_exec_segments(struct ps_prochandle* ph, ELF_EHDR* exec_ehdr) {\n@@ -462,0 +463,1 @@\n+  uintptr_t result = 0L;\n@@ -464,1 +466,1 @@\n-    return false;\n+    return 0L;\n@@ -505,0 +507,1 @@\n+        result = exec_php->p_vaddr;\n@@ -507,0 +510,4 @@\n+        \/\/ Base address of executable is based on entry point (AT_ENTRY).\n+        \/\/ See svr4_exec_displacement() in GDB.\n+        result = ph->core->dynamic_addr - exec_ehdr->e_entry;\n+\n@@ -520,1 +527,1 @@\n-  return true;\n+  return result;\n@@ -523,1 +530,1 @@\n-  return false;\n+  return 0L;\n@@ -775,1 +782,2 @@\n-  if (read_exec_segments(ph, &exec_ehdr) != true) {\n+  uintptr_t exec_base_addr = read_exec_segments(ph, &exec_ehdr);\n+  if (exec_base_addr == 0L) {\n@@ -778,5 +786,2 @@\n-\n-  \/\/ exec file is also treated like a shared object for symbol search\n-  \/\/ FIXME: This is broken and ends up with a base address of 0. See JDK-8248876.\n-  if (add_lib_info_fd(ph, exec_file, ph->core->exec_fd,\n-                      (uintptr_t)0 + find_base_address(ph->core->exec_fd, &exec_ehdr)) == NULL) {\n+  print_debug(\"exec_base_addr = 0x%lx\\n\", exec_base_addr);\n+  if (add_lib_info_fd(ph, exec_file, ph->core->exec_fd, exec_base_addr) == NULL) {\n","filename":"src\/jdk.hotspot.agent\/linux\/native\/libsaproc\/ps_core.c","additions":16,"deletions":11,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -72,1 +72,0 @@\n-      if (base == null) continue; \/\/ Skip. LoadObject was not properly initialized.\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/debugger\/linux\/LinuxCDebugger.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}