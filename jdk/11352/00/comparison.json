{"files":[{"patch":"@@ -95,0 +95,3 @@\n+\n+        boolean isTargetEventFound = false;\n+\n@@ -102,14 +105,29 @@\n-            Asserts.assertEquals(events.size(), 1, \"No event found in virtual thread\");\n-            RecordedEvent event = events.get(0);\n-            System.out.println(event);\n-            RecordedStackTrace stackTrace = event.getStackTrace();\n-            List<RecordedFrame> frames = stackTrace.getFrames();\n-            Asserts.assertTrue(stackTrace.isTruncated());\n-            int count = 0;\n-            for (RecordedFrame frame : frames) {\n-                Asserts.assertTrue(frame.isJavaFrame());\n-                Asserts.assertNotNull(frame.getMethod());\n-                RecordedMethod m = frame.getMethod();\n-                Asserts.assertNotNull(m.getType());\n-                if (m.getName().contains(stackMethod)) {\n-                    count++;\n+            Asserts.assertFalse(events.isEmpty(), \"No event found in virtual thread\");\n+            for (RecordedEvent event : events) {\n+                System.out.println(event);\n+                RecordedStackTrace stackTrace = event.getStackTrace();\n+                if (stackTrace == null) {\n+                    continue;\n+                }\n+                List<RecordedFrame> frames = stackTrace.getFrames();\n+                int count = 0;\n+                boolean isTargetEvent = false;\n+                boolean isFirstFrame = true;\n+                for (int c = 0; c < frames.size(); c++) {\n+                    RecordedFrame frame = frames.get(c);\n+                    Asserts.assertTrue(frame.isJavaFrame());\n+                    Asserts.assertNotNull(frame.getMethod());\n+                    RecordedMethod m = frame.getMethod();\n+                    Asserts.assertNotNull(m.getType());\n+                    if (m.getName().contains(stackMethod)) {\n+                        if (c == 0) {\n+                            isTargetEvent = true;\n+                        }\n+                        count++;\n+                    }\n+                }\n+                if (isTargetEvent) {\n+                    isTargetEventFound = true;\n+                    Asserts.assertTrue(stackTrace.isTruncated());\n+                    Asserts.assertEquals(count, FRAME_COUNT);\n+                    Asserts.assertEquals(frames.size(), FRAME_COUNT);\n@@ -118,2 +136,0 @@\n-            Asserts.assertEquals(count, FRAME_COUNT);\n-            Asserts.assertEquals(frames.size(), FRAME_COUNT);\n@@ -121,0 +137,2 @@\n+\n+        Asserts.assertTrue(isTargetEventFound, \"At least one target event found\");\n","filename":"test\/jdk\/jdk\/jfr\/threading\/TestDeepVirtualStackTrace.java","additions":34,"deletions":16,"binary":false,"changes":50,"status":"modified"}]}