{"files":[{"patch":"@@ -0,0 +1,124 @@\n+\n+\/* Copyright (c) 2016, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+import java.awt.AWTException;\n+import java.awt.Desktop;\n+import java.awt.Robot;\n+import java.awt.desktop.QuitEvent;\n+import java.awt.desktop.QuitHandler;\n+import java.awt.desktop.QuitResponse;\n+import java.awt.desktop.QuitStrategy;\n+import java.awt.event.KeyEvent;\n+import java.lang.reflect.InvocationTargetException;\n+import javax.swing.JFrame;\n+import javax.swing.SwingUtilities;\n+\n+\/*\n+ * @test\n+ * @key headful\n+ * @bug 8297095\n+ * @summary To determine the quit request of the application\n+ * @run main ActiveWindowCloseTest\n+ *\/\n+public class ActiveWindowCloseTest extends JFrame implements QuitHandler {\n+    private static ActiveWindowCloseTest frame = null;\n+    private static volatile int count = 0;\n+    private static Robot robot;\n+    private static boolean passed = false;\n+\n+    private ActiveWindowCloseTest(String name) {\n+        super(name);\n+    }\n+\n+    @Override\n+    public void handleQuitRequestWith(QuitEvent e, QuitResponse response) {\n+        if (count++ == 2) {\n+            System.out.println(\"Received performQuit()\");\n+            response.performQuit();\n+        } else {\n+            System.out.println(\"Received cancelQuit()\");\n+            response.cancelQuit();\n+        }\n+    }\n+\n+    private static void createAndShow() {\n+        try {\n+            frame = new ActiveWindowCloseTest(\"Close windows\");\n+            Desktop.getDesktop().setQuitHandler(frame);\n+            Desktop.getDesktop().disableSuddenTermination();\n+            Desktop.getDesktop()\n+                .setQuitStrategy(QuitStrategy.CLOSE_ALL_WINDOWS);\n+            frame.pack();\n+            frame.setLocationRelativeTo(null);\n+            frame.setVisible(true);\n+            passed = true;\n+        } catch (UnsupportedOperationException usoe) {\n+            System.out.println(\"Test skipped, as the action \"\n+                + \"is not supported on the current platform!\");\n+        }\n+    }\n+\n+    public static void main(String args[])\n+        throws AWTException, InvocationTargetException, InterruptedException {\n+        boolean isMac = false;\n+        try {\n+            if (System.getProperty(\"os.name\").toLowerCase().contains(\"os x\")) {\n+                isMac = true;\n+            }\n+            SwingUtilities.invokeAndWait(ActiveWindowCloseTest::createAndShow);\n+\n+            if (passed) {\n+                robot = new Robot();\n+                robot.setAutoDelay(50);\n+                robot.setAutoWaitForIdle(true);\n+                robot.waitForIdle();\n+\n+                for (int i = 0; i < 3; i++) {\n+                    if (frame.isActive()) {\n+                        if (isMac) {\n+                            robot.keyPress(KeyEvent.VK_META);\n+                            robot.keyPress(KeyEvent.VK_Q);\n+                            robot.keyRelease(KeyEvent.VK_Q);\n+                            robot.keyRelease(KeyEvent.VK_META);\n+                        } else {\n+                            robot.keyPress(KeyEvent.VK_ALT);\n+                            robot.keyPress(KeyEvent.VK_F4);\n+                            robot.keyRelease(KeyEvent.VK_F4);\n+                            robot.keyRelease(KeyEvent.VK_ALT);\n+                        }\n+                        robot.waitForIdle();\n+                    }\n+                }\n+                System.out.println(\"Test passed, by closing the application.\");\n+            }\n+        } finally {\n+            SwingUtilities.invokeAndWait(ActiveWindowCloseTest::disposeFrame);\n+        }\n+    }\n+\n+    public static void disposeFrame() {\n+        if (frame != null) {\n+            frame.dispose();\n+        }\n+    }\n+\n+}\n","filename":"test\/jdk\/java\/awt\/Desktop\/ActiveWindowCloseTest.java","additions":124,"deletions":0,"binary":false,"changes":124,"status":"added"}]}