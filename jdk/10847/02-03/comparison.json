{"files":[{"patch":"@@ -3337,2 +3337,4 @@\n-  Label SHORT_UNROLLED_BEGIN, SHORT_UNROLLED_LOOP_BEGIN, SHORT_SCALAR_BEGIN, SHORT_SCALAR_LOOP_BEGIN,\n-        LONG, LONG_INIT, LONG_SCALAR_LOOP_BEGIN, LONG_SCALAR_LOOP_END, LONG_VECTOR_LOOP_BEGIN, LONG_VECTOR_LOOP_END,\n+  Label SHORT_UNROLLED_BEGIN, SHORT_UNROLLED_LOOP_BEGIN, SHORT_UNROLLED_LOOP_EXIT,\n+        SHORT_SCALAR_BEGIN, SHORT_SCALAR_LOOP_BEGIN,\n+        LONG, LONG_INIT, LONG_SCALAR_LOOP_BEGIN, LONG_SCALAR_LOOP_END,\n+        LONG_VECTOR_LOOP_BEGIN, LONG_VECTOR_LOOP_END,\n@@ -3372,1 +3374,1 @@\n-  cmpl(cnt1, 4);\n+  cmpl(cnt1, 2);\n@@ -3517,20 +3519,5 @@\n-  \/\/ int i = 0;\n-  xorl(index, index);\n-  \/\/ int bound = cnt1 & ~(4 - 1);\n-  bound = coef;\n-  movl(bound, cnt1);\n-  andl(bound, ~(4-1));\n-\n-  \/\/ for (; i < bound; i += 4) {\n-  bind(SHORT_UNROLLED_LOOP_BEGIN);\n-  \/\/ i < bound;\n-  cmpl(index, bound);\n-  jccb(Assembler::greaterEqual, SHORT_SCALAR_LOOP_BEGIN);\n-  for (int idx = 0; idx < 4; idx++) {\n-    \/\/ h = (31 * h) or (h << 5 - h);\n-    movl(tmp, result);\n-    shll(result, 5);\n-    subl(result, tmp);\n-    \/\/ h += ary1[i];\n-    arrays_hashcode_elload(tmp, Address(ary1, index, Address::times(elsize), idx * elsize), eltype, is_string_hashcode);\n-    addl(result, tmp);\n+  \/\/ int i = 1;\n+  movl(index, 1);\n+  if (!is_string_hashcode) {\n+    movl(coef, 961);\n+    imull(result, coef);\n@@ -3538,1 +3525,13 @@\n-  addl(index, 4);\n+  \/\/ for (; i < cnt1 ; i += 2) {\n+  bind(SHORT_UNROLLED_LOOP_BEGIN);\n+  arrays_hashcode_elload(tmp, Address(ary1, index, Address::times(elsize), -elsize), eltype, is_string_hashcode);\n+  movl(coef, 31);\n+  imull(tmp, coef);\n+  addl(result, tmp);\n+  arrays_hashcode_elload(tmp, Address(ary1, index, Address::times(elsize)), eltype, is_string_hashcode);\n+  addl(result, tmp);\n+  addl(index, 2);\n+  cmpl(index, cnt1);\n+  jccb(Assembler::greaterEqual, SHORT_UNROLLED_LOOP_EXIT);\n+  movl(coef, 961);\n+  imull(result, coef);\n@@ -3540,0 +3539,1 @@\n+\n@@ -3541,5 +3541,2 @@\n-  \/\/ for (; i < cnt1; i += 1) {\n-  bind(SHORT_SCALAR_BEGIN);\n-  xorl(index, index);\n-  bind(SHORT_SCALAR_LOOP_BEGIN);\n-  \/\/ i < cnt1;\n+  \/\/ if (i == cnt1) {\n+  bind(SHORT_UNROLLED_LOOP_EXIT);\n@@ -3547,1 +3544,7 @@\n-  jcc(Assembler::greaterEqual, END);\n+  jccb(Assembler::greater, END);\n+  movl(coef, result);\n+  shll(result, 5);\n+  subl(result, coef);\n+  arrays_hashcode_elload(tmp, Address(ary1, index, Address::times(elsize), -elsize), eltype, is_string_hashcode);\n+  addl(result, tmp);\n+  jmpb(END);\n@@ -3549,0 +3552,5 @@\n+  \/\/ }\n+\n+  bind(SHORT_SCALAR_BEGIN);\n+  cmpl(cnt1, 0);\n+  jccb(Assembler::equal, END);\n@@ -3550,3 +3558,5 @@\n-  movl(tmp, result);\n-  shll(result, 5);\n-  subl(result, tmp);\n+  if (!is_string_hashcode) {\n+    movl(tmp, result);\n+    shll(result, 5);\n+    subl(result, tmp);\n+  }\n@@ -3554,1 +3564,1 @@\n-  arrays_hashcode_elload(tmp, Address(ary1, index, Address::times(elsize)), eltype, is_string_hashcode);\n+  arrays_hashcode_elload(tmp, Address(ary1, 0, Address::times(elsize)), eltype, is_string_hashcode);\n@@ -3557,2 +3567,0 @@\n-  incrementl(index);\n-  jmpb(SHORT_SCALAR_LOOP_BEGIN);\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":44,"deletions":36,"binary":false,"changes":80,"status":"modified"}]}