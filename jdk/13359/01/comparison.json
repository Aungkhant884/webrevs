{"files":[{"patch":"@@ -29,0 +29,1 @@\n+#include <malloc.h>\n@@ -519,4 +520,0 @@\n-#define MAX_BUFFER (FILENAME_MAX+1)\n-    const wchar_t wname[MAX_BUFFER];\n-    const char data[MAX_BUFFER];\n-\n@@ -526,2 +523,0 @@\n-    DWORD dwNameSize;\n-    DWORD dwDataValueSize;\n@@ -542,3 +537,1 @@\n-    if (ret != ERROR_SUCCESS ||\n-        dwMaxValueNameLen >= MAX_BUFFER ||\n-        dwMaxValueDataLen >= MAX_BUFFER) {\n+    if (ret != ERROR_SUCCESS) {\n@@ -548,0 +541,3 @@\n+    dwMaxValueNameLen++; \/* Account for NULL-terminator *\/\n+    wchar_t *wname = (wchar_t*)malloc(dwMaxValueNameLen * sizeof(wchar_t));\n+    wchar_t *data = (wchar_t*)malloc(dwMaxValueDataLen);\n@@ -549,3 +545,3 @@\n-        dwNameSize = MAX_BUFFER;\n-        dwDataValueSize = MAX_BUFFER;\n-        ret = RegEnumValueW(hkeyFonts, nval, (LPWSTR)wname, &dwNameSize,\n+        DWORD dwNameSize = dwMaxValueNameLen;\n+        DWORD dwDataValueSize = dwMaxValueDataLen;\n+        ret = RegEnumValueW(hkeyFonts, nval, wname, &dwNameSize,\n@@ -561,1 +557,1 @@\n-        if (!RegistryToBaseTTNameW((LPWSTR)wname) ) {\n+        if (!RegistryToBaseTTNameW(wname) ) {\n@@ -566,1 +562,1 @@\n-            LPWSTR dot = wcsrchr((LPWSTR)data, L'.');\n+            LPWSTR dot = wcsrchr(data, L'.');\n@@ -572,1 +568,1 @@\n-        registerFontW(fmi, fontToFileMap, (LPWSTR)wname, (LPWSTR)data);\n+        registerFontW(fmi, fontToFileMap, wname, data);\n@@ -575,0 +571,2 @@\n+    free(wname);\n+    free(data);\n","filename":"src\/java.desktop\/windows\/native\/libfontmanager\/fontpath.c","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"}]}