{"files":[{"patch":"@@ -29,0 +29,1 @@\n+#include <malloc.h>\n@@ -519,5 +520,0 @@\n-#define MAX_NAME_BUFFER (MAX_PATH+1)\n-#define MAX_DATA_BUFFER (MAX_PATH*2+2)\n-    const wchar_t wname[MAX_NAME_BUFFER];\n-    const char data[MAX_DATA_BUFFER];\n-\n@@ -527,2 +523,0 @@\n-    DWORD dwNameSize;\n-    DWORD dwDataValueSize;\n@@ -543,3 +537,1 @@\n-    if (ret != ERROR_SUCCESS ||\n-        dwMaxValueNameLen >= MAX_NAME_BUFFER ||\n-        dwMaxValueDataLen >= MAX_DATA_BUFFER) {\n+    if (ret != ERROR_SUCCESS) {\n@@ -549,0 +541,3 @@\n+    dwMaxValueNameLen++; \/* Account for NULL-terminator *\/\n+    wchar_t *wname = (wchar_t*)malloc(dwMaxValueNameLen * sizeof(wchar_t));\n+    wchar_t *data = (wchar_t*)malloc(dwMaxValueDataLen);\n@@ -550,3 +545,3 @@\n-        dwNameSize = MAX_NAME_BUFFER;\n-        dwDataValueSize = MAX_DATA_BUFFER;\n-        ret = RegEnumValueW(hkeyFonts, nval, (LPWSTR)wname, &dwNameSize,\n+        DWORD dwNameSize = dwMaxValueNameLen;\n+        DWORD dwDataValueSize = dwMaxValueDataLen;\n+        ret = RegEnumValueW(hkeyFonts, nval, wname, &dwNameSize,\n@@ -562,1 +557,1 @@\n-        if (!RegistryToBaseTTNameW((LPWSTR)wname) ) {\n+        if (!RegistryToBaseTTNameW(wname) ) {\n@@ -567,1 +562,1 @@\n-            LPWSTR dot = wcsrchr((LPWSTR)data, L'.');\n+            LPWSTR dot = wcsrchr(data, L'.');\n@@ -573,1 +568,1 @@\n-        registerFontW(fmi, fontToFileMap, (LPWSTR)wname, (LPWSTR)data);\n+        registerFontW(fmi, fontToFileMap, wname, data);\n@@ -576,0 +571,2 @@\n+    free(wname);\n+    free(data);\n","filename":"src\/java.desktop\/windows\/native\/libfontmanager\/fontpath.c","additions":13,"deletions":16,"binary":false,"changes":29,"status":"modified"}]}