{"files":[{"patch":"@@ -3274,1 +3274,1 @@\n-Address MacroAssembler::add_memory_helper(const Address dst) {\n+Address MacroAssembler::add_memory_helper(const Address dst, Register tmp) {\n@@ -3279,1 +3279,1 @@\n-      return form_address(t1, dst.base(), dst.offset());\n+      return form_address(tmp, dst.base(), dst.offset());\n@@ -3281,2 +3281,2 @@\n-      la(t1, dst);\n-      return Address(t1);\n+      la(tmp, dst);\n+      return Address(tmp);\n@@ -3286,1 +3286,1 @@\n-void MacroAssembler::increment(const Address dst, int64_t value) {\n+void MacroAssembler::increment(const Address dst, int64_t value, Register tmp1, Register tmp2) {\n@@ -3290,5 +3290,5 @@\n-  Address adr = add_memory_helper(dst);\n-  assert(!adr.uses(t0), \"invalid dst for address increment\");\n-  ld(t0, adr);\n-  add(t0, t0, value, t1);\n-  sd(t0, adr);\n+  Address adr = add_memory_helper(dst, tmp2);\n+  assert(!adr.uses(tmp1), \"invalid dst for address increment\");\n+  ld(tmp1, adr);\n+  add(tmp1, tmp1, value, tmp2);\n+  sd(tmp1, adr);\n@@ -3297,1 +3297,1 @@\n-void MacroAssembler::incrementw(const Address dst, int32_t value) {\n+void MacroAssembler::incrementw(const Address dst, int32_t value, Register tmp1, Register tmp2) {\n@@ -3301,5 +3301,5 @@\n-  Address adr = add_memory_helper(dst);\n-  assert(!adr.uses(t0), \"invalid dst for address increment\");\n-  lwu(t0, adr);\n-  addw(t0, t0, value, t1);\n-  sw(t0, adr);\n+  Address adr = add_memory_helper(dst, tmp2);\n+  assert(!adr.uses(tmp1), \"invalid dst for address increment\");\n+  lwu(tmp1, adr);\n+  addw(tmp1, tmp1, value, tmp2);\n+  sw(tmp1, adr);\n@@ -3308,1 +3308,1 @@\n-void MacroAssembler::decrement(const Address dst, int64_t value) {\n+void MacroAssembler::decrement(const Address dst, int64_t value, Register tmp1, Register tmp2) {\n@@ -3312,5 +3312,5 @@\n-  Address adr = add_memory_helper(dst);\n-  assert(!adr.uses(t0), \"invalid dst for address decrement\");\n-  ld(t0, adr);\n-  sub(t0, t0, value, t1);\n-  sd(t0, adr);\n+  Address adr = add_memory_helper(dst, tmp2);\n+  assert(!adr.uses(tmp1), \"invalid dst for address decrement\");\n+  ld(tmp1, adr);\n+  sub(tmp1, tmp1, value, tmp2);\n+  sd(tmp1, adr);\n@@ -3319,1 +3319,1 @@\n-void MacroAssembler::decrementw(const Address dst, int32_t value) {\n+void MacroAssembler::decrementw(const Address dst, int32_t value, Register tmp1, Register tmp2) {\n@@ -3323,5 +3323,5 @@\n-  Address adr = add_memory_helper(dst);\n-  assert(!adr.uses(t0), \"invalid dst for address decrement\");\n-  lwu(t0, adr);\n-  subw(t0, t0, value, t1);\n-  sw(t0, adr);\n+  Address adr = add_memory_helper(dst, tmp2);\n+  assert(!adr.uses(tmp1), \"invalid dst for address decrement\");\n+  lwu(tmp1, adr);\n+  subw(tmp1, tmp1, value, tmp2);\n+  sw(tmp1, adr);\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":28,"deletions":28,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -1057,2 +1057,2 @@\n-  void increment(const Address dst, int64_t value = 1);\n-  void incrementw(const Address dst, int32_t value = 1);\n+  void increment(const Address dst, int64_t value = 1, Register tmp1 = t0, Register tmp2 = t1);\n+  void incrementw(const Address dst, int32_t value = 1, Register tmp1 = t0, Register tmp2 = t1);\n@@ -1060,2 +1060,2 @@\n-  void decrement(const Address dst, int64_t value = 1);\n-  void decrementw(const Address dst, int32_t value = 1);\n+  void decrement(const Address dst, int64_t value = 1, Register tmp1 = t0, Register tmp2 = t1);\n+  void decrementw(const Address dst, int32_t value = 1, Register tmp1 = t0, Register tmp2 = t1);\n@@ -1275,1 +1275,1 @@\n-  Address add_memory_helper(const Address dst);\n+  Address add_memory_helper(const Address dst, Register tmp);\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.hpp","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2453,3 +2453,1 @@\n-    __ ld(tmp, Address(disp_hdr, ObjectMonitor::recursions_offset_in_bytes() - markWord::monitor_value));\n-    __ add(tmp, tmp, 1);\n-    __ sd(tmp, Address(disp_hdr, ObjectMonitor::recursions_offset_in_bytes() - markWord::monitor_value));\n+    __ increment(Address(disp_hdr, ObjectMonitor::recursions_offset_in_bytes() - markWord::monitor_value), 1, t0, tmp);\n@@ -2461,3 +2459,1 @@\n-    __ ld(tmp, Address(xthread, JavaThread::held_monitor_count_offset()));\n-    __ add(tmp, tmp, 1);\n-    __ sd(tmp, Address(xthread, JavaThread::held_monitor_count_offset()));\n+    __ increment(Address(xthread, JavaThread::held_monitor_count_offset()), 1, t0, tmp);\n@@ -2540,3 +2536,1 @@\n-    __ ld(tmp, Address(xthread, JavaThread::held_monitor_count_offset()));\n-    __ sub(tmp, tmp, 1);\n-    __ sd(tmp, Address(xthread, JavaThread::held_monitor_count_offset()));\n+    __ decrement(Address(xthread, JavaThread::held_monitor_count_offset()), 1, t0, tmp);\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":3,"deletions":9,"binary":false,"changes":12,"status":"modified"}]}