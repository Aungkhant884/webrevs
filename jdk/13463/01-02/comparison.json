{"files":[{"patch":"@@ -334,1 +334,1 @@\n-    MetaspaceShared::unrecoverable_writing_error(\"\");\n+    MetaspaceShared::unrecoverable_writing_error();\n@@ -384,1 +384,1 @@\n-    MetaspaceShared::unrecoverable_writing_error(\"\");\n+    MetaspaceShared::unrecoverable_writing_error();\n@@ -1272,1 +1272,2 @@\n-  MetaspaceShared::unrecoverable_writing_error(err_msg(\"Unable to allocate from '%s' region\\nPlease reduce the number of shared classes.\", name));\n+  log_error(cds)(\"Unable to allocate from '%s' region\\nPlease reduce the number of shared classes.\", name);\n+  MetaspaceShared::unrecoverable_writing_error();\n","filename":"src\/hotspot\/share\/cds\/archiveBuilder.cpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -192,2 +192,3 @@\n-    MetaspaceShared::unrecoverable_writing_error(err_msg(\"Failed to expand shared space to \" SIZE_FORMAT \" bytes\",\n-                                                         need_committed_size));\n+    log_error(cds)(\"Failed to expand shared space to \" SIZE_FORMAT \" bytes\",\n+                    need_committed_size);\n+    MetaspaceShared::unrecoverable_writing_error();\n","filename":"src\/hotspot\/share\/cds\/archiveUtils.cpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -370,1 +370,2 @@\n-      MetaspaceShared::unrecoverable_loading_error(err_msg(\"-XX:+RecordDynamicDumpInfo%s\", __THEMSG));\n+      log_error(cds)(\"-XX:+RecordDynamicDumpInfo%s\", __THEMSG);\n+      MetaspaceShared::unrecoverable_loading_error();\n","filename":"src\/hotspot\/share\/cds\/dynamicArchive.cpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -347,1 +347,2 @@\n-    MetaspaceShared::unrecoverable_loading_error(err_msg(\"Unable to open file %s.\", cpe->name()));\n+    log_error(cds)(\"Unable to open file %s.\", cpe->name());\n+    MetaspaceShared::unrecoverable_loading_error();\n@@ -1077,1 +1078,2 @@\n-        MetaspaceShared::unrecoverable_loading_error(err_msg(\"%s%s\", mismatch_msg, hint_msg));\n+        log_error(cds)(\"%s%s\", mismatch_msg, hint_msg);\n+        MetaspaceShared::unrecoverable_loading_error();\n@@ -1427,1 +1429,2 @@\n-    MetaspaceShared::unrecoverable_loading_error(err_msg(\"Unable to seek to position %ld\", pos));\n+    log_error(cds)(\"Unable to seek to position %ld\", pos);\n+    MetaspaceShared::unrecoverable_loading_error();\n@@ -1473,2 +1476,3 @@\n-    MetaspaceShared::unrecoverable_writing_error(err_msg(\"Unable to create shared archive file %s: (%s).\", _full_path,\n-              os::strerror(errno)));\n+    log_error(cds)(\"Unable to create shared archive file %s: (%s).\", _full_path,\n+                   os::strerror(errno));\n+    MetaspaceShared::unrecoverable_writing_error();\n@@ -1711,5 +1715,6 @@\n-    MetaspaceShared::unrecoverable_writing_error(err_msg(\"Unable to write archive heap memory regions: \"\n-              \"number of memory regions exceeds maximum due to fragmentation. \"\n-              \"Please increase java heap size \"\n-              \"(current MaxHeapSize is \" SIZE_FORMAT \", InitialHeapSize is \" SIZE_FORMAT \").\",\n-              MaxHeapSize, InitialHeapSize));\n+    log_error(cds)(\"Unable to write archive heap memory regions: \"\n+                   \"number of memory regions exceeds maximum due to fragmentation. \"\n+                   \"Please increase java heap size \"\n+                   \"(current MaxHeapSize is \" SIZE_FORMAT \", InitialHeapSize is \" SIZE_FORMAT \").\",\n+                   MaxHeapSize, InitialHeapSize);\n+    MetaspaceShared::unrecoverable_writing_error();\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":15,"deletions":10,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -738,1 +738,1 @@\n-  MetaspaceShared::unrecoverable_writing_error(\"\");\n+  MetaspaceShared::unrecoverable_writing_error();\n@@ -1216,1 +1216,1 @@\n-    MetaspaceShared::unrecoverable_writing_error(\"\");\n+    MetaspaceShared::unrecoverable_writing_error();\n@@ -1226,1 +1226,1 @@\n-    MetaspaceShared::unrecoverable_writing_error(\"\");\n+    MetaspaceShared::unrecoverable_writing_error();\n@@ -1255,1 +1255,1 @@\n-        MetaspaceShared::unrecoverable_writing_error(\"\");\n+        MetaspaceShared::unrecoverable_writing_error();\n","filename":"src\/hotspot\/share\/cds\/heapShared.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -270,1 +270,2 @@\n-    MetaspaceShared::unrecoverable_writing_error(err_msg(\"Unable to reserve memory for symbols\\n%ld bytes.\", symbol_rs_size));\n+    log_error(cds)(\"Unable to reserve memory for symbols\\n%ld bytes.\", symbol_rs_size);\n+    MetaspaceShared::unrecoverable_writing_error();\n@@ -311,1 +312,2 @@\n-      unrecoverable_loading_error(err_msg(\"string length too large: %d\", utf8_length));\n+      log_error(cds)(\"string length too large: %d\", utf8_length);\n+      unrecoverable_loading_error();\n@@ -566,3 +568,0 @@\n-  \/\/ There may be pending VM operations. We have changed some global states\n-  \/\/ (such as vmClasses::_klasses) that may cause these VM operations\n-  \/\/ to fail. For safety, forget these operations and exit the VM directly.\n@@ -679,2 +678,3 @@\n-      MetaspaceShared::unrecoverable_writing_error(err_msg(\"Out of memory. Please run with a larger Java heap, current MaxHeapSize = \"\n-                                  SIZE_FORMAT \"M\", MaxHeapSize\/M));\n+      log_error(cds)(\"Out of memory. Please run with a larger Java heap, current MaxHeapSize = \"\n+                     SIZE_FORMAT \"M\", MaxHeapSize\/M);\n+      MetaspaceShared::unrecoverable_writing_error();\n@@ -910,4 +910,4 @@\n-  jio_fprintf(defaultStream::error_stream(),\n-              \"An error has occurred while processing the\"\n-              \" shared archive file.\\n\");\n-  log_error(cds)(\"%s\", message);\n+  log_error(cds)(\"An error has occurred while processing the shared archive file.\\n\");\n+  if (message != nullptr) {\n+    log_error(cds)(\"%s\", message);\n+  }\n@@ -920,2 +920,3 @@\n-  tty->print_cr(\"%s\", message);\n-  log_error(cds)(\"%s\", message);\n+  if (message != nullptr) {\n+    log_error(cds)(\"%s\", message);\n+  }\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.cpp","additions":14,"deletions":13,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -119,2 +119,2 @@\n-  static void unrecoverable_loading_error(const char* message);\n-  static void unrecoverable_writing_error(const char* message);\n+  static void unrecoverable_loading_error(const char* message = nullptr);\n+  static void unrecoverable_writing_error(const char* message = nullptr);\n","filename":"src\/hotspot\/share\/cds\/metaspaceShared.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -799,1 +799,1 @@\n-      MetaspaceShared::unrecoverable_writing_error(\"Too many strings to be archived: %ld\", _items_count);\n+      MetaspaceShared::unrecoverable_writing_error(err_msg(\"Too many strings to be archived: %ld\", _items_count));\n","filename":"src\/hotspot\/share\/classfile\/stringTable.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}