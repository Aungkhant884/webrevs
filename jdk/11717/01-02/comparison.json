{"files":[{"patch":"@@ -334,0 +334,2 @@\n+                            boolean shouldClose = shouldCloseAfter407(headers);\n+                            var closestr = shouldClose ? \"Connection: close\\r\\n\" : \"\";\n@@ -335,1 +337,1 @@\n-                                    \"Content-Length: 0\\r\\n\" +\n+                                    \"Content-Length: 0\\r\\n\" + closestr +\n@@ -347,1 +349,1 @@\n-                            if (shouldCloseAfter407(headers)) {\n+                            if (shouldClose) {\n@@ -448,0 +450,5 @@\n+            var cmdline = headers.get(0);\n+            int m = cmdline.indexOf(' ');\n+            var method = (m > 0) ? cmdline.substring(0, m) : null;\n+            var nobody = List.of(\"GET\", \"HEAD\");\n+\n@@ -458,4 +465,7 @@\n-            try {\n-                n = Integer.parseInt(cl);\n-                if (debug) {\n-                    System.out.printf(\"Proxy: content-length: %d%n\", n);\n+            if (cl == null) {\n+                if (nobody.contains(method)) {\n+                    n = 0;\n+                    System.out.printf(\"Proxy: no content length for %s, assuming 0%n\", method);\n+                } else {\n+                    System.out.printf(\"Proxy: no content-length for %s, closing connection%n\", method);\n+                    return true;\n@@ -463,6 +473,14 @@\n-            } catch (NumberFormatException x) {\n-                if (debug) {\n-                    System.out.println(\"Proxy: bad content-length, closing connection\");\n-                    System.out.println(\"Proxy: \\tcontent-length: \" + cl);\n-                    System.out.println(\"Proxy: \\theaders: \" + headers);\n-                    System.out.println(\"Proxy: \\t\" + x);\n+            } else {\n+                try {\n+                    n = Integer.parseInt(cl);\n+                    if (debug) {\n+                        System.out.printf(\"Proxy: content-length: %d%n\", n);\n+                    }\n+                } catch (NumberFormatException x) {\n+                    if (debug) {\n+                        System.out.println(\"Proxy: bad content-length, closing connection\");\n+                        System.out.println(\"Proxy: \\tcontent-length: \" + cl);\n+                        System.out.println(\"Proxy: \\theaders: \" + headers);\n+                        System.out.println(\"Proxy: \\t\" + x);\n+                    }\n+                    return true;  \/\/ should close\n@@ -470,1 +488,0 @@\n-                return true;  \/\/ should close\n@@ -478,5 +495,1 @@\n-            var cmdline = headers.get(0);\n-            int m = cmdline.indexOf(' ');\n-            var method = (m > 0) ? cmdline.substring(0, m) : null;\n-            var nobody = List.of(\"GET\", \"HEAD\");\n-            if (n == 0 || nobody.contains(m)) {\n+            if (n == 0) {\n","filename":"test\/jdk\/java\/net\/httpclient\/ProxyServer.java","additions":31,"deletions":18,"binary":false,"changes":49,"status":"modified"}]}