{"files":[{"patch":"@@ -24,1 +24,0 @@\n-\n@@ -38,2 +37,1 @@\n-import static java.nio.file.StandardOpenOption.APPEND;\n-import static java.nio.file.StandardOpenOption.CREATE;\n+\n@@ -46,0 +44,2 @@\n+import static java.nio.file.StandardOpenOption.APPEND;\n+import static java.nio.file.StandardOpenOption.CREATE;\n@@ -47,2 +47,0 @@\n-import jaxp.library.SimpleHttpServer;\n-import jdk.test.lib.util.JarUtils;\n@@ -50,0 +48,1 @@\n+import jdk.test.lib.util.JarUtils;\n@@ -57,0 +56,1 @@\n+import jdk.test.lib.net.SimpleHttpServer;\n@@ -75,1 +75,0 @@\n-    static String USER_DIR = getSystemProperty(\"user.dir\");\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/catalog\/CatalogFileInputTest.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -51,1 +51,0 @@\n-\n","filename":"test\/jdk\/java\/util\/jar\/JarFile\/mrjar\/MultiReleaseJarAPI.java","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -50,1 +50,0 @@\n-import java.net.InetAddress;\n@@ -54,0 +53,1 @@\n+import jdk.test.lib.net.SimpleHttpServer;\n@@ -55,2 +55,0 @@\n-\n-import org.testng.Assert;\n@@ -63,0 +61,1 @@\n+    static final String TESTCONTEXT = \"\/multi-release.jar\";  \/\/mapped to local file path\n@@ -66,1 +65,1 @@\n-        server = new SimpleHttpServer(InetAddress.getLoopbackAddress());\n+        server = new SimpleHttpServer(TESTCONTEXT, System.getProperty(\"user.dir\", \".\"));\n@@ -75,1 +74,1 @@\n-                        .path(\"\/multi-release.jar\").toURL(),\n+                        .path(TESTCONTEXT).toURL(),\n","filename":"test\/jdk\/java\/util\/jar\/JarFile\/mrjar\/MultiReleaseJarHttpProperties.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -75,1 +75,1 @@\n-        CreateMultiReleaseTestJars creator =  new CreateMultiReleaseTestJars();\n+        CreateMultiReleaseTestJars creator = new CreateMultiReleaseTestJars();\n@@ -102,1 +102,1 @@\n-        ((URLClassLoader)cldr).close();\n+        ((URLClassLoader) cldr).close();\n","filename":"test\/jdk\/java\/util\/jar\/JarFile\/mrjar\/MultiReleaseJarProperties.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -35,5 +35,0 @@\n-import org.testng.Assert;\n-import org.testng.annotations.AfterClass;\n-import org.testng.annotations.DataProvider;\n-import org.testng.annotations.Test;\n-\n@@ -62,0 +57,4 @@\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n","filename":"test\/jdk\/java\/util\/jar\/JarFile\/mrjar\/TestVersionedStream.java","additions":4,"deletions":5,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -38,1 +38,1 @@\n-import jdk.security.jarsigner.JarSigner;\n+import java.io.File;\n@@ -40,1 +40,1 @@\n-import jdk.test.lib.util.JarBuilder;\n+import jdk.security.jarsigner.JarSigner;\n@@ -42,0 +42,1 @@\n+import jdk.test.lib.util.JarBuilder;\n","filename":"test\/jdk\/lib\/testlibrary\/java\/util\/jar\/CreateMultiReleaseTestJars.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -1,81 +0,0 @@\n-\/*\n- * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n- *\n- * This code is free software; you can redistribute it and\/or modify it\n- * under the terms of the GNU General Public License version 2 only, as\n- * published by the Free Software Foundation.\n- *\n- * This code is distributed in the hope that it will be useful, but WITHOUT\n- * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n- * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n- * version 2 for more details (a copy is included in the LICENSE file that\n- * accompanied this code).\n- *\n- * You should have received a copy of the GNU General Public License version\n- * 2 along with this work; if not, write to the Free Software Foundation,\n- * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n- *\n- * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n- * or visit www.oracle.com if you need additional information or have any\n- * questions.\n- *\/\n-\n-import com.sun.net.httpserver.*;\n-\n-import java.io.IOException;\n-import java.io.InputStream;\n-import java.io.OutputStream;\n-import java.net.InetAddress;\n-import java.net.InetSocketAddress;\n-import java.nio.file.Files;\n-import java.nio.file.Path;\n-import java.nio.file.Paths;\n-\n-\/**\n- * Extremely simple server that only performs one task.  The server listens for\n- * requests on the ephemeral port.  If it sees a request that begins with\n- * \"\/multi-release.jar\", it consumes the request and returns a stream of bytes\n- * representing the jar file multi-release.jar found in \"userdir\".\n- *\/\n-class SimpleHttpServer {\n-    private static final String userdir = System.getProperty(\"user.dir\", \".\");\n-    private static final Path multirelease = Paths.get(userdir, \"multi-release.jar\");\n-\n-    private final HttpServer server;\n-    private final InetAddress address;\n-\n-    public SimpleHttpServer() throws IOException {\n-        this(null);\n-    }\n-\n-    public SimpleHttpServer(InetAddress addr) throws IOException {\n-        address = addr;\n-        server = HttpServer.create();\n-    }\n-\n-    public void start() throws IOException {\n-        server.bind(new InetSocketAddress(address, 0), 0);\n-        server.createContext(\"\/multi-release.jar\", t -> {\n-            try (InputStream is = t.getRequestBody()) {\n-                is.readAllBytes();  \/\/ probably not necessary to consume request\n-                byte[] bytes = Files.readAllBytes(multirelease);\n-                t.sendResponseHeaders(200, bytes.length);\n-                try (OutputStream os = t.getResponseBody()) {\n-                    os.write(bytes);\n-                }\n-            }\n-        });\n-        server.setExecutor(null); \/\/ creates a default executor\n-        server.start();\n-    }\n-\n-    public void stop() {\n-        server.stop(0);\n-    }\n-\n-    int getPort() {\n-        return server.getAddress().getPort();\n-    }\n-}\n-\n","filename":"test\/jdk\/lib\/testlibrary\/java\/util\/jar\/SimpleHttpServer.java","additions":0,"deletions":81,"binary":false,"changes":81,"status":"deleted"},{"patch":"@@ -29,2 +29,5 @@\n-import java.io.*;\n-import java.net.*;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.net.URL;\n+import java.net.URLConnection;\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/B4756443.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -38,0 +38,1 @@\n+\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/B5105410.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -31,1 +31,3 @@\n-import java.io.*;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n@@ -34,1 +36,2 @@\n-import java.util.jar.*;\n+import java.util.jar.JarEntry;\n+import java.util.jar.JarOutputStream;\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/JarURLConnectionUseCaches.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -44,1 +44,0 @@\n-import java.net.InetAddress;\n@@ -57,0 +56,1 @@\n+import jdk.test.lib.net.SimpleHttpServer;\n@@ -58,1 +58,0 @@\n-\n@@ -70,0 +69,1 @@\n+    static final String TESTCONTEXT = \"\/multi-release.jar\";\n@@ -80,1 +80,1 @@\n-        server = new SimpleHttpServer(InetAddress.getLoopbackAddress());\n+        server = new SimpleHttpServer(TESTCONTEXT,System.getProperty(\"user.dir\", \".\"));\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/MultiReleaseJarURLConnection.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -42,5 +42,0 @@\n-import jdk.test.lib.JDKToolFinder;\n-import jdk.test.lib.compiler.CompilerUtils;\n-import jdk.test.lib.process.ProcessTools;\n-import jdk.test.lib.util.JarUtils;\n-\n@@ -51,0 +46,1 @@\n+\n@@ -52,0 +48,4 @@\n+import jdk.test.lib.JDKToolFinder;\n+import jdk.test.lib.compiler.CompilerUtils;\n+import jdk.test.lib.process.ProcessTools;\n+import jdk.test.lib.util.JarUtils;\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/jarbug\/TestDriver.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -26,2 +26,1 @@\n-import java.io.*;\n-import java.util.*;\n+import java.io.InputStream;\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/jarbug\/src\/jar1\/GetResource.java","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -26,2 +26,3 @@\n-import java.io.*;\n-import java.util.*;\n+import java.io.InputStream;\n+import java.util.Locale;\n+import java.util.ResourceBundle;\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/jarbug\/src\/jar1\/LoadResourceBundle.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -24,23 +24,24 @@\n-import java.io.*;\n-import java.net.*;\n-import java.util.jar.*;\n-\n-public abstract class JarTest\n-{\n-        static String tmpdir = System.getProperty(\"java.io.tmpdir\");\n-        static String javaCmd = System.getProperty(\"java.home\") + File.separator +\n-                                \"bin\" + File.separator + \"java\";\n-\n-        \/**\n-         * Reads an input stream into a byte array.\n-         *\/\n-        protected byte[] readFully(InputStream in) throws Exception {\n-                ByteArrayOutputStream out = new ByteArrayOutputStream();\n-                byte[] buffer = new byte[32];\n-                int count;\n-\n-                while ((count = in.read(buffer)) >= 0) {\n-                        out.write(buffer, 0, count);\n-                }\n-\n-                return out.toByteArray();\n+import java.io.BufferedOutputStream;\n+import java.io.BufferedReader;\n+import java.io.ByteArrayOutputStream;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.PrintStream;\n+\n+public abstract class JarTest {\n+    static String tmpdir = System.getProperty(\"java.io.tmpdir\");\n+    static String javaCmd = System.getProperty(\"java.home\") + File.separator +\n+            \"bin\" + File.separator + \"java\";\n+\n+    \/**\n+     * Reads an input stream into a byte array.\n+     *\/\n+    protected byte[] readFully(InputStream in) throws Exception {\n+        ByteArrayOutputStream out = new ByteArrayOutputStream();\n+        byte[] buffer = new byte[32];\n+        int count;\n+\n+        while ((count = in.read(buffer)) >= 0) {\n+            out.write(buffer, 0, count);\n@@ -49,12 +50,27 @@\n-        \/**\n-         * Copies the named resource into the directory specified.\n-         *\/\n-        protected File copyResource(File dir, String resName) throws Exception {\n-                BufferedOutputStream buffOut = null;\n-                FileOutputStream fileOut;\n-                InputStream in = null;\n-                File file = null;\n-                byte[] buffer;\n-                int count;\n-\n-                file = new File(dir, resName);\n+        return out.toByteArray();\n+    }\n+\n+    \/**\n+     * Copies the named resource into the directory specified.\n+     *\/\n+    protected File copyResource(File dir, String resName) throws Exception {\n+        BufferedOutputStream buffOut = null;\n+        FileOutputStream fileOut;\n+        InputStream in = null;\n+        File file = null;\n+        byte[] buffer;\n+        int count;\n+\n+        file = new File(dir, resName);\n+        try {\n+            fileOut = new FileOutputStream(file);\n+            buffOut = new BufferedOutputStream(fileOut);\n+            in = getClass().getResourceAsStream(resName);\n+            buffer = new byte[1024];\n+\n+            while ((count = in.read(buffer)) >= 0) {\n+                buffOut.write(buffer, 0, count);\n+            }\n+            buffOut.flush();\n+        } finally {\n+            if (buffOut != null) {\n@@ -62,22 +78,2 @@\n-                    fileOut = new FileOutputStream(file);\n-                    buffOut = new BufferedOutputStream(fileOut);\n-                    in = getClass().getResourceAsStream(resName);\n-                    buffer = new byte[1024];\n-\n-                    while ((count = in.read(buffer)) >= 0) {\n-                            buffOut.write(buffer, 0, count);\n-                    }\n-                    buffOut.flush();\n-                } finally {\n-                    if (buffOut != null) {\n-                        try {\n-                            buffOut.close();\n-                        } catch (IOException e) {\n-                        }\n-                    }\n-                    if (in != null) {\n-                        try {\n-                            in.close();\n-                        }  catch (IOException e) {\n-                        }\n-                    }\n+                    buffOut.close();\n+                } catch (IOException e) {\n@@ -85,2 +81,7 @@\n-\n-                return file;\n+            }\n+            if (in != null) {\n+                try {\n+                    in.close();\n+                } catch (IOException e) {\n+                }\n+            }\n@@ -89,7 +90,2 @@\n-        \/**\n-         * Utility to create a temp dir.\n-         *\/\n-        protected File createTempDir() throws Exception {\n-                File result = new File(tmpdir  + File.separator + getClass().getName());\n-                result.delete();\n-                result.mkdirs();\n+        return file;\n+    }\n@@ -97,2 +93,7 @@\n-                return result;\n-        }\n+    \/**\n+     * Utility to create a temp dir.\n+     *\/\n+    protected File createTempDir() throws Exception {\n+        File result = new File(tmpdir + File.separator + getClass().getName());\n+        result.delete();\n+        result.mkdirs();\n@@ -100,14 +101,2 @@\n-        \/**\n-         * Utility to recursively delete a directory.\n-         *\/\n-        protected  boolean deleteRecursively(File file) {\n-                File[] children;\n-                boolean result = true;\n-\n-                children = file.listFiles();\n-                if (children != null) {\n-                        for (int i=0; i<children.length; i++) {\n-                                result = result && deleteRecursively(children[i]);\n-                        }\n-                }\n-                result = result && file.delete();\n+        return result;\n+    }\n@@ -115,1 +104,12 @@\n-                return result;\n+    \/**\n+     * Utility to recursively delete a directory.\n+     *\/\n+    protected boolean deleteRecursively(File file) {\n+        File[] children;\n+        boolean result = true;\n+\n+        children = file.listFiles();\n+        if (children != null) {\n+            for (int i = 0; i < children.length; i++) {\n+                result = result && deleteRecursively(children[i]);\n+            }\n@@ -117,0 +117,4 @@\n+        result = result && file.delete();\n+\n+        return result;\n+    }\n@@ -118,2 +122,1 @@\n-    static class Redirector implements Runnable\n-    {\n+    static class Redirector implements Runnable {\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/jar\/jarbug\/src\/test\/JarTest.java","additions":88,"deletions":85,"binary":false,"changes":173,"status":"modified"},{"patch":"@@ -23,1 +23,1 @@\n-package jaxp.library;\n+package jdk.test.lib.net;\n@@ -30,0 +30,1 @@\n+\n@@ -91,0 +92,4 @@\n+    public int getPort() {\n+        return _httpserver.getAddress().getPort();\n+    }\n+\n","filename":"test\/lib\/jdk\/test\/lib\/net\/SimpleHttpServer.java","additions":6,"deletions":1,"binary":false,"changes":7,"previous_filename":"test\/jaxp\/javax\/xml\/jaxp\/libs\/jaxp\/library\/SimpleHttpServer.java","status":"renamed"}]}