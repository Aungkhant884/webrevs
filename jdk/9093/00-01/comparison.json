{"files":[{"patch":"@@ -255,1 +255,1 @@\n-    \/\/ and Expect-Continue\n+    \/\/ an Expect-Continue\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/ExchangeImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -306,1 +306,2 @@\n-        \/\/ TODO: add comment\n+        \/\/ Have to mark request as sent, due to no request body being sent\n+        \/\/ in the event of a 417 Expectation Failed\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Stream.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,1 +39,1 @@\n- * @run testng\/othervm\/timeout=10  ExpectContinueTest\n+ * @run testng\/othervm ExpectContinueTest\n@@ -45,0 +45,1 @@\n+import org.testng.annotations.AfterTest;\n@@ -51,0 +52,1 @@\n+import java.io.Closeable;\n@@ -73,2 +75,1 @@\n-    HttpServerAdapters.HttpTestServer httpTestServer;    \/\/ HTTP\/1.1\n-    HttpServerAdapters.HttpTestServer http2TestServer;   \/\/ HTTP\/2\n+    HttpTestServer http1TestServer; \/\/ HTTP\/1.1\n@@ -76,0 +77,1 @@\n+    HttpTestServer http2TestServer; \/\/ HTTP\/2\n@@ -84,0 +86,2 @@\n+    static final String EXPECTATION_FAILED_417 = \"417 Expectation Failed\";\n+\n@@ -89,5 +93,5 @@\n-        httpTestServer = HttpServerAdapters.HttpTestServer.of(HttpServer.create(sa, 0));\n-        httpTestServer.addHandler(new GetHandler(), \"\/http1\/get\");\n-        httpTestServer.addHandler(new PostHandler(), \"\/http1\/post\");\n-        getUri = URI.create(\"http:\/\/\" + httpTestServer.serverAuthority() + \"\/http1\/get\");\n-        postUri = URI.create(\"http:\/\/\" + httpTestServer.serverAuthority() + \"\/http1\/post\");\n+        http1TestServer = HttpTestServer.of(HttpServer.create(sa, 0));\n+        http1TestServer.addHandler(new GetHandler(), \"\/http1\/get\");\n+        http1TestServer.addHandler(new PostHandler(), \"\/http1\/post\");\n+        getUri = URI.create(\"http:\/\/\" + http1TestServer.serverAuthority() + \"\/http1\/get\");\n+        postUri = URI.create(\"http:\/\/\" + http1TestServer.serverAuthority() + \"\/http1\/post\");\n@@ -101,1 +105,1 @@\n-        http2TestServer = HttpServerAdapters.HttpTestServer.of(\n+        http2TestServer = HttpTestServer.of(\n@@ -110,1 +114,1 @@\n-        httpTestServer.start();\n+        http1TestServer.start();\n@@ -115,0 +119,7 @@\n+    @AfterTest\n+    public void teardown() throws IOException {\n+        http1TestServer.stop();\n+        http1HangServer.close();\n+        http2TestServer.stop();\n+    }\n+\n@@ -140,1 +151,0 @@\n-                byte[] bytes = \"200 OK\".getBytes(UTF_8);\n@@ -153,1 +163,1 @@\n-                byte[] bytes = \"417 Expectation Failed\".getBytes();\n+                byte[] bytes = EXPECTATION_FAILED_417.getBytes();\n@@ -160,1 +170,1 @@\n-    static class Http1HangServer extends Thread {\n+    static class Http1HangServer extends Thread implements Closeable {\n@@ -166,0 +176,1 @@\n+        volatile Socket client;\n@@ -176,1 +187,1 @@\n-            byte[] bytes = \"417 Expectation Failed\".getBytes();\n+            byte[] bytes = EXPECTATION_FAILED_417.getBytes();\n@@ -182,1 +193,1 @@\n-                    Socket client = ss.accept();\n+                    client = ss.accept();\n@@ -205,1 +216,1 @@\n-                    \/\/ If correct request, send 417 reply. Otherwise wait for correct one\n+                    \/\/ If correct request, send 417 reply. Otherwise, wait for correct one\n@@ -217,0 +228,2 @@\n+                    } else {\n+                        client.close();\n@@ -224,0 +237,6 @@\n+\n+        @Override\n+        public void close() throws IOException {\n+            if (client != null) client.close();\n+            if (ss != null) ss.close();\n+        }\n","filename":"test\/jdk\/java\/net\/httpclient\/ExpectContinueTest.java","additions":36,"deletions":17,"binary":false,"changes":53,"status":"modified"}]}