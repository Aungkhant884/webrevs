{"files":[{"patch":"@@ -410,4 +410,3 @@\n-        try {\n-            kt.run(args, System.out);\n-        } catch (ExitException ee) {\n-            System.exit(ee.errorCode);\n+        int exitCode = kt.run(args, System.out);\n+        if (exitCode != 0) {\n+            System.exit(exitCode);\n@@ -426,1 +425,1 @@\n-    public void run(String[] args, PrintStream out) throws Exception {\n+    public int run(String[] args, PrintStream out) throws Exception {\n@@ -433,1 +432,1 @@\n-            throw ee;\n+            return ee.errorCode;\n@@ -440,1 +439,1 @@\n-                throw new ExitException(1);\n+                return 1;\n@@ -457,0 +456,1 @@\n+        return 0;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/Main.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -96,4 +96,3 @@\n-        try {\n-            kinit.run(args);\n-        } catch (Exception e) {\n-            System.exit(-1);\n+        int exitCode = kinit.run(args);\n+        if (exitCode != 0) {\n+            System.exit(exitCode);\n@@ -107,3 +106,1 @@\n-     * @exception IOException if an I\/O error occurs.\n-     * @exception RealmException if the Realm could not be instantiated.\n-     * @exception KrbException if error occurs during Kerberos operation.\n+     * @return the exit code\n@@ -111,2 +108,1 @@\n-    public void run(String[] args)\n-            throws IOException, RealmException, KrbException {\n+    public int run(String[] args) {\n@@ -134,1 +130,1 @@\n-            String msg = null;\n+            String msg;\n@@ -147,1 +143,1 @@\n-            throw e;\n+            return -1;\n@@ -149,0 +145,1 @@\n+        return 0;\n","filename":"src\/java.security.jgss\/windows\/classes\/sun\/security\/krb5\/internal\/tools\/Kinit.java","additions":8,"deletions":11,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -81,4 +81,3 @@\n-        try {\n-            klist.run(args);\n-        } catch (ExitException ee) {\n-            System.exit(ee.errorCode);\n+        int exitCode = klist.run(args);\n+        if (exitCode != 0) {\n+            System.exit(exitCode);\n@@ -88,10 +87,1 @@\n-    private static class ExitException extends RuntimeException {\n-        @java.io.Serial\n-        static final long serialVersionUID = 0L;\n-        private final int errorCode;\n-        public ExitException(int errorCode) {\n-            this.errorCode = errorCode;\n-        }\n-    }\n-\n-    public void run(String[] args) throws ExitException {\n+    public int run(String[] args) {\n@@ -107,1 +97,1 @@\n-                    return;\n+                    return 0;\n@@ -137,0 +127,1 @@\n+                            System.out.println(\"Invalid argument: \" + args[i]);\n@@ -138,1 +129,1 @@\n-                            throw new ExitException(-1);\n+                            return -1;\n@@ -140,1 +131,0 @@\n-\n@@ -145,1 +135,0 @@\n-                        arg = null;\n@@ -147,0 +136,1 @@\n+                        System.out.println(\"Invalid argument: \" + args[i]);\n@@ -148,1 +138,1 @@\n-                        throw new ExitException(-1);\n+                        return -1;\n@@ -162,1 +152,1 @@\n-                displayCache();\n+                return displayCache();\n@@ -165,1 +155,1 @@\n-                throw new ExitException(-1);\n+                return -1;\n@@ -167,1 +157,0 @@\n-            break;\n@@ -172,1 +161,1 @@\n-                throw new ExitException(-1);\n+                return -1;\n@@ -176,1 +165,1 @@\n-                throw new ExitException(-1);\n+                return -1;\n@@ -180,2 +169,1 @@\n-            displayTab();\n-            break;\n+            return displayTab();\n@@ -185,1 +173,1 @@\n-                throw new ExitException(-1);\n+                return -1;\n@@ -190,1 +178,1 @@\n-                    displayCache();\n+                    return displayCache();\n@@ -193,1 +181,1 @@\n-                    throw new ExitException(-1);\n+                    return -1;\n@@ -199,1 +187,1 @@\n-    void displayTab() {\n+    int displayTab() {\n@@ -234,0 +222,1 @@\n+        return 0;\n@@ -236,1 +225,1 @@\n-    void displayCache() {\n+    int displayCache() {\n@@ -243,1 +232,1 @@\n-            throw new ExitException(-1);\n+            return -1;\n@@ -340,1 +329,1 @@\n-                    throw new ExitException(-1);\n+                    return -1;\n@@ -355,0 +344,2 @@\n+\n+        return 0;\n","filename":"src\/java.security.jgss\/windows\/classes\/sun\/security\/krb5\/internal\/tools\/Klist.java","additions":24,"deletions":33,"binary":false,"changes":57,"status":"modified"},{"patch":"@@ -76,4 +76,3 @@\n-        try {\n-            ktab.run(args);\n-        } catch (ExitException ee) {\n-            System.exit(ee.errorCode);\n+        int exitCode = ktab.run(args);\n+        if (exitCode != 0) {\n+            System.exit(exitCode);\n@@ -92,1 +91,10 @@\n-    public void run(String[] args) throws ExitException {\n+    public int run(String[] args) {\n+        try {\n+            run0(args);\n+            return 0;\n+        } catch (ExitException ee) {\n+            return ee.errorCode;\n+        }\n+    }\n+\n+    private void run0(String[] args) throws ExitException {\n","filename":"src\/java.security.jgss\/windows\/classes\/sun\/security\/krb5\/internal\/tools\/Ktab.java","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -138,4 +138,3 @@\n-        try {\n-            js.run(args);\n-        } catch (ExitException ee) {\n-            System.exit(ee.errorCode);\n+        int exitCode = js.run(args);\n+        if (exitCode != 0) {\n+            System.exit(exitCode);\n@@ -250,1 +249,1 @@\n-    public void run(String args[]) {\n+    public int run(String args[]) {\n@@ -316,5 +315,1 @@\n-            if (ee.errorCode == 0) {\n-                return;\n-            } else {\n-                throw ee;\n-            }\n+            return ee.errorCode;\n@@ -326,1 +321,1 @@\n-            exit(1);\n+            return 1;\n@@ -359,3 +354,1 @@\n-            if (exitCode != 0) {\n-                exit(exitCode);\n-            }\n+            return exitCode;\n@@ -363,0 +356,2 @@\n+\n+        return 0;\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/security\/tools\/jarsigner\/Main.java","additions":9,"deletions":14,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -33,0 +33,2 @@\n+import jdk.test.lib.Asserts;\n+import jdk.test.lib.Platform;\n@@ -36,0 +38,3 @@\n+\n+    private static final int BAD = Platform.isWindows() ? -1 : 255;\n+\n@@ -40,1 +45,1 @@\n-                .shouldHaveExitValue(-1);\n+                .shouldHaveExitValue(BAD);\n@@ -43,1 +48,1 @@\n-                .shouldHaveExitValue(-1);\n+                .shouldHaveExitValue(BAD);\n@@ -46,1 +51,1 @@\n-                .shouldHaveExitValue(-1);\n+                .shouldHaveExitValue(BAD);\n@@ -48,19 +53,7 @@\n-        \/\/ calling the run() methods no longer\n-        try {\n-            new sun.security.krb5.internal.tools.Kinit()\n-                    .run(\"u@R p1 p2\".split(\" \"));\n-        } catch (Exception e) {\n-            \/\/ whatever\n-        }\n-        try {\n-            new sun.security.krb5.internal.tools.Klist()\n-                    .run(\"-x\".split(\" \"));\n-        } catch (Exception e) {\n-            \/\/ whatever\n-        }\n-        try {\n-            new sun.security.krb5.internal.tools.Ktab()\n-                    .run(\"-x\".split(\" \"));\n-        } catch (Exception e) {\n-            \/\/ whatever\n-        }\n+        \/\/ calling the run() methods returns the exit code\n+        Asserts.assertEQ(new sun.security.krb5.internal.tools.Kinit()\n+                .run(\"u@R p1 p2\".split(\" \")), -1);\n+        Asserts.assertEQ(new sun.security.krb5.internal.tools.Klist()\n+                .run(\"-x\".split(\" \")), -1);\n+        Asserts.assertEQ(new sun.security.krb5.internal.tools.Ktab()\n+                .run(\"-x\".split(\" \")), -1);\n","filename":"test\/jdk\/sun\/security\/krb5\/tools\/ExitOrNot.java","additions":15,"deletions":22,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+import jdk.test.lib.Asserts;\n@@ -45,6 +46,2 @@\n-        try {\n-            new sun.security.tools.jarsigner.Main()\n-                    .run(\"1 2 3\".split(\" \"));\n-        } catch (Exception e) {\n-            \/\/ whatever\n-        }\n+        Asserts.assertEQ(new sun.security.tools.jarsigner.Main()\n+                    .run(\"1 2 3\".split(\" \")), 1);\n@@ -52,6 +49,2 @@\n-        try {\n-            new sun.security.tools.keytool.Main()\n-                    .run(\"-x\".split(\" \"), System.out);\n-        } catch (Exception e) {\n-            \/\/ whatever\n-        }\n+        Asserts.assertEQ(new sun.security.tools.keytool.Main()\n+                    .run(\"-x\".split(\" \"), System.out), 1);\n","filename":"test\/jdk\/sun\/security\/tools\/jarsigner\/ExitOrNot.java","additions":5,"deletions":12,"binary":false,"changes":17,"status":"modified"}]}