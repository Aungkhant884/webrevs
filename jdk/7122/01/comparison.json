{"files":[{"patch":"@@ -544,2 +544,1 @@\n-                        if ((b1 == (byte)0xc2 || b1 == (byte)0xc3) &&\n-                                offset + 1 < sl) {\n+                        if ((b1 & 0xfe) == 0xc2 && offset + 1 < sl) { \/\/ b1 either 0xc2 or 0xc3\n@@ -701,2 +700,1 @@\n-                    if ((b1 == (byte) 0xc2 || b1 == (byte) 0xc3) &&\n-                            offset + 1 < sl) {\n+                    if ((b1 & 0xfe) == 0xc2 && offset + 1 < sl) { \/\/ b1 either 0xc2 or 0xc3\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -43,1 +43,1 @@\n-@Fork(value = 3, jvmArgs = \"-Xmx1g\")\n+@Fork(value = 3)\n@@ -49,34 +49,2 @@\n-    @BenchmarkMode(Mode.AverageTime)\n-    @OutputTimeUnit(TimeUnit.NANOSECONDS)\n-    @Fork(value = 3, jvmArgs = \"-Xmx1g\")\n-    @Warmup(iterations = 5, time = 2)\n-    @Measurement(iterations = 5, time = 2)\n-    @State(Scope.Thread)\n-    public static class WithCharset {\n-\n-        @Param({\"US-ASCII\", \"ISO-8859-1\", \"UTF-8\", \"MS932\", \"ISO-8859-6\", \"ISO-2022-KR\"})\n-        private String charsetName;\n-\n-        private Charset charset;\n-        private byte[] asciiString;\n-        private byte[] utf16String;\n-\n-        @Setup\n-        public void setup() {\n-            charset = Charset.forName(charsetName);\n-            asciiString = \"ascii string\".getBytes(charset);\n-            utf16String = \"UTF-\\uFF11\\uFF16 string\".getBytes(charset);\n-        }\n-\n-        @Benchmark\n-        public void decodeCharsetName(Blackhole bh) throws Exception {\n-            bh.consume(new String(asciiString, charsetName));\n-            bh.consume(new String(utf16String, charsetName));\n-        }\n-\n-        @Benchmark\n-        public void decodeCharset(Blackhole bh) throws Exception {\n-            bh.consume(new String(asciiString, charset));\n-            bh.consume(new String(utf16String, charset));\n-        }\n-    }\n+    @Param({\"US-ASCII\", \"ISO-8859-1\", \"UTF-8\", \"MS932\", \"ISO-8859-6\", \"ISO-2022-KR\"})\n+    private String charsetName;\n@@ -84,2 +52,6 @@\n-    private byte[] asciiDefaultString;\n-    private byte[] utf16DefaultString;\n+    private Charset charset;\n+    private byte[] asciiString;\n+    private byte[] utf16String;\n+    private byte[] longUtf16String;\n+    private byte[] longUtf16StartString;\n+    private byte[] longLatin1String;\n@@ -89,2 +61,91 @@\n-        asciiDefaultString = \"ascii string\".getBytes();\n-        utf16DefaultString = \"UTF-\\uFF11\\uFF16 string\".getBytes();\n+        charset = Charset.forName(charsetName);\n+        asciiString = \"ascii string\".getBytes(charset);\n+        utf16String = \"UTF-\\uFF11\\uFF16 string\".getBytes(charset);\n+        longUtf16String = \"\"\"\n+             Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ac sem eu\n+             urna egestas placerat. Etiam finibus ipsum nulla, non mattis dolor cursus a.\n+             Nulla nec nisl consectetur, lacinia neque id, accumsan ante. Curabitur et\n+             sapien in magna porta ultricies. Sed vel pellentesque nibh. Pellentesque dictum\n+             dignissim diam eu ultricies. Class aptent taciti sociosqu ad litora torquent\n+             per conubia nostra, per inceptos himenaeos. Suspendisse erat diam, fringilla\n+             sed massa sed, posuere viverra orci. Suspendisse tempor libero non gravida\n+             efficitur. Vivamus lacinia risus non orci viverra, at consectetur odio laoreet.\n+             Suspendisse potenti.\n+\n+             Phasellus vel nisi iaculis, accumsan quam sed, bibendum eros. Sed venenatis\n+             nulla tortor, et eleifend urna sodales id. Nullam tempus ac metus sit amet\n+             sollicitudin. Nam sed ex diam. Praesent vitae eros et neque condimentum\n+             consectetur eget non tortor. Praesent bibendum vel felis nec dignissim.\n+             Maecenas a enim diam. Suspendisse quis ligula at nisi accumsan lacinia id\n+             hendrerit sapien. \\uFF11Donec aliquam mattis lectus eu ultrices. Duis eu nisl\\uFF11\n+             euismod, blandit mauris vel, \\uFF11placerat urna. Etiam malesuada enim purus,\n+             tristique mollis odio blandit quis.\\uFF11 Vivamus posuere. \\uFF11\n+             \\uFF11\n+            \"\"\".getBytes(charset);\n+        longUtf16StartString = \"\"\"\n+             \\uFF11\n+             Lorem ipsum dolor sit amet, \\uFF11consectetur adipiscing elit. Aliquam ac sem eu\n+             urna egestas \\uFF11placerat. Etiam finibus ipsum nulla, non mattis dolor cursus a.\n+             Nulla \\uFF11nec nisl consectetur, lacinia neque id, accumsan ante. Curabitur et\n+             sapien in \\uFF11magna porta ultricies. \\uFF11Sed vel pellentesque nibh. Pellentesque dictum\n+             dignissim diam eu ultricies. Class aptent taciti sociosqu ad litora torquent\n+             per conubia nostra, per inceptos himenaeos. Suspendisse erat diam, fringilla\n+             sed massa sed, posuere viverra orci. Suspendisse tempor libero non gravida\n+             efficitur. Vivamus lacinia risus non orci viverra, at consectetur odio laoreet.\n+             Suspendisse potenti.\n+\n+             Phasellus vel nisi iaculis, accumsan quam sed, bibendum eros. Sed venenatis\n+             nulla tortor, et eleifend urna sodales id. Nullam tempus ac metus sit amet\n+             sollicitudin. Nam sed ex diam. Praesent vitae eros et neque condimentum\n+             consectetur eget non tortor. Praesent bibendum vel felis nec dignissim.\n+             Maecenas a enim diam. Suspendisse quis ligula at nisi accumsan lacinia id\n+             hendrerit sapien. Donec aliquam mattis lectus eu ultrices. Duis eu nisl\n+             euismod, blandit mauris vel, placerat urna. Etiam malesuada enim purus,\n+             tristique mollis odio blandit quis. Vivamus posuere.\n+            \"\"\".getBytes(charset);\n+\n+        longLatin1String = \"\"\"\n+             a\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             b\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             c\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             d\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             e\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             f\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             g\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             h\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             i\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             j\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\n+             k\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\\u00F6\n+             l\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\\u00F6\n+             m\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00F6\\u00B6\\u00F6\\u00F6\n+            \"\"\".getBytes(charset);\n+    }\n+\n+    @Benchmark\n+    public String decodeAsciiCharsetName() throws Exception {\n+        return new String(asciiString, charsetName);\n+    }\n+\n+    @Benchmark\n+    public String decodeAscii() throws Exception {\n+        return new String(asciiString, charset);\n+    }\n+\n+    @Benchmark\n+    public String decodeLatin1Long() throws Exception {\n+        return new String(longLatin1String, charset);\n+    }\n+\n+    @Benchmark\n+    public String decodeUTF16Short() throws Exception {\n+        return new String(utf16String, charset);\n+    }\n+\n+    @Benchmark\n+    public String decodeUTF16LongEnd() throws Exception {\n+        return new String(longUtf16String, charset);\n+    }\n+\n+    @Benchmark\n+    public String decodeUTF16LongStart() throws Exception {\n+        return new String(longUtf16StartString, charset);\n@@ -94,3 +155,3 @@\n-    public void decodeDefault(Blackhole bh) throws Exception {\n-        bh.consume(new String(asciiDefaultString));\n-        bh.consume(new String(utf16DefaultString));\n+    public void decodeUTF16LongMixed(Blackhole bh) throws Exception {\n+        bh.consume(new String(longUtf16StartString, charset));\n+        bh.consume(new String(longUtf16String, charset));\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/lang\/StringDecode.java","additions":103,"deletions":42,"binary":false,"changes":145,"status":"modified"}]}