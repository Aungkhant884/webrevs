{"files":[{"patch":"@@ -32,0 +32,1 @@\n+Semaphore AsyncLogWriter::_io_sem(1);\n@@ -35,1 +36,0 @@\n-  debug_only(static intx _locking_thread_id;)\n@@ -40,1 +40,0 @@\n-    debug_only(_locking_thread_id = os::current_thread_id());\n@@ -44,1 +43,0 @@\n-    debug_only(_locking_thread_id = -1);\n@@ -50,1 +48,0 @@\n-debug_only(intx AsyncLogLocker::_locking_thread_id = -1;)\n@@ -129,2 +126,1 @@\n-    AsyncLogLocker ml;\n-    AsyncLogMapIterator dropped_counters_iter(logs);\n+    AsyncLogLocker lock;\n@@ -134,0 +130,1 @@\n+    AsyncLogMapIterator dropped_counters_iter(logs);\n@@ -138,0 +135,1 @@\n+  _io_sem.wait();\n@@ -147,0 +145,1 @@\n+  _io_sem.signal();\n@@ -150,3 +149,1 @@\n-  _state = ThreadState::Running;\n-\n-  while (_state == ThreadState::Running) {\n+  while (true) {\n@@ -185,0 +182,2 @@\n+\/\/ write() acquires and releases _io_sem even _buffer is empty.\n+\/\/ This guarantees all logging I\/O of dequeued messages are done when it returns.\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.cpp","additions":8,"deletions":9,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -138,0 +138,1 @@\n+  \/\/ It decreases in AsyncLogWriter::run()\n@@ -139,0 +140,2 @@\n+  \/\/ A lock of IO\n+  static Semaphore _io_sem;\n","filename":"src\/hotspot\/share\/logging\/logAsyncWriter.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -265,0 +265,1 @@\n+    AsyncLogWriter::flush();\n","filename":"src\/hotspot\/share\/logging\/logConfiguration.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -49,0 +49,1 @@\n+  AsyncLogWriter::flush();\n","filename":"test\/hotspot\/gtest\/logging\/logTestFixture.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -25,0 +25,1 @@\n+#include \"logging\/logAsyncWriter.hpp\"\n@@ -49,0 +50,1 @@\n+  AsyncLogWriter::flush();\n@@ -138,0 +140,1 @@\n+  AsyncLogWriter::flush();\n","filename":"test\/hotspot\/gtest\/logging\/logTestUtils.inline.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+  AsyncLogWriter::flush();\n","filename":"test\/hotspot\/gtest\/logging\/test_log.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}