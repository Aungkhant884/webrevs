{"files":[{"patch":"@@ -899,2 +899,4 @@\n-    if (use_avx_limit > 2 && is_intel_skylake() && _stepping < 5) {\n-      FLAG_SET_DEFAULT(UseAVX, 2);\n+    if (use_avx_limit > 2 && is_intel_skylake()) {\n+      if (_stepping < 5) {\n+        FLAG_SET_DEFAULT(UseAVX, 2);\n+      }\n@@ -905,0 +907,1 @@\n+\n@@ -1295,0 +1298,19 @@\n+  if (FLAG_IS_DEFAULT(SuperWordMaxVectorSize)) {\n+    if (FLAG_IS_DEFAULT(UseAVX) && UseAVX > 2 &&\n+        is_intel_skylake() && _stepping > 5) {\n+      \/\/ Limit auto vectorization to 256 bit (32 byte) by default on Cascade Lake\n+      FLAG_SET_DEFAULT(SuperWordMaxVectorSize, 32);\n+    } else {\n+      FLAG_SET_DEFAULT(SuperWordMaxVectorSize, MaxVectorSize);\n+    }\n+  } else {\n+    if (SuperWordMaxVectorSize > MaxVectorSize) {\n+      warning(\"SuperWordMaxVectorSize cannot be greater than MaxVectorSize %i\", (int) MaxVectorSize);\n+      FLAG_SET_DEFAULT(SuperWordMaxVectorSize, MaxVectorSize);\n+    }\n+    if (!is_power_of_2(SuperWordMaxVectorSize)) {\n+      warning(\"SuperWordMaxVectorSize must be a power of 2, setting to MaxVectorSize: %i\", (int) MaxVectorSize);\n+      FLAG_SET_DEFAULT(SuperWordMaxVectorSize, MaxVectorSize);\n+    }\n+  }\n+\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":24,"deletions":2,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -85,0 +85,5 @@\n+  product(intx, SuperWordMaxVectorSize, 64,                                 \\\n+          \"Vector size limit in bytes for superword, \"                      \\\n+          \"superword vector size limit in bytes\")                           \\\n+          range(0, max_jint)                                                \\\n+                                                                            \\\n","filename":"src\/hotspot\/share\/opto\/c2_globals.hpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -204,0 +204,10 @@\n+\/\/------------------------------max vector size------------------------------\n+int SuperWord::max_vector_size(BasicType bt) {\n+  int max_vector = Matcher::max_vector_size(bt);\n+  int sw_max_vector_limit = SuperWordMaxVectorSize \/ type2aelembytes(bt);\n+  if (max_vector > sw_max_vector_limit) {\n+    max_vector = sw_max_vector_limit;\n+  }\n+  return max_vector;\n+}\n+\n@@ -222,1 +232,1 @@\n-  int max_vector = Matcher::max_vector_size(T_BYTE);\n+  int max_vector = max_vector_size(T_BYTE);\n@@ -357,1 +367,1 @@\n-      int cur_max_vector = Matcher::max_vector_size(bt);\n+      int cur_max_vector = max_vector_size(bt);\n@@ -996,1 +1006,1 @@\n-      vw = MIN2(Matcher::max_vector_size(btype)*type2aelembytes(btype), vw * 2);\n+      vw = MIN2(max_vector_size(btype)*type2aelembytes(btype), vw * 2);\n@@ -1694,1 +1704,1 @@\n-      uint max_vlen = Matcher::max_vector_size(bt); \/\/ Max elements in vector\n+      uint max_vlen = max_vector_size(bt); \/\/ Max elements in vector\n","filename":"src\/hotspot\/share\/opto\/superword.cpp","additions":14,"deletions":4,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -330,0 +330,2 @@\n+  int max_vector_size(BasicType bt);\n+\n","filename":"src\/hotspot\/share\/opto\/superword.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -280,0 +280,5 @@\n+bool VectorNode::vector_size_supported(BasicType bt, uint vlen) {\n+  return (Matcher::vector_size_supported(bt, vlen) &&\n+          (vlen * type2aelembytes(bt) <= (uint)SuperWordMaxVectorSize));\n+}\n+\n@@ -285,1 +290,1 @@\n-      Matcher::vector_size_supported(bt, vlen)) {\n+      vector_size_supported(bt, vlen)) {\n@@ -1278,1 +1283,1 @@\n-      Matcher::vector_size_supported(bt, vlen)) {\n+      VectorNode::vector_size_supported(bt, vlen)) {\n","filename":"src\/hotspot\/share\/opto\/vectornode.cpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -90,0 +90,1 @@\n+  static bool vector_size_supported(BasicType bt, uint vlen);\n","filename":"src\/hotspot\/share\/opto\/vectornode.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}