{"files":[{"patch":"@@ -150,1 +150,3 @@\n-  ProjNode* proj_true = create_slow_version_of_loop(loop, old_new, unswitch_iff->Opcode(), CloneIncludesStripMined);\n+  IfNode* invar_iff = create_slow_version_of_loop(loop, old_new, unswitch_iff, CloneIncludesStripMined);\n+  ProjNode* proj_true = invar_iff->proj_out(1);\n+  ProjNode* proj_false = invar_iff->proj_out(0);\n@@ -186,9 +188,0 @@\n-  \/\/ Add test to new \"if\" outside of loop\n-  IfNode* invar_iff   = proj_true->in(0)->as_If();\n-  Node* invar_iff_c   = invar_iff->in(0);\n-  BoolNode* bol       = unswitch_iff->in(1)->as_Bool();\n-  invar_iff->set_req(1, bol);\n-  invar_iff->_prob    = unswitch_iff->_prob;\n-\n-  ProjNode* proj_false = invar_iff->proj_out(0)->as_Proj();\n-\n@@ -199,1 +192,0 @@\n-\n@@ -252,2 +244,2 @@\n-\/\/ Return control projection of the entry to the fast version.\n-ProjNode* PhaseIdealLoop::create_slow_version_of_loop(IdealLoopTree *loop,\n+\/\/ Return the inserted if.\n+IfNode* PhaseIdealLoop::create_slow_version_of_loop(IdealLoopTree *loop,\n@@ -255,1 +247,1 @@\n-                                                      int opcode,\n+                                                      IfNode* unswitch_iff,\n@@ -265,8 +257,4 @@\n-  Node *cont      = _igvn.intcon(1);\n-  set_ctrl(cont, C->root());\n-  Node* opq       = new Opaque1Node(C, cont);\n-  register_node(opq, outer_loop, entry, dom_depth(entry));\n-  Node *bol       = new Conv2BNode(opq);\n-  register_node(bol, outer_loop, entry, dom_depth(entry));\n-  IfNode* iff = (opcode == Op_RangeCheck) ? new RangeCheckNode(entry, bol, PROB_MAX, COUNT_UNKNOWN) :\n-    new IfNode(entry, bol, PROB_MAX, COUNT_UNKNOWN);\n+  \/\/ Add test to new \"if\" outside of loop\n+  Node *bol   = unswitch_iff->in(1)->as_Bool();\n+  IfNode* iff = (unswitch_iff->Opcode() == Op_RangeCheck) ? new RangeCheckNode(entry, bol, unswitch_iff->_prob, unswitch_iff->_fcnt) :\n+    new IfNode(entry, bol, unswitch_iff->_prob, unswitch_iff->_fcnt);\n@@ -299,1 +287,1 @@\n-  return iffast;\n+  return iff;\n","filename":"src\/hotspot\/share\/opto\/loopUnswitch.cpp","additions":11,"deletions":23,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -1348,1 +1348,2 @@\n-  ProjNode* create_slow_version_of_loop(IdealLoopTree *loop,\n+  \/\/ Return the inserted if.\n+  IfNode* create_slow_version_of_loop(IdealLoopTree *loop,\n@@ -1350,1 +1351,1 @@\n-                                        int opcode,\n+                                        IfNode* unswitch_iff,\n","filename":"src\/hotspot\/share\/opto\/loopnode.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}