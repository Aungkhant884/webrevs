{"files":[{"patch":"@@ -593,1 +593,0 @@\n-javax\/net\/ssl\/SSLEngine\/CheckStatus.java                        8298872 generic-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,1 +46,3 @@\n-    private static boolean debug = true;\n+    private final SSLContext SSL_CONTEXT;\n+    private SSLEngine clientEngine;    \/\/ client\n+    private SSLEngine serverEngine;    \/\/ server\n@@ -48,3 +50,1 @@\n-    private SSLContext sslc;\n-    private SSLEngine ssle1;    \/\/ client\n-    private SSLEngine ssle2;    \/\/ server\n+    private static final String PATH_TO_STORES = \"..\/etc\";\n@@ -52,4 +52,2 @@\n-    private static String pathToStores = \"..\/etc\";\n-    private static String keyStoreFile = \"keystore\";\n-    private static String trustStoreFile = \"truststore\";\n-    private static String passwd = \"passphrase\";\n+    private static final String KEYSTORE_FILE = \"keystore\";\n+    private static final String TRUSTSTORE_FILE = \"truststore\";\n@@ -57,6 +55,6 @@\n-    private static String keyFilename =\n-            System.getProperty(\"test.src\", \".\/\") + \"\/\" + pathToStores +\n-                \"\/\" + keyStoreFile;\n-    private static String trustFilename =\n-            System.getProperty(\"test.src\", \".\/\") + \"\/\" + pathToStores +\n-                \"\/\" + trustStoreFile;\n+    private static final String keyFilename =\n+            System.getProperty(\"test.src\", \".\/\") + \"\/\" + PATH_TO_STORES +\n+                \"\/\" + KEYSTORE_FILE;\n+    private static final String trustFilename =\n+            System.getProperty(\"test.src\", \".\/\") + \"\/\" + PATH_TO_STORES +\n+                \"\/\" + TRUSTSTORE_FILE;\n@@ -64,4 +62,4 @@\n-    private ByteBuffer appOut1;         \/\/ write side of ssle1\n-    private ByteBuffer appIn1;          \/\/ read side of ssle1\n-    private ByteBuffer appOut2;         \/\/ write side of ssle2\n-    private ByteBuffer appIn2;          \/\/ read side of ssle2\n+    private ByteBuffer clientOut;         \/\/ write side of clientEngine\n+    private ByteBuffer clientIn;          \/\/ read side of clientEngine\n+    private ByteBuffer serverOut;         \/\/ write side of serverEngine\n+    private ByteBuffer serverIn;          \/\/ read side of serverEngine\n@@ -69,2 +67,2 @@\n-    private ByteBuffer oneToTwo;        \/\/ \"reliable\" transport ssle1->ssle2\n-    private ByteBuffer twoToOne;        \/\/ \"reliable\" transport ssle2->ssle1\n+    private ByteBuffer clientToServer;        \/\/ \"reliable\" transport clientEngine->serverEngine\n+    private ByteBuffer serverToClient;        \/\/ \"reliable\" transport serverEngine->clientEngine\n@@ -77,2 +75,2 @@\n-        ssle1 = sslc.createSSLEngine(\"client\", 1);\n-        ssle1.setUseClientMode(true);\n+        clientEngine = SSL_CONTEXT.createSSLEngine(\"client\", 1);\n+        clientEngine.setUseClientMode(true);\n@@ -80,2 +78,2 @@\n-        ssle2 = sslc.createSSLEngine(\"server\", 2);\n-        ssle2.setUseClientMode(false);\n+        serverEngine = SSL_CONTEXT.createSSLEngine(\"server\", 2);\n+        serverEngine.setUseClientMode(false);\n@@ -129,3 +127,2 @@\n-        SSLEngineResult result1;        \/\/ ssle1's results from last operation\n-        SSLEngineResult result2;        \/\/ ssle2's results from last operation\n-\n+        SSLEngineResult result1;        \/\/ clientEngine's results from last operation\n+        SSLEngineResult result2;        \/\/ serverEngine's results from last operation\n@@ -133,1 +130,1 @@\n-            \"SSL_RSA_WITH_RC4_128_MD5\" };\n+            \"TLS_DHE_RSA_WITH_AES_128_CBC_SHA\" };\n@@ -135,1 +132,1 @@\n-            \"SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA\" };\n+            \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\" };\n@@ -137,2 +134,4 @@\n-        ssle1.setEnabledCipherSuites(suite1);\n-        ssle2.setEnabledCipherSuites(suite1);\n+        clientEngine.setEnabledCipherSuites(suite1);\n+        clientEngine.setEnabledProtocols(new String[]{\"TLSv1.2\"});\n+        serverEngine.setEnabledCipherSuites(suite1);\n+        serverEngine.setEnabledProtocols(new String[]{\"TLSv1.2\"});\n@@ -143,3 +142,3 @@\n-        twoToOne.limit(0);\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        serverToClient.limit(0);\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -147,1 +146,1 @@\n-        twoToOne.limit(twoToOne.capacity());\n+        serverToClient.limit(serverToClient.capacity());\n@@ -150,3 +149,3 @@\n-        log(\"client hello\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ClientHello]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -155,2 +154,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -158,1 +157,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -160,1 +159,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -162,1 +161,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -165,2 +164,2 @@\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result2,\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result2,\n@@ -170,1 +169,1 @@\n-        log(\"ServerHello\");\n+        log(\"Server -> Client [ServerHello]\");\n@@ -172,2 +171,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -175,1 +174,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -177,2 +176,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -180,1 +179,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -182,1 +181,1 @@\n-        runDelegatedTasks(ssle1);\n+        runDelegatedTasks(clientEngine);\n@@ -185,3 +184,3 @@\n-        log(\"Key Exchange\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ClientKeyExchange]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -190,2 +189,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -193,1 +192,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -195,1 +194,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -197,1 +196,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -200,3 +199,3 @@\n-        log(\"CCS\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ChangeCipherSpec]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -205,2 +204,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -208,1 +207,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -212,1 +211,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -215,3 +214,3 @@\n-        log(\"Finished\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [Finished]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -220,2 +219,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -223,1 +222,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -226,1 +225,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -229,1 +228,1 @@\n-        log(\"CCS\");\n+        log(\"Server -> Client [NewSessionTicket]\");\n@@ -231,2 +230,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -234,1 +233,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -236,2 +235,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -239,1 +238,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -242,1 +241,1 @@\n-        log(\"FINISHED\");\n+        log(\"Server -> Client [ChangeCipherSpec]\");\n@@ -244,4 +243,22 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n-            Status.OK, HandshakeStatus.FINISHED, 0, -1);\n-        twoToOne.flip();\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+            Status.OK, HandshakeStatus.NEED_WRAP, 0, -1);\n+        serverToClient.flip();\n+\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n+            Status.OK, HandshakeStatus.NEED_UNWRAP, result2.bytesProduced(), 0);\n+        serverToClient.compact();\n+\n+        log(\"======================================\");\n+        log(\"Server -> Client [Finished]\");\n+\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+                Status.OK, HandshakeStatus.FINISHED, 0, -1);\n+        serverToClient.flip();\n+\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n+                Status.OK, HandshakeStatus.FINISHED, result2.bytesProduced(), 0);\n+        serverToClient.compact();\n@@ -249,4 +266,0 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n-            Status.OK, HandshakeStatus.FINISHED, result2.bytesProduced(), 0);\n-        twoToOne.compact();\n@@ -257,1 +270,1 @@\n-        String suite = ssle1.getSession().getCipherSuite();\n+        String suite = clientEngine.getSession().getCipherSuite();\n@@ -263,1 +276,1 @@\n-        suite = ssle2.getSession().getCipherSuite();\n+        suite = serverEngine.getSession().getCipherSuite();\n@@ -272,2 +285,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -275,2 +288,2 @@\n-            appOut1.capacity(), -1);\n-        oneToTwo.flip();\n+            clientOut.capacity(), -1);\n+        clientToServer.flip();\n@@ -278,2 +291,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -281,2 +294,2 @@\n-            appOut2.capacity(), -1);\n-        twoToOne.flip();\n+            serverOut.capacity(), -1);\n+        serverToClient.flip();\n@@ -284,2 +297,2 @@\n-        SSLEngineResult result3 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result3,\n+        SSLEngineResult result3 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result3,\n@@ -288,1 +301,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -290,2 +303,2 @@\n-        SSLEngineResult result4 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result4,\n+        SSLEngineResult result4 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result4,\n@@ -294,1 +307,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -296,4 +309,4 @@\n-        appIn1.clear();\n-        appIn2.clear();\n-        appOut1.rewind();\n-        appOut2.rewind();\n+        clientIn.clear();\n+        serverIn.clear();\n+        clientOut.rewind();\n+        serverOut.rewind();\n@@ -304,2 +317,2 @@\n-        ssle2.getSession().invalidate();\n-        ssle2.setNeedClientAuth(true);\n+        serverEngine.getSession().invalidate();\n+        serverEngine.setNeedClientAuth(true);\n@@ -307,2 +320,2 @@\n-        ssle1.setEnabledCipherSuites(suite2);\n-        ssle2.setEnabledCipherSuites(suite2);\n+        clientEngine.setEnabledCipherSuites(suite2);\n+        serverEngine.setEnabledCipherSuites(suite2);\n@@ -310,1 +323,1 @@\n-        ssle2.beginHandshake();\n+        serverEngine.beginHandshake();\n@@ -313,1 +326,1 @@\n-        log(\"HelloRequest\");\n+        log(\"Server -> Client [HelloRequest]\");\n@@ -315,2 +328,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -318,1 +331,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -320,2 +333,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -323,1 +336,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -325,1 +338,1 @@\n-        runDelegatedTasks(ssle1);\n+        runDelegatedTasks(clientEngine);\n@@ -328,1 +341,1 @@\n-        log(\"ClientHello\");\n+        log(\"CLient -> Server [ClientHello]\");\n@@ -330,2 +343,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -334,2 +347,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -337,1 +350,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -339,1 +352,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -341,1 +354,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -346,2 +359,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -349,2 +362,2 @@\n-            appOut1.capacity(), -1);\n-        oneToTwo.flip();\n+            clientOut.capacity(), -1);\n+        clientToServer.flip();\n@@ -352,2 +365,2 @@\n-        result4 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result4,\n+        result4 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result4,\n@@ -356,1 +369,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -358,2 +371,2 @@\n-        appIn2.clear();\n-        appOut1.rewind();\n+        serverIn.clear();\n+        clientOut.rewind();\n@@ -362,1 +375,1 @@\n-        log(\"ServerHello\");\n+        log(\"Server -> Client [ServerHello]\");\n@@ -364,2 +377,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -367,1 +380,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -369,2 +382,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -372,1 +385,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -374,1 +387,1 @@\n-        runDelegatedTasks(ssle1);\n+        runDelegatedTasks(clientEngine);\n@@ -379,2 +392,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -382,2 +395,2 @@\n-            appOut2.capacity(), -1);\n-        twoToOne.flip();\n+            serverOut.capacity(), -1);\n+        serverToClient.flip();\n@@ -385,2 +398,2 @@\n-        result3 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result3,\n+        result3 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result3,\n@@ -389,1 +402,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -391,2 +404,2 @@\n-        appIn1.clear();\n-        appOut2.rewind();\n+        clientIn.clear();\n+        serverOut.rewind();\n@@ -395,3 +408,3 @@\n-        log(\"Client Cert and Key Exchange\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [Certificate] and [ClientKeyExchange]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -400,2 +413,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -403,1 +416,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -405,1 +418,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -407,1 +420,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -410,3 +423,3 @@\n-        log(\"CCS\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ChangeCipherSpec]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -415,2 +428,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -418,1 +431,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -422,1 +435,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -425,3 +438,3 @@\n-        log(\"Finished\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [Finished]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -430,2 +443,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -433,1 +446,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -436,1 +449,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -439,1 +452,1 @@\n-        log(\"CCS\");\n+        log(\"Server -> Client [NewSessionTicket]\");\n@@ -441,2 +454,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -444,1 +457,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -446,2 +459,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -449,1 +462,14 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n+\n+        log(\"======================================\");\n+        log(\"Server -> Client [ChangeCipherSpec]\");\n+\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+                Status.OK, HandshakeStatus.NEED_WRAP, 0, -1);\n+        serverToClient.flip();\n+\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n+                Status.OK, HandshakeStatus.NEED_UNWRAP, result2.bytesProduced(), 0);\n+        serverToClient.compact();\n@@ -452,1 +478,1 @@\n-        log(\"FINISHED\");\n+        log(\"Server -> Client [Finished]\");\n@@ -454,2 +480,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -457,1 +483,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -459,2 +485,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -462,1 +488,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -467,1 +493,1 @@\n-        suite = ssle1.getSession().getCipherSuite();\n+        suite = clientEngine.getSession().getCipherSuite();\n@@ -473,1 +499,1 @@\n-        suite = ssle2.getSession().getCipherSuite();\n+        suite = serverEngine.getSession().getCipherSuite();\n@@ -482,2 +508,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -485,2 +511,2 @@\n-            appOut1.capacity(), -1);\n-        oneToTwo.flip();\n+            clientOut.capacity(), -1);\n+        clientToServer.flip();\n@@ -488,2 +514,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -491,2 +517,2 @@\n-            appOut2.capacity(), -1);\n-        twoToOne.flip();\n+            serverOut.capacity(), -1);\n+        serverToClient.flip();\n@@ -494,2 +520,2 @@\n-        result3 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result3,\n+        result3 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result3,\n@@ -498,1 +524,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -500,2 +526,2 @@\n-        result4 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result4,\n+        result4 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result4,\n@@ -504,1 +530,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -506,4 +532,4 @@\n-        appIn1.clear();\n-        appIn2.clear();\n-        appOut1.rewind();\n-        appOut2.rewind();\n+        clientIn.clear();\n+        serverIn.clear();\n+        clientOut.rewind();\n+        serverOut.rewind();\n@@ -512,1 +538,1 @@\n-        log(\"CN\");\n+        log(\"Server -> Client [CloseNotify]\");\n@@ -514,2 +540,2 @@\n-        if (isHandshaking(ssle1)) {\n-            throw new Exception(\"ssle1 IS handshaking\");\n+        if (isHandshaking(clientEngine)) {\n+            throw new Exception(\"clientEngine IS handshaking\");\n@@ -518,2 +544,2 @@\n-        if (isHandshaking(ssle2)) {\n-            throw new Exception(\"ssle2 IS handshaking\");\n+        if (isHandshaking(serverEngine)) {\n+            throw new Exception(\"serverEngine IS handshaking\");\n@@ -522,1 +548,1 @@\n-        ssle2.closeOutbound();\n+        serverEngine.closeOutbound();\n@@ -524,2 +550,2 @@\n-        if (!isHandshaking(ssle2)) {\n-            throw new Exception(\"ssle1 IS NOT handshaking\");\n+        if (!isHandshaking(serverEngine)) {\n+            throw new Exception(\"serverEngine IS NOT handshaking\");\n@@ -528,2 +554,2 @@\n-        appOut1.rewind();\n-        appOut2.rewind();\n+        clientOut.rewind();\n+        serverOut.rewind();\n@@ -531,4 +557,4 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n-            Status.CLOSED, HandshakeStatus.NEED_UNWRAP, 0, -1);\n-        twoToOne.flip();\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+            Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, -1);\n+        serverToClient.flip();\n@@ -536,2 +562,2 @@\n-        if (ssle1.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone\");\n+        if (clientEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone\");\n@@ -540,2 +566,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -544,1 +570,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -546,2 +572,2 @@\n-        if (!ssle1.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone\");\n+        if (!clientEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone\");\n@@ -550,2 +576,2 @@\n-        if (!isHandshaking(ssle1)) {\n-            throw new Exception(\"ssle1 IS NOT handshaking\");\n+        if (!isHandshaking(clientEngine)) {\n+            throw new Exception(\"clientEngine IS NOT handshaking\");\n@@ -554,4 +580,4 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n-            Status.CLOSED, HandshakeStatus.NEED_UNWRAP, 0, 0);\n-        twoToOne.flip();\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+            Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, 0);\n+        serverToClient.flip();\n@@ -560,1 +586,1 @@\n-        log(\"CN response\");\n+        log(\"CloseNotify response\");\n@@ -562,2 +588,2 @@\n-        if (ssle1.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone\");\n+        if (clientEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone\");\n@@ -566,3 +592,3 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n-             Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, -1);\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n+                        Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, -1);\n@@ -570,2 +596,2 @@\n-        if (!ssle1.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone is NOT done\");\n+        if (!clientEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone is NOT done\");\n@@ -574,2 +600,2 @@\n-        if (isHandshaking(ssle1)) {\n-            throw new Exception(\"ssle1 IS handshaking\");\n+        if (isHandshaking(clientEngine)) {\n+            throw new Exception(\"clientEngine IS handshaking\");\n@@ -578,1 +604,1 @@\n-        oneToTwo.flip();\n+        clientToServer.flip();\n@@ -580,2 +606,2 @@\n-        if (!ssle2.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone\");\n+        if (!serverEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone\");\n@@ -584,2 +610,2 @@\n-        if (ssle2.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone\");\n+        if (serverEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone\");\n@@ -588,1 +614,1 @@\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -590,1 +616,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -594,2 +620,2 @@\n-        if (!ssle2.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone is NOT done\");\n+        if (!serverEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone is NOT done\");\n@@ -598,2 +624,2 @@\n-        if (!ssle2.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone is NOT done\");\n+        if (!serverEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone is NOT done\");\n@@ -602,2 +628,2 @@\n-        if (isHandshaking(ssle2)) {\n-            throw new Exception(\"ssle1 IS handshaking\");\n+        if (isHandshaking(serverEngine)) {\n+            throw new Exception(\"clientEngine IS handshaking\");\n@@ -606,1 +632,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -617,3 +643,0 @@\n-\n-        cs.createSSLEngines();\n-\n@@ -632,1 +655,1 @@\n-        sslc = getSSLContext(keyFilename, trustFilename);\n+        SSL_CONTEXT = getSSLContext(keyFilename, trustFilename);\n@@ -665,1 +688,1 @@\n-        SSLSession session = ssle1.getSession();\n+        SSLSession session = clientEngine.getSession();\n@@ -669,2 +692,2 @@\n-        appIn1 = ByteBuffer.allocateDirect(appBufferMax + 50);\n-        appIn2 = ByteBuffer.allocateDirect(appBufferMax + 50);\n+        clientIn = ByteBuffer.allocateDirect(appBufferMax + 50);\n+        serverIn = ByteBuffer.allocateDirect(appBufferMax + 50);\n@@ -672,2 +695,2 @@\n-        oneToTwo = ByteBuffer.allocateDirect(netBufferMax);\n-        twoToOne = ByteBuffer.allocateDirect(netBufferMax);\n+        clientToServer = ByteBuffer.allocateDirect(netBufferMax);\n+        serverToClient = ByteBuffer.allocateDirect(netBufferMax);\n@@ -675,2 +698,2 @@\n-        appOut1 = ByteBuffer.wrap(\"Hi Engine2, I'm SSLEngine1\".getBytes());\n-        appOut2 = ByteBuffer.wrap(\"Hello Engine1, I'm SSLEngine2\".getBytes());\n+        clientOut = ByteBuffer.wrap(\"Hi Engine2, I'm SSLEngine1\".getBytes());\n+        serverOut = ByteBuffer.wrap(\"Hello Engine1, I'm SSLEngine2\".getBytes());\n@@ -678,2 +701,2 @@\n-        log(\"AppOut1 = \" + appOut1);\n-        log(\"AppOut2 = \" + appOut2);\n+        log(\"AppOut1 = \" + clientOut);\n+        log(\"AppOut2 = \" + serverOut);\n@@ -710,3 +733,1 @@\n-        if (debug) {\n-            System.out.println(str);\n-        }\n+        System.out.println(str);\n@@ -714,1 +735,1 @@\n-}\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/javax\/net\/ssl\/SSLEngine\/CheckStatus.java","additions":304,"deletions":283,"binary":false,"changes":587,"status":"modified"},{"patch":"@@ -82,1 +82,1 @@\n-            \"SSL_RSA_WITH_RC4_128_MD5\"});\n+            \"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384\"});\n@@ -85,1 +85,1 @@\n-            \"SSL_RSA_WITH_RC4_128_MD5\"});\n+            \"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384\"});\n","filename":"test\/jdk\/javax\/net\/ssl\/SSLEngine\/ConnectionTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}