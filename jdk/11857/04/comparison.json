{"files":[{"patch":"@@ -590,1 +590,0 @@\n-javax\/net\/ssl\/SSLEngine\/CheckStatus.java                        8298872 generic-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,1 @@\n- * @summary SSLEngineResult needs updating [none yet]\n+ * @summary Verify return values from SSLEngine wrap\/unwrap (TLSv1.2) operations\n@@ -29,1 +29,1 @@\n- * @run main\/othervm -Djsse.enableCBCProtection=false CheckStatus\n+ * @run main CheckStatus\n@@ -46,1 +46,3 @@\n-    private static boolean debug = true;\n+    private final SSLContext SSL_CONTEXT;\n+    private SSLEngine clientEngine;    \/\/ client\n+    private SSLEngine serverEngine;    \/\/ server\n@@ -48,3 +50,1 @@\n-    private SSLContext sslc;\n-    private SSLEngine ssle1;    \/\/ client\n-    private SSLEngine ssle2;    \/\/ server\n+    private static final String PATH_TO_STORES = \"..\/etc\";\n@@ -52,4 +52,2 @@\n-    private static String pathToStores = \"..\/etc\";\n-    private static String keyStoreFile = \"keystore\";\n-    private static String trustStoreFile = \"truststore\";\n-    private static String passwd = \"passphrase\";\n+    private static final String KEYSTORE_FILE = \"keystore\";\n+    private static final String TRUSTSTORE_FILE = \"truststore\";\n@@ -57,6 +55,6 @@\n-    private static String keyFilename =\n-            System.getProperty(\"test.src\", \".\/\") + \"\/\" + pathToStores +\n-                \"\/\" + keyStoreFile;\n-    private static String trustFilename =\n-            System.getProperty(\"test.src\", \".\/\") + \"\/\" + pathToStores +\n-                \"\/\" + trustStoreFile;\n+    private static final String keyFilename =\n+            System.getProperty(\"test.src\", \".\/\") + \"\/\" + PATH_TO_STORES +\n+                \"\/\" + KEYSTORE_FILE;\n+    private static final String trustFilename =\n+            System.getProperty(\"test.src\", \".\/\") + \"\/\" + PATH_TO_STORES +\n+                \"\/\" + TRUSTSTORE_FILE;\n@@ -64,4 +62,4 @@\n-    private ByteBuffer appOut1;         \/\/ write side of ssle1\n-    private ByteBuffer appIn1;          \/\/ read side of ssle1\n-    private ByteBuffer appOut2;         \/\/ write side of ssle2\n-    private ByteBuffer appIn2;          \/\/ read side of ssle2\n+    private ByteBuffer clientOut;         \/\/ write side of clientEngine\n+    private ByteBuffer clientIn;          \/\/ read side of clientEngine\n+    private ByteBuffer serverOut;         \/\/ write side of serverEngine\n+    private ByteBuffer serverIn;          \/\/ read side of serverEngine\n@@ -69,2 +67,2 @@\n-    private ByteBuffer oneToTwo;        \/\/ \"reliable\" transport ssle1->ssle2\n-    private ByteBuffer twoToOne;        \/\/ \"reliable\" transport ssle2->ssle1\n+    private ByteBuffer clientToServer;        \/\/ \"reliable\" transport clientEngine->serverEngine\n+    private ByteBuffer serverToClient;        \/\/ \"reliable\" transport serverEngine->clientEngine\n@@ -77,2 +75,2 @@\n-        ssle1 = sslc.createSSLEngine(\"client\", 1);\n-        ssle1.setUseClientMode(true);\n+        clientEngine = SSL_CONTEXT.createSSLEngine(\"client\", 1);\n+        clientEngine.setUseClientMode(true);\n@@ -80,2 +78,2 @@\n-        ssle2 = sslc.createSSLEngine(\"server\", 2);\n-        ssle2.setUseClientMode(false);\n+        serverEngine = SSL_CONTEXT.createSSLEngine(\"server\", 2);\n+        serverEngine.setUseClientMode(false);\n@@ -129,3 +127,2 @@\n-        SSLEngineResult result1;        \/\/ ssle1's results from last operation\n-        SSLEngineResult result2;        \/\/ ssle2's results from last operation\n-\n+        SSLEngineResult result1;        \/\/ clientEngine's results from last operation\n+        SSLEngineResult result2;        \/\/ serverEngine's results from last operation\n@@ -133,1 +130,1 @@\n-            \"SSL_RSA_WITH_RC4_128_MD5\" };\n+            \"TLS_DHE_RSA_WITH_AES_128_CBC_SHA\" };\n@@ -135,1 +132,1 @@\n-            \"SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA\" };\n+            \"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\" };\n@@ -137,2 +134,2 @@\n-        ssle1.setEnabledCipherSuites(suite1);\n-        ssle2.setEnabledCipherSuites(suite1);\n+        clientEngine.setEnabledCipherSuites(suite1);\n+        serverEngine.setEnabledCipherSuites(suite1);\n@@ -143,3 +140,3 @@\n-        twoToOne.limit(0);\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        serverToClient.limit(0);\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -147,1 +144,1 @@\n-        twoToOne.limit(twoToOne.capacity());\n+        serverToClient.limit(serverToClient.capacity());\n@@ -150,3 +147,3 @@\n-        log(\"client hello\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ClientHello]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -155,2 +152,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -158,1 +155,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -160,1 +157,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -162,1 +159,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -165,2 +162,2 @@\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result2,\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result2,\n@@ -170,1 +167,1 @@\n-        log(\"ServerHello\");\n+        log(\"Server -> Client [ServerHello]\");\n@@ -172,2 +169,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -175,1 +172,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -177,2 +174,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -180,1 +177,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -182,1 +179,1 @@\n-        runDelegatedTasks(ssle1);\n+        runDelegatedTasks(clientEngine);\n@@ -185,3 +182,3 @@\n-        log(\"Key Exchange\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ClientKeyExchange]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -190,2 +187,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -193,1 +190,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -195,1 +192,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -197,1 +194,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -200,3 +197,3 @@\n-        log(\"CCS\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ChangeCipherSpec]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -205,2 +202,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -208,1 +205,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -212,1 +209,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -215,3 +212,3 @@\n-        log(\"Finished\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [Finished]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -220,2 +217,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -223,1 +220,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -226,1 +223,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -229,1 +226,1 @@\n-        log(\"CCS\");\n+        log(\"Server -> Client [NewSessionTicket]\");\n@@ -231,2 +228,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -234,1 +231,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -236,2 +233,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -239,1 +236,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -242,1 +239,1 @@\n-        log(\"FINISHED\");\n+        log(\"Server -> Client [ChangeCipherSpec]\");\n@@ -244,4 +241,22 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n-            Status.OK, HandshakeStatus.FINISHED, 0, -1);\n-        twoToOne.flip();\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+            Status.OK, HandshakeStatus.NEED_WRAP, 0, -1);\n+        serverToClient.flip();\n+\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n+            Status.OK, HandshakeStatus.NEED_UNWRAP, result2.bytesProduced(), 0);\n+        serverToClient.compact();\n+\n+        log(\"======================================\");\n+        log(\"Server -> Client [Finished]\");\n+\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+                Status.OK, HandshakeStatus.FINISHED, 0, -1);\n+        serverToClient.flip();\n+\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n+                Status.OK, HandshakeStatus.FINISHED, result2.bytesProduced(), 0);\n+        serverToClient.compact();\n@@ -249,4 +264,0 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n-            Status.OK, HandshakeStatus.FINISHED, result2.bytesProduced(), 0);\n-        twoToOne.compact();\n@@ -257,1 +268,1 @@\n-        String suite = ssle1.getSession().getCipherSuite();\n+        String suite = clientEngine.getSession().getCipherSuite();\n@@ -263,1 +274,1 @@\n-        suite = ssle2.getSession().getCipherSuite();\n+        suite = serverEngine.getSession().getCipherSuite();\n@@ -272,2 +283,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -275,2 +286,2 @@\n-            appOut1.capacity(), -1);\n-        oneToTwo.flip();\n+            clientOut.capacity(), -1);\n+        clientToServer.flip();\n@@ -278,2 +289,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -281,2 +292,2 @@\n-            appOut2.capacity(), -1);\n-        twoToOne.flip();\n+            serverOut.capacity(), -1);\n+        serverToClient.flip();\n@@ -284,2 +295,2 @@\n-        SSLEngineResult result3 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result3,\n+        SSLEngineResult result3 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result3,\n@@ -288,1 +299,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -290,2 +301,2 @@\n-        SSLEngineResult result4 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result4,\n+        SSLEngineResult result4 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result4,\n@@ -294,1 +305,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -296,4 +307,4 @@\n-        appIn1.clear();\n-        appIn2.clear();\n-        appOut1.rewind();\n-        appOut2.rewind();\n+        clientIn.clear();\n+        serverIn.clear();\n+        clientOut.rewind();\n+        serverOut.rewind();\n@@ -304,2 +315,2 @@\n-        ssle2.getSession().invalidate();\n-        ssle2.setNeedClientAuth(true);\n+        serverEngine.getSession().invalidate();\n+        serverEngine.setNeedClientAuth(true);\n@@ -307,2 +318,2 @@\n-        ssle1.setEnabledCipherSuites(suite2);\n-        ssle2.setEnabledCipherSuites(suite2);\n+        clientEngine.setEnabledCipherSuites(suite2);\n+        serverEngine.setEnabledCipherSuites(suite2);\n@@ -310,1 +321,1 @@\n-        ssle2.beginHandshake();\n+        serverEngine.beginHandshake();\n@@ -313,1 +324,1 @@\n-        log(\"HelloRequest\");\n+        log(\"Server -> Client [HelloRequest]\");\n@@ -315,2 +326,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -318,1 +329,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -320,2 +331,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -323,1 +334,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -325,1 +336,1 @@\n-        runDelegatedTasks(ssle1);\n+        runDelegatedTasks(clientEngine);\n@@ -328,1 +339,1 @@\n-        log(\"ClientHello\");\n+        log(\"CLient -> Server [ClientHello]\");\n@@ -330,2 +341,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -334,2 +345,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -337,1 +348,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -339,1 +350,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -341,1 +352,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -346,2 +357,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -349,2 +360,2 @@\n-            appOut1.capacity(), -1);\n-        oneToTwo.flip();\n+            clientOut.capacity(), -1);\n+        clientToServer.flip();\n@@ -352,2 +363,2 @@\n-        result4 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result4,\n+        result4 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result4,\n@@ -356,1 +367,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -358,2 +369,2 @@\n-        appIn2.clear();\n-        appOut1.rewind();\n+        serverIn.clear();\n+        clientOut.rewind();\n@@ -362,1 +373,1 @@\n-        log(\"ServerHello\");\n+        log(\"Server -> Client [ServerHello]\");\n@@ -364,2 +375,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -367,1 +378,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -369,2 +380,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -372,1 +383,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -374,1 +385,1 @@\n-        runDelegatedTasks(ssle1);\n+        runDelegatedTasks(clientEngine);\n@@ -379,2 +390,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -382,2 +393,2 @@\n-            appOut2.capacity(), -1);\n-        twoToOne.flip();\n+            serverOut.capacity(), -1);\n+        serverToClient.flip();\n@@ -385,2 +396,2 @@\n-        result3 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result3,\n+        result3 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result3,\n@@ -389,1 +400,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -391,2 +402,2 @@\n-        appIn1.clear();\n-        appOut2.rewind();\n+        clientIn.clear();\n+        serverOut.rewind();\n@@ -395,3 +406,3 @@\n-        log(\"Client Cert and Key Exchange\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [Certificate] and [ClientKeyExchange]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -400,2 +411,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -403,1 +414,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -405,1 +416,1 @@\n-        runDelegatedTasks(ssle2);\n+        runDelegatedTasks(serverEngine);\n@@ -407,1 +418,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -410,3 +421,3 @@\n-        log(\"CCS\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [ChangeCipherSpec]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -415,2 +426,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -418,1 +429,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -422,1 +433,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -425,3 +436,3 @@\n-        log(\"Finished\");\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        log(\"Client -> Server [Finished]\");\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -430,2 +441,2 @@\n-        oneToTwo.flip();\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        clientToServer.flip();\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -433,1 +444,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -436,1 +447,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -439,1 +450,1 @@\n-        log(\"CCS\");\n+        log(\"Server -> Client [NewSessionTicket]\");\n@@ -441,2 +452,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -444,1 +455,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -446,2 +457,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -449,1 +460,14 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n+\n+        log(\"======================================\");\n+        log(\"Server -> Client [ChangeCipherSpec]\");\n+\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+                Status.OK, HandshakeStatus.NEED_WRAP, 0, -1);\n+        serverToClient.flip();\n+\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n+                Status.OK, HandshakeStatus.NEED_UNWRAP, result2.bytesProduced(), 0);\n+        serverToClient.compact();\n@@ -452,1 +476,1 @@\n-        log(\"FINISHED\");\n+        log(\"Server -> Client [Finished]\");\n@@ -454,2 +478,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -457,1 +481,1 @@\n-        twoToOne.flip();\n+        serverToClient.flip();\n@@ -459,2 +483,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -462,1 +486,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -467,1 +491,1 @@\n-        suite = ssle1.getSession().getCipherSuite();\n+        suite = clientEngine.getSession().getCipherSuite();\n@@ -473,1 +497,1 @@\n-        suite = ssle2.getSession().getCipherSuite();\n+        suite = serverEngine.getSession().getCipherSuite();\n@@ -482,2 +506,2 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n@@ -485,2 +509,2 @@\n-            appOut1.capacity(), -1);\n-        oneToTwo.flip();\n+            clientOut.capacity(), -1);\n+        clientToServer.flip();\n@@ -488,2 +512,2 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n@@ -491,2 +515,2 @@\n-            appOut2.capacity(), -1);\n-        twoToOne.flip();\n+            serverOut.capacity(), -1);\n+        serverToClient.flip();\n@@ -494,2 +518,2 @@\n-        result3 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result3,\n+        result3 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result3,\n@@ -498,1 +522,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -500,2 +524,2 @@\n-        result4 = ssle2.unwrap(oneToTwo, appIn2);\n-        checkResult(oneToTwo, appIn2, result4,\n+        result4 = serverEngine.unwrap(clientToServer, serverIn);\n+        checkResult(clientToServer, serverIn, result4,\n@@ -504,1 +528,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -506,4 +530,4 @@\n-        appIn1.clear();\n-        appIn2.clear();\n-        appOut1.rewind();\n-        appOut2.rewind();\n+        clientIn.clear();\n+        serverIn.clear();\n+        clientOut.rewind();\n+        serverOut.rewind();\n@@ -512,1 +536,1 @@\n-        log(\"CN\");\n+        log(\"Server -> Client [CloseNotify]\");\n@@ -514,2 +538,2 @@\n-        if (isHandshaking(ssle1)) {\n-            throw new Exception(\"ssle1 IS handshaking\");\n+        if (isHandshaking(clientEngine)) {\n+            throw new Exception(\"clientEngine IS handshaking\");\n@@ -518,2 +542,2 @@\n-        if (isHandshaking(ssle2)) {\n-            throw new Exception(\"ssle2 IS handshaking\");\n+        if (isHandshaking(serverEngine)) {\n+            throw new Exception(\"serverEngine IS handshaking\");\n@@ -522,1 +546,1 @@\n-        ssle2.closeOutbound();\n+        serverEngine.closeOutbound();\n@@ -524,2 +548,2 @@\n-        if (!isHandshaking(ssle2)) {\n-            throw new Exception(\"ssle1 IS NOT handshaking\");\n+        if (!isHandshaking(serverEngine)) {\n+            throw new Exception(\"serverEngine IS NOT handshaking\");\n@@ -528,2 +552,2 @@\n-        appOut1.rewind();\n-        appOut2.rewind();\n+        clientOut.rewind();\n+        serverOut.rewind();\n@@ -531,4 +555,4 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n-            Status.CLOSED, HandshakeStatus.NEED_UNWRAP, 0, -1);\n-        twoToOne.flip();\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+            Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, -1);\n+        serverToClient.flip();\n@@ -536,2 +560,2 @@\n-        if (ssle1.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone\");\n+        if (clientEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone\");\n@@ -540,2 +564,2 @@\n-        result1 = ssle1.unwrap(twoToOne, appIn1);\n-        checkResult(twoToOne, appIn1, result1,\n+        result1 = clientEngine.unwrap(serverToClient, clientIn);\n+        checkResult(serverToClient, clientIn, result1,\n@@ -544,1 +568,1 @@\n-        twoToOne.compact();\n+        serverToClient.compact();\n@@ -546,2 +570,2 @@\n-        if (!ssle1.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone\");\n+        if (!clientEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone\");\n@@ -550,2 +574,2 @@\n-        if (!isHandshaking(ssle1)) {\n-            throw new Exception(\"ssle1 IS NOT handshaking\");\n+        if (!isHandshaking(clientEngine)) {\n+            throw new Exception(\"clientEngine IS NOT handshaking\");\n@@ -554,4 +578,4 @@\n-        result2 = ssle2.wrap(appOut2, twoToOne);\n-        checkResult(appOut2, twoToOne, result2,\n-            Status.CLOSED, HandshakeStatus.NEED_UNWRAP, 0, 0);\n-        twoToOne.flip();\n+        result2 = serverEngine.wrap(serverOut, serverToClient);\n+        checkResult(serverOut, serverToClient, result2,\n+            Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, 0);\n+        serverToClient.flip();\n@@ -560,1 +584,1 @@\n-        log(\"CN response\");\n+        log(\"CloseNotify response\");\n@@ -562,2 +586,2 @@\n-        if (ssle1.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone\");\n+        if (clientEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone\");\n@@ -566,3 +590,3 @@\n-        result1 = ssle1.wrap(appOut1, oneToTwo);\n-        checkResult(appOut1, oneToTwo, result1,\n-             Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, -1);\n+        result1 = clientEngine.wrap(clientOut, clientToServer);\n+        checkResult(clientOut, clientToServer, result1,\n+                        Status.CLOSED, HandshakeStatus.NOT_HANDSHAKING, 0, -1);\n@@ -570,2 +594,2 @@\n-        if (!ssle1.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone is NOT done\");\n+        if (!clientEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone is NOT done\");\n@@ -574,2 +598,2 @@\n-        if (isHandshaking(ssle1)) {\n-            throw new Exception(\"ssle1 IS handshaking\");\n+        if (isHandshaking(clientEngine)) {\n+            throw new Exception(\"clientEngine IS handshaking\");\n@@ -578,1 +602,1 @@\n-        oneToTwo.flip();\n+        clientToServer.flip();\n@@ -580,2 +604,2 @@\n-        if (!ssle2.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone\");\n+        if (!serverEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone\");\n@@ -584,2 +608,2 @@\n-        if (ssle2.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone\");\n+        if (serverEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone\");\n@@ -588,1 +612,1 @@\n-        result2 = ssle2.unwrap(oneToTwo, appIn2);\n+        result2 = serverEngine.unwrap(clientToServer, serverIn);\n@@ -590,1 +614,1 @@\n-        checkResult(oneToTwo, appIn2, result2,\n+        checkResult(clientToServer, serverIn, result2,\n@@ -594,2 +618,2 @@\n-        if (!ssle2.isOutboundDone()) {\n-            throw new Exception(\"ssle1 outboundDone is NOT done\");\n+        if (!serverEngine.isOutboundDone()) {\n+            throw new Exception(\"clientEngine outboundDone is NOT done\");\n@@ -598,2 +622,2 @@\n-        if (!ssle2.isInboundDone()) {\n-            throw new Exception(\"ssle1 inboundDone is NOT done\");\n+        if (!serverEngine.isInboundDone()) {\n+            throw new Exception(\"clientEngine inboundDone is NOT done\");\n@@ -602,2 +626,2 @@\n-        if (isHandshaking(ssle2)) {\n-            throw new Exception(\"ssle1 IS handshaking\");\n+        if (isHandshaking(serverEngine)) {\n+            throw new Exception(\"clientEngine IS handshaking\");\n@@ -606,1 +630,1 @@\n-        oneToTwo.compact();\n+        clientToServer.compact();\n@@ -610,10 +634,1 @@\n-        \/\/ reset the security property to make sure that the algorithms\n-        \/\/ and keys used in this test are not disabled.\n-        Security.setProperty(\"jdk.tls.disabledAlgorithms\", \"\");\n-\n-        CheckStatus cs;\n-\n-        cs = new CheckStatus();\n-\n-        cs.createSSLEngines();\n-\n+        CheckStatus cs = new CheckStatus();\n@@ -621,1 +636,0 @@\n-\n@@ -632,1 +646,1 @@\n-        sslc = getSSLContext(keyFilename, trustFilename);\n+        SSL_CONTEXT = getSSLContext(keyFilename, trustFilename);\n@@ -655,1 +669,1 @@\n-        SSLContext sslCtx = SSLContext.getInstance(\"TLS\");\n+        SSLContext sslCtx = SSLContext.getInstance(\"TLSv1.2\");\n@@ -665,1 +679,1 @@\n-        SSLSession session = ssle1.getSession();\n+        SSLSession session = clientEngine.getSession();\n@@ -669,2 +683,2 @@\n-        appIn1 = ByteBuffer.allocateDirect(appBufferMax + 50);\n-        appIn2 = ByteBuffer.allocateDirect(appBufferMax + 50);\n+        clientIn = ByteBuffer.allocateDirect(appBufferMax + 50);\n+        serverIn = ByteBuffer.allocateDirect(appBufferMax + 50);\n@@ -672,2 +686,2 @@\n-        oneToTwo = ByteBuffer.allocateDirect(netBufferMax);\n-        twoToOne = ByteBuffer.allocateDirect(netBufferMax);\n+        clientToServer = ByteBuffer.allocateDirect(netBufferMax);\n+        serverToClient = ByteBuffer.allocateDirect(netBufferMax);\n@@ -675,2 +689,2 @@\n-        appOut1 = ByteBuffer.wrap(\"Hi Engine2, I'm SSLEngine1\".getBytes());\n-        appOut2 = ByteBuffer.wrap(\"Hello Engine1, I'm SSLEngine2\".getBytes());\n+        clientOut = ByteBuffer.wrap(\"Hi Server, I'm Client\".getBytes());\n+        serverOut = ByteBuffer.wrap(\"Hello Client, I'm Server\".getBytes());\n@@ -678,2 +692,2 @@\n-        log(\"AppOut1 = \" + appOut1);\n-        log(\"AppOut2 = \" + appOut2);\n+        log(\"Client out = \" + clientOut);\n+        log(\"Server out = \" + serverOut);\n@@ -683,1 +697,1 @@\n-    private static void runDelegatedTasks(SSLEngine engine) throws Exception {\n+    private static void runDelegatedTasks(SSLEngine engine) {\n@@ -687,1 +701,1 @@\n-            log(\"running delegated task...\");\n+            log(\"Running delegated task...\");\n@@ -692,17 +706,0 @@\n-    private static void checkTransfer(ByteBuffer a, ByteBuffer b)\n-            throws Exception {\n-        a.flip();\n-        b.flip();\n-\n-        if (!a.equals(b)) {\n-            throw new Exception(\"Data didn't transfer cleanly\");\n-        } else {\n-            log(\"Data transferred cleanly\");\n-        }\n-\n-        a.position(a.limit());\n-        b.position(b.limit());\n-        a.limit(a.capacity());\n-        b.limit(b.capacity());\n-    }\n-\n@@ -710,3 +707,1 @@\n-        if (debug) {\n-            System.out.println(str);\n-        }\n+        System.out.println(str);\n","filename":"test\/jdk\/javax\/net\/ssl\/SSLEngine\/CheckStatus.java","additions":307,"deletions":312,"binary":false,"changes":619,"status":"modified"}]}