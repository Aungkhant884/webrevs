{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -29,0 +29,1 @@\n+import sun.security.action.GetPropertyAction;\n@@ -38,0 +39,11 @@\n+    private static final String PROPERTY_ENABLE_FILE_NAME_ENCODING =\n+        \"jdk.nio.path.useNormalizationFormD\";\n+\n+    private static final boolean ENCODE_FILE_NAMES;\n+\n+    static {\n+        final String name = PROPERTY_ENABLE_FILE_NAME_ENCODING;\n+        String value = GetPropertyAction.privilegedGetProperty(name);\n+        ENCODE_FILE_NAMES = \"true\".equalsIgnoreCase(value);\n+    }\n+\n@@ -49,4 +61,5 @@\n-        for (int i = 0; i < path.length(); i++) {\n-            char c = path.charAt(i);\n-            if (c > 0x80)\n-                return new String(normalizepath(path.toCharArray(),\n+        if (ENCODE_FILE_NAMES) {\n+            for (int i = 0; i < path.length(); i++) {\n+                char c = path.charAt(i);\n+                if (c > 0x80)\n+                    return new String(normalizepath(path.toCharArray(),\n@@ -54,0 +67,1 @@\n+            }\n@@ -60,4 +74,6 @@\n-        for (int i = 0; i < path.length(); i++) {\n-            if (path.charAt(i) > 0x80)\n-                return new String(normalizepath(path.toCharArray(),\n-                                  kCFStringNormalizationFormC));\n+        if (ENCODE_FILE_NAMES) {\n+            for (int i = 0; i < path.length(); i++) {\n+                if (path.charAt(i) > 0x80)\n+                    return new String(normalizepath(path.toCharArray(),\n+                                      kCFStringNormalizationFormC));\n+            }\n","filename":"src\/java.base\/macosx\/classes\/sun\/nio\/fs\/MacOSXFileSystem.java","additions":25,"deletions":9,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+import java.text.Normalizer.Form;\n@@ -34,0 +35,2 @@\n+    private static final String FILE_NAME_ENCODING_PROPERTY =\n+        \"jdk.nio.path.useNormalizationFormD\";\n@@ -84,2 +87,4 @@\n-        String dname_nfd = Normalizer.normalize(dname, Normalizer.Form.NFD);\n-        String fname_nfd = Normalizer.normalize(fname_nfc, Normalizer.Form.NFD);\n+        Normalizer.Form form = Boolean.getBoolean(FILE_NAME_ENCODING_PROPERTY) ?\n+            Normalizer.Form.NFD : Normalizer.Form.NFC;\n+        String dname_nfd = Normalizer.normalize(dname, form);\n+        String fname_nfd = Normalizer.normalize(fname_nfc, form);\n","filename":"test\/jdk\/java\/nio\/file\/Path\/MacPath.java","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,1 +25,1 @@\n- * @bug 7130915\n+ * @bug 7130915 8289689\n@@ -37,0 +37,1 @@\n+ * @run main\/othervm -Djdk.nio.path.useNormalizationFormD=true MacPathTest\n@@ -42,0 +43,4 @@\n+    private static final String FILE_NAME_ENCODING_PROPERTY =\n+        \"jdk.nio.path.useNormalizationFormD\";\n+    private static final boolean ENABLE_FILE_NAME_ENCODING =\n+        Boolean.getBoolean(FILE_NAME_ENCODING_PROPERTY);\n@@ -44,1 +49,8 @@\n-        ProcessBuilder pb = ProcessTools.createTestJvm(MacPath.class.getName());\n+        ProcessBuilder pb;\n+        if (ENABLE_FILE_NAME_ENCODING) {\n+            String option = ENABLE_FILE_NAME_ENCODING ?\n+                \"-D\" + FILE_NAME_ENCODING_PROPERTY + \"=true\" : \"\";\n+            pb = ProcessTools.createTestJvm(option, MacPath.class.getName());\n+        } else {\n+            pb = ProcessTools.createTestJvm(MacPath.class.getName());\n+        }\n","filename":"test\/jdk\/java\/nio\/file\/Path\/MacPathTest.java","additions":15,"deletions":3,"binary":false,"changes":18,"status":"modified"}]}