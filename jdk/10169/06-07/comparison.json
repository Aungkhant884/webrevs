{"files":[{"patch":"@@ -502,2 +502,3 @@\n-        \/\/ For 100 (with the request configured to expect-continue) and 101, we handle it\n-        \/\/ specifically as defined in the RFC-9110, outside of this method.\n+        \/\/ For 100 (with the request configured to expect-continue) and 101 (for which the request\n+        \/\/ has already sent an \"Upgrade\" request header), we handle it specifically as defined in\n+        \/\/ the RFC-9110, outside of this method.\n@@ -506,1 +507,5 @@\n-        \/\/ response (just like any other 1xx response)\n+        \/\/ response (just like any other 1xx response).\n+        \/\/ Similarly, if we receive a 101 response, but the request didn't ask for the Upgrade,\n+        \/\/ then we ignore that 101 response and wait for a final response. The client is allowed to\n+        \/\/ do this as per RFC-9110, section 15.2 which says \"A user agent MAY ignore unexpected\n+        \/\/ 1xx responses\".\n@@ -512,1 +517,2 @@\n-                || (statusCode == 100 && !request.expectContinue)) {\n+                || (statusCode == 100 && !request.expectContinue)\n+                || (statusCode == 101 && !upgrading)) {\n","filename":"src\/java.net.http\/share\/classes\/jdk\/internal\/net\/http\/Exchange.java","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -39,1 +39,0 @@\n-\n@@ -118,0 +117,1 @@\n+        private static final String REQ_LINE_BYE = \"GET \/test\/bye HTTP\/1.1\\r\\n\";\n@@ -160,0 +160,3 @@\n+                    }  else if (requestLine.startsWith(REQ_LINE_BYE)) {\n+                        \/\/ we will send intermediate\/informational 101 response\n+                        informationalResponseCode = 101;\n@@ -171,2 +174,9 @@\n-                            os.write((\"HTTP\/1.1 \" + informationalResponseCode + \"\\r\\n\\r\\n\")\n-                                    .getBytes(StandardCharsets.UTF_8));\n+                            if (informationalResponseCode == 101) {\n+                                os.write((\"HTTP\/1.1 \" + informationalResponseCode + \"\\r\\n\" +\n+                                        \"Connection: upgrade\\r\\n\" +\n+                                        \"Upgrade: websocket\\r\\n\\r\\n\")\n+                                        .getBytes(StandardCharsets.UTF_8));\n+                            } else {\n+                                os.write((\"HTTP\/1.1 \" + informationalResponseCode + \"\\r\\n\\r\\n\")\n+                                        .getBytes(StandardCharsets.UTF_8));\n+                            }\n@@ -288,1 +298,2 @@\n-                new URI(http1RequestURIBase + \"\/test\/hello\")};\n+                new URI(http1RequestURIBase + \"\/test\/hello\"),\n+                new URI(http1RequestURIBase + \"\/test\/bye\")};\n","filename":"test\/jdk\/java\/net\/httpclient\/Response1xxTest.java","additions":15,"deletions":4,"binary":false,"changes":19,"status":"modified"}]}