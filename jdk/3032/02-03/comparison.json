{"files":[{"patch":"@@ -34,2 +34,2 @@\n-    private final Headers headers;  \/\/ mutable, but no reference to it escapes\n-    private final Map<String, List<String>> map;\n+    private final Headers headers;  \/\/ modifiable, but no reference to it escapes\n+    private final Map<String, List<String>> map;  \/\/ unmodifiable\n@@ -39,3 +39,6 @@\n-        Map<String, List<String>> unmodListMap = new HashMap<>();\n-        h.forEach((k, v) -> unmodListMap.put(k, Collections.unmodifiableList(v)));\n-        this.map = Collections.unmodifiableMap(unmodListMap);\n+        var unmodHeaders = new Headers();\n+        h.forEach((k, v) -> {\n+                List<String> l = v == null ? List.of() : Collections.unmodifiableList(v);\n+                unmodHeaders.put(k, l);\n+        });\n+        this.map = Collections.unmodifiableMap(unmodHeaders);\n@@ -45,1 +48,1 @@\n-    public int size() {return map.size();}\n+    public int size() {return headers.size();}\n@@ -47,1 +50,1 @@\n-    public boolean isEmpty() {return map.isEmpty();}\n+    public boolean isEmpty() {return headers.isEmpty();}\n@@ -49,1 +52,1 @@\n-    public boolean containsKey(Object key) { return map.containsKey (key); }\n+    public boolean containsKey(Object key) { return headers.containsKey(key); }\n@@ -51,1 +54,1 @@\n-    public boolean containsValue(Object value) { return map.containsValue(value); }\n+    public boolean containsValue(Object value) { return headers.containsValue(value); }\n@@ -101,1 +104,1 @@\n-    public boolean equals(Object o) {return map.equals(o);}\n+    public boolean equals(Object o) {return headers.equals(o);}\n@@ -103,1 +106,1 @@\n-    public int hashCode() {return map.hashCode();}\n+    public int hashCode() {return headers.hashCode();}\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/UnmodifiableHeaders.java","additions":14,"deletions":11,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -91,0 +91,1 @@\n+        assertThrows(UOP, () -> headers.get(\"foo\").remove(0));\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/UnmodifiableHeadersTest.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}