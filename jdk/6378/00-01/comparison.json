{"files":[{"patch":"@@ -820,0 +820,2 @@\n+    binutils_system_error=\"\"\n+    HSDIS_LIBS=\"\"\n@@ -821,10 +823,4 @@\n-      if test \"x$OPENJDK_TARGET_OS\" != xlinux; then\n-        AC_MSG_CHECKING([for binutils to use with hsdis])\n-        AC_MSG_RESULT([invalid])\n-        AC_MSG_ERROR([binutils on system is supported for Linux only])\n-      fi\n-      AC_CHECK_LIB(bfd, bfd_openr, [ HSDIS_LIBS=\"$HSDIS_LIBS -lbfd\" ], [ AC_MSG_ERROR([libbfd not found]) ])\n-      AC_CHECK_LIB(opcodes, disassembler, [ HSDIS_LIBS=\"$HSDIS_LIBS -lopcodes\" ], [ AC_MSG_ERROR([libopcodes not found]) ])\n-      AC_CHECK_LIB(iberty, xmalloc, [ HSDIS_LIBS=\"$HSDIS_LIBS -liberty\" ], [ AC_MSG_ERROR([libiberty not found]) ])\n-      AC_CHECK_LIB(z, deflate, [ HSDIS_LIBS=\"$HSDIS_LIBS -lz\" ], [ AC_MSG_ERROR([libz not found]) ])\n-      HSDIS_CFLAGS=\"-DSYSTEM_BINUTILS\"\n+      AC_CHECK_LIB(bfd, bfd_openr, [ HSDIS_LIBS=\"-lbfd\" ], [ binutils_system_error=\"libbfd not found\" ])\n+      AC_CHECK_LIB(opcodes, disassembler, [ HSDIS_LIBS=\"$HSDIS_LIBS -lopcodes\" ], [ binutils_system_error=\"libopcodes not found\" ])\n+      AC_CHECK_LIB(iberty, xmalloc, [ HSDIS_LIBS=\"$HSDIS_LIBS -liberty\" ], [ binutils_system_error=\"libiberty not found\" ])\n+      AC_CHECK_LIB(z, deflate, [ HSDIS_LIBS=\"$HSDIS_LIBS -lz\" ], [ binutils_system_error=\"libz not found\" ])\n@@ -832,1 +828,0 @@\n-      AC_MSG_CHECKING([for binutils to use with hsdis])\n@@ -836,1 +831,0 @@\n-        AC_MSG_RESULT([$BINUTILS_DIR])\n@@ -839,3 +833,0 @@\n-      else\n-        AC_MSG_RESULT([invalid])\n-        AC_MSG_ERROR([$BINUTILS_DIR does not contain a proper binutils installation])\n@@ -843,8 +834,0 @@\n-    else\n-      AC_MSG_CHECKING([for binutils to use with hsdis])\n-      AC_MSG_RESULT([missing])\n-      AC_MSG_NOTICE([--with-hsdis=binutils requires specifying a binutils installation.])\n-      AC_MSG_NOTICE([Download binutils from https:\/\/www.gnu.org\/software\/binutils and unpack it,])\n-      AC_MSG_NOTICE([and point --with-binutils-src to the resulting directory, or use])\n-      AC_MSG_NOTICE([--with-binutils to point to a pre-built binutils installation.])\n-      AC_MSG_ERROR([Cannot continue])\n@@ -852,0 +835,32 @@\n+\n+    AC_MSG_CHECKING([for binutils to use with hsdis])\n+    case \"x$BINUTILS_DIR\" in\n+      xsystem)\n+        if test \"x$OPENJDK_TARGET_OS\" != xlinux; then\n+          AC_MSG_RESULT([invalid])\n+          AC_MSG_ERROR([binutils on system is supported for Linux only])\n+        elif test \"x$binutils_system_error\" = x; then\n+          AC_MSG_RESULT([system])\n+          HSDIS_CFLAGS=\"-DSYSTEM_BINUTILS\"\n+        else\n+          AC_MSG_RESULT([invalid])\n+          AC_MSG_ERROR([$binutils_system_error])\n+        fi\n+        ;;\n+      x)\n+        AC_MSG_RESULT([missing])\n+        AC_MSG_NOTICE([--with-hsdis=binutils requires specifying a binutils installation.])\n+        AC_MSG_NOTICE([Download binutils from https:\/\/www.gnu.org\/software\/binutils and unpack it,])\n+        AC_MSG_NOTICE([and point --with-binutils-src to the resulting directory, or use])\n+        AC_MSG_NOTICE([--with-binutils to point to a pre-built binutils installation.])\n+        AC_MSG_ERROR([Cannot continue])\n+        ;;\n+      *)\n+        if test \"x$HSDIS_LIBS\" != x; then\n+          AC_MSG_RESULT([$BINUTILS_DIR])\n+        else\n+          AC_MSG_RESULT([invalid])\n+          AC_MSG_ERROR([$BINUTILS_DIR does not contain a proper binutils installation])\n+        fi\n+        ;;\n+    esac\n","filename":"make\/autoconf\/jdk-options.m4","additions":38,"deletions":23,"binary":false,"changes":61,"status":"modified"}]}