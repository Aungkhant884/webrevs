{"files":[{"patch":"@@ -820,2 +820,8 @@\n-    AC_MSG_CHECKING([for binutils to use with hsdis])\n-    if test \"x$BINUTILS_DIR\" != x; then\n+    binutils_system_error=\"\"\n+    HSDIS_LIBS=\"\"\n+    if test \"x$BINUTILS_DIR\" = xsystem; then\n+      AC_CHECK_LIB(bfd, bfd_openr, [ HSDIS_LIBS=\"-lbfd\" ], [ binutils_system_error=\"libbfd not found\" ])\n+      AC_CHECK_LIB(opcodes, disassembler, [ HSDIS_LIBS=\"$HSDIS_LIBS -lopcodes\" ], [ binutils_system_error=\"libopcodes not found\" ])\n+      AC_CHECK_LIB(iberty, xmalloc, [ HSDIS_LIBS=\"$HSDIS_LIBS -liberty\" ], [ binutils_system_error=\"libiberty not found\" ])\n+      AC_CHECK_LIB(z, deflate, [ HSDIS_LIBS=\"$HSDIS_LIBS -lz\" ], [ binutils_system_error=\"libz not found\" ])\n+    elif test \"x$BINUTILS_DIR\" != x; then\n@@ -825,1 +831,0 @@\n-        AC_MSG_RESULT([$BINUTILS_DIR])\n@@ -828,3 +833,0 @@\n-      else\n-        AC_MSG_RESULT([invalid])\n-        AC_MSG_ERROR([$BINUTILS_DIR does not contain a proper binutils installation])\n@@ -832,7 +834,0 @@\n-    else\n-      AC_MSG_RESULT([missing])\n-      AC_MSG_NOTICE([--with-hsdis=binutils requires specifying a binutils installation.])\n-      AC_MSG_NOTICE([Download binutils from https:\/\/www.gnu.org\/software\/binutils and unpack it,])\n-      AC_MSG_NOTICE([and point --with-binutils-src to the resulting directory, or use])\n-      AC_MSG_NOTICE([--with-binutils to point to a pre-built binutils installation.])\n-      AC_MSG_ERROR([Cannot continue])\n@@ -840,0 +835,32 @@\n+\n+    AC_MSG_CHECKING([for binutils to use with hsdis])\n+    case \"x$BINUTILS_DIR\" in\n+      xsystem)\n+        if test \"x$OPENJDK_TARGET_OS\" != xlinux; then\n+          AC_MSG_RESULT([invalid])\n+          AC_MSG_ERROR([binutils on system is supported for Linux only])\n+        elif test \"x$binutils_system_error\" = x; then\n+          AC_MSG_RESULT([system])\n+          HSDIS_CFLAGS=\"-DSYSTEM_BINUTILS\"\n+        else\n+          AC_MSG_RESULT([invalid])\n+          AC_MSG_ERROR([$binutils_system_error])\n+        fi\n+        ;;\n+      x)\n+        AC_MSG_RESULT([missing])\n+        AC_MSG_NOTICE([--with-hsdis=binutils requires specifying a binutils installation.])\n+        AC_MSG_NOTICE([Download binutils from https:\/\/www.gnu.org\/software\/binutils and unpack it,])\n+        AC_MSG_NOTICE([and point --with-binutils-src to the resulting directory, or use])\n+        AC_MSG_NOTICE([--with-binutils to point to a pre-built binutils installation.])\n+        AC_MSG_ERROR([Cannot continue])\n+        ;;\n+      *)\n+        if test \"x$HSDIS_LIBS\" != x; then\n+          AC_MSG_RESULT([$BINUTILS_DIR])\n+        else\n+          AC_MSG_RESULT([invalid])\n+          AC_MSG_ERROR([$BINUTILS_DIR does not contain a proper binutils installation])\n+        fi\n+        ;;\n+    esac\n","filename":"make\/autoconf\/jdk-options.m4","additions":40,"deletions":13,"binary":false,"changes":53,"status":"modified"},{"patch":"@@ -70,0 +70,4 @@\n+If you want to build hsdis with binutils provided by system\n+(e.g. binutils-devel from Fedora, binutils-dev from Ubuntu), you can pass\n+\"--with-binutils=system\". \"system\" is available on Linux only.\n+\n","filename":"src\/utils\/hsdis\/README","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -52,0 +52,1 @@\n+#ifndef SYSTEM_BINUTILS\n@@ -53,0 +54,2 @@\n+#endif\n+\n@@ -59,1 +62,0 @@\n-#include <bfdver.h>\n@@ -568,1 +570,1 @@\n-#if BFD_VERSION >= 234000000\n+#ifdef SEC_ELF_OCTETS\n","filename":"src\/utils\/hsdis\/hsdis.c","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"}]}