{"files":[{"patch":"@@ -28,0 +28,1 @@\n+import java.awt.Graphics2D;\n@@ -32,0 +33,1 @@\n+import java.awt.geom.AffineTransform;\n@@ -148,13 +150,6 @@\n-        int w = width;\n-        int h = height;\n-\n-        g.translate(x, y);\n-\n-        \/\/ 8279614: The dark line was being overdrawn by the light line. The fix was to\n-        \/\/ make sure that the dark line is always drawn second.\n-        if (etchType == LOWERED) {\n-            paintBorderShadow(g, getHighlightColor(c), w, h);\n-            paintBorderRect(g, getShadowColor(c), w, h);\n-        } else {\n-            paintBorderRect(g, getHighlightColor(c), w, h);\n-            paintBorderShadow(g, getShadowColor(c), w, h);\n+        \/\/ We remove any initial transforms to prevent rounding errors\n+        \/\/ when drawing in non-integer scales\n+        AffineTransform at = new AffineTransform();\n+        if (g instanceof Graphics2D) {\n+            at = ((Graphics2D) g).getTransform();\n+            ((Graphics2D) g).setTransform(new AffineTransform());\n@@ -163,0 +158,2 @@\n+        int w = (int) (at.getScaleX()*width);\n+        int h = (int) (at.getScaleY()*height);\n@@ -164,1 +161,16 @@\n-        g.translate(-x, -y);\n+        g.translate((int) (at.getScaleX()*x+at.getTranslateX()),\n+                (int) (at.getScaleY()*y+at.getTranslateY()));\n+\n+        \/\/ Drawing the border last prevents the shadow from overdrawing the border\n+        paintBorderShadow(g, (etchType == LOWERED) ? getHighlightColor(c)\n+                                                    : getShadowColor(c), w, h);\n+        paintBorderRect(g, (etchType == LOWERED) ? getShadowColor(c)\n+                                                    : getHighlightColor(c), w, h);\n+\n+\n+        g.translate(-((int) (at.getScaleX()*x+at.getTranslateX())),\n+                -((int) (at.getScaleY()*y+at.getTranslateY())));\n+        \/\/ Set the transform we removed earlier\n+        if (g instanceof Graphics2D) {\n+            ((Graphics2D) g).setTransform(at);\n+        }\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/border\/EtchedBorder.java","additions":26,"deletions":14,"binary":false,"changes":40,"status":"modified"}]}