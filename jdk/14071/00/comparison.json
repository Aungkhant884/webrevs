{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -153,0 +153,11 @@\n+    \/**\n+     * Creates a {@code <a href><\/a>} link with {@code targetAddress} being the value for {@code href}\n+     * and the {@code linkText} being the text for the link.\n+     *\n+     * @param targetAddress the target address\n+     * @param linkText      the text for the link\n+     *\/\n+    public void createLink(String targetAddress, String linkText) {\n+        pw.printf(\"<a href=\\\"%1$s\\\">%2$s<\/a>%n\", targetAddress, linkText);\n+    }\n+\n","filename":"test\/failure_handler\/src\/share\/classes\/jdk\/test\/failurehandler\/HtmlSection.java","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -50,0 +50,1 @@\n+import java.util.StringTokenizer;\n@@ -79,1 +80,2 @@\n-        PrintWriter log = getChildren.getSection(section).getWriter();\n+        HtmlSection childrenSection = getChildren.getSection(section);\n+        PrintWriter log = childrenSection.getWriter();\n@@ -81,1 +83,1 @@\n-        ExitCode code = run(log, writer, pb, getChildren.getParameters());\n+        ExitCode code = run(childrenSection, log, writer, pb, getChildren.getParameters());\n@@ -157,2 +159,2 @@\n-    private ExitCode run(PrintWriter log, Writer out, ProcessBuilder pb,\n-                    ActionParameters params) {\n+    private ExitCode run(HtmlSection section, PrintWriter log, Writer out, ProcessBuilder pb,\n+                         ActionParameters params) {\n@@ -202,0 +204,13 @@\n+        \/\/ upon successful completion of the action, generate links to any successArtifacts\n+        \/\/ that have been declared for this action\n+        if (ExitCode.OK.equals(result) && params.successArtifacts != null) {\n+            final StringTokenizer t = new StringTokenizer(params.successArtifacts, \",\");\n+            while (t.hasMoreTokens()) {\n+                final String artifactPath = t.nextToken().trim();\n+                if (artifactPath.isEmpty()) {\n+                    continue;\n+                }\n+                \/\/ create a link to the artifact\n+                section.createLink(artifactPath, artifactPath);\n+            }\n+        }\n@@ -289,0 +304,5 @@\n+            \/\/ hold on to the original command and successArtifacts values which potentially\n+            \/\/ contain the %iterCount token, since we need to replace it with different value\n+            \/\/ on each iteration\n+            String originalSuccessArtifacts = params.successArtifacts;\n+            List<String> originalCommand = process.command();\n@@ -293,1 +313,6 @@\n-                ExitCode exitCode = run(writer, writer, process, params);\n+                \/\/ use the original values with the token (if any)\n+                params.successArtifacts = originalSuccessArtifacts;\n+                process.command(originalCommand);\n+                \/\/ replace the %iterCount token (if any)\n+                prepareIteration(i, process, params);\n+                ExitCode exitCode = run(section, writer, writer, process, params);\n@@ -312,1 +337,20 @@\n-            run(section.getWriter(), section.getWriter(), process, params);\n+            prepareIteration(0, process, params);\n+            run(section, section.getWriter(), section.getWriter(), process, params);\n+        }\n+    }\n+\n+    \/\/ replaces the occurrences of %iterCount from the process builder command\/arguments\n+    \/\/ and the action params' \"successArtifacts\" paths, with the iteration count\n+    private void prepareIteration(int iterationCount, ProcessBuilder pb,\n+                                  ActionParameters actionParams) {\n+        List<String> command = new ArrayList<>();\n+        for (String arg : pb.command()) {\n+            arg = arg.replaceAll(\"%iterCount\", String.valueOf(iterationCount)) ;\n+            command.add(arg);\n+        }\n+        pb.command(command);\n+\n+        String successArtifacts = actionParams.successArtifacts;\n+        if (successArtifacts != null) {\n+            actionParams.successArtifacts = successArtifacts.replaceAll(\"%iterCount\",\n+                    String.valueOf(iterationCount));\n","filename":"test\/failure_handler\/src\/share\/classes\/jdk\/test\/failurehandler\/action\/ActionHelper.java","additions":51,"deletions":7,"binary":false,"changes":58,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,0 +46,4 @@\n+    @Value (name = \"successArtifacts\")\n+    @DefaultValue (value = \"\")\n+    public String successArtifacts = \"\";\n+\n","filename":"test\/failure_handler\/src\/share\/classes\/jdk\/test\/failurehandler\/action\/ActionParameters.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -65,0 +65,5 @@\n+        \/\/ replace occurrences of the pattern in the \"successArtifacts\" param\n+        String successArtifacts = action.getParameters().successArtifacts;\n+        if (successArtifacts != null) {\n+            action.getParameters().successArtifacts = successArtifacts.replaceAll(pattern, value);\n+        }\n","filename":"test\/failure_handler\/src\/share\/classes\/jdk\/test\/failurehandler\/action\/PatternAction.java","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -60,1 +60,3 @@\n-jcmd.thread.dump_to_file.args=%p Thread.dump_to_file JavaThread.dump.%p\n+jcmd.thread.dump_to_file.args=%p Thread.dump_to_file -format=json JavaThread.dump.%p.%iterCount\n+jcmd.thread.dump_to_file.params.repeat=6\n+jcmd.thread.dump_to_file.params.successArtifacts=JavaThread.dump.%p.%iterCount\n","filename":"test\/failure_handler\/src\/share\/conf\/common.properties","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"}]}