[{"commit":{"message":"Simplify branch protection configure check"},"files":[{"filename":"make\/autoconf\/flags-cflags.m4"}],"sha":"29471d30f2f5b328eaef7c2e2042f65cfbfc698d"},{"commit":{"message":"8264130: PAC-RET protection for Linux\/AArch64\n\nPAC is an optional feature in AArch64 8.3 and is compulsory in v9. One\nof its uses is to protect against ROP based attacks. This is done by\nsigning the Link Register whenever it is stored on the stack, and\nauthenticating the value when it is loaded back from the stack. If an\nattacker were to try to change control flow by editing the stack then\nthe authentication check of the Link Register will fail, causing a\nsegfault when the function returns.\n\nOn a system with PAC enabled, it is expected that all applications will\nbe compiled with ROP protection. Fedora 33 and upwards already provide\nthis. By compiling for ARMv8.0, GCC and LLVM will only use the set of\nPAC instructions that exist in the NOP space - on hardware without PAC,\nthese instructions act as NOPs, allowing backward compatibility for\nnegligible performance cost (2 NOPs per non-leaf function).\n\nHardware is currently limited to the Apple M1 MacBooks. All testing has\nbeen done within a Fedora Docker image. A run of SpecJVM showed no\ndifference to that of noise - which was surprising.\n\nThe most important part of this patch is simply compiling using branch\nprotection provided by GCC\/LLVM. This protects all C++ code from being\nused in ROP attacks, removing all static ROP gadgets from use.\n\nThe remainder of the patch adds ROP protection to runtime generated\ncode, in both stubs and compiled Java code. Attacks here are much harder\nas ROP gadgets must be found dynamically at runtime. If\/when AOT\ncompilation is added to JDK, then all stubs and compiled Java will be\nsusceptible ROP gadgets being found by static analysis and therefore\npotentially as vulnerable as C++ code.\n\nThere are a number of places where the VM changes control flow by\nrewriting the stack or otherwise. I’ve done some analysis as to how\nthese could also be used for attacks (which I didn’t want to post here).\nThese areas can be protected ensuring the pointers to various stubs and\nentry points are stored in memory as signed pointers. These changes are\nsimple to make (they can be reduced to a type change in common code and\na few addition sign\/auth calls in the backend), but there a lot of them\nand the total code change is fairly large. I’m happy to provide a few\nwork in progress patches.\n\nIn order to match the security benefits of the Apple Arm64e ABI across\nthe whole of JDK, then all the changes mentioned above would be\nrequired."},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad"},{"filename":"src\/hotspot\/cpu\/aarch64\/c1_Runtime1_aarch64.cpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/frame_aarch64.cpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.hpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/pauth_aarch64.hpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/sharedRuntime_aarch64.cpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/templateInterpreterGenerator_aarch64.cpp"},{"filename":"src\/hotspot\/os_cpu\/bsd_aarch64\/pauth_bsd_aarch64.inline.hpp"},{"filename":"src\/hotspot\/os_cpu\/linux_aarch64\/pauth_linux_aarch64.inline.hpp"},{"filename":"src\/hotspot\/os_cpu\/linux_aarch64\/threadLS_linux_aarch64.S"},{"filename":"src\/hotspot\/os_cpu\/windows_aarch64\/pauth_windows_aarch64.inline.hpp"},{"filename":"src\/hotspot\/share\/opto\/runtime.cpp"},{"filename":"src\/hotspot\/share\/runtime\/frame.cpp"},{"filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp"}],"sha":"e0e3f666d85f5b0414b200fb9288928a181875fb"},{"commit":{"message":"Add PAC assembly instructions"},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/assembler_aarch64.hpp"},{"filename":"test\/hotspot\/gtest\/aarch64\/aarch64-asmtest.py"},{"filename":"test\/hotspot\/gtest\/aarch64\/asmtest.out.h"}],"sha":"2c7e2730470b6ae1a0b4f402335c68a7560d8ecf"},{"commit":{"message":"Add AArch64 ROP protection runtime flag"},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/globals_aarch64.hpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.cpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/vm_version_aarch64.hpp"},{"filename":"src\/hotspot\/os_cpu\/linux_aarch64\/vm_version_linux_aarch64.cpp"},{"filename":"src\/jdk.internal.vm.ci\/share\/classes\/jdk.vm.ci.aarch64\/src\/jdk\/vm\/ci\/aarch64\/AArch64.java"}],"sha":"66b05a68586064592fab7889fd2e9db795e96798"},{"commit":{"message":"Build with branch protection"},"files":[{"filename":"make\/autoconf\/flags-cflags.m4"},{"filename":"make\/autoconf\/spec.gmk.in"}],"sha":"9b05854c74ee0f6d1ad3fbf743f543bb67eed5f5"}]