{"files":[{"patch":"@@ -54,3 +54,0 @@\n-  \/\/ Disable Loom\n-  SHENANDOAH_ERGO_DISABLE_FLAG(VMContinuations);\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/mode\/shenandoahIUMode.cpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2313,0 +2313,2 @@\n+  if (ShenandoahIUBarrier) return true;\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -121,0 +121,28 @@\n+template <stackChunkOopDesc::BarrierType barrier>\n+class HeaderBarrierClosure: public OopClosure {\n+public:\n+  virtual void do_oop(oop* p)       override { do_oop_work(p); }\n+  virtual void do_oop(narrowOop* p) override { do_oop_work(p); }\n+\n+  template <class T> inline void do_oop_work(T* p) {\n+    oop value = (oop)HeapAccess<>::oop_load(p);\n+    if (barrier == stackChunkOopDesc::BarrierType::Store) {\n+      HeapAccess<>::oop_store(p, value);\n+    }\n+  }\n+};\n+\n+template <typename T, stackChunkOopDesc::BarrierType barrier>\n+void stackChunkOopDesc::do_barriers_for_header() {\n+  T* parent_addr = field_addr<T>(jdk_internal_vm_StackChunk::parent_offset());\n+  T* cont_addr = field_addr<T>(jdk_internal_vm_StackChunk::cont_offset());\n+  HeaderBarrierClosure<barrier> closure;\n+  Devirtualizer::do_oop(&closure, parent_addr);\n+  Devirtualizer::do_oop(&closure, cont_addr);\n+}\n+\n+template void stackChunkOopDesc::do_barriers_for_header<narrowOop, stackChunkOopDesc::BarrierType::Load> ();\n+template void stackChunkOopDesc::do_barriers_for_header<narrowOop, stackChunkOopDesc::BarrierType::Store>();\n+template void stackChunkOopDesc::do_barriers_for_header<oop, stackChunkOopDesc::BarrierType::Load> ();\n+template void stackChunkOopDesc::do_barriers_for_header<oop, stackChunkOopDesc::BarrierType::Store>();\n+\n@@ -123,0 +151,6 @@\n+  if (UseCompressedOops) {\n+    do_barriers_for_header<narrowOop, barrier>();\n+  } else {\n+    do_barriers_for_header<oop, barrier>();\n+  }\n+\n","filename":"src\/hotspot\/share\/oops\/stackChunkOop.cpp","additions":34,"deletions":0,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -193,0 +193,3 @@\n+  template<typename T, BarrierType barrier>\n+  void do_barriers_for_header();\n+\n","filename":"src\/hotspot\/share\/oops\/stackChunkOop.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}