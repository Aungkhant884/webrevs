{"files":[{"patch":"@@ -0,0 +1,32 @@\n+\/*\n+ * Copyright Amazon.com Inc. or its affiliates. All Rights Reserved.\n+ * Copyright (c) 2022, Institute of Software, Chinese Academy of Sciences. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\n+ *\/\n+\n+#include \"precompiled.hpp\"\n+#include \"asm\/codeBuffer.inline.hpp\"\n+#include \"asm\/macroAssembler.hpp\"\n+\n+bool CodeBuffer::pd_finalize_stubs() {\n+  return emit_shared_stubs_to_interp<MacroAssembler>(this, _shared_stub_to_interp_requests);\n+}\n","filename":"src\/hotspot\/cpu\/riscv\/codeBuffer_riscv.cpp","additions":32,"deletions":0,"binary":false,"changes":32,"status":"added"},{"patch":"@@ -32,6 +32,1 @@\n-  bool pd_finalize_stubs() {\n-    if (_finalize_stubs) {\n-      Unimplemented();\n-    }\n-    return true;\n-  }\n+  bool pd_finalize_stubs();\n@@ -41,1 +36,1 @@\n-  static constexpr bool supports_shared_stubs() { return false; }\n+  static constexpr bool supports_shared_stubs() { return true; }\n","filename":"src\/hotspot\/cpu\/riscv\/codeBuffer_riscv.hpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -2270,5 +2270,11 @@\n-      \/\/ Emit stub for static call\n-      address stub = CompiledStaticCall::emit_to_interp_stub(cbuf);\n-      if (stub == NULL) {\n-        ciEnv::current()->record_failure(\"CodeCache is full\");\n-        return;\n+      if (CodeBuffer::supports_shared_stubs() && _method->can_be_statically_bound()) {\n+        \/\/ Calls of the same statically bound method can share\n+        \/\/ a stub to the interpreter.\n+        cbuf.shared_stub_to_interp_for(_method, cbuf.insts()->mark_off());\n+      } else {\n+        \/\/ Emit stub for static call\n+        address stub = CompiledStaticCall::emit_to_interp_stub(cbuf);\n+        if (stub == NULL) {\n+          ciEnv::current()->record_failure(\"CodeCache is full\");\n+          return;\n+        }\n","filename":"src\/hotspot\/cpu\/riscv\/riscv.ad","additions":11,"deletions":5,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -31,1 +31,1 @@\n- * @requires os.arch==\"amd64\" | os.arch==\"x86_64\" | os.arch==\"i386\" | os.arch==\"x86\" | os.arch==\"aarch64\"\n+ * @requires os.arch==\"amd64\" | os.arch==\"x86_64\" | os.arch==\"i386\" | os.arch==\"x86\" | os.arch==\"aarch64\" | os.arch==\"riscv64\"\n","filename":"test\/hotspot\/jtreg\/compiler\/sharedstubs\/SharedStubToInterpTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}