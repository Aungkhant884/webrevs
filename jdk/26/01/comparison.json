{"files":[{"patch":"@@ -74,1 +74,1 @@\n-            throw new IllegalAccessError(\"Already connected\");\n+            throw new IllegalStateException(\"Already connected\");\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/URLConnection.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2013, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,2 +26,2 @@\n- * @bug 4485208\n- * @summary  file: and ftp: URL handlers need to throw NPE in setRequestProperty\n+ * @bug 4485208 8252767\n+ * @summary  Validate java.net.URLConnection#setRequestProperty throws NPE and IllegalStateException\n@@ -46,1 +46,1 @@\n-            test(new URL(urlStr));\n+            testSetRequestPropNPE(new URL(urlStr));\n@@ -50,0 +50,2 @@\n+\n+        testSetRequestPropIllegalStateException();\n@@ -52,1 +54,1 @@\n-    static void test(URL url) throws Exception {\n+    static void testSetRequestPropNPE(URL url) throws Exception {\n@@ -82,0 +84,25 @@\n+\n+    \/**\n+     * Test that {@link URLConnection#setRequestProperty(String, String)} throws\n+     * an {@link IllegalStateException} when already connected\n+     *\n+     * @throws Exception\n+     *\/\n+    private static void testSetRequestPropIllegalStateException() throws Exception {\n+        final URL url = new URL(\"file:\/\/\" + System.getProperty(\"java.io.tmpdir\"));\n+        final java.net.URLConnection conn = url.openConnection();\n+        conn.connect();\n+        try {\n+            conn.setRequestProperty(\"foo\", \"bar\");\n+            throw new RuntimeException(\"setRequestProperty on \" + conn.getClass().getName() +\n+                    \" for \" + url + \" was expected to throw IllegalStateException, but didn't\");\n+        } catch (IllegalStateException ise) {\n+            \/\/ expected\n+        } finally {\n+            try {\n+                conn.getInputStream().close();\n+            } catch (Exception e) {\n+                \/\/ ignore\n+            }\n+        }\n+    }\n","filename":"test\/jdk\/java\/net\/URLConnection\/RequestProperties.java","additions":32,"deletions":5,"binary":false,"changes":37,"status":"modified"}]}