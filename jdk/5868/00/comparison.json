{"files":[{"patch":"@@ -53,0 +53,2 @@\n+private:\n+  GCCause::Cause _cause;\n@@ -54,2 +56,5 @@\n-  ShenandoahBreakpointGCScope() {\n-    ShenandoahBreakpoint::at_before_gc();\n+  ShenandoahBreakpointGCScope(GCCause::Cause cause) : _cause(cause) {\n+    if (cause == GCCause::_wb_breakpoint) {\n+      ShenandoahBreakpoint::start_gc();\n+      ShenandoahBreakpoint::at_before_gc();\n+    }\n@@ -59,1 +64,3 @@\n-    ShenandoahBreakpoint::at_after_gc();\n+    if (_cause == GCCause::_wb_breakpoint) {\n+      ShenandoahBreakpoint::at_after_gc();\n+    }\n@@ -64,0 +71,2 @@\n+private:\n+  GCCause::Cause _cause;\n@@ -65,2 +74,4 @@\n-  ShenandoahBreakpointMarkScope() {\n-    ShenandoahBreakpoint::at_after_marking_started();\n+  ShenandoahBreakpointMarkScope(GCCause::Cause cause) : _cause(cause) {\n+    if (_cause == GCCause::_wb_breakpoint) {\n+      ShenandoahBreakpoint::at_after_marking_started();\n+    }\n@@ -70,1 +81,3 @@\n-    ShenandoahBreakpoint::at_before_marking_completed();\n+    if (_cause == GCCause::_wb_breakpoint) {\n+      ShenandoahBreakpoint::at_before_marking_completed();\n+    }\n@@ -89,4 +102,1 @@\n-  if (cause == GCCause::_wb_breakpoint) {\n-    ShenandoahBreakpoint::start_gc();\n-  }\n-  ShenandoahBreakpointGCScope breakpoint_gc_scope;\n+  ShenandoahBreakpointGCScope breakpoint_gc_scope(cause);\n@@ -101,1 +111,1 @@\n-    ShenandoahBreakpointMarkScope breakpoint_mark_scope;\n+    ShenandoahBreakpointMarkScope breakpoint_mark_scope(cause);\n@@ -660,1 +670,3 @@\n-  ShenandoahBreakpoint::at_after_reference_processing_started();\n+  if (heap->gc_cause() == GCCause::_wb_breakpoint) {\n+    ShenandoahBreakpoint::at_after_reference_processing_started();\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.cpp","additions":24,"deletions":12,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -508,1 +508,0 @@\n-    _gc_requested.set();\n@@ -510,0 +509,1 @@\n+    _gc_requested.set();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahControlThread.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}