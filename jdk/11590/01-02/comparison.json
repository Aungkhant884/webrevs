{"files":[{"patch":"@@ -133,1 +133,1 @@\n-        secureRandom.nextInt();\n+        int keyID = secureRandom.nextInt();\n@@ -137,0 +137,2 @@\n+        \/\/ Use the \"priming output\" to initialize the FC 5077 session ticket key name\n+        serverCache.initCurrentKeyID(keyID);\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLContextImpl.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import java.util.Iterator;\n@@ -75,2 +76,1 @@\n-    private int currentKeyID = new SecureRandom().nextInt();\n-                                        \/\/ RFC 5077 session ticket key name\n+    private int currentKeyID;           \/\/ RFC 5077 session ticket key name\n@@ -181,1 +181,6 @@\n-    \/\/ package-private, used only by SSLContextImpl\n+    \/\/ Package-private, used only from SSLContextImpl::engineInit() to initialie currentKeyID.\n+    void initCurrentKeyID(int keyID) {\n+        currentKeyID = keyID;\n+    }\n+\n+    \/\/ Package-private, used only from SSLContextImpl::getKey() to create a new session key.\n@@ -187,1 +192,4 @@\n-        for (Map.Entry<Integer, SessionTicketExtension.StatelessKey> entry : keyHashMap.entrySet()) {\n+        Iterator<Map.Entry<Integer, SessionTicketExtension.StatelessKey>> it =\n+            keyHashMap.entrySet().iterator();\n+        while (it.hasNext()) {\n+            Map.Entry<Integer, SessionTicketExtension.StatelessKey> entry = it.next();\n@@ -190,0 +198,1 @@\n+                it.remove();\n@@ -195,1 +204,0 @@\n-                keyHashMap.remove(entry.getKey());\n@@ -201,1 +209,1 @@\n-    \/\/ package-private, used only by SSLContextImpl\n+    \/\/ Package-private, used only from SSLContextImpl::getKey() to create a new session key.\n@@ -203,0 +211,1 @@\n+        assert newID != currentKeyID : \"Must use a new ID for a new session key!\";\n@@ -208,1 +217,1 @@\n-    \/\/ package-private, used only by SSLContextImpl\n+    \/\/ Package-private, used only from SSLContextImpl::getKey().\n@@ -213,1 +222,1 @@\n-    \/\/ package-private, used only by SSLContextImpl\n+    \/\/ Package-private, used only from SSLContextImpl::getKey(int id).\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLSessionContextImpl.java","additions":17,"deletions":8,"binary":false,"changes":25,"status":"modified"}]}