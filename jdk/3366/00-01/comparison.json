{"files":[{"patch":"@@ -31,0 +31,2 @@\n+#include <sys\/mount.h>\n+#include <sys\/param.h>\n@@ -170,5 +172,13 @@\n-    if (result == -1 && (errno == ENOTSUP || errno == ENOTTY)) {\n-        \/* Try fsync() in case F_FULLSYUNC is not implemented on the file system\n-         * or is unsupported by the device.\n-         *\/\n-        result = fsync(fd);\n+    if (result == -1) {\n+        if (errno == ENOTSUP) {\n+            \/* Try fsync() in case F_FULLSYUNC is not implemented on the\n+             * file system.\n+             *\/\n+            result = fsync(fd);\n+        } else {\n+            struct statfs fbuf;\n+            if (fstatfs(fd, &fbuf) == 0 && (fbuf.f_flags & MNT_LOCAL) == 0) {\n+                \/* Try fsync() in case file is not local. *\/\n+                result = fsync(fd);\n+            }\n+        }\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/FileDispatcherImpl.c","additions":15,"deletions":5,"binary":false,"changes":20,"status":"modified"}]}