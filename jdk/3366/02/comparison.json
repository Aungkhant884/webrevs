{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,0 +31,2 @@\n+#include <sys\/mount.h>\n+#include <sys\/param.h>\n@@ -170,3 +172,19 @@\n-    if (result == -1 && errno == ENOTSUP) {\n-        \/* Try fsync() in case F_FULLSYUNC is not implemented on the file system. *\/\n-        result = fsync(fd);\n+    if (result == -1) {\n+        if (errno == ENOTSUP) {\n+            \/* Try fsync() in case F_FULLSYUNC is not implemented on the\n+             * file system.\n+             *\/\n+            result = fsync(fd);\n+        } else {\n+            struct statfs fbuf;\n+            int errno_fcntl = errno;\n+            if (fstatfs(fd, &fbuf) == 0) {\n+                if ((fbuf.f_flags & MNT_LOCAL) == 0) {\n+                    \/* Try fsync() in case file is not local. *\/\n+                    result = fsync(fd);\n+                }\n+            } else {\n+                \/* fstatfs() failed so reinstate errno from fcntl(). *\/\n+                errno = errno_fcntl;\n+            }\n+        }\n","filename":"src\/java.base\/unix\/native\/libnio\/ch\/FileDispatcherImpl.c","additions":22,"deletions":4,"binary":false,"changes":26,"status":"modified"}]}