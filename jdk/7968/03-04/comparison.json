{"files":[{"patch":"@@ -7101,1 +7101,1 @@\n-instruct cmovI_imm_01(rRegI dst, immI_1 src1, immI_0 src2, rFlagsReg cr, cmpOp cop)\n+instruct cmovI_imm_01(rRegI dst, immI_1 src, rFlagsReg cr, cmpOp cop)\n@@ -7103,1 +7103,2 @@\n-  match(Set dst (CMoveI (Binary cop cr) (Binary src1 src2)));\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_int() == 0);\n+  match(Set dst (CMoveI (Binary cop cr) (Binary src dst)));\n@@ -7105,3 +7106,2 @@\n-  ins_cost(150); \/\/ XXX\n-  format %{ \"setbn$cop $dst\\t# signed, int\\n\\t\"\n-            \"movzbl    $dst, $dst\" %}\n+  ins_cost(100); \/\/ XXX\n+  format %{ \"setbn$cop $dst\\t# signed, int\" %}\n@@ -7111,1 +7111,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -7113,1 +7112,1 @@\n-  ins_pipe(pipe_slow);\n+  ins_pipe(ialu_reg);\n@@ -7128,1 +7127,1 @@\n-instruct cmovI_imm_01U(rRegI dst, immI_1 src1, immI_0 src2, rFlagsRegU cr, cmpOpU cop)\n+instruct cmovI_imm_01U(rRegI dst, immI_1 src, rFlagsRegU cr, cmpOpU cop)\n@@ -7130,1 +7129,2 @@\n-  match(Set dst (CMoveI (Binary cop cr) (Binary src1 src2)));\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_int() == 0);\n+  match(Set dst (CMoveI (Binary cop cr) (Binary src dst)));\n@@ -7132,3 +7132,2 @@\n-  ins_cost(150); \/\/ XXX\n-  format %{ \"setbn$cop $dst\\t# signed, int\\n\\t\"\n-            \"movzbl    $dst, $dst\" %}\n+  ins_cost(100); \/\/ XXX\n+  format %{ \"setbn$cop $dst\\t# unsigned, int\" %}\n@@ -7138,1 +7137,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -7140,1 +7138,1 @@\n-  ins_pipe(pipe_slow);\n+  ins_pipe(ialu_reg);\n@@ -7154,1 +7152,1 @@\n-instruct cmovI_imm_01UCF(rRegI dst, immI_1 src1, immI_0 src2, rFlagsRegUCF cr, cmpOpUCF cop)\n+instruct cmovI_imm_01UCF(rRegI dst, immI_1 src, rFlagsRegUCF cr, cmpOpUCF cop)\n@@ -7156,1 +7154,2 @@\n-  match(Set dst (CMoveI (Binary cop cr) (Binary src1 src2)));\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_int() == 0);\n+  match(Set dst (CMoveI (Binary cop cr) (Binary src dst)));\n@@ -7158,3 +7157,2 @@\n-  ins_cost(150); \/\/ XXX\n-  format %{ \"setbn$cop $dst\\t# signed, int\\n\\t\"\n-            \"movzbl    $dst, $dst\" %}\n+  ins_cost(100); \/\/ XXX\n+  format %{ \"setbn$cop $dst\\t# unsigned, int\" %}\n@@ -7164,1 +7162,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -7166,1 +7163,1 @@\n-  ins_pipe(pipe_slow);\n+  ins_pipe(ialu_reg);\n@@ -7305,1 +7302,1 @@\n-instruct cmovL_imm_01(rRegL dst, immL1 src1, immL0 src2, rFlagsReg cr, cmpOp cop)\n+instruct cmovL_imm_01(rRegL dst, immI_1 src, rFlagsReg cr, cmpOp cop)\n@@ -7307,1 +7304,2 @@\n-  match(Set dst (CMoveL (Binary cop cr) (Binary src1 src2)));\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n+  match(Set dst (CMoveL (Binary cop cr) (Binary src dst)));\n@@ -7309,3 +7307,2 @@\n-  ins_cost(150); \/\/ XXX\n-  format %{ \"setbn$cop $dst\\t# signed, long\\n\\t\"\n-            \"movzbl    $dst, $dst\" %}\n+  ins_cost(100); \/\/ XXX\n+  format %{ \"setbn$cop $dst\\t# signed, long\" %}\n@@ -7315,1 +7312,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -7317,1 +7313,1 @@\n-  ins_pipe(pipe_slow);\n+  ins_pipe(ialu_reg);\n@@ -7344,1 +7340,1 @@\n-instruct cmovL_imm_01U(rRegL dst, immL1 src1, immL0 src2, rFlagsRegU cr, cmpOpU cop)\n+instruct cmovL_imm_01U(rRegL dst, immI_1 src, rFlagsRegU cr, cmpOpU cop)\n@@ -7346,1 +7342,2 @@\n-  match(Set dst (CMoveL (Binary cop cr) (Binary src1 src2)));\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n+  match(Set dst (CMoveL (Binary cop cr) (Binary src dst)));\n@@ -7348,3 +7345,2 @@\n-  ins_cost(150); \/\/ XXX\n-  format %{ \"setbn$cop $dst\\t# unsigned, long\\n\\t\"\n-            \"movzbl    $dst, $dst\" %}\n+  ins_cost(100); \/\/ XXX\n+  format %{ \"setbn$cop $dst\\t# unsigned, long\" %}\n@@ -7354,1 +7350,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -7356,1 +7351,1 @@\n-  ins_pipe(pipe_slow);\n+  ins_pipe(ialu_reg);\n@@ -7371,1 +7366,1 @@\n-instruct cmovL_imm_01UCF(rRegL dst, immL1 src1, immL0 src2, rFlagsRegUCF cr, cmpOpUCF cop)\n+instruct cmovL_imm_01UCF(rRegL dst, immI_1 src, rFlagsRegUCF cr, cmpOpUCF cop)\n@@ -7373,1 +7368,2 @@\n-  match(Set dst (CMoveL (Binary cop cr) (Binary src1 src2)));\n+  predicate(n->in(2)->in(2)->is_Con() && n->in(2)->in(2)->get_long() == 0);\n+  match(Set dst (CMoveL (Binary cop cr) (Binary src dst)));\n@@ -7375,3 +7371,2 @@\n-  ins_cost(150); \/\/ XXX\n-  format %{ \"setbn$cop $dst\\t# unsigned, long\\n\\t\"\n-            \"movzbl    $dst, $dst\" %}\n+  ins_cost(100); \/\/ XXX\n+  format %{ \"setbn$cop $dst\\t# unsigned, long\" %}\n@@ -7381,1 +7376,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -7383,1 +7377,1 @@\n-  ins_pipe(pipe_slow);\n+  ins_pipe(ialu_reg);\n@@ -10693,1 +10687,1 @@\n-  effect(KILL cr);\n+  effect(TEMP dst, KILL cr);\n@@ -10695,3 +10689,3 @@\n-  format %{ \"testl   $src, $src\\t# ci2b\\n\\t\"\n-            \"setnz   $dst\\n\\t\"\n-            \"movzbl  $dst, $dst\" %}\n+  format %{ \"xorl    $dst, $dst\\t# ci2b\\n\\t\"\n+            \"testl   $src, $src\\n\\t\"\n+            \"setnz   $dst\" %}\n@@ -10699,0 +10693,1 @@\n+    __ xorl($dst$$Register, $dst$$Register);\n@@ -10701,1 +10696,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n@@ -10710,1 +10704,1 @@\n-  effect(KILL cr);\n+  effect(TEMP dst, KILL cr);\n@@ -10712,3 +10706,3 @@\n-  format %{ \"testq   $src, $src\\t# cp2b\\n\\t\"\n-            \"setnz   $dst\\n\\t\"\n-            \"movzbl  $dst, $dst\" %}\n+  format %{ \"xorl    $dst, $dst\\t# cp2b\\n\\t\"\n+            \"testq   $src, $src\\n\\t\"\n+            \"setnz   $dst\" %}\n@@ -10716,0 +10710,1 @@\n+    __ xorl($dst$$Register, $dst$$Register);\n@@ -10718,1 +10713,0 @@\n-    __ movzbl($dst$$Register, $dst$$Register);\n","filename":"src\/hotspot\/cpu\/x86\/x86_64.ad","additions":46,"deletions":52,"binary":false,"changes":98,"status":"modified"}]}