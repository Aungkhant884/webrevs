{"files":[{"patch":"@@ -428,2 +428,1 @@\n-    KlassCallback callback(&kwr);\n-    _subsystem_callback = &callback;\n+    KlassCallback callback(&_subsystem_callback, &kwr);\n@@ -435,2 +434,1 @@\n-    CompositeKlassCallback callback(&ckwr);\n-    _subsystem_callback = &callback;\n+    CompositeKlassCallback callback(&_subsystem_callback, &ckwr);\n@@ -477,2 +475,1 @@\n-  RegisterKlassCallback callback(&reg);\n-  _subsystem_callback = &callback;\n+  RegisterKlassCallback callback(&_subsystem_callback, &reg);\n@@ -555,2 +552,1 @@\n-    PackageCallback callback(&pwwc);\n-    _subsystem_callback = &callback;\n+    PackageCallback callback(&_subsystem_callback, &pwwc);\n@@ -565,2 +561,1 @@\n-    CompositePackageCallback callback(&cpwwc);\n-    _subsystem_callback = &callback;\n+    CompositePackageCallback callback(&_subsystem_callback, &cpwwc);\n@@ -576,2 +571,1 @@\n-  ClearPackageCallback callback(&clear);\n-  _subsystem_callback = &callback;\n+  ClearPackageCallback callback(&_subsystem_callback, &clear);\n@@ -654,2 +648,1 @@\n-    ModuleCallback callback(&mwwc);\n-    _subsystem_callback = &callback;\n+    ModuleCallback callback(&_subsystem_callback, &mwwc);\n@@ -664,2 +657,1 @@\n-    CompositeModuleCallback callback(&cmwwc);\n-    _subsystem_callback = &callback;\n+    CompositeModuleCallback callback(&_subsystem_callback, &cmwwc);\n@@ -675,2 +667,1 @@\n-  ClearModuleCallback callback(&clear);\n-  _subsystem_callback = &callback;\n+  ClearModuleCallback callback(&_subsystem_callback, &clear);\n@@ -788,2 +779,1 @@\n-    CldCallback callback(&cldwwc);\n-    _subsystem_callback = &callback;\n+    CldCallback callback(&_subsystem_callback, &cldwwc);\n@@ -800,2 +790,1 @@\n-    CompositeCldCallback callback(&ccldwwc);\n-    _subsystem_callback = &callback;\n+    CompositeCldCallback callback(&_subsystem_callback, &ccldwwc);\n@@ -811,2 +800,1 @@\n-  ClearCLDCallback callback(&clear);\n-  _subsystem_callback = &callback;\n+  ClearCLDCallback callback(&_subsystem_callback, &clear);\n","filename":"src\/hotspot\/share\/jfr\/recorder\/checkpoint\/types\/jfrTypeSet.cpp","additions":12,"deletions":24,"binary":false,"changes":36,"status":"modified"},{"patch":"@@ -61,0 +61,1 @@\n+  JfrArtifactClosure** _subsystem_callback_loc;\n@@ -63,1 +64,8 @@\n-  JfrArtifactCallbackHost(Callback* callback) : _callback(callback) {}\n+  JfrArtifactCallbackHost(JfrArtifactClosure** subsystem_callback_loc, Callback* callback) :\n+          _subsystem_callback_loc(subsystem_callback_loc), _callback(callback) {\n+    assert(*_subsystem_callback_loc == NULL, \"Subsystem callback should not be set yet\");\n+    *_subsystem_callback_loc = this;\n+  }\n+  ~JfrArtifactCallbackHost() {\n+    *_subsystem_callback_loc = NULL;\n+  }\n","filename":"src\/hotspot\/share\/jfr\/recorder\/checkpoint\/types\/jfrTypeSetUtils.hpp","additions":9,"deletions":1,"binary":false,"changes":10,"status":"modified"}]}