{"files":[{"patch":"@@ -35,0 +35,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -485,8 +486,12 @@\n-  if (!has_mh)  mh_reg_name = \"R5\";\n-  tty->print_cr(\"MH %s %s=\" PTR_FORMAT \" sp=(\" PTR_FORMAT \"+\" INTX_FORMAT \") stack_size=\" INTX_FORMAT \" bp=\" PTR_FORMAT,\n-                adaptername, mh_reg_name, mh_reg,\n-                (intptr_t)entry_sp, (intptr_t)saved_sp - (intptr_t)entry_sp, (intptr_t)(base_sp - last_sp), (intptr_t)saved_bp);\n-\n-  if (last_sp != saved_sp && last_sp != NULL)\n-    tty->print_cr(\"*** last_sp=\" INTPTR_FORMAT, p2i(last_sp));\n-  if (Verbose) {\n+  if (!has_mh) {\n+    mh_reg_name = \"R5\";\n+  }\n+  log_info(methodhandles)(\"MH %s %s=\" PTR_FORMAT \" sp=(\" PTR_FORMAT \"+\" INTX_FORMAT \") stack_size=\" INTX_FORMAT \" bp=\" PTR_FORMAT,\n+                          adaptername, mh_reg_name, mh_reg,\n+                          (intptr_t)entry_sp, (intptr_t)saved_sp - (intptr_t)entry_sp, (intptr_t)(base_sp - last_sp), (intptr_t)saved_bp);\n+\n+  if (last_sp != saved_sp && last_sp != NULL) {\n+    log_info(methodhandles)(\"*** last_sp=\" INTPTR_FORMAT, p2i(last_sp));\n+  }\n+  LogTarget(Trace, methodhandles) lt;\n+  if (lt.is_enabled()) {\n@@ -494,1 +499,2 @@\n-    tty->print(\" reg dump: \");\n+    LogStream ls(lt);\n+    ls.print(\" reg dump: \");\n@@ -498,1 +504,1 @@\n-        tty->print(\"\\n   + dump: \");\n+        ls.print(\"\\n   + dump: \");\n@@ -500,1 +506,1 @@\n-      tty->print(\" %s: \" INTPTR_FORMAT, reg_name, p2i((void *)saved_regs[i]));\n+      ls.print(\" %s: \" INTPTR_FORMAT, reg_name, p2i((void*)saved_regs[i]));\n@@ -502,1 +508,1 @@\n-    tty->cr();\n+    ls.cr();\n@@ -530,2 +536,2 @@\n-      tty->print_cr(\"  stack layout:\");\n-      values.print(p);\n+      ls.print_cr(\"  stack layout:\");\n+      values.print_on(p, &ls);\n@@ -535,1 +541,1 @@\n-      mh->print();\n+      mh->print_on(&ls);\n@@ -537,1 +543,1 @@\n-        java_lang_invoke_MethodHandle::form(mh)->print();\n+        java_lang_invoke_MethodHandle::form(mh)->print_on(&ls);\n","filename":"src\/hotspot\/cpu\/arm\/methodHandles_arm.cpp","additions":22,"deletions":16,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -493,1 +494,1 @@\n-  tty->print_cr(\"MH %s %s=\" INTPTR_FORMAT \" sp=\" INTPTR_FORMAT,\n+  log_info(methodhandles)(\"MH %s %s=\" INTPTR_FORMAT \" sp=\" INTPTR_FORMAT,\n@@ -496,1 +497,2 @@\n-  if (Verbose) {\n+  LogTarget(Trace, methodhandles) lt;\n+  if (lt.is_enabled()) {\n@@ -498,1 +500,2 @@\n-    tty->print_cr(\"Registers:\");\n+    LogStream ls(lt);\n+    ls.print_cr(\"Registers:\");\n@@ -504,1 +507,1 @@\n-      tty->print(\"%3s=\" PTR_FORMAT, r->name(), saved_regs[abi_offset + count]);\n+      ls.print(\"%3s=\" PTR_FORMAT, r->name(), saved_regs[abi_offset + count]);\n@@ -506,1 +509,1 @@\n-        tty->cr();\n+        ls.cr();\n@@ -508,1 +511,1 @@\n-        tty->print(\", \");\n+        ls.print(\", \");\n@@ -511,1 +514,1 @@\n-    tty->cr();\n+    ls.cr();\n@@ -545,2 +548,2 @@\n-      tty->print_cr(\"Stack layout:\");\n-      values.print(p);\n+      ls.print_cr(\"Stack layout:\");\n+      values.print_on(p, &ls);\n@@ -550,1 +553,1 @@\n-      mh->print();\n+      mh->print_on(&ls);\n@@ -552,1 +555,1 @@\n-        java_lang_invoke_MethodHandle::form(mh)->print();\n+        java_lang_invoke_MethodHandle::form(mh)->print_on(&ls);\n","filename":"src\/hotspot\/cpu\/ppc\/methodHandles_ppc.cpp","additions":14,"deletions":11,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -558,3 +559,3 @@\n-  tty->print_cr(\"MH %s %s=\" INTPTR_FORMAT \" sender_sp=\" INTPTR_FORMAT \" args=\" INTPTR_FORMAT,\n-                adaptername, mh_reg_name,\n-                p2i(mh), p2i(sender_sp), p2i(args));\n+  log_info(methodhandles)(\"MH %s %s=\" INTPTR_FORMAT \" sender_sp=\" INTPTR_FORMAT \" args=\" INTPTR_FORMAT,\n+                          adaptername, mh_reg_name,\n+                          p2i(mh), p2i(sender_sp), p2i(args));\n@@ -562,1 +563,2 @@\n-  if (Verbose) {\n+  LogTarget(Trace, methodhandles) lt;\n+  if (lt.is_enabled()) {\n@@ -564,1 +566,2 @@\n-\n+    ResourceMark rm;\n+    LogStream ls(lt);\n@@ -567,1 +570,0 @@\n-    ResourceMark rm;\n@@ -617,2 +619,2 @@\n-    tty->print_cr(\"  stack layout:\");\n-    values.print(p);\n+    ls.print_cr(\"  stack layout:\");\n+    values.print_on(p, &ls);\n@@ -620,1 +622,1 @@\n-      mh->print();\n+      mh->print_on(&ls);\n@@ -622,1 +624,1 @@\n-        java_lang_invoke_MethodHandle::form(mh)->print();\n+        java_lang_invoke_MethodHandle::form(mh)->print_on(&ls);\n","filename":"src\/hotspot\/cpu\/s390\/methodHandles_s390.cpp","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -33,0 +33,1 @@\n+#include \"logging\/logStream.hpp\"\n@@ -511,3 +512,1 @@\n-  tty->print_cr(\"MH %s %s=\" PTR_FORMAT \" sp=\" PTR_FORMAT,\n-                adaptername, mh_reg_name,\n-                p2i(mh), p2i(entry_sp));\n+  log_info(methodhandles)(\"MH %s %s=\" PTR_FORMAT \" sp=\" PTR_FORMAT, adaptername, mh_reg_name, p2i(mh), p2i(entry_sp));\n@@ -515,1 +514,2 @@\n-  if (Verbose) {\n+  LogTarget(Trace, methodhandles) lt;\n+  if (lt.is_enabled()) {\n@@ -517,1 +517,2 @@\n-    tty->print_cr(\"Registers:\");\n+    LogStream ls(lt);\n+    ls.print_cr(\"Registers:\");\n@@ -526,1 +527,1 @@\n-        tty->print(\"%3s=\" PTR_FORMAT, r->name(), (intptr_t)(&saved_regs[16]));\n+        ls.print(\"%3s=\" PTR_FORMAT, r->name(), (intptr_t)(&saved_regs[16]));\n@@ -528,1 +529,1 @@\n-        tty->print(\"%3s=\" PTR_FORMAT, r->name(), saved_regs[((saved_regs_count - 1) - i)]);\n+        ls.print(\"%3s=\" PTR_FORMAT, r->name(), saved_regs[((saved_regs_count - 1) - i)]);\n@@ -531,1 +532,1 @@\n-      tty->print(\"%3s=\" PTR_FORMAT, r->name(), saved_regs[((saved_regs_count - 1) - i)]);\n+      ls.print(\"%3s=\" PTR_FORMAT, r->name(), saved_regs[((saved_regs_count - 1) - i)]);\n@@ -534,1 +535,1 @@\n-        tty->cr();\n+        ls.cr();\n@@ -536,1 +537,1 @@\n-        tty->print(\", \");\n+        ls.print(\", \");\n@@ -539,1 +540,1 @@\n-    tty->cr();\n+    ls.cr();\n@@ -590,2 +591,2 @@\n-      tty->print_cr(\"Stack layout:\");\n-      values.print(p);\n+      ls.print_cr(\"Stack layout:\");\n+      values.print_on(p, &ls);\n@@ -594,1 +595,1 @@\n-      mh->print();\n+      mh->print_on(&ls);\n@@ -596,1 +597,1 @@\n-        java_lang_invoke_MethodHandle::form(mh)->print();\n+        java_lang_invoke_MethodHandle::form(mh)->print_on(&ls);\n","filename":"src\/hotspot\/cpu\/x86\/methodHandles_x86.cpp","additions":16,"deletions":15,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -1291,1 +1291,1 @@\n-void FrameValues::print(JavaThread* thread) {\n+void FrameValues::print_on(JavaThread* thread, outputStream* st) {\n@@ -1324,1 +1324,1 @@\n-      tty->print_cr(\" \" INTPTR_FORMAT \": \" INTPTR_FORMAT, p2i(cur), *cur);\n+      st->print_cr(\" \" INTPTR_FORMAT \": \" INTPTR_FORMAT, p2i(cur), *cur);\n@@ -1329,1 +1329,1 @@\n-      tty->print_cr(\" %s  %s %s\", spacer, spacer, fv.description);\n+      st->print_cr(\" %s  %s %s\", spacer, spacer, fv.description);\n@@ -1331,1 +1331,1 @@\n-      tty->print_cr(\" \" INTPTR_FORMAT \": \" INTPTR_FORMAT \" %s\", p2i(fv.location), *fv.location, fv.description);\n+      st->print_cr(\" \" INTPTR_FORMAT \": \" INTPTR_FORMAT \" %s\", p2i(fv.location), *fv.location, fv.description);\n","filename":"src\/hotspot\/share\/runtime\/frame.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -443,1 +443,2 @@\n-  void print(JavaThread* thread);\n+  void print(JavaThread* thread) { print_on(thread, tty); }\n+  void print_on(JavaThread* thread, outputStream* out);\n","filename":"src\/hotspot\/share\/runtime\/frame.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}