{"files":[{"patch":"@@ -170,2 +170,1 @@\n-  _preserved_mark_stack.clear(true);\n-  _preserved_oop_stack.clear(true);\n+  _preserved_overflow_stack.clear(true);\n","filename":"src\/hotspot\/share\/gc\/serial\/genMarkSweep.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -52,2 +52,1 @@\n-Stack<oop, mtGC>              MarkSweep::_preserved_oop_stack;\n-Stack<markWord, mtGC>         MarkSweep::_preserved_mark_stack;\n+Stack<PreservedMark, mtGC>    MarkSweep::_preserved_overflow_stack;\n@@ -164,1 +163,1 @@\n-    _preserved_marks[_preserved_count++].init(obj, mark);\n+    _preserved_marks[_preserved_count++] = PreservedMark(obj, mark);\n@@ -166,2 +165,1 @@\n-    _preserved_mark_stack.push(mark);\n-    _preserved_oop_stack.push(obj);\n+    _preserved_overflow_stack.push(PreservedMark(obj, mark));\n@@ -179,3 +177,0 @@\n-  assert( _preserved_oop_stack.size() == _preserved_mark_stack.size(),\n-         \"inconsistent preserved oop stacks\");\n-\n@@ -188,1 +183,1 @@\n-  StackIterator<oop, mtGC> iter(_preserved_oop_stack);\n+  StackIterator<PreservedMark, mtGC> iter(_preserved_overflow_stack);\n@@ -190,2 +185,2 @@\n-    oop* p = iter.next_addr();\n-    adjust_pointer(p);\n+    PreservedMark* p = iter.next_addr();\n+    p->adjust_pointer();\n@@ -196,3 +191,1 @@\n-  assert(_preserved_oop_stack.size() == _preserved_mark_stack.size(),\n-         \"inconsistent preserved oop stacks\");\n-  log_trace(gc)(\"Restoring \" SIZE_FORMAT \" marks\", _preserved_count + _preserved_oop_stack.size());\n+  log_trace(gc)(\"Restoring \" SIZE_FORMAT \" marks\", _preserved_count + _preserved_overflow_stack.size());\n@@ -206,4 +199,3 @@\n-  while (!_preserved_oop_stack.is_empty()) {\n-    oop obj       = _preserved_oop_stack.pop();\n-    markWord mark = _preserved_mark_stack.pop();\n-    obj->set_mark(mark);\n+  while (!_preserved_overflow_stack.is_empty()) {\n+    PreservedMark p = _preserved_overflow_stack.pop();\n+    p.restore();\n","filename":"src\/hotspot\/share\/gc\/serial\/markSweep.cpp","additions":10,"deletions":18,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -103,2 +103,1 @@\n-  static Stack<markWord, mtGC>                 _preserved_mark_stack;\n-  static Stack<oop, mtGC>                      _preserved_oop_stack;\n+  static Stack<PreservedMark, mtGC>      _preserved_overflow_stack;\n@@ -202,5 +201,1 @@\n-  void init(oop obj, markWord mark) {\n-    _obj = obj;\n-    _mark = mark;\n-  }\n-\n+  PreservedMark(oop obj, markWord mark) : _obj(obj), _mark(mark) {}\n","filename":"src\/hotspot\/share\/gc\/serial\/markSweep.hpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"}]}