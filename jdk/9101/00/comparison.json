{"files":[{"patch":"@@ -57,0 +57,3 @@\n+#ifdef LINUX\n+#include <link.h>\n+#endif\n@@ -709,1 +712,20 @@\n-  ::dlclose(lib);\n+#if defined(LINUX)\n+  struct link_map *lmap;\n+  int res_dli = ::dlinfo(lib, RTLD_DI_LINKMAP, &lmap);\n+  const char* l_path = \"<none>\";\n+  if (res_dli == 0) {\n+    l_path = lmap->l_name;\n+  }\n+#else\n+  const char* l_path = \"<not available>\";\n+#endif\n+\n+  int res = ::dlclose(lib);\n+\n+  if (res == 0) {\n+    Events::log_dll_message(NULL, \"Unloaded shared library %s [\" INTPTR_FORMAT \"]\", l_path, p2i(lib));\n+    log_info(os)(\"Unloaded shared library \\\"%s\\\" [\" INTPTR_FORMAT \"]\", l_path, p2i(lib));\n+  } else {\n+    Events::log_dll_message(NULL, \"Attempt to unload shared library %s [\" INTPTR_FORMAT \"] failed\", l_path, p2i(lib));\n+    log_info(os)(\"Attempt to unload shared library \\\"%s\\\" [\" INTPTR_FORMAT \"] failed\", l_path, p2i(lib));\n+  }\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":23,"deletions":1,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -1239,1 +1239,12 @@\n-  ::FreeLibrary((HMODULE)lib);\n+  char name[MAX_PATH];\n+  if (::GetModuleFileName((HMODULE)lib, name, sizeof(name)) == 0) {\n+    name[0] = '\\0';\n+  }\n+  if (::FreeLibrary((HMODULE)lib)) {\n+    Events::log_dll_message(NULL, \"Unloaded dll \\\"%s\\\" [\" INTPTR_FORMAT \"]\", name, p2i(lib));\n+    log_info(os)(\"Unloaded dll \\\"%s\\\" [\" INTPTR_FORMAT \"]\", name, p2i(lib));\n+  } else {\n+    const DWORD errcode = ::GetLastError();\n+    Events::log_dll_message(NULL, \"Attempt to unload dll %s [\" INTPTR_FORMAT \"] failed (error code %d)\", name, p2i(lib), errcode);\n+    log_info(os)(\"Attempt to unload dll \\\"%s\\\" [\" INTPTR_FORMAT \"] failed (error code %d)\", name, p2i(lib), errcode);\n+  }\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"}]}