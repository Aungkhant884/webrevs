{"files":[{"patch":"@@ -1789,0 +1789,10 @@\n+const char* os::Linux::dll_path(void* lib) {\n+  struct link_map *lmap;\n+  int res_dli = ::dlinfo(lib, RTLD_DI_LINKMAP, &lmap);\n+  const char* l_path = \"<none>\";\n+  if (res_dli == 0) {\n+    l_path = lmap->l_name;\n+  }\n+  return l_path;\n+}\n+\n","filename":"src\/hotspot\/os\/linux\/os_linux.cpp","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1999, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1999, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -123,0 +123,1 @@\n+  static const char *dll_path(void* lib); \n","filename":"src\/hotspot\/os\/linux\/os_linux.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -57,3 +57,0 @@\n-#ifdef LINUX\n-#include <link.h>\n-#endif\n@@ -712,11 +709,2 @@\n-#if defined(LINUX)\n-  struct link_map *lmap;\n-  int res_dli = ::dlinfo(lib, RTLD_DI_LINKMAP, &lmap);\n-  const char* l_path = \"<none>\";\n-  if (res_dli == 0) {\n-    l_path = lmap->l_name;\n-  }\n-#else\n-  const char* l_path = \"<not available>\";\n-#endif\n-\n+  const char* l_path = LINUX_ONLY(os::Linux::dll_path(lib))\n+                       NOT_LINUX(\"<not available>\");\n@@ -726,1 +714,2 @@\n-    Events::log_dll_message(NULL, \"Unloaded shared library %s [\" INTPTR_FORMAT \"]\", l_path, p2i(lib));\n+    Events::log_dll_message(NULL, \"Unloaded shared library \\\"%s\\\" [\" INTPTR_FORMAT \"]\",\n+                            l_path, p2i(lib));\n@@ -729,2 +718,9 @@\n-    Events::log_dll_message(NULL, \"Attempt to unload shared library %s [\" INTPTR_FORMAT \"] failed\", l_path, p2i(lib));\n-    log_info(os)(\"Attempt to unload shared library \\\"%s\\\" [\" INTPTR_FORMAT \"] failed\", l_path, p2i(lib));\n+    const char* error_report = ::dlerror();\n+    if (error_report == NULL) {\n+      error_report = \"dlerror returned no error description\";\n+    }\n+\n+    Events::log_dll_message(NULL, \"Attempt to unload shared library \\\"%s\\\" [\" INTPTR_FORMAT \"] failed, %s\",\n+                            l_path, p2i(lib), error_report);\n+    log_info(os)(\"Attempt to unload shared library \\\"%s\\\" [\" INTPTR_FORMAT \"] failed, %s\",\n+                  l_path, p2i(lib), error_report);\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":13,"deletions":17,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -1248,1 +1248,1 @@\n-    Events::log_dll_message(NULL, \"Attempt to unload dll %s [\" INTPTR_FORMAT \"] failed (error code %d)\", name, p2i(lib), errcode);\n+    Events::log_dll_message(NULL, \"Attempt to unload dll \\\"%s\\\" [\" INTPTR_FORMAT \"] failed (error code %d)\", name, p2i(lib), errcode);\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}