{"files":[{"patch":"@@ -9648,0 +9648,94 @@\n+\/\/ Manifest a CmpU result in an integer register.\n+\/\/ (src1 < src2) ? -1 : ((src1 > src2) ? 1 : 0)\n+instruct cmpU3_reg_reg(iRegINoSp dst, iRegI src1, iRegI src2, rFlagsReg flags)\n+%{\n+  match(Set dst (CmpU3 src1 src2));\n+  effect(KILL flags);\n+\n+  ins_cost(INSN_COST * 3);\n+  format %{\n+      \"cmpw $src1, $src2\\n\\t\"\n+      \"csetw $dst, ne\\n\\t\"\n+      \"cnegw $dst, lo\\t# CmpU3(reg)\"\n+  %}\n+  ins_encode %{\n+    __ cmpw($src1$$Register, $src2$$Register);\n+    __ csetw($dst$$Register, Assembler::NE);\n+    __ cnegw($dst$$Register, $dst$$Register, Assembler::LO);\n+  %}\n+\n+  ins_pipe(pipe_class_default);\n+%}\n+\n+instruct cmpU3_reg_imm(iRegINoSp dst, iRegI src1, immIAddSub src2, rFlagsReg flags)\n+%{\n+  match(Set dst (CmpU3 src1 src2));\n+  effect(KILL flags);\n+\n+  ins_cost(INSN_COST * 3);\n+  format %{\n+      \"cmpw $src1, $src2\\n\\t\"\n+      \"csetw $dst, ne\\n\\t\"\n+      \"cnegw $dst, lo\\t# CmpU3(imm)\"\n+  %}\n+  ins_encode %{\n+    int32_t con = (int32_t)$src2$$constant;\n+    if (con < 0) {\n+      __ addsw(zr, $src1$$Register, -con);\n+    } else {\n+      __ subsw(zr, $src1$$Register, con);\n+    }\n+    __ csetw($dst$$Register, Assembler::NE);\n+    __ cnegw($dst$$Register, $dst$$Register, Assembler::LO);\n+  %}\n+\n+  ins_pipe(pipe_class_default);\n+%}\n+\n+\/\/ Manifest a CmpUL result in an integer register.\n+\/\/ (src1 < src2) ? -1 : ((src1 > src2) ? 1 : 0)\n+instruct cmpUL3_reg_reg(iRegINoSp dst, iRegL src1, iRegL src2, rFlagsReg flags)\n+%{\n+  match(Set dst (CmpUL3 src1 src2));\n+  effect(KILL flags);\n+\n+  ins_cost(INSN_COST * 3);\n+  format %{\n+      \"cmp $src1, $src2\\n\\t\"\n+      \"csetw $dst, ne\\n\\t\"\n+      \"cnegw $dst, lo\\t# CmpUL3(reg)\"\n+  %}\n+  ins_encode %{\n+    __ cmp($src1$$Register, $src2$$Register);\n+    __ csetw($dst$$Register, Assembler::NE);\n+    __ cnegw($dst$$Register, $dst$$Register, Assembler::LO);\n+  %}\n+\n+  ins_pipe(pipe_class_default);\n+%}\n+\n+instruct cmpUL3_reg_imm(iRegINoSp dst, iRegL src1, immLAddSub src2, rFlagsReg flags)\n+%{\n+  match(Set dst (CmpUL3 src1 src2));\n+  effect(KILL flags);\n+\n+  ins_cost(INSN_COST * 3);\n+  format %{\n+      \"cmp $src1, $src2\\n\\t\"\n+      \"csetw $dst, ne\\n\\t\"\n+      \"cnegw $dst, lo\\t# CmpUL3(imm)\"\n+  %}\n+  ins_encode %{\n+    int32_t con = (int32_t)$src2$$constant;\n+    if (con < 0) {\n+      __ adds(zr, $src1$$Register, -con);\n+    } else {\n+      __ subs(zr, $src1$$Register, con);\n+    }\n+    __ csetw($dst$$Register, Assembler::NE);\n+    __ cnegw($dst$$Register, $dst$$Register, Assembler::LO);\n+  %}\n+\n+  ins_pipe(pipe_class_default);\n+%}\n+\n@@ -9655,1 +9749,1 @@\n-  ins_cost(INSN_COST * 6);\n+  ins_cost(INSN_COST * 3);\n@@ -9657,3 +9751,3 @@\n-      \"cmp $src1, $src2\"\n-      \"csetw $dst, ne\"\n-      \"cnegw $dst, lt\"\n+      \"cmp $src1, $src2\\n\\t\"\n+      \"csetw $dst, ne\\n\\t\"\n+      \"cnegw $dst, lt\\t# CmpL3(reg)\"\n@@ -9661,1 +9755,0 @@\n-  \/\/ format %{ \"CmpL3 $dst, $src1, $src2\" %}\n@@ -9676,1 +9769,1 @@\n-  ins_cost(INSN_COST * 6);\n+  ins_cost(INSN_COST * 3);\n@@ -9678,3 +9771,3 @@\n-      \"cmp $src1, $src2\"\n-      \"csetw $dst, ne\"\n-      \"cnegw $dst, lt\"\n+      \"cmp $src1, $src2\\n\\t\"\n+      \"csetw $dst, ne\\n\\t\"\n+      \"cnegw $dst, lt\\t# CmpL3(imm)\"\n@@ -9684,1 +9777,1 @@\n-     if (con < 0) {\n+    if (con < 0) {\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":103,"deletions":10,"binary":false,"changes":113,"status":"modified"},{"patch":"@@ -32,2 +32,2 @@\n- * @bug 8283726\n- * @requires os.arch==\"amd64\" | os.arch==\"x86_64\"\n+ * @bug 8283726 8287925\n+ * @requires os.arch==\"amd64\" | os.arch==\"x86_64\" | os.arch==\"aarch64\"\n@@ -76,0 +76,6 @@\n+    @Test\n+    @IR(counts = {IRNode.CMP_U3, \"1\"})\n+    public int compareIntWith42(int x) {\n+        return Integer.compareUnsigned(x, 42);\n+    }\n+\n@@ -82,1 +88,9 @@\n-    @Run(test = {\"lessThanInt\", \"lessThanLong\", \"compareInt\", \"compareLong\"})\n+    @Test\n+    @IR(counts = {IRNode.CMP_UL3, \"1\"})\n+    public int compareLongWith42(long x) {\n+        return Long.compareUnsigned(x, 42);\n+    }\n+\n+    @Run(test = {\"lessThanInt\", \"lessThanLong\",\n+                 \"compareInt\", \"compareIntWith42\",\n+                 \"compareLong\", \"compareLongWith42\"})\n@@ -92,0 +106,1 @@\n+            Asserts.assertEquals(compareIntWith42(x), expectedResult(x, 42));\n@@ -100,0 +115,1 @@\n+            Asserts.assertEquals(compareLongWith42(x), expectedResult(x, 42));\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/TestCompareUnsigned.java","additions":19,"deletions":3,"binary":false,"changes":22,"status":"modified"}]}