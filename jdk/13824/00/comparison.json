{"files":[{"patch":"@@ -101,0 +101,1 @@\n+  _vm_error_callbacks = nullptr;\n","filename":"src\/hotspot\/share\/runtime\/thread.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -58,0 +58,1 @@\n+class VMErrorCallback;\n@@ -107,0 +108,2 @@\n+  friend class VMError;\n+  friend class VMErrorCallbackMark;\n@@ -636,0 +639,3 @@\n+\n+ private:\n+  VMErrorCallback* _vm_error_callbacks;\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":6,"deletions":0,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -951,0 +951,8 @@\n+  STEP_IF(\"printing registered callbacks\", _verbose && _thread != nullptr);\n+    for (VMErrorCallback* callback = _thread->_vm_error_callbacks;\n+        callback != nullptr;\n+        callback = callback->_next) {\n+      callback->call(st);\n+      st->cr();\n+    }\n+\n@@ -1899,0 +1907,11 @@\n+\n+VMErrorCallbackMark::VMErrorCallbackMark(VMErrorCallback* callback)\n+  : _thread(Thread::current()) {\n+  callback->_next = _thread->_vm_error_callbacks;\n+  _thread->_vm_error_callbacks = callback;\n+}\n+\n+VMErrorCallbackMark::~VMErrorCallbackMark() {\n+  assert(_thread->_vm_error_callbacks != nullptr, \"Popped too far\");\n+  _thread->_vm_error_callbacks = _thread->_vm_error_callbacks->_next;\n+}\n","filename":"src\/hotspot\/share\/utilities\/vmError.cpp","additions":19,"deletions":0,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -216,0 +216,23 @@\n+\n+class VMErrorCallback {\n+  friend class VMError;\n+  friend class VMErrorCallbackMark;\n+\n+  \/\/ Link through all callbacks active on a thread\n+  VMErrorCallback* _next;\n+\n+  \/\/ Called by VMError reporting\n+  virtual void call(outputStream* st) = 0;\n+\n+public:\n+  VMErrorCallback() : _next(nullptr) {}\n+};\n+\n+class VMErrorCallbackMark : public StackObj {\n+  Thread* _thread;\n+\n+public:\n+  VMErrorCallbackMark(VMErrorCallback* callback);\n+  ~VMErrorCallbackMark();\n+};\n+\n","filename":"src\/hotspot\/share\/utilities\/vmError.hpp","additions":23,"deletions":0,"binary":false,"changes":23,"status":"modified"}]}