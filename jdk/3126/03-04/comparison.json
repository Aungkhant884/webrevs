{"files":[{"patch":"@@ -45,0 +45,4 @@\n+    @Label(\"Container type\")\n+    @Description(\"Container type information\")\n+    public String containerType;\n+\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/events\/ContainerConfigurationEvent.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -93,5 +93,0 @@\n-        ContainerConfigurationEvent.class,\n-        ContainerCPUUsageEvent.class,\n-        ContainerCPUThrottlingEvent.class,\n-        ContainerMemoryUsageEvent.class,\n-        ContainerIOUsageEvent.class,\n@@ -134,2 +129,1 @@\n-                containerMetrics = Container.metrics();\n-                initializationTriggered = true;\n+                \n@@ -138,5 +132,3 @@\n-                RequestEngine.addTrustedJDKHook(ContainerConfigurationEvent.class, emitContainerConfiguration);\n-                RequestEngine.addTrustedJDKHook(ContainerCPUUsageEvent.class, emitContainerCPUUsage);\n-                RequestEngine.addTrustedJDKHook(ContainerCPUThrottlingEvent.class, emitContainerCPUThrottling);\n-                RequestEngine.addTrustedJDKHook(ContainerMemoryUsageEvent.class, emitContainerMemoryUsage);\n-                RequestEngine.addTrustedJDKHook(ContainerIOUsageEvent.class, emitContainerIOUsage);\n+                \n+                initializeContainerEvents();\n+                initializationTriggered = true;\n@@ -169,0 +161,17 @@\n+    private static void initializeContainerEvents() {\n+        containerMetrics = Container.metrics();\n+        if (containerMetrics == null) {\n+            SecuritySupport.registerEvent(ContainerConfigurationEvent.class);\n+            SecuritySupport.registerEvent(ContainerCPUUsageEvent.class);\n+            SecuritySupport.registerEvent(ContainerCPUThrottlingEvent.class);\n+            SecuritySupport.registerEvent(ContainerMemoryUsageEvent.class);\n+            SecuritySupport.registerEvent(ContainerIOUsageEvent.class);\n+\n+            RequestEngine.addTrustedJDKHook(ContainerConfigurationEvent.class, emitContainerConfiguration);\n+            RequestEngine.addTrustedJDKHook(ContainerCPUUsageEvent.class, emitContainerCPUUsage);\n+            RequestEngine.addTrustedJDKHook(ContainerCPUThrottlingEvent.class, emitContainerCPUThrottling);\n+            RequestEngine.addTrustedJDKHook(ContainerMemoryUsageEvent.class, emitContainerMemoryUsage);\n+            RequestEngine.addTrustedJDKHook(ContainerIOUsageEvent.class, emitContainerIOUsage);\n+        }\n+    }\n+\n@@ -178,0 +187,1 @@\n+            t.containerType = containerMetrics.getProvider();\n@@ -259,5 +269,7 @@\n-        RequestEngine.removeHook(emitContainerConfiguration);\n-        RequestEngine.removeHook(emitContainerCPUUsage);\n-        RequestEngine.removeHook(emitContainerCPUThrottling);\n-        RequestEngine.removeHook(emitContainerMemoryUsage);\n-        RequestEngine.removeHook(emitContainerIOUsage);\n+        if (containerMetrics == null) {\n+            RequestEngine.removeHook(emitContainerConfiguration);\n+            RequestEngine.removeHook(emitContainerCPUUsage);\n+            RequestEngine.removeHook(emitContainerCPUThrottling);\n+            RequestEngine.removeHook(emitContainerMemoryUsage);\n+            RequestEngine.removeHook(emitContainerIOUsage);\n+        }\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/instrument\/JDKEvents.java","additions":29,"deletions":17,"binary":false,"changes":46,"status":"modified"}]}