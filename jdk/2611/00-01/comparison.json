{"files":[{"patch":"@@ -5583,4 +5583,5 @@\n-  \/\/ This class records the entry point of a stub and the stub pointer\n-  \/\/ which will point to it. The entry point is set when\n-  \/\/ ~AtomicStubMark() is called, after ICache::invalidate_range. This\n-  \/\/ ensures safe publication of the generated code.\n+  \/\/ class AtomicStubMark records the entry point of a stub and the\n+  \/\/ stub pointer which will point to it. The stub pointer is set to\n+  \/\/ the entry point when ~AtomicStubMark() is called, which must be\n+  \/\/ after ICache::invalidate_range. This ensures safe publication of\n+  \/\/ the generated code.\n@@ -5646,1 +5647,1 @@\n-                     bool acquire, bool release) {\n+                     atomic_memory_order order) {\n@@ -5649,0 +5650,7 @@\n+    bool acquire, release;\n+    switch (order) {\n+    case memory_order_relaxed:\n+      acquire = false, release = false; break;\n+    default:\n+      acquire = true, release = true; break;\n+    }\n@@ -5651,1 +5659,1 @@\n-    if (acquire && release) {\n+    if (order == memory_order_conservative) {\n@@ -5708,1 +5716,1 @@\n-    gen_cas_entry(MacroAssembler::byte, \/*acquire*\/true, \/*release*\/true);\n+    gen_cas_entry(MacroAssembler::byte, memory_order_conservative);\n@@ -5710,3 +5718,3 @@\n-    gen_cas_entry(MacroAssembler::word, \/*acquire*\/true, \/*release*\/true);\n-    AtomicStubMark stub(_masm, &aarch64_atomic_cmpxchg_8_impl);\n-    gen_cas_entry(MacroAssembler::xword, \/*acquire*\/true, \/*release*\/true);\n+    gen_cas_entry(MacroAssembler::word, memory_order_conservative);\n+    AtomicStubMark mark_cmpxchg_8(_masm, &aarch64_atomic_cmpxchg_8_impl);\n+    gen_cas_entry(MacroAssembler::xword, memory_order_conservative);\n@@ -5717,1 +5725,1 @@\n-    gen_cas_entry(MacroAssembler::byte, \/*acquire*\/false, \/*release*\/false);\n+    gen_cas_entry(MacroAssembler::byte, memory_order_relaxed);\n@@ -5720,1 +5728,1 @@\n-    gen_cas_entry(MacroAssembler::word, \/*acquire*\/false, \/*release*\/false);\n+    gen_cas_entry(MacroAssembler::word, memory_order_relaxed);\n@@ -5723,1 +5731,1 @@\n-    gen_cas_entry(MacroAssembler::xword, \/*acquire*\/false, \/*release*\/false);\n+    gen_cas_entry(MacroAssembler::xword, memory_order_relaxed);\n","filename":"src\/hotspot\/cpu\/aarch64\/stubGenerator_aarch64.cpp","additions":21,"deletions":13,"binary":false,"changes":34,"status":"modified"}]}