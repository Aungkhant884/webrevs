{"files":[{"patch":"@@ -1026,1 +1026,1 @@\n-\/\/ release a named shared memory region\n+\/\/ release a named shared memory region that was mmap-ed.\n@@ -1029,5 +1029,13 @@\n-#if defined(_AIX)\n-  \/\/ Do not rely on os::reserve_memory\/os::release_memory to use mmap.\n-  \/\/ Use os::reserve_memory\/os::release_memory for PerfDisableSharedMem=1, mmap\/munmap for PerfDisableSharedMem=0\n-  if (::munmap(addr, bytes) == -1) {\n-    warning(\"perfmemory: munmap failed (%d)\\n\", errno);\n+  int res;\n+  if (MemTracker::tracking_level() > NMT_minimal) {\n+    \/\/ Note: Tracker contains a ThreadCritical.\n+    Tracker tkr(Tracker::release);\n+    res = ::munmap(addr, bytes);\n+    if (res == 0) {\n+      tkr.record((address)addr, bytes);\n+    }\n+  } else {\n+    res = ::munmap(addr, bytes);\n+  }\n+  if (res != 0) {\n+    log_info(os)(\"os::release_memory failed (\" PTR_FORMAT \", \" SIZE_FORMAT \")\", p2i(addr), bytes);\n@@ -1035,3 +1043,0 @@\n-#else\n-  os::release_memory(addr, bytes);\n-#endif\n","filename":"src\/hotspot\/os\/posix\/perfMemory_posix.cpp","additions":14,"deletions":9,"binary":false,"changes":23,"status":"modified"}]}