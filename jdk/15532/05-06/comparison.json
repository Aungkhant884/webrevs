{"files":[{"patch":"@@ -683,8 +683,21 @@\n-        for (int j = cases.size() - 1; j >= 0; j--) {\n-            var currentCase = cases.get(j);\n-\n-            if (currentCase != cases.last() && (currentCase.guard != null || TreeInfo.isNullCaseLabel(currentCase.labels.head)) &&\n-                    currentCase.caseKind == CaseKind.STATEMENT &&\n-                    currentCase.completesNormally) {\n-                var nextCase = cases.get(j + 1);\n-                currentCase.stats = currentCase.stats.appendList(nextCase.stats);\n+        while (cases.nonEmpty()) {\n+            var currentCase = cases.head;\n+\n+            if (currentCase.caseKind == CaseKind.STATEMENT &&\n+                currentCase.completesNormally &&\n+                cases.tail.nonEmpty() &&\n+                cases.tail.head.guard != null) {\n+                ListBuffer<JCStatement> newStatements = new ListBuffer<>();\n+                List<JCCase> copyFrom = cases;\n+\n+                while (copyFrom.nonEmpty()) {\n+                    newStatements.appendList(copyFrom.head.stats);\n+\n+                    if (!copyFrom.head.completesNormally) {\n+                        break;\n+                    }\n+\n+                    copyFrom = copyFrom.tail;\n+                };\n+\n+                currentCase.stats = newStatements.toList();\n@@ -692,0 +705,2 @@\n+\n+            cases = cases.tail;\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/TransPatterns.java","additions":23,"deletions":8,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -111,0 +111,1 @@\n+        int i = 0;\n@@ -114,1 +115,1 @@\n-                return 1;\n+                i = i + 1;\n@@ -116,1 +117,4 @@\n-                while (true) {break;}\n+                while (true) {\n+                    i = i + 10;\n+                    break;\n+                }\n@@ -118,1 +122,1 @@\n-                return 3;\n+                i = i + 100;\n@@ -120,0 +124,2 @@\n+\n+        return i;\n@@ -150,4 +156,4 @@\n-        assertEquals(1, multipleCasesWithLoop(42));\n-        assertEquals(1, multipleCasesWithLoop(\"test\"));\n-        assertEquals(3, multipleCasesWithLoop(null));\n-        assertEquals(3, multipleCasesWithLoop(\"\"));\n+        assertEquals(111, multipleCasesWithLoop(42));\n+        assertEquals(111, multipleCasesWithLoop(\"test\"));\n+        assertEquals(110, multipleCasesWithLoop(null));\n+        assertEquals(100, multipleCasesWithLoop(\"\"));\n","filename":"test\/langtools\/tools\/javac\/patterns\/T8314226.java","additions":13,"deletions":7,"binary":false,"changes":20,"status":"modified"}]}