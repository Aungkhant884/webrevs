{"files":[{"patch":"@@ -1646,2 +1646,9 @@\n-    requested_base = base;\n-    dumptime_base = base; \/\/ This is the runtime address of the base (lower end) of this heap region.\n+    \/\/ For UseCompressedOops == false:\n+    \/\/     For deterministic archive contents, we pretend that the dumptime heap\n+    \/\/     always starts at 0x10000000 (see HeapShared::to_requested_address()), so\n+    \/\/     requested_base and dumptime_base are NOT the actual address used at\n+    \/\/     dumptime for this region. However, the contents of this region are\n+    \/\/     patched as if the it started there.\n+    \/\/ For UseCompressedOops == false, HeapShared::to_requested_address does nothing.\n+    requested_base = (char*)HeapShared::to_requested_address((address)base);\n+    dumptime_base = requested_base;\n@@ -2144,5 +2151,10 @@\n-  log_info(cds)(\"    narrow_klass_base = \" PTR_FORMAT \", narrow_klass_shift = %d\",\n-                p2i(narrow_klass_base()), narrow_klass_shift());\n-  log_info(cds)(\"    narrow_oop_mode = %d, narrow_oop_base = \" PTR_FORMAT \", narrow_oop_shift = %d\",\n-                narrow_oop_mode(), p2i(narrow_oop_base()), narrow_oop_shift());\n-  log_info(cds)(\"    heap range = [\" PTR_FORMAT \" - \"  PTR_FORMAT \"]\",\n+  if (header()->compressed_class_pointers()) {\n+    log_info(cds)(\"    narrow_klass_base = \" PTR_FORMAT \", narrow_klass_shift = %d\",\n+                  p2i(narrow_klass_base()), narrow_klass_shift());\n+  }\n+  if (header()->compressed_oops()) {\n+    log_info(cds)(\"    narrow_oop_mode = %d, narrow_oop_base = \" PTR_FORMAT \", narrow_oop_shift = %d\",\n+                  narrow_oop_mode(), p2i(narrow_oop_base()), narrow_oop_shift());\n+  }\n+  log_info(cds)(\"    heap range %s= [\" PTR_FORMAT \" - \"  PTR_FORMAT \"]\",\n+                header()->compressed_oops() ? \"\" : \"(effective) \",\n@@ -2153,4 +2165,8 @@\n-  log_info(cds)(\"    narrow_klass_base = \" PTR_FORMAT \", narrow_klass_shift = %d\",\n-                p2i(CompressedKlassPointers::base()), CompressedKlassPointers::shift());\n-  log_info(cds)(\"    narrow_oop_mode = %d, narrow_oop_base = \" PTR_FORMAT \", narrow_oop_shift = %d\",\n-                CompressedOops::mode(), p2i(CompressedOops::base()), CompressedOops::shift());\n+  if (UseCompressedClassPointers) {\n+    log_info(cds)(\"    narrow_klass_base = \" PTR_FORMAT \", narrow_klass_shift = %d\",\n+                  p2i(CompressedKlassPointers::base()), CompressedKlassPointers::shift());\n+  }\n+  if (UseCompressedOops) {\n+    log_info(cds)(\"    narrow_oop_mode = %d, narrow_oop_base = \" PTR_FORMAT \", narrow_oop_shift = %d\",\n+                  CompressedOops::mode(), p2i(CompressedOops::base()), CompressedOops::shift());\n+  }\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":27,"deletions":11,"binary":false,"changes":38,"status":"modified"}]}