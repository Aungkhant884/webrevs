{"files":[{"patch":"@@ -218,1 +218,1 @@\n-    __ unlock_object(R5, R6, R4, *stub->entry());\n+    __ unlock_object(R5, R6, R4, *stub->entry(), compilation()->is_osr_compile());\n@@ -2682,1 +2682,1 @@\n-      __ unlock_object(hdr, obj, lock, *op->stub()->entry());\n+      __ unlock_object(hdr, obj, lock, *op->stub()->entry(), compilation()->is_osr_compile());\n","filename":"src\/hotspot\/cpu\/ppc\/c1_LIRAssembler_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -161,1 +161,1 @@\n-void C1_MacroAssembler::unlock_object(Register Rmark, Register Roop, Register Rbox, Label& slow_case) {\n+void C1_MacroAssembler::unlock_object(Register Rmark, Register Roop, Register Rbox, Label& slow_case, bool may_be_unordered) {\n@@ -184,1 +184,1 @@\n-    lightweight_unlock(Roop, Rmark, noreg, slow_int);\n+    lightweight_unlock(Roop, Rmark, noreg, slow_int, may_be_unordered);\n","filename":"src\/hotspot\/cpu\/ppc\/c1_MacroAssembler_ppc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -47,1 +47,1 @@\n-  void unlock_object(Register Rmark, Register Roop, Register Rbox,                    Label& slow_case);\n+  void unlock_object(Register Rmark, Register Roop, Register Rbox,                    Label& slow_case, bool may_be_unordered);\n","filename":"src\/hotspot\/cpu\/ppc\/c1_MacroAssembler_ppc.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -1130,5 +1130,0 @@\n-      \/\/ Then check if the top of the lock-stack matches the unlocked object.\n-      addi(tmp, tmp, -oopSize);\n-      ldx(tmp, tmp, R16_thread);\n-      cmpd(CCR0, tmp, object);\n-      bne(CCR0, slow_case);\n@@ -1139,1 +1134,2 @@\n-      lightweight_unlock(object, header, tmp, slow_case);\n+\n+      lightweight_unlock(object, header, tmp, slow_case, true);\n","filename":"src\/hotspot\/cpu\/ppc\/interp_masm_ppc_64.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2296,1 +2296,2 @@\n-                                                 Register temp, Register displaced_header, Register current_header) {\n+                                                 Register temp, Register displaced_header, Register current_header,\n+                                                 bool may_be_unordered) {\n@@ -2337,1 +2338,1 @@\n-    lightweight_unlock(oop, current_header, \/* temp *\/ displaced_header, failure);\n+    lightweight_unlock(oop, current_header, \/* temp *\/ displaced_header, failure, may_be_unordered);\n@@ -4035,1 +4036,1 @@\n-void MacroAssembler::lightweight_unlock(Register obj, Register hdr, Register t1, Label& slow) {\n+void MacroAssembler::lightweight_unlock(Register obj, Register hdr, Register t1, Label& slow, bool may_be_unordered) {\n@@ -4070,3 +4071,14 @@\n-  ldx(R0, temp, R16_thread);\n-  cmpd(CCR0, R0, obj);\n-  bne(CCR0, slow);\n+  if (may_be_unordered) {\n+    ldx(R0, temp, R16_thread);\n+    cmpd(CCR0, R0, obj);\n+    bne(CCR0, slow);\n+  } else {\n+#ifdef ASSERT\n+    Label tos_ok;\n+    ldx(R0, temp, R16_thread);\n+    cmpd(CCR0, R0, obj);\n+    beq(CCR0, tos_ok);\n+    stop(\"Top of lock-stack does not match the unlocked object\");\n+    bind(tos_ok);\n+#endif\n+  }\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":18,"deletions":6,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -610,1 +610,1 @@\n-  void lightweight_unlock(Register obj, Register hdr, Register t1, Label& slow);\n+  void lightweight_unlock(Register obj, Register hdr, Register t1, Label& slow, bool may_be_unordered);\n@@ -629,1 +629,1 @@\n-                                   Register tmp1, Register tmp2, Register tmp3);\n+                                   Register tmp1, Register tmp2, Register tmp3, bool may_be_unoredered);\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -12171,1 +12171,1 @@\n-                                   $tmp1$$Register, $tmp2$$Register, $tmp3$$Register);\n+                                   $tmp1$$Register, $tmp2$$Register, $tmp3$$Register, Compile::current()->is_osr_compilation());\n","filename":"src\/hotspot\/cpu\/ppc\/ppc.ad","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2677,1 +2677,1 @@\n-    __ compiler_fast_unlock_object(CCR0, r_oop, r_box, r_temp_1, r_temp_2, r_temp_3);\n+    __ compiler_fast_unlock_object(CCR0, r_oop, r_box, r_temp_1, r_temp_2, r_temp_3, false);\n","filename":"src\/hotspot\/cpu\/ppc\/sharedRuntime_ppc.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}