{"files":[{"patch":"@@ -6352,0 +6352,1 @@\n+  ldrw(t1, Address(rthread, JavaThread::lock_stack_top_offset()));\n@@ -6360,1 +6361,0 @@\n-    ldrw(t1, Address(rthread, JavaThread::lock_stack_top_offset()));\n@@ -6366,10 +6366,0 @@\n-  {\n-    \/\/ Check if the top of the lock-stack matches the unlocked object.\n-    Label tos_ok;\n-    subw(t1, t1, oopSize);\n-    ldr(t1, Address(rthread, t1));\n-    cmpoop(t1, obj);\n-    br(Assembler::EQ, tos_ok);\n-    STOP(\"Top of lock-stack does not match the unlocked object\");\n-    bind(tos_ok);\n-  }\n@@ -6386,0 +6376,6 @@\n+  \/\/ Check if the top of the lock-stack matches the unlocked object.\n+  subw(t1, t1, oopSize);\n+  ldr(t2, Address(rthread, t1));\n+  cmpoop(t2, obj);\n+  br(Assembler::NE, slow);\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/macroAssembler_aarch64.cpp","additions":7,"deletions":11,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -9839,0 +9839,14 @@\n+  \/\/ Check if the top of the lock-stack matches the unlocked object.\n+#ifdef _LP64\n+  const Register thread = r15_thread;\n+#else\n+  const Register thread = rax;\n+  \/\/ TODO: push hdr and use below from stack\n+  \/\/ get_thread(thread);\n+#endif\n+#ifdef _LP64\n+  movl(tmp, Address(thread, JavaThread::lock_stack_top_offset()));\n+  cmpptr(obj, Address(thread, tmp, Address::times_1, -oopSize));\n+  jcc(Assembler::notEqual, slow);\n+#endif\n+\n@@ -9846,4 +9860,1 @@\n-#ifdef _LP64\n-  const Register thread = r15_thread;\n-#else\n-  const Register thread = rax;\n+#ifndef _LP64\n","filename":"src\/hotspot\/cpu\/x86\/macroAssembler_x86.cpp","additions":15,"deletions":4,"binary":false,"changes":19,"status":"modified"}]}