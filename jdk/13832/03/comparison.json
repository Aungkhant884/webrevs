{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -88,5 +88,8 @@\n-    public synchronized void error(String msg, Exception ex, int code) {\n-        if (reported) {\n-            \/\/ We only report the first error, to avoid clogging\n-            \/\/ the screen.\n-            return;\n+    public void error(String msg, Exception ex, int code) {\n+        synchronized (this) {\n+            if (reported) {\n+                \/\/ We only report the first error, to avoid clogging\n+                \/\/ the screen.\n+                return;\n+            }\n+            reported = true;\n@@ -94,1 +97,0 @@\n-        reported = true;\n","filename":"src\/java.logging\/share\/classes\/java\/util\/logging\/ErrorManager.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -731,1 +731,15 @@\n-    private synchronized void rotate() {\n+    private void rotate() {\n+        if (tryUseLock()) {\n+            try {\n+                rotate0();\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                rotate0();\n+            }\n+        }\n+    }\n+\n+    private void rotate0() {\n@@ -763,1 +777,0 @@\n-    @SuppressWarnings(\"removal\")\n@@ -765,1 +778,16 @@\n-    public synchronized void publish(LogRecord record) {\n+    public void publish(LogRecord record) {\n+        if (tryUseLock()) {\n+            try {\n+                publish0(record);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                publish0(record);\n+            }\n+        }\n+\n+    }\n+    @SuppressWarnings(\"removal\")\n+    private void publish0(LogRecord record) {\n@@ -794,1 +822,15 @@\n-    public synchronized void close() throws SecurityException {\n+    public void close() throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                close0();\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                close0();\n+            }\n+        }\n+    }\n+\n+    private void close0() throws SecurityException {\n","filename":"src\/java.logging\/share\/classes\/java\/util\/logging\/FileHandler.java","additions":47,"deletions":5,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -33,0 +33,1 @@\n+import java.util.concurrent.locks.ReentrantLock;\n@@ -68,0 +69,1 @@\n+    private final ReentrantLock lock;\n@@ -76,0 +78,11 @@\n+        lock = initLocking();\n+    }\n+\n+    private ReentrantLock initLocking() {\n+        Class<?> clazz = this.getClass();\n+        ClassLoader loader = clazz.getClassLoader();\n+        if (loader != null && loader != ClassLoader.getPlatformClassLoader()) {\n+            return null;\n+        } else {\n+            return new ReentrantLock();\n+        }\n@@ -93,0 +106,1 @@\n+        this();\n@@ -125,0 +139,9 @@\n+    boolean tryUseLock() {\n+        if (lock == null) return false;\n+        lock.lock();\n+        return true;\n+    }\n+    void unlock() {\n+        lock.unlock();\n+    }\n+\n@@ -168,1 +191,15 @@\n-    public synchronized void setFormatter(Formatter newFormatter) throws SecurityException {\n+    public void setFormatter(Formatter newFormatter) throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                setFormatter0(newFormatter);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setFormatter0(newFormatter);\n+            }\n+        }\n+    }\n+\n+    private void setFormatter0(Formatter newFormatter) throws SecurityException {\n@@ -194,1 +231,16 @@\n-    public synchronized void setEncoding(String encoding)\n+    public void setEncoding(String encoding)\n+            throws SecurityException, java.io.UnsupportedEncodingException {\n+        if (tryUseLock()) {\n+            try {\n+                setEncoding0(encoding);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setEncoding0(encoding);\n+            }\n+        }\n+    }\n+\n+    private void setEncoding0(String encoding)\n@@ -230,1 +282,15 @@\n-    public synchronized void setFilter(Filter newFilter) throws SecurityException {\n+    public void setFilter(Filter newFilter) throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                setFilter0(newFilter);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setFilter0(newFilter);\n+            }\n+        }\n+    }\n+\n+    private void setFilter0(Filter newFilter) throws SecurityException {\n@@ -254,1 +320,15 @@\n-    public synchronized void setErrorManager(ErrorManager em) {\n+    public void setErrorManager(ErrorManager em) {\n+        if (tryUseLock()) {\n+            try {\n+                setErrorManager0(em);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setErrorManager0(em);\n+            }\n+        }\n+    }\n+\n+    private void setErrorManager0(ErrorManager em) {\n@@ -306,1 +386,15 @@\n-    public synchronized void setLevel(Level newLevel) throws SecurityException {\n+    public void setLevel(Level newLevel) throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                setLevel0(newLevel);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setLevel0(newLevel);\n+            }\n+        }\n+    }\n+\n+    private void setLevel0(Level newLevel) throws SecurityException {\n@@ -314,0 +408,2 @@\n+\n+\n","filename":"src\/java.logging\/share\/classes\/java\/util\/logging\/Handler.java","additions":102,"deletions":6,"binary":false,"changes":108,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -181,1 +181,15 @@\n-    public synchronized void publish(LogRecord record) {\n+    public void publish(LogRecord record) {\n+        if (tryUseLock()) {\n+            try {\n+                publish0(record);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                publish0(record);\n+            }\n+        }\n+    }\n+\n+    private void publish0(LogRecord record) {\n@@ -203,1 +217,15 @@\n-    public synchronized void push() {\n+    public void push() {\n+        if (tryUseLock()) {\n+            try {\n+                push0();\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                push0();\n+            }\n+        }\n+    }\n+\n+    private void push0() {\n@@ -247,1 +275,15 @@\n-    public synchronized void setPushLevel(Level newLevel) throws SecurityException {\n+    public void setPushLevel(Level newLevel) throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                setPushLevel0(newLevel);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setPushLevel0(newLevel);\n+            }\n+        }\n+    }\n+\n+    private void setPushLevel0(Level newLevel) throws SecurityException {\n","filename":"src\/java.logging\/share\/classes\/java\/util\/logging\/MemoryHandler.java","additions":46,"deletions":4,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -159,1 +159,15 @@\n-    public synchronized void close() throws SecurityException {\n+    public void close() throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                close0();\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                close0();\n+            }\n+        }\n+    }\n+\n+    private void close0() throws SecurityException {\n@@ -178,1 +192,15 @@\n-    public synchronized void publish(LogRecord record) {\n+    public void publish(LogRecord record) {\n+        if (tryUseLock()) {\n+            try {\n+                publish0(record);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                publish0(record);\n+            }\n+        }\n+    }\n+\n+    private void publish0(LogRecord record) {\n","filename":"src\/java.logging\/share\/classes\/java\/util\/logging\/SocketHandler.java","additions":31,"deletions":3,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2000, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2000, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,1 +125,15 @@\n-    protected synchronized void setOutputStream(OutputStream out) throws SecurityException {\n+    protected void setOutputStream(OutputStream out) throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                setOutputStream0(out);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setOutputStream0(out);\n+            }\n+        }\n+    }\n+\n+    private void setOutputStream0(OutputStream out) throws SecurityException {\n@@ -160,1 +174,15 @@\n-    public synchronized void setEncoding(String encoding)\n+    public void setEncoding(String encoding)\n+                        throws SecurityException, java.io.UnsupportedEncodingException {\n+        if (tryUseLock()) {\n+            try {\n+                setEncoding0(encoding);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                setEncoding0(encoding);\n+            }\n+        }\n+    }\n+    private void setEncoding0(String encoding)\n@@ -193,1 +221,14 @@\n-    public synchronized void publish(LogRecord record) {\n+    public void publish(LogRecord record) {\n+        if (tryUseLock()) {\n+            try {\n+                publish0(record);\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                publish0(record);\n+            }\n+        }\n+    }\n+    private void publish0(LogRecord record) {\n@@ -244,1 +285,14 @@\n-    public synchronized void flush() {\n+    public void flush() {\n+        if (tryUseLock()) {\n+            try {\n+                flush0();\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                flush0();\n+            }\n+        }\n+    }\n+    private void flush0() {\n@@ -256,1 +310,1 @@\n-    private synchronized void flushAndClose() throws SecurityException {\n+    private void flushAndClose() throws SecurityException {\n@@ -289,2 +343,12 @@\n-    public synchronized void close() throws SecurityException {\n-        flushAndClose();\n+    public void close() throws SecurityException {\n+        if (tryUseLock()) {\n+            try {\n+                flushAndClose();\n+            } finally {\n+                unlock();\n+            }\n+        } else {\n+            synchronized (this) {\n+                flushAndClose();\n+            }\n+        }\n","filename":"src\/java.logging\/share\/classes\/java\/util\/logging\/StreamHandler.java","additions":72,"deletions":8,"binary":false,"changes":80,"status":"modified"}]}