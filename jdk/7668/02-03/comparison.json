{"files":[{"patch":"@@ -737,0 +737,1 @@\n+    void* buf = NULL;\n@@ -738,1 +739,1 @@\n-        void* buf = malloc(pfSize);\n+        buf = malloc(pfSize);\n@@ -744,1 +745,0 @@\n-            free(buf);\n@@ -748,0 +748,2 @@\n+    cmsCloseProfile(p); \/\/ No longer needed.\n+\n@@ -752,2 +754,2 @@\n-        cmsCloseProfile(p);\n-        p =  NULL;\n+        free(buf);\n+        return NULL;\n@@ -759,0 +761,1 @@\n+            free(buf);\n@@ -760,1 +763,0 @@\n-            cmsCloseProfile(p);\n@@ -765,2 +767,8 @@\n-        cmsCloseProfile(p);\n-        p = pfSanity;\n+        \/\/ Except we want to re-open it since the call to cmsReadTag()\n+        \/\/ means we may not get back the same bytes as we set.\n+        \/\/ Whilst this may change later anyway, we can at least prevent\n+        \/\/ it from happening immediately.\n+        cmsCloseProfile(pfSanity);\n+        pfSanity = cmsOpenProfileFromMem(buf, pfSize);\n+        free(buf);\n+        return pfSanity;\n@@ -768,2 +776,0 @@\n-\n-    return p;\n","filename":"src\/java.desktop\/share\/native\/liblcms\/LCMS.c","additions":15,"deletions":9,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -250,1 +250,0 @@\n-sun\/java2d\/cmm\/ProfileOp\/ReadWriteProfileTest.java 8282635 generic-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -106,2 +106,0 @@\n-            } catch (CMMException cmmEx) {\n-                System.err.println(\"Ignoring \" + cmmEx);\n@@ -109,0 +107,1 @@\n+                System.err.println(\"Ignoring \" + ignored);\n@@ -121,2 +120,0 @@\n-            } catch (CMMException cmmEx) {\n-                System.err.println(\"Ignoring \" + cmmEx);\n","filename":"test\/jdk\/java\/awt\/color\/ICC_Profile\/MTGetData.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"}]}