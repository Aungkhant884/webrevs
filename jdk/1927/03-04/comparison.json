{"files":[{"patch":"@@ -29,1 +29,1 @@\n- * @run main LandscapeStackOverflow\n+ * @run main\/manual LandscapeStackOverflow\n@@ -33,0 +33,2 @@\n+import java.awt.event.ActionEvent;\n+import java.awt.event.ActionListener;\n@@ -42,0 +44,7 @@\n+import java.awt.Font;\n+import java.awt.BorderLayout;\n+import java.awt.GridLayout;\n+import javax.swing.JButton;\n+import javax.swing.JDialog;\n+import javax.swing.JPanel;\n+import javax.swing.JTextArea;\n@@ -45,0 +54,3 @@\n+    private static Thread mainThread;\n+    private static boolean testGeneratedInterrupt;\n+\n@@ -46,3 +58,11 @@\n-        PrintService[] printService = PrinterJob.lookupPrintServices();\n-        if (printService.length == 0) {\n-            throw new RuntimeException(\"no printer found\");\n+\n+        JDialog dialog = new JDialog();\n+        JPanel panel = new JPanel();\n+        panel.add(new PrintInstructions(dialog), BorderLayout.NORTH);\n+        dialog.add(panel);\n+        dialog.pack();\n+        dialog.setVisible(true);\n+        mainThread = Thread.currentThread();\n+        try {\n+            Thread.sleep(30000);\n+        } catch (InterruptedException e) {\n@@ -50,3 +70,2 @@\n-        PrinterJob printjob = PrinterJob.getPrinterJob();\n-        if (printjob.getPrintService() == null) {\n-            printjob.setPrintService(printService[0]);\n+        if (!testGeneratedInterrupt) {\n+            throw new RuntimeException(\"user has not executed the test\");\n@@ -54,0 +73,30 @@\n+    }\n+\n+    public void dispose() {\n+        testGeneratedInterrupt = true;\n+        mainThread.interrupt();\n+    }\n+}\n+\n+class PrintInstructions extends JPanel implements ActionListener {\n+    JDialog dlg;\n+\n+    static final String INSTRUCTIONS =\n+       \"You must have a printer installed for this test.\\n\" +\n+       \"Press the PRINT button below and click on OK in print dialog\\n\" +\n+       \"If you are using \\\"Print-to-pdf\\\" printer, then set the Save-To-File option in Save dialog\\n\";\n+\n+    PrintInstructions(JDialog dialog) {\n+        dlg = dialog;\n+        setLayout(new GridLayout(2,1));\n+        JTextArea t = new JTextArea(INSTRUCTIONS, 4, 30);\n+        add(t);\n+        JButton b = new JButton(\"PRINT\");\n+        b.setFont(new Font(\"Dialog\", Font.BOLD, 10));\n+        b.addActionListener(this);\n+        add(b);\n+    }\n+\n+    public void actionPerformed(ActionEvent e) {\n+\n+        PrinterJob printjob = PrinterJob.getPrinterJob();\n@@ -59,0 +108,1 @@\n+        LandscapeStackOverflow test = new LandscapeStackOverflow();\n@@ -61,1 +111,3 @@\n-            printjob.print( attributes );\n+            if (printjob.printDialog()) {\n+                printjob.print( attributes );\n+            }\n@@ -64,0 +116,3 @@\n+        } finally {\n+            if (dlg != null) dlg.dispose();\n+            test.dispose();\n","filename":"test\/jdk\/java\/awt\/print\/PrinterJob\/LandscapeStackOverflow.java","additions":63,"deletions":8,"binary":false,"changes":71,"status":"modified"}]}