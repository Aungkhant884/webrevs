{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,10 +24,0 @@\n-\/**\n- * JRobot is a wrapper around java.awt.Robot that provides some convenience\n- * methods.\n- * <p>When using jtreg you would include this class via something like:\n- * <pre>\n- * @library ..\/..\/..\/regtesthelpers\n- * @build JRobot\n- * <\/pre>\n- *\n- *\/\n@@ -36,1 +26,0 @@\n-import java.awt.Dimension;\n@@ -41,1 +30,3 @@\n-import java.awt.event.KeyEvent;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.lang.reflect.InvocationTargetException;\n+\n@@ -44,0 +35,9 @@\n+\/**\n+ * JRobot is a wrapper around java.awt.Robot that provides some convenience\n+ * methods.\n+ * <p>When using jtreg you would include this class via something like:\n+ * <pre>{@code\n+ * @library ..\/..\/..\/regtesthelpers\n+ * @build JRobot\n+ * }<\/pre>\n+ *\/\n@@ -45,2 +45,2 @@\n-    private static int DEFAULT_DELAY = 550;\n-    private static int INTERNAL_DELAY = 250;\n+    private static final int DEFAULT_DELAY = 550;\n+    private static final int INTERNAL_DELAY = 250;\n@@ -115,0 +115,3 @@\n+     * <p>\n+     * <b>Note:<\/b> This method is executed on EDT.\n+     *\n@@ -118,4 +121,1 @@\n-        Point p = c.getLocationOnScreen();\n-        Dimension size = c.getSize();\n-        p.x += size.width \/ 2;\n-        p.y += size.height \/ 2;\n+        Point p = getCenterPoint(c);\n@@ -126,0 +126,18 @@\n+    private static Point getCenterPoint(Component c) {\n+        AtomicReference<Point> result = new AtomicReference<>();\n+        if (SwingUtilities.isEventDispatchThread()) {\n+            result.set(getCenterPointImpl(c));\n+        } else {\n+            try {\n+                SwingUtilities.invokeAndWait(() -> result.set(getCenterPointImpl(c)));\n+            } catch (InterruptedException | InvocationTargetException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+        return result.get();\n+    }\n+\n+    private static Point getCenterPointImpl(Component c) {\n+        return centerOf(new Rectangle(c.getLocationOnScreen(), c.getSize()));\n+    }\n+\n@@ -156,1 +174,1 @@\n-        clickMouse(InputEvent.BUTTON1_MASK);\n+        clickMouse(InputEvent.BUTTON1_DOWN_MASK);\n@@ -160,1 +178,4 @@\n-     * Click in the center of the given Component\n+     * Click in the center of the given Component.\n+     * <p>\n+     * <b>Note:<\/b> This method is executed on EDT.\n+     *\n@@ -162,1 +183,1 @@\n-     * @param buttons mouse button(s).\n+     * @param buttons mouse button(s)\n@@ -171,0 +192,3 @@\n+     * <p>\n+     * <b>Note:<\/b> This method is executed on EDT.\n+     *\n@@ -174,1 +198,1 @@\n-        clickMouseOn(c, InputEvent.BUTTON1_MASK);\n+        clickMouseOn(c, InputEvent.BUTTON1_DOWN_MASK);\n@@ -222,2 +246,2 @@\n-    public Point centerOf(Rectangle r) {\n-        return new Point(r.x + r.width \/ 2, r.y + r.height \/ 2);\n+    public static Point centerOf(Rectangle r) {\n+        return centerOf(r, new Point());\n@@ -232,1 +256,1 @@\n-    public Point centerOf(Rectangle r, Point p) {\n+    public static Point centerOf(Rectangle r, Point p) {\n@@ -241,0 +265,3 @@\n+     * <p>\n+     * <b>Note:<\/b> This method is executed on EDT.\n+     *\n@@ -245,4 +272,11 @@\n-        Point p = new Point(r.x, r.y);\n-        SwingUtilities.convertPointToScreen(p, c);\n-        r.x = p.x;\n-        r.y = p.y;\n+        AtomicReference<Point> p = new AtomicReference<>();\n+        if (SwingUtilities.isEventDispatchThread()) {\n+            p.set(c.getLocationOnScreen());\n+        } else {\n+            try {\n+                SwingUtilities.invokeAndWait(() -> p.set(c.getLocationOnScreen()));\n+            } catch (InterruptedException | InvocationTargetException e) {\n+                throw new RuntimeException(e);\n+            }\n+        }\n+        r.setLocation(p.get());\n","filename":"test\/jdk\/javax\/swing\/regtesthelpers\/JRobot.java","additions":64,"deletions":30,"binary":false,"changes":94,"status":"modified"}]}