{"files":[{"patch":"@@ -510,1 +510,1 @@\n-    CompLevel expected_comp_level = comp_level;\n+    CompLevel expected_comp_level = MIN2(CompLevel_full_optimization, static_cast<CompLevel>(comp_level + 1));\n@@ -515,5 +515,8 @@\n-    nmethod* osr_nm = inlinee->lookup_osr_nmethod_for(bci, expected_comp_level, false);\n-    assert(osr_nm == NULL || osr_nm->comp_level() >= expected_comp_level, \"lookup_osr_nmethod_for is broken\");\n-    if (osr_nm != NULL) {\n-      \/\/ Perform OSR with new nmethod\n-      return osr_nm;\n+    CompLevel max_osr_level = static_cast<CompLevel>(inlinee->highest_osr_comp_level());\n+    if (max_osr_level >= expected_comp_level) { \/\/ fast check to avoid locking in a typical scenario\n+      nmethod* osr_nm = inlinee->lookup_osr_nmethod_for(bci, expected_comp_level, false);\n+      assert(osr_nm == NULL || osr_nm->comp_level() >= expected_comp_level, \"lookup_osr_nmethod_for is broken\");\n+      if (osr_nm != NULL && osr_nm->comp_level() != comp_level) {\n+        \/\/ Perform OSR with new nmethod\n+        return osr_nm;\n+      }\n","filename":"src\/hotspot\/share\/compiler\/tieredThresholdPolicy.cpp","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"}]}