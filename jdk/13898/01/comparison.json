{"files":[{"patch":"@@ -54,0 +54,8 @@\n+    elif test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+      # Linking is different on aix\n+      SHARED_LIBRARY_FLAGS=\"-shared -Wl,-bM:SRE -Wl,-bnoentry\"\n+      SET_EXECUTABLE_ORIGIN=\"\"\n+      SET_SHARED_LIBRARY_ORIGIN=''\n+      SET_SHARED_LIBRARY_NAME=''\n+      SET_SHARED_LIBRARY_MAPFILE=''\n+\n@@ -209,1 +217,0 @@\n-\n@@ -287,3 +294,9 @@\n-    C_O_FLAG_HIGHEST_JVM=\"-O3\"\n-    C_O_FLAG_HIGHEST=\"-O3\"\n-    C_O_FLAG_HI=\"-O3\"\n+    if test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+      C_O_FLAG_HIGHEST_JVM=\"-O3 -finline-functions\"\n+      C_O_FLAG_HIGHEST=\"-O3 -finline-functions\"\n+      C_O_FLAG_HI=\"-O3 -finline-functions\"\n+    else\n+      C_O_FLAG_HIGHEST_JVM=\"-O3\"\n+      C_O_FLAG_HIGHEST=\"-O3\"\n+      C_O_FLAG_HI=\"-O3\"\n+    fi\n@@ -461,0 +474,3 @@\n+    if test \"x$TOOLCHAIN_TYPE\" = xclang && test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+      DEBUG_CFLAGS_JVM=\"-fpic -mcmodel=large\"\n+    fi\n@@ -496,0 +512,6 @@\n+  if test \"x$TOOLCHAIN_TYPE\" = xclang && test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+    # clang compiler on aix needs -ffunction-sections\n+    TOOLCHAIN_CFLAGS_JVM=\"$TOOLCHAIN_CFLAGS_JVM -ffunction-sections -ftls-model -fno-math-errno -fstack-protector\"\n+    TOOLCHAIN_CFLAGS_JDK=\"-ffunction-sections -fsigned-char -fstack-protector\"\n+  fi\n+\n@@ -604,0 +626,3 @@\n+  elif test \"x$TOOLCHAIN_TYPE\" = xclang && test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+    JVM_PICFLAG=\"-fpic -mcmodel=large -Wl,-bbigtoc\n+    JDK_PICFLAG=\"-fpic\n","filename":"make\/autoconf\/flags-cflags.m4","additions":29,"deletions":4,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -78,1 +78,5 @@\n-\n+    if test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+      BASIC_LDFLAGS=\"-Wl,-b64 -Wl,-brtl -Wl,-bnorwexec -Wl,-bnolibpath -Wl,-bnoexpall \\\n+        -Wl,-bernotok -Wl,-bdatapsize:64k -Wl,-btextpsize:64k -Wl,-bstackpsize:64k\"\n+      BASIC_LDFLAGS_JVM_ONLY=\"$BASIC_LDFLAGS_JVM_ONLY -Wl,-lC_r -Wl,-bbigtoc\"\n+    fi\n@@ -91,1 +95,2 @@\n-  if test \"x$TOOLCHAIN_TYPE\" = xgcc || test \"x$TOOLCHAIN_TYPE\" = xclang; then\n+  if (test \"x$TOOLCHAIN_TYPE\" = xgcc || test \"x$TOOLCHAIN_TYPE\" = xclang) \\\n+      && test \"x$OPENJDK_TARGET_OS\" != xaix; then\n@@ -119,0 +124,8 @@\n+\n+  elif test \"x$TOOLCHAIN_TYPE\" = xclang && test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+    # We need '-fpic' or '-fpic -mcmodel=large -Wl,-bbigtoc' if the TOC overflows.\n+    # Hotspot now overflows its 64K TOC (currently only for debug),\n+    # so we build with '-fpic -mcmodel=large -Wl,-bbigtoc'.\n+    if test \"x$DEBUG_LEVEL\" != xrelease; then\n+      DEBUGLEVEL_LDFLAGS_JVM_ONLY=\"$DEBUGLEVEL_LDFLAGS_JVM_ONLY -Wl,-bbigtoc\"\n+    fi\n","filename":"make\/autoconf\/flags-ldflags.m4","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2022, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -43,1 +43,1 @@\n-VALID_TOOLCHAINS_aix=\"xlc\"\n+VALID_TOOLCHAINS_aix=\"xlc clang\"\n@@ -237,0 +237,19 @@\n+  # On AIX the default toolchain depends on the installed (found) compiler\n+  #   xlclang++     -> xlc toolchain\n+  #   ibm-clang++_r -> clang toolchain\n+  # The compiler is searched on the PATH and TOOLCHAIN_PATH\n+  # xlclang++ has precedence over ibm-clang++_r if both are installed\n+  if test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+    DEFAULT_TOOLCHAIN=\"clang\"\n+    if test \"x$TOOLCHAIN_PATH\" != x; then\n+      if test -e ${TOOLCHAIN_PATH}\/xlclang++; then\n+        DEFAULT_TOOLCHAIN=\"xlc\"\n+      fi\n+    else\n+      UTIL_LOOKUP_PROGS(XLCLANG_TEST_PATH, xlclang++)\n+      if test \"x$XLCLANG_TEST_PATH\" != x; then\n+        DEFAULT_TOOLCHAIN=\"xlc\"\n+      fi\n+    fi\n+  fi\n+\n@@ -266,5 +285,9 @@\n-\n-    XLCLANG_VERSION_OUTPUT=`${XLC_TEST_PATH}xlclang++ -qversion 2>&1 | $HEAD -n 1`\n-    $ECHO \"$XLCLANG_VERSION_OUTPUT\" | $GREP \"IBM XL C\/C++ for AIX\" > \/dev\/null\n-    if test $? -eq 0; then\n-      AC_MSG_NOTICE([xlclang++ output: $XLCLANG_VERSION_OUTPUT])\n+    if test \"x$TOOLCHAIN_TYPE\" = xclang; then\n+      TOOLCHAIN_DESCRIPTION_clang=\"IBM Open XL C\/C++\"\n+      XLCLANG_VERSION_OUTPUT=`${XLC_TEST_PATH}ibm-clang++_r --version 2>&1 | $HEAD -n 1`\n+      $ECHO \"$XLCLANG_VERSION_OUTPUT\" | $GREP \"IBM Open XL C\/C++ for AIX\" > \/dev\/null\n+      if test $? -eq 0; then\n+        AC_MSG_NOTICE([ibm-clang++_r output: $XLCLANG_VERSION_OUTPUT])\n+      else\n+        AC_MSG_ERROR([ibm-clang++_r version output check failed, output: $XLCLANG_VERSION_OUTPUT])\n+      fi\n@@ -272,1 +295,7 @@\n-      AC_MSG_ERROR([xlclang++ version output check failed, output: $XLCLANG_VERSION_OUTPUT])\n+      XLCLANG_VERSION_OUTPUT=`${XLC_TEST_PATH}xlclang++ -qversion 2>&1 | $HEAD -n 1`\n+      $ECHO \"$XLCLANG_VERSION_OUTPUT\" | $GREP \"IBM XL C\/C++ for AIX\" > \/dev\/null\n+      if test $? -eq 0; then\n+        AC_MSG_NOTICE([xlclang++ output: $XLCLANG_VERSION_OUTPUT])\n+      else\n+        AC_MSG_ERROR([xlclang++ version output check failed, output: $XLCLANG_VERSION_OUTPUT])\n+      fi\n@@ -276,1 +305,5 @@\n-  TOOLCHAIN_CC_BINARY_clang=\"clang\"\n+  if test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+    TOOLCHAIN_CC_BINARY_clang=\"ibm-clang_r\"\n+  else\n+    TOOLCHAIN_CC_BINARY_clang=\"clang\"\n+  fi\n@@ -281,1 +314,5 @@\n-  TOOLCHAIN_CXX_BINARY_clang=\"clang++\"\n+  if test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+    TOOLCHAIN_CXX_BINARY_clang=\"ibm-clang++_r\"\n+  else\n+    TOOLCHAIN_CXX_BINARY_clang=\"clang++\"\n+  fi\n@@ -969,1 +1006,5 @@\n-    HOTSPOT_TOOLCHAIN_TYPE=gcc\n+    if test \"x$OPENJDK_TARGET_OS\" = xaix; then\n+      HOTSPOT_TOOLCHAIN_TYPE=xlc\n+    else\n+      HOTSPOT_TOOLCHAIN_TYPE=gcc\n+    fi\n","filename":"make\/autoconf\/toolchain.m4","additions":52,"deletions":11,"binary":false,"changes":63,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2013, 2022, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -40,2 +40,7 @@\n-    ADLC_LDFLAGS += -q64\n-    ADLC_CFLAGS := -qnortti -qeh -q64 -DAIX\n+    ifeq ($(TOOLCHAIN_TYPE), clang)\n+      ADLC_LDFLAGS += -m64\n+      ADLC_CFLAGS := -fno-rtti -fexceptions -ffunction-sections -m64 -DAIX\n+    else\n+      ADLC_LDFLAGS += -q64\n+      ADLC_CFLAGS := -qnortti -qeh -q64 -DAIX\n+    endif\n","filename":"make\/hotspot\/gensrc\/GensrcAdlc.gmk","additions":8,"deletions":3,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2013, 2021, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2013, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -112,1 +112,5 @@\n-  BUILD_LIBJVM_synchronizer.cpp_CXXFLAGS := -qnoinline\n+  ifeq ($(TOOLCHAIN_TYPE), clang)\n+    BUILD_LIBJVM_synchronizer.cpp_CXXFLAGS := -fno-inline\n+  else\n+    BUILD_LIBJVM_synchronizer.cpp_CXXFLAGS := -qnoinline\n+  endif\n","filename":"make\/hotspot\/lib\/JvmOverrideFiles.gmk","additions":6,"deletions":2,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -2,2 +2,2 @@\n- * Copyright (c) 1998, 2022, Oracle and\/or its affiliates. All rights reserved.\n- * Copyright (c) 2012, 2021 SAP SE. All rights reserved.\n+ * Copyright (c) 1998, 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2023 SAP SE. All rights reserved.\n@@ -59,0 +59,4 @@\n+#elif defined(__open_xl_version__)\n+  #if __open_xl_version__ < 17\n+  #error \"open xlc < 17 not supported\"\n+  #endif\n@@ -60,1 +64,1 @@\n-  #error \"xlc < 16 not supported, macro __ibmxl_version__ not found\"\n+  #error \"xlc version not supported, macro __ibmxl_version__ or __open_xl_version__ not found\"\n@@ -67,0 +71,5 @@\n+\/\/ Shortcut for the new xlc 17 compiler\n+#if defined(AIX) && defined(__open_xl_version__) && __open_xl_version__ >= 17\n+#define AIX_XLC_GE_17\n+#endif\n+\n","filename":"src\/hotspot\/share\/utilities\/globalDefinitions_xlc.hpp","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"}]}