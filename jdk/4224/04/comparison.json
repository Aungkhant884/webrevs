{"files":[{"patch":"@@ -748,1 +748,1 @@\n-  ObjectMonitor* _current_pending_monitor;              \/\/ ObjectMonitor this thread is waiting to lock\n+  ObjectMonitor* volatile _current_pending_monitor;     \/\/ ObjectMonitor this thread is waiting to lock\n@@ -750,1 +750,1 @@\n-  ObjectMonitor* _current_waiting_monitor;              \/\/ ObjectMonitor on which this thread called Object.wait()\n+  ObjectMonitor* volatile _current_waiting_monitor;     \/\/ ObjectMonitor on which this thread called Object.wait()\n@@ -756,1 +756,3 @@\n-    return _current_pending_monitor;\n+    \/\/ Using atomic load to prevent compilers from reloading (ThreadService::get_current_contended_monitor).\n+    \/\/ In case of concurrent modification, reloading pointer after NULL check must be prevented.\n+    return Atomic::load(&_current_pending_monitor);\n@@ -759,1 +761,1 @@\n-    _current_pending_monitor = monitor;\n+    Atomic::store(&_current_pending_monitor, monitor);\n@@ -768,1 +770,2 @@\n-    return _current_waiting_monitor;\n+    \/\/ Using atomic load as in current_pending_monitor.\n+    return Atomic::load(&_current_waiting_monitor);\n@@ -771,1 +774,1 @@\n-    _current_waiting_monitor = monitor;\n+    Atomic::store(&_current_waiting_monitor, monitor);\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -742,1 +742,1 @@\n-  nonstatic_field(JavaThread,                  _current_pending_monitor,                      ObjectMonitor*)                        \\\n+  volatile_nonstatic_field(JavaThread,         _current_pending_monitor,                      ObjectMonitor*)                        \\\n@@ -744,1 +744,1 @@\n-  nonstatic_field(JavaThread,                  _current_waiting_monitor,                      ObjectMonitor*)                        \\\n+  volatile_nonstatic_field(JavaThread,         _current_waiting_monitor,                      ObjectMonitor*)                        \\\n","filename":"src\/hotspot\/share\/runtime\/vmStructs.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}