{"files":[{"patch":"@@ -124,0 +124,9 @@\n+    {\n+        this(layer, loader, descriptor, uri, true);\n+    }\n+\n+    Module(ModuleLayer layer,\n+           ClassLoader loader,\n+           ModuleDescriptor descriptor,\n+           URI uri,\n+           boolean performNativeUpdate)\n@@ -137,1 +146,3 @@\n-        defineModule0(this, isOpen, vs, loc, packages);\n+        if (performNativeUpdate) {\n+            defineModule0(this, isOpen, vs, loc, packages);\n+        }\n@@ -1129,1 +1140,9 @@\n-                                             ModuleLayer layer)\n+                                             ModuleLayer layer) {\n+        return defineModules(cf, clf, layer, true, false);\n+    }\n+\n+    private static Map<String, Module> defineModules(Configuration cf,\n+                                                     Function<String, ClassLoader> clf,\n+                                                     ModuleLayer layer,\n+                                                     boolean performNativeUpdate,\n+                                                     boolean isBootLayerOverride)\n@@ -1131,1 +1150,1 @@\n-        boolean isBootLayer = (ModuleLayer.boot() == null);\n+        boolean isBootLayer = (ModuleLayer.boot() == null) || isBootLayerOverride;\n@@ -1183,1 +1202,1 @@\n-                m = new Module(layer, loader, descriptor, uri);\n+                m = new Module(layer, loader, descriptor, uri, performNativeUpdate);\n@@ -1223,1 +1242,3 @@\n-                addReads0(m, m2);\n+                if (performNativeUpdate) {\n+                    addReads0(m, m2);\n+                }\n@@ -1229,1 +1250,1 @@\n-                m.implAddReads(ALL_UNNAMED_MODULE, true);\n+                m.implAddReads(ALL_UNNAMED_MODULE, performNativeUpdate);\n@@ -1236,1 +1257,1 @@\n-                    initExports(m, nameToModule);\n+                    initExports(m, nameToModule, performNativeUpdate);\n@@ -1238,1 +1259,1 @@\n-                    initExportsAndOpens(m, nameToSource, nameToModule, layer.parents());\n+                    initExportsAndOpens(m, nameToSource, nameToModule, layer.parents(), performNativeUpdate);\n@@ -1298,0 +1319,1 @@\n+     * @param syncVM indicates whether the VM state should be updated\n@@ -1299,1 +1321,1 @@\n-    private static void initExports(Module m, Map<String, Module> nameToModule) {\n+    private static void initExports(Module m, Map<String, Module> nameToModule, boolean syncVM) {\n@@ -1310,1 +1332,3 @@\n-                        addExports0(m, source, m2);\n+                        if (syncVM) {\n+                            addExports0(m, source, m2);\n+                        }\n@@ -1319,1 +1343,3 @@\n-                addExportsToAll0(m, source);\n+                if (syncVM) {\n+                    addExportsToAll0(m, source);\n+                }\n@@ -1336,0 +1362,1 @@\n+     * @param syncVM indicates whether the VM state should be updated\n@@ -1340,1 +1367,2 @@\n-                                            List<ModuleLayer> parents) {\n+                                            List<ModuleLayer> parents,\n+                                            boolean syncVM) {\n@@ -1355,1 +1383,3 @@\n-                        addExports0(m, source, m2);\n+                        if (syncVM) {\n+                            addExports0(m, source, m2);\n+                        }\n@@ -1364,1 +1394,3 @@\n-                addExportsToAll0(m, source);\n+                if (syncVM) {\n+                    addExportsToAll0(m, source);\n+                }\n@@ -1386,1 +1418,3 @@\n-                            addExports0(m, source, m2);\n+                            if (syncVM) {\n+                                addExports0(m, source, m2);\n+                            }\n@@ -1396,1 +1430,3 @@\n-                addExportsToAll0(m, source);\n+                if (syncVM) {\n+                    addExportsToAll0(m, source);\n+                }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Module.java","additions":52,"deletions":16,"binary":false,"changes":68,"status":"modified"}]}