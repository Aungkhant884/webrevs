{"files":[{"patch":"@@ -541,5 +541,1 @@\n-static int literal_size(oop obj) {\n-  \/\/ NOTE: this would over-count if (pre-JDK8)\n-  \/\/ java_lang_Class::has_offset_field() is true and the String.value array is\n-  \/\/ shared by several Strings. However, starting from JDK8, the String.value\n-  \/\/ array is not shared anymore.\n+static size_t literal_size(oop obj) {\n@@ -548,4 +544,0 @@\n-  } else if (obj->klass() == vmClasses::String_klass()) {\n-    return (obj->size() + java_lang_String::value(obj)->size()) * HeapWordSize;\n-  } else {\n-    return obj->size();\n@@ -553,0 +545,9 @@\n+\n+  size_t word_size = obj->size();\n+\n+  if (obj->klass() == vmClasses::String_klass()) {\n+    \/\/ This may overcount if String.value arrays are shared.\n+    word_size += java_lang_String::value(obj)->size();\n+  }\n+\n+  return word_size * HeapWordSize;\n","filename":"src\/hotspot\/share\/classfile\/stringTable.cpp","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -78,1 +78,1 @@\n-template<typename T> static int literal_size(T) { return 0; }\n+template<typename T> static size_t literal_size(T) { return 0; }\n@@ -80,1 +80,1 @@\n-static int literal_size(Symbol *symbol) {\n+static size_t literal_size(Symbol *symbol) {\n@@ -84,1 +84,1 @@\n-static int literal_size(oop obj) {\n+static size_t literal_size(oop obj) {\n@@ -87,1 +87,5 @@\n-  } else if (obj->klass() == vmClasses::String_klass()) {\n+  }\n+\n+  size_t word_size = obj->size();\n+\n+  if (obj->klass() == vmClasses::String_klass()) {\n@@ -89,3 +93,1 @@\n-    return (obj->size() + java_lang_String::value(obj)->size()) * HeapWordSize;\n-  } else {\n-    return obj->size();\n+    word_size += java_lang_String::value(obj)->size();\n@@ -93,0 +95,2 @@\n+\n+  return word_size * HeapWordSize;\n@@ -95,1 +99,1 @@\n-static int literal_size(WeakHandle v) {\n+static size_t literal_size(WeakHandle v) {\n@@ -178,1 +182,1 @@\n-  int literal_bytes = 0;\n+  size_t literal_bytes = 0;\n","filename":"src\/hotspot\/share\/utilities\/hashtable.cpp","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"}]}