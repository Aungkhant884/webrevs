{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Azul, Inc. All rights reserved.\n+ * Copyright (c) 2021, 2022, Azul, Inc. All rights reserved.\n@@ -37,2 +37,5 @@\n-import java.io.*;\n-import java.net.*;\n+import java.io.DataInputStream;\n+import java.io.DataOutputStream;\n+import java.io.EOFException;\n+import java.io.IOException;\n+import java.net.Socket;\n@@ -46,2 +49,2 @@\n-            SSLServerSocketFactory sslserversocketfactory =\n-                    SSLContext.getDefault().getServerSocketFactory();\n+            SSLServerSocketFactory sslServerSocketFactory =\n+                    SSLContext.getDefault().getServerSocketFactory();;\n@@ -49,1 +52,1 @@\n-                    (SSLServerSocket) sslserversocketfactory.createServerSocket(0);\n+                    (SSLServerSocket) sslServerSocketFactory.createServerSocket(0);\n@@ -52,0 +55,1 @@\n+            Socket socket = null;\n@@ -53,1 +57,1 @@\n-                Socket socket = new Socket(sslServerSocket.getInetAddress(), sslServerSocket.getLocalPort());\n+                socket = new Socket(sslServerSocket.getInetAddress(), sslServerSocket.getLocalPort());\n@@ -60,2 +64,2 @@\n-                msg = in.readUTF();\n-            } catch(Exception e) {\n+                in.readUTF();\n+            } catch (Exception e) {\n@@ -63,0 +67,1 @@\n+                System.out.println(\"Client side exception: \" + e);\n@@ -64,0 +69,9 @@\n+            } finally {\n+                if (socket != null) {\n+                    try {\n+                        socket.close();\n+                    } catch (IOException ie) {\n+                        System.out.println(\"Ignore IOException at socket \" +\n+                                \"close on client side\");\n+                    }\n+                }\n@@ -67,1 +81,1 @@\n-            throw new RuntimeException(\"Fails to start SSL server\");\n+            throw new RuntimeException(\"Fails to start SSL server\", e);\n@@ -71,3 +85,2 @@\n-                !(clientException instanceof SocketException &&\n-                clientException.getMessage().equals(\"Connection reset\"))) {\n-                System.out.println(\"Test PASSED\");\n+                clientException instanceof EOFException) {\n+            System.out.println(\"Test PASSED\");\n@@ -82,2 +95,1 @@\n-        private SSLSocket sslSocket = null;\n-        Exception exception;\n+        Exception exception = null;\n@@ -89,0 +101,1 @@\n+        @Override\n@@ -90,0 +103,1 @@\n+            SSLSocket sslSocket = null;\n@@ -91,1 +105,0 @@\n-                SSLSocket sslsocket = null;\n@@ -93,3 +106,3 @@\n-                    sslsocket = (SSLSocket) sslServerSocket.accept();\n-                    DataInputStream in = new DataInputStream(sslsocket.getInputStream());\n-                    DataOutputStream out = new DataOutputStream(sslsocket.getOutputStream());\n+                    sslSocket = (SSLSocket) sslServerSocket.accept();\n+                    DataInputStream in = new DataInputStream(sslSocket.getInputStream());\n+                    DataOutputStream out = new DataOutputStream(sslSocket.getOutputStream());\n@@ -102,1 +115,1 @@\n-            } catch(Exception e) {\n+            } catch (Exception e) {\n@@ -104,0 +117,1 @@\n+                System.out.println(\"Server side exception: \" + e);\n@@ -105,0 +119,9 @@\n+            } finally {\n+                if (sslSocket != null) {\n+                    try {\n+                        sslSocket.close();\n+                    } catch (IOException ie) {\n+                        System.out.println(\"Ignore IOException at socket \" +\n+                                \"close on server side\");\n+                    }\n+                }\n","filename":"test\/jdk\/sun\/security\/ssl\/SSLSocketImpl\/SSLSocketReset.java","additions":43,"deletions":20,"binary":false,"changes":63,"status":"modified"}]}