{"files":[{"patch":"@@ -121,3 +121,0 @@\n-        dfltTargetMeta = new Name[] { names.PACKAGE, names.TYPE,\n-            names.FIELD, names.RECORD_COMPONENT, names.METHOD, names.CONSTRUCTOR,\n-            names.ANNOTATION_TYPE, names.LOCAL_VARIABLE, names.PARAMETER, names.MODULE };\n@@ -163,0 +160,1 @@\n+        allowModules = Feature.MODULES.allowedInSource(source);\n@@ -196,0 +194,4 @@\n+    \/** Are modules allowed\n+     *\/\n+    private final boolean allowModules;\n+\n@@ -3217,14 +3219,1 @@\n-            Set<Name> targets = new HashSet<>();\n-            targets.add(names.ANNOTATION_TYPE);\n-            targets.add(names.CONSTRUCTOR);\n-            targets.add(names.FIELD);\n-            if (allowRecords) {\n-                targets.add(names.RECORD_COMPONENT);\n-            }\n-            targets.add(names.LOCAL_VARIABLE);\n-            targets.add(names.METHOD);\n-            targets.add(names.PACKAGE);\n-            targets.add(names.PARAMETER);\n-            targets.add(names.TYPE);\n-\n-            defaultTargets = java.util.Collections.unmodifiableSet(targets);\n+            defaultTargets = Set.of(defaultTargetMetaInfo());\n@@ -3430,1 +3419,1 @@\n-    public final Name[] dfltTargetMeta;\n+    private Name[] dfltTargetMeta;\n@@ -3432,0 +3421,18 @@\n+        if (dfltTargetMeta == null) {\n+            ArrayList<Name> defaultTargets = new ArrayList<>();\n+            defaultTargets.add(names.PACKAGE);\n+            defaultTargets.add(names.TYPE);\n+            defaultTargets.add(names.FIELD);\n+            defaultTargets.add(names.METHOD);\n+            defaultTargets.add(names.CONSTRUCTOR);\n+            defaultTargets.add(names.ANNOTATION_TYPE);\n+            defaultTargets.add(names.LOCAL_VARIABLE);\n+            defaultTargets.add(names.PARAMETER);\n+            if (allowRecords) {\n+              defaultTargets.add(names.RECORD_COMPONENT);\n+            }\n+            if (allowModules) {\n+              defaultTargets.add(names.MODULE);\n+            }\n+            dfltTargetMeta = defaultTargets.toArray(new Name[0]);\n+        }\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Check.java","additions":25,"deletions":18,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -0,0 +1,41 @@\n+\/*\n+ * Copyright (c) 2021, Alphabet LLC. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @bug 8261088\n+ * @summary Repeatable annotations without Target cannot have containers that target module declarations\n+ * @compile T8261088.java\n+ *\/\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Repeatable;\n+import java.lang.annotation.Target;\n+\n+@Target(ElementType.MODULE)\n+@interface TC {\n+    T[] value() default {};\n+}\n+\n+@Repeatable(TC.class)\n+@interface T {}\n","filename":"test\/langtools\/tools\/javac\/annotations\/8261088\/T8261088.java","additions":41,"deletions":0,"binary":false,"changes":41,"status":"added"},{"patch":"@@ -28,1 +28,1 @@\n- * @bug 8006547\n+ * @bug 8006547 8261088\n@@ -45,1 +45,2 @@\n-    ElementType.RECORD_COMPONENT\n+    ElementType.RECORD_COMPONENT,\n+    ElementType.MODULE,\n","filename":"test\/langtools\/tools\/javac\/annotations\/repeatingAnnotations\/NoTargetOnContainer.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @bug 8006547\n+ * @bug 8006547 8261088\n@@ -47,1 +47,2 @@\n-    ElementType.RECORD_COMPONENT\n+    ElementType.RECORD_COMPONENT,\n+    ElementType.MODULE,\n","filename":"test\/langtools\/tools\/javac\/annotations\/repeatingAnnotations\/NoTargetOnContainer2.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}