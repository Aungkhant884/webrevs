{"files":[{"patch":"@@ -11087,1 +11087,0 @@\n-\n@@ -12903,0 +12902,1 @@\n+\n@@ -12974,1 +12974,0 @@\n-\n@@ -13693,1 +13692,0 @@\n-\n@@ -13698,3 +13696,3 @@\n-    __ cselw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n-             as_Register($src2$$reg),\n+    __ cselw($dst$$Register,\n+             $src1$$Register,\n+             $src2$$Register,\n@@ -13703,1 +13701,0 @@\n-\n@@ -13712,1 +13709,0 @@\n-\n@@ -13717,3 +13713,3 @@\n-    __ cselw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n-             as_Register($src2$$reg),\n+    __ cselw($dst$$Register,\n+             $src1$$Register,\n+             $src2$$Register,\n@@ -13722,1 +13718,0 @@\n-\n@@ -13731,1 +13726,0 @@\n-\n@@ -13736,2 +13730,2 @@\n-    __ cselw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ cselw($dst$$Register,\n+             $src1$$Register,\n@@ -13741,1 +13735,0 @@\n-\n@@ -13750,1 +13743,0 @@\n-\n@@ -13755,2 +13747,2 @@\n-    __ cselw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ cselw($dst$$Register,\n+             $src1$$Register,\n@@ -13760,1 +13752,0 @@\n-\n@@ -13769,1 +13760,0 @@\n-\n@@ -13774,2 +13764,2 @@\n-    __ csincw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ csincw($dst$$Register,\n+             $src1$$Register,\n@@ -13779,1 +13769,0 @@\n-\n@@ -13788,1 +13777,0 @@\n-\n@@ -13793,2 +13781,2 @@\n-    __ csincw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ csincw($dst$$Register,\n+             $src1$$Register,\n@@ -13798,1 +13786,0 @@\n-\n@@ -13807,1 +13794,0 @@\n-\n@@ -13812,2 +13798,2 @@\n-    __ csinvw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ csinvw($dst$$Register,\n+             $src1$$Register,\n@@ -13817,1 +13803,0 @@\n-\n@@ -13826,1 +13811,0 @@\n-\n@@ -13831,2 +13815,2 @@\n-    __ csinvw(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ csinvw($dst$$Register,\n+             $src1$$Register,\n@@ -13836,1 +13820,0 @@\n-\n@@ -13842,1 +13825,1 @@\n-instruct minI_reg_imm0(iRegINoSp dst, iRegI src, immI0 imm)\n+instruct minI_reg_imm0(iRegINoSp dst, iRegIorL2I src, immI0 imm)\n@@ -13855,1 +13838,1 @@\n-instruct minI_imm0_reg(iRegINoSp dst, immI0 imm, iRegI src)\n+instruct minI_imm0_reg(iRegINoSp dst, immI0 imm, iRegIorL2I src)\n@@ -13868,1 +13851,1 @@\n-instruct minI_reg_imm1(iRegINoSp dst, iRegI src, immI_1 imm)\n+instruct minI_reg_imm1(iRegINoSp dst, iRegIorL2I src, immI_1 imm)\n@@ -13881,1 +13864,1 @@\n-instruct minI_imm1_reg(iRegINoSp dst, immI_1 imm, iRegI src)\n+instruct minI_imm1_reg(iRegINoSp dst, immI_1 imm, iRegIorL2I src)\n@@ -13894,1 +13877,1 @@\n-instruct minI_reg_immM1(iRegINoSp dst, iRegI src, immI_M1 imm)\n+instruct minI_reg_immM1(iRegINoSp dst, iRegIorL2I src, immI_M1 imm)\n@@ -13907,1 +13890,1 @@\n-instruct minI_immM1_reg(iRegINoSp dst, immI_M1 imm, iRegI src)\n+instruct minI_immM1_reg(iRegINoSp dst, immI_M1 imm, iRegIorL2I src)\n@@ -13920,1 +13903,1 @@\n-instruct maxI_reg_imm0(iRegINoSp dst, iRegI src, immI0 imm)\n+instruct maxI_reg_imm0(iRegINoSp dst, iRegIorL2I src, immI0 imm)\n@@ -13933,1 +13916,1 @@\n-instruct maxI_imm0_reg(iRegINoSp dst, immI0 imm, iRegI src)\n+instruct maxI_imm0_reg(iRegINoSp dst, immI0 imm, iRegIorL2I src)\n@@ -13946,1 +13929,1 @@\n-instruct maxI_reg_imm1(iRegINoSp dst, iRegI src, immI_1 imm)\n+instruct maxI_reg_imm1(iRegINoSp dst, iRegIorL2I src, immI_1 imm)\n@@ -13959,1 +13942,1 @@\n-instruct maxI_imm1_reg(iRegINoSp dst, immI_1 imm, iRegI src)\n+instruct maxI_imm1_reg(iRegINoSp dst, immI_1 imm, iRegIorL2I src)\n@@ -13972,1 +13955,1 @@\n-instruct maxI_reg_immM1(iRegINoSp dst, iRegI src, immI_M1 imm)\n+instruct maxI_reg_immM1(iRegINoSp dst, iRegIorL2I src, immI_M1 imm)\n@@ -13985,1 +13968,1 @@\n-instruct maxI_immM1_reg(iRegINoSp dst, immI_M1 imm, iRegI src)\n+instruct maxI_immM1_reg(iRegINoSp dst, immI_M1 imm, iRegIorL2I src)\n@@ -16007,3 +15990,0 @@\n-instruct compI_reg_imm0(rFlagsReg cr, iRegI src1)\n-%{\n-  effect(DEF cr, USE src1);\n@@ -16011,0 +15991,3 @@\n+instruct compI_reg_imm0(rFlagsReg cr, iRegI src)\n+%{\n+  effect(DEF cr, USE src);\n@@ -16012,1 +15995,1 @@\n-  format %{ \"cmpw $src1, 0\" %}\n+  format %{ \"cmpw $src, 0\" %}\n@@ -16015,1 +15998,1 @@\n-    __ cmpw(as_Register($src1$$reg), 0);\n+    __ cmpw($src$$Register, 0);\n@@ -16017,1 +16000,0 @@\n-\n@@ -16021,1 +16003,1 @@\n-instruct minI_reg_reg(iRegINoSp dst, iRegI src1, iRegI src2)\n+instruct minI_reg_reg(iRegINoSp dst, iRegIorL2I src1, iRegIorL2I src2)\n@@ -16031,1 +16013,0 @@\n-\n@@ -16034,3 +16015,1 @@\n-\/\/ FROM HERE\n-\n-instruct maxI_reg_reg(iRegINoSp dst, iRegI src1, iRegI src2)\n+instruct maxI_reg_reg(iRegINoSp dst, iRegIorL2I src1, iRegIorL2I src2)\n@@ -16040,0 +16019,1 @@\n+\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64.ad","additions":39,"deletions":59,"binary":false,"changes":98,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-dnl\n+\n@@ -33,2 +33,1 @@\n-dnl\n-define(`ORL2I', `ifelse($1,I,orL2I)')\n+define(`ORL2I', `ifelse($1,I,orL2I)')dnl\n@@ -195,1 +194,1 @@\n-define(`EXTEND', `($2$1 (LShift$1 $3 $4) $5)') dnl\n+define(`EXTEND', `($2$1 (LShift$1 $3 $4) $5)')dnl\n@@ -218,1 +217,1 @@\n-')\n+')dnl\n@@ -342,1 +341,1 @@\n-\/\/ Rotations dnl\n+\/\/ Rotations\n@@ -550,1 +549,0 @@\n-\n@@ -555,3 +553,3 @@\n-    __ $2(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n-             as_Register($src2$$reg),\n+    __ $2($dst$$Register,\n+             $src1$$Register,\n+             $src2$$Register,\n@@ -560,1 +558,0 @@\n-\n@@ -572,1 +569,0 @@\n-\n@@ -577,2 +573,2 @@\n-    __ $3(as_Register($dst$$reg),\n-             as_Register($src1$$reg),\n+    __ $3($dst$$Register,\n+             $src1$$Register,\n@@ -582,1 +578,0 @@\n-\n@@ -596,2 +591,2 @@\n-instruct downcase($1)$2_reg_imm$4(iReg$2NoSp dst, iReg$2 src, imm$2$3$4 imm),\n-instruct downcase($1)$2_imm$4_reg(iReg$2NoSp dst, imm$2$3$4 imm, iReg$2 src))\n+instruct downcase($1)$2_reg_imm$4(iReg$2NoSp dst, iReg$2`'ORL2I($2) src, imm$2$3$4 imm),\n+instruct downcase($1)$2_imm$4_reg(iReg$2NoSp dst, imm$2$3$4 imm, iReg$2`'ORL2I($2) src))\n","filename":"src\/hotspot\/cpu\/aarch64\/aarch64_ad.m4","additions":12,"deletions":17,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -56,0 +56,1 @@\n+    public static long im3l = Integer.MIN_VALUE * 3L;\n@@ -58,1 +59,3 @@\n-        assertEQ(std.applyAsInt(0), alt.applyAsInt(0), \"Basic check\");\n+        for (int a : intCases) {\n+            assertEQ(std.applyAsInt(a), alt.applyAsInt(a), String.format(\"Failed on %d\", a));\n+        }\n@@ -61,1 +64,1 @@\n-        assertTrue(wb.isMethodCompiled(method), \"Should be compiled\");\n+        assertTrue(wb.isMethodCompiled(method));\n@@ -68,1 +71,5 @@\n-        assertEQ(std.applyAsInt(0, 0), alt.applyAsInt(0, 0), \"Basic check\");\n+        for (int a : intCases) {\n+            for (int b : intCases) {\n+                assertEQ(std.applyAsInt(a, b), alt.applyAsInt(a, b), String.format(\"Failed on %d, %d\", a, b));\n+            }\n+        }\n@@ -71,1 +78,1 @@\n-        assertTrue(wb.isMethodCompiled(method), \"Should be compiled\");\n+        assertTrue(wb.isMethodCompiled(method));\n@@ -79,0 +86,12 @@\n+    static int maxL2I(long a, int b) {\n+        return Math.max((int) a, b);\n+    }\n+\n+    static void testL2I() throws NoSuchMethodException {\n+        assertEQ(0, maxL2I(im3l, 0));\n+        var method = TestMinMaxIntrinsics.class.getDeclaredMethod(\"maxL2I\", long.class, int.class);\n+        wb.enqueueMethodForCompilation(method, COMP_LEVEL_FULL_OPTIMIZATION);\n+        assertTrue(wb.isMethodCompiled(method));\n+        assertEQ(0, maxL2I(im3l, 0));\n+    }\n+\n@@ -84,3 +103,3 @@\n-        test(a -> (a >= 0) ? a : 0, a -> Math.max(a, 0));\n-        test(a -> (a >= 1) ? a : 1, a -> Math.max(a, 1));\n-        test(a -> (a >= -1) ? a : -1, a -> Math.max(a, -1));\n+        test(a -> (0 >= a) ? 0 : a, a -> Math.max(0, a));\n+        test(a -> (1 >= a) ? 1 : a, a -> Math.max(1, a));\n+        test(a -> (-1 >= a) ? -1 : a, a -> Math.max(-1, a));\n@@ -90,0 +109,2 @@\n+\n+        testL2I();\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/math\/TestMinMaxIntrinsics.java","additions":28,"deletions":7,"binary":false,"changes":35,"status":"modified"}]}