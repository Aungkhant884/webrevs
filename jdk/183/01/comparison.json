{"files":[{"patch":"@@ -154,1 +154,1 @@\n-  _long_term_pause_time_ratio = _recent_gc_times_ms->sum() \/ long_interval_ms;\n+  _long_term_pause_time_ratio = (_recent_gc_times_ms->sum() + pause_time_ms) \/ long_interval_ms;\n@@ -326,1 +326,0 @@\n-  _prev_collection_pause_end_ms = end_time_sec * 1000.0;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Analytics.cpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -117,0 +117,4 @@\n+  void set_prev_collection_pause_end_ms(double ms) {\n+    _prev_collection_pause_end_ms = ms;\n+  }\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Analytics.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -561,4 +561,0 @@\n-  double full_gc_time_sec = end_sec - _full_collection_start_sec;\n-  double full_gc_time_ms = full_gc_time_sec * 1000.0;\n-\n-  _analytics->update_recent_gc_times(end_sec, full_gc_time_ms);\n@@ -680,1 +676,0 @@\n-  _analytics->append_prev_collection_pause_end_ms(elapsed_time_ms);\n@@ -756,0 +751,1 @@\n+  double start_time_sec = phase_times()->cur_collection_start_sec();\n@@ -761,1 +757,1 @@\n-  record_pause(this_pause, end_time_sec - pause_time_ms \/ 1000.0, end_time_sec);\n+  record_pause(this_pause, start_time_sec, end_time_sec);\n@@ -769,1 +765,1 @@\n-  double app_time_ms = (phase_times()->cur_collection_start_sec() * 1000.0 - _analytics->prev_collection_pause_end_ms());\n+  double app_time_ms = (start_time_sec * 1000.0 - _analytics->prev_collection_pause_end_ms());\n@@ -789,3 +785,0 @@\n-\n-    _analytics->compute_pause_time_ratios(end_time_sec, pause_time_ms);\n-    _analytics->update_recent_gc_times(end_time_sec, pause_time_ms);\n@@ -1241,1 +1234,0 @@\n-  _analytics->append_prev_collection_pause_end_ms(elapsed_time_ms);\n@@ -1315,0 +1307,14 @@\n+void G1Policy::update_gc_pause_time_ratios(PauseKind kind, double start_time_sec, double end_time_sec){\n+\n+  double pause_time_sec = end_time_sec - start_time_sec;\n+  double pause_time_ms = pause_time_sec * 1000.0;\n+\n+  _analytics->compute_pause_time_ratios(end_time_sec, pause_time_ms);\n+  _analytics->update_recent_gc_times(end_time_sec, pause_time_ms);\n+  if (kind == Cleanup || kind == Remark) {\n+    _analytics->append_prev_collection_pause_end_ms(pause_time_ms);\n+  } else {\n+    _analytics->set_prev_collection_pause_end_ms(end_time_sec*1000*0);\n+  }\n+}\n+\n@@ -1320,0 +1326,4 @@\n+  bool update_stats = !_g1h->evacuation_failed();\n+  if (update_stats){\n+    update_gc_pause_time_ratios(kind, start, end);\n+  }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":21,"deletions":11,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -442,0 +442,2 @@\n+  void update_gc_pause_time_ratios(PauseKind kind, double start_sec, double end_sec);\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}