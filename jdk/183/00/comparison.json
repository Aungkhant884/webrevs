{"files":[{"patch":"@@ -101,2 +101,3 @@\n-  _recent_prev_end_times_for_all_gcs_sec->add(os::elapsedTime());\n-  _prev_collection_pause_end_ms = os::elapsedTime() * 1000.0;\n+  double time_sec = os::elapsedTime();\n+  _recent_prev_end_times_for_all_gcs_sec->add(time_sec);\n+  _prev_collection_pause_end_ms = time_sec * 1000.0;\n@@ -154,1 +155,1 @@\n-  _long_term_pause_time_ratio = _recent_gc_times_ms->sum() \/ long_interval_ms;\n+  _long_term_pause_time_ratio = (_recent_gc_times_ms->sum() + pause_time_ms) \/ long_interval_ms;\n@@ -326,1 +327,0 @@\n-  _prev_collection_pause_end_ms = end_time_sec * 1000.0;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Analytics.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -117,0 +117,4 @@\n+  void set_prev_collection_pause_end_ms(double ms) {\n+    _prev_collection_pause_end_ms = ms;\n+  }\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Analytics.hpp","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -532,1 +532,1 @@\n-    size_t rs_length_prediction = rs_length * 1100 \/ 1000;\n+    size_t rs_length_prediction = rs_length * 110 \/ 100;\n@@ -561,4 +561,0 @@\n-  double full_gc_time_sec = end_sec - _full_collection_start_sec;\n-  double full_gc_time_ms = full_gc_time_sec * 1000.0;\n-\n-  _analytics->update_recent_gc_times(end_sec, full_gc_time_ms);\n@@ -667,1 +663,1 @@\n-void G1Policy::record_concurrent_mark_init_end(double mark_init_elapsed_time_ms) {\n+void G1Policy::record_concurrent_mark_init_end() {\n@@ -680,1 +676,0 @@\n-  _analytics->append_prev_collection_pause_end_ms(elapsed_time_ms);\n@@ -756,0 +751,1 @@\n+  double start_time_sec = phase_times()->cur_collection_start_sec();\n@@ -761,1 +757,1 @@\n-  record_pause(this_pause, end_time_sec - pause_time_ms \/ 1000.0, end_time_sec);\n+  record_pause(this_pause, start_time_sec, end_time_sec);\n@@ -764,1 +760,1 @@\n-    record_concurrent_mark_init_end(0.0);\n+    record_concurrent_mark_init_end();\n@@ -769,1 +765,1 @@\n-  double app_time_ms = (phase_times()->cur_collection_start_sec() * 1000.0 - _analytics->prev_collection_pause_end_ms());\n+  double app_time_ms = (start_time_sec * 1000.0 - _analytics->prev_collection_pause_end_ms());\n@@ -789,3 +785,0 @@\n-\n-    _analytics->compute_pause_time_ratios(end_time_sec, pause_time_ms);\n-    _analytics->update_recent_gc_times(end_time_sec, pause_time_ms);\n@@ -1241,1 +1234,0 @@\n-  _analytics->append_prev_collection_pause_end_ms(elapsed_time_ms);\n@@ -1315,0 +1307,14 @@\n+void G1Policy::update_pause_time_stats(PauseKind kind, double start_time_sec, double end_time_sec){\n+\n+  double pause_time_sec = end_time_sec - start_time_sec;\n+  double pause_time_ms = pause_time_sec * 1000.0;\n+\n+  _analytics->compute_pause_time_ratios(end_time_sec, pause_time_ms);\n+  _analytics->update_recent_gc_times(end_time_sec, pause_time_ms);\n+  if (kind == Cleanup || kind == Remark) {\n+    _analytics->append_prev_collection_pause_end_ms(pause_time_ms);\n+  } else {\n+    _analytics->set_prev_collection_pause_end_ms(end_time_sec*1000*0);\n+  }\n+}\n+\n@@ -1320,0 +1326,4 @@\n+  bool update_stats = !_g1h->evacuation_failed();\n+  if (update_stats){\n+    update_pause_time_stats(kind, start, end);\n+  }\n@@ -1398,1 +1408,1 @@\n-  size_t result = region_num \/ gc_num;\n+\n@@ -1400,3 +1410,1 @@\n-  if (result * gc_num < region_num) {\n-    result += 1;\n-  }\n+  size_t result = (region_num + gc_num -1) \/ gc_num;\n@@ -1415,1 +1423,1 @@\n-  size_t result = region_num * perc \/ 100;\n+\n@@ -1417,3 +1425,1 @@\n-  if (100 * result < region_num * perc) {\n-    result += 1;\n-  }\n+  size_t result = ((region_num * perc) + 99) \/ 100;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":28,"deletions":22,"binary":false,"changes":50,"status":"modified"},{"patch":"@@ -331,1 +331,1 @@\n-  void record_concurrent_mark_init_end(double mark_init_elapsed_time_ms);\n+  void record_concurrent_mark_init_end();\n@@ -442,0 +442,2 @@\n+  void update_pause_time_stats(PauseKind kind, double start_sec, double end_sec);\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}