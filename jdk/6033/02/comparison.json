{"files":[{"patch":"@@ -48,24 +48,22 @@\n-  _inline_ptr_bits_per_card(HeapRegion::LogCardsPerRegion) {\n-\n-  \/\/ Array of Cards card set container size calculation\n-  _num_cards_in_array = G1RemSetArrayOfCardsEntries;\n-\n-  \/\/ Full card set container size calculation\n-  _max_cards_in_card_set = (uint)HeapRegion::CardsPerRegion;\n-  assert(is_power_of_2(_max_cards_in_card_set),\n-        \"max_cards_in_card_set must be a power of 2: %u\", _max_cards_in_card_set);\n-  _cards_in_howl_threshold = _max_cards_in_card_set * (double)G1RemSetCoarsenHowlToFullPercent \/ 100;\n-\n-  \/\/ Howl card set container size calculation.\n-  _num_buckets_in_howl = G1RemSetHowlNumBuckets;\n-\n-  \/\/ Howl Bitmap card set container size calculation.\n-  _num_cards_in_howl_bitmap = G1CardSetHowl::bitmap_size(_max_cards_in_card_set, _num_buckets_in_howl);\n-  _log2_num_cards_in_howl_bitmap = log2i_exact(_num_cards_in_howl_bitmap);\n-  _cards_in_howl_bitmap_threshold = _num_cards_in_howl_bitmap * (double)G1RemSetCoarsenHowlBitmapToHowlFullPercent \/ 100;\n-  _bitmap_hash_mask = ~(~(0) << _log2_num_cards_in_howl_bitmap);\n-\n-  init_card_set_alloc_options();\n-\n-  log_configuration();\n-}\n+  G1CardSetConfiguration(HeapRegion::LogCardsPerRegion,                             \/* inline_ptr_bits_per_card *\/\n+                         G1RemSetArrayOfCardsEntries,                               \/* num_cards_in_array *\/\n+                         (double)G1RemSetCoarsenHowlBitmapToHowlFullPercent \/ 100,  \/* cards_in_bitmap_threshold_percent *\/\n+                         G1RemSetHowlNumBuckets,                                    \/* num_buckets_in_howl *\/\n+                         (double)G1RemSetCoarsenHowlToFullPercent \/ 100,            \/* cards_in_howl_threshold_percent *\/\n+                         (uint)HeapRegion::CardsPerRegion)                          \/* max_cards_in_cardset *\/\n+                         { }\n+\n+G1CardSetConfiguration::G1CardSetConfiguration(uint num_cards_in_array,\n+                                               double cards_in_bitmap_threshold_percent,\n+                                               uint max_buckets_in_howl,\n+                                               double cards_in_howl_threshold_percent,\n+                                               uint max_cards_in_card_set) :\n+  G1CardSetConfiguration(log2i_exact(max_cards_in_card_set),                   \/* inline_ptr_bits_per_card *\/\n+                         num_cards_in_array,                                   \/* num_cards_in_array *\/\n+                         cards_in_bitmap_threshold_percent,                    \/* cards_in_bitmap_threshold_percent *\/\n+                         G1CardSetHowl::num_buckets(max_cards_in_card_set,     \/* num_buckets_in_howl *\/\n+                                                    num_cards_in_array,\n+                                                    max_buckets_in_howl),\n+                         cards_in_howl_threshold_percent,                      \/* cards_in_howl_threshold_percent *\/\n+                         max_cards_in_card_set)                                \/* max_cards_in_cardset *\/\n+                         { }\n@@ -75,4 +73,4 @@\n-                                               double cards_in_bitmap_threshold,\n-                                               uint max_buckets_in_howl,\n-                                               double cards_in_howl_threshold,\n-                                               uint max_cards_in_cardset) :\n+                                               double cards_in_bitmap_threshold_percent,\n+                                               uint num_buckets_in_howl,\n+                                               double cards_in_howl_threshold_percent,\n+                                               uint max_cards_in_card_set) :\n@@ -81,2 +79,7 @@\n-  _max_cards_in_card_set(max_cards_in_cardset),\n-  _cards_in_howl_threshold(max_cards_in_cardset * cards_in_howl_threshold) {\n+  _num_buckets_in_howl(num_buckets_in_howl),\n+  _max_cards_in_card_set(max_cards_in_card_set),\n+  _cards_in_howl_threshold(max_cards_in_card_set * cards_in_howl_threshold_percent),\n+  _num_cards_in_howl_bitmap(G1CardSetHowl::bitmap_size(_max_cards_in_card_set, _num_buckets_in_howl)),\n+  _cards_in_howl_bitmap_threshold(_num_cards_in_howl_bitmap * cards_in_bitmap_threshold_percent),\n+  _log2_num_cards_in_howl_bitmap(log2i_exact(_num_cards_in_howl_bitmap)),\n+  _bitmap_hash_mask(~(~(0) << _log2_num_cards_in_howl_bitmap)) {\n@@ -85,8 +88,1 @@\n-        \"max_cards_in_card_set must be a power of 2: %u\", _max_cards_in_card_set);\n-\n-  _num_buckets_in_howl = G1CardSetHowl::num_buckets(_max_cards_in_card_set, _num_cards_in_array, max_buckets_in_howl);\n-\n-  _num_cards_in_howl_bitmap = G1CardSetHowl::bitmap_size(_max_cards_in_card_set, _num_buckets_in_howl);\n-  _cards_in_howl_bitmap_threshold = _num_cards_in_howl_bitmap * cards_in_bitmap_threshold;\n-  _log2_num_cards_in_howl_bitmap = log2i_exact(_num_cards_in_howl_bitmap);\n-  _bitmap_hash_mask = ~(~(0) << _log2_num_cards_in_howl_bitmap);\n+         \"max_cards_in_card_set must be a power of 2: %u\", _max_cards_in_card_set);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.cpp","additions":34,"deletions":38,"binary":false,"changes":72,"status":"modified"},{"patch":"@@ -54,1 +54,0 @@\n-  uint _num_cards_in_howl_bitmap;\n@@ -58,0 +57,1 @@\n+  uint _num_cards_in_howl_bitmap;\n@@ -64,0 +64,6 @@\n+  G1CardSetConfiguration(uint inline_ptr_bits_per_card,\n+                         uint num_cards_in_array,\n+                         double cards_in_bitmap_threshold_percent,\n+                         uint num_buckets_in_howl,\n+                         double cards_in_howl_threshold_percent,\n+                         uint max_cards_in_card_set);\n@@ -72,3 +78,3 @@\n-  G1CardSetConfiguration(uint inline_ptr_bits_per_card,\n-                         uint num_cards_in_array,\n-                         double cards_in_bitmap_threshold,\n+  \/\/ Only for test\n+  G1CardSetConfiguration(uint num_cards_in_array,\n+                         double cards_in_bitmap_threshold_percent,\n@@ -76,2 +82,2 @@\n-                         double cards_in_howl_threshold,\n-                         uint max_cards_in_cardset);\n+                         double cards_in_howl_threshold_percent,\n+                         uint max_cards_in_card_set);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.hpp","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -209,1 +209,5 @@\n-  G1CardSetConfiguration config(log2i_exact(CardsPerRegion), 28, BitmapCoarsenThreshold, 8, FullCardSetThreshold, CardsPerRegion);\n+  G1CardSetConfiguration config(28,\n+                                BitmapCoarsenThreshold,\n+                                8,\n+                                FullCardSetThreshold,\n+                                CardsPerRegion);\n@@ -423,1 +427,5 @@\n-  G1CardSetConfiguration config(log2i_exact(CardsPerRegion), 120, BitmapCoarsenThreshold, 8, FullCardSetThreshold, CardsPerRegion);\n+  G1CardSetConfiguration config(120,\n+                                BitmapCoarsenThreshold,\n+                                8,\n+                                FullCardSetThreshold,\n+                                CardsPerRegion);\n","filename":"test\/hotspot\/gtest\/gc\/g1\/test_g1CardSet.cpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"}]}