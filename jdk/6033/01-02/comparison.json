{"files":[{"patch":"@@ -47,8 +47,8 @@\n-G1CardSetConfiguration::G1CardSetConfiguration() {\n-  init(HeapRegion::LogCardsPerRegion,\n-       G1RemSetArrayOfCardsEntries,\n-       (double)G1RemSetCoarsenHowlBitmapToHowlFullPercent \/ 100,\n-       0,  \/\/ max_buckets_in_howl\n-       (double)G1RemSetCoarsenHowlToFullPercent \/ 100,\n-       (uint)HeapRegion::CardsPerRegion);\n-}\n+G1CardSetConfiguration::G1CardSetConfiguration() :\n+  G1CardSetConfiguration(HeapRegion::LogCardsPerRegion,                             \/* inline_ptr_bits_per_card *\/\n+                         G1RemSetArrayOfCardsEntries,                               \/* num_cards_in_array *\/\n+                         (double)G1RemSetCoarsenHowlBitmapToHowlFullPercent \/ 100,  \/* cards_in_bitmap_threshold_percent *\/\n+                         G1RemSetHowlNumBuckets,                                    \/* num_buckets_in_howl *\/\n+                         (double)G1RemSetCoarsenHowlToFullPercent \/ 100,            \/* cards_in_howl_threshold_percent *\/\n+                         (uint)HeapRegion::CardsPerRegion)                          \/* max_cards_in_cardset *\/\n+                         { }\n@@ -56,2 +56,1 @@\n-G1CardSetConfiguration::G1CardSetConfiguration(uint inline_ptr_bits_per_card,\n-                                               uint num_cards_in_array,\n+G1CardSetConfiguration::G1CardSetConfiguration(uint num_cards_in_array,\n@@ -61,8 +60,10 @@\n-                                               uint max_cards_in_cardset) {\n-  init(inline_ptr_bits_per_card,\n-       num_cards_in_array,\n-       cards_in_bitmap_threshold_percent,\n-       max_buckets_in_howl,\n-       cards_in_howl_threshold_percent,\n-       max_cards_in_cardset);\n-}\n+                                               uint max_cards_in_card_set) :\n+  G1CardSetConfiguration(log2i_exact(max_cards_in_card_set),                   \/* inline_ptr_bits_per_card *\/\n+                         num_cards_in_array,                                   \/* num_cards_in_array *\/\n+                         cards_in_bitmap_threshold_percent,                    \/* cards_in_bitmap_threshold_percent *\/\n+                         G1CardSetHowl::num_buckets(max_cards_in_card_set,     \/* num_buckets_in_howl *\/\n+                                                    num_cards_in_array,\n+                                                    max_buckets_in_howl),\n+                         cards_in_howl_threshold_percent,                      \/* cards_in_howl_threshold_percent *\/\n+                         max_cards_in_card_set)                                \/* max_cards_in_cardset *\/\n+                         { }\n@@ -70,3 +71,15 @@\n-G1CardSetConfiguration::~G1CardSetConfiguration() {\n-  FREE_C_HEAP_ARRAY(size_t, _card_set_alloc_options);\n-}\n+G1CardSetConfiguration::G1CardSetConfiguration(uint inline_ptr_bits_per_card,\n+                                               uint num_cards_in_array,\n+                                               double cards_in_bitmap_threshold_percent,\n+                                               uint num_buckets_in_howl,\n+                                               double cards_in_howl_threshold_percent,\n+                                               uint max_cards_in_card_set) :\n+  _inline_ptr_bits_per_card(inline_ptr_bits_per_card),\n+  _num_cards_in_array(num_cards_in_array),\n+  _num_buckets_in_howl(num_buckets_in_howl),\n+  _max_cards_in_card_set(max_cards_in_card_set),\n+  _cards_in_howl_threshold(max_cards_in_card_set * cards_in_howl_threshold_percent),\n+  _num_cards_in_howl_bitmap(G1CardSetHowl::bitmap_size(_max_cards_in_card_set, _num_buckets_in_howl)),\n+  _cards_in_howl_bitmap_threshold(_num_cards_in_howl_bitmap * cards_in_bitmap_threshold_percent),\n+  _log2_num_cards_in_howl_bitmap(log2i_exact(_num_cards_in_howl_bitmap)),\n+  _bitmap_hash_mask(~(~(0) << _log2_num_cards_in_howl_bitmap)) {\n@@ -74,9 +87,0 @@\n-void G1CardSetConfiguration::init(uint inline_ptr_bits_per_card,\n-                                  uint num_cards_in_array,\n-                                  double cards_in_bitmap_threshold_percent,\n-                                  uint max_buckets_in_howl,\n-                                  double cards_in_howl_threshold_percent,\n-                                  uint max_cards_in_cardset) {\n-  _inline_ptr_bits_per_card = inline_ptr_bits_per_card;\n-  _num_cards_in_array = num_cards_in_array;\n-  _max_cards_in_card_set = max_cards_in_cardset;\n@@ -85,12 +89,0 @@\n-  _cards_in_howl_threshold = max_cards_in_cardset * cards_in_howl_threshold_percent;\n-\n-  if (max_buckets_in_howl == 0) {\n-    _num_buckets_in_howl = G1RemSetHowlNumBuckets;\n-  } else {\n-    _num_buckets_in_howl = G1CardSetHowl::num_buckets(_max_cards_in_card_set, _num_cards_in_array, max_buckets_in_howl);\n-  }\n-\n-  _num_cards_in_howl_bitmap = G1CardSetHowl::bitmap_size(_max_cards_in_card_set, _num_buckets_in_howl);\n-  _cards_in_howl_bitmap_threshold = _num_cards_in_howl_bitmap * cards_in_bitmap_threshold_percent;\n-  _log2_num_cards_in_howl_bitmap = log2i_exact(_num_cards_in_howl_bitmap);\n-  _bitmap_hash_mask = ~(~(0) << _log2_num_cards_in_howl_bitmap);\n@@ -103,0 +95,4 @@\n+G1CardSetConfiguration::~G1CardSetConfiguration() {\n+  FREE_C_HEAP_ARRAY(size_t, _card_set_alloc_options);\n+}\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.cpp","additions":38,"deletions":42,"binary":false,"changes":80,"status":"modified"},{"patch":"@@ -54,1 +54,0 @@\n-  uint _num_cards_in_howl_bitmap;\n@@ -58,0 +57,1 @@\n+  uint _num_cards_in_howl_bitmap;\n@@ -64,0 +64,6 @@\n+  G1CardSetConfiguration(uint inline_ptr_bits_per_card,\n+                         uint num_cards_in_array,\n+                         double cards_in_bitmap_threshold_percent,\n+                         uint num_buckets_in_howl,\n+                         double cards_in_howl_threshold_percent,\n+                         uint max_cards_in_card_set);\n@@ -65,6 +71,0 @@\n-  void init(uint inline_ptr_bits_per_card,\n-            uint num_cards_in_array,\n-            double cards_in_bitmap_threshold_percent,\n-            uint max_buckets_in_howl,\n-            double cards_in_howl_threshold_percent,\n-            uint max_cards_in_cardset);\n@@ -78,2 +78,2 @@\n-  G1CardSetConfiguration(uint inline_ptr_bits_per_card,\n-                         uint num_cards_in_array,\n+  \/\/ Only for test\n+  G1CardSetConfiguration(uint num_cards_in_array,\n@@ -83,1 +83,1 @@\n-                         uint max_cards_in_cardset);\n+                         uint max_cards_in_card_set);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CardSet.hpp","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -209,1 +209,5 @@\n-  G1CardSetConfiguration config(log2i_exact(CardsPerRegion), 28, BitmapCoarsenThreshold, 8, FullCardSetThreshold, CardsPerRegion);\n+  G1CardSetConfiguration config(28,\n+                                BitmapCoarsenThreshold,\n+                                8,\n+                                FullCardSetThreshold,\n+                                CardsPerRegion);\n@@ -423,1 +427,5 @@\n-  G1CardSetConfiguration config(log2i_exact(CardsPerRegion), 120, BitmapCoarsenThreshold, 8, FullCardSetThreshold, CardsPerRegion);\n+  G1CardSetConfiguration config(120,\n+                                BitmapCoarsenThreshold,\n+                                8,\n+                                FullCardSetThreshold,\n+                                CardsPerRegion);\n","filename":"test\/hotspot\/gtest\/gc\/g1\/test_g1CardSet.cpp","additions":10,"deletions":2,"binary":false,"changes":12,"status":"modified"}]}