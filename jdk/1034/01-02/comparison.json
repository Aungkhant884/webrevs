{"files":[{"patch":"@@ -443,1 +443,1 @@\n-                         JVM_handle_bsd_signal\n+JVM_handle_bsd_signal\n@@ -445,1 +445,1 @@\n-                         JVM_handle_aix_signal\n+JVM_handle_aix_signal\n@@ -447,1 +447,1 @@\n-                         JVM_handle_linux_signal\n+JVM_handle_linux_signal\n@@ -451,3 +451,1 @@\n-                                                  (int signo, siginfo_t* siginfo,\n-                                                   void* ucontext,\n-                                                   int abort_if_unrecognized)\n+  (int signo, siginfo_t* siginfo, void* ucontext, int abort_if_unrecognized)\n@@ -455,1 +453,26 @@\n-  return javaSignalHandler_inner(signo, siginfo, ucontext, abort_if_unrecognized);\n+  int rc = 0;\n+  assert(AllowUserSignalHandlers, \"Only valid to call for -XX:+AllowUserSignalHandlers.\");\n+  \/\/ We only allow those signals which had been in the original \"contract\" (see comment above).\n+  switch (signo) {\n+    \/\/  Of those signals, we only pass those to the handler which it would\n+    \/\/  have gotten anyway had it been properly installed:\n+    case SIGSEGV:\n+    case SIGILL:\n+    case SIGBUS:\n+    case SIGFPE:\n+    case SIGPIPE:\n+    case SIGXFSZ:\n+    PPC64_ONLY(case SIGTRAP:)\n+      rc = javaSignalHandler_inner(signo, siginfo, ucontext, abort_if_unrecognized);\n+      break;\n+    \/\/ Ignore these to keep backward compatibility:\n+    case SIGQUIT:\n+    case SIGUSR1:\n+      rc = 0;\n+      break;\n+    \/\/ Invalid according to contract:\n+    default:\n+      ShouldNotReachHere();\n+      rc = 0;\n+  }\n+  return rc;\n@@ -458,1 +481,0 @@\n-\n@@ -581,1 +603,1 @@\n-      if (sig == SIGILL || sig == SIGFPE) {\n+      if (S390_ONLY(sig == SIGILL || sig == SIGFPE) NOT_S390(false)) {\n@@ -858,3 +880,1 @@\n-#if defined(PPC64)\n-  do_signal_check(SIGTRAP);\n-#endif\n+  PPC64_ONLY(do_signal_check(SIGTRAP);)\n@@ -1255,3 +1275,1 @@\n-#if defined(PPC64) || defined(AIX)\n-  set_signal_handler(SIGTRAP, true);\n-#endif\n+  PPC64_ONLY(set_signal_handler(SIGTRAP, true);)\n@@ -1435,3 +1453,1 @@\n-  #if defined(PPC64) || defined(AIX)\n-    sigaddset(&unblocked_sigs, SIGTRAP);\n-  #endif\n+  PPC64_ONLY(sigaddset(&unblocked_sigs, SIGTRAP);)\n","filename":"src\/hotspot\/os\/posix\/signals_posix.cpp","additions":34,"deletions":18,"binary":false,"changes":52,"status":"modified"},{"patch":"@@ -761,1 +761,1 @@\n-          \"Do not complain if the application installs signal handlers \"    \\\n+          \"Application will install primary signal handlers for the JVM \"   \\\n","filename":"src\/hotspot\/share\/runtime\/globals.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}