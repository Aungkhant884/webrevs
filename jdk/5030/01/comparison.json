{"files":[{"patch":"@@ -251,5 +251,7 @@\n-    result = survivor_gc_alloc_region(node_index)->attempt_allocation_locked(min_word_size,\n-                                                                             desired_word_size,\n-                                                                             actual_word_size);\n-    if (result == NULL) {\n-      set_survivor_full();\n+    if (!survivor_is_full()) {\n+      result = survivor_gc_alloc_region(node_index)->attempt_allocation_locked(min_word_size,\n+                                                                              desired_word_size,\n+                                                                              actual_word_size);\n+      if (result == NULL) {\n+        set_survivor_full();\n+      }\n@@ -275,5 +277,7 @@\n-    result = old_gc_alloc_region()->attempt_allocation_locked(min_word_size,\n-                                                              desired_word_size,\n-                                                              actual_word_size);\n-    if (result == NULL) {\n-      set_old_full();\n+    if (!old_is_full()) {\n+      result = old_gc_alloc_region()->attempt_allocation_locked(min_word_size,\n+                                                                desired_word_size,\n+                                                                actual_word_size);\n+      if (result == NULL) {\n+        set_old_full();\n+      }\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Allocator.cpp","additions":14,"deletions":10,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -167,1 +167,1 @@\n-  if (res == NULL && do_expand && _expand_heap_after_alloc_failure) {\n+  if (res == NULL && do_expand) {\n@@ -170,2 +170,1 @@\n-    \/\/ safepoint. If this assumption changes we might have to\n-    \/\/ reconsider the use of _expand_heap_after_alloc_failure.\n+    \/\/ safepoint.\n@@ -186,2 +185,0 @@\n-    } else {\n-      _expand_heap_after_alloc_failure = false;\n@@ -1459,1 +1456,0 @@\n-  _expand_heap_after_alloc_failure(true),\n@@ -3521,1 +3517,0 @@\n-  _expand_heap_after_alloc_failure = true;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":2,"deletions":7,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -243,8 +243,0 @@\n-  \/\/ It specifies whether we should attempt to expand the heap after a\n-  \/\/ region allocation failure. If heap expansion fails we set this to\n-  \/\/ false so that we don't re-attempt the heap expansion (it's likely\n-  \/\/ that subsequent expansion attempts will also fail if one fails).\n-  \/\/ Currently, it is only consulted during GC and it's reset at the\n-  \/\/ start of each GC.\n-  bool _expand_heap_after_alloc_failure;\n-\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.hpp","additions":0,"deletions":8,"binary":false,"changes":8,"status":"modified"}]}