{"files":[{"patch":"@@ -1323,0 +1323,7 @@\n+#if INCLUDE_JVMCI\n+  if (comp->is_jvmci() && !JVMCI::can_initialize_JVMCI()) {\n+    \/\/ JVMCI compilation is not yet initializable.\n+    return nullptr;\n+  }\n+#endif\n+\n@@ -1351,6 +1358,0 @@\n-#if INCLUDE_JVMCI\n-  if (comp->is_jvmci() && !JVMCI::can_initialize_JVMCI()) {\n-    return nullptr;\n-  }\n-#endif\n-\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.cpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -304,1 +304,1 @@\n-\n+private:\n@@ -314,0 +314,1 @@\n+public:\n","filename":"src\/hotspot\/share\/compiler\/compileBroker.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -59,0 +59,5 @@\n+  if (UseJVMCINativeLibrary) {\n+    \/\/ Initializing libjvmci does not execute Java code so\n+    \/\/ can be done any time.\n+    return true;\n+  }\n","filename":"src\/hotspot\/share\/jvmci\/jvmci.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -697,1 +697,0 @@\n-  bool forced_JVMCI_initialization_must_succeed = true;\n@@ -702,7 +701,0 @@\n-\n-    if (!force_JVMCI_initialization) {\n-      \/\/ 8145270: Force initialization of JVMCI runtime otherwise requests for blocking\n-      \/\/ compilations via JVMCI will not actually block until JVMCI is initialized.\n-      force_JVMCI_initialization = UseJVMCICompiler && (!UseInterpreter || !BackgroundCompilation);\n-      forced_JVMCI_initialization_must_succeed = false;\n-    }\n@@ -712,5 +704,1 @@\n-  \/\/ Postpone completion of compiler initialization to after JVMCI\n-  \/\/ is initialized to avoid timeouts of blocking compilations.\n-  if (JVMCI_ONLY(!force_JVMCI_initialization) NOT_JVMCI(true)) {\n-    CompileBroker::compilation_init_phase2();\n-  }\n+  CompileBroker::compilation_init_phase2();\n@@ -760,13 +748,1 @@\n-    JVMCI::initialize_compiler(THREAD);\n-    if (HAS_PENDING_EXCEPTION) {\n-      if (forced_JVMCI_initialization_must_succeed) {\n-        return JNI_ERR;\n-      } else {\n-        ResourceMark rm(THREAD);\n-        stringStream st;\n-        java_lang_Throwable::print(PENDING_EXCEPTION, &st);\n-        CLEAR_PENDING_EXCEPTION;\n-        JVMCI_event_1(\"Error during eager JVMCI initialization: %s\", st.as_string());\n-      }\n-    }\n-    CompileBroker::compilation_init_phase2();\n+    JVMCI::initialize_compiler(CHECK_JNI_ERR);\n","filename":"src\/hotspot\/share\/runtime\/threads.cpp","additions":2,"deletions":26,"binary":false,"changes":28,"status":"modified"}]}