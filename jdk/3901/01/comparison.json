{"files":[{"patch":"@@ -59,0 +59,5 @@\n+  uintptr_t cld = (uintptr_t)method->method_holder()->class_loader_data();\n+  hash = (hash * 31) ^ (unsigned int)cld;\n+#ifdef _LP64\n+  hash = hash ^ (unsigned int)(cld >> 32);\n+#endif\n","filename":"src\/hotspot\/share\/prims\/resolvedMethodTable.cpp","additions":5,"deletions":0,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -28,0 +28,1 @@\n+ * @modules java.base\/jdk.internal.misc\n@@ -36,0 +37,1 @@\n+import java.util.Arrays;\n@@ -37,0 +39,1 @@\n+import jdk.internal.misc.Unsafe;\n@@ -51,0 +54,7 @@\n+    private MethodHandle generateWithSameName() throws ReflectiveOperationException {\n+        byte[] buf = new byte[100];\n+        int size = writeClass(buf, \"MH$$\");\n+        Class<?> cls = Unsafe.getUnsafe().defineAnonymousClass(ResolvedMethodTableHash.class, Arrays.copyOf(buf, size), null);\n+        return MethodHandles.publicLookup().findStatic(cls, \"m\", MethodType.methodType(void.class));\n+    }\n+\n@@ -85,1 +95,6 @@\n-            handles.add(generator.generate(\"MH$\" + i));\n+            \/\/ prevents metaspace oom\n+            if (i % 5 != 0) {\n+                handles.add(generator.generate(\"MH$\" + i));\n+            } else {\n+                handles.add(generator.generateWithSameName());\n+            }\n","filename":"test\/hotspot\/jtreg\/runtime\/MemberName\/ResolvedMethodTableHash.java","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"}]}