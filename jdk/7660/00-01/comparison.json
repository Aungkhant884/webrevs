{"files":[{"patch":"@@ -377,3 +377,3 @@\n-For aarch64 machines running Windows the minimum accepted version is Visual Studio 2019 \n-(16.8 or higher). For all other platforms the minimum accepted version of \n-Visual Studio is 2017. Older versions will not be accepted by `configure` and will \n+For aarch64 machines running Windows the minimum accepted version is Visual Studio 2019\n+(16.8 or higher). For all other platforms the minimum accepted version of\n+Visual Studio is 2017. Older versions will not be accepted by `configure` and will\n@@ -1517,2 +1517,1 @@\n-there is an ongoing effort. There are some things you can do to minimize\n-non-determinism and make a larger part of the build reproducible:\n+there is an ongoing effort.\n@@ -1520,1 +1519,6 @@\n-  * Turn on build system support for reproducible builds\n+An absolute prerequisite for building reproducible is to speficy a fixed build\n+time, since time stamps are embedded in many file formats. This is done by\n+setting the `SOURCE_DATE_EPOCH` environment variable, which is an [industry\n+standard]( https:\/\/reproducible-builds.org\/docs\/source-date-epoch\/), that many\n+tools, such as gcc, recognize, and use in place of the current time when\n+generating output.\n@@ -1522,3 +1526,4 @@\n-Add the flag `--enable-reproducible-build` to your `configure` command line.\n-This will turn on support for reproducible builds where it could otherwise be\n-lacking.\n+To generate reproducible builds, you must set `SOURCE_DATE_EPOCH` before running\n+`configure`. The value in `SOURCE_DATE_EPOCH` will be stored in the\n+configuration, and used by `make`. Setting `SOURCE_DATE_EPOCH` before running\n+`make` will have no effect on the build.\n@@ -1526,1 +1531,5 @@\n-  * Do not rely on `configure`'s default adhoc version strings\n+You must also make sure your build does not rely on `configure`'s default adhoc\n+version strings. Default adhoc version strings `OPT` segment include user name,\n+source directory and timestamp. You can either override just the `OPT` segment\n+using `--with-version-opt=<any fixed string>`, or you can specify the entire\n+version string using `--with-version-string=<your version>`.\n@@ -1528,4 +1537,1 @@\n-Default adhoc version strings OPT segment include user name, source directory\n-and timestamp. You can either override just the OPT segment using\n-`--with-version-opt=<any fixed string>`, or you can specify the entire version\n-string using `--with-version-string=<your version>`.\n+This is a typical example of how to build the JDK in a reproducible way:\n@@ -1533,31 +1539,5 @@\n-  * Specify how the build sets `SOURCE_DATE_EPOCH`\n-\n-The JDK build system will set the `SOURCE_DATE_EPOCH` environment variable\n-during building, depending on the value of the `--with-source-date` option for\n-`configure`. The default value is `updated`, which means that\n-`SOURCE_DATE_EPOCH` will be set to the current time each time you are running\n-`make`.\n-\n-The [`SOURCE_DATE_EPOCH` environment variable](\n-https:\/\/reproducible-builds.org\/docs\/source-date-epoch\/) is an industry\n-standard, that many tools, such as gcc, recognize, and use in place of the\n-current time when generating output.\n-\n-For reproducible builds, you need to set this to a fixed value. You can use the\n-special value `version` which will use the nominal release date for the current\n-JDK version, or a value describing a date, either an epoch based timestamp as an\n-integer, or a valid ISO-8601 date.\n-\n-**Hint:** If your build environment already sets `SOURCE_DATE_EPOCH`, you can\n-propagate this using `--with-source-date=$SOURCE_DATE_EPOCH`.\n-\n-  * Specify a hotspot build time\n-\n-Set a fixed hotspot build time. This will be included in the hotspot library\n-(`libjvm.so` or `jvm.dll`) and defaults to the current time when building\n-hotspot. Use `--with-hotspot-build-time=<any fixed string>` for reproducible\n-builds. It's a string so you don't need to format it specifically, so e.g. `n\/a`\n-will do. Another solution is to use the `SOURCE_DATE_EPOCH` variable, e.g.\n-`--with-hotspot-build-time=$(date --date=@$SOURCE_DATE_EPOCH)`.\n-\n-  * Copyright year\n+```\n+export SOURCE_DATE_EPOCH=946684800\n+bash configure --with-version-opt=adhoc\n+make\n+```\n@@ -1565,3 +1545,51 @@\n-The copyright year in some generated text files are normally set to the current\n-year. This can be overridden by `--with-copyright-year=<year>`. For fully\n-reproducible builds, this needs to be set to a fixed value.\n+Note that regardless if you specify a source date for `configure` or not, the\n+JDK build system will set `SOURCE_DATE_EPOCH` for all build tools when building.\n+If `--with-source-date` has the value `updated` (which is the default unless\n+`SOURCE_DATE_EPOCH` is found by in the environment by `configure`), the source\n+date value will be determined at build time.\n+\n+There are several aspects of reproducible builds that can be individually\n+adjusted by `configure` arguments. If any of these are given, they will override\n+the value derived from `SOURCE_DATE_EPOCH`. These arguments are:\n+\n+ * `--with-source-date`\n+\n+    This option controls how the JDK build sets SOURCE_DATE_ EPOCH when\n+    building. It can be set to a value describing a date, either an epoch based\n+    timestamp as an integer, or a valid ISO-8601 date.\n+\n+    It can also be set to one of the special values `current`, `updated` or\n+    `version`. `current` means that the time of running `configure` will be\n+    used. `version` will use the nominal release date for the current JDK\n+    version. `updated`, which means that `SOURCE_DATE_EPOCH` will be set to the\n+    current time each time you are running `make`. All choices, except for\n+    `updated`, will set a fixed value for the source date timestamp.\n+\n+    When `SOURCE_DATE_EPOCH` is set, the default value for `--with-source-date`\n+    will be the value given by `SOURCE_DATE_EPOCH`. Otherwise, the default value\n+    is `updated`.\n+\n+ * `--with-hotspot-build-time`\n+\n+    This option controls the build time string that will be included in the\n+    hotspot library (`libjvm.so` or `jvm.dll`). When the source date is fixed\n+    (e.g. by setting `SOURCE_DATE_EPOCH`), the default value for\n+    `--with-hotspot-build-time` will be an ISO 8601 representation of that time\n+    stamp. Otherwise the default value will be the current time when building\n+    hotspot.\n+\n+ * `--with-copyright-year`\n+\n+    This option controls the copyright year in some generated text files. When\n+    the source date is fixed (e.g. by setting `SOURCE_DATE_EPOCH`), the default\n+    value for `--with-copyright-year` will be the year of that time stamp.\n+    Otherwise the default is the current year at the time of running configure.\n+    This can be overridden by `--with-copyright-year=<year>`.\n+\n+ * `--enable-reproducible-build`\n+\n+    This option controls some additional behavior needed to make the build\n+    reproducible. When the source date is fixed (e.g. by setting\n+    `SOURCE_DATE_EPOCH`), this flag will be turned on by default. Otherwise, the\n+    value is determined by heuristics. If it is explicitly turned off, the build\n+    might not be reproducible.\n","filename":"doc\/building.md","additions":76,"deletions":48,"binary":false,"changes":124,"status":"modified"},{"patch":"@@ -299,0 +299,7 @@\n+  if test \"x$SOURCE_DATE\" != xupdated; then\n+    source_date_info=\"$SOURCE_DATE ($SOURCE_DATE_ISO_8601)\"\n+  else\n+    source_date_info=\"Determined at build time\"\n+  fi\n+  printf \"* Source date:    $source_date_info\\n\"\n+\n","filename":"make\/autoconf\/help.m4","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -214,1 +214,1 @@\n-      [Set copyright year value for build @<:@current year@:>@])])\n+      [Set copyright year value for build @<:@current year\/source-date@:>@])])\n@@ -219,1 +219,1 @@\n-  elif test \"x$SOURCE_DATE_EPOCH\" != x; then\n+  elif test \"x$SOURCE_DATE\" != xcurrent; then\n@@ -221,1 +221,1 @@\n-      COPYRIGHT_YEAR=`date --date=@$SOURCE_DATE_EPOCH +%Y`\n+      COPYRIGHT_YEAR=`$DATE --date=@$SOURCE_DATE +%Y`\n@@ -223,1 +223,1 @@\n-      COPYRIGHT_YEAR=`date -j -f %s $SOURCE_DATE_EPOCH +%Y`\n+      COPYRIGHT_YEAR=`$DATE -j -f %s $SOURCE_DATE +%Y`\n@@ -679,0 +679,1 @@\n+      with_source_date_present=true\n","filename":"make\/autoconf\/jdk-options.m4","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"}]}