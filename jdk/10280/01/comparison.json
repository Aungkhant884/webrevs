{"files":[{"patch":"@@ -131,0 +131,18 @@\n+void ThrowExceptionWithMessageAndErrcode(JNIEnv *env, const char *exceptionName,\n+                                         const char *msg, DWORD dwError) {\n+    char szMessage[500];\n+    szMessage[0] = '\\0';\n+    char szMessage2[1024];\n+    szMessage2[0] = '\\0';\n+\n+    DWORD res = FormatMessageA(FORMAT_MESSAGE_FROM_SYSTEM, NULL, dwError,\n+        NULL, szMessage, sizeof(szMessage), NULL);\n+    if (res == 0) {\n+        strcpy(szMessage, \"Unknown error\");\n+    }\n+    snprintf(szMessage2, sizeof(szMessage2), \"%s: error %lu, %s\", msg, dwError, szMessage);\n+\n+    ThrowExceptionWithMessage(env, exceptionName, szMessage2);\n+}\n+\n+\n@@ -137,1 +155,1 @@\n-    char szMessage[1024];\n+    char szMessage[500];\n@@ -139,0 +157,2 @@\n+    char szMessage2[1024];\n+    szMessage2[0] = '\\0';\n@@ -145,0 +165,1 @@\n+    snprintf(szMessage2, sizeof(szMessage2), \"error %lu, %s\", msg, dwError, szMessage);\n@@ -146,1 +167,1 @@\n-    ThrowExceptionWithMessage(env, exceptionName, szMessage);\n+    ThrowExceptionWithMessage(env, exceptionName, szMessage2);\n@@ -1848,2 +1869,1 @@\n-\n-            ThrowException(env, KEYSTORE_EXCEPTION, NTE_BAD_KEYSET_PARAM);\n+            ThrowExceptionWithMessage(env, KEYSTORE_EXCEPTION, \"key container name was NULL, NTE_BAD_KEYSET_PARAM\");\n@@ -1861,1 +1881,1 @@\n-            ThrowException(env, KEYSTORE_EXCEPTION, GetLastError());\n+            ThrowExceptionWithMessageAndErrcode(env, KEYSTORE_EXCEPTION, \"CryptAcquireContext failure\", GetLastError());\n","filename":"src\/jdk.crypto.mscapi\/windows\/native\/libsunmscapi\/security.cpp","additions":25,"deletions":5,"binary":false,"changes":30,"status":"modified"}]}