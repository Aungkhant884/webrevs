{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -133,1 +133,5 @@\n-                    if (encodedCerts.size() > SSLConfiguration.maxCertificateChainLength) {\n+                    int maxAllowedChainLength = handshakeContext.sslConfig.isClientMode ?\n+                            SSLConfiguration.maxInboundServerCertChainLen :\n+                            SSLConfiguration.maxInboundClientCertChainLen;\n+\n+                    if (encodedCerts.size() > maxAllowedChainLength) {\n@@ -138,1 +142,1 @@\n-                                + SSLConfiguration.maxCertificateChainLength\n+                                + maxAllowedChainLength\n@@ -864,1 +868,5 @@\n-                if (certList.size() > SSLConfiguration.maxCertificateChainLength) {\n+                int maxAllowedChainLength = handshakeContext.sslConfig.isClientMode ?\n+                        SSLConfiguration.maxInboundServerCertChainLen :\n+                        SSLConfiguration.maxInboundClientCertChainLen;\n+\n+                if (certList.size() > maxAllowedChainLength) {\n@@ -869,1 +877,1 @@\n-                            + SSLConfiguration.maxCertificateChainLength\n+                            + maxAllowedChainLength\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/CertificateMessage.java","additions":13,"deletions":5,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -111,3 +111,5 @@\n-    \/\/ Set the max certificate chain length to 10\n-    static final int maxCertificateChainLength = GetIntegerAction.privilegedGetProperty(\n-            \"jdk.tls.maxCertificateChainLength\", 10);\n+    \/\/ Limit the certificate chain length accepted from clients\n+    static final int maxInboundClientCertChainLen;\n+\n+    \/\/ Limit the certificate chain length accepted from servers\n+    static final int maxInboundServerCertChainLen;\n@@ -136,0 +138,47 @@\n+    static {\n+        boolean globalPropSet = false;\n+\n+        \/\/ jdk.tls.maxCertificateChainLength property has no default\n+        Integer maxCertificateChainLength = GetIntegerAction.privilegedGetProperty(\n+                \"jdk.tls.maxCertificateChainLength\");\n+        if (maxCertificateChainLength != null && maxCertificateChainLength >= 0) {\n+            globalPropSet = true;\n+        }\n+\n+        \/*\n+         * If either jdk.tls.server.maxInboundCertificateChainLength or\n+         * jdk.tls.client.maxInboundCertificateChainLength is set, it will\n+         * override jdk.tls.maxCertificateChainLength, regardless of whether\n+         * jdk.tls.maxCertificateChainLength is set or not.\n+         * If neither jdk.tls.server.maxInboundCertificateChainLength nor\n+         * jdk.tls.client.maxInboundCertificateChainLength is set, the behavior\n+         * depends on the setting of jdk.tls.maxCertificateChainLength. If\n+         * jdk.tls.maxCertificateChainLength is set, it falls back to that\n+         * value; otherwise, it defaults to 8 for\n+         * jdk.tls.server.maxInboundCertificateChainLength\n+         * and 10 for jdk.tls.client.maxInboundCertificateChainLength.\n+         * Usesrs can independently set either\n+         * jdk.tls.server.maxInboundCertificateChainLength or\n+         * jdk.tls.client.maxInboundCertificateChainLength.\n+         *\/\n+        Integer inboundClientLen = GetIntegerAction.privilegedGetProperty(\n+                \"jdk.tls.server.maxInboundCertificateChainLength\");\n+\n+        \/\/ Default for jdk.tls.server.maxInboundCertificateChainLength is 8\n+        if (inboundClientLen == null || inboundClientLen < 0) {\n+            maxInboundClientCertChainLen = globalPropSet ? maxCertificateChainLength : 8;\n+        } else {\n+            maxInboundClientCertChainLen = inboundClientLen;\n+        }\n+\n+        Integer inboundServerLen = GetIntegerAction.privilegedGetProperty(\n+                \"jdk.tls.client.maxInboundCertificateChainLength\");\n+\n+        \/\/ Default for jdk.tls.client.maxInboundCertificateChainLength is 10\n+        if (inboundServerLen == null || inboundServerLen < 0) {\n+            maxInboundServerCertChainLen = globalPropSet ? maxCertificateChainLength : 10;\n+        } else {\n+            maxInboundServerCertChainLen = inboundServerLen;\n+        }\n+    }\n+\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SSLConfiguration.java","additions":53,"deletions":4,"binary":false,"changes":57,"status":"modified"}]}