{"files":[{"patch":"@@ -999,5 +999,6 @@\n-  if (thread != NULL) {\n-    if (thread->is_Java_thread()) {\n-      oop obj = JavaThread::cast(thread)->threadObj();\n-      return (obj == NULL) ? 0 : java_lang_Thread::thread_id(obj);\n-    }\n+  if (thread != NULL && thread->is_Java_thread()) {\n+    Thread* current = Thread::current();\n+    guarantee(current != thread || JavaThread::cast(thread)->is_oop_safe(),\n+              \"current cannot touch oops after its GC barrier is detached.\");\n+    oop obj = JavaThread::cast(thread)->threadObj();\n+    return (obj == NULL) ? 0 : java_lang_Thread::thread_id(obj);\n","filename":"src\/hotspot\/share\/runtime\/sharedRuntime.cpp","additions":6,"deletions":5,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -34,3 +34,0 @@\n-serviceability\/jvmti\/vthread\/ContFramePopTest\/ContFramePopTest.java 8278053 generic-all\n-serviceability\/jvmti\/vthread\/ContStackDepthTest\/ContStackDepthTest.java 8278053 generic-all\n-\n","filename":"test\/hotspot\/jtreg\/ProblemList-Xcomp.txt","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"}]}