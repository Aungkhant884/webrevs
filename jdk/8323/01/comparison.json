{"files":[{"patch":"@@ -27,1 +27,0 @@\n-import java.util.Objects;\n@@ -36,1 +35,1 @@\n- * @LastModified: Jan 2022\n+ * @LastModified: Apr 2022\n@@ -454,2 +453,1 @@\n-      Objects.checkIndex(index, s.length());\n-      if (s.length() > index) {\n+      if (index >= 0 && index < s.length() - 1) {\n","filename":"src\/java.xml\/share\/classes\/com\/sun\/org\/apache\/xpath\/internal\/compiler\/Lexer.java","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,82 @@\n+\/*\n+ * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+package xpath;\n+\n+import java.io.StringReader;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+import org.testng.Assert;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+\n+\/*\n+ * @test\n+ * @bug 8284548\n+ * @run testng xpath.XPathExceptionTest\n+ * @summary This is a general test for Exception handling. Additional cases may\n+ * be added with a bug id in the test cases.\n+ *\/\n+public class XPathExceptionTest {\n+\n+    \/*\n+     * DataProvider: invalid XPath expressions\n+     * Illegal expressions and structures that may escape the validation check.\n+     *\/\n+    @DataProvider(name = \"invalid\")\n+    public Object[][] getInvalid() throws Exception {\n+        return new Object[][]{\n+            \/\/ @bug JDK-8284548: expressions ending with relational operators\n+            \/\/ throw StringIndexOutOfBoundsException instead of XPathExpressionException\n+            {\"\/a\/b\/c[@d >\"},\n+            {\"\/a\/b\/c[@d <\"},\n+            {\"\/a\/b\/c[@d >=\"},\n+            {\">>\"},\n+        };\n+    }\n+\n+    \/**\n+     * Verifies that the XPath processor throws XPathExpressionException upon\n+     * encountering illegal XPath expressions.\n+     * @param invalidExp an illegal XPath expression\n+     * @throws Exception if the test fails\n+     *\/\n+    @Test(dataProvider = \"invalid\")\n+    public void testIllegalExp(String invalidExp) throws Exception {\n+        DocumentBuilder builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+        Document doc = builder.parse(new org.xml.sax.InputSource(new StringReader(\"<A\/>\")));\n+        Assert.assertThrows(XPathExpressionException.class, () -> evaluate(doc, invalidExp));\n+    }\n+\n+    private void evaluate(Document doc, String s) throws XPathExpressionException {\n+        XPath xp = XPathFactory.newInstance().newXPath();\n+        XPathExpression xe = xp.compile(s);\n+        xe.evaluateExpression(doc, Node.class);\n+    }\n+}\n","filename":"test\/jaxp\/javax\/xml\/jaxp\/unittest\/xpath\/XPathExceptionTest.java","additions":82,"deletions":0,"binary":false,"changes":82,"status":"added"}]}