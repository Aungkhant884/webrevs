{"files":[{"patch":"@@ -84,1 +84,3 @@\n-  class Process : public ModuleClosure {\n+  GrowableArray<char*>* module_paths = new GrowableArray<char*>(5);\n+\n+  class ModulePathsGatherer : public ModuleClosure {\n@@ -86,0 +88,2 @@\n+    int _total_count;\n+    GrowableArray<char*>* _module_paths;\n@@ -87,1 +91,2 @@\n-    Process(JavaThread* current) : _current(current) {}\n+    ModulePathsGatherer(JavaThread* current, GrowableArray<char*>* module_paths) :\n+      _current(current), _total_count(0), _module_paths(module_paths) {}\n@@ -92,1 +97,3 @@\n-        ClassLoader::setup_module_search_path(_current, path);\n+        char* path_copy = NEW_RESOURCE_ARRAY(char, strlen(path) + 1);\n+        strcpy(path_copy, path);\n+        _module_paths->at_put_grow(_total_count++, path_copy);\n@@ -96,2 +103,10 @@\n-  Process process(current);\n-  met->modules_do(&process);\n+\n+  ModulePathsGatherer gatherer(current, module_paths);\n+  {\n+    MutexLocker ml(Module_lock);\n+    met->modules_do(&gatherer);\n+  }\n+\n+  for (int i = 0; i < module_paths->length(); i++) {\n+    ClassLoader::setup_module_search_path(current, module_paths->at(i));\n+  }\n","filename":"src\/hotspot\/share\/classfile\/classLoaderExt.cpp","additions":20,"deletions":5,"binary":false,"changes":25,"status":"modified"}]}