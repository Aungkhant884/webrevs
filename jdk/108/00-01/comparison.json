{"files":[{"patch":"@@ -229,1 +229,1 @@\n-\/\/ The main reason is revising young length, with our without the GCLocker being\n+\/\/ The main reason is revising young length, with or without the GCLocker being\n@@ -253,1 +253,1 @@\n-  \/\/ allocated more than that for reasons. In this case, use that.\n+  \/\/ allocated more than that for various reasons. In this case, use that.\n@@ -262,1 +262,0 @@\n-  uint desired_eden_length_before_mixed = 0;\n@@ -271,15 +270,4 @@\n-    if (!next_gc_should_be_mixed(NULL, NULL)) {\n-      desired_eden_length_by_pause =\n-        calculate_desired_eden_length_by_pause(survivor_base_time_ms,\n-                                               absolute_min_young_length - survivor_length,\n-                                               absolute_max_young_length - survivor_length);\n-    } else {\n-      desired_eden_length_before_mixed =\n-        calculate_desired_eden_length_before_mixed(survivor_base_time_ms,\n-                                                   absolute_min_young_length - survivor_length,\n-                                                   absolute_max_young_length - survivor_length);\n-    }\n-    \/\/ Above either sets desired_eden_length_by_pause or desired_eden_length_before_mixed,\n-    \/\/ the other is zero. Use the one that has been set below.\n-    uint desired_eden_length = MAX2(desired_eden_length_by_pause,\n-                                    desired_eden_length_before_mixed);\n+    desired_eden_length_by_pause =\n+      calculate_desired_eden_length_by_pause(survivor_base_time_ms,\n+                                             absolute_min_young_length - survivor_length,\n+                                             absolute_max_young_length - survivor_length);\n@@ -287,1 +275,1 @@\n-    \/\/ Finally incorporate MMU concerns; assume that it overrides the pause time\n+    \/\/ Incorporate MMU concerns; assume that it overrides the pause time\n@@ -290,3 +278,3 @@\n-    desired_eden_length = MAX3(desired_eden_length,\n-                               desired_eden_length_by_mmu,\n-                               MinDesiredEdenLength);\n+    uint desired_eden_length = MAX3(desired_eden_length_by_pause,\n+                                    desired_eden_length_by_mmu,\n+                                    MinDesiredEdenLength);\n@@ -310,1 +298,0 @@\n-                            \"desired eden length before mixed %u\"\n@@ -316,1 +303,0 @@\n-                            desired_eden_length_before_mixed,\n@@ -417,0 +403,15 @@\n+  if (!next_gc_should_be_mixed(NULL, NULL)) {\n+    return calculate_desired_eden_length_before_young_only(base_time_ms,\n+                                                           min_eden_length,\n+                                                           max_eden_length);\n+  } else {\n+    return calculate_desired_eden_length_before_mixed(base_time_ms,\n+                                                      min_eden_length,\n+                                                      max_eden_length);\n+  }\n+}\n+\n+\n+uint G1Policy::calculate_desired_eden_length_before_young_only(double base_time_ms,\n+                                                               uint min_eden_length,\n+                                                               uint max_eden_length) const {\n@@ -499,3 +500,3 @@\n-     calculate_desired_eden_length_by_pause(predicted_region_evac_time_ms,\n-                                            min_eden_length,\n-                                            max_eden_length);\n+     calculate_desired_eden_length_before_young_only(predicted_region_evac_time_ms,\n+                                                     min_eden_length,\n+                                                     max_eden_length);\n@@ -1113,2 +1114,0 @@\n-  } else {\n-    assert(expansion_region_num == 0, \"sanity\");\n@@ -1117,1 +1116,1 @@\n-  assert(target_young_length <= max_length, \"post-condition\");\n+  assert(target_young_length <= max_length, \"overflow\");\n@@ -1366,2 +1365,6 @@\n-      log_debug(gc, ergo)(\"%s (reclaimable percentage not over threshold). candidate old regions: %u reclaimable: \" SIZE_FORMAT \" (%1.2f) threshold: \" UINTX_FORMAT,\n-                          false_action_str, candidates->num_remaining(), reclaimable_bytes, reclaimable_percent, G1HeapWastePercent);\n+      log_debug(gc, ergo)(\"%s (reclaimable percentage below threshold). \"\n+                          \"candidate old regions: %u reclaimable: \" SIZE_FORMAT \" (%1.2f) \"\n+                          \"threshold: \" UINTX_FORMAT,\n+                          false_action_str,\n+                          candidates->num_remaining(), reclaimable_bytes, reclaimable_percent,\n+                          G1HeapWastePercent);\n@@ -1372,2 +1375,6 @@\n-    log_debug(gc, ergo)(\"%s (candidate old regions available). candidate old regions: %u reclaimable: \" SIZE_FORMAT \" (%1.2f) threshold: \" UINTX_FORMAT,\n-                        true_action_str, candidates->num_remaining(), reclaimable_bytes, reclaimable_percent, G1HeapWastePercent);\n+    log_debug(gc, ergo)(\"%s (candidate old regions available). \"\n+                        \"candidate old regions: %u reclaimable: \" SIZE_FORMAT \" (%1.2f) \"\n+                        \"threshold: \" UINTX_FORMAT,\n+                        true_action_str,\n+                        candidates->num_remaining(), reclaimable_bytes, reclaimable_percent,\n+                        G1HeapWastePercent);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.cpp","additions":41,"deletions":34,"binary":false,"changes":75,"status":"modified"},{"patch":"@@ -204,1 +204,1 @@\n-  \/\/ Calculate and return the desired eden length that can fit into the pause time goal.\n+  \/\/ Calculate the desired eden length meeting the pause time goal.\n@@ -212,0 +212,6 @@\n+  \/\/ Calculate the desired eden length that can fit into the pause time\n+  \/\/ goal before young only gcs.\n+  uint calculate_desired_eden_length_before_young_only(double base_time_ms,\n+                                                       uint min_eden_length,\n+                                                       uint max_eden_length) const;\n+\n","filename":"src\/hotspot\/share\/gc\/g1\/g1Policy.hpp","additions":7,"deletions":1,"binary":false,"changes":8,"status":"modified"}]}