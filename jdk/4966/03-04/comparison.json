{"files":[{"patch":"@@ -124,1 +124,1 @@\n-            target.omitUnusedPrivateSyntheticEnclosingInstanceFields() ||\n+            target.optimizeOuterThis() ||\n@@ -2251,2 +2251,4 @@\n-                if (!TreeInfo.isInitialConstructor(def)) {\n-                    continue;\n+                if (TreeInfo.isInitialConstructor(def)) {\n+                  JCMethodDecl mdef = (JCMethodDecl) def;\n+                  mdef.body.stats = mdef.body.stats.prepend(\n+                      initOuterThis(mdef.body.pos, mdef.params.head.sym));\n@@ -2254,3 +2256,0 @@\n-                JCMethodDecl mdef = (JCMethodDecl) def;\n-                mdef.body.stats = mdef.body.stats.prepend(\n-                    initOuterThis(mdef.body.pos, mdef.params.head.sym));\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Lower.java","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -210,1 +210,1 @@\n-    public boolean omitUnusedPrivateSyntheticEnclosingInstanceFields() {\n+    public boolean optimizeOuterThis() {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/jvm\/Target.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -10,0 +10,2 @@\n+import java.util.Objects;\n+\n@@ -28,1 +30,1 @@\n-            T6521805.this.toString();\n+            Objects.requireNonNull(T6521805.this);\n","filename":"test\/langtools\/tools\/javac\/6521805\/T6521805d.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1,1 +1,1 @@\n-T6521805d.java:18:18: compiler.err.cannot.generate.class: T6521805.Inner, (compiler.misc.synthetic.name.conflict: this$0, T6521805.Inner)\n+T6521805d.java:20:18: compiler.err.cannot.generate.class: T6521805.Inner, (compiler.misc.synthetic.name.conflict: this$0, T6521805.Inner)\n","filename":"test\/langtools\/tools\/javac\/6521805\/T6521805d.out","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -5,0 +5,2 @@\n+import java.util.Objects;\n+\n@@ -9,1 +11,1 @@\n-            Outer.this.toString();\n+            Objects.requireNonNull(Outer.this);\n","filename":"test\/langtools\/tools\/javac\/6521805\/p\/Outer.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -47,1 +47,0 @@\n-        expectedNumberOfSyntheticFields = 1,\n@@ -50,2 +49,1 @@\n-        expectedMethods = {\"<init>(AccessToPrivateInnerClassConstructorsTest)\"},\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedMethods = {\"<init>(AccessToPrivateInnerClassConstructorsTest)\"})\n@@ -53,2 +51,1 @@\n-        expectedMethods = {\"<init>(AccessToPrivateInnerClassConstructorsTest)\"},\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedMethods = {\"<init>(AccessToPrivateInnerClassConstructorsTest)\"})\n@@ -64,5 +61,0 @@\n-\n-        {\n-            \/\/ access enclosing instance so this$0 field is generated\n-            AccessToPrivateInnerClassConstructorsTest.this.toString();\n-        }\n@@ -75,6 +67,1 @@\n-        class Local {\n-            {\n-                \/\/ access enclosing instance so this$0 field is generated\n-                AccessToPrivateInnerClassConstructorsTest.this.toString();\n-            }\n-        };\n+        class Local {};\n@@ -85,6 +72,1 @@\n-        class Local {\n-            {\n-                \/\/ access enclosing instance so this$0 field is generated\n-                AccessToPrivateInnerClassConstructorsTest.this.toString();\n-            }\n-        };\n+        class Local {};\n","filename":"test\/langtools\/tools\/javac\/classfiles\/attributes\/Synthetic\/AccessToPrivateInnerClassConstructorsTest.java","additions":4,"deletions":22,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -46,2 +46,1 @@\n- * 6. field this in Inner1.\n- * 7. constructor for Inner*.\n+ * 6. constructor for Inner*.\n@@ -53,2 +52,1 @@\n-        expectedFields = \"var\",\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedFields = \"var\")\n@@ -63,4 +61,1 @@\n-        private void function() {\n-            \/\/ access enclosing instance so this$0 field is generated\n-            AccessToPrivateInnerClassMembersTest.this.toString();\n-        }\n+        private void function() {}\n","filename":"test\/langtools\/tools\/javac\/classfiles\/attributes\/Synthetic\/AccessToPrivateInnerClassMembersTest.java","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -46,2 +46,1 @@\n- * 6. field this in Inner1.\n- * 7. constructor for Inner*.\n+ * 6. constructor for Inner*.\n@@ -52,2 +51,1 @@\n-        expectedFields = \"var\",\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedFields = \"var\")\n@@ -68,4 +66,1 @@\n-        private void function() {\n-            \/\/ access enclosing instance so this$0 field is generated\n-            AccessToPrivateSiblingsTest.this.toString();\n-        }\n+        private void function() {}\n","filename":"test\/langtools\/tools\/javac\/classfiles\/attributes\/Synthetic\/AccessToPrivateSiblingsTest.java","additions":3,"deletions":8,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -35,1 +35,1 @@\n- * @compile -XDdeduplicateLambdas=false BridgeMethodsForLambdaTest.java\n+ * @compile BridgeMethodsForLambdaTest.java\n@@ -58,2 +58,1 @@\n-        expectedNumberOfSyntheticMethods = 1,\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedNumberOfSyntheticMethods = 1)\n@@ -65,2 +64,1 @@\n-        expectedMethods = {\"<init>(BridgeMethodsForLambdaTest)\", \"function()\"},\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedMethods = {\"<init>(BridgeMethodsForLambdaTest)\", \"function()\"})\n@@ -69,2 +67,1 @@\n-        expectedNumberOfSyntheticMethods = 1,\n-        expectedNumberOfSyntheticFields = 1)\n+        expectedNumberOfSyntheticMethods = 1)\n@@ -83,5 +80,0 @@\n-\n-        {\n-            \/\/ access enclosing instance so this$0 field is generated\n-            BridgeMethodsForLambdaTest.this.toString();\n-        }\n@@ -100,5 +92,0 @@\n-\n-        {\n-            \/\/ access enclosing instance so this$0 field is generated\n-            BridgeMethodsForLambdaTest.this.toString();\n-        }\n@@ -112,5 +99,0 @@\n-\n-        {\n-            \/\/ access enclosing instance so this$0 field is generated\n-            BridgeMethodsForLambdaTest.this.toString();\n-        }\n","filename":"test\/langtools\/tools\/javac\/classfiles\/attributes\/Synthetic\/BridgeMethodsForLambdaTest.java","additions":4,"deletions":22,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -37,0 +37,2 @@\n+import java.util.Objects;\n+\n@@ -54,1 +56,1 @@\n-                ThisFieldTest.this.toString();\n+                Objects.requireNonNull(ThisFieldTest.this);\n@@ -61,1 +63,1 @@\n-                ThisFieldTest.this.toString();\n+                Objects.requireNonNull(ThisFieldTest.this);\n","filename":"test\/langtools\/tools\/javac\/classfiles\/attributes\/Synthetic\/ThisFieldTest.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -27,0 +27,2 @@\n+import java.util.Objects;\n+\n@@ -36,1 +38,1 @@\n-            ErrSyntheticNameConflict.this.toString();\n+            Objects.requireNonNull(ErrSyntheticNameConflict.this);\n","filename":"test\/langtools\/tools\/javac\/diags\/examples\/ErrSyntheticNameConflict.java","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"}]}