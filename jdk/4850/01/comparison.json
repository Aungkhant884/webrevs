{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,1 +31,7 @@\n-import java.awt.print.*;\n+import java.awt.Frame;\n+import java.awt.TextArea;\n+import java.awt.Panel;\n+import java.awt.BorderLayout;\n+import java.awt.print.PrinterJob;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -35,7 +41,3 @@\n-  static String[] instructions = {\n-     \"This test assumes and requires that you have a printer installed\",\n-     \"When the dialog appears, increment the number of copies then press OK.\",\n-     \"The test will throw an exception if you fail to do this, since\",\n-     \"it cannot distinguish that from a failure\",\n-     \"\"\n-  };\n+    private static final Frame instructionFrame = new Frame();\n+    private static volatile boolean testResult;\n+    private static volatile CountDownLatch countDownLatch;\n@@ -43,1 +45,1 @@\n-  public static void main(String[] args) {\n+    private static void createInstructionUI() {\n@@ -45,3 +47,5 @@\n-      for (int i=0;i<instructions.length;i++) {\n-         System.out.println(instructions[i]);\n-      }\n+        final String instruction = \"\"\"\n+                This test assumes and requires that you have a printer installed\n+                When the dialog appears, increment the number of copies then\n+                press OK\/Print.The test will throw an exception if you fail\n+                to do this, since,it cannot distinguish that from a failure.\"\"\";\n@@ -49,4 +53,9 @@\n-      PrinterJob job = PrinterJob.getPrinterJob();\n-      if (job.getPrintService() == null || !job.printDialog()) {\n-         return;\n-      }\n+        Panel mainControlPanel = new Panel(new BorderLayout());\n+        TextArea instructionTextArea = new TextArea();\n+        instructionTextArea.setText(instruction);\n+        instructionTextArea.setEditable(false);\n+        mainControlPanel.add(instructionTextArea, BorderLayout.CENTER);\n+        instructionFrame.add(mainControlPanel);\n+        instructionFrame.pack();\n+        instructionFrame.setVisible(true);\n+    }\n@@ -54,1 +63,11 @@\n-      System.out.println(\"Job copies is \" + job.getCopies());\n+    public static void showPrintDialog() {\n+        PrinterJob job = PrinterJob.getPrinterJob();\n+        if (job.getPrintService() == null) {\n+            System.out.println(\"Looks like printer is not configured. Please install printer and \" +\n+                    \"re-run the test case.\");\n+            testResult = false;\n+            countDownLatch.countDown();\n+            return;\n+        }\n+        checkNoOfCopies(job, job.printDialog());\n+    }\n@@ -56,4 +75,29 @@\n-      if (job.getCopies() == 1) {\n-            throw new RuntimeException(\"Copies not incremented\");\n-      }\n-   }\n+    public static void checkNoOfCopies(PrinterJob job, boolean pdReturnValue) {\n+        if (pdReturnValue) {\n+            System.out.println(\"User has selected OK\/Print button on the PrintDialog\");\n+        } else {\n+            System.out.println(\"User has selected Cancel button on the PrintDialog\");\n+        }\n+        int copies = job.getCopies();\n+        if (copies <= 1) {\n+            testResult = false;\n+            System.out.println(\"Expected the number of copies to be more than 1 but got \" + copies);\n+        } else {\n+            testResult = true;\n+            System.out.println(\"Total number of copies : \" + copies);\n+        }\n+        countDownLatch.countDown();\n+        instructionFrame.dispose();\n+    }\n+\n+    public static void main(String[] args) throws InterruptedException {\n+        countDownLatch = new CountDownLatch(1);\n+        createInstructionUI();\n+        showPrintDialog();\n+        if (!countDownLatch.await(5, TimeUnit.MINUTES)) {\n+            throw new RuntimeException(\"Timeout : No action was performed on the test UI.\");\n+        }\n+        if (!testResult) {\n+            throw new RuntimeException(\"Test failed!\");\n+        }\n+    }\n@@ -61,0 +105,1 @@\n+\n","filename":"test\/jdk\/java\/awt\/print\/Dialog\/DialogCopies.java","additions":67,"deletions":22,"binary":false,"changes":89,"status":"modified"}]}