{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2007, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2007, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -24,1 +24,1 @@\n-\/**\n+\/*\n@@ -31,1 +31,4 @@\n-import java.awt.print.*;\n+import java.awt.Frame;\n+import java.awt.TextArea;\n+import java.awt.BorderLayout;\n+import java.awt.print.PrinterJob;\n@@ -35,7 +38,11 @@\n-  static String[] instructions = {\n-     \"This test assumes and requires that you have a printer installed\",\n-     \"When the dialog appears, increment the number of copies then press OK.\",\n-     \"The test will throw an exception if you fail to do this, since\",\n-     \"it cannot distinguish that from a failure\",\n-     \"\"\n-  };\n+    private static Frame createInstructionUI() {\n+        final String instruction = \"\"\"\n+                This test requires that you have a printer.\n+\n+                Press Cancel if your system has only virtual printers such as\n+                Microsoft Print to PDF or Microsoft XPS Document Writer since\n+                they don't allow setting copies to anything but 1.\n+\n+                If a real printer is installed, select it from the drop-down\n+                list in the Print dialog and increase the number of copies,\n+                then press OK button.\"\"\";\n@@ -43,1 +50,2 @@\n-  public static void main(String[] args) {\n+        TextArea instructionTextArea = new TextArea(instruction);\n+        instructionTextArea.setEditable(false);\n@@ -45,3 +53,7 @@\n-      for (int i=0;i<instructions.length;i++) {\n-         System.out.println(instructions[i]);\n-      }\n+        Frame instructionFrame = new Frame();\n+        instructionFrame.add(instructionTextArea, BorderLayout.CENTER);\n+        instructionFrame.pack();\n+        instructionFrame.setLocationRelativeTo(null);\n+        instructionFrame.setVisible(true);\n+        return instructionFrame;\n+    }\n@@ -49,4 +61,9 @@\n-      PrinterJob job = PrinterJob.getPrinterJob();\n-      if (job.getPrintService() == null || !job.printDialog()) {\n-         return;\n-      }\n+    public static void showPrintDialog() {\n+        PrinterJob job = PrinterJob.getPrinterJob();\n+        if (job.getPrintService() == null) {\n+            System.out.println(\"Looks like printer is not configured. Please install printer \" +\n+                    \" and re-run the test case.\");\n+            return;\n+        }\n+        checkNoOfCopies(job, job.printDialog());\n+    }\n@@ -54,1 +71,13 @@\n-      System.out.println(\"Job copies is \" + job.getCopies());\n+    public static void checkNoOfCopies(PrinterJob job, boolean pdReturnValue) {\n+        if (pdReturnValue) {\n+            System.out.println(\"User has selected OK\/Print button on the PrintDialog\");\n+            int copies = job.getCopies();\n+            if (copies <= 1) {\n+                throw new RuntimeException(\"Expected the number of copies to be more than 1 but got \" + copies);\n+            } else {\n+                System.out.println(\"Total number of copies : \" + copies);\n+            }\n+        } else {\n+            System.out.println(\"User has selected Cancel button on the PrintDialog.\");\n+        }\n+    }\n@@ -56,4 +85,8 @@\n-      if (job.getCopies() == 1) {\n-            throw new RuntimeException(\"Copies not incremented\");\n-      }\n-   }\n+    public static void main(String[] args) throws InterruptedException {\n+        Frame frame = createInstructionUI();\n+        try {\n+            showPrintDialog();\n+        } finally {\n+            frame.dispose();\n+        }\n+    }\n","filename":"test\/jdk\/java\/awt\/print\/Dialog\/DialogCopies.java","additions":56,"deletions":23,"binary":false,"changes":79,"status":"modified"}]}