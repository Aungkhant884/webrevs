{"files":[{"patch":"@@ -443,0 +443,13 @@\n+        \/\/ if a prefix is present, remove it\n+        if (path.startsWith(\"\\\\\\\\?\\\\\")) {\n+            if (path.startsWith(\"UNC\\\\\", 4)) {\n+                path = \"\\\\\\\\\" + path.substring(8);\n+            } else {\n+                path = path.substring(4);\n+                \/\/ if only \"UNC\" remains, a trailing \"\\\\\" was likely removed\n+                if (path.equals(\"UNC\")) {\n+                    path = \"\\\\\\\\\";\n+                }\n+            }\n+        }\n+\n","filename":"src\/java.base\/windows\/classes\/java\/io\/WinNTFileSystem.java","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -25,2 +25,4 @@\n-   @bug 4899022\n-   @summary Look for erroneous representation of drive letter\n+ * @bug 4899022\n+ * @requires (os.family == \"windows\")\n+ * @summary Look for erroneous representation of drive letter\n+ * @run junit GetCanonicalPath\n@@ -29,1 +31,13 @@\n-import java.io.*;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n@@ -32,4 +46,33 @@\n-    public static void main(String[] args) throws Exception {\n-        if (File.separatorChar == '\\\\') {\n-            testDriveLetter();\n-        }\n+    private static Stream<Arguments> pathProvider() {\n+        File dir = new File(System.getProperty(\"user.dir\", \".\"));\n+        List<Arguments> list = new ArrayList<Arguments>();\n+\n+        String pathname = \"C:\\\\\";\n+        list.add(Arguments.of(pathname, pathname));\n+        pathname = \"C:\";\n+        list.add(Arguments.of(pathname, dir.toString()));\n+\n+        pathname = \"foo\\\\bar\\\\gus\";\n+        list.add(Arguments.of(pathname, new File(dir, pathname).toString()));\n+\n+        pathname = \"C:\\\\foo\\\\bar\\\\gus\";\n+        list.add(Arguments.of(pathname, pathname));\n+\n+        pathname = \"\\\\\\\\server\\\\share\\\\foo\\\\bar\\\\gus\";\n+        list.add(Arguments.of(pathname, pathname));\n+\n+        pathname = \"\\\\\\\\localhost\\\\C$\\\\Users\\\\file.dat\";\n+        list.add(Arguments.of(pathname, pathname));\n+\n+        list.add(Arguments.of(\"\\\\\\\\?\\\\C:\\\\Users\\\\file.dat\",\n+                              \"C:\\\\Users\\\\file.dat\"));\n+        list.add(Arguments.of(\"\\\\\\\\?\\\\UNC\\\\localhost\\\\C$\\\\Users\\\\file.dat\",\n+                              \"\\\\\\\\localhost\\\\C$\\\\Users\\\\file.dat\"));\n+\n+        return list.stream();\n+    }\n+\n+    @ParameterizedTest\n+    @ValueSource(strings = {\"\\\\\\\\?\", \"\\\\\\\\?\\\\\", \"\\\\\\\\?\\\\UNC\", \"\\\\\\\\?\\\\UNC\\\\\"})\n+    void badPaths(String pathname) {\n+        assertThrows(IOException.class, () -> new File(pathname).getCanonicalPath());\n@@ -37,1 +80,11 @@\n-    private static void testDriveLetter() throws Exception {\n+\n+    @ParameterizedTest\n+    @MethodSource(\"pathProvider\")\n+    void goodPaths(String pathname, String expected) throws IOException {\n+        File file = new File(pathname);\n+        String canonicalPath = file.getCanonicalPath();\n+        assertEquals(expected, canonicalPath);\n+    }\n+\n+    @Test\n+    void driveLetter() throws IOException {\n@@ -39,2 +92,1 @@\n-        if (path.length() > 3)\n-            throw new RuntimeException(\"Drive letter incorrectly represented\");\n+        assertFalse(path.length() > 3, \"Drive letter incorrectly represented\");\n","filename":"test\/jdk\/java\/io\/File\/GetCanonicalPath.java","additions":63,"deletions":11,"binary":false,"changes":74,"status":"modified"}]}