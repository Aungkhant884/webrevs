{"files":[{"patch":"@@ -84,1 +84,2 @@\n-DEBUG_ONLY(bool SystemDictionaryShared::_no_class_loading_should_happen = false;)\n+\/\/ Used by NoClassLoadingMark\n+DEBUG_ONLY(bool SystemDictionaryShared::_class_loading_may_happen = true;)\n@@ -184,0 +185,1 @@\n+  assert(!k->is_shared(), \"sanity\");\n@@ -189,0 +191,1 @@\n+  assert(!k->is_shared(), \"sanity\");\n@@ -509,2 +512,1 @@\n-  assert(!SystemDictionaryShared::no_class_loading_should_happen(),\n-         \"no new classes can be loaded while dumping archive\");\n+  assert(SystemDictionaryShared::class_loading_may_happen(), \"sanity\");\n@@ -593,1 +595,1 @@\n-  assert(_no_class_loading_should_happen, \"class loading must be disabled\");\n+  assert(!class_loading_may_happen(), \"class loading must be disabled\");\n@@ -651,1 +653,1 @@\n-  assert(no_class_loading_should_happen(), \"sanity\");\n+  assert(!class_loading_may_happen(), \"class loading must be disabled\");\n@@ -673,1 +675,1 @@\n-  assert(_no_class_loading_should_happen, \"sanity\");\n+  assert(!class_loading_may_happen(), \"class loading must be disabled\");\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.cpp","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -202,1 +202,1 @@\n-  DEBUG_ONLY(static bool _no_class_loading_should_happen;)\n+  DEBUG_ONLY(static bool _class_loading_may_happen;)\n@@ -319,1 +319,1 @@\n-  DEBUG_ONLY(static bool no_class_loading_should_happen() {return _no_class_loading_should_happen;})\n+  DEBUG_ONLY(static bool class_loading_may_happen() {return _class_loading_may_happen;})\n@@ -322,0 +322,3 @@\n+  \/\/ This object marks a critical period when writing the CDS archive. During this\n+  \/\/ period, the JVM must not load any new classes, so as to avoid adding new\n+  \/\/ items in the SystemDictionaryShared::_dumptime_table. \n@@ -325,2 +328,2 @@\n-      assert(!_no_class_loading_should_happen, \"must not be nested\");\n-      _no_class_loading_should_happen = true;\n+      assert(_class_loading_may_happen, \"must not be nested\");\n+      _class_loading_may_happen = false;\n@@ -329,1 +332,1 @@\n-      _no_class_loading_should_happen = false;\n+      _class_loading_may_happen = true;\n","filename":"src\/hotspot\/share\/classfile\/systemDictionaryShared.hpp","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"}]}