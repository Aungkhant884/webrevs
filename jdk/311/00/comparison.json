{"files":[{"patch":"@@ -38,3 +38,3 @@\n- * @build nsk.aod.AttachProvider.AttachProvider01.AttachProvider01\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -XX:+UsePerfData\n@@ -43,1 +43,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -49,2 +49,2 @@\n-import java.util.List;\n-import com.sun.tools.attach.*;\n+import com.sun.tools.attach.VirtualMachine;\n+import com.sun.tools.attach.VirtualMachineDescriptor;\n@@ -52,1 +52,1 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AODTestRunner;\n@@ -55,0 +55,2 @@\n+import java.util.List;\n+\n@@ -66,1 +68,1 @@\n-    public void doTestActions(String targetVMId) throws Throwable {\n+    public void doTestActions(String targetVMId) {\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/AttachProvider\/AttachProvider01\/AttachProvider01.java","additions":10,"deletions":8,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -40,4 +40,4 @@\n- * @build nsk.aod.AttachProvider.AttachProvider02.AttachProvider02\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -Djdk.attach.allowAttachSelf -XX:+UsePerfData\n- *      PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -Djdk.attach.allowAttachSelf\n+ *      -XX:+UsePerfData\n@@ -46,1 +46,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -52,2 +52,2 @@\n-import java.util.Properties;\n-import com.sun.tools.attach.*;\n+import com.sun.tools.attach.VirtualMachine;\n+import com.sun.tools.attach.VirtualMachineDescriptor;\n@@ -55,1 +55,1 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AODTestRunner;\n@@ -58,0 +58,2 @@\n+import java.util.Properties;\n+\n@@ -83,1 +85,0 @@\n-\n@@ -87,1 +88,0 @@\n-\n@@ -98,1 +98,1 @@\n-        if (useVMDescriptor)\n+        if (useVMDescriptor) {\n@@ -100,1 +100,1 @@\n-        else\n+        } else {\n@@ -102,0 +102,1 @@\n+        }\n@@ -108,1 +109,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/AttachProvider\/AttachProvider02\/AttachProvider02.java","additions":13,"deletions":13,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -1,2 +0,0 @@\n-# disabled till JDK-8251999 is fixed\n-allowSmartActionArgs=false\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/TEST.properties","additions":0,"deletions":2,"binary":false,"changes":2,"status":"deleted"},{"patch":"@@ -42,3 +42,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine01.VirtualMachine01\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -XX:+UsePerfData\n@@ -47,1 +47,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -53,3 +53,3 @@\n-import nsk.share.aod.*;\n-import nsk.share.test.TestUtils;\n-import com.sun.tools.attach.*;\n+import com.sun.tools.attach.AttachNotSupportedException;\n+import com.sun.tools.attach.VirtualMachine;\n+import com.sun.tools.attach.VirtualMachineDescriptor;\n@@ -57,0 +57,2 @@\n+import nsk.share.aod.AODTestRunner;\n+import nsk.share.test.TestUtils;\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine01\/VirtualMachine01.java","additions":9,"deletions":7,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -42,4 +42,4 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine02.VirtualMachine02\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -Djdk.attach.allowAttachSelf -XX:+UsePerfData\n- *      PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -Djdk.attach.allowAttachSelf\n+ *      -XX:+UsePerfData\n@@ -48,1 +48,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -54,2 +54,2 @@\n-import java.io.IOException;\n-import com.sun.tools.attach.*;\n+import com.sun.tools.attach.VirtualMachine;\n+import com.sun.tools.attach.VirtualMachineDescriptor;\n@@ -57,1 +57,1 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AODTestRunner;\n@@ -60,0 +60,2 @@\n+import java.io.IOException;\n+\n@@ -63,1 +65,0 @@\n- *\n@@ -65,1 +66,0 @@\n- *\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine02\/VirtualMachine02.java","additions":10,"deletions":10,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -37,4 +37,4 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine03.VirtualMachine03\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -Djdk.attach.allowAttachSelf -XX:+UsePerfData\n- *      PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -Djdk.attach.allowAttachSelf\n+ *      -XX:+UsePerfData\n@@ -43,1 +43,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -50,1 +50,1 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AODTestRunner;\n@@ -66,3 +66,0 @@\n-\n-        VirtualMachine vm2 = VirtualMachine.attach(targetVMId);\n-\n@@ -70,9 +67,12 @@\n-            TestUtils.assertEquals(vm1.id(), currentVMId, \"vm.id() returns unexpected value: \" + vm1.id());\n-\n-            TestUtils.assertEquals(vm2.id(), targetVMId, \"vm.id() returns unexpected value: \" + vm2.id());\n-\n-            TestUtils.assertTrue(!vm1.equals(vm2), vm1 + \".equals(\" + vm2 + \") returns 'true'\");\n-\n-            checkVM(vm1);\n-\n-            checkVM(vm2);\n+            VirtualMachine vm2 = VirtualMachine.attach(targetVMId);\n+            try {\n+                TestUtils.assertEquals(vm1.id(), currentVMId, \"vm.id() returns unexpected value: \" + vm1.id());\n+                TestUtils.assertEquals(vm2.id(), targetVMId, \"vm.id() returns unexpected value: \" + vm2.id());\n+\n+                TestUtils.assertTrue(!vm1.equals(vm2), vm1 + \".equals(\" + vm2 + \") returns 'true'\");\n+\n+                checkVM(vm1);\n+                checkVM(vm2);\n+            } finally {\n+                vm2.detach();\n+            }\n@@ -81,2 +81,0 @@\n-\n-            vm2.detach();\n@@ -93,1 +91,0 @@\n-\n@@ -95,1 +92,0 @@\n-\n@@ -101,1 +97,1 @@\n-        TestUtils.assertTrue(!vm1.equals(new String()), \"vm.equals(String) returns 'true'\");\n+        TestUtils.assertTrue(!vm1.equals(\"\"), \"vm.equals(String) returns 'true'\");\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine03\/VirtualMachine03.java","additions":19,"deletions":23,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,0 +23,1 @@\n+\n@@ -33,6 +34,3 @@\n-\n-    static String testPropertyKey = \"VirtualMachine04_testPropertyKey\";\n-\n-    static String testPropertyValue = \"VirtualMachine04_testPropertyValue\";\n-\n-    static String changedTestPropertyValue = \"VirtualMachine04_testPropertyValue_changed\";\n+    static final String TEST_PROPERTY_KEY = \"VirtualMachine04_testPropertyKey\";\n+    static final String TEST_PROPERTY_VALUE = \"VirtualMachine04_testPropertyValue\";\n+    static final String CHANGED_TEST_PROPERTY_VALUE = \"VirtualMachine04_testPropertyValue_changed\";\n@@ -43,2 +41,2 @@\n-        log.display(\"Setting property \" + testPropertyKey + \" = \" + testPropertyValue);\n-        System.setProperty(testPropertyKey, testPropertyValue);\n+        log.display(\"Setting property \" + TEST_PROPERTY_KEY + \" = \" + TEST_PROPERTY_VALUE);\n+        System.setProperty(TEST_PROPERTY_KEY, TEST_PROPERTY_VALUE);\n@@ -49,2 +47,2 @@\n-        log.display(\"Received signal: \"  + signal);\n-        if (!signal.equals(VirtualMachine04.SIGNAL_CHANGE_PROPERTY))\n+        log.display(\"Received signal: \" + signal);\n+        if (!signal.equals(VirtualMachine04.SIGNAL_CHANGE_PROPERTY)) {\n@@ -52,0 +50,1 @@\n+        }\n@@ -53,2 +52,2 @@\n-        log.display(\"Setting property \" + testPropertyKey + \" = \" + changedTestPropertyValue);\n-        System.setProperty(testPropertyKey, changedTestPropertyValue);\n+        log.display(\"Setting property \" + TEST_PROPERTY_KEY + \" = \" + CHANGED_TEST_PROPERTY_VALUE);\n+        System.setProperty(TEST_PROPERTY_KEY, CHANGED_TEST_PROPERTY_VALUE);\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine04\/VM04Target.java","additions":12,"deletions":13,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -41,3 +41,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine04.VirtualMachine04\n- *        nsk.aod.VirtualMachine.VirtualMachine04.VM04Target\n- * @run main\/othervm -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.aod.VirtualMachine.VirtualMachine04.VM04Target\n+ * @run main\/othervm\n+ *      -XX:+UsePerfData\n@@ -46,1 +46,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -52,1 +52,0 @@\n-import java.util.Properties;\n@@ -54,0 +53,1 @@\n+import nsk.share.TestBug;\n@@ -56,1 +56,2 @@\n-import nsk.share.*;\n+\n+import java.util.Properties;\n@@ -61,1 +62,0 @@\n- *\n@@ -65,1 +65,0 @@\n-\n@@ -67,1 +66,0 @@\n-\n@@ -78,1 +76,1 @@\n-            checkSystemProperties(vm, VM04Target.testPropertyKey, VM04Target.testPropertyValue);\n+            checkSystemProperties(vm, VM04Target.TEST_PROPERTY_KEY, VM04Target.TEST_PROPERTY_VALUE);\n@@ -84,1 +82,1 @@\n-            if (!signal.equals(SIGNAL_PROPERTY_CHANGED))\n+            if (!signal.equals(SIGNAL_PROPERTY_CHANGED)) {\n@@ -86,2 +84,2 @@\n-\n-            checkSystemProperties(vm, VM04Target.testPropertyKey, VM04Target.changedTestPropertyValue);\n+            }\n+            checkSystemProperties(vm, VM04Target.TEST_PROPERTY_KEY, VM04Target.CHANGED_TEST_PROPERTY_VALUE);\n@@ -98,2 +96,2 @@\n-            String propertyToCheck,\n-            String expectedPropertyValue) throws Throwable {\n+                               String propertyToCheck,\n+                               String expectedPropertyValue) throws Throwable {\n@@ -105,1 +103,1 @@\n-        String checkedPropertyValue  = properties.getProperty(propertyToCheck);\n+        String checkedPropertyValue = properties.getProperty(propertyToCheck);\n@@ -123,1 +121,0 @@\n-\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine04\/VirtualMachine04.java","additions":14,"deletions":17,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -38,3 +38,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine05.VirtualMachine05\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -XX:+UsePerfData\n@@ -43,1 +43,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -49,3 +49,3 @@\n-import java.util.List;\n-import com.sun.tools.attach.*;\n-import nsk.share.aod.*;\n+import com.sun.tools.attach.VirtualMachine;\n+import com.sun.tools.attach.VirtualMachineDescriptor;\n+import nsk.share.aod.AODTestRunner;\n@@ -54,0 +54,2 @@\n+import java.util.List;\n+\n@@ -65,1 +67,1 @@\n-    public void doTestActions(String targetVMId) throws Throwable {\n+    public void doTestActions(String targetVMId) {\n@@ -69,1 +71,1 @@\n-        checkList(VirtualMachine.list(), currentVMId, targetVMId);\n+        checkList(currentVMId, targetVMId);\n@@ -72,1 +74,1 @@\n-    private void checkList(List<VirtualMachineDescriptor> vmDescriptors, String currentVMId, String targetVMId) {\n+    private void checkList(String currentVMId, String targetVMId) {\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine05\/VirtualMachine05.java","additions":12,"deletions":10,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -23,1 +23,0 @@\n-package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -25,1 +24,1 @@\n-import java.lang.instrument.Instrumentation;\n+package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -29,0 +28,2 @@\n+import java.lang.instrument.Instrumentation;\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine06\/VM06Agent00.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,1 +23,0 @@\n-package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -25,1 +24,1 @@\n-import java.lang.instrument.Instrumentation;\n+package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -29,0 +28,2 @@\n+import java.lang.instrument.Instrumentation;\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine06\/VM06Agent01.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -23,1 +23,0 @@\n-package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -25,1 +24,1 @@\n-import java.lang.instrument.Instrumentation;\n+package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -29,0 +28,2 @@\n+import java.lang.instrument.Instrumentation;\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine06\/VM06Agent02.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -23,1 +23,0 @@\n-package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -25,1 +24,1 @@\n-import java.lang.instrument.Instrumentation;\n+package nsk.aod.VirtualMachine.VirtualMachine06;\n@@ -29,0 +28,2 @@\n+import java.lang.instrument.Instrumentation;\n+\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine06\/VM06Agent03.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -56,2 +56,1 @@\n- * @build ExecDriver\n- * @run driver PropertyResolvingWrapper ExecDriver --cmd\n+ * @run driver ExecDriver --cmd\n@@ -62,1 +61,1 @@\n- * @run driver PropertyResolvingWrapper ExecDriver --cmd\n+ * @run driver ExecDriver --cmd\n@@ -67,1 +66,1 @@\n- * @run driver PropertyResolvingWrapper ExecDriver --cmd\n+ * @run driver ExecDriver --cmd\n@@ -72,1 +71,1 @@\n- * @run driver PropertyResolvingWrapper ExecDriver --cmd\n+ * @run driver ExecDriver --cmd\n@@ -79,3 +78,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine06.VirtualMachine06\n- *        nsk.share.aod.TargetApplicationWaitingAgents\n- * @run main\/othervm -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.TargetApplicationWaitingAgents\n+ * @run main\/othervm\n+ *      -XX:+UsePerfData\n@@ -84,1 +83,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -91,0 +90,2 @@\n+import com.sun.tools.attach.AgentInitializationException;\n+import com.sun.tools.attach.VirtualMachine;\n@@ -92,1 +93,2 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AODTestRunner;\n+import nsk.share.aod.AgentInformation;\n@@ -94,2 +96,2 @@\n-import java.util.*;\n-import com.sun.tools.attach.*;\n+\n+import java.util.List;\n@@ -100,1 +102,0 @@\n- *\n@@ -112,1 +113,1 @@\n-        if (agents.size() != 4)\n+        if (agents.size() != 4) {\n@@ -114,1 +115,1 @@\n-\n+        }\n@@ -116,1 +117,1 @@\n-            if (!agent.jarAgent)\n+            if (!agent.jarAgent) {\n@@ -118,0 +119,1 @@\n+            }\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine06\/VirtualMachine06.java","additions":18,"deletions":16,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -43,3 +43,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine07.VirtualMachine07\n- *        nsk.share.aod.TargetApplicationWaitingAgents\n- * @run main\/othervm\/native -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.TargetApplicationWaitingAgents\n+ * @run main\/othervm\/native\n+ *      -XX:+UsePerfData\n@@ -48,1 +48,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -56,2 +56,6 @@\n-import nsk.share.*;\n-import nsk.share.aod.*;\n+import com.sun.tools.attach.AgentInitializationException;\n+import com.sun.tools.attach.VirtualMachine;\n+import nsk.share.TestBug;\n+import nsk.share.aod.AODRunnerArgParser;\n+import nsk.share.aod.AODTestRunner;\n+import nsk.share.aod.AgentInformation;\n@@ -60,3 +64,1 @@\n-import java.util.*;\n-\n-import com.sun.tools.attach.*;\n+import java.util.List;\n@@ -67,1 +69,0 @@\n- *\n@@ -73,4 +74,2 @@\n-\n-    static class ArgParser extends AODRunnerArgParser {\n-\n-        final String testedMethodOpt = \"testedMethod\";\n+    private static class ArgParser extends AODRunnerArgParser {\n+        private static final String TESTED_METHOD_OPT = \"testedMethod\";\n@@ -86,2 +85,2 @@\n-            if (option.equals(testedMethodOpt)) {\n-                if (value.equals(\"loadAgentLibrary\") || value.equals(\"loadAgentPath\"))\n+            if (option.equals(TESTED_METHOD_OPT)) {\n+                if (\"loadAgentLibrary\".equals(value) || \"loadAgentPath\".equals(value)) {\n@@ -89,2 +88,3 @@\n-                else\n-                    throw new TestBug(\"Unexpected value of '\" + testedMethodOpt + \"': \" + value);\n+                } else {\n+                    throw new TestBug(\"Unexpected value of '\" + TESTED_METHOD_OPT + \"': \" + value);\n+                }\n@@ -101,1 +101,1 @@\n-                if (!options.containsKey(\"arch\"))\n+                if (!options.containsKey(\"arch\")) {\n@@ -103,0 +103,1 @@\n+                }\n@@ -107,1 +108,1 @@\n-            return options.getProperty(testedMethodOpt).equals(\"loadAgentLibrary\");\n+            return options.getProperty(TESTED_METHOD_OPT).equals(\"loadAgentLibrary\");\n@@ -144,1 +145,1 @@\n-        if (testLoadAgentLibrary)\n+        if (testLoadAgentLibrary) {\n@@ -146,1 +147,1 @@\n-        else\n+        } else {\n@@ -148,0 +149,1 @@\n+        }\n@@ -162,1 +164,1 @@\n-        if (testLoadAgentLibrary)\n+        if (testLoadAgentLibrary) {\n@@ -164,1 +166,1 @@\n-        else\n+        } else {\n@@ -166,0 +168,1 @@\n+        }\n@@ -180,1 +183,1 @@\n-        if (agents.size() != 4)\n+        if (agents.size() != 4) {\n@@ -182,1 +185,1 @@\n-\n+        }\n@@ -184,1 +187,1 @@\n-            if (agent.jarAgent)\n+            if (agent.jarAgent) {\n@@ -186,0 +189,1 @@\n+            }\n@@ -212,1 +216,1 @@\n-                        \"AgentInitializationException.returnValue() returns unexpected value: \" + e.returnValue()+ \", expected value is 10\");\n+                        \"AgentInitializationException.returnValue() returns unexpected value: \" + e.returnValue() + \", expected value is 10\");\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine07\/VirtualMachine07.java","additions":32,"deletions":28,"binary":false,"changes":60,"status":"modified"},{"patch":"@@ -44,3 +44,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine07.VirtualMachine07\n- *        nsk.share.aod.TargetApplicationWaitingAgents\n- * @run main\/othervm\/native -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.TargetApplicationWaitingAgents\n+ * @run main\/othervm\/native\n+ *      -XX:+UsePerfData\n@@ -49,1 +49,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine08\/TestDescription.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -40,3 +40,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine09.VirtualMachine09\n- *        nsk.aod.VirtualMachine.VirtualMachine09.VM09Target\n- * @run main\/othervm\/native -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.aod.VirtualMachine.VirtualMachine09.VM09Target\n+ * @run main\/othervm\/native\n+ *      -XX:+UsePerfData\n@@ -45,1 +45,1 @@\n- *      \"-javaOpts=-agentlib:VirtualMachine09agent00 -XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-agentlib:VirtualMachine09agent00 -XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -53,0 +53,1 @@\n+import com.sun.tools.attach.VirtualMachine;\n@@ -55,1 +56,1 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AgentInformation;\n@@ -57,3 +58,1 @@\n-import java.util.*;\n-\n-import com.sun.tools.attach.*;\n+import java.util.List;\n@@ -76,1 +75,1 @@\n-        if (agents.size() != 1)\n+        if (agents.size() != 1) {\n@@ -78,1 +77,1 @@\n-\n+        }\n@@ -80,1 +79,1 @@\n-            if (agent.jarAgent)\n+            if (agent.jarAgent) {\n@@ -82,0 +81,1 @@\n+            }\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine09\/VirtualMachine09.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -41,3 +41,3 @@\n- * @build nsk.aod.VirtualMachine.VirtualMachine09.VirtualMachine09\n- *        nsk.aod.VirtualMachine.VirtualMachine09.VM09Target\n- * @run main\/othervm\/native -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.aod.VirtualMachine.VirtualMachine09.VM09Target\n+ * @run main\/othervm\/native\n+ *      -XX:+UsePerfData\n@@ -46,1 +46,1 @@\n- *      \"-javaOpts=-agentlib:VirtualMachine09agent00 -XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-agentlib:VirtualMachine09agent00 -XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachine\/VirtualMachine10\/TestDescription.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -40,3 +40,3 @@\n- * @build nsk.aod.VirtualMachineDescriptor.VirtualMachineDescriptor01.VirtualMachineDescriptor01\n- *        nsk.share.aod.DummyTargetApplication\n- * @run main\/othervm -XX:+UsePerfData PropertyResolvingWrapper\n+ * @build nsk.share.aod.DummyTargetApplication\n+ * @run main\/othervm\n+ *      -XX:+UsePerfData\n@@ -45,1 +45,1 @@\n- *      \"-javaOpts=-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n+ *      -javaOpts=\"-XX:+UsePerfData ${test.vm.opts} ${test.java.opts}\"\n@@ -51,1 +51,2 @@\n-import com.sun.tools.attach.*;\n+import com.sun.tools.attach.VirtualMachine;\n+import com.sun.tools.attach.VirtualMachineDescriptor;\n@@ -53,1 +54,1 @@\n-import nsk.share.aod.*;\n+import nsk.share.aod.AODTestRunner;\n@@ -111,2 +112,1 @@\n-                    \"VirtualMachineDescriptor.hashCode() returns different values \" + \"(\" + targetVMDesc.hashCode() + \" and \" + targetVMDesc2.hashCode() + \")\" +\n-                    \" for '\" + targetVMDesc + \"' and '\" + targetVMDesc2 + \"'\");\n+                    \"VirtualMachineDescriptor.hashCode() returns different values for '\" + targetVMDesc + \"' and '\" + targetVMDesc2 + \"'\");\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/aod\/VirtualMachineDescriptor\/VirtualMachineDescriptor01\/VirtualMachineDescriptor01.java","additions":8,"deletions":8,"binary":false,"changes":16,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2018, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2020, Oracle and\/or its affiliates. All rights reserved.\n@@ -23,6 +23,0 @@\n-package nsk.share.aod;\n-\n-import nsk.share.*;\n-import java.util.*;\n-\n-public class AODRunnerArgParser extends ArgumentParser {\n@@ -30,7 +24,1 @@\n-    public static final String jarAgentParam = \"ja\";\n-\n-    public static final String nativeAgentParam = \"na\";\n-\n-    public static final String targetAppParam = \"target\";\n-\n-    public static final String javaOptsParam = \"javaOpts\";\n+package nsk.share.aod;\n@@ -38,1 +26,2 @@\n-    public static final String testedJdkParam = \"jdk\";\n+import nsk.share.ArgumentParser;\n+import nsk.share.TestBug;\n@@ -40,1 +29,3 @@\n-    private static List<String> supportedOptions;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n@@ -42,8 +33,12 @@\n-    static {\n-        supportedOptions = new ArrayList<String>();\n-        supportedOptions.add(jarAgentParam);\n-        supportedOptions.add(nativeAgentParam);\n-        supportedOptions.add(targetAppParam);\n-        supportedOptions.add(javaOptsParam);\n-        supportedOptions.add(testedJdkParam);\n-    }\n+public class AODRunnerArgParser extends ArgumentParser {\n+    private static final String JAR_AGENT_PARAM = \"ja\";\n+    private static final String NATIVE_AGENT_PARAM = \"na\";\n+    private static final String TARGET_APP_PARAM = \"target\";\n+    private static final String JAVA_OPTS_PARAM = \"javaOpts\";\n+    private static final String TESTED_JDK_PARAM = \"jdk\";\n+    private static final Set<String> SUPPORTED_OPTIONS = Set.of(\n+            JAR_AGENT_PARAM,\n+            NATIVE_AGENT_PARAM,\n+            TARGET_APP_PARAM,\n+            JAVA_OPTS_PARAM,\n+            TESTED_JDK_PARAM);\n@@ -58,1 +53,1 @@\n-        if (super.checkOption(option, value))\n+        if (super.checkOption(option, value)) {\n@@ -60,0 +55,1 @@\n+        }\n@@ -61,1 +57,1 @@\n-        if (!supportedOptions.contains(option))\n+        if (!SUPPORTED_OPTIONS.contains(option)) {\n@@ -63,0 +59,1 @@\n+        }\n@@ -64,1 +61,1 @@\n-        if (option.equals(jarAgentParam)) {\n+        if (option.equals(JAR_AGENT_PARAM)) {\n@@ -68,1 +65,1 @@\n-        if (option.equals(nativeAgentParam)) {\n+        if (option.equals(NATIVE_AGENT_PARAM)) {\n@@ -77,1 +74,1 @@\n-            agents = new ArrayList<AgentInformation>();\n+            agents = new ArrayList<>();\n@@ -83,1 +80,1 @@\n-            agents = new ArrayList<AgentInformation>();\n+            agents = new ArrayList<>();\n@@ -86,1 +83,1 @@\n-        String agentStrings[];\n+        String[] agentStrings;\n@@ -88,1 +85,1 @@\n-        if (unsplittedAgentsString.contains(\",\"))\n+        if (unsplittedAgentsString.contains(\",\")) {\n@@ -90,2 +87,3 @@\n-        else\n-            agentStrings = new String[]{unsplittedAgentsString};\n+        } else {\n+            agentStrings = new String[]{ unsplittedAgentsString };\n+        }\n@@ -107,1 +105,1 @@\n-        if (!options.containsKey(targetAppParam))\n+        if (!options.containsKey(TARGET_APP_PARAM)) {\n@@ -109,0 +107,1 @@\n+        }\n@@ -110,1 +109,1 @@\n-        return options.getProperty(targetAppParam);\n+        return options.getProperty(TARGET_APP_PARAM);\n@@ -114,1 +113,1 @@\n-        if (!options.containsKey(testedJdkParam))\n+        if (!options.containsKey(TESTED_JDK_PARAM)) {\n@@ -116,0 +115,1 @@\n+        }\n@@ -117,1 +117,1 @@\n-        return options.getProperty(testedJdkParam);\n+        return options.getProperty(TESTED_JDK_PARAM);\n@@ -121,1 +121,5 @@\n-        return options.getProperty(javaOptsParam, \"\");\n+        var value = options.getProperty(JAVA_OPTS_PARAM, \"\");\n+        if (value.length() > 1 && value.startsWith(\"\\\"\") && value.endsWith(\"\\\"\")) {\n+            value = value.substring(1, value.length() - 1);\n+        }\n+        return value.trim();\n","filename":"test\/hotspot\/jtreg\/vmTestbase\/nsk\/share\/aod\/AODRunnerArgParser.java","additions":43,"deletions":39,"binary":false,"changes":82,"status":"modified"}]}