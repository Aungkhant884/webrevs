{"files":[{"patch":"@@ -24,1 +24,0 @@\n-import java.io.BufferedReader;\n@@ -27,1 +26,1 @@\n-import java.io.FileInputStream;\n+import java.io.IOException;\n@@ -29,1 +28,0 @@\n-import java.io.InputStreamReader;\n@@ -31,1 +29,2 @@\n-import java.util.ArrayList;\n+import java.nio.file.Files;\n+import java.util.HexFormat;\n@@ -33,0 +32,1 @@\n+import java.util.stream.Collectors;\n@@ -44,1 +44,2 @@\n-    private HexDumpReader() {}\n+    private HexDumpReader() {\n+    }\n@@ -46,0 +47,1 @@\n+    \/\/ Converts a Hex dump file (String) into an InputStream containing bytes\n@@ -48,1 +50,1 @@\n-                                             fileName));\n+                fileName));\n@@ -51,0 +53,1 @@\n+    \/\/ Converts a Hex dump file (File) into an InputStream containing bytes\n@@ -52,65 +55,6 @@\n-        ByteArrayBuilder bab = new ByteArrayBuilder();\n-        int lineNo = 0;\n-        try (BufferedReader reader\n-                 = new BufferedReader(new InputStreamReader(new FileInputStream(hexFile),\n-                StandardCharsets.US_ASCII))) {\n-            String line;\n-            while ((line = reader.readLine()) != null) {\n-                lineNo++;\n-                line = line.trim();\n-                \/\/ Skip blank and comment lines.\n-                if (line.length() == 0) {\n-                    continue;\n-                }\n-                int x = line.indexOf('#');\n-                if (x == 0) {\n-                    continue;\n-                }\n-                if (x > 0) {\n-                    line = line.substring(0, x).trim();\n-                }\n-                int len = line.length();\n-                for (int i = 0; i < len; i += 2) {\n-                    bab.put((byte)Integer.parseInt(line, i, i + 2, 16));\n-                }\n-            }\n-        } catch (Exception e) {\n-            throw new RuntimeException(hexFile.getName() + \":error:\" + lineNo + \": \" + e, e);\n-        }\n-        return new ByteArrayInputStream(bab.toArray());\n-    }\n-\n-\n-    private static class ByteArrayBuilder {\n-        private static final int BUFFER_SIZE = 4096;\n-\n-        private int size;\n-        private List<byte[]> bytes;\n-        private byte[] current;\n-        private int offset;\n-\n-        ByteArrayBuilder() {\n-            bytes = new ArrayList<>();\n-            current = new byte[BUFFER_SIZE];\n-        }\n-\n-        void put(byte b) {\n-            if (offset == BUFFER_SIZE) {\n-                bytes.add(current);\n-                current = new byte[BUFFER_SIZE];\n-                offset = 0;\n-            }\n-            current[offset++] = b;\n-            size++;\n-        }\n-\n-        byte[] toArray() {\n-            byte[] buf = new byte[size];\n-            int ptr = 0;\n-            for (byte[] ba : bytes) {\n-                System.arraycopy(ba, 0, buf, ptr, ba.length);\n-                ptr += ba.length;\n-            }\n-            System.arraycopy(current, 0, buf, ptr, offset);\n-            assert ptr + offset == size;\n-            return buf;\n+        List<String> lines;\n+        try {\n+            lines = Files.readAllLines(hexFile.toPath(), StandardCharsets.UTF_8);\n+        } catch (IOException e) {\n+            throw new RuntimeException(String.format(\"Utility class HexDumpReader\" +\n+                    \" threw %s when trying to read the file %s\", e, hexFile.getName()));\n@@ -118,0 +62,7 @@\n+        \/\/ Grab all non-empty lines up until a '#' if one exists\n+        String hexString = lines.stream().map(String::trim)\n+                .map(s -> (s.contains(\"#\")) ? s.substring(0, s.indexOf(\"#\")).trim() : s)\n+                .filter(s -> !s.isEmpty()).collect(Collectors.joining());\n+        \/\/ Iterate the hex string and convert it to bytes\n+        byte[] bArray = HexFormat.of().parseHex(hexString);\n+        return new ByteArrayInputStream(bArray);\n@@ -119,1 +70,0 @@\n-\n","filename":"test\/jdk\/java\/text\/testlib\/HexDumpReader.java","additions":22,"deletions":72,"binary":false,"changes":94,"status":"modified"}]}