[{"commit":{"message":"8304948: [vectorapi] C2 crashes when expanding VectorBox\n\nThis patch fixes C2 failure with SIGSEGV due to endless recursion.\n\nWith test case VectorBoxExpandTest.java in this patch, C2 would generate\nIR graph like below:\n\n```\n               ------------\n              \/            \\\n      Region |  VectorBox   |\n           \\ | \/            |\n            Phi             |\n             |              |\n             |              |\n      Region |  VectorBox   |\n           \\ | \/            |\n            Phi             |\n             |              |\n             |\\------------\/\n             |\n\n```\n\nThis Phi will be optimized by merge_through_phi [1], which transforms\n`Phi (VectorBox VectorBox)` into `VectorBox (Phi Phi)` to pursue\nopportunity of combining VectorBox with VectorUnbox. In this process,\neither the pre type check [2] or the process cloning Phi nodes [3], the\ncircle case is well considered to avoid falling into endless loop.\n\nAfter merge_through_phi, each input Phi of new VectorBox has the same\nshape with original root Phi before merging (only VectorBox has been\nreplaced). After several other optimizations, C2 would expand VectorBox\n[4] on a graph like below:\n\n```\n               ------------\n              \/            \\\n      Region |  Proj        |\n           \\ | \/            |\n            Phi             |\n             |              |\n             |              |\n      Region |  Proj        |\n           \\ | \/            |\n            Phi             |\n             |              |\n             |\\------------\/\n             |\n             |     Phi\n             |     \/\n          VectorBox\n\n```\nwhich the circle case should be taken into consideration as well.\n\n[TEST]\nFull Jtreg passed without new failure.\n\n[1] https:\/\/github.com\/openjdk\/jdk\/blob\/master\/src\/hotspot\/share\/opto\/cfgnode.cpp#L2557\n[2] https:\/\/github.com\/openjdk\/jdk\/blob\/master\/src\/hotspot\/share\/opto\/cfgnode.cpp#L2574\n[3] https:\/\/github.com\/openjdk\/jdk\/blob\/master\/src\/hotspot\/share\/opto\/cfgnode.cpp#L2534\n[4] https:\/\/github.com\/openjdk\/jdk\/blob\/master\/src\/hotspot\/share\/opto\/vector.cpp#L316\n\nChange-Id: I381b1ba7e0865814d97535e365db6d9d72ef1949"},"files":[{"filename":"src\/hotspot\/share\/opto\/vector.cpp"},{"filename":"src\/hotspot\/share\/opto\/vector.hpp"},{"filename":"test\/hotspot\/jtreg\/compiler\/vectorapi\/VectorBoxExpandTest.java"}],"sha":"0e73688a40044943b5ff9f874543652d5ee9f2ec"}]