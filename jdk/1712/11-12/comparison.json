{"files":[{"patch":"@@ -1783,1 +1783,1 @@\n-                    int gzlevel = -1;\n+                    int gzlevel = 0;\n@@ -1797,1 +1797,1 @@\n-                        if (gzlevel < 1) {\n+                        if (gzlevel == 0) {\n@@ -1805,1 +1805,1 @@\n-                        \/\/ Try to parse \"gz=\" option. If failed, treat it as filename\n+                        \/\/ Try to parse \"gz=\" option.\n@@ -1808,12 +1808,3 @@\n-                            if (gzlevel < 1) {\n-                                err.println(\"Can not parse compression level from option \\\"\" + option + \"\\\".\");\n-                                if (gzlevel == 0) {\n-                                    \/\/ Compression level not in range.\n-                                    usage();\n-                                    return;\n-                                } else {\n-                                    \/\/ Use the whole \"gz=xxx\" as dumped file name.\n-                                    out.println(\"Use \\\"\" + option +\"\\\" as dumped file name.\");\n-                                }\n-                            } else {\n-                                filename = \"heap.bin.gz\";\n+                            if (gzlevel == 0) {\n+                                 usage();\n+                                 return;\n@@ -1821,0 +1812,1 @@\n+                            filename = \"heap.bin.gz\";\n@@ -1823,0 +1815,7 @@\n+                    \/\/ Don't accept filename that start with \"gz=\" to avoid case like\n+                    \/\/ \"dumpheap gz=1 gz=2\"\n+                    if (filename.startsWith(\"gz=\")) {\n+                        err.println(\"Illegal filename \\\" + filename + \\\" should not start with \\\"gz=\\\".\");\n+                        usage();\n+                        return;\n+                    }\n@@ -2098,2 +2097,1 @@\n-     *           0      compression level is out of range\n-     *          -1      compression level can not be parsed as number\n+     *           0      compression level is illegal\n@@ -2102,1 +2100,1 @@\n-        int gzl = -1;\n+        int gzl = 0;\n@@ -2107,1 +2105,1 @@\n-                return -1;\n+                return 0;\n@@ -2114,1 +2112,1 @@\n-                return -1;\n+                return 0;\n@@ -2118,1 +2116,1 @@\n-                gzl = 0;\n+                return 0;\n@@ -2122,0 +2120,1 @@\n+            return 0;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/CommandProcessor.java","additions":20,"deletions":21,"binary":false,"changes":41,"status":"modified"},{"patch":"@@ -80,1 +80,1 @@\n-    private static int gzLevel = -1;\n+    private static int gzLevel = 0;\n@@ -208,1 +208,1 @@\n-            if (gzLevel == -1) {\n+            if (gzLevel == 0) {\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/tools\/JMap.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -161,4 +161,8 @@\n-                    \/\/ Command \"dumpheap gz=\"\n-                    new SubTest(\"dumpheap \", \"gz=\", false, true, \"heap written to gz=\"),\n-                    \/\/ Command \"dumpheap gz\"\n-                    new SubTest(\"dumpheap \", \"gz\", false, true, \"heap written to gz\")\n+                    \/\/ Command \"dumpheap gz=\".\n+                    new SubTest(\"dumpheap \", \"gz=\", true, false,\n+                            \"Usage: dumpheap \\\\[gz=<1-9>\\\\] \\\\[filename\\\\]\"),\n+                    \/\/ Command \"dumpheap gz\".\n+                    new SubTest(\"dumpheap \", \"gz\", false, true, \"heap written to gz\"),\n+                    \/\/ Command \"dump heap gz=1 gz=2\".\n+                    new SubTest(\"dumpheap gz=1\", \"gz=2\", true, false,\n+                            \"Usage: dumpheap \\\\[gz=<1-9>\\\\] \\\\[filename\\\\]\")\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/ClhsdbDumpheap.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"}]}