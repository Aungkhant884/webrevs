{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2002, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2002, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -435,12 +435,0 @@\n-\n-                \/*\n-                 * Check if current directory is at root and user clicks on\n-                 * '..\/' (index = 1) to move to prevoius directory then don't\n-                 * process the event.\n-                 * It is not possible to walk past root directory.\n-                 *\/\n-                File currentDirectory = getFileChooser().getCurrentDirectory();\n-                if (currentDirectory.getParentFile() == null && index == 1) {\n-                    return;\n-                }\n-\n@@ -995,0 +983,19 @@\n+\n+        @Override\n+        public Vector<File> getDirectories() {\n+            Vector<File> files = super.getDirectories();\n+\n+            \/*\n+             * Delete the \"\/..\" file entry from file chooser directory list in\n+             * GTK LAF if current directory is root and files vector contains\n+             * \"\/..\" entry.\n+             *\n+             * It is not possible to go beyond root directory.\n+             *\/\n+            File crntDir = getFileChooser().getCurrentDirectory();\n+            if (crntDir != null && crntDir.getParentFile() == null &&\n+                files.contains(new File(\"\/..\"))) {\n+                    files.removeElementAt(0);\n+            }\n+            return files;\n+        }\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/java\/swing\/plaf\/gtk\/GTKFileChooserUI.java","additions":20,"deletions":13,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -27,1 +27,2 @@\n- * @key headful\n+ * @library \/java\/awt\/regtesthelpers\n+ * @build PassFailJFrame\n@@ -29,2 +30,3 @@\n- * @summary Verifies if user is not able to select \"..\/\" beyond root file system\n- * @run main TestFileChooserDirectorySelection\n+ * @summary Verifies if user is not able to select \"..\/\" beyond\n+ * root file system.\n+ * @run main\/manual TestFileChooserDirectorySelection\n@@ -33,4 +35,0 @@\n-import java.io.File;\n-import java.awt.event.InputEvent;\n-import java.awt.Point;\n-import java.awt.Robot;\n@@ -42,1 +40,1 @@\n-public class TestFileChooserDirectorySelection  {\n+public class TestFileChooserDirectorySelection {\n@@ -44,2 +42,6 @@\n-    private static JFileChooser fileChooser;\n-    private static Robot robot;\n+    private static final String INSTRUCTIONS =\n+            \"Double click on the \\\"..\/\\\" entry from directory list.\\n\\n\" +\n+            \"Repeat the same process till the current directory is root \" +\n+            \"i.e \\\" \/ \\\" .\\n\\n\" +\n+            \"If \\\" ..\/ \\\" option is not available at root directory\" +\n+            \", press Pass else Fail.\";\n@@ -49,2 +51,2 @@\n-        robot = new Robot();\n-        robot.setAutoDelay(100);\n+        PassFailJFrame passFailJFrame = new PassFailJFrame(\n+                \"JFileChooser Test Instructions\", INSTRUCTIONS, 5, 8, 35);\n@@ -52,30 +54,3 @@\n-            SwingUtilities.invokeAndWait(() -> {\n-                createAndShowUI();\n-            });\n-\n-            robot.waitForIdle();\n-            robot.delay(1000);\n-            Point pt = frame.getLocationOnScreen();\n-            int i = 0;\n-            boolean passed = false;\n-            File crntDir = fileChooser.getCurrentDirectory();\n-            File prevDir = null;\n-            while (true) {\n-                prevDir = crntDir;\n-                doubleClickMouse(pt);\n-                crntDir = fileChooser.getCurrentDirectory();\n-                robot.delay(1000);\n-                \/\/ getParentFile() returns null for root directory\n-                if (prevDir == crntDir && crntDir.getParentFile() == null) {\n-                    passed = true;\n-                    break;\n-                } else if (++i > 5) {\n-                    break;\n-                }\n-            }\n-            robot.delay(1000);\n-            if (!passed)\n-                throw new RuntimeException(\"User is able to select ..\/ \" +\n-                        \"beyond root directory\");\n-            else\n-                System.out.println(\"passed\");\n+            SwingUtilities.invokeAndWait(\n+                    TestFileChooserDirectorySelection::createAndShowUI);\n+            passFailJFrame.awaitAndCheck();\n@@ -90,1 +65,0 @@\n-\n@@ -93,1 +67,5 @@\n-        fileChooser = new JFileChooser();\n+        JFileChooser fileChooser = new JFileChooser();\n+        fileChooser.setControlButtonsAreShown(false);\n+        PassFailJFrame.addTestWindow(frame);\n+        PassFailJFrame.positionTestWindow(\n+                frame, PassFailJFrame.Position.HORIZONTAL);\n@@ -95,2 +73,1 @@\n-        frame.setSize(500,500);\n-        frame.setLocationRelativeTo(null);\n+        frame.setSize(500, 500);\n@@ -100,10 +77,0 @@\n-\n-    private static void doubleClickMouse(Point p) {\n-        robot.mouseMove(p.x+75, p.y+frame.getHeight()\/2 - 90);\n-        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n-        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n-        robot.delay(100);\n-        robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n-        robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n-        robot.delay(1000);\n-    }\n","filename":"test\/jdk\/javax\/swing\/JFileChooser\/TestFileChooserDirectorySelection.java","additions":23,"deletions":56,"binary":false,"changes":79,"status":"modified"}]}