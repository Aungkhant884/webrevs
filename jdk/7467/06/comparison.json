{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -185,1 +185,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n@@ -280,1 +280,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n","filename":"src\/java.base\/linux\/classes\/sun\/nio\/fs\/LinuxDosFileAttributeView.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,1 +73,1 @@\n-            UnixNativeDispatcher.close(ifd);\n+            UnixNativeDispatcher.close(ifd, e -> null);\n@@ -299,3 +299,3 @@\n-            UnixNativeDispatcher.close(socketpair[0]);\n-            UnixNativeDispatcher.close(socketpair[1]);\n-            UnixNativeDispatcher.close(ifd);\n+            UnixNativeDispatcher.close(socketpair[0], e -> null);\n+            UnixNativeDispatcher.close(socketpair[1], e -> null);\n+            UnixNativeDispatcher.close(ifd, e -> null);\n","filename":"src\/java.base\/linux\/classes\/sun\/nio\/fs\/LinuxWatchService.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -189,1 +189,1 @@\n-                    close(sfd);\n+                    close(sfd, e -> null);\n@@ -213,1 +213,1 @@\n-                close(dfd);\n+                close(dfd, e -> null);\n@@ -291,1 +291,1 @@\n-                close(fo);\n+                close(fo, e -> null);\n@@ -301,1 +301,1 @@\n-            close(fi);\n+            close(fi, e -> null);\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixCopyFile.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -70,1 +70,1 @@\n-    protected final UnixPath directory() {\n+    final UnixPath directory() {\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixDirectoryStream.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -163,1 +163,1 @@\n-                close(fd);\n+                close(fd, e -> null);\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixFileAttributeViews.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -200,1 +200,1 @@\n-            UnixNativeDispatcher.close(fd);\n+            UnixNativeDispatcher.close(fd, e -> null);\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixFileStore.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -434,0 +434,3 @@\n+            IOException ioe = x.errno() == UnixConstants.ENOTDIR ?\n+                new NotDirectoryException(dir.getPathForExceptionMessage()) :\n+                x.asIOException(dir);\n@@ -435,1 +438,1 @@\n-                UnixNativeDispatcher.close(dfd1);\n+                UnixNativeDispatcher.close(dfd1, e -> null);\n@@ -437,4 +440,2 @@\n-                UnixNativeDispatcher.close(dfd2);\n-            if (x.errno() == UnixConstants.ENOTDIR)\n-                throw new NotDirectoryException(dir.getPathForExceptionMessage());\n-            x.rethrowAsIOException(dir);\n+                UnixNativeDispatcher.close(dfd2, e -> null);\n+            throw ioe;\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixFileSystemProvider.java","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,2 @@\n+import java.util.function.Function;\n+\n@@ -93,1 +95,1 @@\n-    static void close(int fd) {\n+    static void close(int fd) throws UnixException {\n@@ -98,1 +100,19 @@\n-    private static native void close0(int fd);\n+    private static native void close0(int fd) throws UnixException;\n+\n+    \/**\n+     * close(fd). If close fails then the given exception supplier function is\n+     * invoked to produce an exception to throw. If the function returns null\n+     * then no exception is thrown. If close fails and the exception supplier\n+     * function is null, then no exception is thrown.\n+     *\/\n+    static <X extends Throwable>\n+    void close(int fd, Function<UnixException, X> mapper) throws X {\n+        try {\n+            close(fd);\n+        } catch (UnixException e) {\n+            if (mapper != null) {\n+                X ex = mapper.apply(e);\n+                if (ex != null) throw ex;\n+            }\n+        }\n+    }\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixNativeDispatcher.java","additions":23,"deletions":3,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -64,1 +64,1 @@\n-                UnixNativeDispatcher.close(dfd);\n+                UnixNativeDispatcher.close(dfd, e -> e.asIOException(ds.directory()));\n@@ -120,0 +120,3 @@\n+                IOException ioe = x.errno() == UnixConstants.ENOTDIR ?\n+                    new NotDirectoryException(file.toString()) :\n+                    x.asIOException(file);\n@@ -121,1 +124,1 @@\n-                    UnixNativeDispatcher.close(newdfd1);\n+                    UnixNativeDispatcher.close(newdfd1, e -> null);\n@@ -123,4 +126,2 @@\n-                    UnixNativeDispatcher.close(newdfd2);\n-                if (x.errno() == UnixConstants.ENOTDIR)\n-                    throw new NotDirectoryException(file.toString());\n-                x.rethrowAsIOException(file);\n+                    UnixNativeDispatcher.close(newdfd1, e -> null);\n+                throw ioe;\n@@ -425,1 +426,1 @@\n-                        UnixNativeDispatcher.close(fd);\n+                        UnixNativeDispatcher.close(fd, e-> null);\n@@ -507,1 +508,1 @@\n-                        UnixNativeDispatcher.close(fd);\n+                        UnixNativeDispatcher.close(fd, e-> null);\n@@ -530,1 +531,1 @@\n-                        UnixNativeDispatcher.close(fd);\n+                        UnixNativeDispatcher.close(fd, e-> null);\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixSecureDirectoryStream.java","additions":11,"deletions":10,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -136,1 +136,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n@@ -160,1 +160,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n@@ -224,1 +224,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n@@ -286,1 +286,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n@@ -308,1 +308,1 @@\n-            close(fd);\n+            close(fd, e -> null);\n@@ -349,1 +349,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"src\/java.base\/unix\/classes\/sun\/nio\/fs\/UnixUserDefinedFileAttributeView.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"}]}