{"files":[{"patch":"@@ -45,1 +45,0 @@\n-import java.util.function.Function;\n@@ -70,0 +69,1 @@\n+import sun.swing.SwingAccessor;\n@@ -820,0 +820,12 @@\n+    \/\/ This method is called from the native in OutlineRowAccessibility.m\n+    private static Accessible getAccessibleCurrentAccessible(Accessible a, Component c) {\n+        if (a == null) return null;\n+        return invokeAndWait(() -> {\n+            AccessibleContext ac = a.getAccessibleContext();\n+            if (ac != null) {\n+                return SwingAccessor.getAccessibleComponentAccessor().getCurrentAccessible(ac);\n+            }\n+            return null;\n+        }, c);\n+    }\n+\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CAccessibility.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -35,3 +35,1 @@\n-static jclass sjc_CAccessible = NULL;\n-#define GET_CACCESSIBLE_CLASS_RETURN(ret) \\\n-    GET_CLASS_RETURN(sjc_CAccessible, \"sun\/lwawt\/macosx\/CAccessible\", ret);\n+static jclass sjc_CAccessibility = NULL;\n@@ -45,5 +43,3 @@\n-    jobject jAxContext = getAxContext(env, fAccessible, fComponent);\n-    if (jAxContext == NULL) return NULL;\n-    jclass axContextClass = (*env)->GetObjectClass(env, jAxContext);\n-    DECLARE_METHOD_RETURN(jm_getCurrentComponent, axContextClass, \"getCurrentComponent\", \"()Ljava\/awt\/Component;\", NULL);\n-    jobject newComponent = (*env)->CallObjectMethod(env, jAxContext, jm_getCurrentComponent);\n+    GET_CACCESSIBILITY_CLASS_RETURN(NULL);\n+    DECLARE_STATIC_METHOD_RETURN(sjm_getAccessibleCurrentAccessible, sjc_CAccessibility, \"getAccessibleCurrentAccessible\", \"(Ljavax\/accessibility\/Accessible;Ljava\/awt\/Component;)Ljavax\/accessibility\/Accessible;\", NULL);\n+    jobject currentAccessible = (*env)->CallStaticObjectMethod(env, sjc_CAccessibility, sjm_getAccessibleCurrentAccessible, fAccessible, fComponent);\n@@ -51,11 +47,1 @@\n-    (*env)->DeleteLocalRef(env, jAxContext);\n-    if (newComponent != NULL) {\n-        GET_CACCESSIBLE_CLASS_RETURN(NULL);\n-        DECLARE_STATIC_METHOD_RETURN(sjm_getCAccessible, sjc_CAccessible, \"getCAccessible\", \"(Ljavax\/accessibility\/Accessible;)Lsun\/lwawt\/macosx\/CAccessible;\", NULL);\n-        jobject currentAccessible = (*env)->CallStaticObjectMethod(env, sjc_CAccessible, sjm_getCAccessible, newComponent);\n-        CHECK_EXCEPTION();\n-        (*env)->DeleteLocalRef(env, newComponent);\n-        return currentAccessible;\n-    } else {\n-        return NULL;\n-    }\n+    return currentAccessible;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/a11y\/OutlineRowAccessibility.m","additions":5,"deletions":19,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -95,0 +95,1 @@\n+import sun.swing.SwingAccessor;\n@@ -4743,0 +4744,20 @@\n+            static {\n+                SwingAccessor.setAccessibleComponentAccessor(new AccessibleJTreeNodeAccessor());\n+            }\n+\n+            private static class AccessibleJTreeNodeAccessor implements SwingAccessor.AccessibleComponentAccessor {\n+\n+                private AccessibleJTreeNodeAccessor() {}\n+\n+                @Override\n+                public Accessible getCurrentAccessible(AccessibleContext ac) {\n+                    if (ac instanceof AccessibleJTreeNode) {\n+                        Component c = ((AccessibleJTreeNode) ac).getCurrentComponent();\n+                        if (c instanceof Accessible) {\n+                            return (Accessible)c;\n+                        }\n+                    }\n+                    return null;\n+                }\n+            }\n+\n","filename":"src\/java.desktop\/share\/classes\/javax\/swing\/JTree.java","additions":21,"deletions":0,"binary":false,"changes":21,"status":"modified"},{"patch":"@@ -28,1 +28,2 @@\n-import java.awt.*;\n+import java.awt.Component;\n+import java.awt.Point;\n@@ -30,1 +31,2 @@\n-import javax.swing.*;\n+import javax.accessibility.Accessible;\n+import javax.accessibility.AccessibleContext;\n@@ -32,0 +34,1 @@\n+import javax.swing.*;\n@@ -50,0 +53,23 @@\n+    \/**\n+     * This interface provides access to the renderer's accessibility component.\n+     * For example, the renderer of a list element, a table cell, or a tree node\n+     *\/\n+    public interface AccessibleComponentAccessor {\n+        Accessible getCurrentAccessible(AccessibleContext ac);\n+    }\n+\n+    private static AccessibleComponentAccessor accessibleComponentAccessor = null;\n+\n+    public static AccessibleComponentAccessor getAccessibleComponentAccessor() {\n+        var access = accessibleComponentAccessor;\n+        if (access == null) {\n+            ensureClassInitialized(JTree.class);\n+            access = accessibleComponentAccessor;\n+        }\n+        return access;\n+    }\n+\n+    public static void setAccessibleComponentAccessor(final AccessibleComponentAccessor accessibleAccessor) {\n+        accessibleComponentAccessor = accessibleAccessor;\n+    }\n+\n","filename":"src\/java.desktop\/share\/classes\/sun\/swing\/SwingAccessor.java","additions":28,"deletions":2,"binary":false,"changes":30,"status":"modified"}]}