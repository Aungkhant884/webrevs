{"files":[{"patch":"@@ -4073,2 +4073,2 @@\n-                                            KRegister ktmp1, AddressLiteral double_sign_flip,\n-                                            AddressLiteral max_long, Register scratch, int vec_enc) {\n+                                            KRegister ktmp1, KRegister ktmp2, AddressLiteral double_sign_flip,\n+                                            Register scratch, int vec_enc) {\n@@ -4083,2 +4083,2 @@\n-  evcmppd(ktmp1, k0, src, src, Assembler::UNORD_Q, vec_enc);\n-  evblendmpd(dst, ktmp1, dst, xtmp2, true, vec_enc);\n+  evcmppd(ktmp2, k0, src, src, Assembler::UNORD_Q, vec_enc);\n+  evmovdquq(dst, ktmp2, xtmp2, true, vec_enc);\n@@ -4086,1 +4086,1 @@\n-  evpcmpeqq(ktmp1, xtmp1, dst, vec_enc);\n+  kxorwl(ktmp1, ktmp1, ktmp2);\n@@ -4088,2 +4088,2 @@\n-  evmovdquq(xtmp1, max_long, vec_enc, scratch);\n-  evblendmpd(dst, ktmp1, dst, xtmp1, true, vec_enc);\n+  vpternlogq(xtmp2, 0x11, xtmp1, xtmp1, vec_enc);\n+  evmovdquq(dst, ktmp1, xtmp2, true, vec_enc);\n@@ -4094,2 +4094,2 @@\n-                                           XMMRegister xtmp2, XMMRegister xtmp3, AddressLiteral float_sign_flip,\n-                                           AddressLiteral max_int, Register scratch, int vec_enc) {\n+                                           XMMRegister xtmp2, XMMRegister xtmp3, XMMRegister xtmp4,\n+                                           AddressLiteral float_sign_flip, Register scratch, int vec_enc) {\n@@ -4100,2 +4100,1 @@\n-  vpmovmskb(scratch, xtmp2, vec_enc);\n-  testl(scratch, scratch);\n+  vptest(xtmp2, xtmp2, vec_enc);\n@@ -4104,1 +4103,1 @@\n-  vpxor(xtmp2, xtmp2, xtmp2, vec_enc);\n+  vpxor(xtmp4, xtmp4, xtmp4, vec_enc);\n@@ -4106,1 +4105,8 @@\n-  vblendvps(dst, dst, xtmp2, xtmp3, vec_enc);\n+  vblendvps(dst, dst, xtmp4, xtmp3, vec_enc);\n+\n+  vpxor(xtmp2, xtmp2, xtmp3, vec_enc);\n+  vpand(xtmp4, xtmp2, src, vec_enc);\n+  vpxor(xtmp3, xtmp2, xtmp4, vec_enc);\n+\n+  vpcmpeqd(xtmp4, xtmp4, xtmp4, vec_enc);\n+  vpxor(xtmp1, xtmp1, xtmp4, vec_enc);\n@@ -4108,5 +4114,0 @@\n-  vpcmpeqd(xtmp1, dst, xtmp1, vec_enc);\n-  vpand(xtmp2, xtmp1, src, vec_enc);\n-  vpxor(xtmp3, xtmp2, xtmp1, vec_enc);\n-  vpand(xtmp3, xtmp3, xtmp1, vec_enc);\n-  vmovdqu(xtmp1, max_int, scratch);\n@@ -4118,2 +4119,2 @@\n-                                            KRegister ktmp1, AddressLiteral float_sign_flip,\n-                                            AddressLiteral max_int, Register scratch, int vec_enc) {\n+                                            KRegister ktmp1, KRegister ktmp2, AddressLiteral float_sign_flip,\n+                                            Register scratch, int vec_enc) {\n@@ -4128,2 +4129,2 @@\n-  evcmpps(ktmp1, k0, src, src, Assembler::UNORD_Q, vec_enc);\n-  evblendmps(dst, ktmp1, dst, xtmp2, true, vec_enc);\n+  evcmpps(ktmp2, k0, src, src, Assembler::UNORD_Q, vec_enc);\n+  evmovdqul(dst, ktmp2, xtmp2, true, vec_enc);\n@@ -4131,1 +4132,1 @@\n-  Assembler::evpcmpeqd(ktmp1, k0, xtmp1, dst, vec_enc);\n+  kxorwl(ktmp1, ktmp1, ktmp2);\n@@ -4133,2 +4134,2 @@\n-  evmovdquq(xtmp1, max_int, vec_enc, scratch);\n-  evblendmps(dst, ktmp1, dst, xtmp1, true, vec_enc);\n+  vpternlogd(xtmp2, 0x11, xtmp1, xtmp1, vec_enc);\n+  evmovdqul(dst, ktmp1, xtmp2, true, vec_enc);\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":26,"deletions":25,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -293,2 +293,2 @@\n-                          XMMRegister xtmp2, XMMRegister xtmp3, AddressLiteral float_sign_flip,\n-                          AddressLiteral max_int, Register scratch, int vec_enc);\n+                          XMMRegister xtmp2, XMMRegister xtmp3, XMMRegister xtmp4,\n+                          AddressLiteral float_sign_flip, Register scratch, int vec_enc);\n@@ -297,2 +297,2 @@\n-                           KRegister ktmp1, AddressLiteral float_sign_flip,\n-                           AddressLiteral max_int, Register scratch, int vec_enc);\n+                           KRegister ktmp1, KRegister ktmp2, AddressLiteral float_sign_flip,\n+                           Register scratch, int vec_enc);\n@@ -301,2 +301,2 @@\n-                           KRegister ktmp1, AddressLiteral double_sign_flip,\n-                           AddressLiteral max_long, Register scratch, int vec_enc);\n+                           KRegister ktmp1, KRegister ktmp2, AddressLiteral double_sign_flip,\n+                           Register scratch, int vec_enc);\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.hpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -1387,2 +1387,0 @@\n-  static address vector_float_signmask() { return StubRoutines::x86::vector_float_sign_mask();}\n-  static address vector_double_signmask() { return StubRoutines::x86::vector_double_sign_mask();}\n@@ -7178,1 +7176,1 @@\n-instruct vcastFtoI_reg_avx(vec dst, vec src, vec xtmp1, vec xtmp2, vec xtmp3, rRegP scratch, rFlagsReg cr) %{\n+instruct vcastFtoI_reg_avx(vec dst, vec src, vec xtmp1, vec xtmp2, vec xtmp3, vec xtmp4, rRegP scratch, rFlagsReg cr) %{\n@@ -7183,2 +7181,2 @@\n-  effect(TEMP dst, TEMP xtmp1, TEMP xtmp2, TEMP xtmp3, TEMP scratch, KILL cr);\n-  format %{ \"vector_cast_f2i $dst,$src\\t! using $xtmp1, $xtmp2 and $xtmp3 as TEMP\" %}\n+  effect(TEMP dst, TEMP xtmp1, TEMP xtmp2, TEMP xtmp3, TEMP xtmp4, TEMP scratch, KILL cr);\n+  format %{ \"vector_cast_f2i $dst,$src\\t! using $xtmp1, $xtmp2, $xtmp3 and $xtmp4 as TEMP\" %}\n@@ -7188,2 +7186,2 @@\n-                          $xtmp2$$XMMRegister, $xtmp3$$XMMRegister, ExternalAddress(vector_float_signflip()),\n-                          ExternalAddress(vector_float_signmask()), $scratch$$Register, vlen_enc);\n+                          $xtmp2$$XMMRegister, $xtmp3$$XMMRegister, $xtmp4$$XMMRegister,\n+                          ExternalAddress(vector_float_signflip()), $scratch$$Register, vlen_enc);\n@@ -7194,1 +7192,1 @@\n-instruct vcastFtoI_reg_evex(vec dst, vec src, vec xtmp1, vec xtmp2, kReg ktmp1, rRegP scratch, rFlagsReg cr) %{\n+instruct vcastFtoI_reg_evex(vec dst, vec src, vec xtmp1, vec xtmp2, kReg ktmp1, kReg ktmp2, rRegP scratch, rFlagsReg cr) %{\n@@ -7199,2 +7197,2 @@\n-  effect(TEMP dst, TEMP xtmp1, TEMP xtmp2, TEMP ktmp1, TEMP scratch, KILL cr);\n-  format %{ \"vector_cast_f2i $dst,$src\\t! using $xtmp1, $xtmp2 and $ktmp1 as TEMP\" %}\n+  effect(TEMP dst, TEMP xtmp1, TEMP xtmp2, TEMP ktmp1, TEMP ktmp2, TEMP scratch, KILL cr);\n+  format %{ \"vector_cast_f2i $dst,$src\\t! using $xtmp1, $xtmp2, $ktmp1 and $ktmp2 as TEMP\" %}\n@@ -7204,2 +7202,2 @@\n-                           $xtmp2$$XMMRegister, $ktmp1$$KRegister, ExternalAddress(vector_float_signflip()),\n-                           ExternalAddress(vector_float_signmask()), $scratch$$Register, vlen_enc);\n+                           $xtmp2$$XMMRegister, $ktmp1$$KRegister, $ktmp2$$KRegister,\n+                           ExternalAddress(vector_float_signflip()), $scratch$$Register, vlen_enc);\n@@ -7221,1 +7219,1 @@\n-instruct vcastDtoL_reg_evex(vec dst, vec src, vec xtmp1, vec xtmp2, kReg ktmp1, rRegP scratch, rFlagsReg cr) %{\n+instruct vcastDtoL_reg_evex(vec dst, vec src, vec xtmp1, vec xtmp2, kReg ktmp1, kReg ktmp2, rRegP scratch, rFlagsReg cr) %{\n@@ -7224,2 +7222,2 @@\n-  effect(TEMP dst, TEMP xtmp1, TEMP xtmp2, TEMP ktmp1, TEMP scratch, KILL cr);\n-  format %{ \"vector_cast_d2l $dst,$src\\t! using $xtmp1, $xtmp2 and $ktmp1 as TEMP\" %}\n+  effect(TEMP dst, TEMP xtmp1, TEMP xtmp2, TEMP ktmp1, TEMP ktmp2, TEMP scratch, KILL cr);\n+  format %{ \"vector_cast_d2l $dst,$src\\t! using $xtmp1, $xtmp2, $ktmp1 and $ktmp2 as TEMP\" %}\n@@ -7229,2 +7227,2 @@\n-                           $xtmp2$$XMMRegister, $ktmp1$$KRegister, ExternalAddress(vector_double_signflip()),\n-                           ExternalAddress(vector_double_signmask()), $scratch$$Register, vlen_enc);\n+                           $xtmp2$$XMMRegister, $ktmp1$$KRegister, $ktmp2$$KRegister,\n+                           ExternalAddress(vector_double_signflip()), $scratch$$Register, vlen_enc);\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":15,"deletions":17,"binary":false,"changes":32,"status":"modified"}]}