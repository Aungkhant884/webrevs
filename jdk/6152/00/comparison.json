{"files":[{"patch":"@@ -242,1 +242,2 @@\n-      # Default is to calculate a string like this 'adhoc.<username>.<base dir name>'\n+      # Default is to calculate a string like this:\n+      # 'adhoc.<username>.<base dir name>[.<git branch>]'\n@@ -245,1 +246,9 @@\n-      VERSION_OPT=\"adhoc.$USERNAME.$basedirname\"\n+      if test x$GIT != x; then\n+        git_output=`cd $TOPDIR && $GIT rev-parse --abbrev-ref HEAD 2>\/dev\/null`\n+        if test x$git_output != xmaster; then\n+          git_branch=\".$git_output\"\n+        else\n+          git_branch=\n+        fi\n+      fi\n+      VERSION_OPT=\"adhoc.$USERNAME.$basedirname$git_branch\"\n@@ -268,2 +277,0 @@\n-      # FIXME: Until all code can cope with an empty VERSION_BUILD, set it to 0.\n-      VERSION_BUILD=0\n@@ -442,3 +449,10 @@\n-  # The complete version string, with additional build information\n-  if test \"x$VERSION_BUILD$VERSION_OPT\" = x; then\n-    VERSION_STRING=$VERSION_NUMBER${VERSION_PRE:+-$VERSION_PRE}\n+  # A build number of \"0\" is interpreted as \"no build number\".\n+  if test \"x$VERSION_BUILD\" = x0; then\n+    VERSION_BUILD=\n+  fi\n+\n+  # Compute the complete version string, with additional build information\n+  version_with_pre=$VERSION_NUMBER${VERSION_PRE:+-$VERSION_PRE}\n+  if test \"x$VERSION_BUILD\" != x || ( test \"x$VERSION_OPT\" != x && test \"x$VERSION_PRE\" = x ); then\n+    # As per JEP 223, if build is set, or if opt is set but not pre, we need a + separator\n+    version_with_build=$version_with_pre+$VERSION_BUILD\n@@ -446,2 +460,1 @@\n-    # If either build or opt is set, we need a + separator\n-    VERSION_STRING=$VERSION_NUMBER${VERSION_PRE:+-$VERSION_PRE}+$VERSION_BUILD${VERSION_OPT:+-$VERSION_OPT}\n+    version_with_build=$version_with_pre\n@@ -449,0 +462,1 @@\n+  VERSION_STRING=$version_with_build${VERSION_OPT:+-$VERSION_OPT}\n","filename":"make\/autoconf\/jdk-version.m4","additions":23,"deletions":9,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -66,1 +66,1 @@\n-  #error VERSION_BUILD must be defined\n+  #define VERSION_BUILD 0\n","filename":"src\/hotspot\/share\/runtime\/abstract_vm_version.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}