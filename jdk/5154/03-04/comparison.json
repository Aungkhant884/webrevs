{"files":[{"patch":"@@ -38,0 +38,1 @@\n+import java.util.concurrent.CountDownLatch;\n@@ -46,1 +47,2 @@\n-    private static final int INTERRUPT_DELAY_IN_MS = 10;\n+    private static final int INTERRUPT_DELAY_IN_MS = 50;\n+    private static final int DURATION_MAX_IN_MS = 3*INTERRUPT_DELAY_IN_MS;\n@@ -89,1 +91,2 @@\n-            Future<?> wakeup = pool.schedule(new Runnable() {\n+            final CountDownLatch interruptLatch = new CountDownLatch(1);\n+            Future<?> wakeup = pool.submit(new Runnable() {\n@@ -91,1 +94,6 @@\n-                    System.out.printf(\"Interrupting at %dms...%n\",\n+                    try {\n+                        interruptLatch.await();\n+                        Thread.sleep(INTERRUPT_DELAY_IN_MS);\n+                    } catch (InterruptedException ignore) {\n+                    }\n+                    System.out.printf(\"Interrupting at %d ms...%n\",\n@@ -94,4 +102,2 @@\n-                }},\n-                INTERRUPT_DELAY_IN_MS,\n-                java.util.concurrent.TimeUnit.MILLISECONDS\n-            );\n+                }\n+            });\n@@ -99,2 +105,3 @@\n-                System.out.printf(\"Copying file at %dms...%n\",\n-                    System.currentTimeMillis());\n+                interruptLatch.countDown();\n+                long theBeginning = System.currentTimeMillis();\n+                System.out.printf(\"Copying file at %d ms...%n\", theBeginning);\n@@ -102,3 +109,5 @@\n-                System.out.printf(\"Done copying at %dms...%n\",\n-                    System.currentTimeMillis());\n-                throw new RuntimeException(\"Copy was not interrupted\");\n+                long theEnd = System.currentTimeMillis();\n+                System.out.printf(\"Done copying at %d ms...%n\", theEnd);\n+                long duration = theEnd - theBeginning;\n+                if (duration > DURATION_MAX_IN_MS)\n+                    throw new RuntimeException(\"Copy was not interrupted\");\n@@ -118,0 +127,1 @@\n+            CountDownLatch cancelLatch = new CountDownLatch(1);\n@@ -120,1 +130,2 @@\n-                    System.out.printf(\"Copying file at %dms...%n\",\n+                    cancelLatch.countDown();\n+                    System.out.printf(\"Copying file at %d ms...%n\",\n@@ -124,1 +135,1 @@\n-                    System.out.printf(\"Done copying at %dms...%n\",\n+                    System.out.printf(\"Done copying at %d ms...%n\",\n@@ -130,0 +141,1 @@\n+                cancelLatch.await();\n@@ -131,1 +143,1 @@\n-            } catch (InterruptedException ignored) {\n+            } catch (InterruptedException ignore) {\n@@ -133,2 +145,0 @@\n-            System.out.printf(\"Cancelling at %dms...%n\",\n-                System.currentTimeMillis());\n@@ -137,0 +147,2 @@\n+            System.out.printf(\"Cancelling at %d ms...%n\",\n+                System.currentTimeMillis());\n","filename":"test\/jdk\/java\/nio\/file\/Files\/InterruptCopy.java","additions":29,"deletions":17,"binary":false,"changes":46,"status":"modified"}]}