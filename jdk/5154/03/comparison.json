{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2008, 2016, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2008, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -31,3 +31,10 @@\n-import java.nio.file.*;\n-import java.io.*;\n-import java.util.concurrent.*;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.nio.file.Files;\n+import java.nio.file.FileStore;\n+import java.nio.file.Path;\n+import java.nio.file.StandardCopyOption;\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.ScheduledExecutorService;\n@@ -38,3 +45,3 @@\n-    private static final long FILE_SIZE_TO_COPY = 512L * 1024L * 1024L;\n-    private static final int DELAY_IN_MS = 500;\n-    private static final int DURATION_MAX_IN_MS = 5000;\n+    private static final long FILE_SIZE_TO_COPY = 1024L * 1024L * 1024L;\n+    private static final int INTERRUPT_DELAY_IN_MS = 10;\n+    private static final int CANCEL_DELAY_IN_MS = 10;\n@@ -77,0 +84,1 @@\n+\n@@ -78,1 +86,2 @@\n-            \/\/ copy source to target in main thread, interrupting it after a delay\n+            \/\/ copy source to target in main thread, interrupting it\n+            \/\/ after a delay\n@@ -82,0 +91,2 @@\n+                    System.out.printf(\"Interrupting at %dms...%n\",\n+                        System.currentTimeMillis());\n@@ -83,2 +94,4 @@\n-                }}, DELAY_IN_MS, TimeUnit.MILLISECONDS);\n-            System.out.println(\"Copying file...\");\n+                }},\n+                INTERRUPT_DELAY_IN_MS,\n+                java.util.concurrent.TimeUnit.MILLISECONDS\n+            );\n@@ -86,1 +99,2 @@\n-                long start = System.currentTimeMillis();\n+                System.out.printf(\"Copying file at %dms...%n\",\n+                    System.currentTimeMillis());\n@@ -88,3 +102,3 @@\n-                long duration = System.currentTimeMillis() - start;\n-                if (duration > DURATION_MAX_IN_MS)\n-                    throw new RuntimeException(\"Copy was not interrupted\");\n+                System.out.printf(\"Done copying at %dms...%n\",\n+                    System.currentTimeMillis());\n+                throw new RuntimeException(\"Copy was not interrupted\");\n@@ -95,1 +109,1 @@\n-                System.out.println(\"Copy failed (this is expected)\");\n+                System.out.println(\"Copy failed (this is expected).\");\n@@ -102,2 +116,2 @@\n-            \/\/ copy source to target via task in thread pool, interrupting it after\n-            \/\/ a delay using cancel(true)\n+            \/\/ copy source to target via task in thread pool, interrupting it\n+            \/\/ after a delay using cancel(true)\n@@ -106,1 +120,2 @@\n-                    System.out.println(\"Copying file...\");\n+                    System.out.printf(\"Copying file at %dms...%n\",\n+                        System.currentTimeMillis());\n@@ -109,0 +124,2 @@\n+                    System.out.printf(\"Done copying at %dms...%n\",\n+                        System.currentTimeMillis());\n@@ -112,3 +129,12 @@\n-            Thread.sleep(DELAY_IN_MS);\n-            boolean cancelled = result.cancel(true);\n-            if (!cancelled)\n+            try {\n+                Thread.sleep(CANCEL_DELAY_IN_MS);\n+            } catch (InterruptedException ignored) {\n+            }\n+            System.out.printf(\"Cancelling at %dms...%n\",\n+                System.currentTimeMillis());\n+            if (result.isDone())\n+                throw new RuntimeException(\"Copy finished before cancellation\");\n+            boolean cancelled  = result.cancel(true);\n+            if (cancelled)\n+                System.out.println(\"Copy cancelled.\");\n+            else {\n@@ -116,1 +142,2 @@\n-            System.out.println(\"Copy cancelled.\");\n+                throw new RuntimeException(\"Copy was not cancelled\");\n+            }\n","filename":"test\/jdk\/java\/nio\/file\/Files\/InterruptCopy.java","additions":49,"deletions":22,"binary":false,"changes":71,"status":"modified"}]}