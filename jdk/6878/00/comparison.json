{"files":[{"patch":"@@ -229,0 +229,7 @@\n+# For reproducible builds specify the jmod --date using SOURCE_DATE in ISO-8601\n+ifeq ($(ENABLE_REPRODUCIBLE_BUILD), true)\n+  JMOD_SOURCE_DATE := --date $(SOURCE_DATE_ISO_8601)\n+else\n+  JMOD_SOURCE_DATE :=\n+endif\n+\n@@ -240,0 +247,1 @@\n+        $(JMOD_SOURCE_DATE) \\\n","filename":"make\/CreateJmods.gmk","additions":8,"deletions":0,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -382,0 +382,10 @@\n+  # Determine if the boot jdk jar supports the --date option\n+  if $JAR --help 2>&1 | $GREP -q \"\\-\\-date=TIMESTAMP\"; then\n+    BOOT_JDK_JAR_SUPPORTS_DATE=true\n+  else\n+    BOOT_JDK_JAR_SUPPORTS_DATE=false\n+  fi\n+  AC_MSG_CHECKING([if Boot JDK jar supports --date=TIMESTAMP])\n+  AC_MSG_RESULT([$BOOT_JDK_JAR_SUPPORTS_DATE])\n+  AC_SUBST(BOOT_JDK_JAR_SUPPORTS_DATE)\n+\n","filename":"make\/autoconf\/boot-jdk.m4","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -374,0 +374,3 @@\n+# Whether the boot jdk jar supports --date=TIMESTAMP\n+BOOT_JDK_JAR_SUPPORTS_DATE:=@BOOT_JDK_JAR_SUPPORTS_DATE@\n+\n","filename":"make\/autoconf\/spec.gmk.in","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -242,1 +242,1 @@\n-    timestamp=$($DATE -j -f \"%F %T\" \"$2\" \"+%s\" 2> \/dev\/null)\n+    timestamp=$($DATE -u -j -f \"%F %T\" \"$2\" \"+%s\" 2> \/dev\/null)\n@@ -245,1 +245,1 @@\n-      timestamp=$($DATE -j -f \"%F %T\" \"$2 00:00:00\" \"+%s\" 2> \/dev\/null)\n+      timestamp=$($DATE -u -j -f \"%F %T\" \"$2 00:00:00\" \"+%s\" 2> \/dev\/null)\n","filename":"make\/autoconf\/util.m4","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2019, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -196,1 +196,1 @@\n-        $$($1_JAR_CMD) $$($1_JAR_UPDATE_OPTIONS) $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents; \\\n+        $$($1_JAR_CMD) --update $$($1_JAR_OPTIONS) --file $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents; \\\n@@ -215,1 +215,1 @@\n-  $1_SUPDATE_CONTENTS=$$($1_JAR_CMD) $$($1_JAR_UPDATE_OPTIONS) $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents $$(NEWLINE)\n+  $1_SUPDATE_CONTENTS=$$($1_JAR_CMD) --update $$($1_JAR_OPTIONS) --file $$@ @$$($1_BIN)\/_the.$$($1_JARNAME)_contents $$(NEWLINE)\n@@ -220,0 +220,8 @@\n+  # If reproducible build and the boot jdk jar supports --date\n+  # then specify the --date using SOURCE_DATE in ISO-8601\n+  $1_JAR_SOURCE_DATE :=\n+  ifeq ($$(ENABLE_REPRODUCIBLE_BUILD), true)\n+    ifeq ($$(BOOT_JDK_JAR_SUPPORTS_DATE), true)\n+      $1_JAR_SOURCE_DATE := --date $(SOURCE_DATE_ISO_8601)\n+    endif\n+  endif\n@@ -221,2 +229,1 @@\n-    $1_JAR_CREATE_OPTIONS := c0fm\n-    $1_JAR_UPDATE_OPTIONS := u0f\n+    $1_JAR_OPTIONS := --no-compress $$($1_JAR_SOURCE_DATE)\n@@ -224,2 +231,1 @@\n-      $1_JAR_CREATE_OPTIONS := cfm\n-      $1_JAR_UPDATE_OPTIONS := uf\n+      $1_JAR_OPTIONS := $$($1_JAR_SOURCE_DATE)\n@@ -228,2 +234,1 @@\n-    $1_JAR_CREATE_OPTIONS := cfm\n-    $1_JAR_UPDATE_OPTIONS := uf\n+    $1_JAR_OPTIONS := $$($1_JAR_SOURCE_DATE)\n@@ -233,1 +238,1 @@\n-  $1_VARDEPS := $$($1_JAR_CMD) $$($1_JAR_CREATE_OPTIONS) $$($1_MANIFEST) \\\n+  $1_VARDEPS := $$($1_JAR_CMD) $$($1_JAR_OPTIONS) $$($1_MANIFEST) \\\n@@ -258,1 +263,1 @@\n-\t  $$($1_JAR_CMD) $$($1_JAR_CREATE_OPTIONS) $$@ $$($1_MANIFEST_FILE) $$(NEWLINE) \\\n+\t  $$($1_JAR_CMD) --create $$($1_JAR_OPTIONS) --file $$@ --manifest $$($1_MANIFEST_FILE) $$(NEWLINE) \\\n","filename":"make\/common\/JarArchive.gmk","additions":16,"deletions":11,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n-# Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+# Copyright (c) 2011, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -143,0 +143,11 @@\n+# If reproducible builds are enabled then set SOURCE_DATE_ISO_8601 string variable\n+ifeq ($(ENABLE_REPRODUCIBLE_BUILD), true)\n+  SOURCE_DATE_ISO_8601 := $(shell $(DATE) --utc --date=\"@$(SOURCE_DATE_EPOCH)\" +\"%Y-%m-%dT%H:%M:%SZ\" 2> \/dev\/null)\n+  ifeq ($(SOURCE_DATE_ISO_8601), )\n+    # GNU date format did not work, try BSD date options\n+    SOURCE_DATE_ISO_8601 := $(shell $(DATE) -u -j -f \"%s\" \"$(SOURCE_DATE_EPOCH)\" +\"%Y-%m-%dT%H:%M:%SZ\" 2> \/dev\/null)\n+  endif\n+endif\n+\n+################################################################################\n+\n","filename":"make\/common\/MakeBase.gmk","additions":12,"deletions":1,"binary":false,"changes":13,"status":"modified"}]}