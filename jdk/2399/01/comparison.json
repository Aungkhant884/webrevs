{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -230,1 +230,1 @@\n-               if (compress_level == null) {\n+               if (compress_level.length() == 0) {\n","filename":"src\/jdk.jcmd\/share\/classes\/sun\/tools\/jmap\/JMap.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -121,0 +121,1 @@\n+        testDumpIllegalCompressedArgs();\n@@ -233,0 +234,7 @@\n+    private static void testDumpIllegalCompressedArgs() throws Exception{\n+        dump(true, false, true, \"0\", 1, \"Compression level out of range\");\n+        dump(true, false, true, \"100\", 1, \"Compression level out of range\");\n+        dump(true, false, true, \"abc\", 1, \"Invalid compress level\");\n+        dump(true, false, true, \"\", 1, \"Fail: no number provided in option:\");\n+    }\n+\n@@ -234,0 +242,9 @@\n+        dump(live, explicitAll, compressed, \"1\", 0, \"Heap dump file created\");\n+    }\n+\n+    private static void dump(boolean live,\n+                             boolean explicitAll,\n+                             boolean compressed,\n+                             String compressLevel,\n+                             int expExitValue,\n+                             String expOutput) throws Exception {\n@@ -251,1 +268,1 @@\n-            compressArg = \"gz=1,\";\n+            compressArg = \"gz=\" + compressLevel;\n@@ -259,1 +276,1 @@\n-        fileArg = \"file=\" + file.getName();\n+        fileArg = \"file=\" + file.getName() + \",\";\n@@ -262,1 +279,1 @@\n-        allArgs = allArgs + liveArg + compressArg + \"format=b,\" + fileArg;\n+        allArgs = allArgs + liveArg + \"format=b,\" + fileArg + compressArg;\n@@ -264,3 +281,5 @@\n-        output.shouldHaveExitValue(0);\n-        output.shouldContain(\"Heap dump file created\");\n-        verifyDumpFile(file);\n+        output.shouldHaveExitValue(expExitValue);\n+        output.shouldContain(expOutput);\n+        if (expExitValue == 0) {\n+            verifyDumpFile(file);\n+        }\n","filename":"test\/jdk\/sun\/tools\/jmap\/BasicJMapTest.java","additions":26,"deletions":7,"binary":false,"changes":33,"status":"modified"}]}