{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -181,1 +181,1 @@\n-                        mres.withDoNotResolveByDefault();\n+                        mres = mres.withDoNotResolveByDefault();\n","filename":"src\/jdk.jartool\/share\/classes\/sun\/tools\/jar\/GNUStyleOptions.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,0 +26,1 @@\n+import java.lang.module.ModuleFinder;\n@@ -32,0 +33,1 @@\n+import java.util.function.Predicate;\n@@ -41,0 +43,2 @@\n+import jdk.internal.module.ModuleReferenceImpl;\n+import jdk.internal.module.ModuleResolution;\n@@ -56,0 +60,1 @@\n+ *          java.base\/jdk.internal.module\n@@ -945,0 +950,131 @@\n+    @DataProvider(name = \"resolutionWarnings\")\n+    public Object[][] resolutionWarnings() {\n+        return new Object[][] {\n+            {\"incubating\", (Predicate<ModuleResolution>) ModuleResolution::hasIncubatingWarning},\n+            {\"deprecated\", (Predicate<ModuleResolution>) ModuleResolution::hasDeprecatedWarning},\n+            {\"deprecated-for-removal\",\n+                (Predicate<ModuleResolution>) ModuleResolution::hasDeprecatedForRemovalWarning}\n+        };\n+    }\n+\n+    \/**\n+     * Validate that you can create a jar only specifying --warn-if-resolved\n+     * @throws IOException\n+     *\/\n+    @Test(dataProvider = \"resolutionWarnings\")\n+    public void shouldAddWarnIfResolved(String resolutionName,\n+                                        Predicate<ModuleResolution> hasWarning) throws IOException {\n+        Path mp = Paths.get(\"moduleWarnIfResolved-\" + resolutionName);\n+        createTestDir(mp);\n+        Path modClasses = MODULE_CLASSES.resolve(FOO.moduleName);\n+        Path modularJar = mp.resolve(FOO.moduleName + \".jar\");\n+\n+        jar(\"--create\",\n+            \"--file=\" + modularJar.toString(),\n+            \"--main-class=\" + FOO.mainClass,\n+            \"--warn-if-resolved=\" + resolutionName,\n+            \"--no-manifest\",\n+            \"-C\", modClasses.toString(), \".\")\n+            .assertSuccess();\n+\n+        ModuleReferenceImpl moduleReference = ModuleFinder.of(modularJar)\n+            .find(FOO.moduleName)\n+            .map(ModuleReferenceImpl.class::cast)\n+            .orElseThrow();\n+        ModuleResolution moduleResolution = moduleReference.moduleResolution();\n+\n+        assertTrue(hasWarning.test(moduleResolution));\n+    }\n+\n+    \/**\n+     * Validate that you can create a jar only specifying --do-not-resolve-by-default\n+     * @throws IOException\n+     *\/\n+    @Test\n+    public void shouldAddDoNotResolveByDefault() throws IOException {\n+        Path mp = Paths.get(\"moduleDoNotResolveByDefault\");\n+        createTestDir(mp);\n+        Path modClasses = MODULE_CLASSES.resolve(FOO.moduleName);\n+        Path modularJar = mp.resolve(FOO.moduleName + \".jar\");\n+\n+        jar(\"--create\",\n+            \"--file=\" + modularJar.toString(),\n+            \"--main-class=\" + FOO.mainClass,\n+            \"--do-not-resolve-by-default\",\n+            \"--no-manifest\",\n+            \"-C\", modClasses.toString(), \".\")\n+            .assertSuccess();\n+\n+        ModuleReferenceImpl moduleReference = ModuleFinder.of(modularJar)\n+            .find(FOO.moduleName)\n+            .map(ModuleReferenceImpl.class::cast)\n+            .orElseThrow();\n+        ModuleResolution moduleResolution = moduleReference.moduleResolution();\n+\n+        assertTrue(moduleResolution.doNotResolveByDefault());\n+    }\n+\n+    \/**\n+     * Validate that you can create a jar specifying --warn-if-resolved and\n+     * --do-not-resolve-by-default\n+     * @throws IOException\n+     *\/\n+    @Test(dataProvider = \"resolutionWarnings\")\n+    public void shouldAddWarnIfResolvedAndDoNotResolveByDefault(String resolutionName,\n+                                        Predicate<ModuleResolution> hasWarning) throws IOException {\n+        Path mp = Paths.get(\"moduleResolutionWarnThenNotResolve-\" + resolutionName);\n+        createTestDir(mp);\n+        Path modClasses = MODULE_CLASSES.resolve(FOO.moduleName);\n+        Path modularJar = mp.resolve(FOO.moduleName + \".jar\");\n+\n+        jar(\"--create\",\n+            \"--file=\" + modularJar.toString(),\n+            \"--main-class=\" + FOO.mainClass,\n+            \"--warn-if-resolved=\" + resolutionName,\n+            \"--do-not-resolve-by-default\",\n+            \"--no-manifest\",\n+            \"-C\", modClasses.toString(), \".\")\n+            .assertSuccess();\n+\n+        ModuleReferenceImpl moduleReference = ModuleFinder.of(modularJar)\n+            .find(FOO.moduleName)\n+            .map(ModuleReferenceImpl.class::cast)\n+            .orElseThrow();\n+        ModuleResolution moduleResolution = moduleReference.moduleResolution();\n+\n+        assertTrue(hasWarning.test(moduleResolution));\n+        assertTrue(moduleResolution.doNotResolveByDefault());\n+    }\n+\n+    \/**\n+     * Validate that you can create a jar specifying --do-not-resolve-by-default and\n+     * --warn-if-resolved\n+     * @throws IOException\n+     *\/\n+    @Test(dataProvider = \"resolutionWarnings\")\n+    public void shouldAddResolutionDoNotResolveByDefaultAndWarnIfResolved(String resolutionName,\n+                                        Predicate<ModuleResolution> hasWarning) throws IOException {\n+        Path mp = Paths.get(\"moduleResolutionNotResolveThenWarn-\" + resolutionName);\n+        createTestDir(mp);\n+        Path modClasses = MODULE_CLASSES.resolve(FOO.moduleName);\n+        Path modularJar = mp.resolve(FOO.moduleName + \".jar\");\n+\n+        jar(\"--create\",\n+            \"--file=\" + modularJar.toString(),\n+            \"--main-class=\" + FOO.mainClass,\n+            \"--do-not-resolve-by-default\",\n+            \"--warn-if-resolved=\" + resolutionName,\n+            \"--no-manifest\",\n+            \"-C\", modClasses.toString(), \".\")\n+            .assertSuccess();\n+\n+        ModuleReferenceImpl moduleReference = ModuleFinder.of(modularJar)\n+            .find(FOO.moduleName)\n+            .map(ModuleReferenceImpl.class::cast)\n+            .orElseThrow();\n+        ModuleResolution moduleResolution = moduleReference.moduleResolution();\n+\n+        assertTrue(hasWarning.test(moduleResolution));\n+        assertTrue(moduleResolution.doNotResolveByDefault());\n+    }\n+\n","filename":"test\/jdk\/tools\/jar\/modularJar\/Basic.java","additions":137,"deletions":1,"binary":false,"changes":138,"status":"modified"}]}