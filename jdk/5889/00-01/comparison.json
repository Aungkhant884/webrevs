{"files":[{"patch":"@@ -29,0 +29,2 @@\n+ * @requires vm.compMode != \"Xint\"\n+ * @requires vm.compiler1.enabled | vm.compiler2.enabled\n@@ -32,1 +34,0 @@\n- * @build compiler.jvmti.TriggerBuiltinExceptionsTest\n@@ -59,2 +60,2 @@\n-    private static final int ITERATIONS = 30;           \/\/Arbitrary value, feel free to change\n-    private static final long COMP_TIMEOUT = 2000L;     \/\/Arbitrary value, feel free to change (millis)\n+    private static final int ITERATIONS = 30;           \/\/ Arbitrary value, feel free to change\n+    private static final long COMP_TIMEOUT = 2000L;     \/\/ Arbitrary value, feel free to change (millis)\n@@ -102,1 +103,1 @@\n-        TriggerBuiltinExceptionsTest.compileMethodOrThrow(method);\n+        compileMethodOrThrow(method);\n@@ -113,1 +114,1 @@\n-            TriggerBuiltinExceptionsTest.methodToCompile(i, src, dst);\n+            methodToCompile(i, src, dst);\n@@ -120,1 +121,1 @@\n-        TriggerBuiltinExceptionsTest.compileMethodOrThrow(method);\n+        compileMethodOrThrow(method);\n@@ -124,1 +125,1 @@\n-            TriggerBuiltinExceptionsTest.methodToCompile(i, src, dst);\n+            methodToCompile(i, src, dst);\n@@ -128,1 +129,1 @@\n-                TriggerBuiltinExceptionsTest.caughtByJVMTIAgent(), caughtByJavaTest,\n+                caughtByJVMTIAgent(), caughtByJavaTest,\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmti\/TriggerBuiltinExceptionsTest.java","additions":9,"deletions":8,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -43,1 +43,0 @@\n-    bool successful = true;\n@@ -45,6 +44,5 @@\n-    do {\n-        result = jvm->GetEnv((void **) (&jvmti), JVMTI_VERSION);\n-        if (result != JNI_OK) {\n-            printf(\"Agent_OnLoad: Error in GetEnv in obtaining jvmtiEnv: %d\\n\", result);\n-            break;\n-        }\n+    result = jvm->GetEnv((void **) (&jvmti), JVMTI_VERSION);\n+    if (result != JNI_OK) {\n+        printf(\"Agent_OnLoad: Error in GetEnv in obtaining jvmtiEnv: %d\\n\", result);\n+        return JNI_ERR;\n+    }\n@@ -52,3 +50,3 @@\n-        jvmtiEventCallbacks callbacks;\n-        memset(&callbacks, 0, sizeof(callbacks));\n-        callbacks.Exception = &callbackException;\n+    jvmtiEventCallbacks callbacks;\n+    memset(&callbacks, 0, sizeof(callbacks));\n+    callbacks.Exception = &callbackException;\n@@ -56,5 +54,5 @@\n-        result = jvmti->SetEventCallbacks(&callbacks, sizeof(jvmtiEventCallbacks));\n-        if (result != JVMTI_ERROR_NONE) {\n-            printf(\"Agent_OnLoad: Error in JVMTI SetEventCallbacks: %d\\n\", result);\n-            break;\n-        }\n+    result = jvmti->SetEventCallbacks(&callbacks, sizeof(jvmtiEventCallbacks));\n+    if (result != JVMTI_ERROR_NONE) {\n+        printf(\"Agent_OnLoad: Error in JVMTI SetEventCallbacks: %d\\n\", result);\n+        return JNI_ERR;\n+    }\n@@ -62,8 +60,8 @@\n-        jvmtiCapabilities capabilities;\n-        memset(&capabilities, 0, sizeof(capabilities));\n-        capabilities.can_generate_exception_events = 1;\n-        result = jvmti->AddCapabilities(&capabilities);\n-        if (result != JVMTI_ERROR_NONE) {\n-            printf(\"Agent_OnLoad: Error in JVMTI AddCapabilities: %d\\n\", result);\n-            break;\n-        }\n+    jvmtiCapabilities capabilities;\n+    memset(&capabilities, 0, sizeof(capabilities));\n+    capabilities.can_generate_exception_events = 1;\n+    result = jvmti->AddCapabilities(&capabilities);\n+    if (result != JVMTI_ERROR_NONE) {\n+        printf(\"Agent_OnLoad: Error in JVMTI AddCapabilities: %d\\n\", result);\n+        return JNI_ERR;\n+    }\n@@ -71,5 +69,5 @@\n-        result = jvmti->SetEventNotificationMode(JVMTI_ENABLE, JVMTI_EVENT_EXCEPTION, (jthread)NULL);\n-        if (result != JVMTI_ERROR_NONE) {\n-            printf(\"Agent_OnLoad: Error in JVMTI SetEventNotificationMode: %d\\n\", result);\n-            break;\n-        }\n+    result = jvmti->SetEventNotificationMode(JVMTI_ENABLE, JVMTI_EVENT_EXCEPTION, (jthread)NULL);\n+    if (result != JVMTI_ERROR_NONE) {\n+        printf(\"Agent_OnLoad: Error in JVMTI SetEventNotificationMode: %d\\n\", result);\n+        return JNI_ERR;\n+    }\n@@ -77,3 +75,1 @@\n-    } while (false);\n-\n-    return (result == JNI_OK) || (result == JVMTI_ERROR_NONE) ? JNI_OK : JNI_ERR;\n+    return JNI_OK;\n","filename":"test\/hotspot\/jtreg\/compiler\/jvmti\/libTriggerBuiltinExceptions.cpp","additions":27,"deletions":31,"binary":false,"changes":58,"status":"modified"}]}