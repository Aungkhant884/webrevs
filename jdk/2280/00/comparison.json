{"files":[{"patch":"@@ -578,4 +578,1 @@\n-    \/\/ DefNew needs to run with n_threads == 0, to make sure the serial\n-    \/\/ version of the card table scanning code is used.\n-    \/\/ See: CardTableRS::non_clean_card_iterate_possibly_parallel.\n-    StrongRootsScope srs(0);\n+    StrongRootsScope srs(1);\n@@ -583,2 +580,1 @@\n-    heap->young_process_roots(&srs,\n-                              &scan_closure,\n+    heap->young_process_roots(&scan_closure,\n","filename":"src\/hotspot\/share\/gc\/serial\/defNewGeneration.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -92,2 +92,1 @@\n-void SerialHeap::young_process_roots(StrongRootsScope* scope,\n-                                     OopIterateClosure* root_closure,\n+void SerialHeap::young_process_roots(OopIterateClosure* root_closure,\n@@ -98,1 +97,1 @@\n-  process_roots(scope, SO_ScavengeCodeCache, root_closure,\n+  process_roots(SO_ScavengeCodeCache, root_closure,\n@@ -102,3 +101,1 @@\n-  old_gen()->younger_refs_iterate(old_gen_closure, scope->n_threads());\n-\n-  _process_strong_tasks->all_tasks_completed(scope->n_threads());\n+  old_gen()->younger_refs_iterate(old_gen_closure, 0);\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.cpp","additions":3,"deletions":6,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -80,2 +80,1 @@\n-  void young_process_roots(StrongRootsScope* scope,\n-                           OopIterateClosure* root_closure,\n+  void young_process_roots(OopIterateClosure* root_closure,\n","filename":"src\/hotspot\/share\/gc\/serial\/serialHeap.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -102,1 +102,0 @@\n-  _process_strong_tasks(new SubTasksDone(GCH_PS_NumElements)),\n@@ -549,3 +548,1 @@\n-  assert(my_thread->is_VM_thread() ||\n-         my_thread->is_ConcurrentGC_thread(),\n-         \"incorrect thread type capability\");\n+  assert(my_thread->is_VM_thread(), \"only VM thread\");\n@@ -798,2 +795,1 @@\n-void GenCollectedHeap::process_roots(StrongRootsScope* scope,\n-                                     ScanningOption so,\n+void GenCollectedHeap::process_roots(ScanningOption so,\n@@ -806,4 +802,0 @@\n-  \/\/ _n_termination for _process_strong_tasks should be set up stream\n-  \/\/ in a method not running in a GC worker.  Otherwise the GC worker\n-  \/\/ could be trying to change the termination condition while the task\n-  \/\/ is executing in another GC worker.\n@@ -811,1 +803,1 @@\n-  if (_process_strong_tasks->try_claim_task(GCH_PS_ClassLoaderDataGraph_oops_do)) {\n+  {\n@@ -818,2 +810,1 @@\n-  bool is_par = scope->n_threads() > 1;\n-  Threads::possibly_parallel_oops_do(is_par, strong_roots, roots_from_code_p);\n+  Threads::oops_do(strong_roots, roots_from_code_p);\n@@ -822,1 +813,1 @@\n-  if (_process_strong_tasks->try_claim_task(GCH_PS_aot_oops_do)) {\n+  {\n@@ -828,1 +819,1 @@\n-  if (_process_strong_tasks->try_claim_task(GCH_PS_OopStorageSet_oops_do)) {\n+  {\n@@ -832,1 +823,1 @@\n-  if (_process_strong_tasks->try_claim_task(GCH_PS_CodeCache_oops_do)) {\n+  {\n@@ -862,2 +853,1 @@\n-  process_roots(scope, so, root_closure, cld_closure, weak_cld_closure, &mark_code_closure);\n-  _process_strong_tasks->all_tasks_completed(scope->n_threads());\n+  process_roots(so, root_closure, cld_closure, weak_cld_closure, &mark_code_closure);\n","filename":"src\/hotspot\/share\/gc\/shared\/genCollectedHeap.cpp","additions":8,"deletions":18,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -106,14 +106,0 @@\n-  \/\/ The set of potentially parallel tasks in root scanning.\n-  enum GCH_strong_roots_tasks {\n-    GCH_PS_OopStorageSet_oops_do,\n-    GCH_PS_ClassLoaderDataGraph_oops_do,\n-    GCH_PS_CodeCache_oops_do,\n-    AOT_ONLY(GCH_PS_aot_oops_do COMMA)\n-    \/\/ Leave this one last.\n-    GCH_PS_NumElements\n-  };\n-\n-  \/\/ Data structure for claiming the (potentially) parallel tasks in\n-  \/\/ (gen-specific) roots processing.\n-  SubTasksDone* _process_strong_tasks;\n-\n@@ -360,2 +346,1 @@\n-  void process_roots(StrongRootsScope* scope,\n-                     ScanningOption so,\n+  void process_roots(ScanningOption so,\n","filename":"src\/hotspot\/share\/gc\/shared\/genCollectedHeap.hpp","additions":1,"deletions":16,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -40,1 +40,4 @@\n-  Threads::change_thread_claim_token();\n+  \/\/ no need for thread claim for sequential case\n+  if (_n_threads > 1) {\n+    Threads::change_thread_claim_token();\n+  }\n@@ -44,1 +47,3 @@\n-  Threads::assert_all_threads_claimed();\n+  if (_n_threads > 1) {\n+    Threads::assert_all_threads_claimed();\n+  }\n","filename":"src\/hotspot\/share\/gc\/shared\/strongRootsScope.cpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -36,2 +36,1 @@\n-\/\/ Sets up and tears down the required state for parallel root processing.\n-\n+\/\/ Sets up and tears down the required state for sequential\/parallel root processing.\n","filename":"src\/hotspot\/share\/gc\/shared\/strongRootsScope.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}