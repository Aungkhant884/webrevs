{"files":[{"patch":"@@ -1703,1 +1703,18 @@\n-\/\/ granularity is 1, 2 bytes per load\n+\/\/ granularity is 1 OR 2 bytes per load. dst and src.base() allowed to be the same register\n+void MacroAssembler::load_short_misaligned(Register dst, Address src, Register tmp, bool is_signed, int granularity) {\n+  if (granularity != 1 && granularity != 2) {\n+    ShouldNotReachHere();\n+  }\n+  if (AvoidUnalignedAccesses && (granularity != 2)) {\n+    assert_different_registers(dst, tmp);\n+    assert_different_registers(tmp, src.base());\n+    is_signed ? lb(tmp, Address(src.base(), src.offset() + 1)) : lbu(tmp, Address(src.base(), src.offset() + 1));\n+    slli(tmp, tmp, 8);\n+    lbu(dst, src);\n+    add(dst, dst, tmp);\n+  } else {\n+    is_signed ? lh(dst, src) : lhu(dst, src);\n+  }\n+}\n+\n+\/\/ granularity is 1, 2 OR 4 bytes per load, if granularity 2 or 4 then dst and src.base() allowed to be the same register\n@@ -1706,1 +1723,0 @@\n-    assert_different_registers(dst, tmp, src.base());\n@@ -1709,0 +1725,1 @@\n+        assert_different_registers(dst, tmp, src.base());\n@@ -1721,1 +1738,2 @@\n-        lhu(dst, src);\n+        assert_different_registers(dst, tmp);\n+        assert_different_registers(tmp, src.base());\n@@ -1724,0 +1742,1 @@\n+        lhu(dst, src);\n@@ -1734,1 +1753,1 @@\n-\/\/ granularity is 1, 2 or 4 bytes per load\n+\/\/ granularity is 1, 2, 4 or 8 bytes per load, if granularity 4 or 8 then dst and src.base() allowed to be same register\n@@ -1737,1 +1756,0 @@\n-    assert_different_registers(dst, tmp, src.base());\n@@ -1740,0 +1758,1 @@\n+        assert_different_registers(dst, tmp, src.base());\n@@ -1764,0 +1783,1 @@\n+        assert_different_registers(dst, tmp, src.base());\n@@ -1776,1 +1796,2 @@\n-        lwu(dst, src);\n+        assert_different_registers(dst, tmp);\n+        assert_different_registers(tmp, src.base());\n@@ -1779,0 +1800,1 @@\n+        lwu(dst, src);\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.cpp","additions":28,"deletions":6,"binary":false,"changes":34,"status":"modified"},{"patch":"@@ -434,0 +434,2 @@\n+  void load_short_misaligned(Register dst, Address src, Register tmp, bool is_signed, int granularity = 1);\n+\n","filename":"src\/hotspot\/cpu\/riscv\/macroAssembler_riscv.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"}]}