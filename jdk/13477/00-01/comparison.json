{"files":[{"patch":"@@ -87,1 +87,1 @@\n-    intptr_t offset = *f.addr_at(frame::interpreter_frame_locals_offset);\n+    intptr_t locals_offset = *f.addr_at(frame::interpreter_frame_locals_offset);\n@@ -91,1 +91,1 @@\n-    fp = caller.unextended_sp() - 1 - offset + (overlap_caller ? ContinuationHelper::InterpretedFrame::stack_argsize(f) : 0);\n+    fp = caller.unextended_sp() - 1 - locals_offset + (overlap_caller ? ContinuationHelper::InterpretedFrame::stack_argsize(f) : 0);\n@@ -101,1 +101,1 @@\n-    *hf.addr_at(frame::interpreter_frame_locals_offset) = offset;\n+    *hf.addr_at(frame::interpreter_frame_locals_offset) = locals_offset;\n@@ -149,1 +149,1 @@\n-  \/\/ since we freeze the padding word (see recurse_freeze_interpreted_frame) in order to keep the same relativized\n+  \/\/ because we freeze the padding word (see recurse_freeze_interpreted_frame) in order to keep the same relativized\n@@ -298,5 +298,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  \/\/ Nothing to do. Just make sure the relativized locals is already set.\n-  assert((*f.addr_at(frame::interpreter_frame_locals_offset) == (bottom - 1) - f.fp()), \"\");\n-}\n-\n","filename":"src\/hotspot\/cpu\/aarch64\/continuationFreezeThaw_aarch64.inline.hpp","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -73,4 +73,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  Unimplemented();\n-}\n-\n","filename":"src\/hotspot\/cpu\/arm\/continuationFreezeThaw_arm.inline.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -87,1 +87,1 @@\n-  \/\/ frame, since we freeze the padding (see recurse_freeze_interpreted_frame)\n+  \/\/ frame, because we freeze the padding (see recurse_freeze_interpreted_frame)\n@@ -267,1 +267,1 @@\n-    intptr_t offset = *f.addr_at(ijava_idx(locals));\n+    intptr_t locals_offset = *f.addr_at(ijava_idx(locals));\n@@ -275,1 +275,1 @@\n-    fp = caller.unextended_sp() - 1 - offset + overlap;\n+    fp = caller.unextended_sp() - 1 - locals_offset + overlap;\n@@ -289,1 +289,1 @@\n-    *hf.addr_at(ijava_idx(locals)) = offset;\n+    *hf.addr_at(ijava_idx(locals)) = locals_offset;\n@@ -550,5 +550,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  \/\/ Nothing to do. Just make sure the relativized locals is already set.\n-  assert((*f.addr_at(ijava_idx(locals)) == (bottom - 1) - f.fp()), \"\");\n-}\n-\n","filename":"src\/hotspot\/cpu\/ppc\/continuationFreezeThaw_ppc.inline.hpp","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -86,1 +86,1 @@\n-    intptr_t offset = *f.addr_at(frame::interpreter_frame_locals_offset);\n+    intptr_t locals_offset = *f.addr_at(frame::interpreter_frame_locals_offset);\n@@ -90,1 +90,1 @@\n-    fp = caller.unextended_sp() - 1 - offset + (overlap_caller ? ContinuationHelper::InterpretedFrame::stack_argsize(f) : 0);\n+    fp = caller.unextended_sp() - 1 - locals_offset + (overlap_caller ? ContinuationHelper::InterpretedFrame::stack_argsize(f) : 0);\n@@ -99,1 +99,1 @@\n-    *hf.addr_at(frame::interpreter_frame_locals_offset) = offset;\n+    *hf.addr_at(frame::interpreter_frame_locals_offset) = locals_offset;\n@@ -147,1 +147,1 @@\n-  \/\/ since we freeze the padding word (see recurse_freeze_interpreted_frame) in order to keep the same relativized\n+  \/\/ because we freeze the padding word (see recurse_freeze_interpreted_frame) in order to keep the same relativized\n@@ -300,5 +300,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  \/\/ Nothing to do. Just make sure the relativized locals is already set.\n-  assert((*f.addr_at(frame::interpreter_frame_locals_offset) == (bottom - 1) - f.fp()), \"\");\n-}\n-\n","filename":"src\/hotspot\/cpu\/riscv\/continuationFreezeThaw_riscv.inline.hpp","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2019, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2019, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -73,4 +73,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  Unimplemented();\n-}\n-\n","filename":"src\/hotspot\/cpu\/s390\/continuationFreezeThaw_s390.inline.hpp","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -84,1 +84,1 @@\n-    int locals = f.interpreter_frame_method()->max_locals();\n+    intptr_t locals_offset = *f.addr_at(frame::interpreter_frame_locals_offset);\n@@ -88,1 +88,1 @@\n-    fp = caller.unextended_sp() - (locals + frame::sender_sp_offset) + (overlap_caller ? ContinuationHelper::InterpretedFrame::stack_argsize(f) : 0);\n+    fp = caller.unextended_sp() - 1 - locals_offset + (overlap_caller ? ContinuationHelper::InterpretedFrame::stack_argsize(f) : 0);\n@@ -97,1 +97,2 @@\n-    *hf.addr_at(frame::interpreter_frame_locals_offset) = frame::sender_sp_offset + locals - 1;\n+    \/\/ copy relativized locals from the stack frame\n+    *hf.addr_at(frame::interpreter_frame_locals_offset) = locals_offset;\n@@ -226,2 +227,2 @@\n-    intptr_t offset = *hf.addr_at(frame::interpreter_frame_locals_offset);\n-    assert((int)offset == frame::sender_sp_offset + locals - 1, \"\");\n+    intptr_t locals_offset = *hf.addr_at(frame::interpreter_frame_locals_offset);\n+    assert((int)locals_offset == frame::sender_sp_offset + locals - 1, \"\");\n@@ -229,1 +230,1 @@\n-    *f.addr_at(frame::interpreter_frame_locals_offset) = offset;\n+    *f.addr_at(frame::interpreter_frame_locals_offset) = locals_offset;\n@@ -288,4 +289,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  \/\/ Nothing to do. Just make sure the relativized locals is already set.\n-  assert((*f.addr_at(frame::interpreter_frame_locals_offset) == (bottom - 1) - f.fp()), \"\");\n-}\n","filename":"src\/hotspot\/cpu\/x86\/continuationFreezeThaw_x86.inline.hpp","additions":7,"deletions":10,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -73,4 +73,0 @@\n-inline void ThawBase::set_interpreter_frame_bottom(const frame& f, intptr_t* bottom) {\n-  Unimplemented();\n-}\n-\n","filename":"src\/hotspot\/cpu\/zero\/continuationFreezeThaw_zero.inline.hpp","additions":0,"deletions":4,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -1092,2 +1092,2 @@\n-  \/\/ Some architectures (like AArch64\/PPC64\/RISC-V) adds padding between the locals and the fixed_frame to keep the fp 16-byte-aligned.\n-  \/\/ On those architectures we freeze the padding in order to keep the same localized pointer values.\n+  \/\/ Some architectures (like AArch64\/PPC64\/RISC-V) add padding between the locals and the fixed_frame to keep the fp 16-byte-aligned.\n+  \/\/ On those architectures we freeze the padding in order to keep the same fp-relative offsets in the fixed_frame.\n@@ -1753,1 +1753,0 @@\n-  static inline void set_interpreter_frame_bottom(const frame& f, intptr_t* bottom);\n@@ -2148,5 +2147,0 @@\n-  assert(hf.is_heap_frame(), \"should be\");\n-  const int fsize = heap_frame_bottom - heap_frame_top;\n-\n-  assert((stack_frame_bottom >= stack_frame_top + fsize) &&\n-         (stack_frame_bottom <= stack_frame_top + fsize + 1), \"\"); \/\/ internal alignment on aarch64\n@@ -2156,2 +2150,3 @@\n-  \/\/ Some architectures (like AArch64\/PPC64\/RISC-V) adds padding between the locals and the fixed_frame to keep the fp 16-byte-aligned.\n-  \/\/ On those architectures we thaw the padding in order to keep the same localized pointer values.\n+  \/\/ Some architectures (like AArch64\/PPC64\/RISC-V) add padding between the locals and the fixed_frame to keep the fp 16-byte-aligned.\n+  \/\/ On those architectures we freeze the padding in order to keep the same fp-relative offsets in the fixed_frame.\n+  const int fsize = heap_frame_bottom - heap_frame_top;\n@@ -2160,1 +2155,3 @@\n-  set_interpreter_frame_bottom(f, stack_frame_bottom); \/\/ the copy overwrites the metadata\n+  \/\/ Make sure the relativized locals is already set.\n+  assert(f.interpreter_frame_local_at(0) == stack_frame_bottom - 1, \"invalid frame bottom\");\n+\n","filename":"src\/hotspot\/share\/runtime\/continuationFreezeThaw.cpp","additions":8,"deletions":11,"binary":false,"changes":19,"status":"modified"}]}