{"files":[{"patch":"@@ -1527,1 +1527,0 @@\n-volatile intptr_t os::ThreadCrashProtection::_crash_mux = 0;\n@@ -1530,0 +1529,2 @@\n+  assert(Thread::current()->is_JfrSampler_thread(), \"should be JFRSampler\");\n+  _protected_thread = Thread::current();\n@@ -1541,5 +1542,0 @@\n-  Thread::muxAcquire(&_crash_mux, \"CrashProtection\");\n-\n-  _protected_thread = Thread::current_or_null();\n-  assert(_protected_thread != NULL, \"Cannot crash protect a NULL thread\");\n-\n@@ -1558,1 +1554,0 @@\n-    Thread::muxRelease(&_crash_mux);\n@@ -1565,1 +1560,0 @@\n-  Thread::muxRelease(&_crash_mux);\n","filename":"src\/hotspot\/os\/posix\/os_posix.cpp","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -149,1 +149,1 @@\n- * Crash protection for the watcher thread. Wrap the callback\n+ * Crash protection for the JfrSampler thread. Wrap the callback\n@@ -170,1 +170,0 @@\n-  static volatile intptr_t _crash_mux;\n","filename":"src\/hotspot\/os\/posix\/os_posix.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -5002,1 +5002,0 @@\n-volatile intptr_t os::ThreadCrashProtection::_crash_mux = 0;\n@@ -5005,0 +5004,2 @@\n+  assert(Thread::current()->is_JfrSampler_thread(), \"should be JFRSampler\");\n+  _protected_thread = Thread::current();\n@@ -5014,6 +5015,0 @@\n-\n-  Thread::muxAcquire(&_crash_mux, \"CrashProtection\");\n-\n-  _protected_thread = Thread::current_or_null();\n-  assert(_protected_thread != NULL, \"Cannot crash protect a NULL thread\");\n-\n@@ -5030,1 +5025,0 @@\n-  Thread::muxRelease(&_crash_mux);\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":2,"deletions":8,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -131,1 +131,1 @@\n- * Crash protection for the watcher thread. Wrap the callback\n+ * Crash protection for the JfrSampler thread. Wrap the callback\n@@ -149,1 +149,0 @@\n-  static volatile intptr_t _crash_mux;\n","filename":"src\/hotspot\/os\/windows\/os_windows.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -346,0 +346,1 @@\n+  bool is_JfrSampler_thread() const { return true; }\n","filename":"src\/hotspot\/share\/jfr\/periodic\/sampling\/jfrThreadSampler.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -496,0 +496,1 @@\n+  virtual bool is_JfrSampler_thread() const          { return false; }\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}