{"files":[{"patch":"@@ -70,1 +70,1 @@\n-    native void doDrawGlyphList(long dstData, long xgc,\n+    native boolean doDrawGlyphList(long dstData, long xgc,\n@@ -81,1 +81,17 @@\n-            doDrawGlyphList(x11sd.getNativeOps(), xgc, clip, gl);\n+            boolean allGlyphsRendered = doDrawGlyphList(x11sd.getNativeOps(), xgc, clip, gl);\n+            \/\/ There are some color glyphs, which we couldn't draw\n+            if (!allGlyphsRendered) {\n+                gl.startGlyphIteration();\n+                for (int i = 0; i < gl.getNumGlyphs(); i++) {\n+                    if (gl.isColorGlyph(i)) {\n+                        int end;\n+                        for (end = i + 1; end < gl.getNumGlyphs(); end++) {\n+                            if (!gl.isColorGlyph(end)) break;\n+                        }\n+                        sg2d.loops.drawGlyphListColorLoop.\n+                                DrawGlyphListColor(sg2d, sg2d.surfaceData,\n+                                        gl, i, end);\n+                        i = end - 1;\n+                    } else gl.setGlyphIndex(i);\n+                }\n+            }\n@@ -92,1 +108,1 @@\n-        void doDrawGlyphList(long dstData, long xgc,\n+        boolean doDrawGlyphList(long dstData, long xgc,\n@@ -96,1 +112,1 @@\n-            super.doDrawGlyphList(dstData, xgc, clip, gl);\n+            return super.doDrawGlyphList(dstData, xgc, clip, gl);\n","filename":"src\/java.desktop\/unix\/classes\/sun\/font\/X11TextRenderer.java","additions":20,"deletions":4,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -106,1 +106,1 @@\n-                       jint clipRight, jint clipBottom)\n+                       jint clipRight, jint clipBottom, jboolean *allGlyphsRendered)\n@@ -127,1 +127,1 @@\n-        rowBytes = glyphs[glyphCounter].width;\n+        rowBytes = glyphs[glyphCounter].rowBytes;\n@@ -133,0 +133,5 @@\n+        if ((int) rowBytes == width * 4) { \/\/ Skip colored glyphs\n+            *allGlyphsRendered = JNI_FALSE;\n+            continue;\n+        }\n+\n@@ -209,1 +214,1 @@\n-                 SurfaceDataBounds *bounds, ImageRef *glyphs, jint totalGlyphs)\n+                 SurfaceDataBounds *bounds, ImageRef *glyphs, jint totalGlyphs, jboolean *allGlyphsRendered)\n@@ -262,1 +267,1 @@\n-                       cx1, cy1, cx2, cy2);\n+                       cx1, cy1, cx2, cy2, allGlyphsRendered);\n","filename":"src\/java.desktop\/unix\/native\/common\/java2d\/x11\/X11TextRenderer_md.c","additions":9,"deletions":4,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -48,1 +48,1 @@\n- SurfaceDataBounds *bounds, ImageRef *glyphs, jint totalGlyphs);\n+ SurfaceDataBounds *bounds, ImageRef *glyphs, jint totalGlyphs, jboolean *allGlyphsRendered);\n@@ -53,1 +53,1 @@\n- * Signature: (Lsun\/java2d\/SurfaceData;Ljava\/awt\/Rectangle;ILsun\/font\/GlyphList;J)V\n+ * Signature: (Lsun\/java2d\/SurfaceData;Ljava\/awt\/Rectangle;ILsun\/font\/GlyphList;J)Z\n@@ -55,1 +55,1 @@\n-JNIEXPORT void JNICALL Java_sun_font_X11TextRenderer_doDrawGlyphList\n+JNIEXPORT jboolean JNICALL Java_sun_font_X11TextRenderer_doDrawGlyphList\n@@ -67,1 +67,1 @@\n-        return;\n+        return JNI_TRUE;\n@@ -71,1 +71,1 @@\n-        return;\n+        return JNI_TRUE;\n@@ -73,0 +73,1 @@\n+    jboolean allGlyphsRendered = JNI_TRUE;\n@@ -74,1 +75,1 @@\n-                     &bounds, gbv->glyphs, gbv->numGlyphs);\n+                     &bounds, gbv->glyphs, gbv->numGlyphs, &allGlyphsRendered);\n@@ -76,0 +77,1 @@\n+    return allGlyphsRendered;\n","filename":"src\/java.desktop\/unix\/native\/libfontmanager\/X11TextRenderer.c","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"}]}