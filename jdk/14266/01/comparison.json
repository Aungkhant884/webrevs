{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,0 +30,1 @@\n+import java.awt.Toolkit;\n@@ -395,0 +396,36 @@\n+    \/**\n+     * Our X11 code expects the drop target window to be a top level window\n+     * and to have the XA_WM_STATE property.\n+     * This is not true when performing drag and drop from XWayland\n+     * to a native Wayland application.\n+     * In this case XWayland creates a dummy window with only one property,\n+     * XdndAware.\n+     *\n+     * @param window to test\n+     * @return true if window has XdndAware property when running under Wayland\n+     *\/\n+    private static boolean isXWaylandDndAwareWindow(long window) {\n+        Toolkit toolkit = Toolkit.getDefaultToolkit();\n+        if (!(toolkit instanceof SunToolkit)\n+                || !((SunToolkit) toolkit).isRunningOnWayland()) {\n+            return false;\n+        }\n+\n+        WindowPropertyGetter wpg =\n+                new WindowPropertyGetter(window,\n+                        XDnDConstants.XA_XdndAware,\n+                        0, 1, false,\n+                        XConstants.AnyPropertyType);\n+\n+        try {\n+            int status = wpg.execute(XErrorHandler\n+                    .IgnoreBadWindowHandler.getInstance());\n+\n+            return status == XConstants.Success\n+                    && wpg.getData() != 0\n+                    && wpg.getActualType() == XAtom.XA_ATOM;\n+        } finally {\n+            wpg.dispose();\n+        }\n+    }\n+\n@@ -411,0 +448,4 @@\n+        if (isXWaylandDndAwareWindow(window)) {\n+            return window;\n+        }\n+\n","filename":"src\/java.desktop\/unix\/classes\/sun\/awt\/X11\/XDragSourceContextPeer.java","additions":42,"deletions":1,"binary":false,"changes":43,"status":"modified"}]}