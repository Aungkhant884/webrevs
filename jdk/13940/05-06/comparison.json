{"files":[{"patch":"@@ -26,1 +26,1 @@\n- * @bug JDK-8298127\n+ * @bug 8298127\n@@ -30,1 +30,1 @@\n- * @run main TestHSSLMS\n+ * @run main TestHSS\n@@ -47,1 +47,1 @@\n-public class TestHSSLMS {\n+public class TestHSS {\n@@ -72,1 +72,1 @@\n-        if (!t.exception) {\n+        if (t.e == null) {\n@@ -79,1 +79,1 @@\n-            \/\/ exception is expected and is a pass (true)\n+            \/\/ exception is expected\n@@ -83,2 +83,4 @@\n-            } catch (InvalidKeySpecException | SignatureException ex) {\n-                return true;\n+            } catch (InvalidKeySpecException ex) {\n+                return t.e instanceof InvalidKeySpecException;\n+            } catch (SignatureException ex) {\n+                return t.e instanceof SignatureException;\n@@ -178,1 +180,1 @@\n-            boolean exception,\n+            Exception e,\n@@ -186,1 +188,1 @@\n-        \/\/ Test Case #0\n+        \/\/ Test Case #1\n@@ -189,2 +191,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -299,1 +301,1 @@\n-        \/\/ Test Case #1\n+        \/\/ Test Case #2\n@@ -302,2 +304,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -453,1 +455,1 @@\n-            true,  \/\/ InvalidKeyException\n+            new InvalidKeySpecException(),\n@@ -499,1 +501,1 @@\n-            true,  \/\/ exception expected\n+            new InvalidKeySpecException(),\n@@ -546,1 +548,1 @@\n-            true,  \/\/ exception expected\n+            new InvalidKeySpecException(),\n@@ -607,2 +609,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -710,2 +712,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -818,2 +820,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -954,2 +956,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -1096,2 +1098,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -1318,2 +1320,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -1545,2 +1547,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -1772,2 +1774,2 @@\n-            false, \/\/ exception expected\n-            true,  \/\/ expected result\n+            null, \/\/ exception\n+            true, \/\/ expected result\n@@ -2001,1 +2003,0 @@\n-        \/\/ SignatureException\n@@ -2004,1 +2005,1 @@\n-            true,  \/\/ exception expected\n+            new SignatureException(),\n@@ -2115,1 +2116,0 @@\n-        \/\/ SignatureException\n@@ -2118,1 +2118,1 @@\n-            true,  \/\/ exception expected\n+            new SignatureException(),\n@@ -2231,1 +2231,1 @@\n-            false, \/\/ exception expected\n+            null,  \/\/ exception\n@@ -2342,1 +2342,0 @@\n-        \/\/ SignatureException\n@@ -2345,1 +2344,1 @@\n-            true,  \/\/ exception expected\n+            new SignatureException(),\n@@ -2456,1 +2455,0 @@\n-        \/\/ SignatureException\n@@ -2459,1 +2457,1 @@\n-            true,  \/\/ exception expected\n+            new SignatureException(),\n@@ -2486,1 +2484,1 @@\n-            false, \/\/ exception expected\n+            null,  \/\/ exception\n","filename":"test\/jdk\/sun\/security\/provider\/hss\/TestHSS.java","additions":41,"deletions":43,"binary":false,"changes":84,"status":"modified"},{"patch":"@@ -29,1 +29,1 @@\n- * @run main VerifyHSSLMSSignedJar\n+ * @run main VerifyHSSSignedJar\n@@ -39,1 +39,1 @@\n-public class VerifyHSSLMSSignedJar {\n+public class VerifyHSSSignedJar {\n","filename":"test\/jdk\/sun\/security\/tools\/jarsigner\/VerifyHSSSignedJar.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+import org.openjdk.jmh.annotations.Param;\n@@ -64,1 +65,1 @@\n-public class HSSLMS {\n+public class HSS {\n@@ -66,0 +67,30 @@\n+    static byte[] pk;\n+    static byte[] msg;\n+    static byte[] sig;\n+    static Signature v;\n+\n+    @Param({\"noop\"})\n+    private String test;\n+\n+    static byte[] decode(String s) {\n+        return HexFormat.of().parseHex(s\n+                        .replaceAll(\"\/\/.*\", \"\")\n+                        .replaceAll(\"\\\\s\", \"\"));\n+    }\n+\n+    @Setup\n+    public void setup() throws Exception {\n+        p = Security.getProvider(\"SUN\");\n+        if (p == null) {\n+            throw new Exception (\"Can't load \\\"Sun\\\" provider\");\n+        }\n+    }\n+\n+    public Signature getVerifier(byte[] pk) throws Exception {\n+        var kf = KeyFactory.getInstance(\"HSS\/LMS\", Security.getProvider(\"SUN\"));\n+        var pk1 = kf.generatePublic(new RawKeySpec(pk));\n+\n+        var vv = Signature.getInstance(\"HSS\/LMS\");\n+        vv.initVerify(pk1);\n+        return vv;\n+    }\n@@ -68,3 +99,19 @@\n-    public void test01_RFC_8554() throws Exception {\n-        \/\/ RFC 8554 Test Case 1\n-        var pk = decode(\"\"\"\n+    public void verify() throws Exception {\n+        if (v == null) {\n+            return;\n+        }\n+        v.update(msg);\n+        if (!v.verify(sig)) {\n+            throw new RuntimeException();\n+        }\n+    }\n+\n+    \/\/ RFC 8554 Test Case 1\n+    public static class test01 extends HSS {\n+\n+        @Param({\"RFC 8554 1\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -76,1 +123,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -83,1 +130,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -176,1 +223,3 @@\n-        verify(pk, sig, msg);\n+\n+            v = getVerifier(pk);\n+        }\n@@ -179,4 +228,9 @@\n-    @Benchmark\n-    public void test02_RFC_8554() throws Exception {\n-        \/\/ RFC 8554 Test Case 2\n-        var pk = decode(\"\"\"\n+    \/\/ RFC 8554 Test Case 2\n+    public static class test02 extends HSS {\n+\n+        @Param({\"RFC 8554 2\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -188,1 +242,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -194,1 +248,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -326,1 +380,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -330,3 +385,8 @@\n-    @Benchmark\n-    public void test03_h15_w8() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test03 extends HSS {\n+\n+        @Param({\"       h15_w8\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -338,1 +398,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -372,1 +432,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -429,1 +489,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -433,3 +494,8 @@\n-    @Benchmark\n-    public void test04_h20_w8() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test04 extends HSS {\n+\n+        @Param({\"       h20_w8\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -441,1 +507,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -475,1 +541,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -537,1 +603,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -541,3 +608,8 @@\n-    @Benchmark\n-    public void test05_h15_w4() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test05 extends HSS {\n+\n+        @Param({\"       h15_w4\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -549,1 +621,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -583,1 +655,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -673,1 +745,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -677,3 +750,8 @@\n-    @Benchmark\n-    public void test06_h20_w4() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test06 extends HSS {\n+\n+        @Param({\"       h20_w4\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -685,1 +763,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -719,1 +797,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -814,1 +892,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -819,3 +898,8 @@\n-    @Benchmark\n-    public void test07_h15_w4_h10_w4() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test07 extends HSS {\n+\n+        @Param({\"h15_w4_h10_w4\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -827,1 +911,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -861,1 +945,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -1036,1 +1120,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -1041,3 +1126,8 @@\n-    @Benchmark\n-    public void test08_h15_w4_h15_w4() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test08 extends HSS {\n+\n+        @Param({\"h15_w4_h15_w4\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -1049,1 +1139,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -1083,1 +1173,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -1263,1 +1353,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -1268,3 +1359,8 @@\n-    @Benchmark\n-    public void test09_h20_w4_h10_w4() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test09 extends HSS {\n+\n+        @Param({\"h20_w4_h10_w4\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -1276,1 +1372,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -1310,1 +1406,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -1490,1 +1586,2 @@\n-        verify(pk, sig, msg);\n+            v = getVerifier(pk);\n+        }\n@@ -1495,3 +1592,8 @@\n-    @Benchmark\n-    public void test10_h20_w4_h15_w4() throws Exception {\n-        var pk = decode(\"\"\"\n+    public static class test10 extends HSS {\n+\n+        @Param({\"h20_w4_h15_w4\"})\n+        private String test;\n+\n+        @Setup\n+        public void setup() throws Exception {\n+            pk = decode(\"\"\"\n@@ -1503,1 +1605,1 @@\n-        var msg = decode(\"\"\"\n+            msg = decode(\"\"\"\n@@ -1537,1 +1639,1 @@\n-        var sig = decode(\"\"\"\n+            sig = decode(\"\"\"\n@@ -1722,8 +1824,1 @@\n-        verify(pk, sig, msg);\n-    }\n-\n-    @Setup\n-    public void setup() throws Exception {\n-        p = Security.getProvider(\"SUN\");\n-        if (p == null) {\n-            throw new Exception (\"Can't load \\\"Sun\\\" provider\");\n+            v = getVerifier(pk);\n@@ -1732,21 +1827,0 @@\n-\n-    public void verify(byte[] pk, byte[] sig, byte[] msg) throws Exception {\n-\n-        \/\/ build public key\n-        RawKeySpec rks = new RawKeySpec(pk);\n-        KeyFactory kf = KeyFactory.getInstance(\"HSS\/LMS\", p);\n-        PublicKey pk1 = kf.generatePublic(rks);\n-\n-        var v = Signature.getInstance(\"HSS\/LMS\");\n-        v.initVerify(pk1);\n-        v.update(msg);\n-        if (!v.verify(sig)) {\n-            throw new RuntimeException();\n-        }\n-    }\n-\n-    static byte[] decode(String s) {\n-        return HexFormat.of().parseHex(s\n-                        .replaceAll(\"\/\/.*\", \"\")\n-                        .replaceAll(\"\\\\s\", \"\"));\n-    }\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/security\/HSS.java","additions":164,"deletions":90,"binary":false,"changes":254,"status":"modified"}]}