{"files":[{"patch":"@@ -51,1 +51,0 @@\n-@Fork(value = 3, jvmArgsAppend={\"-Djava.security.manager=allow\"})\n@@ -57,1 +56,2 @@\n-    URL u;\n+    @Param({\"10\"})\n+    public int numberOfCodeSources;\n@@ -61,1 +61,0 @@\n-    static ProtectionDomain[] pd;\n@@ -64,2 +63,1 @@\n-    CodeSource cs;\n-    Permissions p;\n+    static CodeSource[] cs;\n@@ -80,1 +78,0 @@\n-        pd = new ProtectionDomain[numberOfClasses];\n@@ -82,0 +79,1 @@\n+        cs = new CodeSource[numberOfCodeSources];\n@@ -83,4 +81,4 @@\n-        u = new URL(\"file:\/tmp\/duke\");\n-        cs = new CodeSource(u, (java.security.cert.Certificate[]) null);\n-        p = new Permissions();\n-        p.add(new SocketPermission(\"localhost\", \"connect\"));\n+        for (int i = 0; i < numberOfCodeSources; i++) {\n+            URL u = new URL(\"file:\/tmp\/duke\" + i);\n+            cs[i] = new CodeSource(u, (java.security.cert.Certificate[]) null);\n+        }\n@@ -91,1 +89,0 @@\n-            pd[i] = new ProtectionDomain(cs, p);\n@@ -96,1 +93,1 @@\n-    static class ProtectionDomainBenchLoader extends ClassLoader {\n+    static class ProtectionDomainBenchLoader extends SecureClassLoader {\n@@ -110,1 +107,1 @@\n-                return defineClass(name, compiledClasses[index] , 0, (compiledClasses[index]).length, pd[index] );\n+                return defineClass(name, compiledClasses[index] , 0, (compiledClasses[index]).length, cs[index % cs.length] );\n@@ -117,3 +114,1 @@\n-    @Benchmark\n-    public void bench()  throws ClassNotFoundException {\n-\n+    void work() throws ClassNotFoundException {\n@@ -128,0 +123,12 @@\n+\n+    @Benchmark\n+    @Fork(value = 3, jvmArgsPrepend={\"-Djava.security.manager=allow\"})\n+    public void withSecurityManager()  throws ClassNotFoundException {\n+        work();\n+    }\n+\n+    @Benchmark\n+    @Fork(value = 3)\n+    public void noSecurityManager()  throws ClassNotFoundException {\n+        work();\n+    }\n","filename":"test\/micro\/org\/openjdk\/bench\/java\/security\/ProtectionDomainBench.java","additions":23,"deletions":16,"binary":false,"changes":39,"status":"modified"}]}