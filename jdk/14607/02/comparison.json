{"files":[{"patch":"@@ -146,1 +146,4 @@\n-  static const int table_size = 7919;\n+  \/\/ We chose 8191, as this is a Mersenne prime (2^x - 1), which for a random\n+  \/\/  polynomial modulo p = (2^x - 1) is uniformily distributed in [p], so each\n+  \/\/  bit has the same distribution.\n+  static const int table_size = 8191; \/\/ i.e. 8191==(2^13 - 1);\n@@ -153,5 +156,4 @@\n-  static unsigned calculate_hash(const void* p) {\n-    uintptr_t tmp = p2i(p);\n-    unsigned hash = (unsigned)tmp\n-                     LP64_ONLY( ^ (unsigned)(tmp >> 32));\n-    return hash;\n+  static uint64_t calculate_hash(const void* p) {\n+    \/\/ Keep hash function simple, the modulo\n+    \/\/ operation in index function will do the \"heavy lifting\".\n+    return (uint64_t)(p);\n@@ -161,1 +163,2 @@\n-    const unsigned hash = calculate_hash(p);\n+    const uint64_t hash = calculate_hash(p);\n+    \/\/ \"table_size\" is a Mersenne prime, so \"modulo\" is all we need here.\n","filename":"src\/hotspot\/share\/services\/nmtPreInit.hpp","additions":10,"deletions":7,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -160,1 +160,4 @@\n-        OutputAnalyzer output = new OutputAnalyzer(pb.start());\n+        Process proc = pb.start();\n+        long pid = proc.pid();\n+        System.out.println(\"Test process pid:\" + pid);\n+        OutputAnalyzer output = new OutputAnalyzer(proc);\n@@ -190,1 +193,1 @@\n-            System.out.println(\"found: \" + entries + \" - \" + sum_bytes + longest_chain + \".\");\n+            System.out.println(\"[pid\"+pid+\"] found: \" + entries + \" - \" + sum_bytes + \" - \" + longest_chain + \".\");\n@@ -203,1 +206,1 @@\n-                throw new RuntimeException(\"Suspiciously high number of pre-init allocations.\");\n+                throw new RuntimeException(\"[pid\"+pid+\"] Suspiciously high number of pre-init allocations.\");\n@@ -206,1 +209,1 @@\n-                throw new RuntimeException(\"Suspiciously high pre-init memory usage.\");\n+                throw new RuntimeException(\"[pid\"+pid+\"] Suspiciously high pre-init memory usage.\");\n@@ -212,1 +215,1 @@\n-                throw new RuntimeException(\"Suspiciously long bucket chains in lookup table.\");\n+                throw new RuntimeException(\"[pid\"+pid+\"] Suspiciously long bucket chains in lookup table.\");\n","filename":"test\/hotspot\/jtreg\/runtime\/NMT\/NMTInitializationTest.java","additions":8,"deletions":5,"binary":false,"changes":13,"status":"modified"}]}