{"files":[{"patch":"@@ -0,0 +1,8 @@\n+#\n+# The pre-submit tests will only runs for forks of the TARGET_PROJECT defined below. This is set to \"jdk\" by default,\n+# and can be changed by downstream projects if they also want to run pre-submit tests.\n+#\n+# The tests will attempt to merge the latest commits from TARGET_BRANCH before executing, to ensure that what is tested\n+# is as close as possible to what the final integration result will be. This is set to \"master\" by default, and can\n+# be changed by downstream projects that utilize multiple branches in order to select the correct one.\n+#\n@@ -7,0 +15,1 @@\n+      - pr\/*\n@@ -13,0 +22,4 @@\n+      merge:\n+        description: \"Merge latest changes from target branch\"\n+        required: true\n+        default: true\n@@ -18,0 +31,3 @@\n+    env:\n+      TARGET_PROJECT: jdk\n+      TARGET_BRANCH: master\n@@ -28,0 +44,2 @@\n+      fetch_target_command: ${{ steps.merge_target.outputs.command }}\n+      merge_target_command: ${{ steps.try_merge_target.outputs.command }}\n@@ -30,0 +48,7 @@\n+      - name: Determine target project name (fork source)\n+        id: upstream_repo\n+        uses: actions\/github-script@v3\n+        with:\n+          result-encoding: string\n+          script: \"return (await github.repos.get( {owner: context.repo.owner, repo: context.repo.repo })).data.source.name\"\n+\n@@ -32,1 +57,1 @@\n-        run: echo \"::set-output name=should_run::${{ github.event.inputs.platforms != '' || (!secrets.JDK_SUBMIT_FILTER || startsWith(github.ref, 'refs\/heads\/submit\/')) }}\"\n+        run: echo \"::set-output name=should_run::${{ env.TARGET_PROJECT == steps.upstream_repo.outputs.result }} && (${{ github.event.inputs.platforms != '' || (!secrets.JDK_SUBMIT_FILTER || startsWith(github.ref, 'refs\/heads\/submit\/')) }})\"\n@@ -54,0 +79,1 @@\n+          fetch-depth: 1000\n@@ -56,0 +82,20 @@\n+      - name: Determine merge target hash\n+        id: merge_target\n+        run: |\n+          git fetch https:\/\/github.com\/openjdk\/${{ steps.upstream_repo.outputs.result }} ${TARGET_BRANCH}\n+          echo \"::set-output name=hash::`git rev-parse FETCH_HEAD`\"\n+          echo \"::set-output name=command::git fetch https:\/\/github.com\/openjdk\/${{ steps.upstream_repo.outputs.result }} ${TARGET_BRANCH}\"\n+        working-directory: jdk\n+        if: steps.check_submit.outputs.should_run != 'false' && (github.event.inputs.platforms == '' || github.event.inputs.merge == 'true')\n+\n+      - name: Determine merge strategy\n+        id: try_merge_target\n+        run: >\n+          (git -c user.name=\"presubmit\" -c user.email=\"presubmit@github.actions\" merge --no-edit ${{ steps.merge_target.outputs.hash }} &&\n+            echo \"::set-output name=command::git -c user.name=\"presubmit\" -c user.email=\"presubmit@github.actions\" merge --no-edit ${{ steps.merge_target.outputs.hash }}\") ||\n+          (git merge --abort && git -c user.name=\"presubmit\" -c user.email=\"presubmit@github.actions\" rebase ${{ steps.merge_target.outputs.hash }} &&\n+            echo \"::set-output name=command::git -c user.name=\"presubmit\" -c user.email=\"presubmit@github.actions\" rebase ${{ steps.merge_target.outputs.hash }}\") ||\n+          echo \"::set-output name=command::echo There are merge conflicts with the target that will have to be resolved before integration\"\n+        working-directory: jdk\n+        if: steps.check_submit.outputs.should_run != 'false' && (github.event.inputs.platforms == '' || github.event.inputs.merge == 'true')\n+\n@@ -132,0 +178,7 @@\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n+        working-directory: jdk\n@@ -259,0 +312,7 @@\n+        with:\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n@@ -442,0 +502,7 @@\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n+        working-directory: jdk\n@@ -594,0 +661,7 @@\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n+        working-directory: jdk\n@@ -727,0 +801,7 @@\n+        with:\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n@@ -892,0 +973,7 @@\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n+        working-directory: jdk\n@@ -981,0 +1069,7 @@\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n+        working-directory: jdk\n@@ -1118,0 +1213,7 @@\n+        with:\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n@@ -1294,0 +1396,7 @@\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n+        working-directory: jdk\n@@ -1421,0 +1530,7 @@\n+        with:\n+          fetch-depth: 1000\n+\n+      - name: Merge latest changes from target branch\n+        run: |\n+          ${{ needs.prerequisites.outputs.fetch_target_command }}\n+          ${{ needs.prerequisites.outputs.merge_target_command }}\n","filename":".github\/workflows\/submit.yml","additions":117,"deletions":1,"binary":false,"changes":118,"status":"modified"}]}