{"files":[{"patch":"@@ -35,4 +35,0 @@\n-LogOutput::~LogOutput() {\n-  os::free(_config_string);\n-}\n-\n@@ -59,3 +55,2 @@\n-  os::free(_config_string);\n-  _config_string = os::strdup(string, mtLogging);\n-  _config_string_buffer_size = strlen(_config_string) + 1;\n+  _config_string.reset();\n+  _config_string.print_raw(string);\n@@ -65,7 +60,1 @@\n-  if (_config_string_buffer_size < InitialConfigBufferSize) {\n-    _config_string_buffer_size = InitialConfigBufferSize;\n-    _config_string = REALLOC_C_HEAP_ARRAY(char, _config_string, _config_string_buffer_size, mtLogging);\n-  }\n-\n-  size_t offset = strlen(_config_string);\n-  if (offset > 0) {\n+  if (_config_string.size() > 0) {\n@@ -73,1 +62,1 @@\n-    _config_string[offset++] = ',';\n+    _config_string.print_raw(\",\");\n@@ -75,12 +64,1 @@\n-\n-  for (;;) {\n-    int ret = selection.describe(_config_string + offset,\n-                                 _config_string_buffer_size - offset);\n-    if (ret == -1) {\n-      \/\/ Double the buffer size and retry\n-      _config_string_buffer_size *= 2;\n-      _config_string = REALLOC_C_HEAP_ARRAY(char, _config_string, _config_string_buffer_size, mtLogging);\n-      continue;\n-    }\n-    break;\n-  };\n+  selection.describe_on(&_config_string);\n","filename":"src\/hotspot\/share\/logging\/logOutput.cpp","additions":5,"deletions":27,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"utilities\/ostream.hpp\"\n@@ -46,2 +47,0 @@\n-  static const size_t InitialConfigBufferSize = 256;\n-\n@@ -53,2 +52,1 @@\n-  char* _config_string;\n-  size_t _config_string_buffer_size;\n+  stringStream _config_string;\n@@ -62,1 +60,1 @@\n-  \/\/ Replaces the current config description with the given string.\n+  \/\/ Replaces the current config description with a copy of the given string.\n@@ -82,1 +80,1 @@\n-    return _config_string;\n+    return _config_string.base();\n@@ -85,1 +83,1 @@\n-  LogOutput() : _reconfigured(false), _config_string(NULL), _config_string_buffer_size(0) {\n+  LogOutput() : _reconfigured(false), _config_string(){\n@@ -88,1 +86,1 @@\n-  virtual ~LogOutput();\n+  virtual ~LogOutput() {};\n","filename":"src\/hotspot\/share\/logging\/logOutput.hpp","additions":6,"deletions":8,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -205,2 +205,1 @@\n-int LogSelection::describe_tags(char* buf, size_t bufsize) const {\n-  int tot_written = 0;\n+void LogSelection::describe_tags_on(outputStream* out) const {\n@@ -208,6 +207,1 @@\n-    int written = jio_snprintf(buf + tot_written, bufsize - tot_written,\n-                               \"%s%s\", (i == 0 ? \"\" : \"+\"), LogTag::name(_tags[i]));\n-    if (written == -1) {\n-      return written;\n-    }\n-    tot_written += written;\n+    out->print(\"%s%s\", (i == 0 ? \"\" : \"+\"), LogTag::name(_tags[i]));\n@@ -215,1 +209,0 @@\n-\n@@ -217,5 +210,1 @@\n-    int written = jio_snprintf(buf + tot_written, bufsize - tot_written, \"*\");\n-    if (written == -1) {\n-      return written;\n-    }\n-    tot_written += written;\n+    out->print(\"*\");\n@@ -223,1 +212,0 @@\n-  return tot_written;\n@@ -226,9 +214,3 @@\n-int LogSelection::describe(char* buf, size_t bufsize) const {\n-  int tot_written = describe_tags(buf, bufsize);\n-\n-  int written = jio_snprintf(buf + tot_written, bufsize - tot_written, \"=%s\", LogLevel::name(_level));\n-  if (written == -1) {\n-    return -1;\n-  }\n-  tot_written += written;\n-  return tot_written;\n+void LogSelection::describe_on(outputStream* out) const {\n+  describe_tags_on(out);\n+  out->print(\"=%s\", LogLevel::name(_level));\n@@ -348,3 +330,2 @@\n-    char buf[128];\n-    suggestions[i].describe_tags(buf, sizeof(buf));\n-    out->print(\" %s\", buf);\n+    out->print(\" \");\n+    suggestions[i].describe_tags_on(out);\n","filename":"src\/hotspot\/share\/logging\/logSelection.cpp","additions":8,"deletions":27,"binary":false,"changes":35,"status":"modified"},{"patch":"@@ -64,2 +64,2 @@\n-  int describe_tags(char* buf, size_t bufsize) const;\n-  int describe(char* buf, size_t bufsize) const;\n+  void describe_tags_on(outputStream* out) const;\n+  void describe_on(outputStream* out) const;\n","filename":"src\/hotspot\/share\/logging\/logSelection.hpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -45,3 +45,3 @@\n-      char buf[256];\n-      _selections[i].describe_tags(buf, sizeof(buf));\n-      out->print(\" %s. \", buf);\n+      out->print(\" \");\n+      _selections[i].describe_tags_on(out);\n+      out->print(\". \");\n","filename":"src\/hotspot\/share\/logging\/logSelectionList.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+#include \"utilities\/ostream.hpp\"\n@@ -44,3 +45,3 @@\n-  char buf[256];\n-  sel.describe(buf, sizeof(buf));\n-  *os << buf;\n+  stringStream ss;\n+  sel.describe_on(&ss);\n+  *os << ss.freeze();\n@@ -202,1 +203,1 @@\n-  char buf[256];\n+  stringStream ss;\n@@ -205,2 +206,2 @@\n-  selection.describe_tags(buf, sizeof(buf));\n-  EXPECT_STREQ(\"logging+test*\", buf);\n+  selection.describe_tags_on(&ss);\n+  EXPECT_STREQ(\"logging+test*\", ss.freeze());\n@@ -210,1 +211,1 @@\n-  char buf[256];\n+  stringStream ss;\n@@ -213,2 +214,2 @@\n-  selection.describe(buf, sizeof(buf));\n-  EXPECT_STREQ(\"logging+test*=off\", buf);\n+  selection.describe_on(&ss);\n+  EXPECT_STREQ(\"logging+test*=off\", ss.freeze());\n","filename":"test\/hotspot\/gtest\/logging\/test_logSelection.cpp","additions":10,"deletions":9,"binary":false,"changes":19,"status":"modified"}]}