{"files":[{"patch":"@@ -134,0 +134,3 @@\n+\/\/ True if -Xint\/-Xmixed\/-Xcomp were specified\n+static bool mode_flag_cmd_line = false;\n+\n@@ -2603,0 +2606,1 @@\n+          mode_flag_cmd_line = true;\n@@ -2606,0 +2610,1 @@\n+          mode_flag_cmd_line = true;\n@@ -2610,0 +2615,1 @@\n+          mode_flag_cmd_line = true;\n@@ -3034,8 +3040,12 @@\n-    \/\/ Compiler threads may concurrently update the class metadata (such as method entries), so it's\n-    \/\/ unsafe with -Xshare:dump (which modifies the class metadata in place). Let's disable\n-    \/\/ compiler just to be safe.\n-    \/\/\n-    \/\/ Note: this is not a concern for dynamically dumping shared spaces, which makes a copy of the\n-    \/\/ class metadata instead of modifying them in place. The copy is inaccessible to the compiler.\n-    \/\/ TODO: revisit the following for the static archive case.\n-    set_mode_flags(_int);\n+    if (!mode_flag_cmd_line) {\n+      \/\/ By default, -Xshare:dump runs in interpreter-only mode, which is required for deterministic archive.\n+      \/\/\n+      \/\/ If your classlist is large and you don't care about deterministic dumping, you can use\n+      \/\/ -Xshare:dump -Xmixed to improve dumping speed.\n+      set_mode_flags(_int);\n+    } else if (_mode == _comp) {\n+      \/\/ -Xcomp may use excessive CPU for the test tiers. Also, -Xshare:dump runs a small and fixed set of\n+      \/\/ Java code, so there's not much benefit in running -Xcomp.\n+      log_info(cds)(\"reduced -Xcomp to -Xmixed for static dumping\");\n+      set_mode_flags(_mixed);\n+    }\n","filename":"src\/hotspot\/share\/runtime\/arguments.cpp","additions":18,"deletions":8,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -5072,0 +5072,12 @@\n+.PP\n+By default, when the \\f[V]-Xshare:dump\\f[R] option is used, the JVM runs\n+in interpreter-only mode (as if the \\f[V]-Xint\\f[R] option were\n+specified).\n+This is required for generating deterministic output in the shared\n+archive file.\n+I.e., the exact same archive will be generated, bit-for-bit, every time\n+you dump it.\n+However, if deterministic output is not needed, and you have a large\n+classlist, you can explicitly add \\f[V]-Xmixed\\f[R] to the command-line\n+to enable the JIT compiler.\n+This will speed up the archive creation.\n","filename":"src\/java.base\/share\/man\/java.1","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -82,0 +82,1 @@\n+            .addPrefix(\"-Xint\") \/\/ Override any -Xmixed\/-Xcomp flags from jtreg -vmoptions\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/DeterministicDump.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2014, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2014, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -62,1 +62,4 @@\n-        \"-XX:ObjectAlignmentInBytes=64\"\n+        \"-XX:ObjectAlignmentInBytes=64\",\n+        \"-Xint\",\n+        \"-Xmixed\",\n+        \"-Xcomp\",\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/CommandLineFlagCombo.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"}]}