{"files":[{"patch":"@@ -114,0 +114,14 @@\n+  fail_continue_impl(LogLevel::Info, msg, ap);\n+  va_end(ap);\n+}\n+\n+void FileMapInfo::fail_continue(LogLevelType level, const char *msg, ...) {\n+  va_list ap;\n+  va_start(ap, msg);\n+  fail_continue_impl(level, msg, ap);\n+  va_end(ap);\n+}\n+\n+void FileMapInfo::fail_continue_impl(LogLevelType level, const char *msg, va_list ap) {\n+  va_list ap_copy;\n+  va_copy(ap_copy, ap);\n@@ -119,1 +133,1 @@\n-    tty->vprint(msg, ap);\n+    tty->vprint(msg, ap_copy);\n@@ -123,1 +137,1 @@\n-      fail_exit(msg, ap);\n+      fail_exit(msg, ap_copy);\n@@ -125,0 +139,4 @@\n+      \/\/ LogMessage::vwrite, which makes a copy of the va_list, must be called before\n+      \/\/ LogStream::vprint_cr.\n+      LogMessage(cds) lm;\n+      lm.vwrite(level, msg, ap_copy);\n@@ -128,1 +146,1 @@\n-        ls.vprint_cr(msg, ap);\n+        ls.vprint_cr(msg, ap_copy);\n@@ -132,1 +150,1 @@\n-  va_end(ap);\n+  va_end(ap_copy);\n@@ -1121,9 +1139,3 @@\n-      const char* hint_msg = \"(hint: enable -Xlog:class+path=info to diagnose the failure)\";\n-      if (log_is_enabled(Info, class, path)) {\n-        fail_continue(\"%s\", mismatch_msg);\n-      } else {\n-        fail_continue(\"%s %s\", mismatch_msg, hint_msg);\n-      }\n-      if (!log_is_enabled(Info, cds) && !log_is_enabled(Info, class, path)) {\n-        log_warning(cds)(\"%s %s\", mismatch_msg, hint_msg);\n-      }\n+      const char* hint_msg = log_is_enabled(Info, class, path) ?\n+          \"\" : \" (hint: enable -Xlog:class+path=info to diagnose the failure)\";\n+      fail_continue(LogLevel::Warning, \"%s%s\", mismatch_msg, hint_msg);\n","filename":"src\/hotspot\/share\/cds\/filemap.cpp","additions":25,"deletions":13,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -30,0 +30,1 @@\n+#include \"logging\/logLevel.hpp\"\n@@ -484,0 +485,2 @@\n+  static void fail_continue(LogLevelType level, const char *msg, ...) ATTRIBUTE_PRINTF(2, 3);\n+  static void fail_continue_impl(LogLevelType level, const char *msg, va_list ap) ATTRIBUTE_PRINTF(2, 0);\n","filename":"src\/hotspot\/share\/cds\/filemap.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}