[{"commit":{"message":"JDK-8311892: TrustManagerFactory loading an invalid keystore yield vague exception\n\nWhen loading the default JVM trust store, if the JVM trust store contains an invalid certificate, the exception contains insufficient information to determine which certificate is invalid, making it very difficult to fix the problem.\n\nTo reproduce the issue:\n1. Modify the default JVM trust store to contain invalid information. A very easy way to do this on openjdk \/ red hat systems is to edit \/etc\/pki\/ca-trust\/extracted\/java\/cacerts and add garbage text to the file.\n2. Run this code:\n```\nTrustManagerFactory = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());\n\/\/ initializing the trust store with a null KeyStore will load the default JVM trust store\ntmf.init((KeyStore) null);\n```\n\nThis stack trace results:\n```\nCaused by: java.security.KeyStoreException: problem accessing trust store\n\tat java.base\/sun.security.ssl.TrustManagerFactoryImpl.engineInit(TrustManagerFactoryImpl.java:73)\n\tat java.base\/javax.net.ssl.TrustManagerFactory.init(TrustManagerFactory.java:282)\n\t... 81 common frames omitted\nCaused by: java.io.IOException: toDerInputStream rejects tag type 97\n\tat java.base\/sun.security.util.DerValue.toDerInputStream(DerValue.java:1155)\n\tat java.base\/sun.security.pkcs12.PKCS12KeyStore.engineLoad(PKCS12KeyStore.java:2013)\n\tat java.base\/sun.security.util.KeyStoreDelegator.engineLoad(KeyStoreDelegator.java:221)\n\tat java.base\/java.security.KeyStore.load(KeyStore.java:1473)\n\tat java.base\/sun.security.ssl.TrustStoreManager$TrustAnchorManager.loadKeyStore(TrustStoreManager.java:390)\n\tat java.base\/sun.security.ssl.TrustStoreManager$TrustAnchorManager.getTrustedCerts(TrustStoreManager.java:336)\n\tat java.base\/sun.security.ssl.TrustStoreManager.getTrustedCerts(TrustStoreManager.java:57)\n\tat java.base\/sun.security.ssl.TrustManagerFactoryImpl.engineInit(TrustManagerFactoryImpl.java:49)\n\t... 83 common frames omitted\n```\n\nThrowing an exception with a more detailed error message facilitates\ndebugging and ultimately fixing such problems."},"files":[{"filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/TrustStoreManager.java"}],"sha":"257bc1745cf275d691db1801f8dd270b9ff1b324"}]