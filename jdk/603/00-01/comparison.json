{"files":[{"patch":"@@ -2951,0 +2951,1 @@\n+    const Register rklass_tmp = r9;  \/\/ load_klass\n@@ -2952,1 +2953,2 @@\n-    const Address  length(rsp, 6 * wordSize);  \/\/ elements count is on stack on Win64\n+    const Address  length(rsp, 7 * wordSize);  \/\/ elements count is on stack on Win64\n+    const Register rklass_tmp = rdi;  \/\/ load_klass\n@@ -2973,0 +2975,4 @@\n+#ifdef _WIN64\n+   __ push(rklass_tmp); \/\/ rdi is callee-save on Windows\n+#endif\n+\n@@ -3017,0 +3023,1 @@\n+    const Register r11_length    = r11; \/\/ elements count to copy\n@@ -3020,2 +3027,3 @@\n-    __ cmpl(length, 0);\n-    __ jccb(Assembler::less, L_failed_0);\n+    __ movl(r11_length, length);        \/\/ length (elements count, 32-bits value)\n+    __ testl(r11_length, r11_length);\n+    __ jccb(Assembler::negative, L_failed_0);\n@@ -3023,1 +3031,1 @@\n-    __ load_klass(r10_src_klass, src, r11);\n+    __ load_klass(r10_src_klass, src, rklass_tmp);\n@@ -3034,1 +3042,1 @@\n-      __ load_klass(rax, dst, r11);\n+      __ load_klass(rax, dst, rklass_tmp);\n@@ -3057,1 +3065,1 @@\n-    __ load_klass(rax, dst, r11);\n+    __ load_klass(rax, dst, rklass_tmp);\n@@ -3081,4 +3089,2 @@\n-    const Register length_reg = NOT_WIN64(length) WIN64_ONLY(r11); \/\/ elements count to copy\n-    WIN64_ONLY(__ movl(length_reg, length);) \/\/ Load from stack\n-\n-    arraycopy_range_checks(src, src_pos, dst, dst_pos, length_reg, r10, L_failed);\n+    arraycopy_range_checks(src, src_pos, dst, dst_pos, r11_length,\n+                           r10, L_failed);\n@@ -3103,0 +3109,4 @@\n+#ifdef _WIN64\n+    __ pop(rklass_tmp); \/\/ Restore callee-save rdi\n+#endif\n+\n@@ -3115,1 +3125,1 @@\n-    __ movl2ptr(count, length_reg); \/\/ length\n+    __ movl2ptr(count, r11_length); \/\/ length\n@@ -3123,1 +3133,1 @@\n-    __ movl2ptr(count, length_reg); \/\/ length\n+    __ movl2ptr(count, r11_length); \/\/ length\n@@ -3131,1 +3141,1 @@\n-    __ movl2ptr(count, length_reg); \/\/ length\n+    __ movl2ptr(count, r11_length); \/\/ length\n@@ -3148,1 +3158,1 @@\n-    __ movl2ptr(count, length_reg); \/\/ length\n+    __ movl2ptr(count, r11_length); \/\/ length\n@@ -3153,1 +3163,1 @@\n-    \/\/ live at this point: r10_src_klass, src[_pos], dst[_pos]\n+    \/\/ live at this point:  r10_src_klass, r11_length, src[_pos], dst[_pos]\n@@ -3157,1 +3167,1 @@\n-    __ load_klass(rax, dst, r11);\n+    __ load_klass(rax, dst, rklass_tmp);\n@@ -3162,2 +3172,2 @@\n-    WIN64_ONLY(__ movl(length_reg, length);) \/\/ Load from stack\n-    arraycopy_range_checks(src, src_pos, dst, dst_pos, length_reg, r10, L_failed);\n+    arraycopy_range_checks(src, src_pos, dst, dst_pos, r11_length,\n+                           r10, L_failed);\n@@ -3169,1 +3179,1 @@\n-    __ movl2ptr(count, length_reg); \/\/ length\n+    __ movl2ptr(count, r11_length); \/\/ length\n@@ -3171,0 +3181,3 @@\n+#ifdef _WIN64\n+    __ pop(rklass_tmp); \/\/ Restore callee-save rdi\n+#endif\n@@ -3174,1 +3187,1 @@\n-    \/\/ live at this point: r10_src_klass, rax (dst_klass)\n+    \/\/ live at this point:  r10_src_klass, r11_length, rax (dst_klass)\n@@ -3181,2 +3194,2 @@\n-      WIN64_ONLY(__ movl(length_reg, length);) \/\/ Load from stack\n-      arraycopy_range_checks(src, src_pos, dst, dst_pos, length_reg, rax, L_failed);\n+      arraycopy_range_checks(src, src_pos, dst, dst_pos, r11_length,\n+                             rax, L_failed);\n@@ -3185,1 +3198,1 @@\n-      __ load_klass(r11_dst_klass, dst, rax); \/\/ reload\n+      __ load_klass(r11_dst_klass, dst, rklass_tmp); \/\/ reload\n@@ -3210,0 +3223,4 @@\n+#ifdef _WIN64\n+    __ pop(rklass_tmp); \/\/ Restore callee-save rdi\n+#endif\n+\n@@ -3219,0 +3236,3 @@\n+#ifdef _WIN64\n+    __ pop(rklass_tmp); \/\/ Restore callee-save rdi\n+#endif\n","filename":"src\/hotspot\/cpu\/x86\/stubGenerator_x86_64.cpp","additions":43,"deletions":23,"binary":false,"changes":66,"status":"modified"}]}