{"files":[{"patch":"@@ -51,1 +51,0 @@\n-import javax.imageio.IIOException;\n@@ -659,28 +658,24 @@\n-                    try {\n-                        switch(dataType) {\n-                            case DataBuffer.TYPE_BYTE:\n-                                byte[] bdata =\n-                                    ((DataBufferByte)src.getDataBuffer()).getData();\n-                                stream.write(bdata, pos, destScanlineLength);\n-                                break;\n-\n-                            case DataBuffer.TYPE_SHORT:\n-                                short[] sdata =\n-                                    ((DataBufferShort)src.getDataBuffer()).getData();\n-                                stream.writeShorts(sdata, pos, destScanlineLength);\n-                                break;\n-\n-                            case DataBuffer.TYPE_USHORT:\n-                                short[] usdata =\n-                                    ((DataBufferUShort)src.getDataBuffer()).getData();\n-                                stream.writeShorts(usdata, pos, destScanlineLength);\n-                                break;\n-\n-                            case DataBuffer.TYPE_INT:\n-                                int[] idata =\n-                                    ((DataBufferInt)src.getDataBuffer()).getData();\n-                                stream.writeInts(idata, pos, destScanlineLength);\n-                                break;\n-                            }\n-                    } catch (IndexOutOfBoundsException e) {\n-                        throw new IIOException(\"Invalid buffer length\", e);\n+                    switch(dataType) {\n+                    case DataBuffer.TYPE_BYTE:\n+                        byte[] bdata =\n+                            ((DataBufferByte)src.getDataBuffer()).getData();\n+                        stream.write(bdata, pos, destScanlineLength);\n+                        break;\n+\n+                    case DataBuffer.TYPE_SHORT:\n+                        short[] sdata =\n+                            ((DataBufferShort)src.getDataBuffer()).getData();\n+                        stream.writeShorts(sdata, pos, destScanlineLength);\n+                        break;\n+\n+                    case DataBuffer.TYPE_USHORT:\n+                        short[] usdata =\n+                            ((DataBufferUShort)src.getDataBuffer()).getData();\n+                        stream.writeShorts(usdata, pos, destScanlineLength);\n+                        break;\n+\n+                    case DataBuffer.TYPE_INT:\n+                        int[] idata =\n+                            ((DataBufferInt)src.getDataBuffer()).getData();\n+                        stream.writeInts(idata, pos, destScanlineLength);\n+                        break;\n@@ -1464,0 +1459,3 @@\n+        if (bpp != 0 && bpp != 1 && bpp != 4 && bpp != 8 && bpp != 16 && bpp != 24 && bpp != 32) {\n+            return false;\n+        }\n","filename":"src\/java.desktop\/share\/classes\/com\/sun\/imageio\/plugins\/bmp\/BMPImageWriter.java","additions":27,"deletions":29,"binary":false,"changes":56,"status":"modified"},{"patch":"@@ -34,1 +34,1 @@\n-import javax.imageio.IIOException;\n+import java.io.IOException;\n@@ -51,1 +51,1 @@\n-        } catch (IIOException e) {\n+        } catch (IOException e) {\n","filename":"test\/jdk\/javax\/imageio\/plugins\/bmp\/TruncatedPngTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}