{"files":[{"patch":"@@ -84,0 +84,15 @@\n+    private static Long openThemeImpl(String widget, int dpi) {\n+       Long theme;\n+       int i = widget.indexOf(\"::\");\n+       if (i > 0) {\n+           \/\/ We're using the syntax \"subAppName::controlName\" here, as used by msstyles.\n+           \/\/ See documentation for SetWindowTheme on MSDN.\n+           setWindowTheme(widget.substring(0, i));\n+           theme = openTheme(widget.substring(i + 2), dpi);\n+           setWindowTheme(null);\n+       } else {\n+           theme = openTheme(widget, dpi);\n+       }\n+       return theme;\n+    }\n+\n@@ -86,24 +101,2 @@\n-        Long theme = null;\n-\n-        Map<String, Long> dpiWidgetToTheme = dpiAwareWidgetToTheme.get(dpi);\n-\n-        if (dpiWidgetToTheme != null) {\n-            theme = dpiWidgetToTheme.get(widget);\n-        }\n-\n-        if (theme == null) {\n-            int i = widget.indexOf(\"::\");\n-            if (i > 0) {\n-                \/\/ We're using the syntax \"subAppName::controlName\" here, as used by msstyles.\n-                \/\/ See documentation for SetWindowTheme on MSDN.\n-                setWindowTheme(widget.substring(0, i));\n-                theme = openTheme(widget.substring(i + 2), dpi);\n-                setWindowTheme(null);\n-            } else {\n-                theme = openTheme(widget, dpi);\n-            }\n-\n-            dpiAwareWidgetToTheme.computeIfAbsent(dpi, key -> new HashMap<>()).put(widget, theme);\n-\n-        }\n-        return theme;\n+       return dpiAwareWidgetToTheme.computeIfAbsent(dpi, key -> new HashMap<>())\n+                .computeIfAbsent(widget, w -> openThemeImpl(widget, dpi));\n@@ -124,6 +117,3 @@\n-                    if (!dpiAwareWidgetToTheme.isEmpty()) {\n-                        for (Map<String, Long> dpiVal : dpiAwareWidgetToTheme.values()) {\n-                            for (Long value : dpiVal.values()) {\n-                                closeTheme(value);\n-                            }\n-                            dpiVal.clear();\n+                    for (Map<String, Long> dpiVal : dpiAwareWidgetToTheme.values()) {\n+                        for (Long value : dpiVal.values()) {\n+                            closeTheme(value);\n@@ -131,2 +121,0 @@\n-                        dpiAwareWidgetToTheme.clear();\n-                        valid = true;\n@@ -134,0 +122,2 @@\n+                    dpiAwareWidgetToTheme.clear();\n+                    valid = true;\n@@ -144,3 +134,4 @@\n-        if (dpiAwareWidgetToTheme.get(dpi) != null)\n-        {\n-            theme = dpiAwareWidgetToTheme.get(dpi).get(widget);\n+        Map<String, Long> dpiWidgetToTheme = dpiAwareWidgetToTheme.get(dpi);\n+\n+        if (dpiWidgetToTheme != null) {\n+            theme = dpiWidgetToTheme.get(widget);\n@@ -148,0 +139,1 @@\n+\n@@ -169,1 +161,0 @@\n-\n","filename":"src\/java.desktop\/windows\/classes\/sun\/awt\/windows\/ThemeReader.java","additions":27,"deletions":36,"binary":false,"changes":63,"status":"modified"}]}