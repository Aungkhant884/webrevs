{"files":[{"patch":"@@ -43,0 +43,3 @@\n+#if INCLUDE_MANAGEMENT\n+#include \"services\/finalizerTable.hpp\"\n+#endif\n@@ -352,0 +355,12 @@\n+#if INCLUDE_MANAGEMENT\n+static void on_enqueue(const DiscoveredListIterator& iter) {\n+  oop referent = iter.referent();\n+  if (referent != NULL) {\n+    assert(referent->is_instance(), \"invariant\");\n+    const InstanceKlass* const ik = InstanceKlass::cast(referent->klass());\n+    assert(ik->has_finalizer(), \"invariant\");\n+    FinalizerTable::on_enqueue(ik);\n+  }\n+}\n+#endif\n+\n@@ -364,1 +379,0 @@\n-\n@@ -366,0 +380,1 @@\n+    MANAGEMENT_ONLY(on_enqueue(iter);)\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.cpp","additions":16,"deletions":1,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -1087,2 +1087,3 @@\n-    <Field type=\"ulong\" name=\"registrations\" label=\"Registrations\" description=\"Number of objects registered for finalization\" \/>\n-    <Field type=\"ulong\" name=\"invocations\" label=\"Invocations\" description=\"Number of objects finalized by the GC\" \/>\n+    <Field type=\"ulong\" name=\"registered\" label=\"Registered\" description=\"Number of objects registered for finalization\" \/>\n+    <Field type=\"ulong\" name=\"enqueued\" label=\"Enqueued\" description=\"Number of objects enqueued for finalization by the GC\" \/>\n+    <Field type=\"ulong\" name=\"finalized\" label=\"Finalized\" description=\"Number of objects finalized\" \/>\n","filename":"src\/hotspot\/share\/jfr\/metadata\/metadata.xml","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -91,2 +91,3 @@\n-    event.set_registrations(0);\n-    event.set_invocations(0);\n+    event.set_registered(0);\n+    event.set_enqueued(0);\n+    event.set_finalized(0);\n@@ -95,2 +96,3 @@\n-    event.set_registrations(fe->registered());\n-    event.set_invocations(fe->completed());\n+    event.set_registered(fe->registered());\n+    event.set_enqueued(fe->enqueued());\n+    event.set_finalized(fe->finalized());\n","filename":"src\/hotspot\/share\/jfr\/periodic\/jfrFinalizerEvent.cpp","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -53,4 +53,0 @@\n-uint64_t FinalizerEntry::completed() const {\n-  return Atomic::load(&_completed);\n-}\n-\n@@ -61,0 +57,8 @@\n+uint64_t FinalizerEntry::enqueued() const {\n+  return Atomic::load(&_enqueued);\n+}\n+\n+uint64_t FinalizerEntry::finalized() const {\n+  return Atomic::load(&_finalized);\n+}\n+\n@@ -65,0 +69,4 @@\n+void FinalizerEntry::on_enqueue() {\n+  atomic_inc(&_enqueued);\n+}\n+\n@@ -66,1 +74,1 @@\n-  atomic_inc(&_completed);\n+  atomic_inc(&_finalized);\n@@ -405,0 +413,8 @@\n+void FinalizerTable::on_enqueue(const InstanceKlass* ik) {\n+  assert(ik != nullptr, \"invariant\");\n+  assert(ik->has_finalizer(), \"invariant\");\n+  FinalizerEntry* const fe = get_entry(ik, Thread::current());\n+  assert(fe != nullptr, \"invariant\");\n+  fe->on_enqueue();\n+}\n+\n","filename":"src\/hotspot\/share\/services\/finalizerTable.cpp","additions":21,"deletions":5,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -38,1 +38,0 @@\n-  uint64_t _completed;\n@@ -40,0 +39,2 @@\n+  uint64_t _enqueued;\n+  uint64_t _finalized;\n@@ -41,1 +42,1 @@\n-  FinalizerEntry(const InstanceKlass* ik) : _ik(ik), _completed(0), _registered(0) {}\n+  FinalizerEntry(const InstanceKlass* ik) : _ik(ik), _registered(0), _enqueued(0), _finalized(0) {}\n@@ -43,1 +44,0 @@\n-  uint64_t completed() const NOT_MANAGEMENT_RETURN_(0L);\n@@ -45,0 +45,2 @@\n+  uint64_t enqueued() const NOT_MANAGEMENT_RETURN_(0L);\n+  uint64_t finalized() const NOT_MANAGEMENT_RETURN_(0L);\n@@ -46,0 +48,1 @@\n+  void on_enqueue() NOT_MANAGEMENT_RETURN;\n@@ -64,1 +67,0 @@\n-  static void on_complete(const instanceHandle& i, JavaThread* finalizerThread) NOT_MANAGEMENT_RETURN;\n@@ -66,0 +68,2 @@\n+  static void on_enqueue(const InstanceKlass* ik) NOT_MANAGEMENT_RETURN;\n+  static void on_complete(const instanceHandle& i, JavaThread* finalizerThread) NOT_MANAGEMENT_RETURN;\n","filename":"src\/hotspot\/share\/services\/finalizerTable.hpp","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"}]}