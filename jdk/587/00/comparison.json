{"files":[{"patch":"@@ -32,0 +32,1 @@\n+ * @library \/test\/lib\n@@ -38,0 +39,3 @@\n+import java.awt.Frame;\n+import java.awt.Menu;\n+import java.awt.MenuBar;\n@@ -42,0 +46,1 @@\n+\n@@ -47,0 +52,2 @@\n+import jdk.test.lib.process.ProcessTools;\n+\n@@ -51,1 +58,1 @@\n-    private boolean isApplicationOpened;\n+    private Process process;\n@@ -54,1 +61,1 @@\n-    public TestNoScreenMenuBar(String[] args)\n+    public TestNoScreenMenuBar()\n@@ -63,5 +70,3 @@\n-        if (!(args.length > 0 && args[0].equals(\"baseline\"))) {\n-            \/\/ activate another application\n-            openOtherApplication();\n-            robot.delay(500);\n-        }\n+        \/\/ activate another java application\n+        openOtherApplication();\n+        robot.delay(2000);\n@@ -137,3 +142,1 @@\n-        String[] cmd = { \"\/usr\/bin\/open\", \"\/Applications\/System Preferences.app\" };\n-        execute(cmd);\n-        isApplicationOpened = true;\n+        process = execute();\n@@ -143,3 +146,2 @@\n-        if (isApplicationOpened) {\n-            String[] cmd = { \"\/usr\/bin\/osascript\", \"-e\", \"tell application \\\"System Preferences\\\" to close window 1\" };\n-            execute(cmd);\n+        if (process != null) {\n+            process.destroyForcibly();\n@@ -149,1 +151,1 @@\n-    private void execute(String[] cmd) {\n+    private Process execute() {\n@@ -151,3 +153,4 @@\n-            Process p = Runtime.getRuntime().exec(cmd);\n-            p.waitFor();\n-        } catch (IOException | InterruptedException ex) {\n+            ProcessBuilder pb = ProcessTools.createJavaProcessBuilder(\n+                    TestNoScreenMenuBar.class.getSimpleName(), \"mark\");\n+            return ProcessTools.startProcess(\"Other frame\", pb);\n+        } catch (IOException ex) {\n@@ -174,1 +177,11 @@\n-\n+        if (args.length != 0) {\n+            Frame frame = new Frame();\n+            MenuBar mb = new MenuBar();\n+            mb.add(new Menu(\"Hello\"));\n+            frame.setMenuBar(mb);\n+            frame.setSize(300, 300);\n+            frame.setLocationRelativeTo(null);\n+            frame.setVisible(true);\n+            frame.toFront();\n+            return;\n+        }\n@@ -177,1 +190,1 @@\n-            runSwing(() -> theTest = new TestNoScreenMenuBar(args));\n+            runSwing(() -> theTest = new TestNoScreenMenuBar());\n","filename":"test\/jdk\/java\/awt\/MenuBar\/TestNoScreenMenuBar.java","additions":32,"deletions":19,"binary":false,"changes":51,"status":"modified"}]}