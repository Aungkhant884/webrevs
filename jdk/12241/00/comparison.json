{"files":[{"patch":"@@ -184,1 +184,1 @@\n-    public AnnotationType annotationTargetType(Attribute.Compound a, Symbol s) {\n+    public AnnotationType annotationTargetType(JCTree tree, Attribute.Compound a, Symbol s) {\n@@ -192,1 +192,1 @@\n-                        .map(attr -> targetToAnnotationType(attr, s))\n+                        .map(attr -> targetToAnnotationType(tree, a, attr, s))\n@@ -208,1 +208,1 @@\n-    private AnnotationType targetToAnnotationType(Attribute a, Symbol s) {\n+    private AnnotationType targetToAnnotationType(JCTree tree, Attribute.Compound anno, Attribute a, Symbol s) {\n@@ -258,2 +258,1 @@\n-            Assert.error(\"annotationTargetType(): unrecognized Attribute name \" + e.value.name +\n-                    \" (\" + e.value.name.getClass() + \")\");\n+            log.error(TreeInfo.diagnosticPositionFor(anno.type.tsym, tree), Errors.AnnotationUnrecognizedAttributeName(anno.type, e.value.name));\n@@ -309,1 +308,1 @@\n-        private void separateAnnotationsKinds(JCTree typetree, Type type,\n+        private void separateAnnotationsKinds(JCTree tree, JCTree typetree, Type type,\n@@ -318,1 +317,1 @@\n-                switch (annotationTargetType(a, sym)) {\n+                switch (annotationTargetType(tree, a, sym)) {\n@@ -1170,1 +1169,1 @@\n-                        separateAnnotationsKinds(tree, null, tree.sym, pos);\n+                        separateAnnotationsKinds(tree, tree, null, tree.sym, pos);\n@@ -1174,1 +1173,1 @@\n-                        separateAnnotationsKinds(tree.restype,\n+                        separateAnnotationsKinds(tree, tree.restype,\n@@ -1187,1 +1186,1 @@\n-                        separateAnnotationsKinds(tree.recvparam.vartype, tree.recvparam.sym.type, tree.recvparam.sym, pos);\n+                        separateAnnotationsKinds(tree, tree.recvparam.vartype, tree.recvparam.sym.type, tree.recvparam.sym, pos);\n@@ -1200,1 +1199,1 @@\n-                            separateAnnotationsKinds(param.vartype, param.sym.type, param.sym, pos);\n+                            separateAnnotationsKinds(param, param.vartype, param.sym.type, param.sym, pos);\n@@ -1242,1 +1241,1 @@\n-                                separateAnnotationsKinds(param.vartype, param.sym.type, param.sym, pos);\n+                                separateAnnotationsKinds(param, param.vartype, param.sym.type, param.sym, pos);\n@@ -1275,1 +1274,1 @@\n-                    separateAnnotationsKinds(tree.vartype, tree.sym.type, tree.sym, pos);\n+                    separateAnnotationsKinds(tree, tree.vartype, tree.sym.type, tree.sym, pos);\n@@ -1282,1 +1281,1 @@\n-                    separateAnnotationsKinds(tree.vartype, tree.sym.type, tree.sym, pos);\n+                    separateAnnotationsKinds(tree, tree.vartype, tree.sym.type, tree.sym, pos);\n@@ -1288,1 +1287,1 @@\n-                separateAnnotationsKinds(tree.vartype, tree.sym.type, tree.sym, pos);\n+                separateAnnotationsKinds(tree, tree.vartype, tree.sym.type, tree.sym, pos);\n@@ -1293,1 +1292,1 @@\n-                separateAnnotationsKinds(tree.vartype, tree.sym.type, tree.sym, pos);\n+                separateAnnotationsKinds(tree, tree.vartype, tree.sym.type, tree.sym, pos);\n@@ -1298,1 +1297,1 @@\n-                separateAnnotationsKinds(tree.vartype, tree.sym.type, tree.sym, pos);\n+                separateAnnotationsKinds(tree, tree.vartype, tree.sym.type, tree.sym, pos);\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/code\/TypeAnnotations.java","additions":16,"deletions":17,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -5869,1 +5869,1 @@\n-                        typeAnnotations.annotationTargetType(ai.attribute, sym) == TypeAnnotations.AnnotationType.DECLARATION) {\n+                        typeAnnotations.annotationTargetType(ai, ai.attribute, sym) == TypeAnnotations.AnnotationType.DECLARATION) {\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/comp\/Attr.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -158,0 +158,4 @@\n+# 0: type, 1: name\n+compiler.err.annotation.unrecognized.attribute.name=\\\n+    annotation @{0} has an unrecognizable attribute named ''{1}''\n+\n","filename":"src\/jdk.compiler\/share\/classes\/com\/sun\/tools\/javac\/resources\/compiler.properties","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -0,0 +1,75 @@\n+class A {\n+  0xCAFEBABE;\n+  0; \/\/ minor version\n+  55; \/\/ version\n+  [] { \/\/ Constant Pool\n+    ; \/\/ first element is empty\n+    Utf8 \"A\"; \/\/ #1\n+    class #1; \/\/ #2\n+    Utf8 \"java\/lang\/Object\"; \/\/ #3\n+    class #3; \/\/ #4\n+    Utf8 \"java\/lang\/annotation\/Annotation\"; \/\/ #5\n+    class #5; \/\/ #6\n+    Utf8 \"A.java\"; \/\/ #7\n+    Utf8 \"Ljava\/lang\/annotation\/Target;\"; \/\/ #8\n+    Utf8 \"value\"; \/\/ #9\n+    Utf8 \"Ljava\/lang\/annotation\/ElementType;\"; \/\/ #10\n+    Utf8 \"FIELD\"; \/\/ #11\n+    Utf8 \"NO_SUCH\"; \/\/ #12\n+    Utf8 \"SourceFile\"; \/\/ #13\n+    Utf8 \"RuntimeVisibleAnnotations\"; \/\/ #14\n+  } \/\/ Constant Pool\n+\n+  0x2600; \/\/ access\n+  #2;\/\/ this_cpx\n+  #4;\/\/ super_cpx\n+\n+  [] { \/\/ Interfaces\n+    #6;\n+  } \/\/ Interfaces\n+\n+  [] { \/\/ Fields\n+  } \/\/ Fields\n+\n+  [] { \/\/ Methods\n+  } \/\/ Methods\n+\n+  [] { \/\/ Attributes\n+    Attr(#13) { \/\/ SourceFile\n+      #7;\n+    } \/\/ end SourceFile\n+    ;\n+    Attr(#14) { \/\/ RuntimeVisibleAnnotations\n+      [] { \/\/ annotations\n+        {  \/\/  annotation\n+          #8;\n+          [] { \/\/ element_value_pairs\n+            {  \/\/  element value pair\n+              #9;\n+              {  \/\/  element_value\n+                '[';\n+                [] { \/\/ array_value\n+                  {  \/\/  element_value\n+                    'e';\n+                    {  \/\/  enum_const_value\n+                      #10;\n+                      #11;\n+                    }  \/\/  enum_const_value\n+                  }  \/\/  element_value\n+                  ;\n+                  {  \/\/  element_value\n+                    'e';\n+                    {  \/\/  enum_const_value\n+                      #10;\n+                      #12;\n+                    }  \/\/  enum_const_value\n+                  }  \/\/  element_value\n+                }  \/\/  array_value\n+              }  \/\/  element_value\n+            }  \/\/  element value pair\n+          }  \/\/  element_value_pairs\n+        }  \/\/  annotation\n+      }\n+    } \/\/ end RuntimeVisibleAnnotations\n+  } \/\/ Attributes\n+} \/\/ end class A\n","filename":"test\/langtools\/tools\/javac\/annotations\/crashOnUnknownAttr\/A.jcod","additions":75,"deletions":0,"binary":false,"changes":75,"status":"added"},{"patch":"@@ -0,0 +1,11 @@\n+\/*\n+ * @test \/nodynamiccopyright\/\n+ * @summary compiler is crashing with AssertionError for annotations with unknown target type\n+ * @bug 8296010\n+ * @build A\n+ * @compile\/fail\/ref=CrashOnUnknownTargetTypeTest.out -XDrawDiagnostics CrashOnUnknownTargetTypeTest.java\n+ *\/\n+\n+public class CrashOnUnknownTargetTypeTest {\n+    @A Object o;\n+}\n","filename":"test\/langtools\/tools\/javac\/annotations\/crashOnUnknownAttr\/CrashOnUnknownTargetTypeTest.java","additions":11,"deletions":0,"binary":false,"changes":11,"status":"added"},{"patch":"@@ -0,0 +1,5 @@\n+- compiler.warn.unknown.enum.constant: A.class, java.lang.annotation.ElementType, NO_SUCH\n+- compiler.warn.unknown.enum.constant: Annotation.class, java.lang.annotation.ElementType, NO_SUCH\n+CrashOnUnknownTargetTypeTest.java:10:6: compiler.err.annotation.unrecognized.attribute.name: A, NO_SUCH\n+1 error\n+2 warnings\n","filename":"test\/langtools\/tools\/javac\/annotations\/crashOnUnknownAttr\/CrashOnUnknownTargetTypeTest.out","additions":5,"deletions":0,"binary":false,"changes":5,"status":"added"},{"patch":"@@ -210,0 +210,3 @@\n+\n+# this one needs a forged class file to be reproduced\n+compiler.err.annotation.unrecognized.attribute.name\n\\ No newline at end of file\n","filename":"test\/langtools\/tools\/javac\/diags\/examples.not-yet.txt","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"}]}