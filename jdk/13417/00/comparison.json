{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n-  @key headful\n+   @key headful\n@@ -29,1 +29,0 @@\n-   @author Alexander Potochkin\n@@ -33,1 +32,5 @@\n-import javax.swing.*;\n+import java.awt.event.InputEvent;\n+import java.awt.Point;\n+import java.awt.Robot;\n+import javax.swing.JFrame;\n+import javax.swing.JTable;\n@@ -37,2 +40,2 @@\n-import java.awt.*;\n-import java.awt.event.InputEvent;\n+import javax.swing.SwingUtilities;\n+import javax.swing.UIManager;\n@@ -41,0 +44,1 @@\n+    private static JFrame frame;\n@@ -42,0 +46,1 @@\n+    private static volatile Point point;\n@@ -44,0 +49,2 @@\n+        try {\n+            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());\n@@ -45,15 +52,26 @@\n-        UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());\n-\n-        Robot robot = new Robot();\n-        robot.setAutoDelay(20);\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            public void run() {\n-                \/\/ just to quickly grab a column model\n-                JTable table = new JTable(10, 5);\n-                header = new JTableHeader(table.getColumnModel());\n-                checkColumn(0, \"A\");\n-                JFrame frame = new JFrame(\"standalone header\");\n-                frame.add(header);\n-                frame.pack();\n-                frame.setVisible(true);\n-                frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+            Robot robot = new Robot();\n+            robot.setAutoDelay(100);\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                public void run() {\n+                    \/\/ just to quickly grab a column model\n+                    JTable table = new JTable(10, 5);\n+                    header = new JTableHeader(table.getColumnModel());\n+                    checkColumn(0, \"A\");\n+                    frame = new JFrame(\"standalone header\");\n+                    frame.add(header);\n+                    frame.pack();\n+                    frame.setLocationRelativeTo(null);\n+                    frame.setVisible(true);\n+                    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n+                }\n+            });\n+            robot.waitForIdle();\n+            robot.delay(1000);\n+            SwingUtilities.invokeAndWait(() -> {\n+                point = header.getLocationOnScreen();\n+            });\n+            robot.mouseMove(point.x + 3, point.y + 3);\n+            robot.waitForIdle();\n+            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);\n+            for (int i = 0; i < header.getWidth() - 3; i++) {\n+                robot.mouseMove(point.x + i, point.y + 3);\n@@ -61,7 +79,14 @@\n-        });\n-        robot.waitForIdle();\n-        Point point = header.getLocationOnScreen();\n-        robot.mouseMove(point.x + 3, point.y + 3);\n-        robot.mousePress(InputEvent.BUTTON1_MASK);\n-        for (int i = 0; i < header.getWidth() - 3; i++) {\n-            robot.mouseMove(point.x + i, point.y + 3);\n+            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);\n+            robot.waitForIdle();\n+            SwingUtilities.invokeAndWait(new Runnable() {\n+                public void run() {\n+                    TableColumnModel model = header.getColumnModel();\n+                    checkColumn(model.getColumnCount() - 1, \"A\");\n+                }\n+            });\n+        } finally {\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n@@ -69,7 +94,0 @@\n-        robot.mouseRelease(InputEvent.BUTTON1_MASK);\n-        SwingUtilities.invokeAndWait(new Runnable() {\n-            public void run() {\n-                TableColumnModel model = header.getColumnModel();\n-                checkColumn(model.getColumnCount() - 1, \"A\");\n-            }\n-        });\n","filename":"test\/jdk\/javax\/swing\/JTableHeader\/6884066\/bug6884066.java","additions":53,"deletions":35,"binary":false,"changes":88,"status":"modified"}]}