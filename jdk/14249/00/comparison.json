{"files":[{"patch":"@@ -35,1 +35,0 @@\n-import java.lang.invoke.MethodHandles.Lookup.ClassOption;\n@@ -48,7 +47,0 @@\n-        \/\/ This class is also used by the appcds\/dynamicArchive\/RegularHiddenClass.java\n-        \/\/ test which will pass the \"keep-alive\" argument during dynamic CDS dump\n-        \/\/ for preventing from being GC'ed prior to the dumping operation.\n-        boolean keepAlive = false;\n-        if (args.length == 1 && args[0].equals(\"keep-alive\")) {\n-            keepAlive = true;\n-        }\n@@ -59,2 +51,2 @@\n-            Class<?> c0 = lookup.defineHiddenClass(klassbuf, false, NESTMATE).lookupClass();\n-            Class.forName(c0.getName()).newInstance();\n+            Class<?> cl = lookup.defineHiddenClass(klassbuf, false, NESTMATE).lookupClass();\n+            Class.forName(cl.getName()).newInstance();\n@@ -71,3 +63,2 @@\n-        ClassOption classOption = keepAlive ? STRONG : NESTMATE;\n-        Class<?> c1 = lookup.defineHiddenClass(klassbuf, false, classOption).lookupClass();\n-        Class<?> c2 = lookup.defineHiddenClass(klassbuf, false, classOption).lookupClass();\n+        Class<?> c1 = lookup.defineHiddenClass(klassbuf, false, NESTMATE).lookupClass();\n+        Class<?> c2 = lookup.defineHiddenClass(klassbuf, false, NESTMATE).lookupClass();\n","filename":"test\/hotspot\/jtreg\/runtime\/HiddenClasses\/InstantiateHiddenClass.java","additions":4,"deletions":13,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -33,2 +33,0 @@\n-    \/\/ Prevent the following class from being GC'ed too soon.\n-    private static Class keptC = null;\n@@ -37,2 +35,2 @@\n-        if (args.length < 3) {\n-            throw new RuntimeException(\"Unexpected number of arguments: expected at least 3, actual \" + args.length);\n+        if (args.length != 3) {\n+            throw new RuntimeException(\"Unexpected number of arguments: expected 3, actual \" + args.length);\n@@ -67,8 +65,0 @@\n-        \/\/ The HelloDynamicCustom.java and PrintSharedArchiveAndExit.java tests\n-        \/\/ under appcds\/dynamicArchive pass the keep-alive argument for preventing\n-        \/\/ the class from being GC'ed prior to dumping of the dynamic CDS archive.\n-        boolean keepAlive = false;\n-        if (args[args.length - 1].equals(\"keep-alive\")) {\n-            keepAlive = true;\n-        }\n-\n@@ -78,3 +68,0 @@\n-        if (keepAlive) {\n-            keptC = c;\n-        }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/customLoader\/test-classes\/HelloUnload.java","additions":2,"deletions":15,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import java.util.HashMap;\n@@ -32,2 +31,0 @@\n-    \/\/ Prevent the classes from being GC'ed too soon.\n-    static HashMap<String, Class> clsMap = new HashMap<>();\n@@ -50,10 +47,0 @@\n-        \/\/ The OldClassAndInf.java test under appcds\/dynamicArchive passes the keep-alive\n-        \/\/ argument for preventing the classes from being GC'ed prior to dumping of\n-        \/\/ the dynamic CDS archive.\n-        int startIdx = 2;\n-        boolean keepAlive = false;\n-        if (args[2].equals(\"keep-alive\")) {\n-            keepAlive = true;\n-            startIdx = 3;\n-        }\n-\n@@ -63,1 +50,1 @@\n-        for (int i = startIdx; i < args.length; i++) {\n+        for (int i = 2; i < args.length; i++) {\n@@ -67,3 +54,0 @@\n-            if (keepAlive) {\n-                clsMap.put(args[i], c);\n-            }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/customLoader\/test-classes\/OldClassApp.java","additions":1,"deletions":17,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -67,1 +67,1 @@\n-            mainAppClass, customJarPath, \"false\", \"false\", \"keep-alive\")\n+            mainAppClass, customJarPath, \"false\", \"false\")\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/HelloDynamicCustom.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -52,1 +52,1 @@\n-            \"-cp\", appJar, mainClass, appJar, \"init\", \"keep-alive\")\n+            \"-cp\", appJar, mainClass, appJar, \"init\")\n@@ -70,1 +70,1 @@\n-            \"-cp\", appJar, mainClass, appJar, \"keep-alive\")\n+            \"-cp\", appJar, mainClass, appJar)\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/LambdaCustomLoader.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -83,1 +83,1 @@\n-                     mainAppClass, loadeesJar, inArchive, \"keep-alive\"),\n+                     mainAppClass, loadeesJar, inArchive),\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/OldClassAndInf.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -67,1 +67,1 @@\n-            mainAppClass, customJarPath, \"false\", \"false\", \"keep-alive\")\n+            mainAppClass, customJarPath, \"false\", \"false\")\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/PrintSharedArchiveAndExit.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -57,1 +57,1 @@\n-            \"-cp\", appJar, mainClass, \"keep-alive\")\n+            \"-cp\", appJar, mainClass)\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/RegularHiddenClass.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -31,2 +31,0 @@\n-    \/\/ Prevent the class from being GC'ed too soon.\n-    private static Class keptC = null;\n@@ -42,1 +40,1 @@\n-        if (args.length >= 2 && args[1].equals(\"init\")) {\n+        if (args.length ==2 && args[1].equals(\"init\")) {\n@@ -46,8 +44,0 @@\n-        \/\/ The dynamicArchive\/LambdaCustomLoader.java test passes the keep-alive\n-        \/\/ argument for preventing the class from being GC'ed prior to dumping of\n-        \/\/ the dynamic CDS archive.\n-        boolean keepAlive = false;\n-        if (args[args.length - 1].equals(\"keep-alive\")) {\n-            keepAlive = true;\n-        }\n-\n@@ -57,4 +47,0 @@\n-        if (keepAlive) {\n-            keptC = c;\n-        }\n-\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/test-classes\/CustomLoaderApp.java","additions":1,"deletions":15,"binary":false,"changes":16,"status":"modified"}]}