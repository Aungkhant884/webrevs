{"files":[{"patch":"@@ -827,0 +827,1 @@\n+    ResourceMark rm;\n","filename":"src\/hotspot\/share\/classfile\/classLoaderData.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -30,1 +30,1 @@\n-#include \"classfile\/javaClasses.hpp\"\n+#include \"classfile\/javaClasses.inline.hpp\"\n@@ -68,4 +68,0 @@\n-void Klass::replace_java_mirror(oop mirror) {\n-  _java_mirror.replace(mirror);\n-}\n-\n@@ -791,1 +787,1 @@\n-    guarantee(oopDesc::is_oop(java_mirror_no_keepalive()), \"should be instance\");\n+    guarantee(java_lang_Class::is_instance(java_mirror_no_keepalive()), \"should be instance\");\n","filename":"src\/hotspot\/share\/oops\/klass.cpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -272,1 +272,2 @@\n-  void replace_java_mirror(oop mirror);\n+  OopHandle java_mirror_handle() const { return _java_mirror; }\n+  void replace_java_mirror_handle(OopHandle mirror) { _java_mirror.assign_handle(mirror); }\n","filename":"src\/hotspot\/share\/oops\/klass.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -58,0 +58,7 @@\n+  OopHandle& assign_handle(const OopHandle& copy) {\n+    \/\/ Assignment is used by RedefineClasses for java_mirror to temporarily\n+    \/\/ replace the mirror in the scratch class.\n+    _obj = copy._obj;\n+    return *this;\n+  }\n+\n","filename":"src\/hotspot\/share\/oops\/oopHandle.hpp","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -1327,1 +1327,1 @@\n-  Handle            _scratch_mirror;\n+  OopHandle         _scratch_mirror;\n@@ -1335,2 +1335,2 @@\n-    _scratch_mirror = Handle(_state->get_thread(), _scratch_class->java_mirror());\n-    _scratch_class->replace_java_mirror(the_class->java_mirror());\n+    _scratch_mirror = _scratch_class->java_mirror_handle();\n+    _scratch_class->replace_java_mirror_handle(the_class->java_mirror_handle());\n@@ -1342,1 +1342,1 @@\n-    _scratch_class->replace_java_mirror(_scratch_mirror());\n+    _scratch_class->replace_java_mirror_handle(_scratch_mirror);\n","filename":"src\/hotspot\/share\/prims\/jvmtiRedefineClasses.cpp","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"}]}