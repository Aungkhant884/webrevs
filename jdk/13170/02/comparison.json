{"files":[{"patch":"@@ -33,3 +33,0 @@\n-com\/sun\/jdi\/FetchLocals.java 8285422 generic-all\n-com\/sun\/jdi\/Frames2Test.java 8285422 generic-all\n-com\/sun\/jdi\/GetSetLocalTest.java 8285422 generic-all\n@@ -40,1 +37,0 @@\n-com\/sun\/jdi\/LaunchCommandLine.java 8285422 generic-all\n@@ -43,1 +39,0 @@\n-com\/sun\/jdi\/NativeInstanceFilter.java 8285422 generic-all\n","filename":"test\/jdk\/ProblemList-svc-vthread.txt","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2015, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -233,1 +233,1 @@\n-        args = new String[] { \"-J-Dnthreads=\" + nthreads, \"-J-Dnhits=\" + nhits} ;\n+        args = new String[] { \"-Dnthreads=\" + nthreads, \"-Dnhits=\" + nhits} ;\n","filename":"test\/jdk\/com\/sun\/jdi\/MultiBreakpointsTest.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -464,0 +464,3 @@\n+    final List<String> doubleWordArgs = List.of(\"-cp\", \"-classpath\", \"--add-opens\", \"--class-path\",\n+            \"--upgrade-module-path\", \"--add-modules\", \"-d\", \"--add-exports\", \"--patch-module\", \"--module-path\");\n+\n@@ -466,9 +469,11 @@\n-        String mainWrapper = System.getProperty(\"main.wrapper\");\n-        if (\"Virtual\".equals(mainWrapper)) {\n-            argInfo.targetAppCommandLine = TestScaffold.class.getName() + \" \" + mainWrapper + \" \";\n-            argInfo.targetVMArgs += \"--enable-preview \";\n-        } else if (\"true\".equals(System.getProperty(\"test.enable.preview\"))) {\n-            \/\/ the test specified @enablePreview.\n-            argInfo.targetVMArgs += \"--enable-preview \";\n-        }\n-\n+        \/\/ Parse arguments, like java\/j* tools command-line arguments\n+        \/\/ the first argument not-starting with '-' is treated as a classname\n+        \/\/ the other arguments are split to targetVMArgs targetAppCommandLine correspondingly\n+        \/\/ The example of args for line '@run driver Frames2Test -Xss4M' is  '-Xss4M' 'Frames2Targ'.\n+        \/\/ The result without any wrapper enabled:\n+        \/\/ argInfo.targetAppCommandLine : Frames2Targ\n+        \/\/ argInfo.targetVMArgs : -Xss4M\n+        \/\/ The result with wrapper enabled:\n+        \/\/ argInfo.targetAppCommandLine : TestScaffold Virtual Frames2Targ\n+        \/\/ argInfo.targetVMArgs : -Xss4M --enable-preview\n+        boolean classNameParsed = false;\n@@ -476,1 +481,7 @@\n-            if (args[i].equals(\"-connect\")) {\n+            String arg = args[i].trim();\n+            if (classNameParsed) {\n+                \/\/ once classname is read, treat any other arguments as app arguments\n+                argInfo.targetAppCommandLine += (arg + ' ');\n+                continue;\n+            }\n+            if (arg.equals(\"-connect\")) {\n@@ -479,1 +490,1 @@\n-            } else if (args[i].equals(\"-trace\")) {\n+            } else if (arg.equals(\"-trace\")) {\n@@ -482,1 +493,1 @@\n-            } else if (args[i].equals(\"-redefstart\")) {\n+            } else if (arg.equals(\"-redefstart\")) {\n@@ -484,1 +495,1 @@\n-            } else if (args[i].equals(\"-redefevent\")) {\n+            } else if (arg.equals(\"-redefevent\")) {\n@@ -486,1 +497,1 @@\n-            } else if (args[i].equals(\"-redefasync\")) {\n+            } else if (arg.equals(\"-redefasync\")) {\n@@ -488,8 +499,6 @@\n-            } else if (args[i].startsWith(\"-J\")) {\n-                argInfo.targetVMArgs += (args[i].substring(2) + ' ');\n-\n-                \/*\n-                 * classpath can span two arguments so we need to handle\n-                 * it specially.\n-                 *\/\n-                if (args[i].equals(\"-J-classpath\")) {\n+            } else if (arg.startsWith(\"-J\")) {\n+                argInfo.targetVMArgs += (arg.substring(2) + ' ');\n+                throw new RuntimeException(\"-J-option is not supported. Incorrect arg: \" + args[i]);\n+            } else if (arg.startsWith(\"-\")) {\n+                argInfo.targetVMArgs += (arg + ' ');\n+                if (doubleWordArgs.contains(arg)) {\n@@ -500,1 +509,2 @@\n-                argInfo.targetAppCommandLine += (args[i] + ' ');\n+                classNameParsed = true;\n+                argInfo.targetAppCommandLine += (arg + ' ');\n@@ -503,0 +513,11 @@\n+\n+        \/\/ Need to change args to run wrapper using command like 'TestScaffold Virtual <app-name>'\n+        String mainWrapper = System.getProperty(\"main.wrapper\");\n+        if (mainWrapper != null && !argInfo.targetAppCommandLine.isEmpty()) {\n+            argInfo.targetAppCommandLine = TestScaffold.class.getName() + ' '\n+                    + mainWrapper + ' ' + argInfo.targetAppCommandLine;\n+            argInfo.targetVMArgs += \"--enable-preview \";\n+        } else if (\"true\".equals(System.getProperty(\"test.enable.preview\"))) {\n+            \/\/ the test specified @enablePreview.\n+            argInfo.targetVMArgs += \"--enable-preview \";\n+        }\n","filename":"test\/jdk\/com\/sun\/jdi\/TestScaffold.java","additions":44,"deletions":23,"binary":false,"changes":67,"status":"modified"}]}