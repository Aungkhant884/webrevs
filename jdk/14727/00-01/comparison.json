{"files":[{"patch":"@@ -32,0 +32,1 @@\n+import javax.print.PrintService;\n@@ -45,0 +46,4 @@\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n@@ -53,0 +58,3 @@\n+    private static volatile int testTotalCount;\n+\n+    private static Set<Attribute> supportedSides = new HashSet<>();\n@@ -57,3 +65,8 @@\n-            testPrint(Sides.ONE_SIDED);\n-            testPrint(Sides.DUPLEX);\n-            testPrint(Sides.TUMBLE);\n+\n+            Set<Attribute> supportedSides = getSupportedSidesAttributes();\n+            if (supportedSides.size() > 1) {\n+                testTotalCount = supportedSides.size();\n+                testPrint(Sides.ONE_SIDED, supportedSides);\n+                testPrint(Sides.DUPLEX, supportedSides);\n+                testPrint(Sides.TUMBLE, supportedSides);\n+            }\n@@ -80,2 +93,3 @@\n-        if (testCount < 3) {\n-            throw new Exception(\"Timeout: less than 3 tests were running!\");\n+        if (testCount != testTotalCount) {\n+            throw new Exception(\n+                    \"Timeout: \" + testCount + \" tests passed out from \" + testTotalCount);\n@@ -125,1 +139,1 @@\n-        return String.format(\"Page: %d - %s\", page, getSidesDescription(sides));\n+        return String.format(\"Page: %d - %s\", page, getSidesText(sides));\n@@ -128,1 +142,1 @@\n-    private static String getSidesDescription(Sides sides) {\n+    private static String getSidesText(Sides sides) {\n@@ -139,0 +153,26 @@\n+    private static String getSidesDescription(Sides sides) {\n+        if (Sides.ONE_SIDED.equals(sides)) {\n+            return \"a one-sided document\";\n+        } else if (Sides.TWO_SIDED_SHORT_EDGE.equals(sides)) {\n+            return \"double-sided document along the short edge of the paper\";\n+        } else if (Sides.TWO_SIDED_LONG_EDGE.equals(sides)) {\n+            return \"double-sided document along the long edge of the paper\";\n+        }\n+        throw new RuntimeException(\"Unknown sides attribute: \" + sides);\n+    }\n+\n+    private static Set<Attribute> getSupportedSidesAttributes() {\n+        Set<Attribute> supportedSides = new HashSet<>();\n+\n+        PrinterJob printerJob = PrinterJob.getPrinterJob();\n+        PrintService service = printerJob.getPrintService();\n+\n+        Object obj = service.getSupportedAttributeValues(Sides.class, null, null);\n+        if (obj instanceof Attribute[]) {\n+            Attribute[] attr = (Attribute[]) obj;\n+            Collections.addAll(supportedSides, attr);\n+        }\n+\n+        return supportedSides;\n+    }\n+\n@@ -143,1 +183,2 @@\n-    private static void fail() {\n+    private static void fail(Sides sides) {\n+        System.out.printf(\"Failed test: %s%n\", getSidesText(sides));\n@@ -151,1 +192,1 @@\n-            fail();\n+            fail(sides);\n@@ -156,1 +197,1 @@\n-    private static void testPrint(Sides sides) {\n+    private static void testPrint(Sides sides, Set<Attribute> supportedSides) {\n@@ -158,1 +199,1 @@\n-        if (!testPassed || timeout) {\n+        if (!supportedSides.contains(sides) || !testPassed || timeout) {\n@@ -163,0 +204,5 @@\n+                \"Up to \" + testTotalCount + \" tests will run and it will test all the cases\",\n+                \"supported by the printer.\",\n+                \"\",\n+                \"The test is \" + (testCount + 1) + \" from \" + testTotalCount + \".\",\n+                \"\",\n@@ -172,3 +218,5 @@\n-                \"The test fails only if the text on the pages is not printed\",\n-                \"or pages are not printed according to the sides attribute\",\n-                getSidesDescription(sides)\n+                \"\",\n+                \"The test fails if the pages are not printed according to the tested\",\n+                getSidesText(sides) + \" attribute where \" + getSidesDescription(sides),\n+                \"needs to be printed.\",\n+                \"\",\n@@ -177,1 +225,2 @@\n-        String title = \"Print sides test: \" + getSidesDescription(sides);\n+        String title = String.format(\"Print %s sides test: %d from %d\",\n+                getSidesText(sides), testCount + 1, testTotalCount);\n@@ -191,1 +240,1 @@\n-            fail();\n+            fail(sides);\n@@ -215,1 +264,1 @@\n-                fail();\n+                fail(sides);\n","filename":"test\/jdk\/javax\/print\/attribute\/SidesAttributeTest.java","additions":66,"deletions":17,"binary":false,"changes":83,"status":"modified"}]}