{"files":[{"patch":"@@ -1129,1 +1129,1 @@\n-        buildTrustedCerts();\n+        KeyStore cakstore = buildTrustedCerts();\n@@ -1138,1 +1138,1 @@\n-            caks = KeyStoreUtil.getCacertsKeyStore();\n+            caks = cakstore;\n@@ -4905,2 +4905,1 @@\n-                String eMessage = e.getMessage();\n-                if (eMessage.contains(\"denyAfter constraint check failed\") &&\n+                if (e.getMessage().contains(\"denyAfter constraint check failed\") &&\n@@ -4908,2 +4907,4 @@\n-                    String separator = \"java.security: \";\n-                    int sepPos = eMessage.indexOf(separator);\n+\n+                    String prop = Security.getProperty(\"jdk.certpath.disabledAlgorithms\");\n+                    String separator = \"denyAfter \";\n+                    int sepPos = prop.indexOf(separator);\n@@ -4912,1 +4913,1 @@\n-                        denyAfterDate = eMessage.substring(sepPos + separator.length(),\n+                        denyAfterDate = prop.substring(sepPos + separator.length(),\n@@ -4915,0 +4916,1 @@\n+\n@@ -5033,1 +5035,2 @@\n-    private void buildTrustedCerts() {\n+    private KeyStore buildTrustedCerts() {\n+        KeyStore caks = null;\n@@ -5035,1 +5038,1 @@\n-            KeyStore caks = KeyStoreUtil.getCacertsKeyStore();\n+            caks = KeyStoreUtil.getCacertsKeyStore();\n@@ -5050,0 +5053,1 @@\n+        return caks;\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/Main.java","additions":13,"deletions":9,"binary":false,"changes":22,"status":"modified"}]}