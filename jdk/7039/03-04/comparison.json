{"files":[{"patch":"@@ -1138,1 +1138,7 @@\n-            caks = cakstore;\n+            if (cakstore != null) {\n+                caks = cakstore;\n+            } else {\n+                \/\/ try to load cacerts again, and let exception propagate\n+                \/\/ if it cannot be loaded\n+                caks = KeyStoreUtil.getCacertsKeyStore();\n+            }\n@@ -4905,1 +4911,2 @@\n-                if (e.getMessage().contains(\"denyAfter constraint check failed\") &&\n+                String eMessage = e.getMessage();\n+                if (eMessage.contains(\"denyAfter constraint check failed\") &&\n@@ -4907,4 +4914,2 @@\n-\n-                    String prop = Security.getProperty(\"jdk.certpath.disabledAlgorithms\");\n-                    String separator = \"denyAfter \";\n-                    int sepPos = prop.indexOf(separator);\n+                    String separator = \"java.security: \";\n+                    int sepPos = eMessage.indexOf(separator);\n@@ -4913,1 +4918,1 @@\n-                        denyAfterDate = prop.substring(sepPos + separator.length(),\n+                        denyAfterDate = eMessage.substring(sepPos + separator.length(),\n","filename":"src\/java.base\/share\/classes\/sun\/security\/tools\/keytool\/Main.java","additions":12,"deletions":7,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -403,0 +403,2 @@\n+                        String denyAfterDate = entry.substring(entry.indexOf(\" \") + 1);\n+\n@@ -415,1 +417,1 @@\n-                                day);\n+                                day, denyAfterDate);\n@@ -689,0 +691,1 @@\n+        private String denyAfterString;\n@@ -691,1 +694,2 @@\n-        DenyAfterConstraint(String algo, int year, int month, int day) {\n+        DenyAfterConstraint(String algo, int year, int month, int day,\n+                String dateString) {\n@@ -720,0 +724,1 @@\n+            denyAfterString = dateString;\n@@ -754,1 +759,2 @@\n-                        denyAfterDate + \"; params date: \" +\n+                        denyAfterDate + \" (in java.security: \" + denyAfterString +\n+                        \"); params date: \" +\n","filename":"src\/java.base\/share\/classes\/sun\/security\/util\/DisabledAlgorithmConstraints.java","additions":10,"deletions":4,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -48,1 +48,2 @@\n-                .shouldMatch(\"cannot be used to sign JARs\")\n+                .shouldMatch(\"cannot be used to sign JARs after 2019-01-01\")\n+                .shouldNotContain(\"0000-00-00\")\n@@ -57,1 +58,2 @@\n-                .shouldMatch(\"cannot be used to sign JARs\")\n+                .shouldMatch(\"cannot be used to sign JARs after 2019-01-01\")\n+                .shouldNotContain(\"0000-00-00\")\n","filename":"test\/jdk\/sun\/security\/tools\/keytool\/TestSha1Usage.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"}]}