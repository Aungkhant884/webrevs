{"files":[{"patch":"@@ -182,1 +182,1 @@\n-  void generate_unchecked_arraycopy(Node** ctrl, MergeMemNode** mem,\n+  bool generate_unchecked_arraycopy(Node** ctrl, MergeMemNode** mem,\n","filename":"src\/hotspot\/share\/opto\/macro.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -690,0 +690,1 @@\n+  bool is_partial_array_copy = false;\n@@ -696,4 +697,4 @@\n-    generate_unchecked_arraycopy(&local_ctrl, &local_mem,\n-                                 adr_type, copy_type, disjoint_bases,\n-                                 src, src_offset, dest, dest_offset,\n-                                 ConvI2X(copy_length), dest_uninitialized);\n+    is_partial_array_copy = generate_unchecked_arraycopy(&local_ctrl, &local_mem,\n+                                                         adr_type, copy_type, disjoint_bases,\n+                                                         src, src_offset, dest, dest_offset,\n+                                                         ConvI2X(copy_length), dest_uninitialized);\n@@ -846,0 +847,6 @@\n+  if (is_partial_array_copy) {\n+    assert((*ctrl)->is_Proj(), \"MemBar control projection\");\n+    assert((*ctrl)->in(0)->isa_MemBar(), \"MemBar node\");\n+    (*ctrl)->in(0)->isa_MemBar()->set_after_partial_array_copy();\n+  }\n+\n@@ -852,1 +859,1 @@\n-  if (dest_t->is_known_instance()) {\n+  if (dest_t->is_known_instance() && false == is_partial_array_copy) {\n@@ -1184,1 +1191,1 @@\n-void PhaseMacroExpand::generate_unchecked_arraycopy(Node** ctrl, MergeMemNode** mem,\n+bool PhaseMacroExpand::generate_unchecked_arraycopy(Node** ctrl, MergeMemNode** mem,\n@@ -1191,1 +1198,1 @@\n-  if ((*ctrl)->is_top()) return;\n+  if ((*ctrl)->is_top()) return false;\n@@ -1239,0 +1246,3 @@\n+    return true;\n+  }\n+  return false;\n","filename":"src\/hotspot\/share\/opto\/macroArrayCopy.cpp","additions":17,"deletions":7,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -1187,1 +1187,2 @@\n-    LeadingLoadStore\n+    LeadingLoadStore,\n+    AfterPartialArrayCopy\n@@ -1224,0 +1225,2 @@\n+  void set_after_partial_array_copy() { _kind = AfterPartialArrayCopy; }\n+  bool after_partial_array_copy() const { return _kind == AfterPartialArrayCopy; }\n","filename":"src\/hotspot\/share\/opto\/memnode.hpp","additions":4,"deletions":1,"binary":false,"changes":5,"status":"modified"}]}