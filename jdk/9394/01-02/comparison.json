{"files":[{"patch":"@@ -49,0 +49,1 @@\n+  static int CLASSES_TO_LOAD = 30000;\n@@ -76,0 +77,1 @@\n+    boolean checked_load_factor = false;\n@@ -85,8 +87,11 @@\n-      } else if (resized && line.startsWith(\"Java dictionary (\")) {\n-        \/\/ ex. Java dictionary (table_size=10103, classes=5002)\n-        Scanner scanner = new Scanner(line);\n-        scanner.next(); \/\/ skip \"Java\"\n-        scanner.next(); \/\/ skip \"dictionary\"\n-        int table_size = getInt(scanner.next()); \/\/ process \"(table_size=40423\"\n-        int classes = getInt(scanner.next()); \/\/ process \", classes=50002\"\n-        scanner.close();\n+      } else if (resized) {\n+        int index = -1;\n+        if ((index = line.indexOf(\"Java dictionary (\")) != -1) {\n+          \/\/ ex. Java dictionary (table_size=10103, classes=5002)\n+          String dict = line.substring(index);\n+          Scanner scanner = new Scanner(dict);\n+          scanner.next(); \/\/ skip \"Java\"\n+          scanner.next(); \/\/ skip \"dictionary\"\n+          int table_size = getInt(scanner.next()); \/\/ process \"(table_size=40423\"\n+          int classes = getInt(scanner.next()); \/\/ process \", classes=50002\"\n+          scanner.close();\n@@ -94,2 +99,1 @@\n-        double loadFactor = (double)classes \/ (double)table_size;\n-        if (loadFactor > MAX_LOAD_FACTOR) {\n+          checked_load_factor = classes >= CLASSES_TO_LOAD;\n@@ -97,2 +101,2 @@\n-          \/\/ We've hit an error, so print all of the output.\n-          System.out.println(output);\n+          double loadFactor = (double)classes \/ (double)table_size;\n+          if (loadFactor > MAX_LOAD_FACTOR) {\n@@ -100,6 +104,11 @@\n-          throw new RuntimeException(\"Load factor too high, expected MAX \" + MAX_LOAD_FACTOR +\n-            \", got \" + loadFactor + \" [table size \" + table_size + \", number of clases \" + classes + \"]\");\n-        } else {\n-          System.out.println(\"PASS table_size: \" + table_size + \", classes: \" + classes +\n-          \", load factor: \" + loadFactor + \" <= \" + MAX_LOAD_FACTOR);\n-          \/\/ There are more than one system dictionary to check, so keep looking...\n+            \/\/ We've hit an error, so print all of the output.\n+            System.out.println(output);\n+\n+            throw new RuntimeException(\"Load factor too high, expected MAX \" + MAX_LOAD_FACTOR +\n+                  \", got \" + loadFactor + \" [table size \" + table_size + \", number of clases \" + classes + \"]\");\n+          } else {\n+            checked_load_factor = true;\n+            System.out.println(\"PASS table_size: \" + table_size + \", classes: \" + classes +\n+                \", load factor: \" + loadFactor + \" <= \" + MAX_LOAD_FACTOR);\n+                \/\/ There are more than one system dictionary to check, so keep looking...\n+          }\n@@ -112,0 +121,5 @@\n+    } else {\n+      \/\/ Make sure the load factor was checked\n+      if (!checked_load_factor) {\n+        throw new RuntimeException(\"Test didn't check load factor\");\n+      }\n@@ -123,1 +137,1 @@\n-                                                              \"30000\");\n+                                                              String.valueOf(CLASSES_TO_LOAD));\n","filename":"test\/hotspot\/jtreg\/runtime\/LoadClass\/TestResize.java","additions":33,"deletions":19,"binary":false,"changes":52,"status":"modified"}]}