{"files":[{"patch":"@@ -172,1 +172,1 @@\n-  if (!isStrong(node)) {\n+    if (!isStrong(node)) {\n@@ -188,0 +188,2 @@\n+        } else {\n+          return NULL;\n@@ -202,6 +204,1 @@\n-    jboolean wasStrong = isStrong(node); \/\/ Need to cache this before updating flags below\n-    if (isUnpinAll) {\n-        node->isPinAll = JNI_FALSE;\n-    } else {\n-        node->isCommonPin = JNI_FALSE;\n-    }\n+    jboolean willStillBeStrong = (node->isPinAll && !isUnpinAll) || (node->isCommonPin && isUnpinAll);\n@@ -210,2 +207,2 @@\n-    \/\/ no longer exist, then weaken it.\n-    if (wasStrong && !node->isPinAll && !node->isCommonPin) {\n+    \/\/ will no longer exist, then weaken it.\n+    if (isStrong(node) && !willStillBeStrong) {\n@@ -223,0 +220,2 @@\n+        } else {\n+          return NULL;\n@@ -225,0 +224,6 @@\n+\n+    if (isUnpinAll) {\n+        node->isPinAll = JNI_FALSE;\n+    } else {\n+        node->isCommonPin = JNI_FALSE;\n+    }\n@@ -567,1 +572,1 @@\n-            weakRef = weakenNode(env, node, JNI_FALSE \/* isPinAll *\/);\n+            weakRef = weakenNode(env, node, JNI_FALSE \/* isUnpinAll *\/);\n@@ -644,1 +649,1 @@\n-                    weakRef = weakenNode(env, node, JNI_TRUE \/* isPinAll *\/);\n+                    weakRef = weakenNode(env, node, JNI_TRUE \/* isUnpinAll *\/);\n","filename":"src\/jdk.jdwp.agent\/share\/native\/libjdwp\/commonRef.c","additions":16,"deletions":11,"binary":false,"changes":27,"status":"modified"}]}