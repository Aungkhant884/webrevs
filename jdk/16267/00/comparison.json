{"files":[{"patch":"@@ -3856,2 +3856,0 @@\n-    Register tmp3_aliased = len;\n-\n@@ -3861,2 +3859,2 @@\n-    andl(tmp1, 64 - 1);   \/\/ tail count (in chars) 0x3F\n-    andl(len, ~(64 - 1));    \/\/ vector count (in chars)\n+    andl(tmp1, 0x0000003f); \/\/ tail count (in chars) 0x3F\n+    andl(len,  0xffffffc0); \/\/ vector count (in chars)\n@@ -3882,0 +3880,2 @@\n+\n+    \/\/ check the tail for absense of negatives\n@@ -3884,4 +3884,7 @@\n-    mov64(tmp3_aliased, 0xFFFFFFFFFFFFFFFF);\n-    shlxq(tmp3_aliased, tmp3_aliased, tmp1);\n-    notq(tmp3_aliased);\n-    kmovql(mask2, tmp3_aliased);\n+    {\n+      Register tmp3_aliased = len;\n+      mov64(tmp3_aliased, 0xFFFFFFFFFFFFFFFF);\n+      shlxq(tmp3_aliased, tmp3_aliased, tmp1);\n+      notq(tmp3_aliased);\n+      kmovql(mask2, tmp3_aliased);\n+    }\n@@ -3919,0 +3922,5 @@\n+    \/\/ do a full check for negative registers in the tail\n+    movl(len, tmp1); \/\/ tmp1 holds low 6-bit from original len;\n+                     \/\/ ary1 already pointing to the right place\n+    jmpb(TAIL_START);\n+\n@@ -3920,1 +3928,1 @@\n-    \/\/ At least one byte in the last 64 bytes is negative.\n+    \/\/ At least one byte in the last 64 byte block was negative.\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":17,"deletions":9,"binary":false,"changes":26,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @bug 8999999\n+ * @bug 8281146\n@@ -36,0 +36,12 @@\n+\/*\n+ * @test\n+ * @bug 8281146 8318509\n+ * @summary Validates StringCoding.countPositives intrinsic for AVX3 works with and without\n+ *          AVX3Threshold=0\n+ * @library \/compiler\/patches\n+ *\n+ * @build java.base\/java.lang.Helper\n+ * @requires vm.cpu.features ~= \".*avx512.*\"\n+ * @run main\/othervm\/timeout=1200 -XX:UseAVX=3 compiler.intrinsics.string.TestCountPositives\n+ * @run main\/othervm\/timeout=1200 -XX:UseAVX=3 -XX:+UnlockDiagnosticVMOptions -XX:AVX3Threshold=0 compiler.intrinsics.string.TestCountPositives\n+ *\/\n","filename":"test\/hotspot\/jtreg\/compiler\/intrinsics\/string\/TestCountPositives.java","additions":13,"deletions":1,"binary":false,"changes":14,"status":"modified"}]}