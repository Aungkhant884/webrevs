{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -274,21 +274,1 @@\n-            NamedGroup namedGroup = null;\n-\n-            \/\/ Iteratively determine the X509Possession type's ParameterSpec.\n-            ECParameterSpec ecParams = x509Possession.getECParameterSpec();\n-            NamedParameterSpec namedParams = null;\n-            if (ecParams != null) {\n-                namedGroup = NamedGroup.valueOf(ecParams);\n-            }\n-\n-            \/\/ Wasn't EC, try XEC.\n-            if (ecParams == null) {\n-                namedParams = x509Possession.getXECParameterSpec();\n-                namedGroup = NamedGroup.nameOf(namedParams.getName());\n-            }\n-\n-            \/\/ Can't figure this out, bail.\n-            if ((ecParams == null) && (namedParams == null)) {\n-                \/\/ unlikely, have been checked during cipher suite negotiation.\n-                throw shc.conContext.fatal(Alert.ILLEGAL_PARAMETER,\n-                    \"Not EC\/XDH server cert for ECDH client key exchange\");\n-            }\n+            NamedGroup namedGroup = x509Possession.getNamedGroup();\n@@ -301,0 +281,7 @@\n+            }\n+\n+            \/\/ unlikely, have been checked during cipher suite negotiation.\n+            if (namedGroup.spec != NamedGroup.NamedGroupSpec.NAMED_GROUP_ECDHE\n+                    && namedGroup.spec != NamedGroup.NamedGroupSpec.NAMED_GROUP_XDH) {\n+                throw shc.conContext.fatal(Alert.ILLEGAL_PARAMETER,\n+                    \"Not EC\/XDH server cert for ECDH client key exchange\");\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/ECDHClientKeyExchange.java","additions":9,"deletions":22,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -300,1 +300,1 @@\n-                NamedGroup ng = NamedGroup.valueOf(params);\n+                NamedGroup ng = ((X509Possession)poss).getECNamedGroup();\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/ECDHKeyExchange.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -475,0 +475,3 @@\n+\n+        NamedGroup namedGroup = x509Possession.getECNamedGroup();\n+\n@@ -491,4 +494,1 @@\n-                    ECParameterSpec params =\n-                            x509Possession.getECParameterSpec();\n-                    if (params != null &&\n-                            ss.namedGroup == NamedGroup.valueOf(params)) {\n+                    if (namedGroup == ss.namedGroup) {\n@@ -505,1 +505,2 @@\n-                            \"), unsupported EC parameter spec: \" + params);\n+                            \"), unsupported EC parameter spec: \" +\n+                            x509Possession.getECParameterSpec());\n@@ -517,10 +518,5 @@\n-                    ECParameterSpec params =\n-                            x509Possession.getECParameterSpec();\n-                    if (params != null) {\n-                        NamedGroup keyGroup = NamedGroup.valueOf(params);\n-                        if (keyGroup != null &&\n-                                SupportedGroups.isSupported(keyGroup)) {\n-                            Signature signer = ss.getSigner(signingKey);\n-                            if (signer != null) {\n-                                return new SimpleImmutableEntry<>(ss, signer);\n-                            }\n+                    if (namedGroup != null &&\n+                            SupportedGroups.isSupported(namedGroup)) {\n+                        Signature signer = ss.getSigner(signingKey);\n+                        if (signer != null) {\n+                            return new SimpleImmutableEntry<>(ss, signer);\n@@ -534,1 +530,2 @@\n-                            \"), unsupported EC parameter spec: \" + params);\n+                            \"), unsupported EC parameter spec: \" +\n+                            x509Possession.getECParameterSpec());\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/SignatureScheme.java","additions":13,"deletions":16,"binary":false,"changes":29,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2018, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2018, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -125,0 +125,6 @@\n+        private final ECParameterSpec     ecParamSpec;\n+        private final NamedGroup          ecNamedGroup;\n+\n+        private final NamedParameterSpec  xecParamSpec;\n+        private final NamedGroup          xecNamedGroup;\n+\n@@ -129,0 +135,16 @@\n+\n+            ecParamSpec = getECParamSpec();\n+\n+            if (ecParamSpec != null) {\n+                ecNamedGroup = NamedGroup.valueOf(ecParamSpec);\n+\n+                xecParamSpec = null;\n+                xecNamedGroup = null;\n+            } else {\n+                ecNamedGroup = null;\n+\n+                \/\/ Wasn't EC, try XEC.\n+                xecParamSpec = getXECParamSpec();\n+                xecNamedGroup = xecParamSpec != null\n+                        ? NamedGroup.nameOf(xecParamSpec.getName()) : null;\n+            }\n@@ -132,0 +154,4 @@\n+            return ecParamSpec;\n+        }\n+\n+        private ECParameterSpec getECParamSpec() {\n@@ -151,1 +177,0 @@\n-        \/\/ Similar to above, but for XEC.\n@@ -153,0 +178,5 @@\n+            return xecParamSpec;\n+        }\n+\n+        \/\/ Similar to above, but for XEC.\n+        private NamedParameterSpec getXECParamSpec() {\n@@ -179,0 +209,8 @@\n+\n+        NamedGroup getNamedGroup() {\n+            return ecNamedGroup != null ? ecNamedGroup : xecNamedGroup;\n+        }\n+\n+        NamedGroup getECNamedGroup() {\n+            return ecNamedGroup;\n+        }\n","filename":"src\/java.base\/share\/classes\/sun\/security\/ssl\/X509Authentication.java","additions":40,"deletions":2,"binary":false,"changes":42,"status":"modified"}]}