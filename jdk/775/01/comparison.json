{"files":[{"patch":"@@ -1079,1 +1079,6 @@\n-        LinkedList l;\n+        public LinkedList l;\n+        public LinkedList(LinkedList l) {\n+            this.l = l;\n+        }\n+    }\n+    static class LinkedListOfLongArrays extends LinkedList {\n@@ -1081,1 +1086,2 @@\n-        public LinkedList(LinkedList l, int size) {\n+        public LinkedListOfLongArrays(LinkedList l, int size) {\n+            super(l);\n@@ -1083,1 +1089,0 @@\n-            this.l = l;\n@@ -1095,1 +1100,2 @@\n-                    consumedMemory = new LinkedList(consumedMemory, size);\n+                    consumedMemory =\n+                            size == 1 ? new LinkedList(consumedMemory) : new LinkedListOfLongArrays(consumedMemory, size);\n@@ -2605,3 +2611,1 @@\n-        \/\/ We succeeded to pop just one frame. When we continue, we will call dontinline_brkpt() again.\n-        Asserts.assertTrue(coughtOom || !env.targetVMOptions.EliminateAllocations,\n-                           \"PopFrame should have triggered an OOM exception in target\");\n+        \/\/ We succeeded to pop just one frame if OOM was raised. When we continue, we will call dontinline_brkpt() again.\n@@ -2609,1 +2613,1 @@\n-                env.targetVMOptions.EliminateAllocations ? \"dontinline_consume_all_memory_brkpt\" : \"dontinline_testMethod\";\n+                coughtOom ? \"dontinline_consume_all_memory_brkpt\" : \"dontinline_testMethod\";\n@@ -2618,1 +2622,4 @@\n-        return super.shouldSkip() || env.targetVMOptions.DeoptimizeObjectsALot || env.targetVMOptions.UseJVMCICompiler;\n+        return super.shouldSkip() ||\n+                !env.targetVMOptions.EliminateAllocations ||\n+                env.targetVMOptions.DeoptimizeObjectsALot ||\n+                env.targetVMOptions.UseJVMCICompiler;\n@@ -2658,1 +2665,4 @@\n-        return super.shouldSkip() || DeoptimizeObjectsALot || UseJVMCICompiler;\n+        return super.shouldSkip() ||\n+                !EliminateAllocations ||\n+                DeoptimizeObjectsALot ||\n+                UseJVMCICompiler;\n@@ -2697,2 +2707,0 @@\n-        Asserts.assertTrue(coughtOom || !env.targetVMOptions.EliminateAllocations,\n-                           \"PopFrame should have triggered an OOM exception in target\");\n@@ -2700,1 +2708,1 @@\n-                env.targetVMOptions.EliminateAllocations ? \"inlinedCallForcedToReturn\" : \"dontinline_testMethod\";\n+                coughtOom ? \"inlinedCallForcedToReturn\" : \"dontinline_testMethod\";\n@@ -2708,1 +2716,4 @@\n-        return super.shouldSkip() || env.targetVMOptions.DeoptimizeObjectsALot || env.targetVMOptions.UseJVMCICompiler;\n+        return super.shouldSkip() ||\n+                !env.targetVMOptions.EliminateAllocations ||\n+                env.targetVMOptions.DeoptimizeObjectsALot ||\n+                env.targetVMOptions.UseJVMCICompiler;\n@@ -2764,1 +2775,4 @@\n-        return super.shouldSkip() || DeoptimizeObjectsALot || UseJVMCICompiler;\n+        return super.shouldSkip() ||\n+                !EliminateAllocations ||\n+                DeoptimizeObjectsALot ||\n+                UseJVMCICompiler;\n@@ -2951,1 +2965,1 @@\n-        if (env.targetVMOptions.EliminateAllocations) {\n+        if (coughtOom) {\n@@ -2953,1 +2967,0 @@\n-            Asserts.assertTrue(coughtOom, \"ForceEarlyReturn should have triggered an OOM exception in target\");\n@@ -2967,1 +2980,4 @@\n-        return super.shouldSkip() || env.targetVMOptions.DeoptimizeObjectsALot || env.targetVMOptions.UseJVMCICompiler;\n+        return super.shouldSkip() ||\n+                !env.targetVMOptions.EliminateAllocations ||\n+                env.targetVMOptions.DeoptimizeObjectsALot ||\n+                env.targetVMOptions.UseJVMCICompiler;\n@@ -3024,1 +3040,4 @@\n-        return super.shouldSkip() || DeoptimizeObjectsALot || UseJVMCICompiler;\n+        return super.shouldSkip() ||\n+                !EliminateAllocations ||\n+                DeoptimizeObjectsALot ||\n+                UseJVMCICompiler;\n","filename":"test\/jdk\/com\/sun\/jdi\/EATests.java","additions":38,"deletions":19,"binary":false,"changes":57,"status":"modified"}]}