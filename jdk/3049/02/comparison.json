{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2003, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2003, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -30,1 +30,1 @@\n- *      8067796 8224905\n+ *      8067796 8224905 8263729\n@@ -2138,1 +2138,24 @@\n-                List<String> childArgs = new ArrayList<String>(javaChildArgs);\n+                List<String> childArgs = new ArrayList<>(javaChildArgs);\n+                final ProcessBuilder pb = new ProcessBuilder(childArgs);\n+                {\n+                    \/\/ Redirect any child VM error output away from the stream being tested\n+                    \/\/ and to the log file. For background see:\n+                    \/\/ 8231297: java\/lang\/ProcessBuilder\/Basic.java test fails intermittently\n+                    \/\/ Destroying the process may, depending on the timing, cause some output\n+                    \/\/ from the child VM.\n+                    \/\/ This test requires the thread reading from the subprocess be blocked\n+                    \/\/ in the read from the subprocess; there should be no bytes to read.\n+                    assert (childArgs.get(1).equals(\"-XX:+DisplayVMOutputToStderr\")) : \"Expected arg 1 to be \\\"-XX:+DisplayVMOutputToStderr\\\"\";\n+                    switch (action & 0x1) {\n+                        case 0:\n+                            childArgs.set(1, \"-XX:+DisplayVMOutputToStderr\");\n+                            pb.redirectError(INHERIT);\n+                            break;\n+                        case 1:\n+                            childArgs.set(1, \"-XX:+DisplayVMOutputToStdout\");\n+                            pb.redirectOutput(INHERIT);\n+                            break;\n+                        default:\n+                            throw new Error();\n+                    }\n+                }\n@@ -2141,1 +2164,1 @@\n-                final Process p = new ProcessBuilder(childArgs).start();\n+                final Process p = pb.start();\n","filename":"test\/jdk\/java\/lang\/ProcessBuilder\/Basic.java","additions":27,"deletions":4,"binary":false,"changes":31,"status":"modified"}]}