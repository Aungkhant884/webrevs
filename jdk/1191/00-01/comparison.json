{"files":[{"patch":"@@ -3152,1 +3152,2 @@\n-  int attempts = 20;\n+  static const int max_attempts = 20;\n+  int attempts = 0;\n@@ -3155,3 +3156,2 @@\n-    char* extra_base = file_desc != -1 ?\n-      os::map_memory_to_file(extra_size, file_desc) :\n-      os::reserve_memory(extra_size);\n+    char* extra_base = file_desc != -1 ? os::map_memory_to_file(extra_size, file_desc) :\n+                                         os::reserve_memory(extra_size);\n@@ -3168,2 +3168,1 @@\n-      aligned_base = NULL;\n-      break;\n+      return NULL;\n@@ -3172,4 +3171,5 @@\n-    aligned_base = file_desc != -1 ?\n-      os::attempt_map_memory_to_file_at(aligned_base, size, file_desc) :\n-      os::attempt_reserve_memory_at(aligned_base, size);\n-    attempts --;\n+    \/\/ Attempt to map, into the just vacated space, the slightly smaller aligned area.\n+    \/\/ Which may fail, hence the loop.\n+    aligned_base = file_desc != -1 ? os::attempt_map_memory_to_file_at(aligned_base, size, file_desc) :\n+                                     os::attempt_reserve_memory_at(aligned_base, size);\n+    attempts++;\n@@ -3177,1 +3177,1 @@\n-  } while (aligned_base == NULL && attempts > 0);\n+  } while (aligned_base == NULL && attempts < max_attempts);\n@@ -3179,1 +3179,1 @@\n-  assert(attempts > 0, \"Did not manage to re-map after 20 attempts?\");\n+  assert(aligned_base != NULL, \"Did not manage to re-map after %d attempts?\", attempts);\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":12,"deletions":12,"binary":false,"changes":24,"status":"modified"}]}