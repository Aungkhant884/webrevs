{"files":[{"patch":"@@ -3152,0 +3152,2 @@\n+  static const int max_attempts = 20;\n+  int attempts = 0;\n@@ -3154,3 +3156,2 @@\n-    char* extra_base = file_desc != -1 ?\n-      os::map_memory_to_file(extra_size, file_desc) :\n-      os::reserve_memory(extra_size);\n+    char* extra_base = file_desc != -1 ? os::map_memory_to_file(extra_size, file_desc) :\n+                                         os::reserve_memory(extra_size);\n@@ -3163,4 +3164,5 @@\n-    if (file_desc != -1) {\n-      os::unmap_memory(extra_base, extra_size);\n-    } else {\n-      os::release_memory(extra_base, extra_size);\n+    bool rc = (file_desc != -1) ? os::unmap_memory(extra_base, extra_size) :\n+                                  os::release_memory(extra_base, extra_size);\n+    assert(rc, \"release failed\");\n+    if (!rc) {\n+      return NULL;\n@@ -3169,3 +3171,7 @@\n-    aligned_base = file_desc != -1 ?\n-      os::attempt_map_memory_to_file_at(aligned_base, size, file_desc) :\n-      os::attempt_reserve_memory_at(aligned_base, size);\n+    \/\/ Attempt to map, into the just vacated space, the slightly smaller aligned area.\n+    \/\/ Which may fail, hence the loop.\n+    aligned_base = file_desc != -1 ? os::attempt_map_memory_to_file_at(aligned_base, size, file_desc) :\n+                                     os::attempt_reserve_memory_at(aligned_base, size);\n+    attempts++;\n+\n+  } while (aligned_base == NULL && attempts < max_attempts);\n@@ -3173,1 +3179,1 @@\n-  } while (aligned_base == NULL);\n+  assert(aligned_base != NULL, \"Did not manage to re-map after %d attempts?\", attempts);\n","filename":"src\/hotspot\/os\/windows\/os_windows.cpp","additions":17,"deletions":11,"binary":false,"changes":28,"status":"modified"}]}