{"files":[{"patch":"@@ -44,0 +44,2 @@\n+\n+  bool is_monitor_deflation_thread() const override  { return true; }\n","filename":"src\/hotspot\/share\/runtime\/monitorDeflationThread.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -27,0 +27,1 @@\n+#include \"gc\/shared\/suspendibleThreadSet.hpp\"\n@@ -1476,0 +1477,10 @@\n+class VM_RendezvousGCThreads : public VM_Operation {\n+public:\n+  bool evaluate_at_safepoint() const override { return false; }\n+  VMOp_Type type() const override { return VMOp_RendezvousGCThreads; }\n+  void doit() override {\n+    SuspendibleThreadSet::synchronize();\n+    SuspendibleThreadSet::desynchronize();\n+  };\n+};\n+\n@@ -1517,1 +1528,1 @@\n-    if (current->is_Java_thread()) {\n+    if (current->is_monitor_deflation_thread()) {\n@@ -1531,0 +1542,5 @@\n+      \/\/ Also, we sync and desync GC threads around the handshake, so that they can\n+      \/\/ safely read the mark-word and look-through to the object-monitor, without\n+      \/\/ being afraid that the object-monitor is going away.\n+      VM_RendezvousGCThreads sync_gc;\n+      VMThread::execute(&sync_gc);\n@@ -1538,0 +1554,4 @@\n+    } else {\n+      \/\/ This is not a monitor deflation thread.\n+      \/\/ No handshake or rendezvous is needed when we are already at safepoint.\n+      assert_at_safepoint();\n","filename":"src\/hotspot\/share\/runtime\/synchronizer.cpp","additions":21,"deletions":1,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -322,0 +322,1 @@\n+  virtual bool is_monitor_deflation_thread() const   { return false; }\n","filename":"src\/hotspot\/share\/runtime\/thread.hpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -109,1 +109,2 @@\n-  template(JvmtiPostObjectFree)\n+  template(JvmtiPostObjectFree)                   \\\n+  template(RendezvousGCThreads)\n","filename":"src\/hotspot\/share\/runtime\/vmOperation.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}