{"files":[{"patch":"@@ -8329,1 +8329,1 @@\n-  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ _legacy_mode_bw, \/* no_mask_reg *\/ true, \/* uses_vl *\/ true);\n+  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ true, \/* uses_vl *\/ true);\n@@ -8336,1 +8336,1 @@\n-  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ _legacy_mode_bw, \/* no_mask_reg *\/ true, \/* uses_vl *\/ true);\n+  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ true, \/* uses_vl *\/ true);\n@@ -8342,36 +8342,0 @@\n-void Assembler::evpsadbw(XMMRegister dst, KRegister mask, XMMRegister nds, XMMRegister src, bool merge, int vector_len) {\n-  assert(VM_Version::supports_avx512bw() && (vector_len == AVX_512bit || VM_Version::supports_avx512vl()), \"\");\n-  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ false,\/* uses_vl *\/ true);\n-  attributes.set_is_evex_instruction();\n-  attributes.set_embedded_opmask_register_specifier(mask);\n-  if (merge) {\n-    attributes.reset_is_clear_context();\n-  }\n-  int encode = vex_prefix_and_encode(dst->encoding(), nds->encoding(), src->encoding(), VEX_SIMD_66, VEX_OPCODE_0F, &attributes);\n-  emit_int16((unsigned char)0xF6, (0xC0 | encode));\n-}\n-\n-void Assembler::evpunpckldq(XMMRegister dst, KRegister mask, XMMRegister nds, XMMRegister src, bool merge, int vector_len) {\n-  assert(vector_len == AVX_512bit || VM_Version::supports_avx512vl(), \"\");\n-  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ false,\/* uses_vl *\/ true);\n-  attributes.set_is_evex_instruction();\n-  attributes.set_embedded_opmask_register_specifier(mask);\n-  if (merge) {\n-    attributes.reset_is_clear_context();\n-  }\n-  int encode = vex_prefix_and_encode(dst->encoding(), nds->encoding(), src->encoding(), VEX_SIMD_66, VEX_OPCODE_0F, &attributes);\n-  emit_int16(0x62, (0xC0 | encode));\n-}\n-\n-void Assembler::evpunpckhdq(XMMRegister dst, KRegister mask, XMMRegister nds, XMMRegister src, bool merge, int vector_len) {\n-  assert(vector_len == AVX_512bit || VM_Version::supports_avx512vl(), \"\");\n-  InstructionAttr attributes(vector_len, \/* vex_w *\/ false, \/* legacy_mode *\/ false, \/* no_mask_reg *\/ false,\/* uses_vl *\/ true);\n-  attributes.set_is_evex_instruction();\n-  attributes.set_embedded_opmask_register_specifier(mask);\n-  if (merge) {\n-    attributes.reset_is_clear_context();\n-  }\n-  int encode = vex_prefix_and_encode(dst->encoding(), nds->encoding(), src->encoding(), VEX_SIMD_66, VEX_OPCODE_0F, &attributes);\n-  emit_int16(0x6A, (0xC0 | encode));\n-}\n-\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.cpp","additions":2,"deletions":38,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -1937,1 +1937,0 @@\n-  void evpunpckldq(XMMRegister dst, KRegister mask, XMMRegister nds, XMMRegister src, bool merge, int vector_len);\n@@ -1941,1 +1940,0 @@\n-  void evpunpckhdq(XMMRegister dst, KRegister mask, XMMRegister nds, XMMRegister src, bool merge, int vector_len);\n@@ -1948,1 +1946,0 @@\n-  void evpsadbw(XMMRegister dst, KRegister mask, XMMRegister nds, XMMRegister src, bool merge, int vector_len);\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -4359,17 +4359,0 @@\n-  } else if (vec_enc == Assembler::AVX_512bit) {\n-    assert(VM_Version::supports_avx512vlbw(), \"\");\n-    movl(rtmp, 0x0F0F0F0F);\n-    evpbroadcastd(xtmp1, rtmp, vec_enc);\n-    evmovdqul(xtmp2, k0, ExternalAddress(StubRoutines::x86::vector_popcount_lut()), false, vec_enc, rtmp);\n-    evpandd(xtmp3, k0, src, xtmp1, true, vec_enc);\n-    vpshufb(xtmp3, xtmp2, xtmp3, vec_enc);\n-    Assembler::evpsrlw(dst, k0, src, 4, true , vec_enc);\n-    evpandd(dst, k0, dst, xtmp1, true, vec_enc);\n-    vpshufb(dst, xtmp2, dst, vec_enc);\n-    evpaddb(xtmp3, k0, dst, xtmp3, true, vec_enc);\n-    evpxord(xtmp1, k0, xtmp1, xtmp1, true, vec_enc);\n-    evpunpckhdq(dst, k0, xtmp3, xtmp1, true, vec_enc);\n-    evpsadbw(dst, k0, dst, xtmp1, true, vec_enc);\n-    evpunpckldq(xtmp2, k0, xtmp3, xtmp1, true, vec_enc);\n-    evpsadbw(xtmp2, k0, xtmp2, xtmp1, true, vec_enc);\n-    vpackuswb(dst, xtmp2, dst, vec_enc);\n@@ -4377,1 +4360,1 @@\n-    assert(VM_Version::supports_avx2(), \"\");\n+    assert((vec_enc == Assembler::AVX_512bit && VM_Version::supports_avx512bw()) || VM_Version::supports_avx2(), \"\");\n@@ -4381,1 +4364,5 @@\n-    vmovdqu(xtmp2, ExternalAddress(StubRoutines::x86::vector_popcount_lut()), rtmp);\n+    if (Assembler::AVX_512bit == vec_enc) {\n+      evmovdqul(xtmp2, k0, ExternalAddress(StubRoutines::x86::vector_popcount_lut()), false, vec_enc, rtmp);\n+    } else {\n+      vmovdqu(xtmp2, ExternalAddress(StubRoutines::x86::vector_popcount_lut()), rtmp);\n+    }\n@@ -4403,1 +4390,1 @@\n-    assert(VM_Version::supports_avx512vlbw(), \"\");\n+    assert(VM_Version::supports_avx512bw(), \"\");\n@@ -4408,1 +4395,1 @@\n-    evpandq(xtmp3, k0, src, xtmp1, true, vec_enc);\n+    vpandq(xtmp3, src, xtmp1, vec_enc);\n@@ -4410,2 +4397,2 @@\n-    Assembler::evpsrlw(dst, k0, src, 4, true , vec_enc);\n-    evpandq(dst, k0, dst, xtmp1, true, vec_enc);\n+    vpsrlw(dst, src, 4, vec_enc);\n+    vpandq(dst, dst, xtmp1, vec_enc);\n@@ -4413,3 +4400,3 @@\n-    evpaddb(xtmp3, k0, dst, xtmp3, true, vec_enc);\n-    evpxorq(xtmp1, k0, xtmp1, xtmp1, true, vec_enc);\n-    evpsadbw(dst, k0, xtmp3, xtmp1, true, vec_enc);\n+    vpaddb(xtmp3, dst, xtmp3, vec_enc);\n+    vpxorq(xtmp1, xtmp1, xtmp1, vec_enc);\n+    vpsadbw(dst, xtmp3, xtmp1, vec_enc);\n","filename":"src\/hotspot\/cpu\/x86\/c2_MacroAssembler_x86.cpp","additions":13,"deletions":26,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -1870,1 +1870,1 @@\n-          (vlen == 16) && !VM_Version::supports_avx512vlbw()) {\n+          (vlen == 16) && !VM_Version::supports_avx512bw()) {\n@@ -1876,1 +1876,1 @@\n-          ((vlen <= 4) || ((vlen == 8) && !VM_Version::supports_avx512vlbw()))) {\n+          ((vlen <= 4) || ((vlen == 8) && !VM_Version::supports_avx512bw()))) {\n","filename":"src\/hotspot\/cpu\/x86\/x86.ad","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}