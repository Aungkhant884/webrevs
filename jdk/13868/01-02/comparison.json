{"files":[{"patch":"@@ -3262,1 +3262,1 @@\n-TypePtr::InterfaceSet::InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces, bool init)\n+TypePtr::InterfaceSet::InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces)\n@@ -3265,1 +3265,0 @@\n-  DEBUG_ONLY(_initialized = false);\n@@ -3269,3 +3268,1 @@\n-  if (init) {\n-    initialize();\n-  }\n+  initialize();\n@@ -3314,0 +3311,18 @@\n+bool TypePtr::InterfaceSet::eq(ciInstanceKlass* k, InterfaceHandling interface_handling) const {\n+  assert(k->is_loaded(), \"should be loaded\");\n+  assert((interface_handling == trust_interfaces) || !k->is_interface(), \"no interface expected\");\n+  GrowableArray<ciInstanceKlass *>* interfaces = k->as_instance_klass()->transitive_interfaces();\n+  if (_list.length() != interfaces->length()) {\n+    return false;\n+  }\n+  for (int i = 0; i < interfaces->length(); i++) {\n+    bool found = false;\n+    _list.find_sorted<ciKlass*, compare>(interfaces->at(i), found);\n+    if (!found) {\n+      return false;\n+    }\n+  }\n+  return true;\n+}\n+\n+\n@@ -3456,2 +3471,2 @@\n-    ciKlass* interface = _list.at(i);\n-    if (eq(interfaces(interface, false, true, false, trust_interfaces, false))) {\n+    ciInstanceKlass* interface = _list.at(i)->as_instance_klass();\n+    if (eq(interface, trust_interfaces)) {\n@@ -3459,1 +3474,1 @@\n-      res = _list.at(i);\n+      res = interface;\n@@ -3982,3 +3997,1 @@\n-    ciKlass* k = _klass;\n-    const TypePtr::InterfaceSet interfaces = TypePtr::interfaces(k, true, false, false, ignore_interfaces, false);\n-    if (_interfaces.eq(interfaces)) {\n+    if (_interfaces.eq(_klass->as_instance_klass(), ignore_interfaces)) {\n@@ -4037,1 +4050,1 @@\n-TypePtr::InterfaceSet TypePtr::interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling, bool init) {\n+TypePtr::InterfaceSet TypePtr::interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling) {\n@@ -4046,2 +4059,2 @@\n-      GrowableArray<ciInstanceKlass *> *k_interfaces = k->as_instance_klass()->transitive_interfaces();\n-      InterfaceSet interfaces(k_interfaces, init);\n+      GrowableArray<ciInstanceKlass *>* k_interfaces = k->as_instance_klass()->transitive_interfaces();\n+      InterfaceSet interfaces(k_interfaces);\n@@ -4583,5 +4596,2 @@\n-    ciKlass* k = ik;\n-    TypePtr::InterfaceSet interfaces = TypePtr::interfaces(k, true, false, false, ignore_interfaces, false);\n-    assert(k == ik, \"\");\n-    if (interfaces.eq(_interfaces)) {\n-      Compile *C = Compile::current();\n+    if (_interfaces.eq(ik, ignore_interfaces)) {\n+      Compile* C = Compile::current();\n@@ -5594,2 +5604,1 @@\n-    ciKlass* k = _klass;\n-    if (_interfaces.eq(TypePtr::interfaces(k, true, false, true, ignore_interfaces, false))) {\n+    if (_interfaces.eq(_klass->as_instance_klass(), ignore_interfaces)) {\n@@ -5792,4 +5801,1 @@\n-        ciKlass* sub_k = sub;\n-        TypePtr::InterfaceSet sub_interfaces = TypePtr::interfaces(sub_k, true, false, false, ignore_interfaces, false);\n-        assert(sub_k == sub, \"\");\n-        if (sub_interfaces.eq(_interfaces)) {\n+        if (_interfaces.eq(sub, ignore_interfaces)) {\n@@ -6042,4 +6048,1 @@\n-        ciKlass *sub_k = sub;\n-        TypePtr::InterfaceSet sub_interfaces = TypePtr::interfaces(sub_k, true, false, false, ignore_interfaces, false);\n-        assert(sub_k == sub, \"\");\n-        if (sub_interfaces.eq(_interfaces)) {\n+        if (_interfaces.eq(sub, ignore_interfaces)) {\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":32,"deletions":29,"binary":false,"changes":61,"status":"modified"},{"patch":"@@ -899,1 +899,1 @@\n-    InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces, bool init = true);\n+    InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces);\n@@ -901,0 +901,1 @@\n+    bool eq(ciInstanceKlass* k, InterfaceHandling interface_handling) const;\n@@ -920,1 +921,1 @@\n-    static int compare(ciKlass* const &, ciKlass* const& k2);\n+    static int compare(ciKlass* const& k1, ciKlass* const& k2);\n@@ -923,1 +924,1 @@\n-  static InterfaceSet interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling, bool init = true);\n+  static InterfaceSet interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling);\n","filename":"src\/hotspot\/share\/opto\/type.hpp","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -288,1 +288,1 @@\n-  template <typename K, int compare(const K&, const E&)> int find_sorted(const K& key, bool& found) {\n+  template <typename K, int compare(const K&, const E&)> int find_sorted(const K& key, bool& found) const {\n","filename":"src\/hotspot\/share\/utilities\/growableArray.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}