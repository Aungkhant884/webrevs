{"files":[{"patch":"@@ -3258,1 +3258,2 @@\n-          _hash_computed(0), _exact_klass_computed(0) {\n+          _hash(0), _exact_klass(nullptr) {\n+  DEBUG_ONLY(_initialized = true);\n@@ -3261,1 +3262,1 @@\n-TypePtr::InterfaceSet::InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces)\n+TypePtr::InterfaceSet::InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces, bool init)\n@@ -3263,1 +3264,2 @@\n-          _hash_computed(0), _exact_klass_computed(0) {\n+          _hash(0), _exact_klass(nullptr) {\n+  DEBUG_ONLY(_initialized = false);\n@@ -3267,0 +3269,3 @@\n+  if (init) {\n+    initialize();\n+  }\n@@ -3269,0 +3274,5 @@\n+void TypePtr::InterfaceSet::initialize() {\n+  compute_hash();\n+  compute_exact_klass();\n+  DEBUG_ONLY(_initialized = true;)\n+}\n@@ -3305,5 +3315,1 @@\n-  if (_hash_computed) {\n-    return _hash;\n-  }\n-  const_cast<InterfaceSet*>(this)->compute_hash();\n-  assert(_hash_computed, \"should be computed now\");\n+  assert(_initialized, \"must be\");\n@@ -3320,1 +3326,0 @@\n-  _hash_computed = 1;\n@@ -3383,0 +3388,1 @@\n+  result.initialize();\n@@ -3421,0 +3427,1 @@\n+  result.initialize();\n@@ -3438,5 +3445,1 @@\n-  if (_exact_klass_computed) {\n-    return _exact_klass;\n-  }\n-  const_cast<InterfaceSet*>(this)->compute_exact_klass();\n-  assert(_exact_klass_computed, \"should be computed now\");\n+  assert(_initialized, \"must be\");\n@@ -3449,1 +3452,0 @@\n-    _exact_klass_computed = 1;\n@@ -3455,1 +3457,1 @@\n-    if (eq(interfaces(interface, false, true, false, trust_interfaces))) {\n+    if (eq(interfaces(interface, false, true, false, trust_interfaces, false))) {\n@@ -3461,1 +3463,0 @@\n-  _exact_klass_computed = 1;\n@@ -3982,1 +3983,1 @@\n-    const TypePtr::InterfaceSet interfaces = TypePtr::interfaces(k, true, false, false, ignore_interfaces);\n+    const TypePtr::InterfaceSet interfaces = TypePtr::interfaces(k, true, false, false, ignore_interfaces, false);\n@@ -4036,1 +4037,1 @@\n-TypePtr::InterfaceSet TypePtr::interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling) {\n+TypePtr::InterfaceSet TypePtr::interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling, bool init) {\n@@ -4046,1 +4047,1 @@\n-      InterfaceSet interfaces(k_interfaces);\n+      InterfaceSet interfaces(k_interfaces, init);\n@@ -4389,2 +4390,0 @@\n-  InterfaceSet subtype_interfaces;\n-\n@@ -4585,1 +4584,1 @@\n-    TypePtr::InterfaceSet interfaces = TypePtr::interfaces(k, true, false, false, ignore_interfaces);\n+    TypePtr::InterfaceSet interfaces = TypePtr::interfaces(k, true, false, false, ignore_interfaces, false);\n@@ -5596,1 +5595,1 @@\n-    if (_interfaces.eq(TypePtr::interfaces(k, true, false, true, ignore_interfaces))) {\n+    if (_interfaces.eq(TypePtr::interfaces(k, true, false, true, ignore_interfaces, false))) {\n@@ -5794,1 +5793,1 @@\n-        TypePtr::InterfaceSet sub_interfaces = TypePtr::interfaces(sub_k, true, false, false, ignore_interfaces);\n+        TypePtr::InterfaceSet sub_interfaces = TypePtr::interfaces(sub_k, true, false, false, ignore_interfaces, false);\n@@ -6044,1 +6043,1 @@\n-        TypePtr::InterfaceSet sub_interfaces = TypePtr::interfaces(sub_k, true, false, false, ignore_interfaces);\n+        TypePtr::InterfaceSet sub_interfaces = TypePtr::interfaces(sub_k, true, false, false, ignore_interfaces, false);\n","filename":"src\/hotspot\/share\/opto\/type.cpp","additions":25,"deletions":26,"binary":false,"changes":51,"status":"modified"},{"patch":"@@ -887,0 +887,5 @@\n+    int _hash;\n+    ciKlass* _exact_klass;\n+    DEBUG_ONLY(bool _initialized;)\n+\n+    void initialize();\n@@ -890,4 +895,0 @@\n-    uint _hash_computed:1;\n-    uint _exact_klass_computed:1;\n-    int _hash;\n-    ciKlass* _exact_klass;\n@@ -898,1 +899,1 @@\n-    InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces);\n+    InterfaceSet(GrowableArray<ciInstanceKlass*>* interfaces, bool init = true);\n@@ -922,1 +923,1 @@\n-  static InterfaceSet interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling);\n+  static InterfaceSet interfaces(ciKlass*& k, bool klass, bool interface, bool array, InterfaceHandling interface_handling, bool init = true);\n","filename":"src\/hotspot\/share\/opto\/type.hpp","additions":7,"deletions":6,"binary":false,"changes":13,"status":"modified"}]}