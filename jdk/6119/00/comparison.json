{"files":[{"patch":"@@ -35,0 +35,2 @@\n+import jdk.test.lib.Platform;\n+\n@@ -41,0 +43,3 @@\n+ * @library \/test\/lib\n+ * @build jdk.test.lib.Platform\n+ * @run main BlitRotateClippedArea\n@@ -104,11 +109,25 @@\n-        for (int x = 0; x < gold.getWidth(); ++x) {\n-            for (int y = 0; y < gold.getHeight(); ++y) {\n-                Color goldColor = new Color(gold.getRGB(x, y));\n-                Color actualColor = new Color(img.getRGB(x, y));\n-                if ((Math.abs(goldColor.getRed() - actualColor.getRed()) > 1) ||\n-                    (Math.abs(goldColor.getGreen() - actualColor.getGreen()) > 1) ||\n-                    (Math.abs(goldColor.getBlue() - actualColor.getBlue()) > 1)) {\n-                     ImageIO.write(gold, \"png\", new File(\"gold.png\"));\n-                     ImageIO.write(img, \"png\", new File(\"snapshot.png\"));\n-                     throw new RuntimeException(\"Test failed for pixel :\"\n-                        + x + \"\/\" + y);\n+        if (!Platform.isLinux()) {\n+            for (int x = 0; x < gold.getWidth(); ++x) {\n+                for (int y = 0; y < gold.getHeight(); ++y) {\n+                    if (gold.getRGB(x, y) != img.getRGB(x, y)) {\n+                        ImageIO.write(gold, \"png\", new File(\"gold.png\"));\n+                        ImageIO.write(img, \"png\", new File(\"snapshot.png\"));\n+                        throw new RuntimeException(\"Test failed.\");\n+                    }\n+                }\n+            }\n+        } else {\n+            \/\/ In Linux where we use XRender pipeline there is\n+            \/\/ little deviation because of less arithmetic precision\n+            for (int x = 0; x < gold.getWidth(); ++x) {\n+                for (int y = 0; y < gold.getHeight(); ++y) {\n+                    Color goldColor = new Color(gold.getRGB(x, y));\n+                    Color actualColor = new Color(img.getRGB(x, y));\n+                    if ((Math.abs(goldColor.getRed() - actualColor.getRed()) > 1) ||\n+                        (Math.abs(goldColor.getGreen() - actualColor.getGreen()) > 1) ||\n+                        (Math.abs(goldColor.getBlue() - actualColor.getBlue()) > 1)) {\n+                        ImageIO.write(gold, \"png\", new File(\"gold.png\"));\n+                        ImageIO.write(img, \"png\", new File(\"snapshot.png\"));\n+                        throw new RuntimeException(\"Test failed for pixel :\"\n+                            + x + \"\/\" + y);\n+                    }\n","filename":"test\/jdk\/java\/awt\/image\/DrawImage\/BlitRotateClippedArea.java","additions":30,"deletions":11,"binary":false,"changes":41,"status":"modified"}]}