{"files":[{"patch":"@@ -42,10 +42,0 @@\n-  auto by_dest = [](CodeBuffer::SharedTrampolineRequest* r1, CodeBuffer::SharedTrampolineRequest* r2) {\n-    if (r1->dest() < r2->dest()) {\n-      return -1;\n-    } else if (r1->dest() == r2->dest()) {\n-      return 0;\n-    } else {\n-      return 1;\n-    }\n-  };\n-  requests->sort(by_dest);\n@@ -53,1 +43,0 @@\n-  MacroAssembler masm(cb);\n@@ -55,0 +44,5 @@\n+  const int table_length = length * 2 + 1;\n+  const int UNUSED = length;\n+  intArray last(table_length, table_length, UNUSED);  \/\/ maps an dest address to the last request of the address\n+  intArray prev(length, length, UNUSED);              \/\/ points to the previous request with the same dest address\n+\n@@ -57,0 +51,14 @@\n+    int j = intptr_t(dest) % table_length;\n+    for (; last.at(j) != UNUSED && requests->at(last.at(j)).dest() != dest; j = (j + 1) % table_length)\n+      ;\n+    prev.at(i) = last.at(j);\n+    last.at(j) = i;\n+  }\n+\n+  MacroAssembler masm(cb);\n+  for (int i = 0; i < table_length; i++) {\n+    if (last.at(i) == UNUSED) {\n+      continue;\n+    }\n+    int j = last.at(i);\n+    const address dest = requests->at(j).dest();\n@@ -60,3 +68,2 @@\n-    for (; (i + 1) < length && requests->at(i + 1).dest() == dest; i++) {\n-      masm.relocate(trampoline_stub_Relocation::spec(cb->insts()->start()\n-                                                     + requests->at(i).caller_offset()));\n+    for (; prev.at(j) != UNUSED; j = prev.at(j)) {\n+      masm.relocate(trampoline_stub_Relocation::spec(cb->insts()->start() + requests->at(j).caller_offset()));\n@@ -66,1 +73,1 @@\n-    address stub = masm.emit_trampoline_stub(requests->at(i).caller_offset(), dest);\n+    address stub = masm.emit_trampoline_stub(requests->at(j).caller_offset(), dest);\n","filename":"src\/hotspot\/cpu\/aarch64\/codeBuffer_aarch64.cpp","additions":22,"deletions":15,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -429,1 +429,1 @@\n-  SharedTrampolineRequests*   _shared_trampoline_requests;     \/\/ used to collect requests for shared runtime call stubs\n+  SharedTrampolineRequests*   _shared_trampoline_requests;     \/\/ used to collect requests for shared trampolines\n","filename":"src\/hotspot\/share\/asm\/codeBuffer.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}