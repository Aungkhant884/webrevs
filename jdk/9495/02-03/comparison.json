{"files":[{"patch":"@@ -1663,2 +1663,5 @@\n-  MutexLocker ml(ClassLoaderDataGraph_lock);\n-  ClassLoaderDataGraph::methods_do(f);\n+\n+  {\n+    MutexLocker ml(ClassLoaderDataGraph_lock);\n+    ClassLoaderDataGraph::methods_do(f);\n+  }\n@@ -1669,1 +1672,6 @@\n-  _invoke_method_intrinsic_table.iterate_all(doit);\n+\n+  {\n+    MutexLocker ml(InvokeMethodTable_lock);\n+    _invoke_method_intrinsic_table.iterate_all(doit);\n+  }\n+\n@@ -2023,1 +2031,0 @@\n-  MutexLocker ml(THREAD, InvokeMethodTable_lock);\n@@ -2033,3 +2040,4 @@\n-  met = _invoke_method_intrinsic_table.get(key);\n-\n-  if (met != nullptr) {\n+  {\n+    MutexLocker ml(THREAD, InvokeMethodTable_lock);\n+    met = _invoke_method_intrinsic_table.get(key);\n+    if (met != nullptr) {\n@@ -2037,0 +2045,1 @@\n+    }\n@@ -2052,5 +2061,8 @@\n-  signature->make_permanent(); \/\/ The signature is never unloaded.\n-  _invoke_method_intrinsic_table.put(key, m());\n-  assert(m() != NULL, \"\");\n-  assert(Arguments::is_interpreter_only() || (m->has_compiled_code() &&\n-         m->code()->entry_point() == m->from_compiled_entry()),\n+  {\n+    MutexLocker ml(THREAD, InvokeMethodTable_lock);\n+    signature->make_permanent(); \/\/ The signature is never unloaded.\n+    bool created;\n+    met = _invoke_method_intrinsic_table.put_if_absent(key, m(), &created);\n+    Method* saved_method = *met;\n+    assert(Arguments::is_interpreter_only() || (saved_method->has_compiled_code() &&\n+         saved_method->code()->entry_point() == saved_method->from_compiled_entry()),\n@@ -2058,1 +2070,2 @@\n-  return m();\n+    return saved_method;\n+  }\n","filename":"src\/hotspot\/share\/classfile\/systemDictionary.cpp","additions":26,"deletions":13,"binary":false,"changes":39,"status":"modified"},{"patch":"@@ -117,1 +117,1 @@\n-  if ((ProfileInterpreter COMPILER1_PRESENT(|| C1UpdateMethodData)) &&\n+  if (ProfileInterpreter COMPILER1_PRESENT(|| C1UpdateMethodData) &&\n","filename":"src\/hotspot\/share\/runtime\/java.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}