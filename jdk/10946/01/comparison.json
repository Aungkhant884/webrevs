{"files":[{"patch":"@@ -883,0 +883,24 @@\n+  \/\/ UseSSE is set to the smaller of what hardware supports and what\n+  \/\/ the command line requires.  I.e., you cannot set UseSSE to 2 on\n+  \/\/ older Pentiums which do not support it.\n+  int use_sse_limit = 0;\n+  if (UseSSE > 0) {\n+    if (UseSSE > 3 && supports_sse4_1()) {\n+      use_sse_limit = 4;\n+    } else if (UseSSE > 2 && supports_sse3()) {\n+      use_sse_limit = 3;\n+    } else if (UseSSE > 1 && supports_sse2()) {\n+      use_sse_limit = 2;\n+    } else if (UseSSE > 0 && supports_sse()) {\n+      use_sse_limit = 1;\n+    } else {\n+      use_sse_limit = 0;\n+    }\n+  }\n+  if (FLAG_IS_DEFAULT(UseSSE)) {\n+    FLAG_SET_DEFAULT(UseSSE, use_sse_limit);\n+  } else if (UseSSE > use_sse_limit) {\n+    warning(\"UseSSE=%d is not supported on this CPU, setting it to UseSSE=%d\", (int) UseSSE, use_sse_limit);\n+    FLAG_SET_DEFAULT(UseSSE, use_sse_limit);\n+  }\n+\n@@ -886,1 +910,4 @@\n-    if (UseAVX > 2 && supports_evex()) {\n+    if (UseSSE < 4) {\n+      \/\/ Don't use AVX if SSE is unavailable or has been disabled.\n+      use_avx_limit = 0;\n+    } else if (UseAVX > 2 && supports_evex()) {\n@@ -905,1 +932,5 @@\n-    warning(\"UseAVX=%d is not supported on this CPU, setting it to UseAVX=%d\", (int) UseAVX, use_avx_limit);\n+    if (UseSSE < 4) {\n+      warning(\"UseAVX=%d requires UseSSE=4, setting it to UseAVX=0\", (int) UseAVX);\n+    } else {\n+      warning(\"UseAVX=%d is not supported on this CPU, setting it to UseAVX=%d\", (int) UseAVX, use_avx_limit);\n+    }\n@@ -907,3 +938,0 @@\n-  } else if (UseAVX < 0) {\n-    warning(\"UseAVX=%d is not valid, setting it to UseAVX=0\", (int) UseAVX);\n-    FLAG_SET_DEFAULT(UseAVX, 0);\n@@ -976,27 +1004,0 @@\n-  \/\/ UseSSE is set to the smaller of what hardware supports and what\n-  \/\/ the command line requires.  I.e., you cannot set UseSSE to 2 on\n-  \/\/ older Pentiums which do not support it.\n-  int use_sse_limit = 0;\n-  if (UseSSE > 0) {\n-    if (UseSSE > 3 && supports_sse4_1()) {\n-      use_sse_limit = 4;\n-    } else if (UseSSE > 2 && supports_sse3()) {\n-      use_sse_limit = 3;\n-    } else if (UseSSE > 1 && supports_sse2()) {\n-      use_sse_limit = 2;\n-    } else if (UseSSE > 0 && supports_sse()) {\n-      use_sse_limit = 1;\n-    } else {\n-      use_sse_limit = 0;\n-    }\n-  }\n-  if (FLAG_IS_DEFAULT(UseSSE)) {\n-    FLAG_SET_DEFAULT(UseSSE, use_sse_limit);\n-  } else if (UseSSE > use_sse_limit) {\n-    warning(\"UseSSE=%d is not supported on this CPU, setting it to UseSSE=%d\", (int) UseSSE, use_sse_limit);\n-    FLAG_SET_DEFAULT(UseSSE, use_sse_limit);\n-  } else if (UseSSE < 0) {\n-    warning(\"UseSSE=%d is not valid, setting it to UseSSE=0\", (int) UseSSE);\n-    FLAG_SET_DEFAULT(UseSSE, 0);\n-  }\n-\n","filename":"src\/hotspot\/cpu\/x86\/vm_version_x86.cpp","additions":33,"deletions":32,"binary":false,"changes":65,"status":"modified"}]}