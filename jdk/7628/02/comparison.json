{"files":[{"patch":"@@ -303,2 +303,1 @@\n-  assert((op1 & 0x01) == 1, \"should be 32bit operation\");\n-  assert((op1 & 0x02) == 0, \"sign-extension bit should not be set\");\n+  assert(op1 == 0x81, \"Unexpected opcode\");\n@@ -309,0 +308,13 @@\n+  } else if (dst == rax) {\n+    switch (op2) {\n+      case 0xD0: emit_int8(0x15); break; \/\/ adc\n+      case 0xC0: emit_int8(0x05); break; \/\/ add\n+      case 0xE0: emit_int8(0x25); break; \/\/ and\n+      case 0xF8: emit_int8(0x3D); break; \/\/ cmp\n+      case 0xC8: emit_int8(0x0D); break; \/\/ or\n+      case 0xD8: emit_int8(0x1D); break; \/\/ sbb\n+      case 0xE8: emit_int8(0x2D); break; \/\/ sub\n+      case 0xF0: emit_int8(0x35); break; \/\/ xor\n+      default: ShouldNotReachHere();\n+    }\n+    emit_int32(imm32);\n@@ -932,0 +944,10 @@\n+  case 0x15: \/\/ adc rax, #32\n+  case 0x05: \/\/ add rax, #32\n+  case 0x25: \/\/ and rax, #32\n+  case 0x3D: \/\/ cmp rax, #32\n+  case 0x0D: \/\/ or  rax, #32\n+  case 0x1D: \/\/ sbb rax, #32\n+  case 0x2D: \/\/ sub rax, #32\n+  case 0x35: \/\/ xor rax, #32\n+    return which == end_pc_operand ? ip + 4 : ip;\n+\n@@ -957,0 +979,5 @@\n+  case 0xA8: \/\/ testb rax, #8\n+    return which == end_pc_operand ? ip + 1 : ip;\n+  case 0xA9: \/\/ testl\/testq rax, #32\n+    return which == end_pc_operand ? ip + 4 : ip;\n+\n@@ -1686,6 +1713,0 @@\n-void Assembler::cmp(Register dst, int32_t imm32) {\n-  prefix(dst);\n-  emit_int8((unsigned char)0x3D);\n-  emit_int32(imm32);\n-}\n-\n@@ -5778,2 +5799,7 @@\n-  (void) prefix_and_encode(dst->encoding(), true);\n-  emit_arith_b(0xF6, 0xC0, dst, imm8);\n+  if (dst == rax) {\n+    emit_int8((unsigned char)0xA8);\n+    emit_int8(imm8);\n+  } else {\n+    (void) prefix_and_encode(dst->encoding(), true);\n+    emit_arith_b(0xF6, 0xC0, dst, imm8);\n+  }\n@@ -5790,0 +5816,11 @@\n+void Assembler::testl(Address dst, int32_t imm32) {\n+  if (imm32 >= 0 && is8bit(imm32)) {\n+    testb(dst, imm32);\n+    return;\n+  }\n+  InstructionMark im(this);\n+  emit_int8((unsigned char)0xF7);\n+  emit_operand(as_Register(0), dst);\n+  emit_int32(imm32);\n+}\n+\n@@ -5791,0 +5828,4 @@\n+  if (imm32 >= 0 && is8bit(imm32) && dst->has_byte_register()) {\n+    testb(dst, imm32);\n+    return;\n+  }\n@@ -5794,4 +5835,9 @@\n-  int encode = dst->encoding();\n-  encode = prefix_and_encode(encode);\n-  emit_int16((unsigned char)0xF7, (0xC0 | encode));\n-  emit_int32(imm32);\n+  if (dst == rax) {\n+    emit_int8((unsigned char)0xA9);\n+    emit_int32(imm32);\n+  } else {\n+    int encode = dst->encoding();\n+    encode = prefix_and_encode(encode);\n+    emit_int16((unsigned char)0xF7, (0xC0 | encode));\n+    emit_int32(imm32);\n+  }\n@@ -12996,0 +13042,4 @@\n+  if (imm32 >= 0) {\n+    testl(dst, imm32);\n+    return;\n+  }\n@@ -13003,0 +13053,4 @@\n+  if (imm32 >= 0) {\n+    testl(dst, imm32);\n+    return;\n+  }\n@@ -13006,4 +13060,10 @@\n-  int encode = dst->encoding();\n-  encode = prefixq_and_encode(encode);\n-  emit_int16((unsigned char)0xF7, (0xC0 | encode));\n-  emit_int32(imm32);\n+  if (dst == rax) {\n+    prefix(REX_W);\n+    emit_int8((unsigned char)0xA9);\n+    emit_int32(imm32);\n+  } else {\n+    int encode = dst->encoding();\n+    encode = prefixq_and_encode(encode);\n+    emit_int16((unsigned char)0xF7, (0xC0 | encode));\n+    emit_int32(imm32);\n+  }\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.cpp","additions":78,"deletions":18,"binary":false,"changes":96,"status":"modified"},{"patch":"@@ -1084,2 +1084,0 @@\n-\n-  void cmp(Register dst, int32_t imm32);\n@@ -1092,1 +1090,0 @@\n-\n@@ -2095,1 +2092,0 @@\n-  void testb(Register dst, int imm8);\n@@ -2097,0 +2093,1 @@\n+  void testb(Register dst, int imm8);\n@@ -2098,0 +2095,1 @@\n+  void testl(Address dst, int32_t imm32);\n","filename":"src\/hotspot\/cpu\/x86\/assembler_x86.hpp","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1928,2 +1928,2 @@\n-    \/\/ cmp    $0x80000000,%eax\n-    __ cmp(as_Register(RAX_enc), 0x80000000);\n+    \/\/ cmpl    $0x80000000,%eax\n+    __ cmpl(as_Register(RAX_enc), 0x80000000);\n@@ -1937,1 +1937,1 @@\n-    \/\/ cmp    $0xffffffffffffffff,%ecx\n+    \/\/ cmpl    $0xffffffffffffffff,%ecx\n","filename":"src\/hotspot\/cpu\/x86\/x86_64.ad","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"}]}