{"files":[{"patch":"@@ -80,1 +80,2 @@\n-  _needs_cleaning(false) {\n+  _needs_cleaning(false),\n+  _posting_events(false) {\n@@ -1217,1 +1218,7 @@\n-      MutexLocker ml(lock(), Mutex::_no_safepoint_check_flag);\n+      MonitorLocker ml(lock(), Mutex::_no_safepoint_check_flag);\n+      \/\/ If another thread is posting events, let it finish\n+      bool posting = _posting_events;\n+      while (_posting_events) {\n+        ml.wait();\n+      }\n+\n@@ -1222,0 +1229,1 @@\n+      _posting_events = true;\n@@ -1226,0 +1234,5 @@\n+    {\n+      MonitorLocker ml(lock(), Mutex::_no_safepoint_check_flag);\n+      _posting_events = false;\n+      ml.notify_all();\n+    }\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.cpp","additions":15,"deletions":2,"binary":false,"changes":17,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n-  Mutex                 _lock;                      \/\/ lock for this tag map\n+  Monitor               _lock;                      \/\/ lock for this tag map\n@@ -45,0 +45,1 @@\n+  bool                  _posting_events;\n@@ -61,1 +62,1 @@\n-  inline Mutex* lock()                      { return &_lock; }\n+  inline Monitor* lock()                    { return &_lock; }\n","filename":"src\/hotspot\/share\/prims\/jvmtiTagMap.hpp","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}