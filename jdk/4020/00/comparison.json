{"files":[{"patch":"@@ -807,8 +807,3 @@\n-    strcpy(&buf[jvm_offset], hsdis_library_name);\n-    strcat(&buf[jvm_offset], os::dll_file_extension());\n-    if (Verbose) st->print_cr(\"Trying to load: %s\", buf);\n-    _library = os::dll_load(buf, ebuf, sizeof ebuf);\n-    if (_library == NULL && lib_offset >= 0) {\n-      \/\/ 2. <home>\/lib\/<vm>\/hsdis-<arch>.so\n-      strcpy(&buf[lib_offset], hsdis_library_name);\n-      strcat(&buf[lib_offset], os::dll_file_extension());\n+    if (jvm_offset + strlen(hsdis_library_name) + strlen(os::dll_file_extension()) < JVM_MAXPATHLEN) {\n+      strcpy(&buf[jvm_offset], hsdis_library_name);\n+      strcat(&buf[jvm_offset], os::dll_file_extension());\n@@ -817,0 +812,13 @@\n+    } else {\n+      if (Verbose) st->print_cr(\"Try to load hsdis library failed: the length of path is beyond the OS limit\");\n+    }\n+    if (_library == NULL && lib_offset >= 0) {\n+      \/\/ 2. <home>\/lib\/<vm>\/hsdis-<arch>.so\n+      if (lib_offset + strlen(hsdis_library_name) + strlen(os::dll_file_extension()) < JVM_MAXPATHLEN) {\n+        strcpy(&buf[lib_offset], hsdis_library_name);\n+        strcat(&buf[lib_offset], os::dll_file_extension());\n+        if (Verbose) st->print_cr(\"Trying to load: %s\", buf);\n+        _library = os::dll_load(buf, ebuf, sizeof ebuf);\n+      } else {\n+        if (Verbose) st->print_cr(\"Try to load hsdis library failed: the length of path is beyond the OS limit\");\n+      }\n@@ -824,4 +832,8 @@\n-        strcpy(&buf[lib_offset], hsdis_library_name);\n-        strcat(&buf[lib_offset], os::dll_file_extension());\n-        if (Verbose) st->print_cr(\"Trying to load: %s\", buf);\n-        _library = os::dll_load(buf, ebuf, sizeof ebuf);\n+        if (lib_offset + strlen(hsdis_library_name) + strlen(os::dll_file_extension()) < JVM_MAXPATHLEN) {\n+          strcpy(&buf[lib_offset], hsdis_library_name);\n+          strcat(&buf[lib_offset], os::dll_file_extension());\n+          if (Verbose) st->print_cr(\"Trying to load: %s\", buf);\n+          _library = os::dll_load(buf, ebuf, sizeof ebuf);\n+        } else {\n+          if (Verbose) st->print_cr(\"Try to load hsdis library failed: the length of path is beyond the OS limit\");\n+        }\n","filename":"src\/hotspot\/share\/compiler\/disassembler.cpp","additions":24,"deletions":12,"binary":false,"changes":36,"status":"modified"}]}