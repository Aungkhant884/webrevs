{"files":[{"patch":"@@ -320,2 +320,2 @@\n-                var name = new HtmlTree(TagName.SPAN);\n-                name.setStyle(HtmlStyle.typeNameLabel);\n+\n+                var name = HtmlTree.SPAN(HtmlStyle.typeNameLabel);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/AbstractMemberWriter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -37,0 +37,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n@@ -101,1 +102,1 @@\n-            desc.add(HtmlTree.EMPTY);\n+            desc.add(Text.EMPTY);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/DeprecatedListWriter.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -1374,6 +1374,8 @@\n-        if (depr) {\n-            div = HtmlTree.DIV(HtmlStyle.deprecationComment, result);\n-            target.add(div);\n-        } else {\n-            div = HtmlTree.DIV(HtmlStyle.block, result);\n-            target.add(div);\n+        if (!result.isEmpty()) {\n+            if (depr) {\n+                div = HtmlTree.DIV(HtmlStyle.deprecationComment, result);\n+                target.add(div);\n+            } else {\n+                div = HtmlTree.DIV(HtmlStyle.block, result);\n+                target.add(div);\n+            }\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlDocletWriter.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -75,1 +75,1 @@\n-        if (source.isValid()) {\n+        if (!source.isEmpty()) {\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/HtmlSerialFieldWriter.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -614,0 +614,1 @@\n+        HtmlTree iconSpan = HtmlTree.SPAN(HtmlStyle.navBarToggleIcon).addUnchecked(Text.EMPTY);\n@@ -620,3 +621,3 @@\n-                        .add(HtmlTree.SPAN(HtmlStyle.navBarToggleIcon, HtmlTree.EMPTY))\n-                        .add(HtmlTree.SPAN(HtmlStyle.navBarToggleIcon, HtmlTree.EMPTY))\n-                        .add(HtmlTree.SPAN(HtmlStyle.navBarToggleIcon, HtmlTree.EMPTY)))\n+                        .add(iconSpan)\n+                        .add(iconSpan)\n+                        .add(iconSpan))\n@@ -662,1 +663,2 @@\n-        navigationBar.add(HtmlTree.SPAN(HtmlStyle.skipNav, HtmlTree.EMPTY)\n+        navigationBar.add(HtmlTree.SPAN(HtmlStyle.skipNav)\n+                .addUnchecked(Text.EMPTY)\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Navigation.java","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -297,1 +297,1 @@\n-                var moduleLink = HtmlTree.EMPTY;\n+                Content moduleLink = Text.EMPTY;\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PackageWriterImpl.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -34,1 +34,0 @@\n-import jdk.javadoc.internal.doclets.formats.html.markup.HtmlTree;\n@@ -36,0 +35,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n@@ -81,1 +81,1 @@\n-            desc.add(HtmlTree.EMPTY);\n+            desc.add(Text.EMPTY);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/PreviewListWriter.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -78,1 +78,1 @@\n-        var nameSpan = new HtmlTree(TagName.SPAN).setStyle(HtmlStyle.elementName);\n+        var nameSpan = HtmlTree.SPAN(HtmlStyle.elementName);\n@@ -94,1 +94,1 @@\n-        var nameSpan = new HtmlTree(TagName.SPAN).setStyle(HtmlStyle.elementName);\n+        var nameSpan = HtmlTree.SPAN(HtmlStyle.elementName);\n@@ -131,1 +131,1 @@\n-            var nameSpan = new HtmlTree(TagName.SPAN).setStyle(HtmlStyle.elementName);\n+            var nameSpan = HtmlTree.SPAN(HtmlStyle.elementName);\n@@ -149,2 +149,1 @@\n-                var extendsImplements = new HtmlTree(TagName.SPAN)\n-                        .setStyle(HtmlStyle.extendsImplements);\n+                var extendsImplements = HtmlTree.SPAN(HtmlStyle.extendsImplements);\n@@ -192,1 +191,1 @@\n-                var permitsSpan = new HtmlTree(TagName.SPAN).setStyle(HtmlStyle.permits);\n+                var permitsSpan = HtmlTree.SPAN(HtmlStyle.permits);\n@@ -475,1 +474,1 @@\n-            var nameSpan = new HtmlTree(TagName.SPAN).setStyle(HtmlStyle.elementName);\n+            var nameSpan = HtmlTree.SPAN(HtmlStyle.elementName);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Signatures.java","additions":6,"deletions":7,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -290,2 +290,1 @@\n-        var span = new HtmlTree(TagName.SPAN);\n-        span.setStyle(HtmlStyle.sourceLineNo);\n+        var span = HtmlTree.SPAN(HtmlStyle.sourceLineNo);\n@@ -309,1 +308,1 @@\n-    private void addLine(Content pre, String line, int currentLineNo) {\n+    private void addLine(HtmlTree pre, String line, int currentLineNo) {\n@@ -314,1 +313,1 @@\n-            pre.add(anchor);\n+            pre.addUnchecked(anchor);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/SourceToHTMLConverter.java","additions":3,"deletions":4,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -47,0 +47,1 @@\n+import jdk.javadoc.internal.doclets.formats.html.markup.Text;\n@@ -336,2 +337,2 @@\n-            \/\/ Replace invalid content with HtmlTree.EMPTY to make sure the cell isn't dropped\n-            var cell = HtmlTree.DIV(cellStyle, c.isValid() ? c : HtmlTree.EMPTY);\n+            \/\/ Always add content to make sure the cell isn't dropped\n+            var cell = HtmlTree.DIV(cellStyle).addUnchecked(c.isEmpty() ? Text.EMPTY : c);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/Table.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -34,0 +34,1 @@\n+import java.util.function.Predicate;\n@@ -350,1 +351,1 @@\n-        links.stream().filter(Content::isValid).forEach(item -> {\n+        links.stream().filter(Predicate.not(Content::isEmpty)).forEach(item -> {\n@@ -385,1 +386,1 @@\n-                .add(HtmlTree.EMPTY); \/\/ Make sure the element is always rendered\n+                .addUnchecked(Text.EMPTY); \/\/ Make sure the element is always rendered\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/TagletWriterImpl.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -94,1 +94,1 @@\n-                .add(footer == null ? HtmlTree.EMPTY : footer);\n+                .add(footer == null ? Text.EMPTY : footer);\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/BodyContents.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -56,1 +56,1 @@\n-        } else\n+        } else {\n@@ -58,0 +58,1 @@\n+        }\n@@ -94,17 +95,0 @@\n-    \/**\n-     * {@inheritDoc}\n-     *\n-     * @implSpec\n-     * A content builder is valid if any of its content is; thus, it is\n-     * valid to be added to an HtmlTree, which checks the validity of\n-     * each content in this builder.\n-     *\/\n-    @Override\n-    public boolean isValid() {\n-        for (Content content: contents) {\n-            if (content.isValid())\n-                return true;\n-        }\n-        return false;\n-    }\n-\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/ContentBuilder.java","additions":2,"deletions":18,"binary":false,"changes":20,"status":"modified"},{"patch":"@@ -85,6 +85,0 @@\n-    \/**\n-     * A sentinel value to explicitly indicate empty content.\n-     * The '==' identity of this object is significant.\n-     *\/\n-    public static final Content EMPTY = Text.of(\"\");\n-\n@@ -171,0 +165,4 @@\n+     * @implSpec In order to facilitate creation of succinct output this method\n+     * silently drops discardable content as determined by {@link #isDiscardable()}.\n+     * Use {@link #addUnchecked(Content)} to add content unconditionally.\n+     *\n@@ -172,0 +170,1 @@\n+     * @return this HTML tree\n@@ -177,0 +176,5 @@\n+        } else if (!content.isDiscardable()) {\n+            \/\/ quietly avoid adding empty or invalid nodes\n+            if (this.content.isEmpty())\n+                this.content = new ArrayList<>();\n+            this.content.add(content);\n@@ -178,2 +182,13 @@\n-        else if (content == HtmlTree.EMPTY || content.isValid()) {\n-            \/\/ quietly avoid adding empty or invalid nodes (except EMPTY)\n+        return this;\n+    }\n+\n+    \/**\n+     * Adds content to this HTML tree without checking whether it is discardable.\n+     *\n+     * @param content the content to add\n+     * @return this HTML tree\n+     *\/\n+    public HtmlTree addUnchecked(Content content) {\n+        if (content instanceof ContentBuilder cb) {\n+            cb.contents.forEach(this::addUnchecked);\n+        } else {\n@@ -792,0 +807,11 @@\n+    \/**\n+     * Creates an HTML {@code SPAN} element with the given style.\n+     *\n+     * @param styleClass the style\n+     * @return the element\n+     *\/\n+    public static HtmlTree SPAN(HtmlStyle styleClass) {\n+        return new HtmlTree(TagName.SPAN)\n+                .setStyle(styleClass);\n+    }\n+\n@@ -984,3 +1010,4 @@\n-     * Returns true if the HTML tree is valid. This check is more specific to\n-     * standard doclet and not exactly similar to W3C specifications. But it\n-     * ensures HTML validation.\n+     * Returns {@code true} if the HTML tree does not affect the output and can be discarded.\n+     * This implementation considers non-void elements without content or {@code id} attribute\n+     * as discardable, with the exception of {@code SCRIPT} which can sometimes be used without\n+     * content.\n@@ -988,1 +1015,1 @@\n-     * @return true if the HTML tree is valid\n+     * @return true if the HTML tree can be discarded without affecting the output\n@@ -991,24 +1018,5 @@\n-    public boolean isValid() {\n-        return switch (tagName) {\n-            case A ->\n-                    hasAttr(HtmlAttr.ID) || (hasAttr(HtmlAttr.HREF) && hasContent());\n-            case BR ->\n-                    !hasContent() && (!hasAttrs() || hasAttr(HtmlAttr.CLEAR));\n-            case HR, INPUT ->\n-                    !hasContent();\n-            case IMG ->\n-                    hasAttr(HtmlAttr.SRC) && hasAttr(HtmlAttr.ALT) && !hasContent();\n-            case LINK ->\n-                    hasAttr(HtmlAttr.HREF) && !hasContent();\n-            case META ->\n-                    hasAttr(HtmlAttr.CONTENT) && !hasContent();\n-            case SCRIPT ->\n-                    (hasAttr(HtmlAttr.TYPE) && hasAttr(HtmlAttr.SRC) && !hasContent())\n-                            || (hasAttr(HtmlAttr.TYPE) && hasContent());\n-            case SPAN ->\n-                    hasAttr(HtmlAttr.ID) || hasContent();\n-            case WBR ->\n-                    !hasContent();\n-            default ->\n-                    hasContent();\n-        };\n+    public boolean isDiscardable() {\n+        return !isVoid()\n+            && !hasContent()\n+            && !hasAttr(HtmlAttr.ID)\n+            && tagName != TagName.SCRIPT;\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/formats\/html\/markup\/HtmlTree.java","additions":44,"deletions":36,"binary":false,"changes":80,"status":"modified"},{"patch":"@@ -126,2 +126,2 @@\n-     * Returns true if the content is valid. This allows filtering during\n-     * {@link #add(Content) addition}.\n+     * Returns true if this content does not affect the output and can be discarded.\n+     * The default implementation considers empty content as discardable.\n@@ -129,1 +129,1 @@\n-     * @return true if the content is valid else return false\n+     * @return true if this content can be discarded without affecting the output\n@@ -131,2 +131,2 @@\n-    public boolean isValid() {\n-        return !isEmpty();\n+    public boolean isDiscardable() {\n+        return isEmpty();\n","filename":"src\/jdk.javadoc\/share\/classes\/jdk\/javadoc\/internal\/doclets\/toolkit\/Content.java","additions":5,"deletions":5,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2010, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2010, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,4 +85,0 @@\n-        \/\/ Test invalid META tag\n-        HtmlTree invmeta = new HtmlTree(TagName.META);\n-        head.add(invmeta);\n-        \/\/ Test LINK tag\n@@ -93,3 +89,0 @@\n-        \/\/ Test invalid LINK tag\n-        HtmlTree invlink = new HtmlTree(TagName.LINK);\n-        head.add(invlink);\n","filename":"test\/langtools\/jdk\/javadoc\/doclet\/testHtmlDocument\/TestHtmlDocument.java","additions":1,"deletions":8,"binary":false,"changes":9,"status":"modified"}]}