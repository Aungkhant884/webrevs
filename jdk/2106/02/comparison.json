{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 1995, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 1995, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -287,3 +287,2 @@\n-    if (!IsJavaArgs()) {\n-        SetJvmEnvironment(argc,argv);\n-    }\n+    \/* Set env. Must be done before LoadJavaVM. *\/\n+    SetJvmEnvironment(argc, argv);\n@@ -809,0 +808,1 @@\n+    const char* NMT_Arg_Name = IsJavaArgs() ? \"-J-XX:NativeMemoryTracking=\" : \"-XX:NativeMemoryTracking=\";\n@@ -814,5 +814,8 @@\n-         * Since this must be a VM flag we stop processing once we see\n-         * an argument the launcher would not have processed beyond (such\n-         * as -version or -h), or an argument that indicates the following\n-         * arguments are for the application (i.e. the main class name, or\n-         * the -jar argument).\n+         * Java launcher (!IsJavaArgs()):\n+         *   Since this must be a VM flag we stop processing once we see\n+         *   an argument the launcher would not have processed beyond (such\n+         *   as -version or -h), or an argument that indicates the following\n+         *   arguments are for the application (i.e. the main class name, or\n+         *   the -jar argument).\n+         * Other launchers (IsJavaArgs()):\n+         *   All arguments have to be scanned to see if it is a -J argument.\n@@ -820,1 +823,1 @@\n-        if (i > 0) {\n+        if (!IsJavaArgs() && i > 0) {\n@@ -838,1 +841,1 @@\n-        if (JLI_StrCCmp(arg, \"-XX:NativeMemoryTracking=\") == 0) {\n+        if (JLI_StrCCmp(arg, NMT_Arg_Name) == 0) {\n@@ -841,1 +844,1 @@\n-            size_t pnlen = JLI_StrLen(\"-XX:NativeMemoryTracking=\");\n+            size_t pnlen = JLI_StrLen(NMT_Arg_Name);\n","filename":"src\/java.base\/share\/native\/libjli\/java.c","additions":15,"deletions":12,"binary":false,"changes":27,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2012, 2019, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2012, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -26,1 +26,1 @@\n- * @bug 7124089 7131021 8042469 8066185 8074373\n+ * @bug 7124089 7131021 8042469 8066185 8074373 8258917\n@@ -255,0 +255,12 @@\n+    @Test\n+    void testNMTTools() throws FileNotFoundException {\n+        TestResult tr;\n+        \/\/ Tools (non-java launchers) should handle NTM (no \"wrong launcher\" warning).\n+        tr = doExec(jarCmd, \"-J-XX:NativeMemoryTracking=summary\", \"--help\");\n+        ensureNoWarnings(tr);\n+\n+        \/\/ And java terminal args (like \"--help\") don't stop \"-J\" args parsing.\n+        tr = doExec(jarCmd, \"--help\", \"-J-XX:NativeMemoryTracking=summary\");\n+        ensureNoWarnings(tr);\n+    }\n+\n","filename":"test\/jdk\/tools\/launcher\/TestSpecialArgs.java","additions":14,"deletions":2,"binary":false,"changes":16,"status":"modified"}]}