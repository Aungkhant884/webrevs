{"files":[{"patch":"@@ -202,2 +202,2 @@\n-#define def(var, type, pri, vm_block) {       \\\n-  var = new type(Mutex::pri, #var, vm_block); \\\n+#define def(var, type, pri, ...) {            \\\n+  var = new type(Mutex::pri, #var, ##__VA_ARGS__); \\\n@@ -209,2 +209,2 @@\n-#define defl(var, type, held_lock, vm_block) {         \\\n-  var = new type(held_lock->rank()-1, #var, vm_block); \\\n+#define defl(var, type, held_lock, ...) {         \\\n+  var = new type(held_lock->rank()-1, #var, ##__VA_ARGS__); \\\n@@ -214,2 +214,2 @@\n-#define defl(var, type, held_lock, vm_block) {         \\\n-  var = new type(Mutex::safepoint, #var, vm_block);    \\\n+#define defl(var, type, held_lock, ...) {         \\\n+  var = new type(Mutex::safepoint, #var, ##__VA_ARGS__); \\\n@@ -222,1 +222,1 @@\n-  def(tty_lock                     , PaddedMutex  , tty,            true);      \/\/ allow to lock in VM\n+  def(tty_lock                     , PaddedMutex  , tty);      \/\/ allow to lock in VM\n@@ -224,1 +224,1 @@\n-  def(STS_lock                     , PaddedMonitor, nosafepoint,    true);\n+  def(STS_lock                     , PaddedMonitor, nosafepoint);\n@@ -227,1 +227,1 @@\n-    def(CGC_lock                   , PaddedMonitor, nosafepoint,    true);\n+    def(CGC_lock                   , PaddedMonitor, nosafepoint);\n@@ -229,1 +229,1 @@\n-    def(G1DetachedRefinementStats_lock, PaddedMutex, nosafepoint-2, true);\n+    def(G1DetachedRefinementStats_lock, PaddedMutex, nosafepoint-2);\n@@ -231,4 +231,4 @@\n-    def(FreeList_lock              , PaddedMutex  , service-1,      true);\n-    def(OldSets_lock               , PaddedMutex  , nosafepoint,    true);\n-    def(Uncommit_lock              , PaddedMutex  , service-2,      true);\n-    def(RootRegionScan_lock        , PaddedMonitor, nosafepoint-1,  true);\n+    def(FreeList_lock              , PaddedMutex  , service-1);\n+    def(OldSets_lock               , PaddedMutex  , nosafepoint);\n+    def(Uncommit_lock              , PaddedMutex  , service-2);\n+    def(RootRegionScan_lock        , PaddedMonitor, nosafepoint-1);\n@@ -236,2 +236,2 @@\n-    def(MarkStackFreeList_lock     , PaddedMutex  , nosafepoint,    true);\n-    def(MarkStackChunkList_lock    , PaddedMutex  , nosafepoint,    true);\n+    def(MarkStackFreeList_lock     , PaddedMutex  , nosafepoint);\n+    def(MarkStackChunkList_lock    , PaddedMutex  , nosafepoint);\n@@ -239,1 +239,1 @@\n-    def(MonitoringSupport_lock     , PaddedMutex  , service-1,      true);      \/\/ used for serviceability monitoring support\n+    def(MonitoringSupport_lock     , PaddedMutex  , service-1);      \/\/ used for serviceability monitoring support\n@@ -241,4 +241,4 @@\n-  def(StringDedup_lock             , PaddedMonitor, nosafepoint,    true);\n-  def(StringDedupIntern_lock       , PaddedMutex  , nosafepoint,    true);\n-  def(ParGCRareEvent_lock          , PaddedMutex  , safepoint,      true);\n-  def(RawMonitor_lock              , PaddedMutex  , nosafepoint-1,  true);\n+  def(StringDedup_lock             , PaddedMonitor, nosafepoint);\n+  def(StringDedupIntern_lock       , PaddedMutex  , nosafepoint);\n+  def(ParGCRareEvent_lock          , PaddedMutex  , safepoint, true);\n+  def(RawMonitor_lock              , PaddedMutex  , nosafepoint-1);\n@@ -246,1 +246,1 @@\n-  def(Metaspace_lock               , PaddedMutex  , nosafepoint-3,  true);\n+  def(Metaspace_lock               , PaddedMutex  , nosafepoint-3);\n@@ -248,3 +248,3 @@\n-  def(Patching_lock                , PaddedMutex  , nosafepoint,    true);      \/\/ used for safepointing and code patching.\n-  def(MonitorDeflation_lock        , PaddedMonitor, nosafepoint,    true);      \/\/ used for monitor deflation thread operations\n-  def(Service_lock                 , PaddedMonitor, service,        true);      \/\/ used for service thread operations\n+  def(Patching_lock                , PaddedMutex  , nosafepoint);      \/\/ used for safepointing and code patching.\n+  def(MonitorDeflation_lock        , PaddedMonitor, nosafepoint);      \/\/ used for monitor deflation thread operations\n+  def(Service_lock                 , PaddedMonitor, service);      \/\/ used for service thread operations\n@@ -253,1 +253,1 @@\n-    def(Notification_lock          , PaddedMonitor, service,        true);  \/\/ used for notification thread operations\n+    def(Notification_lock          , PaddedMonitor, service);  \/\/ used for notification thread operations\n@@ -258,1 +258,1 @@\n-  def(JmethodIdCreation_lock       , PaddedMutex  , nosafepoint-2,  true); \/\/ used for creating jmethodIDs.\n+  def(JmethodIdCreation_lock       , PaddedMutex  , nosafepoint-2); \/\/ used for creating jmethodIDs.\n@@ -261,5 +261,5 @@\n-  def(VMStatistic_lock             , PaddedMutex  , safepoint,      false);\n-  def(JNIHandleBlockFreeList_lock  , PaddedMutex  , nosafepoint-1,  true);      \/\/ handles are used by VM thread\n-  def(SignatureHandlerLibrary_lock , PaddedMutex  , safepoint,      false);\n-  def(SymbolArena_lock             , PaddedMutex  , nosafepoint,    true);\n-  def(ExceptionCache_lock          , PaddedMutex  , safepoint,      false);\n+  def(VMStatistic_lock             , PaddedMutex  , safepoint);\n+  def(JNIHandleBlockFreeList_lock  , PaddedMutex  , nosafepoint-1);      \/\/ handles are used by VM thread\n+  def(SignatureHandlerLibrary_lock , PaddedMutex  , safepoint);\n+  def(SymbolArena_lock             , PaddedMutex  , nosafepoint);\n+  def(ExceptionCache_lock          , PaddedMutex  , safepoint);\n@@ -267,1 +267,1 @@\n-  def(FullGCALot_lock              , PaddedMutex  , safepoint,      false); \/\/ a lock to make FullGCALot MT safe\n+  def(FullGCALot_lock              , PaddedMutex  , safepoint); \/\/ a lock to make FullGCALot MT safe\n@@ -271,2 +271,2 @@\n-  def(NonJavaThreadsList_lock      , PaddedMutex,   nosafepoint-1,  true);\n-  def(NonJavaThreadsListSync_lock  , PaddedMutex,   nosafepoint,    true);\n+  def(NonJavaThreadsList_lock      , PaddedMutex,   nosafepoint-1);\n+  def(NonJavaThreadsListSync_lock  , PaddedMutex,   nosafepoint);\n@@ -274,1 +274,1 @@\n-  def(RetData_lock                 , PaddedMutex  , safepoint,      false);\n+  def(RetData_lock                 , PaddedMutex  , safepoint);\n@@ -276,1 +276,1 @@\n-  def(InitCompleted_lock           , PaddedMonitor, nosafepoint,    true);\n+  def(InitCompleted_lock           , PaddedMonitor, nosafepoint);\n@@ -280,1 +280,1 @@\n-  def(Heap_lock                    , PaddedMonitor, safepoint,      false); \/\/ Doesn't safepoint check during termination.\n+  def(Heap_lock                    , PaddedMonitor, safepoint); \/\/ Doesn't safepoint check during termination.\n@@ -283,5 +283,5 @@\n-  def(CompiledIC_lock              , PaddedMutex  , nosafepoint,    true);  \/\/ locks VtableStubs_lock, InlineCacheBuffer_lock\n-  def(MethodCompileQueue_lock      , PaddedMonitor, safepoint,      false);\n-  def(CompileStatistics_lock       , PaddedMutex  , safepoint,      false);\n-  def(DirectivesStack_lock         , PaddedMutex  , nosafepoint,    true);\n-  def(MultiArray_lock              , PaddedMutex  , safepoint,      false);\n+  def(CompiledIC_lock              , PaddedMutex  , nosafepoint);  \/\/ locks VtableStubs_lock, InlineCacheBuffer_lock\n+  def(MethodCompileQueue_lock      , PaddedMonitor, safepoint);\n+  def(CompileStatistics_lock       , PaddedMutex  , safepoint);\n+  def(DirectivesStack_lock         , PaddedMutex  , nosafepoint);\n+  def(MultiArray_lock              , PaddedMutex  , safepoint);\n@@ -289,3 +289,3 @@\n-  def(JvmtiThreadState_lock        , PaddedMutex  , safepoint,      false); \/\/ Used by JvmtiThreadState\/JvmtiEventController\n-  def(EscapeBarrier_lock           , PaddedMonitor, nosafepoint,    true);  \/\/ Used to synchronize object reallocation\/relocking triggered by JVMTI\n-  def(Management_lock              , PaddedMutex  , safepoint,      false); \/\/ used for JVM management\n+  def(JvmtiThreadState_lock        , PaddedMutex  , safepoint); \/\/ Used by JvmtiThreadState\/JvmtiEventController\n+  def(EscapeBarrier_lock           , PaddedMonitor, nosafepoint);  \/\/ Used to synchronize object reallocation\/relocking triggered by JVMTI\n+  def(Management_lock              , PaddedMutex  , safepoint); \/\/ used for JVM management\n@@ -294,2 +294,2 @@\n-  def(MethodData_lock              , PaddedMutex  , safepoint,      false);\n-  def(TouchedMethodLog_lock        , PaddedMutex  , safepoint,      false);\n+  def(MethodData_lock              , PaddedMutex  , safepoint);\n+  def(TouchedMethodLog_lock        , PaddedMutex  , safepoint);\n@@ -297,1 +297,1 @@\n-  def(CompileThread_lock           , PaddedMonitor, safepoint,      false);\n+  def(CompileThread_lock           , PaddedMonitor, safepoint);\n@@ -303,1 +303,1 @@\n-    def(Compilation_lock           , PaddedMonitor, nosafepoint,    true);\n+    def(Compilation_lock           , PaddedMonitor, nosafepoint);\n@@ -307,4 +307,4 @@\n-  def(JfrBuffer_lock               , PaddedMutex  , nosafepoint,       true);\n-  def(JfrMsg_lock                  , PaddedMonitor, nosafepoint-3,     true);\n-  def(JfrStacktrace_lock           , PaddedMutex  , stackwatermark-1,  true);\n-  def(JfrThreadSampler_lock        , PaddedMonitor, nosafepoint,       true);\n+  def(JfrBuffer_lock               , PaddedMutex  , nosafepoint);\n+  def(JfrMsg_lock                  , PaddedMonitor, nosafepoint-3);\n+  def(JfrStacktrace_lock           , PaddedMutex  , stackwatermark-1);\n+  def(JfrThreadSampler_lock        , PaddedMonitor, nosafepoint);\n@@ -314,1 +314,1 @@\n-  def(UnsafeJlong_lock             , PaddedMutex  , nosafepoint,    true);\n+  def(UnsafeJlong_lock             , PaddedMutex  , nosafepoint);\n@@ -317,6 +317,6 @@\n-  def(CodeHeapStateAnalytics_lock  , PaddedMutex  , safepoint,      false);\n-  def(NMethodSweeperStats_lock     , PaddedMutex  , nosafepoint,    true);\n-  def(ThreadsSMRDelete_lock        , PaddedMonitor, nosafepoint-3,  true); \/\/ Holds ConcurrentHashTableResize_lock\n-  def(ThreadIdTableCreate_lock     , PaddedMutex  , safepoint,      false);\n-  def(SharedDecoder_lock           , PaddedMutex  , tty-1,          true);\n-  def(DCmdFactory_lock             , PaddedMutex  , nosafepoint,    true);\n+  def(CodeHeapStateAnalytics_lock  , PaddedMutex  , safepoint);\n+  def(NMethodSweeperStats_lock     , PaddedMutex  , nosafepoint);\n+  def(ThreadsSMRDelete_lock        , PaddedMonitor, nosafepoint-3); \/\/ Holds ConcurrentHashTableResize_lock\n+  def(ThreadIdTableCreate_lock     , PaddedMutex  , safepoint);\n+  def(SharedDecoder_lock           , PaddedMutex  , tty-1);\n+  def(DCmdFactory_lock             , PaddedMutex  , nosafepoint);\n@@ -324,1 +324,1 @@\n-  def(NMTQuery_lock                , PaddedMutex  , safepoint,      false);\n+  def(NMTQuery_lock                , PaddedMutex  , safepoint);\n@@ -328,1 +328,1 @@\n-  def(CDSClassFileStream_lock      , PaddedMutex  , safepoint,      false);\n+  def(CDSClassFileStream_lock      , PaddedMutex  , safepoint);\n@@ -330,5 +330,5 @@\n-  def(DumpTimeTable_lock           , PaddedMutex  , nosafepoint,    true);\n-  def(CDSLambda_lock               , PaddedMutex  , nosafepoint,    true);\n-  def(DumpRegion_lock              , PaddedMutex  , nosafepoint,    true);\n-  def(ClassListFile_lock           , PaddedMutex  , nosafepoint,    true);\n-  def(LambdaFormInvokers_lock      , PaddedMutex  , safepoint,      false);\n+  def(DumpTimeTable_lock           , PaddedMutex  , nosafepoint);\n+  def(CDSLambda_lock               , PaddedMutex  , nosafepoint);\n+  def(DumpRegion_lock              , PaddedMutex  , nosafepoint);\n+  def(ClassListFile_lock           , PaddedMutex  , nosafepoint);\n+  def(LambdaFormInvokers_lock      , PaddedMutex  , safepoint);\n@@ -336,2 +336,2 @@\n-  def(Bootclasspath_lock           , PaddedMutex  , nosafepoint,    true);\n-  def(Zip_lock                     , PaddedMonitor, nosafepoint-1,  true); \/\/ Holds DumpTimeTable_lock\n+  def(Bootclasspath_lock           , PaddedMutex  , nosafepoint);\n+  def(Zip_lock                     , PaddedMonitor, nosafepoint-1); \/\/ Holds DumpTimeTable_lock\n@@ -344,5 +344,5 @@\n-  defl(InlineCacheBuffer_lock      , PaddedMutex  , CompiledIC_lock,  true);\n-  defl(VtableStubs_lock            , PaddedMutex  , CompiledIC_lock,  true);  \/\/ Also holds DumpTimeTable_lock\n-  defl(CodeCache_lock              , PaddedMonitor, VtableStubs_lock, true);\n-  defl(CompiledMethod_lock         , PaddedMutex  , CodeCache_lock,   true);\n-  defl(CodeSweeper_lock            , PaddedMonitor, CompiledMethod_lock, true);\n+  defl(InlineCacheBuffer_lock      , PaddedMutex  , CompiledIC_lock);\n+  defl(VtableStubs_lock            , PaddedMutex  , CompiledIC_lock);  \/\/ Also holds DumpTimeTable_lock\n+  defl(CodeCache_lock              , PaddedMonitor, VtableStubs_lock);\n+  defl(CompiledMethod_lock         , PaddedMutex  , CodeCache_lock);\n+  defl(CodeSweeper_lock            , PaddedMonitor, CompiledMethod_lock);\n@@ -351,2 +351,2 @@\n-  defl(Heap_lock                   , PaddedMonitor, MultiArray_lock,    false);\n-  defl(Compile_lock                , PaddedMutex ,  MethodCompileQueue_lock, false);\n+  defl(Heap_lock                   , PaddedMonitor, MultiArray_lock);\n+  defl(Compile_lock                , PaddedMutex ,  MethodCompileQueue_lock);\n@@ -356,1 +356,1 @@\n-  defl(ClassLoaderDataGraph_lock   , PaddedMutex  , MultiArray_lock,   false);\n+  defl(ClassLoaderDataGraph_lock   , PaddedMutex  , MultiArray_lock);\n@@ -366,1 +366,1 @@\n-  defl(Module_lock                 , PaddedMutex ,  ClassLoaderDataGraph_lock, false);\n+  defl(Module_lock                 , PaddedMutex ,  ClassLoaderDataGraph_lock);\n","filename":"src\/hotspot\/share\/runtime\/mutexLocker.cpp","additions":79,"deletions":79,"binary":false,"changes":158,"status":"modified"}]}