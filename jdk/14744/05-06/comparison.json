{"files":[{"patch":"@@ -30,0 +30,4 @@\n+import java.awt.event.WindowAdapter;\n+import java.awt.event.WindowEvent;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n@@ -34,1 +38,0 @@\n-import javax.swing.WindowConstants;\n@@ -60,1 +63,0 @@\n-    private static boolean startTest = false;\n@@ -62,0 +64,2 @@\n+    private static boolean testStarted = false;\n+    private static volatile CountDownLatch countDownLatch;\n@@ -87,0 +91,1 @@\n+            testStarted = !isManual;\n@@ -94,16 +99,8 @@\n-                try {\n-                    invokeAndWait(RobotModifierMaskTest::createInstructionsUI);\n-                    robot.waitForIdle();\n-                    while (!startTest) {\n-                        robot.delay(200);\n-                        if (!jFrame.isVisible()) {\n-                            throw new RuntimeException(\"Test instruction frame closed\");\n-                        }\n-                    }\n-                } finally {\n-                    invokeAndWait(() -> {\n-                        if (jFrame != null) {\n-                            jFrame.dispose();\n-                        }\n-                    });\n-                }\n+                countDownLatch = new CountDownLatch(1);\n+                invokeAndWait(RobotModifierMaskTest::createInstructionsUI);\n+                robot.waitForIdle();\n+                countDownLatch.await(2, TimeUnit.MINUTES);\n+            }\n+\n+            if (!testStarted) {\n+                throw new RuntimeException(\"Test Failed: Manual test timed out!!\");\n@@ -234,1 +231,4 @@\n-        jButton.addActionListener(e -> startTest = true);\n+        jButton.addActionListener(e -> {\n+            testStarted = true;\n+            countDownLatch.countDown();\n+        });\n@@ -239,1 +239,1 @@\n-        jFrame.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+        jFrame.addWindowListener(new CustomWindowAdapter());\n@@ -252,1 +252,2 @@\n-        jFrame.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);\n+\n+        jFrame.addWindowListener(new CustomWindowAdapter());\n@@ -275,0 +276,10 @@\n+\n+    private static class CustomWindowAdapter extends WindowAdapter {\n+        @Override\n+        public void windowClosing(WindowEvent e) {\n+            if (isManual) {\n+                countDownLatch.countDown();\n+            }\n+            throw new RuntimeException(\"Instruction\/Test window closed abruptly\");\n+        }\n+    }\n","filename":"test\/jdk\/java\/awt\/Robot\/RobotModifierMaskTest.java","additions":32,"deletions":21,"binary":false,"changes":53,"status":"modified"}]}