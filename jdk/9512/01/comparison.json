{"files":[{"patch":"@@ -58,0 +58,1 @@\n+@property (readwrite, atomic) int displayLinkCount;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLLayer.h","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#define KEEP_ALIVE_INC 4\n@@ -45,0 +46,1 @@\n+@synthesize displayLinkCount;\n@@ -77,0 +79,1 @@\n+    self.displayLinkCount = 0;\n@@ -82,1 +85,3 @@\n-        J2dTraceLn4(J2D_TRACE_VERBOSE, \"MTLLayer.blitTexture: uninitialized (mtlc=%p, javaLayer=%p, buffer=%p, devide=%p)\", self.ctx, self.javaLayer, self.buffer, ctx.device);\n+        J2dTraceLn4(J2D_TRACE_VERBOSE,\n+                    \"MTLLayer.blitTexture: uninitialized (mtlc=%p, javaLayer=%p, buffer=%p, devide=%p)\", self.ctx,\n+                    self.javaLayer, self.buffer, ctx.device);\n@@ -103,3 +108,3 @@\n-           J2dTraceLn(J2D_TRACE_VERBOSE, \"MTLLayer.blitTexture: Invalid src width or height.\");\n-           [self stopDisplayLink];\n-           return;\n+            J2dTraceLn(J2D_TRACE_VERBOSE, \"MTLLayer.blitTexture: Invalid src width or height.\");\n+            [self stopDisplayLink];\n+            return;\n@@ -137,1 +142,5 @@\n-        [self stopDisplayLink];\n+\n+        if (--self.displayLinkCount <= 0) {\n+            self.displayLinkCount = 0;\n+            [self stopDisplayLink];\n+        }\n@@ -180,1 +189,1 @@\n-    if (!CVDisplayLinkIsRunning(self.displayLink))\n+    if (!CVDisplayLinkIsRunning(self.displayLink)) {\n@@ -182,0 +191,3 @@\n+        J2dTraceLn(J2D_TRACE_VERBOSE, \"MTLLayer_startDisplayLink\");\n+    }\n+    displayLinkCount += KEEP_ALIVE_INC; \/\/ Keep alive displaylink counter\n@@ -185,1 +197,1 @@\n-    if (CVDisplayLinkIsRunning(self.displayLink))\n+    if (CVDisplayLinkIsRunning(self.displayLink)) {\n@@ -187,0 +199,2 @@\n+        J2dTraceLn(J2D_TRACE_VERBOSE, \"MTLLayer_stopDisplayLink\");\n+    }\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/java2d\/metal\/MTLLayer.m","additions":21,"deletions":7,"binary":false,"changes":28,"status":"modified"}]}