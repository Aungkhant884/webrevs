{"files":[{"patch":"@@ -192,12 +192,0 @@\n-  \/\/ Convert \"c0 - (x + c1)\" into \"(c0 - c1) - x\"\n-  if (in2->Opcode() == Op_AddI\n-      && phase->type(in1)->isa_int() != NULL\n-      && phase->type(in1)->isa_int()->is_con()\n-      && phase->type(in2->in(2))->isa_int() != NULL\n-      && phase->type(in2->in(2))->isa_int()->is_con()\n-      && ok_to_convert(in2)) {\n-    jint c0 = phase->type(in1)->isa_int()->get_con();\n-    jint c1 = phase->type(in2->in(2))->isa_int()->get_con();\n-    return new SubINode(phase->intcon(java_subtract(c0, c1)), in2->in(1));\n-  }\n-\n@@ -215,2 +203,2 @@\n-\n-  \/\/ Convert \"x - (y+c0)\" into \"(x-y) - c0\"\n+  \/\/ Convert \"x - (y+c0)\" into \"(x-y) - c0\" AND\n+  \/\/ Convert \"c1 - (y+c0)\" into \"(c1-c0) - y\"\n@@ -218,1 +206,4 @@\n-  if (op2 == Op_AddI && ok_to_convert(in2, in1)) {\n+  if (op2 == Op_AddI\n+      && ok_to_convert(in2, in1)\n+      && in2->in(2)->Opcode() == Op_ConI) {\n+    jint c0 = phase->type(in2->in(2))->isa_int()->get_con();\n@@ -220,5 +211,9 @@\n-    Node* in22 = in2->in(2);\n-    const TypeInt* tcon = phase->type(in22)->isa_int();\n-    if (tcon != NULL && tcon->is_con()) {\n-      Node* sub2 = phase->transform( new SubINode(in1, in21) );\n-      Node* neg_c0 = phase->intcon(- tcon->get_con());\n+    if (in1->Opcode() == Op_ConI) {\n+      \/\/ Match c1\n+      jint c1 = phase->type(in1)->isa_int()->get_con();\n+      Node* sub2 = phase->intcon(java_subtract(c1, c0));\n+      return new SubINode(sub2, in21);\n+    } else {\n+      \/\/ Match x\n+      Node* sub2 = phase->transform(new SubINode(in1, in21));\n+      Node* neg_c0 = phase->intcon(-c0);\n","filename":"src\/hotspot\/share\/opto\/subnode.cpp","additions":15,"deletions":20,"binary":false,"changes":35,"status":"modified"}]}