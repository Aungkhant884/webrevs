{"files":[{"patch":"@@ -42,2 +42,2 @@\n-  size_t        _scale;  \/\/ report in this scale\n-  outputStream* _output; \/\/ destination\n+  const size_t  _scale;         \/\/ report in this scale\n+  outputStream* const _output;  \/\/ destination\n@@ -46,4 +46,7 @@\n-  MemReporterBase(outputStream* out = NULL, size_t scale = K)\n-    : _scale(scale) {\n-    _output = (out == NULL) ? tty : out;\n-  }\n+\n+  \/\/ Default scale to use if no scale given.\n+  static const size_t default_scale = K;\n+\n+  MemReporterBase(outputStream* out, size_t scale = default_scale) :\n+    _scale(scale), _output(out)\n+  {}\n@@ -77,1 +80,0 @@\n-\n@@ -103,1 +105,1 @@\n-    size_t scale = K) : MemReporterBase(output, scale),\n+    size_t scale = default_scale) : MemReporterBase(output, scale),\n@@ -128,1 +130,1 @@\n-  MemDetailReporter(MemBaseline& baseline, outputStream* output, size_t scale = K) :\n+  MemDetailReporter(MemBaseline& baseline, outputStream* output, size_t scale = default_scale) :\n@@ -165,1 +167,1 @@\n-    outputStream* output, size_t scale = K) : MemReporterBase(output, scale),\n+    outputStream* output, size_t scale = default_scale) : MemReporterBase(output, scale),\n@@ -204,1 +206,1 @@\n-    outputStream* output, size_t scale = K) :\n+    outputStream* output, size_t scale = default_scale) :\n","filename":"src\/hotspot\/share\/services\/memReporter.hpp","additions":13,"deletions":11,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -173,0 +173,6 @@\n+\/\/ Report during error reporting.\n+void MemTracker::error_report(outputStream* output) {\n+  if (tracking_level() >= NMT_summary) {\n+    report(true, output, K); \/\/ just print summary for error case.\n+  }\n+}\n@@ -174,0 +180,1 @@\n+\/\/ Report when handling PrintNMTStatistics before VM shutdown.\n@@ -184,1 +191,1 @@\n-      report(level == NMT_summary, output);\n+      report(level == NMT_summary, output, 1);\n@@ -189,1 +196,1 @@\n-void MemTracker::report(bool summary_only, outputStream* output) {\n+void MemTracker::report(bool summary_only, outputStream* output, size_t scale) {\n@@ -194,1 +201,1 @@\n-      MemSummaryReporter rpt(baseline, output);\n+      MemSummaryReporter rpt(baseline, output, scale);\n@@ -197,1 +204,1 @@\n-      MemDetailReporter rpt(baseline, output);\n+      MemDetailReporter rpt(baseline, output, scale);\n@@ -202,1 +209,3 @@\n-      MetaspaceUtils::print_basic_report(output, K);\n+      \/\/ (Note: scale = 0 in NMT is default scale, in metaspace reporting\n+      \/\/  it means dynamic, human readable scale.)\n+      MetaspaceUtils::print_basic_report(output, scale == 0 ? K : scale);\n","filename":"src\/hotspot\/share\/services\/memTracker.cpp","additions":14,"deletions":5,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -289,6 +289,2 @@\n-  \/\/ Make a final report or report for hs_err file.\n-  static void error_report(outputStream* output) {\n-    if (tracking_level() >= NMT_summary) {\n-      report(true, output);  \/\/ just print summary for error case.\n-    }\n-   }\n+  \/\/ Report during error reporting.\n+  static void error_report(outputStream* output);\n@@ -296,0 +292,1 @@\n+  \/\/ Report when handling PrintNMTStatistics before VM shutdown.\n@@ -311,1 +308,1 @@\n-  static void report(bool summary_only, outputStream* output);\n+  static void report(bool summary_only, outputStream* output, size_t scale);\n","filename":"src\/hotspot\/share\/services\/memTracker.hpp","additions":4,"deletions":7,"binary":false,"changes":11,"status":"modified"}]}