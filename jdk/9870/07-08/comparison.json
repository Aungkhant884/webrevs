{"files":[{"patch":"@@ -624,6 +624,0 @@\n-    \/* C runtime error that has no corresponding DOS error code *\/\n-    if(errno != 0) {\n-        errtext = strerror(errno);\n-        if(errtext == NULL) errtext = unknown;\n-    }\n-\n@@ -634,2 +628,6 @@\n-        if(errtext != NULL) {\n-            errtext = conflict;\n+        int n = FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM|\n+            FORMAT_MESSAGE_IGNORE_INSERTS|FORMAT_MESSAGE_ALLOCATE_BUFFER,\n+            NULL, errval, 0, (LPTSTR)&errtext, 0, NULL);\n+        if (errtext == NULL || n == 0) {                \/* Paranoia check *\/\n+            errtext = unknown;\n+            n = 0;\n@@ -637,13 +635,6 @@\n-            int n = FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM|\n-                FORMAT_MESSAGE_IGNORE_INSERTS|FORMAT_MESSAGE_ALLOCATE_BUFFER,\n-                NULL, errval, 0, (LPTSTR)&errtext, 0, NULL);\n-            if (errtext == NULL || n == 0) {                \/* Paranoia check *\/\n-                errtext = unknown;\n-                n = 0;\n-            } else {\n-                freeit = JNI_TRUE;\n-                if (n > 2) {                                \/* Drop final CR, LF *\/\n-                    if (errtext[n - 1] == '\\n') n--;\n-                    if (errtext[n - 1] == '\\r') n--;\n-                    errtext[n] = '\\0';\n-                }\n+            freeit = JNI_TRUE;\n+            if (n > 3) {                                \/* Drop final CR, LF *\/\n+                if (errtext[n - 1] == '\\n') n--;\n+                if (errtext[n - 1] == '\\r') n--;\n+                if (errtext[n - 1] == '.') n--;         \/* Drop '.' to match getLastErrorString *\/\n+                errtext[n] = '\\0';\n@@ -654,0 +645,11 @@\n+    \/* C runtime error that has no corresponding DOS error code *\/\n+    if(errno != 0) {\n+        errtext = strerror(errno);\n+        if(errtext == NULL) errtext = unknown;\n+    }\n+\n+    \/* Final safety check to catch conflicting errors *\/\n+    if(GetLastError() != 0 && errno != 0) {\n+        errtext = conflict;\n+    }\n+\n","filename":"src\/java.base\/windows\/native\/libjli\/java_md.c","additions":23,"deletions":21,"binary":false,"changes":44,"status":"modified"}]}