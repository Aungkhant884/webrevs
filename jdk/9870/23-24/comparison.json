{"files":[{"patch":"@@ -207,2 +207,0 @@\n-    char buf[256];\n-    size_t n;\n@@ -212,1 +210,4 @@\n-    n = getLastErrorString(buf, sizeof(buf), SYSTEM);\n+#ifdef _WIN32\n+    \/* The implementation on Windows uses the Windows API *\/\n+    char buf[256];\n+    size_t n = getLastWinErrorString(buf, sizeof(buf));\n@@ -214,1 +215,7 @@\n-        why = JNU_NewStringPlatform(env, buf);\n+#else\n+    char* buf = NULL;\n+    int error = errno;\n+    if (error != 0) buf = strerror(error);\n+    if (buf != NULL) {\n+#endif\n+    \twhy = JNU_NewStringPlatform(env, buf);\n","filename":"src\/java.base\/share\/native\/libjava\/io_util.c","additions":11,"deletions":4,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -339,0 +339,4 @@\n+#ifdef _WIN32\n+JNIEXPORT size_t JNICALL getLastWinErrorString(char*, size_t);\n+#endif\n+\n","filename":"src\/java.base\/share\/native\/libjava\/jni_util.h","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -851,0 +851,1 @@\n+#ifdef _WIN32\n@@ -852,0 +853,4 @@\n+#else\n+    int error;\n+    char* errbuf = NULL;\n+#endif\n@@ -866,1 +871,8 @@\n-        if (pmsg && getLastErrorString(errbuf, sizeof(errbuf), SYSTEM) > 0)\n+#ifdef _WIN32\n+        \/* ZFILE_Open *\/\n+        if (pmsg && getLastWinErrorString(errbuf, sizeof(errbuf)) > 0) {\n+#else\n+        error = errno;\n+        if (error != 0) errbuf = strerror(error);\n+        if (errbuf != NULL) {\n+#endif\n@@ -868,0 +880,1 @@\n+        }\n@@ -884,1 +897,7 @@\n-            if (pmsg && getLastErrorString(errbuf, sizeof(errbuf), SYSTEM) > 0)\n+#ifdef _WIN32\n+            if (pmsg && getLastWinErrorString(errbuf, sizeof(errbuf)) > 0) {\n+#else\n+            error = errno;\n+            if (error != 0) errbuf = strerror(error);\n+            if (errbuf != NULL) {\n+#endif\n@@ -886,0 +905,1 @@\n+            }\n@@ -1496,0 +1516,1 @@\n+    char* buffer = NULL;\n@@ -1520,1 +1541,3 @@\n-                    msg = strerror(errno);\n+                    int error = errno;\n+                \tif (error != 0) buffer = strerror(error);\n+                \tif (buffer != NULL) msg = buffer;\n@@ -1536,1 +1559,3 @@\n-                msg = strerror(errno);\n+                int error = errno;\n+            \tif (error != 0) buffer = strerror(error);\n+            \tif (buffer != NULL) msg = buffer;\n","filename":"src\/java.base\/share\/native\/libzip\/zip_util.c","additions":29,"deletions":4,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -325,0 +325,1 @@\n+    char* buf = NULL;\n@@ -327,3 +328,2 @@\n-    if (errnum != 0 && errnum != EINVAL) {\n-        detail = strerror(errnum);\n-    }\n+    if (errnum != 0) buf = strerror(errnum);\n+    if (buf != NULL) detail = buf;\n","filename":"src\/java.base\/unix\/native\/libjava\/ProcessImpl_md.c","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -65,0 +65,28 @@\n+\n+JNIEXPORT size_t JNICALL\n+getLastWinErrorString(char *buffer, size_t size) {\n+\n+    DWORD error;\n+\n+    if ((error = GetLastError()) != 0) {\n+        \/* DOS error *\/\n+        size_t n = (size_t) FormatMessage(\n+                FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS,\n+                NULL,\n+                error,\n+                0,\n+                buffer,\n+                (DWORD) size,\n+                NULL);\n+        if (n > 3) {\n+            \/* Drop final '.', CR, LF *\/\n+            if (buffer[n - 1] == '\\n') n--;\n+            if (buffer[n - 1] == '\\r') n--;\n+            if (buffer[n - 1] == '.') n--;\n+            buffer[n] = '\\0';\n+        }\n+        return n;\n+    } else {\n+        return 0;\n+    }\n+}\n","filename":"src\/java.base\/windows\/native\/libjava\/jni_util_md.c","additions":28,"deletions":0,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -107,1 +107,1 @@\n-    getLastErrorString(buffer, sizeof(buffer), SYSTEM);\n+    getLastWinErrorString(buffer, sizeof(buffer));\n","filename":"src\/jdk.hotspot.agent\/share\/native\/libsaproc\/sadis.c","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}