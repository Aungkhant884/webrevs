{"files":[{"patch":"@@ -56,2 +56,2 @@\n-  \/\/ hw.optional.floatingpoint always returns 1, see\n-  \/\/ https:\/\/github.com\/apple\/darwin-xnu\/blob\/master\/bsd\/kern\/kern_mib.c#L416.\n+  \/\/ hw.optional.floatingpoint always returns 1.\n+  \/\/ See https:\/\/github.com\/apple\/darwin-xnu\/blob\/main\/bsd\/kern\/kern_mib.c#L744\n@@ -59,0 +59,1 @@\n+  \/\/ See https:\/\/developer.arm.com\/documentation\/ddi0595\/2021-12\/AArch64-Registers\/ID-AA64PFR0-EL1--AArch64-Processor-Feature-Register-0\n@@ -63,2 +64,2 @@\n-  \/\/ All Apple-darwin Arm processors have AES and PMULL.\n-  _features |= CPU_AES | CPU_PMULL;\n+  \/\/ All Apple-darwin Arm processors have AES, PMULL, SHA1 and SHA2.\n+  _features |= CPU_AES | CPU_PMULL | CPU_SHA1 | CPU_SHA2;\n@@ -66,4 +67,19 @@\n-  \/\/ Only few features are available via sysctl, see line 614\n-  \/\/ https:\/\/opensource.apple.com\/source\/xnu\/xnu-6153.141.1\/bsd\/kern\/kern_mib.c.auto.html\n-  if (cpu_has(\"hw.optional.armv8_crc32\"))     _features |= CPU_CRC32;\n-  if (cpu_has(\"hw.optional.armv8_1_atomics\")) _features |= CPU_LSE;\n+  \/\/ Only few features are available via sysctl.\n+  \/\/ See https:\/\/github.com\/apple\/darwin-xnu\/blob\/main\/bsd\/kern\/kern_mib.c#L855\n+  \/\/ Regarding SHA512 and SHA3, there are two sysctl flags for them, which\n+  \/\/ might be invented at different times. We check both here.\n+  \/\/ See https:\/\/git.tartarus.org\/?p=simon\/putty.git;a=blob_plain;f=unix\/utils\/arm_arch_queries.c;hb=HEAD\n+  if (cpu_has(\"hw.optional.armv8_crc32\")) {\n+    _features |= CPU_CRC32;\n+  }\n+  if (cpu_has(\"hw.optional.armv8_1_atomics\")) {\n+    _features |= CPU_LSE;\n+  }\n+  if (cpu_has(\"hw.optional.arm.FEAT_SHA512\") ||\n+      cpu_has(\"hw.optional.armv8_2_sha512\")) {\n+    _features |= CPU_SHA512;\n+  }\n+  if (cpu_has(\"hw.optional.arm.FEAT_SHA3\") ||\n+      cpu_has(\"hw.optional.armv8_2_sha3\")) {\n+    _features |= CPU_SHA3;\n+  }\n","filename":"src\/hotspot\/os_cpu\/bsd_aarch64\/vm_version_bsd_aarch64.cpp","additions":24,"deletions":8,"binary":false,"changes":32,"status":"modified"}]}