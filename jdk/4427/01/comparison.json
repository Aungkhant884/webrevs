{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -195,1 +195,0 @@\n-                lockCount.incrementAndGet();\n@@ -197,1 +196,2 @@\n-                    ResourceScope.Handle handle = scope.acquire();\n+                    ResourceScope.Handle handle = scope.acquire(); \/\/ this can throw if segment has been closed\n+                    lockCount.incrementAndGet();\n@@ -199,3 +199,4 @@\n-                    scope.release(handle);\n-                    scope.release(handle); \/\/ make sure it's idempotent\n-                    scope.release(handle); \/\/ make sure it's idempotent\n+                    lockCount.decrementAndGet();\n+                    scope.release(handle); \/\/ cannot throw (acquired segments cannot be closed)\n+                    scope.release(handle); \/\/ cannot throw (idempotent)\n+                    scope.release(handle); \/\/ cannot throw (idempotent)\n@@ -204,2 +205,0 @@\n-                } finally {\n-                    lockCount.decrementAndGet();\n@@ -210,1 +209,5 @@\n-        while (lockCount.get() > 0) {\n+        while (lockCount.get() == 0) {\n+            waitSomeTime(); \/\/ make sure some thread gets scheduled\n+        }\n+\n+        while (true) {\n","filename":"test\/jdk\/java\/foreign\/TestResourceScope.java","additions":12,"deletions":9,"binary":false,"changes":21,"status":"modified"}]}