[{"commit":{"message":"code backup\n\nChange-Id: Ie9046b1d7e8f5e2669767756b6b074b564523039"},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon.ad"},{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon_ad.m4"}],"sha":"c860c725ba4a3aedb0c1bd25d134025b66effd9a"},{"commit":{"message":"8262916: Merge LShiftCntV and RShiftCntV into a single node\n\nThe vector shift count was defined by two separate nodes(LShiftCntV and\nRShiftCntV), which would prevent them from being shared when the shift\ncounts are the same.\n\n```\npublic static void test_shiftv(int sh) {\n    for (int i = 0; i < N; i+=1) {\n        a0[i] = a1[i] << sh;\n        b0[i] = b1[i] >> sh;\n    }\n}\n```\n\nGiven the example above, by merging the same shift counts into one\nnode, they could be shared by shift nodes(RShiftV or LShiftV) like\nbelow:\n\n```\nBefore:\n1184  LShiftCntV  === _  1189  [[ 1185  ... ]]\n1190  RShiftCntV  === _  1189  [[ 1191  ... ]]\n1185  LShiftVI  === _  1181  1184  [[ 1186 ]]\n1191  RShiftVI  === _  1187  1190  [[ 1192 ]]\n\nAfter:\n1190  ShiftCntV  === _  1189  [[ 1191 1204  ... ]]\n1204  LShiftVI  === _  1211  1190  [[ 1203 ]]\n1191  RShiftVI  === _  1187  1190  [[ 1192 ]]\n```\n\nThe final code could remove one redundant “dup”(scalar->vector),\nwith one register saved.\n\n```\nBefore:\n        dup     v16.16b, w12\n        dup     v17.16b, w12\n        ...\n        ldr     q18, [x13, #16]\n        sshl    v18.4s, v18.4s, v16.4s\n        add     x18, x16, x12           ; iaload\n\n        add     x4, x15, x12\n        str     q18, [x4, #16]          ; iastore\n\n        ldr     q18, [x18, #16]\n        add     x12, x14, x12\n        neg     v19.16b, v17.16b\n        sshl    v18.4s, v18.4s, v19.4s\n        str     q18, [x12, #16]         ; iastore\n\nAfter:\n        dup\tv16.16b, w11\n        ...\n        ldr\tq17, [x13, #16]\n        sshl\tv17.4s, v17.4s, v16.4s\n        add\tx2, x22, x11            ; iaload\n\n        add\tx4, x16, x11\n        str\tq17, [x4, #16]          ; iastore\n\n        ldr\tq17, [x2, #16]\n        add\tx11, x21, x11\n        neg\tv18.16b, v16.16b\n        sshl\tv17.4s, v17.4s, v18.4s\n        str\tq17, [x11, #16]         ; iastore\n\n```\n\nChange-Id: I047f3f32df9535d706a9920857d212610e8ce315"},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon.ad"},{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64_neon_ad.m4"},{"filename":"test\/hotspot\/jtreg\/compiler\/codegen\/TestByteVect.java"},{"filename":"test\/hotspot\/jtreg\/compiler\/codegen\/TestIntVect.java"},{"filename":"test\/hotspot\/jtreg\/compiler\/codegen\/TestLongVect.java"},{"filename":"test\/hotspot\/jtreg\/compiler\/codegen\/TestShortVect.java"}],"sha":"eece376d75eee5bccf11f39b91b8b006745309a2"}]