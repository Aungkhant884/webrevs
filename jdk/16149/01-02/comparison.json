{"files":[{"patch":"@@ -62,1 +62,1 @@\n-static void* dll_lookup(const char* name, const char* path) {\n+static void* dll_lookup(const char* name, const char* path, bool vm_exit_on_failure) {\n@@ -65,1 +65,1 @@\n-  if (func == nullptr) {\n+  if (func == nullptr && vm_exit_on_failure) {\n@@ -73,1 +73,1 @@\n-static void store_function_pointers(const char* path) {\n+static void store_function_pointers(const char* path, bool vm_exit_on_failure) {\n@@ -75,7 +75,7 @@\n-  ZIP_Open = CAST_TO_FN_PTR(ZIP_Open_t, dll_lookup(\"ZIP_Open\", path));\n-  ZIP_Close = CAST_TO_FN_PTR(ZIP_Close_t, dll_lookup(\"ZIP_Close\", path));\n-  ZIP_FindEntry = CAST_TO_FN_PTR(ZIP_FindEntry_t, dll_lookup(\"ZIP_FindEntry\", path));\n-  ZIP_ReadEntry = CAST_TO_FN_PTR(ZIP_ReadEntry_t, dll_lookup(\"ZIP_ReadEntry\", path));\n-  ZIP_CRC32 = CAST_TO_FN_PTR(ZIP_CRC32_t, dll_lookup(\"ZIP_CRC32\", path));\n-  ZIP_GZip_InitParams = CAST_TO_FN_PTR(ZIP_GZip_InitParams_t, dll_lookup(\"ZIP_GZip_InitParams\", path));\n-  ZIP_GZip_Fully = CAST_TO_FN_PTR(ZIP_GZip_Fully_t, dll_lookup(\"ZIP_GZip_Fully\", path));\n+  ZIP_Open = CAST_TO_FN_PTR(ZIP_Open_t, dll_lookup(\"ZIP_Open\", path, vm_exit_on_failure));\n+  ZIP_Close = CAST_TO_FN_PTR(ZIP_Close_t, dll_lookup(\"ZIP_Close\", path, vm_exit_on_failure));\n+  ZIP_FindEntry = CAST_TO_FN_PTR(ZIP_FindEntry_t, dll_lookup(\"ZIP_FindEntry\", path, vm_exit_on_failure));\n+  ZIP_ReadEntry = CAST_TO_FN_PTR(ZIP_ReadEntry_t, dll_lookup(\"ZIP_ReadEntry\", path, vm_exit_on_failure));\n+  ZIP_CRC32 = CAST_TO_FN_PTR(ZIP_CRC32_t, dll_lookup(\"ZIP_CRC32\", path, vm_exit_on_failure));\n+  ZIP_GZip_InitParams = CAST_TO_FN_PTR(ZIP_GZip_InitParams_t, dll_lookup(\"ZIP_GZip_InitParams\", path, vm_exit_on_failure));\n+  ZIP_GZip_Fully = CAST_TO_FN_PTR(ZIP_GZip_Fully_t, dll_lookup(\"ZIP_GZip_Fully\", path, vm_exit_on_failure));\n@@ -84,1 +84,1 @@\n-static void load_zip_library() {\n+static void load_zip_library(bool vm_exit_on_failure) {\n@@ -92,1 +92,4 @@\n-    vm_exit_during_initialization(\"Unable to load zip library\", &path[0]);\n+    if (vm_exit_on_failure) {\n+      vm_exit_during_initialization(\"Unable to load zip library\", &path[0]);\n+    }\n+    return;\n@@ -94,1 +97,1 @@\n-  store_function_pointers(&path[0]);\n+  store_function_pointers(&path[0], vm_exit_on_failure);\n@@ -129,1 +132,1 @@\n-static void initialize() {\n+static void initialize(bool vm_exit_on_failure = true) {\n@@ -135,1 +138,1 @@\n-    load_zip_library();\n+    load_zip_library(vm_exit_on_failure);\n@@ -170,2 +173,4 @@\n-  initialize();\n-  assert(ZIP_GZip_InitParams != nullptr, \"invariant\");\n+  initialize(false);\n+  if (ZIP_GZip_InitParams == nullptr) {\n+    return \"Cannot get ZIP_GZip_InitParams function\";\n+  }\n@@ -176,2 +181,5 @@\n-  initialize();\n-  assert(ZIP_GZip_Fully != nullptr, \"invariant\");\n+  initialize(false);\n+  if (ZIP_GZip_Fully == nullptr) {\n+    *pmsg = \"Cannot get ZIP_GZip_Fully function\";\n+    return 0;\n+  }\n","filename":"src\/hotspot\/share\/utilities\/zipLibrary.cpp","additions":27,"deletions":19,"binary":false,"changes":46,"status":"modified"}]}