{"files":[{"patch":"@@ -177,0 +177,9 @@\n+        return getPathForWin32Calls(false);\n+    }\n+\n+    String getPathWithPrefixForWin32Calls() throws WindowsException {\n+        return getPathForWin32Calls(true);\n+    }\n+\n+    String getPathForWin32Calls(boolean alwaysAddPrefix)\n+        throws WindowsException {\n@@ -179,1 +188,1 @@\n-            return path;\n+            return alwaysAddPrefix ? addPrefixIfAbsent(path) : path;\n@@ -186,1 +195,1 @@\n-            return resolved;\n+            return alwaysAddPrefix ? addPrefixIfAbsent(resolved) : resolved;\n@@ -197,1 +206,2 @@\n-        if (resolved.length() > MAX_PATH) {\n+        boolean eligibleToCache = true;\n+        if (resolved.length() > MAX_PATH || alwaysAddPrefix) {\n@@ -202,1 +212,7 @@\n-            resolved = addPrefixIfNeeded(GetFullPathName(resolved));\n+            String prefixed = addPrefixIfNeeded(GetFullPathName(resolved));\n+            if (prefixed != resolved) {\n+                resolved = prefixed;\n+            } else if (alwaysAddPrefix) {\n+                resolved = addPrefixIfAbsent(resolved);\n+                eligibleToCache = false;\n+            }\n@@ -208,1 +224,1 @@\n-        if (type != WindowsPathType.DRIVE_RELATIVE) {\n+        if (eligibleToCache && type != WindowsPathType.DRIVE_RELATIVE) {\n@@ -292,0 +308,7 @@\n+    }\n+\n+    static String addPrefixIfAbsent(String path) {\n+        if (!path.startsWith(\"\\\\\\\\\")) {\n+            path = \"\\\\\\\\?\\\\\" + path;\n+        }\n+        return path;\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsPath.java","additions":28,"deletions":5,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -64,3 +64,1 @@\n-        String path = join(file.getPathForWin32Calls(), name);\n-        WindowsPath wp = WindowsPath.createFromNormalizedPath(wfs, path);\n-        return wp.getPathForWin32Calls();\n+        return join(file.getPathWithPrefixForWin32Calls(), name);\n","filename":"src\/java.base\/windows\/classes\/sun\/nio\/fs\/WindowsUserDefinedFileAttributeView.java","additions":1,"deletions":3,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -245,1 +245,1 @@\n-            int MAX_PATH = 247;\n+            int MAX_PATH = 250;\n","filename":"test\/jdk\/java\/nio\/file\/attribute\/UserDefinedFileAttributeView\/Basic.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}