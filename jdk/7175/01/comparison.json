{"files":[{"patch":"@@ -74,2 +74,0 @@\n-  inline bool pop_object(oop& obj);\n-  inline bool pop_objarray(ObjArrayTask& array);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.hpp","additions":0,"deletions":2,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2017, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2017, 2022, Oracle and\/or its affiliates. All rights reserved.\n@@ -94,4 +94,0 @@\n-inline bool G1FullGCMarker::pop_object(oop& oop) {\n-  return _oop_stack.pop_overflow(oop) || _oop_stack.pop_local(oop);\n-}\n-\n@@ -104,4 +100,0 @@\n-inline bool G1FullGCMarker::pop_objarray(ObjArrayTask& arr) {\n-  return _objarray_stack.pop_overflow(arr) || _objarray_stack.pop_local(arr);\n-}\n-\n@@ -165,1 +157,7 @@\n-    while (pop_object(obj)) {\n+    while (_oop_stack.pop_overflow(obj)) {\n+      if (!_oop_stack.try_push_to_taskqueue(obj)) {\n+        assert(_bitmap->is_marked(obj), \"must be marked\");\n+        follow_object(obj);\n+      }\n+    }\n+    while (_oop_stack.pop_local(obj)) {\n@@ -169,1 +167,3 @@\n-    \/\/ Process ObjArrays one at a time to avoid marking stack bloat.\n+    \/\/ Process ObjArrays one at a time to avoid marking stack bloat, but it is\n+    \/\/ fine to try to move work from the overflow queue to the shared queue as\n+    \/\/ quickly as possible.\n@@ -171,1 +171,7 @@\n-    if (pop_objarray(task)) {\n+    while (_objarray_stack.pop_overflow(task)) {\n+      if (!_objarray_stack.try_push_to_taskqueue(task)) {\n+        follow_array_chunk(objArrayOop(task.obj()), task.index());\n+        break;\n+      }\n+    }\n+    if (_objarray_stack.pop_local(task)) {\n@@ -175,0 +181,1 @@\n+  return;\n","filename":"src\/hotspot\/share\/gc\/g1\/g1FullGCMarker.inline.hpp","additions":19,"deletions":12,"binary":false,"changes":31,"status":"modified"}]}