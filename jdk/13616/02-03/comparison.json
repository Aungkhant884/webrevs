{"files":[{"patch":"@@ -538,2 +538,22 @@\n-uint StringTable::rehash_table_expected_workers() {\n-  return (!_needs_rehashing || should_grow() || _rehashed || !_local_table->is_safepoint_safe()) ? 0 : 1;\n+bool StringTable::rehash_table_expects_safepoint_rehashing() {\n+  \/\/ No rehashing required\n+  if (!needs_rehashing()) {\n+    return false;\n+  }\n+\n+  \/\/ Grow instead of rehash\n+  if (should_grow()) {\n+    return false;\n+  }\n+\n+  \/\/ Already rehashed\n+  if (_rehashed) {\n+    return false;\n+  }\n+\n+  \/\/ Resizing in progress\n+  if (!_local_table->is_safepoint_safe()) {\n+    return false;\n+  }\n+\n+  return true;\n","filename":"src\/hotspot\/share\/classfile\/stringTable.cpp","additions":22,"deletions":2,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -103,1 +103,1 @@\n-  static uint rehash_table_expected_workers();\n+  static bool rehash_table_expects_safepoint_rehashing();\n","filename":"src\/hotspot\/share\/classfile\/stringTable.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -813,2 +813,22 @@\n-uint SymbolTable::rehash_table_expected_workers() {\n-  return (!_needs_rehashing || should_grow() || _rehashed || !_local_table->is_safepoint_safe()) ? 0 : 1;\n+bool SymbolTable::rehash_table_expects_safepoint_rehashing() {\n+  \/\/ No rehashing required\n+  if (!needs_rehashing()) {\n+    return false;\n+  }\n+\n+  \/\/ Grow instead of rehash\n+  if (should_grow()) {\n+    return false;\n+  }\n+\n+  \/\/ Already rehashed\n+  if (_rehashed) {\n+    return false;\n+  }\n+\n+  \/\/ Resizing in progress\n+  if (!_local_table->is_safepoint_safe()) {\n+    return false;\n+  }\n+\n+  return true;\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.cpp","additions":22,"deletions":2,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -151,1 +151,1 @@\n-  static uint rehash_table_expected_workers();\n+  static bool rehash_table_expects_safepoint_rehashing();\n","filename":"src\/hotspot\/share\/classfile\/symbolTable.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -164,2 +164,12 @@\n-uint InlineCacheBuffer::update_inline_caches_expected_workers() {\n-  return (buffer()->number_of_stubs() > 0 || pending_icholder_count() > 0) ? 1 : 0;\n+bool InlineCacheBuffer::needs_update_inline_caches() {\n+  \/\/ Stub removal\n+  if (buffer()->number_of_stubs() > 0) {\n+    return true;\n+  }\n+\n+  \/\/ Release pending CompiledICHolder\n+  if (pending_icholder_count() > 0) {\n+    return true;\n+  }\n+\n+  return false;\n","filename":"src\/hotspot\/share\/code\/icBuffer.cpp","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -170,1 +170,1 @@\n-  static uint update_inline_caches_expected_workers();\n+  static bool needs_update_inline_caches();\n","filename":"src\/hotspot\/share\/code\/icBuffer.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -553,3 +553,11 @@\n-    workers += SymbolTable::rehash_table_expected_workers();\n-    workers += StringTable::rehash_table_expected_workers();\n-    workers += InlineCacheBuffer::update_inline_caches_expected_workers();\n+    if (SymbolTable::rehash_table_expects_safepoint_rehashing()) {\n+      workers++;\n+    }\n+\n+    if (StringTable::rehash_table_expects_safepoint_rehashing()) {\n+      workers++;\n+    }\n+\n+    if (InlineCacheBuffer::needs_update_inline_caches()) {\n+      workers++;\n+    }\n","filename":"src\/hotspot\/share\/runtime\/safepoint.cpp","additions":11,"deletions":3,"binary":false,"changes":14,"status":"modified"}]}