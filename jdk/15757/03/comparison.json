{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2022, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -28,0 +28,1 @@\n+ * @run junit TempDirDoesNotExist\n@@ -30,1 +31,0 @@\n-import jdk.test.lib.process.ProcessTools;\n@@ -32,0 +32,1 @@\n+import jdk.test.lib.process.ProcessTools;\n@@ -34,0 +35,1 @@\n+import java.io.IOException;\n@@ -36,0 +38,1 @@\n+import java.util.ArrayList;\n@@ -38,0 +41,1 @@\n+import java.util.stream.Stream;\n@@ -39,2 +43,4 @@\n-public class TempDirDoesNotExist {\n-    final static String ioWarningMsg = \"WARNING: java.io.tmpdir directory does not exist\";\n+import org.junit.jupiter.params.ParameterizedTest;\n+import org.junit.jupiter.params.provider.Arguments;\n+import org.junit.jupiter.params.provider.MethodSource;\n+import org.junit.jupiter.params.provider.ValueSource;\n@@ -42,1 +48,2 @@\n-    public static void main(String... args) throws Exception {\n+public class TempDirDoesNotExist {\n+    final static String WARNING = \"WARNING: java.io.tmpdir directory does not exist\";\n@@ -44,3 +51,1 @@\n-        String userDir = System.getProperty(\"user.home\");\n-        String timeStamp = System.currentTimeMillis() + \"\";\n-        String tempDir = Path.of(userDir,\"non-existing-\", timeStamp).toString();\n+    private static final String USER_DIR = System.getProperty(\"user.home\");\n@@ -48,0 +53,1 @@\n+    public static void main(String... args) throws IOException {\n@@ -50,0 +56,1 @@\n+                File file = null;\n@@ -51,1 +58,1 @@\n-                    File.createTempFile(\"prefix\", \".suffix\");\n+                    file = File.createTempFile(\"prefix\", \".suffix\");\n@@ -54,0 +61,3 @@\n+                } finally {\n+                    if (file != null && file.exists())\n+                        file.delete();\n@@ -56,0 +66,1 @@\n+                Path path = null;\n@@ -57,1 +68,1 @@\n-                    Files.createTempFile(\"prefix\", \".suffix\");\n+                    path = Files.createTempFile(\"prefix\", \".suffix\");\n@@ -60,0 +71,3 @@\n+                } finally {\n+                    if (path != null)\n+                        Files.deleteIfExists(path);\n@@ -62,1 +76,1 @@\n-                throw new Exception(\"unknown case: \" + arg);\n+                throw new RuntimeException(\"unknown case: \" + arg);\n@@ -65,0 +79,1 @@\n+    }\n@@ -66,30 +81,87 @@\n-        if (args.length == 0) {\n-            \/\/ standard test with default setting for java.io.tmpdir\n-            testMessageNotExist(0, ioWarningMsg, \"TempDirDoesNotExist\", \"io\");\n-            testMessageNotExist(0, ioWarningMsg, \"TempDirDoesNotExist\", \"nio\");\n-\n-            \/\/ valid custom java.io.tmpdir\n-            testMessageNotExist(0, ioWarningMsg, \"-Djava.io.tmpdir=\" + userDir,\n-                    \"TempDirDoesNotExist\", \"io\");\n-            testMessageNotExist(0, ioWarningMsg, \"-Djava.io.tmpdir=\" + userDir,\n-                    \"TempDirDoesNotExist\", \"nio\");\n-\n-            \/\/ invalid custom java.io.tmpdir\n-            testMessageExist(0, ioWarningMsg, \"-Djava.io.tmpdir=\" + tempDir,\n-                    \"TempDirDoesNotExist\", \"io\");\n-            testMessageExist(0, ioWarningMsg, \"-Djava.io.tmpdir=\" + tempDir,\n-                    \"TempDirDoesNotExist\", \"nio\");\n-\n-            \/\/ test with security manager\n-            testMessageExist(0, ioWarningMsg, \"-Djava.io.tmpdir=\" + tempDir\n-                            + \" -Djava.security.manager\",\n-                    \"TempDirDoesNotExist\", \"io\");\n-\n-            testMessageExist(0, ioWarningMsg, \"-Djava.io.tmpdir=\" + tempDir\n-                            + \" -Djava.security.manager\",\n-                    \"TempDirDoesNotExist\", \"nio\");\n-\n-            \/\/ error message printed only once\n-            testMessageCounter(0, \"-Djava.io.tmpdir=\" + tempDir,\n-                    \"TempDirDoesNotExist\", \"io\", \"nio\");\n-        }\n+    private static String tempDir() {\n+        String timeStamp = String.valueOf(System.currentTimeMillis());\n+        return Path.of(USER_DIR, \"non-existing-\", timeStamp).toString();\n+    }\n+\n+    public static Stream<Arguments> existingProvider() {\n+        List<Arguments> list = new ArrayList<Arguments>();\n+\n+        \/\/ invalid custom java.io.tmpdir\n+        Arguments args = Arguments.of(0, WARNING,\n+                                      new String[] {\n+                                          \"-Djava.io.tmpdir=\" +\n+                                          tempDir(),\n+                                          \"TempDirDoesNotExist\", \"io\"\n+                                      });\n+        list.add(args);\n+        args = Arguments.of(0, WARNING,\n+                            new String[] {\n+                                \"-Djava.io.tmpdir=\" + tempDir(),\n+                                \"TempDirDoesNotExist\", \"nio\"\n+                            });\n+        list.add(args);\n+\n+        \/\/ test with security manager\n+        args = Arguments.of(0, WARNING,\n+                            new String[] {\n+                                \"-Djava.io.tmpdir=\" + tempDir()\n+                                + \" -Djava.security.manager\",\n+                                \"TempDirDoesNotExist\", \"io\"\n+                            });\n+        list.add(args);\n+        args = Arguments.of(0, WARNING,\n+                            new String[] {\n+                                \"-Djava.io.tmpdir=\" + tempDir()\n+                                + \" -Djava.security.manager\",\n+                                \"TempDirDoesNotExist\", \"nio\"\n+                            });\n+        list.add(args);\n+\n+        return list.stream();\n+    }\n+\n+    public static Stream<Arguments> nonexistentProvider() {\n+        List<Arguments> list = new ArrayList<Arguments>();\n+\n+        \/\/ standard test with default setting for java.io.tmpdir\n+        Arguments args = Arguments.of(0, WARNING,\n+                                      new String[] {\n+                                          \"TempDirDoesNotExist\",\n+                                          \"io\"\n+                                      });\n+        list.add(args);\n+        args = Arguments.of(0, WARNING,\n+                            new String[] {\n+                                \"TempDirDoesNotExist\", \"nio\"\n+                            });\n+        list.add(args);\n+\n+        \/\/ valid custom java.io.tmpdir\n+        args = Arguments.of(0, WARNING,\n+                            new String[] {\n+                                \"-Djava.io.tmpdir=\" + USER_DIR,\n+                                \"TempDirDoesNotExist\", \"io\"\n+                            });\n+        list.add(args);\n+        args = Arguments.of(0, WARNING,\n+                            new String[] {\n+                                \"-Djava.io.tmpdir=\" + USER_DIR,\n+                                \"TempDirDoesNotExist\", \"nio\"\n+                            });\n+        list.add(args);\n+\n+        return list.stream();\n+    }\n+\n+    public static Stream<Arguments> counterProvider() {\n+        List<Arguments> list = new ArrayList<Arguments>();\n+\n+        \/\/ standard test with default setting for java.io.tmpdir\n+        Arguments args = Arguments.of(0,\n+                                      new String[] {\n+                                          \"-Djava.io.tmpdir=\" + tempDir(),\n+                                          \"TempDirDoesNotExist\", \"io\", \"nio\"\n+                                      });\n+        list.add(args);\n+\n+        return list.stream();\n@@ -98,3 +170,6 @@\n-    private static void testMessageExist(int exitValue, String errorMsg, String... options) throws Exception {\n-        ProcessTools.executeTestJvm(options).shouldContain(errorMsg)\n-                .shouldHaveExitValue(exitValue);\n+    @ParameterizedTest\n+    @MethodSource(\"existingProvider\")\n+    public void existingMessage(int exitValue, String errorMsg,\n+                                String... options) throws Exception {\n+       ProcessTools.executeTestJvm(options).shouldContain(errorMsg)\n+           .shouldHaveExitValue(exitValue);\n@@ -103,2 +178,6 @@\n-    private static void testMessageNotExist(int exitValue, String errorMsg,String... options) throws Exception {\n-        ProcessTools.executeTestJvm(options).shouldNotContain(errorMsg).shouldHaveExitValue(exitValue);\n+    @ParameterizedTest\n+    @MethodSource(\"nonexistentProvider\")\n+    public void nonexistentMessage(int exitValue, String errorMsg,\n+                                   String... options) throws Exception {\n+        ProcessTools.executeTestJvm(options).shouldNotContain(errorMsg)\n+            .shouldHaveExitValue(exitValue);\n@@ -107,1 +186,4 @@\n-    private static void testMessageCounter(int exitValue,String... options) throws Exception {\n+    @ParameterizedTest\n+    @MethodSource(\"counterProvider\")\n+    public  void messageCounter(int exitValue, String... options)\n+        throws Exception {\n@@ -110,1 +192,1 @@\n-                -> line.equalsIgnoreCase(ioWarningMsg)).collect(Collectors.toList());\n+                -> line.equalsIgnoreCase(WARNING)).collect(Collectors.toList());\n@@ -115,1 +197,1 @@\n-}\n\\ No newline at end of file\n+}\n","filename":"test\/jdk\/java\/io\/File\/TempDirDoesNotExist.java","additions":131,"deletions":49,"binary":false,"changes":180,"status":"modified"}]}