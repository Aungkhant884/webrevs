{"files":[{"patch":"@@ -36,0 +36,1 @@\n+import java.util.Optional;\n@@ -65,1 +66,1 @@\n-    private final String mainClass;\n+    private final Optional<String> mainClass;\n@@ -68,1 +69,1 @@\n-    private final boolean appStore;\n+    private final Optional<String> appStore;\n@@ -85,1 +86,1 @@\n-        this.mainClass = mainClass;\n+        this.mainClass = Optional.ofNullable(mainClass);\n@@ -90,1 +91,1 @@\n-        this.appStore = \"true\".equals(appStoreStr);\n+        this.appStore = Optional.ofNullable(appStoreStr);\n@@ -113,1 +114,7 @@\n-        return mainClass;\n+        if (mainClass.isPresent()) {\n+            return mainClass.get();\n+        } else {\n+            throw new RuntimeException(MessageFormat.format(\n+                I18N.getString(\"ERR_MissingAppImageElement\"),\n+                \"main-class\"));\n+        }\n@@ -121,1 +128,7 @@\n-        return appStore;\n+        if (appStore.isPresent()) {\n+            return \"true\".equals(appStore.get());\n+        } else {\n+            throw new RuntimeException(MessageFormat.format(\n+                I18N.getString(\"ERR_MissingAppImageElement\"),\n+                \"app-store\"));\n+        }\n@@ -207,4 +220,0 @@\n-            if (mainClass == null) {\n-                \/\/ No main class, this is fatal.\n-                return new AppImageFile();\n-            }\n@@ -236,1 +245,1 @@\n-            if (!file.isValid()) {\n+            if (!file.isValid(appImageDir)) {\n@@ -342,1 +351,1 @@\n-    private boolean isValid() {\n+    private boolean isValid(Path appImageDir) {\n@@ -354,0 +363,4 @@\n+            Log.info(MessageFormat.format(I18N.getString(\n+                        \"warning.unexpected-version-jpackage-xml\"),\n+                             appImageDir.toAbsolutePath().toString(),\n+                             getVersion(), creatorVersion));\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/AppImageFile.java","additions":25,"deletions":12,"binary":false,"changes":37,"status":"modified"},{"patch":"@@ -82,0 +82,1 @@\n+warning.unexpected-version-jpackage-xml=Warning: Unexpected version of .jpackage.xml file in app-image dir ({0}). Expected version \"{1}\". Actual version \"{2}\".\n@@ -117,0 +118,1 @@\n+ERR_MissingAppImageElement=Error: app-image was generated by older jpackage version and missing required element <{0}> from .jpackage.xml.\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -80,0 +80,1 @@\n+warning.unexpected-version-jpackage-xml=Warning: Unexpected version of .jpackage.xml file in app-image dir ({0}). Expected version \"{1}\". Actual version \"{2}\".\n@@ -114,0 +115,1 @@\n+ERR_MissingAppImageElement=Error: app-image was generated by older jpackage version and missing required element <{0}> from .jpackage.xml.\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources_de.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -80,0 +80,1 @@\n+warning.unexpected-version-jpackage-xml=Warning: Unexpected version of .jpackage.xml file in app-image dir ({0}). Expected version \"{1}\". Actual version \"{2}\".\n@@ -114,0 +115,1 @@\n+ERR_MissingAppImageElement=Error: app-image was generated by older jpackage version and missing required element <{0}> from .jpackage.xml.\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources_ja.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -80,0 +80,1 @@\n+warning.unexpected-version-jpackage-xml=Warning: Unexpected version of .jpackage.xml file in app-image dir ({0}). Expected version \"{1}\". Actual version \"{2}\".\n@@ -114,0 +115,1 @@\n+ERR_MissingAppImageElement=Error: app-image was generated by older jpackage version and missing required element <{0}> from .jpackage.xml.\n","filename":"src\/jdk.jpackage\/share\/classes\/jdk\/jpackage\/internal\/resources\/MainResources_zh_CN.properties","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -84,5 +84,0 @@\n-        assertInvalid(createFromXml(\n-                JPACKAGE_STATE_OPEN,\n-                    \"<main-launcher>Foo<\/main-launcher>\",\n-                    \"<main-class><\/main-class>\",\n-                \"<\/jpackage-state>\"));\n@@ -144,0 +139,15 @@\n+    @Test\n+    public void testMissingMainClass() throws IOException {\n+        AppImageFile aif = createFromXml(\n+            JPACKAGE_STATE_OPEN,\n+                \"<main-launcher>Foo<\/main-launcher>\",\n+                \"<description>Duck App Description<\/description>\",\n+            \"<\/jpackage-state>\");\n+\n+        try {\n+            aif.getMainClass();\n+        } catch (RuntimeException ex) {\n+            Assert.assertTrue(ex.getMessage().contains(\"main-class\"));\n+        }\n+    }\n+\n@@ -168,0 +178,16 @@\n+    @Test\n+    public void testMissingMacAppStore() throws IOException {\n+        AppImageFile aif = createFromXml(\n+            JPACKAGE_STATE_OPEN,\n+                \"<main-launcher>Foo<\/main-launcher>\",\n+                \"<main-class>main.Class<\/main-class>\",\n+                \"<description>Duck App Description<\/description>\",\n+            \"<\/jpackage-state>\");\n+\n+        try {\n+            aif.getMainClass();\n+        } catch (RuntimeException ex) {\n+            Assert.assertTrue(ex.getMessage().contains(\"app-store\"));\n+        }\n+    }\n+\n","filename":"test\/jdk\/tools\/jpackage\/junit\/jdk\/jpackage\/internal\/AppImageFileTest.java","additions":31,"deletions":5,"binary":false,"changes":36,"status":"modified"}]}