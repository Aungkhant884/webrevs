{"files":[{"patch":"@@ -48,2 +48,1 @@\n-import java.util.Queue;\n-import java.util.concurrent.ArrayBlockingQueue;\n+import java.lang.ref.Reference;\n@@ -94,2 +93,2 @@\n-        private static void allocateHumongous(int num, Queue keeper) {\n-            for (int i = 1; i <= num; i++) {\n+        private static void allocateHumongous(int num, Object[] holder) {\n+            for (int i = 0; i < num; i++) {\n@@ -100,5 +99,1 @@\n-                byte[] e = new byte[HumongousObjectSize];\n-                if (!keeper.offer(e)) {\n-                    keeper.remove();\n-                    keeper.offer(e);\n-                }\n+                holder[i % holder.length] = new byte[HumongousObjectSize];\n@@ -108,1 +103,1 @@\n-        private static void runConcurrentUndoCycle(ArrayBlockingQueue a) {\n+        private static void runConcurrentUndoCycle() {\n@@ -113,2 +108,1 @@\n-            a = new ArrayBlockingQueue(1);\n-            allocateHumongous(NumHumongousObjectAllocations, a);\n+            allocateHumongous(NumHumongousObjectAllocations, new Object[1]);\n@@ -118,1 +112,2 @@\n-        private static void runConcurrentMarkCycle(ArrayBlockingQueue a) {\n+        private static void runConcurrentMarkCycle() {\n+            Object[] a = new Object[NumHumongousObjectAllocations];\n@@ -127,2 +122,0 @@\n-                WB.concurrentGCRunToIdle();\n-\n@@ -137,1 +130,1 @@\n-            allocateHumongous(1, new ArrayBlockingQueue(1));\n+            allocateHumongous(1, new Object[1]);\n@@ -139,0 +132,2 @@\n+\n+            Reference.reachabilityFence(a);\n@@ -142,1 +137,0 @@\n-            ArrayBlockingQueue a = null;\n@@ -144,5 +138,2 @@\n-                a = new ArrayBlockingQueue(1);\n-                runConcurrentUndoCycle(a);\n-\n-                a = new ArrayBlockingQueue(NumHumongousObjectAllocations);\n-                runConcurrentMarkCycle(a);\n+                runConcurrentUndoCycle();\n+                runConcurrentMarkCycle();\n@@ -150,1 +141,0 @@\n-            System.out.println(a);\n","filename":"test\/hotspot\/jtreg\/gc\/g1\/TestHumongousConcurrentStartUndo.java","additions":13,"deletions":23,"binary":false,"changes":36,"status":"modified"}]}