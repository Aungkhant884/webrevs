{"files":[{"patch":"@@ -230,1 +230,2 @@\n-  totally_drain = totally_drain || (_target_stack_size == 0);\n+  const uint threshold = totally_drain ? 0\n+                                       : _target_stack_size;\n@@ -239,9 +240,1 @@\n-      process_popped_location_depth(task);\n-    }\n-\n-    if (totally_drain) {\n-      while (tq->pop_local(task)) {\n-        process_popped_location_depth(task);\n-      }\n-    } else {\n-      while (tq->size() > _target_stack_size && tq->pop_local(task)) {\n+      if (!tq->try_push_to_taskqueue(task)) {\n@@ -251,1 +244,5 @@\n-  } while ((totally_drain && !tq->taskqueue_empty()) || !tq->overflow_empty());\n+\n+    while (tq->pop_local(task, threshold)) {\n+      process_popped_location_depth(task);\n+    }\n+  } while (!tq->overflow_empty());\n","filename":"src\/hotspot\/share\/gc\/parallel\/psPromotionManager.cpp","additions":8,"deletions":11,"binary":false,"changes":19,"status":"modified"}]}