{"files":[{"patch":"@@ -48,0 +48,2 @@\n+import java.security.AccessController;\n+import java.security.PrivilegedAction;\n@@ -72,0 +74,4 @@\n+    private final static boolean useTemplateImages = AccessController.doPrivileged((PrivilegedAction<Boolean>)\n+        () -> Boolean.getBoolean(\"apple.awt.enableTemplateImages\")\n+    );\n+\n@@ -214,1 +220,1 @@\n-                    setNativeImage(ptr, imagePtr, imageAutoSize);\n+                    setNativeImage(ptr, imagePtr, imageAutoSize, useTemplateImages);\n@@ -220,1 +226,1 @@\n-    private native void setNativeImage(final long model, final long nsimage, final boolean autosize);\n+    private native void setNativeImage(final long model, final long nsimage, final boolean autosize, final boolean template);\n","filename":"src\/java.desktop\/macosx\/classes\/sun\/lwawt\/macosx\/CTrayIcon.java","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -55,1 +55,1 @@\n-- (void) setImage:(NSImage *) imagePtr sizing:(BOOL)autosize;\n+- (void) setImage:(NSImage *) imagePtr sizing:(BOOL)autosize template:(BOOL)isTemplate;\n@@ -64,1 +64,1 @@\n-@interface AWTTrayIconView : NSView <NSMenuDelegate> {\n+@interface AWTTrayIconView : NSStatusBarButton <NSMenuDelegate> {\n@@ -67,1 +67,0 @@\n-    NSImage* image;\n@@ -73,1 +72,0 @@\n--(void)setImage:(NSImage*)anImage;\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CTrayIcon.h","additions":2,"deletions":4,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -107,1 +107,1 @@\n-- (void) setImage:(NSImage *) imagePtr sizing:(BOOL)autosize {\n+- (void) setImage:(NSImage *) imagePtr sizing:(BOOL)autosize template:(BOOL)isTemplate {\n@@ -118,0 +118,1 @@\n+    [imagePtr setTemplate: isTemplate];\n@@ -178,0 +179,1 @@\n+    [self setImage: nil];\n@@ -179,1 +181,0 @@\n-    image = nil;\n@@ -199,1 +200,0 @@\n-    [image release];\n@@ -212,10 +212,0 @@\n-- (void)setImage:(NSImage*)anImage {\n-    [anImage retain];\n-    [image release];\n-    image = anImage;\n-\n-    if (image != nil) {\n-        [self setNeedsDisplay:YES];\n-    }\n-}\n-\n@@ -239,1 +229,1 @@\n-    if (image == nil) {\n+    if (self.image == nil) {\n@@ -244,11 +234,0 @@\n-    NSSize imageSize = [image size];\n-\n-    NSRect drawRect = {{ (bounds.size.width - imageSize.width) \/ 2.0,\n-        (bounds.size.height - imageSize.height) \/ 2.0 }, imageSize};\n-\n-    \/\/ don't cover bottom pixels of the status bar with the image\n-    if (drawRect.origin.y < 1.0) {\n-        drawRect.origin.y = 1.0;\n-    }\n-    drawRect = NSIntegralRect(drawRect);\n-\n@@ -257,5 +236,2 @@\n-    [image drawInRect:drawRect\n-             fromRect:NSZeroRect\n-            operation:NSCompositeSourceOver\n-             fraction:1.0\n-     ];\n+\n+    [super drawRect: dirtyRect];\n@@ -378,1 +354,1 @@\n- * Signature: (JJZ)V\n+ * Signature: (JJZZ)V\n@@ -381,1 +357,1 @@\n-(JNIEnv *env, jobject self, jlong model, jlong imagePtr, jboolean autosize) {\n+(JNIEnv *env, jobject self, jlong model, jlong imagePtr, jboolean autosize, jboolean isTemplate) {\n@@ -386,1 +362,1 @@\n-        [icon setImage:jlong_to_ptr(imagePtr) sizing:autosize];\n+        [icon setImage:jlong_to_ptr(imagePtr) sizing:autosize template:isTemplate];\n","filename":"src\/java.desktop\/macosx\/native\/libawt_lwawt\/awt\/CTrayIcon.m","additions":9,"deletions":33,"binary":false,"changes":42,"status":"modified"},{"patch":"@@ -74,0 +74,9 @@\n+ * <p>\n+ * @implnote\n+ * When the {@systemProperty apple.awt.enableTemplateImages} property is\n+ * set, all images associated with instances of this class are treated\n+ * as template images by the native desktop system. This means all color\n+ * information is discarded, and the image is adapted automatically to\n+ * be visible when desktop theme and\/or colors change. This property\n+ * only affects MacOSX.\n+ *\n","filename":"src\/java.desktop\/share\/classes\/java\/awt\/TrayIcon.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}