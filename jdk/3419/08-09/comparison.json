{"files":[{"patch":"@@ -38,1 +38,1 @@\n- * default charset may be accepted.\n+ * {@link Charset#defaultCharset() default charset} may be accepted.\n@@ -67,1 +67,2 @@\n-     * Creates an InputStreamReader that uses the default charset.\n+     * Creates an InputStreamReader that uses the\n+     * {@link Charset#defaultCharset() default charset}.\n@@ -70,0 +71,2 @@\n+     *\n+     * @see Charset#defaultCharset()\n","filename":"src\/java.base\/share\/classes\/java\/io\/InputStreamReader.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -25,0 +25,2 @@\n+import jdk.test.lib.process.OutputAnalyzer;\n+import jdk.test.lib.process.ProcessTools;\n@@ -30,5 +32,6 @@\n- * @build CharsetTest\n- * @run shell runCharsetTest.sh en_US.ISO8859-1 ISO-8859-1\n- * @run shell runCharsetTest.sh en_US.US-ASCII US-ASCII\n- * @run shell runCharsetTest.sh en_US.UTF-8 UTF-8\n- * @run shell runCharsetTest.sh en_US.FOO ignored\n+ * @requires (os.family == \"linux\") | (os.family == \"mac\")\n+ * @library \/test\/lib\n+ * @run main CharsetTest en_US.ISO8859-1 ISO-8859-1\n+ * @run main CharsetTest en_US.US-ASCII US-ASCII\n+ * @run main CharsetTest en_US.UTF-8 UTF-8\n+ * @run main CharsetTest en_US.FOO ignored\n@@ -37,3 +40,24 @@\n-    public static void main(String... args) {\n-        Console con = System.console();\n-        System.out.println(con.charset());\n+    public static void main(String... args) throws Throwable {\n+        if (args.length == 0) {\n+            \/\/ no arg means child java process being tested.\n+            Console con = System.console();\n+            System.out.println(con.charset());\n+        } else {\n+            \/\/ invoking `expect` command\n+            var testSrc = System.getProperty(\"test.src\", \".\");\n+            var testClasses = System.getProperty(\"test.classes\", \".\");\n+            var jdkDir = System.getProperty(\"test.jdk\");\n+            OutputAnalyzer output = ProcessTools.executeProcess(\n+                    \"expect\",\n+                    \"-n\",\n+                    testSrc + \"\/script.exp\",\n+                    jdkDir + \"\/bin\/java\",\n+                    args[0],\n+                    args[1],\n+                    testClasses);\n+            output.reportDiagnosticSummary();\n+            var eval = output.getExitValue();\n+            if (eval != 0) {\n+                throw new RuntimeException(\"Exitval: \" + eval);\n+            }\n+        }\n","filename":"test\/jdk\/java\/io\/Console\/CharsetTest.java","additions":32,"deletions":8,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -1,51 +0,0 @@\n-# Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n-#\n-# This code is free software; you can redistribute it and\/or modify it\n-# under the terms of the GNU General Public License version 2 only, as\n-# published by the Free Software Foundation.\n-#\n-# This code is distributed in the hope that it will be useful, but WITHOUT\n-# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n-# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n-# version 2 for more details (a copy is included in the LICENSE file that\n-# accompanied this code).\n-#\n-# You should have received a copy of the GNU General Public License version\n-# 2 along with this work; if not, write to the Free Software Foundation,\n-# Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n-#\n-# Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n-# or visit www.oracle.com if you need additional information or have any\n-# questions.\n-#\n-\n-#! \/bin\/sh\n-#\n-\n-# Cygwin's `expect` command does not emulate console\n-OS=`uname -s`\n-case \"$OS\" in\n-  Windows* | CYGWIN* )\n-    echo \"Cygwin's `expect` command does not emulate console. Test ignored.\"\n-    exit 0\n-esac\n-\n-locale=$1\n-encoding=$2\n-\n-if [ -f \/usr\/bin\/expect ]\n-then\n-    EXPECT=\/usr\/bin\/expect\n-else\n-    echo \"expect command does not exist. test ignored\"\n-    exit 0\n-fi\n-\n-if $EXPECT -n $TESTSRC\/script.exp $TESTJAVA\/bin\/java $locale $encoding $TESTCLASSES ${TESTVMOPTS} ; then\n-    echo \"TEST PASSED!\"\n-    exit 0\n-else\n-    echo \"TEST FAILED!\"\n-    exit 1\n-fi\n","filename":"test\/jdk\/java\/io\/Console\/runCharsetTest.sh","additions":0,"deletions":51,"binary":false,"changes":51,"status":"deleted"}]}