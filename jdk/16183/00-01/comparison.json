{"files":[{"patch":"@@ -0,0 +1,122 @@\n+\/*\n+ * Copyright (c) 2023, Oracle and\/or its affiliates. All rights reserved.\n+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.\n+ *\n+ * This code is free software; you can redistribute it and\/or modify it\n+ * under the terms of the GNU General Public License version 2 only, as\n+ * published by the Free Software Foundation.\n+ *\n+ * This code is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+ * version 2 for more details (a copy is included in the LICENSE file that\n+ * accompanied this code).\n+ *\n+ * You should have received a copy of the GNU General Public License version\n+ * 2 along with this work; if not, write to the Free Software Foundation,\n+ * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.\n+ *\n+ * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA\n+ * or visit www.oracle.com if you need additional information or have any\n+ * questions.\n+ *\/\n+\n+\/*\n+ * @test\n+ * @run testng\/othervm --enable-native-access=ALL-UNNAMED TestScope\n+ *\/\n+\n+import org.testng.annotations.*;\n+\n+import java.lang.foreign.Arena;\n+import java.lang.foreign.MemorySegment;\n+import java.lang.foreign.SymbolLookup;\n+import java.nio.ByteBuffer;\n+import java.nio.IntBuffer;\n+\n+import static org.testng.Assert.*;\n+\n+public class TestScope {\n+\n+    static {\n+        System.loadLibrary(\"LookupTest\");\n+    }\n+\n+    @Test\n+    public void testDifferentArrayScope() {\n+        MemorySegment.Scope scope1 = MemorySegment.ofArray(new byte[10]).scope();\n+        MemorySegment.Scope scope2 = MemorySegment.ofArray(new byte[10]).scope();\n+        assertNotEquals(scope1, scope2);\n+    }\n+\n+    @Test\n+    public void testDifferentBufferScope() {\n+        MemorySegment.Scope scope1 = MemorySegment.ofBuffer(ByteBuffer.allocateDirect(10)).scope();\n+        MemorySegment.Scope scope2 = MemorySegment.ofBuffer(ByteBuffer.allocateDirect(10)).scope();\n+        assertNotEquals(scope1, scope2);\n+    }\n+\n+    @Test\n+    public void testDifferentArenaScope() {\n+        MemorySegment.Scope scope1 = Arena.ofAuto().allocate(10).scope();\n+        MemorySegment.Scope scope2 = Arena.ofAuto().allocate(10).scope();\n+        assertNotEquals(scope1, scope2);\n+    }\n+\n+    @Test\n+    public void testSameArrayScope() {\n+        byte[] arr = new byte[10];\n+        assertEquals(MemorySegment.ofArray(arr).scope(), MemorySegment.ofArray(arr).scope());\n+        ByteBuffer buf = ByteBuffer.wrap(arr);\n+        assertEquals(MemorySegment.ofArray(arr).scope(), MemorySegment.ofBuffer(buf).scope());\n+        testDerivedBufferScope(MemorySegment.ofArray(arr));\n+    }\n+\n+    @Test\n+    public void testSameBufferScope() {\n+        ByteBuffer buf = ByteBuffer.allocateDirect(10);\n+        assertEquals(MemorySegment.ofBuffer(buf).scope(), MemorySegment.ofBuffer(buf).scope());\n+        testDerivedBufferScope(MemorySegment.ofBuffer(buf));\n+    }\n+\n+    @Test\n+    public void testSameArenaScope() {\n+        try (Arena arena = Arena.ofConfined()) {\n+            MemorySegment segment1 = arena.allocate(10);\n+            MemorySegment segment2 = arena.allocate(10);\n+            assertEquals(segment1.scope(), segment2.scope());\n+            testDerivedBufferScope(segment1);\n+        }\n+    }\n+\n+    @Test\n+    public void testSameNativeScope() {\n+        MemorySegment segment1 = MemorySegment.ofAddress(42);\n+        MemorySegment segment2 = MemorySegment.ofAddress(43);\n+        assertEquals(segment1.scope(), segment2.scope());\n+        assertEquals(segment1.scope(), segment2.reinterpret(10).scope());\n+        assertEquals(segment1.scope(), Arena.global().scope());\n+        testDerivedBufferScope(segment1.reinterpret(10));\n+    }\n+\n+    @Test\n+    public void testSameLookupScope() {\n+        SymbolLookup loaderLookup = SymbolLookup.loaderLookup();\n+        MemorySegment segment1 = loaderLookup.find(\"f\").get();\n+        MemorySegment segment2 = loaderLookup.find(\"c\").get();\n+        assertEquals(segment1.scope(), segment2.scope());\n+        testDerivedBufferScope(segment1.reinterpret(10));\n+    }\n+\n+    void testDerivedBufferScope(MemorySegment segment) {\n+        ByteBuffer buffer = segment.asByteBuffer();\n+        MemorySegment.Scope expectedScope = segment.scope();\n+        assertEquals(MemorySegment.ofBuffer(buffer).scope(), expectedScope);\n+        \/\/ buffer slices should have same scope\n+        ByteBuffer slice = buffer.slice(0, 2);\n+        assertEquals(expectedScope, MemorySegment.ofBuffer(slice).scope());\n+        \/\/ buffer views should have same scope\n+        IntBuffer view = buffer.asIntBuffer();\n+        assertEquals(expectedScope, MemorySegment.ofBuffer(view).scope());\n+    }\n+}\n\\ No newline at end of file\n","filename":"test\/jdk\/java\/foreign\/TestScope.java","additions":122,"deletions":0,"binary":false,"changes":122,"status":"added"}]}