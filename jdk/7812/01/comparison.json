{"files":[{"patch":"@@ -151,1 +151,2 @@\n-     * @throws IllegalStateException if the resulting {@linkplain ClassDesc} would have an array rank of greater than 255\n+     * @throws IllegalStateException if the resulting {@linkplain\n+     * ClassDesc} would have an array rank of greater than 255\n@@ -170,1 +171,2 @@\n-     * @throws IllegalArgumentException if the rank is less than or equal to zero or if the rank of the resulting array type is\n+     * @throws IllegalArgumentException if the rank is less than or\n+     * equal to zero or if the rank of the resulting array type is\n@@ -175,3 +177,15 @@\n-        int currentDepth = ConstantUtils.arrayDepth(descriptorString());\n-        if (rank <= 0 || currentDepth + rank > ConstantUtils.MAX_ARRAY_TYPE_DESC_DIMENSIONS)\n-            throw new IllegalArgumentException(\"rank: \" + currentDepth + rank);\n+        int netRank;\n+        if (rank <= 0) {\n+            throw new IllegalArgumentException(\"rank \" + rank + \"is not a positive value\");\n+        }\n+        try {\n+            int currentDepth = ConstantUtils.arrayDepth(descriptorString());\n+            netRank = Math.addExact(currentDepth, rank);\n+            if (netRank > ConstantUtils.MAX_ARRAY_TYPE_DESC_DIMENSIONS) {\n+                throw new IllegalArgumentException(\"rank: \" + netRank +\n+                                                   \" exceeds maximum supported dimension of \" +\n+                                                   ConstantUtils.MAX_ARRAY_TYPE_DESC_DIMENSIONS);\n+            }\n+        } catch (ArithmeticException ae) {\n+            throw new IllegalArgumentException(\"Integer overflow in rank computation\");\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/constant\/ClassDesc.java","additions":19,"deletions":5,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n- * @bug 8215510\n+ * @bug 8215510 8283075\n@@ -187,0 +187,13 @@\n+    private void testArrayRankOverflow() {\n+        ClassDesc TwoDArrayDesc =\n+            String.class.describeConstable().get().arrayType().arrayType();\n+\n+        try {\n+            TwoDArrayDesc.arrayType(Integer.MAX_VALUE);\n+            fail(\"\");\n+        } catch (IllegalArgumentException iae) {\n+            \/\/ Expected\n+        }\n+    }\n+\n+\n@@ -221,0 +234,1 @@\n+            testArrayRankOverflow();\n","filename":"test\/jdk\/java\/lang\/constant\/ClassDescTest.java","additions":15,"deletions":1,"binary":false,"changes":16,"status":"modified"}]}