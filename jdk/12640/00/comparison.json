{"files":[{"patch":"@@ -877,1 +877,1 @@\n-                return Arrays.copyOf(val, val.length);\n+                return val.clone();\n@@ -976,5 +976,4 @@\n-            byte[] dst = Arrays.copyOf(val, val.length);\n-            for (int i = 0; i < dst.length; i++) {\n-                if (dst[i] < 0) {\n-                    dst[i] = '?';\n-                }\n+            int positives = StringCoding.countPositives(val, 0, val.length);\n+            byte[] dst = val.clone();\n+            if (positives < dst.length) {\n+                replaceNegatives(dst, positives);\n@@ -1005,0 +1004,8 @@\n+    private static void replaceNegatives(byte[] val, int fromIndex) {\n+        for (int i = fromIndex; i < val.length; i++) {\n+            if (val[i] < 0) {\n+                val[i] = '?';\n+            }\n+        }\n+    }\n+\n@@ -1011,1 +1018,1 @@\n-            return Arrays.copyOf(val, val.length);\n+            return val.clone();\n@@ -1265,2 +1272,1 @@\n-        int dp = 0;\n-        while (dp < val.length && val[dp] >=0) { dp++; }\n+        int dp = StringCoding.countPositives(val, 0, val.length);\n@@ -1281,1 +1287,1 @@\n-        if (coder == UTF16)\n+        if (coder == UTF16) {\n@@ -1283,0 +1289,1 @@\n+        }\n@@ -1284,2 +1291,3 @@\n-        if (!StringCoding.hasNegatives(val, 0, val.length))\n-            return Arrays.copyOf(val, val.length);\n+        if (!StringCoding.hasNegatives(val, 0, val.length)) {\n+            return val.clone();\n+        }\n@@ -1297,1 +1305,1 @@\n-        if (dp == dst.length)\n+        if (dp == dst.length) {\n@@ -1299,0 +1307,1 @@\n+        }\n","filename":"src\/java.base\/share\/classes\/java\/lang\/String.java","additions":22,"deletions":13,"binary":false,"changes":35,"status":"modified"}]}