{"files":[{"patch":"@@ -568,0 +568,1 @@\n+\/\/ delay box in runtime, treat box as a scalarized object\n@@ -569,14 +570,0 @@\n-  Unique_Node_List safepoints;\n-  for (DUIterator_Fast imax, i = resproj->fast_outs(imax); i < imax; i++) {\n-    Node* m = resproj->fast_out(i);\n-    safepoints.push(m);\n-  }\n-\n-#ifndef PRODUCT\n-  if (PrintEliminateAllocations && safepoints.size() > 0) {\n-    tty->print(\"++++ Eliminated: %d \", call->_idx);\n-    call->as_CallStaticJava()->method()->print_short_name(tty);\n-    tty->cr();\n-  }\n-#endif\n-\n@@ -585,4 +572,0 @@\n-  \/\/ delay box in runtime, treat box as a scalarized object\n-  while (safepoints.size() > 0) {\n-    ProjNode* res = resproj->as_Proj();\n-    Node* sfpt = safepoints.pop();\n@@ -590,3 +573,4 @@\n-    ciInstanceKlass* klass = call->as_CallStaticJava()->method()->holder();\n-    int n_fields = klass->nof_nonstatic_fields();\n-    assert(n_fields == 1, \"the klass must be an auto-boxing klass\");\n+  ProjNode* res = resproj->as_Proj();\n+  ciInstanceKlass* klass = call->as_CallStaticJava()->method()->holder();\n+  int n_fields = klass->nof_nonstatic_fields();\n+  assert(n_fields == 1, \"the klass must be an auto-boxing klass\");\n@@ -594,0 +578,2 @@\n+  for (DUIterator_Last imin, i = res->last_outs(imin); i >= imin;) {\n+    SafePointNode* sfpt = res->last_out(i)->as_SafePoint();\n@@ -597,1 +583,1 @@\n-                                                  call->isa_Allocate(),\n+                                                nullptr,\n@@ -607,1 +593,2 @@\n-    sfpt->replace_edges_in_range(res, sobj, start, end);\n+    int num_edges = sfpt->replace_edges_in_range(res, sobj, start, end, &gvn);\n+    i -= num_edges;\n@@ -610,1 +597,9 @@\n-  assert(resproj->outcnt() == 0, \"the box must have no use after replace\");\n+  assert(res->outcnt() == 0, \"the box must have no use after replace\");\n+\n+#ifndef PRODUCT\n+  if (PrintEliminateAllocations) {\n+    tty->print(\"++++ Eliminated: %d \", call->_idx);\n+    call->as_CallStaticJava()->method()->print_short_name(tty);\n+    tty->cr();\n+  }\n+#endif\n","filename":"src\/hotspot\/share\/opto\/callGenerator.cpp","additions":19,"deletions":24,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -900,1 +900,1 @@\n-#if COMPILER2 || INCLUDE_JVMCI || INCLUDE_AOT\n+#if COMPILER2_OR_JVMCI || INCLUDE_AOT\n@@ -1028,1 +1028,1 @@\n-#endif \/\/ COMPILER2 || INCLUDE_JVMCI || INCLUDE_AOT\n+#endif \/\/ COMPILER2_OR_JVMCI || INCLUDE_AOT\n@@ -1047,1 +1047,1 @@\n-#if COMPILER2 || INCLUDE_JVMCI || INCLUDE_AOT\n+#if COMPILER2_OR_JVMCI || INCLUDE_AOT\n@@ -1056,1 +1056,1 @@\n-#endif \/\/ COMPILER2 || INCLUDE_JVMCI || INCLUDE_AOT\n+#endif \/\/ COMPILER2_OR_JVMCI || INCLUDE_AOT\n@@ -1398,1 +1398,1 @@\n-#if COMPILER2 || INCLUDE_JVMCI || INCLUDE_AOT\n+#if COMPILER2_OR_JVMCI || INCLUDE_AOT\n@@ -1403,1 +1403,1 @@\n-#endif \/\/ COMPILER2 || INCLUDE_JVMCI || INCLUDE_AOT\n+#endif \/\/ COMPILER2_OR_JVMCI || INCLUDE_AOT\n","filename":"src\/hotspot\/share\/runtime\/deoptimization.cpp","additions":6,"deletions":6,"binary":false,"changes":12,"status":"modified"}]}