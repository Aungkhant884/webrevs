{"files":[{"patch":"@@ -34,1 +34,2 @@\n- * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI SharedArchiveConsistency\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI SharedArchiveConsistency on\n+ * @run main\/othervm -Xbootclasspath\/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI SharedArchiveConsistency auto\n@@ -72,0 +73,3 @@\n+    public static boolean shareAuto;       \/\/ true  == -Xshare:auto\n+                                           \/\/ false == -Xshare:on\n+\n@@ -83,0 +87,2 @@\n+    public static final String HELLO_WORLD = \"Hello World\";\n+\n@@ -342,1 +348,1 @@\n-        OutputAnalyzer output = TestCommon.execCommon(execArgs);\n+        OutputAnalyzer output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -364,0 +370,8 @@\n+        if (args.length != 1) {\n+            throw new RuntimeException(\"One arg of 'on' or 'auto' to run the test\");\n+        }\n+        if (!args[0].equals(\"on\") && !args[0].equals(\"auto\")) {\n+            throw new RuntimeException(\"Arg must be 'on' or 'auto'\");\n+        }\n+        shareAuto = args[0].equals(\"auto\");\n+\n@@ -383,1 +397,1 @@\n-        OutputAnalyzer output = TestCommon.execCommon(execArgs);\n+        OutputAnalyzer output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -386,1 +400,1 @@\n-            TestCommon.checkExecReturn(output, 0, true, \"Hello World\");\n+            TestCommon.checkExecReturn(output, 0, true, HELLO_WORLD);\n@@ -400,1 +414,1 @@\n-        output = TestCommon.execCommon(execArgs);\n+        output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -403,0 +417,3 @@\n+        if (shareAuto) {\n+            output.shouldContain(HELLO_WORLD);\n+        }\n@@ -407,1 +424,1 @@\n-        output = TestCommon.execCommon(execArgs);\n+        output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -410,0 +427,3 @@\n+        if (shareAuto) {\n+            output.shouldContain(HELLO_WORLD);\n+        }\n@@ -411,3 +431,3 @@\n-        \/\/ use the same archive as above, but run with -Xshare:auto\n-        System.out.println(\"\\n2b. Corrupt _jvm_ident run with -Xshare:auto\\n\");\n-        output = TestCommon.execAuto(execArgs);\n+        \/\/ use the same archive as above, but run with -Xshare:auto or -Xshare:on depends on shareAuto (reverse)\n+        System.out.println(\"\\n2b. Corrupt _jvm_ident run with \" + (shareAuto ? \"-Xshare:on\\n\" : \"-Xshare:auto\"));\n+        output = shareAuto ? TestCommon.execCommon(execArgs) : TestCommon.execAuto(execArgs);\n@@ -415,1 +435,3 @@\n-        output.shouldContain(\"Hello World\");\n+        if (!shareAuto) {\n+          output.shouldContain(\"Hello World\");\n+        }\n@@ -420,1 +442,1 @@\n-        output = TestCommon.execCommon(execArgs);\n+        output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -423,0 +445,3 @@\n+        if (shareAuto) {\n+            output.shouldContain(HELLO_WORLD);\n+        }\n@@ -427,1 +452,1 @@\n-        output = TestCommon.execCommon(execArgs);\n+        output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -430,0 +455,3 @@\n+        if (shareAuto) {\n+            output.shouldContain(HELLO_WORLD);\n+        }\n@@ -445,1 +473,1 @@\n-        output = TestCommon.execCommon(execArgs);\n+        output = shareAuto ? TestCommon.execAuto(execArgs) : TestCommon.execCommon(execArgs);\n@@ -448,0 +476,3 @@\n+        if (shareAuto) {\n+            output.shouldContain(HELLO_WORLD);\n+        }\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/SharedArchiveConsistency.java","additions":44,"deletions":13,"binary":false,"changes":57,"status":"modified"}]}