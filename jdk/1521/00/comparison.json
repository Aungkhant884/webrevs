{"files":[{"patch":"@@ -3156,4 +3156,19 @@\n-  if (!UseCompressedClassPointers) return 0;\n-  int num_instrs = 1;  \/\/ shift or move\n-  if (CompressedKlassPointers::base() != 0) num_instrs = 7;  \/\/ shift + load const + add\n-  return num_instrs * BytesPerInstWord;\n+  static int computed_size = -1;\n+\n+  \/\/ Not yet computed?\n+  if (computed_size == -1) {\n+\n+    if (!UseCompressedClassPointers) {\n+      computed_size = 0;\n+    } else {\n+      \/\/ Determine by scratch emit.\n+      ResourceMark rm;\n+      int code_size = 8 * BytesPerInstWord;\n+      CodeBuffer cb(\"decode_klass_not_null scratch buffer\", code_size, 0);\n+      MacroAssembler* a = new MacroAssembler(&cb);\n+      a->decode_klass_not_null(R11_scratch1);\n+      computed_size = a->offset();\n+    }\n+  }\n+\n+  return computed_size;\n","filename":"src\/hotspot\/cpu\/ppc\/macroAssembler_ppc.cpp","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -1103,2 +1103,1 @@\n-  if (UseInlineCaches)\n-    return 4;\n+  if (UseInlineCaches) return 4;\n@@ -1112,2 +1111,1 @@\n-    assert(!UseInlineCaches, \"expect vtable calls only if not using ICs\");\n-    return 24;\n+    return 24 + MacroAssembler::instr_size_for_decode_klass_not_null();\n@@ -3638,1 +3636,1 @@\n-#if 0\n+\n@@ -3659,1 +3657,1 @@\n-             \"Fix constant in ret_addr_offset()\");\n+             \"Fix constant in ret_addr_offset(), expected %d\", __ offset() - start_offset);\n@@ -3679,3 +3677,0 @@\n-      if (((MachCallDynamicJavaNode*)this)->ret_addr_offset() != __ offset() - start_offset) {\n-        tty->print(\" %d, %d\\n\", ((MachCallDynamicJavaNode*)this)->ret_addr_offset(),__ offset() - start_offset);\n-      }\n@@ -3683,1 +3678,1 @@\n-             \"Fix constant in ret_addr_offset()\");\n+             \"Fix constant in ret_addr_offset(), expected %d\", __ offset() - start_offset);\n@@ -3685,2 +3680,0 @@\n-#endif\n-    Unimplemented();  \/\/ ret_addr_offset not yet fixed. Depends on compressed oops (load klass!).\n","filename":"src\/hotspot\/cpu\/ppc\/ppc.ad","additions":5,"deletions":12,"binary":false,"changes":17,"status":"modified"}]}