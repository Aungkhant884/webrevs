{"files":[{"patch":"@@ -261,1 +261,0 @@\n-java\/awt\/FullScreen\/DisplayChangeVITest\/DisplayChangeVITest.java 8169469,8273618 windows-all,macosx-aarch64\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -48,0 +48,1 @@\n+import javax.swing.SwingUtilities;\n@@ -61,1 +62,1 @@\n-public class DisplayChangeVITest extends JFrame implements Runnable {\n+public class DisplayChangeVITest implements Runnable {\n@@ -76,1 +77,1 @@\n-        addKeyListener(new KeyAdapter() {\n+        frame.addKeyListener(new KeyAdapter() {\n@@ -98,1 +99,1 @@\n-            g.fillRect(0, 0, getWidth(), getHeight());\n+            g.fillRect(0, 0, frame.getWidth(), frame.getHeight());\n@@ -118,1 +119,1 @@\n-        GraphicsDevice gd = getGraphicsConfiguration().getDevice();\n+        GraphicsDevice gd = frame.getGraphicsConfiguration().getDevice();\n@@ -129,1 +130,1 @@\n-                        render(getGraphics());\n+                        render(frame.getGraphics());\n@@ -131,1 +132,1 @@\n-                        repaint();\n+                        frame.repaint();\n@@ -141,1 +142,0 @@\n-        dispose();\n@@ -150,1 +150,1 @@\n-            bb.getWidth() != getWidth() || bb.getHeight() != getHeight())\n+            bb.getWidth() != frame.getWidth() || bb.getHeight() != frame.getHeight())\n@@ -152,1 +152,1 @@\n-            bb = createVolatileImage(getWidth(), getHeight());\n+            bb = frame.createVolatileImage(frame.getWidth(), frame.getHeight());\n@@ -159,1 +159,1 @@\n-        int res = bb.validate(getGraphicsConfiguration());\n+        int res = bb.validate(frame.getGraphicsConfiguration());\n@@ -163,1 +163,1 @@\n-            bb.validate(getGraphicsConfiguration());\n+            bb.validate(frame.getGraphicsConfiguration());\n@@ -171,1 +171,1 @@\n-            volSprite = createVolatileImage(100, 100);\n+            volSprite = frame.createVolatileImage(100, 100);\n@@ -173,1 +173,1 @@\n-        volSprite.validate(getGraphicsConfiguration());\n+        volSprite.validate(frame.getGraphicsConfiguration());\n@@ -222,0 +222,2 @@\n+    private static JFrame frame;\n+\n@@ -223,14 +225,21 @@\n-        DisplayChangeVITest test = new DisplayChangeVITest();\n-        GraphicsDevice gd =\n-            GraphicsEnvironment.getLocalGraphicsEnvironment().\n-                getDefaultScreenDevice();\n-        if (gd.isFullScreenSupported()) {\n-            gd.setFullScreenWindow(test);\n-            Thread t = new Thread(test);\n-            t.run();\n-            synchronized (lock) {\n-                while (!done) {\n-                    try {\n-                        lock.wait(50);\n-                    } catch (InterruptedException ex) {\n-                        ex.printStackTrace();\n+        GraphicsDevice gd = null;\n+        try {\n+            SwingUtilities.invokeAndWait(() -> {\n+                frame = new JFrame();\n+            });\n+            DisplayChangeVITest test = new DisplayChangeVITest();\n+            gd =\n+                GraphicsEnvironment.getLocalGraphicsEnvironment().\n+                    getDefaultScreenDevice();\n+            if (gd.isFullScreenSupported()) {\n+                gd.setFullScreenWindow(frame);\n+                Thread t = new Thread(test);\n+                t.run();\n+                sleep(1000);\n+                synchronized (lock) {\n+                    while (!done) {\n+                        try {\n+                            lock.wait(100);\n+                        } catch (InterruptedException ex) {\n+                            ex.printStackTrace();\n+                        }\n@@ -239,0 +248,3 @@\n+                System.err.println(\"Test Passed.\");\n+            } else {\n+                System.err.println(\"Full screen not supported. Test passed.\");\n@@ -240,3 +252,7 @@\n-            System.err.println(\"Test Passed.\");\n-        } else {\n-            System.err.println(\"Full screen not supported. Test passed.\");\n+        } finally {\n+            gd.setFullScreenWindow(null);\n+            SwingUtilities.invokeAndWait(() -> {\n+                if (frame != null) {\n+                    frame.dispose();\n+                }\n+            });\n","filename":"test\/jdk\/java\/awt\/FullScreen\/DisplayChangeVITest\/DisplayChangeVITest.java","additions":46,"deletions":30,"binary":false,"changes":76,"status":"modified"}]}