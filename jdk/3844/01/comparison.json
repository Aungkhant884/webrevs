{"files":[{"patch":"@@ -28,0 +28,4 @@\n+import java.awt.GraphicsConfiguration;\n+import java.awt.GraphicsDevice;\n+import java.awt.GraphicsEnvironment;\n+import java.awt.Point;\n@@ -32,0 +36,1 @@\n+import java.io.File;\n@@ -34,0 +39,1 @@\n+import javax.imageio.ImageIO;\n@@ -106,1 +112,7 @@\n-                return popupMenu.getBounds();\n+                Rectangle bounds = popupMenu.getBounds();\n+                Point anchor = popupMenu.getLocationOnScreen();\n+                Point location = popupMenu.getLocation();\n+                int offsetX = anchor.x - location.x;\n+                int offsetY = anchor.y - location.y;\n+                bounds.setLocation(bounds.x + offsetX, bounds.y + offsetY);\n+                return bounds;\n@@ -111,0 +123,1 @@\n+        BufferedImage redFrame = robot.createScreenCapture(frame.getBounds());\n@@ -116,0 +129,1 @@\n+                lowerFrame.invalidate();\n@@ -120,0 +134,1 @@\n+        robot.delay(1000); \/\/ Give frame time to repaint\n@@ -122,0 +137,1 @@\n+        BufferedImage greenFrame = robot.createScreenCapture(frame.getBounds());\n@@ -124,0 +140,25 @@\n+            try {\n+                GraphicsDevice[] devices = GraphicsEnvironment.getLocalGraphicsEnvironment().getScreenDevices();\n+                for (int i = 0; i < devices.length; i++) {\n+                    GraphicsConfiguration[] screens = devices[i].getConfigurations();\n+                    for (int j = 0; j < screens.length; j++) {\n+                        BufferedImage fullScreen = robot.createScreenCapture(screens[j].getBounds());\n+                        if (screens[j].getBounds().intersects(popupRectangle)) {\n+                            Graphics g = fullScreen.getGraphics();\n+                            g.setColor(Color.CYAN);\n+                            g.drawRect(popupRectangle.x - 1, popupRectangle.y - 1,\n+                                    popupRectangle.width + 2, popupRectangle.height + 2);\n+                            g.dispose();\n+                        }\n+                        ImageIO.write(fullScreen, \"png\", new File(\"dev\" + i + \"scr\" + j + \".png\"));\n+                    }\n+                }\n+                ImageIO.write(redFrame, \"png\", new File(\"redframe.png\"));\n+                ImageIO.write(redBackgroundCapture, \"png\", new File(\"redbg.png\"));\n+                ImageIO.write(greenFrame, \"png\", new File(\"greenframe.png\"));\n+                ImageIO.write(greenBackgroundCapture, \"png\", new File(\"greenbg.png\"));\n+            } finally {\n+                frame.dispose();\n+                lowerFrame.dispose();\n+            }\n+            robot.waitForIdle();\n","filename":"test\/jdk\/javax\/swing\/JPopupMenu\/7156657\/bug7156657.java","additions":42,"deletions":1,"binary":false,"changes":43,"status":"modified"}]}