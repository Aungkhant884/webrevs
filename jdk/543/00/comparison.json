{"files":[{"patch":"@@ -975,0 +975,12 @@\n+    methodHandle method(THREAD, target->get_Method());\n+\n+    if (TieredCompilation && method->get_method_counters(THREAD) == NULL) {\n+      \/\/ Tiered policy requires method counters.\n+      record_failure(\"can't create method counters\");\n+      \/\/ All buffers in the CodeBuffer are allocated in the CodeCache.\n+      \/\/ If the code buffer is created on each compile attempt\n+      \/\/ as in C2, then it must be freed.\n+      code_buffer->free_blob();\n+      return;\n+    }\n+\n@@ -1014,3 +1026,0 @@\n-\n-    methodHandle method(THREAD, target->get_Method());\n-\n","filename":"src\/hotspot\/share\/ci\/ciEnv.cpp","additions":12,"deletions":3,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -1580,2 +1580,9 @@\n-  JVMCI::CodeInstallResult result;\n-  {\n+  JVMCI::CodeInstallResult result(JVMCI::ok);\n+\n+  if (TieredCompilation && method->get_method_counters(THREAD) == NULL) {\n+    \/\/ Tiered policy requires method counters.\n+    result = JVMCI::cache_full;\n+    failure_detail = (char*) \"can't create method counters\";\n+  }\n+\n+  if (result == JVMCI::ok) {\n","filename":"src\/hotspot\/share\/jvmci\/jvmciRuntime.cpp","additions":9,"deletions":2,"binary":false,"changes":11,"status":"modified"}]}