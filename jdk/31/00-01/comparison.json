{"files":[{"patch":"@@ -1671,1 +1671,1 @@\n-        \/\/ See Hacker's Delight (2nd ed), section 9.3\n+        \/* See Hacker's Delight (2nd ed), section 9.3 *\/\n@@ -1675,1 +1675,1 @@\n-            return q + ((r | ~(r - divisor)) >>> Long.SIZE - 1);\n+            return q + ((r | ~(r - divisor)) >>> (Long.SIZE - 1));\n@@ -1677,1 +1677,1 @@\n-        return (dividend & ~(dividend - divisor)) >>> Long.SIZE - 1;\n+        return (dividend & ~(dividend - divisor)) >>> (Long.SIZE - 1);\n@@ -1693,1 +1693,1 @@\n-        \/\/ See Hacker's Delight (2nd ed), section 9.3\n+        \/* See Hacker's Delight (2nd ed), section 9.3 *\/\n@@ -1697,1 +1697,12 @@\n-            return r - (~(r - divisor) >> Long.SIZE - 1 & divisor);\n+            \/*\n+             * Here, 0 <= r < 2 * divisor\n+             * (1) When 0 <= r < divisor, the remainder is simply r.\n+             * (2) Otherwise the remainder is r - divisor.\n+             *\n+             * In case (1), r - divisor < 0. Applying ~ produces a long with\n+             * sign bit 0, so >> produces 0. The returned value is thus r.\n+             *\n+             * In case (2), a similar reasoning shows that >> produces -1,\n+             * so the returned value is r - divisor.\n+             *\/\n+            return r - ((~(r - divisor) >> (Long.SIZE - 1)) & divisor);\n@@ -1699,1 +1710,10 @@\n-        return dividend - ((dividend & ~(dividend - divisor)) >> Long.SIZE - 1 & divisor);\n+        \/*\n+         * (1) When dividend >= 0, the remainder is dividend.\n+         * (2) Otherwise\n+         *      (2.1) When dividend < divisor, the remainder is dividend.\n+         *      (2.2) Otherwise the remainder is dividend - divisor\n+         *\n+         * A reasoning similar to the above shows that the returned value\n+         * is as expected.\n+         *\/\n+        return dividend - (((dividend & ~(dividend - divisor)) >> (Long.SIZE - 1)) & divisor);\n","filename":"src\/java.base\/share\/classes\/java\/lang\/Long.java","additions":26,"deletions":6,"binary":false,"changes":32,"status":"modified"}]}