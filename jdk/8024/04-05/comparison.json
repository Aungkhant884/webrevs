{"files":[{"patch":"@@ -33,6 +33,1 @@\n- * @run driver compiler.sharedstubs.SharedStubToInterpTest c2 StaticMethodTest\n- * @run driver compiler.sharedstubs.SharedStubToInterpTest c1 StaticMethodTest\n- * @run driver compiler.sharedstubs.SharedStubToInterpTest c2 FinalClassTest\n- * @run driver compiler.sharedstubs.SharedStubToInterpTest c1 FinalClassTest\n- * @run driver compiler.sharedstubs.SharedStubToInterpTest c2 FinalMethodTest\n- * @run driver compiler.sharedstubs.SharedStubToInterpTest c1 FinalMethodTest\n+ * @run driver compiler.sharedstubs.SharedStubToInterpTest\n@@ -45,1 +40,1 @@\n-import java.util.ListIterator;\n+import java.util.List;\n@@ -50,3 +45,4 @@\n-    public static void main(String[] args) throws Exception {\n-        String compiler = args[0];\n-        String testClassName = SharedStubToInterpTest.class.getName() + \"$\" + args[1];\n+    private final static int ITERATIONS_TO_HEAT_LOOP = 20_000;\n+\n+    private static void runTest(String compiler, String test) throws Exception {\n+        String testClassName = SharedStubToInterpTest.class.getName() + \"$\" + test;\n@@ -54,1 +50,1 @@\n-        command.add(\"-XX:+IgnoreUnrecognizedVMOptions\");\n+        command.add(compiler);\n@@ -56,7 +52,0 @@\n-        if (compiler.equals(\"c2\")) {\n-            command.add(\"-XX:-TieredCompilation\");\n-        } else if (compiler.equals(\"c1\")) {\n-            command.add(\"-XX:TieredStopAtLevel=1\");\n-        } else {\n-            throw new RuntimeException(\"Unknown compiler: \" + compiler);\n-        }\n@@ -72,3 +61,0 @@\n-        command.add(\"a\");\n-        command.add(\"b\");\n-        command.add(\"c\");\n@@ -87,0 +73,12 @@\n+    public static void main(String[] args) throws Exception {\n+        List<String> compilers = java.util.Arrays.asList(\"-XX:-TieredCompilation\" \/* C2 *\/,\n+            \"-XX:TieredStopAtLevel=1\" \/* C1 *\/);\n+        List<String> tests = java.util.Arrays.asList(\"StaticMethodTest\",\n+            \"FinalClassTest\", \"FinalMethodTest\");\n+        for (String compiler : compilers) {\n+            for (String test : tests) {\n+                runTest(compiler, test);\n+            }\n+        }\n+    }\n+\n@@ -138,2 +136,2 @@\n-        static void test(int i, String[] args) {\n-            if (i % args.length == 0) {\n+        static void test(int i) {\n+            if (i % 3 == 0) {\n@@ -149,2 +147,2 @@\n-            for (int i = 1; i < 50_000; ++i) {\n-                test(i, args);\n+            for (int i = 1; i < ITERATIONS_TO_HEAT_LOOP; ++i) {\n+                test(i);\n@@ -161,2 +159,2 @@\n-        void test(int i, String[] args) {\n-            if (i % args.length == 0) {\n+        void test(int i) {\n+            if (i % 3 == 0) {\n@@ -173,2 +171,2 @@\n-            for (int i = 1; i < 50_000; ++i) {\n-                tFC.test(i,args);\n+            for (int i = 1; i < ITERATIONS_TO_HEAT_LOOP; ++i) {\n+                tFC.test(i);\n@@ -185,2 +183,2 @@\n-        void test(int i, String[] args) {\n-            if (i % args.length == 0) {\n+        void test(int i) {\n+            if (i % 3 == 0) {\n@@ -197,2 +195,2 @@\n-            for (int i = 1; i < 50_000; ++i) {\n-                tFM.test(i,args);\n+            for (int i = 1; i < ITERATIONS_TO_HEAT_LOOP; ++i) {\n+                tFM.test(i);\n","filename":"test\/hotspot\/jtreg\/compiler\/sharedstubs\/SharedStubToInterpTest.java","additions":31,"deletions":33,"binary":false,"changes":64,"status":"modified"}]}