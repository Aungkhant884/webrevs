{"files":[{"patch":"@@ -169,1 +169,0 @@\n-                    barrier.check(); \/\/ block if recording is being stopped\n@@ -172,4 +171,0 @@\n-                    long endMillis = Instant.ofEpochSecond(0, endNanos).toEpochMilli();\n-                    if (barrier.getStreamEnd() <= endMillis) {\n-                        return;\n-                    }\n@@ -180,1 +175,9 @@\n-                if (isLastChunk()) {\n+                long endNanos = currentParser.getStartNanos() + currentParser.getChunkDuration();\n+                long endMillis = Instant.ofEpochSecond(0, endNanos).toEpochMilli();\n+\n+                barrier.check(); \/\/ block if recording is being stopped\n+                if (barrier.getStreamEnd() <= endMillis) {\n+                    return;\n+                }\n+\n+                if (!barrier.hasStreamEnd() && isLastChunk()) {\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/consumer\/EventDirectoryStream.java","additions":9,"deletions":6,"binary":false,"changes":15,"status":"modified"},{"patch":"@@ -65,0 +65,4 @@\n+    public synchronized boolean hasStreamEnd() {\n+        return end != Long.MAX_VALUE;\n+    }\n+\n","filename":"src\/jdk.jfr\/share\/classes\/jdk\/jfr\/internal\/management\/StreamBarrier.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -752,1 +752,0 @@\n-jdk\/jfr\/api\/consumer\/recordingstream\/TestStop.java              8298043 generic-all\n","filename":"test\/jdk\/ProblemList.txt","additions":0,"deletions":1,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -152,1 +152,1 @@\n-                if (outerCount.get() == 3) {\n+                if (outerCount.get() != 3) {\n","filename":"test\/jdk\/jdk\/jfr\/api\/consumer\/recordingstream\/TestStop.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -161,1 +161,1 @@\n-                if (outerCount.get() == 3) {\n+                if (outerCount.get() != 3) {\n","filename":"test\/jdk\/jdk\/jfr\/jmx\/streaming\/TestStop.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}