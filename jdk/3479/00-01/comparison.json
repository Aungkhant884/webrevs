{"files":[{"patch":"@@ -288,2 +288,0 @@\n-    \/\/ Bytecodes for shared old classes can be verified because they have\n-    \/\/ not been rewritten.\n@@ -291,0 +289,2 @@\n+    \/\/ However, bytecodes for shared old classes can be verified because\n+    \/\/ they have not been rewritten.\n","filename":"src\/hotspot\/share\/classfile\/verifier.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -573,0 +573,1 @@\n+    assert(MetaspaceShared::is_old_class(klass), \"only shared old classes aren't rewritten\");\n","filename":"src\/hotspot\/share\/interpreter\/rewriter.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -604,0 +604,4 @@\n+  bool is_old = is_old_class(ik);\n+  if (is_old) {\n+    ik->set_is_shared_old_klass();\n+  }\n@@ -606,1 +610,1 @@\n-  return DumpSharedSpaces ? !is_old_class(ik) : !ik->is_shared_unregistered_class();\n+  return DumpSharedSpaces ? !is_old : !ik->is_shared_unregistered_class();\n","filename":"src\/hotspot\/share\/memory\/metaspaceShared.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -141,5 +141,1 @@\n-  if (!pool_holder()->is_rewritten()) {\n-    it->push(&_cache, MetaspaceClosure::_writable);\n-  } else {\n-    it->push(&_cache);\n-  }\n+  it->push(&_cache);\n@@ -360,1 +356,1 @@\n-  if (!_pool_holder->is_linked() && MetaspaceShared::is_old_class(_pool_holder)) {\n+  if (!_pool_holder->is_linked() && !_pool_holder->is_rewritten()) {\n@@ -400,1 +396,1 @@\n-  if (!_pool_holder->is_linked() && MetaspaceShared::is_old_class(_pool_holder)) {\n+  if (!_pool_holder->is_linked() && _pool_holder->is_shared_old_klass()) {\n","filename":"src\/hotspot\/share\/oops\/constantPool.cpp","additions":3,"deletions":7,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -180,1 +180,2 @@\n-    _has_value_based_class_annotation = 4\n+    _has_value_based_class_annotation = 4,\n+    _is_shared_old_klass = 8\n@@ -336,0 +337,8 @@\n+  void set_is_shared_old_klass() {\n+    CDS_ONLY(_shared_class_flags |= _is_shared_old_klass;)\n+  }\n+  bool is_shared_old_klass() const {\n+    CDS_ONLY(return (_shared_class_flags & _is_shared_old_klass) != 0;)\n+    NOT_CDS(return false;)\n+  }\n+\n","filename":"src\/hotspot\/share\/oops\/klass.hpp","additions":10,"deletions":1,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -54,1 +54,1 @@\n-  return _klass->is_shared() && !MetaspaceShared::remapped_readwrite() && !MetaspaceShared::is_old_class(ik());\n+  return _klass->is_shared() && !MetaspaceShared::remapped_readwrite() && !_klass->is_shared_old_klass();\n","filename":"src\/hotspot\/share\/oops\/klassVtable.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -367,1 +367,1 @@\n-  if (is_shared() && !MetaspaceShared::remapped_readwrite() && !MetaspaceShared::is_old_class(method_holder())) {\n+  if (is_shared() && !MetaspaceShared::remapped_readwrite() && !method_holder()->is_shared_old_klass()) {\n@@ -378,1 +378,1 @@\n-  if (is_shared() && !MetaspaceShared::remapped_readwrite() && !MetaspaceShared::is_old_class(method_holder())) {\n+  if (is_shared() && !MetaspaceShared::remapped_readwrite() && !method_holder()->is_shared_old_klass()) {\n","filename":"src\/hotspot\/share\/oops\/method.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}