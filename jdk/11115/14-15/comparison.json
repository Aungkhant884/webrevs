{"files":[{"patch":"@@ -103,0 +103,2 @@\n+extern int snprintf_checked(char* buf, size_t len, const char* fmt, ...);\n+\n","filename":"src\/hotspot\/share\/adlc\/adlc.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -216,1 +216,1 @@\n-          snprintf(buf, buf_size, \"%s_%d\", instr->_ident, match_rules_cnt++);\n+          snprintf_checked(buf, buf_size, \"%s_%d\", instr->_ident, match_rules_cnt++);\n@@ -261,1 +261,0 @@\n-\/\/assert(false, \"abort\");\n@@ -2883,1 +2882,1 @@\n-  snprintf(ec_name, ec_name_size, \"%s%s\", prefix, inst._ident);\n+  snprintf_checked(ec_name, ec_name_size, \"%s%s\", prefix, inst._ident);\n@@ -3355,1 +3354,1 @@\n-  snprintf(ec_name, ec_name_size, \"%s%s\", prefix, inst._ident);\n+  snprintf_checked(ec_name, ec_name_size, \"%s%s\", prefix, inst._ident);\n@@ -4676,1 +4675,1 @@\n-      snprintf(buf, buf_size, \"(%s)\", param);\n+      snprintf_checked(buf, buf_size, \"(%s)\", param);\n@@ -5285,1 +5284,1 @@\n-  snprintf(location, location_size, \"\\n#line %d \\\"%s\\\"\\n\", line, file);\n+  snprintf_checked(location, location_size, \"\\n#line %d \\\"%s\\\"\\n\", line, file);\n","filename":"src\/hotspot\/share\/adlc\/adlparse.cpp","additions":5,"deletions":6,"binary":false,"changes":11,"status":"modified"},{"patch":"@@ -818,1 +818,1 @@\n-    snprintf(regMask, length, \"%s%s()\", rc_name, mask);\n+    snprintf_checked(regMask, length, \"%s%s()\", rc_name, mask);\n@@ -911,1 +911,1 @@\n-  snprintf(result, length, \"%s%s\", stack_or, reg_mask_name);\n+  snprintf_checked(result, length, \"%s%s\", stack_or, reg_mask_name);\n","filename":"src\/hotspot\/share\/adlc\/archDesc.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -215,1 +215,1 @@\n-    snprintf(Expr::buffer(), STRING_BUFFER_LENGTH, \"_kids[0]->_cost[%s]\", lchild_to_upper);\n+    snprintf_checked(Expr::buffer(), STRING_BUFFER_LENGTH, \"_kids[0]->_cost[%s]\", lchild_to_upper);\n@@ -221,1 +221,1 @@\n-    snprintf(Expr::buffer(), STRING_BUFFER_LENGTH, \"_kids[1]->_cost[%s]\", rchild_to_upper);\n+    snprintf_checked(Expr::buffer(), STRING_BUFFER_LENGTH, \"_kids[1]->_cost[%s]\", rchild_to_upper);\n@@ -760,1 +760,1 @@\n-    snprintf(string_buffer, STRING_BUFFER_LENGTH, \"0\");\n+    snprintf_checked(string_buffer, STRING_BUFFER_LENGTH, \"0\");\n","filename":"src\/hotspot\/share\/adlc\/dfa.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -1538,1 +1538,1 @@\n-      snprintf(s, remaining_buflen(buf, s), \"\/*%s*\/(\",(char*)i._key);\n+      snprintf_checked(s, remaining_buflen(buf, s), \"\/*%s*\/(\",(char*)i._key);\n@@ -3477,1 +3477,1 @@\n-  snprintf(subtree, len, \"_%s_%s_%s\", _opType, lstr, rstr);\n+  snprintf_checked(subtree, len, \"_%s_%s_%s\", _opType, lstr, rstr);\n@@ -3926,1 +3926,1 @@\n-  snprintf(buf, buf_size, \"%s_%d\", instr_ident, match_rules_cnt++);\n+  snprintf_checked(buf, buf_size, \"%s_%d\", instr_ident, match_rules_cnt++);\n","filename":"src\/hotspot\/share\/adlc\/formssel.cpp","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -469,1 +469,1 @@\n-  snprintf(fname,len,\"%s%s\",base,suffix);\n+  snprintf_checked(fname,len,\"%s%s\",base,suffix);\n","filename":"src\/hotspot\/share\/adlc\/main.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -40,0 +40,10 @@\n+int snprintf_checked(char* buf, size_t len, const char* fmt, ...) {\n+  va_list args;\n+  va_start(args, fmt);\n+  int result = vsnprintf(buf, len, fmt, args);\n+  va_end(args);\n+  assert(result >= 0, \"snprintf error\");\n+  assert(static_cast<size_t>(result) < len, \"snprintf truncated\");\n+  return result;\n+}\n+\n@@ -217,1 +227,1 @@\n-    templen += snprintf(&operand_stages[templen], operand_stages_size - templen, \"  stage_%s%c\\n\",\n+    templen += snprintf_checked(&operand_stages[templen], operand_stages_size - templen, \"  stage_%s%c\\n\",\n@@ -292,1 +302,1 @@\n-    templen += snprintf(&resource_stages[templen], resource_stages_size - templen, \"  stage_%s%-*s \/\/ %s\\n\",\n+    templen += snprintf_checked(&resource_stages[templen], resource_stages_size - templen, \"  stage_%s%-*s \/\/ %s\\n\",\n@@ -351,1 +361,1 @@\n-    templen = snprintf(temp, sizeof(temp), \"%d\", res_cycles[i]);\n+    templen = snprintf_checked(temp, sizeof(temp), \"%d\", res_cycles[i]);\n@@ -366,1 +376,1 @@\n-    templen += snprintf(&resource_cycles[templen], resource_cycles_size - templen, \"  %*d%c \/\/ %s\\n\",\n+    templen += snprintf_checked(&resource_cycles[templen], resource_cycles_size - templen, \"  %*d%c \/\/ %s\\n\",\n@@ -465,1 +475,1 @@\n-      snprintf(&resource_mask[templen], resource_mask_size - templen, \"  %s(0x%0*x, %*d, %*d, %s %s(\",\n+      snprintf_checked(&resource_mask[templen], resource_mask_size - templen, \"  %s(0x%0*x, %*d, %*d, %s %s(\",\n@@ -505,1 +515,1 @@\n-        snprintf(&resource_mask[templen], resource_mask_size - templen, \"0x%08x%s\", res_mask[j], j > 0 ? \", \" : \"\");\n+        snprintf_checked(&resource_mask[templen], resource_mask_size - templen, \"0x%08x%s\", res_mask[j], j > 0 ? \", \" : \"\");\n@@ -536,1 +546,1 @@\n-    snprintf(args, 37, \"0x%x, 0x%x, %u\",\n+    snprintf_checked(args, 37, \"0x%x, 0x%x, %u\",\n@@ -1074,1 +1084,1 @@\n-        snprintf(inst_prefix, sizeof(inst_prefix), \"inst%d_\",   inst_position);\n+        snprintf_checked(inst_prefix, sizeof(inst_prefix), \"inst%d_\",   inst_position);\n@@ -1076,1 +1086,1 @@\n-        snprintf(receiver, sizeof(receiver), \"inst%d->\", inst_position);\n+        snprintf_checked(receiver, sizeof(receiver), \"inst%d->\", inst_position);\n@@ -1170,1 +1180,1 @@\n-          snprintf(left_reg_index, sizeof(left_reg_index), \",inst%u_idx%u\", (unsigned)left_index, (unsigned)left_op_index);\n+          snprintf_checked(left_reg_index, sizeof(left_reg_index), \",inst%u_idx%u\", (unsigned)left_index, (unsigned)left_op_index);\n@@ -1182,1 +1192,1 @@\n-            snprintf(right_reg_index, sizeof(right_reg_index), \",inst%u_idx%u\", (unsigned)right_index, (unsigned)right_op_index);\n+            snprintf_checked(right_reg_index, sizeof(right_reg_index), \",inst%u_idx%u\", (unsigned)right_index, (unsigned)right_op_index);\n@@ -2571,1 +2581,1 @@\n-      ib += snprintf(ib, remaining_buflen(idxbuf, ib), \"  unsigned idx_%-5s = mach_constant_base_node_input(); \\t\/\/ %s, \\t%s\\n\",\n+      ib += snprintf_checked(ib, remaining_buflen(idxbuf, ib), \"  unsigned idx_%-5s = mach_constant_base_node_input(); \\t\/\/ %s, \\t%s\\n\",\n@@ -2573,1 +2583,1 @@\n-      nb += snprintf(nb, remaining_buflen(nbuf, nb), \"  Node    *n_%-7s = lookup(idx_%s);\\n\", name, name);\n+      nb += snprintf_checked(nb, remaining_buflen(nbuf, nb), \"  Node    *n_%-7s = lookup(idx_%s);\\n\", name, name);\n@@ -2580,1 +2590,1 @@\n-      ib += snprintf(ib, remaining_buflen(idxbuf, ib), \"  unsigned idx_%-5s = idx%d; \\t\/\/ %s, \\t%s\\n\",\n+      ib += snprintf_checked(ib, remaining_buflen(idxbuf, ib), \"  unsigned idx_%-5s = idx%d; \\t\/\/ %s, \\t%s\\n\",\n@@ -2582,2 +2592,2 @@\n-      nb += snprintf(nb, remaining_buflen(nbuf, nb), \"  Node    *n_%-7s = lookup(idx_%s);\\n\", name, name);\n-      ob += snprintf(ob, remaining_buflen(opbuf, ob), \"  %sOper *op_%s = (%sOper *)opnd_array(%d);\\n\", type, name, type, idx);\n+      nb += snprintf_checked(nb, remaining_buflen(nbuf, nb), \"  Node    *n_%-7s = lookup(idx_%s);\\n\", name, name);\n+      ob += snprintf_checked(ob, remaining_buflen(opbuf, ob), \"  %sOper *op_%s = (%sOper *)opnd_array(%d);\\n\", type, name, type, idx);\n","filename":"src\/hotspot\/share\/adlc\/output_c.cpp","additions":26,"deletions":16,"binary":false,"changes":42,"status":"modified"}]}