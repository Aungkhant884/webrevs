{"files":[{"patch":"@@ -110,0 +110,18 @@\n+void BarrierSetAssembler::resolve_jobject(MacroAssembler* masm, Register value, Register tmp1, Register tmp2) {\n+  NearLabel Ldone;\n+  __ z_ltgr(tmp1, value);\n+  __ z_bre(Ldone);          \/\/ Use NULL result as-is.\n+\n+  __ z_nill(value, ~JNIHandles::weak_tag_mask);\n+  __ z_lg(value, 0, value); \/\/ Resolve (untagged) jobject.\n+\n+  __ verify_oop(value, FILE_AND_LINE);\n+  __ bind(Ldone);\n+}\n+\n+void BarrierSetAssembler::try_resolve_jobject_in_native(MacroAssembler* masm, Register jni_env,\n+                                                        Register obj, Register tmp, Label& slowpath) {\n+  __ z_nill(obj, ~JNIHandles::weak_tag_mask);\n+  __ z_lg(obj, 0, obj); \/\/ Resolve (untagged) jobject.\n+}\n+\n@@ -160,1 +178,1 @@\n-  __ resolve_weak_handle(\/*TODO*\/);\n+  __ resolve_weak_handle(Z_R1_scratch, Z_R0_scratch, Z_R2);\n@@ -173,18 +191,0 @@\n-\n-void BarrierSetAssembler::resolve_jobject(MacroAssembler* masm, Register value, Register tmp1, Register tmp2) {\n-  NearLabel Ldone;\n-  __ z_ltgr(tmp1, value);\n-  __ z_bre(Ldone);          \/\/ Use NULL result as-is.\n-\n-  __ z_nill(value, ~JNIHandles::weak_tag_mask);\n-  __ z_lg(value, 0, value); \/\/ Resolve (untagged) jobject.\n-\n-  __ verify_oop(value, FILE_AND_LINE);\n-  __ bind(Ldone);\n-}\n-\n-void BarrierSetAssembler::try_resolve_jobject_in_native(MacroAssembler* masm, Register jni_env,\n-                                                        Register obj, Register tmp, Label& slowpath) {\n-  __ z_nill(obj, ~JNIHandles::weak_tag_mask);\n-  __ z_lg(obj, 0, obj); \/\/ Resolve (untagged) jobject.\n-}\n","filename":"src\/hotspot\/cpu\/s390\/gc\/shared\/barrierSetAssembler_s390.cpp","additions":19,"deletions":19,"binary":false,"changes":38,"status":"modified"},{"patch":"@@ -4191,3 +4191,9 @@\n-void resolve_weak_handle(Register result, Register tmp1, Register tmp2,\n-                         DecoratorSet decorators) {\n-  \/\/ TODO\n+void resolve_weak_handle(Register result, Register tmp1, Register tmp2) {\n+  Label resolved;\n+\n+  \/\/ A null weak handle resolves to null.\n+  z_cfi(result, 0);\n+  z_bre(resolved);\n+\n+  access_load_at(T_OBJECT, IN_NATIVE | ON_PHANTOM_OOP_REF, result, noreg, result, tmp1, tmp2);\n+  bind(resolved);\n","filename":"src\/hotspot\/cpu\/s390\/macroAssembler_s390.cpp","additions":9,"deletions":3,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -814,2 +814,1 @@\n-  void resolve_weak_handle(Register result, Register tmp1, Register tmp2,\n-                           DecoratorSet decorators);\n+  void resolve_weak_handle(Register result, Register tmp1, Register tmp2);\n","filename":"src\/hotspot\/cpu\/s390\/macroAssembler_s390.hpp","additions":1,"deletions":2,"binary":false,"changes":3,"status":"modified"}]}