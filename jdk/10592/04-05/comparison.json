{"files":[{"patch":"@@ -26,0 +26,4 @@\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestInstance;\n@@ -29,1 +33,0 @@\n-import java.io.InputStream;\n@@ -35,1 +38,0 @@\n-import org.junit.jupiter.api.Test;\n@@ -50,0 +52,1 @@\n+@TestInstance(TestInstance.Lifecycle.PER_CLASS)\n@@ -52,0 +55,17 @@\n+    Http2TestServer server;\n+    int port;\n+    SSLContext sslContext;\n+\n+    @BeforeAll\n+    void before() throws Exception {\n+        sslContext = new SimpleSSLContext().get();\n+        server = createServer(sslContext);\n+        port = server.getAddress().getPort();\n+        server.start();\n+    }\n+\n+    @AfterAll\n+    void after() throws Exception {\n+        server.close();\n+    }\n+\n@@ -55,8 +75,2 @@\n-            InputStream is = e.getRequestBody();\n-            StringBuilder sb = new StringBuilder();\n-            for (int ch; (ch = is.read()) != -1; ) {\n-                sb.append((char) ch);\n-            }\n-            is.readAllBytes();\n-            is.close();\n-            if (e.getRequestURI().getAuthority().contains(\"user@\")) {\n+            String authorityHeader = e.getRequestHeaders().firstValue(\":authority\").orElse(null);\n+            if (authorityHeader == null || authorityHeader.contains(\"user@\")) {\n@@ -78,7 +92,1 @@\n-    public void main() throws Exception {\n-        SSLContext sslContext = new SimpleSSLContext().get();\n-        Http2TestServer server = createServer(sslContext);\n-        int port = server.getAddress().getPort();\n-\n-        server.start();\n-\n+    public void testAuthorityHeader() throws Exception {\n@@ -103,2 +111,1 @@\n-        try {\n-            HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());\n+        HttpResponse<String> response = client.send(request, HttpResponse.BodyHandlers.ofString());\n@@ -106,4 +113,1 @@\n-            assertEquals(200, response.statusCode(), \"Test Failed : \" + response.uri().getAuthority());\n-        } finally {\n-            server.stop();\n-        }\n+        assertEquals(200, response.statusCode(), \"Test Failed : \" + response.uri().getAuthority());\n","filename":"test\/jdk\/java\/net\/httpclient\/http2\/UserInfoTest.java","additions":27,"deletions":23,"binary":false,"changes":50,"status":"modified"}]}