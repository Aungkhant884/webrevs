{"files":[{"patch":"@@ -227,1 +227,1 @@\n-\t<LI><P><B>{@systemProperty http.auth.digest.reEnabledAlgs}<\/B> (default: &lt;none&gt;)<BR>\n+\t<LI><P><B>{@systemProperty http.auth.digest.enabledAlgorithms}<\/B> (default: &lt;none&gt;)<BR>\n@@ -229,4 +229,6 @@\n-        authentication due to their proven security limitations. Currently, this list only\n-        includes {@code MD5} but other algorithms may be added in future. If it is still\n-        required to use one of these algorithms, then they can be re-enabled by setting\n-        this property to a comma separated list of the algorithm names.<\/P>\n+        authentication due to their proven security limitations. This only applies to proxy\n+        authentication and plain-text HTTP server authentication. Disabled algorithms are still\n+        usable for HTTPS server authentication. The default list of disabled algorithms is specified\n+        in the {@code java.security} properties file and currently comprises {@code MD5} and\n+        {@code SHA-1}. If it is still required to use one of these algorithms, then they can be\n+        re-enabled by setting this property to a comma separated list of the algorithm names.<\/P>\n","filename":"src\/java.base\/share\/classes\/java\/net\/doc-files\/net-properties.html","additions":7,"deletions":5,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -32,0 +32,2 @@\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n@@ -36,0 +38,2 @@\n+import java.security.Security;\n+import java.text.Normalizer;\n@@ -37,0 +41,1 @@\n+import java.util.Collections;\n@@ -44,1 +49,0 @@\n-import sun.nio.cs.ISO_8859_1;\n@@ -63,0 +67,3 @@\n+    private static final String secPropName =\n+        \"jdk.httpdigest.defaultDisabledAlgorithms\";\n+\n@@ -69,3 +76,20 @@\n-    \/\/ This will probably be expanded to include SHA-1 eventually\n-    private static final Set<String> defDisabledAlgs =\n-        Set.of(\"MD5\");\n+    private static final Set<String> defDisabledAlgs = getDefaultAlgs();\n+\n+    private static Set<String> getDefaultAlgs() {\n+        Set<String> disabledAlgs = new HashSet<>();\n+        @SuppressWarnings(\"removal\")\n+        String secprops = AccessController.doPrivileged(\n+            new PrivilegedAction<>() {\n+                public String run() {\n+                    return Security.getProperty(secPropName)\n+                                   .replaceAll(\"\\\\s\", \"\")\n+                                   .toUpperCase();\n+                }\n+            }\n+        );\n+        String[] algorithms = secprops.split(\",\");\n+        for (String algorithm : algorithms) {\n+            disabledAlgs.add(algorithm);\n+        }\n+        return Collections.unmodifiableSet(disabledAlgs);\n+    }\n@@ -74,2 +98,2 @@\n-    private static final String enabledAlgPropName = \"http.auth.digest.\" +\n-        \"reEnabledAlgs\";\n+    private static final String enabledAlgPropName =\n+        \"http.auth.digest.enabledAlgorithms\";\n@@ -87,1 +111,1 @@\n-        boolean flag = AccessController.doPrivileged(\n+        Boolean b = AccessController.doPrivileged(\n@@ -90,2 +114,1 @@\n-                    Boolean b = NetProperties.getBoolean(compatPropName);\n-                    return (b == null) ? false : b.booleanValue();\n+                    return NetProperties.getBoolean(compatPropName);\n@@ -95,1 +118,1 @@\n-        delimCompatFlag = flag;\n+        delimCompatFlag = (b == null) ? false : b.booleanValue();\n@@ -103,1 +126,2 @@\n-                    return s == null ? \"\" : s;\n+                    return s == null\n+                        ? \"\" : s.replaceAll(\"\\\\s\", \"\").toUpperCase();\n@@ -127,0 +151,1 @@\n+        private String charset;\n@@ -157,0 +182,1 @@\n+            charset = null;\n@@ -201,0 +227,11 @@\n+\n+        synchronized Charset getCharset() {\n+            return \"UTF-8\".equals(charset)\n+                ? StandardCharsets.UTF_8\n+                : StandardCharsets.ISO_8859_1;\n+        }\n+\n+        synchronized void setCharset(String charset) {\n+            this.charset = charset;\n+        }\n+\n@@ -241,5 +278,1 @@\n-\n-        synchronized void setAlgorithm (String s) {\n-            algorithm = s;\n-        }\n-\n+        synchronized void setAlgorithm (String s) { algorithm=s;}\n@@ -364,0 +397,1 @@\n+        params.setCharset(p.findValue(\"charset\", \"ISO_8859_1\").toUpperCase());\n@@ -392,0 +426,1 @@\n+        algorithm = algorithm.toUpperCase();\n@@ -422,0 +457,6 @@\n+        try {\n+            validateAlgorithm(algorithm);\n+        } catch (IOException e) {\n+            return null;\n+        }\n+        Charset charset = params.getCharset();\n@@ -434,1 +475,1 @@\n-        boolean session = algorithm.endsWith (\"-sess\");\n+        boolean session = algorithm.endsWith (\"-SESS\");\n@@ -439,8 +480,0 @@\n-        try {\n-            validateAlgorithm(algorithm);\n-        } catch (IOException e) {\n-            \/\/ should not happen since the algorithm has already been\n-            \/\/ validated\n-            return null;\n-        }\n-\n@@ -450,1 +483,1 @@\n-                                        algorithm, session);\n+                                        algorithm, session, charset);\n@@ -476,1 +509,1 @@\n-                user = computeUserhash(algorithm, user, realm);\n+                user = computeUserhash(algorithm, user, realm, charset);\n@@ -523,1 +556,1 @@\n-                     \"the \\\"http.auth.digest.enabledDigestAlgs\\\" system property.\");\n+                     \"the \\\"http.auth.digest.enabledAlgorithms\\\" system property.\");\n@@ -538,0 +571,2 @@\n+        Charset charset = params.getCharset();\n+        validateAlgorithm(algorithm);\n@@ -545,1 +580,1 @@\n-        boolean session = algorithm.endsWith (\"-sess\");\n+        boolean session = algorithm.endsWith (\"-SESS\");\n@@ -549,1 +584,0 @@\n-        validateAlgorithm(algorithm);\n@@ -559,1 +593,2 @@\n-                                           nonce, cnonce, ncstring, algorithm, session);\n+                                           nonce, cnonce, ncstring, algorithm,\n+                                           session, charset);\n@@ -579,1 +614,2 @@\n-    private String computeUserhash(String algorithm, String user, String realm)\n+    private String computeUserhash(String algorithm, String user,\n+                                   String realm, Charset charset)\n@@ -582,2 +618,0 @@\n-        boolean truncate256 = false;\n-\n@@ -585,2 +619,1 @@\n-            algorithm = \"SHA-512\";\n-            truncate256 = true;\n+            algorithm = \"SHA-512\/256\";\n@@ -590,1 +623,1 @@\n-        return encode(s, null, md, truncate256);\n+        return encode(s, null, md, charset);\n@@ -598,1 +631,2 @@\n-                        String algorithm, boolean session\n+                        String algorithm, boolean session,\n+                        Charset charset\n@@ -603,1 +637,0 @@\n-        boolean truncate256 = false;\n@@ -606,2 +639,1 @@\n-            algorithm = \"SHA-512\";\n-            truncate256 = true;\n+            algorithm = \"SHA-512\/256\";\n@@ -614,1 +646,1 @@\n-                String s1 = encode (s, password, md, truncate256);\n+                String s1 = encode (s, password, md, charset);\n@@ -616,1 +648,1 @@\n-                HashA1 = encode(A1, null, md, truncate256);\n+                HashA1 = encode(A1, null, md, charset);\n@@ -621,1 +653,1 @@\n-            HashA1 = encode(A1, password, md, truncate256);\n+            HashA1 = encode(A1, password, md, charset);\n@@ -630,1 +662,1 @@\n-        String HashA2 = encode(A2, null, md, truncate256);\n+        String HashA2 = encode(A2, null, md, charset);\n@@ -642,1 +674,1 @@\n-        finalHash = encode(combo, null, md, truncate256);\n+        finalHash = encode(combo, null, md, charset);\n@@ -656,3 +688,5 @@\n-    \/\/ truncate256 means only use the last 256 bits of the digest (32 bytes)\n-    private String encode(String src, char[] passwd, MessageDigest md, boolean truncate256) {\n-        md.update(src.getBytes(ISO_8859_1.INSTANCE));\n+    private String encode(String src, char[] passwd, MessageDigest md, Charset charset) {\n+        if (charset.equals(StandardCharsets.UTF_8)) {\n+            src = Normalizer.normalize(src, Normalizer.Form.NFC);\n+        }\n+        md.update(src.getBytes(charset));\n@@ -667,6 +701,0 @@\n-        int start = 0;\n-        if (truncate256) {\n-            assert digest.length >= 32;\n-            start = digest.length - 32;\n-        }\n-\n@@ -674,1 +702,1 @@\n-        for (int i = start; i < digest.length; i++) {\n+        for (int i = 0; i < digest.length; i++) {\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/DigestAuthentication.java","additions":84,"deletions":56,"binary":false,"changes":140,"status":"modified"},{"patch":"@@ -704,0 +704,10 @@\n+#\n+# Disabled (by default) message digest algorithms for use with\n+# HTTP Digest authentication (java.net.HttpURLConnection)\n+# This may be overridden by setting the networking (or system)\n+# property \"http.auth.digest.enabledAlgorithms\" to a comma\n+# separated list of algorithms to be allowed.\n+#\n+jdk.httpdigest.defaultDisabledAlgorithms = MD5, MD-5, SHA1, SHA-1\n+\n+\n","filename":"src\/java.base\/share\/conf\/security\/java.security","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 B4722333\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 B4722333\n","filename":"test\/jdk\/java\/net\/Authenticator\/B4722333.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,2 +28,2 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 B4759514\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 -Djava.net.preferIPv6Addresses=true B4759514\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 B4759514\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 -Djava.net.preferIPv6Addresses=true B4759514\n","filename":"test\/jdk\/java\/net\/Authenticator\/B4759514.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n@@ -30,1 +30,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n","filename":"test\/jdk\/java\/net\/Authenticator\/B6870935.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -34,2 +34,2 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 B8034170 unquoted\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 B8034170 unquoted\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n@@ -37,1 +37,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n","filename":"test\/jdk\/java\/net\/Authenticator\/B8034170.java","additions":3,"deletions":3,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -66,4 +66,4 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPSetAuthenticatorTest DIGEST SERVER\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPSetAuthenticatorTest DIGEST PROXY\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPSetAuthenticatorTest DIGEST PROXY305\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPSetAuthenticatorTest DIGEST SERVER307\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST SERVER\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST PROXY\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST PROXY305\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST SERVER307\n","filename":"test\/jdk\/java\/net\/HttpURLConnection\/SetAuthenticator\/HTTPSetAuthenticatorTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -66,4 +66,4 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPTest SERVER\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPTest PROXY\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPTest SERVER307\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 HTTPTest PROXY305\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPTest SERVER\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPTest PROXY\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPTest SERVER307\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 HTTPTest PROXY305\n","filename":"test\/jdk\/java\/net\/HttpURLConnection\/SetAuthenticator\/HTTPTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -50,3 +50,4 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth good\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth only_nonce\n- * @run main\/othervm DigestAuth sha1\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth good\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth only_nonce\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=SHA1 DigestAuth sha1-good\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth sha1-bad\n@@ -56,8 +57,7 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth sha1\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth sha256\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth no_header\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth no_nonce\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth no_qop\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth invalid_alg\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth validate_server\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 DigestAuth validate_server_no_qop\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth sha256\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth no_header\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth no_nonce\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth no_qop\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth invalid_alg\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth validate_server\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 DigestAuth validate_server_no_qop\n@@ -247,1 +247,1 @@\n-                case \"sha1\":\n+                case \"sha1-good\":\n@@ -252,0 +252,6 @@\n+                case \"sha1-bad\":\n+                    \/\/ server returns a WWW-Authenticate header with SHA-1\n+                    \/\/ but SHA-1 disabled\n+                    server.setWWWAuthHeader(WWW_AUTH_HEADER_SHA1);\n+                    success = testAuth(url, auth, EXPECT_FAILURE);\n+                    break;\n","filename":"test\/jdk\/sun\/net\/www\/http\/HttpURLConnection\/DigestAuth.java","additions":18,"deletions":12,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -28,1 +28,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n@@ -30,1 +30,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n@@ -33,1 +33,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n@@ -36,1 +36,1 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/http\/DigestTest.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -30,2 +30,2 @@\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5 NoNTLM\n- * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgs=MD5\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5 NoNTLM\n+ * @run main\/othervm -Dhttp.auth.digest.enabledAlgorithms=MD5\n","filename":"test\/jdk\/sun\/net\/www\/protocol\/http\/NoNTLM.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"}]}