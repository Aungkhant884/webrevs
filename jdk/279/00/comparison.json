{"files":[{"patch":"@@ -37,0 +37,6 @@\n+template <typename T, ENABLE_IF(std::is_integral<T>::value)>\n+constexpr T max_power_of_2() {\n+  T max_val = std::numeric_limits<T>::max();\n+  return max_val - (max_val >> 1);\n+}\n+\n@@ -74,2 +80,1 @@\n-  const T max_value = std::numeric_limits<T>::max();\n-  assert(value <= (max_value - (max_value >> 1)), \"Overflow\");\n+  assert(value <= max_power_of_2<T>(), \"Overflow\");\n","filename":"src\/hotspot\/share\/utilities\/powerOfTwo.hpp","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -32,5 +32,0 @@\n-template <typename T> static constexpr T max_pow2() {\n-  T max_val = std::numeric_limits<T>::max();\n-  return max_val - (max_val >> 1);\n-}\n-\n@@ -63,1 +58,1 @@\n-    = static_test_is_power_of_2_aux(max_pow2<T>());\n+    = static_test_is_power_of_2_aux(max_power_of_2<T>());\n@@ -81,1 +76,1 @@\n-  for (T i = max_pow2<T>(); i > 0; i = (i >> 1)) {\n+  for (T i = max_power_of_2<T>(); i > 0; i = (i >> 1)) {\n@@ -86,1 +81,1 @@\n-  for (T i = max_pow2<T>(); i > 2; i = (i >> 1)) {\n+  for (T i = max_power_of_2<T>(); i > 2; i = (i >> 1)) {\n@@ -91,1 +86,1 @@\n-  for (T i = max_pow2<T>(); i > 1; i = (i >> 1)) {\n+  for (T i = max_power_of_2<T>(); i > 1; i = (i >> 1)) {\n@@ -143,1 +138,1 @@\n-  T t_max_pow2 = max_pow2<T>();\n+  T t_max_pow2 = max_power_of_2<T>();\n@@ -186,1 +181,1 @@\n-  T t_max_pow2 = max_pow2<T>();\n+  T t_max_pow2 = max_power_of_2<T>();\n@@ -232,1 +227,1 @@\n-  T t_max_pow2 = max_pow2<T>();\n+  T t_max_pow2 = max_power_of_2<T>();\n@@ -259,0 +254,11 @@\n+\n+TEST(power_of_2, max) {\n+  EXPECT_EQ(max_power_of_2<int8_t>(),  0x40);\n+  EXPECT_EQ(max_power_of_2<int16_t>(), 0x4000);\n+  EXPECT_EQ(max_power_of_2<int32_t>(), 0x40000000);\n+  EXPECT_EQ(max_power_of_2<int64_t>(), CONST64(0x4000000000000000));\n+  EXPECT_EQ(max_power_of_2<uint8_t>(),  0x80u);\n+  EXPECT_EQ(max_power_of_2<uint16_t>(), 0x8000u);\n+  EXPECT_EQ(max_power_of_2<uint32_t>(), 0x80000000u);\n+  EXPECT_EQ(max_power_of_2<uint64_t>(), UCONST64(0x8000000000000000));\n+}\n","filename":"test\/hotspot\/gtest\/utilities\/test_powerOfTwo.cpp","additions":18,"deletions":12,"binary":false,"changes":30,"status":"modified"}]}