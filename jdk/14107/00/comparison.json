{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2011, 2020, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2011, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -39,0 +39,2 @@\n+\n+#include \"management_ext.h\"\n@@ -334,0 +336,20 @@\n+static long read_vmem_usage(const char *procfile, unsigned long *vsize) {\n+    int n = read_statdata(procfile, \"%*c %*d %*d %*d %*d %*d %*u %*u %*u %*u %*u %*d %*d %*d %*d %*d %*d %*u %*u %*d %lu %*[^\\n]\\n\", vsize);\n+    if (n != 1) {\n+        return -1;\n+    } else {\n+        return *vsize;\n+    }\n+}\n+\n+JNIEXPORT jlong JNICALL\n+Java_com_sun_management_internal_OperatingSystemImpl_getCommittedVirtualMemorySize0\n+  (JNIEnv *env, jobject mbean)\n+{\n+    unsigned long vsize;\n+    if (read_vmem_usage(\"\/proc\/self\/stat\", &vsize) == -1) {\n+        throw_internal_error(env, \"Unable to get virtual memory usage\");\n+    }\n+    return (jlong) vsize;\n+}\n+\n","filename":"src\/jdk.management\/linux\/native\/libmanagement_ext\/UnixOperatingSystem.c","additions":23,"deletions":1,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -38,0 +38,7 @@\n+void throw_internal_error(JNIEnv* env, const char* msg) {\n+    char errmsg[128];\n+\n+    snprintf(errmsg, sizeof(errmsg), \"errno: %d error: %s\\n\", errno, msg);\n+    JNU_ThrowInternalError(env, errmsg);\n+}\n+\n","filename":"src\/jdk.management\/share\/native\/libmanagement_ext\/management_ext.c","additions":7,"deletions":0,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -40,0 +40,2 @@\n+void throw_internal_error(JNIEnv* env, const char* msg);\n+\n","filename":"src\/jdk.management\/share\/native\/libmanagement_ext\/management_ext.h","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -85,7 +85,0 @@\n-static void throw_internal_error(JNIEnv* env, const char* msg) {\n-    char errmsg[128];\n-\n-    snprintf(errmsg, sizeof(errmsg), \"errno: %d error: %s\\n\", errno, msg);\n-    JNU_ThrowInternalError(env, errmsg);\n-}\n-\n@@ -132,0 +125,2 @@\n+\/\/ Linux-specific implementation is in UnixOperatingSystem.c\n+#if !defined(__linux__)\n@@ -136,19 +131,1 @@\n-#if defined(__linux__)\n-    FILE *fp;\n-    unsigned long vsize = 0;\n-\n-    if ((fp = fopen(\"\/proc\/self\/stat\", \"r\")) == NULL) {\n-        throw_internal_error(env, \"Unable to open \/proc\/self\/stat\");\n-        return -1;\n-    }\n-\n-    \/\/ Ignore everything except the vsize entry\n-    if (fscanf(fp, \"%*d %*s %*c %*d %*d %*d %*d %*d %*u %*u %*u %*u %*u %*d %*d %*d %*d %*d %*d %*u %*u %*d %lu %*[^\\n]\\n\", &vsize) == EOF) {\n-        throw_internal_error(env, \"Unable to get virtual memory usage\");\n-        fclose(fp);\n-        return -1;\n-    }\n-\n-    fclose(fp);\n-    return (jlong)vsize;\n-#elif defined(__APPLE__)\n+#if defined(__APPLE__)\n@@ -171,0 +148,1 @@\n+#endif\n","filename":"src\/jdk.management\/unix\/native\/libmanagement_ext\/OperatingSystemImpl.c","additions":4,"deletions":26,"binary":false,"changes":30,"status":"modified"}]}