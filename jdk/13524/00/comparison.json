{"files":[{"patch":"@@ -96,4 +96,2 @@\n-\n-      if (written == sz * sizeof(char)) {\n-        return fclose(f) == 0;\n-      }\n+      \/\/ at least see \"header\"\n+      return fclose(f) == 0 && sz == written && sz >= 6;\n@@ -260,0 +258,1 @@\n+  fprintf(stdout, \"header\");\n@@ -266,1 +265,1 @@\n-  EXPECT_TRUE(write_to_file(testing::internal::GetCapturedStdout()));\n+  fflush(nullptr);\n@@ -268,3 +267,5 @@\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n+  if (write_to_file(testing::internal::GetCapturedStdout())) {\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"header\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n@@ -272,2 +273,3 @@\n-  if (AsyncLogWriter::instance() != nullptr) {\n-    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    if (AsyncLogWriter::instance() != nullptr) {\n+      EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    }\n@@ -279,0 +281,1 @@\n+  fprintf(stderr, \"header\");\n@@ -285,1 +288,1 @@\n-  EXPECT_TRUE(write_to_file(testing::internal::GetCapturedStderr()));\n+  fflush(nullptr);\n@@ -287,3 +290,5 @@\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n-  EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n+  if (write_to_file(testing::internal::GetCapturedStderr())) {\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"header\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"LogStreamWithAsyncLogImpl\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream msg1-msg2-msg3\"));\n+    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"logStream newline\"));\n@@ -291,2 +296,3 @@\n-  if (AsyncLogWriter::instance() != nullptr) {\n-    EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    if (AsyncLogWriter::instance() != nullptr) {\n+      EXPECT_TRUE(file_contains_substring(TestLogFileName, \"messages dropped due to async logging\"));\n+    }\n","filename":"test\/hotspot\/gtest\/logging\/test_asynclog.cpp","additions":22,"deletions":16,"binary":false,"changes":38,"status":"modified"}]}