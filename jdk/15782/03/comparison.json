{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,2 +46,5 @@\n-    Type type = db.lookupType(\"ObjectSynchronizer\");\n-    inUseList = type.getAddressField(\"_in_use_list\").getValue();\n+    Type objectSynchronizerType = db.lookupType(\"ObjectSynchronizer\");\n+    Type monitorListType = db.lookupType(\"MonitorList\");\n+    \/\/ Static fields will be left in the default initialized state if the lookup fails\n+    Address monitorListAddr = objectSynchronizerType.getField(\"_in_use_list\").getStaticFieldAddress();\n+    inUseListHead = monitorListType.getAddressField(\"_head\").getAddress(monitorListAddr);\n@@ -73,5 +76,1 @@\n-    if (inUseList != null) {\n-      return new ObjectMonitorIterator();\n-    } else {\n-      return null;\n-    }\n+    return new ObjectMonitorIterator();\n@@ -86,1 +85,1 @@\n-      mon = new ObjectMonitor(inUseList);\n+      mon = inUseListHead == null ? null : new ObjectMonitor(inUseListHead);\n@@ -90,1 +89,1 @@\n-      return (mon.nextOM() != null);\n+      return (mon != null);\n@@ -94,3 +93,2 @@\n-      \/\/ advance to next entry\n-      Address monAddr = mon.nextOM();\n-      if (monAddr == null) {\n+      ObjectMonitor ret = mon;\n+      if (ret == null) {\n@@ -99,2 +97,5 @@\n-      mon = new ObjectMonitor(monAddr);\n-      return mon;\n+      \/\/ advance to next entry\n+      Address nextMon = mon.nextOM();\n+      mon = nextMon == null ? null : new ObjectMonitor(nextMon);\n+\n+      return ret;\n@@ -110,1 +111,1 @@\n-  private static Address inUseList;\n+  private static Address inUseListHead;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/ObjectSynchronizer.java","additions":17,"deletions":16,"binary":false,"changes":33,"status":"modified"},{"patch":"@@ -97,5 +97,0 @@\n-    if (i == null) {\n-      tty.println(\"This version of HotSpot VM doesn't support monitor cache dump.\");\n-      tty.println(\"You need 1.4.0_04, 1.4.1_01 or later versions\");\n-      return;\n-    }\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/ui\/MonitorCacheDumpPanel.java","additions":0,"deletions":5,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -41,1 +41,1 @@\n- *             jdk.test.lib.apps.LingeredApp jdk.test.lib.apps.LingeredApp$1\n+ *             jdk.test.lib.apps.LingeredApp jdk.test.lib.apps.LingeredApp$1 jdk.test.lib.apps.LingeredApp$SteadyStateLock\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/dynamicArchive\/DynamicSharedSymbols.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -67,1 +67,2 @@\n-                              \"jdk\/test\/lib\/apps\/LingeredApp$1\"};\n+                              \"jdk\/test\/lib\/apps\/LingeredApp$1\",\n+                              \"jdk\/test\/lib\/apps\/LingeredApp$SteadyStateLock\"};\n","filename":"test\/hotspot\/jtreg\/runtime\/cds\/appcds\/jcmd\/JCmdTestDumpBase.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,0 +85,1 @@\n+        SAOutput.shouldContain(\"SteadyStateLock\");\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/TestObjectMonitorIterate.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2015, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2015, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -590,0 +590,1 @@\n+    static class SteadyStateLock {};\n@@ -619,1 +620,1 @@\n-            Object steadyStateObj = new Object();\n+            Object steadyStateObj = new SteadyStateLock();\n","filename":"test\/lib\/jdk\/test\/lib\/apps\/LingeredApp.java","additions":3,"deletions":2,"binary":false,"changes":5,"status":"modified"}]}