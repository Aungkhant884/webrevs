{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2001, 2021, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2001, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -46,2 +46,6 @@\n-    Type type = db.lookupType(\"ObjectSynchronizer\");\n-    inUseList = type.getAddressField(\"_in_use_list\").getValue();\n+    Type objectSynchronizerType = db.lookupType(\"ObjectSynchronizer\");\n+    Type monitorListType = db.lookupType(\"MonitorList\");\n+    \/\/ Static fields will be left in the default initialized state if the lookup fails\n+    Address monitorListAddr = objectSynchronizerType.getField(\"_in_use_list\").getStaticFieldAddress();\n+    inUseListHead = monitorListType.getAddressField(\"_head\").getAddress(monitorListAddr);\n+    isSupported = true;\n@@ -73,1 +77,1 @@\n-    if (inUseList != null) {\n+    if (isSupported) {\n@@ -86,1 +90,1 @@\n-      mon = new ObjectMonitor(inUseList);\n+      mon = inUseListHead == null ? null : new ObjectMonitor(inUseListHead);\n@@ -90,1 +94,1 @@\n-      return (mon.nextOM() != null);\n+      return (mon != null);\n@@ -94,3 +98,2 @@\n-      \/\/ advance to next entry\n-      Address monAddr = mon.nextOM();\n-      if (monAddr == null) {\n+      ObjectMonitor ret = mon;\n+      if (ret == null) {\n@@ -99,2 +102,5 @@\n-      mon = new ObjectMonitor(monAddr);\n-      return mon;\n+      \/\/ advance to next entry\n+      Address nextMon = mon.nextOM();\n+      mon = nextMon == null ? null : new ObjectMonitor(nextMon);\n+\n+      return ret;\n@@ -110,1 +116,2 @@\n-  private static Address inUseList;\n+  private static Address inUseListHead;\n+  private static boolean isSupported;\n","filename":"src\/jdk.hotspot.agent\/share\/classes\/sun\/jvm\/hotspot\/runtime\/ObjectSynchronizer.java","additions":19,"deletions":12,"binary":false,"changes":31,"status":"modified"},{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2021, 2022, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2021, 2023, Oracle and\/or its affiliates. All rights reserved.\n@@ -85,0 +85,1 @@\n+        SAOutput.shouldContain(\"java\/lang\/Object\");\n","filename":"test\/hotspot\/jtreg\/serviceability\/sa\/TestObjectMonitorIterate.java","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"}]}