{"files":[{"patch":"@@ -3276,1 +3276,4 @@\n-    _pss.state_for_worker(index)->set_ref_discoverer(nullptr);\n+\n+    G1ParScanThreadState* pss = _pss.state_for_worker(index);\n+    pss->set_ref_discoverer(nullptr);\n+\n@@ -3278,2 +3281,2 @@\n-    G1CopyingKeepAliveClosure keep_alive(&_g1h, _pss.state_for_worker(index));\n-    G1ParEvacuateFollowersClosure complete_gc(&_g1h, _pss.state_for_worker(index), &_task_queues, _tm == RefProcThreadModel::Single ? nullptr : &_terminator, G1GCPhaseTimes::ObjCopy);\n+    G1CopyingKeepAliveClosure keep_alive(&_g1h, pss);\n+    G1ParEvacuateFollowersClosure complete_gc(&_g1h, pss, &_task_queues, _tm == RefProcThreadModel::Single ? nullptr : &_terminator, G1GCPhaseTimes::ObjCopy);\n@@ -3281,0 +3284,3 @@\n+\n+    \/\/ We have completed copying any necessary live referent objects.\n+    assert(pss->queue_is_empty(), \"both queue and overflow should be empty\");\n@@ -3291,1 +3297,1 @@\n-  double ref_proc_start = os::elapsedTime();\n+  Ticks start = Ticks::now();\n@@ -3296,9 +3302,0 @@\n-  \/\/ Use only a single queue for this PSS.\n-  G1ParScanThreadState*          pss = per_thread_states->state_for_worker(0);\n-  pss->set_ref_discoverer(NULL);\n-  assert(pss->queue_is_empty(), \"pre-condition\");\n-\n-\n-  ReferenceProcessorPhaseTimes& pt = *phase_times()->ref_phase_times();\n-\n-  ReferenceProcessorStats stats;\n@@ -3306,6 +3303,0 @@\n-\n-  \/\/ Parallel reference processing\n-  assert(no_of_gc_workers <= rp->max_num_queues(),\n-         \"Mismatch between the number of GC workers %u and the maximum number of Reference process queues %u\",\n-         no_of_gc_workers,  rp->max_num_queues());\n-\n@@ -3313,0 +3304,1 @@\n+\n@@ -3314,1 +3306,2 @@\n-  stats = rp->process_discovered_references(task, pt);\n+  ReferenceProcessorPhaseTimes& pt = *phase_times()->ref_phase_times();\n+  ReferenceProcessorStats stats = rp->process_discovered_references(task, pt);\n@@ -3318,3 +3311,0 @@\n-  \/\/ We have completed copying any necessary live referent objects.\n-  assert(pss->queue_is_empty(), \"both queue and overflow should be empty\");\n-\n@@ -3323,1 +3313,0 @@\n-  assert(!rp->discovery_enabled(), \"Postcondition\");\n@@ -3326,2 +3315,1 @@\n-  double ref_proc_time = os::elapsedTime() - ref_proc_start;\n-  phase_times()->record_ref_proc_time(ref_proc_time * 1000.0);\n+  phase_times()->record_ref_proc_time((Ticks::now() - start).seconds() * MILLIUNITS);\n","filename":"src\/hotspot\/share\/gc\/g1\/g1CollectedHeap.cpp","additions":14,"deletions":26,"binary":false,"changes":40,"status":"modified"},{"patch":"@@ -572,0 +572,1 @@\n+  assert(v <= max_num_queues(), \"Mt degree %u too high, maximum %u\", v,  max_num_queues());\n","filename":"src\/hotspot\/share\/gc\/shared\/referenceProcessor.cpp","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"}]}