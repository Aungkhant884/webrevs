{"files":[{"patch":"@@ -352,1 +352,3 @@\n-                AuthCacheImpl ak = httpuc == null ? null : httpuc.getAuthCache();\n+                AuthCacheImpl ak = httpuc == null\n+                    ? AuthCacheImpl.getDefault()\n+                    : httpuc.getAuthCache();\n@@ -425,1 +427,1 @@\n-        return authcache;\n+        return authcache == null ? AuthCacheImpl.getDefault() : authcache;\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/http\/HttpClient.java","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -28,1 +28,0 @@\n-import java.lang.invoke.MethodHandles;\n@@ -36,1 +35,0 @@\n-import java.util.concurrent.atomic.AtomicInteger;\n@@ -118,0 +116,12 @@\n+    \/**\n+     * The default cache is stored under null key which is never garbage\n+     * collected.\n+     *\/\n+    public static AuthCacheImpl getDefault() {\n+        return getAuthCacheFor(null);\n+    }\n+\n+    \/**\n+     * Atomically check if a cache exists for given Authenticator and return it\n+     * or create one and return it\n+     *\/\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/AuthCacheImpl.java","additions":12,"deletions":2,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -216,3 +216,0 @@\n-    \/** A cache to obtain credentials from if the default cache not to be used *\/\n-    AuthCacheImpl authcache;\n-\n@@ -221,1 +218,1 @@\n-                              int port, String realm, AuthCacheImpl acache) {\n+                              int port, String realm) {\n@@ -229,1 +226,0 @@\n-        this.authcache = acache == null ? defCache : acache;\n@@ -245,2 +241,1 @@\n-    public AuthenticationInfo(char type, AuthScheme authScheme, URL url, String realm,\n-                              AuthCacheImpl acache) {\n+    public AuthenticationInfo(char type, AuthScheme authScheme, URL url, String realm) {\n@@ -263,1 +258,0 @@\n-        this.authcache = acache == null ? defCache : acache;\n@@ -325,1 +319,0 @@\n-\n@@ -331,2 +324,1 @@\n-        \/\/ use default cache if none supplied\n-        acache = acache == null ? defCache : acache;\n+        Objects.requireNonNull(acache);\n@@ -346,0 +338,1 @@\n+        Objects.requireNonNull(acache);\n@@ -347,2 +340,0 @@\n-        \/\/ use default cache if none supplied\n-        acache = acache == null ? defCache : acache;\n@@ -366,1 +357,1 @@\n-        acache = acache == null ? defCache : acache;\n+        Objects.requireNonNull(acache);\n@@ -379,1 +370,2 @@\n-    void addToCache() {\n+    void addToCache(AuthCacheImpl authcache) {\n+        Objects.requireNonNull(authcache);\n@@ -400,1 +392,2 @@\n-    void removeFromCache() {\n+    void removeFromCache(AuthCacheImpl authcache) {\n+        Objects.requireNonNull(authcache);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/AuthenticationInfo.java","additions":9,"deletions":16,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -66,1 +66,1 @@\n-                               boolean isUTF8, AuthCacheImpl authCache) {\n+                               boolean isUTF8) {\n@@ -68,1 +68,1 @@\n-              AuthScheme.BASIC, host, port, realm, authCache);\n+              AuthScheme.BASIC, host, port, realm);\n@@ -77,2 +77,1 @@\n-                               String realm, String auth,\n-                               AuthCacheImpl authCache) {\n+                               String realm, String auth) {\n@@ -80,1 +79,1 @@\n-              AuthScheme.BASIC, host, port, realm, authCache);\n+              AuthScheme.BASIC, host, port, realm);\n@@ -88,2 +87,1 @@\n-                               PasswordAuthentication pw, boolean isUTF8,\n-                               AuthCacheImpl authCache) {\n+                               PasswordAuthentication pw, boolean isUTF8) {\n@@ -91,1 +89,1 @@\n-              AuthScheme.BASIC, url, realm, authCache);\n+              AuthScheme.BASIC, url, realm);\n@@ -116,1 +114,1 @@\n-                               String auth, AuthCacheImpl authCache) {\n+                               String auth) {\n@@ -118,1 +116,1 @@\n-              AuthScheme.BASIC, url, realm, authCache);\n+              AuthScheme.BASIC, url, realm);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/BasicAuthentication.java","additions":8,"deletions":10,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -299,1 +299,1 @@\n-                                Parameters params, AuthCacheImpl authcache) {\n+                                Parameters params){\n@@ -303,2 +303,1 @@\n-              realm,\n-              authcache);\n+              realm);\n@@ -312,1 +311,1 @@\n-                                Parameters params, AuthCacheImpl authcache) {\n+                                Parameters params) {\n@@ -317,2 +316,1 @@\n-              realm,\n-              authcache);\n+              realm);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/DigestAuthentication.java","additions":4,"deletions":6,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -313,1 +313,1 @@\n-    protected volatile AuthCacheImpl authCache;\n+    protected volatile AuthCacheImpl authCache = AuthCacheImpl.getDefault();\n@@ -450,1 +450,0 @@\n-\n@@ -1769,1 +1768,1 @@\n-                    proxyAuthentication.addToCache();\n+                    proxyAuthentication.addToCache(authCache);\n@@ -1817,1 +1816,1 @@\n-                                serverAuthentication.removeFromCache();\n+                                serverAuthentication.removeFromCache(authCache);\n@@ -1858,1 +1857,1 @@\n-                            serverAuthentication.removeFromCache();\n+                            serverAuthentication.removeFromCache(authCache);\n@@ -1862,1 +1861,1 @@\n-                        serverAuthentication.addToCache();\n+                        serverAuthentication.addToCache(authCache);\n@@ -1878,2 +1877,2 @@\n-                                                   digestparams, srv.authcache);\n-                                d.addToCache ();\n+                                                   digestparams);\n+                                d.addToCache (authCache);\n@@ -2090,1 +2089,1 @@\n-                proxyAuthentication.removeFromCache();\n+                proxyAuthentication.removeFromCache(authCache);\n@@ -2231,1 +2230,1 @@\n-                    proxyAuthentication.addToCache();\n+                    proxyAuthentication.addToCache(authCache);\n@@ -2417,2 +2416,1 @@\n-                        ret = new BasicAuthentication(true, host, port, realm, a,\n-                                             isUTF8, authCache);\n+                        ret = new BasicAuthentication(true, host, port, realm, a, isUTF8);\n@@ -2430,2 +2428,1 @@\n-                                             scheme, a, params,\n-                                             authCache);\n+                                             scheme, a, params);\n@@ -2470,2 +2467,1 @@\n-                            ret = NTLMAuthenticationProxy.proxy.create(true, host,\n-                                    port, a, authCache);\n+                            ret = NTLMAuthenticationProxy.proxy.create(true, host, port, a);\n@@ -2503,2 +2499,1 @@\n-                        ret = new BasicAuthentication (true, host, port, realm, a,\n-                                  authCache);\n+                        ret = new BasicAuthentication (true, host, port, realm, a);\n@@ -2595,2 +2590,1 @@\n-                        ret = new BasicAuthentication(false, url, realm, a,\n-                                    isUTF8, authCache);\n+                        ret = new BasicAuthentication(false, url, realm, a, isUTF8);\n@@ -2607,2 +2601,1 @@\n-                                    a, digestparams,\n-                                    authCache);\n+                                    a, digestparams);\n@@ -2653,2 +2646,1 @@\n-                            ret = NTLMAuthenticationProxy.proxy.create(false,\n-                                     url1, a, authCache);\n+                            ret = NTLMAuthenticationProxy.proxy.create(false, url1, a);\n@@ -2678,2 +2670,1 @@\n-                    ret = new BasicAuthentication (false, url, realm, a,\n-                                    authCache);\n+                    ret = new BasicAuthentication (false, url, realm, a);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/HttpURLConnection.java","additions":17,"deletions":26,"binary":false,"changes":43,"status":"modified"},{"patch":"@@ -48,0 +48,1 @@\n+    private final Constructor<? extends AuthenticationInfo> threeArgCtr;\n@@ -49,1 +50,0 @@\n-    private final Constructor<? extends AuthenticationInfo> fiveArgCtr;\n@@ -51,2 +51,3 @@\n-    private NTLMAuthenticationProxy(Constructor<? extends AuthenticationInfo> fourArgCtr,\n-                                    Constructor<? extends AuthenticationInfo> fiveArgCtr) {\n+    private NTLMAuthenticationProxy(Constructor<? extends AuthenticationInfo> threeArgCtr,\n+                                    Constructor<? extends AuthenticationInfo> fourArgCtr) {\n+        this.threeArgCtr = threeArgCtr;\n@@ -54,1 +55,0 @@\n-        this.fiveArgCtr = fiveArgCtr;\n@@ -60,2 +60,1 @@\n-                              PasswordAuthentication pw,\n-                              AuthCacheImpl authcache) {\n+                              PasswordAuthentication pw) {\n@@ -63,1 +62,1 @@\n-            return fourArgCtr.newInstance(isProxy, url, pw, authcache);\n+            return threeArgCtr.newInstance(isProxy, url, pw);\n@@ -74,2 +73,1 @@\n-                              PasswordAuthentication pw,\n-                              AuthCacheImpl authcache) {\n+                              PasswordAuthentication pw) {\n@@ -77,1 +75,1 @@\n-            return fiveArgCtr.newInstance(isProxy, host, port, pw, authcache);\n+            return fourArgCtr.newInstance(isProxy, host, port, pw);\n@@ -126,2 +124,1 @@\n-                                             PasswordAuthentication.class,\n-                                             AuthCacheImpl.class);\n+                                             PasswordAuthentication.class);\n@@ -131,2 +128,1 @@\n-                                            PasswordAuthentication.class,\n-                                            AuthCacheImpl.class);\n+                                            PasswordAuthentication.class);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/NTLMAuthenticationProxy.java","additions":10,"deletions":14,"binary":false,"changes":24,"status":"modified"},{"patch":"@@ -36,1 +36,0 @@\n-import sun.net.www.protocol.http.AuthCacheImpl;\n@@ -84,3 +83,1 @@\n-              hci.url,\n-              \"\",\n-              AuthCacheImpl.getAuthCacheFor(hci.authenticator));\n+              hci.url, \"\");\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/NegotiateAuthentication.java","additions":1,"deletions":4,"binary":false,"changes":5,"status":"modified"},{"patch":"@@ -42,1 +42,0 @@\n-import sun.net.www.protocol.http.AuthCacheImpl;\n@@ -135,2 +134,1 @@\n-    public NTLMAuthentication(boolean isProxy, URL url, PasswordAuthentication pw,\n-                              AuthCacheImpl authcache) {\n+    public NTLMAuthentication(boolean isProxy, URL url, PasswordAuthentication pw) {\n@@ -139,3 +137,1 @@\n-                url,\n-                \"\",\n-                authcache);\n+                url, \"\");\n@@ -178,2 +174,1 @@\n-                              PasswordAuthentication pw,\n-                              AuthCacheImpl authcache) {\n+                              PasswordAuthentication pw) {\n@@ -184,2 +179,1 @@\n-                \"\",\n-                authcache);\n+                \"\");\n","filename":"src\/java.base\/unix\/classes\/sun\/net\/www\/protocol\/http\/ntlm\/NTLMAuthentication.java","additions":4,"deletions":10,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -38,1 +38,0 @@\n-import sun.net.www.protocol.http.AuthCacheImpl;\n@@ -123,2 +122,1 @@\n-    public NTLMAuthentication(boolean isProxy, URL url, PasswordAuthentication pw,\n-                              AuthCacheImpl authcache) {\n+    public NTLMAuthentication(boolean isProxy, URL url, PasswordAuthentication pw) {\n@@ -128,2 +126,1 @@\n-              \"\",\n-              authcache);\n+              \"\");\n@@ -159,2 +156,1 @@\n-                              PasswordAuthentication pw,\n-                              AuthCacheImpl authcache) {\n+                              PasswordAuthentication pw) {\n@@ -165,2 +161,1 @@\n-              \"\",\n-              authcache);\n+              \"\");\n","filename":"src\/java.base\/windows\/classes\/sun\/net\/www\/protocol\/http\/ntlm\/NTLMAuthentication.java","additions":4,"deletions":9,"binary":false,"changes":13,"status":"modified"},{"patch":"@@ -65,0 +65,1 @@\n+ * @run main\/othervm HTTPSetAuthenticatorTest NONE SERVER PROXY SERVER307 PROXY305\n@@ -123,1 +124,0 @@\n-\n","filename":"test\/jdk\/java\/net\/HttpURLConnection\/SetAuthenticator\/HTTPSetAuthenticatorTest.java","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}