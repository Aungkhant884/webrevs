{"files":[{"patch":"@@ -115,1 +115,1 @@\n-    private static Map<Authenticator,AuthCacheImpl> caches =\n+    private static final Map<Authenticator,AuthCacheImpl> caches =\n@@ -119,4 +119,7 @@\n-        var c = caches.get(auth);\n-        if (c == null) {\n-            c = new AuthCacheImpl();\n-            caches.put(auth, c);\n+        synchronized (caches) {\n+            var c = caches.get(auth);\n+            if (c == null) {\n+                c = new AuthCacheImpl();\n+                caches.put(auth, c);\n+            }\n+            return c;\n@@ -124,1 +127,0 @@\n-        return c;\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/AuthCacheImpl.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -47,5 +47,1 @@\n-    protected static AuthCacheImpl defCache = new AuthCacheImpl();\n-\n-    public static void setAuthCache (AuthCacheImpl map) {\n-        defCache = map;\n-    }\n+    protected static final AuthCacheImpl defCache = new AuthCacheImpl();\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/AuthCacheValue.java","additions":1,"deletions":5,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -76,1 +76,1 @@\n-    protected transient PasswordAuthentication pw;\n+    protected PasswordAuthentication pw;\n@@ -217,1 +217,1 @@\n-    transient AuthCacheImpl authcache; \/\/ may be null\n+    AuthCacheImpl authcache;\n@@ -330,1 +330,1 @@\n-    static AuthenticationInfo getAuth(String key, URL url, AuthCacheImpl authcache) {\n+    static AuthenticationInfo getAuth(String key, URL url, AuthCacheImpl acache) {\n@@ -332,1 +332,1 @@\n-        authcache = authcache == null ? defCache : authcache;\n+        acache = acache == null ? defCache : acache;\n@@ -334,1 +334,1 @@\n-            return (AuthenticationInfo)authcache.get (key, null);\n+            return (AuthenticationInfo)acache.get (key, null);\n@@ -336,1 +336,1 @@\n-            return (AuthenticationInfo)authcache.get (key, url.getPath());\n+            return (AuthenticationInfo)acache.get (key, url.getPath());\n@@ -345,1 +345,1 @@\n-    static AuthenticationInfo getProxyAuth(String host, int port, AuthCacheImpl authcache) {\n+    static AuthenticationInfo getProxyAuth(String host, int port, AuthCacheImpl acache) {\n@@ -348,2 +348,2 @@\n-        authcache = authcache == null ? defCache : authcache;\n-        AuthenticationInfo result = (AuthenticationInfo) authcache.get(key, null);\n+        acache = acache == null ? defCache : acache;\n+        AuthenticationInfo result = (AuthenticationInfo) acache.get(key, null);\n@@ -365,3 +365,3 @@\n-    private static AuthenticationInfo getCachedProxyAuth(String key, AuthCacheImpl authcache) {\n-        authcache = authcache == null ? defCache : authcache;\n-        return (AuthenticationInfo) authcache.get(key, null);\n+    private static AuthenticationInfo getCachedProxyAuth(String key, AuthCacheImpl acache) {\n+        acache = acache == null ? defCache : acache;\n+        return (AuthenticationInfo) acache.get(key, null);\n@@ -370,3 +370,3 @@\n-    static AuthenticationInfo getProxyAuth(String key, AuthCacheImpl authcache) {\n-        if (!serializeAuth) return getCachedProxyAuth(key, authcache);\n-        return requestAuthentication(key, authcache, AuthenticationInfo::getCachedProxyAuth);\n+    static AuthenticationInfo getProxyAuth(String key, AuthCacheImpl acache) {\n+        if (!serializeAuth) return getCachedProxyAuth(key, acache);\n+        return requestAuthentication(key, acache, AuthenticationInfo::getCachedProxyAuth);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/AuthenticationInfo.java","additions":15,"deletions":15,"binary":false,"changes":30,"status":"modified"},{"patch":"@@ -49,1 +49,1 @@\n-    private final Constructor<? extends AuthenticationInfo> sixArgCtr;\n+    private final Constructor<? extends AuthenticationInfo> fiveArgCtr;\n@@ -52,1 +52,1 @@\n-                                    Constructor<? extends AuthenticationInfo> sixArgCtr) {\n+                                    Constructor<? extends AuthenticationInfo> fiveArgCtr) {\n@@ -54,1 +54,1 @@\n-        this.sixArgCtr = sixArgCtr;\n+        this.fiveArgCtr = fiveArgCtr;\n@@ -77,1 +77,1 @@\n-            return sixArgCtr.newInstance(isProxy, host, port, pw, authcache);\n+            return fiveArgCtr.newInstance(isProxy, host, port, pw, authcache);\n@@ -120,1 +120,1 @@\n-        Constructor<? extends AuthenticationInfo> fourArg, sixArg;\n+        Constructor<? extends AuthenticationInfo> fourArg, fiveArg;\n@@ -128,1 +128,1 @@\n-                sixArg = cl.getConstructor(boolean.class,\n+                fiveArg = cl.getConstructor(boolean.class,\n@@ -136,1 +136,1 @@\n-                                                   sixArg);\n+                                                   fiveArg);\n","filename":"src\/java.base\/share\/classes\/sun\/net\/www\/protocol\/http\/NTLMAuthenticationProxy.java","additions":7,"deletions":7,"binary":false,"changes":14,"status":"modified"},{"patch":"@@ -66,0 +66,9 @@\n+ * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST PROXY\n+ * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST PROXY305\n+ * @run main\/othervm -Dhttp.auth.digest.reEnabledAlgorithms=MD5 HTTPSetAuthenticatorTest DIGEST SERVER307\n+ * @run main\/othervm HTTPSetAuthenticatorTest BASIC  SERVER\n+ * @run main\/othervm HTTPSetAuthenticatorTest BASIC  PROXY\n+ * @run main\/othervm HTTPSetAuthenticatorTest BASIC  PROXY305\n+ * @run main\/othervm HTTPSetAuthenticatorTest BASIC  SERVER307\n+ * @run main\/othervm HTTPSetAuthenticatorTest BASICSERVER SERVER\n+ * @run main\/othervm HTTPSetAuthenticatorTest BASICSERVER SERVER307\n","filename":"test\/jdk\/java\/net\/HttpURLConnection\/SetAuthenticator\/HTTPSetAuthenticatorTest.java","additions":9,"deletions":0,"binary":false,"changes":9,"status":"modified"}]}