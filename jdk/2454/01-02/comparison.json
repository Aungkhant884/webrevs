{"files":[{"patch":"@@ -210,15 +210,14 @@\n-    {\n-        int cm = WideCharToMultiByte(encoding,\n-                                    0,\n-                                    utf16str.c_str(),\n-                                    int(utf16str.size()),\n-                                    NULL,\n-                                    0,\n-                                    NULL,\n-                                    NULL);\n-        if (cm < 0) {\n-            JP_THROW(\"Unexpected reply from WideCharToMultiByte()\");\n-        }\n-        if (0 == cm) {\n-            break;\n-        }\n+    int cm = WideCharToMultiByte(encoding,\n+                                 0,\n+                                 utf16str.c_str(),\n+                                 int(utf16str.size()),\n+                                 NULL,\n+                                 0,\n+                                 NULL,\n+                                 NULL);\n+    if (cm < 0) {\n+        JP_THROW(\"Unexpected reply from WideCharToMultiByte()\");\n+    }\n+    if (0 == cm) {\n+        return reply;\n+    }\n@@ -226,12 +225,11 @@\n-        reply.resize(cm);\n-        int cm2 = WideCharToMultiByte(encoding,\n-                                    0,\n-                                    utf16str.c_str(),\n-                                    int(utf16str.size()),\n-                                    &*reply.begin(),\n-                                    cm,\n-                                    NULL,\n-                                    NULL);\n-        if (cm != cm2) {\n-            JP_THROW(\"Unexpected reply from WideCharToMultiByte()\");\n-        }\n+    reply.resize(cm);\n+    int cm2 = WideCharToMultiByte(encoding,\n+                                  0,\n+                                  utf16str.c_str(),\n+                                  int(utf16str.size()),\n+                                  &*reply.begin(),\n+                                  cm,\n+                                  NULL,\n+                                  NULL);\n+    if (cm != cm2) {\n+        JP_THROW(\"Unexpected reply from WideCharToMultiByte()\");\n@@ -248,13 +246,12 @@\n-    {\n-        int cw = MultiByteToWideChar(encoding,\n-                                    MB_ERR_INVALID_CHARS,\n-                                    str.c_str(),\n-                                    int(str.size()),\n-                                    NULL,\n-                                    0);\n-        if (cw < 0) {\n-            JP_THROW(\"Unexpected reply from MultiByteToWideChar()\");\n-        }\n-        if (0 == cw) {\n-            break;\n-        }\n+    int cw = MultiByteToWideChar(encoding,\n+                                 MB_ERR_INVALID_CHARS,\n+                                 str.c_str(),\n+                                 int(str.size()),\n+                                 NULL,\n+                                 0);\n+    if (cw < 0) {\n+        JP_THROW(\"Unexpected reply from MultiByteToWideChar()\");\n+    }\n+    if (0 == cw) {\n+        return utf16;\n+    }\n@@ -262,10 +259,9 @@\n-        utf16.resize(cw);\n-        int cw2 = MultiByteToWideChar(encoding,\n-                                    MB_ERR_INVALID_CHARS,\n-                                    str.c_str(),\n-                                    int(str.size()),\n-                                    &*utf16.begin(),\n-                                    cw);\n-        if (cw != cw2) {\n-            JP_THROW(\"Unexpected reply from MultiByteToWideChar()\");\n-        }\n+    utf16.resize(cw);\n+    int cw2 = MultiByteToWideChar(encoding,\n+                                  MB_ERR_INVALID_CHARS,\n+                                  str.c_str(),\n+                                  int(str.size()),\n+                                  &*utf16.begin(),\n+                                  cw);\n+    if (cw != cw2) {\n+        JP_THROW(\"Unexpected reply from MultiByteToWideChar()\");\n","filename":"src\/jdk.jpackage\/share\/native\/common\/tstrings.cpp","additions":46,"deletions":50,"binary":false,"changes":96,"status":"modified"}]}