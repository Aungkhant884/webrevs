{"files":[{"patch":"@@ -2,1 +2,1 @@\n- * Copyright (c) 2005, 2006, Oracle and\/or its affiliates. All rights reserved.\n+ * Copyright (c) 2005, 2021, Oracle and\/or its affiliates. All rights reserved.\n@@ -27,1 +27,0 @@\n-import java.io.*;\n@@ -30,0 +29,2 @@\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.CopyOnWriteArrayList;\n@@ -31,1 +32,0 @@\n-import com.sun.net.httpserver.spi.*;\n@@ -43,5 +43,5 @@\n-    private String path;\n-    private String protocol;\n-    private HttpHandler handler;\n-    private Map<String,Object> attributes = new HashMap<String,Object>();\n-    private ServerImpl server;\n+    private final String path;\n+    private final String protocol;\n+    private final ServerImpl server;\n+    private final AuthFilter authfilter;\n+    private final Map<String,Object> attributes = new ConcurrentHashMap<>();\n@@ -49,1 +49,1 @@\n-    private LinkedList<Filter> sfilters = new LinkedList<Filter>();\n+    private final List<Filter> sfilters = new CopyOnWriteArrayList<>();\n@@ -51,1 +51,1 @@\n-    private LinkedList<Filter> ufilters = new LinkedList<Filter>();\n+    private final List<Filter> ufilters = new CopyOnWriteArrayList<>();\n@@ -53,1 +53,1 @@\n-    private AuthFilter authfilter;\n+    private HttpHandler handler;\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/HttpContextImpl.java","additions":11,"deletions":11,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -657,2 +657,2 @@\n-                List<Filter> sf = ctx.getSystemFilters();\n-                List<Filter> uf = ctx.getFilters();\n+                final List<Filter> sf = ctx.getSystemFilters();\n+                final List<Filter> uf = ctx.getFilters();\n@@ -660,2 +660,2 @@\n-                Filter.Chain sc = new Filter.Chain(sf, ctx.getHandler());\n-                Filter.Chain uc = new Filter.Chain(uf, new LinkHandler (sc));\n+                final Filter.Chain sc = new Filter.Chain(sf, ctx.getHandler());\n+                final Filter.Chain uc = new Filter.Chain(uf, new LinkHandler (sc));\n","filename":"src\/jdk.httpserver\/share\/classes\/sun\/net\/httpserver\/ServerImpl.java","additions":4,"deletions":4,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -41,2 +41,1 @@\n-import java.util.concurrent.atomic.AtomicInteger;\n-import java.util.concurrent.atomic.AtomicReference;\n+import java.util.concurrent.CompletableFuture;\n@@ -168,1 +167,1 @@\n-        var respCode = new AtomicInteger();\n+        var respCode = new CompletableFuture<Integer>();\n@@ -170,1 +169,1 @@\n-                e -> respCode.set(e.getResponseCode()));\n+                e -> respCode.complete(e.getResponseCode()));\n@@ -179,1 +178,1 @@\n-            assertEquals(response.statusCode(), respCode.get());\n+            assertEquals(response.statusCode(), (int)respCode.get());\n@@ -188,1 +187,1 @@\n-        var attr = new AtomicReference<String>();\n+        var attr = new CompletableFuture<String>();\n@@ -193,1 +192,1 @@\n-                e -> attr.set((String) e.getAttribute(\"test-attr\")));\n+                e -> attr.complete((String) e.getAttribute(\"test-attr\")));\n@@ -213,1 +212,1 @@\n-        var respCode = new AtomicInteger();\n+        var respCode = new CompletableFuture<Integer>();\n@@ -222,1 +221,1 @@\n-                        respCode.set(e.getResponseCode());\n+                        respCode.complete(e.getResponseCode());\n@@ -236,1 +235,1 @@\n-            assertEquals(response.statusCode(), respCode.get());\n+            assertEquals(response.statusCode(), (int)respCode.get());\n@@ -245,1 +244,1 @@\n-        var respCode = new AtomicInteger();\n+        var respCode = new CompletableFuture<Integer>();\n@@ -249,1 +248,1 @@\n-                e -> respCode.set(e.getResponseCode()));\n+                e -> respCode.complete(e.getResponseCode()));\n@@ -260,1 +259,0 @@\n-            assertEquals(response.statusCode(), respCode.get());\n@@ -263,0 +261,1 @@\n+            assertEquals(response.statusCode(), (int)respCode.get());\n","filename":"test\/jdk\/com\/sun\/net\/httpserver\/FilterTest.java","additions":12,"deletions":13,"binary":false,"changes":25,"status":"modified"}]}