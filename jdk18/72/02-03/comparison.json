{"files":[{"patch":"@@ -482,5 +482,3 @@\n-        GraphicsConfiguration gc = GraphicsEnvironment.getLocalGraphicsEnvironment()\n-                .getDefaultScreenDevice().getDefaultConfiguration();\n-        gc = AccessibilityGraphicsEnvironment.getGraphicsConfigurationAtPoint(gc, x, y);\n-        x = AccessibilityGraphicsEnvironment.toUserSpaceX(gc, x);\n-        y = AccessibilityGraphicsEnvironment.toUserSpaceY(gc, y);\n+        Point userSpaceXY = AccessibilityGraphicsEnvironment.toUserSpace(x, y);\n+        x = userSpaceXY.x;\n+        y = userSpaceXY.y;\n@@ -7357,1 +7355,16 @@\n-         * Returns the graphics configuration which bounds contain the given point.\n+         * Returns the graphics configuration which bounds contain the given point in the user's space.\n+         *\n+         * See {@link sun.java2d.SunGraphicsEnvironment#getGraphicsConfigurationAtPoint(GraphicsConfiguration, double, double)}\n+         *\n+         * @param  x the x coordinate of the given point in the user's space\n+         * @param  y the y coordinate of the given point in the user's space\n+         * @return the graphics configuration\n+         *\/\n+        public static GraphicsConfiguration getGraphicsConfigurationAtPoint(double x, double y) {\n+            GraphicsConfiguration gc = GraphicsEnvironment.getLocalGraphicsEnvironment()\n+                    .getDefaultScreenDevice().getDefaultConfiguration();\n+            return getGraphicsConfigurationAtPoint(gc, x, y);\n+        }\n+\n+        \/**\n+         * Returns the graphics configuration which bounds contain the given point in the user's space.\n@@ -7363,2 +7376,2 @@\n-         * @param  x the x coordinate of the given point\n-         * @param  y the y coordinate of the given point\n+         * @param  x the x coordinate of the given point in the user's space\n+         * @param  y the y coordinate of the given point in the user's space\n@@ -7369,1 +7382,1 @@\n-            if (current.getBounds().contains(x, y)) {\n+            if (containsUserSpacePoint(current, x, y)) {\n@@ -7375,3 +7388,1 @@\n-                Rectangle bounds = config.getBounds();\n-                bounds = toDeviceSpaceAbs(config, bounds.x, bounds.y, bounds.width, bounds.height);\n-                if (bounds.contains(x, y)) {\n+                if (containsUserSpacePoint(config, x, y)) {\n@@ -7385,2 +7396,1 @@\n-         * Converts absolute x coordinate from the device\n-         * space to the user's space using passed graphics configuration.\n+         * Returns the graphics configuration which bounds contain the given point in the device space.\n@@ -7388,3 +7398,3 @@\n-         * @param  gc the graphics configuration to be used for transformation\n-         * @param  x absolute coordinate in the device's space\n-         * @return the corresponding x coordinate in user's space\n+         * @param  x the x coordinate of the given point in the device space\n+         * @param  y the y coordinate of the given point in the device space\n+         * @return the graphics configuration\n@@ -7392,4 +7402,4 @@\n-        public static int toUserSpaceX(GraphicsConfiguration gc, int x) {\n-            AffineTransform tx = gc.getDefaultTransform();\n-            Rectangle screen = gc.getBounds();\n-            return screen.x + clipRound((x - screen.x) \/ tx.getScaleX());\n+        public static GraphicsConfiguration getGraphicsConfigurationAtDevicePoint(double x, double y) {\n+            GraphicsConfiguration gc = GraphicsEnvironment.getLocalGraphicsEnvironment()\n+                    .getDefaultScreenDevice().getDefaultConfiguration();\n+            return getGraphicsConfigurationAtDevicePoint(gc, x, y);\n@@ -7399,1 +7409,49 @@\n-         * Converts absolute y coordinate from the device\n+         * Returns the graphics configuration which bounds contain the given point in the device space.\n+         *\n+         * @param  current the default configuration which is checked in the first\n+         *         place\n+         * @param  x the x coordinate of the given point in the device space\n+         * @param  y the y coordinate of the given point in the device space\n+         * @return the graphics configuration\n+         *\/\n+        public static GraphicsConfiguration getGraphicsConfigurationAtDevicePoint(\n+                GraphicsConfiguration current, double x, double y) {\n+            if (containsDeviceSpacePoint(current, x, y)) {\n+                return current;\n+            }\n+            GraphicsEnvironment env = getLocalGraphicsEnvironment();\n+            for (GraphicsDevice device : env.getScreenDevices()) {\n+                GraphicsConfiguration config = device.getDefaultConfiguration();\n+                if (containsDeviceSpacePoint(config, x, y)) {\n+                    return config;\n+                }\n+            }\n+            return current;\n+        }\n+\n+        private static boolean containsDeviceSpacePoint(GraphicsConfiguration config, double x, double y) {\n+            Rectangle bounds = config.getBounds();\n+            bounds = toDeviceSpaceAbs(config, bounds.x, bounds.y, bounds.width, bounds.height);\n+            return bounds.contains(x, y);\n+        }\n+\n+        private static boolean containsUserSpacePoint(GraphicsConfiguration config, double x, double y) {\n+            Rectangle bounds = config.getBounds();\n+            return bounds.contains(x, y);\n+        }\n+\n+        \/**\n+         * Converts absolute coordinates from the device\n+         * space to the user's space space using appropriate device transformation.\n+         *\n+         * @param  x absolute x coordinate in the device's space\n+         * @param  y absolute y coordinate in the device's space\n+         * @return the corresponding coordinates in user's space\n+         *\/\n+        public static Point toUserSpace(int x, int y) {\n+            GraphicsConfiguration gc = getGraphicsConfigurationAtDevicePoint(x, y);\n+            return toUserSpace(gc, x, y);\n+        }\n+\n+        \/**\n+         * Converts absolute coordinates from the device\n@@ -7403,2 +7461,3 @@\n-         * @param  y absolute coordinate in the device's space\n-         * @return the corresponding y coordinate in user's space\n+         * @param  x absolute x coordinate in the device's space\n+         * @param  y absolute y coordinate in the device's space\n+         * @return the corresponding coordinates in user's space\n@@ -7406,1 +7465,1 @@\n-        public static int toUserSpaceY(GraphicsConfiguration gc, int y) {\n+        public static Point toUserSpace(GraphicsConfiguration gc, int x, int y) {\n@@ -7409,1 +7468,3 @@\n-            return screen.y + clipRound((y - screen.y) \/ tx.getScaleY());\n+            int userX = screen.x + clipRound((x - screen.x) \/ tx.getScaleX());\n+            int userY = screen.y + clipRound((y - screen.y) \/ tx.getScaleY());\n+            return new Point(userX, userY);\n@@ -7422,3 +7483,1 @@\n-            GraphicsConfiguration gc = getLocalGraphicsEnvironment()\n-                    .getDefaultScreenDevice().getDefaultConfiguration();\n-            gc = getGraphicsConfigurationAtPoint(gc, rect.x, rect.y);\n+            GraphicsConfiguration gc = getGraphicsConfigurationAtPoint(rect.x, rect.y);\n","filename":"src\/jdk.accessibility\/windows\/classes\/com\/sun\/java\/accessibility\/internal\/AccessBridge.java","additions":88,"deletions":29,"binary":false,"changes":117,"status":"modified"}]}