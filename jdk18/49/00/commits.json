[{"commit":{"message":"8278889: AArch64: [vectorapi] VectorMaskLoadStoreTest.testMaskCast() test fail\n\nThis bug appears intermittently and it's caused by vmaskAll_immI[1]\nwhen the vector mask size is smaller than max predicate size of running\nmachine. It generates an all-true predicate without considering those\ninactive bits. That may result in the wrong result of VectorMask.toLong.\nThe problematic code is as below:\n\n```\n        ShortVector.SPECIES_64.MaskAll(true).toLong()\n\nassembly:\n\n        ptrue   p0.h          <= MaskAll(true)\n        mov     z16.h, p0\/z, #1\n        mov     z17.h, #0\n        uzp1    z16.b, z16.b, z17.b\n        fmov    x10, d16\n        orr     x10, x10, x10, lsr #7\n        orr     x10, x10, x10, lsr #14\n        orr     x10, x10, x10, lsr #28\n        and     x10, x10, #0xff\n\n(gdb) p\/x $p0 # on an SVE machine with vector length as 64 in bytes\n$1 = {0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55}\n\nExpected:\n(gdb) p\/x $p0\n$1 = {0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}\n\n```\n\nConsidering MaskAll is used in VectorMask.fromLong() only for a special\ncase and relies on the mechanism of inline and intrinsification, even it\ncould be optimized out, this patch also adds test cases for MaskAll to\nreproduce this issue stably.\n\nAlso fix a small issue on register utilization for\nsve_reduce_[max|min][D|F].\n\n[1] https:\/\/github.com\/openjdk\/jdk18\/blob\/master\/src\/hotspot\/cpu\/aarch64\/aarch64_sve.ad#L416\n\nhotspot\/compiler\/vectorapi, jdk\/incubator\/vector passed on SVE enabled\nsystem.\n\nChange-Id: I9631f26f9232ffe7a28b74f14062d945c32fa1fb"},"files":[{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve.ad"},{"filename":"src\/hotspot\/cpu\/aarch64\/aarch64_sve_ad.m4"},{"filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.cpp"},{"filename":"src\/hotspot\/cpu\/aarch64\/c2_MacroAssembler_aarch64.hpp"},{"filename":"test\/hotspot\/gtest\/aarch64\/aarch64-asmtest.py"},{"filename":"test\/hotspot\/gtest\/aarch64\/asmtest.out.h"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Byte128VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Byte256VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Byte512VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Byte64VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/ByteMaxVectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Double128VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Double256VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Double512VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Double64VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/DoubleMaxVectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Float128VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Float256VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Float512VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Float64VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/FloatMaxVectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Int128VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Int256VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Int512VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Int64VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/IntMaxVectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Long128VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Long256VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Long512VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Long64VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/LongMaxVectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Short128VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Short256VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Short512VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/Short64VectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/ShortMaxVectorTests.java"},{"filename":"test\/jdk\/jdk\/incubator\/vector\/templates\/Unit-Miscellaneous.template"}],"sha":"109d88384faf0af0f821c7744da92ed420313c9d"}]