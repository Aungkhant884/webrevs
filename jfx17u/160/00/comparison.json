{"files":[{"patch":"@@ -861,0 +861,3 @@\n+            if (oldIndex > cellCount) {\n+                oldIndex = cellCount;\n+            }\n@@ -2991,1 +2994,5 @@\n-    private int computeCurrentIndex() {\n+    \/**\n+     * Compute the index of the first visible cell\n+     * This has package access ONLY FOR TESTING.\n+     *\/\n+    int computeCurrentIndex() {\n","filename":"modules\/javafx.controls\/src\/main\/java\/javafx\/scene\/control\/skin\/VirtualFlow.java","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -81,0 +81,4 @@\n+    public int shim_computeCurrentIndex() {\n+        return super.computeCurrentIndex();\n+    }\n+\n","filename":"modules\/javafx.controls\/src\/shims\/java\/javafx\/scene\/control\/skin\/VirtualFlowShim.java","additions":4,"deletions":0,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -74,0 +74,1 @@\n+    private int prefSizeCounter;\n@@ -82,1 +83,2 @@\n-        list = new ArrayLinkedListShim<CellStub>();\n+        prefSizeCounter = 0;\n+        list = new ArrayLinkedListShim<>();\n@@ -103,0 +105,1 @@\n+                prefSizeCounter++;\n@@ -118,0 +121,1 @@\n+                prefSizeCounter++;\n@@ -1717,0 +1721,32 @@\n+\n+    @Test\n+    public void testLowerCellCount() {\n+        flow.setCellCount(10000);\n+        int idx = flow.shim_computeCurrentIndex();\n+        assertEquals(0, idx);\n+\n+        assertTrue(prefSizeCounter < 500);\n+        int cntr = prefSizeCounter;\n+        flow.scrollTo(9999);\n+        pulse();\n+        idx = flow.shim_computeCurrentIndex();\n+        assertTrue(idx < 10000);\n+        int newCounter = prefSizeCounter - cntr;\n+        assertTrue(newCounter < 100);\n+        cntr = prefSizeCounter;\n+\n+        flow.setCellCount(5000);\n+        idx = flow.shim_computeCurrentIndex();\n+        assertTrue(idx < 5000);\n+        newCounter = prefSizeCounter - cntr;\n+        assertTrue(newCounter < 100);\n+        cntr = prefSizeCounter;\n+\n+        pulse();\n+        idx = flow.shim_computeCurrentIndex();\n+        assertTrue(idx < 5000);\n+        newCounter = prefSizeCounter - cntr;\n+\n+        assertTrue(newCounter < 100);\n+\n+    }\n","filename":"modules\/javafx.controls\/src\/test\/java\/test\/javafx\/scene\/control\/skin\/VirtualFlowTest.java","additions":37,"deletions":1,"binary":false,"changes":38,"status":"modified"}]}