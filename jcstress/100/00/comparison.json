{"files":[{"patch":"@@ -29,1 +29,0 @@\n-import org.openjdk.jcstress.util.FileUtils;\n@@ -53,0 +52,1 @@\n+    private static volatile boolean STRESS_SEED_AVAILABLE;\n@@ -195,0 +195,6 @@\n+            STRESS_SEED_AVAILABLE = detect(\"Checking if C2 randomizers accept stress seed\",\n+                    SimpleTestMain.class,\n+                    null,\n+                    \"-XX:StressSeed=42\"\n+            );\n+\n@@ -301,1 +307,1 @@\n-                l.addAll(c.args());\n+                l.addAll(c.origArgs());\n@@ -311,1 +317,1 @@\n-                l.addAll(c.args());\n+                l.addAll(c.origArgs());\n@@ -319,1 +325,1 @@\n-            List<String> args = config.args();\n+            List<String> args = config.origArgs();\n@@ -468,0 +474,2 @@\n+        private static final Random SEED_RANDOM = new Random();\n+\n@@ -471,0 +479,1 @@\n+        private final boolean addStressSeed;\n@@ -476,0 +485,14 @@\n+            this.addStressSeed = shouldAddStressSeed();\n+        }\n+\n+        private boolean shouldAddStressSeed() {\n+            \/\/ Prefer to add the explicit stress seed to aid reproducibility.\n+            \/\/ Support the case where user already passes the seed, probably\n+            \/\/ for replication.\n+            if (stress && STRESS_SEED_AVAILABLE) {\n+                for (String arg : args) {\n+                    if (arg.contains(\"-XX:StressSeed\")) return false;\n+                }\n+                return true;\n+            }\n+            return false;\n@@ -486,1 +509,1 @@\n-        public List<String> args() {\n+        public List<String> origArgs() {\n@@ -490,0 +513,10 @@\n+        public List<String> args() {\n+            if (addStressSeed) {\n+                List<String> na = new ArrayList<>(args);\n+                na.add(\"-XX:StressSeed=\" + SEED_RANDOM.nextInt(Integer.MAX_VALUE));\n+                return na;\n+            } else {\n+                return args;\n+            }\n+        }\n+\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/vm\/VMSupport.java","additions":38,"deletions":5,"binary":false,"changes":43,"status":"modified"}]}