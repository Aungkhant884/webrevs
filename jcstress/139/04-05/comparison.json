{"files":[{"patch":"@@ -41,0 +41,1 @@\n+    final AtomicInteger maxInflightTests;\n@@ -48,0 +49,1 @@\n+        this.maxInflightTests = new AtomicInteger();\n@@ -57,1 +59,2 @@\n-        inflightTests.incrementAndGet();\n+        int inflight = inflightTests.incrementAndGet();\n+        maxInflightTests.updateAndGet(x -> Math.max(x, inflight));\n@@ -65,4 +68,2 @@\n-        int testsInflight = inflightTests();\n-        if (testsInflight <= 0) {\n-            testsInflight = 1;\n-        }\n+        int parMult;\n+\n@@ -70,0 +71,15 @@\n+        int maxInflight = maxInflightTests.get();\n+\n+        if (testsLeft >= maxInflight) {\n+            \/\/ Parallel multiplier is at least the number of currently\n+            \/\/ running parallel tests.\n+            parMult = inflightTests();\n+            if (parMult <= 0) {\n+                parMult = 1;\n+            }\n+        } else {\n+            \/\/ If the last tests are running, we should not cut down\n+            \/\/ the test time unnecessarily.\n+            parMult = maxInflight;\n+        }\n+\n@@ -73,1 +89,1 @@\n-                timeLeft \/ testsLeft * testsInflight :\n+                timeLeft \/ testsLeft * parMult :\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/TimeBudget.java","additions":22,"deletions":6,"binary":false,"changes":28,"status":"modified"}]}