{"files":[{"patch":"@@ -54,0 +54,2 @@\n+        String triplet = \"P\" + packageId + \", C\" + coreId + \", T\" + threadId;\n+\n@@ -55,1 +57,1 @@\n-            throw new TopologyParseException(\"Package is not initialized: \" + packageId);\n+            throw new TopologyParseException(\"Package is not initialized: \" + triplet);\n@@ -59,1 +61,1 @@\n-            throw new TopologyParseException(\"Core is not initialized: \" + coreId);\n+            throw new TopologyParseException(\"Core is not initialized: \" + triplet);\n@@ -63,1 +65,1 @@\n-            throw new TopologyParseException(\"Thread is not initialized: \" + threadId);\n+            throw new TopologyParseException(\"Thread is not initialized: \" + triplet);\n@@ -70,1 +72,1 @@\n-            throw new TopologyParseException(\"Duplicate thread ID: \" + threadId);\n+            throw new TopologyParseException(\"Duplicate thread ID: \" + triplet);\n@@ -74,2 +76,3 @@\n-            if (!coreToPackage.get(coreId).equals(packageId)) {\n-                throw new TopologyParseException(\"Core belongs to different packages: \" + coreId);\n+            Integer ex = coreToPackage.get(coreId);\n+            if (!ex.equals(packageId)) {\n+                throw new TopologyParseException(\"Core belongs to different packages: \" + triplet + \", \" + ex);\n@@ -82,2 +85,3 @@\n-            if (!threadToPackage.get(threadId).equals(packageId)) {\n-                throw new TopologyParseException(\"Thread belongs to different packages: \" + packageId);\n+            Integer ex = threadToPackage.get(threadId);\n+            if (!ex.equals(packageId)) {\n+                throw new TopologyParseException(\"Thread belongs to different packages: \" + triplet + \", \" + ex);\n@@ -90,2 +94,3 @@\n-            if (!threadToCore.get(threadId).equals(coreId)) {\n-                throw new TopologyParseException(\"Thread belongs to different cores: \" + threadId);\n+            Integer ex = threadToCore.get(threadId);\n+            if (!ex.equals(coreId)) {\n+                throw new TopologyParseException(\"Thread belongs to different cores: \" + triplet + \", \" + ex);\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/os\/topology\/AbstractTopology.java","additions":15,"deletions":10,"binary":false,"changes":25,"status":"modified"},{"patch":"@@ -66,1 +66,14 @@\n-        List<List<Integer>> coreGroups = new ArrayList<>();\n+        \/\/ Parse the number of available CPUs\n+        int cpuCount = 0;\n+        try (DirectoryStream<Path> ds = Files.newDirectoryStream(root)) {\n+            for (Path d : ds) {\n+                if (!Files.isDirectory(d.resolve(\"topology\"))) continue;\n+\n+                String basename = d.getFileName().toString();\n+                if (basename.matches(\"cpu[0-9]+\")) {\n+                    cpuCount++;\n+                }\n+            }\n+        } catch (Exception e) {\n+            \/\/ Nothing to do\n+        }\n@@ -69,0 +82,1 @@\n+        List<List<Integer>> coreGroups = new ArrayList<>();\n@@ -120,1 +134,1 @@\n-                    add(packageId, packageId*packageCount + coreId, threadId);\n+                    add(packageId, packageId*cpuCount + coreId, threadId);\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/os\/topology\/LinuxSysfsTopology.java","additions":16,"deletions":2,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -104,0 +104,12 @@\n+    @Test\n+    public void test_Saved_7() throws IOException {\n+        String s = FileUtils.copyFileToTemp(\"\/topology\/cpuinfo-7.txt\", \"jcstress\", \"test\");\n+\n+        try {\n+            new LinuxProcfsTopology(s);\n+            Assert.fail(\"Should have failed\");\n+        } catch (TopologyParseException topo) {\n+            \/\/ Should fail\n+        }\n+    }\n+\n","filename":"jcstress-core\/src\/test\/java\/org\/openjdk\/jcstress\/os\/topology\/LinuxProcfsTopologyTest.java","additions":12,"deletions":0,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -149,0 +149,19 @@\n+    @Test\n+    public void test_Saved_7() throws TopologyParseException, IOException {\n+        FileSystem fs = parse(\"\/topology\/sysfs-7.txt\");\n+        LinuxSysfsTopology topo = new LinuxSysfsTopology(fs.getPath(\"\"));\n+\n+        Assert.assertEquals(2, topo.packagesPerSystem());\n+        Assert.assertEquals(4, topo.coresPerPackage());\n+        Assert.assertEquals(1, topo.threadsPerCore());\n+        Assert.assertEquals(8, topo.totalCores());\n+        Assert.assertEquals(8, topo.totalThreads());\n+\n+        for (int t = 0; t < topo.totalThreads(); t++) {\n+            Assert.assertEquals(t % 2, topo.threadToPackage(t));\n+            Assert.assertEquals((t % 2) * 4 + (t \/ 2), topo.threadToCore(t));\n+        }\n+\n+        checkGenericInvariants(topo);\n+    }\n+\n","filename":"jcstress-core\/src\/test\/java\/org\/openjdk\/jcstress\/os\/topology\/LinuxSysfsTopologyTest.java","additions":19,"deletions":0,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -0,0 +1,215 @@\n+processor\t: 0\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.096\n+cache size\t: 6144 KB\n+physical id\t: 0\n+siblings\t: 4\n+core id\t\t: 0\n+cpu cores\t: 4\n+apicid\t\t: 0\n+initial apicid\t: 0\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.19\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 1\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.095\n+cache size\t: 6144 KB\n+physical id\t: 1\n+siblings\t: 4\n+core id\t\t: 0\n+cpu cores\t: 4\n+apicid\t\t: 4\n+initial apicid\t: 4\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.26\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 2\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.096\n+cache size\t: 6144 KB\n+physical id\t: 0\n+siblings\t: 4\n+core id\t\t: 1\n+cpu cores\t: 4\n+apicid\t\t: 1\n+initial apicid\t: 1\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.19\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 3\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.096\n+cache size\t: 6144 KB\n+physical id\t: 1\n+siblings\t: 4\n+core id\t\t: 1\n+cpu cores\t: 4\n+apicid\t\t: 5\n+initial apicid\t: 5\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.26\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 4\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.095\n+cache size\t: 6144 KB\n+physical id\t: 0\n+siblings\t: 4\n+core id\t\t: 2\n+cpu cores\t: 4\n+apicid\t\t: 2\n+initial apicid\t: 2\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.19\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 5\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.096\n+cache size\t: 6144 KB\n+physical id\t: 1\n+siblings\t: 4\n+core id\t\t: 2\n+cpu cores\t: 4\n+apicid\t\t: 6\n+initial apicid\t: 6\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.26\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 6\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.095\n+cache size\t: 6144 KB\n+physical id\t: 0\n+siblings\t: 4\n+core id\t\t: 3\n+cpu cores\t: 4\n+apicid\t\t: 3\n+initial apicid\t: 3\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.19\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 7\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 23\n+model name\t: Intel(R) Xeon(R) CPU           E5440  @ 2.83GHz\n+stepping\t: 6\n+microcode\t: 0x60f\n+cpu MHz\t\t: 2826.096\n+cache size\t: 6144 KB\n+physical id\t: 1\n+siblings\t: 4\n+core id\t\t: 3\n+cpu cores\t: 4\n+apicid\t\t: 7\n+initial apicid\t: 7\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 10\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good nopl cpuid aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm dca sse4_1 lahf_lm pti tpr_shadow vnmi flexpriority dtherm\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 5652.26\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 38 bits physical, 48 bits virtual\n+power management:\n","filename":"jcstress-core\/src\/test\/resources\/topology\/cpuinfo-7.txt","additions":215,"deletions":0,"binary":false,"changes":215,"status":"added"},{"patch":"@@ -0,0 +1,104 @@\n+cpu0\/topology\/core_cpus: 01\n+cpu0\/topology\/core_cpus_list: 0\n+cpu0\/topology\/core_id: 0\n+cpu0\/topology\/core_siblings: 55\n+cpu0\/topology\/core_siblings_list: 0,2,4,6\n+cpu0\/topology\/die_cpus: 55\n+cpu0\/topology\/die_cpus_list: 0,2,4,6\n+cpu0\/topology\/die_id: 0\n+cpu0\/topology\/package_cpus: 55\n+cpu0\/topology\/package_cpus_list: 0,2,4,6\n+cpu0\/topology\/physical_package_id: 0\n+cpu0\/topology\/thread_siblings: 01\n+cpu0\/topology\/thread_siblings_list: 0\n+cpu1\/topology\/core_cpus: 02\n+cpu1\/topology\/core_cpus_list: 1\n+cpu1\/topology\/core_id: 0\n+cpu1\/topology\/core_siblings: aa\n+cpu1\/topology\/core_siblings_list: 1,3,5,7\n+cpu1\/topology\/die_cpus: aa\n+cpu1\/topology\/die_cpus_list: 1,3,5,7\n+cpu1\/topology\/die_id: 0\n+cpu1\/topology\/package_cpus: aa\n+cpu1\/topology\/package_cpus_list: 1,3,5,7\n+cpu1\/topology\/physical_package_id: 1\n+cpu1\/topology\/thread_siblings: 02\n+cpu1\/topology\/thread_siblings_list: 1\n+cpu2\/topology\/core_cpus: 04\n+cpu2\/topology\/core_cpus_list: 2\n+cpu2\/topology\/core_id: 1\n+cpu2\/topology\/core_siblings: 55\n+cpu2\/topology\/core_siblings_list: 0,2,4,6\n+cpu2\/topology\/die_cpus: 55\n+cpu2\/topology\/die_cpus_list: 0,2,4,6\n+cpu2\/topology\/die_id: 0\n+cpu2\/topology\/package_cpus: 55\n+cpu2\/topology\/package_cpus_list: 0,2,4,6\n+cpu2\/topology\/physical_package_id: 0\n+cpu2\/topology\/thread_siblings: 04\n+cpu2\/topology\/thread_siblings_list: 2\n+cpu3\/topology\/core_cpus: 08\n+cpu3\/topology\/core_cpus_list: 3\n+cpu3\/topology\/core_id: 1\n+cpu3\/topology\/core_siblings: aa\n+cpu3\/topology\/core_siblings_list: 1,3,5,7\n+cpu3\/topology\/die_cpus: aa\n+cpu3\/topology\/die_cpus_list: 1,3,5,7\n+cpu3\/topology\/die_id: 0\n+cpu3\/topology\/package_cpus: aa\n+cpu3\/topology\/package_cpus_list: 1,3,5,7\n+cpu3\/topology\/physical_package_id: 1\n+cpu3\/topology\/thread_siblings: 08\n+cpu3\/topology\/thread_siblings_list: 3\n+cpu4\/topology\/core_cpus: 10\n+cpu4\/topology\/core_cpus_list: 4\n+cpu4\/topology\/core_id: 2\n+cpu4\/topology\/core_siblings: 55\n+cpu4\/topology\/core_siblings_list: 0,2,4,6\n+cpu4\/topology\/die_cpus: 55\n+cpu4\/topology\/die_cpus_list: 0,2,4,6\n+cpu4\/topology\/die_id: 0\n+cpu4\/topology\/package_cpus: 55\n+cpu4\/topology\/package_cpus_list: 0,2,4,6\n+cpu4\/topology\/physical_package_id: 0\n+cpu4\/topology\/thread_siblings: 10\n+cpu4\/topology\/thread_siblings_list: 4\n+cpu5\/topology\/core_cpus: 20\n+cpu5\/topology\/core_cpus_list: 5\n+cpu5\/topology\/core_id: 2\n+cpu5\/topology\/core_siblings: aa\n+cpu5\/topology\/core_siblings_list: 1,3,5,7\n+cpu5\/topology\/die_cpus: aa\n+cpu5\/topology\/die_cpus_list: 1,3,5,7\n+cpu5\/topology\/die_id: 0\n+cpu5\/topology\/package_cpus: aa\n+cpu5\/topology\/package_cpus_list: 1,3,5,7\n+cpu5\/topology\/physical_package_id: 1\n+cpu5\/topology\/thread_siblings: 20\n+cpu5\/topology\/thread_siblings_list: 5\n+cpu6\/topology\/core_cpus: 40\n+cpu6\/topology\/core_cpus_list: 6\n+cpu6\/topology\/core_id: 3\n+cpu6\/topology\/core_siblings: 55\n+cpu6\/topology\/core_siblings_list: 0,2,4,6\n+cpu6\/topology\/die_cpus: 55\n+cpu6\/topology\/die_cpus_list: 0,2,4,6\n+cpu6\/topology\/die_id: 0\n+cpu6\/topology\/package_cpus: 55\n+cpu6\/topology\/package_cpus_list: 0,2,4,6\n+cpu6\/topology\/physical_package_id: 0\n+cpu6\/topology\/thread_siblings: 40\n+cpu6\/topology\/thread_siblings_list: 6\n+cpu7\/topology\/core_cpus: 80\n+cpu7\/topology\/core_cpus_list: 7\n+cpu7\/topology\/core_id: 3\n+cpu7\/topology\/core_siblings: aa\n+cpu7\/topology\/core_siblings_list: 1,3,5,7\n+cpu7\/topology\/die_cpus: aa\n+cpu7\/topology\/die_cpus_list: 1,3,5,7\n+cpu7\/topology\/die_id: 0\n+cpu7\/topology\/package_cpus: aa\n+cpu7\/topology\/package_cpus_list: 1,3,5,7\n+cpu7\/topology\/physical_package_id: 1\n+cpu7\/topology\/thread_siblings: 80\n+cpu7\/topology\/thread_siblings_list: 7\n","filename":"jcstress-core\/src\/test\/resources\/topology\/sysfs-7.txt","additions":104,"deletions":0,"binary":false,"changes":104,"status":"added"}]}