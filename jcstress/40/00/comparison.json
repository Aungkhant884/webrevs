{"files":[{"patch":"@@ -68,0 +68,1 @@\n+\n@@ -72,0 +73,24 @@\n+        if (coreToPackage.containsKey(coreId)) {\n+            if (!coreToPackage.get(coreId).equals(packageId)) {\n+                throw new TopologyParseException(\"Core belongs to different packages: \" + coreId);\n+            }\n+        } else {\n+            coreToPackage.put(coreId, packageId);\n+        }\n+\n+        if (threadToPackage.containsKey(threadId)) {\n+            if (!threadToPackage.get(threadId).equals(packageId)) {\n+                throw new TopologyParseException(\"Thread belongs to different packages: \" + packageId);\n+            }\n+        } else {\n+            threadToPackage.put(threadId, packageId);\n+        }\n+\n+        if (threadToCore.containsKey(threadId)) {\n+            if (!threadToCore.get(threadId).equals(coreId)) {\n+                throw new TopologyParseException(\"Thread belongs to different cores: \" + threadId);\n+            }\n+        } else {\n+            threadToCore.put(threadId, coreId);\n+        }\n+\n@@ -74,3 +99,0 @@\n-        coreToPackage.put(coreId, packageId);\n-        threadToPackage.put(threadId, packageId);\n-        threadToCore.put(threadId, coreId);\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/os\/topology\/AbstractTopology.java","additions":25,"deletions":3,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -94,0 +94,1 @@\n+        \/\/ Renumber packages here\n@@ -95,1 +96,1 @@\n-        int pIdx = 0;\n+        int packageCount = 0;\n@@ -98,1 +99,1 @@\n-                knownPackage.put(cg, pIdx++);\n+                knownPackage.put(cg, packageCount++);\n@@ -119,1 +120,1 @@\n-                    add(packageId, coreId, threadId);\n+                    add(packageId, packageId*packageCount + coreId, threadId);\n","filename":"jcstress-core\/src\/main\/java\/org\/openjdk\/jcstress\/os\/topology\/LinuxSysfsTopology.java","additions":4,"deletions":3,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -69,1 +69,1 @@\n-    public void test_Saved_4() throws IOException, TopologyParseException {\n+    public void test_Saved_4() throws IOException {\n@@ -71,1 +71,7 @@\n-        LinuxProcfsTopology topo = new LinuxProcfsTopology(s);\n+\n+        try {\n+            new LinuxProcfsTopology(s);\n+            Assert.fail(\"Should have failed\");\n+        } catch (TopologyParseException topo) {\n+            \/\/ Should fail\n+        }\n@@ -86,0 +92,12 @@\n+    @Test\n+    public void test_Saved_6() throws IOException {\n+        String s = FileUtils.copyFileToTemp(\"\/topology\/cpuinfo-6.txt\", \"jcstress\", \"test\");\n+\n+        try {\n+            new LinuxProcfsTopology(s);\n+            Assert.fail(\"Should have failed\");\n+        } catch (TopologyParseException topo) {\n+            \/\/ Should fail\n+        }\n+    }\n+\n","filename":"jcstress-core\/src\/test\/java\/org\/openjdk\/jcstress\/os\/topology\/LinuxProcfsTopologyTest.java","additions":20,"deletions":2,"binary":false,"changes":22,"status":"modified"},{"patch":"@@ -130,0 +130,19 @@\n+    @Test\n+    public void test_Saved_6() throws TopologyParseException, IOException {\n+        FileSystem fs = parse(\"\/topology\/sysfs-6.txt\");\n+        LinuxSysfsTopology topo = new LinuxSysfsTopology(fs.getPath(\"\"));\n+\n+        Assert.assertEquals(2,  topo.packagesPerSystem());\n+        Assert.assertEquals(1, topo.coresPerPackage());\n+        Assert.assertEquals(1,  topo.threadsPerCore());\n+        Assert.assertEquals(2, topo.totalCores());\n+        Assert.assertEquals(2, topo.totalThreads());\n+\n+        for (int t = 0; t < topo.totalThreads(); t++) {\n+            Assert.assertEquals(t, topo.threadToPackage(t));\n+            Assert.assertEquals(t, topo.threadToCore(t));\n+        }\n+\n+        checkGenericInvariants(topo);\n+    }\n+\n","filename":"jcstress-core\/src\/test\/java\/org\/openjdk\/jcstress\/os\/topology\/LinuxSysfsTopologyTest.java","additions":19,"deletions":0,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -0,0 +1,54 @@\n+processor\t: 0\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 42\n+model name\t: Intel Xeon E312xx (Sandy Bridge, IBRS update)\n+stepping\t: 1\n+microcode\t: 0x1\n+cpu MHz\t\t: 1999.999\n+cache size\t: 4096 KB\n+physical id\t: 0\n+siblings\t: 1\n+core id\t\t: 0\n+cpu cores\t: 1\n+apicid\t\t: 0\n+initial apicid\t: 0\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 13\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl cpuid tsc_known_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm pti ssbd ibrs ibpb stibp xsaveopt\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 3999.99\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 46 bits physical, 48 bits virtual\n+power management:\n+\n+processor\t: 1\n+vendor_id\t: GenuineIntel\n+cpu family\t: 6\n+model\t\t: 42\n+model name\t: Intel Xeon E312xx (Sandy Bridge, IBRS update)\n+stepping\t: 1\n+microcode\t: 0x1\n+cpu MHz\t\t: 1999.999\n+cache size\t: 4096 KB\n+physical id\t: 1\n+siblings\t: 1\n+core id\t\t: 0\n+cpu cores\t: 1\n+apicid\t\t: 1\n+initial apicid\t: 1\n+fpu\t\t: yes\n+fpu_exception\t: yes\n+cpuid level\t: 13\n+wp\t\t: yes\n+flags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl cpuid tsc_known_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx hypervisor lahf_lm pti ssbd ibrs ibpb stibp xsaveopt\n+bugs\t\t: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs itlb_multihit\n+bogomips\t: 3999.99\n+clflush size\t: 64\n+cache_alignment\t: 64\n+address sizes\t: 46 bits physical, 48 bits virtual\n+power management:\n+\n","filename":"jcstress-core\/src\/test\/resources\/topology\/cpuinfo-6.txt","additions":54,"deletions":0,"binary":false,"changes":54,"status":"added"},{"patch":"@@ -0,0 +1,26 @@\n+cpu1\/topology\/die_id: 0\n+cpu1\/topology\/physical_package_id: 1\n+cpu1\/topology\/core_cpus_list: 1\n+cpu1\/topology\/die_cpus_list: 1\n+cpu1\/topology\/core_siblings: 2\n+cpu1\/topology\/core_siblings_list: 1\n+cpu1\/topology\/package_cpus: 2\n+cpu1\/topology\/package_cpus_list: 1\n+cpu1\/topology\/die_cpus: 2\n+cpu1\/topology\/thread_siblings_list: 1\n+cpu1\/topology\/core_id: 0\n+cpu1\/topology\/core_cpus: 2\n+cpu1\/topology\/thread_siblings: 2\n+cpu0\/topology\/die_id: 0\n+cpu0\/topology\/physical_package_id: 0\n+cpu0\/topology\/core_cpus_list: 0\n+cpu0\/topology\/die_cpus_list: 0\n+cpu0\/topology\/core_siblings: 1\n+cpu0\/topology\/core_siblings_list: 0\n+cpu0\/topology\/package_cpus: 1\n+cpu0\/topology\/package_cpus_list: 0\n+cpu0\/topology\/die_cpus: 1\n+cpu0\/topology\/thread_siblings_list: 0\n+cpu0\/topology\/core_id: 0\n+cpu0\/topology\/core_cpus: 1\n+cpu0\/topology\/thread_siblings: 1\n","filename":"jcstress-core\/src\/test\/resources\/topology\/sysfs-6.txt","additions":26,"deletions":0,"binary":false,"changes":26,"status":"added"}]}