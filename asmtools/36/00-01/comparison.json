{"files":[{"patch":"@@ -37,0 +37,1 @@\n+    public static final String STDIN_SWITCH=\"-\";\n","filename":"src\/org\/openjdk\/asmtools\/Main.java","additions":1,"deletions":0,"binary":false,"changes":1,"status":"modified"},{"patch":"@@ -88,0 +88,10 @@\n+\n+    protected void addStdIn() {\n+        for (ToolInput toolInput: fileList) {\n+            if (toolInput instanceof ToolInput.StdinInput) {\n+                \/\/or throw?\n+                return;\n+            }\n+        }\n+        fileList.add(new ToolInput.StdinInput());\n+    }\n","filename":"src\/org\/openjdk\/asmtools\/common\/Tool.java","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -32,1 +32,0 @@\n-import java.util.ArrayList;\n@@ -207,0 +206,4 @@\n+                    case org.openjdk.asmtools.Main.STDIN_SWITCH -> {\n+                        addStdIn();\n+                        break;\n+                    }\n@@ -218,2 +221,3 @@\n-            if (fileList.size() == 0) {\n-                fileList.add(new ToolInput.StdinInput());\n+            if (fileList.isEmpty()) {\n+                usage();\n+                System.exit(FAILED);\n","filename":"src\/org\/openjdk\/asmtools\/jasm\/Main.java","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -151,0 +151,4 @@\n+                    case org.openjdk.asmtools.Main.STDIN_SWITCH -> {\n+                        addStdIn();\n+                        break;\n+                    }\n@@ -162,2 +166,3 @@\n-            if (fileList.size() == 0) {\n-                fileList.add(new ToolInput.StdinInput());\n+            if (fileList.isEmpty()) {\n+                usage();\n+                System.exit(FAILED);\n","filename":"src\/org\/openjdk\/asmtools\/jcoder\/Main.java","additions":7,"deletions":2,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -29,1 +29,0 @@\n-import java.util.ArrayList;\n@@ -115,0 +114,3 @@\n+                case org.openjdk.asmtools.Main.STDIN_SWITCH:\n+                    addStdIn();\n+                    break;\n@@ -126,1 +128,2 @@\n-            fileList.add(new ToolInput.StdinInput());\n+            usage();\n+            System.exit(FAILED);\n","filename":"src\/org\/openjdk\/asmtools\/jdec\/Main.java","additions":5,"deletions":2,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -150,0 +150,3 @@\n+                case org.openjdk.asmtools.Main.STDIN_SWITCH:\n+                    addStdIn();\n+                    break;\n@@ -164,1 +167,2 @@\n-            fileList.add(new ToolInput.StdinInput());\n+            usage();\n+            System.exit(FAILED);\n","filename":"src\/org\/openjdk\/asmtools\/jdis\/Main.java","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -0,0 +1,23 @@\n+package org.openjdk.asmtools;\n+\n+import org.junit.jupiter.api.Assertions;\n+\n+import java.io.File;\n+import java.util.regex.Pattern;\n+\n+public class ClassPathClassWork {\n+\n+    protected static Class clazz;\n+    protected static String classFile;\n+    protected static Pattern className;\n+    protected static Pattern packageName;\n+\n+    public static void initClassData(Class testsClass) {\n+        clazz = testsClass;\n+        classFile = \".\/target\/classes\/\" + clazz.getName().replace('.', '\/') + \".class\";\n+        Assertions.assertTrue(new File(classFile).exists());\n+        className  = Pattern.compile(\"public .*class .*\" + clazz.getSimpleName() + \" extends .*\");\n+        packageName = Pattern.compile(\"package \"+clazz.getPackageName() + \";\");\n+    }\n+\n+}\n","filename":"test\/org\/openjdk\/asmtools\/ClassPathClassWork.java","additions":23,"deletions":0,"binary":false,"changes":23,"status":"added"},{"patch":"@@ -4,0 +4,1 @@\n+import org.junit.jupiter.api.BeforeAll;\n@@ -5,0 +6,1 @@\n+import org.openjdk.asmtools.ClassPathClassWork;\n@@ -7,1 +9,0 @@\n-import java.io.ByteArrayOutputStream;\n@@ -12,1 +13,1 @@\n-import java.io.PrintWriter;\n+import java.util.regex.Pattern;\n@@ -14,1 +15,6 @@\n-class MainTest {\n+class MainTest extends ClassPathClassWork {\n+\n+    @BeforeAll\n+    public static void prepareClass() {\n+        initClassData(org.openjdk.asmtools.jdec.Main.class);\n+    }\n@@ -33,1 +39,1 @@\n-        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), \".\/target\/classes\/org\/openjdk\/asmtools\/jdec\/Main.class\");\n+        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), classFile);\n@@ -46,1 +52,1 @@\n-        File in =  new File(\".\/target\/classes\/org\/openjdk\/asmtools\/jdec\/Main.class\");\n+        File in =  new File(classFile);\n@@ -50,1 +56,1 @@\n-            Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput());\n+            Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), org.openjdk.asmtools.Main.STDIN_SWITCH);\n","filename":"test\/org\/openjdk\/asmtools\/jdec\/MainTest.java","additions":12,"deletions":6,"binary":false,"changes":18,"status":"modified"},{"patch":"@@ -4,0 +4,1 @@\n+import org.junit.jupiter.api.BeforeAll;\n@@ -5,0 +6,1 @@\n+import org.openjdk.asmtools.ClassPathClassWork;\n@@ -14,1 +16,6 @@\n-class MainTest {\n+class MainTest extends ClassPathClassWork {\n+\n+    @BeforeAll\n+    public static void prepareClass() {\n+        initClassData(org.openjdk.asmtools.jdis.Main.class);\n+    }\n@@ -33,1 +40,1 @@\n-        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), \".\/target\/classes\/org\/openjdk\/asmtools\/jdis\/Main.class\");\n+        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), classFile);\n@@ -41,0 +48,2 @@\n+        Assertions.assertEquals(1, packageName.matcher(outs.getToolBos()).results().count());\n+        Assertions.assertEquals(1, className.matcher(outs.getToolBos()).results().count());\n@@ -46,1 +55,1 @@\n-        File in =  new File(\".\/target\/classes\/org\/openjdk\/asmtools\/jdis\/Main.class\");\n+        File in = new File(classFile);\n@@ -50,1 +59,1 @@\n-            Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput());\n+            Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), org.openjdk.asmtools.Main.STDIN_SWITCH);\n@@ -58,1 +67,3 @@\n-        }finally {\n+            Assertions.assertEquals(1, packageName.matcher(outs.getToolBos()).results().count());\n+            Assertions.assertEquals(1, className.matcher(outs.getToolBos()).results().count());\n+        } finally {\n@@ -63,1 +74,0 @@\n-\n@@ -67,1 +77,1 @@\n-        String testClazz = \"org\/openjdk\/asmtools\/jdis\/Main\";\n+        String testClazz = clazz.getName().replace('.', '\/');\n@@ -69,1 +79,1 @@\n-        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), \".\/target\/classes\/\" + testClazz + \".class\");\n+        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), classFile);\n@@ -117,0 +127,23 @@\n+    @Test\n+    public void mainBothFileAndStreamIsRead() throws IOException {\n+        ThreeStringWriters outs = new ThreeStringWriters();\n+        File in = new File(classFile);\n+        InputStream is = System.in;\n+        try {\n+            System.setIn(new FileInputStream(in));\n+            Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), classFile, org.openjdk.asmtools.Main.STDIN_SWITCH, classFile, org.openjdk.asmtools.Main.STDIN_SWITCH);\n+            int i = decoder.disasm();\n+            outs.flush();\n+            Assertions.assertEquals(0, i);\n+            Assertions.assertFalse(outs.getToolBos().isEmpty());\n+            Assertions.assertTrue(outs.getErrorBos().isEmpty());\n+            Assertions.assertTrue(outs.getLoggerBos().isEmpty());\n+            Assertions.assertTrue(outs.getToolBos().contains(\"invoke\"));\n+            \/\/3, both files, but stream only once, despite two are sets\n+            Assertions.assertEquals(3, packageName.matcher(outs.getToolBos()).results().count());\n+            Assertions.assertEquals(3, className.matcher(outs.getToolBos()).results().count());\n+        } finally {\n+            System.setIn(is);\n+        }\n+    }\n+\n","filename":"test\/org\/openjdk\/asmtools\/jdis\/MainTest.java","additions":41,"deletions":8,"binary":false,"changes":49,"status":"modified"}]}