{"files":[{"patch":"@@ -7,0 +7,1 @@\n+import java.io.File;\n@@ -8,0 +9,2 @@\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n@@ -42,1 +45,3 @@\n-        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), \".\/target\/classes\/org\/openjdk\/asmtools\/jdis\/Main.class\");\n+        String testClazz = \"org\/openjdk\/asmtools\/jdis\/Main\";\n+        String name = testClazz.replaceAll(\".*\/\", \"\");\n+        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), \".\/target\/classes\/\" + testClazz + \".class\");\n@@ -50,2 +55,2 @@\n-        for(String line: clazz.split(\"\\n\")) {\n-            if (line.contains(\"class Main extends JdisTool\")){\n+        for (String line : clazz.split(\"\\n\")) {\n+            if (line.contains(\"class \" + name + \" extends JdisTool\")) {\n@@ -53,0 +58,31 @@\n+                checkSupperIsOmitedIfNotPresent(clazz, testClazz);\n+                return;\n+            }\n+        }\n+        Assertions.assertTrue(false, \"class Main was not found in disassembled output\");\n+    }\n+\n+    private void checkSupperIsOmitedIfNotPresent(String clazzWithSuper, String fqn) throws IOException {\n+        String name = fqn.replaceAll(\".*\/\", \"\");\n+        String classWithoutSuper = clazzWithSuper.replaceFirst(\" super \", \" \");\n+        File sourceWithoutSuper = File.createTempFile(\"jasmTest\", name + \".java\");\n+        sourceWithoutSuper.deleteOnExit();\n+        Files.write(sourceWithoutSuper.toPath(), classWithoutSuper.getBytes(StandardCharsets.UTF_8));\n+        File dir = File.createTempFile(\"asmtools-jasmtest\", \"tmp.dir\");\n+        dir.delete();\n+        dir.mkdir();\n+        dir.deleteOnExit();\n+        org.openjdk.asmtools.jasm.Main jasmTool = new org.openjdk.asmtools.jasm.Main(sourceWithoutSuper.getAbsolutePath(), \"-d\", dir.getAbsolutePath());\n+        jasmTool.compile();\n+        ThreeStringWriters outs = new ThreeStringWriters();\n+        Main decoder = new Main(outs.getToolOutput(), outs.getErrorOutput(), outs.getLoggerOutput(), dir.getAbsolutePath() + \"\/\" + fqn + \".class\");\n+        int i = decoder.disasm();\n+        outs.flush();\n+        Assertions.assertEquals(0, i);\n+        Assertions.assertFalse(outs.getToolBos().isEmpty());\n+        Assertions.assertTrue(outs.getErrorBos().isEmpty());\n+        Assertions.assertTrue(outs.getLoggerBos().isEmpty());\n+        String clazz = outs.getToolBos();\n+        for (String line : clazz.split(\"\\n\")) {\n+            if (line.contains(\"class \" + name + \" extends JdisTool\")) {\n+                Assertions.assertFalse(line.contains(\"super\"), \"class declaration had NOT super omitted - \" + line);\n","filename":"test\/org\/openjdk\/asmtools\/jdis\/MainTest.java","additions":39,"deletions":3,"binary":false,"changes":42,"status":"modified"}]}