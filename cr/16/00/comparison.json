{"files":[{"patch":"@@ -230,4 +230,8 @@\n-        if (state.head.content[state.index] === null || state.base.content[state.index] === null) {\n-            const content = fetchFileContent(state);\n-            state.head.content[state.index] = content.head;\n-            state.base.content[state.index] = content.base;\n+        if (state.comparison.files[state.index].binary === false) {\n+            if (state.head.content[state.index] === null || state.base.content[state.index] === null) {\n+                const content = fetchFileContent(state);\n+                if (content != null) {\n+                    state.head.content[state.index] = content.head;\n+                    state.base.content[state.index] = content.base;\n+                }\n+            }\n@@ -405,34 +409,44 @@\n-            const cdiff = create(\"a\");\n-            cdiff.href = \"#cdiff-\" + i + \"-\" + filename;\n-            cdiff.innerHTML = \"Cdiffs\";\n-            code.append(cdiff, \" \");\n-\n-            const udiff = create(\"a\");\n-            udiff.href = \"#udiff-\" + i + \"-\" + filename;\n-            udiff.innerHTML = \"Udiffs\";\n-            code.append(udiff, \" \");\n-\n-            const sdiff = create(\"a\");\n-            sdiff.href = \"#sdiff-\" + i + \"-\" + filename;\n-            sdiff.innerHTML = \"Sdiffs\";\n-            code.append(sdiff, \" \");\n-\n-            const frames = create(\"a\");\n-            frames.href = \"#frames-\" + i + \"-\" + filename;\n-            frames.innerHTML = \"Frames\";\n-            code.append(frames, \" \");\n-\n-            const oldFile = create(\"a\");\n-            oldFile.href = \"#old-\" + i + \"-\" + filename;\n-            oldFile.innerHTML = \"Old\";\n-            code.append(oldFile, \" \");\n-\n-            const newFile = create(\"a\");\n-            newFile.href = \"#new-\" + i + \"-\" + filename;\n-            newFile.innerHTML = \"New\";\n-            code.append(newFile, \" \");\n-\n-            const patchFile = create(\"a\");\n-            patchFile.href = \"#patch-\" + i + \"-\" + filename;\n-            patchFile.innerHTML = \"Patch\";\n-            code.append(patchFile, \" \");\n+            if (file.binary === true) {\n+                code.append(\"------ \");\n+                code.append(\"------ \");\n+                code.append(\"------ \");\n+                code.append(\"------ \");\n+                code.append(\"--- \");\n+                code.append(\"--- \");\n+                code.append(\"----- \");\n+            } else {\n+                const cdiff = create(\"a\");\n+                cdiff.href = \"#cdiff-\" + i + \"-\" + filename;\n+                cdiff.innerHTML = \"Cdiffs\";\n+                code.append(cdiff, \" \");\n+\n+                const udiff = create(\"a\");\n+                udiff.href = \"#udiff-\" + i + \"-\" + filename;\n+                udiff.innerHTML = \"Udiffs\";\n+                code.append(udiff, \" \");\n+\n+                const sdiff = create(\"a\");\n+                sdiff.href = \"#sdiff-\" + i + \"-\" + filename;\n+                sdiff.innerHTML = \"Sdiffs\";\n+                code.append(sdiff, \" \");\n+\n+                const frames = create(\"a\");\n+                frames.href = \"#frames-\" + i + \"-\" + filename;\n+                frames.innerHTML = \"Frames\";\n+                code.append(frames, \" \");\n+\n+                const oldFile = create(\"a\");\n+                oldFile.href = \"#old-\" + i + \"-\" + filename;\n+                oldFile.innerHTML = \"Old\";\n+                code.append(oldFile, \" \");\n+\n+                const newFile = create(\"a\");\n+                newFile.href = \"#new-\" + i + \"-\" + filename;\n+                newFile.innerHTML = \"New\";\n+                code.append(newFile, \" \");\n+\n+                const patchFile = create(\"a\");\n+                patchFile.href = \"#patch-\" + i + \"-\" + filename;\n+                patchFile.innerHTML = \"Patch\";\n+                code.append(patchFile, \" \");\n+            }\n@@ -464,9 +478,14 @@\n-            const newFile = create(\"a\");\n-            newFile.href = \"#new-\" + i + \"-\" + filename;\n-            newFile.innerHTML = \"New\";\n-            code.append(newFile, \" \");\n-\n-            const patchFile = create(\"a\");\n-            patchFile.href = \"#patch-\" + i + \"-\" + filename;\n-            patchFile.innerHTML = \"Patch\";\n-            code.append(patchFile, \" \");\n+            if (file.binary === true) {\n+                code.append(\"--- \");\n+                code.append(\"----- \");\n+            } else {\n+                const newFile = create(\"a\");\n+                newFile.href = \"#new-\" + i + \"-\" + filename;\n+                newFile.innerHTML = \"New\";\n+                code.append(newFile, \" \");\n+\n+                const patchFile = create(\"a\");\n+                patchFile.href = \"#patch-\" + i + \"-\" + filename;\n+                patchFile.innerHTML = \"Patch\";\n+                code.append(patchFile, \" \");\n+            }\n@@ -492,13 +511,20 @@\n-            const oldFile = create(\"a\");\n-            oldFile.href = \"#old-\" + i + \"-\" + filename;\n-            oldFile.innerHTML = \"Old\";\n-            code.append(oldFile, \" \");\n-\n-            code.append(\"--- \");\n-\n-            const patchFile = create(\"a\");\n-            patchFile.href = \"#patch-\" + i + \"-\" + filename;\n-            patchFile.innerHTML = \"Patch\";\n-            code.append(patchFile, \" \");\n-\n-            code.append(\"--- \");\n+            if (file.binary === true) {\n+                code.append(\"--- \");\n+                code.append(\"--- \");\n+                code.append(\"----- \");\n+                code.append(\"--- \");\n+            } else {\n+                const oldFile = create(\"a\");\n+                oldFile.href = \"#old-\" + i + \"-\" + filename;\n+                oldFile.innerHTML = \"Old\";\n+                code.append(oldFile, \" \");\n+\n+                code.append(\"--- \");\n+\n+                const patchFile = create(\"a\");\n+                patchFile.href = \"#patch-\" + i + \"-\" + filename;\n+                patchFile.innerHTML = \"Patch\";\n+                code.append(patchFile, \" \");\n+\n+                code.append(\"--- \");\n+            }\n@@ -1480,12 +1506,25 @@\n-    let srcStart = 0;\n-    let srcLines = new Array();\n-    let dstStart = 0;\n-    let dstLines = new Array();\n-    let isBefore = true;\n-\n-    const lines = patch.split('\\n');\n-    const end = patch.endsWith('\\n') ? lines.length - 1 : lines.length;\n-    for (let i = 0; i < end; i++) {\n-        const line = lines[i];\n-        if (line.startsWith(\"@@\")) {\n-            if (srcLines.length > 0 || dstLines.length > 0) {\n+    if (patch != null) {\n+        let srcStart = 0;\n+        let srcLines = new Array();\n+        let dstStart = 0;\n+        let dstLines = new Array();\n+        let isBefore = true;\n+\n+        const lines = patch.split('\\n');\n+        const end = patch.endsWith('\\n') ? lines.length - 1 : lines.length;\n+        for (let i = 0; i < end; i++) {\n+            const line = lines[i];\n+            if (line.startsWith(\"@@\")) {\n+                if (srcLines.length > 0 || dstLines.length > 0) {\n+                    hunks.push(new Hunk(srcStart, srcLines, dstStart, dstLines));\n+                }\n+\n+                const parts = line.split(' ');\n+                srcStart = Number(parseRange(parts[1]).start);\n+                dstStart = Number(parseRange(parts[2]).start);\n+                srcLines = new Array();\n+                dstLines = new Array();\n+            } else if (line.startsWith(' ') && !isBefore) {\n+                while (i < lines.length && lines[i].startsWith(' ')) {\n+                    i++;\n+                }\n@@ -1493,1 +1532,10 @@\n-            }\n+                srcStart = srcStart + srcLines.length;\n+                srcLines = new Array();\n+                dstStart = dstStart + dstLines.length;\n+                dstLines = new Array();\n+            } else if (line.startsWith(' ') && isBefore) {\n+                srcStart++;\n+                dstStart++;\n+            } else if (line.startsWith('-')) {\n+                isBefore = false;\n+                srcLines.push(line);\n@@ -1495,8 +1543,9 @@\n-            const parts = line.split(' ');\n-            srcStart = Number(parseRange(parts[1]).start);\n-            dstStart = Number(parseRange(parts[2]).start);\n-            srcLines = new Array();\n-            dstLines = new Array();\n-        } else if (line.startsWith(' ') && !isBefore) {\n-            while (i < lines.length && lines[i].startsWith(' ')) {\n-                i++;\n+            } else if (line.startsWith('+')) {\n+                isBefore = false;\n+                dstLines.push(line);\n+            } else if (line.startsWith(\"\\\\ No newline at end of file\")) {\n+                continue;\n+            } else if (line === \"\") {\n+                continue;\n+            } else {\n+                throw \"Unexpected content on line \" + i + \": '\" + line + \"'\";\n@@ -1504,21 +1553,0 @@\n-            hunks.push(new Hunk(srcStart, srcLines, dstStart, dstLines));\n-            srcStart = srcStart + srcLines.length;\n-            srcLines = new Array();\n-            dstStart = dstStart + dstLines.length;\n-            dstLines = new Array();\n-        } else if (line.startsWith(' ') && isBefore) {\n-            srcStart++;\n-            dstStart++;\n-        } else if (line.startsWith('-')) {\n-            isBefore = false;\n-            srcLines.push(line);\n-\n-        } else if (line.startsWith('+')) {\n-            isBefore = false;\n-            dstLines.push(line);\n-        } else if (line.startsWith(\"\\\\ No newline at end of file\")) {\n-            continue;\n-        } else if (line === \"\") {\n-            continue;\n-        } else {\n-            throw \"Unexpected content on line \" + i + \": '\" + line + \"'\";\n@@ -1526,1 +1554,0 @@\n-    }\n@@ -1528,3 +1555,4 @@\n-    \/\/ The last hunk did not have context after\n-    if (srcLines.length > 0 || dstLines.length > 0) {\n-        hunks.push(new Hunk(srcStart, srcLines, dstStart, dstLines));\n+        \/\/ The last hunk did not have context after\n+        if (srcLines.length > 0 || dstLines.length > 0) {\n+            hunks.push(new Hunk(srcStart, srcLines, dstStart, dstLines));\n+        }\n@@ -1680,4 +1708,8 @@\n-        state.index = i;\n-        const content = fetchFileContent(state);\n-        state.head.content[i] = content.head;\n-        state.base.content[i] = content.base;\n+        if (state.comparison.files[i].binary === false) {\n+            state.index = i;\n+            const content = fetchFileContent(state);\n+            if (content != null) {\n+                state.head.content[i] = content.head;\n+                state.base.content[i] = content.base;\n+            }\n+        }\n","filename":"index.html","additions":142,"deletions":110,"binary":false,"changes":252,"status":"modified"}]}