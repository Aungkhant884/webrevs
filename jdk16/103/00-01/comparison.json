{"files":[{"patch":"@@ -307,0 +307,10 @@\n+void* VtableBlob::operator new(size_t s, unsigned size) throw() {\n+  \/\/ Handling of allocation failure stops compilation and prints a bunch of\n+  \/\/ stuff, which requires unlocking the CodeCache_lock, so that the Compile_lock\n+  \/\/ can be locked, and then re-locking the CodeCache_lock. That is not safe in\n+  \/\/ this context as we hold the CompiledICLocker. So we just don't handle code\n+  \/\/ cache exhaustion here; we leave that for a later allocation that does not\n+  \/\/ hold the CompiledICLocker.\n+  return CodeCache::allocate(size, CodeBlobType::NonNMethod, false \/* handle_alloc_failure *\/);\n+}\n+\n","filename":"src\/hotspot\/share\/code\/codeBlob.cpp","additions":10,"deletions":0,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -444,0 +444,2 @@\n+  void* operator new(size_t s, unsigned size) throw();\n+\n","filename":"src\/hotspot\/share\/code\/codeBlob.hpp","additions":2,"deletions":0,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -486,1 +486,1 @@\n-CodeBlob* CodeCache::allocate(int size, int code_blob_type, int orig_code_blob_type) {\n+CodeBlob* CodeCache::allocate(int size, int code_blob_type, bool handle_alloc_failure, int orig_code_blob_type) {\n@@ -534,1 +534,1 @@\n-          return allocate(size, type, orig_code_blob_type);\n+          return allocate(size, type, handle_alloc_failure, orig_code_blob_type);\n@@ -537,2 +537,4 @@\n-      MutexUnlocker mu(CodeCache_lock, Mutex::_no_safepoint_check_flag);\n-      CompileBroker::handle_full_code_cache(orig_code_blob_type);\n+      if (handle_alloc_failure) {\n+        MutexUnlocker mu(CodeCache_lock, Mutex::_no_safepoint_check_flag);\n+        CompileBroker::handle_full_code_cache(orig_code_blob_type);\n+      }\n","filename":"src\/hotspot\/share\/code\/codeCache.cpp","additions":6,"deletions":4,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -139,1 +139,1 @@\n-  static CodeBlob* allocate(int size, int code_blob_type, int orig_code_blob_type = CodeBlobType::All); \/\/ allocates a new CodeBlob\n+  static CodeBlob* allocate(int size, int code_blob_type, bool handle_alloc_failure = true, int orig_code_blob_type = CodeBlobType::All); \/\/ allocates a new CodeBlob\n","filename":"src\/hotspot\/share\/code\/codeCache.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}