{"files":[{"patch":"@@ -97,1 +97,2 @@\n-  GCForwarding::begin_region(0, _num_marked_objects);\n+  GCForwarding::begin_region(0, _young_marked_objects);\n+  GCForwarding::begin_region(1, _old_marked_objects);\n@@ -189,1 +190,2 @@\n-  _num_marked_objects = 0;\n+  _young_marked_objects = 0;\n+  _old_marked_objects = 0;\n","filename":"src\/hotspot\/share\/gc\/serial\/genMarkSweep.cpp","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -32,0 +32,1 @@\n+#include \"gc\/shared\/genCollectedHeap.hpp\"\n@@ -206,1 +207,5 @@\n-  _num_marked_objects++;\n+  if (GenCollectedHeap::heap()->is_in_young(obj)) {\n+    _young_marked_objects++;\n+  } else {\n+    _old_marked_objects++;\n+  }\n@@ -262,1 +267,2 @@\n-size_t MarkSweep::_num_marked_objects = 0;\n+size_t MarkSweep::_young_marked_objects = 0;\n+size_t MarkSweep::_old_marked_objects = 0;\n","filename":"src\/hotspot\/share\/gc\/serial\/markSweep.cpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -118,1 +118,2 @@\n-  static size_t _num_marked_objects;\n+  static size_t _young_marked_objects;\n+  static size_t _old_marked_objects;\n","filename":"src\/hotspot\/share\/gc\/serial\/markSweep.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -87,1 +87,1 @@\n-    assert(UseG1GC || UseSerialGC, \"happens only with G1 serial compaction\");\n+    assert(UseG1GC, \"happens only with G1 serial compaction\");\n","filename":"src\/hotspot\/share\/gc\/shared\/forwardingTable.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -106,1 +106,5 @@\n-  GCForwarding::initialize([](const void*) -> size_t { return 0; }, 1);\n+  auto addr_to_idx = [](const void* addr) {\n+    if (GenCollectedHeap::heap()->is_in_young(addr)) return (size_t)0;\n+    else return (size_t)1;\n+  };\n+  GCForwarding::initialize(addr_to_idx, 2);\n","filename":"src\/hotspot\/share\/gc\/shared\/genCollectedHeap.cpp","additions":5,"deletions":1,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -33,2 +33,2 @@\n-  oop obj;\n-  ASSERT_EQ(ft.forwardee(obj), nullptr);\n+  oopDesc obj;\n+  ASSERT_EQ(ft.forwardee(&obj), nullptr);\n@@ -42,4 +42,4 @@\n-  oop obj1;\n-  oop obj2;\n-  ft.forward_to(obj1, obj2);\n-  ASSERT_EQ(ft.forwardee(obj1), obj2);\n+  oopDesc obj1;\n+  oopDesc obj2;\n+  ft.forward_to(&obj1, &obj2);\n+  ASSERT_EQ(ft.forwardee(&obj1), cast_to_oop(&obj2));\n@@ -53,22 +53,22 @@\n-  oop obj0;  oop obj1;  oop obj2;  oop obj3;  oop obj4;  oop obj5;  oop obj6;  oop obj7;  oop obj8;  oop obj9;\n-  oop obj0_; oop obj1_; oop obj2_; oop obj3_; oop obj4_; oop obj5_; oop obj6_; oop obj7_; oop obj8_; oop obj9_;\n-  ft.forward_to(obj0, obj0_);\n-  ft.forward_to(obj1, obj1_);\n-  ft.forward_to(obj2, obj2_);\n-  ft.forward_to(obj3, obj3_);\n-  ft.forward_to(obj4, obj4_);\n-  ft.forward_to(obj5, obj5_);\n-  ft.forward_to(obj6, obj6_);\n-  ft.forward_to(obj7, obj7_);\n-  ft.forward_to(obj8, obj8_);\n-  ft.forward_to(obj9, obj9_);\n-  ASSERT_EQ(ft.forwardee(obj0), obj0_);\n-  ASSERT_EQ(ft.forwardee(obj1), obj1_);\n-  ASSERT_EQ(ft.forwardee(obj2), obj2_);\n-  ASSERT_EQ(ft.forwardee(obj3), obj3_);\n-  ASSERT_EQ(ft.forwardee(obj4), obj4_);\n-  ASSERT_EQ(ft.forwardee(obj5), obj5_);\n-  ASSERT_EQ(ft.forwardee(obj6), obj6_);\n-  ASSERT_EQ(ft.forwardee(obj7), obj7_);\n-  ASSERT_EQ(ft.forwardee(obj8), obj8_);\n-  ASSERT_EQ(ft.forwardee(obj9), obj9_);\n+  oopDesc obj0,  obj1,  obj2,  obj3,  obj4,  obj5,  obj6,  obj7,  obj8,  obj9;\n+  oopDesc obj0_, obj1_, obj2_, obj3_, obj4_, obj5_, obj6_, obj7_, obj8_, obj9_;\n+  ft.forward_to(&obj0, &obj0_);\n+  ft.forward_to(&obj1, &obj1_);\n+  ft.forward_to(&obj2, &obj2_);\n+  ft.forward_to(&obj3, &obj3_);\n+  ft.forward_to(&obj4, &obj4_);\n+  ft.forward_to(&obj5, &obj5_);\n+  ft.forward_to(&obj6, &obj6_);\n+  ft.forward_to(&obj7, &obj7_);\n+  ft.forward_to(&obj8, &obj8_);\n+  ft.forward_to(&obj9, &obj9_);\n+  ASSERT_EQ(ft.forwardee(&obj0), cast_to_oop(&obj0_));\n+  ASSERT_EQ(ft.forwardee(&obj1), cast_to_oop(&obj1_));\n+  ASSERT_EQ(ft.forwardee(&obj2), cast_to_oop(&obj2_));\n+  ASSERT_EQ(ft.forwardee(&obj3), cast_to_oop(&obj3_));\n+  ASSERT_EQ(ft.forwardee(&obj4), cast_to_oop(&obj4_));\n+  ASSERT_EQ(ft.forwardee(&obj5), cast_to_oop(&obj5_));\n+  ASSERT_EQ(ft.forwardee(&obj6), cast_to_oop(&obj6_));\n+  ASSERT_EQ(ft.forwardee(&obj7), cast_to_oop(&obj7_));\n+  ASSERT_EQ(ft.forwardee(&obj8), cast_to_oop(&obj8_));\n+  ASSERT_EQ(ft.forwardee(&obj9), cast_to_oop(&obj9_));\n@@ -83,22 +83,22 @@\n-  oop obj0;  oop obj1;  oop obj2;  oop obj3;  oop obj4;  oop obj5;  oop obj6;  oop obj7;  oop obj8;  oop obj9;\n-  oop obj0_; oop obj1_; oop obj2_; oop obj3_; oop obj4_; oop obj5_; oop obj6_; oop obj7_; oop obj8_; oop obj9_;\n-  ft.forward_to(obj9, obj9_);\n-  ft.forward_to(obj8, obj8_);\n-  ft.forward_to(obj7, obj7_);\n-  ft.forward_to(obj6, obj6_);\n-  ft.forward_to(obj5, obj5_);\n-  ft.forward_to(obj4, obj4_);\n-  ft.forward_to(obj3, obj3_);\n-  ft.forward_to(obj2, obj2_);\n-  ft.forward_to(obj1, obj1_);\n-  ft.forward_to(obj0, obj0_);\n-  ASSERT_EQ(ft.forwardee(obj0), obj0_);\n-  ASSERT_EQ(ft.forwardee(obj1), obj1_);\n-  ASSERT_EQ(ft.forwardee(obj2), obj2_);\n-  ASSERT_EQ(ft.forwardee(obj3), obj3_);\n-  ASSERT_EQ(ft.forwardee(obj4), obj4_);\n-  ASSERT_EQ(ft.forwardee(obj5), obj5_);\n-  ASSERT_EQ(ft.forwardee(obj6), obj6_);\n-  ASSERT_EQ(ft.forwardee(obj7), obj7_);\n-  ASSERT_EQ(ft.forwardee(obj8), obj8_);\n-  ASSERT_EQ(ft.forwardee(obj9), obj9_);\n+  oopDesc obj0,  obj1,  obj2,  obj3,  obj4,  obj5,  obj6,  obj7,  obj8,  obj9;\n+  oopDesc obj0_, obj1_, obj2_, obj3_, obj4_, obj5_, obj6_, obj7_, obj8_, obj9_;\n+  ft.forward_to(&obj9, &obj9_);\n+  ft.forward_to(&obj8, &obj8_);\n+  ft.forward_to(&obj7, &obj7_);\n+  ft.forward_to(&obj6, &obj6_);\n+  ft.forward_to(&obj5, &obj5_);\n+  ft.forward_to(&obj4, &obj4_);\n+  ft.forward_to(&obj3, &obj3_);\n+  ft.forward_to(&obj2, &obj2_);\n+  ft.forward_to(&obj1, &obj1_);\n+  ft.forward_to(&obj0, &obj0_);\n+  ASSERT_EQ(ft.forwardee(&obj0), cast_to_oop(&obj0_));\n+  ASSERT_EQ(ft.forwardee(&obj1), cast_to_oop(&obj1_));\n+  ASSERT_EQ(ft.forwardee(&obj2), cast_to_oop(&obj2_));\n+  ASSERT_EQ(ft.forwardee(&obj3), cast_to_oop(&obj3_));\n+  ASSERT_EQ(ft.forwardee(&obj4), cast_to_oop(&obj4_));\n+  ASSERT_EQ(ft.forwardee(&obj5), cast_to_oop(&obj5_));\n+  ASSERT_EQ(ft.forwardee(&obj6), cast_to_oop(&obj6_));\n+  ASSERT_EQ(ft.forwardee(&obj7), cast_to_oop(&obj7_));\n+  ASSERT_EQ(ft.forwardee(&obj8), cast_to_oop(&obj8_));\n+  ASSERT_EQ(ft.forwardee(&obj9), cast_to_oop(&obj9_));\n","filename":"test\/hotspot\/gtest\/gc\/shared\/test_forwardingTable.cpp","additions":50,"deletions":50,"binary":false,"changes":100,"status":"modified"}]}