{"files":[{"patch":"@@ -62,0 +62,1 @@\n+#include \"runtime\/safepoint.hpp\"\n@@ -300,1 +301,7 @@\n-    narrowKlass nklass = obj->mark().narrow_klass();\n+\n+    assert(SafepointSynchronize::is_at_safepoint(), \"resolving displaced headers only at safepoint\");\n+    markWord mark = obj->mark();\n+    if (mark.has_displaced_mark_helper()) {\n+      mark = mark.displaced_mark_helper();\n+    }\n+    narrowKlass nklass = mark.narrow_klass();\n","filename":"src\/hotspot\/share\/cds\/heapShared.cpp","additions":8,"deletions":1,"binary":false,"changes":9,"status":"modified"}]}