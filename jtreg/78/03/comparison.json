{"files":[{"patch":"@@ -114,1 +114,1 @@\n-AGENT_JAVAC_SOURCE_TARGET = --release 8\n+AGENT_JAVAC_SOURCE_TARGET = --release 11\n","filename":"make\/Defs.gmk","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -28,0 +28,5 @@\n+import org.junit.platform.engine.discovery.DiscoverySelectors;\n+import org.junit.platform.launcher.core.LauncherDiscoveryRequestBuilder;\n+import org.junit.platform.launcher.core.LauncherFactory;\n+import org.junit.platform.launcher.listeners.SummaryGeneratingListener;\n+\n@@ -32,1 +37,0 @@\n-\n@@ -38,1 +42,1 @@\n-        JUNIT_NO_DRIVER        = \"No JUnit 4 driver (install junit.jar next to jtreg.jar)\";\n+        JUNIT_NO_DRIVER        = \"No JUnit driver (install junit-platform-console-standalone.jar next to jtreg.jar)\";\n@@ -72,0 +76,5 @@\n+        \/\/ runWithJUnit4(mainClass);\n+        runWithJUnitPlatform(mainClass);\n+    }\n+\n+    private static void runWithJUnit4(Class<?> mainClass) throws Exception {\n@@ -94,0 +103,32 @@\n+    private static void runWithJUnitPlatform(Class<?> mainClass) throws Exception {\n+        \/\/ https:\/\/junit.org\/junit5\/docs\/current\/user-guide\/#launcher-api-execution\n+        Thread.currentThread().setContextClassLoader(mainClass.getClassLoader());\n+        try {\n+\n+            var request = LauncherDiscoveryRequestBuilder.request()\n+                .selectors(DiscoverySelectors.selectClass(mainClass))\n+                .build();\n+\n+            var summaryGeneratingListener = new SummaryGeneratingListener();\n+\n+            try (var session = LauncherFactory.openSession()) {\n+                var launcher = session.getLauncher();\n+                launcher.registerTestExecutionListeners(summaryGeneratingListener);\n+                launcher.execute(request);\n+            }\n+\n+            var summary = summaryGeneratingListener.getSummary();\n+            if (summary.getTotalFailureCount() > 0) {\n+                var sw = new StringWriter();\n+                try (var pw = new PrintWriter(sw)) {\n+                    pw.println(\"JavaTest Message: JUnit Platform Failure(s): \" + summary.getTotalFailureCount());\n+                    summary.printTo(pw);\n+                }\n+                System.err.println(sw);\n+                throw new Exception(\"JUnit test failure\");\n+            }\n+\n+        } catch (NoClassDefFoundError ex) {\n+            throw new Exception(JUNIT_NO_DRIVER, ex);\n+        }\n+    }\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/agent\/JUnitRunner.java","additions":43,"deletions":2,"binary":false,"changes":45,"status":"modified"},{"patch":"@@ -39,1 +39,5 @@\n-\t$(GREP) -s 'Test results: passed: 1; failed: 1' $(@:%.ok=%\/jt.log)  > \/dev\/null\n+\techo $(@:%.ok=%\/jt.log)\n+\tcat $(@:%.ok=%\/jt.log)\n+\techo $(@:%.ok=%\/work\/NPE.jtr)\n+\tcat $(@:%.ok=%\/work\/NPE.jtr)\n+\t$(GREP) -s 'Test results: passed: 2; failed: 1' $(@:%.ok=%\/jt.log)  > \/dev\/null\n@@ -48,0 +52,1 @@\n+INITIAL_TESTS += $(BUILDTESTDIR)\/JUnitTrace.ok\n","filename":"test\/junitTrace\/JUnitTrace.gmk","additions":6,"deletions":1,"binary":false,"changes":7,"status":"modified"},{"patch":"@@ -29,2 +29,0 @@\n-import org.junit.*;\n-\n@@ -32,3 +30,3 @@\n-    @Test\n-    public void test() {\n-        System.out.println(\"Pass\");\n+    @org.junit.Test\n+    public void testJUnit4() {\n+        System.out.println(\"Pass JUnit 4\");\n@@ -36,1 +34,0 @@\n-}\n@@ -38,0 +35,5 @@\n+    @org.junit.jupiter.api.Test\n+    public void testJUnitJupiter() {\n+        System.out.println(\"Pass JUnit Jupiter\");\n+    }\n+}\n","filename":"test\/junitTrace\/Pass.java","additions":8,"deletions":6,"binary":false,"changes":14,"status":"modified"}]}