{"files":[{"patch":"@@ -3,1 +3,1 @@\n-pluginVersion = 1.15\n+pluginVersion = 1.16\n@@ -6,1 +6,1 @@\n-<li>Fix NPE when resolving @library tag<\/li>\\\n+<li>CODETOOLS-7903300: Add test library support to jtreg plugin<\/li>\\\n","filename":"plugins\/idea\/gradle.properties","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -144,2 +144,2 @@\n-                    String dir = \"file:\/\/\" + JTRegService.getInstance(project).getJTRegDir() + File.separator + \"lib\";\n-                    Library library = JTRegUtils.createJTRegLibrary(project, dir, dir);\n+                    String libDir = JTRegService.getInstance(project).getJTRegDir();\n+                    Library library = JTRegUtils.createJTRegLibrary(project, libDir);\n","filename":"plugins\/idea\/src\/main\/java\/com\/oracle\/plugin\/jtreg\/components\/JTRegFileManagerListener.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -138,4 +138,8 @@\n-            \/\/ Create the project library.\n-            String oldDir = \"file:\/\/\" + service.getJTRegDir() + File.separator + \"lib\";\n-            String newDir = \"file:\/\/\" + jtregDir.getText().trim() + File.separator + \"lib\";\n-            JTRegUtils.createJTRegLibrary(project, oldDir, newDir);\n+            \/\/ Create or update the project library.\n+            String oldDir = service.getJTRegDir();\n+            String newDir = jtregDir.getText().trim();\n+            if (oldDir == null || oldDir.isBlank()) {\n+                JTRegUtils.createJTRegLibrary(project, newDir);\n+            } else {\n+                JTRegUtils.updateJTRegLibrary(project, oldDir, newDir);\n+            }\n","filename":"plugins\/idea\/src\/main\/java\/com\/oracle\/plugin\/jtreg\/service\/ui\/JTRegServiceConfigurable.java","additions":8,"deletions":4,"binary":false,"changes":12,"status":"modified"},{"patch":"@@ -42,0 +42,1 @@\n+import java.io.File;\n@@ -352,1 +353,8 @@\n-    public static Library createJTRegLibrary(Project project, String oldDir, String newDir) {\n+    public static Library createJTRegLibrary(Project project, String jtregDir) {\n+        return updateJTRegLibrary(project, null, jtregDir);\n+    }\n+\n+    \/**\n+     * Update the jtreg project library. The library would be created if it doesn't exist.\n+     *\/\n+    public static Library updateJTRegLibrary(Project project, String oldJtregDir, String newJtregDir) {\n@@ -360,2 +368,8 @@\n-        libraryModel.removeRoot(oldDir, OrderRootType.CLASSES);\n-        libraryModel.addJarDirectory(newDir, true);\n+        String oldDir = \"file:\/\/\" + oldJtregDir + File.separator + \"lib\";\n+        if (oldJtregDir != null && !oldJtregDir.isBlank() && libraryModel.isJarDirectory(oldDir, OrderRootType.CLASSES)) {\n+            libraryModel.removeRoot(oldDir, OrderRootType.CLASSES);\n+        }\n+        String newDir = \"file:\/\/\" + newJtregDir + File.separator + \"lib\";\n+        if (newJtregDir != null && !newJtregDir.isBlank() && !libraryModel.isJarDirectory(newDir, OrderRootType.CLASSES)) {\n+            libraryModel.addJarDirectory(newDir, true);\n+        }\n","filename":"plugins\/idea\/src\/main\/java\/com\/oracle\/plugin\/jtreg\/util\/JTRegUtils.java","additions":17,"deletions":3,"binary":false,"changes":20,"status":"modified"}]}