{"files":[{"patch":"@@ -64,0 +64,2 @@\n+    private Throwable globalUncaughtThrowable;\n+\n@@ -203,0 +205,9 @@\n+            Thread.setDefaultUncaughtExceptionHandler((t, e) -> {\n+                synchronized (this) {\n+                    if (e instanceof ThreadDeath)\n+                        return;\n+                    if (globalUncaughtThrowable == null) {\n+                        globalUncaughtThrowable = e;\n+                    }\n+                }\n+            });\n@@ -250,1 +261,2 @@\n-            if (((avmr.t != null) || (tg.uncaughtThrowable != null)) && (error == null)) {\n+            if (((avmr.t != null) || (tg.uncaughtThrowable != null) || (globalUncaughtThrowable != null))\n+                    && (error == null)) {\n@@ -252,2 +264,2 @@\n-                    error = tg.uncaughtThrowable;\n-                } else {\n+                    error = tg.uncaughtThrowable != null ? tg.uncaughtThrowable : globalUncaughtThrowable;\n+                }  else {\n@@ -289,0 +301,1 @@\n+            Thread.setDefaultUncaughtExceptionHandler(null);\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/agent\/MainActionHelper.java","additions":16,"deletions":3,"binary":false,"changes":19,"status":"modified"},{"patch":"@@ -42,0 +42,2 @@\n+    private static Throwable globalUncaughtThrowable = null;\n+\n@@ -73,0 +75,12 @@\n+\n+        Thread.setDefaultUncaughtExceptionHandler((t, e) -> {\n+            synchronized (MainWrapper.class) {\n+                if (e instanceof ThreadDeath)\n+                    return;\n+                e.printStackTrace(System.err);\n+                if (globalUncaughtThrowable == null) {\n+                    globalUncaughtThrowable = e;\n+                }\n+                AStatus.failed(MAIN_THREW_EXCEPT + e).exit();\n+            }\n+        });\n@@ -93,3 +107,0 @@\n-        } else {\n-            AStatus.passed(\"\")\n-                   .exit();\n@@ -97,0 +108,5 @@\n+        if (globalUncaughtThrowable != null) {\n+            handleTestException(globalUncaughtThrowable);\n+        }\n+        AStatus.passed(\"\").exit();\n+\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/agent\/MainWrapper.java","additions":19,"deletions":3,"binary":false,"changes":22,"status":"modified"}]}