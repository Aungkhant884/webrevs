{"files":[{"patch":"@@ -3,1 +3,3 @@\n-_No notewothy changes yet._\n+* Updated set of default environment variables set for tests on Unix-like platforms.\n+  * Includes `DBUS_SESSION_BUS_ADDRESS`, `WAYLAND_DISPLAY`, and `XDG-*` \n+    [CODETOOLS-7903400](https:\/\/bugs.openjdk.org\/browse\/CODETOOLS-7903400)\n","filename":"CHANGELOG.md","additions":3,"deletions":1,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -63,0 +63,1 @@\n+import java.util.function.Predicate;\n@@ -2151,0 +2152,1 @@\n+        Map<String, String> sysEnv = System.getenv();\n@@ -2154,1 +2156,1 @@\n-            addEnvVars(envVars, DEFAULT_WINDOWS_ENV_VARS);\n+            addEnvVars(envVars, sysEnv, DEFAULT_WINDOWS_ENV_VARS);\n@@ -2156,1 +2158,1 @@\n-            addEnvVars(envVars, \"PATH\"); \/\/ accept user's path, for now\n+            addEnvVars(envVars, sysEnv, \"PATH\"); \/\/ accept user's path, for now\n@@ -2158,10 +2160,3 @@\n-            addEnvVars(envVars, DEFAULT_UNIX_ENV_VARS);\n-            addEnvVars(envVars, \"PATH=\/bin:\/usr\/bin:\/usr\/sbin\");\n-        }\n-        addEnvVars(envVars, envVarArgs);\n-        for (Map.Entry<String, String> e: System.getenv().entrySet()) {\n-            String k = e.getKey();\n-            String v = e.getValue();\n-            if (k.startsWith(\"JTREG_\")) {\n-                envVars.put(k, v);\n-            }\n+            addEnvVars(envVars, sysEnv, DEFAULT_UNIX_ENV_VARS);\n+            addEnvVars(envVars, sysEnv, e -> e.getKey().startsWith(\"XDG_\"));\n+            addEnvVars(envVars, sysEnv, \"PATH=\/bin:\/usr\/bin:\/usr\/sbin\");\n@@ -2169,0 +2164,2 @@\n+        addEnvVars(envVars, sysEnv, envVarArgs);\n+        addEnvVars(envVars, sysEnv, e -> e.getKey().startsWith(\"JTREG_\"));\n@@ -2173,2 +2170,2 @@\n-    private void addEnvVars(Map<String, String> table, String list) {\n-        addEnvVars(table, list.split(\",\"));\n+    private void addEnvVars(Map<String, String> table, Map<String, String> sysEnv, String list) {\n+        addEnvVars(table, sysEnv, list.split(\",\"));\n@@ -2177,2 +2174,2 @@\n-    private void addEnvVars(Map<String, String> table, String[] list) {\n-        addEnvVars(table, List.of(list));\n+    private void addEnvVars(Map<String, String> table, Map<String, String> sysEnv, String[] list) {\n+        addEnvVars(table, sysEnv, List.of(list));\n@@ -2181,1 +2178,1 @@\n-    private void addEnvVars(Map<String, String> table, List<String> list) {\n+    private void addEnvVars(Map<String, String> table, Map<String, String> sysEnv, List<String> list) {\n@@ -2191,1 +2188,1 @@\n-                String value = System.getenv(s);\n+                String value = sysEnv.get(s);\n@@ -2202,0 +2199,6 @@\n+    private void addEnvVars(Map<String, String> table, Map<String, String> sysEnv, Predicate<Map.Entry<String, String>> filter) {\n+        sysEnv.entrySet().stream()\n+                .filter(filter)\n+                .forEach(e -> table.put(e.getKey(), e.getValue()));\n+    }\n+\n@@ -2339,2 +2342,8 @@\n-        \"DISPLAY\", \"GNOME_DESKTOP_SESSION_ID\", \"HOME\", \"LANG\",\n-        \"LC_ALL\", \"LC_CTYPE\", \"LPDEST\", \"PRINTER\", \"TZ\", \"XMODIFIERS\"\n+            \"DBUS_SESSION_BUS_ADDRESS\", \"DESKTOP_SESSION\", \"DISPLAY\",\n+            \"GDMSESSION\", \"GNOME_DESKTOP_SESSION_ID\", \"GNOME_SHELL_SESSION_MODE\",\n+            \"HOME\",\n+            \"LANG\", \"LC_ALL\", \"LC_CTYPE\", \"LPDEST\",\n+            \"PRINTER\",\n+            \"TZ\",\n+            \"WAYLAND_DISPLAY\",\n+            \"XMODIFIERS\"\n@@ -2344,1 +2353,3 @@\n-        \"SystemDrive\", \"SystemRoot\", \"windir\", \"TMP\", \"TEMP\", \"TZ\"\n+            \"SystemDrive\", \"SystemRoot\",\n+            \"TMP\", \"TEMP\", \"TZ\",\n+            \"windir\"\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/tool\/Tool.java","additions":32,"deletions":21,"binary":false,"changes":53,"status":"modified"}]}