{"files":[{"patch":"@@ -38,2 +38,13 @@\n- * Interface which should be implemented to customize execution of test.\n- * It is used by main and driver actions to execute test.\n+ * {@code CustomMainWrapper} allows some customization of test execution.\n+ * The jtreg creates new thread for each test using {@code new Thread(ThreadGroup tg, Runnable task);}.\n+ * The implementation of this interface might provide user-defined threads for test execution.\n+ * <p>\n+ * Example:\n+ * <pre>\n+ * new Thread(tg, () -> { ....; task.run(); ....; });\n+ * or\n+ * new VirtualThread(task);\n+ * <\/pre>\n+ * Implementation may be specified on the {@code jtreg} command line\n+ * using {@code -mainWrapper} and {@code -mainWrapperPath} arguments.\n+ * It is executed by tested JDK in {@code agentvm} and {@code othervm} modes.\n@@ -42,4 +53,1 @@\n-    static CustomMainWrapper getInstance(String mainWrapper, String path) {\n-        String[] args = mainWrapper.split(\":\", 2);\n-        String className = args[0];\n-        String actionName = args[1].split(\"=\")[1];\n+    static CustomMainWrapper getInstance(String className, String path) {\n@@ -62,1 +70,0 @@\n-            wrapper.setAction(actionName);\n@@ -71,2 +78,1 @@\n-     * This method should be implemented to run test task.\n-     * Default jtreg implementation is return new Thread(tg, task);\n+     * This method should return unstarted thread which executes test task.\n@@ -74,1 +80,1 @@\n-     * @param task The task which executes test\n+     * @param task The test task\n@@ -78,6 +84,0 @@\n-    \/**\n-     * This method is used to get information about current action.\n-     * @param actionName name of action\n-     *\/\n-    default void setAction(String actionName) {\n-    }\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/agent\/CustomMainWrapper.java","additions":16,"deletions":16,"binary":false,"changes":32,"status":"modified"},{"patch":"@@ -632,1 +632,0 @@\n-\n@@ -634,1 +633,0 @@\n-\n@@ -636,1 +634,0 @@\n-\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/config\/RegressionParameters.java","additions":0,"deletions":3,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -485,1 +485,1 @@\n-            javaProps.put(MainWrapper.MAIN_WRAPPER, script.getCustomWrapper() + \":\" + \"action=\" + this.getName());\n+            javaProps.put(MainWrapper.MAIN_WRAPPER, script.getCustomWrapper());\n@@ -630,1 +630,1 @@\n-            String wrapper = script.getCustomWrapper() == null ? null : script.getCustomWrapper() + \":\" + \"action=\" + this.getName();\n+            String wrapper = script.getCustomWrapper() == null ? null : script.getCustomWrapper();\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/exec\/MainAction.java","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -175,1 +175,2 @@\n-help.main.mw.desc=Main wrapper classname.\n+help.main.mw.desc=Specifies the class to create thread for test execution. \\\n+    The class should implement spcifig interface.\n@@ -177,1 +178,2 @@\n-help.main.mwp.desc=Specifies classspath with custom main wrapper implementation.\n+help.main.mwp.desc=Specifies classspath with custom main wrapper implementation. \\\n+    The classes from this classpath are loaded by tested JDK only using URLClassLoader.\n","filename":"src\/share\/classes\/com\/sun\/javatest\/regtest\/tool\/i18n.properties","additions":4,"deletions":2,"binary":false,"changes":6,"status":"modified"},{"patch":"@@ -34,0 +34,5 @@\n+\/*\n+ * @test\n+ * @run driver Test\n+ *\/\n+\n@@ -40,4 +45,0 @@\n-        if (!\"main\".equals(System.getProperty(\"jtreg.action\"))) {\n-            throw new Exception(\"Property 'jtreg.action'  = \" + System.getProperty(\"jtreg.action\"));\n-        }\n-\n","filename":"test\/mainWrapper\/Test.java","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -32,5 +32,0 @@\n-    @Override\n-    public void setAction(String actionName) {\n-        System.setProperty(\"jtreg.action\", actionName);\n-    }\n-\n@@ -39,1 +34,0 @@\n-\n","filename":"test\/mainWrapper\/TestMainWrapper.java","additions":0,"deletions":6,"binary":false,"changes":6,"status":"modified"}]}