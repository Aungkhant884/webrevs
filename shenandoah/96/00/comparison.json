{"files":[{"patch":"@@ -185,1 +185,0 @@\n-      region->reset_coalesce_and_fill_boundary();\n@@ -191,0 +190,1 @@\n+        region->begin_preemptible_coalesce_and_fill();\n@@ -268,0 +268,4 @@\n+uint ShenandoahOldHeuristics::unprocessed_old_or_hidden_collection_candidates() {\n+  assert(_generation->generation_mode() == OLD, \"This service only available for old-gc heuristics\");\n+  return _old_collection_candidates + _hidden_old_collection_candidates;\n+}\n@@ -271,1 +275,1 @@\n-  return _old_collection_candidates + _hidden_old_collection_candidates;\n+  return _old_collection_candidates;\n@@ -327,1 +331,1 @@\n-  if (unprocessed_old_collection_candidates() > 0) {\n+  if (unprocessed_old_or_hidden_collection_candidates() > 0) {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.cpp","additions":7,"deletions":3,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -95,0 +95,3 @@\n+  \/\/ How many old or hidden collection candidates have not yet been processed?\n+  uint unprocessed_old_or_hidden_collection_candidates();\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/heuristics\/shenandoahOldHeuristics.hpp","additions":3,"deletions":0,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -181,1 +181,1 @@\n-    r->finish_coalesce_and_fill();\n+    r->end_preemptible_coalesce_and_fill();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.cpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -979,1 +979,1 @@\n-        region->reset_coalesce_and_fill_boundary();\n+        region->begin_preemptible_coalesce_and_fill();\n@@ -2715,1 +2715,2 @@\n-  if (doing_mixed_evacuations() || active_generation()->generation_mode() == GLOBAL) {\n+  if (doing_mixed_evacuations() ||\n+      is_concurrent_prep_for_mixed_evacuation_in_progress() || active_generation()->generation_mode() == GLOBAL) {\n@@ -2849,1 +2850,2 @@\n-  if (doing_mixed_evacuations() || active_generation()->generation_mode() == GLOBAL) {\n+  if (doing_mixed_evacuations() ||\n+      is_concurrent_prep_for_mixed_evacuation_in_progress() || active_generation()->generation_mode() == GLOBAL) {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeap.cpp","additions":5,"deletions":3,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -436,1 +436,1 @@\n-    finish_coalesce_and_fill();\n+    end_preemptible_coalesce_and_fill();\n@@ -476,1 +476,1 @@\n-  finish_coalesce_and_fill();\n+  end_preemptible_coalesce_and_fill();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.cpp","additions":2,"deletions":2,"binary":false,"changes":4,"status":"modified"},{"patch":"@@ -375,1 +375,1 @@\n-  inline void reset_coalesce_and_fill_boundary() {\n+  inline void begin_preemptible_coalesce_and_fill() {\n@@ -379,1 +379,1 @@\n-  inline void finish_coalesce_and_fill() {\n+  inline void end_preemptible_coalesce_and_fill() {\n@@ -391,4 +391,0 @@\n-  inline bool coalesce_and_fill_is_done() {\n-    return _coalesce_and_fill_boundary >= _top;\n-  }\n-\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahHeapRegion.hpp","additions":2,"deletions":6,"binary":false,"changes":8,"status":"modified"},{"patch":"@@ -84,1 +84,1 @@\n-void ShenandoahOldGC::entry_old_evacuations() {\n+void ShenandoahOldGC::start_old_evacuations() {\n@@ -194,3 +194,0 @@\n-  \/\/ Prepare for old evacuations (actual evacuations will happen on subsequent young collects).\n-  entry_old_evacuations();\n-\n@@ -217,0 +214,4 @@\n+  \/\/ Prepare for old evacuations (actual evacuations will happen on subsequent young collects).  This cannot\n+  \/\/ begin until after we have completed coalesce-and-fill.\n+  start_old_evacuations();\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGC.cpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -45,1 +45,1 @@\n-  void entry_old_evacuations();\n+  void start_old_evacuations();\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahOldGC.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"},{"patch":"@@ -507,1 +507,1 @@\n-  if (heap->doing_mixed_evacuations()) {\n+  if (heap->doing_mixed_evacuations() || heap->is_concurrent_prep_for_mixed_evacuation_in_progress()) {\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahScanRemembered.inline.hpp","additions":1,"deletions":1,"binary":false,"changes":2,"status":"modified"}]}