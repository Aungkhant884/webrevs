{"files":[{"patch":"@@ -41,2 +41,0 @@\n-#undef KELVIN_MONITOR\n-\n@@ -56,5 +54,0 @@\n-\n-#undef KELVIN_INCREASE_USED\n-#ifdef KELVIN_INCREASE_USED\n-  log_info(gc, ergo)(\"FreeSet::increase_used by \" SIZE_FORMAT \", yielding \" SIZE_FORMAT, num_bytes, _used);\n-#endif\n@@ -139,5 +132,0 @@\n-#ifdef KELVIN_MONITOR\n-  size_t old_regions_examined = 0;\n-  size_t region_with_most_avail = 0;\n-  size_t avail_in_largest_region = 0;\n-#endif\n@@ -154,7 +142,0 @@\n-#ifdef KELVIN_MONITOR\n-          size_t region_available = r->end() - r->top();\n-          if ((old_regions_examined++ == 0) || (region_available > avail_in_largest_region)) {\n-            region_with_most_avail = c;\n-            avail_in_largest_region = region_available;\n-          }\n-#endif\n@@ -162,6 +143,0 @@\n-#ifdef KELVIN_MONITOR\n-            log_info(gc, ergo)(\"aowa succeeds for %s size: \" SIZE_FORMAT \", min_size: \" SIZE_FORMAT \", actual_size: \" SIZE_FORMAT\n-                               \", in region \" SIZE_FORMAT \", remaining available: \" SIZE_FORMAT,\n-                               req.is_lab_alloc()? \"PLAB\": \"shared\", req.size(), req.is_lab_alloc()? req.min_size(): req.size(),\n-                               req.actual_size(), r->index(), r->end() - r->top());\n-#endif\n@@ -185,7 +160,0 @@\n-#ifdef KELVIN_MONITOR\n-          size_t region_available = r->end() - r->top();\n-          if ((old_regions_examined++ == 0) || (region_available > avail_in_largest_region)) {\n-            region_with_most_avail = idx;\n-            avail_in_largest_region = region_available;\n-          }\n-#endif\n@@ -193,6 +161,0 @@\n-#ifdef KELVIN_MONITOR\n-            log_info(gc, ergo)(\"aowa succeeds for %s size: \" SIZE_FORMAT \", min_size: \" SIZE_FORMAT \", actual_size: \" SIZE_FORMAT\n-                               \", in region \" SIZE_FORMAT \", remaining availalble: \" SIZE_FORMAT,\n-                               req.is_lab_alloc()? \"PLAB\": \"shared\", req.size(), req.is_lab_alloc()? req.min_size(): req.size(),\n-                               req.actual_size(), r->index(), r->end() - r->top());\n-#endif\n@@ -205,6 +167,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"aowa failed for %s size: \" SIZE_FORMAT \", min_size: \" SIZE_FORMAT \", scanned \" SIZE_FORMAT\n-                     \" from \" SIZE_FORMAT \" to \" SIZE_FORMAT \", largest available: \" SIZE_FORMAT \" at region \" SIZE_FORMAT,\n-                     req.is_lab_alloc()? \"PLAB\": \"shared\", req.size(), req.is_lab_alloc()? req.min_size(): req.size(),\n-                     old_regions_examined, leftmost, rightmost, avail_in_largest_region, region_with_most_avail);\n-#endif\n@@ -551,11 +507,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-  if (result != nullptr) {\n-    log_info(gc, ergo)(\"try_allocate_in() allocated \" SIZE_FORMAT \" in region \" SIZE_FORMAT \", leaving remnant free: \" SIZE_FORMAT,\n-                       size * HeapWordSize, r->index(), r->free());\n-  } else {\n-    log_info(gc, ergo)(\"try_allocate_in() failed to allocate \" SIZE_FORMAT \" in region \" SIZE_FORMAT \", which has free: \" SIZE_FORMAT,\n-                       size * HeapWordSize, r->index(), r->free());\n-  }\n-  log_info(gc, ergo)(\"has_no_alloc_capacity(\" SIZE_FORMAT \") is %d\", r->index(), has_no_alloc_capacity(r));\n-#endif\n-\n@@ -563,4 +508,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-    log_info(gc, ergo)(\"Retire this region\");\n-#endif\n-\n@@ -738,9 +679,0 @@\n-#ifdef KELVIN_MONITOR\n-  size_t original_m_left = _mutator_leftmost;\n-  size_t original_m_right = _mutator_rightmost;\n-  size_t original_c_left = _collector_leftmost;\n-  size_t original_c_right = _collector_rightmost;\n-  size_t original_oc_left = _old_collector_leftmost;\n-  size_t original_oc_right = _old_collector_rightmost;\n-#endif\n-\n@@ -768,12 +700,0 @@\n-#ifdef KELVIN_MONITOR\n-  if ((original_c_left != _collector_leftmost) || (original_c_right != _collector_rightmost) ||\n-      (original_oc_left != _old_collector_leftmost) || (original_oc_right != _old_collector_rightmost)) {\n-    log_info(gc, ergo)(\"adjust_bounds for mutator [\" SIZE_FORMAT \"-\" SIZE_FORMAT \"] => [\" SIZE_FORMAT \"-\" SIZE_FORMAT\n-                       \"], for collector [\" SIZE_FORMAT \"-\" SIZE_FORMAT \"] -> [\" SIZE_FORMAT \"-\" SIZE_FORMAT\n-                       \"], for old collector [\" SIZE_FORMAT \"-\" SIZE_FORMAT \"] -> [\" SIZE_FORMAT \"-\" SIZE_FORMAT \"]\",\n-                       original_m_left, original_m_right, _mutator_leftmost, _mutator_rightmost,\n-                       original_c_left, original_c_right, _collector_leftmost, _collector_rightmost,\n-                       original_oc_left, original_oc_right, _old_collector_leftmost, _old_collector_rightmost);\n-    \/\/ Don't report mutator adjustments.  They are too frequent.\n-  }\n-#endif\n@@ -887,3 +807,0 @@\n-#ifdef KELVIN_MONITOR\n-    log_info(gc, ergo)(\"alloc_contiguous(\" SIZE_FORMAT \"-\" SIZE_FORMAT \") is adjusting bounds\", beg, end);\n-#endif\n@@ -945,4 +862,0 @@\n-#ifdef KELVIN_MONITOR\n-  size_t original_left = _old_collector_leftmost;\n-  size_t original_right = _old_collector_rightmost;\n-#endif\n@@ -952,5 +865,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"Flipping region \" SIZE_FORMAT \" to OLD GC, %s collector range: [\" SIZE_FORMAT \"-\" SIZE_FORMAT \"] to [\"\n-                     SIZE_FORMAT \"-\" SIZE_FORMAT \"]\", idx, result? \"expanded\": \"preserved\",\n- original_left, original_right, _old_collector_leftmost, _old_collector_rightmost);\n-#endif\n@@ -959,4 +867,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-  log_info(gc, ergo)(\"Capacity decreased by \" SIZE_FORMAT \" to \" SIZE_FORMAT \" after flipping region \" SIZE_FORMAT\n-                     \" to old collector\", alloc_capacity(r), _capacity, r->index());\n-#endif\n@@ -977,4 +881,0 @@\n-#ifdef KELVIN_MONITOR\n-  size_t original_left = _collector_leftmost;\n-  size_t original_right = _collector_rightmost;\n-#endif\n@@ -984,5 +884,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"Flipping region \" SIZE_FORMAT \" to GC, collector range: [\" SIZE_FORMAT \"-\" SIZE_FORMAT \"] to [\"\n-                     SIZE_FORMAT \"-\" SIZE_FORMAT \"]\",\n-                     idx, original_left, original_right, _collector_leftmost, _collector_rightmost);\n-#endif\n@@ -991,4 +886,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-  log_info(gc, ergo)(\"Capacity decreased by \" SIZE_FORMAT \" to \" SIZE_FORMAT \" after flipping region \" SIZE_FORMAT \" to collector\",\n-                     alloc_capacity(r), _capacity, r->index());\n-#endif\n@@ -1028,3 +919,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"Rebuilding FreeSet\");\n-#endif\n@@ -1033,6 +921,0 @@\n-#ifdef KELVIN_MONITOR\n-    bool was_collector_free = false;\n-    if (is_collector_free(idx)) {\n-      was_collector_free = true;\n-    }\n-#endif\n@@ -1049,5 +931,0 @@\n-#ifdef KELVIN_MONITOR_X\n-      if (has_no_alloc_capacity(region)) {\n-        log_info(gc, ergo)(\"Region \" SIZE_FORMAT \" not part of FreeSet because it has no alloc capacity\", region->index());\n-      }\n-#endif\n@@ -1064,4 +941,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-        log_info(gc, ergo)(\"Rebuild capacity increased by \" SIZE_FORMAT \" to \" SIZE_FORMAT \" for region \" SIZE_FORMAT,\n-                           alloc_capacity(region), _capacity, region->index());\n-#endif\n@@ -1072,6 +945,0 @@\n-#ifdef KELVIN_MONITOR\n-        if (was_collector_free) {\n-          log_info(gc, ergo)(\"Treating Region \" SIZE_FORMAT \" as _mutator_free and collector_free!  region capacity: \" SIZE_FORMAT\n-                             \", total capacity: \" SIZE_FORMAT, idx, alloc_capacity(region), _capacity);\n-        }\n-#endif\n@@ -1084,6 +951,0 @@\n-#ifdef KELVIN_MONITOR_X\n-    else {\n-      log_info(gc, ergo)(\"Region \" SIZE_FORMAT \" not part of FreeSet because allocation not allowed and region is not trash\",\n-                         region->index());\n-    }\n-#endif\n@@ -1092,5 +953,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"After rebuild but before reserve\");\n-  log_status();\n-#endif\n-\n@@ -1113,4 +969,0 @@\n-#ifdef KELVIN_MONITOR\n-      log_info(gc, ergo)(\"Freeset for this evacuation, young reserve: \" SIZE_FORMAT \", old reserve: \" SIZE_FORMAT,\n-                         young_reserve, old_reserve);\n-#endif\n@@ -1122,4 +974,0 @@\n-#ifdef KELVIN_MONITOR\n-      log_info(gc, ergo)(\"Freeset for next evacuation, young reserve: \" SIZE_FORMAT \", old reserve: \" SIZE_FORMAT,\n-                         young_reserve, old_reserve);\n-#endif\n@@ -1131,4 +979,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"After rebuild and reserve and recomputing bounds, allocate old left to right is: %s\",\n-                     _old_collector_search_left_to_right? \"true\": \"false\");\n-#endif\n@@ -1140,7 +984,0 @@\n-#ifdef KELVIN_MONITOR\n-  size_t original_old_capacity = _old_capacity;\n-  size_t leftmost_reserved = 0;\n-  size_t rightmost_reserved = 0;\n-  size_t leftmost_old_reserved = 0;\n-  size_t rightmost_old_reserved = 0;\n-#endif\n@@ -1148,8 +985,0 @@\n-#ifdef KELVIN_MONITOR_X\n-    if (reserved <= to_reserve) {\n-      log_info(gc, ergo)(\"Reserving \" SIZE_FORMAT \" more, region \" SIZE_FORMAT \" has capacity: \" SIZE_FORMAT,\n-                         to_reserve - reserved, idx, alloc_capacity(_heap->get_region(idx)));\n-    } else {\n-      log_info(gc, ergo)(\"Resevations are done\");\n-    }\n-#endif\n@@ -1165,5 +994,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-        log_info(gc, ergo)(\"Rebuild reserve capacity decreased by \" SIZE_FORMAT \" to \" SIZE_FORMAT\n-                           \" after flipping region \" SIZE_FORMAT \" to old collector\",\n-                           ac, _capacity, r->index());\n-#endif\n@@ -1171,6 +995,0 @@\n-#ifdef KELVIN_MONITOR\n-        leftmost_old_reserved = idx;\n-        if (rightmost_old_reserved == 0) {\n-          rightmost_old_reserved = idx;\n-        }\n-#endif\n@@ -1187,5 +1005,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-        log_info(gc, ergo)(\"Rebuild reserve capacity decreased by \" SIZE_FORMAT \" to \" SIZE_FORMAT\n-                           \" after flipping region \" SIZE_FORMAT \" to young collector\",\n-                           ac, _capacity, r->index());\n-#endif\n@@ -1193,6 +1006,0 @@\n-#ifdef KELVIN_MONITOR\n-        leftmost_reserved = idx;\n-        if (rightmost_reserved == 0) {\n-          rightmost_reserved = idx;\n-        }\n-#endif\n@@ -1206,8 +1013,0 @@\n-#ifdef KELVIN_MONITOR\n-  log_info(gc, ergo)(\"Successfully reserved for young: \" SIZE_FORMAT \" between \" SIZE_FORMAT \" and \" SIZE_FORMAT\n-                     \", reserved for old: \" SIZE_FORMAT \" between \" SIZE_FORMAT \" and \" SIZE_FORMAT\n-                     \" (of which \" SIZE_FORMAT \" is scattered)\"\n-                     \", with remaining allocation capacity: \" SIZE_FORMAT,\n-                     reserved, leftmost_reserved, rightmost_reserved,\n-                     _old_capacity, leftmost_old_reserved, rightmost_old_reserved, original_old_capacity, _capacity);\n-#endif\n@@ -1338,4 +1137,0 @@\n-#ifdef KELVIN_INCREASE_USED\n-          log_info(gc, ergo)(\"FreeSet:free increased by \" SIZE_FORMAT \", yielding \" SIZE_FORMAT \", for region \" SIZE_FORMAT,\n-                             free, total_free, idx);\n-#endif\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahFreeSet.cpp","additions":0,"deletions":205,"binary":false,"changes":205,"status":"modified"}]}