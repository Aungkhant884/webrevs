{"files":[{"patch":"@@ -112,0 +112,3 @@\n+const size_t ShenandoahRegionChunkIterator::_smallest_chunk_size_words = (_clusters_in_smallest_chunk * CardTable::card_size_in_words() *\n+                                                  ShenandoahCardCluster<ShenandoahDirectCardMarkRememberedSet>::CardsPerCluster);\n+\n@@ -252,2 +255,5 @@\n-  assert(_smallest_chunk_size_words == _clusters_in_smallest_chunk * CardTable::card_size_in_words()\n-         * ShenandoahCardCluster<ShenandoahDirectCardMarkRememberedSet>::CardsPerCluster, \"_smallest_chunk_size is not valid\");\n+#ifdef ASSERT\n+  size_t expected_chunk_size_words = _clusters_in_smallest_chunk * CardTable::card_size_in_words() * ShenandoahCardCluster<ShenandoahDirectCardMarkRememberedSet>::CardsPerCluster;\n+  assert(_smallest_chunk_size_words == expected_chunk_size_words, \"_smallest_chunk_size (\" SIZE_FORMAT\") is not valid because it does not equal (\" SIZE_FORMAT \")\",\n+      _smallest_chunk_size_words, expected_chunk_size_words);\n+#endif\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahScanRemembered.cpp","additions":8,"deletions":2,"binary":false,"changes":10,"status":"modified"},{"patch":"@@ -497,1 +497,1 @@\n-  static const size_t CardsPerCluster = 64;\n+  static constexpr size_t CardsPerCluster = 64;\n@@ -1024,1 +1024,1 @@\n-  static const size_t _maximum_chunk_size_words = (4 * 1024 * 1024) \/ HeapWordSize;\n+  static const size_t _maximum_chunk_size_words = (4 * M) \/ HeapWordSize;\n@@ -1026,2 +1026,1 @@\n-  static const size_t _clusters_in_smallest_chunk = 4;\n-  static const size_t _assumed_words_in_card = 64;\n+  static constexpr size_t _clusters_in_smallest_chunk = 4;\n@@ -1029,2 +1028,2 @@\n-  \/\/ smallest_chunk_size is 4 clusters (i.e. 128 KiB).  Note that there are 64 words per card and there are 64 cards per\n-  \/\/ cluster.  Each cluster spans 128 KiB.\n+  \/\/ smallest_chunk_size is 4 clusters (i.e. 128 KiB).  Note that there are 64 cards per cluster.  Each cluster spans\n+  \/\/ 128 KiB (using a 64 bit word).\n@@ -1033,4 +1032,1 @@\n-  \/\/ We can't perform this computation here, because of encapsulation and initialization constraints.  We paste\n-  \/\/ the magic number here, and assert that this number matches the intended computation in constructor.\n-  static const size_t _smallest_chunk_size_words = (_clusters_in_smallest_chunk * _assumed_words_in_card *\n-                                                    ShenandoahCardCluster<ShenandoahDirectCardMarkRememberedSet>::CardsPerCluster);\n+  static const size_t _smallest_chunk_size_words;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahScanRemembered.hpp","additions":6,"deletions":10,"binary":false,"changes":16,"status":"modified"}]}