{"files":[{"patch":"@@ -298,2 +298,1 @@\n-  char msg[1024];\n-  init_mark_event_message(msg, sizeof(msg));\n+  const char* msg = init_mark_event_message();\n@@ -311,2 +310,1 @@\n-  char msg[1024];\n-  final_mark_event_message(msg, sizeof(msg));\n+  const char* msg = final_mark_event_message();\n@@ -400,1 +398,0 @@\n-  char msg[1024];\n@@ -403,1 +400,1 @@\n-  conc_mark_event_message(msg, sizeof(msg));\n+  const char* msg = conc_mark_event_message();\n@@ -1229,1 +1226,1 @@\n-void ShenandoahConcurrentGC::init_mark_event_message(char* buf, size_t len) const {\n+const char* ShenandoahConcurrentGC::init_mark_event_message() const {\n@@ -1233,1 +1230,1 @@\n-    jio_snprintf(buf, len, \"Pause Init Mark (%s) (unload classes)\", _generation->name());\n+    SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Init Mark\", \" (unload classes)\");\n@@ -1235,1 +1232,1 @@\n-    jio_snprintf(buf, len, \"Pause Init Mark (%s)\", _generation->name());\n+    SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Init Mark\", \"\");\n@@ -1239,1 +1236,1 @@\n-void ShenandoahConcurrentGC::final_mark_event_message(char* buf, size_t len) const {\n+const char* ShenandoahConcurrentGC::final_mark_event_message() const {\n@@ -1243,0 +1240,1 @@\n+\n@@ -1244,1 +1242,1 @@\n-    jio_snprintf(buf, len, \"Pause Final Mark (%s) (unload classes)\", _generation->name());\n+    SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Final Mark\", \" (unload classes)\");\n@@ -1246,1 +1244,1 @@\n-    jio_snprintf(buf, len, \"Pause Final Mark (%s)\", _generation->name());\n+    SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Final Mark\", \"\");\n@@ -1250,1 +1248,1 @@\n-void ShenandoahConcurrentGC::conc_mark_event_message(char* buf, size_t len) const {\n+const char* ShenandoahConcurrentGC::conc_mark_event_message() const {\n@@ -1255,1 +1253,1 @@\n-    jio_snprintf(buf, len, \"Concurrent marking (%s) (unload classes)\", _generation->name());\n+    SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Concurrent marking\", \" (unload classes)\");\n@@ -1257,1 +1255,1 @@\n-    jio_snprintf(buf, len, \"Concurrent marking (%s)\", _generation->name());\n+    SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Concurrent marking\", \"\");\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.cpp","additions":13,"deletions":15,"binary":false,"changes":28,"status":"modified"},{"patch":"@@ -133,4 +133,5 @@\n-  \/\/ Messages for GC trace events\n-  void init_mark_event_message(char* buf, size_t len) const;\n-  void final_mark_event_message(char* buf, size_t len) const;\n-  void conc_mark_event_message(char* buf, size_t len) const;\n+  \/\/ Messages for GC trace events, they have to be immortal for\n+  \/\/ passing around the logging\/tracing systems\n+  const char* init_mark_event_message() const;\n+  const char* final_mark_event_message() const;\n+  const char* conc_mark_event_message() const;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahConcurrentGC.hpp","additions":5,"deletions":4,"binary":false,"changes":9,"status":"modified"},{"patch":"@@ -73,2 +73,1 @@\n-  char msg[1024];\n-  degen_event_message(_degen_point, msg, sizeof(msg));\n+  const char* msg = degen_event_message(_degen_point);\n@@ -445,2 +444,18 @@\n-void ShenandoahDegenGC::degen_event_message(ShenandoahDegenPoint point, char* buf, size_t len) const {\n-  jio_snprintf(buf, len, \"Pause Degenerated %s GC (%s)\", _generation->name(), ShenandoahGC::degen_point_to_string(point));\n+const char* ShenandoahDegenGC::degen_event_message(ShenandoahDegenPoint point) const {\n+  switch (point) {\n+    case _degenerated_unset:\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (<UNSET>)\");\n+    case _degenerated_outside_cycle:\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (Outside of Cycle)\");\n+    case _degenerated_roots:\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (Roots)\");\n+    case _degenerated_mark:\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (Mark)\");\n+    case _degenerated_evac:\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (Evacuation)\");\n+    case _degenerated_updaterefs:\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (Update Refs)\");\n+    default:\n+      ShouldNotReachHere();\n+      SHENANDOAH_RETURN_EVENT_MESSAGE(_generation->type(), \"Pause Degenerated GC\", \" (?)\");\n+  }\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahDegeneratedGC.cpp","additions":19,"deletions":4,"binary":false,"changes":23,"status":"modified"},{"patch":"@@ -67,1 +67,0 @@\n-  void degen_event_message(ShenandoahDegenPoint point, char* buf, size_t len) const;\n@@ -69,0 +68,2 @@\n+\n+  const char* degen_event_message(ShenandoahDegenPoint point) const;\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahDegeneratedGC.hpp","additions":2,"deletions":1,"binary":false,"changes":3,"status":"modified"},{"patch":"@@ -47,0 +47,13 @@\n+#define SHENANDOAH_RETURN_EVENT_MESSAGE(generation_type, prefix, postfix) \\\n+  switch (generation_type) {                                              \\\n+    case GLOBAL:                                                          \\\n+      return prefix \"\" postfix;                                           \\\n+    case YOUNG:                                                           \\\n+      return prefix \" (YOUNG)\" postfix;                                   \\\n+    case OLD:                                                             \\\n+      return prefix \" (OLD)\" postfix;                                     \\\n+    default:                                                              \\\n+      ShouldNotReachHere();                                               \\\n+      return prefix \" (?)\" postfix;                                       \\\n+  }                                                                       \\\n+\n","filename":"src\/hotspot\/share\/gc\/shenandoah\/shenandoahUtils.hpp","additions":13,"deletions":0,"binary":false,"changes":13,"status":"modified"}]}